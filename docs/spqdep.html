<!DOCTYPE html><html lang="en"><head><title>Help for package spqdep</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {spqdep}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#spqdep-package'><p>spqdep: Testing for Spatial Independence of Cross-Sectional Qualitative Data</p></a></li>
<li><a href='#Boots.sf'><p>Boots.sf.</p></a></li>
<li><a href='#cr_symb'><p>A function to create symbols</p></a></li>
<li><a href='#dgp.spq'><p>Generation of qualitative process with spatial structure</p></a></li>
<li><a href='#FastFood.sf'><p>Selection of fast food restaurants in Toronto</p></a></li>
<li><a href='#jc.test'><p>A function to compute joint-count test for</p>
binomial and multinomial (asymptotic and
permutation distributions).</a></li>
<li><a href='#local.sp.runs.test'><p>A function to calculate the local spatial runs tests.</p></a></li>
<li><a href='#m.surround'><p>A function to generate m-surroundings</p></a></li>
<li><a href='#methods_localjc'><p>Methods for class localjc</p></a></li>
<li><a href='#methods_localsrq'><p>Methods for class localsrq</p></a></li>
<li><a href='#methods_m_surr'><p>Method for class m_surr</p></a></li>
<li><a href='#methods_qmap'><p>Method for class qmap</p></a></li>
<li><a href='#methods_scantest'><p>Methods for class scantest</p></a></li>
<li><a href='#methods_spqtest'><p>Methods for class spqtest</p></a></li>
<li><a href='#nb2nb_order'><p>A function to order the elements of the m_i-subrrounds</p></a></li>
<li><a href='#plot.sprunstest'><p>Plot the empirical distribution of runs</p></a></li>
<li><a href='#print.summary.spjctest'><p>Print method for objects of class summary.spjctest.</p></a></li>
<li><a href='#print.summary.spqtest'><p>Print method for objects of class summary.spqtest.</p></a></li>
<li><a href='#provinces_spain'><p>Provinces in Spain.</p></a></li>
<li><a href='#Q.map.test'><p>Compute the QE and QI tests of Equivalence and Independence between maps</p></a></li>
<li><a href='#Q.test'><p>A function to compute Q test for spatial qualitative data</p></a></li>
<li><a href='#scan.test'><p>Compute the scan test</p></a></li>
<li><a href='#similarity.test'><p>Compute the similarity test.</p></a></li>
<li><a href='#sp.runs.test'><p>Compute the global spatial runs test.</p></a></li>
<li><a href='#summary.spjctest'><p>Summary of estimated objects of class <em>spjctest</em>.</p></a></li>
<li><a href='#summary.spqtest'><p>Summary of estimated objects of class <em>spqtest</em>.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Testing for Spatial Independence of Cross-Sectional Qualitative
Data</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.3.5</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-12-17</td>
</tr>
<tr>
<td>Description:</td>
<td>Testing for Spatial Dependence of Qualitative Data in Cross Section. The list of functions includes join-count tests, Q test, spatial scan test, similarity test and spatial runs test. The methodology of these models can be found in &lt;<a href="https://doi.org/10.1007%2Fs10109-009-0100-1">doi:10.1007/s10109-009-0100-1</a>&gt; and &lt;<a href="https://doi.org/10.1080%2F13658816.2011.586327">doi:10.1080/13658816.2011.586327</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://f8l5h9.github.io/spqdep/">https://f8l5h9.github.io/spqdep/</a></td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Imports:</td>
<td>broom, dplyr, ggplot2, gt, gtools, igraph, Matrix, methods,
purrr, rsample, sf, sp, spatialreg, spdep, stats, tidyr</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/f8l5h9/spqdep/issues">https://github.com/f8l5h9/spqdep/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-12-18 10:30:18 UTC; fernandoair</td>
</tr>
<tr>
<td>Author:</td>
<td>Fernando Lopez <a href="https://orcid.org/0000-0002-5397-9748"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Roman Minguez <a href="https://orcid.org/0000-0002-0490-3181"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Antonio Paez <a href="https://orcid.org/0000-0001-6912-9919"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Manuel Ruiz <a href="https://orcid.org/0000-0001-9228-6410"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Fernando Lopez &lt;fernando.lopez@upct.es&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-01-08 09:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='spqdep-package'>spqdep: Testing for Spatial Independence of Cross-Sectional Qualitative Data</h2><span id='topic+spqdep'></span><span id='topic+spqdep-package'></span>

<h3>Description</h3>

<p>Testing for Spatial Dependence of Qualitative Data in Cross Section. The list of functions includes join-count tests, Q test, spatial scan test, similarity test and spatial runs test. The methodology of these models can be found in <a href="https://doi.org/10.1007/s10109-009-0100-1">doi:10.1007/s10109-009-0100-1</a> and <a href="https://doi.org/10.1080/13658816.2011.586327">doi:10.1080/13658816.2011.586327</a>.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Fernando Lopez <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> (<a href="https://orcid.org/0000-0002-5397-9748">ORCID</a>)
</p>
<p>Authors:
</p>

<ul>
<li><p> Roman Minguez <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> (<a href="https://orcid.org/0000-0002-0490-3181">ORCID</a>)
</p>
</li>
<li><p> Antonio Paez <a href="mailto:paezha@gmail.com">paezha@gmail.com</a> (<a href="https://orcid.org/0000-0001-6912-9919">ORCID</a>)
</p>
</li>
<li><p> Manuel Ruiz <a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a> (<a href="https://orcid.org/0000-0001-9228-6410">ORCID</a>)
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://f8l5h9.github.io/spqdep/">https://f8l5h9.github.io/spqdep/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/f8l5h9/spqdep/issues">https://github.com/f8l5h9/spqdep/issues</a>
</p>
</li></ul>


<hr>
<h2 id='Boots.sf'>Boots.sf.</h2><span id='topic+Boots.sf'></span>

<h3>Description</h3>

<p>A simple features object square regular lattice 16x16. from Fig. 3.3 in Upton
and Fingleton (1985). In this figure, the cells coded black/white correspond
to quadrats where the perennial shrub Atriplex hymenelytra is present/absent
in a sample area in Death Valley, California.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(Boots.sf)
</code></pre>


<h3>Format</h3>

<p>A simple features dataframe with 256 rows and 1 column:
</p>

<dl>
<dt>BW</dt><dd><p>A factor with two levels: Black and White</p>
</dd>
</dl>



<h3>Source</h3>

<p>Boots, B. (2003) Developing local measures of spatial association for categorical data, Journal of Geographical Systems, 5(2), 139-160. <a href="https://doi.org/10.1007/s10109-003-0110-3">doi:10.1007/s10109-003-0110-3</a>
</p>


<h3>References</h3>


<ul>
<li><p> Boots, B. (2003). Developing local measures of spatial association
for categorical data. Journal of Geographical Systems, 5(2), 139-160. <a href="https://doi.org/10.1007/s10109-003-0110-3">doi:10.1007/s10109-003-0110-3</a>
</p>
</li>
<li><p> Upton G., Fingleton B. (1985) Spatial data analysis by example.
Volume 1: Point pattern and quantitative data.
John Wiley &amp; Sons, Chichester
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'> data(Boots.sf)
 summary(Boots.sf)
</code></pre>

<hr>
<h2 id='cr_symb'>A function to create symbols</h2><span id='topic+cr_symb'></span>

<h3>Description</h3>

<p>This function obtains the set of symbols to get the Q-statistic
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cr_symb(k = k, m = m)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cr_symb_+3A_k">k</code></td>
<td>
<p>number of categories</p>
</td></tr>
<tr><td><code id="cr_symb_+3A_m">m</code></td>
<td>
<p>length of the m-surrounding</p>
</td></tr>
</table>


<h3>Details</h3>

<p>...
</p>


<h3>Value</h3>

<p>A list with two types of symbols. Permutation and Combinations-totals
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>p_symb</code> </td><td style="text-align: left;"> Matrix with symbols (permutations)</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>c_symb</code> </td><td style="text-align: left;">  Matrix with symbols (combinations)</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
Fernando López  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Román Mínguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Antonio Páez </td><td style="text-align: left;"> <a href="mailto:paezha@gmail.com">paezha@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Manuel Ruiz </td><td style="text-align: left;"> <a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Ruiz M, López FA, A Páez. (2010). <em>Testing for spatial association of qualitative
data using symbolic dynamics</em>. Journal of Geographical Systems. 12 (3) 281-309
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+m.surround">m.surround</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Example 1: Obtain symbols for k=2 classes and m-surroundings of size 5
symb25 &lt;- cr_symb(2,5)
symb25$p_symb # Permutations symbols
symb25$c_symb # Combinations-totals symbols
</code></pre>

<hr>
<h2 id='dgp.spq'>Generation of qualitative process with spatial structure</h2><span id='topic+dgp.spq'></span>

<h3>Description</h3>

<p>The purpose of the function <code>dgp.spq</code> is to generate a random dataset
with the dimensions and spatial structure decided by the user. This function may be
useful in pure simulation experiments or with the aim of showing specific properties
and characteristics of a spatial qualitative dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dgp.spq(listw = listw, p = p,  rho = rho, control = list())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dgp.spq_+3A_listw">listw</code></td>
<td>
<p>A <code>listw</code> object of the class nb, knn, listw o matrix created
for example by
<code><a href="spdep.html#topic+nb2listw">nb2listw</a></code> from <span class="pkg">spatialreg</span> package; if
<code><a href="spdep.html#topic+nb2listw">nb2listw</a></code> not given, set to
the same spatial weights as the <code>listw</code> argument. It can
also be a spatial weighting matrix of order <em>(NxN)</em> instead of
a <code>listw</code> object. Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="dgp.spq_+3A_p">p</code></td>
<td>
<p>a vector with the percentage of elements of each categories.
The lengths must be the number of categories.
The sum of the elements of vector must be 1.</p>
</td></tr>
<tr><td><code id="dgp.spq_+3A_rho">rho</code></td>
<td>
<p>the level of spatial dependence (values between -1 y 1)</p>
</td></tr>
<tr><td><code id="dgp.spq_+3A_control">control</code></td>
<td>
<p>List of additional control arguments. See control argument section.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In order to obtain categorical random variables with controlled degrees
of spatial dependence, we have designed a two- stage data generating process:<br />
<br />
Firstly, we simulate autocorrelated data using the following model:
</p>
<p style="text-align: center;"><code class="reqn">Y = (I - \rho W)^{-1} \epsilon</code>
</p>

<p>where <code class="reqn">\epsilon = N(0,1)</code> I is the <code class="reqn">N \times N</code> identity matrix, <code class="reqn">\rho</code> is a parameter
of spatial dependence, and <em>W</em> is a connectivity matrix that
determines the set of spatial relationships among points.<br />
<br />
In the second step of the data generation process, the continuous spatially
autocorrelated variable Y is used to define a discrete spatial process
as follows. Let <code class="reqn">b_{ij}</code> be defined by:<br />
</p>
<p style="text-align: center;"><code class="reqn">p(Y \leq b_{ij})= {i \over j} \ \ \ with \ \ \ i&lt;j</code>
</p>

<p>Let <code class="reqn">A =\{a_1,a_2,...,a_k\}</code> and define the discrete spatial process as:
</p>
<p style="text-align: center;"><code class="reqn">X_s=a_1 \ \ \ if \ \ \ Y_s \leq b_{1k}</code>
</p>

<p style="text-align: center;"><code class="reqn">X_s=a_i \ \ \ if \ \ \ b_{i-1k} &lt; Y_s \leq b_{ik}</code>
</p>

<p style="text-align: center;"><code class="reqn">X_s=a_k \ \ \ if \ \ \ Y_s &gt; b_{k-1k}</code>
</p>



<h3>Value</h3>

<p>a factor of length N (<code>listw</code> is a matrix of order <em>(NxN)</em>) with
levels the first capital letters: &quot;A&quot;, &quot;B&quot;, ....
</p>
<p>The description of the DGP is available in Páez et al. 2010 (pag 291) and in details section.
</p>


<h3>Control arguments</h3>


<dl>
<dt>seedinit</dt><dd><p>seed to generate the data sets</p>
</dd>
</dl>



<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
Fernando López  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Román Mínguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Antonio Páez </td><td style="text-align: left;"> <a href="mailto:paezha@gmail.com">paezha@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Manuel Ruiz </td><td style="text-align: left;"> <a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Ruiz M, López FA, A Páez. (2010). <em>Testing for spatial association of qualitative
data using symbolic dynamics</em>. Journal of Geographical Systems. 12 (3) 281-309
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+Q.test">Q.test</a></code>, <code><a href="#topic+Q.map.test">Q.map.test</a></code>, <code><a href="#topic+sp.runs.test">sp.runs.test</a></code>, <code><a href="#topic+scan.test">scan.test</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#
N &lt;- 100
cx &lt;- runif(N)
cy &lt;- runif(N)
coor &lt;- cbind(cx,cy)
p &lt;- c(1/6,3/6,2/6)
rho = 0.5
listw &lt;- spdep::nb2listw(spdep::knn2nb(spdep::knearneigh(cbind(cx,cy), k = 4)))
xf &lt;- dgp.spq(list = listw, p = p, rho = rho)

data(provinces_spain)
listw &lt;- spdep::poly2nb(provinces_spain, queen = FALSE)
p &lt;- c(1/6,3/6,2/6)
rho = 0.9
xf &lt;- dgp.spq(p = p, listw = listw, rho = rho)
provinces_spain$xf &lt;- xf
plot(provinces_spain["xf"])
</code></pre>

<hr>
<h2 id='FastFood.sf'>Selection of fast food restaurants in Toronto</h2><span id='topic+FastFood.sf'></span>

<h3>Description</h3>

<p>A simple feature (sf) dataframe containing the locations of a selection of fast food restaurants
in the city of Toronto, Canada (data are from 2008). The data are projected using EPSG: 26917 (WGS 84/UTM Zone 17N).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(FastFood.sf)
</code></pre>


<h3>Format</h3>

<p>A simple features object with 614 rows and 3 variables:
</p>

<dl>
<dt>ID</dt><dd><p>Unique identifier of record.</p>
</dd>
<dt>Class</dt><dd><p>Factor with 3 types of fast food restaurants: [P]izza, [S]andwich, and [H]amburger</p>
</dd>
<dt>geometry</dt><dd><p>Geometry of simple features.</p>
</dd>
</dl>



<h3>Source</h3>

<p>Ruiz et al. (2010)
<a href="https://link.springer.com/article/10.1007/s10109-009-0100-1">https://link.springer.com/article/10.1007/s10109-009-0100-1</a>
</p>


<h3>References</h3>


<ul>
<li><p> Ruiz M, López FA, A Páez. (2010). <em>Testing for spatial association of qualitative
data using symbolic dynamics</em>. Journal of Geographical Systems. 12 (3) 281-309
</p>
</li></ul>


<hr>
<h2 id='jc.test'>A function to compute joint-count test for
binomial and multinomial (asymptotic and
permutation distributions).</h2><span id='topic+jc.test'></span>

<h3>Description</h3>

<p>A function to compute joincount
tests for spatial qualitative data. This function
is a wrapper of <code><a href="spdep.html#topic+joincount.multi">joincount.multi</a></code>
and <code><a href="spdep.html#topic+joincount.test">joincount.test</a></code>
in <span class="pkg">spdep</span> package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>jc.test(formula = NULL,
               data = NULL,
               fx = NULL,
               listw = NULL,
               na.action,
               zero.policy = NULL,
               distr = "asymptotic",
               alternative = "greater",
               control =list())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="jc.test_+3A_formula">formula</code></td>
<td>
<p>a symbolic description of the factor(s).</p>
</td></tr>
<tr><td><code id="jc.test_+3A_data">data</code></td>
<td>
<p>an (optional) data frame or a sf object
with points/multipolygons geometry containing the
variable(s) to be tested.</p>
</td></tr>
<tr><td><code id="jc.test_+3A_fx">fx</code></td>
<td>
<p>a factor  or a matrix of factors in columns</p>
</td></tr>
<tr><td><code id="jc.test_+3A_listw">listw</code></td>
<td>
<p>A <code>listw</code> object created for example by
<code><a href="spdep.html#topic+nb2listw">nb2listw</a></code> from <span class="pkg">spdep</span> package;
if <code><a href="spdep.html#topic+nb2listw">nb2listw</a></code> not given,
the spatial weights are built using the object given
in <code>listw</code> argument (usually an <code>sf</code>
object). Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="jc.test_+3A_na.action">na.action</code></td>
<td>
<p>A function (default <code>options("na.action")</code>),
can also be <code>na.omit</code> or <code>na.exclude</code>.
It may be necessary to set <code>zero.policy</code>
to <code>TRUE</code> because this subsetting may
create no-neighbour observations.</p>
</td></tr>
<tr><td><code id="jc.test_+3A_zero.policy">zero.policy</code></td>
<td>
<p>Similar to the corresponding parameter of
<code><a href="spatialreg.html#topic+lagsarlm">lagsarlm</a></code> function in
<span class="pkg">spatialreg</span> package.
If <code>TRUE</code> assign zero to the lagged value of zones without
neighbours. Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="jc.test_+3A_distr">distr</code></td>
<td>
<p>character. Distribution type &quot;asymptotic&quot; (default) or &quot;mc&quot;.</p>
</td></tr>
<tr><td><code id="jc.test_+3A_alternative">alternative</code></td>
<td>
<p>character string specifying the alternative hypothesis,
must be one of &quot;greater&quot; (default), or &quot;less&quot;.</p>
</td></tr>
<tr><td><code id="jc.test_+3A_control">control</code></td>
<td>
<p>list of additional arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An <code>spjctest</code> object. This type of object
is a list of <code>htest</code> objects.
The length of the list is the number of
factor variables included in the
<code>formula</code> or the number of columns
in <code>fx</code>.
Each element of the list can be a
<code>jclist</code> object, for binomial factors,
or a <code>jcmulti</code> object for multinomial
factors. See <code><a href="spdep.html#topic+joincount.test">joincount.test</a></code>
or <code><a href="spdep.html#topic+joincount.multi">joincount.multi</a></code>
for additional details.
</p>


<h3>Control arguments</h3>


<table>
<tr>
 <td style="text-align: left;">
<code>nsim</code> </td><td style="text-align: left;"> number of permutations used in
the Monte Carlo distribution.
Default <code>nsim</code> = 999. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>seedinit</code> </td><td style="text-align: left;"> seed to select the initial
element during the simulations.
Default <code>seedinit</code> = 1111. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>adjust.n</code> </td><td style="text-align: left;"> default <em>TRUE</em>,
if <em>FALSE</em> the number of observations
is not adjusted for no-neighbour
observations, if <em>TRUE</em>, the number of
observations is adjusted consistently.
See <code><a href="spdep.html#topic+joincount.multi">joincount.multi</a></code>
for aditional information. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>spChk</code> </td><td style="text-align: left;">	should the data vector
names be checked against the spatial
objects for identity integrity,
<em>TRUE</em>, or <em>FALSE</em>, default <em>NULL</em> to
use <em>get.spChkOption()</em>.
See <code><a href="spdep.html#topic+joincount.multi">joincount.multi</a></code>
for aditional information. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>sampling</code> </td><td style="text-align: left;"> default <em>nonfree</em>,
may be <em>free</em>.
See <code><a href="spdep.html#topic+joincount.test">joincount.test</a></code> for
additional information. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>queen</code> </td><td style="text-align: left;"> default <em>TRUE</em>. Defines
the neighborhood criteria for <em>sf</em>
objects. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>style</code> </td><td style="text-align: left;"> defines the style for
<code>listw</code>. Default = <em>B</em> (binary). </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>knn</code> </td><td style="text-align: left;"> chooses the number of
neighboors when this criteria is used.
Default <code>knn</code> = 5.
</td>
</tr>

</table>



<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
Fernando López  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Román Mínguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Antonio Páez </td><td style="text-align: left;"> <a href="mailto:paezha@gmail.com">paezha@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Manuel Ruiz </td><td style="text-align: left;"> <a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Cliff, A. D., Ord, J. K. 1981 <em>Spatial processes</em>, Pion, pp. 19-20.
</p>
</li>
<li><p> Upton, G., Fingleton, B. 1985 <em>Spatial data analysis by example: point pattern and qualitative data</em>, Wiley, pp. 158–170.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+print.summary.spqtest">print.summary.spqtest</a></code>,
<code><a href="spdep.html#topic+joincount.test">joincount.test</a></code>,
<code><a href="spdep.html#topic+joincount.multi">joincount.multi</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Case 1
## Multinomial + Binomial using a sf multipolygon

data("provinces_spain")
# sf::sf_use_s2(FALSE)
provinces_spain$Mal2Fml &lt;- factor(provinces_spain$Mal2Fml &gt; 100)
levels(provinces_spain$Mal2Fml) = c("men","woman")
provinces_spain$Older &lt;- cut(provinces_spain$Older, breaks = c(-Inf,19,22.5,Inf))
levels(provinces_spain$Older) = c("low","middle","high")
f1 &lt;- ~ Older + Mal2Fml
jc1 &lt;- jc.test(formula = f1,
               data = provinces_spain,
               distr = "mc",
               alternative = "greater",
               zero.policy = TRUE)
summary(jc1)

provinces_spain$Coast &lt;- factor(provinces_spain$Coast)
levels(provinces_spain$Coast) = c("no","yes")
f2 &lt;- ~ Mal2Fml + Coast
jc2 &lt;- jc.test(formula = f2,
               data = provinces_spain,
               distr = "mc",
               zero.policy = TRUE)
summary(jc2)


# Case 2:
## Multinomial using a sf multipoint
data("FastFood.sf")
# sf::sf_use_s2(FALSE)
f1 &lt;- ~ Type
jc3 &lt;- jc.test(formula = f1,
               data = FastFood.sf,
               distr = "asymptotic",
               control = list(knn = 6))
 summary(jc3)

# Examples function joincount.test
data(oldcol, package = "spdep")
HICRIME &lt;- cut(COL.OLD$CRIME, breaks = c(0,35,80), labels = c("low","high"))
names(HICRIME) &lt;- rownames(COL.OLD)
jc4 &lt;- jc.test(fx = HICRIME,
               listw = spdep::nb2listw(COL.nb,
               style="B"))
summary(jc4)
 jc5 &lt;- jc.test(fx = HICRIME,
                listw = spdep::nb2listw(COL.nb, style="B"),
                distr = "mc")
 summary(jc5)
 HICRIME &lt;- cut(COL.OLD$CRIME, breaks = c(0, 35, 80),
                labels = c("low","high"))
 names(HICRIME) &lt;- rownames(COL.OLD)
 jc6 &lt;- jc.test(fx = HICRIME,
                listw = spdep::nb2listw(COL.nb,
                                 style = "B"))
summary(jc6)

</code></pre>

<hr>
<h2 id='local.sp.runs.test'>A function to calculate the local spatial runs tests.</h2><span id='topic+local.sp.runs.test'></span>

<h3>Description</h3>

<p>This function calculates the local spatial runs tests for all localizations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>local.sp.runs.test(formula = NULL, data = NULL, fx = NULL,
distr = "asymptotic", listw = listw, alternative = "two.sided" , nsim = NULL,
control = list())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="local.sp.runs.test_+3A_formula">formula</code></td>
<td>
<p>An (optional) formula with the factor included in <code>data</code></p>
</td></tr>
<tr><td><code id="local.sp.runs.test_+3A_data">data</code></td>
<td>
<p>An (optional) data frame or a sf object containing the variable to testing for.</p>
</td></tr>
<tr><td><code id="local.sp.runs.test_+3A_fx">fx</code></td>
<td>
<p>An (optional) factor of observations with the same length as the neighbors list in <code>listw</code></p>
</td></tr>
<tr><td><code id="local.sp.runs.test_+3A_distr">distr</code></td>
<td>
<p>a character string specifying the distribution &quot;asymptotic&quot; (default) or &quot;bootstrap&quot;</p>
</td></tr>
<tr><td><code id="local.sp.runs.test_+3A_listw">listw</code></td>
<td>
<p>A neighbourhood list (an object type knn or nb) or a W matrix that indicates the order of the elements in each  $m_i-environment$
(for example of inverse distance). To calculate the number of runs in each $m_i-environment$, an order must
be established, for example from the nearest neighbour to the furthest one.</p>
</td></tr>
<tr><td><code id="local.sp.runs.test_+3A_alternative">alternative</code></td>
<td>
<p>a character string specifying the alternative hypothesis, must be one
of &quot;two.sided&quot; (default), &quot;greater&quot; or &quot;less&quot;.</p>
</td></tr>
<tr><td><code id="local.sp.runs.test_+3A_nsim">nsim</code></td>
<td>
<p>Default value is NULL to obtain the asymptotic version of the local test.
For the bootstrap version nsim is the number of permutations to obtain the pseudo-value.</p>
</td></tr>
<tr><td><code id="local.sp.runs.test_+3A_control">control</code></td>
<td>
<p>Optional argument. See Control Argument section.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The object <code>listw</code> can be the class:
</p>

<ul>
<li> <p><code>knn</code>: Objects of the class knn that consider the neighbours in
order of proximity.
</p>
</li>
<li> <p><code>nb</code>: If the neighbours are obtained from an sf object, the code internally
will call the function <code><a href="#topic+nb2nb_order">nb2nb_order</a></code> it will order them in order
of proximity of the centroids.
</p>
</li>
<li> <p><code>matrix</code>: If a object of matrix class based in the inverse of
the distance in introduced as argument, the function <code><a href="#topic+nb2nb_order">nb2nb_order</a></code> will
also be called internally to transform the object the class matrix to a matrix of the
class nb with ordered neighbours.
</p>
</li></ul>



<h3>Value</h3>

<p>The output is an object of the class localsrq <br />
<br />
<code>local.SRQ</code> A matrix with <br />
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>runs.i</code> </td><td style="text-align: left;"> number of runs in the localization 'i'. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>E.i</code> </td><td style="text-align: left;"> expectation of local runs statistic in the localization 'i'. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>Sd.i</code> </td><td style="text-align: left;"> standard deviate of local runs statistic in the localization 'i'. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>z.value</code> </td><td style="text-align: left;"> standard value of local runs statistic (only for asymptotic version). </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>p.value</code> </td><td style="text-align: left;"> p-value of local local runs statistic (only for asymptotic version). </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>zseudo.value</code> </td><td style="text-align: left;"> standard value of local runs statistic (only for boots version). </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>pseudo.value</code> </td><td style="text-align: left;"> p-value of local runs statistic (only for boots version). </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p><code>MeanNeig</code> Mean of run.i <br />
<code>MaxNeig</code> Maximum of run.i  <br />
<code>listw</code> the object <code>listw</code> <br />
<code>alternative</code> a character string describing the alternative hypothesis <br />
</p>


<h3>Control arguments</h3>


<table>
<tr>
 <td style="text-align: left;">
<code>seedinit</code> </td><td style="text-align: left;"> Numerical value for the seed in boot version. Default value seedinit = 123 </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
Fernando López  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Román Mínguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Antonio Páez </td><td style="text-align: left;"> <a href="mailto:paezha@gmail.com">paezha@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Manuel Ruiz </td><td style="text-align: left;"> <a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>@references
</p>

<ul>
<li><p> Ruiz, M., López, F., and Páez, A. (2021).
A test for global and local homogeneity of categorical data based on spatial runs.
<em>Working paper</em>.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+sp.runs.test">sp.runs.test</a></code>, <code><a href="#topic+dgp.spq">dgp.spq</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Case 1: Local spatial runs test based on knn
N &lt;- 100
cx &lt;- runif(N)
cy &lt;- runif(N)
x &lt;- cbind(cx,cy)
listw &lt;- spdep::knearneigh(cbind(cx,cy), k = 10)
p &lt;- c(1/6,3/6,2/6)
rho &lt;- 0.5
fx &lt;- dgp.spq(p = p, listw = listw, rho = rho)

# Asymtotic version
lsrq &lt;- local.sp.runs.test(fx = fx, listw = listw, alternative = "less")
print(lsrq)
plot(lsrq, sig = 0.05)
# Asymtotic version
lsrq &lt;- local.sp.runs.test(fx = fx, listw = listw, alternative = "two.sided",
                           distr ="bootstrap", nsim = 399)
print(lsrq)
plot(lsrq, sig = 0.1)

# Case 2:Fastfood example. sf (points)
data("FastFood.sf")
# sf::sf_use_s2(FALSE)
x &lt;- sf::st_coordinates(sf::st_centroid(FastFood.sf))
listw &lt;- spdep::knearneigh(x, k = 10)
formula &lt;- ~ Type
lsrq &lt;- local.sp.runs.test(formula = formula, data = FastFood.sf, listw = listw)
print(lsrq)
plot(lsrq, sf = FastFood.sf, sig = 0.05)


# Case 3: With a sf object (poligons)
fname &lt;- system.file("shape/nc.shp", package="sf")
nc &lt;- sf::st_read(fname)
listw &lt;- spdep::poly2nb(as(nc,"Spatial"), queen = FALSE)
p &lt;- c(1/6,3/6,2/6)
rho = 0.5
nc$fx &lt;- dgp.spq(p = p, listw = listw, rho = rho)
plot(nc["fx"])
formula &lt;- ~ fx
lsrq &lt;- local.sp.runs.test(formula = formula, data = nc, listw = listw)
print(lsrq)
plot(lsrq, sf = nc)
# Version boot
lsrq &lt;- local.sp.runs.test(formula = formula, data = nc, listw = listw,
                           distr ="bootstrap", nsim = 399)
print(lsrq)
plot(lsrq, sf = nc)

# Case 4: With isolated areas
data(provinces_spain)
listw &lt;- spdep::poly2nb(as(provinces_spain,"Spatial"), queen = FALSE)
provinces_spain$Mal2Fml&lt;- factor(provinces_spain$Mal2Fml &gt; 100)
levels(provinces_spain$Mal2Fml) = c("men","woman")
plot(provinces_spain["Mal2Fml"])
formula &lt;- ~ Mal2Fml
lsrq &lt;- local.sp.runs.test(formula = formula, data = provinces_spain, listw = listw)
print(lsrq)
plot(lsrq, sf = provinces_spain, sig = 0.1)

# Boots Version
lsrq &lt;- local.sp.runs.test(formula = formula, data = provinces_spain, listw = listw,
                           distr ="bootstrap", nsim = 199)
print(lsrq)
plot(lsrq, sf = provinces_spain, sig = 0.10)

# Case 5: SRQ test based on a distance matrix (inverse distance)

N &lt;- 100
cx &lt;- runif(N)
cy &lt;- runif(N)
coor &lt;- as.data.frame(cbind(cx,cy))
coor &lt;- sf::st_as_sf(coor,coords = c("cx","cy"))
n = dim(coor)[1]
dis &lt;- 1/matrix(as.numeric(sf::st_distance(coor,coor)), ncol = n, nrow = n)
diag(dis) &lt;- 0
dis &lt;- (dis &lt; quantile(dis,.10))*dis
p &lt;- c(1/6,3/6,2/6)
rho &lt;- 0.5
fx &lt;- dgp.spq(p = p, listw = dis, rho = rho)
lsrq &lt;- local.sp.runs.test(fx = fx, listw = dis)
print(lsrq)
plot(lsrq, coor = cbind(cx,cy), sig = 0.05)
lsrq &lt;- local.sp.runs.test(fx = fx, listw = dis, data = )
print(lsrq)
plot(lsrq, sf = coor)
# Version boots
lsrq &lt;- local.sp.runs.test(fx = fx, listw = dis, data = coor,
                           distr ="bootstrap", nsim = 299)
print(lsrq)
plot(lsrq, sf = coor)

# SRQ test based on inverse distance
data("FastFood.sf")
# sf::sf_use_s2(FALSE)
n = dim(FastFood.sf)[1]
dis &lt;- 1000000/matrix(as.numeric(
          sf::st_distance(FastFood.sf, FastFood.sf)),
          ncol = n, nrow = n)
diag(dis) &lt;- 0
dis &lt;- (dis &lt; quantile(dis,.01))*dis
formula &lt;- ~ Type
lsrq &lt;- local.sp.runs.test(formula = formula, data = FastFood.sf, listw = dis)
print(lsrq)
# plot(lsrq, sf = FastFood.sf)

</code></pre>

<hr>
<h2 id='m.surround'>A function to generate m-surroundings</h2><span id='topic+m.surround'></span>

<h3>Description</h3>

<p>This function obtains the m-surroundings
by selecting the <em>m-1</em> nearest neighbors
of each observation, allowing for a degree of
overlap of <em>r</em>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>m.surround(x, m, r = 1, distance = "Euclidean", control = list())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="m.surround_+3A_x">x</code></td>
<td>
<p>input sf object with points/multipolygons geometry or matrix
of spatial coordinates</p>
</td></tr>
<tr><td><code id="m.surround_+3A_m">m</code></td>
<td>
<p>dimension of m-surrounding</p>
</td></tr>
<tr><td><code id="m.surround_+3A_r">r</code></td>
<td>
<p>maximum overlapping between any two m-surroundings.</p>
</td></tr>
<tr><td><code id="m.surround_+3A_distance">distance</code></td>
<td>
<p>character. For Cartesian coordinates only: one of Euclidean,
Hausdorff or Frechet; for geodetic coordinates, Great Circle distances are
computed. (see <code>sf::st_distance()</code>).
Default = &quot;Euclidean&quot;.</p>
</td></tr>
<tr><td><code id="m.surround_+3A_control">control</code></td>
<td>
<p>List of additional control arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of class <code>list</code> and <code>m_surr</code> containing the following components:<br />
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>ms</code> </td><td style="text-align: left;"> a matrix. Each row is a m-surrounding. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>R</code> </td><td style="text-align: left;"> total number of observations. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>rowexcl</code> </td><td style="text-align: left;"> index of rows excluded. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>mdtms</code> </td><td style="text-align: left;"> distances between the observations of
each m-surrounding.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>N</code> </td><td style="text-align: left;"> total number of symbolized observations.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>m</code> </td><td style="text-align: left;"> length of the m-surroundings.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>r</code> </td><td style="text-align: left;"> overlapping degree.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>initobs</code> </td><td style="text-align: left;"> element to start the generation of m-surroundings.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>distance</code> </td><td style="text-align: left;"> type of distance.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>m</code> </td><td style="text-align: left;"> length of the m-surroundings.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>x</code> </td><td style="text-align: left;"> the input "x" as sf-object.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Control arguments</h3>


<ul>
<li> <p><code>initobs</code>: Initial observation to begin the
m-surrounding process. Default = 1.
</p>
</li>
<li> <p><code>dtmaxabs</code>: Threshold of distance (in absolute
value) to prune the m-surroundings. Any m-surrounding
exceeding the threshold is excluded.
If <code>dtmaxabs</code> = 0 there is no exclusion of m-surroundings.
Default = 0.
</p>
</li>
<li>  <p><code>dtmaxpc</code>: Threshold of distance (as a percentage
of the maximum distance between observations) to prune the m-surroundings. Any m-surrounding
exceeding the threshold is excluded.
Example if <code>dtmaxpc</code> = 0.1 the m-surrounding exceeding
the 10% of the maximum distance between observations are excluded.
If <code>dtmaxpc</code> = 0 there is no exclusion of m-surroundings.
Default = 0.
</p>
</li>
<li>  <p><code>dtmaxknn</code>: Eliminate m-surroundings where some
of the elements are not among the closest
knn (k-nearest-neighbors).
Example, if <code>dtmaxknn</code> = 4 exclude m-surroundings
where some of the elements are not between the 4 closest.
Default <code>dtmaxknn</code> = 0 (no exclusion)
</p>
</li></ul>



<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
Fernando López  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Román Mínguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Antonio Páez </td><td style="text-align: left;"> <a href="mailto:paezha@gmail.com">paezha@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Manuel Ruiz </td><td style="text-align: left;"> <a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Ruiz M, López FA, A Páez. (2010). Testing for spatial association of qualitative
data using symbolic dynamics. <em>Journal of Geographical Systems</em>. 12 (3) 281-309
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
# Example 1: Obtain m-surroundings with degree of overlapping r
N &lt;- 100
cx &lt;- runif(N)
cy &lt;- runif(N)
x &lt;- cbind(cx,cy)
m &lt;- 3
r &lt;- 1
msurr_points &lt;- m.surround(x = x, m = m, r = r)
plot(msurr_points, type = 1)
plot(msurr_points, type = 2)
summary(msurr_points)
msurr_points &lt;- m.surround(x = x, m = m, r = r,
                control = list(dtmaxpc = 0.1))
plot(msurr_points, type = 1)
plot(msurr_points, type = 2)
summary(msurr_points)
msurr_points &lt;- m.surround(x = x, m = m, r = r,
                   control = list(dtmaxknn = 20))
plot(msurr_points, type = 1)
plot(msurr_points, type = 2)
summary(msurr_points)

# Example 2:

data("FastFood.sf")
m &lt;- 3
r &lt;- 1
msurr_points &lt;- m.surround(x = FastFood.sf, m = m, r = r,
                           distance = "Euclidean",
                           control = list(dtmaxpc = .001))
plot(msurr_points, type = 1)
plot(msurr_points, type = 2)
print(msurr_points)
summary(msurr_points)
msurr_points &lt;- m.surround(x = FastFood.sf, m = m, r = r,
                           distance = "Euclidean",
                           control = list(dtmaxknn = 20))
plot(msurr_points, type = 1)
plot(msurr_points, type = 2)
summary(msurr_points)


# Example 3: With isolated areas
data(provinces_spain)
# sf::sf_use_s2(FALSE)
plot(sf::st_geometry(provinces_spain))
m &lt;- 3
r &lt;- 1
msurr_points &lt;- m.surround(x = provinces_spain, m = m, r = r,
                           distance = "Euclidean",
                           control = list(dtmaxknn = 8))
plot(msurr_points, type = 1)
plot(msurr_points, type = 2)

# Example 4: With regular lattice
sfc = sf::st_sfc(sf::st_polygon(list(rbind(c(0,0), c(1,0), c(1,1), c(0,1), c(0,0)))))
hexs &lt;- sf::st_make_grid(sfc, cellsize = 0.1, square = FALSE)
hexs.sf &lt;- sf::st_sf(hexs)
listw  &lt;- spdep::poly2nb(as(hexs.sf, "Spatial"), queen = FALSE)
m &lt;- 3
r &lt;- 1
msurr_polygonsf &lt;- m.surround(x = hexs.sf, m = m, r = r)
plot(msurr_polygonsf, type = 1)
plot(msurr_polygonsf, type = 2)
summary(msurr_polygonsf)
</code></pre>

<hr>
<h2 id='methods_localjc'>Methods for class localjc</h2><span id='topic+methods_localjc'></span><span id='topic+print.localjc'></span><span id='topic+plot.localjc'></span>

<h3>Description</h3>

<p>The <code>plot()</code> function allows the user to plot significant observations.
The <code>print()</code> function is used to print the number of runs in each localization. Additional information of
expected values and standard deviation, z-value ans p-value is prited for each observation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'localjc'
print(x, ...)

## S3 method for class 'localjc'
plot(x, ..., sf = NULL, coor = NULL, sig = 0.05)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="methods_localjc_+3A_x">x</code></td>
<td>
<p>a <code>localjc</code> object created by <code><a href="#topic+Q.test">Q.test</a></code>.</p>
</td></tr>
<tr><td><code id="methods_localjc_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
<tr><td><code id="methods_localjc_+3A_sf">sf</code></td>
<td>
<p>optional argument for <code>plot()</code> method to include a sf object (default = NULL)</p>
</td></tr>
<tr><td><code id="methods_localjc_+3A_coor">coor</code></td>
<td>
<p>optional argument for <code>plot()</code> method to include coordinates of points (default = NULL)</p>
</td></tr>
<tr><td><code id="methods_localjc_+3A_sig">sig</code></td>
<td>
<p>significant level for each observation in <code>plot()</code> method. Default <code>sig = 0.05</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
Fernando López  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Román Mínguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Antonio Páez </td><td style="text-align: left;"> <a href="mailto:paezha@gmail.com">paezha@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Manuel Ruiz </td><td style="text-align: left;"> <a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Ruiz, M., López, F., and Páez, A. (2021).
A test for global and local homogeneity of categorical data based on spatial runs.
<em>working paper</em>.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Example 1: Local spatial runs test based on knn
N &lt;- 100
cx &lt;- runif(N)
cy &lt;- runif(N)
x &lt;- cbind(cx,cy)
listw &lt;- spdep::knearneigh(cbind(cx,cy), k = 10)
p &lt;- c(1/6,3/6,2/6)
rho &lt;- 0.5
fx &lt;- dgp.spq(p = p, listw = listw, rho = rho)

# Asymtotic version
lsrq &lt;- local.sp.runs.test(fx = fx, listw = listw, alternative = "less")
print(lsrq)
plot(lsrq, sig = 0.05)

</code></pre>

<hr>
<h2 id='methods_localsrq'>Methods for class localsrq</h2><span id='topic+methods_localsrq'></span><span id='topic+print.localsrq'></span><span id='topic+plot.localsrq'></span>

<h3>Description</h3>

<p>The <code>plot()</code> function allows the user to plot significant observations.
The <code>print()</code> function is used to print the number of runs in each localization. Additional information of
expected values and standard deviation, z-value ans p-value is prited for each observation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'localsrq'
print(x, ...)

## S3 method for class 'localsrq'
plot(x, ..., sf = NULL, coor = NULL, sig = 0.05)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="methods_localsrq_+3A_x">x</code></td>
<td>
<p>a <code>localsrq</code> object created by <code><a href="#topic+Q.test">Q.test</a></code>.</p>
</td></tr>
<tr><td><code id="methods_localsrq_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
<tr><td><code id="methods_localsrq_+3A_sf">sf</code></td>
<td>
<p>optional argument for <code>plot()</code> method to include a sf object (default = NULL)</p>
</td></tr>
<tr><td><code id="methods_localsrq_+3A_coor">coor</code></td>
<td>
<p>optional argument for <code>plot()</code> method to include coordinates of points (default = NULL)</p>
</td></tr>
<tr><td><code id="methods_localsrq_+3A_sig">sig</code></td>
<td>
<p>significant level for each observation in <code>plot()</code> method. Default <code>sig = 0.05</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
Fernando López  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Román Mínguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Antonio Páez </td><td style="text-align: left;"> <a href="mailto:paezha@gmail.com">paezha@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Manuel Ruiz </td><td style="text-align: left;"> <a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Ruiz, M., López, F., and Páez, A. (2021).
A test for global and local homogeneity of categorical data based on spatial runs.
<em>working paper</em>.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Example 1: Local spatial runs test based on knn
N &lt;- 100
cx &lt;- runif(N)
cy &lt;- runif(N)
x &lt;- cbind(cx,cy)
listw &lt;- spdep::knearneigh(cbind(cx,cy), k = 10)
p &lt;- c(1/6,3/6,2/6)
rho &lt;- 0.5
fx &lt;- dgp.spq(p = p, listw = listw, rho = rho)

# Asymtotic version
lsrq &lt;- local.sp.runs.test(fx = fx, listw = listw, alternative = "less")
print(lsrq)
plot(lsrq, sig = 0.05)

</code></pre>

<hr>
<h2 id='methods_m_surr'>Method for class m_surr</h2><span id='topic+methods_m_surr'></span><span id='topic+summary.m_surr'></span><span id='topic+plot.m_surr'></span><span id='topic+print.m_surr'></span>

<h3>Description</h3>

<p>A function to plots the m-surrounds give an object of the
class <em>m_surr</em> obtain with the code <code>m.surround</code>.<br />
The <code>plot()</code> function allows the user view the configuration of the m-surroundings.<br />
The argument <code>type</code> select the type o visualization. <br />
The <code>print()</code> print the matrix of the m-surrounding. <br />.
The <code>summary</code> give information about the characteristics of the m-surroundings. <br />.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'm_surr'
summary(object, ...)

## S3 method for class 'm_surr'
plot(x, ..., type = 1)

## S3 method for class 'm_surr'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="methods_m_surr_+3A_object">object</code></td>
<td>
<p>object of class <em>m_surr</em>.
2 plot W matrix with network</p>
</td></tr>
<tr><td><code id="methods_m_surr_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
<tr><td><code id="methods_m_surr_+3A_x">x</code></td>
<td>
<p>object of class <em>m_surr</em></p>
</td></tr>
<tr><td><code id="methods_m_surr_+3A_type">type</code></td>
<td>
<p>numeric. 1 (default) to get the plot with igraph.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
Fernando López  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Román Mínguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Antonio Páez </td><td style="text-align: left;"> <a href="mailto:paezha@gmail.com">paezha@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Manuel Ruiz </td><td style="text-align: left;"> <a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Ruiz, M., López, F., and Páez, A. (2021).
A test for global and local homogeneity of categorical data based on spatial runs.
<em>Working paper</em>.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
# Example 1: Obtain m-surroundings with degree of overlapping r
N &lt;- 100
cx &lt;- runif(N)
cy &lt;- runif(N)
x &lt;- cbind(cx,cy)
m = 4
r = 2
msurr_points &lt;- m.surround(x = x, m = m, r = r,control = list(dtmaxabs = 0.5))
plot(msurr_points, type = 1)
plot(msurr_points, type = 2)
print(msurr_points)

# Example 2:
data("FastFood.sf")
m = 6
r = 1
msurr_points &lt;-  m.surround(x = FastFood.sf, m = m, r = r, distance = "Euclidean",
                            control = list(dtmaxpc = .2))
plot(msurr_points, type = 1)
plot(msurr_points, type = 2)
print(msurr_points)

</code></pre>

<hr>
<h2 id='methods_qmap'>Method for class qmap</h2><span id='topic+methods_qmap'></span>

<h3>Description</h3>

<p>A function to plot the difference in frequencies of symbols of each map.
The <code>plot()</code> function to obtain the plot.
The argument <code>ci</code> select the confidence level. <br />
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="methods_qmap_+3A_x">x</code></td>
<td>
<p>object of class <em>qmap</em></p>
</td></tr>
<tr><td><code id="methods_qmap_+3A_ci">ci</code></td>
<td>
<p>confidence level for the difference of probabilities of symbols in <code>plot</code> method.
Default <code>ci = 0.95</code></p>
</td></tr>
<tr><td><code id="methods_qmap_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
Fernando López  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Román Mínguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Antonio Páez </td><td style="text-align: left;"> <a href="mailto:paezha@gmail.com">paezha@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Manuel Ruiz </td><td style="text-align: left;"> <a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Ruiz M, López FA and A Páez (2011).
Comparison of Thematic Maps Using Symbolic Entropy.
<em>International Journal of Geographical Information Science</em>,  26, 413-439.
</p>
</li>
<li><p> Ruiz, M., López, F., and Páez, A. (2021).
A test for global and local homogeneity of categorical data based on spatial runs.
<em>working paper</em>.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Example 1:
N &lt;- 100
cx &lt;- runif(N)
cy &lt;- runif(N)
coor &lt;- cbind(cx,cy)
p &lt;- c(1/6,3/6,2/6)
rho = 0.5
listw &lt;- spdep::nb2listw(spdep::knn2nb(spdep::knearneigh(cbind(cx,cy), k = 4)))
fx &lt;- dgp.spq(list = listw, p = p, rho = rho)
q.test &lt;- Q.test(fx = fx, coor = coor, m = 3, r = 1)
plot(q.test)
</code></pre>

<hr>
<h2 id='methods_scantest'>Methods for class scantest</h2><span id='topic+methods_scantest'></span><span id='topic+plot.scantest'></span><span id='topic+summary.scantest'></span>

<h3>Description</h3>

<p>The <code>plot()</code> function allows the user plot the significant cluster(s).<br />
<code><a href="base.html#topic+summary">summary</a></code> list information about the most likelihood cluster.<br />
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'scantest'
plot(x, ..., sf = NULL, coor = NULL)

## S3 method for class 'scantest'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="methods_scantest_+3A_x">x</code></td>
<td>
<p>is a <code>scantest</code> object created by <code><a href="#topic+scan.test">scan.test</a></code> for <code>plot()</code> method.</p>
</td></tr>
<tr><td><code id="methods_scantest_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
<tr><td><code id="methods_scantest_+3A_sf">sf</code></td>
<td>
<p>optional argument for <code>plot()</code> method to include a sf object (default = NULL)</p>
</td></tr>
<tr><td><code id="methods_scantest_+3A_coor">coor</code></td>
<td>
<p>optional argument for <code>plot()</code> method to include coordinates of points (default = NULL)</p>
</td></tr>
<tr><td><code id="methods_scantest_+3A_object">object</code></td>
<td>
<p>a <code>scantest</code> object created by <code><a href="#topic+scan.test">scan.test</a></code> for <code>summary()</code> method.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
Fernando López  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Román Mínguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Antonio Páez </td><td style="text-align: left;"> <a href="mailto:paezha@gmail.com">paezha@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Manuel Ruiz </td><td style="text-align: left;"> <a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Ruiz, M., López, F., and Páez, A. (2021).
A test for global and local homogeneity of categorical data based on spatial runs.
<em>Working paper</em>.
</p>
</li></ul>


<hr>
<h2 id='methods_spqtest'>Methods for class spqtest</h2><span id='topic+methods_spqtest'></span><span id='topic+plot.spqtest'></span>

<h3>Description</h3>

<p>The <code>plot()</code> function allows the user obtain the plot of relative frequency
of each symbol (standard and equivalent) with the confidence interval.
The <code>print()</code> function is used to get a list with the values of Q test
for standard symbolization based on permutations and for equivalent symbolization
based on combinations. <code>summary()</code> print a table with the output of the Q test.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'spqtest'
plot(x, ..., ci = 0.95)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="methods_spqtest_+3A_x">x</code></td>
<td>
<p>a <code>spqtest</code> object created by <code><a href="#topic+Q.test">Q.test</a></code>.</p>
</td></tr>
<tr><td><code id="methods_spqtest_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods</p>
</td></tr>
<tr><td><code id="methods_spqtest_+3A_ci">ci</code></td>
<td>
<p>confidence level for the intervals in <code>plot</code> method.
Default <code>ci = 0.95</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>This functions does not return any value
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
Fernando López  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Román Mínguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Antonio Páez </td><td style="text-align: left;"> <a href="mailto:paezha@gmail.com">paezha@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Manuel Ruiz </td><td style="text-align: left;"> <a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Ruiz, M., López, F., and Páez, A. (2021).
A test for global and local homogeneity of categorical data based on spatial runs.
<em>working paper</em>.
</p>
</li></ul>


<hr>
<h2 id='nb2nb_order'>A function to order the elements of the m_i-subrrounds</h2><span id='topic+nb2nb_order'></span>

<h3>Description</h3>

<p>An auxiliary function. In the case of obtaining the list of neighbors of class
nb or poly2nb, it is necessary to reorder the elements based on distance and/or angle.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nb2nb_order(listw = listw, sf = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="nb2nb_order_+3A_listw">listw</code></td>
<td>
<p>an object of the nb class.</p>
</td></tr>
<tr><td><code id="nb2nb_order_+3A_sf">sf</code></td>
<td>
<p>the sf object used to get the <code>listw</code> .</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Sort the elements of a list nb. First by distance and
</p>


<h3>Value</h3>

<p>An object of the nb class with the elements in order.
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
Fernando López  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Román Mínguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Antonio Páez </td><td style="text-align: left;"> <a href="mailto:paez@gmail.com">paez@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Manuel Ruiz </td><td style="text-align: left;"> <a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>@references
</p>

<ul>
<li><p> Ruiz, M., López, F., and Páez, A. (2021).
A test for global and local homogeneity of categorical data based on spatial runs.
<em>Working paper</em>.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+dgp.spq">dgp.spq</a></code>, <code><a href="#topic+sp.runs.test">sp.runs.test</a></code>, <code><a href="#topic+local.sp.runs.test">local.sp.runs.test</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# With a sf object (irregular lattice)
library(sf)
fname &lt;- system.file("shape/nc.shp", package="sf")
nc &lt;- sf::st_read(fname)
listw &lt;- spdep::poly2nb(as(nc,"Spatial"), queen = FALSE)
listw.order &lt;- nb2nb_order(listw = listw, sf = nc)

# With a sf object (regular lattice: hexagons)
sfc = sf::st_sfc(sf::st_polygon(list(rbind(c(0,0), c(1,0), c(1,1), c(0,1), c(0,0)))))
hexs &lt;- sf::st_make_grid(sfc, cellsize = 0.1, square = FALSE)
hexs.sf &lt;- sf::st_sf(hexs)
listw  &lt;- spdep::poly2nb(as(hexs.sf, "Spatial"), queen = FALSE)
listw.order &lt;- nb2nb_order(listw = listw, sf = hexs.sf)

</code></pre>

<hr>
<h2 id='plot.sprunstest'>Plot the empirical distribution of runs</h2><span id='topic+plot.sprunstest'></span>

<h3>Description</h3>

<p>Plot the empirical distribution of runs
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'sprunstest'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.sprunstest_+3A_x">x</code></td>
<td>
<p>A object of class <em>sprunstest</em>.</p>
</td></tr>
<tr><td><code id="plot.sprunstest_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Plot the histogram with the empirical distribution
of the runs
</p>


<h3>Value</h3>

<p>No return value, called for side effects
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
Fernando López  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Román Mínguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Antonio Páez </td><td style="text-align: left;"> <a href="mailto:paez@gmail.com">paez@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Manuel Ruiz  </td><td style="text-align: left;"> <a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>See Also</h3>

<p><code><a href="#topic+sp.runs.test">sp.runs.test</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Example 1: Fastfood example. sf (points)
data("FastFood.sf")
x &lt;- sf::st_coordinates(sf::st_centroid(FastFood.sf))
listw &lt;- spdep::knearneigh(x, k = 2)
formula &lt;- ~ Type
srq &lt;- sp.runs.test(formula = formula, data = FastFood.sf, listw = listw, nsim = 299)
plot(srq)

# Example 2: Spain example (poligons with 0 neinghbourhood)
data("provinces_spain")
sf::sf_use_s2(FALSE)
listw &lt;- spdep::poly2nb(as(provinces_spain,"Spatial"), queen = FALSE)
provinces_spain$Older &lt;- cut(provinces_spain$Older, breaks = c(-Inf,19,22.5,Inf))
levels(provinces_spain$Older) = c("low","middle","high")
formula &lt;- ~ Older
srq &lt;- sp.runs.test(formula = formula, data = provinces_spain, listw = listw, nsim = 299)
plot(srq)
provinces_spain$Mal2Fml &lt;- factor(provinces_spain$Mal2Fml &gt; 100)
levels(provinces_spain$Mal2Fml) = c("men","woman")
formula &lt;- ~ Mal2Fml
srq &lt;- sp.runs.test(formula = formula, data = provinces_spain, listw = listw, nsim = 299)
plot(srq)
</code></pre>

<hr>
<h2 id='print.summary.spjctest'>Print method for objects of class summary.spjctest.</h2><span id='topic+print.summary.spjctest'></span>

<h3>Description</h3>

<p>Print method for objects of class summary.spjctest.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'summary.spjctest'
print(x, digits = max(3L, getOption("digits") - 3L), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.summary.spjctest_+3A_x">x</code></td>
<td>
<p>object of class <em>summary.spjctest</em>.</p>
</td></tr>
<tr><td><code id="print.summary.spjctest_+3A_digits">digits</code></td>
<td>
<p>number of digits to show in printed tables.
Default: max(3L, getOption(&quot;digits&quot;) - 3L).</p>
</td></tr>
<tr><td><code id="print.summary.spjctest_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
Fernando López  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Román Mínguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Antonio Páez </td><td style="text-align: left;"> <a href="mailto:paezha@gmail.com">paezha@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Manuel Ruiz </td><td style="text-align: left;"> <a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>See Also</h3>

<p><code><a href="#topic+summary.spqtest">summary.spqtest</a></code>.
</p>

<hr>
<h2 id='print.summary.spqtest'>Print method for objects of class summary.spqtest.</h2><span id='topic+print.summary.spqtest'></span>

<h3>Description</h3>

<p>Print method for objects of class summary.spqtest.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'summary.spqtest'
print(x, digits = max(3L, getOption("digits") - 3L), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.summary.spqtest_+3A_x">x</code></td>
<td>
<p>object of class <em>summary.spqtest</em>.</p>
</td></tr>
<tr><td><code id="print.summary.spqtest_+3A_digits">digits</code></td>
<td>
<p>number of digits to show in printed tables.
Default: max(3L, getOption(&quot;digits&quot;) - 3L).</p>
</td></tr>
<tr><td><code id="print.summary.spqtest_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
Fernando López  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Román Mínguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Antonio Páez </td><td style="text-align: left;"> <a href="mailto:paezha@gmail.com">paezha@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Manuel Ruiz </td><td style="text-align: left;"> <a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>See Also</h3>

<p><code><a href="#topic+summary.spqtest">summary.spqtest</a></code>.
</p>

<hr>
<h2 id='provinces_spain'>Provinces in Spain.</h2><span id='topic+provinces_spain'></span>

<h3>Description</h3>

<p>A simple features object with the provinces in Spain and selected demographic and economic information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(provinces_spain)
</code></pre>


<h3>Format</h3>

<p>A simple features dataframe with 50 rows and 15 columns:
</p>

<dl>
<dt>province</dt><dd><p>Names of provinces in Spain as factor</p>
</dd>
<dt>CCAA</dt><dd><p>Names of Autonomous Communities in Spain as factor</p>
</dd>
<dt>ID_INE</dt><dd><p>National Institute of Statistics unique identifier of the provinces</p>
</dd>
<dt>Population</dt><dd><p>Population in the province in 2020</p>
</dd>
<dt>Density</dt><dd><p>Population density in the province in persons/km^2</p>
</dd>
<dt>Older</dt><dd><p>Percentage of population 65 and older in the provice in 2020</p>
</dd>
<dt>Median_Age</dt><dd><p>Median age of population in the province in 2020</p>
</dd>
<dt>Mal2Fml</dt><dd><p>Ratio of male to female population in the province in 2020</p>
</dd>
<dt>GDPpc</dt><dd><p>GDP per capita in the province in 2016</p>
</dd>
<dt>Transit</dt><dd><p>Dummy variable for mass transit system in province; 1: YES</p>
</dd>
<dt>Area</dt><dd><p>Area of the province</p>
</dd>
<dt>Altitude</dt><dd><p>Altitude of the province</p>
</dd>
<dt>Coast</dt><dd><p>A dummy variable that indicates whether the province is in the coast; 1: YES</p>
</dd>
<dt>Meteo_Station</dt><dd><p>Identifier of meteorological station representative of the province used to retrieve climatic variables</p>
</dd>
<dt>geometry</dt><dd><p>geometry of the simple features object</p>
</dd>
</dl>



<h3>Source</h3>

<p>Instituto Nacional de Estadistica http://www.ine.es/
</p>
<p>Climatic data: Agencia Estatal de Meteorologia http://www.aemet.es/
</p>
<p>Páez et al. (2020)
</p>


<h3>References</h3>


<ul>
<li><p> Paez, A., Lopez, F.A., Menezes, T., Cavalcanti, R., &amp; Pitta, M. (2020). A Spatio‐Temporal Analysis of
the Environmental Correlates of COVID‐19 Incidence in Spain. <em>Geographical Analysis</em>. 53(3) 397-421
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'> data(provinces_spain)
 summary(provinces_spain)
</code></pre>

<hr>
<h2 id='Q.map.test'>Compute the QE and QI tests of Equivalence and Independence between maps</h2><span id='topic+Q.map.test'></span>

<h3>Description</h3>

<p>This function compute the QE and QI tests for maps comparison based on symbolic entropy.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Q.map.test(formula = formula, data = data, coor = NULL, m = m, r = 1,
type = "combinations", control = list())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Q.map.test_+3A_formula">formula</code></td>
<td>
<p>a symbolic description of the two factors.</p>
</td></tr>
<tr><td><code id="Q.map.test_+3A_data">data</code></td>
<td>
<p>(optional) a data frame or a sf object containing the variables to testing for.</p>
</td></tr>
<tr><td><code id="Q.map.test_+3A_coor">coor</code></td>
<td>
<p>(optional) a 2xN vector with coordinates.</p>
</td></tr>
<tr><td><code id="Q.map.test_+3A_m">m</code></td>
<td>
<p>length of m-surrounding.</p>
</td></tr>
<tr><td><code id="Q.map.test_+3A_r">r</code></td>
<td>
<p>maximum overlapping between any two m-surroundings (default = 1).</p>
</td></tr>
<tr><td><code id="Q.map.test_+3A_type">type</code></td>
<td>
<p>Type of symbols: &quot;permutations&quot; or &quot;combinations&quot;. Default &quot;combinations&quot;</p>
</td></tr>
<tr><td><code id="Q.map.test_+3A_control">control</code></td>
<td>
<p>Optional argument. See Control Argument section.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>data</code> is not a sf object the <code>coor</code> argument with the coordinates
of each observation must be included. <br />
</p>


<h3>Value</h3>

<p>A list with two objects of the class <code>htest</code>. The first one
is the QE test of Equivalence between maps and the second one is the QI test
of independence between maps. the elements of each test are: <br />
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>method</code> </td><td style="text-align: left;"> a character string giving description of the method. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>data.name</code> </td><td style="text-align: left;"> a character string giving the name(s) of the data. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>statistic</code> </td><td style="text-align: left;"> the value of the statistic QE or/and QI. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>alternative</code> </td><td style="text-align: left;"> a character string describing the alternative hypothesis. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>p.value</code> </td><td style="text-align: left;">  p-value for QE or QI. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>parameter</code> </td><td style="text-align: left;"> free degree of the statistic for QE or QI. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>symb</code> </td><td style="text-align: left;"> A matrix with the symbols. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>mh</code> </td><td style="text-align: left;"> m-surrounding of th map. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>Tm</code> </td><td style="text-align: left;"> number of maps (ONLY 2). </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>sample.size</code> </td><td style="text-align: left;">  number of symbolized observations. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>nsk</code> </td><td style="text-align: left;"> a matrix Tm x symbols with the frequency of the number of symbols of each map. </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Control arguments</h3>

<p>Several parameters to construct the m-surrounding
</p>

<dl>
<dt>dtmaxabs</dt><dd><p>Delete degenerate surrounding based on the absolute distance between observations.</p>
</dd>
<dt>dtmaxpc</dt><dd><p>A value between 0 and 1. Delete degenerate surrounding based on the distance.
Delete m-surrounding when the maximum distance between observation
is upper than k percentage of maximum distance between anywhere observation.</p>
</dd>
<dt>dtmaxknn</dt><dd><p>A integer value 'k'. Delete degenerate surrounding based on the near neighborhood criteria. Delete m-surrounding
is a element of the m-surrounding is not include in the set of k near neighborhood of the first element</p>
</dd>
<dt>seedinit</dt><dd><p>seed to select the initial element to star
the algorithm to compute the m-surroundings.</p>
</dd>
</dl>



<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
Fernando López  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Román Mínguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Antonio Páez </td><td style="text-align: left;"> <a href="mailto:paezha@gmail.com">paezha@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Manuel Ruiz </td><td style="text-align: left;"> <a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Ruiz M, López FA and A Páez (2011).
Comparison of Thematic Maps Using Symbolic Entropy.
<em>International Journal of Geographical Information Science</em>, 26, 413-439.
</p>
</li>
<li><p> Ruiz, M., López, FA, and Páez, A. (2010).
Testing for spatial association of qualitative data using symbolic dynamics.
<em>Journal of Geographical Systems</em>, 12(3), 281-309.0.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+dgp.spq">dgp.spq</a></code>, <code><a href="#topic+m.surround">m.surround</a></code>, <code><a href="#topic+Q.test">Q.test</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Case 1:
N &lt;- 200
cx &lt;- runif(N)
cy &lt;- runif(N)
x &lt;- cbind(cx,cy)
listw &lt;- spdep::nb2listw(spdep::knn2nb(
           spdep::knearneigh(cbind(cx,cy), k = 4)))
p &lt;- c(1/6, 3/6, 2/6)
rho = 0.5
QY1 &lt;- dgp.spq(p = p, listw = listw, rho = rho)
rho = 0.8
QY2 &lt;- dgp.spq(p = p, listw = listw, rho = rho)
dt = data.frame(QY1,QY2)
m = 3
r = 1
formula &lt;- ~ QY1 + QY2
control &lt;- list(dtmaxknn = 10)
qmap &lt;- Q.map.test(formula = formula, data = dt, coor = x, m = m, r = r,
                   type ="combinations", control = control)
print(qmap)
plot(qmap)
plot(qmap, ci=.6)
plot(qmap[[1]]$mh)
summary(qmap[[1]]$mh)

control &lt;- list(dtmaxknn = 20)
qmap &lt;- Q.map.test(formula = formula, data = dt, coor = x, m = m, r = r,
                   type ="permutations", control = control)
print(qmap)
plot(qmap)
plot(qmap[[1]]$mh)
qmap &lt;- Q.map.test(formula = formula, data = dt, coor = x, m = m, r = r,
                   type ="combinations")
print(qmap)
plot(qmap)
control &lt;- list(dtmaxknn = 10)
qmap &lt;- Q.map.test(formula = formula, data = dt, coor = x, m = m, r = r,
                   type ="combinations", control = control)
print(qmap)
plot(qmap)

# Case 2:
data(provinces_spain)
# sf::sf_use_s2(FALSE)
m = 3
r = 1

provinces_spain$Mal2Fml &lt;- factor(provinces_spain$Mal2Fml &gt; 100)
levels(provinces_spain$Mal2Fml) = c("men","woman")
provinces_spain$Coast &lt;- factor(provinces_spain$Coast)
levels(provinces_spain$Coast) = c("no","yes")
formula &lt;- ~ Coast + Mal2Fml
qmap &lt;- Q.map.test(formula = formula, data = provinces_spain, m = m, r = r,
                   type ="combinations")
print(qmap)
plot(qmap)
plot(qmap[[1]]$mh)

control &lt;- list(dtmaxknn = 6)
qmap &lt;- Q.map.test(formula = formula, data = provinces_spain, m = m, r = r,
                   type ="combinations", control = control)
print(qmap)
plot(qmap[[1]]$mh)
summary(qmap[[1]]$mh)

</code></pre>

<hr>
<h2 id='Q.test'>A function to compute Q test for spatial qualitative data</h2><span id='topic+Q.test'></span>

<h3>Description</h3>

<p>A function to compute Q test for spatial qualitative data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Q.test(formula = NULL, data = NULL, na.action,
fx = NULL, coor = NULL, m = 3, r = 1, distr = "asymptotic",
control = list())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Q.test_+3A_formula">formula</code></td>
<td>
<p>a symbolic description of the factor(s).</p>
</td></tr>
<tr><td><code id="Q.test_+3A_data">data</code></td>
<td>
<p>an (optional) data frame or a sf object
with points/multipolygons geometry containing the
variable(s) to be tested.</p>
</td></tr>
<tr><td><code id="Q.test_+3A_na.action">na.action</code></td>
<td>
<p>action with NA values</p>
</td></tr>
<tr><td><code id="Q.test_+3A_fx">fx</code></td>
<td>
<p>a factor  or a matrix of factors in columns</p>
</td></tr>
<tr><td><code id="Q.test_+3A_coor">coor</code></td>
<td>
<p>(optional) a 2xN vector with spatial coordinates.
Used when <em>data</em> is not a spatial object</p>
</td></tr>
<tr><td><code id="Q.test_+3A_m">m</code></td>
<td>
<p>length of m-surrounding (default = 3).</p>
</td></tr>
<tr><td><code id="Q.test_+3A_r">r</code></td>
<td>
<p>only for asimtotic distribution. Maximum overlapping between any two m-surroundings (default = 1).</p>
</td></tr>
<tr><td><code id="Q.test_+3A_distr">distr</code></td>
<td>
<p>character. Distribution type &quot;asymptotic&quot; (default) or &quot;mc&quot;.</p>
</td></tr>
<tr><td><code id="Q.test_+3A_control">control</code></td>
<td>
<p>Optional argument. See Control Argument section.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The Q-test is a simple, consistent, and powerful statistic for qualitative spatial
independence that we develop using concepts from symbolic dynamics and symbolic
entropy. The Q test can be used to detect, given a spatial distribution of events,
patterns of spatial association of qualitative variables in a wide variety of
settings. <br />
The Q(m) statistic was introduced by Ruiz et al. (2010) as a tool to explore geographical
co-location/co-occurrence of qualitative data. Consider a spatial variable X which is the
result of a qualitative process with a set number of categorical outcomes <code class="reqn">a_j</code> (j=1,...,k).
The spatial variable is observed at a set of fixed locations indexed by their coordinates
<code class="reqn">s_i</code> (i=1,..., N), so that at each location si where an event is observed,
<code class="reqn">X_i</code> takes one of the possible values <code class="reqn">a_j</code>.<br />
</p>
<p>Since the observations are georeferenced, a spatial embedding protocol can be devised
to assess the spatial property of co-location. Let us define, for an observation at
a specified location, say <code class="reqn">s_0</code>, a surrounding of size m, called an m-surrounding.<br />
The m-surrounding is the set of m-1 nearest neighbours from the perspective
of location <code class="reqn">s_0</code>. In the case of distance ties, a secondary criterion can be
invoked based on direction.<br />
Once that an embedding protocol is adopted and the elements of the m-surrounding
for location <code class="reqn">s_0</code> have been determined, a string can be obtained that collects
the elements of the local neighborhood (the m-1 nearest neighbors) of the observation
at <code class="reqn">s_0</code>. The m-surrounding can then be represented in the following way:
</p>
<p style="text-align: center;"><code class="reqn">X_m(s_0)=(X_{s_0},X_{s_1},...X_{s_{m-1}})</code>
</p>

<p>Since each observation Xs takes one of k possible values, and there are m observations in
the m-surrounding, there are exactly k possible unique ways in which those values can
co-locate. This is the number of permutations with replacement.<br />
For instance, if k=2
(e.g. the possible outcomes are a1=0 and a2=1) and m=3, the following eight unique
patterns of co-location are possible (the number of symbols is <code class="reqn">n_{\sigma}</code>=8): (0,0,0), (1,0,0),
(0,1,0), (0,0,1), (1,1,0), (1,0,1), (0,1,1), and (1,1,1). Each unique co-locationtype
can be denoted in a convenient way by means of a symbol <code class="reqn">\sigma_i</code> <code class="reqn">(i=1, 2,...,k^m)</code>. It follows
that each site can be uniquely associated with a specific symbol, in a process termed
symbolization. In this way, we say that a location s is of type <code class="reqn">\sigma_i</code> if and only if <code class="reqn">X_m(s)=\sigma_i</code>.<br />
Equivalent symbols (see Páez, et al. 2012) can be obtained by counting the number of
occurrences of each category within an m-surrounding. This surrenders some
topological information (ordering within the m-surrounding is lost) in favor of a more
compact set of symbols, since the number of combinations with replacement.<br />
<br />
<strong>Definition of Q(m) statistic</strong><br />
<br />
Let <code class="reqn">\{X_s\}_{s \in R}</code> be a discrete spatial process and m be a fixed embedding
dimension. The statistic Q testing the null hypothesis:<br />
<br />
<code class="reqn">H_0:\{X_s\}_{s \in R}</code> is spatially independent, against any other alternative.<br />
<br />
For a fixed <code class="reqn">m \geq 2</code>, the relative frequency of symbols can be used to define the symbolic
entropy of the spatial process as the Shanon entropy of the distinct symbols:<br />
</p>
<p style="text-align: center;"><code class="reqn">h(m) = - \sum_j p_{\sigma_j}ln(p_{\sigma_j})</code>
</p>

<p>where
</p>
<p style="text-align: center;"><code class="reqn">p_{\sigma_j}={ n_{\sigma_j} \over R}</code>
</p>

<p>with <code class="reqn">n_{\sigma_j}</code> is simply the
number of times that the symbol <code class="reqn">\sigma_j</code> is observed and R the number of
symbolized locations.
The entropy function is bounded between <code class="reqn">0 &lt; h (m) \leq \eta</code>.<br />
</p>
<p>The Q statistic is essentially a likelihood ratio test between the symbolic entropy
of the observed pattern and the entropy of the system under the null hypothesis
of a random spatial sequence:
</p>
<p style="text-align: center;"><code class="reqn">Q(m)=2R(\eta-h(m))</code>
</p>

<p>with <code class="reqn">\eta = ln(k^m)</code>. The statistic is asymptotically <code class="reqn">\chi^2</code> distributed
with degrees of freedom equal to the number of symbols minus one.<br />
</p>


<h3>Value</h3>

<p>An list of two object of the class <code>htest</code>. Each element of the list return the:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>data.name</code> </td><td style="text-align: left;"> a character string giving the names of the data.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>statistic</code> </td><td style="text-align: left;"> Value of the Q test </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>N</code> </td><td style="text-align: left;"> total number of observations.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>R</code> </td><td style="text-align: left;"> total number of symbolized observations.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>m</code> </td><td style="text-align: left;"> length m-surrounding.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>r</code> </td><td style="text-align: left;"> degree of overlapping.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>df</code> </td><td style="text-align: left;"> degree of freedom.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>distr</code> </td><td style="text-align: left;"> type of distribution used to get the significance of the Q test.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>type</code> </td><td style="text-align: left;"> type of symbols.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Control arguments</h3>


<dl>
<dt>distance</dt><dd><p>character to select the type of distance.
Default = &quot;Euclidean&quot; for Cartesian coordinates only: one of Euclidean,
Hausdorff or Frechet; for geodetic coordinates,
great circle distances are computed (see sf::st_distance())</p>
</dd>
<dt>dtmaxabs</dt><dd><p>Delete degenerate surrounding based on the absolute distance between observations.</p>
</dd>
<dt>dtmaxpc</dt><dd><p>A value between 0 and 1. Delete degenerate surrounding based on the distance. Delete m-surrounding when the maximum distance between observation
is upper than k percentage of maximum distance between anywhere observation.</p>
</dd>
<dt>dtmaxknn</dt><dd><p>A integer value 'k'. Delete degenerate surrounding based on the near neighbourhood criteria. Delete m-surrounding
is a element of the m-surrounding is not include in the set of k near neighbourhood of the first element</p>
</dd>
<dt>nsim</dt><dd><p>number of simulations for get the Monte Carlo distribution.
Default = 999</p>
</dd>
<dt>seedinit</dt><dd><p>seed to select the initial element to star
the algorithm to get compute the m-surroundings or to start the simulation</p>
</dd>
</dl>



<h3>Standard-Permutation vs Equivalent-Combination Symbols</h3>

<p>The symbolization protocol proposed by Ruiz et al. (2010) - call these
Standard-Permutation Symbols — contains a large amount of topological information
regarding the units of analysis, including proximity and direction.
In this sense, the protocol is fairly general. On the other hand, it is easy to see
that the combinatorial possibilities can very quickly become unmanageable.
For a process with k = 3 outcomes and m = 5, the number of symbols becomes
<code class="reqn">3^5 = 243</code>; for k = 6 and m = 4 it is  <code class="reqn">6^4 = 1,296</code>. Depending on the number
of observations N, the explosion in the number of symbols can very rapidly consume
degrees of freedom for hypothesis testing, because as a rule of thumb
it is recommended that the number of symbolized locations be at least five times
the number of symbols used (e.g., <code class="reqn">R \geq 5k^m</code>), and R will usually be a fraction of N.<br />
</p>
<p>As an alternative, we propose a symbolization protocol that sacrifices
some amount of topological detail for conciseness. The alternative is based
on the standard scheme; however, instead of retaining proximity and
direction relationships, it maintains only the total number of occurrences
of each outcome in an m-surrounding. We call these Equivalent-Combination Symbols.
Because order in the sequence is not considered in this protocol, instead of a
permutation with repetition, the number of symbols reflects a combination with
repetition. <br />
</p>


<h3>Selection of m-surrounding with Controlled Degree of Overlapping (r)</h3>

<p>To select S locations for the analysis, coordinates are selected such that
for any two coordinates <code class="reqn">s_i</code> , <code class="reqn">s_j</code> the number of overlapping nearest
neighbours of <code class="reqn">s_i</code> and <code class="reqn">s_j</code> are at most r. The set S, which is a subset of all the
observations N, is defined recursively as follows. First choose a location <code class="reqn">s_0</code> at random and fix an integer r
with <code class="reqn">0 \leq r &lt; m</code>. The integer r is the degree of overlap, the maximum number of observations that contiguous
m-surroundings are allowed to have in common.<br />
Let <code class="reqn"> \{s_1^0, s_2^0,...,s_{m-1}^0 \}</code> be the set of nearest neighbours
to <code class="reqn">s_0</code>, where the <code class="reqn">s_i^0</code> are ordered by distance to <code class="reqn">s_0</code>, or angle in the case of ties.
Let us call <code class="reqn">s_1 = s_{m-r-1}^0</code> and define <code class="reqn"> A_0 = \{s_0,s_0^1,...,s^0_{m-r-2} \}  </code> . Take the set of
nearest neighbours to <code class="reqn">s_1</code>, namely, <code class="reqn"> \{ s_1^1, s_2^1,...,s^1_{m-1} \} </code> in the
set of locations <code class="reqn">S \setminus A_0 </code> and define <code class="reqn">s_2=s^1_{m-r-1} </code>. Nor for i&gt;1 we define
<code class="reqn">s_i = s^{i-1}_{m-r-1}</code> where <code class="reqn">s^{i-1}_{m-r-1}</code> is in the ser of nearest neighbors to <code class="reqn">s_{i-1}</code>,
<code class="reqn"> \{ s_1^{i-1},s_2^{i-1},...,s_{m-1}^{i-1} \} </code> ,of the set <code class="reqn">S \setminus \{ \cup_{j=0}^{i-1} A_j \} </code>.
Continue this process while there are locations to symbolize.<br />
</p>


<h3>Selection of m-surroundings for bootstrap distribution</h3>

<p>The bootstrapped-based testing can provide an advantage since overlapping between
m-surroundings is not a consideration, and the full sample can be used.<br />
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
Fernando López  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Román Mínguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Antonio Páez </td><td style="text-align: left;"> <a href="mailto:paezha@gmail.com">paezha@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Manuel Ruiz </td><td style="text-align: left;"> <a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Ruiz M, López FA, A Páez. (2010). Testing for spatial association of qualitative
data using symbolic dynamics. <em>Journal of Geographical Systems</em>. 12 (3) 281-309
</p>
</li>
<li><p> López, FA, and A Páez. (2012). Distribution-free inference for Q(m) based on permutational bootstrapping: an application
to the spatial co-location pattern of firms in Madrid <em>Estadística Española</em>, 177, 135-156.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
# Case 1: With coordinates
N &lt;- 200
cx &lt;- runif(N)
cy &lt;- runif(N)
coor &lt;- cbind(cx,cy)
p &lt;- c(1/6,3/6,2/6)
rho = 0.3
listw &lt;- spdep::nb2listw(spdep::knn2nb(spdep::knearneigh(cbind(cx,cy), k = 4)))
fx &lt;- dgp.spq(list = listw, p = p, rho = rho)
q.test &lt;- Q.test(fx = fx, coor = coor, m = 3, r = 1)
summary(q.test)
plot(q.test)
print(q.test)

q.test.mc &lt;- Q.test(fx = fx, coor = coor, m = 3, distr = "mc", control = list(nsim = 999))
summary(q.test.mc)
plot(q.test.mc)
print(q.test.mc)


# Case 2: With a sf object
data("FastFood.sf")
f1 &lt;- ~ Type
q.test &lt;- Q.test(formula = f1, data = FastFood.sf, m = c(3, 4),
r = c(1, 2, 3), control = list(distance ="Euclidean"))
summary(q.test)
plot(q.test)
print(q.test)

# Case 3: With a sf object with isolated areas
data("provinces_spain")
sf::sf_use_s2(FALSE)
provinces_spain$Mal2Fml&lt;- factor(provinces_spain$Mal2Fml &gt; 100)
levels(provinces_spain$Mal2Fml) = c("men","woman")
provinces_spain$Older &lt;- cut(provinces_spain$Older, breaks = c(-Inf,19,22.5,Inf))
levels(provinces_spain$Older) = c("low","middle","high")
f1 &lt;- ~ Older + Mal2Fml
q.test &lt;- Q.test(formula = f1,
data = provinces_spain, m = 3, r = 1, control = list(seedinit = 1111))
summary(q.test)
print(q.test)
plot(q.test)
q.test.mc &lt;- Q.test(formula = f1, data = provinces_spain, m = 4, r = 3, distr = "mc",
control = list(seedinit = 1111))
summary(q.test.mc)
print(q.test.mc)
plot(q.test.mc)

# Case 4: Examples with multipolygons
library(sf)
fname &lt;- system.file("shape/nc.shp", package="sf")
nc &lt;- sf::st_read(fname)
qb79 &lt;- quantile(nc$BIR79)
nc$QBIR79 &lt;- (nc$BIR79 &gt; qb79[2]) + (nc$BIR79 &gt; qb79[3]) +
(nc$BIR79 &gt;= qb79[4]) + 1
nc$QBIR79 &lt;- as.factor(nc$QBIR79)
plot(nc["QBIR79"], pal = c("#FFFEDE","#FFDFA2", "#FFA93F", "#D5610D"),
     main = "BIR79 (Quartiles)")
sid79 &lt;- quantile(nc$SID79)
nc$QSID79 &lt;- (nc$SID79 &gt; sid79[2]) + (nc$SID79 &gt; sid79[3]) +
(nc$SID79 &gt;= sid79[4]) + 1
nc$QSID79 &lt;- as.factor(nc$QSID79)
plot(nc["QSID79"], pal = c("#FFFEDE","#FFDFA2", "#FFA93F", "#D5610D"),
     main = "SID79 (Quartiles)")
f1 &lt;- ~ QSID79 + QBIR79
lq1nc &lt;- Q.test(formula = f1, data = nc, m = 5, r = 2,
control = list(seedinit = 1111, dtmaxpc = 0.5, distance = "Euclidean") )
print(lq1nc)

lq2nc &lt;- Q.test(formula = f1, data = nc, m = 5, r = 2,
control = list(dtmaxpc = 0.2) )
print(lq2nc)

lq3nc &lt;- Q.test(formula = f1, data = nc, m = 5, r = 2,
control = list(dtmaxknn = 5) )
print(lq3nc)

# Case 5: Examples with points and matrix of variables
fx &lt;- matrix(c(nc$QBIR79, nc$QSID79), ncol = 2, byrow = TRUE)
mctr &lt;- suppressWarnings(sf::st_centroid(st_geometry(nc)))
mcoor &lt;- st_coordinates(mctr)[,c("X","Y")]
q.test &lt;- Q.test(fx = fx, coor = mcoor, m = 5, r = 2,
                 control = list(seedinit = 1111, dtmaxpc = 0.5))
print(q.test)
plot(q.test)


</code></pre>

<hr>
<h2 id='scan.test'>Compute the scan test</h2><span id='topic+scan.test'></span>

<h3>Description</h3>

<p>This function compute the spatial scan test for Bernoulli and
Multinomial categorical spatial process, and detect spatial clusters
</p>


<h3>Usage</h3>

<pre><code class='language-R'>scan.test(formula = NULL, data = NULL, fx = NULL, coor = NULL, case = NULL,
nv = NULL, nsim = NULL, distr = NULL, windows = "circular", listw = NULL,
alternative = "High", minsize = 1, control = list())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="scan.test_+3A_formula">formula</code></td>
<td>
<p>a symbolic description of the factor (optional).</p>
</td></tr>
<tr><td><code id="scan.test_+3A_data">data</code></td>
<td>
<p>an (optional) data frame or a sf object containing the variable to testing for.</p>
</td></tr>
<tr><td><code id="scan.test_+3A_fx">fx</code></td>
<td>
<p>a factor (optional).</p>
</td></tr>
<tr><td><code id="scan.test_+3A_coor">coor</code></td>
<td>
<p>(optional) coordinates of observations.</p>
</td></tr>
<tr><td><code id="scan.test_+3A_case">case</code></td>
<td>
<p>Only for Bernoulli distribution. A element of factor, there are cases and non-cases for testing for cases versus non-cases</p>
</td></tr>
<tr><td><code id="scan.test_+3A_nv">nv</code></td>
<td>
<p>Maximum windows size, default nv = N/2. The algorithm scan for clusters of geographic size between 1
and the upper limit (nv) defined by the user.</p>
</td></tr>
<tr><td><code id="scan.test_+3A_nsim">nsim</code></td>
<td>
<p>Number of permutations.</p>
</td></tr>
<tr><td><code id="scan.test_+3A_distr">distr</code></td>
<td>
<p>distribution of the spatial process: &quot;bernoulli&quot; for two levels or &quot;multinomial&quot; for three or more levels.</p>
</td></tr>
<tr><td><code id="scan.test_+3A_windows">windows</code></td>
<td>
<p>a string to select the type of cluster &quot;circular&quot; (default) of &quot;elliptic&quot;.</p>
</td></tr>
<tr><td><code id="scan.test_+3A_listw">listw</code></td>
<td>
<p>only for flexible windows. A neighbours list (an object of the class listw, nb or knn frop spdep) or an adjacency matrix.</p>
</td></tr>
<tr><td><code id="scan.test_+3A_alternative">alternative</code></td>
<td>
<p>Only for Bernoulli spatial process. A character string specifying the type of cluster, must be one
of &quot;High&quot; (default), &quot;Both&quot; or &quot;Low&quot;.</p>
</td></tr>
<tr><td><code id="scan.test_+3A_minsize">minsize</code></td>
<td>
<p>Minimum number of observations inside of Most Likely Cluster and secondary clusters.</p>
</td></tr>
<tr><td><code id="scan.test_+3A_control">control</code></td>
<td>
<p>List of additional control arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Two alternative sets of arguments can be included in this function to compute the scan test:
</p>

<ul>
<li> <p><code>Option 1</code>: A factor (fx) and coordinates (coor).
</p>
</li>
<li> <p><code>Option 2</code>: A sf object (data) and the formula to specify the factor.
The function consider the coordinates of the centroids of the elements of th sf object.
</p>
</li></ul>

<p>The spatial scan statistics are widely used in epidemiology, criminology or ecology.
Their purpose is to analyse the spatial distribution of points or geographical
regions by testing the hypothesis of spatial randomness distribution on the
basis of different distributions (e.g. Bernoulli, Poisson or Normal distributions).
The <code>scan.test</code> function obtain the scan statistic for two relevant distributions related
with categorical variables: the Bernoulli and Multinomial distribution.<br />
The spatial scan statistic is based on the likelihood ratio test statistic and
is formulated as follows:<br />
</p>
<p style="text-align: center;"><code class="reqn">\Delta = { \max_{z \in Z,H_A} L(\theta|z) \over \max_{z \in Z,H_0} L(\theta|z)}</code>
</p>

<p>where Z represents the collection of scanning windows constructed on the study region,
<code class="reqn">H_A</code> is an alternative hypothesis, <code class="reqn">H_0</code> is a null hypothesis, and <code class="reqn">L(\theta|z)</code>
is the likelihood function with parameter <code class="reqn">\theta</code> given window Z<br />.
The null hypothesis says that there is no spatial clustering on the study region, and
the alternative hypothesis is that there is a certain area with high (or low) rates of
outcome variables. The null and alternative hypotheses and the likelihood function may
be expressed in different ways depending on the probability model under consideration.<br />
To test independence in a spatial process, under the null, the type of windows is
irrelevant but under the alternative the elliptic
windows can to identify with more precision the cluster.
</p>
<p>For big data sets (N &gt;&gt;) the windows = &quot;elliptic&quot; can be so slowly
</p>
<p><strong>Bernoulli version</strong><br />
<br />
When we have dichotomous outcome variables, such as cases and noncases of certain
diseases, the Bernoulli model is used. The null hypothesis is written as
</p>
<p style="text-align: center;"><code class="reqn">H_0 : p = q  \ \ for \ \  all  \ \ Z</code>
</p>

<p>and the alternative hypothesis is <br />
</p>
<p style="text-align: center;"><code class="reqn">H_A : p \neq q  \ \ for  \ \ some  \ \ Z</code>
</p>

<p>where p and q are the outcome probabilities (e.g., the probability of being a case)
inside and outside scanning window Z, respectively. Given window Z, the test statistic is:<br />
</p>
<p>where cz and nz are the numbers of cases and observations (cases and noncases) within z,
respectively, and C and N are the total numbers of cases and observations in the whole
study region, respectively.<br />
</p>
<p style="text-align: center;"><code class="reqn">\Delta = </code>
</p>

<p><strong>Multinomial version of the scan test</strong><br />
<br />
The multinomial version of the spatial scan statistic is useful to investigate clustering
when a discrete spatial variable can take one and only one of k possible outcomes
that lack intrinsic order information. If the region defined by the moving window
is denoted by Z, the null hypothesis for the statistic can be stated as follows:<br />
</p>
<p style="text-align: center;"><code class="reqn">H_0: p_1 = q_1;p_2 = q_2;...;p_k = q_k</code>
</p>

<p>where <code class="reqn">p_j</code> is the probability of being of event type j inside the window Z,
and <code class="reqn">q_j</code> is the probability of being of event type j outside the window.
The alternative hypothesis is that for at least one type event the probability
of being of that type is different inside and outside of the window.<br />
</p>
<p>The statistic is built as a likelihood ratio, and takes the following
form after transformation using the natural logarithm:
</p>
<p style="text-align: center;"><code class="reqn">\Delta = \max_Z \{\sum_j \{ S_j^Z log({ S_j^Z \over S^Z }) +
(S_j-S_j^Z) log({ {S_j-S_j^Z} \over {S-S^Z} })\}\}-\sum_j S_j log({ S_j \over S }) </code>
</p>

<p>where S is the total number of events in the study area and <code class="reqn">S_j</code> is the total number
of events of type j. The superscript Z denotes the same but for the sub-region
defined by the moving window. <br />
The theoretical distribution of the statistic under the null hypothesis is not known,
and therefore significance is evaluated numerically by simulating neutral landscapes
(obtained using a random spatial process) and contrasting the empirically calculated
statistic against the frequency of values obtained from the neutral landscapes.
The results of the likelihood ratio serve to identify the most likely cluster,
which is followed by secondary clusters by the expedient of sorting them according to
the magnitude of the test. As usual, significance is assigned by the analyst, and the
cutoff value for significance reflects the confidence of the analyst, or tolerance for error.<br />
When implementing the statistic, the analyst must decide the shape of the
window and the maximum number of cases that any given window can cover.
Currently, analysis can be done using circular or elliptical windows.<br />
Elliptical windows are more time consuming to evaluate but provide greater
flexibility to contrast the distribution of events inside and outside the window,
and are our selected shape in the analyses to follow. Furthermore, it is recommended
that the maximum number of cases entering any given window does not exceed 50\
all available cases.
</p>


<h3>Value</h3>

<p>A object of the <em>htest</em> and <em>scantest</em> class
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>method</code> </td><td style="text-align: left;"> The type of test applied ().</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>fx</code> </td><td style="text-align: left;"> Factor included as input to get the scan test.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>MLC</code> </td><td style="text-align: left;"> Observations included into the Most Likelihood Cluster (MLC).</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>statistic</code> </td><td style="text-align: left;"> Value of the scan test (maximum Log-likelihood ratio). </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>N</code> </td><td style="text-align: left;"> Total number of observations.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>nn</code> </td><td style="text-align: left;"> Windows used to get the cluster.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>nv</code> </td><td style="text-align: left;"> Maximum number of observations into the cluster.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>data.name</code> </td><td style="text-align: left;"> A character string giving the name of the factor.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>coor</code> </td><td style="text-align: left;"> coordinates.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>alternative</code> </td><td style="text-align: left;"> Only for bernoulli spatial process. A character string describing
the alternative hypothesis select by the user.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>p.value</code> </td><td style="text-align: left;"> p-value of the scan test.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>cases.expect</code> </td><td style="text-align: left;"> Expected cases into the MLC.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>cases.observ</code> </td><td style="text-align: left;"> Observed cases into the MLC.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>nsim</code> </td><td style="text-align: left;"> Number of permutations.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>scan.mc</code> </td><td style="text-align: left;"> a (nsim x 1) vector with the loglik values under bootstrap permutation.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>secondary.clusters</code> </td><td style="text-align: left;"> a list with the observations included into the secondary clusters.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>loglik.second</code> </td><td style="text-align: left;"> a vector with the value of the secondary scan tests (maximum Log-likelihood ratio).</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>p.value.secondary</code> </td><td style="text-align: left;"> a vector with the p-value of the secondary scan tests.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>Alternative.MLC</code> </td><td style="text-align: left;"> A vector with the observations included in another cluster with the same loglik than MLC.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Control arguments</h3>


<table>
<tr>
 <td style="text-align: left;">
<code>seedinit</code> </td><td style="text-align: left;"> Numerical value for the seed (only for boot version). Default value seedinit=123 </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
Fernando López  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Román Mínguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Antonio Páez </td><td style="text-align: left;"> <a href="mailto:paezha@gmail.com">paezha@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Manuel Ruiz </td><td style="text-align: left;"> <a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Kulldorff M, Nagarwalla N. (1995).
Spatial disease clusters: Detection and Inference.
<em>Statistics in Medicine</em>. 14:799-810
</p>
</li>
<li><p> Jung I, Kulldorff M, Richard OJ (2010).
A spatial scan statistic for multinomial data.
<em>Statistics in Medicine</em>. 29(18), 1910-1918
</p>
</li>
<li><p> Páez, A., López-Hernández, F.A., Ortega-García, J.A., Ruiz, M. (2016).
Clustering and co-occurrence of cancer types: A comparison of techniques with
an application to pediatric cancer in Murcia, Spain.
<em>Spatial Analysis in Health Geography</em>, 69-90.
</p>
</li>
<li><p> Tango T., Takahashi K. (2005). A flexibly shaped spatial scan statistic
for detecting clusters, <em>International Journal of Health Geographics</em> 4:11.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+local.sp.runs.test">local.sp.runs.test</a></code>, <code><a href="#topic+dgp.spq">dgp.spq</a></code>, <code><a href="#topic+Q.test">Q.test</a></code>,
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Case 1: Scan test bernoulli
data(provinces_spain)
sf::sf_use_s2(FALSE)
provinces_spain$Mal2Fml &lt;- factor(provinces_spain$Mal2Fml &gt; 100)
levels(provinces_spain$Mal2Fml) = c("men","woman")
formula &lt;- ~ Mal2Fml
scan &lt;- scan.test(formula = formula, data = provinces_spain, case="men",
nsim = 99, distr = "bernoulli")
print(scan)
summary(scan)
plot(scan, sf = provinces_spain)

## With maximum number of neighborhood
scan &lt;- scan.test(formula = formula, data = provinces_spain, case = "woman",
nsim = 99, distr = "bernoulli")
print(scan)
plot(scan, sf = provinces_spain)


## With elliptic windows
scan &lt;- scan.test(formula = formula, data = provinces_spain, case = "men", nv = 25,
nsim = 99, distr = "bernoulli", windows ="elliptic")
print(scan)
scan &lt;- scan.test(formula = formula, data = provinces_spain, case = "men", nv = 15,
nsim = 99, distr = "bernoulli", windows ="elliptic", alternative = "Low")
print(scan)
plot(scan, sf = provinces_spain)

# Case 2: scan test multinomial
data(provinces_spain)
provinces_spain$Older &lt;- cut(provinces_spain$Older, breaks = c(-Inf,19,22.5,Inf))
levels(provinces_spain$Older) = c("low","middle","high")
formula &lt;- ~ Older
scan &lt;- scan.test(formula = formula, data = provinces_spain, nsim = 99, distr = "multinomial")
print(scan)
plot(scan, sf = provinces_spain)

# Case 3: scan test multinomial
data(FastFood.sf)
sf::sf_use_s2(FALSE)
formula &lt;- ~ Type
scan &lt;- scan.test(formula = formula, data = FastFood.sf, nsim = 99,
distr = "multinomial", windows="elliptic", nv = 50)
print(scan)
summary(scan)
plot(scan, sf = FastFood.sf)

# Case 4: DGP two categories
N &lt;- 150
cx &lt;- runif(N)
cy &lt;- runif(N)
listw &lt;- spdep::knearneigh(cbind(cx,cy), k = 10)
p &lt;- c(1/2,1/2)
rho &lt;- 0.5
fx &lt;- dgp.spq(p = p, listw = listw, rho = rho)
scan &lt;- scan.test(fx = fx, nsim = 99, case = "A", nv = 50, coor = cbind(cx,cy),
distr = "bernoulli",windows="circular")
print(scan)
plot(scan)

# Case 5: DGP three categories
N &lt;- 200
cx &lt;- runif(N)
cy &lt;- runif(N)
listw &lt;- spdep::knearneigh(cbind(cx,cy), k = 10)
p &lt;- c(1/3,1/3,1/3)
rho &lt;- 0.5
fx &lt;- dgp.spq(p = p, listw = listw, rho = rho)
scan &lt;- scan.test(fx = fx, nsim = 19, coor = cbind(cx,cy), nv = 30,
distr = "multinomial", windows = "elliptic")
print(scan)
plot(scan)

# Case 6: Flexible windows
data(provinces_spain)
sf::sf_use_s2(FALSE)
provinces_spain$Mal2Fml &lt;- factor(provinces_spain$Mal2Fml &gt; 100)
levels(provinces_spain$Mal2Fml) = c("men","woman")
formula &lt;- ~ Mal2Fml
listw &lt;- spdep::poly2nb(provinces_spain, queen = FALSE)
scan &lt;- scan.test(formula = formula, data = provinces_spain, case="men", listw = listw, nv = 6,
                  nsim = 99, distr = "bernoulli", windows = "flexible")
print(scan)
summary(scan)
plot(scan, sf = provinces_spain)


</code></pre>

<hr>
<h2 id='similarity.test'>Compute the similarity test.</h2><span id='topic+similarity.test'></span>

<h3>Description</h3>

<p>This function compute the nonparametric test for spatial independence
using symbolic analysis for categorical/qualitative spatial process.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>similarity.test(formula = NULL, data = NULL, fx = NULL, listw = listw,
alternative = "two.sided", distr = "asymptotic", nsim = NULL, control = list())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="similarity.test_+3A_formula">formula</code></td>
<td>
<p>a symbolic description of the factor (optional).</p>
</td></tr>
<tr><td><code id="similarity.test_+3A_data">data</code></td>
<td>
<p>an (optional) data frame or a sf object containing the variable to testing for.</p>
</td></tr>
<tr><td><code id="similarity.test_+3A_fx">fx</code></td>
<td>
<p>a factor (optional).</p>
</td></tr>
<tr><td><code id="similarity.test_+3A_listw">listw</code></td>
<td>
<p>a listw object</p>
</td></tr>
<tr><td><code id="similarity.test_+3A_alternative">alternative</code></td>
<td>
<p>a character string specifying the type of cluster, must be one
of &quot;High&quot; (default), &quot;Both&quot; or &quot;Low&quot;.</p>
</td></tr>
<tr><td><code id="similarity.test_+3A_distr">distr</code></td>
<td>
<p>A string. Distribution of the test &quot;asymptotic&quot; (default) or &quot;bootstrap&quot;</p>
</td></tr>
<tr><td><code id="similarity.test_+3A_nsim">nsim</code></td>
<td>
<p>Number of permutations.</p>
</td></tr>
<tr><td><code id="similarity.test_+3A_control">control</code></td>
<td>
<p>List of additional control arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This testing approach for spatial independence that extends some of the properties
of the join count statistic. The premise of the tests is similar to the join count
statistic in that they use the concept of similarity between neighbouring spatial
entities (Dacey 1968; Cliff and Ord 1973, 1981). However, it differs by taking
into consideration the number of joins belonging locally to each spatial unit,
rather than the total number of joins in the entire spatial system. The approach
proposed here is applicable to spatial and network contiguity structures, and
the number of neighbors belonging to observations need not be constant.<br />
</p>
<p>We define an equivalence relation <code class="reqn">\sim</code> in the set of locations S. An equivalence
relation satisfies the following properties:<br /> <br />
Reflexive: <code class="reqn">s_i \sim s_i</code> for all <code class="reqn">s_i \in S</code>,<br />
Symmetric: If <code class="reqn">s_i \sim s_j</code>, then <code class="reqn">s_j \sim s_i</code> for all <code class="reqn">s_i,\ s_j \in S</code> and<br />
Transitive: If <code class="reqn">s_i \sim s_j</code> and <code class="reqn">s_j \sim s_k</code>, then <code class="reqn">s_i \sim s_k</code>
for all <code class="reqn">s_i, \  s_j, \ s_k \in S</code><br /> <br />
We call the relation <code class="reqn">\sim</code> a similarity relation. Then, the null hypothesis that
we are interested in is
</p>
<p style="text-align: center;"><code class="reqn">H_0: \{X_s\}_{s \in S} \ \ is\ \ iid</code>
</p>

<p>Assume that, under the null hypothesis, <code class="reqn">P(s_i \sim s_{ji}) = p_i</code> for all
<code class="reqn">s_{ji} \in N_{s_i}</code>. <br />
Define<br />
</p>
<p style="text-align: center;"><code class="reqn">I_{ij}=1 \ \ if \ \ s_i \sim s_{ji} \ \ ; 0 \ \ otherwise</code>
</p>
<p><br />
Then, for a fixed degree d and for all location si with degree d, the variable d<br />
</p>
<p style="text-align: center;"><code class="reqn">\Lambda_{(d,i)}=\sum_{j=1}^d I_{ij}</code>
</p>

<p>gives the number of nearest neighbours to si that are similar to si.
Therefore, under the null hypothesis, <code class="reqn">H_0</code>, <code class="reqn">\Lambda(d,i)</code> follows a binomial
distribution <code class="reqn">B(d, p_i)</code>.
</p>


<h3>Value</h3>

<p>A object of the <em>htest</em>
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>data.name</code> </td><td style="text-align: left;"> a character string giving the names of the data.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>statistic</code> </td><td style="text-align: left;"> Value of the similarity test </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>N</code> </td><td style="text-align: left;"> total number of observations.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>Zmlc</code> </td><td style="text-align: left;"> Elements in the Most Likelihood Cluster.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>alternative</code> </td><td style="text-align: left;"> a character string describing the alternative hypothesis. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>p.value</code> </td><td style="text-align: left;"> p-value of the similarity test </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>similiarity.mc</code> </td><td style="text-align: left;"> values of the similarity test in each permutation. </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Control arguments</h3>


<table>
<tr>
 <td style="text-align: left;">
<code>seedinit</code> </td><td style="text-align: left;"> Numerical value for the seed (only for boot version). Default value seedinit=123 </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
Fernando López  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Román Mínguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Antonio Páez </td><td style="text-align: left;"> <a href="mailto:paezha@gmail.com">paezha@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Manuel Ruiz </td><td style="text-align: left;"> <a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Farber, S., Marin, M. R., &amp; Paez, A. (2015).
Testing for spatial independence using similarity relations.
<em>Geographical Analysis</em>. 47(2), 97-120.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+sp.runs.test">sp.runs.test</a></code>, <code><a href="#topic+dgp.spq">dgp.spq</a></code>, <code><a href="#topic+Q.test">Q.test</a></code>, , <code><a href="#topic+scan.test">scan.test</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Case 1:
N &lt;- 100
cx &lt;- runif(N)
cy &lt;- runif(N)
listw &lt;- spdep::knearneigh(cbind(cx,cy), k = 3)
p &lt;- c(1/4,1/4,1/4,1/4)
rho &lt;- 0.5
fx &lt;- dgp.spq(p = p, listw = listw, rho = rho)
W &lt;- (spdep::nb2mat(spdep::knn2nb(listw)) &gt;0)*1
similarity &lt;- similarity.test(fx = fx, data = FastFood.sf, listw = listw)
print(similarity)

# Case 2: test with formula, a sf object (points) and knn
data("FastFood.sf")
coor &lt;- sf::st_coordinates(sf::st_centroid(FastFood.sf))
listw &lt;- spdep::knearneigh(coor, k = 4)
formula &lt;- ~ Type
similarity &lt;- similarity.test(formula = formula, data = FastFood.sf, listw = listw)
print(similarity)

# Case 3:
data(provinces_spain)
listw &lt;- spdep::poly2nb(as(provinces_spain,"Spatial"), queen = FALSE)
provinces_spain$Mal2Fml &lt;- factor(provinces_spain$Mal2Fml &gt; 100)
levels(provinces_spain$Mal2Fml) = c("men","woman")
formula &lt;- ~ Mal2Fml
similarity &lt;- similarity.test(formula = formula, data = provinces_spain, listw = listw)
print(similarity)
</code></pre>

<hr>
<h2 id='sp.runs.test'>Compute the global spatial runs test.</h2><span id='topic+sp.runs.test'></span>

<h3>Description</h3>

<p>This function compute the global spatial runs test for spatial independence of a
categorical spatial data set.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sp.runs.test(formula = NULL, data = NULL, fx = NULL,
listw = listw, alternative = "two.sided" ,
distr = "asymptotic", nsim = NULL,control = list())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sp.runs.test_+3A_formula">formula</code></td>
<td>
<p>a symbolic description of the factor (optional).</p>
</td></tr>
<tr><td><code id="sp.runs.test_+3A_data">data</code></td>
<td>
<p>an (optional) data frame or a sf object containing the variable to testing for.</p>
</td></tr>
<tr><td><code id="sp.runs.test_+3A_fx">fx</code></td>
<td>
<p>a factor (optional).</p>
</td></tr>
<tr><td><code id="sp.runs.test_+3A_listw">listw</code></td>
<td>
<p>A neighbourhood list (type knn or nb) or a W matrix that indicates the order of the elements in each <code class="reqn">m_i-environment</code>
(for example of inverse distance). To calculate the number of runs in each <code class="reqn">m_i-environment</code>, an order must
be established, for example from the nearest neighbour to the furthest one.</p>
</td></tr>
<tr><td><code id="sp.runs.test_+3A_alternative">alternative</code></td>
<td>
<p>a character string specifying the alternative hypothesis, must be one
of &quot;two.sided&quot; (default), &quot;greater&quot; or &quot;less&quot;.</p>
</td></tr>
<tr><td><code id="sp.runs.test_+3A_distr">distr</code></td>
<td>
<p>A string. Distribution of the test &quot;asymptotic&quot; (default) or &quot;bootstrap&quot;.</p>
</td></tr>
<tr><td><code id="sp.runs.test_+3A_nsim">nsim</code></td>
<td>
<p>Number of permutations to obtain pseudo-value and confidence intervals (CI).
Default value is NULL to don't get CI of number of runs.</p>
</td></tr>
<tr><td><code id="sp.runs.test_+3A_control">control</code></td>
<td>
<p>List of additional control arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The order of the neighbourhoods (<code class="reqn">m_i-environments</code>) is critical to obtain the test. <br />
To obtain the number of runs observed in each <code class="reqn">m_i-environment</code>, each element must be associated
with a set of neighbours ordered by proximity.
Three kinds of lists can be included to identify <code class="reqn">m_i-environments</code>:<br />
</p>

<ul>
<li>  <p><code>knn</code>: Objects of the class knn that consider the neighbours in order of proximity.
</p>
</li>
<li>  <p><code>nb</code>: If the neighbours are obtained from an sf object, the code internally
will call the function <code><a href="#topic+nb2nb_order">nb2nb_order</a></code> it will order them in order
of proximity of the centroids.
</p>
</li>
<li>  <p><code>matrix</code>: If a object of matrix class based in the inverse of the distance in introduced
as argument, the function <code><a href="#topic+nb2nb_order">nb2nb_order</a></code> will also be called internally
to transform the object the class matrix to a matrix of the class nb with ordered neighbours.
</p>
</li></ul>

<p>Two alternative sets of arguments can be included in this function to compute the spatial runs test:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>Option 1</code> </td><td style="text-align: left;"> A factor (fx) and a list of neighborhood (<code>listw</code>) of the class knn. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>Option 2</code> </td><td style="text-align: left;"> A sf object (data) and formula to specify the factor. A list of neighbourhood (listw) </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Value</h3>

<p>A object of the <em>htest</em> and <em>sprunstest</em> class
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>data.name</code> </td><td style="text-align: left;"> a character string giving the names of the data.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>method</code> </td><td style="text-align: left;"> the type of test applied ().</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>SR</code> </td><td style="text-align: left;"> total number of runs </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>dnr</code> </td><td style="text-align: left;"> empirical distribution of the number of runs </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>statistic</code> </td><td style="text-align: left;"> Value of the homogeneity runs statistic. Negative sign indicates global homogeneity </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>alternative</code> </td><td style="text-align: left;"> a character string describing the alternative hypothesis. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>p.value</code> </td><td style="text-align: left;"> p-value of the SRQ </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>pseudo.value</code> </td><td style="text-align: left;"> the pseudo p-value of the SRQ test if nsim is not NULL</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>MeanNeig</code> </td><td style="text-align: left;"> Mean of the Maximum number of neighborhood </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>MaxNeig</code> </td><td style="text-align: left;"> Maximum number of neighborhood </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>listw</code> </td><td style="text-align: left;"> The list of neighborhood </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>nsim</code> </td><td style="text-align: left;"> number of boots (only for boots version) </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>SRGP</code> </td><td style="text-align: left;"> nsim simulated values of statistic. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>SRLP</code> </td><td style="text-align: left;"> matrix with the number of runs for eacl localization. </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Definition of spatial run</h3>

<p>In this section define the concepts of spatial encoding and runs, and construct the main statistics necessary
for testing spatial homogeneity of categorical variables. In order to develop a general theoretical setting,
let us consider <code class="reqn">\{X_s\}_{s \in S}</code>  to be the categorical spatial process of interest with Q different
categories, where S is a set of coordinates.<br />
</p>
<p><strong>Spatial encoding:</strong>
For a location <code class="reqn">s \in S</code> denote by <code class="reqn">N_s = \{s_1,s_2 ...,s_{n_s}\}</code>  the set of neighbours according
to the interaction scheme W, which are ordered from lesser to higher Euclidean distance with respect to location s.<br />
The sequence as <code class="reqn">X_{s_i} , X_{s_i+1},...,, X_{s_i+r}</code> its elements have the same value (or are identified by the same class)
is called a <strong>spatial run</strong> at location s of length r.<br />
</p>


<h3>Spatial run statistic</h3>

<p>The total number of runs is defined as:<br />
</p>
<p style="text-align: center;"><code class="reqn">SR^Q=n+\sum_{s \in S}\sum_{j=1}^{n_s}I_j^s</code>
</p>
<p><br />
where <code class="reqn">I_j^s = 1 \ if \ X_{s_j-1} \neq X_{s_j} \ and 0 \ otherwise</code> for <code class="reqn">j=1,2,...,n_s</code><br />
Following result by the Central Limit Theorem, the asymtotical distribution of <code class="reqn">SR^Q</code> is:<br />
</p>
<p style="text-align: center;"><code class="reqn">SR^Q = N(\mu_{SR^Q},\sigma_{SR^Q})</code>
</p>

<p>In the one-tailed case, we must distinguish the lower-tailed test and the upper-tailed, which are associated
with homogeneity and heterogeneity respectively. In the case of the lower-tailed test,
the following hypotheses are used:<br />
</p>
<p><code class="reqn">H_0:\{X_s\}_{s \in S}</code> is i.i.d.<br />
<code class="reqn">H_1</code>: The spatial distribution of the values of the categorical variable is more homogeneous than under the null hypothesis (according to the fixed association scheme).
In the upper-tailed test, the following hypotheses are used:<br />
</p>
<p><code class="reqn">H_0:\{X_s\}_{s \in S}</code> is i.i.d.<br />
<code class="reqn">H_1</code>: The spatial distribution of the values of the categorical variable is more
heterogeneous than under the null hypothesis (according to the fixed association scheme).<br />
</p>
<p>These hypotheses provide a decision rule regarding the degree of homogeneity in the spatial distribution
of the values of the spatial categorical random variable.<br />
</p>


<h3>Control arguments</h3>


<table>
<tr>
 <td style="text-align: left;">
<code>seedinit</code> </td><td style="text-align: left;"> Numerical value for the seed (only for boot version). Default value seedinit=123 </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
Fernando López  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Román Mínguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Antonio Páez </td><td style="text-align: left;"> <a href="mailto:paezha@gmail.com">paezha@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Manuel Ruiz </td><td style="text-align: left;"> <a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Ruiz, M., López, F., and Páez, A. (2021).
A test for global and local homogeneity of categorical data based on spatial runs.
<em>Working paper</em>.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+local.sp.runs.test">local.sp.runs.test</a></code>, <code><a href="#topic+dgp.spq">dgp.spq</a></code>, <code><a href="#topic+Q.test">Q.test</a></code>,
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Case 1: SRQ test based on factor and knn

n &lt;- 100
cx &lt;- runif(n)
cy &lt;- runif(n)
x &lt;- cbind(cx,cy)
listw &lt;- spdep::knearneigh(cbind(cx,cy), k=3)
p &lt;- c(1/6,3/6,2/6)
rho &lt;- 0.5
fx &lt;- dgp.spq(listw = listw, p = p, rho = rho)
srq &lt;- sp.runs.test(fx = fx, listw = listw)
print(srq)
plot(srq)

# Boots Version
control &lt;- list(seedinit = 1255)
srq &lt;- sp.runs.test(fx = fx, listw = listw, distr = "bootstrap" , nsim = 299, control = control)
print(srq)
plot(srq)

# Case 2: SRQ test with formula, a sf object (points) and knn
data("FastFood.sf")
x &lt;- sf::st_coordinates(sf::st_centroid(FastFood.sf))
listw &lt;- spdep::knearneigh(x, k=4)
formula &lt;- ~ Type
srq &lt;- sp.runs.test(formula = formula, data = FastFood.sf, listw = listw)
print(srq)
plot(srq)
# Version boots
srq &lt;- sp.runs.test(formula = formula, data = FastFood.sf, listw = listw,
distr = "bootstrap", nsim = 199)
print(srq)
plot(srq)

# Case 3: SRQ test (permutation) using formula with a sf object (polygons) and nb
library(sf)
fname &lt;- system.file("shape/nc.shp", package="sf")
nc &lt;- sf::st_read(fname)
listw &lt;- spdep::poly2nb(as(nc,"Spatial"), queen = FALSE)
p &lt;- c(1/6,3/6,2/6)
rho = 0.5
co &lt;- sf::st_coordinates(sf::st_centroid(nc))
nc$fx &lt;- dgp.spq(listw = listw, p = p, rho = rho)
plot(nc["fx"])
formula &lt;- ~ fx
srq &lt;- sp.runs.test(formula = formula, data = nc, listw = listw,
distr = "bootstrap", nsim = 399)
print(srq)
plot(srq)

# Case 4: SRQ test (Asymptotic) using formula with a sf object (polygons) and nb
data(provinces_spain)
# sf::sf_use_s2(FALSE)
listw &lt;- spdep::poly2nb(provinces_spain, queen = FALSE)
provinces_spain$Coast &lt;- factor(provinces_spain$Coast)
levels(provinces_spain$Coast) = c("no","yes")
plot(provinces_spain["Coast"])
formula &lt;- ~ Coast
srq &lt;- sp.runs.test(formula = formula, data = provinces_spain, listw = listw)
print(srq)
plot(srq)

# Boots version
srq &lt;- sp.runs.test(formula = formula, data = provinces_spain, listw = listw,
distr = "bootstrap", nsim = 299)
print(srq)
plot(srq)

# Case 5: SRQ test based on a distance matrix (inverse distance)
N &lt;- 100
cx &lt;- runif(N)
cy &lt;- runif(N)
data &lt;- as.data.frame(cbind(cx,cy))
data &lt;- sf::st_as_sf(data,coords = c("cx","cy"))
n = dim(data)[1]
dis &lt;- 1/matrix(as.numeric(sf::st_distance(data,data)),ncol=n,nrow=n)
diag(dis) &lt;- 0
dis &lt;- (dis &lt; quantile(dis,.10))*dis
p &lt;- c(1/6,3/6,2/6)
rho &lt;- 0.5
fx &lt;- dgp.spq(listw = dis , p = p, rho = rho)
srq &lt;- sp.runs.test(fx = fx, listw = dis)
print(srq)
plot(srq)

srq &lt;- sp.runs.test(fx = fx, listw = dis, data = data)
print(srq)
plot(srq)

# Boots version
srq &lt;- sp.runs.test(fx = fx, listw = dis, data = data, distr = "bootstrap", nsim = 299)
print(srq)
plot(srq)

# Case 6: SRQ test based on a distance matrix (inverse distance)
data("FastFood.sf")
# sf::sf_use_s2(FALSE)
n = dim(FastFood.sf)[1]
dis &lt;- 1000000/matrix(as.numeric(sf::st_distance(FastFood.sf,FastFood.sf)), ncol = n, nrow = n)
diag(dis) &lt;- 0
dis &lt;- (dis &lt; quantile(dis,.005))*dis
p &lt;- c(1/6,3/6,2/6)
rho = 0.5
co &lt;- sf::st_coordinates(sf::st_centroid(FastFood.sf))
FastFood.sf$fx &lt;- dgp.spq(p = p, listw = dis, rho = rho)
plot(FastFood.sf["fx"])
formula &lt;- ~ fx

# Boots version
srq &lt;- sp.runs.test(formula = formula, data = FastFood.sf, listw = dis,
distr = "bootstrap", nsim = 299)
print(srq)
plot(srq)


</code></pre>

<hr>
<h2 id='summary.spjctest'>Summary of estimated objects of class <em>spjctest</em>.</h2><span id='topic+summary.spjctest'></span>

<h3>Description</h3>

<p>This function summarizes estimated <em>spjctest</em> objects.
The tables in the output include basic information for each test.
blablabla...
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'spjctest'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.spjctest_+3A_object">object</code></td>
<td>
<p>An <em>spjctest</em> object including a list of <em>htest</em>.</p>
</td></tr>
<tr><td><code id="summary.spjctest_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <em>summary.spjctest</em>
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
Fernando López  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Román Mínguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Antonio Páez </td><td style="text-align: left;"> <a href="mailto:paezha@gmail.com">paezha@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Manuel Ruiz </td><td style="text-align: left;"> <a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>See Also</h3>

<p><code><a href="#topic+print.summary.spqtest">print.summary.spqtest</a></code>,
<code><a href="spdep.html#topic+joincount.test">joincount.test</a></code>,
<code><a href="spdep.html#topic+joincount.multi">joincount.multi</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Multinomial + Binomial using a sf multipolygon
data("provinces_spain")
sf::sf_use_s2(FALSE)
provinces_spain$Mal2Fml &lt;- factor(provinces_spain$Mal2Fml &gt; 100)
levels(provinces_spain$Mal2Fml) = c("men","woman")
provinces_spain$Older &lt;- cut(provinces_spain$Older, breaks = c(-Inf,19,22.5,Inf))
levels(provinces_spain$Older) = c("low","middle","high")
f1 &lt;- ~ Older + Mal2Fml
jc1 &lt;- jc.test(formula = f1,
               data = provinces_spain,
               distr = "mc",
               alternative = "greater",
               zero.policy = TRUE)
summary(jc1)
</code></pre>

<hr>
<h2 id='summary.spqtest'>Summary of estimated objects of class <em>spqtest</em>.</h2><span id='topic+summary.spqtest'></span>

<h3>Description</h3>

<p>This function summarizes estimated <em>spqtest</em> objects.
The tables in the output include basic information for each test.
blablabla...
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'spqtest'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.spqtest_+3A_object">object</code></td>
<td>
<p>An <em>spqtest</em> object including a list of <em>htest</em>.</p>
</td></tr>
<tr><td><code id="summary.spqtest_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <em>summary.spqtest</em>
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
Fernando López  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Román Mínguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Antonio Páez </td><td style="text-align: left;"> <a href="mailto:paezha@gmail.com">paezha@gmail.com</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
Manuel Ruiz </td><td style="text-align: left;"> <a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>See Also</h3>

<p><code><a href="#topic+print.summary.spqtest">print.summary.spqtest</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Example 1: With coordinates
N &lt;- 100
cx &lt;- runif(N)
cy &lt;- runif(N)
coor &lt;- cbind(cx,cy)
p &lt;- c(1/6,3/6,2/6)
rho = 0.5
listw &lt;- spdep::nb2listw(spdep::knn2nb(
              spdep::knearneigh(cbind(cx, cy), k = 4)))
fx &lt;- dgp.spq(list = listw, p = p, rho = rho)
q.test &lt;- Q.test(fx = fx, coor = coor, m = 3, r = 1)
summary(q.test)
plot(q.test)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
