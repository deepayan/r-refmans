<!DOCTYPE html><html lang="en"><head><title>Help for package hkevp</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {hkevp}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#extrapol.gev'><p>Spatial extrapolation of GEV parameters with the HKEVP</p></a></li>
<li><a href='#extrapol.return.level'><p>Spatial extrapolation of a return level.</p></a></li>
<li><a href='#hkevp'><p>A hierarchical model for spatial extreme values</p></a></li>
<li><a href='#hkevp.expmeasure'><p>Exponent measure of the HKEVP</p></a></li>
<li><a href='#hkevp.fit'><p>Fitting procedure of the HKEVP with MCMC algorithm</p></a></li>
<li><a href='#hkevp.predict'><p>Predictive distribution of the max-stable process at target positions.</p></a></li>
<li><a href='#hkevp.rand'><p>Simulation of the HKEVP</p></a></li>
<li><a href='#latent.fit'><p>Fitting procedure of the latent variable model</p></a></li>
<li><a href='#mcmc_hkevp'>
<p>C routine for fitting either the HKEVP or the latent variable model with MCMC.</p></a></li>
<li><a href='#mcmc.fun'><p>Point estimates of HKEVP fit</p></a></li>
<li><a href='#mcmc.plot'><p>Markov chains plotting</p></a></li>
<li><a href='#return.level'><p>The associated return level</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Spatial Extreme Value Analysis with the Hierarchical Model of
Reich and Shaby (2012)</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1.5</td>
</tr>
<tr>
<td>Author:</td>
<td>Quentin Sebille &lt;quentin.sebille@gmail.com&gt;</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Leo Belzile &lt;belzilel@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Several procedures for the hierarchical kernel extreme value process of Reich and Shaby (2012) &lt;<a href="https://doi.org/10.1214%2F12-AOAS591">doi:10.1214/12-AOAS591</a>&gt;, including simulation, estimation and spatial extrapolation. The spatial latent variable model &lt;<a href="https://doi.org/10.1214%2F11-STS376">doi:10.1214/11-STS376</a>&gt; is also included.</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/lbelzile/hkevp/issues/">https://github.com/lbelzile/hkevp/issues/</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL]</td>
</tr>
<tr>
<td>Imports:</td>
<td>Rcpp (&ge; 0.12.16)</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-04-17 23:25:33 UTC; lbelzile</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-04-18 11:50:06 UTC</td>
</tr>
</table>
<hr>
<h2 id='extrapol.gev'>Spatial extrapolation of GEV parameters with the HKEVP</h2><span id='topic+extrapol.gev'></span>

<h3>Description</h3>

<p>Predictive distributions of the GEV parameters at a set of ungauged sites (targets), given the output from the MCMC procedures <code>hkevp.fit</code> or <code>latent.fit</code>. See details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extrapol.gev(fit, targets, targets.covariates)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="extrapol.gev_+3A_fit">fit</code></td>
<td>
<p>Output from the <code>hkevp.fit</code> procedure.</p>
</td></tr>
<tr><td><code id="extrapol.gev_+3A_targets">targets</code></td>
<td>
<p>A matrix of real values giving the spatial coordinates of the ungauged positions. Each row corresponds to an ungauged position.</p>
</td></tr>
<tr><td><code id="extrapol.gev_+3A_targets.covariates">targets.covariates</code></td>
<td>
<p>A matrix of real values giving the spatial covariates of the ungauged positions. Must match with the covariates used in <code><a href="#topic+hkevp.fit">hkevp.fit</a></code> or <code><a href="#topic+latent.fit">latent.fit</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Since the GEV parameters are modelled with latent Gaussian processes, spatial extrapolation of the marginal distributions at target positions <code class="reqn">(s^*_1, ..., s^*_k)</code> is performed with simple kriging. Estimation is done at each MCMC step to produce a sample of the predictive distribution.
</p>


<h3>Value</h3>

<p>A named list of three elements: <code>loc</code>, <code>scale</code>, <code>shape</code>. Each one is a matrix with columns corresponding to targets positions.
</p>


<h3>Author(s)</h3>

<p>Quentin Sebille
</p>


<h3>See Also</h3>

<p><code><a href="#topic+extrapol.return.level">extrapol.return.level</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Simulation of HKEVP:
sites &lt;- as.matrix(expand.grid(1:3,1:3))
loc &lt;- sites[,1]*10
scale &lt;- 3
shape &lt;- 0
alpha &lt;- .4
tau &lt;- 1
ysim &lt;- hkevp.rand(10, sites, sites, loc, scale, shape, alpha, tau)

# HKEVP fit:
fit &lt;- hkevp.fit(ysim, sites, niter = 1000)

## Extrapolation:
targets &lt;- matrix(1.5, 1, 2)
gev.targets &lt;- extrapol.gev(fit, targets)

## True vs predicted:
predicted &lt;- sapply(gev.targets, median)
sd.predict &lt;- sapply(gev.targets, sd)
true &lt;- c(targets[,1]*10, scale, shape)
# cbind(true, predicted, sd.predict)


</code></pre>

<hr>
<h2 id='extrapol.return.level'>Spatial extrapolation of a return level.</h2><span id='topic+extrapol.return.level'></span>

<h3>Description</h3>

<p>Predictive distribution of a T-years return level at ungauged positions (targets), given the output from the MCMC procedures <code>hkevp.fit</code> or <code>latent.fit</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extrapol.return.level(period, fit, targets, targets.covariates)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="extrapol.return.level_+3A_period">period</code></td>
<td>
<p>An integer indicating the wished return period T.</p>
</td></tr>
<tr><td><code id="extrapol.return.level_+3A_fit">fit</code></td>
<td>
<p>Output from the <code>hkevp.fit</code> procedure.</p>
</td></tr>
<tr><td><code id="extrapol.return.level_+3A_targets">targets</code></td>
<td>
<p>A matrix of real values giving the spatial coordinates of the ungauged positions. Each row corresponds to an ungauged position.</p>
</td></tr>
<tr><td><code id="extrapol.return.level_+3A_targets.covariates">targets.covariates</code></td>
<td>
<p>A matrix of real values giving the spatial covariates of the ungauged positions. Must match with the covariates used in <code><a href="#topic+hkevp.fit">hkevp.fit</a></code> or <code><a href="#topic+latent.fit">latent.fit</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Spatial extrapolation of the return level at target positions <code class="reqn">(s^*_1, ..., s^*_k)</code> is a two-step procedure:
</p>

<ul>
<li><p>Estimation of the predictive distribution for GEV parameters at <code class="reqn">(s^*_1, ..., s^*_k)</code>, by using <code>{extrapol.gev}</code>.
</p>
</li>
<li><p>Computation of the associated return level for each state of the predictive distribution.</p>
</li></ul>



<h3>Value</h3>

<p>A matrix of predictive sample. Each column corresponds to a target position and each row to a predictive draw.
</p>


<h3>Author(s)</h3>

<p>Quentin Sebille
</p>


<h3>See Also</h3>

<p><code><a href="#topic+extrapol.gev">extrapol.gev</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Simulation of HKEVP:
sites &lt;- as.matrix(expand.grid(1:3,1:3))
knots &lt;- sites
loc &lt;- sites[,1]*10
scale &lt;- 1
shape &lt;- .2
alpha &lt;- .4
tau &lt;- 1
ysim &lt;- hkevp.rand(10, sites, knots, loc, scale, shape, alpha, tau)

# HKEVP fit:
fit &lt;- hkevp.fit(ysim, sites, niter = 1000)

## Extrapolation of the 100-years return level (may need more iterations and burn-in/nthin):
targets &lt;- as.matrix(expand.grid(1.5:2.5,1.5:2.5))
pred.sample &lt;- extrapol.return.level(100, fit, targets)
pred.mean &lt;- apply(pred.sample, 2, mean)
pred.sd &lt;- apply(pred.sample, 2, sd)
true &lt;- return.level(100, targets[,1]*10, scale, shape)
# cbind(true, pred.mean, pred.sd)



</code></pre>

<hr>
<h2 id='hkevp'>A hierarchical model for spatial extreme values</h2><span id='topic+hkevp'></span>

<h3>Description</h3>

<p>The HKEVP of <cite>Reich and Shaby (2012)</cite> is a hierarchical model which can be fitted on point-referenced block maxima across a region of space. Its acronym stands for Hierarchical Kernel Extreme Value Model.
</p>
<p>This model fits both marginal GEV parameters and a conditional spatial dependence structure in a Bayesian framework. Estimation of all parameters is performed with a Metropolis-within-Gibbs algorithm that returns samples of posterior distributions, given prior distributions and data. See details.
</p>
<p>Simulation and fitting procedure for this model are provided along with several other tools such as spatial extrapolation and conditional simulation, which is used for instance in <cite>Shaby and Reich (2012)</cite>.
</p>
<p>A particular simpler case of the HKEVP, defined in Davison et al. (2012), is also available. This model, referred as the latent variable model, assumes conditional independence of the block maxima data (i.e. no dependence structure).
</p>
<p>Spatial modelling of extreme values with general max-stable proceses is taken care of in other R libraries such as <code>RandomFields</code> and <code>SpatialExtremes</code>.
</p>


<h3>Details</h3>

<p>The functions included in <code>hkevp</code> package are listed below:
</p>

<ol>
<li> <p><code><a href="#topic+hkevp.fit">hkevp.fit</a></code> (resp. <code><a href="#topic+latent.fit">latent.fit</a></code>): fits the HKEVP (resp. the latent variable model) to spatial block maxima data.
</p>
</li>
<li> <p><code><a href="#topic+hkevp.rand">hkevp.rand</a></code>: simulates data from the HKEVP.
</p>
</li>
<li> <p><code><a href="#topic+hkevp.expmeasure">hkevp.expmeasure</a></code>: computes the exponent measure of the HKEVP. See details below.
</p>
</li>
<li> <p><code><a href="#topic+mcmc.fun">mcmc.fun</a></code>: applies a function to the main Markov chains obtained by <code>hkevp.fit</code>. Useful to compute the posterior means or quantiles for instance.
</p>
</li>
<li> <p><code><a href="#topic+mcmc.plot">mcmc.plot</a></code>: plots the resulting Markov chains, in order to visually assess convergence.
</p>
</li>
<li> <p><code><a href="#topic+extrapol.gev">extrapol.gev</a></code> (resp. <code><a href="#topic+extrapol.return.level">extrapol.return.level</a></code>) : computes the predictive distribution of the GEV parameters (resp. a return level) at ungauged positions.
</p>
</li>
<li> <p><code><a href="#topic+hkevp.predict">hkevp.predict</a></code>: predictive distribution of the spatial process at ungauged stes with the HKEVP given observations.</p>
</li></ol>

<p>The HKEVP of <cite>Reich and Shaby (2012)</cite> is a hierarchical spatial max-stable model for extreme values. Max-stable models arise as the limiting distribution of renormalized maxima of stochastic processes and they generalize the Extreme Value Theory (EVT) to the infinite-dimensional case. For more information about EVT and max-stable processes, see for instance <cite>Beirlant et al. (2004)</cite>, <cite>de Haan and Ferreira (2006)</cite> and <cite>Coles (2001)</cite>. For an emphasis on statistical inference on spatial extremes, see for instance <cite>Cooley et al. (2012)</cite> and <cite>Davison et al. (2012)</cite>.
</p>
<p>Let <code class="reqn">Y(\cdot)</code> be the process of block maxima recorded over a spatial region. Assume this process is max-stable, then all marginal distributions are necessarily GEV, i.e:
</p>
<p style="text-align: center;"><code class="reqn">Y(s) \sim GEV\{\mu(s),\sigma(s),\xi(s)\}</code>
</p>

<p>with location, scale and shape parameters <code class="reqn">\mu(s)</code>, <code class="reqn">\sigma(s)</code> and <code class="reqn">\xi(s)</code> respectively, indexed by position <code class="reqn">s</code> in space. Without loss of generality, one may look at the <em>simple max-stable process</em> <code class="reqn">Z(\cdot)</code> with <code class="reqn">GEV(1,1,1)</code> margins, where spatial dependence is contained unconditionally of the marginals.
</p>
<p>The HKEVP is thus defined by assuming that there exists <code class="reqn">\alpha\in(0,1]</code> and a set of knots <code class="reqn">\{v_1,...,v_L\}</code> with associated kernels <code class="reqn">\{\omega_1(\cdot),...,\omega_L(\cdot)\}</code> such that:
</p>
<p style="text-align: center;"><code class="reqn">Z(s) = U(s)\theta(s)</code>
</p>

<p>where <code class="reqn">U(s)</code> is a spatially-independent process with <code class="reqn">GEV(1,\alpha,\alpha)</code> margins and
</p>
<p style="text-align: center;"><code class="reqn">\theta(s) = \left[ \sum_{\ell=1}^L A_{\ell} \omega_{\ell}(s)^{1/\alpha}\right]^{\alpha}</code>
</p>

<p>is the <em>residual dependence process</em>, defined with a random variable <code class="reqn">A_{\ell} \sim PS(\alpha)</code>, the positive stable distribution with characteristic exponent <code class="reqn">\alpha</code>. Note that the kernels must satisfy the condition <code class="reqn">\sum_{\ell=1}^L \omega_{\ell}(s) = 1</code>, for all <code class="reqn">s</code>.
</p>
<p>Under those assumptions, <cite>Reich and Shaby (2012)</cite> showed that this model lead to an explicit formula for the distribution of a joint vector of maxima, which is not the case for max-stable processes since no general parametric representation exists (cf. <cite>de Haan and Ferreira (2006)</cite>). The joint distribution of the vector <code class="reqn">\{Z(s_1), \ldots, Z(s_n)\}</code> under the HKEVP assumptions can indeed be written:
</p>
<p style="text-align: center;"><code class="reqn">P\{ Z_1(s_1)&lt;z_1, \ldots, Z_n(s_n)&lt;z_n \} = \sum_{\ell=1}^L \left[ \sum_{i=1}^n \left(\frac{\omega_\ell(s_i)}{z_i}\right)^{1/\alpha}\right]^{\alpha} ~.</code>
</p>

<p>The HKEVP can be seen as an approximation of the <cite>Smith (1990)</cite> model, but with an additional dependence parameter <code class="reqn">\alpha</code> which controls the strength of spatial dependence. Low value for <code class="reqn">\alpha</code> leads to a strong dependence structure while <code class="reqn">\alpha=1</code> means independence.
</p>
<p>In the article of <cite>Reich and Shaby (2012)</cite>, the kernels are chosen to be standardized Gaussian kernels, i.e:
</p>
<p style="text-align: center;"><code class="reqn">\omega_\ell(s) = \frac{K(s_\ell|v_\ell,\tau)}{\sum_{j=1}^L K(s_j|v_j,\tau)} ~,</code>
</p>

<p>where <code class="reqn">K(\cdot|v,\tau)</code> is the Gaussian kernel centered at <code class="reqn">v_\ell</code> and <code class="reqn">\tau</code> is a bandwidth parameter.
</p>
<p>Conditionally on the marginal and the dependence parameters, we obtain independent responses which allow the computation of the likelihood. Since the model is structured via multiple layers, Bayesian inference is preferred. Details of the MCMC algorithm can be found in <cite>Reich and Shaby (2012)</cite>.
</p>
<p>Marginal parameters <code class="reqn">\mu(s)</code>, <code class="reqn">\sigma(s)</code> and <code class="reqn">\xi(s)</code> are modelled through latent Gaussian processes.
</p>
<p>A simpler version of the HKEVP, namely the latent variable model of Davison et al. (2012), is also available in this package. This model assumes conditional independence and can therefore be seen as a special case of the HKEVP, with the condition <code class="reqn">\alpha = 1</code>.
</p>


<h3>Note</h3>

<p>I would like to thank Brian Reich and Benjamin Shaby for their help regarding the implementation of the inference procedure of the HKEVP, and Mathieu Ribatet for introducing me to the Bayesian world. I also acknowledge Electricite de France (EDF) for the financial support and the helpful discussions around the HKEVP with Anne Dutfoy, Marie Gallois, Thi Thu Huong Hoang and Sylvie Parey. Finally, I thank my two PhD supervisors Anne-Laure Fougeres and Cecile Mercadier for their reviews of this package.
</p>


<h3>Author(s)</h3>

<p>Quentin Sebille
</p>


<h3>References</h3>

<p>Beirlant, J., Goegebeur, Y., Segers, J. J. J., &amp; Teugels, J. (2004). Statistics of Extremes: Theory and Applications. &lt;DOI:10.1002/0470012382&gt;
</p>
<p>Coles, S. (2001). An Introduction to Statistical Modeling of Extreme Values. Springer Science &amp; Business Media. &lt;10.1007/978-1-4471-3675-0&gt;
</p>
<p>Cooley, D., Cisewski, J., Erhardt, R. J., Jeon, S., Mannshardt, E., Omolo, B. O., &amp; Sun, Y. (2012). A survey of spatial extremes: Measuring spatial dependence and modeling spatial effects. Revstat, 10(1), 135-165.
</p>
<p>Davison, A. C., Padoan, S. A., &amp; Ribatet, M. (2012). Statistical modeling of spatial extremes. Statistical Science, 27(2), 161-186. &lt;DOI:10.1214/11-STS376&gt;
</p>
<p>de Haan, L., &amp; Ferreira, A. (2006). Extreme Value Theory: An Introduction. Springer Science &amp; Business Media. &lt;DOI:10.1007/0-387-34471-3&gt;
</p>
<p>Reich, B. J., &amp; Shaby, B. A. (2012). A hierarchical max-stable spatial model for extreme precipitation. The annals of applied statistics, 6(4), 1430. &lt;DOI:10.1214/12-AOAS591&gt;
</p>
<p>Shaby, B. A., &amp; Reich, B. J. (2012). Bayesian spatial extreme value analysis to assess the changing risk of concurrent high temperatures across large portions of European cropland. Environmetrics, 23(8), 638-648. &lt;DOI:10.1002/env.2178&gt;
</p>
<p>Smith, R. L. (1990). Max-stable processes and spatial extremes. Unpublished manuscript.
</p>

<hr>
<h2 id='hkevp.expmeasure'>Exponent measure of the HKEVP</h2><span id='topic+hkevp.expmeasure'></span>

<h3>Description</h3>

<p>Exponent measure <code class="reqn">V(z_1,...,z_n)</code> of the HKEVP of <cite>Reich and Shaby (2012)</cite>, with given model parameters or output from <code>hkevp.fit</code> or <code>latent.fit</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hkevp.expmeasure(z, sites, knots, alpha, tau, fit)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hkevp.expmeasure_+3A_z">z</code></td>
<td>
<p>The vector <code class="reqn">(z_1,...,z_n)</code> where the exponent measure is computed. Can be of length one and thus corresponds then to <code class="reqn">(z,...,z)</code>.</p>
</td></tr>
<tr><td><code id="hkevp.expmeasure_+3A_sites">sites</code></td>
<td>
<p>The coordinates of the sites where the data are observed. Each row correspond to a site position.</p>
</td></tr>
<tr><td><code id="hkevp.expmeasure_+3A_knots">knots</code></td>
<td>
<p>The coordinates of the knots in the HKEVP. By default, the positions of the knots coincide with the positions of the sites.</p>
</td></tr>
<tr><td><code id="hkevp.expmeasure_+3A_alpha">alpha</code></td>
<td>
<p>The dependence parameter <code class="reqn">\alpha</code> of the HKEVP: a single value in (0,1].</p>
</td></tr>
<tr><td><code id="hkevp.expmeasure_+3A_tau">tau</code></td>
<td>
<p>The bandwidth parameter <code class="reqn">\tau</code> of the kernel functions in the HKEVP: a positive value.</p>
</td></tr>
<tr><td><code id="hkevp.expmeasure_+3A_fit">fit</code></td>
<td>
<p>Output from the <code>hkevp.fit</code> procedure.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The exponent measure describes the spatial dependence structure of a max-stable process, independently from the values of the marginal parameters. If <code class="reqn">Z(\cdot)</code> is a simple max-stable process, i.e. with unit GEV(1,1,1) margins, recorded at the set of sites <code class="reqn">(s_1, \ldots, s_n)</code>, its joint cumulative probability density function is given by:
</p>
<p style="text-align: center;"><code class="reqn">P\{ Z(s_1)\leq z_1, \ldots, Z(s_n)\leq z_n \} = \exp(-V(z_1, \ldots, z_n)) ~,</code>
</p>

<p>where <code class="reqn">V</code> is the so-called exponent measure.
For the HKEVP, the exponent measure is explicit for any number <code class="reqn">n</code> of sites:
</p>
<p style="text-align: center;"><code class="reqn">V(z_1, \ldots, z_n) = \sum_{\ell=1}^L \left[ \sum_{i=1}^n \left(\frac{\omega_\ell(s_i)}{z_i}\right)^{1/\alpha}\right]^{\alpha} ~.</code>
</p>

<p>If argument <code>fit</code> is provided, the predictive distribution of </p>
<p style="text-align: center;"><code class="reqn">V(z_1, \ldots, z_n)</code>
</p>
<p> is computed. If not, the function uses arguments <code>sites</code>, <code>knots</code>, <code>alpha</code>, and <code>tau</code>.
</p>


<h3>Value</h3>

<p>Either a vector if argument <code>fit</code> is provided, or a single value.
</p>


<h3>Author(s)</h3>

<p>Quentin Sebille
</p>


<h3>References</h3>

<p>Reich, B. J., &amp; Shaby, B. A. (2012). A hierarchical max-stable spatial model for extreme precipitation. The annals of applied statistics, 6(4), 1430. &lt;DOI:10.1214/12-AOAS591&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
sites &lt;- as.matrix(expand.grid(1:3,1:3))
loc &lt;- sites[,1]*10
scale &lt;- 3
shape &lt;- 0
alpha &lt;- .4
tau &lt;- 1
ysim &lt;- hkevp.rand(10, sites, sites, loc, scale, shape, alpha, tau)

# HKEVP fit:
fit &lt;- hkevp.fit(ysim, sites, niter = 1000)

predict.em &lt;- hkevp.expmeasure(1, fit = fit)
true.em &lt;- hkevp.expmeasure(1, sites, sites, alpha, tau)
# plot(predict.em, ylim = range(predict.em, true.em), type = "l")
# abline(h = true.em, col = 2, lwd = 2)


</code></pre>

<hr>
<h2 id='hkevp.fit'>Fitting procedure of the HKEVP with MCMC algorithm</h2><span id='topic+hkevp.fit'></span>

<h3>Description</h3>

<p>Metropolis-within-Gibbs algorithm that returns samples from posterior distribution of all the parameters of the HKEVP.
</p>
<p>Most of the input parameters have default values, so that the procedure can be easily handled. However, convergence of the Markov chains should be assessed by using <code><a href="#topic+mcmc.plot">mcmc.plot</a></code> for instance. The experimented user can set initial states, prior hyperparameters along with the magnitude of the MCMC jumps.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hkevp.fit(
  y,
  sites,
  knots,
  niter,
  nburn,
  nthin,
  quiet,
  trace,
  fit.margins,
  gev.vary,
  spatial.covariates,
  log.scale,
  correlation,
  mcmc.init,
  mcmc.prior,
  mcmc.jumps
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hkevp.fit_+3A_y">y</code></td>
<td>
<p>A matrix of observed block maxima. Each column corresponds to a site position.</p>
</td></tr>
<tr><td><code id="hkevp.fit_+3A_sites">sites</code></td>
<td>
<p>The coordinates of the sites where the data are observed. Each row corresponds to a site position.</p>
</td></tr>
<tr><td><code id="hkevp.fit_+3A_knots">knots</code></td>
<td>
<p>The coordinates of the knots in the HKEVP. By default, the positions of the knots coincide with the positions of the sites.</p>
</td></tr>
<tr><td><code id="hkevp.fit_+3A_niter">niter</code></td>
<td>
<p>The number of MCMC iterations.</p>
</td></tr>
<tr><td><code id="hkevp.fit_+3A_nburn">nburn</code></td>
<td>
<p>The number of first MCMC iterations that are discarded. Zero by default.</p>
</td></tr>
<tr><td><code id="hkevp.fit_+3A_nthin">nthin</code></td>
<td>
<p>The size of the MCMC thinning. One by default (i.e. no thinning).</p>
</td></tr>
<tr><td><code id="hkevp.fit_+3A_quiet">quiet</code></td>
<td>
<p>A logical indicating if the progression of the routine should be displayed. TRUE by default.</p>
</td></tr>
<tr><td><code id="hkevp.fit_+3A_trace">trace</code></td>
<td>
<p>If <code>quiet</code> is FALSE, the log-likelihood of the model is displayed each block of <code>trace</code> MCMC steps to observe fitting progression.</p>
</td></tr>
<tr><td><code id="hkevp.fit_+3A_fit.margins">fit.margins</code></td>
<td>
<p>A logical that indicates if the GEV parameters should be fitted along with the dependence structure. TRUE by default.</p>
</td></tr>
<tr><td><code id="hkevp.fit_+3A_gev.vary">gev.vary</code></td>
<td>
<p>A logical vector of size three indicating if the GEV parameters (respectively the location, the scale and the shape) are spatially-varying. If not (by default for the shape), the parameter is the same at each position.</p>
</td></tr>
<tr><td><code id="hkevp.fit_+3A_spatial.covariates">spatial.covariates</code></td>
<td>
<p>A numerical matrix of spatial covariates. Each row corresponds to a site position. See details.</p>
</td></tr>
<tr><td><code id="hkevp.fit_+3A_log.scale">log.scale</code></td>
<td>
<p>A logical value indicating if the GEV scale parameter <code class="reqn">\sigma</code> is modelled by its log. FALSE by default. See details.</p>
</td></tr>
<tr><td><code id="hkevp.fit_+3A_correlation">correlation</code></td>
<td>
<p>A character string indicating the form of the correlation function associated to the latent Gaussian processes that describes the marginal parameters. Must be one of <code>"expo"</code>, <code>"gauss"</code>, <code>"mat32"</code> (By default) and <code>"mat52"</code>, respectively corresponding to the exponential, Gaussian, Matern-3/2 and Matern-5/2 correlation functions.</p>
</td></tr>
<tr><td><code id="hkevp.fit_+3A_mcmc.init">mcmc.init</code></td>
<td>
<p>A named list indicating the initial states of the chains. See details.</p>
</td></tr>
<tr><td><code id="hkevp.fit_+3A_mcmc.prior">mcmc.prior</code></td>
<td>
<p>A named list indicating the hyperparameters of the prior distributions. See details.</p>
</td></tr>
<tr><td><code id="hkevp.fit_+3A_mcmc.jumps">mcmc.jumps</code></td>
<td>
<p>A named list indicating the amplitude of the jumps to propose the MCMC candidates. See details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Details of the MCMC procedure are presented in <cite>Reich and Shaby (2012)</cite>. This function follows the indications and the choices of the authors, with the exception of several small changes:
</p>

<ul>
<li><p>The scale parameter <code class="reqn">\sigma</code> can be modelled like the two other marginal parameters as in <cite>Davison et al. (2012)</cite> or by its logarithm as in <cite>Reich and Shaby (2012)</cite>. For this, use the argument <code>log.scale</code>, set to FALSE by default.
</p>
</li>
<li><p>The Inverse-Gamma prior distributions defined for the bandwith parameter <code class="reqn">\tau</code> and for the ranges <code class="reqn">\lambda</code> of the latent processes are replaced by a Beta distribution over the interval <code class="reqn">[0,2D_{max}]</code>, where <code class="reqn">D_{max}</code> stands for the maximum distance between two sites.</p>
</li></ul>

<p>The procedure can be used normally with <code>fit.margins = TRUE</code> (default) or by assuming that the observed process had GEV(1,1,1) margins already and thus ignoring the marginal estimation.
</p>
<p>If the margins are estimated and the parameters are assumed spatially-varying, the user can provide spatial covariates to fit the mean of the latent Gaussian processes. Recall for instance for the GEV location parameter that:
</p>
<p style="text-align: center;"><code class="reqn">\mu(s) = \beta_{0,\mu} + \beta_{1,\mu} c_1(s) + ... + \beta_{p,\mu} c_p(s) ~.</code>
</p>

<p>The given matrix <code>spatial.covariates</code> that represents the <code class="reqn">c_i(s)</code> elements should have the first column filled with ones to account for the intercept <code class="reqn">\beta_0</code>.
</p>
<p>The arguments <code>mcmc.init</code>, <code>mcmc.prior</code> and <code>mcmc.jumps</code> are named list that have default values. The user can make point changes in these arguments, by setting <code>mcmc.init = list(alpha = .5)</code> for instance, but must respect the constraints of each element:
</p>

<ul>
<li><p><code>mcmc.init</code>. All elements are of length one. The possibilities are:
</p>

<ul>
<li><p><code>loc</code>, <code>scale</code> and <code>shape</code> (GEV parameters).
</p>
</li>
<li><p><code>range</code> and <code>sill</code> of the correlation functions.
</p>
</li>
<li><p><code>alpha</code>, <code>tau</code>, <code>A</code> and <code>B</code>, the dependence parameters and conditional variables of the HKEVP.</p>
</li></ul>

</li>
<li><p>mcmc.prior. The possible elements are:
</p>

<ul>
<li><p><code>constant.gev</code>: a <code class="reqn">2 \times 3</code> matrix of normal parameters for spatially-constant <code class="reqn">\mu</code>, <code class="reqn">\sigma</code> and <code class="reqn">\xi</code>. The first row are the means, the second are the standard deviations.
</p>
</li>
<li><p><code>beta.sd</code>: the normal sd prior of all <code class="reqn">\beta</code> parameters (a single value).
</p>
</li>
<li><p><code>range</code>, <code>alpha</code> and <code>tau</code>: the two Beta parameters.
</p>
</li>
<li><p><code>sill</code>: the two Inverse-Gamma parameters.</p>
</li></ul>

</li>
<li><p>mcmc.jumps. The possible elements are:
</p>

<ul>
<li><p><code>gev</code> and <code>range</code>: a vector of length 3 (for each GEV parameter).
</p>
</li>
<li><p><code>tau</code>, <code>alpha</code>, <code>A</code>, <code>B</code>: single values for each.</p>
</li></ul>
</li></ul>



<h3>Value</h3>

<p>A named list with following elements:
</p>

<ul>
<li><p><code>GEV</code>: the Markov chains associated to the GEV parameters. The dimensions of the array correspond respectively to the sites positions, the three GEV parameters and the states of the Markov chains.
</p>
</li>
<li><p><code>alpha</code>: the Markov chain associated to the dependence parameter <code class="reqn">\alpha</code>.
</p>
</li>
<li><p><code>tau</code>: the Markov chain associated to the dependence parameter <code class="reqn">\tau</code>.
</p>
</li>
<li><p><code>A</code>: the Markov chains associated to the positive stable random effect per site and per block. The dimensions correspond respectively to the indices of blocks, the knots positions and the states of the Markov chains.
</p>
</li>
<li><p><code>llik</code>: the log-likelihood of the model for each step of the algorithm.
</p>
</li>
<li><p><code>time</code>: time (in sec) spent for the fit.
</p>
</li>
<li><p><code>spatial</code>: a named list with four elements linked to the GEV spatially-varying parameters:
</p>

<ul>
<li><p><code>vary</code>: the argument <code>gev.vary</code>.
</p>
</li>
<li><p><code>beta</code>: the <code class="reqn">\beta</code> parameters for each GEV parameter. The dimensions correspond respectively to the steps of the Markov chains, the <code class="reqn">p</code> spatial covariates and the GEV parameters
</p>
</li>
<li><p><code>sills</code>: the Markov chains associated to the sills in the correlation functions of the latent Gaussian processes.
</p>
</li>
<li><p><code>ranges</code>: the Markov chains associated to the ranges in the correlation functions of the latent Gaussian processes.</p>
</li></ul>

</li>
<li><p><code>data</code>: the data fitted.
</p>
</li>
<li><p><code>sites</code>: the sites where the data are observed.
</p>
</li>
<li><p><code>knots</code>: the set of knots.
</p>
</li>
<li><p><code>spatial.covariates</code>: the spatial covariates.
</p>
</li>
<li><p><code>correlation</code>: the type of correlation function for the marginal latent processes.
</p>
</li>
<li><p><code>nstep</code>: the number of steps at the end of the routine after burn-in and thinning.
</p>
</li>
<li><p><code>log.scale</code>: a boolean indicating if the scale parameter has been modelled via its logarithm.
</p>
</li>
<li><p><code>fit.type</code>: either &quot;hkevp&quot; or &quot;dep-only&quot; character string to specify the type of fit.</p>
</li></ul>

<p>If <code>fit.margins</code> is false, only the dependence-related elements are returned.
</p>


<h3>Author(s)</h3>

<p>Quentin Sebille
</p>


<h3>References</h3>

<p>Reich, B. J., &amp; Shaby, B. A. (2012). A hierarchical max-stable spatial model for extreme precipitation. The annals of applied statistics, 6(4), 1430. &lt;DOI:10.1214/12-AOAS591&gt;
</p>
<p>Stephenson, A. G. (2009) High-dimensional parametric modelling of multivariate extreme events. Aust. N. Z. J Stat, 51, 77-88. &lt;DOI:10.1111/j.1467-842X.2008.00528.x&gt;
</p>
<p>Davison, A. C., Padoan, S. A., &amp; Ribatet, M. (2012). Statistical modeling of spatial extremes. Statistical Science, 27(2), 161-186. &lt;DOI:10.1214/11-STS376&gt;
</p>


<h3>See Also</h3>

<p>latent.fit
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Simulation of HKEVP:
set.seed(1)
sites &lt;- as.matrix(expand.grid(1:3,1:3))
loc &lt;- sites[,1]*10
scale &lt;- 3
shape &lt;- 0
alpha &lt;- .4
tau &lt;- 1
ysim &lt;- hkevp.rand(10, sites, sites, loc, scale, shape, alpha, tau)

# HKEVP fit:
fit &lt;- latent.fit(ysim, sites, niter = 1000)



</code></pre>

<hr>
<h2 id='hkevp.predict'>Predictive distribution of the max-stable process at target positions.</h2><span id='topic+hkevp.predict'></span>

<h3>Description</h3>

<p>Computes the predictive distribution of <code class="reqn">Y(\cdot)</code> at a set of ungauged positions <code class="reqn">(s_1^*, ..., s_k^*)</code>, given data at gauged positions <code class="reqn">(s_1, ..., s_n)</code>, by using the output of <cite>latent.fit</cite> or <code>hkevp.fit</code>.
</p>
<p>Two types of prediction are available for the HKEVP, as described in <cite>Shaby and Reich (2012)</cite>. See details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hkevp.predict(fit, targets, targets.covariates, predict.type = "kriging")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hkevp.predict_+3A_fit">fit</code></td>
<td>
<p>Output from the <code>hkevp.fit</code> procedure.</p>
</td></tr>
<tr><td><code id="hkevp.predict_+3A_targets">targets</code></td>
<td>
<p>A matrix of real values giving the spatial coordinates of the ungauged positions. Each row corresponds to an ungauged position.</p>
</td></tr>
<tr><td><code id="hkevp.predict_+3A_targets.covariates">targets.covariates</code></td>
<td>
<p>A matrix of real values giving the spatial covariates of the ungauged positions. Must match with the covariates used in <code><a href="#topic+hkevp.fit">hkevp.fit</a></code> or <code><a href="#topic+latent.fit">latent.fit</a></code>.</p>
</td></tr>
<tr><td><code id="hkevp.predict_+3A_predict.type">predict.type</code></td>
<td>
<p>Character string specifying the type of prediction. Must be one of &quot;<code>kriging</code>&quot; (default) or &quot;<code>climat</code>&quot;. See details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The spatial prediction of <code class="reqn">Y_t(s^*)</code> for a target site <code class="reqn">s^*</code> and a realisation <code class="reqn">t</code> of the process is described in <cite>Shaby and Reich (2012)</cite>. This method involves a three-step procedure:
</p>

<ol>
<li><p> Computation of the residual dependence process <code class="reqn">\theta(\cdot)</code> at the target positions.
</p>
</li>
<li><p> Computation of the conditional GEV parameters <code class="reqn">(\mu^*,\sigma^*,\xi^*)</code> at the target sites. See the definition of the HKEVP in <cite>Reich and Shaby (2012)</cite>.
</p>
</li>
<li><p> Generation of <code class="reqn">Y_t(s^*)</code> from an independent GEV distribution with parameters <code class="reqn">(\mu^*,\sigma^*,\xi^*)</code>.
</p>
</li></ol>

<p>As sketched in <cite>Shaby and Reich (2012)</cite>, two types of prediction are possible: the kriging-type and the climatological-type. These two types differ when the residual dependence process <code class="reqn">\theta</code> is computed (first step of the prediction):
</p>

<ul>
<li><p> The kriging-type takes the actual value of <code class="reqn">A</code> in the MCMC algorithm to compute the residual dependence process. The prediction will be the distribution of the maximum recorded at the specified targets.
</p>
</li>
<li><p> The climatological-type generates <code class="reqn">A</code> by sampling from the positive stable distribution with characteristic exponent <code class="reqn">\alpha</code>, where <code class="reqn">\alpha</code> is the actual value of the MCMC step. The prediction in climatological-type will be the distribution of what could happen in the conditions of the HKEVP dependence structure.
</p>
</li></ul>

<p>Posterior distribution for each realisation <code class="reqn">t</code> of the process and each target position <code class="reqn">s^*</code> is represented with a sample where each element corresponds to a step of the MCMC procedure.
</p>


<h3>Value</h3>

<p>A three-dimensional array where:
</p>

<ul>
<li><p> Each row corresponds to a different realisation of the process (a block).
</p>
</li>
<li><p> Each column corresponds to a target position.
</p>
</li>
<li><p> Each slice corresponds to a MCMC step.</p>
</li></ul>



<h3>Author(s)</h3>

<p>Quentin Sebille
</p>


<h3>References</h3>

<p>Reich, B. J., &amp; Shaby, B. A. (2012). A hierarchical max-stable spatial model for extreme precipitation. The annals of applied statistics, 6(4), 1430. &lt;DOI:10.1214/12-AOAS591&gt;
</p>
<p>Shaby, B. A., &amp; Reich, B. J. (2012). Bayesian spatial extreme value analysis to assess the changing risk of concurrent high temperatures across large portions of European cropland. Environmetrics, 23(8), 638-648. &lt;DOI:10.1002/env.2178&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Simulation of HKEVP:
sites &lt;- as.matrix(expand.grid(1:3,1:3))
targets &lt;- as.matrix(expand.grid(1.5:2.5,1.5:2.5))
all.pos &lt;- rbind(sites, targets)
knots &lt;- sites
loc &lt;- all.pos[,1]*10
scale &lt;- 3
shape &lt;- 0
alpha &lt;- .4
tau &lt;- 1
ysim &lt;- hkevp.rand(10, all.pos, knots, loc, scale, shape, alpha, tau)
yobs &lt;- ysim[,1:9]

# HKEVP fit (omitting first site, used as target):
fit &lt;- hkevp.fit(yobs, sites, niter = 1000)

# Extrapolation:
ypred &lt;- hkevp.predict(fit, targets, predict.type = "kriging")

# Plot of the density and the true value for 4 first realizations:
# par(mfrow = c(2, 2))
# plot(density(ypred[1,1,]), main = "Target 1 / Year 1")
# abline(v = ysim[1,10], col = 2, lwd = 2)
# plot(density(ypred[2,1,]), main = "Target 1 / Year 2")
# abline(v = ysim[2,10], col = 2, lwd = 2)
# plot(density(ypred[1,2,]), main = "Target 2 / Year 1")
# abline(v = ysim[1,11], col = 2, lwd = 2)
# plot(density(ypred[2,2,]), main = "Target 2 / Year 2")
# abline(v = ysim[2,11], col = 2, lwd = 2)




</code></pre>

<hr>
<h2 id='hkevp.rand'>Simulation of the HKEVP</h2><span id='topic+hkevp.rand'></span>

<h3>Description</h3>

<p>Simulation procedure of the HKEVP with given sites and knots positions and marginal and spatial dependence parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hkevp.rand(nrep, sites, knots, loc, scale, shape, alpha, tau)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hkevp.rand_+3A_nrep">nrep</code></td>
<td>
<p>A positive integer.
Number of realisations of the block mashapema process.</p>
</td></tr>
<tr><td><code id="hkevp.rand_+3A_sites">sites</code></td>
<td>
<p>The coordinates of the sites where the data are observed. Each row corresponds to a site position.</p>
</td></tr>
<tr><td><code id="hkevp.rand_+3A_knots">knots</code></td>
<td>
<p>The coordinates of the knots in the HKEVP. By default, the positions of the knots coincide with the positions of the sites.</p>
</td></tr>
<tr><td><code id="hkevp.rand_+3A_loc">loc</code></td>
<td>
<p>A numerical value or a vector of real values for the GEV location parameter. If a vector, its length must coincide with the number of sites. The value by default is 1.</p>
</td></tr>
<tr><td><code id="hkevp.rand_+3A_scale">scale</code></td>
<td>
<p>A numerical value or a vector of real values for the GEV scale parameter. If a vector, its length must coincide with the number of sites. The value by default is 1.</p>
</td></tr>
<tr><td><code id="hkevp.rand_+3A_shape">shape</code></td>
<td>
<p>A numerical value or a vector of real values for the GEV shape parameter. If a vector, its length must coincide with the number of sites. The value by default is 1.</p>
</td></tr>
<tr><td><code id="hkevp.rand_+3A_alpha">alpha</code></td>
<td>
<p>The dependence parameter <code class="reqn">\alpha</code> of the HKEVP: a single value in (0,1].</p>
</td></tr>
<tr><td><code id="hkevp.rand_+3A_tau">tau</code></td>
<td>
<p>The bandwidth parameter <code class="reqn">\tau</code> of the kernel functions in the HKEVP: a positive value.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Simulating one realisation of the block mashapema process <code class="reqn">Y(\cdot)</code> from the HKEVP involves three steps:
</p>

<ol>
<li><p> The <em>nugget process</em> <code class="reqn">U(\cdot)</code> is generated independently at each position, by simulating a random variable with <code class="reqn">GEV(1,\alpha,\alpha)</code> distribution.
</p>
</li>
<li><p> The <em>residual dependence process</em> <code class="reqn">\theta(\cdot)</code> is computed by using the kernel functions centered at the set of knots, the bandwidth parameter <code class="reqn">\tau</code> and the simulations of the positive stable <code class="reqn">PS(\alpha)</code> random effect <code class="reqn">A</code>.
</p>
</li>
<li><p> The process <code class="reqn">Z = U\theta</code> is computed and its margins are transformed to the general GEV distribution with <code class="reqn">\mu(s),\sigma(s)</code> and <code class="reqn">\xi(s)</code> parameters.
</p>
</li></ol>



<h3>Value</h3>

<p>A numerical matrix of real values.
Each column corresponds to a position and each row to a realisation of the process.
</p>


<h3>Author(s)</h3>

<p>Quentin Sebille
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulation of HKEVP:
sites &lt;- as.matrix(expand.grid(1:3,1:3))
loc &lt;- sites[,1]*10
scale &lt;- 3
shape &lt;- 0
alpha &lt;- .4
tau &lt;- 1
ysim &lt;- hkevp.rand(10, sites, sites, loc, scale, shape, alpha, tau)





</code></pre>

<hr>
<h2 id='latent.fit'>Fitting procedure of the latent variable model</h2><span id='topic+latent.fit'></span>

<h3>Description</h3>

<p>Metropolis-within-Gibbs algorithm that returns posterior distribution (as Markov chains) for the marginal GEV parameters of an observed spatial process.
This function is close to <code>hkevp.fit</code> but with less parameters since conditional independence is assumed and only the margins are estimated.
In <code>SpatialExtremes</code> library, a similar function can be found under the name <code>latent</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>latent.fit(
  y,
  sites,
  niter,
  nburn,
  nthin,
  quiet,
  trace,
  gev.vary,
  spatial.covariates,
  log.scale,
  correlation,
  mcmc.init,
  mcmc.prior,
  mcmc.jumps
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="latent.fit_+3A_y">y</code></td>
<td>
<p>A matrix of observed block maxima. Each column corresponds to a site position.</p>
</td></tr>
<tr><td><code id="latent.fit_+3A_sites">sites</code></td>
<td>
<p>The coordinates of the sites where the data are observed. Each row corresponds to a site position.</p>
</td></tr>
<tr><td><code id="latent.fit_+3A_niter">niter</code></td>
<td>
<p>The number of MCMC iterations.</p>
</td></tr>
<tr><td><code id="latent.fit_+3A_nburn">nburn</code></td>
<td>
<p>The number of first MCMC iterations that are discarded. Zero by default.</p>
</td></tr>
<tr><td><code id="latent.fit_+3A_nthin">nthin</code></td>
<td>
<p>The size of the MCMC thinning. One by default (i.e. no thinning).</p>
</td></tr>
<tr><td><code id="latent.fit_+3A_quiet">quiet</code></td>
<td>
<p>A logical indicating if the progression of the routine should be displayed. TRUE by default.</p>
</td></tr>
<tr><td><code id="latent.fit_+3A_trace">trace</code></td>
<td>
<p>If <code>quiet</code> is FALSE, the log-likelihood of the model is displayed each block of <code>trace</code> MCMC steps to observe fitting progression.</p>
</td></tr>
<tr><td><code id="latent.fit_+3A_gev.vary">gev.vary</code></td>
<td>
<p>A logical vector of size three indicating if the GEV parameters (respectively the location, the scale and the shape) are spatially-varying. If not (by default for the shape), the parameter is the same at each position.</p>
</td></tr>
<tr><td><code id="latent.fit_+3A_spatial.covariates">spatial.covariates</code></td>
<td>
<p>A numerical matrix of spatial covariates. Each row corresponds to a site position. See details.</p>
</td></tr>
<tr><td><code id="latent.fit_+3A_log.scale">log.scale</code></td>
<td>
<p>A logical value indicating if the GEV scale parameter <code class="reqn">\sigma</code> is modelled by its log. FALSE by default. See details.</p>
</td></tr>
<tr><td><code id="latent.fit_+3A_correlation">correlation</code></td>
<td>
<p>A character string indicating the form of the correlation function associated to the latent Gaussian processes that describes the marginal parameters. Must be one of <code>"expo"</code>, <code>"gauss"</code>, <code>"mat32"</code> (By default) and <code>"mat52"</code>, respectively corresponding to the exponential, Gaussian, Matern-3/2 and Matern-5/2 correlation functions.</p>
</td></tr>
<tr><td><code id="latent.fit_+3A_mcmc.init">mcmc.init</code></td>
<td>
<p>A named list indicating the initial states of the chains. See details.</p>
</td></tr>
<tr><td><code id="latent.fit_+3A_mcmc.prior">mcmc.prior</code></td>
<td>
<p>A named list indicating the hyperparameters of the prior distributions. See details.</p>
</td></tr>
<tr><td><code id="latent.fit_+3A_mcmc.jumps">mcmc.jumps</code></td>
<td>
<p>A named list indicating the amplitude of the jumps to propose the MCMC candidates. See details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Details of the MCMC procedure are presented in <cite>Davison et al. (2012)</cite>. This function follows the indications and the choices of the authors, with the exception of several small changes:
</p>

<ul>
<li><p>The scale parameter <code class="reqn">\sigma</code> can be modelled like the two other marginal parameters as in <cite>Davison et al. (2012)</cite> or by its logarithm as in <cite>Reich and Shaby (2012)</cite>. For this, use the argument <code>log.scale</code>, set to FALSE by default.
</p>
</li>
<li><p>The Inverse-Gamma prior distributions defined for the bandwith parameter <code class="reqn">\tau</code> and for the ranges <code class="reqn">\lambda</code> of the latent processes are replaced by a Beta distribution over the interval <code class="reqn">[0,2D_{max}]</code>, where <code class="reqn">D_{max}</code> stands for the maximum distance between two sites.</p>
</li></ul>

<p>If the the parameters are assumed spatially-varying, the user can provide spatial covariates to fit the mean of the latent Gaussian processes. Recall for instance for the GEV location parameter that:
</p>
<p style="text-align: center;"><code class="reqn">\mu(s) = \beta_{0,\mu} + \beta_{1,\mu} c_1(s) + ... + \beta_{p,\mu} c_p(s) ~.</code>
</p>

<p>The given matrix <code>spatial.covariates</code> that represents the <code class="reqn">c_i(s)</code> elements should have the first column filled with ones to account for the intercept <code class="reqn">\beta_0</code>.
</p>
<p>The arguments <code>mcmc.init</code>, <code>mcmc.prior</code> and <code>mcmc.jumps</code> are named list that have default values. The user can make point changes in these arguments, by setting <code>mcmc.init = list(loc = .5)</code> for instance, but must respect the constraints of each element:
</p>

<ul>
<li><p><code>mcmc.init</code>: all elements are of length one. The possible elements are:
</p>

<ul>
<li><p><code>loc</code>, <code>scale</code> and <code>shape</code> (GEV parameters).
</p>
</li>
<li><p><code>range</code> and <code>sill</code> of the correlation functions.</p>
</li></ul>

</li>
<li><p>mcmc.prior: the possible elements are:
</p>

<ul>
<li><p><code>constant.gev</code>: a <code class="reqn">2 \times 3</code> matrix of normal parameters for spatially-constant <code class="reqn">\mu</code>, <code class="reqn">\sigma</code> and <code class="reqn">\xi</code>. The first row are the means, the second are the standard deviations.
</p>
</li>
<li><p><code>beta.sd</code>: the normal sd prior of all <code class="reqn">\beta</code> parameters (a single value).
</p>
</li>
<li><p><code>range</code>: the two Beta parameters.
</p>
</li>
<li><p><code>sill</code>: the two Inverse-Gamma parameters.</p>
</li></ul>

</li>
<li><p>mcmc.jumps: the possible elements are <code>gev</code> and <code>range</code>, vectors of length 3 (for each GEV parameter).</p>
</li></ul>



<h3>Value</h3>

<p>A named list with following elements (less elements if <code>fit.margins</code> is <code>FALSE</code>):
</p>

<ul>
<li><p><code>GEV</code>: the Markov chains associated to the GEV parameters. The dimensions of the array correspond respectively to the sites positions, the three GEV parameters and the states of the Markov chains.
</p>
</li>
<li><p><code>llik</code>: the log-likelihood of the model for each step of the algorithm.
</p>
</li>
<li><p><code>time</code>: time (in sec) spent for the fit.
</p>
</li>
<li><p><code>spatial</code>: a named list with four elements linked to the GEV spatially-varying parameters:
</p>

<ul>
<li><p><code>vary</code>: the argument <code>gev.vary</code>.
</p>
</li>
<li><p><code>beta</code>: the <code class="reqn">\beta</code> parameters for each GEV parameter. The dimensions correspond respectively to the steps of the Markov chains, the <code class="reqn">p</code> spatial covariates and the GEV parameters
</p>
</li>
<li><p><code>sills</code>: the Markov chains associated to the sills in the correlation functions of the latent Gaussian processes.
</p>
</li>
<li><p><code>ranges</code>: the Markov chains associated to the ranges in the correlation functions of the latent Gaussian processes.</p>
</li></ul>

</li>
<li><p><code>data</code>: the data fitted.
</p>
</li>
<li><p><code>sites</code>: the sites where the data are observed.
</p>
</li>
<li><p><code>spatial.covariates</code>: the spatial covariates.
</p>
</li>
<li><p><code>correlation</code>: the type of correlation function for the marginal latent processes.
</p>
</li>
<li><p><code>nstep</code>: the number of steps at the end of the routine after burn-in and thinning.
</p>
</li>
<li><p><code>log.scale</code>: a boolean indicating if the scale parameter has been modelled via its logarithm.
</p>
</li>
<li><p><code>fit.type</code>: &quot;latent&quot; character string to specify the type of fit.</p>
</li></ul>



<h3>Author(s)</h3>

<p>Quentin Sebille
</p>


<h3>References</h3>

<p>Reich, B. J., &amp; Shaby, B. A. (2012). A hierarchical max-stable spatial model for extreme precipitation. The annals of applied statistics, 6(4), 1430. &lt;DOI:10.1214/12-AOAS591&gt;
</p>
<p>Davison, A. C., Padoan, S. A., &amp; Ribatet, M. (2012). Statistical modeling of spatial extremes. Statistical Science, 27(2), 161-186. &lt;DOI:10.1214/11-STS376&gt;
</p>


<h3>See Also</h3>

<p>hkevp.fit
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Simulation of HKEVP:
sites &lt;- as.matrix(expand.grid(1:4,1:4))
loc &lt;- sites[,1]*10
scale &lt;- 3
shape &lt;- .2
alpha &lt;- 1
tau &lt;- 2
ysim &lt;- hkevp.rand(15, sites, sites, loc, scale, shape, alpha, tau)

# Latent Variable Model fit:
set.seed(1)
fit &lt;- latent.fit(ysim, sites, niter = 10000, nburn = 5000, nthin = 5)
mcmc.plot(fit, TRUE)
par(mfrow = c(2,2))
apply(fit$GEV[,1,], 1, acf)





</code></pre>

<hr>
<h2 id='mcmc_hkevp'>
C routine for fitting either the HKEVP or the latent variable model with MCMC.
</h2><span id='topic+mcmc_latent'></span><span id='topic+mcmc_hkevp'></span><span id='topic+mcmc_deponly'></span>

<h3>Description</h3>

<p>This set of functions are called by <code>hkevp.fit</code> or <code>latent.fit</code> and should not be used directly by the user (high risk of segmentation fault)!
</p>


<h3>Author(s)</h3>

<p>Quentin Sebille</p>


<h3>See Also</h3>

<p><code><a href="#topic+hkevp.fit">hkevp.fit</a></code></p>

<hr>
<h2 id='mcmc.fun'>Point estimates of HKEVP fit</h2><span id='topic+mcmc.fun'></span>

<h3>Description</h3>

<p>Application of a function to the main Markov chains resulting from the procedure <code>hkevp.fit</code>. May be used to obtain point estimates of the posterior distribution (e.g., the mean or the median). See details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mcmc.fun(fit, FUN, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mcmc.fun_+3A_fit">fit</code></td>
<td>
<p>A named list.
Output from the <code>hkevp.fit</code> procedure.</p>
</td></tr>
<tr><td><code id="mcmc.fun_+3A_fun">FUN</code></td>
<td>
<p>The function applied to the Markov chains in <code>fit</code>. The median by default. The output from FUN must be a single value.</p>
</td></tr>
<tr><td><code id="mcmc.fun_+3A_...">...</code></td>
<td>
<p>Optional arguments of the function to be applied on the Markov chains (e.g. <code>na.rm = FALSE</code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A function is applied to the main Markov chains resulting from the MCMC procedures <code>hkevp.fit</code> or <code>latent.fit</code>. These chains correspond to the three GEV parameters, the dependence parameter <code class="reqn">\alpha</code> and the bandwidth <code class="reqn">\tau</code>.
</p>
<p>The value returned by <code>FUN</code> must be a single value.
</p>


<h3>Value</h3>

<p>If fitted model is the HKEVP, a named list with three elements:
</p>

<ul>
<li> <p><code>GEV</code>: A numerical matrix. Result of the function <code>FUN</code> for each GEV parameter (columns) and each site position (rows).
</p>
</li>
<li> <p><code>alpha</code>: A numerical value. Result of the function <code>FUN</code> on the Markov chain associated to the dependence parameter <code class="reqn">\alpha</code>.
</p>
</li>
<li> <p><code>tau</code>: A numerical value. Result of the function <code>FUN</code> on the Markov chain associated to the bandwidth parameter <code class="reqn">\tau</code>.
</p>
</li></ul>

<p>If fitted model is the latent variable model, the functions returns the <code>GEV</code> matrix only.
</p>


<h3>Author(s)</h3>

<p>Quentin Sebille
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulation of HKEVP:

sites &lt;- as.matrix(expand.grid(1:3,1:3))
knots &lt;- sites
loc &lt;- sites[,1]*10
scale &lt;- 3
shape &lt;- .2
alpha &lt;- .4
tau &lt;- 1
ysim &lt;- hkevp.rand(10, sites, knots, loc, scale, shape, alpha, tau)

# HKEVP fit:
fit &lt;- hkevp.fit(ysim, sites, niter = 1000)

# Posterior median and standard deviation:
# mcmc.fun(fit, median)
# mcmc.fun(fit, sd)



</code></pre>

<hr>
<h2 id='mcmc.plot'>Markov chains plotting</h2><span id='topic+mcmc.plot'></span>

<h3>Description</h3>

<p>Plots of the resulting Markov chains obtained by the MCMC procedures <code>hkevp.fit</code> or <code>latent.fit</code>. May be used to assess graphically convergence of the chains.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mcmc.plot(fit, plot.spatial, mfrow)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mcmc.plot_+3A_fit">fit</code></td>
<td>
<p>Output from the <code>hkevp.fit</code> procedure.</p>
</td></tr>
<tr><td><code id="mcmc.plot_+3A_plot.spatial">plot.spatial</code></td>
<td>
<p>Logical indicating if the Markov chains of the sills and ranges hyperparameters should be plotted. FALSE by default.</p>
</td></tr>
<tr><td><code id="mcmc.plot_+3A_mfrow">mfrow</code></td>
<td>
<p>Optional vector of two numerical values indicating the parameter of the window plotting called by the <code>plot(...)</code> function.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Quentin Sebille
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Simulation of HKEVP:
sites &lt;- as.matrix(expand.grid(1:3,1:3))
knots &lt;- sites
loc &lt;- sites[,1]*10
scale &lt;- 3
shape &lt;- .2
alpha &lt;- .4
tau &lt;- 1
ysim &lt;- hkevp.rand(10, sites, knots, loc, scale, shape, alpha, tau)

# HKEVP fit:
fit &lt;- hkevp.fit(ysim, sites, niter = 1000)

# Markov chains plot:
mcmc.plot(fit, TRUE)




</code></pre>

<hr>
<h2 id='return.level'>The associated return level</h2><span id='topic+return.level'></span>

<h3>Description</h3>

<p>Computation of the associated return level with given period and GEV parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>return.level(period, loc, scale, shape)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="return.level_+3A_period">period</code></td>
<td>
<p>An integer indicating the wished return period T.</p>
</td></tr>
<tr><td><code id="return.level_+3A_loc">loc</code></td>
<td>
<p>A numerical value or vector for the GEV location parameter. Must be of length one or same length as <code>scale</code> and/or <code>shape</code>.</p>
</td></tr>
<tr><td><code id="return.level_+3A_scale">scale</code></td>
<td>
<p>A numerical value or vector for the GEV scale parameter. Must be of length one or same length as <code>loc</code> and/or <code>shape</code>.</p>
</td></tr>
<tr><td><code id="return.level_+3A_shape">shape</code></td>
<td>
<p>A numerical value or vector for the GEV shape parameter. Must be of length one or same length as <code>loc</code> and/or <code>scale</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code class="reqn">T</code>-year return level is a common value of risk in Extreme Value Theory. It represents the value that is expected to be exceeded once over <code class="reqn">T</code> years by the annual maxima. Given the parameters <code class="reqn">\mu</code>, <code class="reqn">\sigma</code> and <code class="reqn">\xi</code> of the GEV distribution associated to the yearly maxima, we can compute the associated <code class="reqn">T</code>-return level <code class="reqn">y_T</code> by:
</p>
<p style="text-align: center;"><code class="reqn">y_T := \mu + \frac{\sigma}{\xi} \left[ \log\left(\frac{T}{T-1}\right)^{-\xi} -1 \right] ~.</code>
</p>



<h3>Value</h3>

<p>A numerical value or a numerical vector, depending on the input arguments <code>loc</code>, <code>scale</code>, <code>shape</code>
</p>


<h3>Author(s)</h3>

<p>Quentin Sebille
</p>


<h3>Examples</h3>

<pre><code class='language-R'>return.level(period = 100, loc = 1, scale = 1, shape = 1)
return.level(period = 200, loc = 1:10, scale = 1, shape = 0)


</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
