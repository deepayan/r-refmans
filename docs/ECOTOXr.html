<!DOCTYPE html><html><head><title>Help for package ECOTOXr</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ECOTOXr}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#build_ecotox_sqlite'><p>Build an SQLite database from zip archived tables downloaded from EPA website</p></a></li>
<li><a href='#cas'><p>Functions for handling chemical abstract service (CAS) registry numbers</p></a></li>
<li><a href='#check_ecotox_availability'><p>Check whether a ECOTOX database exists locally</p></a></li>
<li><a href='#check_ecotox_build'><p>Check the locally build database for validity</p></a></li>
<li><a href='#check_ecotox_version'><p>Check if the locally build database is up to date</p></a></li>
<li><a href='#cite_ecotox'><p>Cite the downloaded copy of the ECOTOX database</p></a></li>
<li><a href='#dbConnectEcotox'><p>Open or close a connection to the local ECOTOX database</p></a></li>
<li><a href='#download_ecotox_data'><p>Download and extract ECOTOX database files and compose database</p></a></li>
<li><a href='#ECOTOXr-package'><p>Package description</p></a></li>
<li><a href='#get_ecotox_info'><p>Get information on the local ECOTOX database when available</p></a></li>
<li><a href='#get_ecotox_sqlite_file'><p>The local path to the ECOTOX database (directory or sqlite file)</p></a></li>
<li><a href='#get_ecotox_url'><p>Get ECOTOX download URL from EPA website</p></a></li>
<li><a href='#list_ecotox_fields'><p>List the field names that are available from the ECOTOX database</p></a></li>
<li><a href='#search_ecotox'><p>Search and retrieve toxicity records from the database</p></a></li>
<li><a href='#websearch_comptox'><p>Search and retrieve substance information from <a href="https://comptox.epa.gov/dashboard">https://comptox.epa.gov/dashboard</a></p></a></li>
<li><a href='#websearch_ecotox'><p>Search and retrieve toxicity records from the on-line database</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Download and Extract Data from US EPA's ECOTOX Database</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.9</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-01-07</td>
</tr>
<tr>
<td>Author:</td>
<td>Pepijn de Vries <a href="https://orcid.org/0000-0002-7961-6646"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre, dtc]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Pepijn de Vries &lt;pepijn.devries@outlook.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>The US EPA ECOTOX database is a freely available database
    with a treasure of aquatic and terrestrial ecotoxicological data.
    As the online search interface doesn't come with an API, this
    package provides the means to easily access and search the database
    in R. To this end, all raw tables are downloaded from the EPA website
    and stored in a local SQLite database.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.1.0), RSQLite (&ge; 2.3.4)</td>
</tr>
<tr>
<td>Imports:</td>
<td>crayon (&ge; 1.5.2), dbplyr (&ge; 2.4.0), dplyr (&ge; 1.1.4), httr2
(&ge; 1.0.0), jsonlite (&ge; 1.8.8), lifecycle (&ge; 1.0.4), purrr
(&ge; 1.0.2), rappdirs (&ge; 0.3.3), readr (&ge; 2.1.4), readxl (&ge;
1.4.3), rlang (&ge; 1.1.2), rvest (&ge; 1.0.3), stringr (&ge; 1.5.1),
tibble (&ge; 3.2.1), tidyr (&ge; 1.3.0), tidyselect (&ge; 1.2.0),
utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>DBI, standartox, testthat (&ge; 3.0.0), webchem</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/pepijn-devries/ECOTOXr">https://github.com/pepijn-devries/ECOTOXr</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/pepijn-devries/ECOTOXr/issues">https://github.com/pepijn-devries/ECOTOXr/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-01-07 21:58:58 UTC; vries171</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-01-08 07:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='build_ecotox_sqlite'>Build an SQLite database from zip archived tables downloaded from EPA website</h2><span id='topic+build_ecotox_sqlite'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> This function is called automatically after <code><a href="#topic+download_ecotox_data">download_ecotox_data()</a></code>. The database
files can also be downloaded manually from the <a href="https://cfpub.epa.gov/ecotox/">EPA website</a> from which a local
database can be build using this function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>build_ecotox_sqlite(source, destination = get_ecotox_path(), write_log = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="build_ecotox_sqlite_+3A_source">source</code></td>
<td>
<p>A <code>character</code> string pointing to the directory path where the text files with the raw
tables are located. These can be obtained by extracting the zip archive from <a href="https://cfpub.epa.gov/ecotox/">https://cfpub.epa.gov/ecotox/</a>
and look for 'Download ASCII Data'.</p>
</td></tr>
<tr><td><code id="build_ecotox_sqlite_+3A_destination">destination</code></td>
<td>
<p>A <code>character</code> string representing the destination path for the SQLite file. By default
this is <code><a href="#topic+get_ecotox_path">get_ecotox_path()</a></code>.</p>
</td></tr>
<tr><td><code id="build_ecotox_sqlite_+3A_write_log">write_log</code></td>
<td>
<p>A <code>logical</code> value indicating whether a log file should be written in the destination path
<code>TRUE</code>. The log contains information on the source and destination path, the version of this package,
the creation date, and the operating system on which the database was created.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Raw data downloaded from the EPA website is in itself not very efficient to work with in R. The files are large
and would put a large strain on R when loading completely into the system's memory. Instead use this function
to build an SQLite database from the tables. That way, the data can be queried without having to load it all into
memory.
</p>
<p>EPA provides the raw table from the <a href="https://cfpub.epa.gov/ecotox/">ECOTOX database</a> as text files with
pipe-characters ('|') as table column separators. Although not documented, the tables appear not to contain comment
or quotation characters. There are records containing the reserved pipe-character that will confuse the table parser.
For these records, the pipe-character is replaced with a dash character ('-').
</p>
<p>In addition, while reading the tables as text files, this package attempts to decode the text as UTF8. Unfortunately,
this process appears to be platform-dependent, and may therefore result in different end-results on different platforms.
This problem only seems to occur for characters that are listed as 'control characters' under UTF8. This will have
consequences for reproducibility, but only if you build search queries that look for such special characters. It is
therefore advised to stick to common (non-accented) alpha-numerical characters in your searches, for the sake of
reproducibility.
</p>
<p>Use '<code><a href="base.html#topic+suppressMessages">suppressMessages()</a></code>' to suppress the progress report.
</p>


<h3>Value</h3>

<p>Returns <code>NULL</code> invisibly.
</p>


<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
## This example will only work properly if 'dir' points to an existing directory
## with the raw tables from the ECOTOX database. This function will be called
## automatically after a call to 'download_ecotox_data()'.
test &lt;- check_ecotox_availability()
if (test) {
  files   &lt;- attributes(test)$files[1,]
  dir     &lt;- gsub(".sqlite", "", files$database, fixed = T)
  path    &lt;- files$path
  if (dir.exists(file.path(path, dir))) {
    ## This will build the database in your temp directory:
    build_ecotox_sqlite(source = file.path(path, dir), destination = tempdir())
  }
}

## End(Not run)
</code></pre>

<hr>
<h2 id='cas'>Functions for handling chemical abstract service (CAS) registry numbers</h2><span id='topic+cas'></span><span id='topic+is.cas'></span><span id='topic+as.cas'></span><span id='topic++5B+5B.cas'></span><span id='topic++5B.cas'></span><span id='topic++5B+5B+3C-.cas'></span><span id='topic++5B+3C-.cas'></span><span id='topic+format.cas'></span><span id='topic+as.character.cas'></span><span id='topic+show.cas'></span><span id='topic+print.cas'></span><span id='topic+as.list.cas'></span><span id='topic+as.double.cas'></span><span id='topic+as.integer.cas'></span><span id='topic+c.cas'></span><span id='topic+as.data.frame.cas'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Functions for handling chemical abstract service (CAS) registry numbers
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cas(length = 0L)

is.cas(x)

as.cas(x)

## S3 method for class 'cas'
x[[i]]

## S3 method for class 'cas'
x[i]

## S3 replacement method for class 'cas'
x[[i]] &lt;- value

## S3 replacement method for class 'cas'
x[i] &lt;- value

## S3 method for class 'cas'
format(x, hyphenate = TRUE, ...)

## S3 method for class 'cas'
as.character(x, ...)

show.cas(x, ...)

## S3 method for class 'cas'
print(x, ...)

## S3 method for class 'cas'
as.list(x, ...)

## S3 method for class 'cas'
as.double(x, ...)

## S3 method for class 'cas'
as.integer(x, ...)

## S3 method for class 'cas'
c(...)

## S3 method for class 'cas'
as.data.frame(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cas_+3A_length">length</code></td>
<td>
<p>A non-negative <code>integer</code> specifying the desired length. Double values will be coerced to
<code>integer</code>: supplying an argument of length other than one is an error.</p>
</td></tr>
<tr><td><code id="cas_+3A_x">x</code></td>
<td>
<p>Object from which data needs to be extracted or replaced, or needs to be coerced into a specific
format. For nearly all of the functions documented here, this needs to be an object of the S3 class 'cas',
which can be created with <code>as.cas</code>. For <code>as.cas</code>, <code>x</code> can be a <code>character</code> (CAS registry number
with or without hyphenation) or a <code>numeric</code> value. Note that <code>as.cas</code> will only accept correctly
formatted and valid CAS registry numbers.</p>
</td></tr>
<tr><td><code id="cas_+3A_i">i</code></td>
<td>
<p>Index specifying element(s) to extract or replace. See also <code><a href="base.html#topic+Extract">base::Extract()</a></code>.</p>
</td></tr>
<tr><td><code id="cas_+3A_value">value</code></td>
<td>
<p>A replacement value, can be anything that can be converted into an S3 cas-class object with <code>as.cas</code>.</p>
</td></tr>
<tr><td><code id="cas_+3A_hyphenate">hyphenate</code></td>
<td>
<p>A <code>logical</code> value indicating whether the formatted CAS number needs to be hyphenated.
Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="cas_+3A_...">...</code></td>
<td>
<p>Arguments passed to other functions</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In the database <a href="https://en.wikipedia.org/wiki/Chemical_Abstracts_Service">CAS registry</a> numbers are stored
as text (type <code>character</code>). As CAS numbers can consist of a maximum of 10 digits (plus two hyphens) this means
that each CAS number can consume up to 12 bytes of memory or disk space. By storing the data numerically, only
5 bytes are required. These functions provide the means to handle CAS registry numbers and coerce from and to
different formats and types.
</p>


<h3>Value</h3>

<p>Functions <code>cas</code>, <code>c</code> and <code>as.cas</code> return S3 class 'cas' objects. Coercion functions
(starting with 'as') return the object as specified by their respective function names (i.e., <code>integer</code>,
<code>double</code>, <code>character</code>, <code>list</code> and <code>data.frame</code>). The <code>show.cas</code> and <code>print</code> functions
also return formatted <code>charater</code>s. The function <code>is.cas</code> will return a single <code>logical</code> value,
indicating whether <code>x</code> is a valid S3 cas-class object. The square brackets return the selected index/indices,
or the <code>vector</code> of cas objects where the selected elements are replaced by <code>value</code>.
</p>


<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## This will generate a vector of cas objects containing 10
## fictive (0-00-0), but valid registry numbers:
cas(10)

## This is a cas-object:
is.cas(cas(0L))

## This is not a cas-object:
is.cas(0L)

## Three different ways of creating a cas object from
## Benzene's CAS registry number (the result is the same)
as.cas("71-43-2")
as.cas("71432")
as.cas(71432L)

## This is one way of creating a vector with multiple CAS registry numbers:
cas_data &lt;- as.cas(c("64175", "71432", "58082"))

## This is how you select a specific element(s) from the vector:
cas_data[2:3]
cas_data[[2]]

## You can also replace specific elements in the vector:
cas_data[1] &lt;- "7440-23-5"
cas_data[[2]] &lt;- "129-00-0"

## You can format CAS numbers with or without hyphens:
format(cas_data, TRUE)
format(cas_data, FALSE)

## The same can be achieved using as.character
as.character(cas_data, TRUE)
as.character(cas_data, FALSE)

## There are also show and print methods available:
show(cas_data)
print(cas_data)

## Numeric values can be obtained from CAS using as.numeric, as.double or as.integer
as.numeric(cas_data)

## Be careful, however. Some CAS numbers cannot be represented by R's 32 bit integers
## and will produce NA's. This will work OK:
huge_cas &lt;- as.cas("9999999-99-5")

## Not run: 
## This will not:
as.integer(huge_cas)

## End(Not run)

## The trick applied by this package is that the final
## validation digit is stored separately as attribute:
unclass(huge_cas)

## This is how cas objects can be concatenated:
cas_data &lt;- c(huge_cas, cas_data)

## This will create a data.frame
as.data.frame(cas_data)

## This will create a list:
as.list(cas_data)
</code></pre>

<hr>
<h2 id='check_ecotox_availability'>Check whether a ECOTOX database exists locally</h2><span id='topic+check_ecotox_availability'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Tests whether a local copy of the US EPA ECOTOX database exists in
<code><a href="#topic+get_ecotox_path">get_ecotox_path()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_ecotox_availability(target = get_ecotox_path())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_ecotox_availability_+3A_target">target</code></td>
<td>
<p>A <code>character</code> string specifying the path where to look for the database file.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When arguments are omitted, this function will look in the default directory (<code><a href="#topic+get_ecotox_path">get_ecotox_path()</a></code>).
However, it is possible to build a database file elsewhere if necessary.
</p>


<h3>Value</h3>

<p>Returns a <code>logical</code> value indicating whether a copy of the database exists. It also returns
a <code>files</code> attribute that lists which copies of the database are found.
</p>


<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>Examples</h3>

<pre><code class='language-R'>check_ecotox_availability()
</code></pre>

<hr>
<h2 id='check_ecotox_build'>Check the locally build database for validity</h2><span id='topic+check_ecotox_build'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Performs some simple tests to check whether the
locally built database is not corrupted.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_ecotox_build(path = get_ecotox_path(), version, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_ecotox_build_+3A_path">path</code></td>
<td>
<p>A <code>character</code> string with the path to the location of the local database (default is
<code><a href="#topic+get_ecotox_path">get_ecotox_path()</a></code>).</p>
</td></tr>
<tr><td><code id="check_ecotox_build_+3A_version">version</code></td>
<td>
<p>A <code>character</code> string referring to the release version of the database you wish to locate.
It should have the same format as the date in the EPA download link, which is month, day, year, separated by
underscores (&quot;%m_%d_%Y&quot;). When missing, the most recent available copy is selected automatically.</p>
</td></tr>
<tr><td><code id="check_ecotox_build_+3A_...">...</code></td>
<td>
<p>Arguments that are passed to <code><a href="RSQLite.html#topic+SQLite">dbConnect()</a></code> method
or <code><a href="RSQLite.html#topic+SQLite">dbDisconnect()</a></code> method.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For now this function tests if all expected tables are present in the locally built
database. Note that in later release of the database some tables were added. Therefore
for older builds this function might return <code>FALSE</code> whereas it is actually just fine
(just out-dated).
</p>
<p>Furthermore, this function tests if all tables contain one or more records. Obviously,
this is no guarantee that the database is valid, but it is a start.
</p>
<p>More tests may be added in future releases.
</p>


<h3>Value</h3>

<p>Returns an indicative logical value whether the database is not corrupted.
<code>TRUE</code> indicates the database is most likely OK. <code>FALSE</code> indicates that something might
be wrong. Additional messages (when <code>FALSE</code>) are included as attributes containing hints
on the outcoming of the tests. See also the 'details' section.
</p>


<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
check_ecotox_build()

## End(Not run)
</code></pre>

<hr>
<h2 id='check_ecotox_version'>Check if the locally build database is up to date</h2><span id='topic+check_ecotox_version'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Checks the version of the database available on-line
from the EPA against the specified version (latest by default) of the database build
locally. Returns <code>TRUE</code> when they are the same.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_ecotox_version(path = get_ecotox_path(), version, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_ecotox_version_+3A_path">path</code></td>
<td>
<p>When you have a copy of the database somewhere other than the default
directory (<code><a href="#topic+get_ecotox_path">get_ecotox_path()</a></code>), you can provide the path here.</p>
</td></tr>
<tr><td><code id="check_ecotox_version_+3A_version">version</code></td>
<td>
<p>A <code>character</code> string referring to the release version of the database you wish to locate.
It should have the same format as the date in the EPA download link, which is month, day, year, separated by
underscores (&quot;%m_%d_%Y&quot;). When missing, the most recent available copy is selected automatically.</p>
</td></tr>
<tr><td><code id="check_ecotox_version_+3A_verbose">verbose</code></td>
<td>
<p>A <code>logical</code> value. If true messages are shown on the console reporting
on the check.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a <code>logical</code> value invisibly indicating whether the locally build
is up to date with the latest release by the EPA.
</p>


<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
check_ecotox_version()

## End(Not run)
</code></pre>

<hr>
<h2 id='cite_ecotox'>Cite the downloaded copy of the ECOTOX database</h2><span id='topic+cite_ecotox'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Cite the downloaded copy of the ECOTOX database and this package for reproducible results.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cite_ecotox(path = get_ecotox_path(), version)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cite_ecotox_+3A_path">path</code></td>
<td>
<p>A <code>character</code> string with the path to the location of the local database \(default is
<code><a href="#topic+get_ecotox_path">get_ecotox_path()</a></code>\).</p>
</td></tr>
<tr><td><code id="cite_ecotox_+3A_version">version</code></td>
<td>
<p>A <code>character</code> string referring to the release version of the database you wish to locate.
It should have the same format as the date in the EPA download link, which is month, day, year, separated by
underscores (&quot;%m_%d_%Y&quot;). When missing, the most recent available copy is selected automatically.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When you download a copy of the EPA ECOTOX database using <code><a href="#topic+download_ecotox_data">download_ecotox_data()</a></code>,
a BibTex file is stored that registers the database release version and the access (= download) date. Use this
function to obtain a citation to that specific download.
</p>
<p>In order for others to reproduce your results, it is key to cite the data source as accurately as possible.
</p>


<h3>Value</h3>

<p>Returns a <code>vector</code> of <code><a href="utils.html#topic+bibentry">bibentry()</a></code>'s, containing a reference to the downloaded database
and this package.
</p>


<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
## In order to cite downloaded database and this package:
cite_ecotox()

## End(Not run)
</code></pre>

<hr>
<h2 id='dbConnectEcotox'>Open or close a connection to the local ECOTOX database</h2><span id='topic+dbConnectEcotox'></span><span id='topic+dbDisconnectEcotox'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Wrappers for <code><a href="RSQLite.html#topic+SQLite">dbConnect()</a></code> and
<code><a href="RSQLite.html#topic+SQLite">dbDisconnect()</a></code> methods.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dbConnectEcotox(path = get_ecotox_path(), version, ...)

dbDisconnectEcotox(conn, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dbConnectEcotox_+3A_path">path</code></td>
<td>
<p>A <code>character</code> string with the path to the location of the local database (default is
<code><a href="#topic+get_ecotox_path">get_ecotox_path()</a></code>).</p>
</td></tr>
<tr><td><code id="dbConnectEcotox_+3A_version">version</code></td>
<td>
<p>A <code>character</code> string referring to the release version of the database you wish to locate.
It should have the same format as the date in the EPA download link, which is month, day, year, separated by
underscores (&quot;%m_%d_%Y&quot;). When missing, the most recent available copy is selected automatically.</p>
</td></tr>
<tr><td><code id="dbConnectEcotox_+3A_...">...</code></td>
<td>
<p>Arguments that are passed to <code><a href="RSQLite.html#topic+SQLite">dbConnect()</a></code> method
or <code><a href="RSQLite.html#topic+SQLite">dbDisconnect()</a></code> method.</p>
</td></tr>
<tr><td><code id="dbConnectEcotox_+3A_conn">conn</code></td>
<td>
<p>An open connection to the ECOTOX database that needs to be closed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Open or close a connection to the local ECOTOX database. These functions are only required when you want
to send custom queries to the database. For most searches the <code><a href="#topic+search_ecotox">search_ecotox()</a></code> function
will be adequate.
</p>


<h3>Value</h3>

<p>A database connection in the form of a <code><a href="DBI.html#topic+DBIConnection-class">DBI::DBIConnection-class()</a></code> object.
The object is tagged with: a time stamp; the package version used; and the
file path of the SQLite database used in the connection. These tags are added as attributes
to the object.
</p>


<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
## This will only work when a copy of the database exists:
con &lt;- dbConnectEcotox()

## check if the connection works by listing the tables in the database:
dbListTables(con)

## Let's be a good boy/girl and close the connection to the database when we're done:
dbDisconnectEcotox(con)

## End(Not run)
</code></pre>

<hr>
<h2 id='download_ecotox_data'>Download and extract ECOTOX database files and compose database</h2><span id='topic+download_ecotox_data'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> In order for this package to fully function, a local copy of the ECOTOX database
needs to be build. This function will download the required data and build the database.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>download_ecotox_data(
  target = get_ecotox_path(),
  write_log = TRUE,
  ask = TRUE,
  verify_ssl = getOption("ECOTOXr_verify_ssl"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="download_ecotox_data_+3A_target">target</code></td>
<td>
<p>Target directory where the files will be downloaded and the database compiled. Default is
<code><a href="#topic+get_ecotox_path">get_ecotox_path()</a></code>.</p>
</td></tr>
<tr><td><code id="download_ecotox_data_+3A_write_log">write_log</code></td>
<td>
<p>A <code>logical</code> value indicating whether a log file should be written to the target path
<code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="download_ecotox_data_+3A_ask">ask</code></td>
<td>
<p>There are several steps in which files are (potentially) overwritten or deleted. In those cases
the user is asked on the command line what to do in those cases. Set this parameter to <code>FALSE</code> in order
to continue without warning and asking.</p>
</td></tr>
<tr><td><code id="download_ecotox_data_+3A_verify_ssl">verify_ssl</code></td>
<td>
<p>When set to <code>FALSE</code> the SSL certificate of the host (EPA)
is not verified. Can also be set as option:
<code>options(ECOTOXr_verify_ssl = TRUE)</code>. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="download_ecotox_data_+3A_...">...</code></td>
<td>
<p>Arguments passed on to <code><a href="httr2.html#topic+req_options">httr2::req_options()</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function will attempt to find the latest download url for the ECOTOX database from the
<a href="https://cfpub.epa.gov/ecotox/index.cfm">EPA website</a> (see <code><a href="#topic+get_ecotox_url">get_ecotox_url()</a></code>).
When found it will attempt to download the zipped archive containing all required data. This data is then
extracted and a local copy of the database is build.
</p>
<p>Use '<code><a href="base.html#topic+suppressMessages">suppressMessages()</a></code>' to suppress the progress report.
</p>


<h3>Value</h3>

<p>Returns <code>NULL</code> invisibly.
</p>


<h3>Known issues</h3>

<p>On some machines this function fails to connect to the database download URL from the
<a href="https://cfpub.epa.gov/ecotox/index.cfm">EPA website</a> due to missing
SSL certificates. Unfortunately, there is no easy fix for this in this package. A work around is to download and
unzip the file manually using a different machine or browser that is less strict with SSL certificates. You can
then call <code><a href="#topic+build_ecotox_sqlite">build_ecotox_sqlite()</a></code> and point the <code>source</code> location to the manually extracted zip
archive. For this purpose <code><a href="#topic+get_ecotox_url">get_ecotox_url()</a></code> can be used. Alternatively, one could try to call <code><a href="#topic+download_ecotox_data">download_ecotox_data()</a></code>
by setting <code>verify_ssl = FALSE</code>; but only do so when you trust the download URL from <a href="#topic+get_ecotox_url">get_ecotox_URL()</a>.
</p>


<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
## This will download and build the database in your temp dir:
download_ecotox_data(tempdir())

## End(Not run)
</code></pre>

<hr>
<h2 id='ECOTOXr-package'>Package description</h2><span id='topic+ECOTOXr'></span><span id='topic+ECOTOXr-package'></span>

<h3>Description</h3>

<p>Everything you need to know when you start using the ECOTOXr package. <img src="../help/figures/logo.png" alt="logo.png" />
</p>


<h3>Details</h3>

<p>The ECOTOXr provides the means to efficiently search, extract and analyse US EPA
<a href="https://cfpub.epa.gov/ecotox/">ECOTOX</a> data, with a focus on reproducible results. Although the package
creator/maintainer is confident in the quality of this software, it is the end users sole responsibility to
assure the quality of his or her work while using this software. As per the provided license terms the package
maintainer is not liable for any damage resulting from its usage. That being said, below we present some tips
for generating reproducible results with this package.
</p>


<h3>How do I get started?</h3>

<p>Installing this package is only the first step to get things started. You need to perform the following steps
in order to use the package to its full capacity.
</p>

<ul>
<li><p> First download a copy of the complete EPA database. This can be done by calling <code><a href="#topic+download_ecotox_data">download_ecotox_data()</a></code>.
This may not always work on all machines as R does not always accept the website SSL certificate from the EPA.
In those cases the zipped archive with the database files can be downloaded manually with a different (more
forgiving) browser. The files from the zip archive can be extracted to a location of choice. Alternatively,
the user could try to use <code style="white-space: pre;">&#8288;[download_ecotox_data](ssl_verifypeer = 0L)&#8288;</code> when the download URL is trusted.
</p>
</li>
<li><p> Next, an SQLite database needs to be build from the downloaded files. This will be done automatically when
you used <code><a href="#topic+download_ecotox_data">download_ecotox_data()</a></code> in the previous step. When you have manually downloaded the files
you can call <code><a href="#topic+build_ecotox_sqlite">build_ecotox_sqlite()</a></code> to build the database locally.
</p>
</li>
<li><p> When the previous steps have been performed successfully, you can now search the database by calling
<code><a href="#topic+search_ecotox">search_ecotox()</a></code>. You can also use <code><a href="#topic+dbConnectEcotox">dbConnectEcotox()</a></code> to open a connection to the
database. You can query the database using this connection and any of the methods provided from the
<a href="DBI.html#topic+DBI-package">DBI</a> or <a href="RSQLite.html#topic+SQLite">RSQLite</a> packages.
</p>
</li></ul>



<h3>How do I obtain reproducible results?</h3>

<p>Each individual user is responsible for evaluating the reproducibility of his or her work. Although
this package offers instruments to achieve reproducibility, it is not guaranteed. In order to increase the
chances of generating reproducible results, one should adhere at least to the following rules:
</p>

<ul>
<li><p> Always use an official release from CRAN, and cite the version used in your analyses (<code>citation("ECOTOXr")</code>).
Different versions, may produce different end results (although we will strive for backward compatibility).
</p>
</li>
<li><p> Make sure you are working with a clean (unaltered) version of the database. When in doubt, download and build
a fresh copy of the database (<code><a href="#topic+download_ecotox_data">download_ecotox_data()</a></code>). Also cite the (release) version of the downloaded
database (<code><a href="#topic+cite_ecotox">cite_ecotox()</a></code>), and the system operating system in which the local database was build
<code><a href="#topic+get_ecotox_info">get_ecotox_info()</a></code>). Or, just make sure that you never modify the database (e.g., write data to it, delete
data from it, etc.)
</p>
</li>
<li><p> In order to avoid platform dependencies it is advised to only include non-accented alpha-numerical characters in
search terms. See also <a href="#topic+search_ecotox">search_ecotox</a> and <a href="#topic+build_ecotox_sqlite">build_ecotox_sqlite</a>.
</p>
</li>
<li><p> When trying to reproduce database extractions from earlier database releases, filter out additions after
that specific release. This can be done by adding output fields 'tests.modified_date', 'tests.created_date' and
'tests.published_date' to your search and compare those with the release date of the database you are trying to
reproduce results from.
</p>
</li></ul>



<h3>Why isn't the database included in the package?</h3>

<p>This package doesn't come bundled with a copy of the database which needs to be downloaded the first time the
package is used. Why is this? There are several reasons:
</p>

<ul>
<li><p> The database is maintained and updated by the US EPA. This process is and should be
outside the sphere of influence of the package maintainer.
</p>
</li>
<li><p> Packages on CRAN are not allowed to contain large amounts of data. Publication on CRAN is key to control
the quality of this package and therefore outweighs the convenience of having the data bundled with the package.
</p>
</li>
<li><p> The user has full control over the release version of the database that is being used.
</p>
</li></ul>



<h3>Why does this package promotes using a local copy of the ECOTOX database?</h3>

<p>Although this package offers experimental features for searching on-line, there are several reasons why we
opted for creating a local copy:
</p>

<ul>
<li><p> The user would be restricted to the search options provided on the website (<a href="https://cfpub.epa.gov/ecotox/">ECOTOX</a>).
</p>
</li>
<li><p> The on-line database doesn't come with an API that would allow for convenient interface. This is why
features implemented in this package are experimental.
</p>
</li>
<li><p> The user is not limited by an internet connection and its bandwidth.
</p>
</li>
<li><p> Not all database fields, and only a limited number of records, can be retrieved from the on-line interface.
</p>
</li></ul>



<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Pepijn de Vries <a href="mailto:pepijn.devries@outlook.com">pepijn.devries@outlook.com</a> (<a href="https://orcid.org/0000-0002-7961-6646">ORCID</a>) [data contributor]
</p>


<h3>References</h3>

<p>Official US EPA ECOTOX website:
<a href="https://cfpub.epa.gov/ecotox/">https://cfpub.epa.gov/ecotox/</a>
</p>
<p>Olker, J.H., Elonen, C.M., Pilli, A., Anderson, A., Kinziger, B., Erickson, S., Skopinski, M., Pomplun, A., LaLone, C.A.,
Russom, C.L. and Hoff, D. (2022), The ECOTOXicology Knowledgebase: A Curated Database of Ecologically Relevant Toxicity
Tests to Support Environmental Research and Risk Assessment. <em>Environ Toxicol Chem</em>, 41: 1520-1539.
</p>


<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/pepijn-devries/ECOTOXr">https://github.com/pepijn-devries/ECOTOXr</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/pepijn-devries/ECOTOXr/issues">https://github.com/pepijn-devries/ECOTOXr/issues</a>
</p>
</li></ul>


<hr>
<h2 id='get_ecotox_info'>Get information on the local ECOTOX database when available</h2><span id='topic+get_ecotox_info'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Get information on how and when the local ECOTOX database was build.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_ecotox_info(path = get_ecotox_path(), version)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_ecotox_info_+3A_path">path</code></td>
<td>
<p>A <code>character</code> string with the path to the location of the local database (default is
<code><a href="#topic+get_ecotox_path">get_ecotox_path()</a></code>).</p>
</td></tr>
<tr><td><code id="get_ecotox_info_+3A_version">version</code></td>
<td>
<p>A <code>character</code> string referring to the release version of the database you wish to locate.
It should have the same format as the date in the EPA download link, which is month, day, year, separated by
underscores (&quot;%m_%d_%Y&quot;). When missing, the most recent available copy is selected automatically.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Get information on how and when the local ECOTOX database was build. This information is retrieved
from the log-file that is (optionally) stored with the local database when calling <code><a href="#topic+download_ecotox_data">download_ecotox_data()</a></code>
or <code><a href="#topic+build_ecotox_sqlite">build_ecotox_sqlite()</a></code>.
</p>


<h3>Value</h3>

<p>Returns a <code>vector</code> of <code>character</code>s, containing a information on the selected local ECOTOX database.
</p>


<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
## Show info on the current database (only works when one is downloaded and build):
get_ecotox_info()

## End(Not run)
</code></pre>

<hr>
<h2 id='get_ecotox_sqlite_file'>The local path to the ECOTOX database (directory or sqlite file)</h2><span id='topic+get_ecotox_sqlite_file'></span><span id='topic+get_ecotox_path'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Obtain the local path to where the ECOTOX database is
(or will be) placed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_ecotox_sqlite_file(path = get_ecotox_path(), version)

get_ecotox_path()
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_ecotox_sqlite_file_+3A_path">path</code></td>
<td>
<p>When you have a copy of the database somewhere other than the default
directory (<code><a href="#topic+get_ecotox_path">get_ecotox_path()</a></code>), you can provide the path here.</p>
</td></tr>
<tr><td><code id="get_ecotox_sqlite_file_+3A_version">version</code></td>
<td>
<p>A <code>character</code> string referring to the release version of the database you wish to locate.
It should have the same format as the date in the EPA download link, which is month, day, year, separated by
underscores (&quot;%m_%d_%Y&quot;). When missing, the most recent available copy is selected automatically.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It can be useful to know where the database is located on your disk. This function
returns the location as provided by <code><a href="rappdirs.html#topic+app_dir">rappdirs::app_dir()</a></code>, or as
specified by you using <code>options(ECOTOXr_path = "mypath")</code>.
</p>


<h3>Value</h3>

<p>Returns a <code>character</code> string of the path.
<code>get_ecotox_path</code> will return the default directory of the database.
<code>get_ecotox_sqlite_file</code> will return the path to the sqlite file when it exists.
</p>


<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>Examples</h3>

<pre><code class='language-R'>get_ecotox_path()

## Not run: 
## This will only work if a local database exists:
get_ecotox_sqlite_file()

## End(Not run)
</code></pre>

<hr>
<h2 id='get_ecotox_url'>Get ECOTOX download URL from EPA website</h2><span id='topic+get_ecotox_url'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> This function downloads the webpage at <a href="https://cfpub.epa.gov/ecotox/index.cfm">https://cfpub.epa.gov/ecotox/index.cfm</a>. It then searches for the
download link for the complete ECOTOX database and extract its URL.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_ecotox_url(verify_ssl = getOption("ECOTOXr_verify_ssl"), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_ecotox_url_+3A_verify_ssl">verify_ssl</code></td>
<td>
<p>When set to <code>FALSE</code> the SSL certificate of the host (EPA)
is not verified. Can also be set as option:
<code>options(ECOTOXr_verify_ssl = TRUE)</code>. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="get_ecotox_url_+3A_...">...</code></td>
<td>
<p>arguments passed on to <code><a href="httr2.html#topic+req_options">httr2::req_options()</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is called by <code><a href="#topic+download_ecotox_data">download_ecotox_data()</a></code> which tries to download the file from the resulting
URL. On some machines this fails due to issues with the SSL certificate. The user can try to download the file
by using this URL in a different browser (or on a different machine). Alternatively, the user could try to use
<code style="white-space: pre;">&#8288;[download_ecotox_data](verify_ssl = FALE)&#8288;</code> when the download URL is trusted.
</p>


<h3>Value</h3>

<p>Returns a <code>character</code> string containing the download URL of the latest version of the EPA ECOTOX
database.
</p>


<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
get_ecotox_url()

## End(Not run)
</code></pre>

<hr>
<h2 id='list_ecotox_fields'>List the field names that are available from the ECOTOX database</h2><span id='topic+list_ecotox_fields'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> List the field names (table headers) that are available from the ECOTOX database
</p>


<h3>Usage</h3>

<pre><code class='language-R'>list_ecotox_fields(
  which = c("default", "extended", "full", "all"),
  include_table = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="list_ecotox_fields_+3A_which">which</code></td>
<td>
<p>A <code>character</code> string that specifies which fields to return. Can be any of:
'<code>default</code>': returns default output field names; '<code>all</code>': returns all fields;
'<code>extended</code>': returns all fields of the default tables; or
'<code>full</code>': returns all fields except those from tables 'chemical_carriers',
'media_characteristics', 'doses', 'dose_responses',
'dose_response_details', 'dose_response_links' and 'dose_stat_method_codes'.</p>
</td></tr>
<tr><td><code id="list_ecotox_fields_+3A_include_table">include_table</code></td>
<td>
<p>A <code>logical</code> value indicating whether the table name should be included
as prefix. Default is <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This can be useful when specifying a <code><a href="#topic+search_ecotox">search_ecotox()</a></code>, to identify which fields
are available from the database, for searching and output.
</p>
<p>Not that when requesting '<code>all</code>' fields, you will get all fields available from the
latest EPA release of the ECOTOX database. This means that not necessarily all
fields are available in your local build of the database.
</p>


<h3>Value</h3>

<p>Returns a <code>vector</code> of type <code>character</code> containing the field names from the ECOTOX database.
</p>


<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Fields that are included in search results by default:
list_ecotox_fields("default")

## All fields that are available from the ECOTOX database:
list_ecotox_fields("all")

## All except fields from the tables 'chemical_carriers', 'media_characteristics',
## 'doses', 'dose_responses', 'dose_response_details', 'dose_response_links' and
## 'dose_stat_method_codes' that are available from the ECOTOX database:
list_ecotox_fields("full")
</code></pre>

<hr>
<h2 id='search_ecotox'>Search and retrieve toxicity records from the database</h2><span id='topic+search_ecotox'></span><span id='topic+search_ecotox_lazy'></span><span id='topic+search_query_ecotox'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Create (and execute) an SQL search query based on basic search terms and
options. This allows you to search the database, without having to understand SQL.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>search_ecotox(
  search,
  output_fields = list_ecotox_fields("default"),
  group_by_results = TRUE,
  compute = FALSE,
  as_data_frame = TRUE,
  ...
)

search_ecotox_lazy(
  search,
  output_fields = list_ecotox_fields("default"),
  compute = FALSE,
  ...
)

search_query_ecotox(search, output_fields = list_ecotox_fields("default"), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="search_ecotox_+3A_search">search</code></td>
<td>
<p>A named <code>list</code> containing the search terms. The names of the elements should refer to
the field (i.e. table header) in which the terms are searched. Use <code><a href="#topic+list_ecotox_fields">list_ecotox_fields()</a></code> to
obtain a list of available field names.
</p>
<p>Each element in that list should contain another list with at least one element named 'terms'. This should
contain a <code>vector</code> of <code>character</code> strings with search terms. Optionally, a second element
named 'method' can be provided which should be set to either '<code>contains</code>' (default, when missing) or
'<code>exact</code>'. In the first case the query will match any record in the indicated field that contains
the search term. In case of '<code>exact</code>' it will only return exact matches. Note that searches are
not case sensitive, but are picky with special (accented) characters. While building the local database
(see <a href="#topic+build_ecotox_sqlite">build_ecotox_sqlite</a>) such special characters may be treated differently on different
operating systems. For the sake of reproducibility, the user is advised to stick with non-accented
alpha-numeric characters.
</p>
<p>Search terms for a specific field (table header) will be combined with 'or'. Meaning that any record that
matches any of the terms are returned. For instance when 'latin_name' 'Daphnia magna' and 'Skeletonema costatum'
are searched, results for both species are returned. Search terms across fields (table headers) are combined with
'and', which will narrow the search. For instance if 'chemical_name' 'benzene' is searched in combination
with 'latin_name' 'Daphnia magna', only tests where Daphnia magna are exposed to benzene are returned.
</p>
<p>When this search behaviour described above is not desirable, the user can either adjust the query manually,
or use this function to perform several separate searches and combine the results afterwards.
</p>
<p>Beware that some field names are ambiguous and occur in multiple tables (like <code style="white-space: pre;">&#8288;cas_number' and &#8288;</code>code').
When searching such fields, the search result may not be as expected.</p>
</td></tr>
<tr><td><code id="search_ecotox_+3A_output_fields">output_fields</code></td>
<td>
<p>A <code>vector</code> of <code>character</code> strings indicating which field names (table headers)
should be included in the output. By default <code style="white-space: pre;">&#8288;[list_ecotox_fields]("default")&#8288;</code> is used. Use
<code style="white-space: pre;">&#8288;[list_ecotox_fields]("all")&#8288;</code> to list all available fields.</p>
</td></tr>
<tr><td><code id="search_ecotox_+3A_group_by_results">group_by_results</code></td>
<td>
<p>Ecological test results are generally the most informative element in the ECOTOX
database. Therefore, this search function returns a table with unique results in each row.
</p>
<p>However, some tables in the database (such as 'chemical_carriers' and 'dose_responses') have a one to many
relationship with test results. This means that multiple chemical carriers can be linked to a single test result,
similarly, multiple doses can also be linked to a single test result.
</p>
<p>By default the search results are grouped by test results. As a result not all doses or chemical carriers may
be displayed in the output. Set the <code>group_by_results</code> parameter to <code>FALSE</code> in order to force SQLite
to output all data (e.g., all carriers). But beware that test results may be duplicated in those cases.</p>
</td></tr>
<tr><td><code id="search_ecotox_+3A_compute">compute</code></td>
<td>
<p>The ECOTOXr package tries to construct database queries as lazy as possible. Meaning that R
moves as much of the heavy lifting as possible to the database. When your search becomes complicated (e.g., when
including many output fields), you may run into trouble and hit the SQL parser limits. In those cases you can set
this parameter to <code>TRUE</code>. Database queries are then computed in the process of joining tables. This is generally
slower. Alternatively, you could try to include less output fields in order to simplify the query.</p>
</td></tr>
<tr><td><code id="search_ecotox_+3A_as_data_frame">as_data_frame</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a> <code>logical</code> value indicating whether the result should be
converted into a <code>data.frame</code> (default is <code>TRUE</code>). When set to <code>FALSE</code> the data will be returned as a <code><a href="dplyr.html#topic+reexports">tbl_df()</a></code>.</p>
</td></tr>
<tr><td><code id="search_ecotox_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code><a href="#topic+dbConnectEcotox">dbConnectEcotox()</a></code> and other functions. You can use this when the database
is not located at the default path (<code><a href="#topic+get_ecotox_path">get_ecotox_path()</a></code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The ECOTOX database is stored locally as an SQLite file, which can be queried with SQL. These functions
allow you to automatically generate an SQL query and send it to the database, without having to understand
SQL. The function <code>search_query_ecotox</code> generates and returns the SQL query (which can be edited by
hand if desired). You can also directly call <code>search_ecotox</code>, this will first generate the query,
send it to the database and retrieve the result.
</p>
<p>Although the generated query is not optimized for speed, it should be able to process most common searches
within an acceptable time. The time required for retrieving data from a search query depends on the complexity
of the query, the size of the query and the speed of your machine. Most queries should be completed within
seconds (or several minutes at most) on modern machines. If your search require optimisation for speed,
you could try reordering the search fields. You can also edit the query generated with <code>search_query_ecotox</code>
by hand and retrieve it with <code><a href="DBI.html#topic+dbGetQuery">DBI::dbGetQuery()</a></code>.
</p>
<p>Note that this package is actively maintained and this function may be revised in future versions.
In order to create reproducible results the user must: always work with an official release from
CRAN and document the package and database version that are used to generate specific results (see also
<code><a href="#topic+cite_ecotox">cite_ecotox()</a></code>).
</p>


<h3>Value</h3>

<p>In case of <code>search_query_ecotox</code>, a <code>character</code> string containing an SQL
query is returned. This query is built based on the provided search terms and options.
</p>
<p>In case of <code>search_ecotox</code> a <code>data.frame</code> is returned based on the search query built with
<code>search_query_ecotox</code>. The <code>data.frame</code> is unmodified as returned by SQLite, meaning that all
fields are returned as <code>character</code>s (even where the field types are 'date' or 'numeric').
</p>
<p>The results are tagged with: a time stamp; the package version used; and the
file path of the SQLite database used in the search (when applicable). These tags are added as attributes
to the output table or query.
</p>


<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>See Also</h3>

<p>Other search-functions: 
<code><a href="#topic+websearch_comptox">websearch_comptox</a>()</code>,
<code><a href="#topic+websearch_ecotox">websearch_ecotox</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
## let's find the ids of all ecotox tests on species
## where Latin names contain either of 2 specific genus names and
## where they were exposed to the chemical benzene
if (check_ecotox_availability()) {
  search &lt;-
    list(
      latin_name    = list(
        terms          = c("Skeletonema", "Daphnia"),
        method         = "contains"
      ),
      chemical_name = list(
        terms          = "benzene",
        method         = "exact"
      )
    )
  ## rows in result each represent a unique test id from the database
  result &lt;- search_ecotox(search)
  query  &lt;- search_query_ecotox(search)
  cat(query)
} else {
  print("Sorry, you need to use 'download_ecotox_data()' first in order for this to work.")
}

## End(Not run)
</code></pre>

<hr>
<h2 id='websearch_comptox'>Search and retrieve substance information from <a href="https://comptox.epa.gov/dashboard">https://comptox.epa.gov/dashboard</a></h2><span id='topic+websearch_comptox'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a> Search <a href="https://comptox.epa.gov/dashboard">https://comptox.epa.gov/dashboard</a> for substances and their chemico-physical properties
and meta-information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>websearch_comptox(
  searchItems,
  identifierTypes = c("chemical_name", "CASRN", "INCHIKEY", "dtxsid"),
  inputType = c("IDENTIFIER", "DTXCID", "INCHIKEY_SKELETON", "MSREADY_FORMULA",
    "EXACT_FORMULA", "MASS"),
  downloadItems = c("DTXCID", "CASRN", "INCHIKEY", "IUPAC_NAME", "SMILES",
    "INCHI_STRING", "MS_READY_SMILES", "QSAR_READY_SMILES", "MOLECULAR_FORMULA",
    "AVERAGE_MASS", "MONOISOTOPIC_MASS", "QC_LEVEL", "SAFETY_DATA", "EXPOCAST",
    "DATA_SOURCES", "TOXVAL_DATA", "NUMBER_OF_PUBMED_ARTICLES", "PUBCHEM_DATA_SOURCES",
    "CPDAT_COUNT", "IRIS_LINK", "PPRTV_LINK", "WIKIPEDIA_ARTICLE", "QC_NOTES",
    "ABSTRACT_SHIFTER", "TOXPRINT_FINGERPRINT", "ACTOR_REPORT", "SYNONYM_IDENTIFIER",
    "RELATED_RELATIONSHIP", "ASSOCIATED_TOXCAST_ASSAYS", 
     "TOXVAL_DETAILS",
    "CHEMICAL_PROPERTIES_DETAILS", "BIOCONCENTRATION_FACTOR_TEST_PRED",
    "BOILING_POINT_DEGC_TEST_PRED", "48HR_DAPHNIA_LC50_MOL/L_TEST_PRED",
    "DENSITY_G/CM^3_TEST_PRED", "DEVTOX_TEST_PRED",
    "96HR_FATHEAD_MINNOW_MOL/L_TEST_PRED", "FLASH_POINT_DEGC_TEST_PRED",
    "MELTING_POINT_DEGC_TEST_PRED", "AMES_MUTAGENICITY_TEST_PRED",
    "ORAL_RAT_LD50_MOL/KG_TEST_PRED", "SURFACE_TENSION_DYN/CM_TEST_PRED",
    "THERMAL_CONDUCTIVITY_MW/(M*K)_TEST_PRED",
    "TETRAHYMENA_PYRIFORMIS_IGC50_MOL/L_TEST_PRED", "VISCOSITY_CP_CP_TEST_PRED", 
    
    "VAPOR_PRESSURE_MMHG_TEST_PRED", "WATER_SOLUBILITY_MOL/L_TEST_PRED",
    "ATMOSPHERIC_HYDROXYLATION_RATE_(AOH)_CM3/MOLECULE*SEC_OPERA_PRED",
    "BIOCONCENTRATION_FACTOR_OPERA_PRED",
    "BIODEGRADATION_HALF_LIFE_DAYS_DAYS_OPERA_PRED", "BOILING_POINT_DEGC_OPERA_PRED",
    "HENRYS_LAW_ATM-M3/MOLE_OPERA_PRED", "OPERA_KM_DAYS_OPERA_PRED",
    "OCTANOL_AIR_PARTITION_COEFF_LOGKOA_OPERA_PRED",
    "SOIL_ADSORPTION_COEFFICIENT_KOC_L/KG_OPERA_PRED",
    "OCTANOL_WATER_PARTITION_LOGP_OPERA_PRED", "MELTING_POINT_DEGC_OPERA_PRED", 
    
    "OPERA_PKAA_OPERA_PRED", "OPERA_PKAB_OPERA_PRED", "VAPOR_PRESSURE_MMHG_OPERA_PRED",
    "WATER_SOLUBILITY_MOL/L_OPERA_PRED",
    "EXPOCAST_MEDIAN_EXPOSURE_PREDICTION_MG/KG-BW/DAY", "NHANES",
    "TOXCAST_NUMBER_OF_ASSAYS/TOTAL", "TOXCAST_PERCENT_ACTIVE"),
  massError = 0,
  timeout = 300,
  verify_ssl = getOption("ECOTOXr_verify_ssl"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="websearch_comptox_+3A_searchitems">searchItems</code></td>
<td>
<p>A <code>vector</code> of <code>character</code>s where each element is a substance descriptor (any of the selected <code>identifierType</code>s) you
wish to query.</p>
</td></tr>
<tr><td><code id="websearch_comptox_+3A_identifiertypes">identifierTypes</code></td>
<td>
<p>Substance identifiers for searching CompTox. Only used when <code>inputType</code> is set to <code>"IDENTIFIER"</code>.</p>
</td></tr>
<tr><td><code id="websearch_comptox_+3A_inputtype">inputType</code></td>
<td>
<p>Type of input used for searching CompTox. See usage section for valid entries.</p>
</td></tr>
<tr><td><code id="websearch_comptox_+3A_downloaditems">downloadItems</code></td>
<td>
<p>Output fields of CompTox data for requested substances</p>
</td></tr>
<tr><td><code id="websearch_comptox_+3A_masserror">massError</code></td>
<td>
<p>Error tolerance when searching for substances based on their monoisotopic mass. Only used for <code>inputType = "MASS"</code>.</p>
</td></tr>
<tr><td><code id="websearch_comptox_+3A_timeout">timeout</code></td>
<td>
<p>Time in seconds (default is 300 secs), that the routine will wait for the download link to get ready.
It will throw an error if it takes longer than the specified <code>timeout</code>.</p>
</td></tr>
<tr><td><code id="websearch_comptox_+3A_verify_ssl">verify_ssl</code></td>
<td>
<p>When set to <code>FALSE</code> the SSL certificate of the host (EPA)
is not verified. Can also be set as option:
<code>options(ECOTOXr_verify_ssl = TRUE)</code>. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="websearch_comptox_+3A_...">...</code></td>
<td>
<p>Arguments passed on to <code><a href="httr2.html#topic+req_options">httr2::req_options()</a></code> requests.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <a href="https://comptox.epa.gov/dashboard">CompTox Chemicals Dashboard</a> is a freely accessible on-line U.S. EPA database.
It contains information on physico-chemical properties, environmental fate and transport, exposure, usage, <em>in vivo</em> toxicity,
and <em>in vitro</em> bioassay of a wide range of substances.
</p>
<p>The function described here to search and retrieve records from the on-line database is experimental. This is because this feature is
not formally supported by the EPA, and it may break in future incarnations of the on-line database. The function forms an interface between
R and the <a href="https://comptox.epa.gov/dashboard">CompTox</a> website and is therefore limited by the restrictions documented there.
</p>


<h3>Value</h3>

<p>Returns a named <code>list</code> of <a href="dplyr.html#topic+reexports">dplyr::tibble</a>s containing the search results for the requested output tables and fields.
Results are unpolished and &lsquo;as is&rsquo; returned by EPA's web service.
</p>


<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>References</h3>

<p>Official US EPA CompTox website:
<a href="https://comptox.epa.gov/dashboard/">https://comptox.epa.gov/dashboard/</a>
</p>
<p>Williams, A.J., Grulke, C.M., Edwards, J., McEachran, A.D., Mansouri, K, Baker, N.C., Patlewicz, G., Shah, I.,
Wambaugh, J.F., Judson, R.S. &amp; Richard, A.M. (2017), The CompTox Chemistry Dashboard: a community data resource
for environmental chemistry. <em>J Cheminform</em>, 9(61) <a href="https://doi.org/10.1186/s13321-017-0247-6">doi:10.1186/s13321-017-0247-6</a>
</p>


<h3>See Also</h3>

<p>Other search-functions: 
<code><a href="#topic+search_ecotox">search_ecotox</a>()</code>,
<code><a href="#topic+websearch_ecotox">websearch_ecotox</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
## search for substance name 'benzene' and CAS registration number 108-88-3
## on https://comptox.epa.gov/dashboard:
comptox_results &lt;- websearch_comptox(c("benzene", "108-88-3"))

## search for substances with monoisotopic mass of 100+/-5:
comptox_results2 &lt;- websearch_comptox("100", inputType = "MASS", massError = 5)

## End(Not run)
</code></pre>

<hr>
<h2 id='websearch_ecotox'>Search and retrieve toxicity records from the on-line database</h2><span id='topic+websearch_ecotox'></span><span id='topic+list_ecotox_web_fields'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a> Functions to search and retrieve records from the on-line database at
<a href="https://cfpub.epa.gov/ecotox/search.cfm">https://cfpub.epa.gov/ecotox/search.cfm</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>websearch_ecotox(
  fields = list_ecotox_web_fields(),
  habitat = c("aquire", "terrestrial"),
  verify_ssl = getOption("ECOTOXr_verify_ssl"),
  ...
)

list_ecotox_web_fields(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="websearch_ecotox_+3A_fields">fields</code></td>
<td>
<p>A named <code>list</code> of <code>character</code>s, used to build a search for for the on-line search query of
<a href="https://cfpub.epa.gov/ecotox/search.cfm">https://cfpub.epa.gov/ecotox/search.cfm</a>.
Use <code><a href="#topic+list_ecotox_web_fields">list_ecotox_web_fields()</a></code> to construct a valid list.</p>
</td></tr>
<tr><td><code id="websearch_ecotox_+3A_habitat">habitat</code></td>
<td>
<p>Use <code>aquire</code> (default) to retrieve aquatic data, <code>terrestrial</code> for, you've guessed it, terrestrial data.</p>
</td></tr>
<tr><td><code id="websearch_ecotox_+3A_verify_ssl">verify_ssl</code></td>
<td>
<p>When set to <code>FALSE</code> the SSL certificate of the host (EPA)
is not verified. Can also be set as option:
<code>options(ECOTOXr_verify_ssl = TRUE)</code>. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="websearch_ecotox_+3A_...">...</code></td>
<td>
<p>In case of <code><a href="#topic+list_ecotox_web_fields">list_ecotox_web_fields()</a></code> the dots can be used as search field values used to update the returned list of fields.
</p>
<p>In case of <code><a href="#topic+websearch_ecotox">websearch_ecotox()</a></code> the dots can be used to pass custom options to the underlying <code><a href="httr2.html#topic+req_options">httr2::req_options()</a></code> call. For available
field names, use <code>names(list_ecotox_web_fields())</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The functions described here to search and retrieve records from the on-line database are experimental. This is because this feature is
not formally supported by the EPA, and it may break in future iterations of the on-line database. The functions form an interface between
R and the ECOTOX website and is therefore limited by its restrictions as described in the package documentation: <a href="#topic+ECOTOXr">ECOTOXr</a>. The
functions should therefore be used with caution.
</p>


<h3>Value</h3>

<p>Returns named <code>list</code> of <a href="dplyr.html#topic+reexports">dplyr::tibble</a>s with search results. Results are unpolished and &lsquo;as is&rsquo; returned by EPA's web service.
</p>
<p><code><a href="#topic+list_ecotox_web_fields">list_ecotox_web_fields()</a></code> returns a named list with fields that can be used in a web search of EPA's ECOTOX database, using
<code><a href="#topic+websearch_ecotox">websearch_ecotox()</a></code>.
</p>


<h3>Note</h3>

<p><strong>IMPORTANT:</strong> when you plan to perform multiple adjacent searches (for instance in a loop), please insert a call to <code><a href="base.html#topic+Sys.sleep">Sys.sleep()</a></code>.
This to avoid overloading the server and getting your IP address banned from the server.
</p>


<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>See Also</h3>

<p>Other search-functions: 
<code><a href="#topic+search_ecotox">search_ecotox</a>()</code>,
<code><a href="#topic+websearch_comptox">websearch_comptox</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
search_fields &lt;-
  list_ecotox_web_fields(
    txAdvancedSpecEntries     = "daphnia magna",
    RBSPECSEARCHTYPE          = "EXACT",
    txAdvancedChemicalEntries = "benzene",
    RBCHEMSEARCHTYPE          = "EXACT")
search_results &lt;- websearch_ecotox(search_fields)

## End(Not run)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
