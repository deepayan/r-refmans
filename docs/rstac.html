<!DOCTYPE html><html><head><title>Help for package rstac</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {rstac}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#assets_functions'><p>Assets functions</p></a></li>
<li><a href='#collections'><p>Endpoint functions</p></a></li>
<li><a href='#conformance'><p>doc_conformance endpoint</p></a></li>
<li><a href='#cql2_helpers'><p>CQL2 helper function</p></a></li>
<li><a href='#ext_filter'><p>Filter extension</p></a></li>
<li><a href='#ext_query'><p>Query extension</p></a></li>
<li><a href='#extensions'><p>Extension development functions</p></a></li>
<li><a href='#get_request'><p>STAC API request functions</p></a></li>
<li><a href='#items'><p>Endpoint functions</p></a></li>
<li><a href='#items_functions'><p>Items functions</p></a></li>
<li><a href='#items_sign_bdc'><p>Signature in hrefs provided by the STAC from the Brazil Data Cube</p>
project.</a></li>
<li><a href='#items_sign_planetary_computer'><p>Signs URL to access assets from Microsoft's Planetary Computer.</p></a></li>
<li><a href='#preview_plot'><p>Plot preview images</p></a></li>
<li><a href='#print'><p>Printing functions</p></a></li>
<li><a href='#queryables'><p>Endpoint functions</p></a></li>
<li><a href='#reexports'><p>Objects exported from other packages</p></a></li>
<li><a href='#rstac'><p>R client library for STAC (rstac)</p></a></li>
<li><a href='#stac'><p>Endpoint functions</p></a></li>
<li><a href='#stac_functions'><p>Utility functions</p></a></li>
<li><a href='#stac_search'><p>Endpoint functions</p></a></li>
<li><a href='#static_functions'><p>Static functions</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Client Library for SpatioTemporal Asset Catalog</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides functions to access, search and download spacetime earth
    observation data via SpatioTemporal Asset Catalog (STAC). This package 
    supports the version 1.0.0 (and older) of the STAC specification
    (<a href="https://github.com/radiantearth/stac-spec">https://github.com/radiantearth/stac-spec</a>). 
    For further details see Simoes et al. (2021) &lt;<a href="https://doi.org/10.1109%2FIGARSS47720.2021.9553518">doi:10.1109/IGARSS47720.2021.9553518</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://brazil-data-cube.github.io/rstac/">https://brazil-data-cube.github.io/rstac/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/brazil-data-cube/rstac/issues">https://github.com/brazil-data-cube/rstac/issues</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5)</td>
</tr>
<tr>
<td>Imports:</td>
<td>utils, httr, jsonlite, crayon, sf, png, jpeg, grid, magrittr</td>
</tr>
<tr>
<td>Suggests:</td>
<td>lifecycle, testthat, knitr</td>
</tr>
<tr>
<td>Collate:</td>
<td>'cql2-expr-funs.R' 'cql2-types.R' 'parse-utils.R'
'cql2-core.R' 'cql2-json.R' 'cql2-text.R' 'cql2-adv_comp.R'
'cql2-funs.R' 'cql2-env.R' 'cql2-utils.R' 'assets-utils.R'
'assets-funs.R' 'check-utils.R' 'conformance-query.R'
'collections-query.R' 'deprec-funs.R' 'doc-funs.R'
'ext_filter.R' 'ext_query.R' 'extensions.R' 'geom-funs.R'
'items-funs.R' 'items-utils.R' 'items-query.R'
'message-utils.R' 'preview-utils.R' 'print.R' 'query-funs.R'
'queryables-query.R' 'request.R' 'signatures.R' 'stac-query.R'
'search-query.R' 'stac-funs.R' 'static-funs.R' 'url-utils.R'
'utils.R' 'rstac.R' 'rstac-funs.R'</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-02-14 14:54:48 UTC; rolf</td>
</tr>
<tr>
<td>Author:</td>
<td>Rolf Simoes [aut],
  Felipe Carvalho [aut, cre],
  Brazil Data Cube Team [aut],
  National Institute for Space Research (INPE) [cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Felipe Carvalho &lt;lipecaso@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-02-14 21:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='assets_functions'>Assets functions</h2><span id='topic+assets_functions'></span><span id='topic+assets_download'></span><span id='topic+assets_download.doc_item'></span><span id='topic+assets_download.doc_items'></span><span id='topic+assets_download.default'></span><span id='topic+assets_url'></span><span id='topic+assets_url.doc_item'></span><span id='topic+assets_url.doc_items'></span><span id='topic+assets_url.default'></span><span id='topic+assets_select'></span><span id='topic+assets_select.doc_item'></span><span id='topic+assets_select.doc_items'></span><span id='topic+assets_select.default'></span><span id='topic+assets_rename'></span><span id='topic+assets_rename.doc_item'></span><span id='topic+assets_rename.doc_items'></span><span id='topic+assets_rename.default'></span><span id='topic+has_assets'></span><span id='topic+has_assets.doc_item'></span><span id='topic+has_assets.doc_items'></span><span id='topic+has_assets.default'></span><span id='topic+asset_key'></span><span id='topic+asset_eo_bands'></span><span id='topic+asset_raster_bands'></span>

<h3>Description</h3>

<p>These functions provide support to work with <code>doc_items</code> and
<code>doc_item</code> item objects.
</p>

<ul>
<li> <p><code>assets_download()</code>: Downloads the assets provided by the STAC API.
</p>
</li>
<li> <p><code>assets_url()</code>: <a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a> Returns a
character vector with each asset href. For the URL, you can add the
GDAL library drivers for the following schemes: HTTP/HTTPS files,
S3 (AWS S3) and GS (Google Cloud Storage).
</p>
</li>
<li> <p><code>assets_select()</code>: <a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a> Selects the
assets of each item by its name (<code>asset_names</code> parameter), by expressions
(<code>...</code> parameter), or by a selection function (<code>select_fn</code> parameter).
Note: This function can produce items with empty assets. In this case,
users can use the <code>items_compact()</code> function to remove items with no
assets.
</p>
</li>
<li> <p><code>assets_rename()</code>: <a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a> Rename each
asset using a named list or a function.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>assets_download(
  items,
  asset_names = NULL,
  output_dir = getwd(),
  overwrite = FALSE,
  ...,
  download_fn = NULL
)

## S3 method for class 'doc_item'
assets_download(
  items,
  asset_names = NULL,
  output_dir = getwd(),
  overwrite = FALSE,
  ...,
  create_json = FALSE,
  download_fn = NULL
)

## S3 method for class 'doc_items'
assets_download(
  items,
  asset_names = NULL,
  output_dir = getwd(),
  overwrite = FALSE,
  ...,
  download_fn = NULL,
  create_json = TRUE,
  items_max = Inf,
  progress = TRUE
)

## Default S3 method:
assets_download(
  items,
  asset_names = NULL,
  output_dir = getwd(),
  overwrite = FALSE,
  ...,
  create_json = FALSE,
  download_fn = NULL
)

assets_url(items, asset_names = NULL, append_gdalvsi = FALSE)

## S3 method for class 'doc_item'
assets_url(items, asset_names = NULL, append_gdalvsi = FALSE)

## S3 method for class 'doc_items'
assets_url(items, asset_names = NULL, append_gdalvsi = FALSE)

## Default S3 method:
assets_url(items, asset_names = NULL, append_gdalvsi = FALSE)

assets_select(items, ..., asset_names = NULL, select_fn = NULL)

## S3 method for class 'doc_item'
assets_select(items, ..., asset_names = NULL, select_fn = NULL)

## S3 method for class 'doc_items'
assets_select(items, ..., asset_names = NULL, select_fn = NULL)

## Default S3 method:
assets_select(items, ..., asset_names = NULL, select_fn = NULL)

assets_rename(items, mapper = NULL, ...)

## S3 method for class 'doc_item'
assets_rename(items, mapper = NULL, ...)

## S3 method for class 'doc_items'
assets_rename(items, mapper = NULL, ...)

## Default S3 method:
assets_rename(items, mapper = NULL, ...)

has_assets(items)

## S3 method for class 'doc_item'
has_assets(items)

## S3 method for class 'doc_items'
has_assets(items)

## Default S3 method:
has_assets(items)

asset_key()

asset_eo_bands(field)

asset_raster_bands(field)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="assets_functions_+3A_items">items</code></td>
<td>
<p>a <code>doc_item</code> or <code>doc_items</code> object
representing the result of <code style="white-space: pre;">&#8288;/stac/search&#8288;</code>,
<code>/collections/{collectionId}/items</code> or
<code>/collections/{collectionId}/items/{itemId}</code> endpoints.</p>
</td></tr>
<tr><td><code id="assets_functions_+3A_asset_names">asset_names</code></td>
<td>
<p>a <code>character</code> vector with the names of the assets
to be selected.</p>
</td></tr>
<tr><td><code id="assets_functions_+3A_output_dir">output_dir</code></td>
<td>
<p>a <code>character</code> directory in which the assets will be
saved. Default is the working directory (<code>getwd()</code>)</p>
</td></tr>
<tr><td><code id="assets_functions_+3A_overwrite">overwrite</code></td>
<td>
<p>a <code>logical</code> if TRUE will replace the existing file,
if FALSE, a warning message is shown.</p>
</td></tr>
<tr><td><code id="assets_functions_+3A_...">...</code></td>
<td>
<p>additional arguments. See details.</p>
</td></tr>
<tr><td><code id="assets_functions_+3A_download_fn">download_fn</code></td>
<td>
<p>a <code>function</code> to handle download of assets for
each item to be downloaded. Using this function, you can change the
hrefs for each asset, as well as the way download is done.</p>
</td></tr>
<tr><td><code id="assets_functions_+3A_create_json">create_json</code></td>
<td>
<p>a <code>logical</code> indicating if a JSON file with item
metadata (<code>doc_item</code> or <code>doc_items</code>) must be created in the
output directory.</p>
</td></tr>
<tr><td><code id="assets_functions_+3A_items_max">items_max</code></td>
<td>
<p>a <code>numeric</code> corresponding to how many items will be
downloaded.</p>
</td></tr>
<tr><td><code id="assets_functions_+3A_progress">progress</code></td>
<td>
<p>a <code>logical</code> indicating if a progress bar must be
shown or not. Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="assets_functions_+3A_append_gdalvsi">append_gdalvsi</code></td>
<td>
<p>a <code>logical</code> value. If true, gdal drivers are
included in the URL of each asset. The following schemes are supported:
HTTP/HTTPS files, S3 (AWS S3) and GS (Google Cloud Storage).</p>
</td></tr>
<tr><td><code id="assets_functions_+3A_select_fn">select_fn</code></td>
<td>
<p>a <code>function</code> to select assets an item
(<code>doc_item</code> or <code>doc_items</code>). This function receives as parameter
the asset element and, optionally, the asset name. Asset elements
contain metadata describing spatial-temporal objects. Users can provide
a function to select assets based on this metadata by returning a
logical value where <code>TRUE</code> selects the asset, and <code>FALSE</code> discards it.</p>
</td></tr>
<tr><td><code id="assets_functions_+3A_mapper">mapper</code></td>
<td>
<p>either a named <code>list</code> or a <code>function</code> to rename assets
of an item (<code>doc_item</code> or <code>doc_items</code>). In the case of a named
list, use <code style="white-space: pre;">&#8288;&lt;old name&gt; = &lt;new name&gt;&#8288;</code> to rename the assets. The function
can be used to rename the assets by returning a <code>character</code> string using
the metadata contained in the asset object.</p>
</td></tr>
<tr><td><code id="assets_functions_+3A_field">field</code></td>
<td>
<p>a <code>character</code> with the name of the asset field to
return.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Ellipsis argument (<code>...</code>) appears in different assets functions and
has distinct purposes:
</p>

<ul>
<li> <p><code>assets_download()</code>: ellipsis is used to pass
additional <code>httr</code> options to <a href="httr.html#topic+GET">GET</a> or <a href="httr.html#topic+POST">POST</a>
methods, such as <a href="httr.html#topic+add_headers">add_headers</a> or
<a href="httr.html#topic+set_cookies">set_cookies</a>.
</p>
</li>
<li> <p><code>assets_select()</code>: ellipsis is used to pass expressions that will
be evaluated against each asset metadata. Expressions must be evaluated as
a logical value where <code>TRUE</code> selects the asset and <code>FALSE</code> discards it.
Multiple expressions are combine with <code>AND</code> operator. Expressions can
use <code>asset</code> helper functions (i.e. <code>asset_key()</code>, <code>asset_eo_bands()</code>,
and <code>asset_raster_bands()</code>). Multiple expressions are combined with
<code>AND</code> operator.
</p>
<p><strong>WARNING:</strong> Errors in the evaluation of expressions are
considered as <code>FALSE</code>.
</p>
</li>
<li> <p><code>assets_rename()</code>: ellipsis is used to pass named parameters
to be processed in the same way as the named list in <code>mapper</code> argument.
</p>
</li></ul>



<h3>Value</h3>


<ul>
<li> <p><code>assets_download()</code>: returns the same input object item
(<code>doc_item</code> or <code>doc_items</code>) where <code>href</code> properties point to
the download assets.
</p>
</li>
<li> <p><code>assets_url()</code>: returns a character vector with all assets <code>href</code>
of an item (<code>doc_item</code> or <code>doc_items</code>).
</p>
</li>
<li> <p><code>assets_select()</code>: returns the same input object item
(<code>doc_item</code> or <code>doc_items</code>) with the selected assets.
</p>
</li>
<li> <p><code>assets_rename()</code>: returns the same input object item
(<code>doc_items</code> or <code>doc_item</code>) with the assets renamed.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+stac_search">stac_search()</a></code>, <code><a href="#topic+items">items()</a></code>, <code><a href="#topic+get_request">get_request()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
 # assets_download function
 stac("https://brazildatacube.dpi.inpe.br/stac/") %&gt;%
   stac_search(collections = "CB4-16D-2",
               datetime = "2019-06-01/2019-08-01") %&gt;%
   stac_search() %&gt;%
   get_request() %&gt;%
   assets_download(asset_names = "thumbnail", output_dir = tempdir())

## End(Not run)

## Not run: 
 # assets_url function
 stac_item &lt;- stac("https://brazildatacube.dpi.inpe.br/stac/") %&gt;%
  stac_search(collections = "CB4-16D-2", limit = 100,
         datetime = "2017-08-01/2018-03-01",
         bbox = c(-48.206,-14.195,-45.067,-12.272)) %&gt;%
  get_request() %&gt;% items_fetch(progress = FALSE)

 stac_item %&gt;% assets_url()

## End(Not run)

## Not run: 
 # assets_select function
 stac_item &lt;- stac("https://brazildatacube.dpi.inpe.br/stac/") %&gt;%
  stac_search(collections = "CB4-16D-2", limit = 100,
         datetime = "2017-08-01/2018-03-01",
         bbox = c(-48.206,-14.195,-45.067,-12.272)) %&gt;%
  get_request() %&gt;% items_fetch(progress = FALSE)

 stac_item %&gt;% assets_select(asset_names = "NDVI")

## End(Not run)

## Not run: 
items &lt;- stac("https://planetarycomputer.microsoft.com/api/stac/v1") %&gt;%
  stac_search(collections = c("landsat-8-c2-l2", "sentinel-2-l2a"),
              bbox = c(xmin = -64.85976089, ymin = -10.49199395,
                       xmax = -64.79272527, ymax =-10.44736091),
              datetime = "2019-01-01/2019-06-28",
              limit = 50) %&gt;%
  post_request()

# Selects assets by name
items &lt;- assets_select(items,
                       asset_names = c("B02", "B03", "SR_B1", "SR_B2"))
# Renames the landsat assets
items &lt;- assets_rename(items,
                       SR_B1 = "blue",
                       SR_B2 = "green",
                       B02   = "blue",
                       B03   = "green")
# Get the assets url's
assets_url(items)

## End(Not run)

</code></pre>

<hr>
<h2 id='collections'>Endpoint functions</h2><span id='topic+collections'></span>

<h3>Description</h3>

<p>The <code>collections</code> function implements the WFS3 <code style="white-space: pre;">&#8288;/collections&#8288;</code>
and <code>/collections/{collectionId}</code> endpoints.
</p>
<p>Each endpoint retrieves specific STAC objects:
</p>

<ul>
<li> <p><code style="white-space: pre;">&#8288;/collections&#8288;</code>: Returns a list of STAC Collections published in
the STAC service
</p>
</li>
<li> <p><code>/collections/{collectionId}</code>: Returns a single STAC
Collection object
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>collections(q, collection_id = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="collections_+3A_q">q</code></td>
<td>
<p>a <code>rstac_query</code> object expressing a STAC query
criteria.</p>
</td></tr>
<tr><td><code id="collections_+3A_collection_id">collection_id</code></td>
<td>
<p>a <code>character</code> collection id to be retrieved.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>rstac_query</code> object with the subclass <code>collections</code> for
<code style="white-space: pre;">&#8288;/collections/&#8288;</code> endpoint, or a <code>collection_id</code> subclass for
<code>/collections/{collection_id}</code> endpoint, containing all search field
parameters to be provided to STAC API web service.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_request">get_request()</a></code>, <code><a href="#topic+post_request">post_request()</a></code>, <code><a href="#topic+items">items()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
 stac("https://brazildatacube.dpi.inpe.br/stac/") %&gt;%
   collections() %&gt;%
   get_request()

 stac("https://brazildatacube.dpi.inpe.br/stac/") %&gt;%
   collections(collection_id = "CB4-16D-2") %&gt;%
   get_request()

## End(Not run)

</code></pre>

<hr>
<h2 id='conformance'>doc_conformance endpoint</h2><span id='topic+conformance'></span>

<h3>Description</h3>

<p>The conformance endpoint provides the capabilities of
the service.
This endpoint is accessible from the provider's catalog (<code style="white-space: pre;">&#8288;/conformance&#8288;</code>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>conformance(q)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="conformance_+3A_q">q</code></td>
<td>
<p>a <code>rstac_query</code> object expressing a STAC query criteria.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>rstac_query</code> object with the subclass <code>conformance</code> for <code style="white-space: pre;">&#8288;/conformance&#8288;</code>
endpoint.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_request">get_request()</a></code>,  <code><a href="#topic+stac">stac()</a></code>, <code><a href="#topic+collections">collections()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
stac("https://planetarycomputer.microsoft.com/api/stac/v1") %&gt;%
  conformance() %&gt;% get_request()

## End(Not run)

</code></pre>

<hr>
<h2 id='cql2_helpers'>CQL2 helper function</h2><span id='topic+cql2_helpers'></span><span id='topic+cql2_bbox_as_geojson'></span><span id='topic+cql2_date'></span><span id='topic+cql2_timestamp'></span><span id='topic+cql2_interval'></span>

<h3>Description</h3>

<p>These are helper functions to easy construction CQL2 expressions.
These functions are not meant to be used in expressions and they must
be escaped using <code style="white-space: pre;">&#8288;{{&#8288;</code> to be evaluated before request.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cql2_bbox_as_geojson(bbox)

cql2_date(x)

cql2_timestamp(x)

cql2_interval(start = "..", end = "..")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cql2_helpers_+3A_bbox">bbox</code></td>
<td>
<p>a <code>numeric</code> containing a bbox with
c(xmin, ymin, xmax, ymax).</p>
</td></tr>
<tr><td><code id="cql2_helpers_+3A_x">x</code>, <code id="cql2_helpers_+3A_start">start</code>, <code id="cql2_helpers_+3A_end">end</code></td>
<td>
<p>a <code>character</code> string containing valid <code>date</code> or
<code>timestamp</code>.</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li> <p><code>cql2_bbox_as_geojson()</code>: used to convert bounding box (bbox) to a
GeoJSON object to be used as argument of CQL2 spatial operators.
</p>
</li>
<li> <p><code>cql2_date()</code>, <code>cql2_timestamp()</code>, and <code>cql2_interval()</code>:
create temporal literal values to be passed into CQL2 expressions.
</p>
</li></ul>



<h3>Value</h3>


<ul>
<li> <p><code>cql2_bbox_as_geojson()</code>: GeoJSON object.
</p>
</li>
<li> <p><code>cql2_date()</code>, <code>cql2_timestamp()</code>, and <code>cql2_interval()</code>:
internal <code>rstac</code> expressions representing temporal values.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
bbox &lt;- c(-122.2751, 47.5469, -121.9613, 47.7458)

cql2_json(
    collection == "landsat-c2-l2" &amp;&amp;
      t_intersects(datetime, {{
        cql2_interval("2020-12-01", "2020-12-31")
      }}) &amp;&amp;
      s_intersects(geometry, {{
        cql2_bbox_as_geojson(bbox)
      }})
  )

## End(Not run)

</code></pre>

<hr>
<h2 id='ext_filter'>Filter extension</h2><span id='topic+ext_filter'></span><span id='topic+cql2_json'></span><span id='topic+cql2_text'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
<code>ext_filter()</code> implements Common Query Language (CQL2) filter extension
on <code>rstac</code>. This extension expands the filter capabilities providing a
query language to construct more complex expressions. CQL2 is an OGC
standard and defines how filters can be constructed. It supports predicates
for standard data types like strings, numbers, and boolean as well as
for spatial geometries (point, lines, polygons) and temporal
data (instants and intervals).
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
<code>cql2_json()</code> and <code>cql2_text()</code> are helper functions that can be used
to show how expressions are converted into CQL2 standard, either
JSON or TEXT formats.
</p>
<p><code>rstac</code> translates R expressions to CQL2, allowing users to express their
filter criteria using R language. For more details on how to create
CQL2 expressions in <code>rstac</code>. See the details section.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ext_filter(q, expr, lang = NULL, crs = NULL)

cql2_json(expr)

cql2_text(expr)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ext_filter_+3A_q">q</code></td>
<td>
<p>a <code>rstac_query</code> object expressing a STAC query
criteria.</p>
</td></tr>
<tr><td><code id="ext_filter_+3A_expr">expr</code></td>
<td>
<p>a valid R expression to be translated to CQL2 (see details).</p>
</td></tr>
<tr><td><code id="ext_filter_+3A_lang">lang</code></td>
<td>
<p>a character value indicating which CQL2 representation
to be used. It can be either <code>"cql2-text"</code> (for plain text) or
<code>"cql2-json"</code> (for JSON format). If <code>NULL</code> (default), <code>"cql2-text"</code> is
used for HTTP <code>GET</code> requests and <code>"cql2-json"</code> for <code>POST</code> requests.</p>
</td></tr>
<tr><td><code id="ext_filter_+3A_crs">crs</code></td>
<td>
<p>an optional character value informing the coordinate reference
system used by geometry objects. If <code>NULL</code> (default), STAC services assume
<code>"WGS 84"</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>To allow users to express filter criteria in R language, <code>rstac</code> takes
advantage of the abstract syntax tree (AST) to translate R expressions
to CQL2 expressions. The following topics describe the correspondences
between <code>rstac</code> expressions and CQL2 operators.
</p>


<h4>Standard comparison operators</h4>


<ul>
<li> <p><code>==</code>, <code>&gt;=</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&lt;</code>, and <code>!=</code> operators correspond to
<code>=</code>, <code>&gt;=</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&lt;</code>, and <code style="white-space: pre;">&#8288;&lt;&gt;&#8288;</code> in CQL2, respectively.
</p>
</li>
<li><p> function <code>is_null(a)</code> and <code>!is_null(a)</code> corresponds to <code style="white-space: pre;">&#8288;a IS NULL&#8288;</code> and
<code style="white-space: pre;">&#8288;a IS NOT NULL&#8288;</code> CQL2 operators, respectively.
</p>
</li></ul>




<h4>Advanced comparison operators</h4>


<ul>
<li> <p><code>a %like% b</code> corresponds to CQL2 <code style="white-space: pre;">&#8288;a LIKE b&#8288;</code>, <code>a</code> and <code>b</code> <code>strings</code> values.
</p>
</li>
<li> <p><code>between(a, b, c)</code> corresponds to CQL2 <code style="white-space: pre;">&#8288;a BETWEEN b AND c&#8288;</code>, where
<code>b</code> and <code>c</code> <code>integer</code> values.
</p>
</li>
<li> <p><code>a %in% b</code> corresponds to CQL2 <code style="white-space: pre;">&#8288;a IN (b)&#8288;</code>, where <code>b</code> should be
a list of values of the same type as <code>a</code>.
</p>
</li></ul>




<h4>Spatial operators</h4>


<ul>
<li><p> functions <code>s_intersects(a, b)</code>, <code>s_touches(a, b)</code>, <code>s_within(a, b)</code>,
<code>s_overlaps(a, b)</code>, <code>s_crosses(a, b)</code>, and <code>s_contains(a, b)</code> corresponds
to CQL2 <code>S_INTERSECTS(a, b)</code>, <code>S_TOUCHES(a, b)</code>, <code>S_WITHIN(a, b)</code>,
<code>S_OVERLAPS(a, b)</code>, <code>S_CROSSES(a, b)</code>, and <code>S_CONTAINS(a, b)</code> operators,
respectively. Here, <code>a</code> and <code>b</code> should be <code>geometry</code> objects. <code>rstac</code>
accepts <code>sf</code>, <code>sfc</code>, <code>sfg</code>, <code>list</code> (representing GeoJSON objects), or
<code>character</code> (representing either GeoJSON or WKT).
</p>
</li>
<li> <p><strong>NOTE</strong>: All of the above spatial object types, except for the
<code>character</code>, representing a WKT, may lose precision due to numeric
truncation when R converts numbers to JSON text. WKT strings are
sent &quot;as is&quot; to the service. Therefore, the only way for users to
retain precision on spatial objects is to represent them as a WKT
string. However, user can control numeric precision using the
<code>options(stac_digits = ...)</code>. The default value is 15 digits.
</p>
</li></ul>




<h4>Temporal operators</h4>


<ul>
<li><p> functions <code>date(a)</code>, <code>timestamp(a)</code>, and <code>interval(a, b)</code> corresponds to
CQL2 <code>DATE(a)</code>, <code>TIMESTAMP(a)</code>, and <code>INTERVAL(a, b)</code> operators,
respectively. These functions create literal <code>temporal</code> values.
The first two define an <code>instant</code> type, and the third an <code>interval</code> type.
</p>
</li>
<li><p> functions <code>t_after(a, b)</code>, <code>t_before(a, b)</code>, <code>t_contains(a, b)</code>,
<code>t_disjoint(a, b)</code>, <code>t_during(a, b)</code>, <code>t_equals(a, b)</code>,
<code>t_finishedby(a, b)</code>, <code>t_finishes(a, b)</code>, <code>t_intersects(a, b)</code>,
<code>t_meets(a, b)</code>, <code>t_meet(a, b)</code>, <code>t_metby(a, b)</code>, <code>t_overlappedby(a, b)</code>,
<code>t_overlaps(a, b)</code>, <code>t_startedby(a, b)</code>, and <code>t_starts(a, b)</code> corresponds
to CQL2 <code>T_AFTER(a, b)</code>, <code>T_BEFORE(a, b)</code>, <code>T_CONTAINS(a, b)</code>,
<code>T_DISJOINT(a, b)</code>, <code>T_DURING(a, b)</code>, <code>T_EQUALS(a, b)</code>,
<code>T_FINISHEDBY(a, b)</code>, <code>T_FINISHES(a, b)</code>, <code>T_INTERSECTS(a, b)</code>,
<code>T_MEETS(a, b)</code>, <code>T_MEET(a, b)</code>, <code>T_METBY(a, b)</code>, <code>T_OVERLAPPEDBY(a, b)</code>,
<code>T_OVERLAPS(a, b)</code>, <code>T_STARTEDBY(a, b)</code>, and <code>T_STARTS(a, b)</code> operators,
respectively. Here, <code>a</code> and <code>b</code> are <code>temporal</code> values (<code>instant</code> or
<code>interval</code>, depending on function).
</p>
</li></ul>




<h4>Array Operators</h4>


<ul>
<li><p> R unnamed lists (or vectors of size &gt; 1) are translated to arrays by
<code>rstac</code>. <code>list()</code> and <code>c()</code> functions always create <code>array</code> values
in CQL2 context, no matter the number of its arguments.
</p>
</li>
<li><p> functions <code>a_equals(a, b)</code>, <code>a_contains(a, b)</code>, <code>a_containedby(a, b)</code>,
and <code>a_overlaps(a, b)</code> corresponds to CQL2 <code>A_EQUALS(a, b)</code>,
<code>A_CONTAINS(a, b)</code>, <code>A_CONTAINEDBY(a, b)</code>, and <code>A_OVERLAPS(a, b)</code>
operators, respectively. Here, <code>a</code> and <code>b</code> should be <code>arrays</code>.
</p>
</li></ul>




<h3>Value</h3>

<p>A <code>rstac_query</code> object  with the subclass <code>ext_filter</code> containing
all request parameters to be passed to <code>get_request()</code> or
<code>post_request()</code> function.
</p>


<h3>Note</h3>

<p>The specification states that double-quoted identifiers should be
interpreted as properties. However, the R language does not distinguish
double quote from single quote strings. The right way to represent
double quoted properties in R is to use the escape character (<code style="white-space: pre;">&#8288;), for example &#8288;</code>&quot;date&quot;'.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ext_query">ext_query()</a></code>, <code><a href="#topic+stac_search">stac_search()</a></code>, <code><a href="#topic+post_request">post_request()</a></code>,
<code><a href="#topic+before_request">before_request()</a></code>, <code><a href="#topic+after_response">after_response()</a></code>, <code><a href="#topic+content_response">content_response()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Standard comparison operators in rstac:
# Creating a stac search query
req &lt;- stac("https://planetarycomputer.microsoft.com/api/stac/v1") %&gt;%
  stac_search(limit = 5)

# Equal operator '=' with collection property
req %&gt;% ext_filter(collection == "sentinel-2-l2a") %&gt;% post_request()

# Not equal operator '!=' with collection property
req %&gt;% ext_filter(collection != "sentinel-2-l2a") %&gt;% post_request()

# Less than or equal operator '&lt;=' with datetime property
req %&gt;% ext_filter(datetime &lt;= "1986-01-01") %&gt;% post_request()

# Greater than or equal '&gt;=' with AND operator
req %&gt;% ext_filter(collection == "sentinel-2-l2a"   &amp;&amp;
                   `s2:vegetation_percentage` &gt;= 50 &amp;&amp;
                   `eo:cloud_cover` &lt;= 10) %&gt;% post_request()
# Advanced comparison operators
# 'LIKE' operator
req %&gt;% ext_filter(collection %like% "modis%") %&gt;% post_request()

# 'IN' operator
req %&gt;% ext_filter(
  collection %in% c("landsat-c2-l2", "sentinel-2-l2a") &amp;&amp;
    datetime &gt; "2019-01-01" &amp;&amp;
    datetime &lt; "2019-06-01") %&gt;%
  post_request()

# Spatial operator
# Lets create a polygon with list
polygon &lt;- list(
  type = "Polygon",
  coordinates = list(
    matrix(c(-62.34499836, -8.57414572,
             -62.18858174, -8.57414572,
             -62.18858174, -8.15351185,
             -62.34499836, -8.15351185,
             -62.34499836, -8.57414572),
           ncol = 2, byrow = TRUE)
  )
)
# 'S_INTERSECTS' spatial operator with polygon and geometry property
req %&gt;% ext_filter(collection == "sentinel-2-l2a" &amp;&amp;
                   s_intersects(geometry, {{polygon}})) %&gt;% post_request()

# 'S_CONTAINS' spatial operator with point and geometry property
point &lt;- list(type = "Point", coordinates = c(-62.45792211, -8.61158488))
req %&gt;% ext_filter(collection == "landsat-c2-l2" &amp;&amp;
                   s_contains(geometry, {{point}})) %&gt;% post_request()

# 'S_CROSSES' spatial operator with linestring and geometry property
linestring &lt;- list(
  type = "LineString",
  coordinates = matrix(
         c(-62.55735320, -8.43329465, -62.21791603, -8.36815014),
         ncol = 2, byrow = TRUE
  )
)
req %&gt;% ext_filter(collection == "landsat-c2-l2" &amp;&amp;
                   s_crosses(geometry, {{linestring}})) %&gt;% post_request()

# Temporal operator
# 'T_INTERSECTS' temporal operator with datetime property
req %&gt;% ext_filter(
  collection == "landsat-c2-l2" &amp;&amp;
    t_intersects(datetime, interval("1985-07-16T05:32:00Z",
                                    "1985-07-24T16:50:35Z"))) %&gt;%
 post_request()

# 'T_DURING' temporal operator with datetime property
req %&gt;%
 ext_filter(collection == "landsat-c2-l2" &amp;&amp;
            t_during(datetime,
            interval("2022-07-16T05:32:00Z", ".."))) %&gt;%
 post_request()

# 'T_BEFORE' temporal operator with datetime property
req %&gt;%
 ext_filter(collection == "landsat-c2-l2" &amp;&amp;
            t_before(datetime, timestamp("2022-07-16T05:32:00Z"))) %&gt;%
 post_request()

# 'T_AFTER' temporal operator with datetime property
req %&gt;%
 ext_filter(collection == "landsat-c2-l2" &amp;&amp;
            t_after(datetime, timestamp("2022-07-16T05:32:00Z"))) %&gt;%
  post_request()

# Shows how CQL2 expression (TEXT format)
cql2_text(collection == "landsat-c2-l2" &amp;&amp;
  s_crosses(geometry, {{linestring}}))

# Shows how CQL2 expression (JSON format)
cql2_json(collection == "landsat-c2-l2" &amp;&amp;
            t_after(datetime, timestamp("2022-07-16T05:32:00Z")))

## End(Not run)

</code></pre>

<hr>
<h2 id='ext_query'>Query extension</h2><span id='topic+ext_query'></span>

<h3>Description</h3>

<p>The <code>ext_query()</code> is the <em>exported function</em> of the STAC API
query extension. It can be used after a call to <code>stac_search()</code>
function. It allows that additional fields and operators other than those
defined in <code>stac_search()</code> function be used to make a complex filter.
</p>
<p>The function accepts multiple filter criteria. Each filter entry is an
expression formed by <code style="white-space: pre;">&#8288;&lt;field&gt; &lt;operator&gt; &lt;value&gt;&#8288;</code>, where
<code style="white-space: pre;">&#8288;&lt;field&gt;&#8288;</code> refers to a valid item property. Supported <code style="white-space: pre;">&#8288;&lt;fields&gt;&#8288;</code>
depends on STAC API service implementation. The users must rely on the
service providers' documentation to know which properties can be used
by this extension.
</p>
<p>The <code>ext_query()</code> function allows the following <code style="white-space: pre;">&#8288;&lt;operators&gt;&#8288;</code>
</p>

<ul>
<li> <p><code>==</code> corresponds to '<code>eq</code>'
</p>
</li>
<li> <p><code>!=</code> corresponds to '<code>neq</code>'
</p>
</li>
<li> <p><code>&lt;</code> corresponds to '<code>lt</code>'
</p>
</li>
<li> <p><code>&lt;=</code> corresponds to '<code>lte</code>'
</p>
</li>
<li> <p><code>&gt;</code> corresponds to '<code>gt</code>'
</p>
</li>
<li> <p><code>&gt;=</code> corresponds to '<code>gte</code>'
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;\%startsWith\%&#8288;</code> corresponds to '<code>startsWith</code>' and implements
a string prefix search operator.
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;\%endsWith\%&#8288;</code> corresponds to '<code>endsWith</code>' and implements a
string suffix search operator.
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;\%contains\%&#8288;</code>: corresponds to '<code>contains</code>' and implements a
string infix search operator.
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;\%in\%&#8288;</code>: corresponds to '<code style="white-space: pre;">&#8288;in&#8288;</code>' and implements a vector
search operator.
</p>
</li></ul>

<p>Besides this function, the following S3 generic methods were implemented
to get things done for this extension:
</p>

<ul>
<li><p> The <code>before_request()</code> for subclass <code>ext_query</code>
</p>
</li>
<li><p> The <code>after_response()</code> for subclass <code>ext_query</code>
</p>
</li></ul>

<p>See source file <code>ext_query.R</code> for an example of how to implement new
extensions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ext_query(q, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ext_query_+3A_q">q</code></td>
<td>
<p>a <code>rstac_query</code> object expressing a STAC query
criteria.</p>
</td></tr>
<tr><td><code id="ext_query_+3A_...">...</code></td>
<td>
<p>entries with format <code style="white-space: pre;">&#8288;&lt;field&gt; &lt;operator&gt; &lt;value&gt;&#8288;</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>rstac_query</code> object  with the subclass <code>ext_query</code> containing
all request parameters to be passed to <code>post_request()</code> function.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ext_filter">ext_filter()</a></code>, <code><a href="#topic+stac_search">stac_search()</a></code>, <code><a href="#topic+post_request">post_request()</a></code>,
<code><a href="#topic+before_request">before_request()</a></code>, <code><a href="#topic+after_response">after_response()</a></code>, <code><a href="#topic+content_response">content_response()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
 stac("https://brazildatacube.dpi.inpe.br/stac/") %&gt;%
   stac_search(collections = "CB4-16D-2") %&gt;%
   ext_query("bdc:tile" %in% "007004") %&gt;%
   post_request()

## End(Not run)

</code></pre>

<hr>
<h2 id='extensions'>Extension development functions</h2><span id='topic+extensions'></span><span id='topic+before_request'></span><span id='topic+after_response'></span><span id='topic+parse_params'></span><span id='topic+content_response'></span><span id='topic+check_query_verb'></span><span id='topic+check_query'></span><span id='topic+subclass'></span><span id='topic+set_query_endpoint'></span><span id='topic+rstac_query'></span>

<h3>Description</h3>

<p>Currently, there are five STAC documents defined in STAC spec:
</p>

<ul>
<li> <p><code>doc_catalog</code>
</p>
</li>
<li> <p><code>doc_collection</code>
</p>
</li>
<li> <p><code>doc_collections</code>
</p>
</li>
<li> <p><code>doc_item</code>
</p>
</li>
<li> <p><code>doc_items</code>
</p>
</li></ul>

<p>Each document class is associated with STAC API endpoints.
As soon as new STAC documents are proposed in the specification, new
classes can be created in the <code>rstac</code> package.
</p>
<p>Let <code>version</code> parameter <code>NULL</code> to detect version automatically.
</p>
<p>Basically, there are two types of extensions in STAC specification:
</p>

<ol>
<li><p> STAC documents extensions: these extensions can be defined in
different elements of the document specification.
</p>
</li>
<li><p> STAC API extensions: these extensions are associated with the
interaction between the client and server through API and may add new
elements in the STAC documents or just filter the elements to be returned
in the documents.
</p>
</li></ol>

<p>Here, we will focus on the second type of extension.
</p>
<p>To let <code>rstac</code> package perform some behavior according to an
STAC API extension we need define some functions. These functions
can be implemented in three environments:
</p>

<ol>
<li><p> In <code>rstac</code> package by including new functions make a
GitHub pull request on <code>rstac</code> repository
(<a href="https://github.com/brazil-data-cube/rstac">https://github.com/brazil-data-cube/rstac</a>)
</p>
</li>
<li><p> In a new package by using <code>rstac</code> as dependent package
</p>
</li>
<li><p> In a script that loads <code>rstac</code> into the environment
</p>
</li></ol>

<p>All these places may impose specific requirements, however the core
logic to implement an extension is the same.
</p>
<p>These functions are intended for those who want to implement new STAC API
extensions. An extension must define a subclass name and implement all the
following S3 generic methods for that subclass:
</p>

<ul>
<li> <p><code>before_request()</code>: allows handling query parameters before
submit them to the HTTP server, usually sets up the query endpoint;
</p>
</li>
<li> <p><code>after_request()</code>: allows to check and parse document received
by the HTTP server;
</p>
</li></ul>

<p>These methods will work 'behind the scenes' when a <code>rstac_query</code> object
representing a user query are passed to a request function
(e.g. <code>get_request()</code> or <code>post_request()</code>). The calling order is:
</p>

<ol>
<li><p> begin of <code>get_request()</code> or <code>post_request()</code>
</p>
</li>
<li><p> if STAC API version is not defined, try detect it
</p>
</li>
<li><p> call <code>before_request()</code>
</p>
</li>
<li><p> send HTTP request
</p>
</li>
<li><p> receive HTTP response
</p>
</li>
<li> <p><code>after_response()</code>
</p>
</li>
<li><p> end of <code>get_request()</code> or <code>post_request()</code>
</p>
</li></ol>

<p>Besides that, the extension must expose a function to receive user
parameters and return a <code>rstac_query</code> object with a subclass
associated with the above S3 methods. This function must accept as its
first parameter a <code>rstac_query</code> object representing the actual query.
To keep the command flow consistency, the function needs to check the
subclass of the input query. After that, it must set new or changes the
input query parameters according to the user input and, finally,
return the new query as a <code>rstac_query</code> object.
</p>
<p>You can see examples on how to implement an STAC API extension by looking at
<code>stac.R</code>, <code>collections.R</code>, <code>items.R</code>, <code>stac_search.R</code>,
and <code>ext_query.R</code> source files. These files implement core STAC API
endpoints, as well as the query API extension.
</p>
<p>There are also some utility functions described in <strong>Functions</strong>
section bellow that can help the extension development.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>before_request(q)

after_response(q, res)

parse_params(q, params)

content_response(res, status_codes, content_types, key_message)

check_query_verb(q, verbs, msg = NULL)

check_query(x, classes = NULL)

subclass(x)

set_query_endpoint(q, endpoint, params = NULL)

rstac_query(version = NULL, base_url, params = list(), subclass)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extensions_+3A_q">q</code></td>
<td>
<p>a <code>rstac_query</code> object.</p>
</td></tr>
<tr><td><code id="extensions_+3A_res">res</code></td>
<td>
<p>a <code>httr</code> <code>response</code> object.</p>
</td></tr>
<tr><td><code id="extensions_+3A_params">params</code></td>
<td>
<p>a named <code>list</code> with all URL query parameters to be
appended in the URL.</p>
</td></tr>
<tr><td><code id="extensions_+3A_status_codes">status_codes</code></td>
<td>
<p>a <code>character</code> vector with successful
status codes.</p>
</td></tr>
<tr><td><code id="extensions_+3A_content_types">content_types</code></td>
<td>
<p>a <code>character</code> vector with all acceptable
responses' content type.</p>
</td></tr>
<tr><td><code id="extensions_+3A_key_message">key_message</code></td>
<td>
<p>a <code>character</code> vector with the JSON keys to show the
requested API message.</p>
</td></tr>
<tr><td><code id="extensions_+3A_verbs">verbs</code></td>
<td>
<p>a <code>character</code> vector with allowed HTTP request methods</p>
</td></tr>
<tr><td><code id="extensions_+3A_msg">msg</code></td>
<td>
<p>a <code>character</code> with a personalized error message</p>
</td></tr>
<tr><td><code id="extensions_+3A_x">x</code></td>
<td>
<p>a <code>rstac_query</code> object expressing a STAC query
criteria.</p>
</td></tr>
<tr><td><code id="extensions_+3A_classes">classes</code></td>
<td>
<p>a <code>character</code> vector with all allowed S3 sub-classes</p>
</td></tr>
<tr><td><code id="extensions_+3A_endpoint">endpoint</code></td>
<td>
<p>a <code>character</code> vector with the format string with the
endpoint url.</p>
</td></tr>
<tr><td><code id="extensions_+3A_version">version</code></td>
<td>
<p>a <code>character</code> with the STAC version.</p>
</td></tr>
<tr><td><code id="extensions_+3A_base_url">base_url</code></td>
<td>
<p>a <code>character</code> informing the base URL of a
STAC web service.</p>
</td></tr>
<tr><td><code id="extensions_+3A_subclass">subclass</code></td>
<td>
<p>a <code>character</code> corresponding to the subclass of the
object to be created.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>rstac_query</code> object for <code>before_request()</code> and
<code>after_response()</code> functions.
</p>
<p>The <code>content_response()</code> function returns a <code>list</code> data structure
representing the JSON file received in HTTP response
</p>
<p>The <code>rstac_query()</code> function returns a <code>STACQuery</code> object with
subclass defined by <code>subclass</code> parameter.
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>content_response()</code>: The <code>content_response</code> function checks if the request's
response is in accordance with the allowed status codes and content-types.
It returns the parsed content response.
</p>
</li>
<li> <p><code>check_query_verb()</code>: The <code>check_query_verb()</code> function allows you to define which HTTP
verbs are allowed. It is useful for establishing which verbs will be
supported by an extension.
</p>
</li>
<li> <p><code>check_query()</code>: The <code>check_query()</code> function specifies which type of query
object (<code>rstac_query</code>) is expected in the function extension.
</p>
</li>
<li> <p><code>subclass()</code>: The <code>subclass()</code> function returns a <code>character</code> representing the
subclass name of <code>rstac_query</code> objects.
</p>
</li>
<li> <p><code>set_query_endpoint()</code>: The <code>set_query_endpoint()</code> function defines the endpoint of a query.
If <code>params</code> parameter is passed, each value must be an entry of params
field of the given query. The corresponding param value will be used as
value replacement of <code style="white-space: pre;">&#8288;%s&#8288;</code> occurrences in the <code>endpoint</code> string. After
the replacement, all params in this list will be removed.
</p>
</li>
<li> <p><code>rstac_query()</code>: The <code>rstac_query()</code> function is a constructor of <code>rstac_query</code>
objects. Every extension must implement a subclass of <code>rstac_query</code> to
represent its queries. This is done by informing to the <code>subclass</code>
parameter the extension's subclass name.
</p>
<p>The <code>params</code> parameter is a named <code>list</code> where user parameters
must be stored. It is important to know if previous query parameters needs
to be keeped in the new query. If so, it is recommended do use
<code><a href="utils.html#topic+modifyList">utils::modifyList()</a></code> function to merge the old and new
query parameters.
</p>
<p>If the <code>version</code> parameter is <code>NULL</code>, <code>rstac</code> will detect
STAC API version automatically.
</p>
<p>In general, if you are implementing a new subclass, the parameters
<code>version</code> and <code>url</code> will be the same as the previous query. The
<code>params</code> parameter will be merged with previous query. And subclass
is the extension's subclass name.
</p>
</li></ul>


<h3>See Also</h3>

<p><code><a href="#topic+ext_query">ext_query()</a></code>
</p>

<hr>
<h2 id='get_request'>STAC API request functions</h2><span id='topic+get_request'></span><span id='topic+post_request'></span>

<h3>Description</h3>

<p>The <code>get_request</code> is function that makes HTTP GET
requests to STAC web services, retrieves, and parse the data.
</p>
<p>The <code>post_request</code> is function that makes HTTP POST
requests to STAC web services, retrieves, and parse the data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_request(q, ...)

post_request(q, ..., encode = c("json", "multipart", "form"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_request_+3A_q">q</code></td>
<td>
<p>a <code>rstac_query</code> object expressing a STAC query
criteria.</p>
</td></tr>
<tr><td><code id="get_request_+3A_...">...</code></td>
<td>
<p>config parameters to be passed to <a href="httr.html#topic+GET">GET</a> or
<a href="httr.html#topic+POST">POST</a> methods, such as <a href="httr.html#topic+add_headers">add_headers</a> or
<a href="httr.html#topic+set_cookies">set_cookies</a>.</p>
</td></tr>
<tr><td><code id="get_request_+3A_encode">encode</code></td>
<td>
<p>a <code>character</code> informing the request body
Content-Type. Accepted types are <code>'json'</code> (<code>'application/json'</code>),
<code>'form'</code> (<code>'application/x-www-form-urlencoded'</code>),
and <code>'multipart'</code> (<code>'multipart/form-data'</code>). Defaults to
<code>'json'</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Either a <code>doc_catalog</code>, <code>doc_collection</code>,
<code>doc_collections</code>, <code>doc_items</code> or <code>doc_item</code>
object depending on the subclass and search fields parameters of <code>q</code>
argument.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+stac">stac()</a></code> <code><a href="#topic+stac_search">stac_search()</a></code> <code><a href="#topic+collections">collections()</a></code>
<code><a href="#topic+items">items()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
 stac("https://brazildatacube.dpi.inpe.br/stac/") %&gt;%
  get_request()

 stac("https://brazildatacube.dpi.inpe.br/stac/") %&gt;%
  stac_search(collections = "CB4-16D-2") %&gt;%
  post_request()

## End(Not run)
</code></pre>

<hr>
<h2 id='items'>Endpoint functions</h2><span id='topic+items'></span>

<h3>Description</h3>

<p>The <code>items</code> function implements WFS3
<code>/collections/{collectionId}/items</code>, and
<code>/collections/{collectionId}/items/{featureId}</code> endpoints.
</p>
<p>Each endpoint retrieves specific STAC objects:
</p>

<ul>
<li> <p><code>/collections/{collectionId}/items</code>: Returns a STAC Items
collection (GeoJSON)
</p>
</li>
<li> <p><code>/collections/{collectionId}/items/{itemId}</code>: Returns a
STAC Item (GeoJSON Feature)
</p>
</li></ul>

<p>The endpoint <code>/collections/{collectionId}/items</code> accepts the same
filters parameters of <code><a href="#topic+stac_search">stac_search()</a></code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>items(q, feature_id = NULL, datetime = NULL, bbox = NULL, limit = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="items_+3A_q">q</code></td>
<td>
<p>a <code>rstac_query</code> object expressing a STAC query
criteria.</p>
</td></tr>
<tr><td><code id="items_+3A_feature_id">feature_id</code></td>
<td>
<p>a <code>character</code> with item id to be fetched.
Only works if the <code>collection_id</code> is informed. This is equivalent to
the endpoint <code>/collections/{collectionId}/items/{featureId}</code>.</p>
</td></tr>
<tr><td><code id="items_+3A_datetime">datetime</code></td>
<td>
<p>a <code>character</code> with a date-time or an interval.
Date and time strings needs to conform to RFC 3339. Intervals are
expressed by separating two date-time strings by <code>'/'</code> character.
Open intervals are expressed by using <code>'..'</code> in place of date-time.
</p>
<p>Examples:
</p>

<ul>
<li><p> A date-time: <code>"2018-02-12T23:20:50Z"</code>
</p>
</li>
<li><p> A closed interval: <code>"2018-02-12T00:00:00Z/2018-03-18T12:31:12Z"</code>
</p>
</li>
<li><p> Open intervals: <code>"2018-02-12T00:00:00Z/.."</code> or
<code>"../2018-03-18T12:31:12Z"</code>
</p>
</li></ul>

<p>Only features that have a <code>datetime</code> property that intersects
the interval or date-time informed in <code>datetime</code> are selected.</p>
</td></tr>
<tr><td><code id="items_+3A_bbox">bbox</code></td>
<td>
<p>a <code>numeric</code> vector with only features that have a
geometry that intersects the bounding box are selected. The bounding box is
provided as four or six numbers, depending on whether the coordinate
reference system includes a vertical axis (elevation or depth):
</p>
 <ul>
<li><p> Lower left corner, coordinate axis 1
</p>
</li>
<li><p> Lower left corner, coordinate axis 2
</p>
</li>
<li><p> Lower left corner, coordinate axis 3 (optional)
</p>
</li>
<li><p> Upper right corner, coordinate axis 1
</p>
</li>
<li><p> Upper right corner, coordinate axis 2
</p>
</li>
<li><p> Upper right corner, coordinate axis 3 (optional) </p>
</li></ul>

<p>The coordinate reference system of the values is WGS84
longitude/latitude (<a href="http://www.opengis.net/def/crs/OGC/1.3/CRS84">http://www.opengis.net/def/crs/OGC/1.3/CRS84</a>).
The values are, in most cases, the sequence of minimum longitude,
minimum latitude, maximum longitude, and maximum latitude. However,
in cases where the box spans the antimeridian, the first value
(west-most box edge) is larger than the third value
(east-most box edge).</p>
</td></tr>
<tr><td><code id="items_+3A_limit">limit</code></td>
<td>
<p>an <code>integer</code> defining the maximum number of results
to return. If not informed, it defaults to the service implementation.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>rstac_query</code> object with the subclass <code>items</code> for
<code>/collections/{collection_id}/items</code> endpoint, or a
<code>item_id</code> subclass for
<code>/collections/{collection_id}/items/{feature_id}</code> endpoint,
containing all search field parameters to be provided to STAC API web
service.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_request">get_request()</a></code>,  <code><a href="#topic+post_request">post_request()</a></code>,
<code><a href="#topic+collections">collections()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
 stac("https://brazildatacube.dpi.inpe.br/stac/") %&gt;%
   collections("CB4-16D-2") %&gt;%
   items(bbox = c(-47.02148, -17.35063, -42.53906, -12.98314)) %&gt;%
   get_request()

 stac("https://brazildatacube.dpi.inpe.br/stac/") %&gt;%
   collections("CB4-16D-2") %&gt;%
   items("CB4-16D_V2_000002_20230509") %&gt;%
   get_request()

## End(Not run)

</code></pre>

<hr>
<h2 id='items_functions'>Items functions</h2><span id='topic+items_functions'></span><span id='topic+items_length'></span><span id='topic+items_length.doc_items'></span><span id='topic+items_matched'></span><span id='topic+items_matched.doc_items'></span><span id='topic+items_fetch'></span><span id='topic+items_fetch.doc_items'></span><span id='topic+items_next'></span><span id='topic+items_next.doc_items'></span><span id='topic+items_datetime'></span><span id='topic+items_datetime.doc_item'></span><span id='topic+items_datetime.doc_items'></span><span id='topic+items_bbox'></span><span id='topic+items_bbox.doc_item'></span><span id='topic+items_bbox.doc_items'></span><span id='topic+items_assets'></span><span id='topic+items_assets.doc_item'></span><span id='topic+items_assets.doc_items'></span><span id='topic+items_assets.default'></span><span id='topic+items_filter'></span><span id='topic+items_filter.doc_items'></span><span id='topic+items_compact'></span><span id='topic+items_compact.doc_items'></span><span id='topic+items_reap'></span><span id='topic+items_reap.doc_item'></span><span id='topic+items_reap.doc_items'></span><span id='topic+items_reap.default'></span><span id='topic+items_fields'></span><span id='topic+items_fields.doc_item'></span><span id='topic+items_fields.doc_items'></span><span id='topic+items_sign'></span><span id='topic+items_sign.doc_item'></span><span id='topic+items_sign.doc_items'></span><span id='topic+items_sign.default'></span><span id='topic+items_as_sf'></span><span id='topic+items_as_sf.doc_item'></span><span id='topic+items_as_sf.doc_items'></span><span id='topic+items_as_sfc'></span><span id='topic+items_as_sfc.doc_item'></span><span id='topic+items_as_sfc.doc_items'></span><span id='topic+items_as_tibble'></span><span id='topic+items_as_tibble.doc_item'></span><span id='topic+items_as_tibble.doc_items'></span><span id='topic+items_intersects'></span><span id='topic+items_intersects.doc_item'></span><span id='topic+items_intersects.doc_items'></span><span id='topic+items_properties'></span><span id='topic+items_properties.doc_item'></span><span id='topic+items_properties.doc_items'></span><span id='topic+items_select'></span><span id='topic+items_select.doc_items'></span>

<h3>Description</h3>

<p>These functions provide support to work with
<code>doc_items</code> and <code>doc_item</code> objects.
</p>

<ul>
<li> <p><code>items_length()</code>: shows how many items there are in
the <code>doc_items</code> object.
</p>
</li>
<li> <p><code>items_matched()</code>: shows how many items matched the
search criteria. It supports <code>search:metadata</code> (v0.8.0),
<code>context</code> (v0.9.0), and <code>numberMatched</code> (OGC WFS3 core spec).
</p>
</li>
<li> <p><code>items_fetch()</code>: request all STAC Items through
pagination.
</p>
</li>
<li> <p><code>items_next()</code>: fetches a new page from STAC service.
</p>
</li>
<li> <p><code>items_datetime()</code>: retrieves the <code>datetime</code>
field in <code>properties</code> from <code>doc_items</code> and
<code>doc_item</code> objects.
</p>
</li>
<li> <p><code>items_bbox()</code>: retrieves the <code>bbox</code>
field of a <code>doc_items</code> or a <code>doc_item</code> object.
</p>
</li>
<li> <p><code>item_assets()</code>: returns the assets name from
<code>doc_items</code> and <code>doc_item</code> objects.
</p>
</li>
<li> <p><code>items_filter()</code>: selects only items that match some criteria
(see details section).
</p>
</li>
<li> <p><code>items_reap()</code>: extract key values by traversing all items
in a <code>doc_items</code> object.
</p>
</li>
<li> <p><code>items_fields()</code>: lists field names inside an item.
</p>
</li>
<li> <p><code>items_sign()</code>: allow access assets by preparing its url.
</p>
</li>
<li> <p><code>items_as_sf()</code>: <a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a> convert items
to <code>sf</code> object.
</p>
</li>
<li> <p><code>items_as_sfc()</code>: <a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a> convert items
to <code>sfc</code> object.
</p>
</li>
<li> <p><code>items_intersects()</code>: <a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a> indicates
which items intersects a given geometry.
</p>
</li>
<li> <p><code>items_properties()</code>: lists properties names inside an item.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>items_length(items)

## S3 method for class 'doc_items'
items_length(items)

items_matched(items, matched_field = NULL)

## S3 method for class 'doc_items'
items_matched(items, matched_field = NULL)

items_fetch(items, ...)

## S3 method for class 'doc_items'
items_fetch(items, ..., progress = TRUE, matched_field = NULL)

items_next(items, ...)

## S3 method for class 'doc_items'
items_next(items, ...)

items_datetime(items)

## S3 method for class 'doc_item'
items_datetime(items)

## S3 method for class 'doc_items'
items_datetime(items)

items_bbox(items)

## S3 method for class 'doc_item'
items_bbox(items)

## S3 method for class 'doc_items'
items_bbox(items)

items_assets(items)

## S3 method for class 'doc_item'
items_assets(items)

## S3 method for class 'doc_items'
items_assets(items)

## Default S3 method:
items_assets(items)

items_filter(items, ..., filter_fn = NULL)

## S3 method for class 'doc_items'
items_filter(items, ..., filter_fn = NULL)

items_compact(items)

## S3 method for class 'doc_items'
items_compact(items)

items_reap(items, field, pick_fn = identity)

## S3 method for class 'doc_item'
items_reap(items, field, pick_fn = identity)

## S3 method for class 'doc_items'
items_reap(items, field, pick_fn = identity)

## Default S3 method:
items_reap(items, field, pick_fn = identity)

items_fields(items, field = NULL)

## S3 method for class 'doc_item'
items_fields(items, field = NULL)

## S3 method for class 'doc_items'
items_fields(items, field = NULL)

items_sign(items, sign_fn)

## S3 method for class 'doc_item'
items_sign(items, sign_fn)

## S3 method for class 'doc_items'
items_sign(items, sign_fn)

## Default S3 method:
items_sign(items, sign_fn)

items_as_sf(items, ..., crs = 4326)

## S3 method for class 'doc_item'
items_as_sf(items, ..., crs = 4326)

## S3 method for class 'doc_items'
items_as_sf(items, ..., crs = 4326)

items_as_sfc(items, crs = 4326)

## S3 method for class 'doc_item'
items_as_sfc(items, crs = 4326)

## S3 method for class 'doc_items'
items_as_sfc(items, crs = 4326)

items_as_tibble(items)

## S3 method for class 'doc_item'
items_as_tibble(items)

## S3 method for class 'doc_items'
items_as_tibble(items)

items_intersects(items, geom, ..., crs = 4326)

## S3 method for class 'doc_item'
items_intersects(items, geom, ..., crs = 4326)

## S3 method for class 'doc_items'
items_intersects(items, geom, ..., crs = 4326)

items_properties(items)

## S3 method for class 'doc_item'
items_properties(items)

## S3 method for class 'doc_items'
items_properties(items)

items_select(items, selection)

## S3 method for class 'doc_items'
items_select(items, selection)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="items_functions_+3A_items">items</code></td>
<td>
<p>a <code>doc_items</code> object.</p>
</td></tr>
<tr><td><code id="items_functions_+3A_matched_field">matched_field</code></td>
<td>
<p>a <code>character</code> vector with the path
where the number of items returned in the named list is located starting
from the initial node of the list. For example, if the information is in a
position <code>items$meta$found</code> of the object, it must be passed as the
following parameter <code>c("meta", "found")</code>.</p>
</td></tr>
<tr><td><code id="items_functions_+3A_...">...</code></td>
<td>
<p>additional arguments. See details.</p>
</td></tr>
<tr><td><code id="items_functions_+3A_progress">progress</code></td>
<td>
<p>a <code>logical</code> indicating if a progress bar must be
shown or not. Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="items_functions_+3A_filter_fn">filter_fn</code></td>
<td>
<p>a <code>function</code> that receives an item that should
evaluate a <code>logical</code> value.</p>
</td></tr>
<tr><td><code id="items_functions_+3A_field">field</code></td>
<td>
<p>a <code>character</code> with the names of the field to
get the subfields values.</p>
</td></tr>
<tr><td><code id="items_functions_+3A_pick_fn">pick_fn</code></td>
<td>
<p>a <code>function</code> used to pick elements from items
addressed by <code>field</code> parameter.</p>
</td></tr>
<tr><td><code id="items_functions_+3A_sign_fn">sign_fn</code></td>
<td>
<p>a <code>function</code> that receives an item as a parameter
and returns an item signed.</p>
</td></tr>
<tr><td><code id="items_functions_+3A_crs">crs</code></td>
<td>
<p>a <code>character</code> representing the geometry projection.</p>
</td></tr>
<tr><td><code id="items_functions_+3A_geom">geom</code></td>
<td>
<p>a <code>sf</code> or <code>sfc</code> object.</p>
</td></tr>
<tr><td><code id="items_functions_+3A_selection">selection</code></td>
<td>
<p>an <code>integer</code> vector containing the indices of the items
to select.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Ellipsis argument (<code>...</code>) appears in different items functions and
has distinct purposes:
</p>

<ul>
<li> <p><code>items_matched()</code> and <code>items_assets()</code>: ellipsis is not used.
</p>
</li>
<li> <p><code>items_fetch()</code> and <code>items_next()</code>: ellipsis is used to pass
additional <code>httr</code> options to <a href="httr.html#topic+GET">GET</a> or <a href="httr.html#topic+POST">POST</a>
methods, such as <a href="httr.html#topic+add_headers">add_headers</a> or
<a href="httr.html#topic+set_cookies">set_cookies</a>.
</p>
</li>
<li> <p><code>items_filter()</code>: ellipsis is used to pass logical
expressions to be evaluated against a <code>doc_item</code> field as filter criteria.
</p>
<p><strong>WARNING:</strong> the evaluation of filter expressions changed in <code>rstac</code> 0.9.2.
Older versions of <code>rstac</code> used <code>properties</code> field to evaluate filter
expressions. Below, there is an example of how to write expressions in new
<code>rstac</code> version:
</p>
<div class="sourceCode R"><pre># expression in older version
items_filter(stac_obj, `eo:cloud_cover` &lt; 10)
# now expressions must refer to properties explicitly
items_filter(stac_obj, properties$`eo:cloud_cover` &lt; 10)
items_filter(stac_obj, properties[["eo:cloud_cover"]] &lt; 10)
</pre></div>
</li>
<li> <p><code>items_sign()</code>: in the near future, ellipsis will be used to append
key-value pairs to the url query string of an asset.
</p>
</li></ul>

<p><code>items_sign()</code> has <code>sign_fn</code> parameter that must be a function that
receives as argument an item and returns a signed item. <code>rstac</code> provides
<code>sign_bdc()</code> and <code>sign_planetary_computer()</code> functions to access Brazil
Data Cube products and Microsoft Planetary Computer catalogs, respectively.
</p>


<h3>Value</h3>


<ul>
<li> <p><code>items_length()</code>: an <code>integer</code> value.
</p>
</li>
<li> <p><code>items_matched()</code>: returns an <code>integer</code> value if the STAC web server
does support this extension. Otherwise returns <code>NULL</code>.
</p>
</li>
<li> <p><code>items_fetch()</code>: a <code>doc_items</code> with all matched items.
</p>
</li>
<li> <p><code>items_next()</code>: fetches a new page from STAC service.
</p>
</li>
<li> <p><code>items_datetime()</code>: a <code>list</code> of all items' datetime.
</p>
</li>
<li> <p><code>items_bbox()</code>: returns a <code>list</code> with all items' bounding boxes.
</p>
</li>
<li> <p><code>item_assets()</code>: returns a <code>character</code> value with all assets names
of all items.
</p>
</li>
<li> <p><code>items_filter()</code>: a <code>doc_items</code> object.
</p>
</li>
<li> <p><code>items_reap()</code>: a <code>vector</code> if the supplied field is atomic,
otherwise or a <code>list</code>.
</p>
</li>
<li> <p><code>items_fields()</code>: a <code>character</code> vector.
</p>
</li>
<li> <p><code>items_sign()</code>: a <code>doc_items</code> object with signed assets url.
</p>
</li>
<li> <p><code>items_as_sf()</code>: a <code>sf</code> object.
</p>
</li>
<li> <p><code>items_as_sfc()</code>: a <code>sfc</code> object.
</p>
</li>
<li> <p><code>items_as_tibble()</code>: a <code>tibble</code> object.
</p>
</li>
<li> <p><code>items_intersects()</code>: a <code>logical</code> vector.
</p>
</li>
<li> <p><code>items_properties()</code>: returns a <code>character</code> value with all properties
of all items.
</p>
</li>
<li> <p><code>items_select()</code>: select features from an items object.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
 x &lt;- stac("https://brazildatacube.dpi.inpe.br/stac") %&gt;%
     stac_search(collections = "CB4-16D-2") %&gt;%
     stac_search(datetime = "2020-01-01/2021-01-01", limit = 500) %&gt;%
     get_request()

 x %&gt;% items_length()
 x %&gt;% items_matched()
 x %&gt;% items_datetime()
 x %&gt;% items_bbox()
 x %&gt;% items_fetch()

## End(Not run)

## Not run: 
# Defining BDC token
Sys.setenv("BDC_ACCESS_KEY" = "token-123")

# doc_item object
stac("https://brazildatacube.dpi.inpe.br/stac/") %&gt;%
    stac_search(collections = "CB4-16D-2", limit = 100,
        datetime = "2017-08-01/2018-03-01",
        bbox = c(-48.206, -14.195, -45.067, -12.272)) %&gt;%
    get_request() %&gt;% items_sign(sign_fn = sign_bdc())


## End(Not run)

## Not run: 
# doc_items object
stac("https://brazildatacube.dpi.inpe.br/stac/") %&gt;%
    stac_search(collections = "CB4-16D-2", limit = 100,
        datetime = "2017-08-01/2018-03-01",
        bbox = c(-48.206, -14.195, -45.067, -12.272)) %&gt;%
    get_request() %&gt;%
    items_filter(properties$`eo:cloud_cover` &lt; 10)

# Example with AWS STAC
stac("https://earth-search.aws.element84.com/v0") %&gt;%
  stac_search(collections = "sentinel-s2-l2a-cogs",
              bbox = c(-48.206, -14.195, -45.067, -12.272),
              datetime = "2018-06-01/2018-06-30",
              limit = 500) %&gt;%
  post_request() %&gt;%
  items_filter(filter_fn = function(x) {x$properties$`eo:cloud_cover` &lt; 10})

## End(Not run)

## Not run: 
# doc_items object
stac_item &lt;- stac("https://brazildatacube.dpi.inpe.br/stac/") %&gt;%
 stac_search(collections = "CB4-16D-2", limit = 100,
        datetime = "2017-08-01/2018-03-01",
        bbox = c(-48.206, -14.195, -45.067, -12.272)) %&gt;%
 get_request() %&gt;% items_fetch(progress = FALSE)

stac_item %&gt;% items_reap(field = c("properties", "datetime"))

stac_item %&gt;% items_as_sf()

stac_item %&gt;% items_as_tibble()

stac_item %&gt;% items_select(c(1, 4, 10, 20))


## End(Not run)

</code></pre>

<hr>
<h2 id='items_sign_bdc'>Signature in hrefs provided by the STAC from the Brazil Data Cube
project.</h2><span id='topic+items_sign_bdc'></span><span id='topic+sign_bdc'></span>

<h3>Description</h3>

<p>These functions provide support to access assets from Brazil Data Cube.
</p>

<ul>
<li> <p><code>items_sign_bdc()</code>: <a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
A simplified function to sign assets' URL from Brazil Data Cube
to be able to access the data.
</p>
</li>
<li> <p><code>sign_bdc()</code>: Creates a signing function to be
used by <code>items_sign()</code>. This function sign all the assets' URL.
</p>
</li></ul>

<p>To sign the hrefs with your token you need to store it in an
environment variable in <code>BDC_ACCESS_KEY</code>or use <code>acess_token</code> parameter.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>items_sign_bdc(items, access_token = NULL, ...)

sign_bdc(access_token = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="items_sign_bdc_+3A_items">items</code></td>
<td>
<p>a <code>doc_item</code> or <code>doc_items</code> object
representing the result of <code style="white-space: pre;">&#8288;/stac/search&#8288;</code>,
<code>/collections/{collectionId}/items</code> or
<code>/collections/{collectionId}/items/{itemId}</code> endpoints.</p>
</td></tr>
<tr><td><code id="items_sign_bdc_+3A_access_token">access_token</code></td>
<td>
<p>a <code>character</code> with the access token parameter to access
Brazil Data Cube assets.</p>
</td></tr>
<tr><td><code id="items_sign_bdc_+3A_...">...</code></td>
<td>
<p>additional parameters can be supplied to the <code>GET</code>
function of the <code>httr</code> package.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>function</code> that signs each item assets.
</p>

<ul>
<li> <p><code>items_sign_bdc()</code>: items with signed assets URLs.
</p>
</li>
<li> <p><code>sign_bdc()</code>: a function to to be passed to <code>items_sign()</code>.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
 # doc_items object
 stac_obj &lt;- stac("https://brazildatacube.dpi.inpe.br/stac/") %&gt;%
   stac_search(collections = "CB4-16D-2",
               datetime = "2019-06-01/2019-08-01") %&gt;%
   stac_search() %&gt;%
   get_request()

 # the new way to authenticate:
 stac_obj &lt;- stac_obj %&gt;%
   items_sign_bdc("&lt;your-access-token&gt;")

 # this is the old way of authentication (still works):
 # stac_obj %&gt;%
 #   items_sign(sign_fn = sign_bdc(access_token = "&lt;your-access-token&gt;"))

## End(Not run)

</code></pre>

<hr>
<h2 id='items_sign_planetary_computer'>Signs URL to access assets from Microsoft's Planetary Computer.</h2><span id='topic+items_sign_planetary_computer'></span><span id='topic+sign_planetary_computer'></span>

<h3>Description</h3>

<p>These functions provide support to access assets from Planetary Computer.
</p>

<ul>
<li> <p><code>items_sign_planetary_computer()</code>: <a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
A simplified function to sign assets' URL from Microsoft Planetary
Computer to be able to access the data.
</p>
</li>
<li> <p><code>sign_planetary_computer()</code>: Creates a signing function to be
used by <code>items_sign()</code>. This function sign all the assets' URL.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>items_sign_planetary_computer(items, subscription_key = NULL, ...)

sign_planetary_computer(..., headers = NULL, token_url = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="items_sign_planetary_computer_+3A_items">items</code></td>
<td>
<p>a <code>doc_item</code> or <code>doc_items</code> object
representing the result of <code style="white-space: pre;">&#8288;/stac/search&#8288;</code>,
<code>/collections/{collectionId}/items</code> or
<code>/collections/{collectionId}/items/{itemId}</code> endpoints.</p>
</td></tr>
<tr><td><code id="items_sign_planetary_computer_+3A_subscription_key">subscription_key</code></td>
<td>
<p>the <code>subscription-key</code> to access restricted
assets in Microsoft Planetary Computer. You can keep this parameter
empty for non-protected assets.</p>
</td></tr>
<tr><td><code id="items_sign_planetary_computer_+3A_...">...</code></td>
<td>
<p>additional parameters can be supplied to the <code>GET</code> function
of the <code>httr</code> package.</p>
</td></tr>
<tr><td><code id="items_sign_planetary_computer_+3A_headers">headers</code></td>
<td>
<p>a named character vector with headers key-value content.</p>
</td></tr>
<tr><td><code id="items_sign_planetary_computer_+3A_token_url">token_url</code></td>
<td>
<p>a <code>character</code> with the URL that generates the tokens
in the Microsoft service.
By default is used:
<code>"https://planetarycomputer.microsoft.com/api/sas/v1/token"</code></p>
</td></tr>
</table>


<h3>Value</h3>


<ul>
<li> <p><code>items_sign_planetary_computer()</code>: items with signed assets URLs.
</p>
</li>
<li> <p><code>sign_planetary_computer()</code>: a function to to be passed to
<code>items_sign()</code>.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
 # doc_items object
 stac_obj &lt;- stac("https://planetarycomputer.microsoft.com/api/stac/v1/") %&gt;%
  stac_search(collections = "sentinel-2-l2a",
              bbox = c(-47.02148, -17.35063, -42.53906, -12.98314)) %&gt;%
  get_request()

 # the new way to authenticate:
 stac_obj &lt;- stac_obj %&gt;%
   items_sign_planetary_computer()

 # this is the old way of authentication (still works):
 # stac_obj &lt;- stac_obj %&gt;%
 #   items_sign(sign_fn = sign_planetary_computer())

 # example of access to collections that require authentication
 stac_obj &lt;- stac("https://planetarycomputer.microsoft.com/api/stac/v1") %&gt;%
   stac_search(collections = c("sentinel-1-rtc"),
               bbox = c(-64.8597, -10.4919, -64.79272527, -10.4473),
               datetime = "2019-01-01/2019-01-28") %&gt;%
   post_request()

 # the new way to authenticate:
 # stac_obj &lt;- stac_obj %&gt;%
 #   items_sign_planetary_computer("&lt;subscription-key&gt;")

 # this is the old way of authentication (still works):
 # stac_obj &lt;- stac_obj %&gt;%
 #   items_sign(
 #     sign_fn = sign_planetary_computer(
 #       headers = c("Ocp-Apim-Subscription-Key" = &lt;your-mpc-token&gt;)
 #     )
 #   )

## End(Not run)

</code></pre>

<hr>
<h2 id='preview_plot'>Plot preview images</h2><span id='topic+preview_plot'></span>

<h3>Description</h3>

<p>This is a helper function to plot preview assets
(e.g. quicklook, thumbnail, rendered_preview).
Currently, only png and jpeg formats are supported.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>preview_plot(url)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="preview_plot_+3A_url">url</code></td>
<td>
<p>image URL to be plotted.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A rastergrob grob from package <code>grid</code>.
</p>

<hr>
<h2 id='print'>Printing functions</h2><span id='topic+print'></span><span id='topic+print.rstac_query'></span><span id='topic+print.doc_catalog'></span><span id='topic+print.doc_collections'></span><span id='topic+print.doc_collection'></span><span id='topic+print.doc_items'></span><span id='topic+print.doc_item'></span><span id='topic+print.doc_queryables'></span><span id='topic+print.doc_conformance'></span><span id='topic+print.doc_link'></span><span id='topic+print.doc_links'></span>

<h3>Description</h3>

<p>The print function covers all objects in the rstac package:
</p>

<ul>
<li> <p><code><a href="#topic+stac">stac()</a></code>: returns a <code>doc_catalog</code> document from
<code style="white-space: pre;">&#8288;/stac&#8288;</code> (v0.8.0) or <code>/</code> (v0.9.0 or v1.0.0) endpoint.
</p>
</li>
<li> <p><code><a href="#topic+stac_search">stac_search()</a></code>: returns a <code>doc_items</code>
document from <code style="white-space: pre;">&#8288;/stac/search&#8288;</code> (v0.8.0) or <code style="white-space: pre;">&#8288;/search&#8288;</code>
(v0.9.0 or v1.0.0) endpoint containing all Items that match
the provided search predicates.
</p>
</li>
<li> <p><code><a href="#topic+collections">collections()</a></code>: implements the <code style="white-space: pre;">&#8288;/collections&#8288;</code> and
<code>/collections/{collectionId}</code> endpoints. The former returns
a <code>doc_collections</code> document that lists all collections published
by the server, and the later returns a single <code>doc_collection</code>
document that describes a unique collection.
</p>
</li>
<li> <p><code><a href="#topic+items">items()</a></code>: retrieves a <code>doc_items</code> document
from <code>/collections/{collectionId}/items</code> endpoint and a
<code>doc_item</code> document from
<code>/collections/{collectionId}/items/{itemId}</code> endpoints.
</p>
</li></ul>

<p>The rstac package objects visualization is based on markdown, a
lightweight markup language. You can paste the output into any
markdown editor for a better visualization.
</p>
<p>Call <code>print()</code> function to print the rstac's objects.
You can determine how many items will be printed using <code>n</code> parameter.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'rstac_query'
print(x, ...)

## S3 method for class 'doc_catalog'
print(x, ...)

## S3 method for class 'doc_collections'
print(x, n = 10, ...)

## S3 method for class 'doc_collection'
print(x, ...)

## S3 method for class 'doc_items'
print(x, n = 10, ..., tail = FALSE)

## S3 method for class 'doc_item'
print(x, ...)

## S3 method for class 'doc_queryables'
print(x, n = 10, ...)

## S3 method for class 'doc_conformance'
print(x, n = 10, ...)

## S3 method for class 'doc_link'
print(x, ...)

## S3 method for class 'doc_links'
print(x, n = 10, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print_+3A_x">x</code></td>
<td>
<p>either a <code>rstac_query</code> object expressing a STAC query
criteria or any <code>rstac_doc</code>.</p>
</td></tr>
<tr><td><code id="print_+3A_...">...</code></td>
<td>
<p>other parameters passed in the functions.</p>
</td></tr>
<tr><td><code id="print_+3A_n">n</code></td>
<td>
<p>number of entries to print. Each object has its own rule of
truncation: the <code>doc_collection</code> objects will print
10 links by default. If the object has less than 20 collections, all
collections will be shown. In <code>doc_items</code>, 10 features
will be printed by default. To show all entries, use <code>n = Inf</code>.</p>
</td></tr>
<tr><td><code id="print_+3A_tail">tail</code></td>
<td>
<p>A <code>logical</code> value indicating if last features in
doc_items object must be show.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+stac">stac()</a></code> <code><a href="#topic+stac_search">stac_search()</a></code> <code><a href="#topic+collections">collections()</a></code>
<code><a href="#topic+items">items()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
 # doc_items object
 stac_item_collection &lt;-
   stac("https://brazildatacube.dpi.inpe.br/stac/") %&gt;%
   stac_search(collections = "CB4-16D-2",
          bbox = c(-47.02148, -17.35063, -42.53906, -12.98314),
          limit = 15) %&gt;%
   get_request()

 print(stac_item_collection, n = 10)

 # doc_collections object
 stac_collection &lt;-
     stac("https://brazildatacube.dpi.inpe.br/stac/") %&gt;%
     collections() %&gt;%
     get_request()

 print(stac_collection, n = 5)

 # rstac_query object
 obj_rstac &lt;- stac("https://brazildatacube.dpi.inpe.br/stac/")

 print(obj_rstac)

## End(Not run)
</code></pre>

<hr>
<h2 id='queryables'>Endpoint functions</h2><span id='topic+queryables'></span>

<h3>Description</h3>

<p>The queryables endpoint allows the user to discover which
properties can be used in the filter extension.
This endpoint can be accessed from the catalog (<code style="white-space: pre;">&#8288;/queryables&#8288;</code>)
or from a collection (<code style="white-space: pre;">&#8288;/collections/{collection_id}/queryables&#8288;</code>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>queryables(q)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="queryables_+3A_q">q</code></td>
<td>
<p>a <code>rstac_query</code> object expressing a STAC query criteria.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>rstac_query</code> object with the subclass <code>queryables</code> for <code style="white-space: pre;">&#8288;/queryables&#8288;</code>
endpoint.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ext_filter">ext_filter()</a></code>,  <code><a href="#topic+conformance">conformance()</a></code>, <code><a href="#topic+collections">collections()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Catalog's queryables
stac("https://planetarycomputer.microsoft.com/api/stac/v1") %&gt;%
  queryables() %&gt;% get_request()

# Collection's queryables
stac("https://planetarycomputer.microsoft.com/api/stac/v1") %&gt;%
  collections(collection_id = "sentinel-2-l2a") %&gt;%
  queryables() %&gt;%
  get_request()

## End(Not run)

</code></pre>

<hr>
<h2 id='reexports'>Objects exported from other packages</h2><span id='topic+reexports'></span><span id='topic++25+3E+25'></span>

<h3>Description</h3>

<p>These objects are imported from other packages. Follow the links
below to see their documentation.
</p>

<dl>
<dt>magrittr</dt><dd><p><code><a href="magrittr.html#topic+pipe">%&gt;%</a></code></p>
</dd>
</dl>

<hr>
<h2 id='rstac'>R client library for STAC (rstac)</h2><span id='topic+rstac-package'></span><span id='topic+rstac'></span>

<h3>Description</h3>

<p><img src="../help/figures/logo.png" style='float: right' alt='logo' width='120' />
</p>
<p>Provides functions to access, search and download spacetime earth observation data via SpatioTemporal Asset Catalog (STAC). This package supports the version 1.0.0 (and older) of the STAC specification (<a href="https://github.com/radiantearth/stac-spec">https://github.com/radiantearth/stac-spec</a>). For further details see Simoes et al. (2021) <a href="https://doi.org/10.1109/IGARSS47720.2021.9553518">doi:10.1109/IGARSS47720.2021.9553518</a>.
</p>


<h3>The <code>rstac</code> functions</h3>

<p>The rstac package provides two categories of functions:
API endpoints and data access and organization.
</p>


<h3>STAC API endpoints functions</h3>


<ul>
<li> <p><code><a href="#topic+stac">stac()</a></code>: implements STAC <code style="white-space: pre;">&#8288;/stac&#8288;</code> endpoint for version
0.8.1 or below, and <code>/</code> for versions 0.9.0 or higher.
</p>
</li>
<li> <p><code><a href="#topic+conformance">conformance()</a></code>: implements <code style="white-space: pre;">&#8288;/conformance&#8288;</code> endpoint.
</p>
</li>
<li> <p><code><a href="#topic+collections">collections()</a></code>: implements <code style="white-space: pre;">&#8288;/collections&#8288;</code>
and <code>/collections/{collectionId}</code> endpoints.
</p>
</li>
<li> <p><code><a href="#topic+items">items()</a></code>: implements
<code>/collections/{collectionId}/items</code> and
<code>/collections/{collectionId}/items/{featureId}</code> endpoints.
</p>
</li>
<li> <p><code><a href="#topic+queryables">queryables()</a></code>: implements <code style="white-space: pre;">&#8288;/queryables&#8288;</code> and
<code>/collections/{collectionId}/queryables</code> endpoints.
</p>
</li>
<li> <p><code><a href="#topic+stac_search">stac_search()</a></code>: implements STAC <code style="white-space: pre;">&#8288;/stac/search&#8288;</code>
endpoint for version 0.8.1 or below, and <code style="white-space: pre;">&#8288;/search&#8288;</code> endpoint for
versions 0.9.0 or higher.
</p>
</li>
<li> <p><code><a href="#topic+ext_filter">ext_filter()</a></code>: implements <code style="white-space: pre;">&#8288;/filter&#8288;</code> CQL2 endpoint.
</p>
</li></ul>



<h3>Data access and organization functions</h3>


<ul>
<li> <p><code><a href="#topic+get_request">get_request()</a></code>: makes HTTP GET requests to STAC web service.
</p>
</li>
<li> <p><code><a href="#topic+post_request">post_request()</a></code>: makes HTTP POST requests to STAC web service.
</p>
</li>
<li> <p><code><a href="#topic+items_matched">items_matched()</a></code>: returns how many items matched the
search criteria.
</p>
</li>
<li> <p><code><a href="#topic+items_fetch">items_fetch()</a></code>: fetches all matched items from service.
</p>
</li>
<li> <p><code><a href="#topic+items_filter">items_filter()</a></code>: selects items according to some criteria.
</p>
</li>
<li> <p><code><a href="#topic+items_as_sf">items_as_sf()</a></code>: converts items to a <code>sf</code> object.
</p>
</li>
<li> <p><code><a href="#topic+items_fields">items_fields()</a></code>: help explore fields inside items.
</p>
</li>
<li> <p><code><a href="#topic+items_compact">items_compact()</a></code>: removes all items with empty assets.
</p>
</li>
<li> <p><code><a href="#topic+items_reap">items_reap()</a></code>: extracts contents from items.
</p>
</li>
<li> <p><code><a href="#topic+items_length">items_length()</a></code>: informs how many items are fetched locally.
</p>
</li>
<li> <p><code><a href="#topic+items_sign">items_sign()</a></code>: appends tokens to assets' URL and turn
them accessible.
</p>
</li>
<li> <p><code><a href="#topic+assets_select">assets_select()</a></code>: select assets in items.
</p>
</li>
<li> <p><code><a href="#topic+assets_rename">assets_rename()</a></code>: rename assets in items.
</p>
</li>
<li> <p><code><a href="#topic+assets_url">assets_url()</a></code>: extract all URL to assets in items.
</p>
</li>
<li> <p><code><a href="#topic+assets_download">assets_download()</a></code>: download assets in batch.
</p>
</li></ul>



<h3>Data types</h3>

<p>The package implements the following S3 classes: <code>doc_items</code>,
<code>doc_item</code>, <code>doc_catalog</code>, <code>doc_collections</code> and
<code>doc_collection</code>. These classes are regular lists representing the
corresponding JSON STAC objects.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Felipe Carvalho <a href="mailto:lipecaso@gmail.com">lipecaso@gmail.com</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> Rolf Simoes <a href="mailto:rolfsimoes@gmail.com">rolfsimoes@gmail.com</a>
</p>
</li>
<li><p> Brazil Data Cube Team <a href="mailto:brazildatacube@inpe.br">brazildatacube@inpe.br</a>
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> National Institute for Space Research (INPE) [copyright holder]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://brazil-data-cube.github.io/rstac/">https://brazil-data-cube.github.io/rstac/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/brazil-data-cube/rstac/issues">https://github.com/brazil-data-cube/rstac/issues</a>
</p>
</li></ul>


<hr>
<h2 id='stac'>Endpoint functions</h2><span id='topic+stac'></span>

<h3>Description</h3>

<p>The <code>stac</code> function implements <code style="white-space: pre;">&#8288;/stac&#8288;</code> API
endpoint (&gt;=0.8.0), and <code>/</code> for versions 0.9.0 or higher. It prepares
search field parameters to be provided to a STAC API web service. This
endpoint should return a STAC Catalog document containing all published data
catalogs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stac(base_url, force_version = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stac_+3A_base_url">base_url</code></td>
<td>
<p>a <code>character</code> informing the base URL of a
STAC web service.</p>
</td></tr>
<tr><td><code id="stac_+3A_force_version">force_version</code></td>
<td>
<p>a <code>character</code> providing the version of the STAC
used. If not provided, the rstac package will make requests to try to find
the version of STAC used. It is highly recommended that you inform the STAC
version you are using.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>rstac_query</code> object with the subclass <code>stac</code> containing all
request parameters to be provided to API service.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+stac_search">stac_search()</a></code>, <code><a href="#topic+collections">collections()</a></code>,
<code><a href="#topic+items">items()</a></code>, <code><a href="#topic+get_request">get_request()</a></code>,
<code><a href="#topic+post_request">post_request()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
 stac("https://brazildatacube.dpi.inpe.br/stac/") %&gt;%
   get_request()

## End(Not run)

</code></pre>

<hr>
<h2 id='stac_functions'>Utility functions</h2><span id='topic+stac_functions'></span><span id='topic+stac_version'></span><span id='topic+stac_type'></span>

<h3>Description</h3>

<p>These function retrieves information about either <code>rstac</code> queries
(<code>rstac_query</code> objects) or <code>rstac</code> documents
(<code>rstac_doc</code> objects).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stac_version(x, ...)

stac_type(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stac_functions_+3A_x">x</code></td>
<td>
<p>either a <code>rstac_query</code> object expressing a STAC query
criteria or any <code>rstac_doc</code>.</p>
</td></tr>
<tr><td><code id="stac_functions_+3A_...">...</code></td>
<td>
<p>config parameters to be passed to <a href="httr.html#topic+GET">GET</a>
method, such as <a href="httr.html#topic+add_headers">add_headers</a> or <a href="httr.html#topic+set_cookies">set_cookies</a>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The <code>stac_version()</code> function returns a <code>character</code> STAC API
version.
</p>

<hr>
<h2 id='stac_search'>Endpoint functions</h2><span id='topic+stac_search'></span>

<h3>Description</h3>

<p>(This document is based on STAC specification documentation
<a href="https://github.com/radiantearth/stac-spec/">https://github.com/radiantearth/stac-spec/</a>
and reproduces some of its parts)
</p>
<p>The <code>stac_search</code> function implements <code style="white-space: pre;">&#8288;/stac/search&#8288;</code> API endpoint
(v0.8.1) and <code style="white-space: pre;">&#8288;/search&#8288;</code> (v0.9.0 or v1.0.0).
It prepares query parameters used in the search API request, a
<code>stac</code> object with all filter parameters to be provided to
<code>get_request</code> or <code>post_request</code> functions. The GeoJSON content
returned by these requests is a <code>doc_items</code> object, a regular R
<code>list</code> representing a STAC Item Collection document.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stac_search(
  q,
  collections = NULL,
  ids = NULL,
  bbox = NULL,
  datetime = NULL,
  intersects = NULL,
  limit = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stac_search_+3A_q">q</code></td>
<td>
<p>a <code>rstac_query</code> object expressing a STAC query
criteria.</p>
</td></tr>
<tr><td><code id="stac_search_+3A_collections">collections</code></td>
<td>
<p>a <code>character</code> vector of collection IDs to include in
the search for items. Only items in one of the provided collections will be
searched.</p>
</td></tr>
<tr><td><code id="stac_search_+3A_ids">ids</code></td>
<td>
<p>a <code>character</code> vector with item IDs. All other filters
parameters that further restrict the number of search results are ignored.</p>
</td></tr>
<tr><td><code id="stac_search_+3A_bbox">bbox</code></td>
<td>
<p>a <code>numeric</code> vector with only features that have a
geometry that intersects the bounding box are selected. The bounding box is
provided as four or six numbers, depending on whether the coordinate
reference system includes a vertical axis (elevation or depth):
</p>
 <ul>
<li><p> Lower left corner, coordinate axis 1
</p>
</li>
<li><p> Lower left corner, coordinate axis 2
</p>
</li>
<li><p> Lower left corner, coordinate axis 3 (optional)
</p>
</li>
<li><p> Upper right corner, coordinate axis 1
</p>
</li>
<li><p> Upper right corner, coordinate axis 2
</p>
</li>
<li><p> Upper right corner, coordinate axis 3 (optional) </p>
</li></ul>

<p>The coordinate reference system of the values is WGS84 longitude/latitude
(<a href="http://www.opengis.net/def/crs/OGC/1.3/CRS84">http://www.opengis.net/def/crs/OGC/1.3/CRS84</a>). The values are, in
most cases, the sequence of minimum longitude, minimum latitude, maximum
longitude, and maximum latitude. However, in cases where the box spans the
antimeridian, the first value (west-most box edge) is larger than the third
value (east-most box edge).</p>
</td></tr>
<tr><td><code id="stac_search_+3A_datetime">datetime</code></td>
<td>
<p>a <code>character</code> with a date-time or an interval. Date
and time strings needs to conform to RFC 3339. Intervals are expressed by
separating two date-time strings by <code>'/'</code> character. Open intervals are
expressed by using <code>'..'</code> in place of date-time.
</p>
<p>Examples:
</p>

<ul>
<li><p> A date-time: <code>"2018-02-12T23:20:50Z"</code>
</p>
</li>
<li><p> A closed interval: <code>"2018-02-12T00:00:00Z/2018-03-18T12:31:12Z"</code>
</p>
</li>
<li><p> Open intervals: <code>"2018-02-12T00:00:00Z/.."</code> or
<code>"../2018-03-18T12:31:12Z"</code>
</p>
</li></ul>

<p>Only features that have a <code>datetime</code> property that intersects the
interval or date-time informed in <code>datetime</code> are selected.</p>
</td></tr>
<tr><td><code id="stac_search_+3A_intersects">intersects</code></td>
<td>
<p>a <code>list</code> expressing GeoJSON geometries
objects as specified in RFC 7946. Only returns items that intersect with
the provided geometry. To turn a GeoJSON into a list the package
<code>jsonlite</code> can be used.</p>
</td></tr>
<tr><td><code id="stac_search_+3A_limit">limit</code></td>
<td>
<p>an <code>integer</code> defining the maximum number of results
to return. If not informed, it defaults to the service implementation.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>rstac_query</code> object with the subclass <code>search</code> containing all
search field parameters to be provided to STAC API web service.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+stac">stac()</a></code>, <code><a href="#topic+ext_query">ext_query()</a></code>,
<code><a href="#topic+get_request">get_request()</a></code>, <code><a href="#topic+post_request">post_request()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
 # GET request
 stac("https://brazildatacube.dpi.inpe.br/stac/") %&gt;%
  stac_search(collections = "CB4-16D-2", limit = 10,
         datetime = "2017-08-01/2018-03-01") %&gt;%
  get_request()

 # POST request
 stac("https://brazildatacube.dpi.inpe.br/stac/") %&gt;%
  stac_search(collections = "CB4-16D-2",
         bbox = c(-47.02148, -17.35063, -42.53906, -12.98314)) %&gt;%
  post_request()

## End(Not run)

</code></pre>

<hr>
<h2 id='static_functions'>Static functions</h2><span id='topic+static_functions'></span><span id='topic+read_stac'></span><span id='topic+read_items'></span><span id='topic+read_collections'></span><span id='topic+links'></span><span id='topic+link_open'></span>

<h3>Description</h3>

<p>These functions provide support to work with static catalogs.
</p>

<ul>
<li> <p><code>stac_read()</code>: open a STAC document from an URL.
</p>
</li>
<li> <p><code>read_items()</code>: opens (statically) all items referred in <code>links</code>
key entry of a given collection document (<code>doc_collection</code>).
</p>
</li>
<li> <p><code>links()</code>: extracts and filters the links of any STAC document.
</p>
</li>
<li> <p><code>link_open()</code>: opens (statically) the document referenced by
the link. This function can resolve any relative URL.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>read_stac(url, ...)

read_items(collection, ..., limit = 100, page = 1, progress = TRUE)

read_collections(catalog, ..., limit = 100, page = 1, progress = TRUE)

links(x, ...)

link_open(link, base_url = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="static_functions_+3A_url">url</code></td>
<td>
<p>a <code>character</code> value with the URL to a valid STAC document.</p>
</td></tr>
<tr><td><code id="static_functions_+3A_...">...</code></td>
<td>
<p>additional arguments. See details.</p>
</td></tr>
<tr><td><code id="static_functions_+3A_collection">collection</code></td>
<td>
<p>a <code>doc_collection</code> object to fetch all
<code>rel=="item"</code> links.</p>
</td></tr>
<tr><td><code id="static_functions_+3A_limit">limit</code></td>
<td>
<p>an <code>integer</code> with defining the page size of items to fetch.</p>
</td></tr>
<tr><td><code id="static_functions_+3A_page">page</code></td>
<td>
<p>an <code>integer</code> with the page number to fetch the items.</p>
</td></tr>
<tr><td><code id="static_functions_+3A_progress">progress</code></td>
<td>
<p>a <code>logical</code> indicating if a progress bar must be
shown or not. Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="static_functions_+3A_catalog">catalog</code></td>
<td>
<p>a <code>doc_catalog</code> object to fetch all <code>rel=="child"</code> links.</p>
</td></tr>
<tr><td><code id="static_functions_+3A_x">x</code></td>
<td>
<p>any <code>rstac</code> document with <code>'links'</code> key entry.</p>
</td></tr>
<tr><td><code id="static_functions_+3A_link">link</code></td>
<td>
<p>a <code>doc_link</code> object, usually an element of <code>links</code> key entry.</p>
</td></tr>
<tr><td><code id="static_functions_+3A_base_url">base_url</code></td>
<td>
<p>a <code>character</code> with the base URL to resolve relative links.
If <code>NULL</code> (default) <code>rstac</code> will try resolve relative links using
internal metadata.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Ellipsis argument (<code>...</code>) may appears in different items functions and
has distinct purposes:
</p>

<ul>
<li> <p><code>stac_read()</code>: ellipsis is used to pass any additional parameters
to <a href="jsonlite.html#topic+read_json">read_json</a> function.
</p>
</li>
<li> <p><code>links()</code>: ellipsis is used to pass logical expressions to be
evaluated against a <code>doc_link</code> item as a filter criteria. See examples.
</p>
</li></ul>



<h3>Value</h3>


<ul>
<li> <p><code>links()</code>: a <code>doc_links</code> object containing a list of <code>link</code> entries.
</p>
</li>
<li> <p><code>link_open()</code>: a recognizable <code>rstac</code> document.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
 x &lt;- stac("https://brazildatacube.dpi.inpe.br/stac") %&gt;%
     collections("CB4-16D-2") %&gt;%
     get_request()

 link &lt;- links(x, rel == "items")
 link_open(link[[1]])

## End(Not run)

## Not run: 
 wv_url &lt;- paste0(
   "https://s3.eu-central-1.wasabisys.com",
   "/stac/openlandmap/wv_mcd19a2v061.seasconv/collection.json"
 )
 wv &lt;- read_stac(wv_url)
 stac_type(wv)  # Collection

 # reads the second page of 5 links
 wv_items &lt;- read_items(wv, limit = 5, page = 2)

 # lists all links of the collection document that are not items
 links(wv, rel != "item")

 # lists all links of the items document
 links(wv_items)

## End(Not run)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
