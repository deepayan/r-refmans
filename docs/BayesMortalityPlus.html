<!DOCTYPE html><html><head><title>Help for package BayesMortalityPlus</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {BayesMortalityPlus}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#blc'><p>Lee-Carter Bayesian Estimation for mortality data</p></a></li>
<li><a href='#dlm'><p>Dynamic Linear Model for mortality table graduation</p></a></li>
<li><a href='#dlm_close'><p>DLM: Fitting the advanced ages of the life tables</p></a></li>
<li><a href='#expectancy'><p>Generic expectancy function</p></a></li>
<li><a href='#expectancy.BLC'><p>BLC: Life expectancy</p></a></li>
<li><a href='#expectancy.DLM'><p>DLM: Life expectancy</p></a></li>
<li><a href='#expectancy.HP'><p>HP: Life expectancy</p></a></li>
<li><a href='#fitted.BLC'><p>BLC: Fitted death probabilities (qx)</p></a></li>
<li><a href='#fitted.DLM'><p>DLM: Fitted death probabilities (qx)</p></a></li>
<li><a href='#fitted.HP'><p>HP: Fitted death probabilities (qx)</p></a></li>
<li><a href='#Heatmap'><p>Generic Heatmap function</p></a></li>
<li><a href='#Heatmap.BLC'><p>BLC: Heatmap for the life expectancy</p></a></li>
<li><a href='#Heatmap.DLM'><p>DLM: Heatmap for the life expectancy</p></a></li>
<li><a href='#Heatmap.HP'><p>HP: Heatmap for the life expectancy</p></a></li>
<li><a href='#Heatmap.list'><p>Heatmap for a set of life tables</p></a></li>
<li><a href='#hp'><p>Bayesian Heligman-Pollard curve for mortality table graduation</p></a></li>
<li><a href='#hp_close'><p>HP: Fitting the advanced ages of the life tables</p></a></li>
<li><a href='#hp_mix'><p>HP: Model mixture</p></a></li>
<li><a href='#improvement'><p>BLC: Improvement</p></a></li>
<li><a href='#mean.BLC'><p>BLC: Arithmetic mean</p></a></li>
<li><a href='#mean.PredBLC'><p>BLC: Arithmetic mean for predictions</p></a></li>
<li><a href='#plot_chain'><p>Chain's plot</p></a></li>
<li><a href='#plot.BLC'><p>BLC: Plot the fitted values</p></a></li>
<li><a href='#plot.DLM'><p>DLM: Plot the life table</p></a></li>
<li><a href='#plot.HP'><p>HP: Plot the life table</p></a></li>
<li><a href='#plot.list'><p>Plot a set of life tables</p></a></li>
<li><a href='#plot.PredBLC'><p>BLC: Plot the log-mortality of a prediction</p></a></li>
<li><a href='#predict.BLC'><p>BLC: Forecasting</p></a></li>
<li><a href='#predict.DLM'><p>DLM: Prediction of death probability</p></a></li>
<li><a href='#print.BLC'><p>BLC: Print</p></a></li>
<li><a href='#print.DLM'><p>DLM: Print</p></a></li>
<li><a href='#print.HP'><p>HP: Print</p></a></li>
<li><a href='#PT'><p>Mortality Data from Portugal to be used as example</p></a></li>
<li><a href='#quantile.BLC'><p>BLC: Sample quantiles</p></a></li>
<li><a href='#quantile.PredBLC'><p>BLC: Sample quantiles for predictions</p></a></li>
<li><a href='#summary.DLM'><p>DLM: Summary</p></a></li>
<li><a href='#summary.HP'><p>HP: Summary</p></a></li>
<li><a href='#USA'><p>Mortality Database from United States to be used as example</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Bayesian Mortality Modelling</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.4</td>
</tr>
<tr>
<td>Author:</td>
<td>Laboratorio de Matematica Aplicada (IM/UFRJ) </td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Luiz Fernando Figueiredo &lt;labmapackage@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Fit Bayesian graduation mortality using the Heligman-Pollard model, as seen in Heligman, L., &amp; Pollard, J. H. (1980) &lt;<a href="https://doi.org/10.1017%2FS0020268100040257">doi:10.1017/S0020268100040257</a>&gt; and Dellaportas, Petros, et al. (2001) &lt;<a href="https://doi.org/10.1111%2F1467-985X.00202">doi:10.1111/1467-985X.00202</a>&gt;, and dynamic linear model (Campagnoli, P., Petris, G., and Petrone, S. (2009) &lt;<a href="https://doi.org/10.1007%2Fb135794_2">doi:10.1007/b135794_2</a>&gt;). While Heligman-Pollard has parameters with a straightforward interpretation yielding some rich analysis, the dynamic linear model provides a very flexible adjustment of the mortality curves by controlling the discount factor value. Closing methods for both Heligman-Pollard and dynamic linear model were also implemented according to Dodd, Erengul, et al. (2018) <a href="https://www.jstor.org/stable/48547511">https://www.jstor.org/stable/48547511</a>. The Bayesian Lee-Carter model is also implemented to fit historical mortality tables time series to predict the mortality in the following years and to do improvement analysis, as seen in Lee, R. D., &amp; Carter, L. R. (1992) &lt;<a href="https://doi.org/10.1080%2F01621459.1992.10475265">doi:10.1080/01621459.1992.10475265</a>&gt; and Pedroza, C. (2006) &lt;<a href="https://doi.org/10.1093%2Fbiostatistics%2Fkxj024">doi:10.1093/biostatistics/kxj024</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>MASS, progress, tidyr, scales, utils, ggplot2, magrittr,
dplyr, mvtnorm</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Collate:</td>
<td>'Heatmap_default.R' 'PT.R' 'USA.R' 'blc.R' 'ffbs.R' 'dlm.R'
'gompertz_dlm.R' 'dlm_close.R' 'expectancy_blc.R'
'expectancy_default.R' 'fitted_dlm.R' 'expectancy_dlm.R'
'fun_aux.R' 'fitted_hp.R' 'expectancy_hp.R' 'fitted_blc.R'
'globals.R' 'heatmap_blc.R' 'heatmap_dlm.R' 'heatmap_hp.R'
'heatmap_list.R' 'hp_poisson_reduced.R'
'hp_lognormal_reduced.R' 'hp_binomial_reduced.R' 'hp_poisson.R'
'hp_lognormal.R' 'hp_binomial.R' 'hp.R' 'sir_gompertz.R'
'hp_close.R' 'hp_mix.R' 'improvement.R' 'kd_filter.R'
'kd_smoother.R' 'mean_blc.R' 'mean_blc_pred.R' 'plot_blc.R'
'plot_blc_pred.R' 'plot_chain.R' 'plot_dlm.R' 'plot_hp.R'
'plot_list.R' 'predict_blc.R' 'predict_dlm.R' 'print_blc.R'
'print_blc_pred.R' 'print_dlm.R' 'print_hp.R' 'quantile_blc.R'
'quantile_blc_pred.R' 'summary_dlm.R' 'summary_hp.R'</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-06-04 13:55:34 UTC; l_fer</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-06-04 16:20:11 UTC</td>
</tr>
</table>
<hr>
<h2 id='blc'>Lee-Carter Bayesian Estimation for mortality data</h2><span id='topic+blc'></span>

<h3>Description</h3>

<p>Performs Bayesian estimation of the Lee-Carter model considering different
variances for each age.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>blc(Y, prior = NULL, init = NULL, M = 5000, bn = 4000, thin = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="blc_+3A_y">Y</code></td>
<td>
<p>Log-mortality rates for each age.</p>
</td></tr>
<tr><td><code id="blc_+3A_prior">prior</code></td>
<td>
<p>A list containing the prior mean <code class="reqn">m_0</code> and the prior
variance <code class="reqn">C_0</code>.</p>
</td></tr>
<tr><td><code id="blc_+3A_init">init</code></td>
<td>
<p>A list containing initial values for <code class="reqn">\alpha</code>, <code class="reqn">\beta</code>,
<code class="reqn">\phi_V</code>, <code class="reqn">\phi_W</code> and <code class="reqn">\theta</code>.</p>
</td></tr>
<tr><td><code id="blc_+3A_m">M</code></td>
<td>
<p>The number of iterations. The default value is 5000.</p>
</td></tr>
<tr><td><code id="blc_+3A_bn">bn</code></td>
<td>
<p>The number of initial iterations from the Gibbs sampler that should be discarded (burn-in). The default value is 4000.</p>
</td></tr>
<tr><td><code id="blc_+3A_thin">thin</code></td>
<td>
<p>A Positive integer specifying the period for saving samples. The default value is 1.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Let <code class="reqn">Y_{it}</code> be the log mortality rate at age <code class="reqn">i</code> and time <code class="reqn">t</code>. The Lee-Carter
model is specified as follows:
</p>
<p><code class="reqn">Y_{it} = \alpha_i + \beta_i \kappa_t + \varepsilon_{it}, i=1,...,p</code> and <code class="reqn">t=1,...,T</code>,
</p>
<p>where <code class="reqn">\alpha = (\alpha_1,...,\alpha_p)'</code> are the interept of the model that represent
the log-mortality rate mean in each age; <code class="reqn">\beta = (\beta_1,...,\beta_p)'</code> are the
coefficient regression that represent the speed of relative change in the log-mortality
rate in each age. <code class="reqn">\kappa = (\kappa_1,...,\kappa_T)'</code> are the state variable that
represent the global relative change in log-mortality rate. Finally, <code class="reqn">\varepsilon_{it} ~ N(0, \sigma^2_i)</code>
is the random error.
</p>
<p>For the state variable <code class="reqn">\kappa_t</code> Lee and Carter (1992) proposed a random walk with
drift to govern the dynamics over time:
</p>
<p><code class="reqn">\kappa_t = \kappa_{t-1} + \theta + \omega_t</code>,
</p>
<p>where <code class="reqn">\theta</code> is the drift parameter and <code class="reqn">\omega_t</code> is the random error of the
random walk.
</p>
<p>We implement the Bayesian Lee Carter (BLC) model, proposed by Pedroza (2006), to estimate
the model. In this approach, we take advantage of the fact that the Bayesian Lee Carter
can be specified as dynamic linear model, to estimate the state variables <code class="reqn">\kappa_t</code>
through FFBS algorithm. To estimate the others parameters we use Gibbs sampler to sample
from their respective posterior distribution.
</p>


<h3>Value</h3>

<p>A <code>BLC</code> object.
</p>
<table>
<tr><td><code>alpha</code></td>
<td>
<p>Posterior sample from alpha parameter.</p>
</td></tr>
<tr><td><code>beta</code></td>
<td>
<p>Posterior sample from beta parameter.</p>
</td></tr>
<tr><td><code>phiv</code></td>
<td>
<p>Posterior sample from phiv parameter. phiv is the precision of the random error of the Lee Carter model.</p>
</td></tr>
<tr><td><code>theta</code></td>
<td>
<p>Posterior sample from theta.</p>
</td></tr>
<tr><td><code>phiw</code></td>
<td>
<p>Posterior sample from phiw. phiw is the precision of the random error of the random walk.</p>
</td></tr>
<tr><td><code>kappa</code></td>
<td>
<p>Sampling from the state variables.</p>
</td></tr>
<tr><td><code>Y</code></td>
<td>
<p>Y Log-mortality rates for each age passed by the user to fit the model.</p>
</td></tr>
<tr><td><code>bn</code></td>
<td>
<p>The warmup of the algorithm specified by the user to fit the model.</p>
</td></tr>
<tr><td><code>M</code></td>
<td>
<p>The number of iterations specified by the user to fit the model.</p>
</td></tr>
<tr><td><code>m0</code></td>
<td>
<p>The prior mean of kappa0.</p>
</td></tr>
<tr><td><code>C0</code></td>
<td>
<p>The prior covariance matrix of kappa0.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Lee, R. D., &amp; Carter, L. R. (1992). “Modeling and forecasting US mortality.” <em>Journal of the American statistical association</em>, 87(419), 659-671.
</p>
<p>Pedroza, C. (2006). “A Bayesian forecasting model: predicting US male mortality.” <em>Biostatistics</em>, 7(4), 530-550.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitted.BLC">fitted.BLC()</a></code>, <code><a href="#topic+plot.BLC">plot.BLC()</a></code>, <code><a href="#topic+print.BLC">print.BLC()</a></code> and <code><a href="#topic+predict.BLC">predict.BLC()</a></code> for <code>BLC</code> methods to native R functions <code><a href="stats.html#topic+fitted">fitted()</a></code>,
<code><a href="base.html#topic+plot">plot()</a></code>, <code><a href="base.html#topic+print">print()</a></code> and <code><a href="stats.html#topic+predict">predict()</a></code>.
</p>
<p><code><a href="#topic+expectancy.BLC">expectancy.BLC()</a></code> and <code><a href="#topic+Heatmap.BLC">Heatmap.BLC()</a></code> for <code>BLC</code> methods to compute and visualise the truncated life expectancy
via <code><a href="#topic+expectancy">expectancy()</a></code> and <code><a href="#topic+Heatmap">Heatmap()</a></code> functions.
</p>
<p><code><a href="#topic+improvement">improvement()</a></code> to compute the improvement of each age, based on the resulting chains of the beta parameter.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Example of transforming the dataset to fit the function:

## Importing mortality data from the USA available on the Human Mortality Database (HMD):
data(USA)

## Calculating the mortality rates for the general population:
require(dplyr)
require(tidyr)
require(magrittr)

USA %&gt;% mutate(mx = USA$Dx.Total/USA$Ex.Total) -&gt; data

data %&gt;%
	filter(Age %in% 18:80 &amp; Year %in% 2000:2015)  %&gt;%
	mutate(logmx = log(mx)) %&gt;%
	dplyr::select(Year,Age,logmx) %&gt;%
	pivot_wider(names_from = Year, values_from = logmx) %&gt;%
	dplyr::select(-Age) %&gt;%
	as.matrix()  %&gt;%
	magrittr::set_rownames(18:80) -&gt; Y

## Fitting the model
fit = blc(Y = Y, M = 100, bn = 20)
print(fit)

## Viewing the results
plot(fit, ages = 18:80)
plot(fit, parameter = "beta", ages=18:80)
improvement(fit)

</code></pre>

<hr>
<h2 id='dlm'>Dynamic Linear Model for mortality table graduation</h2><span id='topic+dlm'></span>

<h3>Description</h3>

<p>This function fits a Dynamic Linear Model (DLM) for mortality data following
a Bayesian framework using Forward Filtering Backward Sampling algorithm to compute the posterior distribution.
The response variable is the log of the mortality rate, and it is modeled specifying the matrices Ft and Gt from the DLM equations.
Furthermore, the discount factor is used to control the smoothness of the fitted model. By default, a
linear growth model is specified.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dlm(y, Ft = matrix(c(1,0), nrow = 1), Gt = matrix(c(1,0,1,1), 2), delta = 0.85,
    prior = list(m0 = rep(0, nrow(Gt)), C0 = diag(100, nrow(Gt))),
    prior.sig2 = list(a = 0, b = 0), M = 2000, ages = 0:(length(y)-1))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dlm_+3A_y">y</code></td>
<td>
<p>Numeric vector of log mortality rates.</p>
</td></tr>
<tr><td><code id="dlm_+3A_ft">Ft</code></td>
<td>
<p>1xp Matrix that specifies the observation equation, where p is the number of parameters. By default, 'Ft = matrix(c(1,0), nrow = 1)'.</p>
</td></tr>
<tr><td><code id="dlm_+3A_gt">Gt</code></td>
<td>
<p>pxp Matrix that specifies the system equations. By default, Gt = matrix(c(1,0,1,1), 2).</p>
</td></tr>
<tr><td><code id="dlm_+3A_delta">delta</code></td>
<td>
<p>Positive real value or real vector of the same length as y with values in the '(0, 1)' interval specifying the discount factor for each age. A higher value of delta results in a higher smoothness of the fitted curve. If a single value is defined, this same value is used for all ages. By default, delta is '0.85'.</p>
</td></tr>
<tr><td><code id="dlm_+3A_prior">prior</code></td>
<td>
<p>A list with the prior mean vector <code class="reqn">(m_0)</code> and covariance matrix <code class="reqn">(C_0)</code> of <code class="reqn">\theta_0</code> (state vector at time (age) t = 0). By default mean of zeros and diagonal matrix with a common variance 100 is used. Each element of the list must be named accordingly with the parameter (m0 for mean vector and C0 for covariance matrix).</p>
</td></tr>
<tr><td><code id="dlm_+3A_prior.sig2">prior.sig2</code></td>
<td>
<p>A list with the prior parameters (a, b) of Inverted Gamma distribution for <code class="reqn">\sigma^2</code>. Each element of the list must be named accordingly with the parameter (a for shape parameter and b for scale parameter).</p>
</td></tr>
<tr><td><code id="dlm_+3A_m">M</code></td>
<td>
<p>Positive integer that indicates the sampling size from the posterior distributions. The default value is 2000.</p>
</td></tr>
<tr><td><code id="dlm_+3A_ages">ages</code></td>
<td>
<p>Numeric vector of the ages fitted. Default is '0:(length(y)-1)'.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Let <code class="reqn">Y_t</code> be the log mortality rate at age <code class="reqn">t</code>. A DLM is specified as follows:
</p>
<p>For <code class="reqn">t = 0</code>:
</p>
<p><code class="reqn">\theta_0 \sim N_p (m_0, C_0)</code>
</p>
<p>Now, for <code class="reqn">t \geq 1</code>:
</p>
<p>The observation equation:
</p>
<p><code class="reqn">Y_t = F_t \theta_t + v_t</code>
</p>
<p>The system equation:
</p>
<p><code class="reqn">\theta_t = G_t \theta_{t-1} + w_t</code>
</p>
<p>Where <code class="reqn">F_t</code> and <code class="reqn">G_t</code> are known matrices. <code class="reqn">v_t</code> and <code class="reqn">w_t</code> are independent
random errors with <code class="reqn">v_t \sim N(0, \sigma^2)</code> and <code class="reqn">w_t \sim N(0, \sigma^2 W_t)</code>. We
use the discount factors <code class="reqn">\delta</code> to specify <code class="reqn">W_t</code> as <code class="reqn">W_t = C_t(1-\delta)/\delta</code>,
where <code class="reqn">C_t</code> is the conditional covariance matrix of <code class="reqn">\theta_t</code>. So, if
<code class="reqn">\delta = 0</code> there is no loss information as <code class="reqn">t</code> increase (completely reducing the
smoothness of the fitted curve). <code class="reqn">\delta</code> can be specified as a single value for all ages
or as a vector in which each element is associated with an age.
</p>
<p>A scheme described by (Petris et al, 2009) for conjugated inference is used.
For more details, see (Petris et al, 2009).
</p>


<h3>Value</h3>

<p>A DLM class object.
</p>
<table>
<tr><td><code>mu</code></td>
<td>
<p>Posterior samples from <code class="reqn">\mu_t = F_t \theta_t</code>, for all t.</p>
</td></tr>
<tr><td><code>theta</code></td>
<td>
<p>Posterior samples from <code class="reqn">\theta_t</code>, for all t.</p>
</td></tr>
<tr><td><code>sig2</code></td>
<td>
<p>Posterior samples from <code class="reqn">\sigma^2</code>.</p>
</td></tr>
<tr><td><code>param</code></td>
<td>
<p>A list with the states parameters for filtering distribution (mt, Ct), predictive distribution (ft, Qt), smoothing distribution (as, Rs), and parameters of the posterior distribution for variance (alpha, beta).</p>
</td></tr>
<tr><td><code>info</code></td>
<td>
<p>A list with some informations of the fitted model: the specification of <code class="reqn">F_t</code> and <code class="reqn">G_t</code> matrices, the data y and the ages, the discount factor <code class="reqn">delta</code> value specified and priors informations.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Campagnoli, P., Petris, G., and Petrone, S. (2009). <em>Dynamic linear models with R</em>. Springer-Verlag New York.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitted.DLM">fitted.DLM()</a></code>, <code><a href="#topic+predict.DLM">predict.DLM()</a></code>, <code><a href="#topic+plot.DLM">plot.DLM()</a></code>, <code><a href="#topic+print.DLM">print.DLM()</a></code> and <code><a href="#topic+summary.DLM">summary.DLM()</a></code> for <code>DLM</code> methods to native R functions <code><a href="stats.html#topic+fitted">fitted()</a></code>,
<code><a href="base.html#topic+plot">plot()</a></code>, <code><a href="base.html#topic+print">print()</a></code> and <code><a href="base.html#topic+summary">summary()</a></code>.
</p>
<p><code><a href="#topic+expectancy.DLM">expectancy.DLM()</a></code> and <code><a href="#topic+Heatmap.DLM">Heatmap.DLM()</a></code> for <code>DLM</code> methods to compute and visualise the truncated life expectancy
via <code><a href="#topic+expectancy">expectancy()</a></code> and <code><a href="#topic+Heatmap">Heatmap()</a></code> functions.
</p>
<p><code><a href="#topic+dlm_close">dlm_close()</a></code> for close methods to expand the life tables.
</p>
<p><code><a href="#topic+plot_chain">plot_chain()</a></code> to visualise the markov chains, respectively.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing mortality data from the USA available on the Human Mortality Database (HMD):
data(USA)

## Selecting the log mortality rate of the 2010 male population ranging from 0 to 100 years old
USA2010 = USA[USA$Year == 2010,]
x = 0:100
Ex = USA2010$Ex.Male[x+1]
Dx = USA2010$Dx.Male[x+1]
y = log(Dx/Ex)

## Fitting DLM
fit = dlm(y)
print(fit)
summary(fit)

## Using other functions available in the package:
## plotting (See "?plot.DLM" in the BayesMortality package for more options):
plot(fit)

## qx estimation (See "?fitted.DLM" in the BayesMortality package for more options):
fitted(fit)

## chain's plot (See "?plot_chain" for more options):
plot_chain(fit, param = c("mu[0]", "mu[100]"))

## Varying discount factor
fit2 = dlm(y, delta = c(rep(0.8, 36), rep(0.9, 65)))
plot(fit2)


</code></pre>

<hr>
<h2 id='dlm_close'>DLM: Fitting the advanced ages of the life tables</h2><span id='topic+dlm_close'></span>

<h3>Description</h3>

<p>This function receives an object of the class <code>DLM</code> fitted by the dlm() function
and fits a closing method to expand the life tables dataset to a maximum age argument inputed
by the user.
There are three closing methods available: 'linear', 'gompertz' and 'plateau'.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dlm_close(fit, method = c("linear", "gompertz", "plateau"),
          x0 = max(fit$info$ages), max_age = 120, k = 7,
          weights = seq(from = 0, to = 1, length.out = k),
          new_data = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dlm_close_+3A_fit">fit</code></td>
<td>
<p>Object of the class <code>DLM</code> adjusted by the dlm() function.</p>
</td></tr>
<tr><td><code id="dlm_close_+3A_method">method</code></td>
<td>
<p>Character string specifying the closing method to be fitted, with them being: 'plateau', 'linear' or 'gompertz'.</p>
</td></tr>
<tr><td><code id="dlm_close_+3A_x0">x0</code></td>
<td>
<p>Integer with the starting age the closing method will be fitted from. Default is the last age fitted by the 'DLM' object.</p>
</td></tr>
<tr><td><code id="dlm_close_+3A_max_age">max_age</code></td>
<td>
<p>Integer with the maximum age the closing method will be fitted. Default age is '120'.</p>
</td></tr>
<tr><td><code id="dlm_close_+3A_k">k</code></td>
<td>
<p>Integer representing the size of the age-interval to be mixed with the 'linear' or 'gompertz' closing methods for a smooth graduation. If k = 0, no mixing will be made. Default: 7.</p>
</td></tr>
<tr><td><code id="dlm_close_+3A_weights">weights</code></td>
<td>
<p>Vector of weights of the closing method used in the mixture of the closing method and the fitted model made in the mixing age group. The vector's size should be equal to 2k+1. For a better understanding of this parameter and the mixture applied in this function, see Details.</p>
</td></tr>
<tr><td><code id="dlm_close_+3A_new_data">new_data</code></td>
<td>
<p>Vector containing the log mortality rates of ages after the x0 input. This is an optional argument used in the 'linear' and 'Gompertz' closing methods.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>#' There are three types of age groups when the closing method is applied: a group
where only the fitted model (DLM) computes the death probabilities, followed by a
group in which the death probabilities are a mix (or more precise a weighted mean)
from the HP model and the closing method and followed by a group in which the
death probabilities are computed just by the closing method. The mix is applied
so the transition of the death probabilities of the ages between the fitted model
and the closing method occurs smoothly.
</p>
<p>The parameters 'x0' and 'k' define the mixing group age. The parameter 'x0'
indicates the center age of the group. The parameter 'k' is the range of ages
before 'x0' and after 'x0', so this group has a total of <code class="reqn">2k + 1</code> age. Therefore,
the parameter 'weights' must have a length size equal to <code class="reqn">2k + 1</code>. In this case,
the death probability is calculated as follows. Consider <code class="reqn">model_x</code> and <code class="reqn">close_x</code>
as the death probability of the fitted model and closing method in the age <code class="reqn">x</code>,
respectively. Then, the resulting death probability of the mix is calculated as:
</p>
<p><code class="reqn">q_x = w_x model_x + (1-w_x)close_x</code>,
</p>
<p>where <code class="reqn">w_x</code> represents the weight of the closing method in the age <code class="reqn">x</code>. This
procedure is applied only in the linear and Gompertz methods.
</p>
<p>The three closing methods implemented by the function are:
</p>
<p>1.'linear' method: Fits a linear regression starting at age x0 - k until the last age with data available
</p>
<p>2.'gompertz' method: Used as the closing method of the 2010-2012 English Life Table No. 17, fits the Gompertz mortality law via SIR using the same available data as the 'linear' method.
</p>
<p>3.'plateau' method: Keeps the death probability (qx) constant after the x0 argument.
</p>


<h3>Value</h3>

<p>Returns a <code>ClosedDLM</code> class object with the predictive chains of the death probability
(qx) from first fitted age to max_age argument, the data information utilized by the function and the
closing method chosen.
</p>


<h3>References</h3>

<p>Dodd, Erengul, Forster, Jonathan, Bijak, Jakub, &amp; Smith, Peter 2018. “Smoothing mortality data: the English life table, 2010-12.” <em>Journal of the Royal Statistical Society: Series A (Statistics in Society)</em>, 181(3), 717-735.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitted.DLM">fitted.DLM()</a></code>, <code><a href="#topic+plot.DLM">plot.DLM()</a></code>, <code><a href="#topic+print.DLM">print.DLM()</a></code> and <code><a href="#topic+summary.DLM">summary.DLM()</a></code> for <code>ClosedDLM</code> methods to native R functions <code><a href="stats.html#topic+fitted">fitted()</a></code>,
<code><a href="base.html#topic+plot">plot()</a></code>, <code><a href="base.html#topic+print">print()</a></code> and <code><a href="base.html#topic+summary">summary()</a></code>.
</p>
<p><code><a href="#topic+expectancy.DLM">expectancy.DLM()</a></code> and <code><a href="#topic+Heatmap.DLM">Heatmap.DLM()</a></code> for <code>ClosedDLM</code> methods to compute and visualise the truncated life expectancy
via <code><a href="#topic+expectancy">expectancy()</a></code> and <code><a href="#topic+Heatmap">Heatmap()</a></code> functions.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing mortality data from the USA available on the Human Mortality Database (HMD):
data(USA)

## Selecting the exposure and the death count of the year 2010, ranging from 0 to 90 years old:
USA2010 = USA[USA$Year == 2010,]
x = 0:100
Ex = USA2010$Ex.Male[x+1]
Dx = USA2010$Dx.Male[x+1]
y &lt;- log(Dx/Ex)

fit &lt;- dlm(y, M = 100)

## Applying the closing function with different methods:
close1 = dlm_close(fit, method = "plateau")

### Getting new data for the linear and gompertz methods:::
x2 = 101:110
Ex2 = USA2010$Ex.Male[x2+1]
Dx2 = USA2010$Dx.Male[x2+1]
y2 &lt;- log(Dx2/Ex2)

close2 = dlm_close(fit, method = "linear",
                  new_data = y2)

#### Using the other functions available in the package with the 'ClosedDLM' object:

## qx estimation (See "?fitted" in the BayesMortalityPlus package for more options):
fitted(close2)

## life expectancy (See "?expectancy.DLM" for more options)
expectancy(close2, age = seq(0,120,by=20), graph = FALSE)

## plotting (See "?plot" in the BayesMortalityPlus package for more options):
plot(list(close1, close2, fit),
     colors = c("red4","seagreen", "blue"),
     labels = c("Plateau method","Linear method", "DLM fitted"),
     plotData = FALSE)


</code></pre>

<hr>
<h2 id='expectancy'>Generic expectancy function</h2><span id='topic+expectancy'></span>

<h3>Description</h3>

<p>Generic function to <code>expectancy</code> method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expectancy(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="expectancy_+3A_x">x</code></td>
<td>
<p>Object of one of these class: <code>HP</code>, <code>DLM</code>, <code>BLC</code>, <code>ClosedHP</code>, <code>ClosedDLM</code>, <code>BLC</code>, or <code>PredBLC</code>.</p>
</td></tr>
<tr><td><code id="expectancy_+3A_...">...</code></td>
<td>
<p>Further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function computes the life expectancy given by:
</p>
<p><code class="reqn">e_x = \sum tp_x</code>
</p>
<p>where:
</p>
<p><code class="reqn">tp_x = p_0 x p_1 x ... x p_x</code>
</p>


<h3>Value</h3>

<p>A data.frame and (if graph = TRUE) a plot for <code>HP</code>, <code>DLM</code>, <code>ClosedHP</code> and <code>ClosedDLM</code> methods.
A list that contains three vectors with the fitted values of life expectancy and the lower and upper limits of the credible intervals for each year used in fitted model or for the prediction, for <code>BLC</code> and <code>PredBLC</code> methods.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+expectancy.HP">expectancy.HP()</a></code>, <code><a href="#topic+expectancy.DLM">expectancy.DLM()</a></code> and <code><a href="#topic+expectancy.BLC">expectancy.BLC()</a></code>.
</p>

<hr>
<h2 id='expectancy.BLC'>BLC: Life expectancy</h2><span id='topic+expectancy.BLC'></span>

<h3>Description</h3>

<p>Computes the fitted life expectancy for a specific age for each year in fit or prediction. It also calculates the limits of credible intervals.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'BLC'
expectancy(x, at = NULL, prob = 0.95, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="expectancy.BLC_+3A_x">x</code></td>
<td>
<p>A <code>BLC</code> or <code>PredBLC</code> object.</p>
</td></tr>
<tr><td><code id="expectancy.BLC_+3A_at">at</code></td>
<td>
<p>A number that determines at which age the expectancy life is calculated based on the ages used in fit or prediction. For instance, at = 0 is related to the first age used in fitted model.</p>
</td></tr>
<tr><td><code id="expectancy.BLC_+3A_prob">prob</code></td>
<td>
<p>A number that specifies the probability of the credible interval. Default is '0.95'.</p>
</td></tr>
<tr><td><code id="expectancy.BLC_+3A_...">...</code></td>
<td>
<p>Further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list that contains three vectors with the fitted values of life expectancy and the lower and upper limits of the credible intervals for each year used in fitted model or for the prediction.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+expectancy.HP">expectancy.HP()</a></code> and <code><a href="#topic+expectancy.DLM">expectancy.DLM()</a></code> for <code>HP</code> and <code>DLM</code> methods.
</p>
<p><code><a href="#topic+Heatmap.BLC">Heatmap.BLC()</a></code> for <code>BLC</code> method to drawing a Heatmap for the truncated life expectancy.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing log-mortality data from Portugal:
data(PT)
Y &lt;- PT

## Fitting the model
fit = blc(Y = Y, M = 100, bn = 20)

## Life expectancy for the years used in model fitted
expectancy(fit)

## Life expectancy for the tenth and thirtieth age in the years used in
## model fitted (27 and 47 y.o.)
expectancy(fit, at = c(10,30))

</code></pre>

<hr>
<h2 id='expectancy.DLM'>DLM: Life expectancy</h2><span id='topic+expectancy.DLM'></span>

<h3>Description</h3>

<p>This function computes the life expectancy for each age for Dynamic Linear model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'DLM'
expectancy(
  x,
  age = seq(0, max(fit$info$ages), by = 10),
  graph = TRUE,
  max_age = 110,
  prob = 0.95,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="expectancy.DLM_+3A_x">x</code></td>
<td>
<p>Object of the following classes: <code>DLM</code> or <code>ClosedDLM</code>.</p>
</td></tr>
<tr><td><code id="expectancy.DLM_+3A_age">age</code></td>
<td>
<p>Numeric vector specifying the ages to calculate the life expectancy. The default is a sequence (0, 10, 20, ...) until the last decade used in the fitted model.</p>
</td></tr>
<tr><td><code id="expectancy.DLM_+3A_graph">graph</code></td>
<td>
<p>Logical value (TRUE ou FALSE). If TRUE, it also returns a plot. The default value is TRUE.</p>
</td></tr>
<tr><td><code id="expectancy.DLM_+3A_max_age">max_age</code></td>
<td>
<p>Positive number indicating the last age to be considered to compute the life expectancy (prediction will be considered to match the age interval if needed). This argument is only necessary with objects of the class <code>DLM</code>.</p>
</td></tr>
<tr><td><code id="expectancy.DLM_+3A_prob">prob</code></td>
<td>
<p>A number specifying the probability of credible interval. The default value is 0.95.</p>
</td></tr>
<tr><td><code id="expectancy.DLM_+3A_...">...</code></td>
<td>
<p>Further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame and (if graph = TRUE) a plot.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+expectancy.HP">expectancy.HP()</a></code> and <code><a href="#topic+expectancy.BLC">expectancy.BLC()</a></code> for <code>HP</code> and <code>BLC</code> methods.
</p>
<p><code><a href="#topic+Heatmap.DLM">Heatmap.DLM()</a></code> and <code><a href="#topic+Heatmap.list">Heatmap.list()</a></code> for <code>DLM</code> or <code>list</code> methods to drawing a Heatmap for the truncated life expectancy.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing mortality data from the USA available on the Human Mortality Database (HMD):
data(USA)

# Example 1: --------------------------------

USA1990 = USA[USA$Year == 1990,]

Ex = USA1990$Ex.Total[1:111]
Dx = USA1990$Dx.Total[1:111]
y &lt;- log(Dx/Ex)

fit &lt;- dlm(y, M = 100)
expectancy(fit)

# Example 2: -------------------------------

# Using some arguments:

expectancy(fit, age = c(0,20,30,60),
prob = 0.99, max_age = 90, graph = FALSE)


</code></pre>

<hr>
<h2 id='expectancy.HP'>HP: Life expectancy</h2><span id='topic+expectancy.HP'></span>

<h3>Description</h3>

<p>This function computes the life expectancy for each age for Heligman-Pollard model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'HP'
expectancy(
  x,
  Ex = NULL,
  age = NULL,
  graph = TRUE,
  max_age = 110,
  prob = 0.95,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="expectancy.HP_+3A_x">x</code></td>
<td>
<p>Object of the class <code>HP</code> or <code>ClosedHP</code> fitted by hp() or hp_close() functions.</p>
</td></tr>
<tr><td><code id="expectancy.HP_+3A_ex">Ex</code></td>
<td>
<p>Numeric vector with the exposure by age. This argument is only necessary when using poisson and binomial models with objects of the class <code>HP</code>.</p>
</td></tr>
<tr><td><code id="expectancy.HP_+3A_age">age</code></td>
<td>
<p>Numeric vector specifying the ages to calculate the life expectancy. The default is a sequence (0, 10, 20, ...) until the last decade used in the fitted model.</p>
</td></tr>
<tr><td><code id="expectancy.HP_+3A_graph">graph</code></td>
<td>
<p>Logical value (TRUE ou FALSE). If TRUE, it returns a plot.</p>
</td></tr>
<tr><td><code id="expectancy.HP_+3A_max_age">max_age</code></td>
<td>
<p>Positive number indicating the last age to be considered to compute the life expectancy (extrapolation will be considered to match the age interval if needed). This argument is only necessary with objects of the class <code>HP</code>.</p>
</td></tr>
<tr><td><code id="expectancy.HP_+3A_prob">prob</code></td>
<td>
<p>A percentage specifying the probability of credible interval.</p>
</td></tr>
<tr><td><code id="expectancy.HP_+3A_...">...</code></td>
<td>
<p>Further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame and (if graph = TRUE) a plot.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+expectancy.DLM">expectancy.DLM()</a></code> and <code><a href="#topic+expectancy.BLC">expectancy.BLC()</a></code> for <code>DLM</code> and <code>BLC</code>  methods.
</p>
<p><code><a href="#topic+Heatmap.HP">Heatmap.HP()</a></code> and <code><a href="#topic+Heatmap.list">Heatmap.list()</a></code> for <code>HP</code> or <code>list</code> methods to drawing a Heatmap for the truncated life expectancy.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing mortality data from the USA available on the Human Mortality Database (HMD):
data(USA)

# Example 1: --------------------------------

USA1990 = USA[USA$Year == 1990,]

Ex = USA1990$Ex.Total[1:91]
Dx = USA1990$Dx.Total[1:91]
x = 0:90

fit &lt;- hp(x, Ex, Dx, model = "binomial", M = 1000, bn = 0, thin = 10)
expectancy(fit)


# Example 2: -------------------------------

# Using some arguments:

Ex = USA1990$Ex.Total[1:106]

expectancy(fit, Ex = Ex, age = c(0,20,30,60,105),
max_age = 105, prob = 0.99, graph = FALSE)


</code></pre>

<hr>
<h2 id='fitted.BLC'>BLC: Fitted death probabilities (qx)</h2><span id='topic+fitted.BLC'></span>

<h3>Description</h3>

<p>Computes the fitted values associated to each age and year based on
the resulting chains from a fitted BLC model. In addition, this function also
evaluates the values of lower and upper limits of the credible interval.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'BLC'
fitted(object, prob = 0.95, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fitted.BLC_+3A_object">object</code></td>
<td>
<p>A <code>BLC</code> or <code>PredBLC</code> object, result of a call to blc() or predict() function.</p>
</td></tr>
<tr><td><code id="fitted.BLC_+3A_prob">prob</code></td>
<td>
<p>A real number that indicates the probability of the credible interval.</p>
</td></tr>
<tr><td><code id="fitted.BLC_+3A_...">...</code></td>
<td>
<p>Other arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the matrices of fitted values and lower and upper limits of the credible interval for each age and year.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitted.HP">fitted.HP()</a></code> and <code><a href="#topic+fitted.DLM">fitted.DLM()</a></code> for <code>HP</code> or <code>DLM</code> methods.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing log-mortality data from Portugal:
data(PT)
Y &lt;- PT

## Fitting the model
fit = blc(Y = Y, M = 100, bn = 20)

## Log-mortalities estimates for each age and year in model fitted
fitted(fit, prob = 0.95)

</code></pre>

<hr>
<h2 id='fitted.DLM'>DLM: Fitted death probabilities (qx)</h2><span id='topic+fitted.DLM'></span>

<h3>Description</h3>

<p>This function computes the point estimations of the death probabilities (qx) of a
mortality graduation returned by dlm() or dlm_close() functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'DLM'
fitted(object, age = NULL, prob = 0.95, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fitted.DLM_+3A_object">object</code></td>
<td>
<p>Object of the following classes: <code>DLM</code> or <code>ClosedDLM</code>.</p>
</td></tr>
<tr><td><code id="fitted.DLM_+3A_age">age</code></td>
<td>
<p>Vector with the ages to calculate the death probabilities (Optional). By default, all ages are considered.</p>
</td></tr>
<tr><td><code id="fitted.DLM_+3A_prob">prob</code></td>
<td>
<p>Coverage probability of the predictive intervals.</p>
</td></tr>
<tr><td><code id="fitted.DLM_+3A_...">...</code></td>
<td>
<p>Other arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame object with the selected ages and the corresponding estimates and predictive intervals of the death probabilities.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitted.HP">fitted.HP()</a></code> and <code><a href="#topic+fitted.BLC">fitted.BLC()</a></code> for <code>HP</code> or <code>BLC</code> methods.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing mortality data from the USA available on the Human Mortality Database (HMD):
data(USA)

## Selecting the log mortality rate of the year 2000, ranging from 0 to 100 years old:
USA2000 = USA[USA$Year == 2000,]
x = 0:100
Ex = USA2000$Ex.Total[x+1]
Dx = USA2000$Dx.Total[x+1]
y = log(Dx/Ex)

## Fitting dlm
fit = dlm(y, M = 100)

## Estimating the death probabilities (qx)
fitted(fit)

</code></pre>

<hr>
<h2 id='fitted.HP'>HP: Fitted death probabilities (qx)</h2><span id='topic+fitted.HP'></span>

<h3>Description</h3>

<p>This function computes the point estimations of the death probabilities (qx) of the <code>HP</code> or the <code>ClosedHP</code> class object fitted by the hp() or hp_close() functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'HP'
fitted(object, age = NULL, Ex = NULL, prob = 0.95, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fitted.HP_+3A_object">object</code></td>
<td>
<p>Object of the class <code>HP</code> or <code>ClosedHP</code> adjusted by the hp() or hp_close() functions.</p>
</td></tr>
<tr><td><code id="fitted.HP_+3A_age">age</code></td>
<td>
<p>Vector with the ages to calculate the death probabilities (Optional). By default, all ages are considered.</p>
</td></tr>
<tr><td><code id="fitted.HP_+3A_ex">Ex</code></td>
<td>
<p>Vector with the exposures of the selected ages. Its length must be equal to the age vector. This argument is only necessary when using the Poisson and the Binomial distributions.</p>
</td></tr>
<tr><td><code id="fitted.HP_+3A_prob">prob</code></td>
<td>
<p>Coverage probability of the predictive intervals.</p>
</td></tr>
<tr><td><code id="fitted.HP_+3A_...">...</code></td>
<td>
<p>Other arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame object with the selected ages and the corresponding estimates and predictive intervals of the death probabilities.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitted.BLC">fitted.BLC()</a></code> and <code><a href="#topic+fitted.DLM">fitted.DLM()</a></code> for <code>BLC</code> or <code>DLM</code> methods.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing mortality data from the USA available on the Human Mortality Database (HMD):
data(USA)

## Selecting the exposure and the death count of the year 2000, ranging from 0 to 90 years old:
USA2000 = USA[USA$Year == 2000,]
x = 0:90
Ex = USA2000$Ex.Total[x+1]
Dx = USA2000$Dx.Total[x+1]

## Fitting a simple model:
fit = hp(x = x, Ex = Ex, Dx = Dx, M = 5000, bn = 0, thin = 10)

## Estimating the death probabilities (qx)
fitted(fit)
fitted(fit, age = 0:110, Ex = USA2000$Ex.Total[0:110+1])

</code></pre>

<hr>
<h2 id='Heatmap'>Generic Heatmap function</h2><span id='topic+Heatmap'></span>

<h3>Description</h3>

<p>Generic function to <code>Heatmap</code> method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Heatmap(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Heatmap_+3A_x">x</code></td>
<td>
<p>Object or list of objects of class <code>HP</code>, <code>DLM</code>, <code>ClosedHP</code> or <code>ClosedDLM</code>. Object of class <code>BLC</code> or <code>PredBLC</code>.</p>
</td></tr>
<tr><td><code id="Heatmap_+3A_...">...</code></td>
<td>
<p>Further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggplot2 heatmap of the life expectancy.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Heatmap.HP">Heatmap.HP()</a></code>, <code><a href="#topic+Heatmap.DLM">Heatmap.DLM()</a></code>, <code><a href="#topic+Heatmap.BLC">Heatmap.BLC()</a></code> and <code><a href="#topic+Heatmap.list">Heatmap.list()</a></code>.
</p>

<hr>
<h2 id='Heatmap.BLC'>BLC: Heatmap for the life expectancy</h2><span id='topic+Heatmap.BLC'></span>

<h3>Description</h3>

<p>Draws a Heat Map based on the life expectancy of a fitted BLC or PredBLC model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'BLC'
Heatmap(x, x_lab = NULL, age = NULL, color = c("red", "white", "blue"), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Heatmap.BLC_+3A_x">x</code></td>
<td>
<p>A <code>BLC</code> or <code>PredBLC</code> object, result of a call to blc() function or forecast via predict() function.</p>
</td></tr>
<tr><td><code id="Heatmap.BLC_+3A_x_lab">x_lab</code></td>
<td>
<p>Description of the modelled object.</p>
</td></tr>
<tr><td><code id="Heatmap.BLC_+3A_age">age</code></td>
<td>
<p>Vector with the ages to plot the heatmap.</p>
</td></tr>
<tr><td><code id="Heatmap.BLC_+3A_color">color</code></td>
<td>
<p>Vector of colours used in the heatmap.</p>
</td></tr>
<tr><td><code id="Heatmap.BLC_+3A_...">...</code></td>
<td>
<p>Further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggplot2 heatmap of the life expectancy.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Heatmap.HP">Heatmap.HP()</a></code> and <code><a href="#topic+Heatmap.DLM">Heatmap.DLM()</a></code> for <code>HP</code> or <code>DLM</code> methods.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing log-mortality data from Portugal:
data(PT)
Y &lt;- PT

## Fitting the model

fit = blc(Y = Y, M = 100, bn = 20)

## Heatmap:
Heatmap(fit, x_lab = 2000:2015, age = 18:80)

</code></pre>

<hr>
<h2 id='Heatmap.DLM'>DLM: Heatmap for the life expectancy</h2><span id='topic+Heatmap.DLM'></span>

<h3>Description</h3>

<p>This function plots a heatmap for the life expectancy of the fitted DLMs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'DLM'
Heatmap(
  x,
  x_lab = NULL,
  age = NULL,
  max_age = 110,
  color = c("red", "white", "blue"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Heatmap.DLM_+3A_x">x</code></td>
<td>
<p>Object or a list of objects of the class <code>DLM</code> or <code>ClosedDLM</code> returned by dlm() or dlm_close() functions.</p>
</td></tr>
<tr><td><code id="Heatmap.DLM_+3A_x_lab">x_lab</code></td>
<td>
<p>Description of the object 'fit'.</p>
</td></tr>
<tr><td><code id="Heatmap.DLM_+3A_age">age</code></td>
<td>
<p>Vector with the ages to plot the heatmap.</p>
</td></tr>
<tr><td><code id="Heatmap.DLM_+3A_max_age">max_age</code></td>
<td>
<p>Positive number indicating the last age to be considered to compute the life expectancy (prediction will be considered to match the age interval if needed). This argument is only necessary with objects of the class <code>DLM</code>.</p>
</td></tr>
<tr><td><code id="Heatmap.DLM_+3A_color">color</code></td>
<td>
<p>Vector of colours used in the heatmap.</p>
</td></tr>
<tr><td><code id="Heatmap.DLM_+3A_...">...</code></td>
<td>
<p>Further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggplot2 heatmap of the life expectancy.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Heatmap.BLC">Heatmap.BLC()</a></code> and <code><a href="#topic+Heatmap.HP">Heatmap.HP()</a></code> for <code>BLC</code> or <code>HP</code> methods.
</p>
<p><code><a href="#topic+Heatmap.list">Heatmap.list()</a></code> to the <code>list</code> method, adding multiple objects in one single Heatmap.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing mortality data from the USA available on the Human Mortality Database (HMD):
data(USA)

# Example 1: -------------------------------

USA2010 = USA[USA$Year == 2010,]

ExF = USA2010$Ex.Female[1:91]
DxF = USA2010$Dx.Female[1:91]
yF = log(DxF/ExF)

fitF &lt;- dlm(yF, M = 100)

Heatmap(fitF, x_lab = "Female expec. 2010 USA", max_age = 90)


</code></pre>

<hr>
<h2 id='Heatmap.HP'>HP: Heatmap for the life expectancy</h2><span id='topic+Heatmap.HP'></span>

<h3>Description</h3>

<p>This function plots a heatmap for the life expectancy of the fitted HP models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'HP'
Heatmap(
  x,
  x_lab = NULL,
  age = 0:90,
  max_age = 110,
  color = c("red", "white", "blue"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Heatmap.HP_+3A_x">x</code></td>
<td>
<p>Object or a list of objects of the class <code>HP</code> or <code>ClosedHP</code> returned by hp() or close_hp() functions.</p>
</td></tr>
<tr><td><code id="Heatmap.HP_+3A_x_lab">x_lab</code></td>
<td>
<p>Description of the object 'fit'.</p>
</td></tr>
<tr><td><code id="Heatmap.HP_+3A_age">age</code></td>
<td>
<p>Vector with the ages to plot the heatmap.</p>
</td></tr>
<tr><td><code id="Heatmap.HP_+3A_max_age">max_age</code></td>
<td>
<p>Positive number indicating the last age to be considered to compute the life expectancy (extrapolation will be considered to match the age interval if needed). This argument is only necessary with objects of the class <code>HP</code>.</p>
</td></tr>
<tr><td><code id="Heatmap.HP_+3A_color">color</code></td>
<td>
<p>Vector of colours used in the heatmap.</p>
</td></tr>
<tr><td><code id="Heatmap.HP_+3A_...">...</code></td>
<td>
<p>Further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggplot2 heatmap of the life expectancy.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Heatmap.BLC">Heatmap.BLC()</a></code> and <code><a href="#topic+Heatmap.DLM">Heatmap.DLM()</a></code> for <code>BLC</code> or <code>DLM</code> methods.
</p>
<p><code><a href="#topic+Heatmap.list">Heatmap.list()</a></code> to the <code>list</code> method, adding multiple objects in one single Heatmap.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing mortality data from the USA available on the Human Mortality Database (HMD):
data(USA)

# Example: -------------------------------

USA2010 = USA[USA$Year == 2010,]

ExF = USA2010$Ex.Female[1:91]
DxF = USA2010$Dx.Female[1:91]
x &lt;- 0:90

fitF &lt;- hp(x, ExF, DxF, model = "lognormal", M = 1000, bn = 0, thin = 10)

Heatmap(fitF, x_lab = "Female expec. 2010 USA")

</code></pre>

<hr>
<h2 id='Heatmap.list'>Heatmap for a set of life tables</h2><span id='topic+Heatmap.list'></span>

<h3>Description</h3>

<p>This function plots a heatmap for the life expectancy of the mortality graduations
returned by hp(), dlm(), hp_close() or dlm_close() functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'list'
Heatmap(
  x,
  x_lab = NULL,
  age = NULL,
  max_age = NULL,
  color = c("red", "white", "blue"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Heatmap.list_+3A_x">x</code></td>
<td>
<p>List of objects of classes: <code>HP</code>, <code>DLM</code>, <code>ClosedHP</code>, or <code>ClosedDLM</code>.</p>
</td></tr>
<tr><td><code id="Heatmap.list_+3A_x_lab">x_lab</code></td>
<td>
<p>Description of the object 'fit'.</p>
</td></tr>
<tr><td><code id="Heatmap.list_+3A_age">age</code></td>
<td>
<p>Vector with the ages to plot the heatmap.</p>
</td></tr>
<tr><td><code id="Heatmap.list_+3A_max_age">max_age</code></td>
<td>
<p>Positive number indicating the last age to be considered to compute the life expectancy (methods for matching the age interval will be considered if needed). This argument is only necessary with objects of the class <code>HP</code> or <code>DLM</code>.</p>
</td></tr>
<tr><td><code id="Heatmap.list_+3A_color">color</code></td>
<td>
<p>Vector with colours used in the heatmap.</p>
</td></tr>
<tr><td><code id="Heatmap.list_+3A_...">...</code></td>
<td>
<p>Further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggplot2 heatmap of the life expectancy.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Heatmap.HP">Heatmap.HP()</a></code>, <code><a href="#topic+Heatmap.DLM">Heatmap.DLM()</a></code> and <code><a href="#topic+Heatmap.BLC">Heatmap.BLC()</a></code> for drawing single Heatmaps.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing mortality data from the USA available on the Human Mortality Database (HMD):
data(USA)

# Example (HP): -------------------------------

## Selecting the data from 2010
USA2010 = USA[USA$Year == 2010,]

ExF = USA2010$Ex.Female[1:91]
DxF = USA2010$Dx.Female[1:91]
x &lt;- 0:90

fitF &lt;- hp(x, ExF, DxF, model = "lognormal", M = 1000, bn = 0, thin = 10)

ExM = USA2010$Ex.Male[1:91]
DxM = USA2010$Dx.Male[1:91]

fitM &lt;- hp(x, ExM, DxM, model = "lognormal", M = 1000, bn = 0, thin = 10)

fits &lt;- list(fitF = fitF, fitM = fitM)

Heatmap(fits, x_lab = c("Female 2010 USA","Male 2010 USA"),
        age = 15:85)


</code></pre>

<hr>
<h2 id='hp'>Bayesian Heligman-Pollard curve for mortality table graduation</h2><span id='topic+hp'></span>

<h3>Description</h3>

<p>This function fits the Heligman-Pollard (HP) model following a Bayesian framework using
Markov chain Monte Carlo techniques to sample the posterior distribution.
Three model options are available: The Binomial and the Poisson models consider nine parameters,
whereas the Log-Normal model considers eight parameters for modelling the HP curve.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hp(x, Ex, Dx, model = c("binomial", "lognormal", "poisson"),
 M = NULL, bn = NULL, thin = 10, m = rep(NA, 8), v = rep(NA, 8),
 inits = NULL, K = NULL, sigma2 = NULL, prop.control = NULL,
 reduced_model = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hp_+3A_x">x</code></td>
<td>
<p>Numeric vector of the ages.</p>
</td></tr>
<tr><td><code id="hp_+3A_ex">Ex</code></td>
<td>
<p>Numeric vector with the exposure by age.</p>
</td></tr>
<tr><td><code id="hp_+3A_dx">Dx</code></td>
<td>
<p>Numeric vector with the death counts by age.</p>
</td></tr>
<tr><td><code id="hp_+3A_model">model</code></td>
<td>
<p>Character string specifying the model to be adopted. The options are: &quot;binomial&quot;, &quot;lognormal&quot; or &quot;poisson&quot;.</p>
</td></tr>
<tr><td><code id="hp_+3A_m">M</code></td>
<td>
<p>Positive integer indicating the number of iterations of the MCMC run. The default value is 50000 iterations. For the reduced model, the default is 30000 iterations.</p>
</td></tr>
<tr><td><code id="hp_+3A_bn">bn</code></td>
<td>
<p>Non-negative integer indicating the number of iteration to be discarded as the burn-in period. The default value is half of the M value, rounded.</p>
</td></tr>
<tr><td><code id="hp_+3A_thin">thin</code></td>
<td>
<p>Positive integer specifying the period for saving samples. The default value is 10.</p>
</td></tr>
<tr><td><code id="hp_+3A_m">m</code></td>
<td>
<p>Numeric vector with the mean of the prior distributions for (A, B, C, D, E, F, G, H).</p>
</td></tr>
<tr><td><code id="hp_+3A_v">v</code></td>
<td>
<p>Numeric vector with the variance of the prior distributions for (A, B, C, D, E, F, G, H).</p>
</td></tr>
<tr><td><code id="hp_+3A_inits">inits</code></td>
<td>
<p>Numeric vector with the initial values for the parameters (A, B, C, D, E, F, G, H).</p>
</td></tr>
<tr><td><code id="hp_+3A_k">K</code></td>
<td>
<p>Number that specifies the extra parameter 'K' value for binomial and poisson models. It is considered only if model = &quot;binomial&quot; or model = &quot;poisson&quot;. The default value is the optimal value.</p>
</td></tr>
<tr><td><code id="hp_+3A_sigma2">sigma2</code></td>
<td>
<p>Positive number that specifies initial value of sigma2 in lognormal model. It is considered only if model = &quot;lognormal&quot;.</p>
</td></tr>
<tr><td><code id="hp_+3A_prop.control">prop.control</code></td>
<td>
<p>Positive number that is considered for tuning the acceptance rate of MCMC.</p>
</td></tr>
<tr><td><code id="hp_+3A_reduced_model">reduced_model</code></td>
<td>
<p>Logical value which determines if reduced model should be addressed. If 'TRUE' (default), the first term of the HP curve (infant mortality) is not considered.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The binomial model assumes that Dx, the death count for the age x, has a binomial distribution:
Bin(Ex, qx), where qx is probability of death in age x. The poisson model assumes that Dx has a
Poisson distribution: Po(Ex*qx). Both models consider the nine parameters
HP curve, that was proposed by Heligman and Pollard (1980):
</p>
<p><code class="reqn">HP_x = A^{(x+B)^C} + De^{(-E(log(x/F))^2)} + GH^x/(1+KGH^x)</code>
</p>
<p><code class="reqn">qx = 1-e^{(-HP_x)}</code>
</p>
<p>This approximation ensures that qx, which is a probability, is in the correct range.
</p>
<p>The Log-Normal model assumes that the log odds of death qx/(1-qx) has Normal distribution
with a constant variance for all the ages. This model was proposed by Dellaportas et al.(2001)
and they consider the eighth parameters HP curve as follows:
</p>
<p><code class="reqn">log(qx/(1-qx)) = log(A^{(x+B)^C} + De^{-E(log(x/F))^2} + GH^x) + \epsilon_x</code>,
</p>
<p>where <code class="reqn">\epsilon_x</code> has independent distributions Normal(0, sigma2) for all ages. More details
of this model are available in Dellaportas, Smith e Stavropoulos (2001).
</p>
<p>The reduced model does not consider the first term of the HP curve: <code class="reqn">A^{(x+B)^C}</code>. In this
case, A, B and C are fixed as zero.
</p>
<p>All parameters, with the exception of the extra parameter K of the Binomial and the Poisson models
that is the estimated optimal value, are estimated by the MCMC methods. Gibbs sampling for sigma2 and
Metropolis-Hastings for parameters A, B, C, D, E, F, G and H. Informative prior distributions
should help the method to converge quickly.
</p>


<h3>Value</h3>

<p>A <code>HP</code> class object.
</p>
<table>
<tr><td><code>summary</code></td>
<td>
<p>A table with summaries measures of the parameters.</p>
</td></tr>
<tr><td><code>post.samples</code></td>
<td>
<p>A list with the chains generated by MCMC.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>A table with the data considered in fitted model.</p>
</td></tr>
<tr><td><code>info</code></td>
<td>
<p>A list with some informations of the fitted model like prior distributions mean and variance, initial values.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Dellaportas, P., Smith, A. F., and Stavropoulos, P. (2001). “Bayesian Analysis of Mortality Data.” <em>Journal of the Royal Statistical Society: Series A (Statistics in Society)</em> 164 (2). Wiley Online Library: 275–291.
</p>
<p>Heligman, Larry, and John H Pollard. (1980). “The Age Pattern of Mortality.” <em>Journal of the Institute of Actuaries (1886-1994)</em> 107 (1). JSTOR: 49–80.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitted.HP">fitted.HP()</a></code>, <code><a href="#topic+plot.HP">plot.HP()</a></code>, <code><a href="#topic+print.HP">print.HP()</a></code> and <code><a href="#topic+summary.HP">summary.HP()</a></code> for <code>HP</code> methods to native R functions <code><a href="stats.html#topic+fitted">fitted()</a></code>,
<code><a href="base.html#topic+plot">plot()</a></code>, <code><a href="base.html#topic+print">print()</a></code> and <code><a href="base.html#topic+summary">summary()</a></code>.
</p>
<p><code><a href="#topic+expectancy.HP">expectancy.HP()</a></code> and <code><a href="#topic+Heatmap.HP">Heatmap.HP()</a></code> for <code>HP</code> methods to compute and visualise the truncated life expectancy
via <code><a href="#topic+expectancy">expectancy()</a></code> and <code><a href="#topic+Heatmap">Heatmap()</a></code> functions.
</p>
<p><code><a href="#topic+hp_close">hp_close()</a></code> for close methods to expand the life tables and <code><a href="#topic+hp_mix">hp_mix()</a></code> for mixing life tables.
</p>
<p><code><a href="#topic+plot_chain">plot_chain()</a></code> to visualise the markov chains, respectively.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing mortality data from the USA available on the Human Mortality Database (HMD):
data(USA)

## Selecting the exposure and death count of the 2010 male population ranging from 0 to 90 years old
USA2010 = USA[USA$Year == 2010,]
x = 0:90
Ex = USA2010$Ex.Male[x+1]
Dx = USA2010$Dx.Male[x+1]

## Fitting binomial model
fit = hp(x = x, Ex = Ex, Dx = Dx)
print(fit)
fit$summary
fit$info

## Fitting lognormal model
## Specifying number of iterations, burn-in, thinning and the initial value of sigma2
fit = hp(x = x, Ex = Ex, Dx = Dx, model = "lognormal",
         M = 1000, bn = 0, thin = 10, sigma2 = 0.1)
summary(fit)

## Fitting poisson model
## Specifying the prior distribution parameters for B and E and fixing K as 0.
fit = hp(x = x, Ex = Ex, Dx = Dx, model = "poisson",
         m = c(NA, 0.08, NA, NA, 9, NA, NA, NA),
         v = c(NA, 1e-4, NA, NA, 0.1, NA, NA, NA), K = 0)
summary(fit)


## Using other functions available in the package:
## plotting (See "?plot.HP" in the BayesMortalityPlus package for more options):
plot(fit)

## qx estimation (See "?fitted.HP" in the BayesMortalityPlus package for more options):
fitted(fit)

## chain's plot (See "?plot_chain" for more options):
plot_chain(fit)

</code></pre>

<hr>
<h2 id='hp_close'>HP: Fitting the advanced ages of the life tables</h2><span id='topic+hp_close'></span>

<h3>Description</h3>

<p>This function receives an object of the class <code>HP</code> fitted by the hp() function
and fits a closing method to expand the life tables dataset to a maximum age argument inputted
by the user.
There are four closing methods available: 'hp', 'plateau', 'linear', and 'gompertz'.
The 'linear' method can only be applied with HP objects following the lognormal variant of
the HP mortality law.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hp_close (fit, method = c("hp", "plateau", "linear", "gompertz"),
 x0 = max(fit$data$x), max_age = 120, k = 7,
 weights = seq(from = 0, to = 1, length.out = 2*k+1),
 new_Ex = NULL, new_Dx = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hp_close_+3A_fit">fit</code></td>
<td>
<p>Object of the class <code>HP</code> fitted by the hp() function</p>
</td></tr>
<tr><td><code id="hp_close_+3A_method">method</code></td>
<td>
<p>Character string specifying the closing method to be fitted, with them being: 'hp', 'plateau', 'linear' or 'gompertz'.</p>
</td></tr>
<tr><td><code id="hp_close_+3A_x0">x0</code></td>
<td>
<p>Integer with the starting age the closing method will be fitted from. Default is the last age fitted by the 'HP' object.</p>
</td></tr>
<tr><td><code id="hp_close_+3A_max_age">max_age</code></td>
<td>
<p>Integer with the maximum age the closing method will be fitted. Default age is '120'.</p>
</td></tr>
<tr><td><code id="hp_close_+3A_k">k</code></td>
<td>
<p>Integer representing the size of the age interval to be mixed with the 'linear' or 'gompertz' closing methods for smooth graduation. If k = 0, no mixing will be applied.</p>
</td></tr>
<tr><td><code id="hp_close_+3A_weights">weights</code></td>
<td>
<p>Vector of weights of the closing method used in the mixture of the closing method and the fitted model made in the mixing age group. The vector's size should be equal to 2k+1. For a better understanding of this parameter and the mixture applied in this function, see Details.</p>
</td></tr>
<tr><td><code id="hp_close_+3A_new_ex">new_Ex</code></td>
<td>
<p>Vector with exposure of ages after the x0 input. This is an optional argument used in the 'linear' and 'gompertz' closing methods. If this argument is specified, then new_Dx also needs to be.</p>
</td></tr>
<tr><td><code id="hp_close_+3A_new_dx">new_Dx</code></td>
<td>
<p>Vector containing the death counts of the ages after the x0 input. This is also an optional argument used in the 'linear' and 'gompertz' closing methods. The length must be the same as new_Ex.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>There are three types of age groups when the closing method is applied: a group
where only the HP-fitted model computes the death probabilities, followed by a
group in which the death probabilities are a mix (or more precise a weighted mean)
from the HP model and the closing method and followed by a group in which the
death probabilities are computed just by the closing method. The mix is applied
so the transition of the death probabilities of the ages between the fitted model
and the closing method occurs smoothly.
</p>
<p>The parameters 'x0' and 'k' define the mixing group age. The parameter 'x0'
indicates the center age of the group. The parameter 'k' is the range of ages
before 'x0' and after 'x0', so this group has a total of <code class="reqn">2k + 1</code> age. Therefore,
the parameter 'weights' must have a length size equal to <code class="reqn">2k + 1</code>. In this case,
the death probability is calculated as follows. Consider <code class="reqn">model_x</code> and <code class="reqn">close_x</code>
as the death probability of the fitted model and closing method in the age <code class="reqn">x</code>,
respectively. Then, the resulting death probability of the mix is calculated as:
</p>
<p><code class="reqn">q_x = w_x model_x + (1-w_x)close_x</code>,
</p>
<p>where <code class="reqn">w_x</code> represents the weight of the closing method in the age <code class="reqn">x</code>.
This computation is applied to all elements in the MCMC chain of the fitted model,
resulting in a new chain of death probabilities. This procedure is applied only in
the linear and Gompertz methods.
</p>
<p>The four closing methods for life tables are:
</p>
<p>1.'hp' method: Expands the previously adjusted HP model until the max_age argument.
</p>
<p>2.'plateau' method: Keeps the death probability (qx) constant after the x0 argument.
</p>
<p>3.'linear' method: Fits a linear regression starting at age x0 - k until the last age with data available (lognormal only).
</p>
<p>4.'gompertz' method: Adopted as the closing method of the 2010-2012 English Life Table No. 17, fits the Gompertz mortality law via SIR using the same available data as the 'linear' method.
</p>


<h3>Value</h3>

<p>Returns a <code>ClosedHP</code> class object with the predictive chains of the death probability
(qx) from first fitted age to max_age argument, the data utilized by the function and the
closing method chosen.
</p>


<h3>References</h3>

<p>Dodd, Erengul, Forster, Jonathan, Bijak, Jakub, &amp; Smith, Peter 2018. “Smoothing mortality data: the English life table, 2010-12.” <em>Journal of the Royal Statistical Society: Series A (Statistics in Society)</em>, 181(3), 717-735.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitted.HP">fitted.HP()</a></code>, <code><a href="#topic+plot.HP">plot.HP()</a></code>, <code><a href="#topic+print.HP">print.HP()</a></code> and <code><a href="#topic+summary.HP">summary.HP()</a></code> for <code>ClosedHP</code> methods to native R functions <code><a href="stats.html#topic+fitted">fitted()</a></code>,
<code><a href="base.html#topic+plot">plot()</a></code>, <code><a href="base.html#topic+print">print()</a></code> and <code><a href="base.html#topic+summary">summary()</a></code>.
</p>
<p><code><a href="#topic+expectancy.HP">expectancy.HP()</a></code> and <code><a href="#topic+Heatmap.HP">Heatmap.HP()</a></code> for <code>ClosedHP</code> methods to compute and visualise the truncated life expectancy
via <code><a href="#topic+expectancy">expectancy()</a></code> and <code><a href="#topic+Heatmap">Heatmap()</a></code> functions.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing mortality data from the USA available on the Human Mortality Database (HMD):
data(USA)

## Selecting the exposure and the death count of the year 2010, ranging from 0 to 90 years old:
USA2010 = USA[USA$Year == 2010,]
x = 0:90
Ex = USA2010$Ex.Male[x+1]
Dx = USA2010$Dx.Male[x+1]

## Fitting a lognormal HP model:
fit = hp(x = x, Ex = Ex, Dx = Dx, model = "lognormal",
         M = 1000, bn = 0, thin = 10)

## Applying the closing function with different methods:
close1 = hp_close(fit, method = "hp", x0 = 90)
close2 = hp_close(fit, method = "plateau", x0 = 90)
close3 = hp_close(fit, method = "linear", x0 = 80,
                  new_Ex = USA2010$Ex.Male[82:101],
                  new_Dx = USA2010$Dx.Male[82:101])
close4 = hp_close(fit, method = "gompertz", x0 = 70,
                  new_Ex = USA2010$Ex.Male[72:101],
                  new_Dx = USA2010$Dx.Male[72:101],
                  k = 5, max_age = 120)

#### Using the other functions available in the package with the 'ClosedHP' object:

## qx estimation (See "?fitted.HP" in the BayesMortalityPlus package for more options):
fitted(close2)

## life expectancy (See "?expectancy.HP" for more options)
expectancy(close3, age = 0:110)

## plotting (See "?plot.HP" in the BayesMortalityPlus package for more options):
plot(close4)
g &lt;- plot(list(close4, fit),
          colors = c("seagreen", "blue"),
          labels = c("Closed", "Model"))
# plotly::ggplotly(g)


</code></pre>

<hr>
<h2 id='hp_mix'>HP: Model mixture</h2><span id='topic+hp_mix'></span>

<h3>Description</h3>

<p>This function mixes the fitted mortality table of the HP model with another mortality
table provided by the user.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hp_mix (fit, mu_post, weights = NULL, mix_age,
 x0_prior, x0_post, max_age)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hp_mix_+3A_fit">fit</code></td>
<td>
<p>Object of the class 'HP' fitted by the hp() function.</p>
</td></tr>
<tr><td><code id="hp_mix_+3A_mu_post">mu_post</code></td>
<td>
<p>Vector with mortality rates considered in the mix.</p>
</td></tr>
<tr><td><code id="hp_mix_+3A_weights">weights</code></td>
<td>
<p>Positive vector specifying the weights considered in the mix.</p>
</td></tr>
<tr><td><code id="hp_mix_+3A_mix_age">mix_age</code></td>
<td>
<p>Positive vector specifying the age range in the mixture.</p>
</td></tr>
<tr><td><code id="hp_mix_+3A_x0_prior">x0_prior</code></td>
<td>
<p>Non-negative number indicating the initial age of the fitted HP model.</p>
</td></tr>
<tr><td><code id="hp_mix_+3A_x0_post">x0_post</code></td>
<td>
<p>Non-negative number indicating the initial age of the mortality table provided by the user.</p>
</td></tr>
<tr><td><code id="hp_mix_+3A_max_age">max_age</code></td>
<td>
<p>Positive number indicating the final age in the mixture.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Return the posterior distribution for qx.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing mortality data from the USA available on the Human Mortality Database (HMD):
data(USA)

## Selecting the exposure and death count of the 2010 and 2013 male populations ranging
## from 0 to 90 years old
USA2010 = USA[USA$Year == 2010,]
x = 0:90
Ex = USA2010$Ex.Male[x+1]
Dx = USA2010$Dx.Male[x+1]

USA2013 = USA[USA$Year == 2013,]
Ex2 = USA2013$Ex.Male[x+1]
Dx2 = USA2013$Dx.Male[x+1]

## Fitting HP model for 2010 data and calculating the mortality rates of 2013
fit = hp(x = x, Ex = Ex, Dx = Dx,
         M = 1000, bn = 0, thin = 10)
tx_2013 = 1 - exp(-Dx2/Ex2)

## Mixing fitted model and mortality rates of 2013:
mix &lt;- hp_mix(fit, tx_2013, x0_prior = 0, x0_post = 0, mix_age = c(50,90),
              max_age = 90)

## Obtaining the new estimated mortality table (after mixture):
qx_mix&lt;- apply(mix$qx, 2, median, na.rm = TRUE)
qx_mix

</code></pre>

<hr>
<h2 id='improvement'>BLC: Improvement</h2><span id='topic+improvement'></span>

<h3>Description</h3>

<p>Calculates the improvement of each age, based on the resulting chains of the beta parameter from a fitted blc model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>improvement(obj, prob = 0.95)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="improvement_+3A_obj">obj</code></td>
<td>
<p>A <code>BLC</code> object, result of a call to blc() function.</p>
</td></tr>
<tr><td><code id="improvement_+3A_prob">prob</code></td>
<td>
<p>A real number that represents the credibility level of the intervals.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame with the improvement values of each age, as well as their credible intervals.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing log-mortality data from Portugal:
data(PT)
Y &lt;- PT

## Fitting the model
fit = blc(Y = Y, M = 100, bn = 20)

## Improvement:
improvement(fit)
improvement(fit, prob = 0.9) #90% credible intervals


</code></pre>

<hr>
<h2 id='mean.BLC'>BLC: Arithmetic mean</h2><span id='topic+mean.BLC'></span>

<h3>Description</h3>

<p>Calculates the means based on the resulting chains from a fitted BLC model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'BLC'
mean(x, name, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mean.BLC_+3A_x">x</code></td>
<td>
<p>A <code>BLC</code> object, result of a call to blc() function.</p>
</td></tr>
<tr><td><code id="mean.BLC_+3A_name">name</code></td>
<td>
<p>A character with a parameter name of the BLC model that should be returned. It can be one of these: &quot;alpha&quot;, &quot;beta&quot;, &quot;kappa&quot;, &quot;phiv&quot;, &quot;theta&quot;, &quot;phiw&quot;.</p>
</td></tr>
<tr><td><code id="mean.BLC_+3A_...">...</code></td>
<td>
<p>Further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector with the mean values of the selected parameter.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mean.PredBLC">mean.PredBLC()</a></code> for <code>PredBLC</code> object method.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(PT)
Y &lt;- PT

## Fitting the model
fit = blc(Y = Y, M = 100, bn = 20)

mean(fit, "kappa")

</code></pre>

<hr>
<h2 id='mean.PredBLC'>BLC: Arithmetic mean for predictions</h2><span id='topic+mean.PredBLC'></span>

<h3>Description</h3>

<p>Calculates the means based on the resulting chains from a predicted year.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'PredBLC'
mean(x, h, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mean.PredBLC_+3A_x">x</code></td>
<td>
<p>A <code>PredBLC</code> object, result to the pred() function call on a <code>BLC</code> object.</p>
</td></tr>
<tr><td><code id="mean.PredBLC_+3A_h">h</code></td>
<td>
<p>A positive integer specifying the year in the prediction horizon to be calculated.</p>
</td></tr>
<tr><td><code id="mean.PredBLC_+3A_...">...</code></td>
<td>
<p>Further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector with the mean values of the log-mortality chains.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mean.BLC">mean.BLC()</a></code> for <code>BLC</code> object method.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(PT)
Y &lt;- PT

## Fitting the model
fit = blc(Y = Y, M = 100, bn = 20)

## Prediction for 2 years ahead
pred = predict(fit, h = 2)

mean(pred, 1)
mean(pred, 2)

</code></pre>

<hr>
<h2 id='plot_chain'>Chain's plot</h2><span id='topic+plot_chain'></span>

<h3>Description</h3>

<p>This function provides three options of plots for the chain generated by the MCMC
algorithm in hp() and dlm() functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_chain(fit, param, type = c("trace", "acf", "density"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_chain_+3A_fit">fit</code></td>
<td>
<p>Object of the classes <code>HP</code> or <code>DLM</code>.</p>
</td></tr>
<tr><td><code id="plot_chain_+3A_param">param</code></td>
<td>
<p>Character vector specifying the parameters to be plotted. It is used only when the class of fit object is <code>DLM</code>.</p>
</td></tr>
<tr><td><code id="plot_chain_+3A_type">type</code></td>
<td>
<p>Character string specifying the type of plot to be returned. There are three options: &quot;trace&quot; return a plot for the sample of the parameters; &quot;acf&quot; return a plot for the autocorrelation of the parameters; &quot;density&quot; return a plot for the posterior density of the parameters based on the samples generated by the MCMC method.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A plot of the chosen type of the selected parameter(s).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing mortality data from the USA available on the Human Mortality Database (HMD):
data(USA)

## Selecting the log mortality rate of the 2010 total population ranging from 0 to 90 years old
USA2010 = USA[USA$Year == 2010,]
x = 0:90
Ex = USA2010$Ex.Total[x+1]
Dx = USA2010$Dx.Total[x+1]
y = log(Dx/Ex)

## Fitting HP model
fit = hp(x = x, Ex = Ex, Dx = Dx, model = "lognormal",
         m = c(NA, 0.08, rep(NA, 6)),
         v = c(NA, 1e-4, rep(NA, 6)))

## Plotting all the available types of plot:
plot_chain(fit, type = "trace")
plot_chain(fit, type = "acf")
plot_chain(fit, type = "density")


## Fitting DLM
fit = dlm(y, M = 100)

plot_chain(fit, param = "sigma2", type = "trace")
plot_chain(fit, param = "mu[10]", type = "acf")

## Selecting all theta1 indexed with 1 in first digit
plot_chain(fit, param = "theta1[1", type = "density")

## Plotting all parameters indexed by age 10 and age 11
plot_chain(fit, param = c("[10]", "[11]"))


</code></pre>

<hr>
<h2 id='plot.BLC'>BLC: Plot the fitted values</h2><span id='topic+plot.BLC'></span>

<h3>Description</h3>

<p>This function plots the fitted log mortality values as well as the parameters values and credible intervals of the BLC fitted models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'BLC'
plot(x, parameter = "all", prob = 0.9, age = NULL, year = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.BLC_+3A_x">x</code></td>
<td>
<p>A <code>BLC</code> object, result of a call to blc() function.</p>
</td></tr>
<tr><td><code id="plot.BLC_+3A_parameter">parameter</code></td>
<td>
<p>A character determines the parameter that will be plotted. Default is &quot;all&quot; which means that all three parameters &quot;alpha&quot;, &quot;beta&quot; and &quot;kappa&quot; will be plotted. It can also be &quot;alpha&quot;, &quot;beta&quot;, &quot;kappa&quot; or &quot;fitted&quot;. The last one provides a plot with all the fitted tables.</p>
</td></tr>
<tr><td><code id="plot.BLC_+3A_prob">prob</code></td>
<td>
<p>A numeric value that indicates the probability for the credible interval. Default is '0.9'.</p>
</td></tr>
<tr><td><code id="plot.BLC_+3A_age">age</code></td>
<td>
<p>A numeric vector that represents the ages used in the fitted BLC model. Default is 'NULL'.</p>
</td></tr>
<tr><td><code id="plot.BLC_+3A_year">year</code></td>
<td>
<p>A numeric vector that represents the years used in the fitted BLC model. Default is 'NULL'.</p>
</td></tr>
<tr><td><code id="plot.BLC_+3A_...">...</code></td>
<td>
<p>Other arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A plot with the fitted log mortality or fitted values and credible intervals of the parameters.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.HP">plot.HP()</a></code> and <code><a href="#topic+plot.DLM">plot.DLM()</a></code> for <code>HP</code> or <code>DLM</code> methods.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing log-mortality data from Portugal:
data(PT)
Y &lt;- PT

## Fitting the model
fit = blc(Y = Y, M = 100, bn = 20)

## Parameters' plot
plot(fit, parameter = "all")
plot(fit, parameter = "beta", prob = 0.95)
plot(fit, parameter = "alpha", age = 18:80)
plot(fit, parameter = "kappa")

## Fitted mortality graduation
plot(fit, parameter = "fitted", age = 18:80)


</code></pre>

<hr>
<h2 id='plot.DLM'>DLM: Plot the life table</h2><span id='topic+plot.DLM'></span>

<h3>Description</h3>

<p>Function that returns a log-scale ggplot of the <code>DLM</code> and <code>ClosedDLM</code> objects returned by dlm() and dlm_close() functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'DLM'
plot(
  x,
  plotIC = TRUE,
  plotData = TRUE,
  labels = NULL,
  colors = NULL,
  linetype = NULL,
  prob = 0.95,
  age = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.DLM_+3A_x">x</code></td>
<td>
<p>Object of the class <code>DLM</code> or <code>ClosedDLM</code> returned by the dlm() or dlm_close() functions.</p>
</td></tr>
<tr><td><code id="plot.DLM_+3A_plotic">plotIC</code></td>
<td>
<p>Logical. If 'TRUE' (default), shows the predictive intervals.</p>
</td></tr>
<tr><td><code id="plot.DLM_+3A_plotdata">plotData</code></td>
<td>
<p>Logical. If 'TRUE' (default), shows crude rate (black dots).</p>
</td></tr>
<tr><td><code id="plot.DLM_+3A_labels">labels</code></td>
<td>
<p>Vector with the name of the curve label. (Optional).</p>
</td></tr>
<tr><td><code id="plot.DLM_+3A_colors">colors</code></td>
<td>
<p>Vector with the color of the curve. (Optional).</p>
</td></tr>
<tr><td><code id="plot.DLM_+3A_linetype">linetype</code></td>
<td>
<p>Vector with the line type of the curve. (Optional).</p>
</td></tr>
<tr><td><code id="plot.DLM_+3A_prob">prob</code></td>
<td>
<p>Coverage probability of the predictive intervals. Default is '0.95'.</p>
</td></tr>
<tr><td><code id="plot.DLM_+3A_age">age</code></td>
<td>
<p>Vector with the ages to plot the life table.</p>
</td></tr>
<tr><td><code id="plot.DLM_+3A_...">...</code></td>
<td>
<p>Other arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A 'ggplot' object with fitted life table.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.HP">plot.HP()</a></code>, <code><a href="#topic+plot.BLC">plot.BLC()</a></code> and <code><a href="#topic+plot.PredBLC">plot.PredBLC()</a></code> for <code>HP</code>, <code>BLC</code> or <code>PredBLC</code> methods.
</p>
<p><code><a href="#topic+plot.list">plot.list()</a></code> to the <code>list</code> method, adding multiple objects in one single plot.
</p>
<p><code><a href="#topic+plot_chain">plot_chain()</a></code> to plot the chains generated by the MCMC algorithms for the <code>HP</code> and <code>DLM</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Selecting the log mortality rate of the 1990 male population ranging from 0 to 100 years old
USA1990 = USA[USA$Year == 1990,]
x = 0:100
Ex = USA1990$Ex.Male[x+1]
Dx = USA1990$Dx.Male[x+1]
y = log(Dx/Ex)

## Fitting DLM
fit = dlm(y, ages = 0:100, M = 100)

## Plotting the life tables:
plot(fit)

## Now we are starting from 20 years

fit2 = dlm(y[21:101], Ft = 1, Gt = 1, ages = 20:100, M = 100)

plot(fit2, plotIC = FALSE)

## To plot multiples life tables see ?plot.list
plot(list(fit, fit2), age = 20:100,
     plotData = FALSE,
     colors = c("red", "blue"),
     labels = c("1", "2"))



</code></pre>

<hr>
<h2 id='plot.HP'>HP: Plot the life table</h2><span id='topic+plot.HP'></span>

<h3>Description</h3>

<p>Function that returns a log-scale ggplot of <code>HP</code> and <code>ClosedHP</code> objects returned by the hp() and hp_close() functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'HP'
plot(
  x,
  age = NULL,
  Ex = NULL,
  plotIC = TRUE,
  plotData = TRUE,
  labels = NULL,
  colors = NULL,
  linetype = NULL,
  prob = 0.95,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.HP_+3A_x">x</code></td>
<td>
<p>Object of the class <code>HP</code> or <code>ClosedHP</code> returned by hp() or hp_close() functions.</p>
</td></tr>
<tr><td><code id="plot.HP_+3A_age">age</code></td>
<td>
<p>Vector with the ages to plot the life table.</p>
</td></tr>
<tr><td><code id="plot.HP_+3A_ex">Ex</code></td>
<td>
<p>Vector with the exposures of the selected ages. Its length must be equal to the age vector. This argument is only necessary when using poisson and binomial HP models.</p>
</td></tr>
<tr><td><code id="plot.HP_+3A_plotic">plotIC</code></td>
<td>
<p>Logical. If 'TRUE' (default), shows the predictive intervals.</p>
</td></tr>
<tr><td><code id="plot.HP_+3A_plotdata">plotData</code></td>
<td>
<p>Logical. If 'TRUE' (default), shows crude rate (black dots).</p>
</td></tr>
<tr><td><code id="plot.HP_+3A_labels">labels</code></td>
<td>
<p>Vector with the name of the curve label. (Optional).</p>
</td></tr>
<tr><td><code id="plot.HP_+3A_colors">colors</code></td>
<td>
<p>Vector with the color of the curve. (Optional).</p>
</td></tr>
<tr><td><code id="plot.HP_+3A_linetype">linetype</code></td>
<td>
<p>Vector with the line type of the curve. (Optional).</p>
</td></tr>
<tr><td><code id="plot.HP_+3A_prob">prob</code></td>
<td>
<p>Coverage probability of the predictive intervals. Default is '0.95'.</p>
</td></tr>
<tr><td><code id="plot.HP_+3A_...">...</code></td>
<td>
<p>Other arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A 'ggplot' object with fitted life table.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.DLM">plot.DLM()</a></code>, <code><a href="#topic+plot.BLC">plot.BLC()</a></code> and <code><a href="#topic+plot.PredBLC">plot.PredBLC()</a></code> for <code>DLM</code>, <code>BLC</code> or <code>PredBLC</code> methods.
</p>
<p><code><a href="#topic+plot.list">plot.list()</a></code> to the <code>list</code> method, adding multiple objects in one single plot.
</p>
<p><code><a href="#topic+plot_chain">plot_chain()</a></code> to plot the chains generated by the MCMC algorithms for the <code>HP</code> and <code>DLM</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Selecting the exposure and the death count of the year 1990, ranging from 0 to 90 years old:
USA1990 = USA[USA$Year == 1990,]
x = 0:90
Ex = USA1990$Ex.Male[x+1]
Dx = USA1990$Dx.Male[x+1]

## Fitting the poisson and the lognormal model:
fit = hp(x = x, Ex = Ex, Dx = Dx, model = "poisson",
         M = 2000, bn = 1000, thin = 1)
fit2 = hp(x = x, Ex = Ex, Dx = Dx, model = "lognormal",
          M = 2000, bn = 1000, thin = 1)

## Plot the life tables:
plot(fit)
plot(fit2, age = 0:110, plotIC = TRUE)

## To plot multiples life tables see ?plot.list
plot(list(fit, fit2),
     age = 0:110, Ex = USA1990$Ex.Male,
     plotIC = FALSE, colors = c("red", "blue"),
     labels = c("Poisson", "Lognormal"))

</code></pre>

<hr>
<h2 id='plot.list'>Plot a set of life tables</h2><span id='topic+plot.list'></span>

<h3>Description</h3>

<p>Function that returns a log-scale 'ggplot' of the mortality graduation
returned by hp(), dlm(), hp_close() or dlm_close() functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'list'
plot(
  x,
  age = NULL,
  Ex = NULL,
  plotIC = TRUE,
  plotData = TRUE,
  labels = NULL,
  colors = NULL,
  linetype = NULL,
  prob = 0.95,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.list_+3A_x">x</code></td>
<td>
<p>List of objects of the following classes: <code>HP</code>, <code>DLM</code>, <code>ClosedHP</code> or <code>ClosedDLM</code>.</p>
</td></tr>
<tr><td><code id="plot.list_+3A_age">age</code></td>
<td>
<p>Vector with the ages to plot the life tables.</p>
</td></tr>
<tr><td><code id="plot.list_+3A_ex">Ex</code></td>
<td>
<p>Vector with the exposures of the selected ages. Its length must be equal to the age vector. This argument is only necessary when plotting poisson and binomial HP models.</p>
</td></tr>
<tr><td><code id="plot.list_+3A_plotic">plotIC</code></td>
<td>
<p>Logical. If 'TRUE'(default), plots the predictive intervals.</p>
</td></tr>
<tr><td><code id="plot.list_+3A_plotdata">plotData</code></td>
<td>
<p>Logical. If 'TRUE' (default), plots the data used in the modelling as dots.</p>
</td></tr>
<tr><td><code id="plot.list_+3A_labels">labels</code></td>
<td>
<p>Description of the curve (Optional).</p>
</td></tr>
<tr><td><code id="plot.list_+3A_colors">colors</code></td>
<td>
<p>Vector of colours of the curves (Optional).</p>
</td></tr>
<tr><td><code id="plot.list_+3A_linetype">linetype</code></td>
<td>
<p>Vector with the line type of the curve. (Optional).</p>
</td></tr>
<tr><td><code id="plot.list_+3A_prob">prob</code></td>
<td>
<p>Coverage probability of the predictive intervals. Default is '0.95'.</p>
</td></tr>
<tr><td><code id="plot.list_+3A_...">...</code></td>
<td>
<p>Other arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A 'ggplot' object with fitted life tables.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.DLM">plot.DLM()</a></code>, <code><a href="#topic+plot.HP">plot.HP()</a></code>, <code><a href="#topic+plot.BLC">plot.BLC()</a></code> and <code><a href="#topic+plot.PredBLC">plot.PredBLC()</a></code> for single plots.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing mortality data from the USA available on the Human Mortality Database (HMD):
data(USA)

## Selecting the log mortality rate of the 1990 male population ranging from 0 to 100 years old
USA1990 = USA[USA$Year == 1990,]
x = 0:90
Ex = USA1990$Ex.Male[x+1]
Dx = USA1990$Dx.Male[x+1]
y = log(Dx/Ex)


## Fit poisson and lognormal HP model and DLM
fit = hp(x = x, Ex = Ex, Dx = Dx, model = "poisson",
         M = 2000, bn = 1000, thin = 1)
fit2 = dlm(y, M = 100)

## Plot multiples life tables
plot(list(fit, fit2),
     age = 0:110, Ex = USA1990$Ex.Male,
     plotIC = FALSE, colors = c("red", "blue"),
     labels = c("HP Poisson", "DLM"))


## Plot ClosedHP and ClosedDLM objects
close1 = hp_close(fit, method = "hp", x0 = 90)
close2 = dlm_close(fit2, method = "plateau")
plot(list(fit, fit2, close1, close2),
     plotIC = FALSE, colors = c("red", "blue", "green", "purple"),
     labels = c("HP", "DLM", "ClosedHP", "ClosedDLM"))

</code></pre>

<hr>
<h2 id='plot.PredBLC'>BLC: Plot the log-mortality of a prediction</h2><span id='topic+plot.PredBLC'></span>

<h3>Description</h3>

<p>This functions plot the predicted log-mortality and the predict
intervals of the log-mortality for a specific year in the prediction horizon
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'PredBLC'
plot(x, h = NULL, prob = 0.95, plotIC = TRUE, age = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.PredBLC_+3A_x">x</code></td>
<td>
<p>A <code>PredBLC</code> object, result to the pred() function call on a <code>BLC</code> object.</p>
</td></tr>
<tr><td><code id="plot.PredBLC_+3A_h">h</code></td>
<td>
<p>A numeric vector specifying the year(s) in the prediction horizon to be calculated.</p>
</td></tr>
<tr><td><code id="plot.PredBLC_+3A_prob">prob</code></td>
<td>
<p>A real number that represents the probability of the predict interval.</p>
</td></tr>
<tr><td><code id="plot.PredBLC_+3A_plotic">plotIC</code></td>
<td>
<p>Logical. If 'TRUE' (default), shows the predictive intervals.</p>
</td></tr>
<tr><td><code id="plot.PredBLC_+3A_age">age</code></td>
<td>
<p>A numeric vector indicating the modelled ages. (Optional).</p>
</td></tr>
<tr><td><code id="plot.PredBLC_+3A_...">...</code></td>
<td>
<p>Other arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A 'ggplot' object with the predicted mortality rates and their predict intervals.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.HP">plot.HP()</a></code>, <code><a href="#topic+plot.DLM">plot.DLM()</a></code> and <a href="#topic+plot.BLC">plot.BLC</a> for <code>HP</code>, <code>DLM</code> or <code>BLC</code> methods.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing log-mortality data from Portugal:
data(PT)
Y &lt;- PT

## Fitting the model
fit = blc(Y = Y, M = 100, bn = 20)

#' ## Prediction for 10 years ahead
pred = predict(fit, h = 3)

## Plotting
plot(pred, h = 1)
plot(pred, h = 3, prob = 0.9)

</code></pre>

<hr>
<h2 id='predict.BLC'>BLC: Forecasting</h2><span id='topic+predict.BLC'></span>

<h3>Description</h3>

<p>Calculates the means and variances of the forecast distributions based on
the resulting chains from an estimation method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'BLC'
predict(object, h, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict.BLC_+3A_object">object</code></td>
<td>
<p>A <code>BLC</code> object that is result of a call to blc() function.</p>
</td></tr>
<tr><td><code id="predict.BLC_+3A_h">h</code></td>
<td>
<p>The prediction horizon.</p>
</td></tr>
<tr><td><code id="predict.BLC_+3A_...">...</code></td>
<td>
<p>Other arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>PredBLC</code> object that contains a list with predicted values calculated
from <code>BLC</code> object chains structured in an array.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitted.BLC">fitted.BLC()</a></code>, <code><a href="#topic+print.BLC">print.BLC()</a></code>, and <code><a href="#topic+plot.PredBLC">plot.PredBLC()</a></code> for <code>PredBLC</code> methods to native R functions <code><a href="stats.html#topic+fitted">fitted()</a></code>,
<code><a href="base.html#topic+print">print()</a></code>, and <code><a href="base.html#topic+plot">plot()</a></code>.
</p>
<p><code><a href="#topic+expectancy.BLC">expectancy.BLC()</a></code> and <a href="#topic+Heatmap.BLC">Heatmap.BLC</a> to compute and plot the life expectancy of the prediction(s).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing log-mortality data from Portugal:
data(PT)
Y &lt;- PT

## Fitting the model
fit = blc(Y = Y, M = 100, bn = 20)

## Prediction for 2 years ahead
pred = predict(fit, h = 2)
print(pred)

</code></pre>

<hr>
<h2 id='predict.DLM'>DLM: Prediction of death probability</h2><span id='topic+predict.DLM'></span>

<h3>Description</h3>

<p>Extrapolates the mortality curve fitted by DLM by calculating the median
of death probability and the respective prediction interval.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'DLM'
predict(object, h, prob = 0.95, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict.DLM_+3A_object">object</code></td>
<td>
<p>A <code>DLM</code> object that is result of a call to dlm() function.</p>
</td></tr>
<tr><td><code id="predict.DLM_+3A_h">h</code></td>
<td>
<p>The ages prediction horizon.</p>
</td></tr>
<tr><td><code id="predict.DLM_+3A_prob">prob</code></td>
<td>
<p>Coverage probability of the predictive intervals.</p>
</td></tr>
<tr><td><code id="predict.DLM_+3A_...">...</code></td>
<td>
<p>Other arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame with the death probability prediction and prediction interval for the ages in the prediction horizon.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitted.DLM">fitted.DLM()</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing mortality data from the USA available on the Human Mortality Database (HMD):
data(USA)

## Selecting the log mortality rate of the year 2000, ranging from 0 to 100 years old:
USA2000 = USA[USA$Year == 2000,]
x = 0:100
Ex = USA2000$Ex.Total[x+1]
Dx = USA2000$Dx.Total[x+1]

y = log(Dx/Ex)

## Fitting dlm
fit = dlm(y, M = 100)

## Extrapolating the death probabilities (qx)
predict(fit, h = 3, prob = 0.95)


</code></pre>

<hr>
<h2 id='print.BLC'>BLC: Print</h2><span id='topic+print.BLC'></span>

<h3>Description</h3>

<p>Print details from a fitted BLC model and returns it invisibly.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'BLC'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.BLC_+3A_x">x</code></td>
<td>
<p>A <code>BLC</code> or <code>PredBLC</code>object, result of a call to blc() or predict() function.</p>
</td></tr>
<tr><td><code id="print.BLC_+3A_...">...</code></td>
<td>
<p>Further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A character vector with the details of a fitted <code>BLC</code> or <code>PredBLC</code> model.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+print.DLM">print.DLM()</a></code> and <code><a href="#topic+print.HP">print.HP()</a></code> for <code>DLM</code> or <code>HP</code> methods.
</p>

<hr>
<h2 id='print.DLM'>DLM: Print</h2><span id='topic+print.DLM'></span>

<h3>Description</h3>

<p>Print details from a fitted <code>DLM</code> or <code>ClosedDLM</code> models and returns it invisibly.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'DLM'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.DLM_+3A_x">x</code></td>
<td>
<p>A <code>DLM</code> or <code>ClosedDLM</code> object, result of a call to dlm() or dlm_close() function.</p>
</td></tr>
<tr><td><code id="print.DLM_+3A_...">...</code></td>
<td>
<p>Further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A character vector with the details of a fitted <code>DLM</code> or <code>ClosedDLM</code> model.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+print.HP">print.HP()</a></code> and <code><a href="#topic+print.BLC">print.BLC()</a></code> for <code>HP</code> or <code>BLC</code> methods.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing mortality data from the USA available on the Human Mortality Database (HMD):
data(USA)

## Selecting the log mortality rate of the 2010 male population ranging from 0 to 100 years old
USA2010 = USA[USA$Year == 2010,]
x = 0:100
Ex = USA2010$Ex.Male[x+1]
Dx = USA2010$Dx.Male[x+1]
y = log(Dx/Ex)

## Fitting DLM
fit = dlm(y, M = 100)
print(fit)

</code></pre>

<hr>
<h2 id='print.HP'>HP: Print</h2><span id='topic+print.HP'></span>

<h3>Description</h3>

<p>Print details from a fitted <code>HP</code> or <code>ClosedHP</code> models and returns it invisibly.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'HP'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.HP_+3A_x">x</code></td>
<td>
<p>A <code>HP</code> or <code>ClosedHP</code> object, result of a call to hp() or hp_close() function.</p>
</td></tr>
<tr><td><code id="print.HP_+3A_...">...</code></td>
<td>
<p>Further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A character vector with the details of a fitted <code>HP</code> or <code>ClosedHP</code> model.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+print.DLM">print.DLM()</a></code> and <code><a href="#topic+print.BLC">print.BLC()</a></code> for <code>DLM</code> or <code>BLC</code> methods.
</p>


<h3>Examples</h3>

<pre><code class='language-R'> ## Importing mortality data from the USA available on the Human Mortality Database (HMD):
data(USA)

## Selecting the exposure and death count of the 2010 male population ranging from 0 to 90 years old
USA2010 = USA[USA$Year == 2010,]
x = 0:90
Ex = USA2010$Ex.Male[x+1]
Dx = USA2010$Dx.Male[x+1]

## Fitting binomial model
fit = hp(x = x, Ex = Ex, Dx = Dx, M = 5000, bn = 0, thin = 10)
print(fit)

</code></pre>

<hr>
<h2 id='PT'>Mortality Data from Portugal to be used as example</h2><span id='topic+PT'></span>

<h3>Description</h3>

<p>Matrix with the logarithm of the mortality rates in Portugal's population from 2000 until 2015.
The ages vary from 18 to 80 years.
</p>


<h3>Format</h3>

<p>A numeric matrix with 63 rows and 16 columns:
</p>

<dl>
<dt>Row</dt><dd><p>Ages available.</p>
</dd>
<dt>Column</dt><dd><p>Years available.</p>
</dd>
</dl>



<h3>References</h3>

<p>Human Mortality Database. University of California, Berkeley (USA), and Max Planck Institute for Demographic Research (Germany). Available at www.mortality.org or www.humanmortality.de (Accessed: July 9th, 2021).
</p>

<hr>
<h2 id='quantile.BLC'>BLC: Sample quantiles</h2><span id='topic+quantile.BLC'></span>

<h3>Description</h3>

<p>Compute the quantiles based on the resulting chains from a fitted BLC model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'BLC'
quantile(x, q, name, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="quantile.BLC_+3A_x">x</code></td>
<td>
<p>A <code>BLC</code> object, result of a call to blc() function.</p>
</td></tr>
<tr><td><code id="quantile.BLC_+3A_q">q</code></td>
<td>
<p>A real number that represents the probability of the quantiles.</p>
</td></tr>
<tr><td><code id="quantile.BLC_+3A_name">name</code></td>
<td>
<p>A character with a parameter name of the blc model that should be returned. It can be one of these: &quot;alpha&quot;, &quot;beta&quot;, &quot;kappa&quot;, &quot;phiv&quot;, &quot;theta&quot;, &quot;phiw&quot;.</p>
</td></tr>
<tr><td><code id="quantile.BLC_+3A_...">...</code></td>
<td>
<p>Further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame with the quantiles of the selected parameter.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+quantile.PredBLC">quantile.PredBLC()</a></code> for <code>PredBLC</code> method.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing log-mortality data from Portugal:
data(PT)
Y &lt;- PT

## Fitting the model
fit = blc(Y = Y, M = 100, bn = 20)

## Parameters' median and quantiles 0.05, 0.95
quantile(fit, c(0.05, 0.5, 0.95), "alpha")
quantile(fit, c(0.05, 0.5, 0.95), "beta")
quantile(fit, c(0.05, 0.5, 0.95), "kappa")
quantile(fit, c(0.05, 0.5, 0.95), "phiv") ## random error precision
quantile(fit, c(0.05, 0.5, 0.95), "theta") ## drift parameter
quantile(fit, c(0.05, 0.5, 0.95), "phiw")

</code></pre>

<hr>
<h2 id='quantile.PredBLC'>BLC: Sample quantiles for predictions</h2><span id='topic+quantile.PredBLC'></span>

<h3>Description</h3>

<p>Calculates the quantiles of log-mortality based on the resulting chains from a predicted year.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'PredBLC'
quantile(x, q, h, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="quantile.PredBLC_+3A_x">x</code></td>
<td>
<p>A <code>PredBLC</code> object, result to the pred() function call on a <code>BLC</code> object.</p>
</td></tr>
<tr><td><code id="quantile.PredBLC_+3A_q">q</code></td>
<td>
<p>A real number that represents the probability of the quantiles.</p>
</td></tr>
<tr><td><code id="quantile.PredBLC_+3A_h">h</code></td>
<td>
<p>A positive integer especifying the year in the prediciton horizon to be calculated.</p>
</td></tr>
<tr><td><code id="quantile.PredBLC_+3A_...">...</code></td>
<td>
<p>Further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame with the quantiles of the selected parameter.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+quantile.BLC">quantile.BLC()</a></code> for <code>BLC</code> method.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing log-mortality data from Portugal:
data(PT)
Y &lt;- PT

## Fitting the model
fit = blc(Y = Y, M = 100, bn = 20)

## Prediction for 2 years ahead
pred = predict(fit, h = 2)

## The log-mortality median for the first year of prediction
quantile(pred, q = 0.5, h = 1)

## The 0.1 and 0.9 quantiles for the first and second year of prediction
quantile(pred, q = c(0.1, 0.9), h = 1)
quantile(pred, q = c(0.1, 0.9), h = 2)

</code></pre>

<hr>
<h2 id='summary.DLM'>DLM: Summary</h2><span id='topic+summary.DLM'></span>

<h3>Description</h3>

<p>Summarizes information from the parameters' markov chains of a fitted <code>DLM</code> or <code>ClosedDLM</code> model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'DLM'
summary(object, digits = 5, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.DLM_+3A_object">object</code></td>
<td>
<p>A <code>DLM</code> or <code>ClosedDLM</code> object, result of a call to dlm() or dlm_close() function.</p>
</td></tr>
<tr><td><code id="summary.DLM_+3A_digits">digits</code></td>
<td>
<p>An integer indicating the number of decimals places.</p>
</td></tr>
<tr><td><code id="summary.DLM_+3A_...">...</code></td>
<td>
<p>Further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame object with the mean, standard deviation and 2.5%, 50% and 97.5% quantiles of a fitted <code>DLM</code> or <code>ClosedDLM</code> model.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+summary.HP">summary.HP()</a></code> for <code>HP</code> method.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Importing mortality data from the USA available on the Human Mortality Database (HMD):
data(USA)

## Selecting the log mortality rate of the 2010 male population ranging from 0 to 100 years old
USA2010 = USA[USA$Year == 2010,]
x = 0:100
Ex = USA2010$Ex.Male[x+1]
Dx = USA2010$Dx.Male[x+1]
y = log(Dx/Ex)

## Fitting DLM
fit = dlm(y, M = 100)
summary(fit)

</code></pre>

<hr>
<h2 id='summary.HP'>HP: Summary</h2><span id='topic+summary.HP'></span>

<h3>Description</h3>

<p>Summarizes information from the parameters' markov chains of a fitted <code>HP</code> or <code>ClosedHP</code> model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'HP'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.HP_+3A_object">object</code></td>
<td>
<p>A <code>HP</code> or <code>ClosedHP</code> object, result of a call to hp() or hp_close() function.</p>
</td></tr>
<tr><td><code id="summary.HP_+3A_...">...</code></td>
<td>
<p>Further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame object with the mean, standard deviation and 2.5%, 50% and 97.5% quantiles of a fitted <code>HP</code> or <code>ClosedHP</code> model.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+summary.DLM">summary.DLM()</a></code> for <code>DLM</code> method.
</p>


<h3>Examples</h3>

<pre><code class='language-R'> ## Importing mortality data from the USA available on the Human Mortality Database (HMD):
data(USA)

## Selecting the exposure and death count of the 2010 male population ranging from 0 to 90 years old
USA2010 = USA[USA$Year == 2010,]
x = 0:90
Ex = USA2010$Ex.Male[x+1]
Dx = USA2010$Dx.Male[x+1]

## Fitting binomial model
fit = hp(x = x, Ex = Ex, Dx = Dx, M = 5000, bn = 0, thin = 10)
summary(fit)

</code></pre>

<hr>
<h2 id='USA'>Mortality Database from United States to be used as example</h2><span id='topic+USA'></span>

<h3>Description</h3>

<p>Data base with exposures and death counts of the population of the United States between the years 1933 and 2019.
</p>


<h3>Format</h3>

<p>A data.frame with 9657 rows and 8 variables:
</p>

<dl>
<dt>Year</dt><dd><p>Years available.</p>
</dd>
<dt>Age</dt><dd><p>Ages available.</p>
</dd>
<dt>Ex.Total</dt><dd><p>Exposure of the US population.</p>
</dd>
<dt>Dx.Total</dt><dd><p>Death count of the US population.</p>
</dd>
<dt>Ex.Male</dt><dd><p>Exposure of the US male population.</p>
</dd>
<dt>Dx.Male</dt><dd><p>Death count of the US male population.</p>
</dd>
<dt>Ex.Female</dt><dd><p>Exposure of the US female population.</p>
</dd>
<dt>Dx.Female</dt><dd><p>Death count of the US female population.</p>
</dd>
</dl>



<h3>References</h3>

<p>Human Mortality Database. University of California, Berkeley (USA), and Max Planck Institute for Demographic Research (Germany). Available at www.mortality.org or www.humanmortality.de (Accessed: August 9th, 2021).
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
