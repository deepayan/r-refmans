<!DOCTYPE html><html><head><title>Help for package gtfs2emis</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {gtfs2emis}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#ef_brazil_cetesb'><p>Running exhaust emissions factors for buses from Brazil (CETESB)</p></a></li>
<li><a href='#ef_brazil_cetesb_db'><p>Emission factors from Environment Company of Sao Paulo, Brazil (CETESB)</p></a></li>
<li><a href='#ef_europe_emep'><p>Speed-dependent emission factor from the European Environment Agency (EMEP/EEA) model</p></a></li>
<li><a href='#ef_europe_emep_db'><p>Emission factors from European Environment Agency — EMEP/EEA</p></a></li>
<li><a href='#ef_scaled_euro'><p>Scale local emission factors in order to make emission estimates a function</p>
of speed.</a></li>
<li><a href='#ef_usa_emfac'><p>Running exhaust emissions factors for buses from United States (EMFAC2017 model)</p></a></li>
<li><a href='#ef_usa_emfac_db'><p>Emission factors from California Air Resources Board (EMFAC Model)</p></a></li>
<li><a href='#ef_usa_moves'><p>Running exhaust emissions factors for buses from United States (MOVES3 model)</p></a></li>
<li><a href='#ef_usa_moves_db'><p>Emission factors from MOtor Vehicle Emission Simulator (MOVES)</p>
</p>
<p>Data.frame of emission factors for buses based on</p>
values from the <a href="https://www.epa.gov/moves">MOVES3 Model</a>.
Estimates expressed in units 'g/km'.</a></li>
<li><a href='#emis_grid'><p>Spatial aggregation of emission estimates into a grid</p></a></li>
<li><a href='#emis_summary'><p>Summarize emissions estimates</p></a></li>
<li><a href='#emis_to_dt'><p>Convert emission estimates from list to data.table format</p></a></li>
<li><a href='#emission_model'><p>Emission model</p></a></li>
<li><a href='#fuel_correction'><p>Correction factor equation</p></a></li>
<li><a href='#multiply_ef'><p>Multiply emission factors by distances</p></a></li>
<li><a href='#slope_class_europe_emep'><p>Add slope class into the transport model (LineString Simple Feature object)</p></a></li>
<li><a href='#transport_model'><p>Transport model</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Estimating Public Transport Emissions from General Transit Feed
Specification (GTFS) Data</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Description:</td>
<td>A bottom up model to estimate the emission levels of public transport systems based on General Transit Feed Specification (GTFS) data. The package requires two main inputs: i) Public transport data in the GTFS standard format; and ii) Some basic information on fleet characteristics such as fleet age, technology, fuel and Euro stage. As it stands, the package estimates several pollutants at high spatial and temporal resolutions. Pollution levels can be calculated for specific transport routes, trips, time of the day or for the transport system as a whole. The output with emission estimates can be extracted in different formats, supporting analysis on how emission levels vary across space, time and by fleet characteristics. A full description of the methods used in the 'gtfs2emis' model is presented in Vieira, J. P. B.; Pereira, R. H. M.; Andrade, P. R. (2022) &lt;<a href="https://doi.org/10.31219%2Fosf.io%2F8m2cy">doi:10.31219/osf.io/8m2cy</a>&gt;. </td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://ipeagit.github.io/gtfs2emis/">https://ipeagit.github.io/gtfs2emis/</a> ,
<a href="https://github.com/ipeaGIT/gtfs2emis">https://github.com/ipeaGIT/gtfs2emis</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/ipeaGIT/gtfs2emis/issues">https://github.com/ipeaGIT/gtfs2emis/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.6)</td>
</tr>
<tr>
<td>Imports:</td>
<td>checkmate, data.table, furrr, future, gtfs2gps, methods, sf
(&ge; 0.9-0), sfheaders, terra, units</td>
</tr>
<tr>
<td>Suggests:</td>
<td>gtfstools, ggplot2, knitr, lwgeom, progressr, rmarkdown,
testthat (&ge; 2.1.0)</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.1</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-11-11 17:54:43 UTC; joaobazzo</td>
</tr>
<tr>
<td>Author:</td>
<td>Joao Bazzo <a href="https://orcid.org/0000-0003-4536-5006"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cre],
  Rafael H. M. Pereira
    <a href="https://orcid.org/0000-0003-2125-7465"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Pedro R. Andrade <a href="https://orcid.org/0000-0001-8675-4046"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Sergio Ibarra-Espinosa
    <a href="https://orcid.org/0000-0002-3162-1905"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [ctb],
  Ipea - Institute for Applied Economic Research [cph, fnd]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Joao Bazzo &lt;joao.bazzo@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-11-14 11:30:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='ef_brazil_cetesb'>Running exhaust emissions factors for buses from Brazil (CETESB)</h2><span id='topic+ef_brazil_cetesb'></span>

<h3>Description</h3>

<p>Returns a vector or <code>data.table</code> of emission factors for buses based on
estimates from the  <a href="https://cetesb.sp.gov.br/veicular/">Environment Company of Sao Paulo, Brazil (CETESB) 2019</a>.
Emission factor estimates are expressed in units 'g/km'.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ef_brazil_cetesb(pollutant, veh_type, model_year, as_list = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ef_brazil_cetesb_+3A_pollutant">pollutant</code></td>
<td>
<p>character. Pollutants &quot;CH4&quot;, &quot;CO2&quot;, &quot;PM10&quot;, &quot;N2O&quot;, &quot;NOx&quot;,
&quot;NO2&quot;, &quot;NO&quot;, &quot;RCHO&quot;, &quot;ETOH&quot; &quot;KML&quot; (Vehicle Kilometers Traveled), &quot;FC&quot; (Fuel Consumption),
&quot;gD/KWH&quot; (grams of Diesel per kWh), &quot;gCO2/KWH&quot; (grams of CO2 per per kWh),
&quot;CO&quot;, &quot;HC&quot; (Total Hydrocarbon), &quot;NMHC&quot; (Non-Methane Hydrocarbon),
&quot;FS&quot;(Fuel Sales) and &quot;NH3&quot;.</p>
</td></tr>
<tr><td><code id="ef_brazil_cetesb_+3A_veh_type">veh_type</code></td>
<td>
<p>character. Vehicle categories by fuel: &quot;BUS_URBAN_D&quot;,
&quot;BUS_MICRO_D&quot;, &quot;BUS_COACH_D&quot; and &quot;BUS_ARTIC_D&quot;.</p>
</td></tr>
<tr><td><code id="ef_brazil_cetesb_+3A_model_year">model_year</code></td>
<td>
<p>numeric. Vehicle model year. Supports <code>model_year</code> from
1960 to 2020.</p>
</td></tr>
<tr><td><code id="ef_brazil_cetesb_+3A_as_list">as_list</code></td>
<td>
<p>logical. If <code>TRUE</code> (default), the function returns the output
in a <code>list</code> format. If <code>FALSE</code>, the output is returned in a <code>data.table</code>
format.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The new convention for vehicles names are translated from CETESB report:</p>

<table>
<tr>
 <td style="text-align: left;">
   vehicle </td><td style="text-align: left;"> description </td>
</tr>
<tr>
 <td style="text-align: left;">
   BUS_URBAN_D </td><td style="text-align: left;"> Urban Bus Diesel (5perc bio-diesel) </td>
</tr>
<tr>
 <td style="text-align: left;">
   BUS_MICRO_D </td><td style="text-align: left;"> Micro Urban Bus Diesel (5perc bio-diesel) </td>
</tr>
<tr>
 <td style="text-align: left;">
   BUS_COACH_D </td><td style="text-align: left;"> Coach (inter-state) Bus Diesel (5perc bio-diesel) </td>
</tr>
<tr>
 <td style="text-align: left;">
   BUS_ARTIC_D </td><td style="text-align: left;"> Articulated Urban Bus Diesel (5perc bio-diesel) </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>The percentage varies of biofuels varies by law.
</p>
<p>These emission factors are not exactly the same as the report of CETESB.
</p>

<ol>
<li><p> In this emission factors, there is also NO and NO2 based on split by published in the EMEP/EEA
air pollutant emission inventory guidebook.
</p>
</li>
<li><p> Also, the emission factors were extended till 50 years of use, repeating the oldest value.
</p>
</li></ol>



<h3>Value</h3>

<p>data.table. Emission factors in units 'g/km' by model_year.
</p>


<h3>Source</h3>

<p><a href="https://cetesb.sp.gov.br/veicular/relatorios-e-publicacoes/">https://cetesb.sp.gov.br/veicular/relatorios-e-publicacoes/</a>
</p>


<h3>See Also</h3>

<p>Other Emission factor model: 
<code><a href="#topic+ef_europe_emep">ef_europe_emep</a>()</code>,
<code><a href="#topic+ef_scaled_euro">ef_scaled_euro</a>()</code>,
<code><a href="#topic+ef_usa_emfac">ef_usa_emfac</a>()</code>,
<code><a href="#topic+ef_usa_moves">ef_usa_moves</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>df &lt;- ef_brazil_cetesb(
          pollutant = c("CO","PM10","CO2","CH4","NOx"),
          veh_type = "BUS_URBAN_D",
          model_year = 2015,
          as_list = TRUE)

</code></pre>

<hr>
<h2 id='ef_brazil_cetesb_db'>Emission factors from Environment Company of Sao Paulo, Brazil (CETESB)</h2><span id='topic+ef_brazil_cetesb_db'></span>

<h3>Description</h3>

<p>units 'g/km'; Emission factors for buses based on estimates from the
<a href="https://cetesb.sp.gov.br/veicular/">Environment Company of Sao Paulo, Brazil (CETESB) 2017</a>,
and obtained from <a href="https://github.com/atmoschem/vein">vein package</a>.
The R script used to organize the CETESB database can be found in the repository
&lt;<a href="https://github.com/ipeaGIT/gtfs2emis/blob/master/data-raw/ef_brazil_cetesb_db.R">https://github.com/ipeaGIT/gtfs2emis/blob/master/data-raw/ef_brazil_cetesb_db.R</a>&gt;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ef_brazil_cetesb_db
</code></pre>


<h3>Format</h3>

<p>A data.table:
</p>

<dl>
<dt>pollutant</dt><dd><p> character; Pollutants: &quot;CH4&quot;, &quot;CO2&quot;, &quot;PM10&quot;, &quot;N2O&quot;, &quot;KML&quot;,
&quot;FC&quot; (Fuel Consumption), &quot;gD/KWH&quot;, &quot;gCO2/KWH&quot;, &quot;CO&quot;, &quot;HC&quot; (Total Hydrocarbon),
&quot;NMHC&quot; (Non-Methane Hydrocarbon), &quot;NOx&quot;, &quot;NO2&quot;, &quot;NO&quot;, &quot;RCHO&quot;, &quot;ETOH&quot;,
&quot;FS&quot;(Fuel Sales) and &quot;NH3&quot;</p>
</dd>
<dt>veh_type</dt><dd><p>character; Vehicle categories by fuel:&quot;BUS_URBAN_D&quot;, &quot;BUS_MICRO_D&quot;,
&quot;BUS_COACH_D&quot; and &quot;BUS_ARTIC_D&quot;.</p>
</dd>
<dt>model_year</dt><dd><p>numeric; Filter the emission factor to start from a specific
base year. </p>
</dd>
<dt>as_list</dt><dd><p>logical; Returns emission factors as a list, instead of data.table
format.</p>
</dd>
</dl>



<h3>Source</h3>

<p><a href="https://cetesb.sp.gov.br/veicular/">https://cetesb.sp.gov.br/veicular/</a>
</p>


<h3>See Also</h3>

<p>Other emission factor data: 
<code><a href="#topic+ef_europe_emep_db">ef_europe_emep_db</a></code>,
<code><a href="#topic+ef_usa_emfac_db">ef_usa_emfac_db</a></code>,
<code><a href="#topic+ef_usa_moves_db">ef_usa_moves_db</a></code>
</p>

<hr>
<h2 id='ef_europe_emep'>Speed-dependent emission factor from the European Environment Agency (EMEP/EEA) model</h2><span id='topic+ef_europe_emep'></span>

<h3>Description</h3>

<p>Returns a list or data.table of emission factors for buses based on EMEP/EEA air pollutant
emission inventory guidebooks. The function uses four emission factor databases
published by EMEP/EEA, considering the editions of 2019, 2016, 2013 and 2007.
Estimates are expressed in units 'g/km'. See more in @details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ef_europe_emep(
  speed,
  veh_type,
  euro,
  pollutant,
  fuel = "D",
  tech = "SCR",
  slope = 0,
  load = 0.5,
  fcorr = 1,
  as_list = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ef_europe_emep_+3A_speed">speed</code></td>
<td>
<p>units; Speed in 'km/h'.</p>
</td></tr>
<tr><td><code id="ef_europe_emep_+3A_veh_type">veh_type</code></td>
<td>
<p>character; Bus type, classified in &quot;Ubus Midi &lt;=15 t&quot;,&quot;Ubus Std 15 - 18 t&quot;,&quot;Ubus Artic &gt;18 t&quot;,
&quot;Coaches Std &lt;=18 t&quot;,&quot;Coaches Artic &gt;18 t&quot;.</p>
</td></tr>
<tr><td><code id="ef_europe_emep_+3A_euro">euro</code></td>
<td>
<p>character; Euro period of vehicle, classified in &quot;Conventional&quot;, &quot;I&quot;, &quot;II&quot;, &quot;III&quot;, &quot;IV&quot;, &quot;V&quot;, &quot;VI&quot;, and &quot;EEV&quot;.</p>
</td></tr>
<tr><td><code id="ef_europe_emep_+3A_pollutant">pollutant</code></td>
<td>
<p>character; Pollutant, classified in &quot;FC&quot;,&quot;CO2&quot;,&quot;CO&quot;,&quot;NOx&quot;,&quot;VOC&quot;,&quot;PM10&quot;,&quot;EC&quot;,&quot;CH4&quot;,&quot;NH3&quot;,&quot;N2O&quot;. &quot;FC&quot; means Fuel Consumption.</p>
</td></tr>
<tr><td><code id="ef_europe_emep_+3A_fuel">fuel</code></td>
<td>
<p>character; Fuel type, classified in &quot;D&quot; (Diesel),&quot;DHD&quot; (Diesel Hybrid ~ Diesel),
&quot;DHE&quot; (Diesel Hybrid ~ Electricity), &quot;CNG&quot; (Compressed Natural Gas), &quot;BD&quot; (Biodiesel).</p>
</td></tr>
<tr><td><code id="ef_europe_emep_+3A_tech">tech</code></td>
<td>
<p>character; After treatment technology, classified in &quot;SCR&quot; (Selective Catalytic Reduction),
&quot;EGR&quot; (Exhaust Gas Recirculation), and &quot;DPF+SCR&quot; (Diesel Particulate Filter + SCR, for Euro VI). Default is &quot;SCR&quot; for &quot;IV&quot; and &quot;V&quot;. There are
no available after treatment technology associated with euro standards &quot;Conventional&quot;, &quot;I&quot;, &quot;II&quot; and &quot;III&quot;.</p>
</td></tr>
<tr><td><code id="ef_europe_emep_+3A_slope">slope</code></td>
<td>
<p>numeric; Slope gradient, classified in -0.06, -0.04, -0.02, 0.00, 0.02, 0.04 and
0.06. Negative gradients means downhills and positive uphills. Default is 0.0.</p>
</td></tr>
<tr><td><code id="ef_europe_emep_+3A_load">load</code></td>
<td>
<p>numeric; Load ratio, classified in 0.0, 0.5 and 1.0. Default is 0.5.</p>
</td></tr>
<tr><td><code id="ef_europe_emep_+3A_fcorr">fcorr</code></td>
<td>
<p>numeric; Correction based on fuel composition. The length must be one per
each euro standards. Default is 1.0.</p>
</td></tr>
<tr><td><code id="ef_europe_emep_+3A_as_list">as_list</code></td>
<td>
<p>logical; Returns emission factors as a list, instead of data.table format. Default is TRUE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The new convention for vehicles names are translated from the EMEP/EEA report:</p>

<table>
<tr>
 <td style="text-align: left;">
   vehicle category </td><td style="text-align: left;"> description </td>
</tr>
<tr>
 <td style="text-align: left;">
   Ubus Midi &lt;=15 t </td><td style="text-align: left;"> Urban Bus Midi size, Gross Vehicle Weight (GVW) &lt;= 15 tons </td>
</tr>
<tr>
 <td style="text-align: left;">
   Ubus Std 15 - 18 t </td><td style="text-align: left;"> Urban Bus Standard size, GVW between 15 - 18 tons </td>
</tr>
<tr>
 <td style="text-align: left;">
   Ubus Artic &gt;18 t </td><td style="text-align: left;"> Urban Bus Articulated size, GVW &gt;= 18 tons </td>
</tr>
<tr>
 <td style="text-align: left;">
   Coaches Std &lt;=18 t </td><td style="text-align: left;"> Coach (inter-state) Standard size, GVW &lt;= 18 tons </td>
</tr>
<tr>
 <td style="text-align: left;">
   Coaches Artic &gt;18 t </td><td style="text-align: left;"> Coach (inter-state) Articulated size, GVW &gt; 18 tons </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>When the information of vehicle technology does not match the existing database,
the function display a message mentioning the returned technology.
User can either select an existing data for the combining variables
(<code>euro</code>, <code>tech</code>, <code>veh_type</code> and <code>pollutant</code>), or accept the assumed change
in vehicle technology.
</p>
<p>In order to cover more pollutants, vehicle technologies, and fuel consumption data,
the function uses four emission factor databases published by EMEP/EEA,
considering the editions of 2019, 2016, 2013 and 2007.
</p>
<p>The R scripts used to download and pre-process 4 EMEP/EEA editions (2019, 2016, 2013 and 2007)
can be accessed in the 'gtfs2emis' GitHub repository at
&lt;<a href="https://github.com/ipeaGIT/gtfs2emis/blob/master/data-raw/ef_europe_emep_db.R">https://github.com/ipeaGIT/gtfs2emis/blob/master/data-raw/ef_europe_emep_db.R</a>&gt;
</p>
<p>EMEP/EEA data and reports can be accessed in the following links:
</p>

<ul>
<li><p> 2019 edition <a href="https://www.eea.europa.eu/themes/air/air-pollution-sources-1/emep-eea-air-pollutant-emission-inventory-guidebook">https://www.eea.europa.eu/themes/air/air-pollution-sources-1/emep-eea-air-pollutant-emission-inventory-guidebook</a>,
</p>
</li>
<li><p> 2016 edition <a href="https://www.eea.europa.eu/publications/emep-eea-guidebook-2016/">https://www.eea.europa.eu/publications/emep-eea-guidebook-2016/</a>,
</p>
</li>
<li><p> 2013 edition <a href="https://www.eea.europa.eu/publications/emep-eea-guidebook-2013/">https://www.eea.europa.eu/publications/emep-eea-guidebook-2013/</a>, and
</p>
</li>
<li><p> 2007 edition <a href="https://www.eea.europa.eu/publications/EMEPCORINAIR5/">https://www.eea.europa.eu/publications/EMEPCORINAIR5/</a>.
</p>
</li></ul>



<h3>Value</h3>

<p>List. emission factors in units 'g/km' (list or a data.table).
</p>


<h3>See Also</h3>

<p>Other Emission factor model: 
<code><a href="#topic+ef_brazil_cetesb">ef_brazil_cetesb</a>()</code>,
<code><a href="#topic+ef_scaled_euro">ef_scaled_euro</a>()</code>,
<code><a href="#topic+ef_usa_emfac">ef_usa_emfac</a>()</code>,
<code><a href="#topic+ef_usa_moves">ef_usa_moves</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ef_europe_emep( speed = units::set_units(1:100,"km/h"),
                veh_type = c("Ubus Midi &lt;=15 t","Ubus Std 15 - 18 t","Ubus Artic &gt;18 t"),
                euro = c("IV","V"),
                fuel = "D",
                pollutant = c("CO","PM10","CH4","NOx"),
                as_list = FALSE) 
</code></pre>

<hr>
<h2 id='ef_europe_emep_db'>Emission factors from European Environment Agency — EMEP/EEA</h2><span id='topic+ef_europe_emep_db'></span>

<h3>Description</h3>

<p>Hot exhaust emission factors are speed dependent functions and are expressed in g/km.
It varies by fuel, vehicle segment, euro standard, pollutant, and after treatment technology.
These variables are consolidated in different EF equations, given by:
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ef_europe_emep_db
</code></pre>


<h3>Format</h3>

<p>A data.table with 6431 rows and 22 variables:
</p>

<dl>
<dt>Category</dt><dd><p>Buses.</p>
</dd>
<dt>Fuel</dt><dd><p>Fuel type, classified in &quot;D&quot; (Diesel),&quot;DHD&quot; (Diesel Hybrid ~ Diesel),
&quot;DHE&quot; (Diesel Hybrid ~ Electricity), &quot;CNG&quot; (Compressed Natural Gas), &quot;BD&quot; (Biodiesel). </p>
</dd>
<dt>Segment</dt><dd><p>character; Bus type, classified in &quot;Ubus Midi &lt;=15 t&quot;,&quot;Ubus Std 15 - 18 t&quot;,&quot;Ubus Artic &gt;18 t&quot;,
&quot;Coaches Std &lt;=18 t&quot;,&quot;Coaches Artic &gt;18 t&quot;.</p>
</dd>
<dt>Euro</dt><dd><p>character; Euro period of vehicle, classified in &quot;Conventional&quot;, &quot;I&quot;, &quot;II&quot;, &quot;III&quot;, &quot;IV&quot;, &quot;V&quot;, &quot;VI&quot;, and &quot;EEV&quot;.</p>
</dd>
<dt>Technology</dt><dd><p>character; After treatment technology, classified in &quot;SCR&quot; (Selective Catalytic Reduction),
&quot;EGR&quot; (Exhaust Gas Recirculation), and &quot;DPF+SCR&quot; (Diesel Particulate Filter + SCR, for Euro VI). Default is &quot;SCR&quot; for &quot;IV&quot; and &quot;V&quot;. There are
no available after treatment technology associated with euro standards &quot;Conventional&quot;, &quot;I&quot;, &quot;II&quot; and &quot;III&quot;. </p>
</dd>
<dt>Pol</dt><dd><p>character; Pollutant, classified in &quot;FC&quot;,&quot;CO2&quot;,&quot;CO&quot;,&quot;NOx&quot;,&quot;VOC&quot;,&quot;PM10&quot;,&quot;EC&quot;,&quot;CH4&quot;,&quot;NH3&quot;,&quot;N2O&quot;. &quot;FC&quot; means Fuel Consumption. </p>
</dd>
<dt>Vmin</dt><dd><p>Minimum speed for emission factor estimation, in km/h.</p>
</dd>
<dt>Vmax</dt><dd><p>Maximum speed for emission factor estimation, in km/h.</p>
</dd>
<dt>Alpha, Beta, Gamma, Delta, Epsilon, Zita, Hta, Thita</dt><dd><p>Constant parameters.</p>
</dd>
<dt>RF</dt><dd><p>Reduction Factor; In percentage (%) units.</p>
</dd>
<dt>k</dt><dd><p>Constant factor.</p>
</dd>
</dl>



<h3>Details</h3>

<p>EF = EF(Alpha, Beta, Gamma, Delta, Epsilon, Zita, Hta, RF, Speed, Function_ID, k, fcorr),
</p>
<p>where Alpha, Beta, Gamma, Delta, Epsilon, Zeta, Eta are constant parameters;
RF is the Reduction Factor, Speed in the average speed, Function_ID is the
equation (function of on the year of the inventory and the pollutant); k is
a constant value, and fcorr is the fuel correction factor.
</p>
<p>The emissions factors are derived from the EMEP/EEA air pollutant emission inventory guidebook
(formerly called the EMEP CORINAIR emission inventory guidebook). The document provides guidance on
estimating emissions from both anthropogenic and natural emission sources.
</p>
<p>The package presents a combination of emission factors from EMEP/EEA guidelines of 2007,
2013, 2016, and 2019, aiming to cover a greater number of pollutants and vehicle segments.
The script used to process the raw EMEP/EEA databases can be found in the repository
&lt;<a href="https://github.com/ipeaGIT/gtfs2emis/blob/master/data-raw/ef_europe_emep_db.R">https://github.com/ipeaGIT/gtfs2emis/blob/master/data-raw/ef_europe_emep_db.R</a>&gt;.
</p>


<h3>Source</h3>

<p>More information can be found at
<a href="https://www.eea.europa.eu//publications/emep-eea-guidebook-2019">https://www.eea.europa.eu//publications/emep-eea-guidebook-2019</a>,
<a href="https://www.eea.europa.eu/publications/emep-eea-guidebook-2016/">https://www.eea.europa.eu/publications/emep-eea-guidebook-2016/</a>,
<a href="https://www.eea.europa.eu/publications/emep-eea-guidebook-2013/">https://www.eea.europa.eu/publications/emep-eea-guidebook-2013/</a>, and
<a href="https://www.eea.europa.eu/publications/EMEPCORINAIR5/">https://www.eea.europa.eu/publications/EMEPCORINAIR5/</a>.
</p>


<h3>See Also</h3>

<p>Other emission factor data: 
<code><a href="#topic+ef_brazil_cetesb_db">ef_brazil_cetesb_db</a></code>,
<code><a href="#topic+ef_usa_emfac_db">ef_usa_emfac_db</a></code>,
<code><a href="#topic+ef_usa_moves_db">ef_usa_moves_db</a></code>
</p>

<hr>
<h2 id='ef_scaled_euro'>Scale local emission factors in order to make emission estimates a function
of speed.</h2><span id='topic+ef_scaled_euro'></span>

<h3>Description</h3>

<p>Scale emission factors to account for vehicle speed based on values from the
emission factor model by the European Environment Agency (EMEP/EEA). Emission
factor estimates are expressed in units 'g/km'.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ef_scaled_euro(
  ef_local,
  speed,
  veh_type,
  euro,
  pollutant,
  fuel = "D",
  tech = "SCR",
  SDC = 19,
  slope = 0,
  load = 0.5,
  fcorr = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ef_scaled_euro_+3A_ef_local">ef_local</code></td>
<td>
<p>data.frame or a list containing the emission factors data.frame.
Local emission factors, in units 'g/km'.</p>
</td></tr>
<tr><td><code id="ef_scaled_euro_+3A_speed">speed</code></td>
<td>
<p>units. Speed in 'km/h'.</p>
</td></tr>
<tr><td><code id="ef_scaled_euro_+3A_veh_type">veh_type</code></td>
<td>
<p>character. Bus type, classified as &quot;Ubus Midi &lt;=15 t&quot;,
&quot;Ubus Std 15 - 18 t&quot;,  &quot;Ubus Artic &gt;18 t&quot;, &quot;Coaches Std &lt;=18 t&quot;, or
&quot;Coaches Artic &gt;18 t&quot;.</p>
</td></tr>
<tr><td><code id="ef_scaled_euro_+3A_euro">euro</code></td>
<td>
<p>character. Euro period of vehicle, classified in &quot;Conventional&quot;,
&quot;I&quot;, &quot;II&quot;, &quot;III&quot;, &quot;IV&quot;, &quot;V&quot;, &quot;VI&quot;, and &quot;EEV&quot;.</p>
</td></tr>
<tr><td><code id="ef_scaled_euro_+3A_pollutant">pollutant</code></td>
<td>
<p>character. Pollutant: &quot;FC&quot;, &quot;CO2&quot;, &quot;CO&quot;, &quot;NOx&quot;, &quot;VOC&quot;,
&quot;PM10&quot;, &quot;EC&quot;, &quot;CH4&quot;, &quot;NH3&quot;, &quot;N2O&quot;, &quot;FC&quot; (fuel consumption).</p>
</td></tr>
<tr><td><code id="ef_scaled_euro_+3A_fuel">fuel</code></td>
<td>
<p>character. Fuel type, classified in &quot;D&quot; (Diesel), &quot;DHD&quot; (Diesel
Hybrid ~ Diesel), &quot;DHE&quot; (Diesel Hybrid ~ Electricity), &quot;CNG&quot;
(Compressed Natural Gas), &quot;BD&quot; (Biodiesel). Default is &quot;D&quot;.</p>
</td></tr>
<tr><td><code id="ef_scaled_euro_+3A_tech">tech</code></td>
<td>
<p>character. After treatment technology, classified in &quot;SCR&quot;
(Selective Catalytic Reduction), &quot;EGR&quot; (Exhaust Gas Recirculation),
and &quot;DPF+SCR&quot; (Diesel Particulate Filter + SCR, for Euro VI). Default
is &quot;SCR&quot; for &quot;IV&quot; and &quot;V&quot;.</p>
</td></tr>
<tr><td><code id="ef_scaled_euro_+3A_sdc">SDC</code></td>
<td>
<p>numeric. Average speed of urban driving condition in 'km/h'.
Default is 19 km/h,  which is the average speed adopted in EMEP/EEA
report.</p>
</td></tr>
<tr><td><code id="ef_scaled_euro_+3A_slope">slope</code></td>
<td>
<p>numeric. Slope gradient, categorized in -0.06, -0.04, -0.02,
0.00, 0.02, 0.04 and 0.06. Negative gradients means downhills and
positive uphills. Default is 0.0.</p>
</td></tr>
<tr><td><code id="ef_scaled_euro_+3A_load">load</code></td>
<td>
<p>numeric. Passenger load ratio, classified in 0.0, 0.5 and 1.0.
Default is 0.5.</p>
</td></tr>
<tr><td><code id="ef_scaled_euro_+3A_fcorr">fcorr</code></td>
<td>
<p>numeric. Correction based on fuel composition. The length must
be one per each euro standards. Default is 1.0.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The scaled emission factor is related to speed by the expression
</p>
<p>EF_scaled (V) = EF_local * ( EF(V) / EF(SDC)),
</p>
<p>where EF_scaled(V) is the scaled emission factors for each street link,
EF_local is the local emission factor, EF(V) and EF(SDC) are the EMEP/EEA
emission factor the speed of V and the average urban driving speed 'SDC', respectively.
</p>
<p>Please note that the function reads the vector arguments in the same order
as informed by the user. For instance, if the pollutant input is <code>c("CO","PM10")</code>
input in the local emission factor function, the order needs to be the same for the
pollutant in the <code>ef_scaled_euro</code> function.
</p>
<p>In the case of vehicle type, which generally changes according to the emission
factor source, the input argument in the <code>ef_scaled_euro</code> needs to be consistent
with the order adopted in the local emission factor function.
</p>
<p>For example, if the vector of local vehicle type is
<code>c("BUS_URBAN_D","BUS_MICRO_D")</code>, the related vector for EMEP/EEA model needs
to be <code>c("Ubus Std 15 - 18 t","Ubus Midi &lt;=15 t")</code>. The same approach applies for
other input arguments. See more in the examples.
</p>


<h3>Value</h3>

<p>list. Emission factors in units 'g/km'.
</p>


<h3>See Also</h3>

<p>Other Emission factor model: 
<code><a href="#topic+ef_brazil_cetesb">ef_brazil_cetesb</a>()</code>,
<code><a href="#topic+ef_europe_emep">ef_europe_emep</a>()</code>,
<code><a href="#topic+ef_usa_emfac">ef_usa_emfac</a>()</code>,
<code><a href="#topic+ef_usa_moves">ef_usa_moves</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>temp_ef_br &lt;- ef_brazil_cetesb(
                    pollutant = c("CO","PM10","CO2","CH4","NOx"),
                    veh_type = c("BUS_URBAN_D","BUS_MICRO_D"),
                    model_year = c(2015,2015),
                    as_list = TRUE
                    )

temp_ef_scaled &lt;- ef_scaled_euro(
                    ef_local = temp_ef_br,
                    speed = units::set_units(1:100,"km/h"),
                    veh_type = c("Ubus Std 15 - 18 t","Ubus Midi &lt;=15 t"),
                    euro = c("IV","IV"),
                    fuel = c("D","D"),
                    tech = c("SCR","SCR"),
                    pollutant = c("CO","PM10","CO2","CH4","NOx")
                    )
</code></pre>

<hr>
<h2 id='ef_usa_emfac'>Running exhaust emissions factors for buses from United States (EMFAC2017 model)</h2><span id='topic+ef_usa_emfac'></span>

<h3>Description</h3>

<p>Returns a vector or data.frame of emission factors for buses based on the
<a href="https://arb.ca.gov/emfac/">California EMission Factor model (EMFAC2017)</a>.
The model considers emission factors (EF) of urban buses in California
(United States), considering different pollutants, years of reference, model
year, fuel, speed ranges, type of regions, model version, and type of season.
The gtfs2emis package currently supports EF only for &quot;Statewide&quot; region type,
and &quot;Annual&quot; season.  Specific data of these variables can be download at
&lt;<a href="https://arb.ca.gov/emfac/emissions-inventory">https://arb.ca.gov/emfac/emissions-inventory</a>&gt;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ef_usa_emfac(
  pollutant,
  reference_year = 2020,
  fuel = "D",
  model_year,
  speed,
  as_list = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ef_usa_emfac_+3A_pollutant">pollutant</code></td>
<td>
<p>character. Pollutants: &quot;CH4&quot; (Methane), &quot;CO&quot; (Carbon
Monoxide), &quot;CO2&quot; (Carbon Dioxide), &quot;N2O&quot; (Nitrous Oxide), &quot;NOx&quot;
(Oxides of Nitrogen), &quot;PM10&quot; (Primary Exhaust PM10 - Total), &quot;PM25&quot;
(Primary Exhaust PM2.5 - Total), &quot;SOX&quot; (Oxides of Sulfur), &quot;TOG&quot;
(Total Organic Gases), &quot;ROG&quot;  (Reactive Organic Gases).</p>
</td></tr>
<tr><td><code id="ef_usa_emfac_+3A_reference_year">reference_year</code></td>
<td>
<p>numeric. Year of reference, in which the emissions
inventory is estimated. Default is 2020. Values between 2015 - 2022.</p>
</td></tr>
<tr><td><code id="ef_usa_emfac_+3A_fuel">fuel</code></td>
<td>
<p>character. Type of fuel: 'D' (Diesel),'G' (Gasoline), 'CNG'
(Compressed Natural Gas). Default is 'D'.</p>
</td></tr>
<tr><td><code id="ef_usa_emfac_+3A_model_year">model_year</code></td>
<td>
<p>Numeric; Model year of vehicle.</p>
</td></tr>
<tr><td><code id="ef_usa_emfac_+3A_speed">speed</code></td>
<td>
<p>Units. Speed in 'km/h'; Emission factor are returned in speed
intervals: &quot;5-10&quot;, &quot;10-15&quot;, &quot;15-20&quot;, &quot;20-25&quot;, &quot;25-30&quot;, &quot;30-35&quot;,
&quot;35-40&quot;, &quot;40-45&quot;, &quot;45-50&quot;, &quot;50-55&quot;, &quot;55-60&quot;, &quot;60-65&quot;, &quot;65-70&quot;, &quot;70-75&quot;,
&quot;75-80&quot;, &quot;80-85&quot;, &quot;85-90&quot;, &quot;&gt;90&quot; mph (miles/h).</p>
</td></tr>
<tr><td><code id="ef_usa_emfac_+3A_as_list">as_list</code></td>
<td>
<p>logical. If <code>TRUE</code> (default), the function returns the output
in a <code>list</code> format. If <code>FALSE</code>, the output is returned in a <code>data.table</code>
format.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List or data.table. Emission factors in units 'g/km' by speed and model_year.
</p>


<h3>Source</h3>

<p><a href="https://arb.ca.gov/emfac/">https://arb.ca.gov/emfac/</a>
</p>


<h3>See Also</h3>

<p>Other Emission factor model: 
<code><a href="#topic+ef_brazil_cetesb">ef_brazil_cetesb</a>()</code>,
<code><a href="#topic+ef_europe_emep">ef_europe_emep</a>()</code>,
<code><a href="#topic+ef_scaled_euro">ef_scaled_euro</a>()</code>,
<code><a href="#topic+ef_usa_moves">ef_usa_moves</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>df &lt;- ef_usa_emfac(
        pollutant = c("CO","PM10"),
        reference_year = 2019,
        model_year = 2015,
        speed = units::set_units(10:100,"km/h"),
        fuel = "D",
        as_list = TRUE
        )
</code></pre>

<hr>
<h2 id='ef_usa_emfac_db'>Emission factors from California Air Resources Board (EMFAC Model)</h2><span id='topic+ef_usa_emfac_db'></span>

<h3>Description</h3>

<p>Running exhaust emissions factors from <a href="https://arb.ca.gov/emfac/emissions-inventory">EMFAC2017 model</a>.
The model generates emission factors (EF) of urban buses in California (United States), considering
different pollutants, years of reference, model year, fuel, speed ranges,
type of regions, model version, and type of season. Currently, the package
supports EFs only for &quot;Statewide&quot; region type, and &quot;Annual&quot; season.
Specific data of other regions and seasons can be download at &lt;<a href="https://arb.ca.gov/emfac/emissions-inventory">https://arb.ca.gov/emfac/emissions-inventory</a>&gt;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ef_usa_emfac_db
</code></pre>


<h3>Format</h3>

<p>A data.table with 79198 rows and 8 variables:
</p>

<dl>
<dt>pol</dt><dd><p>Character; Pollutants: CH4(Methane), CO(Carbon Monoxide),
CO2(Carbon Dioxide), N2O(Nitrous Oxide), NOx(Oxides of Nitrogen),
PM10(Primary Exhaust PM10 - Total), PM25(Primary Exhaust PM2.5 - Total), SOX(Oxides of Sulfur),
TOG(Total Organic Gases), ROG (Reactive Organic Gases)</p>
</dd>
<dt>reference_year</dt><dd><p>Numeric; Year of reference between 2010 - 2020</p>
</dd>
<dt>fuel</dt><dd><p>character; Type of fuel: 'D' (Diesel),'G' (Gasoline),'CNG' (Compressed Natural Gas).</p>
</dd>
<dt>model_year</dt><dd><p>Model year.</p>
</dd>
<dt>speed</dt><dd><p>Units; Speed in 'km/h'; Emission factor are returned in speed intervals
such as &quot;5-10&quot;, &quot;10-15&quot;, &quot;15-20&quot;, &quot;20-25&quot;, &quot;25-30&quot;, &quot;30-35&quot;, &quot;35-40&quot;, &quot;40-45&quot;, &quot;45-50&quot;
&quot;50-55&quot;, &quot;55-60&quot;, &quot;60-65&quot;, &quot;65-70&quot;, &quot;70-75&quot;, &quot;75-80&quot;, &quot;80-85&quot;, &quot;85-90&quot;, &quot;&gt;90&quot; mph (miles/h)</p>
</dd>
</dl>



<h3>Details</h3>

<p>The function returns the data in a data.frame format. The R script used to process
the raw EMFAC database can be found in the repository
&lt;<a href="https://github.com/ipeaGIT/gtfs2emis/blob/master/data-raw/ef_usa_emfac_db.R">https://github.com/ipeaGIT/gtfs2emis/blob/master/data-raw/ef_usa_emfac_db.R</a>&gt;.
</p>


<h3>Source</h3>

<p><a href="https://arb.ca.gov/emfac/emissions-inventory">https://arb.ca.gov/emfac/emissions-inventory</a>
</p>


<h3>See Also</h3>

<p>Other emission factor data: 
<code><a href="#topic+ef_brazil_cetesb_db">ef_brazil_cetesb_db</a></code>,
<code><a href="#topic+ef_europe_emep_db">ef_europe_emep_db</a></code>,
<code><a href="#topic+ef_usa_moves_db">ef_usa_moves_db</a></code>
</p>

<hr>
<h2 id='ef_usa_moves'>Running exhaust emissions factors for buses from United States (MOVES3 model)</h2><span id='topic+ef_usa_moves'></span>

<h3>Description</h3>

<p>Returns a vector or data.frame of emission factors for urban buses based on
values from the <a href="https://www.epa.gov/moves">MOVES3 Model</a>. Emission factor
estimates are expressed in units 'g/km'.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ef_usa_moves(
  pollutant,
  model_year,
  reference_year = 2020,
  speed,
  fuel = "D",
  as_list = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ef_usa_moves_+3A_pollutant">pollutant</code></td>
<td>
<p>character. Pollutants: &quot;CH4&quot; (Methane), &quot;CO&quot; (Carbon
Monoxide), &quot;CO2&quot; (Carbon Dioxide), &quot;EC&quot; (Energy Consumption), &quot;HONO&quot;
(Nitrous Acid), &quot;N2O&quot; (Nitrous Oxide), &quot;NH3&quot; (Ammonia ), &quot;NH4&quot;
(Ammonium), &quot;NO&quot; (Nitrogen Oxide), &quot;NO2&quot; (Nitrogen Dioxide), &quot;NO3&quot;
(Nitrate), &quot;NOx&quot; (Oxides of Nitrogen), &quot;PM10&quot; (Primary Exhaust PM10 -
Total), &quot;PM25&quot; (Primary Exhaust PM2.5 - Total), &quot;SO2&quot; (Sulfur Dioxide),
&quot;THC&quot; (Total Gaseous Hydrocarbons ), &quot;TOG&quot; (Total Organic Gases) and
&quot;VOC&quot; (Volatile Organic Compounds)</p>
</td></tr>
<tr><td><code id="ef_usa_moves_+3A_model_year">model_year</code></td>
<td>
<p>numeric. Model year of vehicle.</p>
</td></tr>
<tr><td><code id="ef_usa_moves_+3A_reference_year">reference_year</code></td>
<td>
<p>numeric. Year of reference, in which the emissions
inventory is estimated. Default is 2020. Values between 2015 - 2022.</p>
</td></tr>
<tr><td><code id="ef_usa_moves_+3A_speed">speed</code></td>
<td>
<p>units. Speed in 'km/h'. Emission factor are returned in speed
intervals: &quot;0-2.5&quot;, &quot;2.5-7.5&quot;, &quot;7.5-12.5&quot;, &quot;12.5-17.5&quot;, &quot;17.5-22.5&quot;,
&quot;22.5-27.5&quot;, &quot;27.5-32.5&quot;, &quot;32.5-37.5&quot;, &quot;37.5-42.5&quot;, &quot;42.5-47.5&quot;,
&quot;47.5-52.5&quot;, &quot;52.5-57.5&quot;, &quot;57.5-62.5&quot;, &quot;62.5-67.5&quot;, &quot;67.5-72.5&quot;,
&quot;&gt;72.5&quot; mph (miles/h).</p>
</td></tr>
<tr><td><code id="ef_usa_moves_+3A_fuel">fuel</code></td>
<td>
<p>character. Type of fuel: 'D' (Diesel),'G' (Gasoline), 'CNG'
(Compressed Natural Gas). Default is 'D'.</p>
</td></tr>
<tr><td><code id="ef_usa_moves_+3A_as_list">as_list</code></td>
<td>
<p>logical. If <code>TRUE</code> (default), the function returns the output
in a <code>list</code> format. If <code>FALSE</code>, the output is returned in a <code>data.table</code>
format.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Users can view the pre-processed database in <code>data(ef_usa_moves_db)</code> function.
</p>


<h3>Value</h3>

<p>List. Emission factors in units 'g/km' by speed and model_year.
</p>


<h3>See Also</h3>

<p>Other Emission factor model: 
<code><a href="#topic+ef_brazil_cetesb">ef_brazil_cetesb</a>()</code>,
<code><a href="#topic+ef_europe_emep">ef_europe_emep</a>()</code>,
<code><a href="#topic+ef_scaled_euro">ef_scaled_euro</a>()</code>,
<code><a href="#topic+ef_usa_emfac">ef_usa_emfac</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>df &lt;- ef_usa_moves(
         pollutant = c("CO","PM10"),
         model_year = 2015,
         speed = units::set_units(10:100,"km/h"),
         reference_year = 2016,
         fuel = "D",
         as_list = TRUE
        )
</code></pre>

<hr>
<h2 id='ef_usa_moves_db'>Emission factors from MOtor Vehicle Emission Simulator (MOVES)
Data.frame of emission factors for buses based on
values from the <a href="https://www.epa.gov/moves">MOVES3 Model</a>.
Estimates expressed in units 'g/km'.</h2><span id='topic+ef_usa_moves_db'></span>

<h3>Description</h3>

<p>Emission factors from MOtor Vehicle Emission Simulator (MOVES)
</p>
<p>Data.frame of emission factors for buses based on
values from the <a href="https://www.epa.gov/moves">MOVES3 Model</a>.
Estimates expressed in units 'g/km'.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ef_usa_moves_db
</code></pre>


<h3>Format</h3>

<p>A data.table:
</p>

<dl>
<dt>pollutant</dt><dd><p>character; Pollutants: CH4 (Methane), CO (Carbon Monoxide),
CO2 (Carbon Dioxide), EC (Energy Consumption), HONO (Nitrous Acid),
N2O (Nitrous Oxide), NH3 (Ammonia),  NH4 (Ammonium), NO (Nitrogen Oxide),
NO2 (Nitrogen Dioxide), NO3 (Nitrate), NOx (Oxides of Nitrogen),
PM10 (Primary Exhaust PM10 - Total), PM25 (Primary Exhaust PM2.5 - Total),
SO2 (Sulfur Dioxide), THC (Total Gaseous Hydrocarbons ),
TOG (Total Organic Gases) and VOC (Volatile Organic Compounds)</p>
</dd>
<dt>fuel_type</dt><dd><p>character; Type of fuel: 'D' (Diesel),'G' (Gasoline),'CNG'
(Compressed Natural Gas).</p>
</dd>
<dt>reference_year</dt><dd><p>Numeric; Calendar Year between 2015 - 2022.
Year in which the emissions inventory is estimated.</p>
</dd>
<dt>model_year</dt><dd><p>numeric; Model year of vehicle.</p>
</dd>
<dt>lower_speed_interval</dt><dd><p>units 'km/h'; Represents the lower value of the
speed intervals;  The speed intervals are &quot; - 2.5&quot;, &quot;2.5 - 7.5&quot;, &quot;7.5 - 12.5&quot;
, &quot;12.5 - 17.5&quot;, &quot;17.5 - 22.5&quot;, &quot;22.5 - 27.5&quot;,&quot;27.5 - 32.5&quot;,&quot;32.5 - 37.5&quot;
,&quot;37.5 - 42.5&quot;,&quot;42.5 - 47.5&quot;,&quot;47.5 - 52.5&quot;,&quot;52.5 - 57.5&quot;, &quot;57.5 - 62.5&quot;
, &quot;62.5 - 67.5&quot;, &quot;67.5 - 72.5&quot;, and &quot;&gt;72.5&quot; mph (miles/h).</p>
</dd>
<dt>upper_speed_interval</dt><dd><p>units in km/h; Represents the upper value of the speed intervals.
The speed intervals are analogous to <code>lower_speed_interval</code> above.</p>
</dd>
<dt>source_type</dt><dd><p>character; Type of vehicle, which currently has only &quot;Transit Bus&quot;.</p>
</dd>
<dt>id_speed</dt><dd><p>integer;it caracterizes the types of vehicle speeds.</p>
</dd>
</dl>



<h3>Source</h3>

<p><a href="https://www.epa.gov/moves">https://www.epa.gov/moves</a>
</p>


<h3>See Also</h3>

<p>Other emission factor data: 
<code><a href="#topic+ef_brazil_cetesb_db">ef_brazil_cetesb_db</a></code>,
<code><a href="#topic+ef_europe_emep_db">ef_europe_emep_db</a></code>,
<code><a href="#topic+ef_usa_emfac_db">ef_usa_emfac_db</a></code>
</p>

<hr>
<h2 id='emis_grid'>Spatial aggregation of emission estimates into a grid</h2><span id='topic+emis_grid'></span>

<h3>Description</h3>

<p>Aggregate emissions proportionally in an sf polygon grid, by performing an
intersection operation between emissions data in <code style="white-space: pre;">&#8288;sf linestring&#8288;</code> format and
the input grid cells. User can also aggregate the emissions in the grid
by time of the day.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>emis_grid(
  emi_list,
  grid,
  time_resolution = "day",
  quiet = TRUE,
  aggregate = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="emis_grid_+3A_emi_list">emi_list</code></td>
<td>
<p>list. A list containing the data of emissions 'emi'
(&quot;data.frame&quot; class) and the transport model 'tp_model' (&quot;sf&quot;
&quot;data.frame&quot; classes).</p>
</td></tr>
<tr><td><code id="emis_grid_+3A_grid">grid</code></td>
<td>
<p>Sf polygon. Grid cell data to allocate emissions.</p>
</td></tr>
<tr><td><code id="emis_grid_+3A_time_resolution">time_resolution</code></td>
<td>
<p>character. Time resolution in which the emissions is
aggregated. Options are 'hour', 'minute', or 'day (Default).</p>
</td></tr>
<tr><td><code id="emis_grid_+3A_quiet">quiet</code></td>
<td>
<p>logical. User can print the total emissions before and after the
intersection operation in order to check if the gridded emissions were
estimated correctly. Default is 'TRUE'.</p>
</td></tr>
<tr><td><code id="emis_grid_+3A_aggregate">aggregate</code></td>
<td>
<p>logical. Aggregate emissions by pollutant. Default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An <code style="white-space: pre;">&#8288;"sf" "data.frame"&#8288;</code> object with emissions estimates per grid cell.
</p>


<h3>See Also</h3>

<p>Other emission analysis: 
<code><a href="#topic+emis_summary">emis_summary</a>()</code>,
<code><a href="#topic+emis_to_dt">emis_to_dt</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(gtfs2emis)
library(gtfstools)

# read GTFS
gtfs_file &lt;- system.file("extdata/bra_cur_gtfs.zip", package = "gtfs2emis")
gtfs &lt;- gtfstools::read_gtfs(gtfs_file) 

# keep a single trip_id to speed up this example
gtfs_small &lt;- gtfstools::filter_by_trip_id(gtfs, trip_id ="4451136")
  
# run transport model
tp_model &lt;- transport_model(gtfs_data = gtfs_small,
                            spatial_resolution = 100,
                            parallel = FALSE)

# Fleet data, using Brazilian emission model and fleet
fleet_data_ef_cetesb &lt;- data.frame(veh_type = "BUS_URBAN_D",
                                   model_year = 2010:2019,
                                   fuel = "D",
                                   fleet_composition = rep(0.1,10)
                                   )
# Emission model
emi_list &lt;- emission_model(
                tp_model = tp_model,
                ef_model = "ef_brazil_cetesb",
                fleet_data = fleet_data_ef_cetesb,
                pollutant = c("CO","PM10","CO2","CH4","NOx")
                )

# create spatial grid
grid &lt;- sf::st_make_grid(
  x = sf::st_make_valid(emi_list$tp_model)
  , cellsize = 0.25 / 200
  , crs= 4326
  , what = "polygons"
  , square = FALSE
  )

emi_grid &lt;- emis_grid( emi_list,grid,'day')

plot(grid)
plot(emi_grid["PM10_2010"],add = TRUE)
plot(st_geometry(emi_list$tp_model), add = TRUE,col = "black")

</code></pre>

<hr>
<h2 id='emis_summary'>Summarize emissions estimates</h2><span id='topic+emis_summary'></span>

<h3>Description</h3>

<p>Summarize emissions estimates, aggregating emissions by pollutant, time of
the day, vehicle.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>emis_summary(
  emi_list,
  by = "pollutant",
  veh_vars = "veh_type",
  segment_vars = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="emis_summary_+3A_emi_list">emi_list</code></td>
<td>
<p>list. Emission or emission factor list.</p>
</td></tr>
<tr><td><code id="emis_summary_+3A_by">by</code></td>
<td>
<p>character. Emissions can be aggregated by 'time', 'vehicle', or
simply 'pollutant' (Default).</p>
</td></tr>
<tr><td><code id="emis_summary_+3A_veh_vars">veh_vars</code></td>
<td>
<p>character. data.frame names of 'emi_list' attributed to
vehicle characteristics. Default is 'veh_type'.</p>
</td></tr>
<tr><td><code id="emis_summary_+3A_segment_vars">segment_vars</code></td>
<td>
<p>character. data.frame names of 'emi_list' object
attributed to the road segments. Default is NULL.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>data.table</code> with pollutants units ('g') aggregated by pollutant,
time, or vehicle type.
</p>


<h3>See Also</h3>

<p>Other emission analysis: 
<code><a href="#topic+emis_grid">emis_grid</a>()</code>,
<code><a href="#topic+emis_to_dt">emis_to_dt</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

library(gtfs2emis)
library(gtfstools)

# read GTFS
gtfs_file &lt;- system.file("extdata/irl_dub_gtfs.zip", package = "gtfs2emis")
gtfs &lt;- gtfstools::read_gtfs(gtfs_file)

# Keep a single trip
gtfs &lt;- gtfstools::filter_by_trip_id(gtfs
                                     , trip_id = c('238.2.60-118-b12-1.59.I'
                                                   ,"7081.2.60-X27-b12-1.106.I"))
# Transport model
tp_model &lt;- transport_model(gtfs_data = gtfs,
                            spatial_resolution = 100,
                            parallel = FALSE)

# fleet data
fleet_df &lt;- read.csv(system.file("extdata/irl_dub_fleet.txt"
                                 , package = "gtfs2emis"))
# emission model
emi_list &lt;- emission_model(tp_model = tp_model
                           , ef_model = "ef_europe_emep"
                           , fleet_data = fleet_df
                           , pollutant = c("CO2","PM10"))

# Aggregate total emissions by 'pollutant'
emis_summary(emi_list) 

# by vehicle type
emis_summary(emi_list, by = "vehicle")
             
emis_summary(emi_list
             , by = "vehicle"
             , veh_vars = c("euro"))

emis_summary(emi_list
             , by = "vehicle"
             , veh_vars = c("fuel"))

emis_summary(emi_list
             , by = "vehicle"
             , veh_vars = c("veh_type","euro","tech","fuel"))
             
# by time of the day
emis_summary(emi_list
             , by = "time"
             , segment_vars = "slope") 

</code></pre>

<hr>
<h2 id='emis_to_dt'>Convert emission estimates from list to data.table format</h2><span id='topic+emis_to_dt'></span>

<h3>Description</h3>

<p>Read emission estimates generated by the <code><a href="#topic+emission_model">emission_model</a></code> or from
emission factor functions (e.g. <code><a href="#topic+ef_brazil_cetesb">ef_brazil_cetesb</a></code>) and convert
them into a <code>data.table</code> format.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>emis_to_dt(
  emi_list,
  emi_vars = "emi",
  veh_vars = "veh_type",
  pol_vars = "pollutant",
  segment_vars = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="emis_to_dt_+3A_emi_list">emi_list</code></td>
<td>
<p>list. A list of emission estimates</p>
</td></tr>
<tr><td><code id="emis_to_dt_+3A_emi_vars">emi_vars</code></td>
<td>
<p>character. data.frame names of 'emi_list' object attributed
to emissions or  emission factors. Default is 'emi'.</p>
</td></tr>
<tr><td><code id="emis_to_dt_+3A_veh_vars">veh_vars</code></td>
<td>
<p>character. data.frame names of 'emi_list' object attributed
to vehicle characteristics. Default is 'veh_type'.</p>
</td></tr>
<tr><td><code id="emis_to_dt_+3A_pol_vars">pol_vars</code></td>
<td>
<p>character. data.frame names of 'emi_list' object attributed
to pollutants. Default is 'pollutant'.</p>
</td></tr>
<tr><td><code id="emis_to_dt_+3A_segment_vars">segment_vars</code></td>
<td>
<p>character. data.frame names of 'emi_list' object
attributed to the road segments. Default is NULL.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.table.
</p>


<h3>See Also</h3>

<p>Other emission analysis: 
<code><a href="#topic+emis_grid">emis_grid</a>()</code>,
<code><a href="#topic+emis_summary">emis_summary</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(gtfs2emis)
library(gtfstools)

# read GTFS
gtfs_file &lt;- system.file("extdata/bra_cur_gtfs.zip", package = "gtfs2emis")
gtfs &lt;- gtfstools::read_gtfs(gtfs_file) 

# keep a single trip_id to speed up this example
gtfs_small &lt;- gtfstools::filter_by_trip_id(gtfs, trip_id ="4451136")
  
# run transport model
tp_model &lt;- transport_model(gtfs_data = gtfs_small,
                            min_speed = 2,
                            max_speed = 80,
                            new_speed = 20,
                            spatial_resolution = 100,
                            parallel = FALSE)

# Example using Brazilian emission model and fleet
fleet_data_ef_cetesb &lt;- data.frame(veh_type = "BUS_URBAN_D",
                                   model_year = 2010:2019,
                                   fuel = "D",
                                   fleet_composition = rep(0.1,10)
                                   )
                                   
emi_list &lt;- emission_model(
                tp_model = tp_model,
                ef_model = "ef_brazil_cetesb",
                fleet_data = fleet_data_ef_cetesb,
                pollutant = c("CO","PM10","CO2","CH4","NOx")
                )

# convert emission list to data.table
dt &lt;- emis_to_dt(emi_list)

</code></pre>

<hr>
<h2 id='emission_model'>Emission model</h2><span id='topic+emission_model'></span>

<h3>Description</h3>

<p>Estimate hot-exhaust emissions of public transport systems. This
function must be used together with <code><a href="#topic+transport_model">transport_model</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>emission_model(
  tp_model,
  ef_model,
  fleet_data,
  pollutant,
  reference_year = 2020,
  heightfile = NULL,
  parallel = TRUE,
  ncores = NULL,
  output_path = NULL,
  continue = FALSE,
  quiet = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="emission_model_+3A_tp_model">tp_model</code></td>
<td>
<p>sf_linestring object or a character path the to sf_linestring objects.
The <code>tp_model</code> is the output from <code><a href="#topic+transport_model">transport_model</a></code>,
or the path in which the output files from the <code><a href="#topic+transport_model">transport_model</a></code> are saved.</p>
</td></tr>
<tr><td><code id="emission_model_+3A_ef_model">ef_model</code></td>
<td>
<p>character. A string indicating the emission factor model
to be used. Options include <code>ef_usa_moves</code>, <code>ef_usa_emfac</code>,<code>ef_europe_emep</code>,
,<code>ef_brazil_cetesb</code>, and <code>ef_brazil_scaled_euro</code> (scale <code>ef_brazil_cetesb()</code> based
on <code>ef_scaled_euro()</code>).</p>
</td></tr>
<tr><td><code id="emission_model_+3A_fleet_data">fleet_data</code></td>
<td>
<p>data.frame. A <code>data.frame</code> with information the fleet
characteristics. The required columns depend on the
<code>ef_model</code> selection. See @examples for input.</p>
</td></tr>
<tr><td><code id="emission_model_+3A_pollutant">pollutant</code></td>
<td>
<p>character. Vector with one or more pollutants to be estimated.
Example: <code>c("CO", "CO2", "PM10", "NOx")</code>. See the documentation to check which
pollutants are available for each emission factor model (<code>ef_usa_moves</code>, <code>ef_usa_emfac</code>,
<code>ef_europe_emep</code>, or <code>ef_brazil_cetesb</code>).</p>
</td></tr>
<tr><td><code id="emission_model_+3A_reference_year">reference_year</code></td>
<td>
<p>numeric. Year of reference considered to calculate the
emissions inventory. Defaults to <code>2020</code>. This
argument is only required when the <code>ef_model</code>
argument is <code>ef_usa_moves</code> or <code>ef_usa_emfac</code>.</p>
</td></tr>
<tr><td><code id="emission_model_+3A_heightfile">heightfile</code></td>
<td>
<p>character or raster data. The raster file with height data,
or its filepath, used to estimate emissions considering the effect of
street slope. This argument is used only when <code>ef_brazil_scaled_euro</code> or
<code>ef_europe_emep</code> are selected. Default is <code>NULL</code>. Details are provided in
<code><a href="#topic+slope_class_europe_emep">slope_class_europe_emep</a></code>.</p>
</td></tr>
<tr><td><code id="emission_model_+3A_parallel">parallel</code></td>
<td>
<p>logical. Decides whether the function should run in parallel.
Defaults is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="emission_model_+3A_ncores">ncores</code></td>
<td>
<p>integer. Number of cores to be used in parallel execution. This
argument is ignored if parallel is <code>FALSE</code>. Default (<code>NULL</code>) selects
the total number of available cores minus one.</p>
</td></tr>
<tr><td><code id="emission_model_+3A_output_path">output_path</code></td>
<td>
<p>character. File path where the function output is exported.
If <code>NULL</code> (Default), the function returns the output to user.</p>
</td></tr>
<tr><td><code id="emission_model_+3A_continue">continue</code></td>
<td>
<p>logical. Argument that can be used only with output_path When TRUE,
it skips processing the shape identifiers that were already saved into
files. It is useful to continue processing a GTFS file that was stopped
for some reason. Default value is FALSE.</p>
</td></tr>
<tr><td><code id="emission_model_+3A_quiet">quiet</code></td>
<td>
<p>Logical; Display messages from the emissions or emission factor functions.
Default is 'TRUE'.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>fleet_data</code> must be a <code>data.frame</code> organized according to the desired
<code>ef_model</code>. The required columns is organized as follows (see @examples for real
data usage).
</p>

<ul>
<li> <p><code>reference_year</code>: character; Base year of the emission factor model input.
Required only when  <code>ef_usa_moves</code> or <code style="white-space: pre;">&#8288;_efusa_emfac&#8288;</code> are selected.
</p>
</li>
<li> <p><code>tech</code>: character; After treatment technology. This is required only
when <code>emep_europe</code> is selected. Check <code>?ef_emep_europe</code> for details.
</p>
</li>
<li> <p><code>euro</code>: character; Euro period of vehicle, classified in
&quot;Conventional&quot;, &quot;I&quot;, &quot;II&quot;, &quot;III&quot;, &quot;IV&quot;, &quot;V&quot;, &quot;VI&quot;, and &quot;EEV&quot;. This is required only
when <code>ef_emep_europe</code> is selected. Check <code>ef_europe_emep</code> for details.
</p>
</li>
<li> <p><code>fuel</code>: character; Required when <code>ef_usa_moves</code>, <code>ef_usa_emfac</code> and
<code>ef_europe_emep</code> are selected.
</p>
</li>
<li> <p><code>fleet_composition</code>: Numeric. Scaled composition of fleet. In most
cases, the user might not know which vehicles run on each specific routes.
The composition is used to attribute a probability of a specific vehicle to
circulate in the line. The probability sums one. Required for all emission
factors selection.
Users can check the
<a href="https://ipeagit.github.io/gtfs2emis/articles/gtfs2emis_fleet_data.html">gtfs2emis fleet data vignette</a>,
for more examples.
</p>
</li></ul>

<p>Based on the input height data, the function returns the slope class between two consecutive
bus stop positions of a LineString Simple Feature (transport model object).
The slope is given by the ratio between the height difference and
network distance from two consecutive public transport stops.
The function classifies the slope into one of the seven categories
available on the European Environmental Agency (EEA) database, which is -0.06,
-0.04,-0.02, 0.00, 0.02, 0.04, and 0.06. The classifications is described in
</p>


<h3>Value</h3>

<p>A <code>list</code> with emissions estimates or <code>NULL</code> with output files saved
locally at <code>output_path</code>.
</p>


<h3>See Also</h3>

<p>Other Core function: 
<code><a href="#topic+transport_model">transport_model</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(gtfstools)

# read GTFS
gtfs_file &lt;- system.file("extdata/bra_cur_gtfs.zip", package = "gtfs2emis")
gtfs &lt;- gtfstools::read_gtfs(gtfs_file) 

# keep a single trip_id to speed up this example
gtfs_small &lt;- gtfstools::filter_by_trip_id(gtfs, trip_id ="4451136")
  
# run transport model
tp_model &lt;- transport_model(gtfs_data = gtfs_small,
                            min_speed = 2,
                            max_speed = 80,
                            new_speed = 20,
                            spatial_resolution = 100,
                            parallel = FALSE)

# Example using Brazilian emission model and fleet
fleet_data_ef_cetesb &lt;- data.frame(veh_type = "BUS_URBAN_D",
                                   model_year = 2010:2019,
                                   fuel = "D",
                                   fleet_composition = rep(0.1,10)
                                   )
                                   
emi_cetesb &lt;- progressr::with_progress(emission_model(
                tp_model = tp_model,
                ef_model = "ef_brazil_cetesb",
                fleet_data = fleet_data_ef_cetesb,
                pollutant = c("CO","PM10","CO2","CH4","NOx")
                ))
                            
# Example using European emission model and fleet
fleet_data_ef_europe &lt;- data.frame(  veh_type = c("Ubus Midi &lt;=15 t",
                                                  "Ubus Std 15 - 18 t",
                                                  "Ubus Artic &gt;18 t")
                                   , euro = c("III","IV","V")
                                   , fuel = rep("D",3)
                                   , tech = c("-","SCR","SCR")
                                   , fleet_composition = c(0.4,0.5,0.1))
                                   
emi_emep &lt;- progressr::with_progress(emission_model(tp_model = tp_model
                          , ef_model = "ef_europe_emep"
                          , fleet_data = fleet_data_ef_europe
                          , pollutant = c("PM10","NOx")))

raster_cur &lt;- system.file("extdata/bra_cur-srtm.tif", package = "gtfs2emis")                           
emi_emep_slope &lt;- progressr::with_progress(emission_model(tp_model = tp_model
                          , ef_model = "ef_europe_emep"
                          , fleet_data = fleet_data_ef_europe
                          , heightfile = raster_cur
                          , pollutant = c("PM10","NOx")))  
                                                  
# Example using US EMFAC emission model and fleet
fleet_data_ef_moves &lt;- data.frame(  veh_type = "BUS_URBAN_D"
                                  , model_year = 2010:2019
                                  , fuel = "D"
                                  , reference_year = 2020
                                  , fleet_composition = rep(0.1,10))
                                  
fleet_data_ef_emfac &lt;- data.frame(  veh_type =  "BUS_URBAN_D"
                                  , model_year = 2010:2019
                                  , fuel = "D"
                                  , reference_year = 2020
                                  , fleet_composition = rep(0.1,10))
                                  
# Example using US MOVES emission model and fleet
emi_moves &lt;- emission_model(tp_model = tp_model
                          , ef_model = "ef_usa_moves"
                          , fleet_data = fleet_data_ef_moves
                          , pollutant = c("CO","PM10","CO2","CH4","NOx")
                          , reference_year = 2020)
                          
emi_emfac &lt;- emission_model(tp_model = tp_model
                          , ef_model = "ef_usa_emfac"
                          , fleet_data = fleet_data_ef_emfac
                          , pollutant = c("CO","PM10","CO2","CH4","NOx")
                          , reference_year = 2020)

</code></pre>

<hr>
<h2 id='fuel_correction'>Correction factor equation</h2><span id='topic+fuel_correction'></span>

<h3>Description</h3>

<p>Relations between emissions and fuel properties for diesel heavy-duty
vehicles based on EMEP/EEA. Function based on values from the <a href="https://www.eea.europa.eu/themes/air/air-pollution-sources-1/emep-eea-air-pollutant-emission-inventory-guidebook">EMEP/EEA air pollutant emission inventory guidebook 2019</a>.
Estimates are given by the ratio between correction factor of improved fuel
by the correction factor of base fuel.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fuel_correction(
  pollutant,
  euro_stage,
  improved_fuel = c(den = 835, s = 40, pah = 5, cn = 53, t95 = 320)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fuel_correction_+3A_pollutant">pollutant</code></td>
<td>
<p>character. Pollutant classified in &quot;CO&quot;, &quot;VOC&quot;, &quot;NOx&quot; or
&quot;PM10&quot;.</p>
</td></tr>
<tr><td><code id="fuel_correction_+3A_euro_stage">euro_stage</code></td>
<td>
<p>character. EURO period of vehicle, classified in &quot;PRE&quot;, &quot;I&quot;,
&quot;II&quot;, &quot;III&quot;, &quot;IV&quot;, &quot;V&quot; and &quot;VI&quot;.</p>
</td></tr>
<tr><td><code id="fuel_correction_+3A_improved_fuel">improved_fuel</code></td>
<td>
<p>numeric. Numeric vector for characteristics of an
improved fuel, ordered by: den (Density at 15 degrees C), s (Sulphur
content in ppm), pah (Polycyclic aromatics content in \
number), t95 (Back end distillation in degrees C). Default input uses
c(den = 835, s = 40, pah = 5, cn = 53, t95 = 320).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>numeric. A fuel correction factor.
</p>

<hr>
<h2 id='multiply_ef'>Multiply emission factors by distances</h2><span id='topic+multiply_ef'></span>

<h3>Description</h3>

<p>Calculate hot exhaust emissions by multiplying emission factors by distances
weighted by fleet composition profile.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>multiply_ef(
  fleet_composition,
  dist,
  ef,
  aggregate = TRUE,
  prefix = NULL,
  as_list = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="multiply_ef_+3A_fleet_composition">fleet_composition</code></td>
<td>
<p>vector; Fleet composition, which is a distribution
of fleet based on frequency. If there is only one, 'fleet_composition'
is 1.0.</p>
</td></tr>
<tr><td><code id="multiply_ef_+3A_dist">dist</code></td>
<td>
<p>units ('km'); Length of each link in km.</p>
</td></tr>
<tr><td><code id="multiply_ef_+3A_ef">ef</code></td>
<td>
<p>list or data.table;    Emission factors.</p>
</td></tr>
<tr><td><code id="multiply_ef_+3A_aggregate">aggregate</code></td>
<td>
<p>logical; if TRUE (default) emissions are aggregated by
pollutant.</p>
</td></tr>
<tr><td><code id="multiply_ef_+3A_prefix">prefix</code></td>
<td>
<p>character; Add prefix into emissions names. Missing parameter
(default) means empty prefix.</p>
</td></tr>
<tr><td><code id="multiply_ef_+3A_as_list">as_list</code></td>
<td>
<p>logical. If <code>TRUE</code> (default), the function returns the output
in a <code>list</code> format. If <code>FALSE</code>, the output is returned in a <code>data.table</code>
format.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>units ('g'); emissions per link.
</p>

<hr>
<h2 id='slope_class_europe_emep'>Add slope class into the transport model (LineString Simple Feature object)</h2><span id='topic+slope_class_europe_emep'></span>

<h3>Description</h3>

<p>Based on the input height data, the function returns the slope class between two consecutive
bus stop positions of a LineString Simple Feature (transport model object).
The slope is given by the ratio between the height difference and
network distance from two consecutive public transport stops.
The function classifies the slope into one of the seven categories
available on the European Environmental Agency (EEA) database, which is -0.06,
-0.04,-0.02, 0.00, 0.02, 0.04, and 0.06. The classifications is described in
@details .
</p>


<h3>Usage</h3>

<pre><code class='language-R'>slope_class_europe_emep(tp_model, heightfile, keep = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="slope_class_europe_emep_+3A_tp_model">tp_model</code></td>
<td>
<p>LineString Simple Feature; transport model output.</p>
</td></tr>
<tr><td><code id="slope_class_europe_emep_+3A_heightfile">heightfile</code></td>
<td>
<p>character or raster data; The raster file with height data, or its filepath.</p>
</td></tr>
<tr><td><code id="slope_class_europe_emep_+3A_keep">keep</code></td>
<td>
<p>A logical. Whether the columns related height and slope to the consecutive bus stops
should be kept or dropped (defaults to FALSE, which keeps only the slope classification).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The transport model with slope information.
</p>


<h3>Slopes classification:</h3>

<p>|  <strong>slope interval</strong>              |  <strong>slope class</strong> |
| slope &lt;= -0.070                  |        -0.06     |
| slope &gt; -0.070 &amp; slope &lt;= -0.050 |        -0.06     |
| slope &gt; -0.050 &amp; slope &lt;= -0.030 |        -0.04     |
| slope &gt; -0.030 &amp; slope &lt;= -0.010 |        -0.02     |
| slope &gt; -0.010 &amp; slope &lt;= +0.010 |        +0.00     |
| slope &gt; +0.010 &amp; slope &lt;= +0.030 |        +0.02     |
| slope &gt; +0.030 &amp; slope &lt;= +0.050 |        +0.04     |
| slope &gt; +0.050 &amp; slope &lt;= +0.070 |        +0.06     |
| slope &gt; +0.070                   |        -0.06     |
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
gtfs_file &lt;- system.file("extdata/bra_cur_gtfs.zip", package = "gtfs2emis")
gtfs &lt;- gtfstools::read_gtfs(gtfs_file) 

# keep a single trip_id to speed up this example
gtfs_small &lt;- gtfstools::filter_by_trip_id(gtfs, trip_id ="4451136")
  
# run transport model
tp_model &lt;- transport_model(gtfs_data = gtfs_small,
                            min_speed = 2,
                            max_speed = 80,
                            new_speed = 20,
                            spatial_resolution = 100,
                            parallel = FALSE)

# read raster file
raster_cur &lt;- system.file("extdata/bra_cur-srtm.tif", package = "gtfs2emis")

tp_model_slope &lt;- slope_class_europe_emep(tp_model,raster_cur)

## End(Not run)
</code></pre>

<hr>
<h2 id='transport_model'>Transport model</h2><span id='topic+transport_model'></span>

<h3>Description</h3>

<p>This function converts a public transport data set in GTFS format into a
GPS-like table with the space-time positions and speeds of public transport
vehicles. The function also allow users to set the spatial resolution of the
output and to adjust the speed of public transport vehicles given a
<code>min_speed</code> and <code>max_speed</code> range.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>transport_model(
  gtfs_data,
  min_speed = 2,
  max_speed = 80,
  new_speed = NULL,
  parallel = TRUE,
  ncores = NULL,
  spatial_resolution = 100,
  output_path = NULL,
  continue = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="transport_model_+3A_gtfs_data">gtfs_data</code></td>
<td>
<p>A path to a GTFS file or a GTFS data organized as a list of
<code>data.tables</code> created with <code>gtfstools::read_gtfs()</code>.</p>
</td></tr>
<tr><td><code id="transport_model_+3A_min_speed">min_speed</code></td>
<td>
<p>numeric (in km/h) or a speed units value. Minimum speed to
be considered as valid. Values below minimum speed will be updated
according to the <code>new_speed</code> parameter, which can affect the arrival
and  departure times of vehicles at  transit stops. Defaults to <code>2</code>
km/h.</p>
</td></tr>
<tr><td><code id="transport_model_+3A_max_speed">max_speed</code></td>
<td>
<p>numeric (in km/h) or a speed units value. Maximum speed to
be considered as valid. Values above maximum speed will be  updated
according to the <code>new_speed</code> parameter, which can affect the arrival
and departure times of vehicles at transit stops. Defaults to <code>80</code>
km/h.</p>
</td></tr>
<tr><td><code id="transport_model_+3A_new_speed">new_speed</code></td>
<td>
<p>numeric (in km/h) or a speed units value. Speed value used
to replace the speeds that fall outside the <code>min_speed</code> and <code>max_speed</code>
range or which are missing from the GTFS input. When <code>new_speed = NULL</code>
(the default), the function uses the average speed of the entire GTFS
data feed.</p>
</td></tr>
<tr><td><code id="transport_model_+3A_parallel">parallel</code></td>
<td>
<p>logical. Decides whether the function should run in parallel.
Defaults is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="transport_model_+3A_ncores">ncores</code></td>
<td>
<p>integer. Number of cores to be used in parallel execution. This
argument is ignored if parallel is <code>FALSE</code>. Default (<code>NULL</code>) selects
the total number of available cores minus one.</p>
</td></tr>
<tr><td><code id="transport_model_+3A_spatial_resolution">spatial_resolution</code></td>
<td>
<p>The spatial resolution in meters. Defaults to <code>100</code>.
The function only creates points in order to guarantee that the
minimum distance between two consecutive points will be at most the
<code>spatial_resolution</code> value. If a given GTFS shape_id has two
consecutive points with a distance smaller than the spatial resolution,
the algorithm will not remove such points.</p>
</td></tr>
<tr><td><code id="transport_model_+3A_output_path">output_path</code></td>
<td>
<p>character. A directory path. If <code>NULL</code> (Default), the
function returns the output. If the user passes a valid <code>passed</code>, the
output will be saved in the <code>output_path</code> dir. Note that that the
output of each public transport <code>shape_id</code> is saved separately in
different files. Setting an <code>output_path</code> is recommended when working
with large public transport system because the output of the function
can be significantly large.</p>
</td></tr>
<tr><td><code id="transport_model_+3A_continue">continue</code></td>
<td>
<p>logical. Argument that can be used only with output_path When TRUE,
it skips processing the shape identifiers that were already saved into
files. It is useful to continue processing a GTFS file that was stopped
for some reason. Default value is FALSE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code style="white-space: pre;">&#8288;data.table sf_linestring&#8288;</code> object or <code>NULL</code>.
</p>


<h3>See Also</h3>

<p>Other Core function: 
<code><a href="#topic+emission_model">emission_model</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(gtfs2emis)
library(gtfstools)

# read GTFS
gtfs_file &lt;- system.file("extdata/bra_cur_gtfs.zip", package = "gtfs2emis")
gtfs &lt;- gtfstools::read_gtfs(gtfs_file) 

# keep a single trip_id to speed up this example
gtfs_small &lt;- gtfstools::filter_by_trip_id(gtfs, trip_id ="4451136")
  
# run transport model
tp_model &lt;- transport_model(gtfs_data = gtfs_small,
                            min_speed = 2,
                            max_speed = 80,
                            new_speed = 20,
                            spatial_resolution = 100,
                            parallel = FALSE)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
