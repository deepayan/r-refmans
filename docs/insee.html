<!DOCTYPE html><html lang="en"><head><title>Help for package insee</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {insee}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#add_insee_metadata'><p>Add metadata to the raw data</p></a></li>
<li><a href='#add_insee_title'><p>Add a title column to the idbank list dataset</p></a></li>
<li><a href='#get_column_title'><p>Get the title of dataset's columns</p></a></li>
<li><a href='#get_dataset_list'><p>Download a full INSEE's dataset list</p></a></li>
<li><a href='#get_idbank_list'><p>Download a full INSEE's series key list</p></a></li>
<li><a href='#get_insee'><p>Get data from INSEE BDM database with a SDMX query link</p></a></li>
<li><a href='#get_insee_dataset'><p>Get dataset from INSEE BDM database</p></a></li>
<li><a href='#get_insee_idbank'><p>Get data from INSEE series idbank</p></a></li>
<li><a href='#get_insee_title'><p>Get title from INSEE series idbank</p></a></li>
<li><a href='#search_insee'><p>Search a pattern among insee datasets and idbanks</p></a></li>
<li><a href='#split_title'><p>Split the title column in several columns</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Tools to Easily Download Data from INSEE BDM Database</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1.7</td>
</tr>
<tr>
<td>Description:</td>
<td>Using embedded sdmx queries, get the data of more than 150 000 insee series from 'bdm' macroeconomic database. </td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://pyr-opendatafr.github.io/R-Insee-Data/">https://pyr-opendatafr.github.io/R-Insee-Data/</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/pyr-opendatafr/R-Insee-Data/issues">https://github.com/pyr-opendatafr/R-Insee-Data/issues</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>httr, xml2, tibble, dplyr, stringr, tidyselect (&ge; 1.2.0),
rlang, purrr, crayon, openssl, rappdirs</td>
</tr>
<tr>
<td>Suggests:</td>
<td>lubridate, ggplot2, prettydoc, htmltools, kableExtra, knitr,
rmarkdown, markdown, magrittr, testthat, covr, png</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-08-24 07:50:21 UTC; onyxia</td>
</tr>
<tr>
<td>Author:</td>
<td>Hadrien Leclerc [aut, cre],
  INSEE [cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Hadrien Leclerc &lt;leclerc.hadrien@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-08-26 07:30:01 UTC</td>
</tr>
</table>
<hr>
<h2 id='add_insee_metadata'>Add metadata to the raw data</h2><span id='topic+add_insee_metadata'></span>

<h3>Description</h3>

<p>Add metadata to the raw data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_insee_metadata(df)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_insee_metadata_+3A_df">df</code></td>
<td>
<p>a dataframe containing data obtained from get_insee_idbank or get_insee_dataset</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Add metadata to the raw data obtained from get_insee_idbank or get_insee_dataset
</p>


<h3>Value</h3>

<p>a tibble with the data given as parameter plus the corresponding metadata
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(magrittr)

data =
 get_insee_idbank("001694061") %&gt;%
 add_insee_metadata()

</code></pre>

<hr>
<h2 id='add_insee_title'>Add a title column to the idbank list dataset</h2><span id='topic+add_insee_title'></span>

<h3>Description</h3>

<p>Add a title column to the idbank list dataset
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_insee_title(df, n_split, lang = "en", split = TRUE, clean = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_insee_title_+3A_df">df</code></td>
<td>
<p>a dataframe containing an idbank column called &quot;idbank&quot; or &quot;IDBANK&quot;</p>
</td></tr>
<tr><td><code id="add_insee_title_+3A_n_split">n_split</code></td>
<td>
<p>number of new columns, by default the maximum is chosen</p>
</td></tr>
<tr><td><code id="add_insee_title_+3A_lang">lang</code></td>
<td>
<p>returns an English title, by default is &quot;en&quot;, any other value returns a French title</p>
</td></tr>
<tr><td><code id="add_insee_title_+3A_split">split</code></td>
<td>
<p>split the title column in several columns, by default is TRUE</p>
</td></tr>
<tr><td><code id="add_insee_title_+3A_clean">clean</code></td>
<td>
<p>remove the columns filled with NA (missing value), by default is TRUE</p>
</td></tr>
</table>


<h3>Details</h3>

<p>this function uses extensively the get_insee_title function.
Then, it should be used on an already filtered dataset, not on the full idbank dataset (cf. get_insee_title).
The number of separators in the official INSEE title can vary and is not normalized. Beware all title columns created may not be a cleaned dimension label.
</p>


<h3>Value</h3>

<p>the same dataframe but with one or several title columns
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(magrittr)
library(dplyr)

idbank_empl =
 get_idbank_list("EMPLOI-SALARIE-TRIM-NATIONAL") %&gt;% #employment
 slice(1:15) %&gt;%
 add_insee_title()

</code></pre>

<hr>
<h2 id='get_column_title'>Get the title of dataset's columns</h2><span id='topic+get_column_title'></span>

<h3>Description</h3>

<p>Get the title of dataset's columns
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_column_title(dataset = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_column_title_+3A_dataset">dataset</code></td>
<td>
<p>an INSEE's dataset, if NULL</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a dataframe
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
column_titles_all_dataset = get_column_title()

column_titles = get_column_title("CNA-2014-CONSO-MEN")

</code></pre>

<hr>
<h2 id='get_dataset_list'>Download a full INSEE's dataset list</h2><span id='topic+get_dataset_list'></span>

<h3>Description</h3>

<p>Download a full INSEE's dataset list
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_dataset_list()
</code></pre>


<h3>Details</h3>

<p>the datasets returned are the ones available through a SDMX query
</p>


<h3>Value</h3>

<p>a tibble with 5 columns :  id, Name.fr, Name.en, url, n_series
</p>


<h3>Examples</h3>

<pre><code class='language-R'>insee_dataset = get_dataset_list()

</code></pre>

<hr>
<h2 id='get_idbank_list'>Download a full INSEE's series key list</h2><span id='topic+get_idbank_list'></span>

<h3>Description</h3>

<p>Download a full INSEE's series key list
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_idbank_list(..., dataset = NULL, update = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_idbank_list_+3A_...">...</code></td>
<td>
<p>one or several dataset names</p>
</td></tr>
<tr><td><code id="get_idbank_list_+3A_dataset">dataset</code></td>
<td>
<p>if a dataset name is provided, only a subset of the data is delivered, otherwise
all the data is returned, and column names refer directly to data dimensions</p>
</td></tr>
<tr><td><code id="get_idbank_list_+3A_update">update</code></td>
<td>
<p>It is FALSE by default, if it is set to TRUE, it triggers the metadata update. This update is automatically triggered once every 6 months.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Download a mapping dataset between INSEE series keys (idbank) and SDMX series names.
Under the hood the get_idbank_list uses download.file function from utils, the user can change the mode argument with the following
command : Sys.getenv(INSEE_download_option_idbank_list = &quot;wb&quot;)
If INSEE makes an update, the user can also change the zip file downloaded, the data file contained in the zip and data the separator  :
Sys.setenv(INSEE_idbank_dataset_path = &quot;new_zip_file_link&quot;)
Sys.setenv(INSEE_idbank_sep = &quot;,&quot;)
Sys.setenv(INSEE_idbank_dataset_file = &quot;new_data_file_name&quot;)
</p>


<h3>Value</h3>

<p>a tibble the idbank dataset
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# download datasets list
dt = get_dataset_list()
# use a dataset name to retrieve the series key list related to the dataset
idbank_list = get_idbank_list('CNT-2014-PIB-EQB-RF')

</code></pre>

<hr>
<h2 id='get_insee'>Get data from INSEE BDM database with a SDMX query link</h2><span id='topic+get_insee'></span>

<h3>Description</h3>

<p>Get data from INSEE BDM database with a SDMX query link
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_insee(link, step = "1/1")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_insee_+3A_link">link</code></td>
<td>
<p>SDMX query link</p>
</td></tr>
<tr><td><code id="get_insee_+3A_step">step</code></td>
<td>
<p>argument used only for internal package purposes to tweak download display</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Get data from INSEE BDM database with a SDMX query link.
This function is mainly for package internal use.
It is used by the functions get_insee_dataset, get_insee_idbank and get_dataset_list.
The data is cached, hence all queries are only run once per R session.
The user can disable the download display in the console with the following command :
Sys.setenv(INSEE_download_verbose = &quot;FALSE&quot;).
The use of cached data can be disabled with : Sys.setenv(INSEE_no_cache_use = &quot;TRUE&quot;).
All queries are printed in the console with this command: Sys.setenv(INSEE_print_query = &quot;TRUE&quot;).
</p>


<h3>Value</h3>

<p>a tibble containing the data
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
insee_link = "http://www.bdm.insee.fr/series/sdmx/data/SERIES_BDM"
insee_query = file.path(insee_link, paste0("010539365","?", "firstNObservations=1"))
data = get_insee(insee_query)

</code></pre>

<hr>
<h2 id='get_insee_dataset'>Get dataset from INSEE BDM database</h2><span id='topic+get_insee_dataset'></span>

<h3>Description</h3>

<p>Get dataset from INSEE BDM database
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_insee_dataset(
  dataset,
  startPeriod = NULL,
  endPeriod = NULL,
  firstNObservations = NULL,
  lastNObservations = NULL,
  includeHistory = NULL,
  updatedAfter = NULL,
  filter = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_insee_dataset_+3A_dataset">dataset</code></td>
<td>
<p>dataset name to be downloaded</p>
</td></tr>
<tr><td><code id="get_insee_dataset_+3A_startperiod">startPeriod</code></td>
<td>
<p>start date of data</p>
</td></tr>
<tr><td><code id="get_insee_dataset_+3A_endperiod">endPeriod</code></td>
<td>
<p>end date of data</p>
</td></tr>
<tr><td><code id="get_insee_dataset_+3A_firstnobservations">firstNObservations</code></td>
<td>
<p>get the first N observations for each key series (idbank)</p>
</td></tr>
<tr><td><code id="get_insee_dataset_+3A_lastnobservations">lastNObservations</code></td>
<td>
<p>get the last N observations for each key series (idbank)</p>
</td></tr>
<tr><td><code id="get_insee_dataset_+3A_includehistory">includeHistory</code></td>
<td>
<p>boolean to access the previous releases (not available on all series)</p>
</td></tr>
<tr><td><code id="get_insee_dataset_+3A_updatedafter">updatedAfter</code></td>
<td>
<p>starting point for querying the previous releases (format yyyy-mm-ddThh:mm:ss)</p>
</td></tr>
<tr><td><code id="get_insee_dataset_+3A_filter">filter</code></td>
<td>
<p>Use the filter to choose only some values in a dimension. It is recommended to use it for big datasets.
A dimension left empty means all values are selected. To select multiple values in one dimension put a &quot;+&quot; between those values (see example)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Get dataset from INSEE BDM database
</p>


<h3>Value</h3>

<p>a tibble with the data
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
insee_dataset = get_dataset_list()
idbank_ipc = get_idbank_list("IPC-2015")

#example 1
data = get_insee_dataset("IPC-2015", filter = "M+A.........CVS..", startPeriod = "2015-03")

#example 2
data = get_insee_dataset("IPC-2015", filter = "A..SO...VARIATIONS_A....BRUT..SO",
 includeHistory = TRUE, updatedAfter = "2017-07-11T08:45:00")


</code></pre>

<hr>
<h2 id='get_insee_idbank'>Get data from INSEE series idbank</h2><span id='topic+get_insee_idbank'></span>

<h3>Description</h3>

<p>Get data from INSEE series idbank
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_insee_idbank(
  ...,
  limit = TRUE,
  startPeriod = NULL,
  endPeriod = NULL,
  firstNObservations = NULL,
  lastNObservations = NULL,
  includeHistory = NULL,
  updatedAfter = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_insee_idbank_+3A_...">...</code></td>
<td>
<p>one or several series key (idbank)</p>
</td></tr>
<tr><td><code id="get_insee_idbank_+3A_limit">limit</code></td>
<td>
<p>by default, the function get_insee_idbank has a 1200-idbank limit.
Set limit argument to FALSE to ignore the limit or modify the limit with the following command : Sys.setenv(INSEE_idbank_limit = 1200)</p>
</td></tr>
<tr><td><code id="get_insee_idbank_+3A_startperiod">startPeriod</code></td>
<td>
<p>start date of data</p>
</td></tr>
<tr><td><code id="get_insee_idbank_+3A_endperiod">endPeriod</code></td>
<td>
<p>end date of data</p>
</td></tr>
<tr><td><code id="get_insee_idbank_+3A_firstnobservations">firstNObservations</code></td>
<td>
<p>get the first N observations for each key series (idbank)</p>
</td></tr>
<tr><td><code id="get_insee_idbank_+3A_lastnobservations">lastNObservations</code></td>
<td>
<p>get the last N observations for each key series (idbank)</p>
</td></tr>
<tr><td><code id="get_insee_idbank_+3A_includehistory">includeHistory</code></td>
<td>
<p>boolean to access the previous releases (not available on all series)</p>
</td></tr>
<tr><td><code id="get_insee_idbank_+3A_updatedafter">updatedAfter</code></td>
<td>
<p>starting point for querying the previous releases (format yyyy-mm-ddThh:mm:ss)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Get data from INSEE series idbanks.
The user can disable the download display in the console with the following command :
Sys.setenv(INSEE_download_verbose = &quot;FALSE&quot;)
</p>


<h3>Value</h3>

<p>a tibble with the data
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

#example 1 : import price index of industrial products and turnover index : manufacture of wood
data = get_insee_idbank("001558315", "010540726")

#example 2 : unemployment data

library(magrittr)
library(dplyr)
library(ggplot2)

df_idbank_list_selected =
  get_idbank_list("CHOMAGE-TRIM-NATIONAL") %&gt;%  #unemployment dataset
  filter(SEXE == 0) %&gt;% #men and women
  add_insee_title()

idbank_list_selected = df_idbank_list_selected %&gt;% pull(idbank)

unem = get_insee_idbank(idbank_list_selected)

#example 3 : French GDP growth rate

df_idbank_list_selected =
  get_idbank_list("CNT-2014-PIB-EQB-RF") %&gt;%  # Gross domestic product balance
  filter(FREQ == "T") %&gt;% #quarter
  filter(OPERATION == "PIB") %&gt;% #GDP
  filter(NATURE == "TAUX") %&gt;% #rate
  filter(CORRECTION == "CVS-CJO") #SA-WDA, seasonally adjusted, working day adjusted

idbank = df_idbank_list_selected %&gt;% pull(idbank)

data = get_insee_idbank(idbank) %&gt;%
  add_insee_metadata()

#plot
ggplot(data, aes(x = DATE, y = OBS_VALUE)) +
geom_col() +
ggtitle("French GDP growth rate, quarter-on-quarter, sa-wda") +
labs(subtitle = sprintf("Last updated : %s", data$TIME_PERIOD[1]))


</code></pre>

<hr>
<h2 id='get_insee_title'>Get title from INSEE series idbank</h2><span id='topic+get_insee_title'></span>

<h3>Description</h3>

<p>Get title from INSEE series idbank
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_insee_title(..., lang = "en")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_insee_title_+3A_...">...</code></td>
<td>
<p>list of series key (idbank)</p>
</td></tr>
<tr><td><code id="get_insee_title_+3A_lang">lang</code></td>
<td>
<p>language of the title, by default it is Engligh, if lang is different from &quot;en&quot; then French will be the title's language</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Query INSEE website to get series title from series key (idbank).
Any query to INSEE database can handle around 400 idbanks at maximum, if necessary the idbank list will then be splitted in several lists of 400 idbanks each.
Consequently, it is not advised to use it on the whole idbank dataset, the user should filter the idbank dataset first.
</p>


<h3>Value</h3>

<p>a character vector with the titles
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#example 1 : industrial production index on manufacturing and industrial activities
title = get_insee_title("010537900")

#example 2 : automotive industry and overall industrial production
library(magrittr)
library(dplyr)
library(stringr)

idbank_list_selected =
  get_idbank_list("IPI-2015") %&gt;% #industrial production index dataset
  filter(FREQ == "M") %&gt;% #monthly
  filter(NATURE == "INDICE") %&gt;% #index
  filter(CORRECTION  == "CVS-CJO") %&gt;% #Working day and seasonally adjusted SA-WDA
  filter(str_detect(NAF2,"^29$|A10-BE")) %&gt;% #automotive industry and overall industrial production
  mutate(title = get_insee_title(idbank))


</code></pre>

<hr>
<h2 id='search_insee'>Search a pattern among insee datasets and idbanks</h2><span id='topic+search_insee'></span>

<h3>Description</h3>

<p>Search a pattern among insee datasets and idbanks
</p>


<h3>Usage</h3>

<pre><code class='language-R'>search_insee(pattern = ".*")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="search_insee_+3A_pattern">pattern</code></td>
<td>
<p>string used to filter the dataset and idbank list</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data related to idbanks is stored internally in the package and might the most up to date.
The function ignores accents and cases.
</p>


<h3>Value</h3>

<p>the dataset and idbank table filtered with the pattern
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# example 1 : search one pattern, the accents do not matter
writeLines("the word 'enqu\U00EAte' (meaning survey in French) will match with 'enquete'")
dataset_enquete = search_insee("enquete")

# example 2 : search multiple patterns
dataset_survey_gdp = search_insee("Survey|gdp")

# example 3 : data about paris
data_paris = search_insee('paris')

# example 4 : all data
data_all = search_insee()

</code></pre>

<hr>
<h2 id='split_title'>Split the title column in several columns</h2><span id='topic+split_title'></span>

<h3>Description</h3>

<p>Split the title column in several columns
</p>


<h3>Usage</h3>

<pre><code class='language-R'>split_title(df, title_col_name, pattern, n_split = "max", lang = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="split_title_+3A_df">df</code></td>
<td>
<p>a dataframe containing a title column</p>
</td></tr>
<tr><td><code id="split_title_+3A_title_col_name">title_col_name</code></td>
<td>
<p>the column name to be splitted, if missing it will be either TITLE_EN</p>
</td></tr>
<tr><td><code id="split_title_+3A_pattern">pattern</code></td>
<td>
<p>the value by default is stored in the package and it is advised to use it, but in some cases it is useful to use one's pattern</p>
</td></tr>
<tr><td><code id="split_title_+3A_n_split">n_split</code></td>
<td>
<p>number of new columns, by default the maximum is chosen</p>
</td></tr>
<tr><td><code id="split_title_+3A_lang">lang</code></td>
<td>
<p>by default it returns both the French and the English title provided by INSEE</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The number of separators in the official INSEE title can vary and is not normalized. Beware all title columns created may not be a cleaned dimension label.
</p>


<h3>Value</h3>

<p>the same dataframe with the title column splitted
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(magrittr)

# quarterly payroll enrollment in the construction sector
data_raw = get_insee_idbank("001577236")

data = data_raw %&gt;%
  split_title()

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
