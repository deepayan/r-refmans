<!DOCTYPE html><html><head><title>Help for package spFW</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {spFW}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#HFWM_est'><p>Estimation Function for Hierarchical Finlay-Wilkinson Model</p></a></li>
<li><a href='#HFWM_pred'><p>Prediction Function for Hierarchical Finlay-Wilkinson Model</p></a></li>
<li><a href='#HSFWM_est'><p>Estimation Function for Hierarchical Spatial Finlay-Wilkinson Model</p></a></li>
<li><a href='#HSFWM_pred'><p>Prediction Function for Hierarchical Spatial Finlay-Wilkinson Model</p></a></li>
<li><a href='#spFW_example_data'><p>Example Data for Analysis</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Hierarchical Spatial Finlay-Wilkinson Model</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Author:</td>
<td>Xingche Guo &lt;xguo@iastate.edu&gt;</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Xingche Guo &lt;xguo@iastate.edu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Estimation and Prediction Functions Using Bayesian Hierarchical Spatial Finlay-Wilkinson Model for Analysis of Multi-Environment Field Trials.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>6.1.1</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo</td>
</tr>
<tr>
<td>Imports:</td>
<td>Rcpp</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-03-29 07:41:56 UTC; apple</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-03-29 18:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='HFWM_est'>Estimation Function for Hierarchical Finlay-Wilkinson Model</h2><span id='topic+HFWM_est'></span>

<h3>Description</h3>

<p>This function ignores spatial effects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>HFWM_est(Y, VAR, ENV, kin_info = FALSE, A = NULL, env_info = FALSE,
  Z = NULL, inits = NULL, hyper_para = NULL, M_iter = 5000,
  burn_in = 3000, thin = 5, save_chain = FALSE, seed = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="HFWM_est_+3A_y">Y</code></td>
<td>
<p>A length-N numerical response vector</p>
</td></tr>
<tr><td><code id="HFWM_est_+3A_var">VAR</code></td>
<td>
<p>A length-N factor/character vector indicating the genotype information of Y</p>
</td></tr>
<tr><td><code id="HFWM_est_+3A_env">ENV</code></td>
<td>
<p>A length-N factor/character vector indicating the field information of Y</p>
</td></tr>
<tr><td><code id="HFWM_est_+3A_kin_info">kin_info</code></td>
<td>
<p>A logical parameter controling if to use kinship matrix</p>
</td></tr>
<tr><td><code id="HFWM_est_+3A_a">A</code></td>
<td>
<p>kinship matrix, give value only if kin_info = TRUE</p>
</td></tr>
<tr><td><code id="HFWM_est_+3A_env_info">env_info</code></td>
<td>
<p>A logical parameter controling whether to use environmental covariates</p>
</td></tr>
<tr><td><code id="HFWM_est_+3A_z">Z</code></td>
<td>
<p>environmental covariates matrix with rownames = field names, give value only if env_info = TRUE</p>
</td></tr>
<tr><td><code id="HFWM_est_+3A_inits">inits</code></td>
<td>
<p>initial values, default is given</p>
</td></tr>
<tr><td><code id="HFWM_est_+3A_hyper_para">hyper_para</code></td>
<td>
<p>hyper-parameter values, default is given</p>
</td></tr>
<tr><td><code id="HFWM_est_+3A_m_iter">M_iter</code></td>
<td>
<p>Total iteration number</p>
</td></tr>
<tr><td><code id="HFWM_est_+3A_burn_in">burn_in</code></td>
<td>
<p>Burn in number</p>
</td></tr>
<tr><td><code id="HFWM_est_+3A_thin">thin</code></td>
<td>
<p>Thinning value</p>
</td></tr>
<tr><td><code id="HFWM_est_+3A_save_chain">save_chain</code></td>
<td>
<p>A logical parameter controling whether to save MCMC chain: 'Chains.rds' in current working directory</p>
</td></tr>
<tr><td><code id="HFWM_est_+3A_seed">seed</code></td>
<td>
<p>Random seed value</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Mean estimates and RMSE value
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(spFW)

# load data
data(spFW_example_data)
Y &lt;- spFW_example_data$yield
VAR &lt;- spFW_example_data$geno
ENV &lt;- spFW_example_data$loc
COOR &lt;- spFW_example_data[,c(4,5)]

# run model
fit0 &lt;- HFWM_est(Y, VAR, ENV, M_iter = 1000, burn_in = 500, thin = 5)

# plot estimated Y
plot(Y, fit0$yhat)

</code></pre>

<hr>
<h2 id='HFWM_pred'>Prediction Function for Hierarchical Finlay-Wilkinson Model</h2><span id='topic+HFWM_pred'></span>

<h3>Description</h3>

<p>This function ignores spatial effects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>HFWM_pred(Y, VAR, ENV, VAR2, ENV2, save_int = FALSE, kin_info = FALSE,
  A = NULL, inits = NULL, hyper_para = NULL, M_iter = 5000,
  burn_in = 3000, thin = 5, seed = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="HFWM_pred_+3A_y">Y</code></td>
<td>
<p>A length-N1 numerical response vector from training set</p>
</td></tr>
<tr><td><code id="HFWM_pred_+3A_var">VAR</code></td>
<td>
<p>A length-N1 factor/character vector indicating the genotype information of Y</p>
</td></tr>
<tr><td><code id="HFWM_pred_+3A_env">ENV</code></td>
<td>
<p>A length-N1 factor/character vector indicating the field information of Y</p>
</td></tr>
<tr><td><code id="HFWM_pred_+3A_var2">VAR2</code></td>
<td>
<p>A length-N2 factor/character vector indicating the genotype information of testing set</p>
</td></tr>
<tr><td><code id="HFWM_pred_+3A_env2">ENV2</code></td>
<td>
<p>A length-N2 factor/character vector indicating the field information of of testing set</p>
</td></tr>
<tr><td><code id="HFWM_pred_+3A_save_int">save_int</code></td>
<td>
<p>A logical parameter controling whether to save prediction credible intervals</p>
</td></tr>
<tr><td><code id="HFWM_pred_+3A_kin_info">kin_info</code></td>
<td>
<p>A logical parameter controling if to use kinship matrix</p>
</td></tr>
<tr><td><code id="HFWM_pred_+3A_a">A</code></td>
<td>
<p>kinship matrix, give value only if kin_info = TRUE</p>
</td></tr>
<tr><td><code id="HFWM_pred_+3A_inits">inits</code></td>
<td>
<p>initial values, default is given</p>
</td></tr>
<tr><td><code id="HFWM_pred_+3A_hyper_para">hyper_para</code></td>
<td>
<p>hyper-parameter values, default is given</p>
</td></tr>
<tr><td><code id="HFWM_pred_+3A_m_iter">M_iter</code></td>
<td>
<p>Total iteration number</p>
</td></tr>
<tr><td><code id="HFWM_pred_+3A_burn_in">burn_in</code></td>
<td>
<p>Burn in number</p>
</td></tr>
<tr><td><code id="HFWM_pred_+3A_thin">thin</code></td>
<td>
<p>Thinning value</p>
</td></tr>
<tr><td><code id="HFWM_pred_+3A_seed">seed</code></td>
<td>
<p>Random seed value</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Mean prediction values and/or prediction intervals
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(spFW)

# load and split data
data(spFW_example_data)
idx_pred &lt;- sample(125, 25)

Y0 &lt;- spFW_example_data$yield
VAR0 &lt;- spFW_example_data$geno
ENV0 &lt;- spFW_example_data$loc


Y1 &lt;- Y0[-idx_pred]
Y2 &lt;- Y0[idx_pred]
VAR1 &lt;- VAR0[-idx_pred]
VAR2 &lt;- VAR0[idx_pred]
ENV1 &lt;- ENV0[-idx_pred]
ENV2 &lt;- ENV0[idx_pred]
order_y &lt;- order(Y2)

# run model
pred0 &lt;- HFWM_pred(Y1, VAR1, ENV1, VAR2, ENV2, save_int = TRUE,
                   M_iter = 1000, burn_in = 500, thin = 5)

# visualize prediction results
plot(1:25, pred0$PY[order_y], ylim = c(50, 250), pch = 15, col = "red",
     xlab = "Plant ID for Prediction", ylab = "Yield",
     main = "95% Prediction Intervals with Predicted Mean (Red) Versus True Yield (Blue)")
points(1:25, Y2[order_y], col = "blue")
for (i in 1:25){
  lines(x = c(i,i), y = c(pred0$PY_CI[,order_y][1,i], pred0$PY_CI[,order_y][4,i]))
}



</code></pre>

<hr>
<h2 id='HSFWM_est'>Estimation Function for Hierarchical Spatial Finlay-Wilkinson Model</h2><span id='topic+HSFWM_est'></span>

<h3>Description</h3>

<p>This function considers spatial adjustments.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>HSFWM_est(Y, VAR, ENV, COOR, kin_info = FALSE, A = NULL,
  env_info = FALSE, Z = NULL, inits = NULL, hyper_para = NULL,
  M_iter = 5000, burn_in = 3000, thin = 5, save_chain = FALSE,
  seed = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="HSFWM_est_+3A_y">Y</code></td>
<td>
<p>A length-N numerical response vector</p>
</td></tr>
<tr><td><code id="HSFWM_est_+3A_var">VAR</code></td>
<td>
<p>A length-N factor/character vector indicating the genotype information of Y</p>
</td></tr>
<tr><td><code id="HSFWM_est_+3A_env">ENV</code></td>
<td>
<p>A length-N factor/character vector indicating the field information of Y</p>
</td></tr>
<tr><td><code id="HSFWM_est_+3A_coor">COOR</code></td>
<td>
<p>A N by 2 numerical matrix indicating the spatial locations of Y</p>
</td></tr>
<tr><td><code id="HSFWM_est_+3A_kin_info">kin_info</code></td>
<td>
<p>A logical parameter controling if to use kinship matrix</p>
</td></tr>
<tr><td><code id="HSFWM_est_+3A_a">A</code></td>
<td>
<p>kinship matrix, give value only if kin_info = TRUE</p>
</td></tr>
<tr><td><code id="HSFWM_est_+3A_env_info">env_info</code></td>
<td>
<p>A logical parameter controling whether to use environmental covariates</p>
</td></tr>
<tr><td><code id="HSFWM_est_+3A_z">Z</code></td>
<td>
<p>environmental covariates matrix with rownames = field names, give value only if env_info = TRUE</p>
</td></tr>
<tr><td><code id="HSFWM_est_+3A_inits">inits</code></td>
<td>
<p>initial values, default is given</p>
</td></tr>
<tr><td><code id="HSFWM_est_+3A_hyper_para">hyper_para</code></td>
<td>
<p>hyper-parameter values, default is given</p>
</td></tr>
<tr><td><code id="HSFWM_est_+3A_m_iter">M_iter</code></td>
<td>
<p>Total iteration number</p>
</td></tr>
<tr><td><code id="HSFWM_est_+3A_burn_in">burn_in</code></td>
<td>
<p>Burn in number</p>
</td></tr>
<tr><td><code id="HSFWM_est_+3A_thin">thin</code></td>
<td>
<p>Thinning value</p>
</td></tr>
<tr><td><code id="HSFWM_est_+3A_save_chain">save_chain</code></td>
<td>
<p>A logical parameter controling whether to save MCMC chain: 'Chains.rds' in current working directory</p>
</td></tr>
<tr><td><code id="HSFWM_est_+3A_seed">seed</code></td>
<td>
<p>Random seed value</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Mean estimates and RMSE value
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(spFW)

# load data
data(spFW_example_data)
Y &lt;- spFW_example_data$yield
VAR &lt;- spFW_example_data$geno
ENV &lt;- spFW_example_data$loc
COOR &lt;- spFW_example_data[,c(4,5)]

# run model
fit1 &lt;- HSFWM_est(Y, VAR, ENV, COOR,
                  M_iter = 1000, burn_in = 500, thin = 5)

# plot estimated Y
plot(Y, fit1$yhat)


</code></pre>

<hr>
<h2 id='HSFWM_pred'>Prediction Function for Hierarchical Spatial Finlay-Wilkinson Model</h2><span id='topic+HSFWM_pred'></span>

<h3>Description</h3>

<p>This function considers spatial adjustments.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>HSFWM_pred(Y, VAR, ENV, COOR, VAR2, ENV2, COOR2, save_int = FALSE,
  kin_info = FALSE, A = NULL, inits = NULL, hyper_para = NULL,
  M_iter = 5000, burn_in = 3000, thin = 5, seed = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="HSFWM_pred_+3A_y">Y</code></td>
<td>
<p>A length-N1 numerical response vector from training set</p>
</td></tr>
<tr><td><code id="HSFWM_pred_+3A_var">VAR</code></td>
<td>
<p>A length-N1 factor/character vector indicating the genotype information of Y</p>
</td></tr>
<tr><td><code id="HSFWM_pred_+3A_env">ENV</code></td>
<td>
<p>A length-N1 factor/character vector indicating the field information of Y</p>
</td></tr>
<tr><td><code id="HSFWM_pred_+3A_coor">COOR</code></td>
<td>
<p>A N1 by 2 numerical matrix indicating the spatial locations of Y</p>
</td></tr>
<tr><td><code id="HSFWM_pred_+3A_var2">VAR2</code></td>
<td>
<p>A length-N2 factor/character vector indicating the genotype information of testing set</p>
</td></tr>
<tr><td><code id="HSFWM_pred_+3A_env2">ENV2</code></td>
<td>
<p>A length-N2 factor/character vector indicating the field information of of testing set</p>
</td></tr>
<tr><td><code id="HSFWM_pred_+3A_coor2">COOR2</code></td>
<td>
<p>A N2 by 2 numerical matrix indicating the spatial locations of testing set</p>
</td></tr>
<tr><td><code id="HSFWM_pred_+3A_save_int">save_int</code></td>
<td>
<p>A logical parameter controling whether to save prediction credible intervals</p>
</td></tr>
<tr><td><code id="HSFWM_pred_+3A_kin_info">kin_info</code></td>
<td>
<p>A logical parameter controling if to use kinship matrix</p>
</td></tr>
<tr><td><code id="HSFWM_pred_+3A_a">A</code></td>
<td>
<p>kinship matrix, give value only if kin_info = TRUE</p>
</td></tr>
<tr><td><code id="HSFWM_pred_+3A_inits">inits</code></td>
<td>
<p>initial values, default is given</p>
</td></tr>
<tr><td><code id="HSFWM_pred_+3A_hyper_para">hyper_para</code></td>
<td>
<p>hyper-parameter values, default is given</p>
</td></tr>
<tr><td><code id="HSFWM_pred_+3A_m_iter">M_iter</code></td>
<td>
<p>Total iteration number</p>
</td></tr>
<tr><td><code id="HSFWM_pred_+3A_burn_in">burn_in</code></td>
<td>
<p>Burn in number</p>
</td></tr>
<tr><td><code id="HSFWM_pred_+3A_thin">thin</code></td>
<td>
<p>Thinning value</p>
</td></tr>
<tr><td><code id="HSFWM_pred_+3A_seed">seed</code></td>
<td>
<p>Random seed value</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Mean prediction values and/or prediction intervals
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(spFW)

# load and split data
data(spFW_example_data)
idx_pred &lt;- sample(125, 25)

Y0 &lt;- spFW_example_data$yield
VAR0 &lt;- spFW_example_data$geno
ENV0 &lt;- spFW_example_data$loc
COOR0 &lt;- spFW_example_data[,c(4,5)]

Y1 &lt;- Y0[-idx_pred]
Y2 &lt;- Y0[idx_pred]
VAR1 &lt;- VAR0[-idx_pred]
VAR2 &lt;- VAR0[idx_pred]
ENV1 &lt;- ENV0[-idx_pred]
ENV2 &lt;- ENV0[idx_pred]
COOR1 &lt;- COOR0[-idx_pred,]
COOR2 &lt;- COOR0[idx_pred,]
order_y &lt;- order(Y2)


# run model
pred1 &lt;- HSFWM_pred(Y1, VAR1, ENV1, COOR1, VAR2, ENV2, COOR2, save_int = TRUE,
                    M_iter = 1000, burn_in = 500, thin = 5)

# visualize prediction results
plot(1:25, pred1$PY[order_y], ylim = c(50, 250), pch = 15, col = "red",
     xlab = "Plant ID for Prediction", ylab = "Yield",
     main = "95% Prediction Intervals with Predicted Mean (Red) Versus True Yield (Blue)")
points(1:25, Y2[order_y], col = "blue")
for (i in 1:25){
  lines(x = c(i,i), y = c(pred1$PY_CI[,order_y][1,i], pred1$PY_CI[,order_y][4,i]))
}
</code></pre>

<hr>
<h2 id='spFW_example_data'>Example Data for Analysis</h2><span id='topic+spFW_example_data'></span>

<h3>Description</h3>

<p>A data frame containing the plant yield, genotypes, environments, and within-field positions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spFW_example_data
</code></pre>


<h3>Format</h3>

<p>A data frame with 5 elements, which are:
</p>

<dl>
<dt>yield</dt><dd><p>Plant yield</p>
</dd>
<dt>geno</dt><dd><p>Plant genotype ID</p>
</dd>
<dt>loc</dt><dd><p>Plant environment ID</p>
</dd>
<dt>range</dt><dd><p>Plant x-coordinate at a given environment</p>
</dd>
<dt>pass</dt><dd><p>Plant y-coordinate at a given environment</p>
</dd>
</dl>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
