<!DOCTYPE html><html lang="en"><head><title>Help for package finna</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {finna}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#analyze_metadata'><p>Analyze Refined Finna Metadata</p></a></li>
<li><a href='#analyze_trends_over_time'><p>Analyze Trends Over Time with Binned Years (Decades)</p></a></li>
<li><a href='#check_api_access'><p>Check Access to the Finna API</p></a></li>
<li><a href='#enrich_author_name'><p>Enrich Author Name from 'Finna' API and Save Results</p></a></li>
<li><a href='#fetch_all_records'><p>Fetch All Records from Finna API</p></a></li>
<li><a href='#fetch_finna'><p>Fetch Finna Collection Data with Flexible Query</p></a></li>
<li><a href='#fetch_viola_records'><p>Fetch Records by Year Ranges from Finna API (Including NA Dates)</p></a></li>
<li><a href='#finna_as_json'><p>Convert Finna query object to JSON</p></a></li>
<li><a href='#finna_cite'><p>Cite a Finna collection</p></a></li>
<li><a href='#finna_interactive'><p>Interactive Finna Search and Data Download</p></a></li>
<li><a href='#get_finna_records'><p>Get Finna Records by IDs with Extended Options</p></a></li>
<li><a href='#harvest_oai_pmh'><p>Harvest Metadata from an OAI-PMH Server</p></a></li>
<li><a href='#load_offline_data'><p>Load 'Finna' Search Results from Offline File</p></a></li>
<li><a href='#refine_metadata'><p>Refine Finna Metadata</p></a></li>
<li><a href='#save_for_offline'><p>Save 'Finna' Search Results for Offline Access</p></a></li>
<li><a href='#search_finna'><p>Finna Index Search with Total Limit Option</p></a></li>
<li><a href='#search_publisher'><p>Finna Publisher Search</p></a></li>
<li><a href='#top_plot'><p>Plot Top Entries</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Access the 'Finna' API</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2025-01-10</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Akewak Jeba &lt;akjeba@utu.fi&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides functions to access and retrieve metadata from the 'Finna' API <a href="https://api.finna.fi/">https://api.finna.fi/</a>, which aggregates content from Finnish archives, libraries, and museums.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/BSD-2-Clause">BSD_2_clause</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr, glue, httr, xml2, jsonlite, ggplot2, readr, tibble,
curl, progress, purrr</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 3.0.0), rmarkdown, knitr</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://ropengov.github.io/finna/">https://ropengov.github.io/finna/</a>,
<a href="https://CRAN.R-project.org/package=finna">https://CRAN.R-project.org/package=finna</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/rOpenGov/finna/issues">https://github.com/rOpenGov/finna/issues</a></td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-01-20 16:01:40 UTC; akasia</td>
</tr>
<tr>
<td>Author:</td>
<td>Akewak Jeba <a href="https://orcid.org/0009-0007-1347-7552"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cre],
  Leo Lahti <a href="https://orcid.org/0000-0001-5537-637X"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-01-22 16:50:07 UTC</td>
</tr>
</table>
<hr>
<h2 id='analyze_metadata'>Analyze Refined Finna Metadata</h2><span id='topic+analyze_metadata'></span>

<h3>Description</h3>

<p>Performs basic analysis on Finna metadata, summarizing the distribution of formats, years, and authors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>analyze_metadata(metadata)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="analyze_metadata_+3A_metadata">metadata</code></td>
<td>
<p>A tibble containing refined Finna metadata.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of tibbles with summaries of formats, years, and authors.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(finna)
sibelius_data &lt;- search_finna("sibelius")
refined_data &lt;- refine_metadata(sibelius_data)
analyze_metadata(refined_data)

</code></pre>

<hr>
<h2 id='analyze_trends_over_time'>Analyze Trends Over Time with Binned Years (Decades)</h2><span id='topic+analyze_trends_over_time'></span>

<h3>Description</h3>

<p>This function analyzes how search results for a given query have trended over time, binned by decades.
It plots the number of records found for each decade, allowing users to observe long-term trends.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>analyze_trends_over_time(data, query = "Records Over Time")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="analyze_trends_over_time_+3A_data">data</code></td>
<td>
<p>A tibble containing Finna search results with a <code>Year</code> column (as character or numeric).</p>
</td></tr>
<tr><td><code id="analyze_trends_over_time_+3A_query">query</code></td>
<td>
<p>A search query string (optional) to label the plot.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggplot2 plot showing the trend of records over time.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>finna_data &lt;- search_finna("Sibelius")
trends &lt;- analyze_trends_over_time(finna_data, "Sibelius")
print(trends)

</code></pre>

<hr>
<h2 id='check_api_access'>Check Access to the Finna API</h2><span id='topic+check_api_access'></span>

<h3>Description</h3>

<p>This function tests whether R can successfully connect to the Finna API by downloading
the OpenAPI specification from <code style="white-space: pre;">&#8288;https://api.finna.fi/api/v1/?openapi&#8288;</code>. It returns
a logical value indicating the accessibility of the API.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_api_access()
</code></pre>


<h3>Value</h3>

<p>A logical value:
</p>

<ul>
<li> <p><code>TRUE</code>: The API is accessible.
</p>
</li>
<li> <p><code>FALSE</code>: The API is not accessible.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  # Check if the API is accessible
  access &lt;- check_api_access()
  if (access) {
    message("Finna API is accessible")
  } else {
    message("Finna API is not accessible")
  }

## End(Not run)
</code></pre>

<hr>
<h2 id='enrich_author_name'>Enrich Author Name from 'Finna' API and Save Results</h2><span id='topic+enrich_author_name'></span>

<h3>Description</h3>

<p>This function reads a CSV file from a URL containing Melinda IDs and author names.
If the author name is missing (NA), it searches the 'Finna' API for the corresponding Melinda ID
to retrieve and update the author name. The updated data is saved in a CSV file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>enrich_author_name(url, output_file = "updated_na_author_rows.csv")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="enrich_author_name_+3A_url">url</code></td>
<td>
<p>A character string specifying the URL of the CSV file with Melinda IDs and author names.</p>
</td></tr>
<tr><td><code id="enrich_author_name_+3A_output_file">output_file</code></td>
<td>
<p>A character string specifying the output CSV file name.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble with updated author names. The file is saved to a temporary directory using <code>tempdir()</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
enrich_author_name(url = "https://example/na_author_rows.csv",
                   output_file = "updated_na_author_rows.csv")

## End(Not run)
</code></pre>

<hr>
<h2 id='fetch_all_records'>Fetch All Records from Finna API</h2><span id='topic+fetch_all_records'></span>

<h3>Description</h3>

<p>This function fetches records from the Finna API in chunks of 100,000,
automatically paginating through the results until the maximum number of
records is reached.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fetch_all_records(
  base_query = "*",
  base_filters = c("collection:\"FEN\""),
  sort = "main_date_str asc",
  limit_per_query = 1e+05,
  total_limit = Inf
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fetch_all_records_+3A_base_query">base_query</code></td>
<td>
<p>A string specifying the base query. Defaults to &quot;*&quot;.</p>
</td></tr>
<tr><td><code id="fetch_all_records_+3A_base_filters">base_filters</code></td>
<td>
<p>A character vector of filters to apply to the query.
Defaults to <code>c('collection:"FEN"')</code>.</p>
</td></tr>
<tr><td><code id="fetch_all_records_+3A_sort">sort</code></td>
<td>
<p>A string defining the sort order of the results. Default is &quot;main_date_str asc&quot;.</p>
</td></tr>
<tr><td><code id="fetch_all_records_+3A_limit_per_query">limit_per_query</code></td>
<td>
<p>An integer specifying the number of records to fetch per query. Defaults to 100000.</p>
</td></tr>
<tr><td><code id="fetch_all_records_+3A_total_limit">total_limit</code></td>
<td>
<p>An integer specifying the maximum number of records to fetch. Defaults to <code>Inf</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble containing all fetched records.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  results &lt;- fetch_all_records(
    base_query = "*",
    base_filters = c('collection:"FEN"'),
    sort = "main_date_str asc",
    limit_per_query = 100000,
    total_limit = Inf
  )
  print(results)

## End(Not run)
</code></pre>

<hr>
<h2 id='fetch_finna'>Fetch Finna Collection Data with Flexible Query</h2><span id='topic+fetch_finna'></span>

<h3>Description</h3>

<p>This function retrieves data from the Finna API and formats it as a tidy tibble.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fetch_finna(
  query = NULL,
  limit = 0,
  facets = "building",
  lng = "fi",
  prettyPrint = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fetch_finna_+3A_query">query</code></td>
<td>
<p>The query string for filtering results. Defaults to NULL, which fetches data without a specific search term.</p>
</td></tr>
<tr><td><code id="fetch_finna_+3A_limit">limit</code></td>
<td>
<p>Maximum number of results to fetch. Defaults to 0.</p>
</td></tr>
<tr><td><code id="fetch_finna_+3A_facets">facets</code></td>
<td>
<p>Facet to retrieve, defaults to &quot;building&quot;.</p>
</td></tr>
<tr><td><code id="fetch_finna_+3A_lng">lng</code></td>
<td>
<p>Language for results, defaults to &quot;fi&quot;.</p>
</td></tr>
<tr><td><code id="fetch_finna_+3A_prettyprint">prettyPrint</code></td>
<td>
<p>Logical, whether to pretty-print JSON responses.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble containing the fetched data with relevant fields.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  fetch_finna(query = "record_format:ead", limit = 0)
  fetch_finna() # Fetches data with no specific query

## End(Not run)
</code></pre>

<hr>
<h2 id='fetch_viola_records'>Fetch Records by Year Ranges from Finna API (Including NA Dates)</h2><span id='topic+fetch_viola_records'></span>

<h3>Description</h3>

<p>This function fetches records from the Finna API in chunks divided by year ranges, handling missing date values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fetch_viola_records(
  base_query = "*",
  base_filters = c("collection:\"VIO\""),
  year_ranges = list(c(0, as.numeric(format(Sys.Date(), "%Y")))),
  include_na = TRUE,
  limit_per_query = 1e+05,
  total_limit = Inf,
  delay_after_query = 5
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fetch_viola_records_+3A_base_query">base_query</code></td>
<td>
<p>The base query string, defaults to &quot;*&quot;.</p>
</td></tr>
<tr><td><code id="fetch_viola_records_+3A_base_filters">base_filters</code></td>
<td>
<p>A character vector of filters for the search, e.g., <code>c('collection:"VIO"')</code>.</p>
</td></tr>
<tr><td><code id="fetch_viola_records_+3A_year_ranges">year_ranges</code></td>
<td>
<p>A list of numeric vectors specifying year ranges, e.g., <code>list(c(2000, 2005), c(2006, 2010))</code>.</p>
</td></tr>
<tr><td><code id="fetch_viola_records_+3A_include_na">include_na</code></td>
<td>
<p>Whether to include records with missing <code>main_date_str</code>. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="fetch_viola_records_+3A_limit_per_query">limit_per_query</code></td>
<td>
<p>Maximum number of records to fetch per query. Default is 100000.</p>
</td></tr>
<tr><td><code id="fetch_viola_records_+3A_total_limit">total_limit</code></td>
<td>
<p>Maximum number of records to fetch overall. Default is <code>Inf</code>.</p>
</td></tr>
<tr><td><code id="fetch_viola_records_+3A_delay_after_query">delay_after_query</code></td>
<td>
<p>Delay in seconds between queries. Default is 5.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble containing all fetched records.
</p>

<hr>
<h2 id='finna_as_json'>Convert Finna query object to JSON</h2><span id='topic+finna_as_json'></span><span id='topic+finna_as_json.finna_query'></span>

<h3>Description</h3>

<p>Convert Finna query object to JSON
</p>


<h3>Usage</h3>

<pre><code class='language-R'>finna_as_json(x)

## S3 method for class 'finna_query'
finna_as_json(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="finna_as_json_+3A_x">x</code></td>
<td>
<p>An object to convert (e.g., a Finna API query or response object).</p>
</td></tr>
</table>

<hr>
<h2 id='finna_cite'>Cite a Finna collection</h2><span id='topic+finna_cite'></span>

<h3>Description</h3>

<p>Automatically generates a citation for a Finna collection result.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>finna_cite(result, index, style = "citation")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="finna_cite_+3A_result">result</code></td>
<td>
<p>The Finna collection result as a tibble.</p>
</td></tr>
<tr><td><code id="finna_cite_+3A_index">index</code></td>
<td>
<p>The index of the collection to cite (numeric).</p>
</td></tr>
<tr><td><code id="finna_cite_+3A_style">style</code></td>
<td>
<p>The citation style to use (default: &quot;citation&quot;). See <code><a href="utils.html#topic+bibentry">bibentry</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A bibliographic entry (<code>bibentry</code>) printed in the specified style.
</p>

<hr>
<h2 id='finna_interactive'>Interactive Finna Search and Data Download</h2><span id='topic+finna_interactive'></span>

<h3>Description</h3>

<p>Provides an interactive interface to search, select, and download datasets from Finna API.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>finna_interactive()
</code></pre>


<h3>Value</h3>

<p>A dataframe containing the selected dataset or downloaded data.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+search_finna">search_finna()</a></code>, <code><a href="#topic+fetch_finna">fetch_finna()</a></code>, <code><a href="#topic+finna_cite">finna_cite()</a></code>
</p>

<hr>
<h2 id='get_finna_records'>Get Finna Records by IDs with Extended Options</h2><span id='topic+get_finna_records'></span>

<h3>Description</h3>

<p>This function retrieves multiple Finna records based on a vector of record IDs. You can specify
which fields to return, the language, and the pagination options.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_finna_records(
  ids,
  field = NULL,
  prettyPrint = FALSE,
  lng = "fi",
  page = 1,
  limit = 100
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_finna_records_+3A_ids">ids</code></td>
<td>
<p>A vector of record IDs to retrieve.</p>
</td></tr>
<tr><td><code id="get_finna_records_+3A_field">field</code></td>
<td>
<p>A vector of fields to return. Defaults to NULL, which returns all default fields.</p>
</td></tr>
<tr><td><code id="get_finna_records_+3A_prettyprint">prettyPrint</code></td>
<td>
<p>Logical; whether to pretty-print the response. Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="get_finna_records_+3A_lng">lng</code></td>
<td>
<p>Language for returned translated strings. Defaults to &quot;fi&quot;.</p>
</td></tr>
<tr><td><code id="get_finna_records_+3A_page">page</code></td>
<td>
<p>The page number to retrieve. Defaults to 1.</p>
</td></tr>
<tr><td><code id="get_finna_records_+3A_limit">limit</code></td>
<td>
<p>The number of records to return per page. Defaults to 20.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble containing the retrieved records data with provenance information.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>records &lt;- get_finna_records("fikka.3405646", field = "title", prettyPrint = TRUE, lng = "en-gb")
print(records)
</code></pre>

<hr>
<h2 id='harvest_oai_pmh'>Harvest Metadata from an OAI-PMH Server</h2><span id='topic+harvest_oai_pmh'></span>

<h3>Description</h3>

<p>This function harvests metadata records from an OAI-PMH-compliant server in batches,
using a custom User-Agent string to identify the service and returns them in a tibble format.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>harvest_oai_pmh(
  base_url,
  metadata_prefix,
  set = NULL,
  verbose = TRUE,
  user_agent = "FinnaHarvester/1.0",
  output_file = NULL,
  record_limit = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="harvest_oai_pmh_+3A_base_url">base_url</code></td>
<td>
<p>A string. The base URL of the OAI-PMH server.</p>
</td></tr>
<tr><td><code id="harvest_oai_pmh_+3A_metadata_prefix">metadata_prefix</code></td>
<td>
<p>A string. The metadata format to request (e.g., &quot;oai_dc&quot;, &quot;marc21&quot;).</p>
</td></tr>
<tr><td><code id="harvest_oai_pmh_+3A_set">set</code></td>
<td>
<p>A string. Optional. A set specifier to limit the harvested records (e.g., &quot;non_dedup&quot;).</p>
</td></tr>
<tr><td><code id="harvest_oai_pmh_+3A_verbose">verbose</code></td>
<td>
<p>A logical. Whether to display progress messages. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="harvest_oai_pmh_+3A_user_agent">user_agent</code></td>
<td>
<p>A string. A custom User-Agent string to identify the service. Default is &quot;FinnaHarvester/1.0&quot;.</p>
</td></tr>
<tr><td><code id="harvest_oai_pmh_+3A_output_file">output_file</code></td>
<td>
<p>output file to be saved as a csv file.</p>
</td></tr>
<tr><td><code id="harvest_oai_pmh_+3A_record_limit">record_limit</code></td>
<td>
<p>limits the number of records that the user wants to fetch</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble with the harvested records containing selected metadata fields.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

# Example for oai_dc (Dublin Core)
records_oai_dc &lt;- harvest_oai_pmh(
base_url = "https://api.finna.fi/OAI/Server",
metadata_prefix = "oai_dc",
user_agent = "MyCustomHarvester/1.0"
)
# Example for marc21 (MARC 21)
records_marc21 &lt;- harvest_oai_pmh(
base_url = "https://api.finna.fi/OAI/Server",
metadata_prefix = "marc21",
user_agent = "MyCustomHarvester/1.0"
)

# Example for oai_vufind_json (VuFind JSON)
records_oai_vufind_json &lt;- harvest_oai_pmh(
base_url = "https://api.finna.fi/OAI/Server",
metadata_prefix = "oai_vufind_json",
user_agent = "MyCustomHarvester/1.0"
)

# Example for oai_ead (Encoded Archival Description)
records_oai_ead &lt;- harvest_oai_pmh(
base_url = "https://api.finna.fi/OAI/Server",
metadata_prefix = "oai_ead",
user_agent = "MyCustomHarvester/1.0"
)
# Example for oai_ead3 (Encoded Archival Description version 3)
records_oai_ead3 &lt;- harvest_oai_pmh(
base_url = "https://api.finna.fi/OAI/Server",
metadata_prefix = "oai_ead3",
user_agent = "MyCustomHarvester/1.0"
)

# Example for oai_forward (Forward metadata format)
records_oai_forward &lt;- harvest_oai_pmh(
base_url = "https://api.finna.fi/OAI/Server",
metadata_prefix = "oai_forward",
user_agent = "MyCustomHarvester/1.0"
)

# Example for oai_lido (Lightweight Information Describing Objects)
records_oai_lido &lt;- harvest_oai_pmh(
base_url = "https://api.finna.fi/OAI/Server",
metadata_prefix = "oai_lido",
user_agent = "MyCustomHarvester/1.0"
)

# Example for oai_qdc (Qualified Dublin Core)
records_oai_qdc &lt;- harvest_oai_pmh(
base_url = "https://api.finna.fi/OAI/Server",
metadata_prefix = "oai_qdc",
user_agent = "MyCustomHarvester/1.0"
)

## End(Not run)
</code></pre>

<hr>
<h2 id='load_offline_data'>Load 'Finna' Search Results from Offline File</h2><span id='topic+load_offline_data'></span>

<h3>Description</h3>

<p>This function loads previously saved 'Finna' search results from a local <code>.rds</code> file for offline access.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>load_offline_data(file_name = "offline_search_results")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="load_offline_data_+3A_file_name">file_name</code></td>
<td>
<p>A string representing the name of the file to load.
The function automatically appends &quot;.rds&quot; if not already included.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble or data frame containing the loaded search results.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
search_results &lt;- search_finna("sibelius")
save_for_offline(search_results, "sibelius_search_results")
offline_data &lt;- load_offline_data("sibelius_search_results")
print(offline_data)

## End(Not run)
</code></pre>

<hr>
<h2 id='refine_metadata'>Refine Finna Metadata</h2><span id='topic+refine_metadata'></span>

<h3>Description</h3>

<p>The <code>refine_metadata</code> function cleans and standardizes Finna metadata by:
</p>

<ul>
<li> <p><strong>Validating Required Fields:</strong> Checks for the presence of key metadata fields and returns <code>NULL</code> if any are missing.
</p>
</li>
<li> <p><strong>Handling Missing Values:</strong> Replaces <code>NA</code> values in critical fields with descriptive placeholder text (e.g., &quot;Unknown Title&quot;).
</p>
</li>
<li> <p><strong>Selecting Relevant Fields:</strong> Keeps only the following fields for streamlined analysis:
</p>

<ul>
<li> <p><code>Title</code>: The title of the resource.
</p>
</li>
<li> <p><code>Author</code>: The creator or author of the resource.
</p>
</li>
<li> <p><code>Year</code>: The publication or release year.
</p>
</li>
<li> <p><code>Language</code>: The language of the resource.
</p>
</li>
<li> <p><code>Formats</code>: The format(s) of the resource (e.g., Book, Audio).
</p>
</li>
<li> <p><code>Subjects</code>: The subject keywords or classifications.
</p>
</li>
<li> <p><code>Library</code>: The owning library or institution.
</p>
</li>
<li> <p><code>Series</code>: The series or collection the resource belongs to.
</p>
</li></ul>

</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>refine_metadata(data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="refine_metadata_+3A_data">data</code></td>
<td>
<p>A tibble containing raw Finna metadata.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble with selected, cleaned metadata fields, or NULL if required fields are missing.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(finna)
sibelius_data &lt;- search_finna("sibelius")
refine_metadata(sibelius_data)

</code></pre>

<hr>
<h2 id='save_for_offline'>Save 'Finna' Search Results for Offline Access</h2><span id='topic+save_for_offline'></span>

<h3>Description</h3>

<p>This function saves 'Finna' search results and metadata locally to a file in <code>.rds</code> format,
allowing users to access and analyze the data offline without an internet connection.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>save_for_offline(data, file_name = "offline_search_results")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="save_for_offline_+3A_data">data</code></td>
<td>
<p>A tibble or data frame containing the 'Finna' search results.</p>
</td></tr>
<tr><td><code id="save_for_offline_+3A_file_name">file_name</code></td>
<td>
<p>A string representing the name of the file to save.
The function automatically appends &quot;.rds&quot; to the name if not already included.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value. Called for its side effects of saving the data to a file.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
search_results &lt;- search_finna("sibelius")
save_for_offline(search_results, "sibelius_search_results")

## End(Not run)
</code></pre>

<hr>
<h2 id='search_finna'>Finna Index Search with Total Limit Option</h2><span id='topic+search_finna'></span>

<h3>Description</h3>

<p>This function retrieves records from the Finna index with an option to limit the total number of records returned.
The function paginates through the results, fetching records until the specified total limit is reached.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>search_finna(
  query = NULL,
  type = "AllFields",
  fields = NULL,
  filters = NULL,
  facets = NULL,
  facetFilters = NULL,
  sort = "relevance,id asc",
  limit = 100,
  lng = "fi",
  prettyPrint = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="search_finna_+3A_query">query</code></td>
<td>
<p>description</p>
</td></tr>
<tr><td><code id="search_finna_+3A_type">type</code></td>
<td>
<p>A string specifying the type of search. Options include &quot;AllFields&quot;, &quot;Title&quot;, &quot;Author&quot;, &quot;Subject&quot;. Defaults to &quot;AllFields&quot;.</p>
</td></tr>
<tr><td><code id="search_finna_+3A_fields">fields</code></td>
<td>
<p>A vector of fields to be returned in the search results. Defaults to NULL, which returns a standard set of fields.</p>
</td></tr>
<tr><td><code id="search_finna_+3A_filters">filters</code></td>
<td>
<p>A vector of filter queries to refine the search. Defaults to NULL.</p>
</td></tr>
<tr><td><code id="search_finna_+3A_facets">facets</code></td>
<td>
<p>A vector specifying which facets to return in the results. Defaults to NULL.</p>
</td></tr>
<tr><td><code id="search_finna_+3A_facetfilters">facetFilters</code></td>
<td>
<p>A vector of regular expressions to filter facets. Defaults to NULL.</p>
</td></tr>
<tr><td><code id="search_finna_+3A_sort">sort</code></td>
<td>
<p>A string defining the sort order of the results. Options include:
</p>

<ul>
<li><p> &quot;relevance,id asc&quot; (default)
</p>
</li>
<li><p> &quot;main_date_str desc&quot; (Year, newest first)
</p>
</li>
<li><p> &quot;main_date_str asc&quot; (Year, oldest first)
</p>
</li>
<li><p> &quot;last_indexed desc&quot; (Last modified)
</p>
</li>
<li><p> &quot;first_indexed desc&quot; (Last added)
</p>
</li>
<li><p> &quot;callnumber,id asc&quot; (Classmark)
</p>
</li>
<li><p> &quot;author,id asc&quot; (Author)
</p>
</li>
<li><p> &quot;title,id asc&quot; (Title)
</p>
</li></ul>
</td></tr>
<tr><td><code id="search_finna_+3A_limit">limit</code></td>
<td>
<p>An integer specifying the total number of records to return across multiple pages.</p>
</td></tr>
<tr><td><code id="search_finna_+3A_lng">lng</code></td>
<td>
<p>A string for the language of returned translated strings. Options are &quot;fi&quot; - Finnish, &quot;en-gb&quot; - English, &quot;sv&quot; - Swedish, &quot;se&quot; - Sami. Defaults to &quot;fi&quot; - Finnish.</p>
</td></tr>
<tr><td><code id="search_finna_+3A_prettyprint">prettyPrint</code></td>
<td>
<p>A logical value indicating whether to pretty-print the JSON response. Useful for debugging. Defaults to FALSE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble containing the search results with relevant fields extracted and provenance information.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>search_results &lt;- search_finna("sibelius", sort = "main_date_str desc", limit = 100)
print(search_results)
</code></pre>

<hr>
<h2 id='search_publisher'>Finna Publisher Search</h2><span id='topic+search_publisher'></span>

<h3>Description</h3>

<p>This function retrieves only the publisher information from the Finna index based on the search query.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>search_publisher(
  query = NULL,
  limit = 100,
  lng = "fi",
  filters = NULL,
  prettyPrint = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="search_publisher_+3A_query">query</code></td>
<td>
<p>A string specifying the search query.</p>
</td></tr>
<tr><td><code id="search_publisher_+3A_limit">limit</code></td>
<td>
<p>An integer specifying the total number of records to return.</p>
</td></tr>
<tr><td><code id="search_publisher_+3A_lng">lng</code></td>
<td>
<p>A string for the language of returned translated strings. Defaults to &quot;fi&quot;.</p>
</td></tr>
<tr><td><code id="search_publisher_+3A_filters">filters</code></td>
<td>
<p>A vector of filter queries to refine the search. Defaults to NULL.</p>
</td></tr>
<tr><td><code id="search_publisher_+3A_prettyprint">prettyPrint</code></td>
<td>
<p>A logical value indicating whether to pretty-print the JSON response. Defaults to FALSE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble containing the record IDs and their respective publishers.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>publishers &lt;- search_publisher("sibelius", limit = 10)
print(publishers)
</code></pre>

<hr>
<h2 id='top_plot'>Plot Top Entries</h2><span id='topic+top_plot'></span>

<h3>Description</h3>

<p>Visualizes the top entries for a given field in a data frame.
Count and percentage statistics is also shown as needed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>top_plot(
  x,
  field = NULL,
  ntop = NULL,
  highlight = NULL,
  max.char = Inf,
  show.rest = FALSE,
  show.percentage = FALSE,
  log10 = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="top_plot_+3A_x">x</code></td>
<td>
<p>Data frame, vector or factor</p>
</td></tr>
<tr><td><code id="top_plot_+3A_field">field</code></td>
<td>
<p>Field to show</p>
</td></tr>
<tr><td><code id="top_plot_+3A_ntop">ntop</code></td>
<td>
<p>Number of top entries to show</p>
</td></tr>
<tr><td><code id="top_plot_+3A_highlight">highlight</code></td>
<td>
<p>Entries from the 'field' to be highlighted</p>
</td></tr>
<tr><td><code id="top_plot_+3A_max.char">max.char</code></td>
<td>
<p>Max number of characters in strings. Longer strings will be cut and only max.char first characters are shown. No cutting by default</p>
</td></tr>
<tr><td><code id="top_plot_+3A_show.rest">show.rest</code></td>
<td>
<p>Show the count of leave-out samples (not in top-N) as an additional bar.</p>
</td></tr>
<tr><td><code id="top_plot_+3A_show.percentage">show.percentage</code></td>
<td>
<p>Show the proportion of each category with respect to the total sample count.</p>
</td></tr>
<tr><td><code id="top_plot_+3A_log10">log10</code></td>
<td>
<p>Show the counts on log10 scale (default FALSE)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ggplot object
</p>


<h3>Author(s)</h3>

<p>Leo Lahti <a href="mailto:leo.lahti@iki.fi">leo.lahti@iki.fi</a>
</p>


<h3>References</h3>

<p>See citation(&quot;bibliographica&quot;)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: p &lt;- top_plot(x, field, 50)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
