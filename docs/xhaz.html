<!DOCTYPE html><html lang="en-US"><head><title>Help for package xhaz</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {xhaz}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#xhaz-package'><p>Excess Hazard Modelling Considering Inappropriate Mortality Rates</p></a></li>
<li><a href='#AIC.bsplines'><p>Akaike's Information Criterion for excess hazard model with</p>
baseline hazard following a B-splines functions</a></li>
<li><a href='#AIC.constant'><p>Akaike's Information Criterion for excess hazard model with</p>
baseline hazard following a piecewise constant function</a></li>
<li><a href='#AIC.mexhazLT'><p>Akaike's Information Criterion for excess hazard model from mexhazLT function</p></a></li>
<li><a href='#anova.bsplines'><p>anova.bsplines function used for likelihood-ratio Test of two models</p>
from xhaz function</a></li>
<li><a href='#anova.constant'><p>anova.constant function used for likelihood-ratio Test of two models</p>
from xhaz function</a></li>
<li><a href='#anova.mexhazLT'><p>anova.mexhazLT function used for likelihood-ratio Test of two models</p>
from mexhaz function</a></li>
<li><a href='#BIC.bsplines'><p>Bayesian Information Criterion for excess hazard model with</p>
baseline hazard following a B-splines functions</a></li>
<li><a href='#BIC.constant'><p>Bayesian Information Criterion for excess hazard model with</p>
baseline hazard following a piecewise constant function</a></li>
<li><a href='#BIC.mexhazLT'><p>Bayesian Information Criterion for excess hazard model from mexhazLT function</p></a></li>
<li><a href='#breast'><p>Simulated clinical trial data with non comparability bias in term of individuals expected hazard</p></a></li>
<li><a href='#ccr.mevents'><p>colorectum cancer data with multiple events</p></a></li>
<li><a href='#dataCancer'><p>Simulated data with cause death information with non comparability bias in term of individuals expected hazard</p></a></li>
<li><a href='#duplicate'><p>duplicate function</p></a></li>
<li><a href='#exphaz'><p>exphaz function</p></a></li>
<li><a href='#mexhazLT'><p>mexhazLT function</p></a></li>
<li><a href='#plot.bsplines'><p>plot.bsplines</p></a></li>
<li><a href='#plot.predxhaz'><p>plots of excess hazard and net Survival from an</p>
<code>predxhaz</code> object</a></li>
<li><a href='#predict.bsplines'><p>Predictions of excess hazard and net Survival from a <code>bsplines</code></p>
object</a></li>
<li><a href='#predict.constant'><p>Predictions of excess hazard and net Survival from an <code>constant</code></p>
object</a></li>
<li><a href='#print.bsplines'><p>A print.bsplines Function used to print a object of class <code>bsplines</code></p></a></li>
<li><a href='#print.constant'><p>A print.constant Function used to print a object of class constant</p></a></li>
<li><a href='#print.predxhaz'><p>A print.predxhaz Function used to print a object of class predxhaz</p></a></li>
<li><a href='#qbs'><p>qbs function</p></a></li>
<li><a href='#rescaledData'><p>Simulated data with cause death information with non comparability bias in term of individuals expected hazard</p></a></li>
<li><a href='#simuData'><p>Simulated data with cause death information in long term follow-up setting without non comparability bias in term of individuals expected hazard</p></a></li>
<li><a href='#summary.bsplines'><p>A summary.bsplines Function used to print a object of class <code>bsplines</code></p></a></li>
<li><a href='#summary.constant'><p>A summary.constant Function used to print a object of class <code>xhaz.constant</code></p></a></li>
<li><a href='#xhaz'><p>xhaz function</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Excess Hazard Modelling Considering Inappropriate Mortality
Rates</td>
</tr>
<tr>
<td>Version:</td>
<td>2.0.2</td>
</tr>
<tr>
<td>Author:</td>
<td>Juste Goungounga [aut, cre] (&lt;https://orcid.org/0000-0002-9039-2639&gt;),
        Hadrien Charvat [aut] (&lt;https://orcid.org/0000-0003-3624-1394&gt;),
        Darlin Mba [aut] (&lt;https://orcid.org/0000-0001-9768-0230&gt;),
        Nathalie Graffeo [aut] (&lt;https://orcid.org/0000-0001-7227-7525&gt;),
        Roch Giorgi [aut] (&lt;https://orcid.org/0000-0001-6135-3078&gt;)</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Juste Goungounga &lt;juste.goungounga@ehesp.fr&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Fits relative survival regression models with or without proportional excess hazards and with the additional possibility to correct for background mortality by one or more parameter(s). These models are relevant when the observed mortality in the studied group is not comparable to that of the general population or in population-based studies where the available life tables used for net survival estimation are insufficiently stratified. In the latter case, the proposed model by Touraine et al. (2020) &lt;<a href="https://doi.org/10.1177%2F0962280218823234">doi:10.1177/0962280218823234</a>&gt; can be used. The user can also fit a model that relaxes the proportional expected hazards assumption considered in the Touraine et al. excess hazard model. This extension was proposed by Mba et al. (2020) &lt;<a href="https://doi.org/10.1186%2Fs12874-020-01139-z">doi:10.1186/s12874-020-01139-z</a>&gt; to allow non-proportional effects of the additional variable on the general population mortality. In non-population-based studies, researchers can identify non-comparability source of bias in terms of expected mortality of selected individuals. An excess hazard model correcting this selection bias is presented in Goungounga et al. (2019) &lt;<a href="https://doi.org/10.1186%2Fs12874-019-0747-3">doi:10.1186/s12874-019-0747-3</a>&gt;. This class of model with a random effect at the cluster level on excess hazard is presented in Goungounga et al. (2023) &lt;<a href="https://doi.org/10.1002%2Fbimj.202100210">doi:10.1002/bimj.202100210</a>&gt;.   </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/AGPL-3">AGPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.3.0), statmod (&ge; 1.5.0), stats, survival (&ge; 3.5.7)</td>
</tr>
<tr>
<td>Imports:</td>
<td>gtools, mexhaz (&ge; 2.6), numDeriv, optimParallel, splines,
stringr, survexp.fr</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, spelling, testthat (&ge; 2.1.0)</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-06-29 10:13:16 UTC; jgoungounga</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-06-29 22:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='xhaz-package'>Excess Hazard Modelling Considering Inappropriate Mortality Rates</h2><span id='topic+xhaz-package'></span>

<h3>Description</h3>

<p>Contains functions to fit excess hazard models, with or without
proportional population hazards assumption. The baseline excess hazard could be a
piecewise constant function or a B-splines. When B-splines is choosen for
the baseline excess hazard, the user can specify some covariates which have
a time-dependent effect (using &quot;bsplines&quot;) on the baseline excess hazard.
The user can also specify if the framework corresponds to the classical
excess hazard modeling, i.e. assuming that the expected mortality of studied
individuals is appropriate. He can also consider two other frameworks: first,
the expected mortality available in the life table is not accurate and
requires taking into account an additional variable in the life table by allowing the
latter acts on the general population morality with a proportional effect.
This approach is presented by Touraine et al. (2020) <a href="doi:10.1177/0962280218823234">doi:10.1177/0962280218823234</a>.
The user can also fit a model that relax the proportional expected hazards assumption
considered in the latter excess hazard model. This extension was proposed by
Mba et al. (2020) <a href="doi:10.1186/s12874-020-01139-z">doi:10.1186/s12874-020-01139-z</a> allows non-proportional
effect of the additional variable on the general population mortality;
second, there is a non-comparability source of bias in terms of expected mortality
of selected individuals in a non-population-based studies such as clinical trials.
The related excess hazard model correcting this source of bias is presented in
Goungounga et al. (2019) <a href="doi:10.1186/s12874-019-0747-3">doi:10.1186/s12874-019-0747-3</a>. The optimization process
in these presented models uses the maximum likelihood method through the routine
<code>optim</code> or an internal function of the <code>xhaz-package</code>.
Finally, it is now possible to fit a rescaled excess hazard regression model using
various flexible parametrisations proposed by the mexhaz R package.
Moreover, the package enables the implementation of a rescaled random effects
excess hazard regression model, which allows for the examination of heterogeneity
between clusters (i.e., random effects at the cluster level) impacts on excess hazard,
as well as the investigation of potentially inappropriate mortality rates. In other words,
the latter concerns situations where the assumption of comparability between other-cause
mortality rates in the cohort under study and observed mortality rates in the general
population may be invalid, which could introduce bias into the estimation of excess
hazard model parameters (Goungounga et al. (2023) <a href="doi:10.1002/bimj.202100210">doi:10.1002/bimj.202100210</a>).
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> xhaz</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 2.0.2</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2024-04-25</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL-3</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>References</h3>

<p>Goungounga JA, Touraine C, Graff\'eo N, Giorgi R;
CENSUR working survival group. Correcting for misclassification
and selection effects in estimating net survival in clinical trials.
BMC Med Res Methodol. 2019 May 16;19(1):104.
doi: 10.1186/s12874-019-0747-3. PMID: 31096911; PMCID: PMC6524224.
(<a href="https://pubmed.ncbi.nlm.nih.gov/31096911/">PubMed</a>)
</p>
<p>Touraine C, Graff\'eo N, Giorgi R; CENSUR working survival group.
More accurate cancer-related excess mortality through correcting
background mortality for extra variables.
Stat Methods Med Res. 2020 Jan;29(1):122-136.
doi: 10.1177/0962280218823234. Epub 2019 Jan 23. PMID: 30674229.
(<a href="https://pubmed.ncbi.nlm.nih.gov/30674229/">PubMed</a>)
</p>
<p>Mba RD, Goungounga JA, Graff\'eo N, Giorgi R; CENSUR working survival group.
Correcting inaccurate background mortality in excess hazard models
through breakpoints. BMC Med Res Methodol. 2020 Oct 29;20(1):268.
doi: 10.1186/s12874-020-01139-z. PMID: 33121436; PMCID: PMC7596976.
(<a href="https://pubmed.ncbi.nlm.nih.gov/33121436/">PubMed</a>)
</p>
<p>Goungounga, JA, Graff\'eo N, Charvat H, Giorgi R. “Correcting for
heterogeneity and non-comparability bias in multicenter clinical trials
with a rescaled random-effect excess hazard model.” Biometrical journal.
Biometrische Zeitschrift vol. 65,4 (2023): e2100210.
doi:10.1002/bimj.202100210.PMID: 36890623;
(<a href="https://pubmed.ncbi.nlm.nih.gov/36890623/">PubMed</a>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

library("numDeriv")
library("survexp.fr")
library("splines")
data("simuData", "dataCancer", package = "xhaz")
# load the data sets 'simuData' and 'dataCancer'.


# Esteve et al. model: baseline excess hazard is a piecewise function
#                      linear and proportional effects for the covariates on
#                      baseline excess hazard.


fit.estv1 &lt;- xhaz(formula = Surv(time_year, status) ~ agec + race,
                  data = simuData,
                  ratetable = survexp.us,
                  interval = c(0, NA, NA, NA, NA, NA, max(simuData$time_year)),
                  rmap = list(age = 'age', sex = 'sex', year = 'date'),
                  baseline = "constant",
                  pophaz = "classic")


fit.estv1


# Touraine et al. model: baseline excess hazard is a piecewise function
#                        with a linear and proportional effects for the
#                        covariates on the baseline excess hazard.
# An additionnal cavariate (here race) missing in the life table is
# considered by the model.


fit.corrected1 &lt;- xhaz(formula = Surv(time_year, status) ~ agec + race,
                       data = simuData,
                       ratetable = survexp.us,
                       interval = c(0, NA, NA, NA, NA, NA,
                                    max(simuData$time_year)),
                       rmap = list(age = 'age', sex = 'sex', year = 'date'),
                       baseline = "constant", pophaz = "corrected",
                       add.rmap = "race")



fit.corrected1



 # An additionnal cavariate (here race) missing in the life table is
 # considered by the model with a breakpoint at 75 years

 fit.corrected2 &lt;- xhaz(formula = Surv(time_year, status) ~ agec + race,
                        data = simuData, ratetable = survexp.us,
                        interval = c(0, NA, NA, NA, NA, 6),
                        rmap = list(age = 'age', sex = 'sex', year = 'date'),
                        baseline = "constant", pophaz = "corrected",
                        add.rmap = "race",
                        add.rmap.cut = list(breakpoint = TRUE, cut = 75))


 fit.corrected2

data("breast")
#load the data sets 'breast'.

 # Flexible mexhaz model: baseline excess hazard with cubic B-splines
 # assumption on the life table available :
 # other cause mortality in the cohort is comparable to the mortality
 # observed in the general population with the same characteristics.

# The life table to be used is survexp.us. Note that SEX is coded 2 instead of female in survexp.us.
breast$sexe &lt;- "female"

fit.haz &lt;- exphaz(
                  formula = Surv(temps, statut) ~ 1,
                  data = breast, ratetable = survexp.us,
                  only_ehazard = FALSE,
                  rmap = list(age = 'age', sex = 'sexe', year = 'date'))

breast$expected &lt;- fit.haz$ehazard
breast$expectedCum &lt;- fit.haz$ehazardInt

mod.bs &lt;- mexhazLT(formula = Surv(temps, statut) ~ agecr + armt,
                  data = breast,
                  ratetable = survexp.us, degree = 3,
                  knots=quantile(breast[breast$statut==1,]$temps, probs=c(1:2/3)),
                  expected = "expected",expectedCum = "expectedCum",
                  base = "exp.bs", pophaz = "classic")

mod.bs


 # Flexible mexhaz model: baseline excess hazard with cubic B-splines
 # assumption on the life table available :
 # other cause mortality in the cohort is different to the mortality
 # observed in the general population with the same characteristics.

mod.bs2 &lt;- mexhazLT(formula = Surv(temps, statut) ~ agecr + armt,
                  data = breast, degree = 3,
                  knots=quantile(breast[breast$statut==1,]$temps, probs=c(1:2/3)),
                  expected = "expected",expectedCum = "expectedCum",
                  base = "exp.bs", pophaz = "rescaled")

mod.bs2


 # Flexible mexhaz model with a random effects at cluster level:
 # baseline excess hazard with cubic B-splines
 # assumption on the life table used :
 # other cause mortality in the cohort is different to the mortality
 # observed in the general population with the same characteristics.

mod.bs3 &lt;- mexhazLT(formula = Surv(temps, statut) ~ agecr + armt,
                  data = breast, degree = 3,
                  knots=quantile(breast[breast$statut==1,]$temps, probs=c(1:2/3)),
                  expected = "expected",expectedCum = "expectedCum",
                  base = "exp.bs", pophaz = "rescaled", random = "hosp")

mod.bs3





</code></pre>

<hr>
<h2 id='AIC.bsplines'>Akaike's Information Criterion for excess hazard model with
baseline hazard following a B-splines functions</h2><span id='topic+AIC.bsplines'></span>

<h3>Description</h3>

<p>Calculates the Akaike's 'An Information Criterion' for fitted
models from <code>xhaz</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bsplines'
AIC(object, ..., k = 2)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="AIC.bsplines_+3A_object">object</code></td>
<td>
<p>a fitted model object obtained from <code>xhaz</code> function</p>
</td></tr>
<tr><td><code id="AIC.bsplines_+3A_...">...</code></td>
<td>
<p>optionally more fitted model objects obtained from <code>xhaz</code> function</p>
</td></tr>
<tr><td><code id="AIC.bsplines_+3A_k">k</code></td>
<td>
<p>numeric, the penalty per parameter to be used; the default <code>k = 2</code>
is the classical AIC.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the value corresponds to the AIC calculated from the total
log-likelihood of the fitted model if just one object is provided.
If multiple objects are provided, a data.frame with columns corresponding to the
objects and rows representing the number of parameters in the model (df) and the AIC
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library("xhaz")

#Giorgi et al model: baseline excess hazard is a quadratic Bsplines
#                    function with two interior knots and allow here a
#                    linear and proportional effects for the covariates on
#                    baseline excess hazard.
levels(simuData$sex) &lt;- c("male", "female")

fitphBS &lt;- xhaz(formula = Surv(time_year, status) ~ agec + race,
                data = simuData,
                ratetable = survexp.us,
                interval = c(0, NA, NA, 6),
                rmap = list(age = 'age', sex = 'sex', year = 'date'),
                baseline = "bsplines", pophaz = "classic")

fitphBS
AIC(fitphBS)


</code></pre>

<hr>
<h2 id='AIC.constant'>Akaike's Information Criterion for excess hazard model with
baseline hazard following a piecewise constant function</h2><span id='topic+AIC.constant'></span>

<h3>Description</h3>

<p>Calculates the Akaike's 'An Information Criterion' for fitted
models from <code>xhaz</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'constant'
AIC(object, ..., k = 2)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="AIC.constant_+3A_object">object</code></td>
<td>
<p>a fitted model object obtained from <code>xhaz</code> function</p>
</td></tr>
<tr><td><code id="AIC.constant_+3A_...">...</code></td>
<td>
<p>optionally more fitted model objects obtained from <code>xhaz</code> function</p>
</td></tr>
<tr><td><code id="AIC.constant_+3A_k">k</code></td>
<td>
<p>numeric, the penalty per parameter to be used; the default <code>k = 2</code>
is the classical AIC.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the value corresponds to the AIC calculated from the total
log-likelihood of the fitted model if just one object is provided.
If multiple objects are provided, a data.frame with columns corresponding to the
objects and rows representing the number of parameters in the model (df) and the AIC
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("xhaz")

# Esteve et al. model: baseline excess hazard is a piecewise function
#                      linear and proportional effects for the covariates on
#                      baseline excess hazard.


set.seed(1980)
simuData2 &lt;- simuData[sample(nrow(simuData), size = 500), ]

fit.estv2 &lt;- xhaz(formula = Surv(time_year, status) ~ agec + race,
                  data = simuData2,
                  ratetable = survexp.us,
                  interval = c(0, NA, NA, NA, NA, NA, 6),
                  rmap = list(age = 'age', sex = 'sex', year = 'date'),
                  baseline = "constant", pophaz = "classic")


fit.estv2

AIC(fit.estv2)


</code></pre>

<hr>
<h2 id='AIC.mexhazLT'>Akaike's Information Criterion for excess hazard model from mexhazLT function</h2><span id='topic+AIC.mexhazLT'></span>

<h3>Description</h3>

<p>Calculates the Akaike's Information Criterion' for fitted models from <code>mexhazLT</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mexhazLT'
AIC(object, ..., k = 2)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="AIC.mexhazLT_+3A_object">object</code></td>
<td>
<p>a fitted model object obtained from <code>mexhazLT</code> function</p>
</td></tr>
<tr><td><code id="AIC.mexhazLT_+3A_...">...</code></td>
<td>
<p>optionally more fitted model objects obtained from <code>mexhazLT</code> function</p>
</td></tr>
<tr><td><code id="AIC.mexhazLT_+3A_k">k</code></td>
<td>
<p>numeric, the penalty per parameter to be used; the default <code>k = 2</code>
is the classical AIC.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the value corresponds to the AIC calculated from the total
log-likelihood of the fitted model if just one object is provided.
If multiple objects are provided, a data.frame with columns corresponding to the
objects and rows representing the number of parameters in the model (df) and the AIC
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library("xhaz")

data("breast")
# load the data sets 'breast'.

 # Flexible mexhaz model: baseline excess hazard with cubic B-splines
 # assumption on the life table available :
 # other cause mortality in the cohort is comparable to the mortality
 # observed in the general population with the same characteristics.

# The life table to be used is survexp.us. Note that SEX is coded 2 instead of female in survexp.us.
breast$sexe &lt;- "female"

fit.haz &lt;- exphaz(
                  formula = Surv(temps, statut) ~ 1,
                  data = breast, ratetable = survexp.us,
                  only_ehazard = FALSE,
                  rmap = list(age = 'age', sex = 'sexe', year = 'date'))

breast$expected &lt;- fit.haz$ehazard
breast$expectedCum &lt;- fit.haz$ehazardInt

mod.bs &lt;- mexhazLT(formula = Surv(temps, statut) ~ agecr + armt,
                  data = breast,
                  ratetable = survexp.us, degree = 3,
                  knots=quantile(breast[breast$statut==1,]$temps, probs=c(1:2/3)),
                  expected = "expected",expectedCum = "expectedCum",
                  base = "exp.bs", pophaz = "classic")

mod.bs

AIC(mod.bs)

</code></pre>

<hr>
<h2 id='anova.bsplines'>anova.bsplines function used for likelihood-ratio Test of two models
from xhaz function</h2><span id='topic+anova.bsplines'></span>

<h3>Description</h3>

<p>This function compute an analysis of deviance table for two
excess hazard models fitted using xhaz R package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bsplines'
anova(object, ..., test = "LRT")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="anova.bsplines_+3A_object">object</code></td>
<td>
<p>an object of class bsplines</p>
</td></tr>
<tr><td><code id="anova.bsplines_+3A_...">...</code></td>
<td>
<p>an object of class bsplines</p>
</td></tr>
<tr><td><code id="anova.bsplines_+3A_test">test</code></td>
<td>
<p>a character string. The appropriate test is a likelihood-ratio
test, all other choices result in Not yet implemented test.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>anova</code> inheriting from class <code>matrix</code>.
The different columns contain respectively the degrees of freedom and the
log-likelihood values of the two nested models, the degree of freedom of the
chi-square statistic, the chi-square statistic and the p-value of the
likelihood ratio test.
</p>


<h3>Note</h3>

<p>As expected, the comparison between two or more models by anova or more
excess hazard models will only be valid if they are fitted to the same
dataset, and if the compared models are nested. This may be a problem if
there are missing values.
</p>


<h3>Author(s)</h3>

<p>Juste Goungounga, Robert Darlin Mba, Nathalie Graff\'eo and
Roch Giorgi
</p>


<h3>References</h3>

<p>Goungounga JA, Touraine C, Graff\'eo N, Giorgi R;
CENSUR working survival group. Correcting for misclassification
and selection effects in estimating net survival in clinical trials.
BMC Med Res Methodol. 2019 May 16;19(1):104.
doi: 10.1186/s12874-019-0747-3. PMID: 31096911; PMCID: PMC6524224.
(<a href="https://pubmed.ncbi.nlm.nih.gov/31096911/">PubMed</a>)
</p>
<p>Touraine C, Graff\'eo N, Giorgi R; CENSUR working survival group.
More accurate cancer-related excess mortality through correcting
background mortality for extra variables.
Stat Methods Med Res. 2020 Jan;29(1):122-136.
doi: 10.1177/0962280218823234. Epub 2019 Jan 23. PMID: 30674229.
(<a href="https://pubmed.ncbi.nlm.nih.gov/30674229/">PubMed</a>)
</p>
<p>Mba RD, Goungounga JA, Graff\'eo N, Giorgi R; CENSUR working survival group.
Correcting inaccurate background mortality in excess hazard models
through breakpoints. BMC Med Res Methodol. 2020 Oct 29;20(1):268.
doi: 10.1186/s12874-020-01139-z. PMID: 33121436; PMCID: PMC7596976.
(<a href="https://pubmed.ncbi.nlm.nih.gov/33121436/">PubMed</a>)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+xhaz">xhaz</a></code>, <code><a href="#topic+summary.bsplines">summary.bsplines</a></code>, <code><a href="#topic+print.constant">print.constant</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# load the data set in the package

library("survival")
library("numDeriv")
library("survexp.fr")
library("statmod")

data("dataCancer", package = "xhaz")   # load the data set in the package

fit.phBS &lt;- xhaz(
      formula = Surv(obs_time_year, event) ~ ageCentre + immuno_trt,
      data = dataCancer,
      ratetable = survexp.fr::survexp.fr,
      interval = c(0, NA, NA, max(dataCancer$obs_time_year)),
      rmap = list(age = 'age', sex = 'sexx', year = 'year_date'),
      baseline = "bsplines", pophaz  = "classic")



fit.nphBS &lt;- xhaz(
      formula = Surv(obs_time_year, event) ~ ageCentre + qbs(immuno_trt),
      data = dataCancer,
      ratetable = survexp.fr::survexp.fr,
      interval = c(0, NA, NA, max(dataCancer$obs_time_year)),
      rmap = list(age = 'age', sex = 'sexx', year = 'year_date'),
      baseline = "bsplines", pophaz  = "classic")

anova(fit.phBS, fit.nphBS)


</code></pre>

<hr>
<h2 id='anova.constant'>anova.constant function used for likelihood-ratio Test of two models
from xhaz function</h2><span id='topic+anova.constant'></span>

<h3>Description</h3>

<p>This function compute an analysis of deviance table for two
excess hazard models fitted using xhaz R package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'constant'
anova(object, ..., test = "LRT")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="anova.constant_+3A_object">object</code></td>
<td>
<p>an object of class constant</p>
</td></tr>
<tr><td><code id="anova.constant_+3A_...">...</code></td>
<td>
<p>an object of class constant</p>
</td></tr>
<tr><td><code id="anova.constant_+3A_test">test</code></td>
<td>
<p>a character string. The appropriate test is a likelihood-ratio
test, all other choices result in Not yet implemented test.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>anova</code> inheriting from class <code>matrix</code>.
The different columns contain respectively the degrees of freedom and the
log-likelihood values of the two nested models, the degree of freedom of the
chi-square statistic, the chi-square statistic and the p-value of the
likelihood ratio test.
</p>


<h3>Note</h3>

<p>As expected, the comparison between two or more models by anova or more
excess hazard models will only be valid if they are fitted to the same
dataset, and if the compared models are nested. This may be a problem if
there are missing values.
</p>


<h3>Author(s)</h3>

<p>Juste Goungounga, Robert Darlin Mba, Nathalie Graff\'eo and Roch Giorgi
</p>


<h3>References</h3>

<p>Goungounga JA, Touraine C, Graff\'eo N, Giorgi R;
CENSUR working survival group. Correcting for misclassification
and selection effects in estimating net survival in clinical trials.
BMC Med Res Methodol. 2019 May 16;19(1):104.
doi: 10.1186/s12874-019-0747-3. PMID: 31096911; PMCID: PMC6524224.
(<a href="https://pubmed.ncbi.nlm.nih.gov/31096911/">PubMed</a>)
</p>
<p>Touraine C, Graff\'eo N, Giorgi R; CENSUR working survival group.
More accurate cancer-related excess mortality through correcting
background mortality for extra variables.
Stat Methods Med Res. 2020 Jan;29(1):122-136.
doi: 10.1177/0962280218823234. Epub 2019 Jan 23. PMID: 30674229.
(<a href="https://pubmed.ncbi.nlm.nih.gov/30674229/">PubMed</a>)
</p>
<p>Mba RD, Goungounga JA, Graff\'eo N, Giorgi R; CENSUR working survival group.
Correcting inaccurate background mortality in excess hazard models
through breakpoints. BMC Med Res Methodol. 2020 Oct 29;20(1):268.
doi: 10.1186/s12874-020-01139-z. PMID: 33121436; PMCID: PMC7596976.
(<a href="https://pubmed.ncbi.nlm.nih.gov/33121436/">PubMed</a>)
</p>
<p>Giorgi R, Abrahamowicz M, Quantin C, Bolard P, Esteve J, Gouvernet J,
Faivre J. A relative survival regression model using B-spline functions
to model non-proportional hazards.
Statistics in Medicine 2003; 22: 2767-84.
(<a href="https://pubmed.ncbi.nlm.nih.gov/12939785/">PubMed</a>)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+xhaz">xhaz</a></code>, <code><a href="#topic+summary.bsplines">summary.bsplines</a></code>, <code><a href="#topic+print.constant">print.constant</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# load the data set in the package
library("survival")
library("numDeriv")
library("survexp.fr")


data("dataCancer")   # load the data set in the package

fit.ph &lt;- xhaz(
      formula = Surv(obs_time_year, event) ~ ageCentre + immuno_trt,
      data = dataCancer,
      ratetable = survexp.fr::survexp.fr,
      interval = c(0, NA, NA, NA, max(dataCancer$obs_time_year)),
      rmap = list(age = 'age', sex = 'sexx', year = 'year_date'),
      baseline = "constant", pophaz  = "classic")



fit.ph2 &lt;- xhaz(
      formula = Surv(obs_time_year, event) ~ ageCentre ,
      data = dataCancer,
      ratetable = survexp.fr::survexp.fr,
      interval = c(0, NA, NA, NA, max(dataCancer$obs_time_year)),
      rmap = list(age = 'age', sex = 'sexx', year = 'year_date'),
      baseline = "constant", pophaz  = "classic")

  anova(fit.ph2, fit.ph)


</code></pre>

<hr>
<h2 id='anova.mexhazLT'>anova.mexhazLT function used for likelihood-ratio Test of two models
from mexhaz function</h2><span id='topic+anova.mexhazLT'></span>

<h3>Description</h3>

<p>This function compute an analysis of deviance table for two
excess hazard models fitted using xhaz R package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mexhazLT'
anova(object, ..., test = "LRT")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="anova.mexhazLT_+3A_object">object</code></td>
<td>
<p>an object of class mexhazLT</p>
</td></tr>
<tr><td><code id="anova.mexhazLT_+3A_...">...</code></td>
<td>
<p>an object of class mexhazLT</p>
</td></tr>
<tr><td><code id="anova.mexhazLT_+3A_test">test</code></td>
<td>
<p>a character string. The appropriate test is a likelihood-ratio
test, all other choices result in Not yet implemented test.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>anova</code> inheriting from class <code>matrix</code>.
The different columns contain respectively the degrees of freedom and the
log-likelihood values of the two nested models, the degree of freedom of the
chi-square statistic, the chi-square statistic and the p-value of the
likelihood ratio test.
</p>


<h3>Note</h3>

<p>As expected, the comparison between two or more models by anova or more
excess hazard models will only be valid if they are fitted to the same
dataset, and if the compared models are nested. This may be a problem if
there are missing values.
</p>


<h3>Author(s)</h3>

<p>Juste Goungounga, Hadrien Charvat, Robert Darlin Mba, Nathalie Graff\'eo and Roch Giorgi
</p>


<h3>References</h3>

<p>Goungounga JA, Touraine C, Graff\'eo N, Giorgi R;
CENSUR working survival group. Correcting for misclassification
and selection effects in estimating net survival in clinical trials.
BMC Med Res Methodol. 2019 May 16;19(1):104.
doi: 10.1186/s12874-019-0747-3. PMID: 31096911; PMCID: PMC6524224.
(<a href="https://pubmed.ncbi.nlm.nih.gov/31096911/">PubMed</a>)
</p>
<p>Goungounga, JA, Graff\'eo N, Charvat H, Giorgi R. “Correcting for
heterogeneity and non-comparability bias in multicenter clinical trials
with a rescaled random-effect excess hazard model.” Biometrical journal.
Biometrische Zeitschrift vol. 65,4 (2023): e2100210.
doi:10.1002/bimj.202100210.PMID: 36890623;
(<a href="https://pubmed.ncbi.nlm.nih.gov/36890623/">PubMed</a>)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+xhaz">xhaz</a></code>, <code><a href="#topic+mexhazLT">mexhazLT</a></code>, <code><a href="#topic+AIC.mexhazLT">AIC.mexhazLT</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# load the data set in the package
library("survival")
library("numDeriv")
library("survexp.fr")


breast$sexe &lt;- "female"

fit.haz &lt;- exphaz(
                  formula = Surv(temps, statut) ~ 1,
                  data = breast, ratetable = survexp.us,
                  only_ehazard = FALSE,
                  rmap = list(age = 'age', sex = 'sexe', year = 'date'))

breast$expected &lt;- fit.haz$ehazard
breast$expectedCum &lt;- fit.haz$ehazardInt

mod.bs3 &lt;- mexhazLT(formula = Surv(temps, statut) ~ agecr + armt,
                  data = breast,
                  ratetable = survexp.us, degree = 3,
                  knots=quantile(breast[breast$statut==1,]$temps, probs=c(1:2/3)),
                  expected = "expected",expectedCum = "expectedCum",
                  base = "exp.bs", pophaz = "classic", random ="hosp")

mod.bs3

mod.bs4 &lt;- mexhazLT(formula = Surv(temps, statut) ~ agecr + armt,
                  data = breast,
                  ratetable = survexp.us, degree = 3,
                  knots=quantile(breast[breast$statut==1,]$temps, probs=c(1:2/3)),
                  expected = "expected",expectedCum = "expectedCum",
                  base = "exp.bs", pophaz = "rescaled", random = "hosp")

mod.bs4

  anova(mod.bs3, mod.bs4)


</code></pre>

<hr>
<h2 id='BIC.bsplines'>Bayesian Information Criterion for excess hazard model with
baseline hazard following a B-splines functions</h2><span id='topic+BIC.bsplines'></span>

<h3>Description</h3>

<p>Calculates the Bayesian Information Criterion' for fitted
models from <code>xhaz</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bsplines'
BIC(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="BIC.bsplines_+3A_object">object</code></td>
<td>
<p>a fitted model object obtained from <code>xhaz</code> function</p>
</td></tr>
<tr><td><code id="BIC.bsplines_+3A_...">...</code></td>
<td>
<p>optionally more fitted model objects obtained from <code>xhaz</code> function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the value corresponds to the BIC calculated from the total
log-likelihood of the fitted model if just one object is provided.
If multiple objects are provided, a data.frame with columns corresponding to the
objects and rows representing the number of parameters in the model (df) and the BIC.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library("xhaz")

#Giorgi et al model: baseline excess hazard is a quadratic Bsplines
#                    function with two interior knots and allow here a
#                    linear and proportional effects for the covariates on
#                    baseline excess hazard.

fitphBS &lt;- xhaz(formula = Surv(time_year, status) ~ agec + race,
                data = simuData,
                ratetable = survexp.us,
                interval = c(0, NA, NA, 6),
                rmap = list(age = 'age', sex = 'sex', year = 'date'),
                baseline = "bsplines", pophaz = "classic")

fitphBS
BIC(fitphBS)


</code></pre>

<hr>
<h2 id='BIC.constant'>Bayesian Information Criterion for excess hazard model with
baseline hazard following a piecewise constant function</h2><span id='topic+BIC.constant'></span>

<h3>Description</h3>

<p>Calculates the Bayesian Information Criterion' for fitted
models from <code>xhaz</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'constant'
BIC(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="BIC.constant_+3A_object">object</code></td>
<td>
<p>a fitted model object obtained from <code>xhaz</code> function</p>
</td></tr>
<tr><td><code id="BIC.constant_+3A_...">...</code></td>
<td>
<p>optionally more fitted model objects obtained from <code>xhaz</code> function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the value corresponds to the BIC calculated from the total
log-likelihood of the fitted model if just one object is provided.
If multiple objects are provided, a data.frame with columns corresponding to the
objects and rows representing the number of parameters in the model (df) and the BIC.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("xhaz")

# Esteve et al. model: baseline excess hazard is a piecewise function
#                      linear and proportional effects for the covariates on
#                      baseline excess hazard.


set.seed(1980)
simuData2 &lt;- simuData[sample(nrow(simuData), size = 500), ]
fit.estv2 &lt;- xhaz(formula = Surv(time_year, status) ~ agec + race,
                  data = simuData2,
                  ratetable = survexp.us,
                  interval = c(0, NA, NA, NA, NA, NA, 6),
                  rmap = list(age = 'age', sex = 'sex', year = 'date'),
                  baseline = "constant", pophaz = "classic")


fit.estv2

BIC(fit.estv2)

</code></pre>

<hr>
<h2 id='BIC.mexhazLT'>Bayesian Information Criterion for excess hazard model from mexhazLT function</h2><span id='topic+BIC.mexhazLT'></span>

<h3>Description</h3>

<p>Calculates the Bayesian Information Criterion' for fitted
models from <code>mexhazLT</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mexhazLT'
BIC(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="BIC.mexhazLT_+3A_object">object</code></td>
<td>
<p>a fitted model object obtained from <code>mexhazLT</code> function</p>
</td></tr>
<tr><td><code id="BIC.mexhazLT_+3A_...">...</code></td>
<td>
<p>optionally more fitted model objects obtained from <code>mexhazLT</code> function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the value corresponds to the BIC calculated from the total
log-likelihood of the fitted model if just one object is provided.
If multiple objects are provided, a data.frame with columns corresponding to the
objects and rows representing the number of parameters in the model (df) and the BIC.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library("xhaz")

data("breast")
# load the data sets 'breast'.

 # Flexible mexhaz model: baseline excess hazard with cubic B-splines
 # assumption on the life table available :
 # other cause mortality in the cohort is comparable to the mortality
 # observed in the general population with the same characteristics.

# The life table to be used is survexp.us. Note that SEX is coded 2 instead of female in survexp.us.
breast$sexe &lt;- "female"

fit.haz &lt;- exphaz(
                  formula = Surv(temps, statut) ~ 1,
                  data = breast, ratetable = survexp.us,
                  only_ehazard = FALSE,
                  rmap = list(age = 'age', sex = 'sexe', year = 'date'))

breast$expected &lt;- fit.haz$ehazard
breast$expectedCum &lt;- fit.haz$ehazardInt

mod.bs &lt;- mexhazLT(formula = Surv(temps, statut) ~ agecr + armt,
                  data = breast,
                  ratetable = survexp.us, degree = 3,
                  knots=quantile(breast[breast$statut==1,]$temps, probs=c(1:2/3)),
                  expected = "expected",expectedCum = "expectedCum",
                  base = "exp.bs", pophaz = "classic")

mod.bs

BIC(mod.bs)


</code></pre>

<hr>
<h2 id='breast'>Simulated clinical trial data with non comparability bias in term of individuals expected hazard</h2><span id='topic+breast'></span>

<h3>Description</h3>

<p>Simulated data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(breast)
</code></pre>


<h3>Format</h3>

<p>This dataset contains the following variables:
</p>

<dl>
<dt>temps</dt><dd><p>Follow-up time (years)</p>
</dd>
<dt>statut</dt><dd><p>Vital status</p>
</dd>
<dt>age</dt><dd><p>Age at diagnosis</p>
</dd>
<dt>agecr</dt><dd><p>Centered and scaled age</p>
</dd>
<dt>date</dt><dd><p>date of diagnosis.</p>
</dd>
<dt>SEX</dt><dd><p>2 for female</p>
</dd>
<dt>armt</dt><dd><p>2 arms of treatment (0,1)</p>
</dd>
<dt>hosp</dt><dd><p>clinical centers</p>
</dd>
<dt>dept</dt><dd><p>department of residence</p>
</dd>
</dl>



<h3>References</h3>

<p>Goungounga, JA, Graff\'eo N, Charvat H, Giorgi R. “Correcting for
heterogeneity and non-comparability bias in multicenter clinical trials
with a rescaled random-effect excess hazard model.” Biometrical journal.
Biometrische Zeitschrift vol. 65,4 (2023): e2100210.
doi:10.1002/bimj.202100210.PMID: 36890623;
(<a href="https://pubmed.ncbi.nlm.nih.gov/36890623/">PubMed</a>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(breast)
summary(breast)
</code></pre>

<hr>
<h2 id='ccr.mevents'>colorectum cancer data with multiple events</h2><span id='topic+ccr.mevents'></span>

<h3>Description</h3>

<p>multiple events data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(dataCancer)
</code></pre>


<h3>Format</h3>

<p>This dataset contains the following variables:
</p>

<dl>
<dt>id</dt><dd><p>patient IDs.</p>
</dd>
<dt>sex</dt><dd><p>gender with 1 for male and 2 for female.</p>
</dd>
<dt>sexe</dt><dd><p>gender male and female.</p>
</dd>
<dt>age</dt><dd><p>Age at diagnosis</p>
</dd>
<dt>stage</dt><dd><p>lower to higher stage 1, 2, 3</p>
</dd>
<dt>time</dt><dd><p>time-to-events (local or distant recurrence or death)</p>
</dd>
<dt>status</dt><dd><p> 0 : no event; 1: local or distant recurrence or death</p>
</dd>
<dt>event</dt><dd><p>1: local recurrence; 2: distant recurrence; 3:death</p>
</dd>
<dt>date_diag</dt><dd><p>date of diagnosis.</p>
</dd>
</dl>



<h3>References</h3>

<p>Touraine C, Graff\'eo N, Giorgi R; CENSUR working survival group.
More accurate cancer-related excess mortality through correcting
background mortality for extra variables.
Stat Methods Med Res. 2020 Jan;29(1):122-136.
doi: 10.1177/0962280218823234. Epub 2019 Jan 23. PMID: 30674229.
(<a href="https://pubmed.ncbi.nlm.nih.gov/30674229/">PubMed</a>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(ccr.mevents)
summary(ccr.mevents)
</code></pre>

<hr>
<h2 id='dataCancer'>Simulated data with cause death information with non comparability bias in term of individuals expected hazard</h2><span id='topic+dataCancer'></span>

<h3>Description</h3>

<p>Simulated data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(dataCancer)
</code></pre>


<h3>Format</h3>

<p>This dataset contains the following variables:
</p>

<dl>
<dt>obs_time</dt><dd><p>Follow-up time (months)</p>
</dd>
<dt>obs_time_year</dt><dd><p>Follow-up time (years)</p>
</dd>
<dt>event</dt><dd><p>Vital status</p>
</dd>
<dt>age</dt><dd><p>Age at diagnosis</p>
</dd>
<dt>agegrp</dt><dd><p>&quot;&lt;30&quot; , &quot;30_60&quot; and  &quot;&gt;=60&quot; age groups </p>
</dd>
<dt>ageCentre</dt><dd><p>centered age at diagnosis</p>
</dd>
<dt>sexx</dt><dd><p>Sex(Female,Male).</p>
</dd>
<dt>immuno_trt</dt><dd><p>Treatment group</p>
</dd>
<dt>year_date</dt><dd><p>date of diagnosis.</p>
</dd>
</dl>



<h3>References</h3>

<p>Goungounga JA, Touraine C, Graff\'eo N, Giorgi R;
CENSUR working survival group. Correcting for misclassification
and selection effects in estimating net survival in clinical trials.
BMC Med Res Methodol. 2019 May 16;19(1):104.
doi: 10.1186/s12874-019-0747-3. PMID: 31096911; PMCID: PMC6524224.
(<a href="https://pubmed.ncbi.nlm.nih.gov/31096911/">PubMed</a>)
</p>
<p>Touraine C, Graff\'eo N, Giorgi R; CENSUR working survival group.
More accurate cancer-related excess mortality through correcting
background mortality for extra variables.
Stat Methods Med Res. 2020 Jan;29(1):122-136.
doi: 10.1177/0962280218823234. Epub 2019 Jan 23. PMID: 30674229.
(<a href="https://pubmed.ncbi.nlm.nih.gov/30674229/">PubMed</a>)
</p>
<p>Mba RD, Goungounga JA, Graff\'eo N, Giorgi R; CENSUR working survival group.
Correcting inaccurate background mortality in excess hazard models
through breakpoints. BMC Med Res Methodol. 2020 Oct 29;20(1):268.
doi: 10.1186/s12874-020-01139-z. PMID: 33121436; PMCID: PMC7596976.
(<a href="https://pubmed.ncbi.nlm.nih.gov/33121436/">PubMed</a>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(dataCancer)
summary(dataCancer)
</code></pre>

<hr>
<h2 id='duplicate'>duplicate function</h2><span id='topic+duplicate'></span>

<h3>Description</h3>

<p>Duplicate data for survival analysis in the context of
competing risks, where an individual can experience only one of alternative
events, using the Lunn &amp; McNeil (Biometrics, 1995) approaches.
Duplication of data proceeds as follows: Suppose that we study <code>J</code>
distinct types of events. Each observation concerning a given subject is
duplicated <code>J</code> times, with one row for each type of event. In addition,
<code>(J-1)</code> dummy variables are created, each indicating the type of event
in relation with that observation (<code>delta.j=1</code> if the event of type j
is the observed one and <code>0</code> otherwise).
Since, for a given subject, only the first occurring event is considered,
the status indicator equals <code>1</code> for that event and <code>0</code> for all the
others. In the case of a censored observation (dropout or administrative
censoring), the same principle applies also: duplication of each subject's
data is made <code>J</code> times with <code>(J-1)</code> dummy variables and a status
indicator equal to <code>0</code> for all observations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>duplicate(status, event, data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="duplicate_+3A_status">status</code></td>
<td>
<p>the censoring status indicator (numeric vector),
0=alive, 1=dead.</p>
</td></tr>
<tr><td><code id="duplicate_+3A_event">event</code></td>
<td>
<p>the indicator of the event type (numeric vector).
By default, the event==0 acts as the censoring indicator.</p>
</td></tr>
<tr><td><code id="duplicate_+3A_data">data</code></td>
<td>
<p>a data frame containing the data to duplicate.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame containing the duplicated data with the new dummy
variables, named <code>delta.number_of_the_event</code>, indicating the type of
event.
</p>


<h3>Author(s)</h3>

<p>Roch Giorgi
</p>


<h3>References</h3>

<p>Lunn M and McNeil D. Applying Cox regression to competing risks.
Biometrics 1995;51:524-532
(<a href="https://pubmed.ncbi.nlm.nih.gov/7662841/">PubMed</a>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Create the simplest test data set
data1 &lt;- data.frame(futime     = c(1, 2, 5, 2, 1, 7, 3, 4, 8, 8),
                    fustat     = c(0, 1, 1, 1, 0, 0, 1, 0, 1, 1),
                    firstevent = c(0, 2, 1, 2, 0, 0, 1, 0, 2, 2),
                    sex        = c(1, 0, 0, 1, 0, 1, 1, 1, 0, 0))

## Duplicate data1 with firstevent == 0 as the censoring indicator.
library(xhaz)
dupli.data &lt;- duplicate(status=fustat, event=firstevent, data=data1)


data2 &lt;- data.frame(futime = c(10, 2, 7, 3, 4, 9, 13, 2, 5, 9),
                    fustat = c(0, 1, 1, 1, 0, 0, 1, 0, 1, 1),
                    firstevent = c(3, 2, 1, 2, 3, 3, 1, 3, 2, 2),
                    sex = c(1, 0, 0, 1, 0, 1, 1, 1, 0, 0))


## Duplicate data1 with firstevent == 3 as the censoring indicator.

dupli.data &lt;- duplicate(status = fustat,
                        event = firstevent == 3,
                        data = data2)


# Joint modeling
coxph(Surv(futime, fustat) ~ delta.2 + sex + delta.2:(sex), data = dupli.data)

coxph(Surv(futime, fustat) ~ delta.1 + sex + delta.1:(sex), data = dupli.data)

# exemple using ccr.mevents data


ccr.mevents$loc.rec &lt;- as.numeric(ccr.mevents$event == 1)
ccr.mevents$dist.rec &lt;- as.numeric(ccr.mevents$event == 2)
ccr.mevents$death &lt;- as.numeric(ccr.mevents$event == 3)
# Age centered to mean and scaled
ccr.mevents$agecr &lt;-  scale(ccr.mevents$age, TRUE, TRUE)

## Duplication of the data with local recurrence as the reference
dupli.ccr.mevents &lt;- duplicate(status = status,
                               event = event, data = ccr.mevents)
head(dupli.ccr.mevents)
# joint model including overall mortality modelling
fit &lt;- coxph(Surv(time, status) ~ agecr + sexe + stage + delta.2 + delta.3,
             data = dupli.ccr.mevents)

fit

# add expected mortality from french life table to the data


library(survexp.fr)
fit.haz &lt;- exphaz(formula = Surv(time, death) ~ 1,
                  data = dupli.ccr.mevents,
                  ratetable = survexp.fr, only_ehazard = TRUE,
                  rmap = list(age = 'age', sex = 'sexe', year = 'date_diag'))

 dupli.ccr.mevents$mua &lt;- fit.haz$ehazard * dupli.ccr.mevents$delta.3

# joint model including excess hazard modelling
library(mexhaz)
fit.mort &lt;- mexhaz(
    Surv(time, status) ~ delta.2 + delta.3,
    data = dupli.ccr.mevents, base = "exp.bs", degree = 3, knots = c(1),
    expected = "mua")

fit.mort


</code></pre>

<hr>
<h2 id='exphaz'>exphaz function</h2><span id='topic+exphaz'></span>

<h3>Description</h3>

<p>Calculate the expected hazard and survival.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>exphaz(
  formula = formula(data),
  data = sys.parent(),
  ratetable,
  rmap = list(age = NULL, sex = NULL, year = NULL),
  ratedata = sys.parent(),
  only_ehazard = TRUE,
  subset,
  na.action,
  scale = 365.2425
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="exphaz_+3A_formula">formula</code></td>
<td>
<p>a formula object of the <code>Surv</code> function with the
response on the left of a <code>~</code> operator and the terms on the right. The
response must be a survival object as returned by the <code>Surv</code>
function (<code>time</code> in first and <code>status</code> in second).</p>
</td></tr>
<tr><td><code id="exphaz_+3A_data">data</code></td>
<td>
<p>a data frame in which to interpret the variables named in the
formula</p>
</td></tr>
<tr><td><code id="exphaz_+3A_ratetable">ratetable</code></td>
<td>
<p>a rate table stratified by <code>age</code>, <code>sex</code>,
<code>year</code> (if missing, ratedata is used)</p>
</td></tr>
<tr><td><code id="exphaz_+3A_rmap">rmap</code></td>
<td>
<p>a list that maps data set names to the ratetable names.</p>
</td></tr>
<tr><td><code id="exphaz_+3A_ratedata">ratedata</code></td>
<td>
<p>a data frame of the hazards mortality in general population.</p>
</td></tr>
<tr><td><code id="exphaz_+3A_only_ehazard">only_ehazard</code></td>
<td>
<p>a boolean argument (by default, <code>only_ehazard=TRUE</code>).
If <code>TRUE</code>, the cumulative population hazard is not provided.</p>
</td></tr>
<tr><td><code id="exphaz_+3A_subset">subset</code></td>
<td>
<p>an expression indicating which subset of the rows in data
should be used in the fit. All observations are included by default</p>
</td></tr>
<tr><td><code id="exphaz_+3A_na.action">na.action</code></td>
<td>
<p>a missing data filter function. The default is na.fail,
which returns an error if any missing values are found. An alternative is
na.exclude, which deletes observations that contain one or more missing
values.</p>
</td></tr>
<tr><td><code id="exphaz_+3A_scale">scale</code></td>
<td>
<p>a numeric argument specifying by default <code>scale = 365.2425</code>
(or using the value corresponding to <code>attributes(ratetable)$cutpoints[[1]][2]</code>, often equal
to 365.25) if the user wants to extract a yearly hazard rate, or <code>scale = 1</code> if he
wants to extract a daily hazard rate from a ratetable containing daily hazard rates for
a matched subject from the population, defined as <code>-log(1-q)/365.25</code>
where <code>q</code> is the <code>1-</code>year probability of death.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>list</code> containing the following components:
</p>
<table role = "presentation">
<tr><td><code>ehazard</code></td>
<td>
<p>expected hazard calculated from the matching <code>ratetable</code>.</p>
</td></tr>
<tr><td><code>ehazardInt</code></td>
<td>
<p>cumulative expected hazard calculated from the matching <code>ratetable</code>. if <code>only_ehazard=TRUE</code>, this quantity is not provided.</p>
</td></tr>
<tr><td><code>dateDiag</code></td>
<td>
<p>date of diagnosis</p>
</td></tr>
</table>


<h3>Note</h3>

<p><code>Time</code> is OBLIGATORY in YEARS.
</p>


<h3>References</h3>

<p>Goungounga JA, Touraine C, Graff\'eo N, Giorgi R;
CENSUR working survival group. Correcting for misclassification
and selection effects in estimating net survival in clinical trials.
BMC Med Res Methodol. 2019 May 16;19(1):104.
doi: 10.1186/s12874-019-0747-3. PMID: 31096911; PMCID: PMC6524224.
(<a href="https://pubmed.ncbi.nlm.nih.gov/31096911/">PubMed</a>)
</p>
<p>Therneau, T. M., Grambsch, P. M., Therneau, T. M., &amp; Grambsch, P. M. (2000).
Expected survival. Modeling survival data: extending the Cox model, 261-287.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
library(survexp.fr)
library(xhaz)
fit.haz &lt;- exphaz(
                formula = Surv(obs_time_year, event) ~ 1,
                data = dataCancer,
                ratetable = survexp.fr, only_ehazard = TRUE,
                rmap = list(age = 'age', sex = 'sexx', year = 'year_date')
)

</code></pre>

<hr>
<h2 id='mexhazLT'>mexhazLT function</h2><span id='topic+mexhazLT'></span><span id='topic+mexhazAlpha'></span>

<h3>Description</h3>

<p>Extends excess hazard models from the mexhaz R<code>-</code>package to allow rescaling (Goungounga et al. (2019) <a href="doi:10.1186/s12874-019-0747-3">doi:10.1186/s12874-019-0747-3</a>) of the background mortality in the presence or absence of multilevel data (Goungounga et al. (2023) &lt;doi: 10.1002/bimj.202100210&gt;).
It allows for different shapes of the baseline hazard, the ability to include time<code>-</code>dependent effects of variable(s), and a random effect at the cluster level.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mexhazLT(
  formula,
  data,
  expected = "expected",
  expectedCum = "expectedCum",
  pophaz = "classic",
  base = c("weibull", "exp.bs", "exp.ns", "pw.cst"),
  degree = 3,
  knots = NULL,
  bound = NULL,
  n.gleg = 20,
  init = NULL,
  random = NULL,
  n.aghq = 10,
  fnoptim = c("nlm", "optim"),
  verbose = 0,
  method = "Nelder-Mead",
  iterlim = 10000,
  numHess = FALSE,
  print.level = 1,
  exactGradHess = TRUE,
  gradtol = ifelse(exactGradHess, 1e-08, 1e-06),
  testInit = TRUE,
  keep.data = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mexhazLT_+3A_formula">formula</code></td>
<td>
<p>a formula object of the  function with the response on the left
of a <code>~</code> operator and the terms on the right. The response must be a
survival object as returned by the <code>Surv</code> function (time in first and status
in second).</p>
</td></tr>
<tr><td><code id="mexhazLT_+3A_data">data</code></td>
<td>
<p>a data frame in which the variables named in the formula are to be interpreted.</p>
</td></tr>
<tr><td><code id="mexhazLT_+3A_expected">expected</code></td>
<td>
<p>name of the variable (must be given in quotes) representing
the population instantaneous hazard.</p>
</td></tr>
<tr><td><code id="mexhazLT_+3A_expectedcum">expectedCum</code></td>
<td>
<p>name of the variable (must be given in quotes) representing
the population cumulative hazard.</p>
</td></tr>
<tr><td><code id="mexhazLT_+3A_pophaz">pophaz</code></td>
<td>
<p>specifies two possible arguments in character: classic and
rescaled. If <code>pophaz = "classic"</code> is chosen, it fits the models that do
not require the background mortality  to be rescaled and assumes that the
comparability assumption holds; if <code>pophaz = "rescaled"</code> is chosen, it
fits the models that require that require the background mortality to be rescaled.</p>
</td></tr>
<tr><td><code id="mexhazLT_+3A_base">base</code></td>
<td>
<p>functional form that should be used to model the baseline hazard.
Selection can be made between the following options: <code>"weibull"</code> for a Weibull
hazard, <code>"exp.bs"</code> for a hazard described by the exponential of a B<code>-</code>spline
(only B<code>-</code>splines of degree 1, 2 or 3 are accepted), <code>"exp.ns"</code> for a hazard
described by the exponential of a restricted cubic spline (also called 'natural spline'), <code>"pw.cst"</code> for a piecewise constant hazard. By default, base=&quot;weibull&quot; as
in mexhaz R<code>-</code>package.</p>
</td></tr>
<tr><td><code id="mexhazLT_+3A_degree">degree</code></td>
<td>
<p>if <code>base="exp.bs"</code>, degree represents the degree of the B<code>-</code>spline used.
Only integer values between 1 and 3 are accepted, and 3 is the default.</p>
</td></tr>
<tr><td><code id="mexhazLT_+3A_knots">knots</code></td>
<td>
<p>if <code>base="exp.bs"</code> or <code>"exp.ns"</code>, knots is the vector
of interior knots of the spline. If <code>base="pw.cst"</code>, knots is the vector
defining the endpoints of the time intervals on which the hazard is assumed
to be constant. By default, <code>knots=NULL</code> (that is, it produces a B<code>-</code>spline
with no interior knots if base=&quot;exp.bs&quot;, a linear B<code>-</code>spline with no interior
knots if base=&quot;exp.ns&quot;, or a constant hazard over the whole follow<code>-</code>up period
if <code>base="pw.cst"</code>).</p>
</td></tr>
<tr><td><code id="mexhazLT_+3A_bound">bound</code></td>
<td>
<p>a vector of two numerical values corresponding to the boundary
knots of the spline functions. If <code>base="exp.bs"</code> or <code>base="exp.ns"</code>,
computation of the B-spline basis requires that boundary knots be given.
The bound argument allows the user to specify these boundary knots.
If <code>base="exp.bs"</code>, the interval defined by the boundary knots must at
least include the interval <code>c(0,max(time))</code> (otherwise, there could be
problems with ill<code>-</code>conditioned bases). If <code>base="exp.ns"</code>,</p>
</td></tr>
<tr><td><code id="mexhazLT_+3A_n.gleg">n.gleg</code></td>
<td>
<p>corresponds to the number of quadrature nodes to be specified as in <code>mexhaz</code>.</p>
</td></tr>
<tr><td><code id="mexhazLT_+3A_init">init</code></td>
<td>
<p>vector of initial values as in <code>mexhaz</code>.</p>
</td></tr>
<tr><td><code id="mexhazLT_+3A_random">random</code></td>
<td>
<p>name of the variable to be entered as a random effect (must be
given between quotes), representing the cluster membership. As in <code>mexhaz</code>
<code>random=NULL</code> means that the function fits a fixed effects model.</p>
</td></tr>
<tr><td><code id="mexhazLT_+3A_n.aghq">n.aghq</code></td>
<td>
<p>corresponds to the number of quadrature points to be specified
as in <code>mexhaz</code> for the estimation of the cluster<code>-</code>specific marginal
likelihoods by adaptative Gauss<code>-</code>Hermite quadrature.</p>
</td></tr>
<tr><td><code id="mexhazLT_+3A_fnoptim">fnoptim</code></td>
<td>
<p>name of the R optimisation procedure used to maximise the
likelihood. Selection can be made between &quot;nlm&quot; (by default) and &quot;optim&quot;.
Note: if <code>exactGradHess=TRUE</code>, this argument will be ignored
(fnoptim will be set automatically to <code>"nlm"</code>).</p>
</td></tr>
<tr><td><code id="mexhazLT_+3A_verbose">verbose</code></td>
<td>
<p>integer parameter representing the frequency at which the
current state of the optimisation process is displayed. If verbose=0 (default),
nothing is displayed.</p>
</td></tr>
<tr><td><code id="mexhazLT_+3A_method">method</code></td>
<td>
<p>if fnoptim=&quot;optim&quot;, method represents the optimisation method to
be used by optim. By default, <code>method="Nelder-Mead"</code>. This parameter is not
used if <code>fnoptim="nlm"</code>.</p>
</td></tr>
<tr><td><code id="mexhazLT_+3A_iterlim">iterlim</code></td>
<td>
<p>if <code>fnoptim="nlm"</code>, iterlim represents the maximum number of
iterations before the nlm optimisation procedure is terminated. By default,
iterlim is set to 10000. This parameter is not used if <code>fnoptim="optim"</code>
(in this case, the maximum number of iterations must be given as part of a
list of control parameters via the control argument: see the help page of optim
for further details).</p>
</td></tr>
<tr><td><code id="mexhazLT_+3A_numhess">numHess</code></td>
<td>
<p>logical value allowing the user to choose between the Hessian
returned by the optimization algorithm (default) or the Hessian estimated by
the hessian function from the <code>numDeriv</code> package.</p>
</td></tr>
<tr><td><code id="mexhazLT_+3A_print.level">print.level</code></td>
<td>
<p>his argument is only used if <code>fnoptim="nlm"</code>. It determines
the level of printing during the optimisation process. The default value
(for the mexhaz function) is set to <code>'1'</code> which means that details on the
initial and final step of the optimisation procedure are printed (see the
help page of nlm for further details).</p>
</td></tr>
<tr><td><code id="mexhazLT_+3A_exactgradhess">exactGradHess</code></td>
<td>
<p>logical value allowing the user to decide whether
maximisation of the likelihood should be based on the analytic gradient and
Hessian computed internally (default, corresponding to <code>exactGradHess=TRUE</code>).</p>
</td></tr>
<tr><td><code id="mexhazLT_+3A_gradtol">gradtol</code></td>
<td>
<p>this argument is only used if <code>fnoptim="nlm"</code>.
It corresponds to the tolerance at which the scaled gradient is considered
close enough to zero to terminate the algorithm. The default value depends on
the value of the argument <code>exactGradHess</code>.</p>
</td></tr>
<tr><td><code id="mexhazLT_+3A_testinit">testInit</code></td>
<td>
<p>this argument is used only when <code>exactGradHess=TRUE</code> and
when the model is not an excess hazard random effect model. It instructs
the mexhaz function to try several vectors of initial values in case
optimization was not successful with the default (or user-defined) initial
values. Because optimization based on the analytical gradient and Hessian
is usually fast, this simple and empirical procedure proves useful to
increase the probability of convergence in cases when it is difficult
to specify appropriate initial values.</p>
</td></tr>
<tr><td><code id="mexhazLT_+3A_keep.data">keep.data</code></td>
<td>
<p>logical argument determining whether the dataset should be
kept in the object returned by the function: this can be useful in certain
contexts (e.g., to calculate cluster<code>-</code>specific posterior predictions from a
random intercept model) but might create unnecessarily voluminous objects.
The default value is set to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="mexhazLT_+3A_...">...</code></td>
<td>
<p>other parameters used with the <code>mexhazLT</code> function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>mexhaz</code>, <code>xhaz</code> or <code>mexhazLT</code>.
This object is a list containing the following components:
</p>
<table role = "presentation">
<tr><td><code>dataset</code></td>
<td>
<p>name of the dataset used to fit the model.</p>
</td></tr>
<tr><td><code>call</code></td>
<td>
<p>function call on which the model is based.</p>
</td></tr>
<tr><td><code>formula</code></td>
<td>
<p>formula part of the call.</p>
</td></tr>
<tr><td><code>withAlpha</code></td>
<td>
<p>logical value indicating whether the model corresponds to a class of models correcting for life tables.</p>
</td></tr>
<tr><td><code>expected</code></td>
<td>
<p>name of the variable corresponding to the population hazard.</p>
</td></tr>
<tr><td><code>expectedCum</code></td>
<td>
<p>name of the variable corresponding to the cumulative population hazard.</p>
</td></tr>
<tr><td><code>xlevels</code></td>
<td>
<p>information concerning the levels of the categorical variables used in the model.</p>
</td></tr>
<tr><td><code>n.obs.tot</code></td>
<td>
<p>total number of observations in the dataset.</p>
</td></tr>
<tr><td><code>n.obs</code></td>
<td>
<p>number of observations used to fit the model (after exclusion of missing values).</p>
</td></tr>
<tr><td><code>n.events</code></td>
<td>
<p>number of events (after exclusion of missing values).</p>
</td></tr>
<tr><td><code>n.clust</code></td>
<td>
<p>number of clusters.</p>
</td></tr>
<tr><td><code>n.time.0</code></td>
<td>
<p>number of observations for which the observed follow-up time was equal to 0 (only for right censored type data).</p>
</td></tr>
<tr><td><code>base</code></td>
<td>
<p>function used to model the baseline hazard.</p>
</td></tr>
<tr><td><code>max.time</code></td>
<td>
<p>maximal observed time in the dataset.</p>
</td></tr>
<tr><td><code>boundary.knots</code></td>
<td>
<p>vector of boundary values used to define the B<code>-</code>spline (or natural spline) bases.</p>
</td></tr>
<tr><td><code>degree</code></td>
<td>
<p>degree of the B<code>-</code>spline used to model the logarithm of the baseline hazard.</p>
</td></tr>
<tr><td><code>knots</code></td>
<td>
<p>vector of interior knots used to define the B<code>-</code>spline (or natural spline) bases.</p>
</td></tr>
<tr><td><code>names.ph</code></td>
<td>
<p>names of the covariables with a proportional effect.</p>
</td></tr>
<tr><td><code>random</code></td>
<td>
<p>name of the variable defining cluster membership (set to NA in the case of a purely fixed effects model).</p>
</td></tr>
<tr><td><code>init</code></td>
<td>
<p>a vector containing the initial values of the parameters.</p>
</td></tr>
<tr><td><code>coefficients</code></td>
<td>
<p>a vector containing the parameter estimates.</p>
</td></tr>
<tr><td><code>std.errors</code></td>
<td>
<p>a vector containing the standard errors of the parameter estimates.</p>
</td></tr>
<tr><td><code>vcov</code></td>
<td>
<p>the variance-covariance matrix of the estimated parameters.</p>
</td></tr>
<tr><td><code>gradient</code></td>
<td>
<p>the gradient of the log<code>-</code>likelihood function evaluated at the estimated parameters.</p>
</td></tr>
<tr><td><code>hessian</code></td>
<td>
<p>the Hessian of the log<code>-</code>likelihood function evaluated at the estimated parameters.</p>
</td></tr>
<tr><td><code>mu.hat</code></td>
<td>
<p>a data.frame containing the estimated cluster<code>-</code>specific random effects (shrinkage estimators).</p>
</td></tr>
<tr><td><code>var.mu.hat</code></td>
<td>
<p>the covariance matrix of the cluster<code>-</code>specific shrinkage estimators.</p>
</td></tr>
<tr><td><code>vcov.fix.mu.hat</code></td>
<td>
<p>a matrix containing the covariances between the fixed effect and the cluster<code>-</code>specific shrinkage estimators. More specifically, the i<code>-</code>th line of the matrix represents the covariances between the shrinkage estimator of the i<code>-</code>th cluster and the fixed effect estimates. This matrix is used by the function <code>predict.mexhaz</code> to make cluster<code>-</code>specific predictions.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>original dataset used to fit the model (if <code>keep.data</code> was set to <code>TRUE</code>).</p>
</td></tr>
<tr><td><code>n.par</code></td>
<td>
<p>number of estimated parameters.</p>
</td></tr>
<tr><td><code>n.gleg</code></td>
<td>
<p>number of Gauss<code>-</code>Legendre quadrature points used to calculate the cumulative (excess) hazard (only relevant if a B-spline of degree 2 or 3 or a cubic restricted spline was used to model the logarithm of the baseline hazard).</p>
</td></tr>
<tr><td><code>n.aghq</code></td>
<td>
<p>number of adaptive Gauss<code>-</code>Hermite quadrature points used to calculate the cluster-specific marginal likelihoods (only relevant if a multi-level model is fitted).</p>
</td></tr>
<tr><td><code>fnoptim</code></td>
<td>
<p>name of the R optimisation procedure used to maximise the likelihood.</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p>optimisation method used by optim.</p>
</td></tr>
<tr><td><code>code</code></td>
<td>
<p>code (integer) indicating the status of the optimisation process (this code has a different meaning for nlm and for optim: see their respective help page for details).</p>
</td></tr>
<tr><td><code>loglik</code></td>
<td>
<p>value of the log<code>-</code>likelihood at the end of the optimisation procedure. Note that this is different to that calculated in mexhaz as the cumulative expected hazard cannot be removed from the log<code>-</code>likelihood.</p>
</td></tr>
<tr><td><code>iter</code></td>
<td>
<p>number of iterations used in the optimisation process.</p>
</td></tr>
<tr><td><code>eval</code></td>
<td>
<p>number of evaluations used in the optimisation process.</p>
</td></tr>
<tr><td><code>time.elapsed</code></td>
<td>
<p>total time required to reach convergence.</p>
</td></tr>
</table>


<h3>Note</h3>

<p><code>time</code> is OBLIGATORY in YEARS.
</p>


<h3>Author(s)</h3>

<p>Juste Goungounga, Hadrien Charvat, Nathalie Graffeo, Roch Giorgi
</p>


<h3>References</h3>

<p>Goungounga JA, Touraine C, Graff\'eo N, Giorgi R; CENSUR working
survival group. Correcting for misclassification and selection effects in
estimating net survival in clinical trials. BMC Med Res Methodol. 2019 May
16;19(1):104. doi: 10.1186/s12874-019-0747-3. PMID: 31096911; PMCID:
PMC6524224. (<a href="https://pubmed.ncbi.nlm.nih.gov/31096911/">PubMed</a>)
</p>
<p>Goungounga, JA, Graff\'eo N, Charvat H, Giorgi R. “Correcting for
heterogeneity and non-comparability bias in multicenter clinical trials
with a rescaled random-effect excess hazard model.” Biometrical journal.
Biometrische Zeitschrift vol. 65,4 (2023): e2100210.
doi:10.1002/bimj.202100210.PMID: 36890623;
(<a href="https://pubmed.ncbi.nlm.nih.gov/36890623/">PubMed</a>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library("numDeriv")
library("survexp.fr")
library("splines")
library("statmod")
data("breast")
# load the data sets 'breast'.

 # Flexible mexhaz model: baseline excess hazard with cubic B-splines
 # assumption on the life table available :
 # other cause mortality in the cohort is comparable to the mortality
 # observed in the general population with the same characteristics.

# The life table to be used is survexp.us. Note that SEX is coded 2 instead of female in survexp.us.
breast$sexe &lt;- "female"

fit.haz &lt;- exphaz(
                  formula = Surv(temps, statut) ~ 1,
                  data = breast, ratetable = survexp.us,
                  only_ehazard = FALSE,
                  rmap = list(age = 'age', sex = 'sexe', year = 'date'))

breast$expected &lt;- fit.haz$ehazard
breast$expectedCum &lt;- fit.haz$ehazardInt

mod.bs &lt;- mexhazLT(formula = Surv(temps, statut) ~ agecr + armt,
                  data = breast,
                  ratetable = survexp.us, degree = 3,
                  knots=quantile(breast[breast$statut==1,]$temps, probs=c(1:2/3)),
                  expected = "expected",expectedCum = "expectedCum",
                  base = "exp.bs", pophaz = "classic")

mod.bs


 # Flexible mexhaz model: baseline excess hazard with cubic B-splines
 # assumption on the life table available :
 # other cause mortality in the cohort is different to the mortality
 # observed in the general population with the same characteristics.

mod.bs2 &lt;- mexhazLT(formula = Surv(temps, statut) ~ agecr + armt,
                  data = breast, degree = 3,
                  knots=quantile(breast[breast$statut==1,]$temps, probs=c(1:2/3)),
                  expected = "expected",expectedCum = "expectedCum",
                  base = "exp.bs", pophaz = "rescaled")

mod.bs2


 # Flexible mexhaz model with a random effects at cluster level:
 # baseline excess hazard with cubic B-splines
 # assumption on the life table used :
 # other cause mortality in the cohort is different to the mortality
 # observed in the general population with the same characteristics.

mod.bs3 &lt;- mexhazLT(formula = Surv(temps, statut) ~ agecr + armt,
                  data = breast, degree = 3,
                  knots=quantile(breast[breast$statut==1,]$temps, probs=c(1:2/3)),
                  expected = "expected",expectedCum = "expectedCum",
                  base = "exp.bs", pophaz = "rescaled", random = "hosp")

mod.bs3





</code></pre>

<hr>
<h2 id='plot.bsplines'>plot.bsplines</h2><span id='topic+plot.bsplines'></span>

<h3>Description</h3>

<p>to plot the log hazard ratio functions for non-proportional
hazards model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bsplines'
plot(
  x,
  cov,
  conf.int = TRUE,
  baseline = FALSE,
  xrange,
  yrange,
  xlegend,
  ylegend,
  glegend,
  xaxs = NULL,
  add = FALSE,
  col = 1,
  lty = 1,
  lwd = 1,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.bsplines_+3A_x">x</code></td>
<td>
<p>An object of class xhaz</p>
</td></tr>
<tr><td><code id="plot.bsplines_+3A_cov">cov</code></td>
<td>
<p>specify covariates for which a plot is required.</p>
</td></tr>
<tr><td><code id="plot.bsplines_+3A_conf.int">conf.int</code></td>
<td>
<p>a vector of logical values indicating whether (if TRUE)
confidence intervals will be plotted. The default is to do so if the plot
concerns only one curve.</p>
</td></tr>
<tr><td><code id="plot.bsplines_+3A_baseline">baseline</code></td>
<td>
<p>a vector of logical values indicating whether (if <code>baseline = TRUE</code>)
to plot the curve for the baseline group. Default is FALSE, except if cov
is unspecified.</p>
</td></tr>
<tr><td><code id="plot.bsplines_+3A_xrange">xrange</code></td>
<td>
<p>vector indicating the minimum and the maximum values of the
x axis. By default, these values are automatically calculated for the first
plot (i.e before the use of add argument).</p>
</td></tr>
<tr><td><code id="plot.bsplines_+3A_yrange">yrange</code></td>
<td>
<p>vector indicating the minimum and the maximum values of the y
axis. By default, these values are automatically calculated for the
first plot (i.e before the use of add argument).</p>
</td></tr>
<tr><td><code id="plot.bsplines_+3A_xlegend">xlegend</code></td>
<td>
<p>value indicating the location of the legend over x axis.
By default, location at the left of the plot.</p>
</td></tr>
<tr><td><code id="plot.bsplines_+3A_ylegend">ylegend</code></td>
<td>
<p>value indicating the location of the legend over y axis.
By default, location at the top of the plot</p>
</td></tr>
<tr><td><code id="plot.bsplines_+3A_glegend">glegend</code></td>
<td>
<p>vectors of names attributed to each lines of the excess hazard
to be displayed in the plot. If (<code>baseline = TRUE</code>), glegend is <code>"baseline"</code>.</p>
</td></tr>
<tr><td><code id="plot.bsplines_+3A_xaxs">xaxs</code></td>
<td>
<p>the x axis style, as listed in 'par'. Survival curves are
traditionally drawn with the curve touching the bounding box on the left
edge, but not touching it on the right edge. This corresponds to neither
of the two standard S axis styles of &quot;e&quot; (neither touches) or &quot;i&quot; (both touch).
If xaxis is missing or NULL the internal axis style is used (xaxs= i) but
only after the right endpoint has been extended.</p>
</td></tr>
<tr><td><code id="plot.bsplines_+3A_add">add</code></td>
<td>
<p>a logical value indicating whether to add the survival curves to the
current plot (if <code>add = TRUE</code>). Default is FALSE.</p>
</td></tr>
<tr><td><code id="plot.bsplines_+3A_col">col</code></td>
<td>
<p>a vector of integers specifying colors for each curve. The default
value is 1.</p>
</td></tr>
<tr><td><code id="plot.bsplines_+3A_lty">lty</code></td>
<td>
<p>a vector of integers specifying line types for each curve. The
default value is fixed by the number of covariates (plus 1 if <code>baseline = TRUE</code>).</p>
</td></tr>
<tr><td><code id="plot.bsplines_+3A_lwd">lwd</code></td>
<td>
<p>a vector of numeric values for line widths. The default value is 1.</p>
</td></tr>
<tr><td><code id="plot.bsplines_+3A_...">...</code></td>
<td>
<p>additional arguments affecting the plot function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The return of this function produce graphics of log hazard ratio
functions for non-proportional hazards model
</p>


<h3>Author(s)</h3>

<p>Juste Goungounga, Robert Darlin Mba, Nathalie Graff\'eo and Roch Giorgi
</p>


<h3>References</h3>

<p>Goungounga JA, Touraine C, Graff\'eo N, Giorgi R;
CENSUR working survival group. Correcting for misclassification
and selection effects in estimating net survival in clinical trials.
BMC Med Res Methodol. 2019 May 16;19(1):104.
doi: 10.1186/s12874-019-0747-3. PMID: 31096911; PMCID: PMC6524224.
(<a href="https://pubmed.ncbi.nlm.nih.gov/31096911/">PubMed</a>)
</p>
<p>Touraine C, Graff\'eo N, Giorgi R; CENSUR working survival group.
More accurate cancer-related excess mortality through correcting
background mortality for extra variables.
Stat Methods Med Res. 2020 Jan;29(1):122-136.
doi: 10.1177/0962280218823234. Epub 2019 Jan 23. PMID: 30674229.
(<a href="https://pubmed.ncbi.nlm.nih.gov/30674229/">PubMed</a>)
</p>
<p>Mba RD, Goungounga JA, Graff\'eo N, Giorgi R; CENSUR working survival group.
Correcting inaccurate background mortality in excess hazard models
through breakpoints. BMC Med Res Methodol. 2020 Oct 29;20(1):268.
doi: 10.1186/s12874-020-01139-z. PMID: 33121436; PMCID: PMC7596976.
(<a href="https://pubmed.ncbi.nlm.nih.gov/33121436/">PubMed</a>)
</p>
<p>Giorgi R, Abrahamowicz M, Quantin C, Bolard P, Esteve J, Gouvernet J,
Faivre J. A relative survival regression model using B-spline functions
to model non-proportional hazards.
Statistics in Medicine 2003; 22: 2767-84.
(<a href="https://pubmed.ncbi.nlm.nih.gov/12939785/">PubMed</a>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# load the data set in the package
library("xhaz")
library("survexp.fr")

data("dataCancer", package = "xhaz")   # load the data set in the package

fit.nphBS &lt;- xhaz(
      formula = Surv(obs_time_year, event) ~ ageCentre + qbs(immuno_trt),
      data = dataCancer,
      ratetable = survexp.fr,
      interval = c(0, NA, NA, max(dataCancer$obs_time_year)),
      rmap = list(age = 'age', sex = 'sexx', year = 'year_date'),
      baseline = "bsplines", pophaz  = "classic")

 plot(fit.nphBS, cov = "immuno_trt", col = "blue", baseline = FALSE)

</code></pre>

<hr>
<h2 id='plot.predxhaz'>plots of excess hazard and net Survival from an
<code>predxhaz</code> object</h2><span id='topic+plot.predxhaz'></span>

<h3>Description</h3>

<p>Function to plot excess hazard or net survival
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'predxhaz'
plot(x, what = "survival", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.predxhaz_+3A_x">x</code></td>
<td>
<p>An object of class predxhaz</p>
</td></tr>
<tr><td><code id="plot.predxhaz_+3A_what">what</code></td>
<td>
<p>allow to choose between excess hazard
(<code>what="hazard"</code>) or net survival (<code>what="survival"</code>).</p>
</td></tr>
<tr><td><code id="plot.predxhaz_+3A_...">...</code></td>
<td>
<p>additional arguments affecting the plot function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The return of this function produce graphics of excess hazard or net
survival, or time-dependent effects, when times.pts argument is provided
in prediction call.
</p>


<h3>Author(s)</h3>

<p>Juste Goungounga, Robert Darlin Mba, Nathalie Graff\'eo and Roch Giorgi
</p>


<h3>References</h3>

<p>Goungounga JA, Touraine C, Graff\'eo N, Giorgi R;
CENSUR working survival group. Correcting for misclassification
and selection effects in estimating net survival in clinical trials.
BMC Med Res Methodol. 2019 May 16;19(1):104.
doi: 10.1186/s12874-019-0747-3. PMID: 31096911; PMCID: PMC6524224.
(<a href="https://pubmed.ncbi.nlm.nih.gov/31096911/">PubMed</a>)
</p>
<p>Touraine C, Graff\'eo N, Giorgi R; CENSUR working survival group.
More accurate cancer-related excess mortality through correcting
background mortality for extra variables.
Stat Methods Med Res. 2020 Jan;29(1):122-136.
doi: 10.1177/0962280218823234. Epub 2019 Jan 23. PMID: 30674229.
(<a href="https://pubmed.ncbi.nlm.nih.gov/30674229/">PubMed</a>)
</p>
<p>Mba RD, Goungounga JA, Graff\'eo N, Giorgi R; CENSUR working survival group.
Correcting inaccurate background mortality in excess hazard models
through breakpoints. BMC Med Res Methodol. 2020 Oct 29;20(1):268.
doi: 10.1186/s12874-020-01139-z. PMID: 33121436; PMCID: PMC7596976.
(<a href="https://pubmed.ncbi.nlm.nih.gov/33121436/">PubMed</a>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("dataCancer")
# load the data set in the package
library("survival")
library("numDeriv")
library("survexp.fr")
data("simuData", package = "xhaz") # load the data sets 'simuData'

#define the levels of variable sex

# Esteve et al. model


fit.estv1 &lt;- xhaz(formula = Surv(time_year, status) ~ agec + race,
                  data = simuData, ratetable = survexp.us,
                  interval = c(0, NA, NA, NA, NA, NA, max(simuData$time_year)),
                  rmap = list(age = 'age', sex = 'sex', year = 'date'),
                  baseline = "constant", pophaz = "classic")


predict_est &lt;- predict(object = fit.estv1,
                       new.data = simuData,
                       times.pts = c(seq(0, 4, 0.1)),
                       baseline = TRUE)

plot(predict_est, what = "survival",
     xlab = "time since diagnosis (year)",
     ylab = "net survival", ylim = c(0, 1))
data("dataCancer", package = "xhaz")   # load the data set in the package

fit.phBS &lt;- xhaz(
      formula = Surv(obs_time_year, event) ~ ageCentre + immuno_trt,
      data = dataCancer, ratetable = survexp.fr::survexp.fr,
      interval = c(0, NA, NA, max(dataCancer$obs_time_year)),
      rmap = list(age = 'age', sex = 'sexx', year = 'year_date'),
      baseline = "bsplines", pophaz  = "classic")


predict_mod1 &lt;- predict(object = fit.phBS, new.data = dataCancer,
                        times.pts = c(seq(0, 10, 0.1)), baseline = FALSE)

old.par &lt;- par(no.readonly = TRUE)
par(mfrow = c(2, 1))


plot(predict_mod1, what = "survival",
     xlab = "time since diagnosis (year)",
     ylab = "net survival", ylim = c(0, 1))

plot(predict_mod1, what = "hazard",
     xlab = "time since diagnosis (year)",
     ylab = "excess hazard")

par(old.par)

</code></pre>

<hr>
<h2 id='predict.bsplines'>Predictions of excess hazard and net Survival from a <code>bsplines</code>
object</h2><span id='topic+predict.bsplines'></span>

<h3>Description</h3>

<p>Function to predict excess hazard and net survival based on
an object of class <code>bsplines</code>. The function allows the
predictions at several time points but not exceeding the maximum time of
follow-up from the baseline model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bsplines'
predict(object, new.data = NULL, times.pts = NULL, baseline = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict.bsplines_+3A_object">object</code></td>
<td>
<p>an object of class <code>bsplines</code></p>
</td></tr>
<tr><td><code id="predict.bsplines_+3A_new.data">new.data</code></td>
<td>
<p>new.data where is covariates</p>
</td></tr>
<tr><td><code id="predict.bsplines_+3A_times.pts">times.pts</code></td>
<td>
<p>time in year scale to calculate the excess hazard. The
default value is NULL. In this case, time variable must be provided in the
new.data</p>
</td></tr>
<tr><td><code id="predict.bsplines_+3A_baseline">baseline</code></td>
<td>
<p>default is survival baseline; put <code>baseline = FALSE</code>
to estimate the net survival with covariates</p>
</td></tr>
<tr><td><code id="predict.bsplines_+3A_...">...</code></td>
<td>
<p>additional arguments affecting the predictions of excess hazard
and net survival</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class predxhaz, which is a list of data.frame. Each
element of the list contains the estimates of hazard and survival at a fixed
time point. The return of this function can be used to produce graphics of
excess hazard or net survival, when times.pts argument is provided. This
object contains:
</p>
<table role = "presentation">
<tr><td><code>times.pts</code></td>
<td>
<p>the times value in year at which the excess hazard
and or the net survival have been estimated</p>
</td></tr>
<tr><td><code>hazard</code></td>
<td>
<p>the excess hazard values based on the model of interest</p>
</td></tr>
<tr><td><code>survival</code></td>
<td>
<p>the net survival values based on the model of interest</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Juste Goungounga, Robert Darlin Mba, Nathalie Graff\'eo and Roch Giorgi
</p>


<h3>References</h3>

<p>Goungounga JA, Touraine C, Graff\'eo N, Giorgi R;
CENSUR working survival group. Correcting for misclassification
and selection effects in estimating net survival in clinical trials.
BMC Med Res Methodol. 2019 May 16;19(1):104.
doi: 10.1186/s12874-019-0747-3. PMID: 31096911; PMCID: PMC6524224.
(<a href="https://pubmed.ncbi.nlm.nih.gov/31096911/">PubMed</a>)
</p>
<p>Touraine C, Graff\'eo N, Giorgi R; CENSUR working survival group.
More accurate cancer-related excess mortality through correcting
background mortality for extra variables.
Stat Methods Med Res. 2020 Jan;29(1):122-136.
doi: 10.1177/0962280218823234. Epub 2019 Jan 23. PMID: 30674229.
(<a href="https://pubmed.ncbi.nlm.nih.gov/30674229/">PubMed</a>)
</p>
<p>Mba RD, Goungounga JA, Graff\'eo N, Giorgi R; CENSUR working survival group.
Correcting inaccurate background mortality in excess hazard models
through breakpoints. BMC Med Res Methodol. 2020 Oct 29;20(1):268.
doi: 10.1186/s12874-020-01139-z. PMID: 33121436; PMCID: PMC7596976.
(<a href="https://pubmed.ncbi.nlm.nih.gov/33121436/">PubMed</a>)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+xhaz">xhaz</a></code>, <code><a href="#topic+print.bsplines">print.bsplines</a></code>, <code><a href="#topic+print.constant">print.constant</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

library("survival")
library("numDeriv")
library("survexp.fr")
library("splines")
data("dataCancer", package = "xhaz")   # load the data set in the package

fit.phBS &lt;- xhaz(
        formula = Surv(obs_time_year, event) ~ ageCentre + immuno_trt,
        data = dataCancer, ratetable = survexp.fr,
        interval = c(0, NA, NA, max(dataCancer$obs_time_year)),
        rmap = list(age = 'age', sex = 'sexx', year = 'year_date'),
        baseline = "bsplines", pophaz = "classic")


print(fit.phBS)


predicted &lt;- predict(object = fit.phBS,
                     new.data = dataCancer[1:10,],
                     times.pts = c(seq(0,10,1)),
                     baseline = TRUE)


#a list of predicted hazard and survival at different time points
print(predicted)


#predicted hazard and survival at time points 10 years
print(predicted[[10]])

</code></pre>

<hr>
<h2 id='predict.constant'>Predictions of excess hazard and net Survival from an <code>constant</code>
object</h2><span id='topic+predict.constant'></span>

<h3>Description</h3>

<p>Function to predict excess hazard and net survival based on an
object of class <code>constant</code>. The function allows the
predictions at several time points but not exceeding the maximum time of
follow-up from the baseline model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'constant'
predict(object, new.data = NULL, times.pts = NULL, baseline = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict.constant_+3A_object">object</code></td>
<td>
<p>An object of class constant</p>
</td></tr>
<tr><td><code id="predict.constant_+3A_new.data">new.data</code></td>
<td>
<p>new.data where is covariates</p>
</td></tr>
<tr><td><code id="predict.constant_+3A_times.pts">times.pts</code></td>
<td>
<p>time in year scale to calculate the excess hazard. The
default value is NULL. In this case, time variable must be provided in the
new.data</p>
</td></tr>
<tr><td><code id="predict.constant_+3A_baseline">baseline</code></td>
<td>
<p>default is survival baseline; put <code>baseline = FALSE</code>
to estimate the net survival with covariates</p>
</td></tr>
<tr><td><code id="predict.constant_+3A_...">...</code></td>
<td>
<p>additional arguments affecting the predictions of excess hazard
and net survival</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class predxhaz. The return of this fonction can be
used to produce graphics of excess hazard or net survival, when times.pts argument is provided. This object
contains:
</p>
<table role = "presentation">
<tr><td><code>times.pts</code></td>
<td>
<p>the times value in year at which the excess hazard and or the net survival have been estimated</p>
</td></tr>
<tr><td><code>hazard</code></td>
<td>
<p>the excess hazard values based on the model of interest</p>
</td></tr>
<tr><td><code>survival</code></td>
<td>
<p>the net survival values based on the model of interest</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Juste Goungounga, Robert Darlin Mba, Nathalie Graff\'eo and Roch Giorgi
</p>


<h3>References</h3>

<p>Goungounga JA, Touraine C, Graff\'eo N, Giorgi R;
CENSUR working survival group. Correcting for misclassification
and selection effects in estimating net survival in clinical trials.
BMC Med Res Methodol. 2019 May 16;19(1):104.
doi: 10.1186/s12874-019-0747-3. PMID: 31096911; PMCID: PMC6524224.
(<a href="https://pubmed.ncbi.nlm.nih.gov/31096911/">PubMed</a>)
</p>
<p>Touraine C, Graff\'eo N, Giorgi R; CENSUR working survival group.
More accurate cancer-related excess mortality through correcting
background mortality for extra variables.
Stat Methods Med Res. 2020 Jan;29(1):122-136.
doi: 10.1177/0962280218823234. Epub 2019 Jan 23. PMID: 30674229.
(<a href="https://pubmed.ncbi.nlm.nih.gov/30674229/">PubMed</a>)
</p>
<p>Mba RD, Goungounga JA, Graff\'eo N, Giorgi R; CENSUR working survival group.
Correcting inaccurate background mortality in excess hazard models
through breakpoints. BMC Med Res Methodol. 2020 Oct 29;20(1):268.
doi: 10.1186/s12874-020-01139-z. PMID: 33121436; PMCID: PMC7596976.
(<a href="https://pubmed.ncbi.nlm.nih.gov/33121436/">PubMed</a>)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+xhaz">xhaz</a></code>, <code><a href="#topic+print.bsplines">print.bsplines</a></code>, <code><a href="#topic+print.constant">print.constant</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# load the data set in the package
library("xhaz")
library("numDeriv")

# load the data sets 'simuData

data("simuData", package = "xhaz")

#define the levels of variable sex
levels(simuData$sex) &lt;- c("male", "female")

# Esteve et al. model

set.seed(1980)
simuData2 &lt;- simuData[sample(nrow(simuData), size = 500), ]

fit.estv2 &lt;- xhaz(formula = Surv(time_year, status) ~ agec + race,
                  data = simuData2,
                  ratetable = survexp.us,
                  interval = c(0, NA, NA, NA, NA, NA, 6),
                  rmap = list(age = 'age', sex = 'sex', year = 'date'),
                  baseline = "constant", pophaz = "classic")


predict_est &lt;- predict(object = fit.estv2,
                       new.data = simuData2,
                       times.pts = c(seq(0, 4, 1)),
                       baseline = TRUE)
predict_est

</code></pre>

<hr>
<h2 id='print.bsplines'>A print.bsplines Function used to print a object of class <code>bsplines</code></h2><span id='topic+print.bsplines'></span>

<h3>Description</h3>

<p>This function present the estimated coefficients for the excess
hazard baseline coefficient and for the covariate effects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bsplines'
print(x, digits = max(options()$digits - 4, 3), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.bsplines_+3A_x">x</code></td>
<td>
<p>an object of class <code>bsplines</code></p>
</td></tr>
<tr><td><code id="print.bsplines_+3A_digits">digits</code></td>
<td>
<p>minimal number of significant digits.</p>
</td></tr>
<tr><td><code id="print.bsplines_+3A_...">...</code></td>
<td>
<p>additionnal parameters which can be used in the <code>print</code>
function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Estimated parameters of the model in different scales for interpretation purposes.
</p>


<h3>References</h3>

<p>Goungounga JA, Touraine C, Graff\'eo N, Giorgi R;
CENSUR working survival group. Correcting for misclassification
and selection effects in estimating net survival in clinical trials.
BMC Med Res Methodol. 2019 May 16;19(1):104.
doi: 10.1186/s12874-019-0747-3. PMID: 31096911; PMCID: PMC6524224.
(<a href="https://pubmed.ncbi.nlm.nih.gov/31096911/">PubMed</a>)
</p>
<p>Touraine C, Graff\'eo N, Giorgi R; CENSUR working survival group.
More accurate cancer-related excess mortality through correcting
background mortality for extra variables.
Stat Methods Med Res. 2020 Jan;29(1):122-136.
doi: 10.1177/0962280218823234. Epub 2019 Jan 23. PMID: 30674229.
(<a href="https://pubmed.ncbi.nlm.nih.gov/30674229/">PubMed</a>)
</p>
<p>Mba RD, Goungounga JA, Graff\'eo N, Giorgi R; CENSUR working survival group.
Correcting inaccurate background mortality in excess hazard models
through breakpoints. BMC Med Res Methodol. 2020 Oct 29;20(1):268.
doi: 10.1186/s12874-020-01139-z. PMID: 33121436; PMCID: PMC7596976.
(<a href="https://pubmed.ncbi.nlm.nih.gov/33121436/">PubMed</a>)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+xhaz">xhaz</a></code>, <code><a href="#topic+plot.predxhaz">plot.predxhaz</a></code>, <code><a href="#topic+print.constant">print.constant</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


library("xhaz")
library("survival")
library("numDeriv")
library("survexp.fr")
library("splines")
data("dataCancer", package = "xhaz")   # load the data set in the package

fit.phBS &lt;- xhaz(
              formula = Surv(obs_time_year, event) ~ ageCentre + immuno_trt,
              data = dataCancer, ratetable = survexp.fr,
              interval = c(0, NA, NA, max(dataCancer$obs_time_year)),
              rmap = list(age = 'age', sex = 'sexx', year = 'year_date'),
              baseline = "bsplines", pophaz = "classic")

print(fit.phBS)


</code></pre>

<hr>
<h2 id='print.constant'>A print.constant Function used to print a object of class constant</h2><span id='topic+print.constant'></span>

<h3>Description</h3>

<p>This function present the estimated coefficients for the excess
hazard baseline coefficient and for the covariate effects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'constant'
print(x, ci_type = "lognormal", digits = max(options()$digits - 4, 3), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.constant_+3A_x">x</code></td>
<td>
<p>an object of class xhaz.constant</p>
</td></tr>
<tr><td><code id="print.constant_+3A_ci_type">ci_type</code></td>
<td>
<p>method for confidence intervals calculation</p>
</td></tr>
<tr><td><code id="print.constant_+3A_digits">digits</code></td>
<td>
<p>minimal number of significant digits.</p>
</td></tr>
<tr><td><code id="print.constant_+3A_...">...</code></td>
<td>
<p>additionnal parameters which can be used in the <code>print</code>
function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Estimated parameters of the model in different scales for interpretation purposes.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+xhaz">xhaz</a></code>, <code><a href="#topic+summary.constant">summary.constant</a></code>, <code><a href="#topic+print.bsplines">print.bsplines</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library("numDeriv")
library("survexp.fr")

data("simuData","rescaledData", "dataCancer")
# load the data sets 'simuData', 'rescaledData' and 'dataCancer'.

# Esteve et al. model: baseline excess hazard is a piecewise function
#                      linear and proportional effects for the covariates on
#                      baseline excess hazard.

set.seed(1980)
simuData2 &lt;- simuData[sample(nrow(simuData), size = 500), ]

fit.estv2 &lt;- xhaz(formula = Surv(time_year, status) ~ agec + race,
                  data = simuData2,
                  ratetable = survexp.us,
                  interval = c(0, NA, NA, NA, NA, NA, 6),
                  rmap = list(age = 'age', sex = 'sex', year = 'date'),
                  baseline = "constant", pophaz = "classic")


print(fit.estv2)


</code></pre>

<hr>
<h2 id='print.predxhaz'>A print.predxhaz Function used to print a object of class predxhaz</h2><span id='topic+print.predxhaz'></span>

<h3>Description</h3>

<p>This function present the print of the predict function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'predxhaz'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.predxhaz_+3A_x">x</code></td>
<td>
<p>an object of class predxhaz</p>
</td></tr>
<tr><td><code id="print.predxhaz_+3A_...">...</code></td>
<td>
<p>other parameters used for print function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an object of class data.frame containing the following components:
</p>
<table role = "presentation">
<tr><td><code>times.pts</code></td>
<td>
<p>The time at which the estimations of excess hazard and net
survival are predicted</p>
</td></tr>
<tr><td><code>hazard</code></td>
<td>
<p>the predicted excess hazard at the fixed times</p>
</td></tr>
<tr><td><code>survival</code></td>
<td>
<p>the predicted net survival at the fixed times</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>


library("xhaz")
library("survexp.fr")
library("splines")

data("dataCancer", package = "xhaz")   # load the data set in the package

fit.phBS &lt;- xhaz(
        formula = Surv(obs_time_year, event) ~ ageCentre + immuno_trt,
        data = dataCancer, ratetable = survexp.fr,
        interval = c(0, NA, NA, max(dataCancer$obs_time_year)),
        rmap = list(age = 'age', sex = 'sexx', year = 'year_date'),
        baseline = "bsplines", pophaz = "classic")


fit.phBS


predicted &lt;- predict(object = fit.phBS,
                     new.data = dataCancer[1:10,],
                     times.pts = c(seq(0,10,1)),
                     baseline = TRUE)



#a list of predicted hazard and survival at different time points
print(predicted)


#predicted hazard and survival at time points 10 years
print(predicted[[10]])


</code></pre>

<hr>
<h2 id='qbs'>qbs function</h2><span id='topic+qbs'></span>

<h3>Description</h3>

<p>a function indicating which covariates have a time-dependent
effect in the formula.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>qbs(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="qbs_+3A_x">x</code></td>
<td>
<p>a covariate to be considered in the <code>xhaz</code> formula with a
time-dependant effect. Quadratic B-splines with two interior knots are used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


library("xhaz")
library("numDeriv")
library("survexp.fr")
library("splines")

fit.tdphBS &lt;- xhaz(
              formula = Surv(obs_time_year, event) ~ ageCentre + qbs(immuno_trt),
              data = dataCancer, ratetable = survexp.fr,
              interval = c(0, NA, NA, max(dataCancer$obs_time_year)),
              rmap = list(age = 'age', sex = 'sexx', year = 'year_date'),
              baseline = "bsplines", pophaz = "classic")

print(fit.tdphBS)


</code></pre>

<hr>
<h2 id='rescaledData'>Simulated data with cause death information with non comparability bias in term of individuals expected hazard</h2><span id='topic+rescaledData'></span>

<h3>Description</h3>

<p>Simulated data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(rescaledData)
</code></pre>


<h3>Format</h3>

<p>This dataset contains the following variables:
</p>

<dl>
<dt>time</dt><dd><p>Follow-up time (months)</p>
</dd>
<dt>status</dt><dd><p>Vital status</p>
</dd>
<dt>age</dt><dd><p>Age at diagnosis</p>
</dd>
<dt>age.c</dt><dd><p>Centred age</p>
</dd>
<dt>sex</dt><dd><p>Sex(Female,Male)</p>
</dd>
<dt>hormTh</dt><dd><p>Treatment group variable</p>
</dd>
<dt>date</dt><dd><p>date of diagnosis</p>
</dd>
</dl>



<h3>References</h3>

<p>Goungounga JA, Touraine C, Graff\'eo N, Giorgi R;
CENSUR working survival group. Correcting for misclassification
and selection effects in estimating net survival in clinical trials.
BMC Med Res Methodol. 2019 May 16;19(1):104.
doi: 10.1186/s12874-019-0747-3. PMID: 31096911; PMCID: PMC6524224.
(<a href="https://pubmed.ncbi.nlm.nih.gov/31096911/">PubMed</a>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(rescaledData)
summary(rescaledData)
</code></pre>

<hr>
<h2 id='simuData'>Simulated data with cause death information in long term follow-up setting without non comparability bias in term of individuals expected hazard</h2><span id='topic+simuData'></span>

<h3>Description</h3>

<p>Simulated data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(simuData)
</code></pre>


<h3>Format</h3>

<p>This dataset contains the following variables:
</p>

<dl>
<dt>age</dt><dd><p>Age at diagnosis</p>
</dd>
<dt>agec</dt><dd><p>Centered age</p>
</dd>
<dt>sex</dt><dd><p>Sex(Female,Male)</p>
</dd>
<dt>race</dt><dd><p>Race</p>
</dd>
<dt>date</dt><dd><p>date of diagnosis.</p>
</dd>
<dt>time</dt><dd><p>Follow-up time (months)</p>
</dd>
<dt>time_year</dt><dd><p>Follow-up time (years)</p>
</dd>
<dt>status</dt><dd><p>Vital status</p>
</dd>
</dl>



<h3>References</h3>

<p>Goungounga JA, Touraine C, Graff\'eo N, Giorgi R;
CENSUR working survival group. Correcting for misclassification
and selection effects in estimating net survival in clinical trials.
BMC Med Res Methodol. 2019 May 16;19(1):104.
doi: 10.1186/s12874-019-0747-3. PMID: 31096911; PMCID: PMC6524224.
(<a href="https://pubmed.ncbi.nlm.nih.gov/31096911/">PubMed</a>)
</p>
<p>Touraine C, Graff\'eo N, Giorgi R; CENSUR working survival group.
More accurate cancer-related excess mortality through correcting
background mortality for extra variables.
Stat Methods Med Res. 2020 Jan;29(1):122-136.
doi: 10.1177/0962280218823234. Epub 2019 Jan 23. PMID: 30674229.
(<a href="https://pubmed.ncbi.nlm.nih.gov/30674229/">PubMed</a>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(simuData)
summary(simuData)
</code></pre>

<hr>
<h2 id='summary.bsplines'>A summary.bsplines Function used to print a object of class <code>bsplines</code></h2><span id='topic+summary.bsplines'></span>

<h3>Description</h3>

<p>This function present the estimated coefficients for the excess
hazard baseline coefficient and for the covariate effects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bsplines'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.bsplines_+3A_object">object</code></td>
<td>
<p>an object of class <code>bsplines</code></p>
</td></tr>
<tr><td><code id="summary.bsplines_+3A_...">...</code></td>
<td>
<p>additionnal parameters which can be used in the <code>summary</code>
function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Estimated parameters of the model in different scales for interpretation purposes.
</p>


<h3>References</h3>

<p>Goungounga JA, Touraine C, Graff\'eo N, Giorgi R;
CENSUR working survival group. Correcting for misclassification
and selection effects in estimating net survival in clinical trials.
BMC Med Res Methodol. 2019 May 16;19(1):104.
doi: 10.1186/s12874-019-0747-3. PMID: 31096911; PMCID: PMC6524224.
(<a href="https://pubmed.ncbi.nlm.nih.gov/31096911/">PubMed</a>)
</p>
<p>Touraine C, Graff\'eo N, Giorgi R; CENSUR working survival group.
More accurate cancer-related excess mortality through correcting
background mortality for extra variables.
Stat Methods Med Res. 2020 Jan;29(1):122-136.
doi: 10.1177/0962280218823234. Epub 2019 Jan 23. PMID: 30674229.
(<a href="https://pubmed.ncbi.nlm.nih.gov/30674229/">PubMed</a>)
</p>
<p>Mba RD, Goungounga JA, Graff\'eo N, Giorgi R; CENSUR working survival group.
Correcting inaccurate background mortality in excess hazard models
through breakpoints. BMC Med Res Methodol. 2020 Oct 29;20(1):268.
doi: 10.1186/s12874-020-01139-z. PMID: 33121436; PMCID: PMC7596976.
(<a href="https://pubmed.ncbi.nlm.nih.gov/33121436/">PubMed</a>)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+xhaz">xhaz</a></code>, <code><a href="#topic+summary.bsplines">summary.bsplines</a></code>, <code><a href="#topic+plot.bsplines">plot.bsplines</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

library("xhaz")
library("survival")
library("numDeriv")
library("survexp.fr")
library("splines")

data("dataCancer", package = "xhaz")   # load the data set in the package

fit.phBS &lt;- xhaz(
              formula = Surv(obs_time_year, event) ~ ageCentre + immuno_trt,
              data = dataCancer, ratetable = survexp.fr,
              interval = c(0, NA, NA, max(dataCancer$obs_time_year)),
              rmap = list(age = 'age', sex = 'sexx', year = 'year_date'),
              baseline = "bsplines", pophaz = "classic")

summary(fit.phBS)


</code></pre>

<hr>
<h2 id='summary.constant'>A summary.constant Function used to print a object of class <code>xhaz.constant</code></h2><span id='topic+summary.constant'></span>

<h3>Description</h3>

<p>This function present the estimated coefficients for the excess
hazard baseline coefficient and for the covariate effects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'constant'
summary(object, ci_type = "lognormal", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.constant_+3A_object">object</code></td>
<td>
<p>an object of class xhaz.constant</p>
</td></tr>
<tr><td><code id="summary.constant_+3A_ci_type">ci_type</code></td>
<td>
<p>method for confidence intervals calculation</p>
</td></tr>
<tr><td><code id="summary.constant_+3A_...">...</code></td>
<td>
<p>additionnal parameters which can be used in the <code>print</code>
function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Estimated parameters of the model in different scales for interpretation purposes.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+xhaz">xhaz</a></code>, <code><a href="#topic+summary.constant">summary.constant</a></code>, <code><a href="#topic+print.bsplines">print.bsplines</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library("xhaz")
library("numDeriv")
data("simuData", package = "xhaz")    # load the data sets 'simuData'

# Esteve et al. model: baseline excess hazard is a piecewise function
#                      linear and proportional effects for the covariates on
#                      baseline excess hazard.


set.seed(1980)
simuData2 &lt;- simuData[sample(nrow(simuData), size = 500), ]

fit.estv2 &lt;- xhaz(formula = Surv(time_year, status) ~ agec + race,
                  data = simuData2,
                  ratetable = survexp.us,
                  interval = c(0, NA, NA, NA, NA, NA, 6),
                  rmap = list(age = 'age', sex = 'sex', year = 'date'),
                  baseline = "constant", pophaz = "classic")





summary(fit.estv2)

</code></pre>

<hr>
<h2 id='xhaz'>xhaz function</h2><span id='topic+xhaz'></span>

<h3>Description</h3>

<p>Fits the excess hazard models proposed by Esteve et al. (1990) <a href="doi:10.1002/sim.4780090506">doi:10.1002/sim.4780090506</a>,
with the possibility to account for time dependent covariates. Fits also the
non-proportional excess hazard model proposed by Giorgi et al. (2005) <a href="doi:10.1002/sim.2400">doi:10.1002/sim.2400</a>.
In addition, fits excess hazard models with possibility to rescale
(Goungounga et al. (2019) <a href="doi:10.1186/s12874-019-0747-3">doi:10.1186/s12874-019-0747-3</a>) or to correct the background mortality with a
proportional (Touraine et al. (2020) <a href="doi:10.1177/0962280218823234">doi:10.1177/0962280218823234</a>) or non-proportional (Mba et al. (2020) <a href="doi:10.1186/s12874-020-01139-z">doi:10.1186/s12874-020-01139-z</a>)
effect.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>xhaz(
  formula = formula(data),
  data = sys.parent(),
  ratetable,
  rmap = list(age = NULL, sex = NULL, year = NULL),
  baseline = c("constant", "bsplines"),
  pophaz = c("classic", "rescaled", "corrected"),
  only_ehazard = FALSE,
  add.rmap = NULL,
  add.rmap.cut = list(breakpoint = FALSE, cut = NA, probs = NULL, criterion = "BIC",
    print_stepwise = FALSE),
  interval,
  ratedata = sys.parent(),
  subset,
  na.action,
  init,
  control = list(eps = 1e-04, iter.max = 800, level = 0.95),
  optim = TRUE,
  scale = 365.2425,
  trace = 0,
  speedy = FALSE,
  nghq = 12,
  method = "L-BFGS-B",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="xhaz_+3A_formula">formula</code></td>
<td>
<p>a formula object of the  function with the response on the left
of a <code>~</code> operator and the terms on the right. The response must be a
survival object as returned by the <code>Surv</code> function (time in first and status
in second).</p>
</td></tr>
<tr><td><code id="xhaz_+3A_data">data</code></td>
<td>
<p>a data frame in which to interpret the variables named in the
formula</p>
</td></tr>
<tr><td><code id="xhaz_+3A_ratetable">ratetable</code></td>
<td>
<p>a rate table stratified by age, sex, year (if missing,
<code>ratedata</code> is used)</p>
</td></tr>
<tr><td><code id="xhaz_+3A_rmap">rmap</code></td>
<td>
<p>a list that maps data set names to the ratetable names.</p>
</td></tr>
<tr><td><code id="xhaz_+3A_baseline">baseline</code></td>
<td>
<p>an argument to specify the baseline hazard: if it follows a
piecewise constant, <code>baseline = "constant"</code> is used and corresponds to
the baseline in Esteve et al. model; if the baseline follows a quadratic b-splines,
<code>baseline = "bsplines"</code>  is used, corresponding to the baseline excess
hazard in Giorgi et al model.</p>
</td></tr>
<tr><td><code id="xhaz_+3A_pophaz">pophaz</code></td>
<td>
<p>indicates three possibles arguments in character: classic or
rescaled and corrected. If <code>pophaz = "classic"</code> chosen, fits the model
that do not require to rescale or to correct the background mortality (i.e. the Esteve
et al. model or Giorgi et al. model); if <code>pophaz = "rescaled"</code>  or
<code>pophaz = "corrected"</code> chosen, fits the models that require to rescale
or to correct the background mortality.</p>
</td></tr>
<tr><td><code id="xhaz_+3A_only_ehazard">only_ehazard</code></td>
<td>
<p>a boolean argument (by default, <code>only_ehazard=FALSE</code>).
If <code>only_ehazard = TRUE</code>, <code>pophaz = "classic"</code> must be provided and
the total value of the log-likelihood will not account for the cumulative population hazard.</p>
</td></tr>
<tr><td><code id="xhaz_+3A_add.rmap">add.rmap</code></td>
<td>
<p>character that indicates the name in character of the additional
demographic variable from <code>data</code> to be used for correction of the life table,
in particular when one is in the presence of an insufficiently stratified life
table (see Touraine et al. model). This argument is not used if
<code>pophaz = "classic"</code> or <code>pophaz = "rescaled"</code>.</p>
</td></tr>
<tr><td><code id="xhaz_+3A_add.rmap.cut">add.rmap.cut</code></td>
<td>
<p>a list containing arguments to specify the modeling
strategy for breakpoint positions, which allows a non-proportional effect of
the correction term acting on the background mortality. By default
<code>list(breakpoint = FALSE)</code>, i.e. a proportional effect of the correction
term acting on the background mortality is needed; in this case, all the other
argument of the list are not working for the model specification;
</p>
<p>if <code>list(breakpoint = TRUE, cut = c(70))</code>, the chosen cut-point(s) is (are)
the numeric value(s) proposed. If <code>list(breakpoint = TRUE, cut = NA)</code>,
there is the same number of breakpoints as the number of NA, with their possible
positions specified as here by <code>probs</code>,
i.e. <code>list(breakpoint = TRUE, cut = NA, probs = seq(0, 1, 0.25))</code>.
That corresponds to a numeric vector of probabilities with values between 0 and 1
as in <code>quantile</code> function.
<code>criterion</code> is used to choose the best model, using the AIC or the
BIC (the default criterion). If needed, all the fitted models are printed
by the user by adding in the list <code>print_stepwise = FALSE</code>.</p>
</td></tr>
<tr><td><code id="xhaz_+3A_interval">interval</code></td>
<td>
<p>a vector indicating either the location of the year-scale time
intervals for models with piecewise constant function, or the location of the
knots for models with B-splines functions for their baseline hazard (see the
appropriate specification in <code>baseline</code> argument). The first component of
the vector is 0, and the last one corresponds to the maximum time fellow-up of the study.</p>
</td></tr>
<tr><td><code id="xhaz_+3A_ratedata">ratedata</code></td>
<td>
<p>a data frame of the hazards mortality in general population.</p>
</td></tr>
<tr><td><code id="xhaz_+3A_subset">subset</code></td>
<td>
<p>an expression indicating which subset of the data should be used
in the modeling. All observations are included by default</p>
</td></tr>
<tr><td><code id="xhaz_+3A_na.action">na.action</code></td>
<td>
<p>as in the <code>coxph</code> function, a missing-data filter function.</p>
</td></tr>
<tr><td><code id="xhaz_+3A_init">init</code></td>
<td>
<p>a list of initial values for the parameters to estimate. For each
elements of the list, give the name of the covariate followed by the vector
of the fixed initials values</p>
</td></tr>
<tr><td><code id="xhaz_+3A_control">control</code></td>
<td>
<p>a list of control values used to control the optimization
process. In this list, <code>eps</code>, is a convergence criteria (by default, <code>eps=10^-4</code>),
<code>iter.max</code> is the  maximum number of iteration (by default, <code>iter.max=15</code>),
and <code>level</code>, is the level used for the confidence intervals (by default, <code>level=0.95</code>).</p>
</td></tr>
<tr><td><code id="xhaz_+3A_optim">optim</code></td>
<td>
<p>a Boolean argument (by default, <code>optim = FALSE</code>).
If <code>optim = TRUE</code>), the maximization algorithm uses the <code>optim</code> function</p>
</td></tr>
<tr><td><code id="xhaz_+3A_scale">scale</code></td>
<td>
<p>a numeric argument to specify whether the life table contains death rates
per day (default <code>scale = 365.2425</code>) or death rates per year (<code>scale = 1</code>).</p>
</td></tr>
<tr><td><code id="xhaz_+3A_trace">trace</code></td>
<td>
<p>a Boolean argument, if <code>trace = TRUE</code>), tracing information
on the progress of the optimization is produced</p>
</td></tr>
<tr><td><code id="xhaz_+3A_speedy">speedy</code></td>
<td>
<p>a Boolean argument, if <code>speedy = TRUE</code>, optimization is done in a
parallel mode</p>
</td></tr>
<tr><td><code id="xhaz_+3A_nghq">nghq</code></td>
<td>
<p>number of nodes and weights for Gaussian quadrature</p>
</td></tr>
<tr><td><code id="xhaz_+3A_method">method</code></td>
<td>
<p>corresponds to <code>optim</code> function argument.</p>
</td></tr>
<tr><td><code id="xhaz_+3A_...">...</code></td>
<td>
<p>other parameters used with the <code>xhaz</code> function</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Use the <code>Surv(time_start, time_stop, status)</code> notation for time
dependent covariate with the appropriate organization of the data set (see
the help page of the <code>Surv</code> function)
</p>
<p>Only two interior knots are possible for the model with B-splines functions
to fit the baseline (excess) hazard. Determination of the intervals might be
user's defined or automatically computed according to the quantile of the
distribution of deaths. Use NA for an automatic determination (for example,
<code>interval = c(0, NA, NA, 5)</code>).
</p>


<h3>Value</h3>

<p>An object of class <code>constant</code> or <code>bsplines</code>,
according to the type of functions chosen to fit the baseline hazard of
model (see details for argument <code>baseline</code>). This object is a list containing
the following components:
</p>
<table role = "presentation">
<tr><td><code>coefficients</code></td>
<td>
<p>estimates found for the model</p>
</td></tr>
<tr><td><code>varcov</code></td>
<td>
<p>the variance-covariance matrix</p>
</td></tr>
<tr><td><code>loglik</code></td>
<td>
<p>for the Estève et al. model: the log-likelihood of the null
model, i.e without covariate, and the log-likelihood of the full model,
i.e with all the covariates declared in the formula; for the Giorgi et al.
model: the log-likelihood of the full model</p>
</td></tr>
<tr><td><code>cov.test</code></td>
<td>
<p>for the Esteve et al.model: the log-likelihood of the null
model, i.e without covariate, and the log-likelihood of the full model,
i.e with all the covariates declared in the formula; for the Giorgi et al.
model: the log-likelihood of the full model</p>
</td></tr>
<tr><td><code>message</code></td>
<td>
<p>a character string returned by the optimizer
see details in <code>optim</code> help page</p>
</td></tr>
<tr><td><code>convergence</code></td>
<td>
<p>an integer code as in <code>optim</code> when <code>"L-BFGS-B"</code> method
is used.</p>
</td></tr>
<tr><td><code>n</code></td>
<td>
<p>the number of individuals in the dataset</p>
</td></tr>
<tr><td><code>n.events</code></td>
<td>
<p>the number of events in the dataset. Event are considered
as death whatever the cause</p>
</td></tr>
<tr><td><code>level</code></td>
<td>
<p>the confidence level used</p>
</td></tr>
<tr><td><code>interval</code></td>
<td>
<p>the intervals used to split time for piecewise baseline excess
hazard, or knots positions for Bsplines baseline</p>
</td></tr>
<tr><td><code>terms</code></td>
<td>
<p>the representation of the terms in the model</p>
</td></tr>
<tr><td><code>call</code></td>
<td>
<p>the function <code>call</code> based on model</p>
</td></tr>
<tr><td><code>pophaz</code></td>
<td>
<p>the assumption considered for the life table used in the
excess hazard model</p>
</td></tr>
<tr><td><code>add.rmap</code></td>
<td>
<p>the additional variable for which the life table is not
stratified</p>
</td></tr>
<tr><td><code>ehazardInt</code></td>
<td>
<p>the cumulative hazard of each individuals calculated from
the ratetable used in the model</p>
</td></tr>
<tr><td><code>ehazard</code></td>
<td>
<p>the individual expected hazard values from the ratetable
used to fit the model</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>the dataset used to run the model</p>
</td></tr>
<tr><td><code>time_elapsed</code></td>
<td>
<p>the time to run the model</p>
</td></tr>
</table>


<h3>Note</h3>

<p><code>time</code> is OBLIGATORY in YEARS.
</p>


<h3>Author(s)</h3>

<p>Juste Goungounga, Darlin Robert Mba, Nathalie Graffeo, Roch Giorgi
</p>


<h3>References</h3>

<p>Goungounga JA, Touraine C, Graff\'eo N, Giorgi R; CENSUR working
survival group. Correcting for misclassification and selection effects in
estimating net survival in clinical trials. BMC Med Res Methodol. 2019 May
16;19(1):104. doi: 10.1186/s12874-019-0747-3. PMID: 31096911; PMCID:
PMC6524224. (<a href="https://pubmed.ncbi.nlm.nih.gov/31096911/">PubMed</a>)
</p>
<p>Touraine C, Graff\'eo N, Giorgi R; CENSUR working survival group. More
accurate cancer-related excess mortality through correcting background
mortality for extra variables. Stat Methods Med Res. 2020 Jan;29(1):122-136.
doi: 10.1177/0962280218823234. Epub 2019 Jan 23. PMID: 30674229.
(<a href="https://pubmed.ncbi.nlm.nih.gov/30674229/">PubMed</a>)
</p>
<p>Mba RD, Goungounga JA, Graff\'eo N, Giorgi R; CENSUR working survival group.
Correcting inaccurate background mortality in excess hazard models through
breakpoints. BMC Med Res Methodol. 2020 Oct 29;20(1):268. doi:
10.1186/s12874-020-01139-z. PMID: 33121436; PMCID: PMC7596976.
(<a href="https://pubmed.ncbi.nlm.nih.gov/33121436/">PubMed</a>)
</p>
<p>Giorgi R, Abrahamowicz M, Quantin C, Bolard P, Esteve J, Gouvernet J, Faivre
J. A relative survival regression model using B-spline functions to model
non-proportional hazards. Statistics in Medicine 2003; 22: 2767-84.
(<a href="https://pubmed.ncbi.nlm.nih.gov/12939785/">PubMed</a>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library("numDeriv")
library("survexp.fr")
library("splines")
library("statmod")
data("simuData","rescaledData", "dataCancer")
# load the data sets 'simuData', 'rescaledData' and 'dataCancer'.

# Esteve et al. model: baseline excess hazard is a piecewise function
#                      linear and proportional effects for the covariates on
#                      baseline excess hazard.


fit.estv1 &lt;- xhaz(formula = Surv(time_year, status) ~ agec + race,
                  data = simuData,
                  ratetable = survexp.us,
                  interval = c(0, NA, NA, NA, NA, NA, 6),
                  rmap = list(age = 'age', sex = 'sex', year = 'date'),
                  baseline = "constant", pophaz = "classic")


fit.estv1


# Touraine et al. model: baseline excess hazard is a piecewise function
#                        with a linear and proportional effects for the
#                        covariates on the baseline excess hazard.
# An additionnal cavariate (here race) missing in the life table is
# considered by the model.


fit.corrected1 &lt;- xhaz(formula = Surv(time_year, status) ~ agec + race,
                       data = simuData,
                       ratetable = survexp.us,
                       interval = c(0, NA, NA, NA, NA, NA, 6),
                       rmap = list(age = 'age', sex = 'sex', year = 'date'),
                       baseline = "constant", pophaz = "corrected",
                       add.rmap = "race")



fit.corrected1

# extension of Touraine et al model: baseline excess hazard is a piecewise
# constant function with a linear and proportional effects for the covariates
# on the baseline excess hazard.

# An additionnal cavariate (here race) missing in the life table is
# considered by the model with a breakpoint at 75 years

fit.corrected2 &lt;- xhaz(formula = Surv(time_year, status) ~ agec + race,
                       data = simuData,
                       ratetable = survexp.us,
                       interval = c(0, NA, NA, NA, NA, NA, 6),
                       rmap = list(age = 'age', sex = 'sex', year = 'date'),
                       baseline = "constant", pophaz = "corrected",
                       add.rmap = "race",
                        add.rmap.cut = list(breakpoint = TRUE, cut = 75))



fit.corrected2


#Giorgi et al model: baseline excess hazard is a quadratic Bsplines
#                    function with two interior knots and allow here a
#                    linear and proportional effects for the covariates on
#                    baseline excess hazard.


fitphBS &lt;- xhaz(formula = Surv(time_year, status) ~ agec + race,
                data = simuData,
                ratetable = survexp.us,
                interval = c(0, NA, NA, 6),
                rmap = list(age = 'age', sex = 'sex', year = 'date'),
                baseline = "bsplines", pophaz = "classic")

fitphBS





# Application on `dataCancer`.
#Giorgi et al model: baseline excess hazard is a quadratic Bspline
#                    function with two interior knots and allow here a
#                    linear and proportional effect for the variable
#                    "immuno_trt" plus a non-proportional effect
#                    for the variable "ageCentre" on baseline excess hazard.


fittdphBS &lt;- xhaz(formula = Surv(obs_time_year, event) ~ qbs(ageCentre) + immuno_trt,
                  data = dataCancer,
                  ratetable = survexp.fr,
                  interval = c(0, 0.5, 12, 15),
                  rmap = list(age = 'age', sex = 'sexx', year = 'year_date'),
                  baseline = "bsplines", pophaz = "classic")

fittdphBS




# Application on `rescaledData`.
# rescaled model: baseline excess hazard is a piecewise function with a
# linear and proportional effects for the covariates on baseline excess hazard.

# A scale parameter on the expected mortality of general population is
# considered to account for the non-comparability source of bias.

rescaledData$timeyear &lt;- rescaledData$time/12
rescaledData$agecr &lt;- scale(rescaledData$age, TRUE, TRUE)

fit.res &lt;- xhaz(formula = Surv(timeyear, status) ~ agecr + hormTh,
                data = rescaledData,
                ratetable = survexp.fr,
                interval = c(0, NA, NA, NA, NA, NA, max(rescaledData$timeyear)),
                rmap = list(age = 'age', sex = 'sex', year = 'date'),
                baseline = "constant", pophaz = "rescaled")

 fit.res


</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
