<!DOCTYPE html><html><head><title>Help for package testex</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {testex}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#as.srcref'><p>Convert to srcref</p></a></li>
<li><a href='#deparse_indent'><p>Deparse an expression and indent for pretty-printing</p></a></li>
<li><a href='#deparse_pretty'><p>Deparse pretty</p></a></li>
<li><a href='#file_line_nchar'><p>Return the number of characters in a line of a file</p></a></li>
<li><a href='#get_example_value'><p>Determine which symbol to use by default when testing examples</p></a></li>
<li><a href='#is_r_cmd_check'><p>Test whether currently executing R checks</p></a></li>
<li><a href='#package-file-helpers'><p>Package source file helpers</p></a></li>
<li><a href='#s3_register'><p>Register a method for a suggested dependency</p></a></li>
<li><a href='#split_srcref'><p>Split a Source Reference at specific lines</p></a></li>
<li><a href='#srclocs'><p>Build a source location from a minimal numeric vector</p></a></li>
<li><a href='#srcref_key'><p>Convert a <code>srcref</code> to a <code>character</code> representation</p></a></li>
<li><a href='#srcref_nlines'><p>Determine the number of source code lines of a given srcref</p></a></li>
<li><a href='#string_newline_count'><p>Get String Line Count</p></a></li>
<li><a href='#test_examples_as_testthat'><p>Execute examples from Rd files as <code>testthat</code> tests</p></a></li>
<li><a href='#test_files'><p>Test a list of files</p></a></li>
<li><a href='#testex'><p>A syntactic helper for writing quick and easy example tests</p></a></li>
<li><a href='#testex-options'><p>Cached retrieval of testex options from package DESCRIPTION</p></a></li>
<li><a href='#testex-rd-example-helpers'><p>Rd Example Parsing Helpers</p></a></li>
<li><a href='#testex-roxygen-tags'><p><code>testex</code> <code>roxygen2</code> tags</p></a></li>
<li><a href='#testex-testthat'><p>Support for <code>testthat</code> example expectations</p></a></li>
<li><a href='#use_testex'><p>Add <code>testex</code> tags and configure package to fully use <code>testex</code> features</p></a></li>
<li><a href='#use_testex_as_testthat'><p>Run examples as <code>testthat</code> expectations</p></a></li>
<li><a href='#vlapply'><p><code>vapply</code> shorthand alternatives</p></a></li>
<li><a href='#with_attached'><p>Temporarily attach a namespace</p></a></li>
<li><a href='#wrap_expect_no_error'><p>Wraps an example expression in a <code>testthat</code> expectation to not error</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Add Tests to Examples</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Description:</td>
<td>
    Add tests in-line in examples. Provides standalone functions for
    facilitating easier test writing in Rd files. However, a more familiar
    interface is provided using 'roxygen2' tags. Tools are also provided for
    facilitating package configuration and use with 'testthat'.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/dgkf/testex">https://github.com/dgkf/testex</a>, <a href="https://dgkf.github.io/testex/">https://dgkf.github.io/testex/</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.2.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat, withr, callr, roxygen2, spelling, knitr, rmarkdown</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-04-03 17:31:15 UTC; root</td>
</tr>
<tr>
<td>Author:</td>
<td>Doug Kelkhoff [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Doug Kelkhoff &lt;doug.kelkhoff@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-04-04 17:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='as.srcref'>Convert to <a href="base.html#topic+srcref">srcref</a></h2><span id='topic+as.srcref'></span><span id='topic+as.srcref.character'></span>

<h3>Description</h3>

<p>Convert to <a href="base.html#topic+srcref">srcref</a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as.srcref(x)

## S3 method for class 'character'
as.srcref(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="as.srcref_+3A_x">x</code></td>
<td>
<p>an object to coerce</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <a href="base.html#topic+srcref">srcref</a>
</p>


<h3>Methods (by class)</h3>


<ul>
<li> <p><code>as.srcref(character)</code>: Convert from a <code>srcref_key</code> to a <a href="base.html#topic+srcref">srcref</a> object
</p>
</li></ul>

<hr>
<h2 id='deparse_indent'>Deparse an expression and indent for pretty-printing</h2><span id='topic+deparse_indent'></span>

<h3>Description</h3>

<p>Deparse an expression and indent for pretty-printing
</p>


<h3>Usage</h3>

<pre><code class='language-R'>deparse_indent(x, indent = 0L)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="deparse_indent_+3A_x">x</code></td>
<td>
<p>A <code>code</code> object</p>
</td></tr>
<tr><td><code id="deparse_indent_+3A_indent">indent</code></td>
<td>
<p>An <code>integer</code> number of spaces or a string to prefix each
line of the deparsed output.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An indented version of the deparsed string from <code>x</code>.
</p>

<hr>
<h2 id='deparse_pretty'>Deparse pretty</h2><span id='topic+deparse_pretty'></span>

<h3>Description</h3>

<p>Deparse to a single string with two spaces of indentation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>deparse_pretty(expr)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="deparse_pretty_+3A_expr">expr</code></td>
<td>
<p>An expression to deparse</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A pretty-formatted string representation of <code>expr</code>.
</p>

<hr>
<h2 id='file_line_nchar'>Return the number of characters in a line of a file</h2><span id='topic+file_line_nchar'></span>

<h3>Description</h3>

<p>Return the number of characters in a line of a file
</p>


<h3>Usage</h3>

<pre><code class='language-R'>file_line_nchar(file, line)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="file_line_nchar_+3A_file">file</code></td>
<td>
<p>A file to use as reference</p>
</td></tr>
<tr><td><code id="file_line_nchar_+3A_line">line</code></td>
<td>
<p>A line number to retrieve the length of</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The number of characters in line <code>line</code>.
</p>

<hr>
<h2 id='get_example_value'>Determine which symbol to use by default when testing examples</h2><span id='topic+get_example_value'></span>

<h3>Description</h3>

<p>Determine which symbol to use by default when testing examples
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_example_value()
</code></pre>


<h3>Value</h3>

<p>The value of the last test expression
</p>

<hr>
<h2 id='is_r_cmd_check'>Test whether currently executing R checks</h2><span id='topic+is_r_cmd_check'></span>

<h3>Description</h3>

<p>Test whether currently executing R checks
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_r_cmd_check()
</code></pre>


<h3>Value</h3>

<p>A logical indicating whether <code style="white-space: pre;">&#8288;R CMD check&#8288;</code> is currently running
</p>

<hr>
<h2 id='package-file-helpers'>Package source file helpers</h2><span id='topic+package-file-helpers'></span><span id='topic+find_package_root'></span><span id='topic+find_package_rds'></span><span id='topic+package_desc'></span>

<h3>Description</h3>

<p>Discover specific package related file paths
</p>


<h3>Usage</h3>

<pre><code class='language-R'>find_package_root(path = ".", quiet = FALSE)

find_package_rds(package, path = getwd())

package_desc()
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="package-file-helpers_+3A_path">path</code></td>
<td>
<p>A file path within a package's source code or installation
directory. Only considered if <code>package</code> is missing.</p>
</td></tr>
<tr><td><code id="package-file-helpers_+3A_quiet">quiet</code></td>
<td>
<p>Whether to suppress output</p>
</td></tr>
<tr><td><code id="package-file-helpers_+3A_package">package</code></td>
<td>
<p>A package name</p>
</td></tr>
</table>


<h3>Value</h3>

<p>NULL, invisibly
</p>
<p>A list of package Rd objects, as returned by <code><a href="tools.html#topic+Rdutils">tools::Rd_db()</a></code>
</p>

<hr>
<h2 id='s3_register'>Register a method for a suggested dependency</h2><span id='topic+s3_register'></span>

<h3>Description</h3>

<p>Generally, the recommend way to register an S3 method is to use the
<code>S3Method()</code> namespace directive (often generated automatically by the
<code style="white-space: pre;">&#8288;@export&#8288;</code> <code>roxygen2</code> tag). However, this technique requires that the generic
be in an imported package, and sometimes you want to suggest a package,
and only provide a method when that package is loaded. <code>s3_register()</code>
can be called from your package's <code>.onLoad()</code> to dynamically register
a method only if the generic's package is loaded.
</p>


<h3>Arguments</h3>

<table>
<tr><td><code id="s3_register_+3A_generic">generic</code></td>
<td>
<p>Name of the generic in the form <code>pkg::generic</code>.</p>
</td></tr>
<tr><td><code id="s3_register_+3A_class">class</code></td>
<td>
<p>Name of the class</p>
</td></tr>
<tr><td><code id="s3_register_+3A_method">method</code></td>
<td>
<p>Optionally, the implementation of the method. By default,
this will be found by looking for a function called <code>generic.class</code>
in the package environment.
</p>
<p>Note that providing <code>method</code> can be dangerous if you use
<code>devtools</code>. When the namespace of the method is reloaded by
<code>devtools::load_all()</code>, the function will keep inheriting from
the old namespace. This might cause crashes because of dangling
<code>.Call()</code> pointers.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For R 3.5.0 and later, <code>s3_register()</code> is also useful when demonstrating
class creation in a vignette, since method lookup no longer always involves
the lexical scope. For R 3.6.0 and later, you can achieve a similar effect
by using &quot;delayed method registration&quot;, i.e. placing the following in your
<code>NAMESPACE</code> file:
</p>
<div class="sourceCode"><pre>if (getRversion() &gt;= "3.6.0") {
  S3method(package::generic, class)
}
</pre></div>


<h3>Value</h3>

<p>No return value, called for side-effect of registering an S3
generic.
</p>


<h3>Usage in other packages</h3>

<p>To avoid taking a dependency on <code>vctrs</code>, you copy the source of
<a href="https://github.com/r-lib/vctrs/blob/main/R/register-s3.R"><code>s3_register()</code></a>
into your own package. It is licensed under the permissive
<a href="https://choosealicense.com/licenses/unlicense/"><code>unlicense</code></a> to make it
crystal clear that we're happy for you to do this. There's no need to include
the license or even credit us when using this function.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># A typical use case is to dynamically register tibble/pillar methods
# for your class. That way you avoid creating a hard dependency on packages
# that are not essential, while still providing finer control over
# printing when they are used.

.onLoad &lt;- function(...) {
  s3_register("pillar::pillar_shaft", "vctrs_vctr")
  s3_register("tibble::type_sum", "vctrs_vctr")
}

</code></pre>

<hr>
<h2 id='split_srcref'>Split a Source Reference at specific lines</h2><span id='topic+split_srcref'></span>

<h3>Description</h3>

<p>Split a Source Reference at specific lines
</p>


<h3>Usage</h3>

<pre><code class='language-R'>split_srcref(sr, where)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="split_srcref_+3A_sr">sr</code></td>
<td>
<p>An original <a href="base.html#topic+srcref">srcref</a> object</p>
</td></tr>
<tr><td><code id="split_srcref_+3A_where">where</code></td>
<td>
<p>A numeric vector of line numbers where the <a href="base.html#topic+srcref">srcref</a> should be
split</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of <a href="base.html#topic+srcref">srcref</a>
</p>

<hr>
<h2 id='srclocs'>Build a source location from a minimal numeric vector</h2><span id='topic+srclocs'></span>

<h3>Description</h3>

<p>Build a length four source location from a length two source location. The
starting column on the first line is assumed to be 1, and the final column is
taken to be the length of the line if the source file exists, or 1 as a
fallback.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>srclocs(x, file)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="srclocs_+3A_x">x</code></td>
<td>
<p>A numeric vector of at least length 2</p>
</td></tr>
<tr><td><code id="srclocs_+3A_file">file</code></td>
<td>
<p>A file to use to determine the length of the final line</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector similar to a <code><a href="utils.html#topic+sourceutils">utils::getSrcLocation</a></code> object
</p>

<hr>
<h2 id='srcref_key'>Convert a <code><a href="base.html#topic+srcref">srcref</a></code> to a <code><a href="base.html#topic+character">character</a></code> representation</h2><span id='topic+srcref_key'></span>

<h3>Description</h3>

<p>Convert a <code><a href="base.html#topic+srcref">srcref</a></code> to a <code><a href="base.html#topic+character">character</a></code> representation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>srcref_key(x, nloc = 2, path = c("base", "root", "full"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="srcref_key_+3A_x">x</code></td>
<td>
<p>A <code><a href="base.html#topic+srcref">srcref</a></code> object</p>
</td></tr>
<tr><td><code id="srcref_key_+3A_nloc">nloc</code></td>
<td>
<p>The number of locations (<code><a href="utils.html#topic+sourceutils">utils::getSrcLocation</a></code>) to use.
Defaults to 2, indicating starting and ending line number.</p>
</td></tr>
<tr><td><code id="srcref_key_+3A_path">path</code></td>
<td>
<p>A form of file path to use for the key. One of <code>"base"</code> for only
the basename of the source file path, <code>"root"</code> for a path relative to a
package root directory if found, or <code>"full"</code> for the full file path.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A string hash of a <a href="base.html#topic+srcref">srcref</a>
</p>

<hr>
<h2 id='srcref_nlines'>Determine the number of source code lines of a given <a href="base.html#topic+srcref">srcref</a></h2><span id='topic+srcref_nlines'></span>

<h3>Description</h3>

<p>Determine the number of source code lines of a given <a href="base.html#topic+srcref">srcref</a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>srcref_nlines(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="srcref_nlines_+3A_x">x</code></td>
<td>
<p>A <a href="base.html#topic+srcref">srcref</a> object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The number of lines in the original source of a <a href="base.html#topic+srcref">srcref</a>
</p>

<hr>
<h2 id='string_newline_count'>Get String Line Count</h2><span id='topic+string_newline_count'></span>

<h3>Description</h3>

<p>Get String Line Count
</p>


<h3>Usage</h3>

<pre><code class='language-R'>string_newline_count(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="string_newline_count_+3A_x">x</code></td>
<td>
<p>A character value</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The number of newline characters in a multiline string
</p>

<hr>
<h2 id='test_examples_as_testthat'>Execute examples from Rd files as <code>testthat</code> tests</h2><span id='topic+test_examples_as_testthat'></span>

<h3>Description</h3>

<p>Reads examples from Rd files and constructs <code>testthat</code>-style tests.
<code>testthat</code> expectations are built such that
</p>


<h3>Usage</h3>

<pre><code class='language-R'>test_examples_as_testthat(
  package,
  path,
  ...,
  test_dir = tempfile("testex"),
  clean = TRUE,
  overwrite = TRUE,
  reporter = testthat::get_reporter()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="test_examples_as_testthat_+3A_package">package</code></td>
<td>
<p>A package name whose examples should be tested</p>
</td></tr>
<tr><td><code id="test_examples_as_testthat_+3A_path">path</code></td>
<td>
<p>Optionally, a path to a source code directory to use. Will only
have an effect if parameter <code>package</code> is missing.</p>
</td></tr>
<tr><td><code id="test_examples_as_testthat_+3A_...">...</code></td>
<td>
<p>Additional argument unused</p>
</td></tr>
<tr><td><code id="test_examples_as_testthat_+3A_test_dir">test_dir</code></td>
<td>
<p>An option directory where test files should be written.
Defaults to a temporary directory.</p>
</td></tr>
<tr><td><code id="test_examples_as_testthat_+3A_clean">clean</code></td>
<td>
<p>Whether the <code>test_dir</code> should be removed upon completion of test
execution. Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="test_examples_as_testthat_+3A_overwrite">overwrite</code></td>
<td>
<p>Whether files should be overwritten if <code>test_dir</code> already
exists. Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="test_examples_as_testthat_+3A_reporter">reporter</code></td>
<td>
<p>A <code>testthat</code> reporter to use. Defaults to the active
reporter in the <code>testthat</code> environment or default reporter.</p>
</td></tr>
</table>


<h3>Details</h3>


<ol>
<li><p> Each example expression is expected to run without error
</p>
</li>
<li><p> Any <code>testex</code> expectations are expected to pass
</p>
</li></ol>

<p>Generally, you won't need to use this function directly. Instead, it
is called by a file generated by <code><a href="#topic+use_testex_as_testthat">use_testex_as_testthat()</a></code> which will add
any <code>testex</code> example tests to your existing <code>testthat</code> testing suite.
</p>


<h3>Value</h3>

<p>The result of <code><a href="testthat.html#topic+source_file">testthat::source_file()</a></code>, after iterating over
generated test files.
</p>


<h3>Note</h3>

<p>It is assumed that this function is used within a <code>testthat</code> run, when
the necessary packages are already installed and loaded.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

# library(pkg.example)
path &lt;- system.file("pkg.example", package = "testex")
test_examples_as_testthat(path = path)


</code></pre>

<hr>
<h2 id='test_files'>Test a list of files</h2><span id='topic+test_files'></span>

<h3>Description</h3>

<p>Test a list of files
</p>


<h3>Usage</h3>

<pre><code class='language-R'>test_files(files, context, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="test_files_+3A_files">files</code></td>
<td>
<p>A collection of file paths to test</p>
</td></tr>
<tr><td><code id="test_files_+3A_context">context</code></td>
<td>
<p>An optional context message to display in <code>testthat</code> reporters</p>
</td></tr>
<tr><td><code id="test_files_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code>testhat::source_file</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>The result of <code><a href="testthat.html#topic+source_file">testthat::source_file()</a></code>, after iterating over
generated test files.
</p>

<hr>
<h2 id='testex'>A syntactic helper for writing quick and easy example tests</h2><span id='topic+testex'></span>

<h3>Description</h3>

<p>A wrapper around <code>stopifnot</code> that allows you to use <code>.</code> to refer to
<code>.Last.value</code> and preserve the last non-test output from an example.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>testex(
  ...,
  value = get_example_value(),
  obj = NULL,
  example = NULL,
  tests = NULL,
  envir = parent.frame()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="testex_+3A_...">...</code></td>
<td>
<p>Expressions to evaluated. <code>.</code> will be replaced with the
expression passed to <code>val</code>, and may be used as a shorthand for the
last example result.</p>
</td></tr>
<tr><td><code id="testex_+3A_value">value</code></td>
<td>
<p>A value to test against. By default, this will use the example's
<code>.Last.value</code>.</p>
</td></tr>
<tr><td><code id="testex_+3A_obj">obj</code></td>
<td>
<p>An optional object name used to construct a more helpful error
message <code>testthat</code> failure message.</p>
</td></tr>
<tr><td><code id="testex_+3A_example">example</code></td>
<td>
<p>An option <code>srcref_key</code> string used to indicate where the
relevant example code originated from.</p>
</td></tr>
<tr><td><code id="testex_+3A_tests">tests</code></td>
<td>
<p>An option <code>srcref_key</code> string used to indicate where the
relevant test code originated from.</p>
</td></tr>
<tr><td><code id="testex_+3A_envir">envir</code></td>
<td>
<p>An environment in which tests should be evaluated. By default
the parent environment where tests are evaluated.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisibly returns the <code>.Last.value</code> as it existed prior to evaluating
the test.
</p>


<h3>Documenting with <code>testex</code></h3>

<p><code>testex</code> is a simple wrapper around execution that propagates the
<code>.Last.value</code> returned before running, allowing you to chain tests
more easily.
</p>


<h4>Use in <code>Rd</code> files:</h4>

<pre>
\examples{
  f &lt;- function(a, b) a + b
  f(3, 4)
  \testonly{
    testex::testex(
      is.numeric(.),
      identical(., 7)
    )
  }
}
</pre>
<p>But <code>Rd</code> files are generally regarded as being a bit cumbersome to author
directly. Instead, <code>testex</code> provide helpers that generate this style of
documentation, which use this function internally.
</p>



<h4>Use with <code>roxygen2</code></h4>

<p>Within a <code>roxygen2</code> <code style="white-space: pre;">&#8288;@examples&#8288;</code> block you can instead use the <code style="white-space: pre;">&#8288;@test&#8288;</code> tag
which will generate Rd code as shown above.
</p>
<pre>
#' @examples
#' f &lt;- function(a, b) a + b
#' f(3, 4)
#' @test is.numeric(.)
#' @test identical(., 7)
</pre>


<hr>
<h2 id='testex-options'>Cached retrieval of testex options from package DESCRIPTION</h2><span id='topic+testex-options'></span><span id='topic+update_testex_desc'></span><span id='topic+testex_options'></span>

<h3>Description</h3>

<p>As long as the <code>fingerprint</code> has not changed, the package <code>DESCRIPTION</code> will
be read only once to parse and retrieve configuration options. If the
<code>DESCRIPTION</code> file is modified or if run from a separate process, the
configured settings will be refreshed based on the most recent version of
the file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>update_testex_desc(path, fingerprint)

testex_options(path = package_desc())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="testex-options_+3A_path">path</code></td>
<td>
<p>A path in which to search for a package <code>DESCRIPTION</code></p>
</td></tr>
<tr><td><code id="testex-options_+3A_fingerprint">fingerprint</code></td>
<td>
<p>An object used to indicate when the cached values have
been invalidated</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The test options environment, invisibly.
</p>
<p>The test options environment as a list
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>testex_options()</code>: 
</p>
</li></ul>

<hr>
<h2 id='testex-rd-example-helpers'>Rd Example Parsing Helpers</h2><span id='topic+testex-rd-example-helpers'></span><span id='topic+rd_extract_examples'></span><span id='topic+rd_code_as_string'></span><span id='topic+split_testonly_as_expr'></span><span id='topic+split_testonly'></span>

<h3>Description</h3>

<p>Rd Example Parsing Helpers
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rd_extract_examples(rd)

rd_code_as_string(rd)

split_testonly_as_expr(rd)

split_testonly(rd)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="testex-rd-example-helpers_+3A_rd">rd</code></td>
<td>
<p>An Rd object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The examples section of an Rd object
</p>
<p>A formatted Rd example
</p>
<p>An interlaced list of expressions, either representing example
code or tests. The names of the list are either <code style="white-space: pre;">&#8288;\testonly&#8288;</code> or <code>RDCODE</code>
depending on the originating source of the expression.
</p>
<p>A list of Rd tag contents
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>rd_extract_examples()</code>: Extract examples tag from an Rd file
</p>
</li>
<li> <p><code>rd_code_as_string()</code>: Convert an Rd example to string
</p>
</li>
<li> <p><code>split_testonly_as_expr()</code>: Split sections of an example into evaluated example code blocks and code
blocks wrapped in <code style="white-space: pre;">&#8288;\testonly&#8288;</code> <code>Rd_tag</code>s, reassigning <code><a href="base.html#topic+srcref">srcref</a></code>s as the
example code is split.
</p>
</li>
<li> <p><code>split_testonly()</code>: Split sections of an example into lists of <code>Rd_tag</code>s. Note that <code><a href="base.html#topic+srcref">srcref</a></code>s
are split by line number. If a line is split between two sections, it is
attributed to the first section. As this is used primarily for giving line
numbers to test messages, this is sufficient for providing test failures
locations.
</p>
</li></ul>

<hr>
<h2 id='testex-roxygen-tags'><code><a href="#topic+testex">testex</a></code> <code>roxygen2</code> tags</h2><span id='topic+testex-roxygen-tags'></span>

<h3>Description</h3>

<p><code><a href="#topic+testex">testex</a></code> provides two new <code>roxygen2</code> tags, <code style="white-space: pre;">&#8288;@test&#8288;</code> and <code style="white-space: pre;">&#8288;@testthat&#8288;</code>.
</p>


<h3>tags</h3>

<p><a href="#topic+testex">testex</a> tags are all sub-tags meant to be used within an
<code style="white-space: pre;">&#8288;@examples&#8288;</code> block. They should be considered as tags <em>within</em> the
<code style="white-space: pre;">&#8288;@examples&#8288;</code> block and used to construct blocks of testing code within
example code.
</p>

<dl>
<dt><code style="white-space: pre;">&#8288;@test&#8288;</code>: </dt><dd>
<p>In-line expectations to test the output of the previous command within an
example. If <code>.</code> is used within the test expression, it will be used to
refer to the output of the previous example command. Otherwise, the
result of the expression is expected to be identical to the previous
output.
</p>
<div class="sourceCode"><pre>#' @examples
#' 1 + 2
#' @test 3
#' @test . == 3
#'
#' @examples
#' 3 + 4
#' @test identical(., 7)
</pre></div>
</dd>
</dl>


<dl>
<dt><code style="white-space: pre;">&#8288;@testthat&#8288;</code>: </dt><dd>
<p>Similar to <code style="white-space: pre;">&#8288;@test&#8288;</code>, <code style="white-space: pre;">&#8288;@testthat&#8288;</code> can be used to make in-line
assertions using <code>testthat</code> expectations. <code>testthat</code> expectations
follow a convention where the first argument is an object to compare
against an expected value or characteristic. Since the value will always
be the result of the previous example, this part of the code is
implicitly constructed for you.
</p>
<p>If you want to use the example result elsewhere in your expectation, you
can refer to it with a <code>.</code>. When used in this way, <a href="#topic+testex">testex</a> will
not do any further implicit modification of your expectation.
</p>
<div class="sourceCode"><pre>#' @examples
#' 1 + 2
#' @testthat expect_equal(3)
#' @testthat expect_gt(0)
#'
#' @examples
#' 3 + 4
#' @testthat expect_equal(., 7)
</pre></div>
</dd>
</dl>


<hr>
<h2 id='testex-testthat'>Support for <code>testthat</code> example expectations</h2><span id='topic+testex-testthat'></span><span id='topic+testthat_block'></span><span id='topic+with_srcref'></span><span id='topic+fallback_expect_no_error'></span>

<h3>Description</h3>

<p>Various functions that are used to produce a more native <code>testthat</code>
experience, automatically converting <a href="#topic+testex">testex</a> tests into <code>testthat</code> code and
executing tests such that they produce informative messages on failure.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>testthat_block(
  ...,
  value = get_example_value(),
  obj = NULL,
  example = NULL,
  tests = NULL,
  envir = parent.frame()
)

with_srcref(src, expr, envir = parent.frame())

fallback_expect_no_error(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="testex-testthat_+3A_...">...</code></td>
<td>
<p>Additional arguments unused</p>
</td></tr>
<tr><td><code id="testex-testthat_+3A_value">value</code></td>
<td>
<p>A symbol or quote to use to refer to the subject of <code>testthat</code>
tests.</p>
</td></tr>
<tr><td><code id="testex-testthat_+3A_obj">obj</code></td>
<td>
<p>An optional object name used to construct a more helpful error
message <code>testthat</code> failure message.</p>
</td></tr>
<tr><td><code id="testex-testthat_+3A_example">example</code></td>
<td>
<p>An option <code>srcref_key</code> string used to indicate where the
relevant example code originated from.</p>
</td></tr>
<tr><td><code id="testex-testthat_+3A_tests">tests</code></td>
<td>
<p>An option <code>srcref_key</code> string used to indicate where the
relevant test code originated from.</p>
</td></tr>
<tr><td><code id="testex-testthat_+3A_envir">envir</code></td>
<td>
<p>An environment in which the expectations should be evaluated</p>
</td></tr>
<tr><td><code id="testex-testthat_+3A_src">src</code></td>
<td>
<p>A <code>srcref_key</code> which is parsed to produce an artificial <code><a href="base.html#topic+srcref">srcref</a></code>
for the expectation signaled messages.</p>
</td></tr>
<tr><td><code id="testex-testthat_+3A_expr">expr</code></td>
<td>
<p>An expression to be evaluated. If an <code>expectation</code> condition is
raised during its evaluation, its <code><a href="base.html#topic+srcref">srcref</a></code> is converted to <code>src</code>.</p>
</td></tr>
<tr><td><code id="testex-testthat_+3A_object">object</code></td>
<td>
<p>An expression to evaluate</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="#topic+testex">testex</a> operates on the previous value produced in example code. This is
unlike <code>testthat</code> expectations, which expect a value to be provided as a
first argument.
</p>
<p>To accommodate a more native <code>testthat</code> interface, <a href="#topic+testex">testex</a> provides a few
convenience functions to make <a href="#topic+testex">testex</a> expectations run more idiomatically
in the style of <code>testthat</code>.
</p>


<h3>Value</h3>

<p>The result of evaluating provided expressions
</p>
<p>The result of evaluating <code>expr</code>, or an expectation with appended
<code><a href="base.html#topic+srcref">srcref</a></code> information if an expectation is raised.
</p>
<p>The value produced by the expectation code
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>testthat_block()</code>: A flavor of <a href="#topic+testex">testex</a> that will inject <a href="base.html#topic+.Last.value">.Last.value</a> into the first argument
of each expression - suitable for using the <code style="white-space: pre;">&#8288;expect_*&#8288;</code> family of functions
from <code>testthat</code>. Also handles temporarily attaching the <code>testthat</code> package.
</p>
</li>
<li> <p><code>with_srcref()</code>: Retroactively assigns a source file and location to a expectation. This
allows <code>testthat</code> to report an origin for any code that raised an example
test failure from the source <code>roxygen2</code> code, even though the test code is
reconstructed from package documentation files.
</p>
</li>
<li> <p><code>fallback_expect_no_error()</code>: A <code>testthat</code> expectation that the provided code can be evaluated without
producing an error. This is the most basic expectation one should expect of
any example code. Further expectations are provided in subsequent <code>testthat</code>
code.
</p>
</li></ul>


<h3>Examples</h3>

<pre><code class='language-R'>
# example code
1 + 2

# within `testthat_block`, test code refers to previous result with `.`
testthat_block({ 
  test_that("addition holds up", {
    expect_equal(., 3)
  })

  # `with_srcref` to spoof the source of the code that caused the failure
  test_that("test failure is spoofed to report error at abc.R:1:0", {
    with_srcref("abc.R:1:3", expect_equal(., 3))
  })
})

</code></pre>

<hr>
<h2 id='use_testex'>Add <code><a href="#topic+testex">testex</a></code> tags and configure package to fully use <code><a href="#topic+testex">testex</a></code> features</h2><span id='topic+use_testex'></span>

<h3>Description</h3>

<p>Add <code><a href="#topic+testex">testex</a></code> tags and configure package to fully use <code><a href="#topic+testex">testex</a></code> features
</p>


<h3>Usage</h3>

<pre><code class='language-R'>use_testex(path = getwd(), check = TRUE, quiet = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="use_testex_+3A_path">path</code></td>
<td>
<p>A package source code working directory</p>
</td></tr>
<tr><td><code id="use_testex_+3A_check">check</code></td>
<td>
<p>A <code>logical</code> value indicating whether tests should be
executing during <code style="white-space: pre;">&#8288;R CMD check&#8288;</code>.</p>
</td></tr>
<tr><td><code id="use_testex_+3A_quiet">quiet</code></td>
<td>
<p>Whether output should be suppressed</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The result of <code><a href="base.html#topic+write.dcf">write.dcf()</a></code> upon modifying the package
<code>DESCRIPTION</code> file.
</p>


<h3>Note</h3>

<p>The <code><a href="#topic+testex">testex</a></code> <code>roxygen2</code> tags behave similarly to <code>roxygen2</code> <code style="white-space: pre;">&#8288;@examples&#8288;</code>
tags, with the minor addition of some wrapping code to manage the tests. This
means that they will be integrated into your <code style="white-space: pre;">&#8288;@examples&#8288;</code> and can be
intermixed between <code style="white-space: pre;">&#8288;@examples&#8288;</code> tags
</p>

<hr>
<h2 id='use_testex_as_testthat'>Run examples as <code>testthat</code> expectations</h2><span id='topic+use_testex_as_testthat'></span>

<h3>Description</h3>

<p>Run examples as <code>testthat</code> expectations
</p>


<h3>Usage</h3>

<pre><code class='language-R'>use_testex_as_testthat(path = getwd(), context = "testex", quiet = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="use_testex_as_testthat_+3A_path">path</code></td>
<td>
<p>A package source code working directory</p>
</td></tr>
<tr><td><code id="use_testex_as_testthat_+3A_context">context</code></td>
<td>
<p>A <code>testthat</code> test context to use as the basis for a new test
filename.</p>
</td></tr>
<tr><td><code id="use_testex_as_testthat_+3A_quiet">quiet</code></td>
<td>
<p>Whether to emit output messages.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The result of <code><a href="base.html#topic+writeLines">writeLines()</a></code> after writing a new <code>testthat</code> file.
</p>

<hr>
<h2 id='vlapply'><code>vapply</code> shorthand alternatives</h2><span id='topic+vlapply'></span><span id='topic+vcapply'></span><span id='topic+vnapply'></span>

<h3>Description</h3>

<p>Simple wrappers around <code>vapply</code> for common data types
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vlapply(..., FUN.VALUE = logical(1L))

vcapply(..., FUN.VALUE = character(1L))

vnapply(..., FUN.VALUE = numeric(1L))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vlapply_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code><a href="base.html#topic+vapply">vapply</a></code></p>
</td></tr>
<tr><td><code id="vlapply_+3A_fun.value">FUN.VALUE</code></td>
<td>
<p>A preset signature for the flavor of <code><a href="base.html#topic+vapply">vapply</a></code>. This is
exposed for transparency, but modifying it would break the implicit
contract in the function name about the return type.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The result of <code><a href="base.html#topic+vapply">vapply</a></code>
</p>

<hr>
<h2 id='with_attached'>Temporarily attach a namespace</h2><span id='topic+with_attached'></span>

<h3>Description</h3>

<p>This function is primarily for managing attaching of namespaces needed for
testing internally. It is exported only because it is needed in code
generated within <code>Rd</code> files, but is otherwise unlikely to be needed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_attached(ns, expr)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="with_attached_+3A_ns">ns</code></td>
<td>
<p>A namespace or namespace name to attach</p>
</td></tr>
<tr><td><code id="with_attached_+3A_expr">expr</code></td>
<td>
<p>An expression to evaluate while the namespace is attached</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The result of evaluating <code>expr</code>
</p>

<hr>
<h2 id='wrap_expect_no_error'>Wraps an example expression in a <code>testthat</code> expectation to not error</h2><span id='topic+wrap_expect_no_error'></span>

<h3>Description</h3>

<p>Wraps an example expression in a <code>testthat</code> expectation to not error
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wrap_expect_no_error(expr, value)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="wrap_expect_no_error_+3A_expr">expr</code></td>
<td>
<p>An expression to wrap in a <code>expect_no_error()</code> expectation. Uses
<code>testthat</code>s version if recent enough version is available, or provides
a fallback otherwise.</p>
</td></tr>
<tr><td><code id="wrap_expect_no_error_+3A_value">value</code></td>
<td>
<p>A symbol to use to store the result of <code>expr</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code><a href="testthat.html#topic+test_that">testthat::test_that()</a></code> call
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
