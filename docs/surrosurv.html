<!DOCTYPE html><html><head><title>Help for package surrosurv</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {surrosurv}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#convergence'>
<p>Assesses the convergence of fitted models for surrogacy evaluation</p></a></li>
<li><a href='#gastadj'><p>Individual data from the adjuvant GASTRIC meta-analysis</p></a></li>
<li><a href='#gastadv'><p>Individual data from the advanced GASTRIC meta-analysis</p></a></li>
<li><a href='#loocv'>
<p>Leave-one-trial-out cross-validation for treatment effect prediction</p></a></li>
<li><a href='#poissonize'>
<p>Transform survival data for fitting a Poisson model</p></a></li>
<li><a href='#simData'>
<p>Generate survival times for two endpoints in a meta-analysis of randomized trials</p></a></li>
<li><a href='#ste'>
<p>Surrogate threshold effect</p></a></li>
<li><a href='#surrosurv'>
<p>Fit and print the models for evaluating the surrogacy strength</p>
of a candidate surrogate endpoint</a></li>
<li><a href='#surrosurv-package'>
<p>Evaluation of Failure Time Surrogate Endpoints in Individual Patient Data</p>
Meta-Analyses</a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Evaluation of Failure Time Surrogate Endpoints in Individual
Patient Data Meta-Analyses</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1.26</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Dan Chaltiel &lt;dan.chaltiel@gustaveroussy.fr&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides functions for the evaluation of
    surrogate endpoints when both the surrogate and the true endpoint are failure
    time variables. The approaches implemented are:
    (1) the two-step approach (Burzykowski et al, 2001) &lt;<a href="https://doi.org/10.1111%2F1467-9876.00244">doi:10.1111/1467-9876.00244</a>&gt; with a copula model (Clayton, Plackett, Hougaard) at
    the first step and either a linear regression of log-hazard ratios at the second
    step (either adjusted or not for measurement error);
    (2) mixed proportional hazard models estimated via mixed Poisson GLM
    (Rotolo et al, 2017 &lt;<a href="https://doi.org/10.1177%2F0962280217718582">doi:10.1177/0962280217718582</a>&gt;).</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>copula, eha, grDevices, lme4, MASS, Matrix, msm, mvmeta,
optimx, parallel, parfm, stats, survival</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/Oncostat/surrosurv">https://github.com/Oncostat/surrosurv</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/Oncostat/surrosurv/issues/">https://github.com/Oncostat/surrosurv/issues/</a></td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>R.rsp</td>
</tr>
<tr>
<td>Suggests:</td>
<td>R.rsp, testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-04-13 07:54:04 UTC; Dan</td>
</tr>
<tr>
<td>Author:</td>
<td>Federico Rotolo <a href="https://orcid.org/0000-0003-4837-6501"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Xavier Paoletti [ctb],
  Marc Buyse [ctb],
  Tomasz Burzykowski [ctb],
  Stefan Michiels <a href="https://orcid.org/0000-0002-6963-2968"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Dan Chaltiel <a href="https://orcid.org/0000-0003-3488-779X"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [cre]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-04-14 08:50:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='convergence'>
Assesses the convergence of fitted models for surrogacy evaluation
</h2><span id='topic+convergence'></span><span id='topic+convergence.surrosurv'></span><span id='topic+convals'></span><span id='topic+convals.surrosurv'></span>

<h3>Description</h3>

<p>This function evaluates whether the fitted models for evaluating 
the surrogacy of a candidate endpoint have converged.
Convergence is assessed by checking whether the maximum gradient is small enough,
and whether the Hessian matrix
and the variance-covariance matrix of random treatment effects
are positive definite.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  ## S3 method for class 'surrosurv'
convals(x, ...)
  ## S3 method for class 'surrosurv'
convergence(x, kkttol = 1e-2, kkt2tol = 1e-8, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="convergence_+3A_x">x</code></td>
<td>

<p>The fitted models, an object of class <code><a href="#topic+surrosurv">surrosurv</a></code>.
</p>
</td></tr>
<tr><td><code id="convergence_+3A_kkttol">kkttol</code></td>
<td>

<p>The tolerance threshold for the assessing whether
the maximum (absolute) scaled gradient is small enough.
</p>
</td></tr>
<tr><td><code id="convergence_+3A_kkt2tol">kkt2tol</code></td>
<td>

<p>The tolerance threshold for checking whether
the Hessian matrix and
the variance-covariance matrix of random treatment effects
are positive definite.
The threshold is for the minimum of the eigenvalues.
</p>
</td></tr>
<tr><td><code id="convergence_+3A_...">...</code></td>
<td>

<p>Further parameters (not implemented)
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The function <code>convals()</code> returns a matrix with one row per model and three columns,
reporting the values of the maximum scaled gradient (<code>maxSgrad</code>), 
of the minimum eigenvalue of the Hessian matrix (<code>minHev</code>), and
of the minimum eigenvalue of the estimated variance-covariance matrix
of random treatment effects (<code>minREev</code>).
The function <code>convergence()</code> returns a matrix with the same structure as <code>convals()</code>,
with <code>TRUE</code>/<code>FALSE</code> values for the test of the results of <code>convals()</code>
against the given thresholds <code>kkttol</code> and <code>kkt2tol</code>.
</p>


<h3>Author(s)</h3>

<p>NA
</p>

<hr>
<h2 id='gastadj'>Individual data from the adjuvant GASTRIC meta-analysis</h2><span id='topic+gastadj'></span>

<h3>Description</h3>

<p>The <code>gastadj</code> dataset contains individual data
(overall and disease-free survival)
of 3288 patients with resectable gastric cancer
from 14 randomized trials of adjuvant chemotherapy.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(gastadj)</code></pre>


<h3>Format</h3>

<p>A dataframe with variables:
</p>

<dl>
<dt>timeT:</dt><dd><p>Overall survival time (days).</p>
</dd>
<dt>statusT:</dt><dd><p>Overall survival indicator (0=censored, 1=death).</p>
</dd>
<dt>timeS:</dt><dd><p>Disease-free survival time (days).</p>
</dd>
<dt>statusS:</dt><dd><p>Disease-free survival indicator (0=censored, 1=progression on death).</p>
</dd>
<dt>trialref:</dt><dd><p>Trial indicator</p>
</dd>
<dt>trt:</dt><dd><p>Treatment arm (-0.5 = control, 0.5=chemotherapy).</p>
</dd>
<dt>id:</dt><dd><p>Patient identifier.</p>
</dd>
</dl>



<h3>Source</h3>

<p>The authors thank the GASTRIC
(Global Advanced/Adjuvant Stomach Tumor Research International Collaboration)
Group for permission to use their data.
The investigators who contributed to GASTRIC are listed in 
Oba et al (2013) and GASTRIC (2010).
The GASTRIC Group data are available within the <code>surrosurv</code> package
for research purposes, under the conditions that
(1) the research be scientifically appropriate,
(2) the confidentiality of individual patient data be protected,
(3) the results of the analyses be shared with the GASTRIC Group prior to public communication,
(4) the source of data be fully acknowledged as above, and
(5) resulting data and results be further shared with the research community.
</p>


<h3>References</h3>

<p>Paoletti X, Oba K, Bang Y-J, et al.
Disease-free survival as a surrogate for overall survival in adjuvant trials
of gastric cancer: a meta-analysis.
<em>J Ntl Cancer Inst</em>, 105(21):1600-7, 2013.
doi: <a href="https://doi.org/10.1093/jnci/djt270">10.1093/jnci/djt270</a>.
</p>
<p>The GASTRIC group.
Benefit of adjuvant chemotherapy for resectable gastric cancer:
a meta-analysis. 
<em>JAMA</em>, 303(17):1729-37, 2010.
doi: <a href="https://doi.org/10.1001/jama.2010.534">10.1001/jama.2010.534</a>.
</p>
<p>Buyse M, Molenberghs G, Paoletti Xavier et al.
Statistical evaluation of surrogate endpoints
with examples from cancer clinical trials.
<em>Biom J</em>, 58(1):104-32, 2016.
doi: <a href="https://doi.org/10.1002/bimj.201400049">10.1002/bimj.201400049</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  ## Not run: 
    data('gastadj')
    allSurroRes &lt;- surrosurv(gastadj, c('Clayton', 'PoissonTIa'), verbose = TRUE)
    convergence(allSurroRes)
    allSurroRes
    predict(allSurroRes)
    plot(allSurroRes)
  
## End(Not run)
</code></pre>

<hr>
<h2 id='gastadv'>Individual data from the advanced GASTRIC meta-analysis</h2><span id='topic+gastadv'></span>

<h3>Description</h3>

<p>The <code>gastadv</code> dataset contains individual data
(overall and progression-free survival)
of 4069 patients with advanced/recurrent gastric cancer
from 20 randomized trials of chemotherapy.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(gastadv)</code></pre>


<h3>Format</h3>

<p>A dataframe with variables:
</p>

<dl>
<dt>timeT:</dt><dd><p>Overall survival time (days).</p>
</dd>
<dt>statusT:</dt><dd><p>Overall survival indicator (0=censored, 1=death).</p>
</dd>
<dt>timeS:</dt><dd><p>Progression-free survival time (days).</p>
</dd>
<dt>statusS:</dt><dd><p>Progression-free survival indicator (0=censored, 1=progression on death).</p>
</dd>
<dt>trialref:</dt><dd><p>Trial indicator</p>
</dd>
<dt>trt:</dt><dd><p>Treatment arm (-0.5 = control, 0.5=chemotherapy).</p>
</dd>
<dt>id:</dt><dd><p>Patient identifier.</p>
</dd>
</dl>



<h3>Source</h3>

<p>The authors thank the GASTRIC
(Global Advanced/Adjuvant Stomach Tumor Research International Collaboration)
Group for permission to use their data.
The investigators who contributed to GASTRIC are listed in 
Paoletti et al (2013) and GASTRIC (2013).
The GASTRIC Group data are available within the <code>surrosurv</code> package
for research purposes, under the conditions that
(1) the research be scientifically appropriate,
(2) the confidentiality of individual patient data be protected,
(3) the results of the analyses be shared with the GASTRIC Group prior to public communication,
(4) the source of data be fully acknowledged as above, and
(5) resulting data and results be further shared with the research community.
</p>


<h3>References</h3>

<p>Paoletti X, Oba K, Bang Y-J, et al.
Progression-free survival as a surrogate for overall survival
in advanced/recurrent gastric cancer trials: a meta-analysis.
<em>J Ntl Cancer Inst</em>, 105(21):1667-70, 2013.
doi: <a href="https://doi.org/10.1093/jnci/djt269">10.1093/jnci/djt269</a>.
</p>
<p>The GASTRIC group.
Role of chemotherapy for advanced/recurrent gastric cancer:
An individual-patient-data meta-analysis. 
<em>Eur J Cancer</em>, 49(7):1565-77, 2013.
doi: <a href="https://doi.org/10.1016/j.ejca.2012.12.016">10.1016/j.ejca.2012.12.016</a>.
</p>
<p>Buyse M, Molenberghs G, Paoletti Xavier et al.
Statistical evaluation of surrogate endpoints
with examples from cancer clinical trials.
<em>Biom J</em>, 58(1):104-32, 2016.
doi: <a href="https://doi.org/10.1002/bimj.201400049">10.1002/bimj.201400049</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  ## Not run: 
    data('gastadv')
    allSurroRes &lt;- surrosurv(gastadv, c('Clayton', 'PoissonTIa'), verbose = TRUE)
    convergence(allSurroRes)
    allSurroRes
    predict(allSurroRes)
    plot(allSurroRes)
  
## End(Not run)
</code></pre>

<hr>
<h2 id='loocv'>
Leave-one-trial-out cross-validation for treatment effect prediction
</h2><span id='topic+loocv'></span><span id='topic+loocv.surrosurv'></span><span id='topic+print.loocvSurrosurv'></span><span id='topic+plot.loocvSurrosurv'></span>

<h3>Description</h3>

<p>The function <code>loocv()</code> computed leave-one-out prediction of the treatment
effect on the true endpoint for each trial,
based on the observed effect on the surrogate endpoint in the trial itself
and based on the meta-analytic model fitted on the remaining trials
(Michiels et al, 2009).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'surrosurv'
loocv(object, models, nCores, parallel = TRUE, ...)

## S3 method for class 'loocvSurrosurv'
print(x, n = min(length(x), 6), silent = FALSE, ...)
          
## S3 method for class 'loocvSurrosurv'
plot(x, models, exact.models, 
                                plot.type = c('classic', 'regression'),
                                main, ylab, xlab, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="loocv_+3A_object">object</code></td>
<td>

<p>Either an object of class <code>surrosurv</code> with an attribute <code>data</code>
of class <a href="base.html#topic+data.frame">data.frame</a> or a <a href="base.html#topic+data.frame">data.frame</a> with columns
</p>

<ul>
<li> <p><code>trialref</code>, the trial reference
</p>
</li>
<li> <p><code>trt</code>, the treatment arm (-0.5 or 0.5)
</p>
</li>
<li> <p><code>id</code>, the patient id
</p>
</li>
<li> <p><code>timeT</code>, the value of the true endpoint T
</p>
</li>
<li> <p><code>statusT</code>, the censoring/event (0/1) indicator of the true endpoint T
</p>
</li>
<li> <p><code>timeS</code>, the value of the surrogate endpoint S
</p>
</li>
<li> <p><code>statusS</code>, the censoring/event (0/1) indicator of the surrogate endpoint S
</p>
</li></ul>

</td></tr>
<tr><td><code id="loocv_+3A_ncores">nCores</code></td>
<td>

<p>The number of cores for parallel computing
</p>
</td></tr>
<tr><td><code id="loocv_+3A_parallel">parallel</code></td>
<td>

<p>Should results be computed using parallelization?
</p>
</td></tr>
<tr><td><code id="loocv_+3A_models">models</code>, <code id="loocv_+3A_exact.models">exact.models</code></td>
<td>

<p>Which models should be fitted (see <code><a href="#topic+surrosurv">surrosurv</a>()</code>).
By default, the same models fitted in <code>object</code> (or <code>x</code>).
</p>
</td></tr>
<tr><td><code id="loocv_+3A_x">x</code></td>
<td>

<p>The fitted models, an object of class <code><a href="#topic+surrosurv">surrosurv</a></code>
</p>
</td></tr>
<tr><td><code id="loocv_+3A_n">n</code></td>
<td>

<p>the number of rows to print
</p>
</td></tr>
<tr><td><code id="loocv_+3A_silent">silent</code></td>
<td>

<p>Should the results be return for storing without printing them?
</p>
</td></tr>
<tr><td><code id="loocv_+3A_plot.type">plot.type</code></td>
<td>

<p>The type ox x-scale for the loocv plot: either the trial number (<code>classic</code>)
or the log-HR on the surrogate endpoint (<code>regression</code>).
</p>
</td></tr>
<tr><td><code id="loocv_+3A_main">main</code>, <code id="loocv_+3A_ylab">ylab</code>, <code id="loocv_+3A_xlab">xlab</code>, <code id="loocv_+3A_...">...</code></td>
<td>

<p>Further parameters to be passed to <code>surrosurv</code>
(for <code>loocv()</code>)
or to the generics <code>print()</code> and <code>plot()</code>
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>loocvSurrosurv</code> 
containing, for each trial:
</p>
<table>
<tr><td><code>margPars</code></td>
<td>

<p>the observed treatment effects 
on the surrogate ednpoint (<code>alpha</code>) and
on the true endpoint (<code>beta</code>)
</p>
</td></tr>
<tr><td><code>...</code></td>
<td>

<p>for each method in <code>models</code>
the predicted value and prediction interval for <code>beta</code>.
</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>NA
</p>


<h3>References</h3>

<p>Michiels S, Le Maitre A, Buyse M, et al.
Surrogate endpoints for overall survival
in locally advanced head and neck cancer:
meta-analyses of individual patient data.
<em>Lancet Oncol</em>. 2009;10(4):341-50.
doi: <a href="https://doi.org/10.1016/S1470-2045(09)70023-3">10.1016/S1470-2045(09)70023-3</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  ## Not run: 
  # Possibly long computation time!
  data('gastadv')
  cvRes &lt;- loocv(gastadv)
  cvRes
  plot(cvRes)
  
## End(Not run)
</code></pre>

<hr>
<h2 id='poissonize'>
Transform survival data for fitting a Poisson model
</h2><span id='topic+poissonize'></span><span id='topic+plotsson'></span>

<h3>Description</h3>

<p>This function transform survival data into a format compatible with
the <code><a href="stats.html#topic+glm">glm</a>()</code> function for fitting an auxiliary Poisson model,
providing the parameter estimates of the associated proportional hazard model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>poissonize(data,
           all.breaks = NULL, interval.width = NULL, nInts = 8,
           factors = NULL, compress = TRUE)
plotsson(x, type = c('survival', 'hazard'),
         add = FALSE, xscale = 1, by, col, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="poissonize_+3A_data">data</code></td>
<td>

<p>a data frame with columns:
</p>

<ul>
<li><p> id       : the patient identifier
</p>
</li>
<li><p> time     : the event/censoring time
</p>
</li>
<li><p> status   : the event(1) or censoring(0) indicator
</p>
</li>
<li><p> ...      : other factors such like the covariables needed
in the regression model   
</p>
</li></ul>

</td></tr>
<tr><td><code id="poissonize_+3A_all.breaks">all.breaks</code></td>
<td>

<p>the breakpoints between time intervals
</p>
</td></tr>
<tr><td><code id="poissonize_+3A_interval.width">interval.width</code></td>
<td>

<p>the width of the time intervals on which the risks will be assumed constant,
in case of intervals of the same length.
This parameter is ignored if <code>all.breaks</code> is specified
</p>
</td></tr>
<tr><td><code id="poissonize_+3A_nints">nInts</code></td>
<td>

<p>the number of intervals containing the same expected number of events
(used only if <code>is.null(interval.width)</code>, see Details).
This parameter is ignored if either <code>all.breaks</code>
or <code>interval.width</code> is specified
</p>
</td></tr>
<tr><td><code id="poissonize_+3A_factors">factors</code></td>
<td>

<p>a vector of characters, containing the names of the factors
to be kept in the transformed data set
</p>
</td></tr>
<tr><td><code id="poissonize_+3A_compress">compress</code></td>
<td>

<p>a logical, indicating whether the record with the same
factor profile should be summarized into one record,
i.e. whether the data should be expressed in a short form
</p>
</td></tr>
<tr><td><code id="poissonize_+3A_x">x</code></td>
<td>

<p>The fitted Poisson model on the poissonized data
</p>
</td></tr>
<tr><td><code id="poissonize_+3A_type">type</code></td>
<td>

<p>the type of plot, either 'haz' for the hazard function
or 'Surv', for the survival curve
</p>
</td></tr>
<tr><td><code id="poissonize_+3A_add">add</code></td>
<td>

<p>should the plot added to the active device?
</p>
</td></tr>
<tr><td><code id="poissonize_+3A_xscale">xscale</code></td>
<td>

<p>scaling factor for the time (x) axis
</p>
</td></tr>
<tr><td><code id="poissonize_+3A_by">by</code></td>
<td>

<p>covariate for which a different curve per level has to be plotted
</p>
</td></tr>
<tr><td><code id="poissonize_+3A_col">col</code>, <code id="poissonize_+3A_...">...</code></td>
<td>

<p>other <a href="graphics.html#topic+par">graphical parameters</a>
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>interval.width</code> is not null, the study period is divided into
equal-length intervals of length <code>interval.width</code>.
Otherwise, <code>nInts</code> intervals are used, and the location of their bounds
is computed based on the empirical quantiles of the survival function.
</p>


<h3>Note</h3>

<p>This code is hugely inspired by original code made publicly available by Stephanie Kovalchik.
</p>


<h3>Author(s)</h3>

<p>NA
</p>


<h3>References</h3>

<p>Whitehead, J.
Fitting Cox's regression model to survival
data using GLIM.
<em>J Roy Stat Soc C Appl Stat</em> 1980; <b>29</b>(3):268-275.
<a href="https://www.jstor.org/stable/2346901">https://www.jstor.org/stable/2346901</a>.
</p>
<p>Crowther MJ, Riley RD, Staessen JA, Wang J, Gueyffier F, Lambert PC.
Individual patient data meta-analysis of survival data
using Poisson regression models.
<em>BMC Medical Research Methodology</em> 2012; <b>12</b>:34.
doi: <a href="https://doi.org/10.1186/1471-2288-12-34">10.1186/1471-2288-12-34</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>################################################################################
# Example 1 - KIDNEY data                                                      #
################################################################################
library(survival)
data(kidney)
kidney &lt;- kidney[1:(nrow(kidney)/2)*2,]
head(kidney) 

par(mfrow=c(1, 3))
for (int in c(50, 20, 10)) {
    head(wdata1 &lt;- poissonize(kidney, interval.width = int, 
                              factors = c('disease'), compress = FALSE))
    head(wdata2 &lt;- poissonize(kidney, interval.width = int, 
                              factors = c('disease'), compress = TRUE))
    
    fitcox &lt;- (coxph(Surv(time, status) ~ disease, data = kidney))
    fitpoi1 &lt;- glm(event ~ -1 + interval + disease + offset(log(time)),
                   data = wdata1, family = 'poisson')
    fitpoi2 &lt;- glm(m ~ -1 + interval + offset(log(Rt)) + disease,
                   data = wdata2, family = 'poisson')
    cox.base &lt;- basehaz(fitcox, centered = FALSE)
    plot(stepfun(cox.base$time[-nrow(cox.base)], exp(-cox.base$hazard)),
         ylim = 0:1, xlim = c(0, max(cox.base$time)),
         do.points = FALSE, verticals = FALSE, xaxs = 'i',
         main = paste0('KIDNEY data set\nInterval width = ', int),
         xlab = 'Time', ylab = 'Survival probability')
    plotsson(fitpoi1, 'Surv', add = TRUE, col = 2, lty = 2)
    plotsson(fitpoi2, 'Surv', add = TRUE, col = 3, lty = 3) 
    legend('topright', col = 1:3, lty = 1:3,
           legend = c('Breslow (Cox)', 'Poisson',
                      'Poisson (compressed dataset)'))
}
print(cbind(Cox                = coef(fitcox),
            Poisson            = rev(rev(coef(fitpoi1))[1:3]),
            Poisson_Compressed = rev(rev(coef(fitpoi2))[1:3])), digits = 2)



################################################################################
#  Example 2 - COLON data                                                      #
################################################################################
library(survival)
data(colon)
head(wdata1 &lt;- poissonize(subset(colon, etype == 1), interval.width = 365.25, 
                          factors=c('surg', 'sex', 'age'), compress = FALSE))
head(wdata2 &lt;- poissonize(subset(colon, etype == 1), interval.width = 365.25, 
                          factors=c('surg', 'sex', 'age'), compress = TRUE))

fitcox &lt;- coxph(Surv(time, status) ~ surg + sex + age, 
                data = subset(colon, etype == 1))

system.time({
    fitpoi1 &lt;- glm(event ~ -1 + interval + surg + sex + age + offset(log(time)),
                   data = wdata1, fam = 'poisson')
})
system.time({
    fitpoi2 &lt;- glm(m ~ -1 + interval + offset(log(Rt)) + surg + sex + age,
                   data = wdata2, family = 'poisson')
})
{
    cox.base &lt;- basehaz(fitcox, centered = FALSE)
    par(mfrow = c(1, 1))
    plot(stepfun(cox.base$time[-nrow(cox.base)], exp(-cox.base$hazard)),
         ylim = 0:1, xlim = c(0, max(cox.base$time)),
         do.points = FALSE, verticals = FALSE, xaxs = 'i',
         main = 'COLON data set', xlab = 'Time', ylab = 'Survival probability')
    plotsson(fitpoi1, 'Surv', add = TRUE, col = 2, lty = 2) 
    plotsson(fitpoi2, 'Surv', add = TRUE, col = 3, lty = 3) 
    legend('topright', col = 1:3, lty = 1:3,
           legend = c('Cox', 'Poisson', 'Poisson (compressed dataset)'))
}
print(cbind(Cox                = coef(fitcox),
            Poisson            = rev(rev(coef(fitpoi1))[1:3]),
            Poisson_Compressed = rev(rev(coef(fitpoi2))[1:3])), digits = 2)



################################################################################
#  Example 3 - LUNG data                                                       #
################################################################################
library(survival)
data(lung)
lung$status &lt;- lung$status - 1
lung$id &lt;- 1:nrow(lung)
head(wdata1 &lt;- poissonize(lung, interval.width = 365.25/12, 
                          factors = c('pat.karno', 'sex', 'age'), 
                          compress = FALSE))
head(wdata2 &lt;- poissonize(lung, interval.width = 365.25/12,
                          factors = c('pat.karno', 'sex', 'age'),
                          compress = TRUE))

fitcox &lt;- coxph(Surv(time, status) ~ pat.karno + sex + age, data = lung)

system.time({
    fitpoi1 &lt;- glm(event ~ -1 + interval + pat.karno + sex + age + 
                              offset(log(time)),
                   data = wdata1, family = 'poisson')
})
system.time({
    fitpoi2 &lt;- glm(m ~ -1 + interval + pat.karno + sex + age + offset(log(Rt)),
                   data = wdata2, family = 'poisson')
})
{
    cox.base &lt;- basehaz(fitcox, centered = FALSE)
    plot(stepfun(cox.base$time[-nrow(cox.base)], exp(-cox.base$hazard)),
         ylim = 0:1, xlim = c(0, max(cox.base$time)),
         do.points = FALSE, verticals = FALSE, xaxs = 'i',
         main = 'LUNG data set', xlab = 'Time', ylab = 'Survival probability')
    plotsson(fitpoi1, 'Surv', add = TRUE, col = 2, lty = 2) 
    plotsson(fitpoi2, 'Surv', add = TRUE, col = 3, lty = 3) 
    legend('topright', col = 1:3, lty = 1:3,
           legend = c('Cox', 'Poisson', 'Poisson (compressed dataset)'))
}
print(cbind(Cox                = coef(fitcox),
            Poisson            = rev(rev(coef(fitpoi1))[1:3]),
            Poisson_Compressed = rev(rev(coef(fitpoi2))[1:3])), digits = 2)

</code></pre>

<hr>
<h2 id='simData'>
Generate survival times for two endpoints in a meta-analysis of randomized trials
</h2><span id='topic+simData.re'></span><span id='topic+simData.cc'></span><span id='topic+simData.gh'></span><span id='topic+simData.mx'></span>

<h3>Description</h3>

<p>Data are generated from a mixed proportional hazard model,
a Clayton copula model (Burzykowski and Cortinas Abrahantes, 2005),
a Gumbel-Hougaard copula model,
or a mixture of half-normal and exponential random variables
(Shi et al., 2011).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simData.re(R2 = 0.6, N = 30, ni = 200,
           nifix = TRUE, gammaWei = c(1, 1), censorT, censorA, 
           kTau= 0.6, baseCorr = 0.5, baseVars = c(0.2, 0.2),
           alpha = 0, beta = 0,
           alphaVar = 0.1, betaVar = 0.1,
           mstS = 4 * 365.25, mstT = 8 * 365.25)
           
simData.cc(R2 = 0.6, N = 30, ni = 200,
           nifix = TRUE, gammaWei = c(1, 1), censorT, censorA,
           kTau= 0.6, baseCorr = 0.5, baseVars = c(0.2, 0.2),
           alpha = 0, beta = 0,
           alphaVar = 0.1, betaVar = 0.1,
           mstS = 4 * 365.25, mstT = 8 * 365.25)
           
simData.gh(R2 = 0.6, N = 30, ni = 200,
           nifix = TRUE, gammaWei = c(1, 1), censorT, censorA,
           kTau= 0.6, baseCorr = 0.5, baseVars = c(0.2, 0.2),
           alpha = 0, beta = 0,
           alphaVar = 0.1, betaVar = 0.1,
           mstS = 4 * 365.25, mstT = 8 * 365.25)
           
simData.mx(R2 = 0.6, N = 30, ni = 200,
           nifix = TRUE, gammaWei = c(1, 1), censorT, censorA,
           indCorr = TRUE, baseCorr = 0.5, baseVars = c(0.2, 0.2),
           alpha = 0, beta = 0,
           alphaVar = 0.1, betaVar = 0.1,
           mstS = 4 * 365.25, mstT = 8 * 365.25)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simData_+3A_r2">R2</code></td>
<td>

<p>The desired trial-level surrogacy <code class="reqn">R^2</code>
</p>
</td></tr>
<tr><td><code id="simData_+3A_n">N</code></td>
<td>

<p>The number of trials
</p>
</td></tr>
<tr><td><code id="simData_+3A_ni">ni</code></td>
<td>

<p>The (fixed or average) number of patients per trial
</p>
</td></tr>
<tr><td><code id="simData_+3A_nifix">nifix</code></td>
<td>

<p>Should all trials have the same size (if <code>nifix = TRUE</code>)
of should the <code>N * ni</code> patients be randomly assigned to trials
with random probabilities (if <code>nifix = FALSE</code>)?
</p>
</td></tr>
<tr><td><code id="simData_+3A_gammawei">gammaWei</code></td>
<td>

<p>The shape parameter(s) of the Weibull distributions.
Either one or two values. If one value is provided, it is used for both endpoints
</p>
</td></tr>
<tr><td><code id="simData_+3A_censort">censorT</code></td>
<td>

<p>censoring rate for the true endpoint T
(before adding administrative censoring)
</p>
</td></tr>
<tr><td><code id="simData_+3A_censora">censorA</code></td>
<td>

<p>administrative censoring at time censorA
</p>
</td></tr>
<tr><td><code id="simData_+3A_ktau">kTau</code></td>
<td>

<p>The desired individual-level dependence between S and T (Kendall's tau)
</p>
</td></tr>
<tr><td><code id="simData_+3A_indcorr">indCorr</code></td>
<td>

<p>Should S and T be correlated or not? (for <code>.mx</code> method)
</p>
</td></tr>
<tr><td><code id="simData_+3A_basecorr">baseCorr</code></td>
<td>

<p>correlation between baseline hazards (<code class="reqn">\rho_{basehaz}</code>)
</p>
</td></tr>
<tr><td><code id="simData_+3A_basevars">baseVars</code></td>
<td>

<p>variances of baseline random effects (S and T)
</p>
</td></tr>
<tr><td><code id="simData_+3A_alpha">alpha</code></td>
<td>

<p>average treatment effect on S
</p>
</td></tr>
<tr><td><code id="simData_+3A_beta">beta</code></td>
<td>

<p>average treatment effect on T
</p>
</td></tr>
<tr><td><code id="simData_+3A_alphavar">alphaVar</code></td>
<td>

<p>variance of <code class="reqn">a_i</code> (<code class="reqn">\theta_a^2</code>)
</p>
</td></tr>
<tr><td><code id="simData_+3A_betavar">betaVar</code></td>
<td>

<p>variance of <code class="reqn">b_i</code> (<code class="reqn">\theta_b^2</code>)
</p>
</td></tr>
<tr><td><code id="simData_+3A_msts">mstS</code></td>
<td>

<p>median survival time for S in the control arm
</p>
</td></tr>
<tr><td><code id="simData_+3A_mstt">mstT</code></td>
<td>

<p>median survival time for T in the control arm
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function <code>simData.re</code> generates data from a proportional hazard model
with random effects at individual level and 
random effects and random treatment effects at trial level.
Individual dependence can be tuned in terms of Kendall's <code class="reqn">tau</code>
(<code>kTau</code>).
</p>
<p>The function <code>simData.cc</code> generates data from a Copula function
as shown by Burzykowski and Cortinas Abrahantes (2005).
Individual dependence can be tuned in terms of Kendall's <code class="reqn">tau</code>
(<code>kTau</code>).
</p>
<p>The function <code>simData.mx</code> implements the simulation method by Shi et al. (2011).
This model is based on a mixture of half-normal and exponential random variables.
Under this model, individual dependence can be induced by using the same
half-normal random variable for S and T.
This is obtained by setting <code>indCorr = TRUE</code>,
but the amount of correlation is not dependent on a single parameter.
</p>


<h3>Value</h3>

<p>A <a href="base.html#topic+data.frame">data.frame</a> with columns
</p>
<table>
<tr><td><code>trialref</code></td>
<td>
<p>the trial reference</p>
</td></tr>
<tr><td><code>trt</code></td>
<td>
<p>the treatment arm (-0.5 or 0.5)</p>
</td></tr>
<tr><td><code>id</code></td>
<td>
<p>the patient id</p>
</td></tr>
<tr><td><code>timeT</code></td>
<td>
<p>the value of the true endpoint T</p>
</td></tr>
<tr><td><code>statusT</code></td>
<td>
<p>the censoring/event (0/1) indicator of the true endpoint T</p>
</td></tr>
<tr><td><code>timeS</code></td>
<td>
<p>the value of the surrogate endpoint S</p>
</td></tr>
<tr><td><code>statusS</code></td>
<td>
<p>the censoring/event (0/1) indicator of the surrogate endpoint S</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>NA
</p>


<h3>References</h3>

<p>Burzykowski T, Cortinas Abrahantes J (2005). Validation in the case of two failure-time endpoints.
In <em>The Evaluation of Surrogate Endpoints</em> (pp. 163-194). Springer, New York.
</p>
<p>Rotolo F, Paoletti X, Burzykowski T, Buyse M, Michiels S.
A Poisson approach for the validation of failure time surrogate endpoints
in individual patient data meta-analyses.
<em>Statistical Methods in Medical Research</em> 2017;
<b>In Press</b>.
doi: <a href="https://doi.org/10.1177/0962280217718582">10.1177/0962280217718582</a>
</p>
<p>Shi Q, Renfro LA, Bot BM, Burzykowski T, Buyse M, Sargent DJ.
Comparative assessment of trial-level surrogacy measures for candidate
time-to-event surrogate endpoints in clinical trials. 
<em>Computational Statistics &amp; Data Analysis</em> 2011; 
<b>55</b>: 2748&ndash;2757.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  set.seed(1)
  simData.re(N = 2, ni = 5)
  simData.cc(N = 2, ni = 5)
  simData.mx(N = 2, ni = 5)
</code></pre>

<hr>
<h2 id='ste'>
Surrogate threshold effect
</h2><span id='topic+ste'></span><span id='topic+print.steSurrosurv'></span>

<h3>Description</h3>

<p>The function <code>ste()</code> computes the surrogate threshold effect (STE)
of a .
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ste(x, models = names(x), exact.models)

## S3 method for class 'steSurrosurv'
print(x, digits = 2, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ste_+3A_x">x</code></td>
<td>

<p>The fitted models, an object of class <code><a href="#topic+surrosurv">surrosurv</a></code>
</p>
</td></tr>
<tr><td><code id="ste_+3A_models">models</code>, <code id="ste_+3A_exact.models">exact.models</code></td>
<td>

<p>Which models should be fitted (see <code><a href="#topic+surrosurv">surrosurv</a>()</code>)
</p>
</td></tr>
<tr><td><code id="ste_+3A_digits">digits</code></td>
<td>

<p>the number of digits
</p>
</td></tr>
<tr><td><code id="ste_+3A_...">...</code></td>
<td>

<p>Further parameters to be passed to 
the generic <code>print()</code> function
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>steSurrosurv</code> 
</p>


<h3>Author(s)</h3>

<p>NA
</p>


<h3>References</h3>

<p>Burzykowski T, Buyse M.
Surrogate threshold effect: an alternative measure
for meta-analytic surrogate endpoint validation.
<em>Pharm Stat</em>. 2006;5(3):173-86.
doi: <a href="https://doi.org/10.1002/pst.207">10.1002/pst.207</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  ## Not run: 
  # Possibly long computation time!
  data('gastadv')
  mod &lt;- surrosurv(gastadv, 'Clayton')
  ste(mod)
  
## End(Not run)
</code></pre>

<hr>
<h2 id='surrosurv'>
Fit and print the models for evaluating the surrogacy strength 
of a candidate surrogate endpoint
</h2><span id='topic+surrosurv'></span><span id='topic+print.surrosurv'></span><span id='topic+plot.surrosurv'></span><span id='topic+predict.surrosurv'></span><span id='topic+plot.predictSurrosurv'></span><span id='topic+print.predictSurrosurv'></span>

<h3>Description</h3>

<p>The function <code>surrosurv</code> fits (all or a subset of) statistical
models to evaluate a surrogate endpoint S for a given true endpoint T,
using individual data from a meta-analysis of randomized controlled trials.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>surrosurv(data,
          models = c('Clayton', 'Plackett', 'Hougaard',
                     'Poisson I', 'Poisson T', 'Poisson TI', 'Poisson TIa'),
          intWidth = NULL,  nInts = 8,
          cop.OPTIMIZER = "bobyqa",
          poi.OPTIMIZER = "bobyqa",
          verbose = TRUE,
          twoStage = FALSE,
          keep.data = TRUE)

## S3 method for class 'surrosurv'
predict(object, models = names(object), exact.models, ...)

## S3 method for class 'surrosurv'
print(x, silent = FALSE, 
      digits = 2, na.print = "-.--", ...)
          
## S3 method for class 'predictSurrosurv'
print(x, n = 6, ...)
          
## S3 method for class 'surrosurv'
plot(x, ...)

## S3 method for class 'predictSurrosurv'
plot(x, models = names(x), exact.models,
                      pred.ints = TRUE,
                      show.ste = TRUE,
                      surro.stats = TRUE, 
                      xlab, ylab, 
                      xlim, ylim, mfrow, main, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="surrosurv_+3A_data">data</code></td>
<td>

<p>A <a href="base.html#topic+data.frame">data.frame</a> with columns
</p>

<ul>
<li> <p><code>trialref</code>, the trial reference
</p>
</li>
<li> <p><code>trt</code>, the treatment arm (-0.5 or 0.5)
</p>
</li>
<li> <p><code>id</code>, the patient id
</p>
</li>
<li> <p><code>timeT</code>, the value of the true endpoint T
</p>
</li>
<li> <p><code>statusT</code>, the censoring/event (0/1) indicator of the true endpoint T
</p>
</li>
<li> <p><code>timeS</code>, the value of the surrogate endpoint S
</p>
</li>
<li> <p><code>statusS</code>, the censoring/event (0/1) indicator of the surrogate endpoint S
</p>
</li></ul>

</td></tr>
<tr><td><code id="surrosurv_+3A_models">models</code></td>
<td>

<p>For <code>surrosurv()</code>, the models should be fitted/plotted/predicted.
Possible models are:
Clayton copula (unadjusted and adjusted),
Plackett copula (unadjusted and adjusted),
Hougaard copula (unadjusted and adjusted),
Poisson (with individual-level heterogeneity only,
with trial-level heterogeneity only,
with both individual- and trial-level heterogeneity,
with both individual- and trial-level heterogeneity 
and with random per-trial intercept).
</p>
</td></tr>
<tr><td><code id="surrosurv_+3A_exact.models">exact.models</code></td>
<td>

<p>If <code>TRUE</code>, plots or predictions are generated only
for the elements of <code>x</code> which match exactly any of <code>models</code>.
If <code>exact.models = TRUE</code>, partial matching is used.
By default, <code>exact.models = TRUE</code> if all the <code>models</code>
match exactly any of the <code>names(x)</code> (or  <code>names(object)</code>)
and <code>exact.models = FALSE</code> otherwise.
</p>
</td></tr>
<tr><td><code id="surrosurv_+3A_intwidth">intWidth</code></td>
<td>

<p>the width of time intervals for data Poissonization
(see <a href="#topic+poissonize">poissonize</a>)
</p>
</td></tr>
<tr><td><code id="surrosurv_+3A_nints">nInts</code></td>
<td>

<p>the number of time intervals for data Poissonization
(see <a href="#topic+poissonize">poissonize</a>)
</p>
</td></tr>
<tr><td><code id="surrosurv_+3A_cop.optimizer">cop.OPTIMIZER</code></td>
<td>

<p>the optimizer for copula models (see <code><a href="optimx.html#topic+optimx">optimx</a></code>)
</p>
</td></tr>
<tr><td><code id="surrosurv_+3A_poi.optimizer">poi.OPTIMIZER</code></td>
<td>

<p>the optimizer for Poisson models (see <code><a href="optimx.html#topic+optimx">optimx</a></code>)
</p>
</td></tr>
<tr><td><code id="surrosurv_+3A_verbose">verbose</code></td>
<td>

<p>should the function print out the model being fitted
</p>
</td></tr>
<tr><td><code id="surrosurv_+3A_twostage">twoStage</code></td>
<td>

<p>should the parameters of the baseline hazard functions
fixed to their marginal estimates (Shih and Louis, 1995)
</p>
</td></tr>
<tr><td><code id="surrosurv_+3A_keep.data">keep.data</code></td>
<td>

<p>should the data object be kept as attribute of the returned results?
(this is needed for <code>confint.surrosurv()</code>)
</p>
</td></tr>
<tr><td><code id="surrosurv_+3A_x">x</code>, <code id="surrosurv_+3A_object">object</code></td>
<td>

<p>The fitted models, an object of class <code><a href="#topic+surrosurv">surrosurv</a></code>
</p>
</td></tr>
<tr><td><code id="surrosurv_+3A_silent">silent</code></td>
<td>

<p>Should the results be return for storing without printing them?
</p>
</td></tr>
<tr><td><code id="surrosurv_+3A_digits">digits</code>, <code id="surrosurv_+3A_na.print">na.print</code>, <code id="surrosurv_+3A_xlab">xlab</code>, <code id="surrosurv_+3A_ylab">ylab</code>, <code id="surrosurv_+3A_xlim">xlim</code>, <code id="surrosurv_+3A_ylim">ylim</code>, <code id="surrosurv_+3A_main">main</code>, <code id="surrosurv_+3A_...">...</code></td>
<td>

<p>other parameters for <code><a href="base.html#topic+print">print</a></code> or <code><a href="graphics.html#topic+plot">plot</a></code>
</p>
</td></tr>
<tr><td><code id="surrosurv_+3A_mfrow">mfrow</code></td>
<td>

<p>the number of rows and columns for displaying the plots
(see <code><a href="graphics.html#topic+par">par</a></code>).
If missing, the default is computed using the function
<code><a href="grDevices.html#topic+n2mfrow">n2mfrow</a></code>
</p>
</td></tr>
<tr><td><code id="surrosurv_+3A_n">n</code></td>
<td>

<p>the number of rows to print
</p>
</td></tr>
<tr><td><code id="surrosurv_+3A_pred.ints">pred.ints</code></td>
<td>

<p>Should the prediction intervals be plotted?
</p>
</td></tr>
<tr><td><code id="surrosurv_+3A_show.ste">show.ste</code></td>
<td>

<p>Should the surrogate threshold effect be showed?
</p>
</td></tr>
<tr><td><code id="surrosurv_+3A_surro.stats">surro.stats</code></td>
<td>

<p>Should the surrogacy statistics be showed?
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Three copula models can be fit: Clayton (1978), Plackett (1965), and
Hougaard (1986).
For all of them the linear regression at the second step
is computed both via simple LS regression
and via a linear model adjusted for measurement error
of the log-hazard ratios estimated at the first step.
This adjusted model is the one described by
Burzykowski et al. (2001), which relies on the results
by van Houwelingen et al. (2002).
</p>
<p>The mixed Poisson models that can be fit
are used to estimate parameters of mixed proportional hazard models,
as described for instance by Crowther et al (2014).
The statistical details are provided in Rotolo et al (WP).
</p>
<p>The function <code>predict()</code> returns the estimated values
of the log-hazard ratios on the true and the surrogate endpoints.
The list of the prediction functions (for all the <code>models</code>)
is available as <code>attr(predict.surrosurv(...), 'predf')</code>.
</p>


<h3>Value</h3>

<p>The fitted models, an object of class <code><a href="#topic+surrosurv">surrosurv</a></code>.
</p>


<h3>Author(s)</h3>

<p>NA
</p>


<h3>References</h3>

<p>Burzykowski T, Molenberghs G, Buyse M et al.
Validation of surrogate end points in multiple randomized clinical trials
with failure time end points.
<em>Journal of the Royal Statistical Society C</em> 2001;
<b>50</b>:405&ndash;422.
doi: <a href="https://doi.org/10.1111/1467-9876.00244">10.1111/1467-9876.00244</a>
</p>
<p>Clayton DG.
A model for association in bivariate life tables
and its application in epidemiological studies of familial tendency 
in chronic disease incidence.
<em>Biometrika</em> 1978; <b>65</b>:141&ndash;151.
doi: <a href="https://doi.org/10.1093/biomet/65.1.141">10.1093/biomet/65.1.141</a>
</p>
<p>Crowther MJ, Riley RD, Staessen JA, Wang J, Gueyffier F, Lambert PC.
Individual patient data meta-analysis of survival data
using Poisson regression models.
<em>BMC Medical Research Methodology</em> 2012; <b>12</b>:34.
doi: <a href="https://doi.org/10.1186/1471-2288-12-34">10.1186/1471-2288-12-34</a>.
</p>
<p>Gasparrini A, Armstrong B, Kenward MG.
Multivariate meta-analysis for non-linear and other multi-parameter associations.
<em>Statistics in Medicine</em> 2012; <b>31</b>:3821&ndash;39.
doi: <a href="https://doi.org/10.1002/sim.5471">10.1002/sim.5471</a>
</p>
<p>Hougaard P.
A class of multivariate failure time distributions.
<em>Biometrika</em> 1986; <b>73</b>:671&ndash;678.
doi: <a href="https://doi.org/10.1093/biomet/73.3.671">10.1093/biomet/73.3.671</a>
</p>
<p>Plackett RL.
A class of bivariate distributions. 
<em>Journal of the America Statistical Association</em> 1965; <b>60</b>:516&ndash;522.
doi: <a href="https://doi.org/10.1080/01621459.1965.10480807">10.1080/01621459.1965.10480807</a>
</p>
<p>Rotolo F, Paoletti X, Burzykowski T, Buyse M, Michiels S.
A Poisson approach for the validation of failure time surrogate endpoints
in individual patient data meta-analyses.
<em>Statistical Methods in Medical Research</em> 2017;
<b>In Press</b>.
doi: <a href="https://doi.org/10.1177/0962280217718582">10.1177/0962280217718582</a>
</p>
<p>Shih JH, Louis TA.
Inferences on the Association Parameter in Copula Models
for Bivariate Survival Data.
<em>Biometrics</em> 1995; <b>51</b>:1384&ndash;1399.
doi: <a href="https://doi.org/10.2307/2533269">10.2307/2533269</a>
</p>
<p>van Houwelingen HC, Arends LR, Stijnen T.
Advanced methods in meta-analysis: multivariate approach and meta-regression.
<em>Statistics in Medicine</em> 2002; <b>21</b>:589&ndash;624.
doi: <a href="https://doi.org/10.1002/sim.1040">10.1002/sim.1040</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  set.seed(150)
  data &lt;- simData.re(N = 20, ni = 250,
                     R2 = 0.8, kTau = 0.4,
                     alpha = log(0.95), beta = log(0.85),
                     censorA = 15 * 365.25)
  library(survival)
  par(mfrow = 1:2)
  plot(survfit(Surv(timeS, statusS) ~ trt, data = data), lty = 1:2, 
       xscale = 365.25, main = 'Progression-Free Survival\n(S)', col = 2)
  plot(survfit(Surv(timeT, statusT) ~ trt, data = data), lty = 1:2,
       xscale = 365.25, main = 'Overall Survival\n(T)')
       
  ## Not run: 
    # Long computation time!
    surrores &lt;- surrosurv(data, verbose = TRUE)
    convergence(surrores)
    surrores
  
## End(Not run)
  
  # Advanced GASTRIC data
  ## Not run: 
    # Long computation time!
    data('gastadv')
    allSurroRes &lt;- surrosurv(gastadv, c('Clayton', 'Poisson'), verbose = TRUE)
    convergence(allSurroRes)
    allSurroRes
    predict(allSurroRes)
    plot(allSurroRes)
  
## End(Not run)
</code></pre>

<hr>
<h2 id='surrosurv-package'>
Evaluation of Failure Time Surrogate Endpoints in Individual Patient Data
Meta-Analyses
</h2><span id='topic+surrosurv-package'></span>

<h3>Description</h3>

<p>Provides functions for the evaluation of
    surrogate endpoints when both the surrogate and the true endpoint are failure
    time variables. The approaches implemented are:
    (1) the two-step approach (Burzykowski et al, 2001) &lt;DOI:10.1111/1467-9876.00244&gt; with a copula model (Clayton, Plackett, Hougaard) at
    the first step and either a linear regression of log-hazard ratios at the second
    step (either adjusted or not for measurement error);
    (2) mixed proportional hazard models estimated via mixed Poisson GLM
    (Rotolo et al, 2017 &lt;DOI:10.1177/0962280217718582&gt;).
</p>


<h3>Details</h3>

<p>The DESCRIPTION file:
</p>

<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> surrosurv</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Title: </td><td style="text-align: left;"> Evaluation of Failure Time Surrogate Endpoints in Individual Patient Data
Meta-Analyses</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.1.26</td>
</tr>
<tr>
 <td style="text-align: left;">
Authors@R: </td><td style="text-align: left;"> c(
  person("Federico", "Rotolo", role="aut", email="federico.rotolo@gustaveroussy.fr",
          comment = c(ORCID = "0000-0003-4837-6501")),
  person("Xavier", "Paoletti", role="ctb"),
  person("Marc", "Buyse", role="ctb"),
  person("Tomasz", "Burzykowski", role="ctb"),
  person("Stefan", "Michiels", role="ctb", email="stefan.michiels@gustaveroussy.fr",
          comment = c(ORCID = "0000-0002-6963-2968")),
  person("Dan", "Chaltiel", role="cre", email="dan.chaltiel@gustaveroussy.fr",
          comment = c(ORCID = "0000-0003-3488-779X")))</td>
</tr>
<tr>
 <td style="text-align: left;">
Maintainer: </td><td style="text-align: left;"> Dan Chaltiel &lt;dan.chaltiel@gustaveroussy.fr&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
Description: </td><td style="text-align: left;"> Provides functions for the evaluation of
    surrogate endpoints when both the surrogate and the true endpoint are failure
    time variables. The approaches implemented are:
    (1) the two-step approach (Burzykowski et al, 2001) &lt;DOI:10.1111/1467-9876.00244&gt; with a copula model (Clayton, Plackett, Hougaard) at
    the first step and either a linear regression of log-hazard ratios at the second
    step (either adjusted or not for measurement error);
    (2) mixed proportional hazard models estimated via mixed Poisson GLM
    (Rotolo et al, 2017 &lt;DOI:10.1177/0962280217718582&gt;).</td>
</tr>
<tr>
 <td style="text-align: left;">
Depends: </td><td style="text-align: left;"> R (&gt;= 3.5.0)</td>
</tr>
<tr>
 <td style="text-align: left;">
Imports: </td><td style="text-align: left;"> copula,
eha,
grDevices,
lme4,
MASS,
Matrix,
msm,
mvmeta,
optimx,
parallel,
parfm,
stats,
survival</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL-2</td>
</tr>
<tr>
 <td style="text-align: left;">
URL: </td><td style="text-align: left;"> https://github.com/Oncostat/surrosurv</td>
</tr>
<tr>
 <td style="text-align: left;">
BugReports: </td><td style="text-align: left;"> https://github.com/Oncostat/surrosurv/issues/</td>
</tr>
<tr>
 <td style="text-align: left;">
VignetteBuilder: </td><td style="text-align: left;"> R.rsp</td>
</tr>
<tr>
 <td style="text-align: left;">
Suggests: </td><td style="text-align: left;"> R.rsp,
testthat (&gt;= 3.0.0)</td>
</tr>
<tr>
 <td style="text-align: left;">
Encoding: </td><td style="text-align: left;"> UTF-8</td>
</tr>
<tr>
 <td style="text-align: left;">
Config/testthat/edition: </td><td style="text-align: left;"> 3</td>
</tr>
<tr>
 <td style="text-align: left;">
Author: </td><td style="text-align: left;"> Federico Rotolo [aut] (&lt;https://orcid.org/0000-0003-4837-6501&gt;),
  Xavier Paoletti [ctb],
  Marc Buyse [ctb],
  Tomasz Burzykowski [ctb],
  Stefan Michiels [ctb] (&lt;https://orcid.org/0000-0002-6963-2968&gt;),
  Dan Chaltiel [cre] (&lt;https://orcid.org/0000-0003-3488-779X&gt;)</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>


<p>Index of help topics:
</p>
<pre>
convergence             Assesses the convergence of fitted models for
                        surrogacy evaluation
gastadj                 Individual data from the adjuvant GASTRIC
                        meta-analysis
gastadv                 Individual data from the advanced GASTRIC
                        meta-analysis
loocv                   Leave-one-trial-out cross-validation for
                        treatment effect prediction
poissonize              Transform survival data for fitting a Poisson
                        model
simData.re              Generate survival times for two endpoints in a
                        meta-analysis of randomized trials
ste                     Surrogate threshold effect
surrosurv               Fit and print the models for evaluating the
                        surrogacy strength of a candidate surrogate
                        endpoint
surrosurv-package       Evaluation of Failure Time Surrogate Endpoints
                        in Individual Patient Data Meta-Analyses
</pre>


<h3>Author(s)</h3>

<p>NA
</p>
<p>Maintainer: Dan Chaltiel &lt;dan.chaltiel@gustaveroussy.fr&gt;
</p>


<h3>References</h3>

<p>Rotolo F, Paoletti X, Burzykowski T, Buyse M, Michiels S.
A Poisson approach for the validation of failure time surrogate endpoints
in individual patient data meta-analyses.
<em>Statistical Methods in Medical Research</em> 2017;
<b>In Press</b>.
doi: <a href="https://doi.org/10.1177/0962280217718582">10.1177/0962280217718582</a>
</p>
<p>Burzykowski T, Molenberghs G, Buyse M et al.
Validation of surrogate end points in multiple randomized clinical trials with failure time end points.
<em>Journal of the Royal Statistical Society C</em> 2001;
<b>50</b>:405&ndash;422.
doi: <a href="https://doi.org/10.1111/1467-9876.00244">10.1111/1467-9876.00244</a>
</p>
<p>Gasparrini A, Armstrong B, Kenward MG.
Multivariate meta-analysis for non-linear and other multi-parameter associations.
<em>Statistics in Medicine</em> 2012; <b>31</b>:3821&ndash;39.
doi: <a href="https://doi.org/10.1002/sim.5471">10.1002/sim.5471</a>
</p>
<p>Burzykowski T, Molenberghs G, Buyse M (2005). 
<em>The Evaluation of Surrogate Endpoints</em>. Springer, New York.
<a href="https://rd.springer.com/book/10.1007/b138566">https://rd.springer.com/book/10.1007/b138566</a>
</p>


<h3>See Also</h3>

<p><a href="https://CRAN.R-project.org/package=Surrogate"><span class="pkg">Surrogate</span></a>, <a href="https://CRAN.R-project.org/package=mvmeta"><span class="pkg">mvmeta</span></a>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
