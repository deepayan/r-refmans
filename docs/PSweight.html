<!DOCTYPE html><html><head><title>Help for package PSweight</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {PSweight}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#coef.PSweight'><p>Point estimates of PSweight</p></a></li>
<li><a href='#NCDS'><p>Illustrative dataset for PSweight</p></a></li>
<li><a href='#OUTmethod'><p>Fitting potential outcome regression with different methods</p></a></li>
<li><a href='#plot.SumStat'><p>Plot the distribution of propensity scores and balance statistics</p></a></li>
<li><a href='#print.PStrim'><p>Print the results of PStrim</p></a></li>
<li><a href='#print.PSweight'><p>Print the results of PSweight</p></a></li>
<li><a href='#print.PSweightsum'><p>Print the results of Summary.PSweight</p></a></li>
<li><a href='#print.SumStat'><p>Print the results of SumStat</p></a></li>
<li><a href='#print.SumSumStat'><p>Print the results of Summary.SumStat</p></a></li>
<li><a href='#psdata'><p>Simulated dataset for PSweight</p></a></li>
<li><a href='#psdata_cl'><p>Simulated dataset for PSweight</p></a></li>
<li><a href='#PSmethod'><p>Fitting propensity score models with different methods</p></a></li>
<li><a href='#PStrim'><p>Trim the input data and propensity estimate</p></a></li>
<li><a href='#PSweight'><p>Estimate average causal effects by propensity score weighting</p></a></li>
<li><a href='#PSweight_cl'><p>Estimate average causal effects by propensity score weighting for a binary treatment with clustering.</p></a></li>
<li><a href='#summary.PSweight'><p>Summarize a PSweight object</p></a></li>
<li><a href='#summary.SumStat'><p>Summarize a SumStat object.</p></a></li>
<li><a href='#SumStat'><p>Calculate summary statistics for propensity score weighting</p></a></li>
<li><a href='#SumStat_cl'><p>Calculate summary statistics for propensity score weighting with clustering (for binary treatment only)</p></a></li>
<li><a href='#vcov.PSweight'><p>Variance of PSweight</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Propensity Score Weighting for Causal Inference with
Observational Studies and Randomized Trials</td>
</tr>
<tr>
<td>Version:</td>
<td>1.2.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-03-27</td>
</tr>
<tr>
<td>Description:</td>
<td>Supports propensity score weighting analysis of observational studies and randomized trials. Enables the estimation and inference of average causal effects with binary and multiple treatments using overlap weights (ATO), inverse probability of treatment weights (ATE), average treatment effect among the treated weights (ATT), matching weights (ATM) and entropy weights (ATEN), with and without propensity score trimming. These weights are members of the family of balancing weights introduced in Li, Morgan and Zaslavsky (2018) &lt;<a href="https://doi.org/10.1080%2F01621459.2016.1260466">doi:10.1080/01621459.2016.1260466</a>&gt; and Li and Li (2019) &lt;<a href="https://doi.org/10.1214%2F19-AOAS1282">doi:10.1214/19-AOAS1282</a>&gt;.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/thuizhou/PSweight">https://github.com/thuizhou/PSweight</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown</td>
</tr>
<tr>
<td>Imports:</td>
<td>lme4, nnet, MASS, ggplot2, numDeriv, gbm, SuperLearner</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-03-29 05:19:00 UTC; yukang</td>
</tr>
<tr>
<td>Author:</td>
<td>Tianhui Zhou [aut],
  Guangyu Tong [aut],
  Fan Li [aut],
  Laine Thomas [aut],
  Fan Li [aut],
  Yukang Zeng [cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Yukang Zeng &lt;yukang.zeng@yale.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-03-29 22:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='coef.PSweight'>Point estimates of PSweight</h2><span id='topic+coef.PSweight'></span>

<h3>Description</h3>

<p>The <code><a href="stats.html#topic+coef">coef</a></code> method for class &quot;PSweight&quot;
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'PSweight'
coef(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="coef.PSweight_+3A_object">object</code></td>
<td>
<p>an object for which the extraction of model coefficients is meaningful.</p>
</td></tr>
<tr><td><code id="coef.PSweight_+3A_...">...</code></td>
<td>
<p>other arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The output from <code><a href="stats.html#topic+coef">coef</a></code>
</p>

<hr>
<h2 id='NCDS'>Illustrative dataset for PSweight</h2><span id='topic+NCDS'></span>

<h3>Description</h3>

<p>This is a real observational study with binary and multiple treatment groups to illustrate the utility of PSweight functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(NCDS)
</code></pre>


<h3>Format</h3>

<p>A data frame with 3642 rows and 16 columns.
</p>


<h3>Details</h3>

<p>An dataset from the National Child Development Survey (NCDS) of the United Kingdom (UK). This dataset is obtained through the CC0 waiver from the work by Battistin and Sianesi (2011).
For illustration, missing entries are imputed once with Multiple Imputation by Chained Equations (MICE).
</p>
<p>This data frame contains the following columns:
</p>

<ul>
<li><p> white: self-identified as white.
</p>
</li>
<li><p> wage: gross hourly wage in pound in log scale.
</p>
</li>
<li><p> Dany: whether received any education before.
</p>
</li>
<li><p> Dmult: three levels of educational attainment.
</p>
</li>
<li><p> maemp: employment status of mother.
</p>
</li>
<li><p> scht: school type.
</p>
</li>
<li><p> qmab: math score at age 7.
</p>
</li>
<li><p> qmab2: math score at age 11.
</p>
</li>
<li><p> qvab: reading score at age 7.
</p>
</li>
<li><p> qvab2: reading score at age 11.
</p>
</li>
<li><p> paed_u: father's years of education.
</p>
</li>
<li><p> maed_u: mother's years of education.
</p>
</li>
<li><p> age_pa: age of father.
</p>
</li>
<li><p> age_ma: age of mother.
</p>
</li>
<li><p> sub_u: number of siblings.
</p>
</li>
<li><p> wagebin: dichotomized wage obtained with a cutoff of average hourly wage.
</p>
</li></ul>



<h3>References</h3>

<p>https://cls.ucl.ac.uk/cls-studies/1958-national-child-development-study/
</p>
<p>Battistin E, Sianesi B. (2011). Misclassified Treatment Status and Treatment Effects: an Application
to Returns to Education in the United Kindom. Review of Economics and Statistics, 93(2), 495-509.
</p>
<p>Battistin E, Sianesi B. (2012). Replication data for: Misclassified Treatment Status and Treatment Effects: an Application
to Returns to Education in the United Kindom. URL https://doi.org.10.7910/DVN/EPCYUL.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("NCDS")
</code></pre>

<hr>
<h2 id='OUTmethod'>Fitting potential outcome regression with different methods</h2><span id='topic+OUTmethod'></span>

<h3>Description</h3>

<p>The function <code>OUTmethod</code> is an internal function to estimate the potential outcomes given a specified model through formula.
It is built into function <code>PSweight</code>, and is used for constructing the augmented estimators.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>OUTmethod(
  out.formula = out.formula,
  y = y,
  out.method = "glm",
  family = "gaussian",
  datain = datain,
  dataout = dataout,
  out.control = list()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="OUTmethod_+3A_out.formula">out.formula</code></td>
<td>
<p>an object of class <code><a href="stats.html#topic+formula">formula</a></code> (or one that can be coerced to that class):
a symbolic description of the outcome model to be fitted.</p>
</td></tr>
<tr><td><code id="OUTmethod_+3A_y">y</code></td>
<td>
<p>a vector of the observed outcome in the training data (<code>datain</code>).</p>
</td></tr>
<tr><td><code id="OUTmethod_+3A_out.method">out.method</code></td>
<td>
<p>a character to specify the method for estimating the outcome regression model. <code>"glm"</code> is default, and <code>"gbm"</code> and <code>"SuperLearner"</code> are also allowed.</p>
</td></tr>
<tr><td><code id="OUTmethod_+3A_family">family</code></td>
<td>
<p>a description of the error distribution and link function to be used in the outcome model. Supported distributional families include
<code>"gaussian" (link = identity)</code>, <code>"binomial" (link = logit)</code> and <code>"poisson" (link = log)</code>. Default is <code>"gaussian"</code>.</p>
</td></tr>
<tr><td><code id="OUTmethod_+3A_datain">datain</code></td>
<td>
<p>The training data for the outcome model. In the context of <code>PSweight</code>, it refers to the data observed for each treatment group.</p>
</td></tr>
<tr><td><code id="OUTmethod_+3A_dataout">dataout</code></td>
<td>
<p>The prediction data for the outcome model. In the context of <code>PSweight</code>, it refers to the full data.</p>
</td></tr>
<tr><td><code id="OUTmethod_+3A_out.control">out.control</code></td>
<td>
<p>a list to specify additional options when <code>out.method</code> is set to <code>"gbm"</code> or <code>"SuperLearner"</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A typical form for <code>out.formula</code> is <code>y ~ terms</code> where <code>y</code> is the outcome
variable and <code>terms</code> is a series of terms which specifies linear predictors (on the link function scale). <code>out.formula</code> by default specifies generalized
linear model given the gaussian error through the default arguments <code>method = "glm"</code> and <code>family = "gaussian"</code>.  It fits the logistic regression when <code>family = "binomal"</code>,and poisson
regression when <code>family = "poisson"</code>. The argument <code>out.method</code> allows user to choose
model other than glm to fit the outcome regression models for constructing the augmented estimator. We have included <code>gbm</code> and <code>SuperLearner</code> as alternative machine learning estimators.
Additional argument in them can be supplied through the <code>...</code> argument. Please refer to the user manual of the <code>gbm</code> and <code>SuperLearner</code> packages for all the
allowed arguments.
</p>


<h3>Value</h3>


<dl>
<dt><code> m.est</code></dt><dd><p>a vector of predicted outcome on the <code>dataout</code>.</p>
</dd>
<dt><code> gamma.h</code></dt><dd><p>estimated coefficient of the outcome model when <code>method = "glm"</code>.</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>
#' the outcome model
out.formula &lt;- Y~cov1+cov2+cov3+cov4+cov5+cov6
y &lt;- psdata$Y
#train on model with treatment group 1
datain &lt;- psdata[psdata$trt==1, ]
outfit &lt;- OUTmethod(out.formula = out.formula, y=y, datain = datain, dataout = psdata)

</code></pre>

<hr>
<h2 id='plot.SumStat'>Plot the distribution of propensity scores and balance statistics</h2><span id='topic+plot.SumStat'></span>

<h3>Description</h3>

<p>Summarize the SumStat object, generate histogram or density of estimated propensity scores and
plot the balance statistics under weighting versus no weighting.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'SumStat'
plot(
  x,
  type = "balance",
  weighted.var = TRUE,
  threshold = 0.1,
  metric = "ASD",
  breaks = 50,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.SumStat_+3A_x">x</code></td>
<td>
<p>a <code>SumStat</code> object obtained with <code><a href="#topic+SumStat">SumStat</a></code> function.</p>
</td></tr>
<tr><td><code id="plot.SumStat_+3A_type">type</code></td>
<td>
<p>a character indicating the type of plot to produce, including histogram of estimated propensity scores (<code>"hist"</code>), density of estimated propensity scores (<code>"density"</code>), and plot of balance statistics (<code>"balance"</code>).</p>
</td></tr>
<tr><td><code id="plot.SumStat_+3A_weighted.var">weighted.var</code></td>
<td>
<p>logical. Indicating whether weighted variance should be used in calculating the balance statistics. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot.SumStat_+3A_threshold">threshold</code></td>
<td>
<p>an optional numeric value indicating the balance threshold for the balance plot. Default is 0.1. Only valid when <code>type = "balance"</code>.</p>
</td></tr>
<tr><td><code id="plot.SumStat_+3A_metric">metric</code></td>
<td>
<p>a character indicating the type of metric used in balance plot. Only <code>"ASD"</code> or <code>"PSD"</code> is allowed. If not specified, the default is <code>"ASD"</code>. See  <code><a href="#topic+summary.SumStat">summary.SumStat</a></code> for additional details on balance metrics.</p>
</td></tr>
<tr><td><code id="plot.SumStat_+3A_breaks">breaks</code></td>
<td>
<p>a single number giving the number of cells for the histogram. Default is 50.</p>
</td></tr>
<tr><td><code id="plot.SumStat_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For the balance plot, a vertical line at <code>threshold</code> is used to define balance on covariates.
The default value is <code>threshold = 0.1</code> following Austin and Stuart (2015). If more than 2 treatments
are considered, only density of the estimated generalized propensity scores will be produced, regardless of
whether <code>type = "density"</code> or <code>type = "hist"</code>.
</p>


<h3>Value</h3>

<p>Plot of the indicated type.
</p>


<h3>References</h3>

<p>Austin, P.C. and Stuart, E.A. (2015). Moving towards best practice when using inverse probability of treatment weighting (IPTW) using the propensity score to estimate causal treatment effects in observational studies.
Statistics in Medicine, 34(28), 3661-3679.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("psdata")
ps.formula&lt;-trt~cov1+cov2+cov3+cov4+cov5+cov6
msstat &lt;- SumStat(ps.formula, trtgrp="2", data=subset(psdata,trt&gt;1),
   weight=c("IPW","overlap","treated","entropy","matching"))

plot(msstat, type="hist")
plot(msstat, type="balance", weighted.var=TRUE, threshold=0.1, metric="ASD")

</code></pre>

<hr>
<h2 id='print.PStrim'>Print the results of PStrim</h2><span id='topic+print.PStrim'></span>

<h3>Description</h3>

<p>The <code><a href="base.html#topic+print">print</a></code> method for class &quot;PStrim&quot;
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'PStrim'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.PStrim_+3A_x">x</code></td>
<td>
<p>an object used to select a method.</p>
</td></tr>
<tr><td><code id="print.PStrim_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The output from <code><a href="base.html#topic+print">print</a></code>
</p>

<hr>
<h2 id='print.PSweight'>Print the results of PSweight</h2><span id='topic+print.PSweight'></span>

<h3>Description</h3>

<p>The <code><a href="base.html#topic+print">print</a></code> method for class &quot;PSweight&quot;
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'PSweight'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.PSweight_+3A_x">x</code></td>
<td>
<p>an object used to select a method.</p>
</td></tr>
<tr><td><code id="print.PSweight_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The output from <code><a href="base.html#topic+print">print</a></code>
</p>

<hr>
<h2 id='print.PSweightsum'>Print the results of Summary.PSweight</h2><span id='topic+print.PSweightsum'></span>

<h3>Description</h3>

<p>The <code><a href="base.html#topic+print">print</a></code> method for class &quot;PSweightsum&quot;
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'PSweightsum'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.PSweightsum_+3A_x">x</code></td>
<td>
<p>an object used to select a method.</p>
</td></tr>
<tr><td><code id="print.PSweightsum_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The output from <code><a href="base.html#topic+print">print</a></code>
</p>

<hr>
<h2 id='print.SumStat'>Print the results of SumStat</h2><span id='topic+print.SumStat'></span>

<h3>Description</h3>

<p>The <code><a href="base.html#topic+print">print</a></code> method for class &quot;SumStat&quot;
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'SumStat'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.SumStat_+3A_x">x</code></td>
<td>
<p>an object used to select a method.</p>
</td></tr>
<tr><td><code id="print.SumStat_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The output from <code><a href="base.html#topic+print">print</a></code>
</p>

<hr>
<h2 id='print.SumSumStat'>Print the results of Summary.SumStat</h2><span id='topic+print.SumSumStat'></span>

<h3>Description</h3>

<p>The <code><a href="base.html#topic+print">print</a></code> method for class &quot;SumSumStat&quot;
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'SumSumStat'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.SumSumStat_+3A_x">x</code></td>
<td>
<p>an object used to select a method.</p>
</td></tr>
<tr><td><code id="print.SumSumStat_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The output from <code><a href="base.html#topic+print">print</a></code>
</p>

<hr>
<h2 id='psdata'>Simulated dataset for PSweight</h2><span id='topic+psdata'></span>

<h3>Description</h3>

<p>This is a simulated observational study with three treatment groups to illustated the ulity of PSweight.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(psdata)
</code></pre>


<h3>Format</h3>

<p>A data frame with 1500 rows and 8 columns.
</p>


<h3>Details</h3>

<p>The simulated dataset includes 1500 rows, with each row represents information recorded from each individual.
There are 8 variables (columns). The treatment is the variable trt, which has three treatment arms.
The outcome of interest is variable Y. cov1-cov6 are pre-treatment covariates among which cov1-cov5 are continous, and cov6 is binary.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("psdata")
</code></pre>

<hr>
<h2 id='psdata_cl'>Simulated dataset for PSweight</h2><span id='topic+psdata_cl'></span>

<h3>Description</h3>

<p>This is a simulated observational study with three treatment groups to illustated the ulity of PSweight.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(psdata_cl)
</code></pre>


<h3>Format</h3>

<p>A data frame with 1500 rows and 9 columns.
</p>


<h3>Details</h3>

<p>The simulated dataset includes 1500 rows, with each row represents information recorded from each individual.
There are 9 variables (columns). The treatment is the variable trt, which has two treatment arms. The clt is the cluster level.
The outcome of interest is variable Y. cov1-cov6 are pre-treatment covariates among which cov1-cov5 are continous, and cov6 is binary.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># data("psdata_cl")
</code></pre>

<hr>
<h2 id='PSmethod'>Fitting propensity score models with different methods</h2><span id='topic+PSmethod'></span>

<h3>Description</h3>

<p>The function <code>PSmethod</code> is an internal function to estimate the propensity scores given a specified model through formula.
It is built into function <code>Sumstat</code>, <code>PStrim</code> and <code>PSweight</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PSmethod(
  ps.formula = ps.formula,
  method = "glm",
  data = data,
  ncate = ncate,
  ps.control = list()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="PSmethod_+3A_ps.formula">ps.formula</code></td>
<td>
<p>an object of class <code><a href="stats.html#topic+formula">formula</a></code> (or one that can be coerced to that class):
a symbolic description of the propensity score model to be fitted. Additional details of model specification
are given under &quot;Details&quot;. This argument is optional if <code>ps.estimate</code> is not <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="PSmethod_+3A_method">method</code></td>
<td>
<p>a character to specify the method for estimating propensity scores. <code>"glm"</code> is default, and <code>"gbm"</code> and <code>"SuperLearner"</code> are also allowed.</p>
</td></tr>
<tr><td><code id="PSmethod_+3A_data">data</code></td>
<td>
<p>an optional data frame containing the variables in the propensity score model.</p>
</td></tr>
<tr><td><code id="PSmethod_+3A_ncate">ncate</code></td>
<td>
<p>a numeric to specify the number of treatment groups present in the given data.</p>
</td></tr>
<tr><td><code id="PSmethod_+3A_ps.control">ps.control</code></td>
<td>
<p>a list to specify additional options when <code>method</code> is set to <code>"gbm"</code> or <code>"SuperLearner"</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A typical form for <code>ps.formula</code> is <code>treatment ~ terms</code> where <code>treatment</code> is the treatment
variable and <code>terms</code> is a series of terms which specifies a linear predictor. <code>ps.formula</code> by default specifies generalized
linear models given the default argument <code>method = "glm"</code>.  It fits the logistic regression when <code>ncate = 2</code>,and multinomial
logistic regression when <code>ncate &gt; 2</code>. The argument <code>method</code> allows user to choose
model other than glm to fit the propensity score models. We have included <code>gbm</code> and <code>SuperLearner</code> as two alternative machine learning methods.
Additional arguments of the machine learning estimators can be supplied through the <code>...</code> argument. Note that SuperLearner does not handle multiple groups and the current version of multinomial
logistic regression is not supported by gbm. We suggest user to use them with extra caution. Please refer to the user manual of the <code>gbm</code> and <code>SuperLearner</code> packages for all the
allowed arguments.
</p>


<h3>Value</h3>


<dl>
<dt><code> e.h</code></dt><dd><p>a data frame of estimated propensity scores.</p>
</dd>
<dt><code> ps.fitObjects</code></dt><dd><p>the fitted propensity model details</p>
</dd>
<dt><code> beta.h</code></dt><dd><p>estimated coefficient of the propensity model when <code>method = "glm"</code>.</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'># the propensity model
ps.formula &lt;- trt~cov1+cov2+cov3+cov4+cov5+cov6
psfit &lt;- PSmethod(ps.formula = ps.formula,data = psdata,ncate=3)


</code></pre>

<hr>
<h2 id='PStrim'>Trim the input data and propensity estimate</h2><span id='topic+PStrim'></span>

<h3>Description</h3>

<p>Trim the original data and propensity estimate according to symmetric propensity score trimming rules.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PStrim(
  data,
  ps.formula = NULL,
  zname = NULL,
  ps.estimate = NULL,
  delta = 0,
  optimal = FALSE,
  out.estimate = NULL,
  method = "glm",
  ps.control = list()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="PStrim_+3A_data">data</code></td>
<td>
<p>an optional data frame containing the variables required by <code>ps.formula</code>.</p>
</td></tr>
<tr><td><code id="PStrim_+3A_ps.formula">ps.formula</code></td>
<td>
<p>an object of class <code><a href="stats.html#topic+formula">formula</a></code> (or one that can be coerced to that class): a symbolic description of the propensity score model to be fitted. Additional details of model specification are given under &quot;Details&quot;. This argument is optional if <code>ps.estimate</code> is not <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="PStrim_+3A_zname">zname</code></td>
<td>
<p>an optional character specifying the name of the treatment variable in <code>data</code>. Unless <code>ps.formula</code> is specified, <code>zname</code> is required.</p>
</td></tr>
<tr><td><code id="PStrim_+3A_ps.estimate">ps.estimate</code></td>
<td>
<p>an optional matrix or data frame containing estimated (generalized) propensity scores for each observation. Typically, this is an N by J matrix, where N is the number of observations and J is the total number of treatment levels. Preferably, the column name of this matrix should match the name of treatment level, if column name is missing or there is a mismatch, the column names would be assigned according to alphabatic order of the treatment levels. A vector of propensity score estimates is also allowed in <code>ps.estimate</code>, in which case a binary treatment is implied and the input is regarded as the propensity to receive the last category of treatment by alphabatic order, unless otherwise stated by <code>trtgrp</code>.</p>
</td></tr>
<tr><td><code id="PStrim_+3A_delta">delta</code></td>
<td>
<p>trimming threshold for estimated (generalized) propensity scores. Should be no larger than 1 / number of treatment groups. Default is 0, corresponding to no trimming.</p>
</td></tr>
<tr><td><code id="PStrim_+3A_optimal">optimal</code></td>
<td>
<p>an logical argument indicating if optimal trimming should be used. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="PStrim_+3A_out.estimate">out.estimate</code></td>
<td>
<p>an optional matrix or data frame containing estimated potential outcomes
for each observation. Typically, this is an N by J matrix, where N is the number of observations
and J is the total number of treatment levels. Preferably, the column name of this matrix should
match the name of treatment level, if column name is missing or there is a mismatch,
the column names would be assigned according to alphabatic order of the treatment levels, with a
similar mechanism as in <code>ps.estimate</code>.</p>
</td></tr>
<tr><td><code id="PStrim_+3A_method">method</code></td>
<td>
<p>a character to specify the method for estimating propensity scores. <code>"glm"</code> is default, and <code>"gbm"</code> and <code>"SuperLearner"</code> are also allowed.</p>
</td></tr>
<tr><td><code id="PStrim_+3A_ps.control">ps.control</code></td>
<td>
<p>a list to specify additional options when <code>method</code> is set to <code>"gbm"</code> or <code>"SuperLearner"</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A typical form for <code>ps.formula</code> is <code>treatment ~ terms</code> where <code>treatment</code> is the treatment
variable (identical to the variable name used to specify <code>zname</code>) and <code>terms</code> is a series of terms
which specifies a linear predictor for <code>treatment</code>. <code>ps.formula</code> specifies a
model for estimating the propensity scores, when <code>ps.estimate</code> is <code>NULL</code>.
<code>"glm"</code> is the default method for propensity score estimation. Logistic regression will be used for binary outcomes,
and multinomial logistic regression will be used for outcomes with more than two categories. The alternative method option of <code>"gbm"</code> serves as an API to call the <code>gbm()</code> function from the
<code>gbm</code> package. Additional argument in the <code>gbm()</code> function can be supplied through the <code>ps.control=list()</code> argument in <code>SumStat()</code>. Please refer to the user manual of the <code>"gbm"</code> package for all the
allowed arguments. Currently, models for binary or multinomial treatment will be automatically chosen based on the number of treatment categories.
<code>"SuperLearner"</code> is also allowed in the <code>method</code> argument to call the <code>SuperLearner()</code> function in <code>SuperLearner</code> package.
Currently, the SuperLearner method only support binary treatment with the default method set to <code>"SL.glm"</code>. The estimation approach is default to <code>"method.NNLS"</code>.
Prediction algorithm and other tuning parameters can also be passed through <code>ps.control=list()</code>. Please refer to the user manual of the <code>SuperLearner</code> package for all the allowed specifications.
</p>
<p>When comparing two treatments, <code>ps.estimate</code> can either be a vector or a two-column matrix of estimated
propensity scores. If a vector is supplied, it is assumed to be the propensity scores to receive the treatment, and
the treatment group corresponds to the last group in the alphebatic order, unless otherwise specified by <code>trtgrp</code>.
When comparing multiple (J&gt;=3) treatments, <code>ps.estimate</code> needs to be specified as an N by J matrix,
where N indicates the number of observations, and J indicates the total number of treatments.
This matrix specifies the estimated generalized propensity scores to receive each of the J treatments.
The same mechanism applies to <code>out.estimate</code>, except that the input for <code>out.estimate</code>
must be an N by J matrix, where each row corresponds to the estimated potential outcomes (corresponding to each treatment)
for each observation.
</p>
<p>With binary treatments, <code>delta</code> defines the symmetric propensity score trimming rule following Crump et al. (2009).
With multiple treatments, <code>delta</code> defines the symmetric multinomial trimming rule introduced in Yoshida et al. (2019).
With binary treatments and when <code>optimal</code> equals <code>TRUE</code>, the trimming function implements the optimal
symmetric trimming rule in Crump et al. (2009). The optimal trimming threshold <code>delta</code> is then returned.
With multiple treatments and <code>optimal</code> equals <code>TRUE</code>, the trimming function implements the optimal trimming rule in Yang et al. (2016).
The optimal cutoff <code>lambda</code>, which defines the acceptable upper bound for the sum of inverse generalized propensity scores, is
returned. See Yang et al. (2016) and Li and Li (2019) for details.
</p>
<p>The argument <code>zname</code> is required when <code>ps.estimate</code> is not <code>NULL</code>.
</p>


<h3>Value</h3>

<p>PStrim returns a list of the following values:
</p>

<dl>
<dt><code> data</code></dt><dd><p>a data frame of trimmed data. </p>
</dd>
<dt><code> trim_sum</code></dt><dd><p>a table summrizing the number of cases by treatment groups before and after trimming. </p>
</dd>
<dt><code> ps.estimate</code></dt><dd><p> a data frame of propensity estimate after trimming. </p>
</dd>
<dt><code> delta</code></dt><dd><p> an optional output of trimming threshold for symmetric trimming. </p>
</dd>
<dt><code> lambda</code></dt><dd><p> an optional output trimming threshold for optimal trimming with multiple treatment groups. </p>
</dd>
<dt><code> out.estimate</code></dt><dd><p> a data frame of estimated potential outcomes after trimming. </p>
</dd>
</dl>



<h3>References</h3>

<p>Crump, R. K., Hotz, V. J., Imbens, G. W., Mitnik, O. A. (2009).
Dealing with limited overlap in estimation of average treatment effects. Biometrika, 96(1), 187-199.
</p>
<p>Yoshida, K., Solomon, D.H., Haneuse, S., Kim, S.C., Patorno, E., Tedeschi, S.K., Lyu, H.,
Franklin, J.M., Stürmer, T., Hernández-Díaz, S. and Glynn, R.J. (2019).
Multinomial extension of propensity score trimming methods: A simulation study.
American Journal of Epidemiology, 188(3), 609-616.
</p>
<p>Yang, S., Imbens, G. W., Cui, Z., Faries, D. E., Kadziola, Z. (2016). Propensity score matching
and subclassification in observational studies with multi-level treatments. Biometrics, 72(4), 1055-1065.
</p>
<p>Li, F., Li, F. (2019). Propensity score weighting for causal inference with multiple treatments.
The Annals of Applied Statistics, 13(4), 2389-2415.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("psdata")

# the propensity model
ps.formula&lt;-trt~cov1+cov2+cov3+cov4+cov5+cov6

# trim the original data by setting the threshold of propensity as 0.05
PStrim(data=psdata, ps.formula=ps.formula, delta=0.05)
PStrim(data=psdata, ps.formula=ps.formula, optimal=TRUE)

</code></pre>

<hr>
<h2 id='PSweight'>Estimate average causal effects by propensity score weighting</h2><span id='topic+PSweight'></span>

<h3>Description</h3>

<p>The function <code>PSweight</code> is used to estimate the average potential outcomes corresponding to
each treatment group among the target population. The function currently implements
the following types of weights: the inverse probability of treatment weights (IPW: target population is the combined population),
average treatment effect among the treated weights (treated: target population is the population receiving a specified treatment),
overlap weights (overlap: target population is the overlap population at clinical equipoise), matching weights (matching: target population
is population obtained under 1:1 matching), entropy weights (entropy: target population is the population weighted by the entropy function).
Augmented propensity score weighting estimators are also allowed, with propensity scores and outcome model estimates either estimated
within the function, or supplied by external routines.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PSweight(
  ps.formula = NULL,
  ps.estimate = NULL,
  trtgrp = NULL,
  zname = NULL,
  yname,
  data,
  weight = "overlap",
  delta = 0,
  augmentation = FALSE,
  bootstrap = FALSE,
  R = 50,
  out.formula = NULL,
  out.estimate = NULL,
  family = "gaussian",
  ps.method = "glm",
  ps.control = list(),
  out.method = "glm",
  out.control = list()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="PSweight_+3A_ps.formula">ps.formula</code></td>
<td>
<p>an object of class <code><a href="stats.html#topic+formula">formula</a></code> (or one that can be coerced to that class):
a symbolic description of the propensity score model to be fitted. Additional details of model specification
are given under &quot;Details&quot;. This argument is optional if <code>ps.estimate</code> is not <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="PSweight_+3A_ps.estimate">ps.estimate</code></td>
<td>
<p>an optional matrix or data frame containing estimated (generalized) propensity scores for
each observation. Typically, this is an N by J matrix, where N is the number of observations and J is the
total number of treatment levels. Preferably, the column name of this matrix should match the name of treatment level,
if column name is missing or there is a mismatch, the column names would be assigned according to alphabatic order
of the treatment levels. A vector of propensity score estimates is also allowed in <code>ps.estimate</code>, in which
case a binary treatment is implied and the input is regarded as the propensity to receive the last category of
treatment by alphabatic order, unless otherwise stated by <code>trtgrp</code>.</p>
</td></tr>
<tr><td><code id="PSweight_+3A_trtgrp">trtgrp</code></td>
<td>
<p>an optional character defining the &quot;treated&quot; population for estimating the average treatment
effect among the treated (ATT). Only necessary if <code>weight = "treated"</code>. This option can also be used to specify
the treatment (in a two-treatment setting) when a vector argument is supplied for <code>ps.estimate</code>.
Default value is the last group in the alphebatic order.</p>
</td></tr>
<tr><td><code id="PSweight_+3A_zname">zname</code></td>
<td>
<p>an optional character specifying the name of the treatment variable in <code>data</code>.</p>
</td></tr>
<tr><td><code id="PSweight_+3A_yname">yname</code></td>
<td>
<p>an optional character specifying the name of the outcome variable in <code>data</code>.</p>
</td></tr>
<tr><td><code id="PSweight_+3A_data">data</code></td>
<td>
<p>an optional data frame containing the variables in the propensity score model
and outcome model (if augmented estimator is used). If not found in data, the variables are
taken from <code>environment(formula)</code>.</p>
</td></tr>
<tr><td><code id="PSweight_+3A_weight">weight</code></td>
<td>
<p>a character or vector of characters including the types of weights to be used.
<code>"IPW"</code> specifies the inverse probability of treatment weights for estimating the average treatment
effect among the combined population. <code>"treated"</code> specifies the weights for estimating the
average treatment effect among the treated. <code>"overlap"</code> specifies the (generalized) overlap weights
for estimating the average treatment effect among the overlap population, or population at
clinical equipoise. <code>"matching"</code> specifies the matching weights for estimating the average treatment effect
among the matched population (ATM). <code>"entropy"</code> specifies the entropy weights for the average treatment effect
of entropy weighted population (ATEN). Default is <code>"overlap"</code>.</p>
</td></tr>
<tr><td><code id="PSweight_+3A_delta">delta</code></td>
<td>
<p>trimming threshold for estimated (generalized) propensity scores.
Should be no larger than 1 / number of treatment groups. Default is 0, corresponding to no trimming.</p>
</td></tr>
<tr><td><code id="PSweight_+3A_augmentation">augmentation</code></td>
<td>
<p>logical. Indicate whether augmented weighting estimators should be used.
Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="PSweight_+3A_bootstrap">bootstrap</code></td>
<td>
<p>logical. Indaicate whether bootstrap is used to estimate the standard error
of the point estimates. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="PSweight_+3A_r">R</code></td>
<td>
<p>an optional integer indicating number of bootstrap replicates. Default is <code>R = 50</code>.</p>
</td></tr>
<tr><td><code id="PSweight_+3A_out.formula">out.formula</code></td>
<td>
<p>an object of class <code><a href="stats.html#topic+formula">formula</a></code> (or one that can be coerced to that class):
a symbolic description of the outcome model to be fitted. Additional details of model specification
are given under &quot;Details&quot;. This argument is optional if <code>out.estimate</code> is not <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="PSweight_+3A_out.estimate">out.estimate</code></td>
<td>
<p>an optional matrix or data frame containing estimated potential outcomes
for each observation. Typically, this is an N by J matrix, where N is the number of observations
and J is the total number of treatment levels. Preferably, the column name of this matrix should
match the name of treatment level, if column name is missing or there is a mismatch,
the column names would be assigned according to alphabatic order of the treatment levels, with a
similar mechanism as in <code>ps.estimate</code>.</p>
</td></tr>
<tr><td><code id="PSweight_+3A_family">family</code></td>
<td>
<p>a description of the error distribution and link function to be used in the outcome model.
Only required if <code>out.formula</code> is provided. Supported distributional families include
<code>"gaussian" (link = identity)</code>, <code>"binomial" (link = logit)</code> and <code>"poisson" (link = log)</code>.
See <code><a href="stats.html#topic+family">family</a></code> in <code><a href="stats.html#topic+glm">glm</a></code> for more details. Default is <code>"gaussian"</code>.</p>
</td></tr>
<tr><td><code id="PSweight_+3A_ps.method">ps.method</code></td>
<td>
<p>a character to specify the method for estimating propensity scores. <code>"glm"</code> is default, and <code>"gbm"</code> and <code>"SuperLearner"</code> are also allowed.</p>
</td></tr>
<tr><td><code id="PSweight_+3A_ps.control">ps.control</code></td>
<td>
<p>a list to specify additional options when <code>method</code> is set to <code>"gbm"</code> or <code>"SuperLearner"</code>.</p>
</td></tr>
<tr><td><code id="PSweight_+3A_out.method">out.method</code></td>
<td>
<p>a character to specify the method for estimating the outcome regression model. <code>"glm"</code> is default, and <code>"gbm"</code> and <code>"SuperLearner"</code> are also allowed.</p>
</td></tr>
<tr><td><code id="PSweight_+3A_out.control">out.control</code></td>
<td>
<p>a list to specify additional options when <code>out.method</code> is set to <code>"gbm"</code> or <code>"SuperLearner"</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A typical form for <code>ps.formula</code> is <code>treatment ~ terms</code> where <code>treatment</code> is the treatment
variable (identical to the variable name used to specify <code>zname</code>) and <code>terms</code> is a series of terms
which specifies a linear predictor for <code>treatment</code>. Similarly, a typical form for <code>out.formula</code> is
<code>outcome ~ terms</code> where <code>outcome</code> is the outcome variable (identical to the variable name
used to specify <code>yname</code>) and <code>terms</code> is a series of terms which specifies a linear
predictor for <code>outcome</code>. Both <code>ps.formula</code> and <code>out.formula</code> by default specify generalized
linear models when <code>ps.estimate</code> and/or <code>out.estimate</code> is <code>NULL</code>. The argument <code>ps.method</code> and <code>out.method</code> allow user to choose
model other than glm to fit the propensity score and outcome regression models for augmentation. Additional argument in the <code>gbm()</code> function can be supplied through the <code>ps.control</code> and <code>out.control</code> argument. Please refer to the user manual of the <code>gbm</code> package for all the
allowed arguments.  <code>"SuperLearner"</code> is also allowed in the <code>ps.method</code> and <code>out.method</code> arguments. Currently, the SuperLearner method only supports binary treatment with the default method set to <code>"SL.glm"</code>. The estimation approach is default to <code>"method.NNLS"</code> for both propensity and outcome regression models.
Prediction algorithm and other tuning parameters can also be passed through<code>ps.control</code> and <code>out.control</code>. Please refer to the user manual of the <code>SuperLearner</code> package for all the allowed specifications.
</p>
<p>When comparing two treatments, <code>ps.estimate</code> can either be a vector or a two-column matrix of estimated
propensity scores. If a vector is supplied, it is assumed to be the propensity scores to receive the treatment, and
the treatment group corresponds to the last group in the alphebatic order, unless otherwise specified by <code>trtgrp</code>.
When comparing multiple (J&gt;=3) treatments, <code>ps.estimate</code> needs to be specified as an N by J matrix,
where N indicates the number of observations, and J indicates the total number of treatments.
This matrix specifies the estimated generalized propensity scores to receive each of the J treatments.
In general, <code>ps.estimate</code> should have column names that indicate the level of the treatment variable,
which should match the levels given in <code>Z</code>.
If column names are empty or there is a mismatch, the column names will be created following
the alphebatic order of values in <code>Z</code>, and the rightmost coulmn of <code>ps.estimate</code> is assumed
to be the treatment group, when estimating ATT. <code>trtgrp</code> can also be used to specify the treatment
group for estimating ATT. The same mechanism applies to <code>out.estimate</code>, except that the input for <code>out.estimate</code>
must be an N by J matrix, where each row corresponds to the estimated potential outcomes (corresponding to each treatment)
for each observation.
</p>
<p>The argument <code>zname</code> and/or <code>yname</code> is required when <code>ps.estimate</code>
and/or <code>out.estimate</code> is not <code>NULL</code>.
</p>
<p>Current version of <code>PSweight</code> allows for five types of propensity score weights used to estimate ATE (IPW), ATT (treated) and
ATO (overlap), ATM (matching) and ATEN (entropy). These weights are members of larger class of balancing weights defined in Li, Morgan, and Zaslavsky (2018).
Specific definitions of these weights are provided in Li, Morgan, and Zaslavsky (2018), Li and Greene (2013), Zhou, Matsouaka and Thomas (2020).
When there is a practical violation of the positivity assumption, <code>delta</code> defines the symmetric
propensity score trimming rule following Crump et al. (2009). With multiple treatments, <code>delta</code> defines the
multinomial trimming rule introduced in Yoshida et al. (2019). The overlap weights can also be considered as
a data-driven continuous trimming strategy without specifying trimming rules, see Li, Thomas and Li (2019).
Additional details on balancing weights and generalized overlap weights for multiple treatment groups are provided in
Li and Li (2019).
</p>
<p>If <code>augmentation = TRUE</code>, an augmented weighting estimator will be implemented. For binary treatments, the augmented
weighting estimator is presented in Mao, Li and Greene (2018). For multiple treatments, the augmented weighting estimator is
mentioned in Li and Li (2019), and additional details will appear in our ongoing work (Zhou et al. 2020+). When
<code>weight = "IPW"</code>, the augmented estimator is also referred to as a doubly-robust (DR) estimator.
</p>
<p>When <code>bootstrap = TRUE</code>, the variance will be calculated by nonparametric bootstrap, with <code>R</code> bootstrap
replications. The default of <code>R</code> is 50. Otherwise, the variance will be calculated using the sandwich variance
formula obtained in the M-estimation framework.
</p>


<h3>Value</h3>

<p>PSweight returns a <code>PSweight</code> object containing a list of the following values:
estimated propensity scores, average potential outcomes corresponding to each treatment,
variance-covariance matrix of the point estimates, the label for each treatment group,
and estimates in each bootstrap replicate if <code>bootstrap = TRUE</code>.
A summary of PSweight can be obtained with <code><a href="#topic+summary.PSweight">summary.PSweight</a></code>.
</p>

<dl>
<dt><code> trtgrp</code></dt><dd><p>a character indicating the treatment group.</p>
</dd>
<dt><code> propensity</code></dt><dd><p>a data frame of estimated propensity scores.</p>
</dd>
<dt><code> muhat</code></dt><dd><p> average potential outcomes by treatment groups, with reference to specific target populations.</p>
</dd>
<dt><code> covmu</code></dt><dd><p> variance-covariance matrix of <code>muhat</code>.</p>
</dd>
<dt><code> muboot</code></dt><dd><p> an optional list of point estimates in each bootstrap replicate <code>bootstrap = TRUE</code>.</p>
</dd>
<dt><code> group</code></dt><dd><p> a table of treatment group labels corresponding to the output point estimates <code>muhat</code>.</p>
</dd>
</dl>



<h3>References</h3>

<p>Crump, R. K., Hotz, V. J., Imbens, G. W., Mitnik, O. A. (2009).
Dealing with limited overlap in estimation of average treatment effects. Biometrika, 96(1), 187-199.
</p>
<p>Li, L., Greene, T. (2013).
A weighting analogue to pair matching in propensity score analysis. The International Journal of Biostatistics, 9(2), 215-234.
</p>
<p>Li, F., Morgan, K. L., Zaslavsky, A. M. (2018).
Balancing covariates via propensity score weighting.
Journal of the American Statistical Association, 113(521), 390-400.
</p>
<p>Mao, H., Li, L., Greene, T. (2019). Propensity score weighting analysis and treatment effect discovery.
Statistical Methods in Medical Research, 28(8), 2439-2454.
</p>
<p>Li, F., Thomas, L. E., Li, F. (2019).
Addressing extreme propensity scores via the overlap weights. American Journal of Epidemiology, 188(1), 250-257.
</p>
<p>Yoshida, K., Solomon, D.H., Haneuse, S., Kim, S.C., Patorno, E., Tedeschi, S.K., Lyu, H.,
Franklin, J.M., Stürmer, T., Hernández-Díaz, S. and Glynn, R.J. (2019).
Multinomial extension of propensity score trimming methods: A simulation study.
American Journal of Epidemiology, 188(3), 609-616.
</p>
<p>Li, F., Li, F. (2019). Propensity score weighting for causal inference with multiple treatments.
The Annals of Applied Statistics, 13(4), 2389-2415.
</p>
<p>Zhou, Y., Matsouaka, R. A., Thomas, L. (2020).
Propensity score weighting under limited overlap and model misspecification. Statistical Methods in Medical Research, 29(12), 3721-3756.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("psdata")
# the propensity and outcome models
ps.formula&lt;-trt~cov1+cov2+cov3+cov4+cov5+cov6
out.formula&lt;-Y~cov1+cov2+cov3+cov4+cov5+cov6

# without augmentation
ato1&lt;-PSweight(ps.formula = ps.formula,yname = 'Y',data = psdata,weight = 'overlap')
summary(ato1)

# augmented weighting estimator, takes longer time to calculate sandwich variance
# ato2&lt;-PSweight(ps.formula = ps.formula,yname = 'Y',data = psdata,
#              augmentation = TRUE,out.formula = out.formula,family = 'gaussian',weight = 'overlap')
# summary(ato2)

</code></pre>

<hr>
<h2 id='PSweight_cl'>Estimate average causal effects by propensity score weighting for a binary treatment with clustering.</h2><span id='topic+PSweight_cl'></span>

<h3>Description</h3>

<p>The function <code>PSweight_cl</code> is used to estimate the average potential outcomes corresponding to
each treatment group among the target population with two-level data. The function currently implements
the following types of weights: the inverse probability of treatment weights (IPW: target population is the combined population),
average treatment effect among the treated weights (treated: target population is the population receiving a specified treatment),
overlap weights (overlap: target population is the overlap population at clinical equipoise), matching weights (matching: target population
is population obtained under 1:1 matching), entropy weights (entropy: target population is the population weighted by the entropy function).
Augmented propensity score weighting estimators are also allowed, with propensity scores and outcome model estimated
within the function through mixed effect model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PSweight_cl(
  ps.formula = NULL,
  trtgrp = NULL,
  yname,
  data,
  weight = "overlap",
  delta = 0,
  augmentation = FALSE,
  bootstrap = FALSE,
  bs_level = NULL,
  R = 50,
  out.formula = NULL,
  family = "gaussian",
  nAGQ = 1L
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="PSweight_cl_+3A_ps.formula">ps.formula</code></td>
<td>
<p>an object of class <code><a href="stats.html#topic+formula">formula</a></code> (or one that can be coerced to that class):
a symbolic description of the propensity score model to be fitted. Additional details of model specification
are given under &quot;Details&quot;.</p>
</td></tr>
<tr><td><code id="PSweight_cl_+3A_trtgrp">trtgrp</code></td>
<td>
<p>an optional character defining the &quot;treated&quot; population for estimating the average treatment
effect among the treated (ATT). Only necessary if <code>weight = "treated"</code>. This option can also be used to specify
the treatment (in a two-treatment setting) when a vector argument is supplied for <code>ps.estimate</code>.
Default value is the last group in the alphebatic order.</p>
</td></tr>
<tr><td><code id="PSweight_cl_+3A_yname">yname</code></td>
<td>
<p>an optional character specifying the name of the outcome variable in <code>data</code>.</p>
</td></tr>
<tr><td><code id="PSweight_cl_+3A_data">data</code></td>
<td>
<p>an optional data frame containing the variables in the propensity score model
and outcome model (if augmented estimator is used). If not found in data, the variables are
taken from <code>environment(formula)</code>.</p>
</td></tr>
<tr><td><code id="PSweight_cl_+3A_weight">weight</code></td>
<td>
<p>a character or vector of characters including the types of weights to be used.
<code>"IPW"</code> specifies the inverse probability of treatment weights for estimating the average treatment
effect among the combined population. <code>"treated"</code> specifies the weights for estimating the
average treatment effect among the treated. <code>"overlap"</code> specifies the (generalized) overlap weights
for estimating the average treatment effect among the overlap population, or population at
clinical equipoise. <code>"matching"</code> specifies the matching weights for estimating the average treatment effect
among the matched population (ATM). <code>"entropy"</code> specifies the entropy weights for the average treatment effect
of entropy weighted population (ATEN). Default is <code>"overlap"</code>.</p>
</td></tr>
<tr><td><code id="PSweight_cl_+3A_delta">delta</code></td>
<td>
<p>trimming threshold for estimated (generalized) propensity scores.
Should be no larger than 1 / number of treatment groups. Default is 0, corresponding to no trimming.</p>
</td></tr>
<tr><td><code id="PSweight_cl_+3A_augmentation">augmentation</code></td>
<td>
<p>logical. Indicate whether augmented weighting estimators should be used.
Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="PSweight_cl_+3A_bootstrap">bootstrap</code></td>
<td>
<p>logical. Indaicate whether bootstrap is used to estimate the standard error
of the point estimates. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="PSweight_cl_+3A_bs_level">bs_level</code></td>
<td>
<p>an optional character defining the cluster level (name of the variable) for each bootstrap resampling.
Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="PSweight_cl_+3A_r">R</code></td>
<td>
<p>an optional integer indicating number of bootstrap replicates. Default is <code>R = 50</code>.</p>
</td></tr>
<tr><td><code id="PSweight_cl_+3A_out.formula">out.formula</code></td>
<td>
<p>an object of class <code><a href="stats.html#topic+formula">formula</a></code> (or one that can be coerced to that class):
a symbolic description of the outcome model to be fitted. Additional details of model specification
are given under &quot;Details&quot;. Different from the out.formula in <code>PSweight</code>, this <code><a href="stats.html#topic+formula">formula</a></code> should include the treatment label with cooresponding cluster forms.</p>
</td></tr>
<tr><td><code id="PSweight_cl_+3A_family">family</code></td>
<td>
<p>a description of the error distribution and link function to be used in the outcome model.
Only required if <code>out.formula</code> is provided. Supported distributional families include
<code>"gaussian" (link = identity)</code>, <code>"binomial" (link = logit)</code> and <code>"poisson" (link = log)</code>.
See <code><a href="stats.html#topic+family">family</a></code> in <code><a href="stats.html#topic+glm">glm</a></code> for more details. Default is <code>"gaussian"</code>.</p>
</td></tr>
<tr><td><code id="PSweight_cl_+3A_nagq">nAGQ</code></td>
<td>
<p>integer scalar - the number of points per axis for evaluating the adaptive Gauss-Hermite approximation to the log-likelihood.
Defaults to 1, corresponding to the Laplace approximation. Please refer to lme4 package for more details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A typical form for <code>ps.formula</code> is <code>treatment ~ terms+1|clusters</code> where <code>treatment</code> is the treatment
variable  and <code>terms</code> is a series of terms
which specifies a linear predictor for <code>treatment</code> and cluster level effects. Similarly, a typical form for <code>out.formula</code> is
<code>outcome ~ treatment+terms+1|cluster</code> where <code>outcome</code> is the outcome variable (identical to the variable name
used to specify <code>yname</code>); <code>terms</code> is a series of terms which specifies a linear
predictor for <code>outcome</code>; <code>clusters</code> is the random effects term for clusters. Both <code>ps.formula</code> and <code>out.formula</code> by default specify generalized
linear mixed effect models.
</p>
<p>Current version of <code>PSweight_cl</code> allows for five types of propensity score weights used to estimate ATE (IPW), ATT (treated) and
ATO (overlap), ATM (matching) and ATEN (entropy). These weights are members of larger class of balancing weights defined in Li, Morgan, and Zaslavsky (2018).
Specific definitions of these weights are provided in Li, Morgan, and Zaslavsky (2018), Li and Greene (2013), Zhou, Matsouaka and Thomas (2020).
When there is a practical violation of the positivity assumption, <code>delta</code> defines the symmetric
propensity score trimming rule following Crump et al. (2009). The overlap weights can also be considered as
a data-driven continuous trimming strategy without specifying trimming rules, see Li, Thomas and Li (2019).
Additional details on balancing weights and generalized overlap weights for multiple treatment groups are provided in
Li and Li (2019).
</p>
<p>If <code>augmentation = TRUE</code>, an augmented weighting estimator will be implemented. For binary treatments, the augmented
weighting estimator is presented in Mao, Li and Greene (2018). When
<code>weight = "IPW"</code>, the augmented estimator is also referred to as a doubly-robust (DR) estimator.
</p>
<p>When <code>bootstrap = TRUE</code>, the variance will be calculated by nonparametric bootstrap, with <code>R</code> bootstrap
replications. <code>bs_level</code> needs to be specified as the variable name for the cluster in order to conduct cluster
level resampling and maintaining the cluster level coorelation. The default value <code>NULL</code> treat each observation independently.
The default of <code>R</code> is 50. Otherwise, the variance will be calculated using the sandwich variance
formula obtained in the M-estimation framework.
</p>


<h3>Value</h3>

<p>PSweight_cl returns a <code>PSweight</code> object containing a list of the following values:
estimated propensity scores, average potential outcomes corresponding to each treatment,
variance-covariance matrix of the point estimates, the label for each treatment group,
and estimates in each bootstrap replicate if <code>bootstrap = TRUE</code>.
A summary of PSweight_cl can be obtained with <code><a href="#topic+summary.PSweight">summary.PSweight</a></code>.
</p>

<dl>
<dt><code> trtgrp</code></dt><dd><p>a character indicating the treatment group.</p>
</dd>
<dt><code> propensity</code></dt><dd><p>a data frame of estimated propensity scores.</p>
</dd>
<dt><code> muhat</code></dt><dd><p> average potential outcomes by treatment groups, with reference to specific target populations.</p>
</dd>
<dt><code> covmu</code></dt><dd><p> variance-covariance matrix of <code>muhat</code>.</p>
</dd>
<dt><code> muboot</code></dt><dd><p> an optional list of point estimates in each bootstrap replicate <code>bootstrap = TRUE</code>.</p>
</dd>
<dt><code> group</code></dt><dd><p> a table of treatment group labels corresponding to the output point estimates <code>muhat</code>.</p>
</dd>
</dl>



<h3>References</h3>

<p>Li, F., Zaslavsky, A. M., Landrum, M. B. (2013).
Propensity score weighting with multilevel data. Statistics in Medicine, 32(19), 3373-3387.
</p>
<p>Fuentes, A., Lüdtke, O., Robitzsch, A. (2021).
Causal inference with multilevel data: A comparison of different propensit score weighting appropaches. Multivariate Behavioral Research, 1-24.
</p>
<p>Crump, R. K., Hotz, V. J., Imbens, G. W., Mitnik, O. A. (2009).
Dealing with limited overlap in estimation of average treatment effects. Biometrika, 96(1), 187-199.
</p>
<p>Li, L., Greene, T. (2013).
A weighting analogue to pair matching in propensity score analysis. The International Journal of Biostatistics, 9(2), 215-234.
</p>
<p>Li, F., Morgan, K. L., Zaslavsky, A. M. (2018).
Balancing covariates via propensity score weighting.
Journal of the American Statistical Association, 113(521), 390-400.
</p>
<p>Mao, H., Li, L., Greene, T. (2019). Propensity score weighting analysis and treatment effect discovery.
Statistical Methods in Medical Research, 28(8), 2439-2454.
</p>
<p>Li, F., Thomas, L. E., Li, F. (2019).
Addressing extreme propensity scores via the overlap weights. American Journal of Epidemiology, 188(1), 250-257.
</p>
<p>Yoshida, K., Solomon, D.H., Haneuse, S., Kim, S.C., Patorno, E., Tedeschi, S.K., Lyu, H.,
Franklin, J.M., Stürmer, T., Hernández-Díaz, S. and Glynn, R.J. (2019).
Multinomial extension of propensity score trimming methods: A simulation study.
American Journal of Epidemiology, 188(3), 609-616.
</p>
<p>Li, F., Li, F. (2019). Propensity score weighting for causal inference with multiple treatments.
The Annals of Applied Statistics, 13(4), 2389-2415.
</p>
<p>Zhou, Y., Matsouaka, R. A., Thomas, L. (2020).
Propensity score weighting under limited overlap and model misspecification. Statistical Methods in Medical Research 29(12), 3721-3756.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#data("psdata_cl")
#ps.formula&lt;-trt~cov1+cov2+cov3+cov4+cov5+cov6+(1|clt)
#ato_cl&lt;-PSweight(ps.formula = ps.formula,yname = 'Y',data = psdata_cl)
#summary(ato_cl)


</code></pre>

<hr>
<h2 id='summary.PSweight'>Summarize a PSweight object</h2><span id='topic+summary.PSweight'></span>

<h3>Description</h3>

<p><code>summary.PSweight</code> is used to summarize the results from <code><a href="#topic+PSweight">PSweight</a></code>.
The output contains the average causal effects defined by specific contrasts, as well as their
standard error estimates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'PSweight'
summary(object, contrast = NULL, type = "DIF", CI = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.PSweight_+3A_object">object</code></td>
<td>
<p>a PSweight object obtained from the <code><a href="#topic+PSweight">PSweight</a></code> function.</p>
</td></tr>
<tr><td><code id="summary.PSweight_+3A_contrast">contrast</code></td>
<td>
<p>a vector or matrix specifying the causal contrast of interest. The average causal effects will be
defined by such contrats. For multiple treatments, the contrast parameters are explained in Li and Li (2019)
for estimating general causal effects. Default is all pairwise contrasts between any two treatment groups.</p>
</td></tr>
<tr><td><code id="summary.PSweight_+3A_type">type</code></td>
<td>
<p>a character specifying the target estimand. The most commonly seen additive estimand is specified
by <code>type = "DIF"</code>, abbreviated for weighted difference-in-means. This is the usual pairwise average treatment
effects as those defined in Li, Morgan, and Zaslavsky (2018) and Li and Li (2019). For binary (or count outcomes), we also
allow two ratio estimands: causal relative risk (<code>type = "RR"</code>) and causal odds ratio (<code>type = "OR"</code>).
Estimates for these two ratio estimands will be reported on the log scale (log relative risk and log
odds ratio) to improve the approximate for asymptotic normality. With binary outcomes, <code>"DIF"</code> is the same
as the average causal risk difference. Default is &quot;DIF&quot; if left empty.</p>
</td></tr>
<tr><td><code id="summary.PSweight_+3A_ci">CI</code></td>
<td>
<p>a logical argument indicates whether confidence interval should be calculated. Default is <code>CI = TRUE</code>.</p>
</td></tr>
<tr><td><code id="summary.PSweight_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For the <code>contrast</code> argument, one specifies the contrast of interest and thus defines the target estimand
for comparing treatments. For example, if there are three treatment levels: A, B, and C, the contrast A-C
(i.e., E[Y(A)] - E[Y(C)]) can be specified by <code>c(1,0,-1)</code>. The contrasts of A-C and B-C can be
jointly specified by <code>rbind(c(1,0,-1), c(0,1,-1))</code>.
</p>
<p>For estimating the causal relative risk (<code>type = "RR"</code>), the contrast is specified at the log scale. For example,
the contrast A-C (specified by <code>c(1,0,-1)</code>) implies the estimation of log{E[Y(A)]} - log{E[Y(C)]}. For estimating the causal odds
ratio, the contrast is specified at the log odds scale. For example, the contrast A-C (specified by <code>c(1,0,-1)</code>)
implies the estimation of log{E[Y(A)]/E[1-Y(A)]} - log{E[Y(C)]/E[1-Y(C)]}.
</p>
<p>The variance of the contrasts will be estimated by the delta method (if sandwich variance is used, or
<code>bootstrap = FALSE</code>), or nonparametric bootstrap (if <code>bootstrap = TRUE</code>). Details will be given in
Zhou et al. (2020+).
</p>
<p>The argument <code>type</code> takes one of three options: <code>"DIF"</code>, <code>"RR"</code>, or <code>"RR"</code>, with <code>"DIF"</code> as
the default option. Typically, <code>"RR"</code> is relavent for binary or count outcomes, and <code>"OR"</code> is relavent
only for binary outcomes. <code>"DIF"</code> applies to all types of outcomes.
</p>


<h3>Value</h3>

<p>A list of following values:
</p>

<dl>
<dt><code> estimates</code></dt><dd><p> a matrix of point estimates, standard errors, test statistics, 95
for contrasts of interest.</p>
</dd>
<dt><code> bootestimates</code></dt><dd><p> a list of data frames containing estimated contrasts in each bootstrap replicate,
if bootstrap is used to estimate standard errors.</p>
</dd>
<dt><code> contrast</code></dt><dd><p> a table listing the specified contrasts of interest.</p>
</dd>
<dt><code> group</code></dt><dd><p> a table of treatment group labels corresponding to the output point estimates, provided in results
obtained from <code><a href="#topic+PSweight">PSweight</a></code>.</p>
</dd>
<dt><code> trtgrp</code></dt><dd><p> a character indicating the treatment group, or target population under ATT weights.</p>
</dd>
<dt><code> type</code></dt><dd><p> a character specifying the target estimand.</p>
</dd>
<dt><code> CI</code></dt><dd><p>a logical indaicator of whether confidence interval should be reported.</p>
</dd>
</dl>



<h3>References</h3>

<p>Li, F., Morgan, K. L., Zaslavsky, A. M. (2018).
Balancing covariates via propensity score weighting.
Journal of the American Statistical Association, 113(521), 390-400.
</p>
<p>Li, F., Li, F. (2019). Propensity score weighting for causal inference with multiple treatments.
The Annals of Applied Statistics, 13(4), 2389-2415.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## For examples, run: example(PSweight).

</code></pre>

<hr>
<h2 id='summary.SumStat'>Summarize a SumStat object.</h2><span id='topic+summary.SumStat'></span>

<h3>Description</h3>

<p><code>summary.SumStat</code> is used to summarize results obtained from function
<code><a href="#topic+SumStat">SumStat</a></code>. The output includes effective sample sizes and tables for balance statistics.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'SumStat'
summary(object, weighted.var = TRUE, metric = "ASD", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.SumStat_+3A_object">object</code></td>
<td>
<p>a <code>SumStat</code> object obtained with the <code><a href="#topic+SumStat">SumStat</a></code> function.</p>
</td></tr>
<tr><td><code id="summary.SumStat_+3A_weighted.var">weighted.var</code></td>
<td>
<p>logical. Indicate whether the propensity score weighted variance should be used in calculating the balance metrics. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="summary.SumStat_+3A_metric">metric</code></td>
<td>
<p>a chatacter indicating the type of balance metrics. <code>"ASD"</code> refers to the pairwise absolute standardized difference and <code>"PSD"</code> refers to the population standardized difference. Default is <code>"ASD"</code>.</p>
</td></tr>
<tr><td><code id="summary.SumStat_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For <code>metric</code>, the two options <code>"ASD"</code> and <code>"PSD"</code> are defined in Li and Li (2019)
for the general family of balancing weights. Similar definitions are also given in McCaffrey et al. (2013)
for inverse probability weighting. <code>weighted.var</code> specifies whether weighted or unweighted variance
should be used in calculating ASD or PSD. An example of weighted variance with two treatment groups is given in
Austin and Stuart (2015). For more than two treatment groups, the maximum of ASD (across all pairs of treatments)
and maximum of PSD (across all treatments) are calcualted, as explained in Li and Li (2019).
</p>


<h3>Value</h3>

<p>A list of tables containing effective sample sizes and balance statistics on covariates
for specified propensity score weighting schemes.
</p>

<dl>
<dt><code> effective.sample.size</code></dt><dd><p>a table of effective sample sizes. This serves as a conservative measure to
characterize the variance inflation or precision loss due to weighting, see Li and Li (2019).</p>
</dd>
<dt><code> unweighted</code></dt><dd><p>A table summarizing mean, variance by treatment groups, and standardized mean difference.</p>
</dd>
<dt><code> IPW</code></dt><dd><p>If <code>"IPW"</code> is specified, this is a data table summarizing mean, variance by treatment groups,
and standardized mean difference under inverse probability of treatment weighting.</p>
</dd>
<dt><code> treated</code></dt><dd><p>If <code>"treated"</code> is specified, this is a data table summarizing mean, variance by treatment groups,
and standardized mean difference under the ATT weights.</p>
</dd>
<dt><code> overlap</code></dt><dd><p>If <code>"overlap"</code> is specified, this is a data table summarizing mean, variance by treatment groups,
and standardized mean difference under the (generalized) overlap weights.</p>
</dd>
<dt><code> matching</code></dt><dd><p>If <code>"matching"</code> is specified, this is a data table summarizing mean, variance by treatment groups,
and standardized mean difference under the (generalized) matching weights.</p>
</dd>
<dt><code> entropy</code></dt><dd><p>If <code>"entropy"</code> is specified, this is a data table summarizing mean, variance by treatment groups,
and standardized mean difference under the (generalized) entropy weights.</p>
</dd>
</dl>



<h3>References</h3>

<p>Crump, R. K., Hotz, V. J., Imbens, G. W., Mitnik, O. A. (2009).
Dealing with limited overlap in estimation of average treatment effects. Biometrika, 96(1), 187-199.
</p>
<p>Li, L., Greene, T. (2013).
A weighting analogue to pair matching in propensity score analysis. The International Journal of Biostatistics, 9(2), 215-234.
</p>
<p>Austin, P.C. and Stuart, E.A. (2015). Moving towards best practice when using inverse probability of treatment weighting (IPTW) using the propensity score to estimate causal treatment effects in observational studies.
Statistics in Medicine, 34(28), 3661-3679.
</p>
<p>Li, F., Li, F. (2019). Propensity score weighting for causal inference with multiple treatments.
The Annals of Applied Statistics, 13(4), 2389-2415.
</p>
<p>Zhou, Y., Matsouaka, R. A., Thomas, L. (2020).
Propensity score weighting under limited overlap and model misspecification. Statistical Methods in Medical Research (Online)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## For examples, run: example(SumStat).
</code></pre>

<hr>
<h2 id='SumStat'>Calculate summary statistics for propensity score weighting</h2><span id='topic+SumStat'></span>

<h3>Description</h3>

<p><code>SumStat</code> is used to generate distributional plots of the estimated propensity scores and balance
diagnostics after propensity score weighting.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SumStat(
  ps.formula = NULL,
  ps.estimate = NULL,
  trtgrp = NULL,
  Z = NULL,
  covM = NULL,
  zname = NULL,
  xname = NULL,
  data = NULL,
  weight = "overlap",
  delta = 0,
  method = "glm",
  ps.control = list()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SumStat_+3A_ps.formula">ps.formula</code></td>
<td>
<p>an object of class <code><a href="stats.html#topic+formula">formula</a></code> (or one that can be coerced to that class): a symbolic description of the propensity score model to be fitted. Additional details of model specification are given under &quot;Details&quot;. This argument is optional if <code>ps.estimate</code> is not <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="SumStat_+3A_ps.estimate">ps.estimate</code></td>
<td>
<p>an optional matrix or data frame containing estimated (generalized) propensity scores for each observation. Typically, this is an N by J matrix, where N is the number of observations and J is the total number of treatment levels. Preferably, the column names of this matrix should match the names of treatment level, if column names are missing or there is a mismatch, the column names would be assigned according to the alphabatic order of treatment levels. A vector of propensity score estimates is also allowed in <code>ps.estimate</code>, in which case a binary treatment is implied and the input is regarded as the propensity to receive the last category of treatment by alphabatic order, unless otherwise stated by <code>trtgrp</code>.</p>
</td></tr>
<tr><td><code id="SumStat_+3A_trtgrp">trtgrp</code></td>
<td>
<p>an optional character defining the &quot;treated&quot; population for estimating the average treatment effect among the treated (ATT). Only necessary if <code>weight = "treated"</code>. This option can also be used to specify the treatment (in a two-treatment setting) when a vector argument is supplied for <code>ps.estimate</code>. Default value is the last group in the alphebatic order.</p>
</td></tr>
<tr><td><code id="SumStat_+3A_z">Z</code></td>
<td>
<p>an optional vector specifying the values of treatment, only necessary when the covariate matrix <code>covM</code> is provided instead of <code>data</code>.</p>
</td></tr>
<tr><td><code id="SumStat_+3A_covm">covM</code></td>
<td>
<p>an optional covariate matrix or data frame including covariates, their interactions and higher-order terms. When the covariate matrix <code>covM</code> is provided, the balance statistics are generated according to each column of this matrix.</p>
</td></tr>
<tr><td><code id="SumStat_+3A_zname">zname</code></td>
<td>
<p>an optional character specifying the name of the treatment variable in <code>data</code>.</p>
</td></tr>
<tr><td><code id="SumStat_+3A_xname">xname</code></td>
<td>
<p>an optional vector of characters including the names of covariates in <code>data</code>.</p>
</td></tr>
<tr><td><code id="SumStat_+3A_data">data</code></td>
<td>
<p>an optional data frame containing the variables in the propensity score model. If not found in data, the variables are taken from <code>environment(formula)</code>.</p>
</td></tr>
<tr><td><code id="SumStat_+3A_weight">weight</code></td>
<td>
<p>a character or vector of characters including the types of weights to be used. <code>"IPW"</code> specifies the inverse probability weights for estimating the average treatment effect among the combined population (ATE). <code>"treated"</code> specifies the weights for estimating the average treatment effect among the treated (ATT). <code>"overlap"</code> specifies the (generalized) overlap weights for estimating the average treatment effect among the overlap population (ATO), or population at clinical equipoise. <code>"matching"</code> specifies the matching weights for estimating the average treatment effect among the matched population (ATM). <code>"entropy"</code> specifies the entropy weights for the average treatment effect of entropy weighted population (ATEN). Default is <code>"overlap"</code>.</p>
</td></tr>
<tr><td><code id="SumStat_+3A_delta">delta</code></td>
<td>
<p>trimming threshold for estimated (generalized) propensity scores. Should be no larger than 1 / number of treatment groups. Default is 0, corresponding to no trimming.</p>
</td></tr>
<tr><td><code id="SumStat_+3A_method">method</code></td>
<td>
<p>a character to specify the method for estimating propensity scores. <code>"glm"</code> is default, and <code>"gbm"</code> and <code>"SuperLearner"</code> are also allowed.</p>
</td></tr>
<tr><td><code id="SumStat_+3A_ps.control">ps.control</code></td>
<td>
<p>a list to specify additional options when <code>method</code> is set to <code>"gbm"</code> or <code>"SuperLearner"</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A typical form for <code>ps.formula</code> is <code>treatment ~ terms</code> where <code>treatment</code> is the treatment
variable (identical to the variable name used to specify <code>zname</code>) and <code>terms</code> is a series of terms
which specifies a linear predictor for <code>treatment</code>. <code>ps.formula</code> specifies logistic or multinomial logistic
models for estimating the propensity scores, when <code>ps.estimate</code> is <code>NULL</code>.
</p>
<p>When comparing two treatments, <code>ps.estimate</code> can either be a vector or a two-column matrix of estimated
propensity scores. If a vector is supplied, it is assumed to be the propensity scores to receive the treatment, and
the treatment group corresponds to the last group in the alphebatic order, unless otherwise specified by <code>trtgrp</code>.
When comparing multiple (J&gt;=3) treatments, <code>ps.estimate</code> needs to be specified as an N by J matrix,
where N indicates the number of observations, and J indicates the total number of treatments.
This matrix specifies the estimated generalized propensity scores to receive each of the J treatments.
In general, <code>ps.estimate</code> should have column names that indicate the level of the treatment variable,
which should match the levels given in <code>Z</code>.
If column names are empty or there is a mismatch, the column names will be created following
the alphebatic order of treatmentlevels. The rightmost coulmn of <code>ps.estimate</code> is then assumed
to be the treatment group when estimating ATT (<code>"treated"</code>). <code>trtgrp</code> can also be used to specify the treatment
group for estimating ATT.
</p>
<p>To generate balance statistics, one can directly specify <code>Z</code> and <code>covM</code> to indicate the treatment levels and
covariate matrix. Alternatively, one can supply <code>data</code>, <code>zname</code>, and <code>xname</code> to indicate the
same information. When both are specified, the function will prioritize inputs from <code>Z</code> and <code>covM</code>.
When <code>ps.estimate</code> is not <code>NULL</code>, argument <code>zname</code>.
</p>
<p>Current version of <code>PSweight</code> allows for five types of propensity score weights used to estimate ATE (<code>"IPW"</code>), ATT (<code>"treated"</code>), and
ATO(<code>"overlap"</code>), ATM (<code>"matching"</code>) and ATEN (<code>"entropy"</code>). These weights are members of a larger class of balancing weights defined in Li, Morgan, and Zaslavsky (2018).
When there is a practical violation of the positivity assumption, <code>delta</code> defines the symmetric
propensity score trimming rule following Crump et al. (2009). With multiple treatments, <code>delta</code> defines the
multinomial trimming rule introduced in Yoshida et al. (2019). The overlap weights can also be considered as
a data-driven continuous trimming strategy without specifying trimming rules, see Li, Thomas and Li (2019).
Additional details on balancing weights and generalized overlap weights for multiple treatment groups are provided in
Li and Li (2019). For details about matching weights and entropy weights, please refer to Li and Greene (2013) and Zhou, Matsouaka and Thomas (2020).
</p>
<p><code>"glm"</code> is the default method for propensity score estimation. Logistic regression will be used for binary outcomes,
and multinomial logistic regression will be used for outcomes with more than two categories. The alternative method option of <code>"gbm"</code> serves as an API to call the <code>gbm()</code> function from the
<code>gbm</code> package. Additional argument in the <code>gbm()</code> function can be supplied through the <code>ps.control=list()</code> argument in <code>SumStat()</code>. Please refer to the user manual of the gbm package for all the
allowed arguments. Currently, models for binary or multinomial treatment will be automatically chosen based on the number of treatment categories.
<code>"SuperLearner"</code> is also allowed in the <code>method</code> argument to pass the propensity score estimation to the <code>SuperLearner()</code> function in SuperLearner package.
Currently, the SuperLearner method only supports binary treatment with the default method set to <code>"SL.glm"</code>. The estimation approach is default to <code>"method.NNLS"</code> in the <code>SumStat()</code> function.
Prediction algorithm and other tuning parameters can also be passed through <code>ps.control=list()</code> to <code>SumStat()</code>. Please refer to the user manual of the <code>SuperLearner</code> package for all the allowed specifications.
</p>


<h3>Value</h3>

<p>SumStat returns a <code>SumStat</code> object including a list of the following value:
treatment group, propensity scores, fitted propensity model, propensity score weights, effective sample sizes,
and balance statistics. A summary of <code>SumStat</code> can be obtained with <code><a href="#topic+summary.SumStat">summary.SumStat</a></code>.
</p>

<dl>
<dt><code> trtgrp</code></dt><dd><p>a character indicating the treatment group.</p>
</dd>
<dt><code> propensity</code></dt><dd><p>a data frame of estimated propensity scores.</p>
</dd>
<dt><code> ps.fitObjects</code></dt><dd><p>the fitted propensity model details</p>
</dd>
<dt><code> ps.weights</code></dt><dd><p>a data frame of propensity score weights.</p>
</dd>
<dt><code> ess</code></dt><dd><p>a table of effective sample sizes. This serves as a conservative measure to
characterize the variance inflation or precision loss due to weighting, see Li and Li (2019).</p>
</dd>
<dt><code> unweighted.sumstat</code></dt><dd><p>A list of tables including covariate means and variances
by treatment group and standardized mean differences.</p>
</dd>
<dt><code> ATE.sumstat</code></dt><dd><p>If <code>"IPW"</code> is included in <code>weight</code>, this is a list of summary statistics using inverse probability weighting.</p>
</dd>
<dt><code> ATT.sumstat</code></dt><dd><p>If <code>"treated"</code> is included in <code>weight</code>, this is a list of summary statistics using the ATT weights.</p>
</dd>
<dt><code> ATO.sumstat</code></dt><dd><p>If <code>"overlap"</code> is included in <code>weight</code>, this is a list of summary statistics using the overlap weights.</p>
</dd>
<dt><code> ATM.sumstat</code></dt><dd><p>If <code>"matching"</code> is included in <code>weight</code>, this is a list of summary statistics using the matching weights.</p>
</dd>
<dt><code> ATEN.sumstat</code></dt><dd><p>If <code>"entropy"</code> is included in <code>weight</code>, this is a list of summary statistics using the entropy weights.</p>
</dd>
<dt><code> trim</code></dt><dd><p>If <code>delta &gt; 0</code>, this is a table summarizing the number of observations before and after trimming.</p>
</dd>
</dl>



<h3>References</h3>

<p>Crump, R. K., Hotz, V. J., Imbens, G. W., Mitnik, O. A. (2009).
Dealing with limited overlap in estimation of average treatment effects. Biometrika, 96(1), 187-199.
</p>
<p>Greenwell B., Boehmke B.,Cunningham J, GBM Developers (2020) gbm: Generalized Boosted Regression Models. Cran: https://cran.r-project.org/web/packages/gbm/index.html
</p>
<p>Li, L., Greene, T. (2013).
A weighting analogue to pair matching in propensity score analysis. The International Journal of Biostatistics, 9(2), 215-234.
</p>
<p>Li, F., Morgan, K. L., Zaslavsky, A. M. (2018).
Balancing covariates via propensity score weighting.
Journal of the American Statistical Association, 113(521), 390-400.
</p>
<p>Li, F., Thomas, L. E., Li, F. (2019).
Addressing extreme propensity scores via the overlap weights. American Journal of Epidemiology, 188(1), 250-257.
</p>
<p>Polley E., LeDell E., Kennedy C., Lendle S., van der Laan M. (2019) SuperLearner: Super Learner Prediction. Cran: https://cran.r-project.org/web/packages/SuperLearner/index.html
</p>
<p>Yoshida, K., Solomon, D.H., Haneuse, S., Kim, S.C., Patorno, E., Tedeschi, S.K., Lyu, H.,
Franklin, J.M., Stürmer, T., Hernández-Díaz, S. and Glynn, R.J. (2019).
Multinomial extension of propensity score trimming methods: A simulation study.
American Journal of Epidemiology, 188(3), 609-616.
</p>
<p>Li, F., Li, F. (2019). Propensity score weighting for causal inference with multiple treatments.
The Annals of Applied Statistics, 13(4), 2389-2415.
</p>
<p>Zhou, Y., Matsouaka, R. A., Thomas, L. (2020).
Propensity score weighting under limited overlap and model misspecification. Statistical Methods in Medical Research (Online)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("psdata")
# the propensity model
ps.formula&lt;-trt~cov1+cov2+cov3+cov4+cov5+cov6

# using SumStat to estimate propensity scores
msstat &lt;- SumStat(ps.formula, trtgrp="2", data=psdata,
   weight=c("IPW","overlap","treated","entropy","matching"))
#summary(msstat)

# importing user-supplied propensity scores "e.h"
# fit &lt;- nnet::multinom(formula=ps.formula, data=psdata, maxit=500, trace=FALSE)
# e.h &lt;- fit$fitted.values
# varname &lt;- c("cov1","cov2","cov3","cov4","cov5","cov6")
# msstat0 &lt;- SumStat(zname="trt", xname=varname, data=psdata, ps.estimate=e.h,
#  trtgrp="2",  weight=c("IPW","overlap","treated","entropy","matching"))
# summary(msstat0)

</code></pre>

<hr>
<h2 id='SumStat_cl'>Calculate summary statistics for propensity score weighting with clustering (for binary treatment only)</h2><span id='topic+SumStat_cl'></span>

<h3>Description</h3>

<p><code>SumStat_cl</code> is used to generate distributional plots of the estimated propensity scores and balance
diagnostics after propensity score weighting with two-level data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SumStat_cl(
  ps.formula = NULL,
  trtgrp = NULL,
  data = NULL,
  weight = "overlap",
  delta = 0,
  nAGQ = 1L
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SumStat_cl_+3A_ps.formula">ps.formula</code></td>
<td>
<p>an object of class <code><a href="stats.html#topic+formula">formula</a></code> (or one that can be coerced to that class): a symbolic description of the propensity score model to be fitted. Additional details of model specification are given under &quot;Details&quot;.</p>
</td></tr>
<tr><td><code id="SumStat_cl_+3A_trtgrp">trtgrp</code></td>
<td>
<p>an optional character defining the &quot;treated&quot; population for estimating the average treatment effect among the treated (ATT). Only necessary if <code>weight = "treated"</code>. This option can also be used to specify the treatment (in a two-treatment setting). Default value is the last group in the alphebatic order.</p>
</td></tr>
<tr><td><code id="SumStat_cl_+3A_data">data</code></td>
<td>
<p>an data frame containing the variables in the propensity score model. If not found in data, the variables are taken from <code>environment(formula)</code>.</p>
</td></tr>
<tr><td><code id="SumStat_cl_+3A_weight">weight</code></td>
<td>
<p>a character or vector of characters including the types of weights to be used. <code>"IPW"</code> specifies the inverse probability weights for estimating the average treatment effect among the combined population (ATE). <code>"treated"</code> specifies the weights for estimating the average treatment effect among the treated (ATT). <code>"overlap"</code> specifies the (generalized) overlap weights for estimating the average treatment effect among the overlap population (ATO), or population at clinical equipoise. <code>"matching"</code> specifies the matching weights for estimating the average treatment effect among the matched population (ATM). <code>"entropy"</code> specifies the entropy weights for the average treatment effect of entropy weighted population (ATEN). Default is <code>"overlap"</code>.</p>
</td></tr>
<tr><td><code id="SumStat_cl_+3A_delta">delta</code></td>
<td>
<p>trimming threshold for estimated (generalized) propensity scores. Should be no larger than 1 / number of treatment groups. Default is 0, corresponding to no trimming.</p>
</td></tr>
<tr><td><code id="SumStat_cl_+3A_nagq">nAGQ</code></td>
<td>
<p>integer scalar - the number of points per axis for evaluating the adaptive Gauss-Hermite approximation to the log-likelihood.
Defaults to 1, corresponding to the Laplace approximation. Please refer to lme4 package for more details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A typical form for <code>ps.formula</code> is <code>treatment ~ terms+1|clusters</code> where <code>treatment</code> is the treatment
variable, <code>terms</code> is a series of terms
which specifies a linear predictor for <code>treatment</code>, and <code>clusters</code> is the cluster indicator. The current version supports two-level models and the random-effects term is required to be the last piece in the formula. <code>ps.formula</code> specifies a mixed-effects logistic regression
model for estimating propensity scores. The treatment group corresponds to the last group in the alphebatic order, unless otherwise specified by <code>trtgrp</code>.
</p>
<p>Current version of <code>PSweight</code> allows for five types of propensity score weights used to estimate ATE (<code>"IPW"</code>), ATT (<code>"treated"</code>), and
ATO(<code>"overlap"</code>), ATM (<code>"matching"</code>) and ATEN (<code>"entropy"</code>). These weights are members of a larger class of balancing weights defined in Li, Morgan, and Zaslavsky (2018).
When there is a practical violation of the positivity assumption, <code>delta</code> defines the symmetric
propensity score trimming rule following Crump et al. (2009). With multiple treatments, <code>delta</code> defines the
multinomial trimming rule introduced in Yoshida et al. (2019). The overlap weights can also be considered as
a data-driven continuous trimming strategy without specifying trimming rules, see Li, Thomas and Li (2019).
Additional details on balancing weights and generalized overlap weights for multiple treatment groups are provided in
Li and Li (2019). For details about matching weights and entropy weights, please refer to Li and Greene (2013) and Zhou, Matsouaka and Thomas (2020).
</p>


<h3>Value</h3>

<p>SumStat_cl returns a <code>SumStat</code> object including a list of the following value:
treatment group, propensity scores, fitted propensity model, propensity score weights, effective sample sizes,
and balance statistics. A summary of <code>SumStat</code> can be obtained with <code><a href="#topic+summary.SumStat">summary.SumStat</a></code>.
</p>

<dl>
<dt><code> trtgrp</code></dt><dd><p>a character indicating the treatment group.</p>
</dd>
<dt><code> propensity</code></dt><dd><p>a data frame of estimated propensity scores.</p>
</dd>
<dt><code> ps.fitObjects</code></dt><dd><p>the fitted propensity model details</p>
</dd>
<dt><code> ps.weights</code></dt><dd><p>a data frame of propensity score weights.</p>
</dd>
<dt><code> ess</code></dt><dd><p>a table of effective sample sizes. This serves as a conservative measure to
characterize the variance inflation or precision loss due to weighting, see Li and Li (2019).</p>
</dd>
<dt><code> unweighted.sumstat</code></dt><dd><p>A list of tables including covariate means and variances
by treatment group and standardized mean differences.</p>
</dd>
<dt><code> ATE.sumstat</code></dt><dd><p>If <code>"IPW"</code> is included in <code>weight</code>, this is a list of summary statistics using inverse probability weighting.</p>
</dd>
<dt><code> ATT.sumstat</code></dt><dd><p>If <code>"treated"</code> is included in <code>weight</code>, this is a list of summary statistics using the ATT weights.</p>
</dd>
<dt><code> ATO.sumstat</code></dt><dd><p>If <code>"overlap"</code> is included in <code>weight</code>, this is a list of summary statistics using the overlap weights.</p>
</dd>
<dt><code> ATM.sumstat</code></dt><dd><p>If <code>"matching"</code> is included in <code>weight</code>, this is a list of summary statistics using the matching weights.</p>
</dd>
<dt><code> ATEN.sumstat</code></dt><dd><p>If <code>"entropy"</code> is included in <code>weight</code>, this is a list of summary statistics using the entropy weights.</p>
</dd>
<dt><code> trim</code></dt><dd><p>If <code>delta &gt; 0</code>, this is a table summarizing the number of observations before and after trimming.</p>
</dd>
</dl>



<h3>References</h3>

<p>Crump, R. K., Hotz, V. J., Imbens, G. W., Mitnik, O. A. (2009).
Dealing with limited overlap in estimation of average treatment effects. Biometrika, 96(1), 187-199.
</p>
<p>Li, L., Greene, T. (2013).
A weighting analogue to pair matching in propensity score analysis. The International Journal of Biostatistics, 9(2), 215-234.
</p>
<p>Li, F., Morgan, K. L., Zaslavsky, A. M. (2018).
Balancing covariates via propensity score weighting.
Journal of the American Statistical Association, 113(521), 390-400.
</p>
<p>Li, F., Thomas, L. E., Li, F. (2019).
Addressing extreme propensity scores via the overlap weights. American Journal of Epidemiology, 188(1), 250-257.
</p>
<p>Li, F., Li, F. (2019). Propensity score weighting for causal inference with multiple treatments.
The Annals of Applied Statistics, 13(4), 2389-2415.
</p>
<p>Zhou, Y., Matsouaka, R. A., Thomas, L. (2020).
Propensity score weighting under limited overlap and model misspecification. Statistical Methods in Medical Research 29(12), 3721-3756.
</p>
<p>Li, F., Zaslavsky, A. M., &amp; Landrum, M. B. (2013). Propensity score weighting with multilevel data. Statistics in Medicine, 32(19), 3373-3387.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("psdata_cl")
# the propensity model
# ps.formula&lt;-trt~cov1+cov2+cov3+cov4+cov5+cov6+(1|clt)

# using SumStat to estimate propensity scores
# msstat &lt;- SumStat_cl(ps.formula, trtgrp="1", data=psdata_cl,
#   weight=c("IPW","overlap","treated","entropy","matching"))
#summary(msstat)

</code></pre>

<hr>
<h2 id='vcov.PSweight'>Variance of PSweight</h2><span id='topic+vcov.PSweight'></span>

<h3>Description</h3>

<p>The <code><a href="stats.html#topic+vcov">vcov</a></code> method for class &quot;PSweight&quot;
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'PSweight'
vcov(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vcov.PSweight_+3A_object">object</code></td>
<td>
<p>an object used to select a method.</p>
</td></tr>
<tr><td><code id="vcov.PSweight_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The output from <code><a href="stats.html#topic+vcov">vcov</a></code>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
