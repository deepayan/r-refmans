<!DOCTYPE html><html><head><title>Help for package twopartm</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {twopartm}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#AME'><p>Average Marginal Effect (AME) with CIs for Two-part Model Objects</p></a></li>
<li><a href='#bioChemists'><p>Articles by Graduate Students in Biochemistry Ph.D. Programs</p></a></li>
<li><a href='#coef-methods'><p>Method for Function <code>coef</code> for Two-part Model Objects in Package <span class="pkg">twopartm</span></p></a></li>
<li><a href='#FiellerRatio'><p>Ratio of two Gaussian random variables with CI by Fieller's theorem</p></a></li>
<li><a href='#logLik-methods'><p>Method for Function <code>logLik</code> for Two-part Model Objects in Package <span class="pkg">twopartm</span></p></a></li>
<li><a href='#margin'><p>Predictive Margins with CIs for Two-part Model Objects</p></a></li>
<li><a href='#meps'><p>A Sample of Medical Expenditure Panel Survey 2004 data</p></a></li>
<li><a href='#plot-methods'><p>Method for Function <code>plot</code> for Two-part Model Objects in Package <span class="pkg">twopartm</span></p></a></li>
<li><a href='#predict-methods'><p>Method for Function <code>predict</code> for Two-part Model Fits in Package <span class="pkg">twopartm</span></p></a></li>
<li><a href='#residuals-methods'><p>Method for Function <code>residuals</code> for Two-part Model Objects in Package <span class="pkg">twopartm</span></p></a></li>
<li><a href='#tpm'><p>Fit Two-part Regression Models for Zero-inflated Data</p></a></li>
<li><a href='#twopartm-class'><p>Class <code>twopartm</code></p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Two-Part Model with Marginal Effects</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Yajie Duan &lt;yajieritaduan@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Fit two-part regression models for zero-inflated data. The models and their components are represented using S4 classes and methods. Average Marginal effects and predictive margins with standard errors and
  confidence intervals can be calculated from two-part model objects. Belotti, F., Deb, P., Manning, W. G., &amp; Norton, E. C. (2015) &lt;<a href="https://doi.org/10.1177%2F1536867X1501500102">doi:10.1177/1536867X1501500102</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>Imports:</td>
<td>methods, graphics, stats, data.table, MASS</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.1</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-10-13 09:57:19 UTC; Yajie Duan</td>
</tr>
<tr>
<td>Author:</td>
<td>Yajie Duan [aut, cre],
  Birol Emir [aut],
  Griffith Bell [aut],
  Javier Cabrera [aut],
  Pfizer Inc. [cph, fnd]</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-10-14 08:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='AME'>Average Marginal Effect (AME) with CIs for Two-part Model Objects</h2><span id='topic+AME'></span><span id='topic+AME+2Ctwopartm-method'></span>

<h3>Description</h3>

<p>Calculate average marginal effects (AMEs) with CIs for variables from a fitted two-part regression model object of class <code>twopartm</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'twopartm'
AME(object, newdata = NULL, term = NULL, at = NULL, se = TRUE,
se.method = c("delta","bootstrap"), CI = TRUE,CI.boots = FALSE,
level = 0.95,eps = 1e-7,na.action = na.pass, iter = 50)

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="AME_+3A_object">object</code></td>
<td>
<p>a fitted two-part model object of class <code>twopartm</code> as returned by <code><a href="#topic+tpm">tpm</a></code>.</p>
</td></tr>
<tr><td><code id="AME_+3A_newdata">newdata</code></td>
<td>
<p>optionally, a data frame in which to look for variables with which to calculate average marginal effects. If omitted, the original observations are used.</p>
</td></tr>
<tr><td><code id="AME_+3A_term">term</code></td>
<td>
<p>A character vector with the names of variables for which to compute the average marginal effects. The default (NULL) returns average marginal effects for all variables.</p>
</td></tr>
<tr><td><code id="AME_+3A_at">at</code></td>
<td>
<p>A list of one or more named vectors, specifically values at which to calculate the average marginal effects. The specified values are fully combined (i.e., a cartesian product) to find AMEs for all combinations of specified variable values. These are used to modify the value of data when calculating AMEs across specified values. Note: This does not calculate AMEs for subgroups but rather for counterfactual datasets where all observations take the specified values; to obtain subgroup effects, subset data directly.</p>
</td></tr>
<tr><td><code id="AME_+3A_se">se</code></td>
<td>
<p>logical switch indicating if standard errors are required.</p>
</td></tr>
<tr><td><code id="AME_+3A_se.method">se.method</code></td>
<td>
<p>A character string indicating the type of estimation procedure to use for estimating variances of AMEs. The default (“delta”) uses the delta method. The alternative is “bootstrap”, which uses bootstrap estimation.</p>
</td></tr>
<tr><td><code id="AME_+3A_ci">CI</code></td>
<td>
<p>logical switch indicating if confidence intervals are required.</p>
</td></tr>
<tr><td><code id="AME_+3A_ci.boots">CI.boots</code></td>
<td>
<p>if <code>se.method == "bootstrap"</code>, logical switch indicating if confidence intervals are obtained by normal-based or by bootstrap quantiles.</p>
</td></tr>
<tr><td><code id="AME_+3A_level">level</code></td>
<td>
<p>A numeric value specifying the confidence level for calculating p-values and confidence intervals.</p>
</td></tr>
<tr><td><code id="AME_+3A_eps">eps</code></td>
<td>
<p>A numeric value specifying the “step” to use when calculating numerical derivatives.</p>
</td></tr>
<tr><td><code id="AME_+3A_na.action">na.action</code></td>
<td>
<p>function determining what should be done with missing values in <code>newdata</code>. The default is to predict <code>NA</code>.</p>
</td></tr>
<tr><td><code id="AME_+3A_iter">iter</code></td>
<td>
<p>if <code>se.method == "bootstrap"</code>, the number of bootstrap iterations.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For factor variables, the average value of discrete first-differences in predicted outcomes are calculated as AME (i.e., change in predicted outcome when factor is set to a given level minus the predicted outcome when the factor is set to its baseline level).  If you want to use numerical differentiation for factor variables (which you probably do not want to do), enter them into the original modeling function as numeric values rather than factors. For logical variables, the same approach as factors is used, but always moving from <code>FALSE</code> to <code>TRUE</code>.
</p>
<p>For numeric (and integer) variables, the method calculates an instantaneous marginal effect using a simple &ldquo;central difference&rdquo; numerical differentiation:
</p>
<p style="text-align: center;"><code class="reqn">\frac{f(x + \frac{1}{2}h) - f(x - \frac{1}{2}h)}{dh}</code>
</p>
<p>, where (<code class="reqn">h = \max(|x|, 1) \sqrt{\epsilon}</code> and the value of <code class="reqn">\epsilon</code> is given by argument <code>eps</code>. Then AMEs are calculated by taking average values of marginal effects from all the observations.
</p>
<p>If <code>at = NULL</code> (the default), AMEs are calculated based on the original observations used in the fitted two-part model, or the new data set that <code>newdata</code> inputs. Otherwise, AMEs are calculated based upon modified data by the number of combinations of values specified in at.
</p>
<p>The standard errors of AMEs could be calculated using delta method or bootstrap method. The delta method for two-part model considers the difference between average Jacobian vectors for factor or logical variables, or the second-order partial derivatives of prediction with respect to both models' parameters, assuming independence between models from two parts. The Jacobian vectors and derivatives are approximated by numerical differentiations. The bootstrap method generates bootstrap samples to fit two-part models, and get variances and inverted bootstrap quantile CIs or normal-based CIs of AMEs. If <code>se == T</code>, the returned data frames also have columns indicating z-statistics and p-values that are calculated by normal assumption and input <code>level</code>, and with CIs if <code>CI == T</code>.
</p>


<h3>Value</h3>

<p>A data frame of estimated average marginal effects for all independent variables in the fitted two-part model or the variables that <code>term</code> specifies, if <code>se == T</code>, with standard errors of AMEs, z-statistics and p-values that are calculated by normal assumption and input <code>level</code>, and with CIs if <code>CI == T</code>. If <code>at = NULL</code> (the default), then the data frame will have a number of rows equal to the number of concerned variables. Otherwise, a data list of AMEs of concerned variables, or a data frame of AMEs if there's only one interested variable, is returned and the number of rows in the data frame for each variable will be a multiple thereof based upon the number of combinations of values specified in at.
</p>


<h3>Author(s)</h3>

<p>Yajie Duan, Birol Emir, Griffith Bell and Javier Cabrera</p>


<h3>References</h3>

<p>Belotti, F., Deb, P., Manning, W.G. and Norton, E.C. (2015). twopm: Two-part models.
<em>The Stata Journal</em>, 15(1), pp.3-20.
</p>
<p>Leeper, T.J. (2017). Interpreting regression results using average marginal effects with R’s margins. <em>Available at the comprehensive R Archive Network (CRAN)</em>, pp.1-32.
</p>
<p>Leeper, T.J., Arnold, J. and Arel-Bundock, V. (2017). Package &quot;margins&quot;. <em>accessed December</em>, 5, p.2019.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+twopartm-class">twopartm-class</a></code>, <code><a href="#topic+tpm">tpm</a></code>, <code><a href="#topic+predict-methods">predict-methods</a></code>, <code><a href="#topic+margin">margin</a></code>, <code><a href="stats.html#topic+glm">glm</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
##data about health expenditures, i.e., non-negative continuous response
data(meps,package = "twopartm")


##fit two-part model with different regressors in both parts, with probit
##regression model for the first part, and glm with Gamma family with log
##link for the second-part model
tpmodel = tpm(formula_part1 = exp_tot~female+age, formula_part2 =
exp_tot~female+age+ed_colplus,data = meps,link_part1 = "logit",
family_part2 = Gamma(link = "log"))

tpmodel

summary(tpmodel)

##AMEs for all variables with standard errors and CIs
AME(tpmodel)

##AMEs for variable "female" with standard errors and CIs at age
##40,and 60 respectively
AME(tpmodel,term = "female",at = list(age = c(40,60)))




##data for count response
data("bioChemists")

##fit two-part model with the same regressors in both parts, with logistic
##regression model for the first part, and poisson regression model with
##default log link for the second-part model
tpmodel = tpm(art ~ .,data = bioChemists,link_part1 = "logit",
family_part2 = poisson)

tpmodel


##AMEs for variable "phd" if all are women
AME(tpmodel,term = "phd",at = list(fem = "Women"))

##AMEs for variable "ment" when all are women and the numbers
##of children aged 5 or younger are 1,3, with standard errors
##by bootstrap methods, and CIs by bootstrap quantiles
AME(tpmodel,term = "ment",at = list(fem = "Women",kid5 = c(1,3)),
se.method = "bootstrap",CI.boots = TRUE,iter = 15)

</code></pre>

<hr>
<h2 id='bioChemists'>Articles by Graduate Students in Biochemistry Ph.D. Programs</h2><span id='topic+bioChemists'></span>

<h3>Description</h3>

<p>A sample of 915 biochemistry graduate students.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("bioChemists")
</code></pre>


<h3>Format</h3>


<dl>
<dt>art</dt><dd><p>count of articles produced during last 3 years of Ph.D.</p>
</dd>
<dt>fem</dt><dd><p>factor indicating gender of student, with levels Men and Women</p>
</dd>
<dt>mar</dt><dd><p>factor indicating marital status of student, with levels
Single and Married</p>
</dd>
<dt>kid5</dt><dd><p>number of children aged 5 or younger</p>
</dd>
<dt>phd</dt><dd><p>prestige of Ph.D. department</p>
</dd>
<dt>ment</dt><dd><p>count of articles produced by Ph.D. mentor during last 3 years</p>
</dd>
</dl>



<h3>Details</h3>

<p>This data set is taken from package <span class="pkg">pscl</span> provided by Simon
Jackman.
</p>


<h3>Source</h3>

<p>found in Stata format at
<a href="https://jslsoc.sitehost.iu.edu/stata/spex_data/couart2.dta">https://jslsoc.sitehost.iu.edu/stata/spex_data/couart2.dta</a>
</p>


<h3>References</h3>

<p>Long, J. Scott. (1990). The origins of sex difference in
science. <em>Social Forces</em>, <b>68</b>, 1297&ndash;1315.
</p>
<p>Long, J. Scott. (1997)  <em>Regression Models for Categorical and
Limited Dependent Variables</em>, Thousand Oaks, California:
Sage.
</p>

<hr>
<h2 id='coef-methods'>Method for Function <code>coef</code> for Two-part Model Objects in Package <span class="pkg">twopartm</span></h2><span id='topic+coef+2Ctwopartm-method'></span>

<h3>Description</h3>

<p>The <code>coef</code> method for <code><a href="#topic+twopartm-class">twopartm-class</a></code> that extracts model coefficients from a fitted two-part regression model object of class <code>twopartm</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'twopartm'
coef(object,model = c("tpm","model1","model2"),...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="coef-methods_+3A_object">object</code></td>
<td>
<p>a fitted two-part model object of class <code>twopartm</code> as returned by <code><a href="#topic+tpm">tpm</a></code>.</p>
</td></tr>
<tr><td><code id="coef-methods_+3A_model">model</code></td>
<td>
<p>character specifying for which part of the model the coefficients should be extracted. It could be either &ldquo;tpm&rdquo; for the full two-part model, or &ldquo;model1&rdquo;, &ldquo;model2&rdquo; for the first-part model and the second-part model respectively.The default is &ldquo;tpm&rdquo;.</p>
</td></tr>
<tr><td><code id="coef-methods_+3A_...">...</code></td>
<td>
<p>arguments passed to <code><a href="stats.html#topic+coef">coef</a></code> in the default setup.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>coef</code> method for <code><a href="#topic+twopartm-class">twopartm-class</a></code> by default return a list including two vectors of estimated coefficients for both parts models. By setting the <code>model</code> argument, the model coefficients for the corresponding model component can be extracted.
</p>


<h3>Value</h3>

<p>Coefficients extracted from the model object <code>twopartm</code>.
</p>
<p>With argument <code>model == "tpm"</code> this will be a list of two numeric vectors of model coefficients for both parts models. With <code>model == "model1" | "model2"</code> it will be a numeric vector of coefficients for the selected part's model.
</p>


<h3>Author(s)</h3>

<p>Yajie Duan, Birol Emir, Griffith Bell and Javier Cabrera</p>


<h3>References</h3>

<p>Belotti, F., Deb, P., Manning, W.G. and Norton, E.C. (2015). twopm: Two-part models.
<em>The Stata Journal</em>, 15(1), pp.3-20.
</p>
<p>Chambers, J. M. and Hastie, T. J. (1992) <em>Statistical Models in S</em>. Wadsworth &amp; Brooks/Cole.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+twopartm-class">twopartm-class</a></code>, <code><a href="stats.html#topic+glm">glm</a></code>,<code><a href="stats.html#topic+coef">coef</a></code>, <code><a href="#topic+tpm">tpm</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
##data about health expenditures, i.e., non-negative continuous response
data(meps,package = "twopartm")


##fit two-part model with the same regressors in both parts, with logistic
##regression model for the first part, and glm with Gamma family with log
##link for the second-part model
tpmodel = tpm(exp_tot~female+age, data = meps,link_part1 = "logit",
family_part2 = Gamma(link = "log"))

tpmodel

##summary information
summary(tpmodel)

##estimated coefficients for both parts
coef(tpmodel)

##estimated coefficients for the first-part model
coef(tpmodel,model = "model1")

</code></pre>

<hr>
<h2 id='FiellerRatio'>Ratio of two Gaussian random variables with CI by Fieller's theorem</h2><span id='topic+FiellerRatio'></span><span id='topic+FiellerRatio+2Cnumeric-method'></span>

<h3>Description</h3>

<p>Calculate ratio of two Gaussian random variables with confidence intervals obtained by Fieller's theorem.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>FiellerRatio(xest,yest,V,alpha = 0.05)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="FiellerRatio_+3A_xest">xest</code></td>
<td>
<p>an estimate of one Gaussian random variable as numerator.</p>
</td></tr>
<tr><td><code id="FiellerRatio_+3A_yest">yest</code></td>
<td>
<p>an estimate of one Gaussian random variable as denominator.</p>
</td></tr>
<tr><td><code id="FiellerRatio_+3A_v">V</code></td>
<td>
<p>Covariance matrix of two estimates.</p>
</td></tr>
<tr><td><code id="FiellerRatio_+3A_alpha">alpha</code></td>
<td>
<p>the alpha (significant) level of the confidence interval. The default value is 0.05.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Let X, Y be Gaussian random variables (or normally distributed estimators) with estimates <code>xest</code> and <code>yest</code>, and the ratio of interest E(X)/E(Y). An intuitive point–estimate for the ratio of interest is <code class="reqn">xest/yest</code>. Fieller's theorem allows the calculation of a confidence interval for the ratio of two population means given estimates and covariance matrix.
</p>


<h3>Value</h3>

<p>A numeric vector including the ratio of two estimates, and the bounds of its confidence interval, if the denominator is significantly different from zero. Otherwise, if the denominator is not significantly different from zero but the confidence set is exclusive, a numeric vector including the ratio of two estimates, and the bounds of its exclusive confidence set is returned.
</p>


<h3>Author(s)</h3>

<p>Yajie Duan, Javier Cabrera and Birol Emir</p>


<h3>References</h3>

<p>Cabrera, J. and McDougall, A. (2002). Statistical consulting. <em>Springer Science &amp; Business Media</em>.
</p>
<p>Franz, V. H. (2007). Ratios: A short guide to confidence limits and proper use. <em>arXiv preprint arXiv:0710.2024</em>.
</p>
<p>Fieller, E. C. (1954). Some problems in interval estimation. <em>Journal of the Royal Statistical Society: Series B (Methodological)</em>, 16(2), 175-185.
</p>
<p>Zerbe, G. O. (1978). On Fieller's theorem and the general linear model. <em>The American Statistician</em>, 32(3), 103-105.
</p>
<p>Young, D. A., Zerbe, G. O., &amp; Hay Jr, W. W. (1997). Fieller's theorem, Scheffé simultaneous confidence intervals, and ratios of parameters of linear and nonlinear mixed-effects models. <em>Biometrics</em>, 838-847.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## example data: bivariate Gaussian random variables
library(MASS)
out &lt;- mvrnorm(1000, mu = c(10,3), Sigma = matrix(c(1,0.2,0.2,1),
ncol = 2))

##ratio with CI between two sample means
FiellerRatio(mean(out[,1]),mean(out[,2]),V = cov(out)/1000)



##case that the denominator is not significantly different from zero
##but the confidence set is exclusive
out &lt;- mvrnorm(1000, mu = c(3,0.001), Sigma = matrix(c(1,0.2,0.2,1), ncol = 2))
FiellerRatio(mean(out[,1]),mean(out[,2]),V = cov(out)/1000)



##an example of calculating ratio of fitted parameters with CI in regression models
## Dobson (1990) Page 93: Randomized Controlled Trial :
counts &lt;- c(18,17,15,20,10,20,25,13,12)
outcome &lt;- gl(3,1,9)
treatment &lt;- gl(3,3)
data.frame(treatment, outcome, counts) # showing data
glm.D93 &lt;- glm(counts ~ outcome + treatment, family = poisson())
summary(glm.D93)

##obtain estimates and covariance matrix of concerned fitted parameters
xest &lt;- as.numeric(coef(glm.D93)["outcome3"])
yest &lt;- as.numeric(coef(glm.D93)["outcome2"])
V &lt;- vcov(glm.D93)[c("outcome3","outcome2"),c("outcome3","outcome2")]

##ratio with CI between two fitted parameters
FiellerRatio(xest,yest,V)
</code></pre>

<hr>
<h2 id='logLik-methods'>Method for Function <code>logLik</code> for Two-part Model Objects in Package <span class="pkg">twopartm</span></h2><span id='topic+logLik+2Ctwopartm-method'></span>

<h3>Description</h3>

<p>The <code>logLik</code> method for <code><a href="#topic+twopartm-class">twopartm-class</a></code> that extracts log-likelihood from a fitted two-part regression model object of class <code>twopartm</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'twopartm'
logLik(object,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="logLik-methods_+3A_object">object</code></td>
<td>
<p>a fitted two-part model object of class <code>twopartm</code> as returned by <code><a href="#topic+tpm">tpm</a></code>.</p>
</td></tr>
<tr><td><code id="logLik-methods_+3A_...">...</code></td>
<td>
<p>arguments passed to <code><a href="stats.html#topic+logLik">logLik</a></code> in the default setup.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>logLik</code> method for <code><a href="#topic+twopartm-class">twopartm-class</a></code> returns an object of class <code>logLik</code>, including the log likelihood value with degree of freedom of a fitted two-part regression model object of class <code>twopartm</code>.
</p>


<h3>Value</h3>

<p>Returns an object of class <code>logLik</code> for model object <code>twopartm</code>.This is a number with at least one attribute, &quot;df&quot; (degrees of freedom), giving the number of (estimated) parameters in the two-part model.
</p>


<h3>Author(s)</h3>

<p>Yajie Duan, Birol Emir, Griffith Bell and Javier Cabrera</p>


<h3>References</h3>

<p>Belotti, F., Deb, P., Manning, W.G. and Norton, E.C. (2015). twopm: Two-part models.
<em>The Stata Journal</em>, 15(1), pp.3-20.
</p>
<p>Harville, D.A. (1974). Bayesian inference for variance components using only error contrasts. <em>Biometrika</em>, 61, 383–385. doi: 10.2307/2334370.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+twopartm-class">twopartm-class</a></code>, <code><a href="stats.html#topic+glm">glm</a></code>,<code><a href="stats.html#topic+logLik.lm">logLik.lm</a></code>, <code><a href="#topic+tpm">tpm</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
##data about health expenditures, i.e., non-negative continuous response
data(meps,package = "twopartm")


##fit two-part model with the same regressors in both parts, with logistic
##regression model for the first part, and glm with Gamma family with log
##link for the second-part model
tpmodel = tpm(exp_tot~female+age, data = meps,link_part1 = "logit",
family_part2 = Gamma(link = "log"))

tpmodel

##summary information
summary(tpmodel)

##log-likehood
logLik(tpmodel)
</code></pre>

<hr>
<h2 id='margin'>Predictive Margins with CIs for Two-part Model Objects</h2><span id='topic+margin'></span><span id='topic+margin+2Ctwopartm-method'></span>

<h3>Description</h3>

<p>Calculate predictive margins with CIs for variables from a fitted two-part regression model object of class <code>twopartm</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'twopartm'
margin(object, newdata = NULL, term = NULL, value = NULL,
se = TRUE, se.method = c("delta","bootstrap"), CI = TRUE, CI.boots = FALSE,
level = 0.95,eps = 1e-7,na.action = na.pass, iter = 50)

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="margin_+3A_object">object</code></td>
<td>
<p>a fitted two-part model object of class <code>twopartm</code> as returned by <code><a href="#topic+tpm">tpm</a></code>.</p>
</td></tr>
<tr><td><code id="margin_+3A_newdata">newdata</code></td>
<td>
<p>optionally, a data frame in which to look for variables with which to calculate predictive margins. If omitted, the original observations are used.</p>
</td></tr>
<tr><td><code id="margin_+3A_term">term</code></td>
<td>
<p>A character vector with the names of variables for which to compute the predictive margins. The default (NULL) returns predictive margins for all variables.</p>
</td></tr>
<tr><td><code id="margin_+3A_value">value</code></td>
<td>
<p>A list of one or more named vectors, specifically values at which to calculate the predictive marginal effects. If omitted, for factor or logical variables, predictive margins at all the levels are calculated, and for numeric (and integer) variables, predictive margins at the mean values among observations are calculated.  Note: This does not calculate predictive margins for subgroups but rather for whole datasets; to obtain subgroup margins, subset data directly.</p>
</td></tr>
<tr><td><code id="margin_+3A_se">se</code></td>
<td>
<p>logical switch indicating if standard errors are required.</p>
</td></tr>
<tr><td><code id="margin_+3A_se.method">se.method</code></td>
<td>
<p>A character string indicating the type of estimation procedure to use for estimating variances of predictive margins. The default (“delta”) uses the delta method. The alternative is “bootstrap”, which uses bootstrap estimation.</p>
</td></tr>
<tr><td><code id="margin_+3A_ci">CI</code></td>
<td>
<p>logical switch indicating if confidence intervals are required.</p>
</td></tr>
<tr><td><code id="margin_+3A_ci.boots">CI.boots</code></td>
<td>
<p>if <code>se.method == "bootstrap"</code>, logical switch indicating if confidence intervals are obtained by normal-based or by bootstrap quantiles.</p>
</td></tr>
<tr><td><code id="margin_+3A_level">level</code></td>
<td>
<p>A numeric value specifying the confidence level for calculating p-values and confidence intervals.</p>
</td></tr>
<tr><td><code id="margin_+3A_eps">eps</code></td>
<td>
<p>A numeric value specifying the “step” to use when calculating numerical derivatives.</p>
</td></tr>
<tr><td><code id="margin_+3A_na.action">na.action</code></td>
<td>
<p>function determining what should be done with missing values in <code>newdata</code>. The default is to predict <code>NA</code>.</p>
</td></tr>
<tr><td><code id="margin_+3A_iter">iter</code></td>
<td>
<p>if <code>se.method == "bootstrap"</code>, the number of bootstrap iterations.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Predictive margins are calculated by taking average values of predictive responses at specified levels for factor and logical variables, or specified values for continuous variables. If <code>value = NULL</code> (the default), for factor or logical variables, predictive margins at all the levels are calculated, and for numeric (and integer) variables, predictive margins at the mean values among observations are calculated. Otherwise, predictive margins at values specified in <code>value</code> are calculated.Margins are calculated based on the original observations used in the fitted two-part model, or the new data set that <code>newdata</code> inputs.
</p>
<p>The standard errors of predictive margins could be calculated using delta method or bootstrap method. The delta method considers the average Jacobian vectors among observations with respect to both models' parameters, assuming independence between models from two parts. The Jacobian vectors are approximated by numerical differentiations. The bootstrap method generates bootstrap samples to fit two-part models, and get variances and inverted bootstrap quantile CIs or normal-based CIs of predictive margins. If <code>se == T</code>, the returned data frames also have columns indicating z-statistics and p-values that are calculated by normal assumption and input <code>level</code>, and with CIs if <code>CI == T</code>.
</p>
<p>If there are two or more values or levels of variables to be concerned for predictive margins, the ratios between calculated predictive margins are calculated. If <code>se == T</code> and <code>CI == T</code>, CIs at levels specified by <code>level</code> of the ratios are calculated by Fieller’s theorem using the covariance matrices between predictive margins obtained by delta or bootstrap methods. Fieller's theorem is a statistical method to calculate a confidence interval for the ratio of two means.
</p>


<h3>Value</h3>

<p>A list of data frames of estimated predictive margins for all independent variables in the fitted two-part model or the variables that <code>term</code> specifies, if <code>se == T</code>, with standard errors of AMEs, z-statistics and p-values that are calculated by normal assumption and input <code>level</code>, and with CIs if <code>CI == T</code>. If <code>values = NULL</code> (the default), for factor or logical variables, predictive margins at all the levels are returned, and for numeric (and integer) variables, predictive margins at the mean values among observations are returned. Otherwise, predictive margins at specified values are returned. If there are two or more values or levels of variables to be concerned for predictive margins, a data frame including ratios between calculated predictive margins is also returned, if <code>se == T</code> and <code>CI == T</code>, with CIs at levels specified by <code>level</code> of the ratios.
</p>


<h3>Author(s)</h3>

<p>Yajie Duan, Birol Emir, Griffith Bell and Javier Cabrera</p>


<h3>References</h3>

<p>Belotti, F., Deb, P., Manning, W.G. and Norton, E.C. (2015). twopm: Two-part models.
<em>The Stata Journal</em>, 15(1), pp.3-20.
</p>
<p>Leeper, T.J. (2017). Interpreting regression results using average marginal effects with R’s margins. <em>Available at the comprehensive R Archive Network (CRAN)</em>, pp.1-32.
</p>
<p>Leeper, T.J., Arnold, J. and Arel-Bundock, V. (2017). Package ‘margins’. <em>accessed December</em>, 5, p.2019.
</p>
<p>Fieller, E.C. (1954). Some problems in interval estimation. <em>Journal of the Royal Statistical Society: Series B (Methodological)</em>, 16(2), pp.175-185.
</p>
<p>O’Hagan, A., Stevens, J.W. and Montmartin, J. (2000). Inference for the cost-effectiveness acceptability curve and cost-effectiveness ratio. <em>Pharmacoeconomics</em>, 17(4), pp.339-349.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+twopartm-class">twopartm-class</a></code>, <code><a href="#topic+tpm">tpm</a></code>, <code><a href="#topic+predict-methods">predict-methods</a></code>, <code><a href="#topic+AME">AME</a></code>, <code><a href="stats.html#topic+glm">glm</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
##data about health expenditures, i.e., non-negative continuous response
data(meps,package = "twopartm")


##fit two-part model with different regressors in both parts, with probit
##regression model for the first part, and glm with Gamma family with log
##link for the second-part model
tpmodel = tpm(formula_part1 = exp_tot~female+age, formula_part2 =
exp_tot~female+age+ed_colplus,data = meps,link_part1 = "logit",
family_part2 = Gamma(link = "log"))

tpmodel

summary(tpmodel)

##Predictive margins and corresponding ratios for all variables with
##standard errors and CIs.
margin(tpmodel)


##Predictive margins and corresponding ratios for female, age at
##20,40,60,80, and more than college education level, resepectively
margin(tpmodel,value = list(female = 1,age = c(50,70),ed_colplus = 1))



##data for count response
data("bioChemists")

##fit two-part model with the same regressors in both parts, with logistic
##regression model for the first part, and poisson regression model with
##default log link for the second-part model
tpmodel = tpm(art ~ .,data = bioChemists,link_part1 = "logit",
family_part2 = poisson)

tpmodel


##Predictive margins and corresponding ratios for variable "kid5"
##at 2,3, with standard errors by bootstrap methods,
##and CIs by bootstrap quantiles
margin(tpmodel,term = "kid5",value = list(kid5 = c(2,3)),
se.method = "bootstrap",CI.boots = TRUE,iter = 20)

##Predictive margins and corresponding ratios for variable "ment" at
##6,7,8, without standard errors and CIs
margin(tpmodel,term = "ment",value = list(ment = c(6,7,8)),se = FALSE)


##Predictive margins and corresponding ratios for all the levels of
##variable "mar", and for variable "phd" at 2.5,3.2, calculated on
##the first 500 observations, with standard errors and CIs
margin(tpmodel,newdata = bioChemists[1:500,],term = c("phd","mar"),
value = list(phd = c(2.5,3.2)))

</code></pre>

<hr>
<h2 id='meps'>A Sample of Medical Expenditure Panel Survey 2004 data</h2><span id='topic+meps'></span>

<h3>Description</h3>

<p>A sample of MEPS 2004 data including 19386 observations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("meps")
</code></pre>


<h3>Format</h3>


<dl>
<dt>duid</dt><dd><p>Dwelling unit id</p>
</dd>
<dt>dupersid</dt><dd><p>Person id (unique) </p>
</dd>
<dt>hieuidx</dt><dd><p>Health insurance eligibility unit id</p>
</dd>
<dt>wtdper</dt><dd><p>Sampling weight for person</p>
</dd>
<dt>age</dt><dd><p>Age</p>
</dd>
<dt>female</dt><dd><p>Female</p>
</dd>
<dt>race_bl</dt><dd><p>Black</p>
</dd>
<dt>race_oth</dt><dd><p>Other race, non-white and non-black</p>
</dd>
<dt>eth_hisp</dt><dd><p>Hispanic</p>
</dd>
<dt>famsize</dt><dd><p>Size of responding annualized family</p>
</dd>
<dt>ed_hs</dt><dd><p>High school education</p>
</dd>
<dt>ed_hsplus</dt><dd><p>Some college education</p>
</dd>
<dt>ed_col</dt><dd><p>College education</p>
</dd>
<dt>ed_colplus</dt><dd><p>More than college education</p>
</dd>
<dt>lninc</dt><dd><p>ln(family income)</p>
</dd>
<dt>reg_midw</dt><dd><p>Midwest region</p>
</dd>
<dt>reg_south</dt><dd><p>South region</p>
</dd>
<dt>reg_west</dt><dd><p>West region</p>
</dd>
<dt>anylim</dt><dd><p>Any disability</p>
</dd>
<dt>mcs12</dt><dd><p>Mental health component of SF12</p>
</dd>
<dt>pcs12</dt><dd><p>Physical health component of SF12</p>
</dd>
<dt>ins_mcare</dt><dd><p>Medicare insurance</p>
</dd>
<dt>ins_mcaid</dt><dd><p>Medicaid insurance</p>
</dd>
<dt>ins_unins</dt><dd><p>Uninsured</p>
</dd>
<dt>ins_dent</dt><dd><p>Dental insurance, prorated</p>
</dd>
<dt>exp_tot</dt><dd><p>Total medical care expenses</p>
</dd>
<dt>exp_dent</dt><dd><p>Dental care expenses</p>
</dd>
<dt>exp_self</dt><dd><p>Total expenses paid by self or family</p>
</dd>
<dt> use_disch</dt><dd><p># hospital discharges</p>
</dd>
<dt>use_los</dt><dd><p># nights in hospital</p>
</dd>
<dt>use_dent</dt><dd><p># dental visits</p>
</dd>
<dt>use_rx</dt><dd><p># prescriptions and refills</p>
</dd>
</dl>



<h3>Details</h3>

<p>This data set is taken from book Health econometrics using Stata (Vol. 3).
</p>


<h3>Source</h3>

<p>found in Stata format at
<a href="https://www.stata-press.com/data/heus.html">https://www.stata-press.com/data/heus.html</a>
</p>


<h3>References</h3>

<p>Deb, P., Norton, E.C. and Manning, W.G. (2017). Health econometrics using Stata (Vol. 3). <em>College Station, TX: Stata press</em>.
</p>

<hr>
<h2 id='plot-methods'>Method for Function <code>plot</code> for Two-part Model Objects in Package <span class="pkg">twopartm</span></h2><span id='topic+plot+2Ctwopartm+2Cmissing-method'></span>

<h3>Description</h3>

<p>The <code>plot</code> method for <code><a href="#topic+twopartm-class">twopartm-class</a></code> that provides plot diagnostics for a fitted two-part regression model object of class <code>twopartm</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'twopartm,missing'
plot(x, y, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot-methods_+3A_x">x</code></td>
<td>
<p>an object of class <code>twopartm</code>.</p>
</td></tr>
<tr><td><code id="plot-methods_+3A_y">y</code></td>
<td>
<p>not used.</p>
</td></tr>
<tr><td><code id="plot-methods_+3A_...">...</code></td>
<td>
<p>arguments passed to <code><a href="stats.html#topic+plot.lm">plot.lm</a></code> in the default setup.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>plot</code> method for <code><a href="#topic+twopartm-class">twopartm-class</a></code> returns the residual plot for the full two-part model, and also six plots for each part's glm model. Six plots are: a plot of residuals against fitted values, a Scale-Location plot of sqrt(| residuals |) against fitted values, a Normal Q-Q plot, a plot of Cook's distances versus row labels, a plot of residuals against leverages, and a plot of Cook's distances against leverage/(1-leverage). By default, the first three plots and the fifth one of each part's model are provided. The plots for each part's model could be selected by argument <code>which</code> of function <code>plot.lm</code> for glm model object.
</p>


<h3>Value</h3>

<p>Returns residual plot for the full two-part model, and plot diagnostics for each part's model from an object <code>twopartm</code>.
</p>


<h3>Author(s)</h3>

<p>Yajie Duan, Birol Emir, Griffith Bell and Javier Cabrera</p>


<h3>References</h3>

<p>Belotti, F., Deb, P., Manning, W.G. and Norton, E.C. (2015). twopm: Two-part models.
<em>The Stata Journal</em>, 15(1), pp.3-20.
</p>
<p>Belsley, D. A., Kuh, E. and Welsch, R. E. (1980). <em>Regression Diagnostics</em>. New York: Wiley.
</p>
<p>Cook, R. D. and Weisberg, S. (1982). <em>Residuals and Influence in Regression</em>. London: Chapman and Hall.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+twopartm-class">twopartm-class</a></code>, <code><a href="stats.html#topic+glm">glm</a></code>,<code><a href="stats.html#topic+plot.lm">plot.lm</a></code>, <code><a href="#topic+tpm">tpm</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
##data about health expenditures, i.e., non-negative continuous response
data(meps,package = "twopartm")


##fit two-part model with the same regressors in both parts, with logistic
##regression model for the first part, and glm with Gamma family with log
##link for the second-part model
tpmodel = tpm(exp_tot~female+age, data = meps,link_part1 = "logit",
family_part2 = Gamma(link = "log"))

tpmodel

##summary information
summary(tpmodel)

##plots for two-part model
plot(tpmodel)

</code></pre>

<hr>
<h2 id='predict-methods'>Method for Function <code>predict</code> for Two-part Model Fits in Package <span class="pkg">twopartm</span></h2><span id='topic+predict-methods'></span><span id='topic+predict+2Ctwopartm-method'></span>

<h3>Description</h3>

<p>Obtains predictions and optionally estimates standard errors of those predictions from a fitted two-part model object of class <code>twopartm</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'twopartm'
predict(object,newdata = NULL, se.fit = FALSE,
dispersion_part1 = NULL,dispersion_part2 = NULL,na.action = na.pass)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict-methods_+3A_object">object</code></td>
<td>
<p>a fitted two-part model object of class <code>twopartm</code> as returned by <code><a href="#topic+tpm">tpm</a></code>.</p>
</td></tr>
<tr><td><code id="predict-methods_+3A_newdata">newdata</code></td>
<td>
<p>optionally, a data frame in which to look for variables with which to predict. If omitted, the original observations are used.</p>
</td></tr>
<tr><td><code id="predict-methods_+3A_se.fit">se.fit</code></td>
<td>
<p>logical switch indicating if standard errors are required.</p>
</td></tr>
<tr><td><code id="predict-methods_+3A_dispersion_part1">dispersion_part1</code></td>
<td>
<p>the dispersion of the GLM fit to be assumed in computing the standard errors for the first-part model. If omitted, that returned by <code>summary</code> applied to the first-part model object is used.</p>
</td></tr>
<tr><td><code id="predict-methods_+3A_dispersion_part2">dispersion_part2</code></td>
<td>
<p>the dispersion of the GLM fit to be assumed in computing the standard errors for the second-part model. If omitted, that returned by <code>summary</code> applied to the second-part model object is used.</p>
</td></tr>
<tr><td><code id="predict-methods_+3A_na.action">na.action</code></td>
<td>
<p>function determining what should be done with missing values in <code>newdata</code>. The default is to predict <code>NA</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The predictive values and corresponding standard errors are on the scales of the response variable not considering the link functions. The predictive responses are calculated by multiplying the predicted probabilities of non-zero responses and the fitted means of non-zero values. The prediction standard errors are calculated using delta method combining prediction standard errors from the models of both parts. If <code>newdata</code> is omitted the predictions are based on the data used for the fit. In that case how cases with missing values in the original fit is determined by the <code>na.action</code> argument of that fit.
</p>


<h3>Value</h3>

<p>If <code>se.fit = FALSE</code>, a vector or matrix of predictions.
If <code>se.fit = TRUE</code>, a list with components
</p>
<table>
<tr><td><code>fit</code></td>
<td>
<p>Predictions, as for <code>se.fit = FALSE</code>.</p>
</td></tr>
<tr><td><code>se.fit</code></td>
<td>
<p>Estimated standard errors.</p>
</td></tr>
<tr><td><code>residual.scale_part1</code></td>
<td>
<p>A scalar giving the square root of the
dispersion used in computing the standard errors for the first-part model.</p>
</td></tr>
<tr><td><code>residual.scale_part2</code></td>
<td>
<p>A scalar giving the square root of the
dispersion used in computing the standard errors for the second-part model.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Yajie Duan, Birol Emir, Griffith Bell and Javier Cabrera</p>


<h3>References</h3>

<p>Belotti, F., Deb, P., Manning, W.G. and Norton, E.C. (2015). twopm: Two-part models.
<em>The Stata Journal</em>, 15(1), pp.3-20.
</p>
<p>Chambers, J. M. and Hastie, T. J. (1992) <em>Statistical Models in S</em>. Wadsworth &amp; Brooks/Cole.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+twopartm-class">twopartm-class</a></code>, <code><a href="#topic+tpm">tpm</a></code>, <code><a href="#topic+AME">AME</a></code>, <code><a href="#topic+margin">margin</a></code>, <code><a href="stats.html#topic+glm">glm</a></code>,  <code><a href="stats.html#topic+predict.glm">predict.glm</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
##data about health expenditures, i.e., non-negative continuous response
data(meps,package = "twopartm")


##fit two-part model with the same regressors in both parts, with logistic
##regression model for the first part, and glm with Gamma family with log
##link for the second-part model
tpmodel = tpm(exp_tot~female+age, data = meps,link_part1 = "logit",
family_part2 = Gamma(link = "log"))

tpmodel

##get prediction results with standard errors for the
##first 500 observations in the dataset
predict(tpmodel,newdata = meps[1:500,],se.fit = TRUE)


##data for count response
data("bioChemists")

##fit two-part model with the same regressors in both parts, with logistic
##regression model for the first part, and poisson regression model with
##default log link for the second-part model
tpmodel = tpm(art ~ .,data = bioChemists,link_part1 = "logit",
family_part2 = poisson)

tpmodel

##get predictive counts
predict(tpmodel)

</code></pre>

<hr>
<h2 id='residuals-methods'>Method for Function <code>residuals</code> for Two-part Model Objects in Package <span class="pkg">twopartm</span></h2><span id='topic+residuals+2Ctwopartm-method'></span>

<h3>Description</h3>

<p>The <code>residuals</code> method for <code><a href="#topic+twopartm-class">twopartm-class</a></code> that extracts model residuals from a fitted two-part regression model object of class <code>twopartm</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'twopartm'
residuals(object,model = c("tpm","model1","model2"),
type = c("deviance", "pearson", "working","response", "partial"))

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="residuals-methods_+3A_object">object</code></td>
<td>
<p>a fitted two-part model object of class <code>twopartm</code> as returned by <code><a href="#topic+tpm">tpm</a></code>.</p>
</td></tr>
<tr><td><code id="residuals-methods_+3A_model">model</code></td>
<td>
<p>character specifying for which part of the model the residuals should be extracted. It could be either &ldquo;tpm&rdquo; for the full two-part model, or &ldquo;model1&rdquo;, &ldquo;model2&rdquo; for the first-part model and the second-part model respectively.The default is &ldquo;tpm&rdquo;.</p>
</td></tr>
<tr><td><code id="residuals-methods_+3A_type">type</code></td>
<td>
<p>if <code>model == "model1" | "model2"</code>, the type of residuals which should be returned. The alternatives are: &ldquo;response&rdquo; (default), &ldquo;pearson&rdquo;, &ldquo;working&rdquo;, &ldquo;deviance&rdquo;, and &ldquo;partial&rdquo;. Can be abbreviated.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>residuals</code> method for <code><a href="#topic+twopartm-class">twopartm-class</a></code> can compute raw response residuals (observed - fitted) for the full two-part model, or different types of residues from both parts models respectively. The references define the types of residuals: Davison &amp; Snell is a good reference for the usages of each. The partial residuals are a matrix of working residuals, with each column formed by omitting a term from the model.
</p>


<h3>Value</h3>

<p>Returns a numerical vector of residuals, either for the full two-part model, or two separate part models from an object <code>twopartm</code>.
</p>


<h3>Author(s)</h3>

<p>Yajie Duan, Birol Emir, Griffith Bell and Javier Cabrera</p>


<h3>References</h3>

<p>Belotti, F., Deb, P., Manning, W.G. and Norton, E.C. (2015). twopm: Two-part models.
<em>The Stata Journal</em>, 15(1), pp.3-20.
</p>
<p>Davison, A. C. and Snell, E. J. (1991). Residuals and diagnostics. <em>Statistical Theory and Modeling</em>. In Honour of Sir David Cox, FRS, eds. Hinkley, D. V., Reid, N. and Snell, E. J., Chapman and Hall.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+twopartm-class">twopartm-class</a></code>, <code><a href="stats.html#topic+glm">glm</a></code>,<code><a href="stats.html#topic+residuals.glm">residuals.glm</a></code>, <code><a href="#topic+tpm">tpm</a></code>,  <code><a href="#topic+predict-methods">predict-methods</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
##data about health expenditures, i.e., non-negative continuous response
data(meps,package = "twopartm")


##fit two-part model with the same regressors in both parts, with logistic
##regression model for the first part, and glm with Gamma family with log
##link for the second-part model
tpmodel = tpm(exp_tot~female+age, data = meps,link_part1 = "logit",
family_part2 = Gamma(link = "log"))

tpmodel

##summary information
summary(tpmodel)

##response residues from the full two-part model
residuals(tpmodel)

##response residues from the first-part model
residuals(tpmodel,model = "model1")

##deviance residues from the second-part model
residuals(tpmodel,model = "model2",type = "deviance")


</code></pre>

<hr>
<h2 id='tpm'>Fit Two-part Regression Models for Zero-inflated Data</h2><span id='topic+tpm'></span><span id='topic+tpm+2Cformula-method'></span><span id='topic+summary+2Ctwopartm-method'></span><span id='topic+print.twopartm'></span><span id='topic+show+2Ctwopartm-method'></span>

<h3>Description</h3>

<p>Fit two-part regression models for zero-inflated data. The first-model is a binomial regression model for indicators about any non-zero responses. The second-model is a generalized linear regression model for non-zero response values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tpm(formula_part1, formula_part2 = NULL,data, link_part1 = c("logit",
"probit", "cloglog", "cauchit", "log"), family_part2 = gaussian(), weights = NULL, ...)

## S4 method for signature 'twopartm'
summary(object,...)

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tpm_+3A_formula_part1">formula_part1</code></td>
<td>
<p>formula specifying the dependent variable and the regressors used for the first-part model, i.e., the binomial model for probabilities of non-zero responses. If <code>formula_part2</code> is <code>NULL</code>, the same regressors specified here are employed in both parts.</p>
</td></tr>
<tr><td><code id="tpm_+3A_formula_part2">formula_part2</code></td>
<td>
<p>formula specifying the dependent variable and the regressors used for the second-part model, i.e., the glm model for non-zero responses. If it's <code>NULL</code>, the same regressors specified in <code>formula_part1</code> are employed in the second-part model.</p>
</td></tr>
<tr><td><code id="tpm_+3A_data">data</code></td>
<td>
<p>a data frame, list or environment (or object coercible by as.data.frame to a data frame) containing the variables in the models for both parts.</p>
</td></tr>
<tr><td><code id="tpm_+3A_link_part1">link_part1</code></td>
<td>
<p>character string specifying the link function of the first-part model, i.e., the binomial model for probabilities of non-zero responses. It could be <code>logit</code>, <code>probit</code>, <code>cauchit</code>, (corresponding to logistic, normal and Cauchy CDFs respectively) <code>log</code> or <code>cloglog</code> (complementary log-log).</p>
</td></tr>
<tr><td><code id="tpm_+3A_family_part2">family_part2</code></td>
<td>
<p>a description of the error distribution and link function to be used in the second-part model,  i.e.,  the glm model for non-zero responses. This can be a character string naming a family function, a family function or the result of a call to a family function.</p>
</td></tr>
<tr><td><code id="tpm_+3A_weights">weights</code></td>
<td>
<p>an optional numeric vector of weights to be used in the fitting process for both parts. Should be NULL or a numeric vector.</p>
</td></tr>
<tr><td><code id="tpm_+3A_object">object</code></td>
<td>
<p>a fitted two-part model object of class <code>twopartm</code> as returned by <code>tpm</code>.</p>
</td></tr>
<tr><td><code id="tpm_+3A_...">...</code></td>
<td>
<p>arguments passed to <code><a href="stats.html#topic+glm">glm</a></code> or <code><a href="stats.html#topic+summary.glm">summary.glm</a></code> in the default setup.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Two-part models are two-component models for zero-inflated data, one modeling indicators
about any non-zero responses and another modeling non-zero response values. It models
the zeros and non-zeros as two separate processes.  For instance, in explaining individual
annual health expenditure, the event is represented by a specific disease. If the illness
occurs, then some not-for-free treatment will be needed, and a positive expense will be
observed. In these situations, a two-part model allows the censoring mechanism and the
outcome to be modeled to use separate processes. In other words, it permits the zeros and
nonzeros to be generated by different densities as a special type of mixture model.
</p>
<p>In function <code>tpm</code>, the zeros are handled using the first-model, specifically a glm with binomial family
and specified link function for the probability of a non-zero outcome. The second-model is a
glm with specified family function with link for non-zero values. The regressors for both parts
could be different and specified separately. The two components of the model are estimated separately
using <code>glm</code> calls, with iterated reweighted least-squares (IRLS) optimization.
</p>
<p>The returned fitted model object is of class <code>twopartm</code>.A set of standard extractor functions
for fitted model objects is available for objects of class <code>twopartm</code>, including methods to
the generic functions <code>print</code>, <code>summary</code>, <code>plot</code>, <code>coef</code>,
<code>logLik</code>, <code>residuals</code>, and <code>predict</code>.See
<code><a href="#topic+predict-methods">predict-methods</a></code> for more details on prediction method.
</p>
<p>The <code>summary</code> method lists result summaries of two fitted glm models for each part respectively.
</p>


<h3>Value</h3>

<p><code>tpm</code> returns an object of class <code>twopartm</code>.
</p>
<p><code>summary</code> returns a list with two objects of class <code>summary.glm</code> for first-part model and second-part model respectively.
</p>


<h3>Author(s)</h3>

<p>Yajie Duan, Birol Emir, Griffith Bell and Javier Cabrera</p>


<h3>References</h3>

<p>Belotti, F., Deb, P., Manning, W.G. and Norton, E.C. (2015). twopm: Two-part models.
<em>The Stata Journal</em>, 15(1), pp.3-20.
</p>
<p>Hay, J. W., and R. J. Olsen. (1984). Let them eat cake: A note on comparing alternative
models of the demand for medical care. <em>Journal of Business and Economic Statistics</em>
2: 279–282.
</p>
<p>Leung, S. F., and S. Yu. (1996). On the choice between sample selection and two-part
models. <em>Journal of Econometrics</em> 72: 197–229
</p>
<p>Mihaylova, B., A. Briggs, A. O’Hagan, and S. G. Thompson. (2011). Review of statistical
methods for analyzing healthcare resources and costs. <em>Health Economics</em> 20: 897–916.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+twopartm-class">twopartm-class</a></code>, <code><a href="stats.html#topic+glm">glm</a></code>, <code><a href="stats.html#topic+summary.glm">summary.glm</a></code>, <code><a href="#topic+predict-methods">predict-methods</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
##data about health expenditures, i.e., non-negative continuous response
data(meps,package = "twopartm")


##fit two-part model with the same regressors in both parts, with logistic
##regression model for the first part, and glm with Gamma family with log
##link for the second-part model
tpmodel = tpm(exp_tot~female+age, data = meps,link_part1 = "logit",
family_part2 = Gamma(link = "log"))

tpmodel

summary(tpmodel)


##fit two-part model with different regressors in both parts, with probit
##regression model for the first part, and glm with Gamma family with log
##link for the second-part model
tpmodel = tpm(formula_part1 = exp_tot~female+age, formula_part2 =
exp_tot~female+age+ed_colplus,data = meps,link_part1 = "probit",
family_part2 = Gamma(link = "log"))

tpmodel

summary(tpmodel)

##fit two-part model with transformed regressors and randomly assigned weights
meps$weights = sample(1:30,nrow(meps),replace = TRUE)

tpmodel = tpm(formula_part1 = exp_tot~female+age, formula_part2 =
exp_tot~female+I(age^2)+ed_colplus,data = meps,link_part1 = "logit",
family_part2 = Gamma(link = "log"),weights = meps$weights)

tpmodel

summary(tpmodel)


##data for count response
data("bioChemists")

##fit two-part model with the same regressors in both parts, with logistic
##regression model for the first part, and poisson regression model with
##default log link for the second-part model
tpmodel = tpm(art ~ .,data = bioChemists,link_part1 = "logit",
family_part2 = poisson)

tpmodel

summary(tpmodel)


</code></pre>

<hr>
<h2 id='twopartm-class'>Class <code>twopartm</code></h2><span id='topic+twopartm-class'></span>

<h3>Description</h3>

<p>A fitted two-part regression model by <code><a href="#topic+tpm">tpm</a></code>.</p>


<h3>Slots</h3>


<dl>
<dt><code>formula_part1</code></dt><dd><p>Formula specified for the first-part model, i.e., the binomial model for indicators about any non-zero responses.</p>
</dd>
<dt><code>formula_part2</code></dt><dd><p>Formula specified for the second-part model, i.e., the glm model for non-zero responses.</p>
</dd>
<dt><code>data</code></dt><dd><p>Data set used to fit the two-part model. It's the same data set as the <code>data</code> argument in <a href="#topic+tpm">tpm</a>.</p>
</dd>
<dt><code>n</code>:</dt><dd><p>Number of observations used in the two-part model (with weights &gt; 0).</p>
</dd>
<dt><code>n_part1</code></dt><dd><p>Number of of observations used in the first-part model (with weights &gt; 0), i.e., the binomial model for indicators about any non-zero responses.</p>
</dd>
<dt><code>n_part2</code></dt><dd><p>Number of of observations used in the second-part model (with weights &gt; 0), i.e., the glm model for non-zero responses.</p>
</dd>
<dt><code>data_model1</code></dt><dd><p>The model frame for the first-part model,  i.e., the binomial model for indicators about any non-zero responses.</p>
</dd>
<dt><code>data_model2</code></dt><dd><p>The model frame for the second-part model,  i.e., the glm model for non-zero responses.</p>
</dd>
<dt><code>model_part1</code></dt><dd><p>An object of class <code>glm</code> of the fitted first-part model,  i.e., the binomial model for indicators about any non-zero responses.</p>
</dd>
<dt><code>model_part2</code></dt><dd><p>An object of class <code>glm</code> of the fitted second-part model,  i.e.,  the glm model for non-zero responses.</p>
</dd>
<dt><code>link_part1</code></dt><dd><p>Character string describing the link function of the first-part model, i.e., the binomial model for indicators about any non-zero responses.</p>
</dd>
<dt><code>family_part2</code></dt><dd><p>The family object used in the second-part model,  i.e.,  the glm model for non-zero responses.</p>
</dd>
<dt><code>weights</code></dt><dd><p>A vector of weights used in the two-part model fitting, or NULL if no weights used.</p>
</dd>
<dt><code>fitted</code></dt><dd><p>Fitted mean values by the two-part model, obtained by multiplying the fitted probabilities of non-zero responses and the fitted means of non-zero responses.</p>
</dd>
<dt><code>residuals</code></dt><dd><p>A vector of raw residuals (observed - fitted).</p>
</dd>
<dt><code>loglik</code></dt><dd><p>Log-likelihood values of the fitted two-part model.</p>
</dd>
<dt><code>y</code></dt><dd><p>The response vector.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Yajie Duan, Birol Emir, Griffith Bell and Javier Cabrera</p>


<h3>See Also</h3>

<p><code><a href="#topic+tpm">tpm</a></code>, <code><a href="#topic+AME">AME</a></code>, <code><a href="#topic+margin">margin</a></code>, <code><a href="stats.html#topic+glm">glm</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
##data about health expenditures, i.e., non-negative continuous response
data(meps,package = "twopartm")


##fit two-part model with the same regressors in both parts, with logistic regression model
##for the first part, and glm with Gamma family with log link for the second-part model
tpmodel = tpm(formula_part1 = exp_tot~female+age, formula_part2 = exp_tot~female+age+ed_colplus,
data = meps,link_part1 = "logit",family_part2 = Gamma(link = "log"))

##get the formula specified for the first-part model
tpmodel@formula_part1

##get the formula specified for the second-part model
tpmodel@formula_part2

##get the log-likelihood for the fitted two-part model
tpmodel@loglik

##get the fitted glm model for the first part
tpmodel@model_part1
##get the fitted glm model for the second part
tpmodel@model_part2


</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
