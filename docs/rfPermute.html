<!DOCTYPE html><html><head><title>Help for package rfPermute</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {rfPermute}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#balancedSampsize'><p>Balanced Sample Size</p></a></li>
<li><a href='#casePredictions'><p>Case Predictions</p></a></li>
<li><a href='#classPriors'><p>Class Priors</p></a></li>
<li><a href='#cleanRFdata'><p>Clean Random Forest Input Data</p></a></li>
<li><a href='#combineRP'><p>Combine rfPermute objects</p></a></li>
<li><a href='#confusionMatrix'><p>Confusion Matrix</p></a></li>
<li><a href='#importance'><p>Extract rfPermute Importance Scores and p-values.</p></a></li>
<li><a href='#pctCorrect'><p>Percent Correctly Classified</p></a></li>
<li><a href='#plotImpPreds'><p>Plot Important Predictor Distribution</p></a></li>
<li><a href='#plotInbag'><p>Plot Inbag distribution</p></a></li>
<li><a href='#plotNull'><p>Plot Random Forest Importance Null Distributions</p></a></li>
<li><a href='#plotPredictedProbs'><p>Plot Predicted Probabilities</p></a></li>
<li><a href='#plotProximity'><p>Plot Random Forest Proximity Scores</p></a></li>
<li><a href='#plotTrace'><p>Plot Trace</p></a></li>
<li><a href='#plotVotes'><p>Plot Vote Distribution</p></a></li>
<li><a href='#rfPermute'><p>Estimate Permutation p-values for Random Forest Importance Metrics</p></a></li>
<li><a href='#rfPermute_package'><p><code>rfPermute</code> package</p></a></li>
<li><a href='#summary'><p>Diagnostics of <code>rfPermute</code> or <code>randomForest</code> models.</p></a></li>
<li><a href='#symb.metab'><p>Symbiodinium type metabolite profiles</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Estimate Permutation p-Values for Random Forest Importance
Metrics</td>
</tr>
<tr>
<td>Description:</td>
<td>Estimate significance of importance metrics
    for a Random Forest model by permuting the response
    variable. Produces null distribution of importance
    metrics for each predictor variable and p-value of
    observed. Provides summary and visualization functions for 'randomForest' 
    results.</td>
</tr>
<tr>
<td>Version:</td>
<td>2.5.2</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/EricArcher/rfPermute">https://github.com/EricArcher/rfPermute</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/EricArcher/rfPermute/issues">https://github.com/EricArcher/rfPermute/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.0.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>abind (&ge; 1.4), dplyr (&ge; 1.0), ggplot2 (&ge; 3.3), grDevices,
gridExtra, magrittr (&ge; 2.0), methods, parallel, randomForest
(&ge; 4.6), rlang, scales, stats, swfscMisc (&ge; 1.5), tibble (&ge;
3.1), tidyr (&ge; 1.1), utils</td>
</tr>
<tr>
<td>Collate:</td>
<td>rfPermute_package.R dataSets.R internals.R rfPermute.R
summary.R importance.R combineRP.R classPriors.R
confusionMatrix.R casePredictions.R pctCorrect.R plotInbag.R
plotImpPreds.R plotNull.R plotPredictedProbs.R plotProximity.R
plotTrace.R plotVotes.R balancedSampsize.R cleanRFdata.R</td>
</tr>
<tr>
<td>LazyData:</td>
<td>TRUE</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-08-23 16:52:41 UTC; ericarcher</td>
</tr>
<tr>
<td>Author:</td>
<td>Eric Archer [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Eric Archer &lt;eric.archer@noaa.gov&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-08-23 17:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='balancedSampsize'>Balanced Sample Size</h2><span id='topic+balancedSampsize'></span>

<h3>Description</h3>

<p>Create a vector of balanced (equal) sample sizes for use in 
the <code>sampsize</code> argument of <code><a href="#topic+rfPermute">rfPermute</a></code> or 
<code><a href="randomForest.html#topic+randomForest">randomForest</a></code> for a classification model. The 
values are derived from a percentage of the smallest class sample size.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>balancedSampsize(y, pct = 0.5)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="balancedSampsize_+3A_y">y</code></td>
<td>
<p>character, numeric, or factor vector containing classes of 
response variable. Values will be treated as unique for computing class 
frequencies.</p>
</td></tr>
<tr><td><code id="balancedSampsize_+3A_pct">pct</code></td>
<td>
<p>percent of smallest class frequency for <code>sampsize</code> vector.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a named vector of sample sizes as long as the number of classes.
</p>


<h3>Author(s)</h3>

<p>Eric Archer <a href="mailto:eric.archer@noaa.gov">eric.archer@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mtcars)

# A balanced model with default half of smallest class size
sampsize_0.5 &lt;- balancedSampsize(mtcars$am)
sampsize_0.5

rfPermute(factor(am) ~ ., mtcars, replace = FALSE, sampsize = sampsize_0.5)

# A balanced model with one quarter of smallest class size
sampsize_0.25 &lt;- balancedSampsize(mtcars$am, pct = 0.25)
sampsize_0.25

rfPermute(factor(am) ~ ., mtcars, replace = FALSE, sampsize = sampsize_0.25)


</code></pre>

<hr>
<h2 id='casePredictions'>Case Predictions</h2><span id='topic+casePredictions'></span>

<h3>Description</h3>

<p>Construct a data frame of case predictions for 
training data along with vote distributions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>casePredictions(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="casePredictions_+3A_x">x</code></td>
<td>
<p>a <code>rfPermte</code> or <code>randomForest</code> model object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame containing columns of original and predicted cases,
whether they were correctly classified, and vote distributions among cases.
</p>


<h3>Author(s)</h3>

<p>Eric Archer <a href="mailto:eric.archer@noaa.gov">eric.archer@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(randomForest)
data(mtcars)

rf &lt;- randomForest(factor(am) ~ ., mtcars)

cp &lt;- casePredictions(rf)
cp

</code></pre>

<hr>
<h2 id='classPriors'>Class Priors</h2><span id='topic+classPriors'></span>

<h3>Description</h3>

<p>Compute the class classification priors and class-specific 
model binomial p-values using these priors as null hypotheses.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>classPriors(x, sampsize)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="classPriors_+3A_x">x</code></td>
<td>
<p>a <code>rfPermute</code> or <code>randomForest</code> model object.</p>
</td></tr>
<tr><td><code id="classPriors_+3A_sampsize">sampsize</code></td>
<td>
<p>the vector of sample sizes used to construct the model. If 
provided, must have length equal to number of classes. If set to
<code>NULL</code>, priors will be computed assuming empirical sample sizes.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Eric Archer <a href="mailto:eric.archer@noaa.gov">eric.archer@noaa.gov</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+balancedSampsize">balancedSampsize</a></code>, <code><a href="#topic+confusionMatrix">confusionMatrix</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(randomForest)
data(mtcars)

# random sampling with replacement
rf &lt;- randomForest(factor(am) ~ ., mtcars)
confusionMatrix(rf)
classPriors(rf, NULL)

# balanced design
sampsize &lt;- balancedSampsize(mtcars$am)
rf &lt;- randomForest(factor(am) ~ ., mtcars, replace = FALSE, sampsize = sampsize)
confusionMatrix(rf)
classPriors(rf, sampsize)

</code></pre>

<hr>
<h2 id='cleanRFdata'>Clean Random Forest Input Data</h2><span id='topic+cleanRFdata'></span>

<h3>Description</h3>

<p>Removes cases for a Random Forest classification model 
with missing data and predictors that are constant.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cleanRFdata(x, y, data, max.levels = 30)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cleanRFdata_+3A_x">x</code></td>
<td>
<p>columns used as predictor variables as character or numeric vector.</p>
</td></tr>
<tr><td><code id="cleanRFdata_+3A_y">y</code></td>
<td>
<p>column used as response variable as character or numeric.</p>
</td></tr>
<tr><td><code id="cleanRFdata_+3A_data">data</code></td>
<td>
<p>data.frame containing <code>x</code> and <code>y</code> columns.</p>
</td></tr>
<tr><td><code id="cleanRFdata_+3A_max.levels">max.levels</code></td>
<td>
<p>maximum number of levels in response variable <code>y</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a data.frame containing cleaned data.
</p>


<h3>Author(s)</h3>

<p>Eric Archer <a href="mailto:eric.archer@noaa.gov">eric.archer@noaa.gov</a>
</p>

<hr>
<h2 id='combineRP'>Combine rfPermute objects</h2><span id='topic+combineRP'></span>

<h3>Description</h3>

<p>Combines two or more ensembles of <code>rfPermute</code> objects into 
one, combining <code>randomForest</code> results, null distributions, 
and re-calculating p-values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>combineRP(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="combineRP_+3A_...">...</code></td>
<td>
<p>two or more objects of class <code>rfPermute</code>, to be combined 
into one.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Eric Archer <a href="mailto:eric.archer@noaa.gov">eric.archer@noaa.gov</a>
</p>


<h3>See Also</h3>

<p><code><a href="randomForest.html#topic+combine">combine</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(iris)
rp1 &lt;- rfPermute(
  Species ~ ., iris, ntree = 50, norm.votes = FALSE, nrep = 100, num.cores = 1
)
rp2 &lt;- rfPermute(
  Species ~ ., iris, ntree = 50, norm.votes = FALSE, nrep = 100, num.cores = 1
)
rp3 &lt;- rfPermute(
  Species ~ ., iris, ntree = 50, norm.votes = FALSE, nrep = 100, num.cores = 1
)
rp.all &lt;- combineRP(rp1, rp2, rp3)
rp.all

plotNull(rp.all) 

</code></pre>

<hr>
<h2 id='confusionMatrix'>Confusion Matrix</h2><span id='topic+confusionMatrix'></span><span id='topic+plotConfMat'></span>

<h3>Description</h3>

<p>Generate a confusion matrix for Random Forest classification 
models with error rates translated into percent correctly classified, 
and columns for confidence intervals added.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>confusionMatrix(x, conf.level = 0.95, threshold = NULL)

plotConfMat(x, title = NULL, plot = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="confusionMatrix_+3A_x">x</code></td>
<td>
<p>a <code>rfPermute</code> or <code>randomForest</code> model object.</p>
</td></tr>
<tr><td><code id="confusionMatrix_+3A_conf.level">conf.level</code></td>
<td>
<p>confidence level for the <code><a href="stats.html#topic+binom.test">binom.test</a></code> 
confidence interval</p>
</td></tr>
<tr><td><code id="confusionMatrix_+3A_threshold">threshold</code></td>
<td>
<p>threshold to test observed classification 
probability against. Should be a number between 0 and 1. 
If not <code>NULL</code>, the output matrix will have extra 
columns giving the one-tailed probability that the true correct 
classification is &gt;= <code>threshold</code>.</p>
</td></tr>
<tr><td><code id="confusionMatrix_+3A_title">title</code></td>
<td>
<p>a title for the plot.</p>
</td></tr>
<tr><td><code id="confusionMatrix_+3A_plot">plot</code></td>
<td>
<p>display the plot?</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Eric Archer <a href="mailto:eric.archer@noaa.gov">eric.archer@noaa.gov</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+classPriors">classPriors</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(randomForest)
data(mtcars)

rf &lt;- randomForest(factor(am) ~ ., mtcars)
confusionMatrix(rf)

confusionMatrix(rf, conf.level = 0.75)

confusionMatrix(rf, threshold = 0.7)
confusionMatrix(rf, threshold = 0.8)
confusionMatrix(rf, threshold = 0.95)

</code></pre>

<hr>
<h2 id='importance'>Extract rfPermute Importance Scores and p-values.</h2><span id='topic+importance'></span><span id='topic+importance.rfPermute'></span><span id='topic+plotImportance'></span>

<h3>Description</h3>

<p>The <code>importance</code> function extracts a matrix of 
the observed importance scores and p-values from the object 
produced by a call to <code>rfPermute</code>. <code>plotImportance</code> produces 
a visualization of importance scores as either a barchart or heatmap.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'rfPermute'
importance(x, scale = TRUE, sort.by = NULL, decreasing = TRUE, ...)

plotImportance(
  x,
  plot.type = c("bar", "heatmap"),
  imp.type = NULL,
  scale = TRUE,
  sig.only = FALSE,
  alpha = 0.05,
  n = NULL,
  ranks = TRUE,
  xlab = NULL,
  ylab = NULL,
  main = NULL,
  size = 3,
  plot = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="importance_+3A_x">x</code></td>
<td>
<p>for <code>importance</code>, an object produced by a call to 
<code>rfPermute</code>. For <code>plotImportance</code>, either a <code>rfPermute</code> 
or <code>randomForest</code> model object. If the latter, it must have been 
run with <code>importance = TRUE</code>.</p>
</td></tr>
<tr><td><code id="importance_+3A_scale">scale</code></td>
<td>
<p>for permutation based measures, should the measures be divided 
their &quot;standard errors&quot;?</p>
</td></tr>
<tr><td><code id="importance_+3A_sort.by">sort.by</code></td>
<td>
<p>character vector giving the importance metric(s) or p-values 
to sort by. If <code>NULL</code>, defaults to <code>"MeanDecreaseAccuracy"</code> for 
classification models and <code>"%IncMSE"</code> for regression models.</p>
</td></tr>
<tr><td><code id="importance_+3A_decreasing">decreasing</code></td>
<td>
<p>logical. Should the sort order be increasing or decreasing?</p>
</td></tr>
<tr><td><code id="importance_+3A_...">...</code></td>
<td>
<p>arguments to be passed to and from other methods.</p>
</td></tr>
<tr><td><code id="importance_+3A_plot.type">plot.type</code></td>
<td>
<p>plot importances as a <code>bar</code> chart or <code>heatmap</code>?</p>
</td></tr>
<tr><td><code id="importance_+3A_imp.type">imp.type</code></td>
<td>
<p>character vector listing which importance measures to plot.
Can be class names (for classification models) or names of overall 
importance measures (e.g., &quot;MeanDecreaseAccuracy&quot;).</p>
</td></tr>
<tr><td><code id="importance_+3A_sig.only">sig.only</code></td>
<td>
<p>Plot only the significant (&lt;= <code>alpha</code>) predictors?</p>
</td></tr>
<tr><td><code id="importance_+3A_alpha">alpha</code></td>
<td>
<p>a number specifying the critical alpha for identifying 
predictors with importance scores significantly different from random. 
This parameter is only relevant if <code>rf</code> is a <code><a href="#topic+rfPermute">rfPermute</a></code>
object with p-values. Importance measures with p-values less than or 
equal to <code>alpha</code> will be denoted in barcharts in red and in the
heatmap by a white diamond. If set to <code>NULL</code>, significance is not 
denoted.</p>
</td></tr>
<tr><td><code id="importance_+3A_n">n</code></td>
<td>
<p>plot <code>n</code> most important predictors.</p>
</td></tr>
<tr><td><code id="importance_+3A_ranks">ranks</code></td>
<td>
<p>plot ranks instead of actual importance scores?</p>
</td></tr>
<tr><td><code id="importance_+3A_xlab">xlab</code>, <code id="importance_+3A_ylab">ylab</code></td>
<td>
<p>labels for the x and y axes.</p>
</td></tr>
<tr><td><code id="importance_+3A_main">main</code></td>
<td>
<p>main title for plot.</p>
</td></tr>
<tr><td><code id="importance_+3A_size">size</code></td>
<td>
<p>a value specifying the size of the significance diamond in the 
heatmap if the p-value &lt;= <code>alpha</code>.</p>
</td></tr>
<tr><td><code id="importance_+3A_plot">plot</code></td>
<td>
<p>display the plot?</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Eric Archer <a href="mailto:eric.archer@noaa.gov">eric.archer@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mtcars)

# A classification model classifying cars to manual or automatic transmission 
am.rp &lt;- rfPermute(factor(am) ~ ., mtcars, ntree = 100, nrep = 50)
  
imp.scaled &lt;- importance(am.rp, scale = TRUE)
imp.scaled

# plot scaled importance scores
plotImportance(am.rp, scale = TRUE)

# plot unscaled and only significant scores
plotImportance(am.rp, scale = FALSE, sig.only = TRUE)

</code></pre>

<hr>
<h2 id='pctCorrect'>Percent Correctly Classified</h2><span id='topic+pctCorrect'></span>

<h3>Description</h3>

<p>For classification models, calculate the percent of 
individuals correctly classified in a specified percent of trees in 
the forest.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pctCorrect(x, pct = c(seq(0.8, 0.95, 0.05), 0.99))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pctCorrect_+3A_x">x</code></td>
<td>
<p>a <code>rfPermte</code> or <code>randomForest</code> model object.</p>
</td></tr>
<tr><td><code id="pctCorrect_+3A_pct">pct</code></td>
<td>
<p>vector of minimum percent of trees voting for each class. Can be 
<code>0:1</code> or <code>0:100</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a matrix giving the percent of individuals correctly classified in 
each class and overall for each threshold value specified in <code>pct</code>.
</p>


<h3>Author(s)</h3>

<p>Eric Archer <a href="mailto:eric.archer@noaa.gov">eric.archer@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(randomForest)
data(mtcars)

rf &lt;- randomForest(factor(am) ~ ., mtcars, importance = TRUE)
pctCorrect(rf)

</code></pre>

<hr>
<h2 id='plotImpPreds'>Plot Important Predictor Distribution</h2><span id='topic+plotImpPreds'></span>

<h3>Description</h3>

<p>For classification models, plot distribution of predictor 
variables on classes sorted by order of importance in model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotImpPreds(
  x,
  df,
  class.col,
  imp.type = NULL,
  max.vars = 16,
  scale = TRUE,
  size = 1,
  point.alpha = 0.2,
  violin.alpha = 0.5,
  plot = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotImpPreds_+3A_x">x</code></td>
<td>
<p>a <code>rfPermute</code> or <code>randomForest</code> model object.</p>
</td></tr>
<tr><td><code id="plotImpPreds_+3A_df">df</code></td>
<td>
<p>data.frame with predictors in <code>rf</code> model.</p>
</td></tr>
<tr><td><code id="plotImpPreds_+3A_class.col">class.col</code></td>
<td>
<p>response column name in <code>df</code>.</p>
</td></tr>
<tr><td><code id="plotImpPreds_+3A_imp.type">imp.type</code></td>
<td>
<p>character string representing importance type to use for 
sorting predictors.</p>
</td></tr>
<tr><td><code id="plotImpPreds_+3A_max.vars">max.vars</code></td>
<td>
<p>number of variables to plot (from most important to least).</p>
</td></tr>
<tr><td><code id="plotImpPreds_+3A_scale">scale</code></td>
<td>
<p>For permutation based importance measures, should they be divided 
their &quot;standard errors&quot;?</p>
</td></tr>
<tr><td><code id="plotImpPreds_+3A_size">size</code>, <code id="plotImpPreds_+3A_point.alpha">point.alpha</code>, <code id="plotImpPreds_+3A_violin.alpha">violin.alpha</code></td>
<td>
<p>controls size of points and alpha 
values (transparency) for points and violin plots.</p>
</td></tr>
<tr><td><code id="plotImpPreds_+3A_plot">plot</code></td>
<td>
<p>display the plot?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the <code>ggplot2</code> object is invisibly returned.
</p>


<h3>Note</h3>

<p>If the model in <code>x</code> is from <code>randomForest</code> and was run 
with <code>importance = TRUE</code>, then 'MeanDecreaseAccuracy' is used as 
the default importance measure for sorting. Otherwise, 'MeanDecreaseGini' 
is used.
</p>


<h3>Author(s)</h3>

<p>Eric Archer <a href="mailto:eric.archer@noaa.gov">eric.archer@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(randomForest)
data(mtcars)

df &lt;- mtcars
df$am &lt;- factor(df$am)

rf &lt;- randomForest(am ~ ., df, importance = TRUE)
plotImpPreds(rf, df, "am")

</code></pre>

<hr>
<h2 id='plotInbag'>Plot Inbag distribution</h2><span id='topic+plotInbag'></span>

<h3>Description</h3>

<p>Plot distribution of the fraction of trees that samples were
inbag in the Random Forest model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotInbag(x, bins = 10, replace = TRUE, sampsize = NULL, plot = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotInbag_+3A_x">x</code></td>
<td>
<p>a <code>rfPermute</code> or <code>randomForest</code> model object..</p>
</td></tr>
<tr><td><code id="plotInbag_+3A_bins">bins</code></td>
<td>
<p>number of bins in histogram.</p>
</td></tr>
<tr><td><code id="plotInbag_+3A_replace">replace</code></td>
<td>
<p>was sampling done with or without replacement?</p>
</td></tr>
<tr><td><code id="plotInbag_+3A_sampsize">sampsize</code></td>
<td>
<p>sizes of samples drawn. Either a single value or vector of 
sample sizes as long as the number of classes.</p>
</td></tr>
<tr><td><code id="plotInbag_+3A_plot">plot</code></td>
<td>
<p>display the plot?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the <code>ggplot2</code> object is invisibly returned.
</p>


<h3>Note</h3>

<p>Red vertical lines on the plot denote the expected inbag rate(s). 
These rates are based on the values of <code>replace</code> and 
<code>sampsize</code> supplied. If not specified, they are set to the 
<code><a href="randomForest.html#topic+randomForest">randomForest</a></code> defaults. If this is not the 
same as the arguments used to run the model, there will be a mismatch in 
the location of these indicator lines and the inbag frequency distribution.
</p>


<h3>Author(s)</h3>

<p>Eric Archer <a href="mailto:eric.archer@noaa.gov">eric.archer@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(randomForest)
data(mtcars)

sampsize = c(5, 5)

rf &lt;- randomForest(factor(am) ~ ., data = mtcars, ntree = 10)
plotInbag(rf)

rf &lt;- randomForest(factor(am) ~ ., data = mtcars, ntree = 1000)
plotInbag(rf)

rf &lt;- randomForest(factor(am) ~ ., data = mtcars, ntree = 10000)
plotInbag(rf)

</code></pre>

<hr>
<h2 id='plotNull'>Plot Random Forest Importance Null Distributions</h2><span id='topic+plotNull'></span>

<h3>Description</h3>

<p>Plot the Random Forest null distributions importance metrics, 
observed values, and p-values for each predictor variable from the 
object produced by a call to <code><a href="#topic+rfPermute">rfPermute</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotNull(
  x,
  preds = NULL,
  imp.type = NULL,
  scale = TRUE,
  plot.type = c("density", "hist"),
  plot = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotNull_+3A_x">x</code></td>
<td>
<p>An object produced by a call to <code><a href="#topic+rfPermute">rfPermute</a></code>.</p>
</td></tr>
<tr><td><code id="plotNull_+3A_preds">preds</code></td>
<td>
<p>a character vector of predictors to plot. If <code>NULL</code>, then 
all predictors are plotted.</p>
</td></tr>
<tr><td><code id="plotNull_+3A_imp.type">imp.type</code></td>
<td>
<p>A character vector giving the importance metric(s) to plot.</p>
</td></tr>
<tr><td><code id="plotNull_+3A_scale">scale</code></td>
<td>
<p>Plot importance measures scaled (divided by) standard errors?</p>
</td></tr>
<tr><td><code id="plotNull_+3A_plot.type">plot.type</code></td>
<td>
<p>type of plot to produce: <code>"density"</code> for smoothed density 
plot, or <code>"hist"</code> for histogram.</p>
</td></tr>
<tr><td><code id="plotNull_+3A_plot">plot</code></td>
<td>
<p>display the plot?</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function will generate an plot for each predictor, with facetted 
importance metrics. The vertical red line shows the observed importance 
score and the _p_-value is given in the facet label.
</p>


<h3>Value</h3>

<p>A named list of the <code>ggplot</code> figures produced is invisibly returned.
</p>


<h3>Author(s)</h3>

<p>Eric Archer <a href="mailto:eric.archer@noaa.gov">eric.archer@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># A regression model using the ozone example
data(airquality)
ozone.rp &lt;- rfPermute(
  Ozone ~ ., data = airquality, ntree = 100, 
  na.action = na.omit, nrep = 50, num.cores = 1
)
  
# Plot the null distributions and observed values.
plotNull(ozone.rp) 

</code></pre>

<hr>
<h2 id='plotPredictedProbs'>Plot Predicted Probabilities</h2><span id='topic+plotPredictedProbs'></span>

<h3>Description</h3>

<p>Plot histogram of assignment probabilities to predicted class. 
This is used for determining if the model differentiates between correctly 
and incorrectly classified samples in terms of how strongly they are 
classified.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotPredictedProbs(x, bins = 30, plot = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotPredictedProbs_+3A_x">x</code></td>
<td>
<p>a <code>rfPermute</code> or <code>randomForest</code> model object.</p>
</td></tr>
<tr><td><code id="plotPredictedProbs_+3A_bins">bins</code></td>
<td>
<p>number of bins in histogram. Defaults to number of samples / 5.</p>
</td></tr>
<tr><td><code id="plotPredictedProbs_+3A_plot">plot</code></td>
<td>
<p>display the plot?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the <code>ggplot2</code> object is invisibly returned.
</p>


<h3>Author(s)</h3>

<p>Eric Archer <a href="mailto:eric.archer@noaa.gov">eric.archer@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(randomForest)
data(mtcars)

rf &lt;- randomForest(factor(am) ~ ., mtcars)
plotPredictedProbs(rf, bins = 20)

</code></pre>

<hr>
<h2 id='plotProximity'>Plot Random Forest Proximity Scores</h2><span id='topic+plotProximity'></span>

<h3>Description</h3>

<p>Create a plot of Random Forest proximity scores using 
multi-dimensional scaling.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotProximity(
  x,
  dim.x = 1,
  dim.y = 2,
  class.cols = NULL,
  legend.type = c("legend", "label", "none"),
  legend.loc = c("top", "bottom", "left", "right"),
  point.size = 2,
  circle.size = 8,
  circle.border = 1,
  group.type = c("ellipse", "hull", "contour", "none"),
  group.alpha = 0.3,
  ellipse.level = 0.95,
  n.contour.grid = 100,
  label.size = 4,
  label.alpha = 0.7,
  plot = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotProximity_+3A_x">x</code></td>
<td>
<p>a <code>rfPermute</code> or <code>randomForest</code> model object.</p>
</td></tr>
<tr><td><code id="plotProximity_+3A_dim.x">dim.x</code>, <code id="plotProximity_+3A_dim.y">dim.y</code></td>
<td>
<p>numeric values giving x and y dimensions to plot from 
multidimensional scaling of proximity scores.</p>
</td></tr>
<tr><td><code id="plotProximity_+3A_class.cols">class.cols</code></td>
<td>
<p>vector of colors to use for each class.</p>
</td></tr>
<tr><td><code id="plotProximity_+3A_legend.type">legend.type</code></td>
<td>
<p>type of legend to use to label classes.</p>
</td></tr>
<tr><td><code id="plotProximity_+3A_legend.loc">legend.loc</code></td>
<td>
<p>character keyword specifying location of legend. 
Can be <code>"bottom", "top", "left", "right"</code>.</p>
</td></tr>
<tr><td><code id="plotProximity_+3A_point.size">point.size</code></td>
<td>
<p>size of central points. Set to <code>NULL</code> for no points.</p>
</td></tr>
<tr><td><code id="plotProximity_+3A_circle.size">circle.size</code></td>
<td>
<p>size of circles around points indicating classification.
Set to NULL for no circles.</p>
</td></tr>
<tr><td><code id="plotProximity_+3A_circle.border">circle.border</code></td>
<td>
<p>width of circle border.</p>
</td></tr>
<tr><td><code id="plotProximity_+3A_group.type">group.type</code></td>
<td>
<p>type of grouping to display.
Ignored for regression models.</p>
</td></tr>
<tr><td><code id="plotProximity_+3A_group.alpha">group.alpha</code></td>
<td>
<p>value giving alpha transparency level for group shading. 
Setting to <code>0</code> produces no shading.</p>
</td></tr>
<tr><td><code id="plotProximity_+3A_ellipse.level">ellipse.level</code></td>
<td>
<p>the confidence level at which to draw the ellipse.</p>
</td></tr>
<tr><td><code id="plotProximity_+3A_n.contour.grid">n.contour.grid</code></td>
<td>
<p>number of grid points for contour lines.</p>
</td></tr>
<tr><td><code id="plotProximity_+3A_label.size">label.size</code></td>
<td>
<p>size of label if <code>legend.type = `label`</code>.</p>
</td></tr>
<tr><td><code id="plotProximity_+3A_label.alpha">label.alpha</code></td>
<td>
<p>transparency of label background.</p>
</td></tr>
<tr><td><code id="plotProximity_+3A_plot">plot</code></td>
<td>
<p>logical determining whether or not to show plot.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Produces a scatter plot of proximity scores for <code>dim.x</code> and 
<code>dim.y</code> dimensions from a multidimensional scale (MDS) conversion of 
proximity scores from a <code>randomForest</code> object. For classification 
models, points are colored according to original (inner) 
and predicted (outer) class.
</p>


<h3>Value</h3>

<p>a list with: 
</p>
<table>
<tr><td><code>prox.mds</code></td>
<td>
<p>the MDS scores of the selected dimensions</p>
</td></tr> 
<tr><td><code>g</code></td>
<td>
<p><code><a href="ggplot2.html#topic+ggplot">ggplot</a></code> object</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Eric Archer <a href="mailto:eric.archer@noaa.gov">eric.archer@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(randomForest)
data(symb.metab)

rf &lt;- randomForest(type ~ ., symb.metab, proximity = TRUE)

# With confidence ellipses
plotProximity(rf)

# With convex hulls
plotProximity(rf, group.type = "hull")

# With contours
plotProximity(rf, group.type = "contour")

# Remove the points and just show ellipses
plotProximity(rf, point.size = NULL, circle.size = NULL, group.alpha = 0.5)

# Labels instead of a legend
plotProximity(rf, legend.type = "label", point.size = NULL, circle.size = NULL, group.alpha = 0.5)

</code></pre>

<hr>
<h2 id='plotTrace'>Plot Trace</h2><span id='topic+plotTrace'></span>

<h3>Description</h3>

<p>Plot trace of cumulative OOB (classification) or MSE 
(regression) error rate by number of trees.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotTrace(x, pct.correct = TRUE, plot = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotTrace_+3A_x">x</code></td>
<td>
<p>a <code>rfPermute</code> or <code>randomForest</code> model object.</p>
</td></tr>
<tr><td><code id="plotTrace_+3A_pct.correct">pct.correct</code></td>
<td>
<p>display y-axis as percent correctly classified 
(<code>TRUE</code>) or OOB error rate (<code>FALSE</code>).</p>
</td></tr>
<tr><td><code id="plotTrace_+3A_plot">plot</code></td>
<td>
<p>display the plot?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the <code>ggplot2</code> object is invisibly returned.
</p>


<h3>Author(s)</h3>

<p>Eric Archer <a href="mailto:eric.archer@noaa.gov">eric.archer@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(randomForest)
data(mtcars)

rf &lt;- randomForest(factor(am) ~ ., mtcars)
plotTrace(rf)

</code></pre>

<hr>
<h2 id='plotVotes'>Plot Vote Distribution</h2><span id='topic+plotVotes'></span>

<h3>Description</h3>

<p>For classification models, plot distribution of votes for each 
sample in each class.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotVotes(x, type = NULL, freq.sep.line = TRUE, plot = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotVotes_+3A_x">x</code></td>
<td>
<p>a <code>rfPermute</code> or <code>randomForest</code> model object.</p>
</td></tr>
<tr><td><code id="plotVotes_+3A_type">type</code></td>
<td>
<p>either <code>area</code> for stacked continuous area plot or 
<code>bar</code> for discrete stacked bar chart. The latter is prefered for small 
numbers of cases. If not specified, a bar chart will be used if all 
classes have &lt;= 30 cases.</p>
</td></tr>
<tr><td><code id="plotVotes_+3A_freq.sep.line">freq.sep.line</code></td>
<td>
<p>put frequency of original group on second line in facet 
label? If <code>FALSE</code>, labels are single line. If <code>NULL</code> frequencies 
will not be included in labels.</p>
</td></tr>
<tr><td><code id="plotVotes_+3A_plot">plot</code></td>
<td>
<p>display the plot?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the <code>ggplot2</code> object is invisibly returned.
</p>


<h3>Author(s)</h3>

<p>Eric Archer <a href="mailto:eric.archer@noaa.gov">eric.archer@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(randomForest)
data(mtcars)

rf &lt;- randomForest(factor(am) ~ ., mtcars)
plotVotes(rf)

</code></pre>

<hr>
<h2 id='rfPermute'>Estimate Permutation p-values for Random Forest Importance Metrics</h2><span id='topic+rfPermute'></span><span id='topic+rfPermute.default'></span><span id='topic+rfPermute.formula'></span><span id='topic+as.randomForest'></span><span id='topic+print.rfPermute'></span><span id='topic+predict.rfPermute'></span>

<h3>Description</h3>

<p>Estimate significance of importance metrics for a Random Forest 
model by permuting the response variable. Produces null distribution of 
importance metrics for each predictor variable and p-value of observed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rfPermute(x, ...)

## Default S3 method:
rfPermute(x, y = NULL, ..., num.rep = 100, num.cores = 1)

## S3 method for class 'formula'
rfPermute(
  formula,
  data = NULL,
  ...,
  subset,
  na.action = na.fail,
  num.rep = 100,
  num.cores = 1
)

as.randomForest(x)

## S3 method for class 'rfPermute'
print(x, ...)

## S3 method for class 'rfPermute'
predict(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rfPermute_+3A_x">x</code>, <code id="rfPermute_+3A_y">y</code>, <code id="rfPermute_+3A_formula">formula</code>, <code id="rfPermute_+3A_data">data</code>, <code id="rfPermute_+3A_subset">subset</code>, <code id="rfPermute_+3A_na.action">na.action</code>, <code id="rfPermute_+3A_...">...</code></td>
<td>
<p>See <code><a href="randomForest.html#topic+randomForest">randomForest</a></code> 
for definitions. In <code>as.randomForest</code> this is either a 
<code>randomForest</code> or <code>rfPermute</code> object to be converted to a
<code>randomForest</code> object.</p>
</td></tr>
<tr><td><code id="rfPermute_+3A_num.rep">num.rep</code></td>
<td>
<p>Number of permutation replicates to run to construct 
null distribution and calculate p-values (default = 100).</p>
</td></tr>
<tr><td><code id="rfPermute_+3A_num.cores">num.cores</code></td>
<td>
<p>Number of CPUs to distribute permutation results over. 
Defaults to <code>NULL</code> which uses one fewer than the number of cores 
reported by <code><a href="parallel.html#topic+detectCores">detectCores</a></code>.</p>
</td></tr>
<tr><td><code id="rfPermute_+3A_object">object</code></td>
<td>
<p>an <code>rfPermute</code> model to be used for prediction. See
<code><a href="randomForest.html#topic+predict.randomForest">predict.randomForest</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>All other parameters are as defined in <code>randomForest.formula</code>. 
A Random Forest model is first created as normal to calculate the observed 
values of variable importance. The response variable is then permuted 
<code>num.rep</code> times, with a new Random Forest model built for each 
permutation step.
</p>


<h3>Value</h3>

<p>An <code>rfPermute</code> object.
</p>


<h3>Author(s)</h3>

<p>Eric Archer <a href="mailto:eric.archer@noaa.gov">eric.archer@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># A regression model predicting ozone levels
data(airquality)
ozone.rp &lt;- rfPermute(Ozone ~ ., data = airquality, na.action = na.omit, ntree = 100, num.rep = 50)
ozone.rp
  
# Plot the scaled importance distributions 
# Significant (p &lt;= 0.05) predictors are in red
plotImportance(ozone.rp, scale = TRUE)

# Plot the importance null distributions and observed values for two of the predictors
plotNull(ozone.rp, preds = c("Solar.R", "Month"))


# A classification model classifying cars to manual or automatic transmission 
data(mtcars)

am.rp &lt;- rfPermute(factor(am) ~ ., mtcars, ntree = 100, num.rep = 50)
summary(am.rp)


plotImportance(am.rp, scale = TRUE, sig.only = TRUE)



</code></pre>

<hr>
<h2 id='rfPermute_package'><code>rfPermute</code> package</h2><span id='topic+rfPermute_package'></span><span id='topic+rfPermuteTutorial'></span><span id='topic+rfPermute-package'></span>

<h3>Description</h3>

<p>Random Forest Predictor Importance Significance and Model Diagnostics.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rfPermuteTutorial()
</code></pre>

<hr>
<h2 id='summary'>Diagnostics of <code>rfPermute</code> or <code>randomForest</code> models.</h2><span id='topic+summary'></span><span id='topic+summary.randomForest'></span><span id='topic+summary.rfPermute'></span>

<h3>Description</h3>

<p>Combine plots of error traces and inbag rates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'randomForest'
summary(object, ...)

## S3 method for class 'rfPermute'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary_+3A_object">object</code></td>
<td>
<p>a <code>rfPermute</code> or <code>randomForest</code> model object to 
summarize.</p>
</td></tr>
<tr><td><code id="summary_+3A_...">...</code></td>
<td>
<p>arguments passed to <code><a href="#topic+plotInbag">plotInbag</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A combination of plots from <code><a href="#topic+plotTrace">plotTrace</a></code> and 
<code><a href="#topic+plotInbag">plotInbag</a></code> as well as summary confusion matrices 
(classification) or error rates (regression) from the model.
</p>


<h3>Author(s)</h3>

<p>Eric Archer <a href="mailto:eric.archer@noaa.gov">eric.archer@noaa.gov</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plotTrace">plotTrace</a></code>, <code><a href="#topic+plotInbag">plotInbag</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># A regression model using the ozone example
data(airquality)
ozone.rp &lt;- rfPermute(
  Ozone ~ ., data = airquality, na.action = na.omit,
  ntree = 100, nrep = 50, num.cores = 1
)

summary(ozone.rp)
 
</code></pre>

<hr>
<h2 id='symb.metab'>Symbiodinium type metabolite profiles</h2><span id='topic+symb.metab'></span>

<h3>Description</h3>

<p>A data.frame of 155 metabolite relative concentrations for 
64 samples of four Symbiodinium clade types.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(symb.metab)
</code></pre>


<h3>Format</h3>

<p>data.frame
</p>


<h3>References</h3>

<p>Klueter, A.; Crandall, J.B.; Archer, F.I.; Teece, M.A.; Coffroth, M.A.	
Taxonomic and Environmental Variation of Metabolite Profiles in Marine 
Dinoflagellates of the Genus Symbiodinium. Metabolites 2015, 5, 74-99.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
