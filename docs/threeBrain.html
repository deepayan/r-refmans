<!DOCTYPE html><html lang="en-US"><head><title>Help for package threeBrain</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {threeBrain}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#AbstractGeom'><p>R6 Class - Abstract Class of Geometries</p></a></li>
<li><a href='#BlankGeom'><p>A geometry that renders nothing</p></a></li>
<li><a href='#brain_proxy'><p>Shiny Proxy for Viewer</p></a></li>
<li><a href='#brain_setup'><p>Setup Package, Install Environment</p></a></li>
<li><a href='#calculate_rotation'><p>Calculate rotation matrix from non-zero vectors</p></a></li>
<li><a href='#check_freesurfer_path'><p>Function to check whether 'FreeSurfer' folder has everything we need</p></a></li>
<li><a href='#conform_volume'><p>Conform imaging data in <code>'FreeSurfer'</code> way</p></a></li>
<li><a href='#create_group'><p>Create a geometry group containing multiple geometries</p></a></li>
<li><a href='#cross_prod'><p>Calculate cross-product of two vectors in '3D'</p></a></li>
<li><a href='#DataCubeGeom'><p>R6 Class - Generate Data Cube Geometry</p></a></li>
<li><a href='#DataCubeGeom2'><p>R6 Class - Generate Data Cube Geometry via 3D Volume Texture</p></a></li>
<li><a href='#default_template_directory'><p>Default Directory to Store Template Brain</p></a></li>
<li><a href='#FreeGeom'><p>R6 Class - Generate Geometry from Vertices and Face Indices</p></a></li>
<li><a href='#freesurfer_brain'><p>Read 'FreeSurfer' surface and volume files</p></a></li>
<li><a href='#freesurfer_lut'><p>Query the 'FreeSurfer' labels</p></a></li>
<li><a href='#generate_smooth_envelope'><p>Generate smooth envelope around surface</p></a></li>
<li><a href='#generate_subcortical_surface'><p>Approximate 'sub-cortical' surfaces from 'parcellation'</p></a></li>
<li><a href='#geom_freemesh'><p>Creates any mesh geometry given vertices and face indices</p></a></li>
<li><a href='#geom_sphere'><p>Create sphere geometry</p></a></li>
<li><a href='#GeomGroup'><p>R6 Class - Generate Group of Geometries</p></a></li>
<li><a href='#get_digest_header'><p>Function to read digest header</p></a></li>
<li><a href='#get_ijk2ras'><p>Get 'voxel' to world matrix</p></a></li>
<li><a href='#import_from_freesurfer'><p>Import from 'FreeSurfer' and create 'JSON' cache for 3D viewer</p></a></li>
<li><a href='#import-fs-suma'><p>Import 'FreeSurfer' or 'SUMA' files into the viewer structure</p></a></li>
<li><a href='#LineSegmentsGeom'><p>R6 Class - Generate Line Segments</p></a></li>
<li><a href='#list_electrode_prototypes'><p>List or load all electrode prototypes</p></a></li>
<li><a href='#localization_module'><p>Launch a 'shiny' application to localize electrodes</p></a></li>
<li><a href='#merge_brain'><p>Create Multi-subject Template</p></a></li>
<li><a href='#new_electrode_prototype'><p>Create or load new electrode prototype from existing configurations</p></a></li>
<li><a href='#plot_slices'><p>Plot slices of volume</p></a></li>
<li><a href='#read_fs_asc'><p>Read 'FreeSurfer' ascii file</p></a></li>
<li><a href='#read_fs_labels'><p>Read FreeSurfer Annotations</p></a></li>
<li><a href='#read_fs_m3z'><p>Read 'FreeSurfer' m3z file</p></a></li>
<li><a href='#read_fs_mgh_mgz'><p>Read 'FreeSurfer' 'mgz/mgh' file</p></a></li>
<li><a href='#read_gii2'><p>Function to load surface data from 'Gifti' files</p></a></li>
<li><a href='#read_mgz'><p>Function to load 'FreeSurfer' 'mgz/mgh' file</p></a></li>
<li><a href='#read_volume'><p>Read volume file in <code>'MGH'</code> or <code>'Nifti'</code> formats</p></a></li>
<li><a href='#reexports'><p>Objects exported from other packages</p></a></li>
<li><a href='#renderBrain'><p>Shiny Renderer for threeBrain Widgets</p></a></li>
<li><a href='#reorient_volume'><p>Function to reshape data to 'RAS' order</p></a></li>
<li><a href='#save_brain'><p>Save threeBrain widgets to local file system</p></a></li>
<li><a href='#seeg_prototype'><p>Create <code>'sEEG'</code> shaft geometry prototype</p></a></li>
<li><a href='#SphereGeom'><p>R6 Class - Generate Sphere Geometry</p></a></li>
<li><a href='#SpriteGeom'><p>R6 Class - Generate Sphere Geometry</p></a></li>
<li><a href='#template_subject'><p>Download and Manage Template Subjects</p></a></li>
<li><a href='#threeBrain'><p>Create a brain object</p></a></li>
<li><a href='#threejs_brain'><p>Create a Threejs Brain and View it in Browsers</p></a></li>
<li><a href='#threejsBrainOutput'><p>Shiny Output for threeBrain Widgets</p></a></li>
<li><a href='#TubeGeom'><p>R6 Class - Generate Tube Geometry</p></a></li>
<li><a href='#video_content'><p>Add video content to the viewer</p></a></li>
<li><a href='#volume_to_surf'><p>Generate surface file from <code>'nii'</code> or <code>'mgz'</code> volume files</p></a></li>
<li><a href='#voxel_colormap'><p>Color maps for volume or surface data</p></a></li>
<li><a href='#voxel_cube'><p>Generate volume data from 'MNI' coordinates</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Your Advanced 3D Brain Visualization</td>
</tr>
<tr>
<td>Version:</td>
<td>1.2.0</td>
</tr>
<tr>
<td>Description:</td>
<td>A fast, interactive cross-platform, and easy to share 
    'WebGL'-based 3D brain viewer that visualizes 'FreeSurfer' and/or
    'AFNI/SUMA' surfaces. The viewer widget can be either standalone or 
    embedded into 'R-shiny' applications. The standalone version only require
    a web browser with 'WebGL2' support (for example, 'Chrome', 'Firefox', 
    'Safari'), and can be inserted into any websites. The 'R-shiny' 
    support allows the 3D viewer to be dynamically generated from reactive user 
    inputs. Please check the publication by Wang, Magnotti, Zhang,
    and Beauchamp (2023, &lt;<a href="https://doi.org/10.1523%2FENEURO.0328-23.2023">doi:10.1523/ENEURO.0328-23.2023</a>&gt;) for electrode 
    localization. This viewer has been fully adopted by 'RAVE' 
    <a href="https://openwetware.org/wiki/RAVE">https://openwetware.org/wiki/RAVE</a>, an interactive toolbox to 
    analyze 'iEEG' data by Magnotti, Wang, and Beauchamp (2020, 
    &lt;<a href="https://doi.org/10.1016%2Fj.neuroimage.2020.117341">doi:10.1016/j.neuroimage.2020.117341</a>&gt;). Please check 
    'citation("threeBrain")' for details.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.mozilla.org/en-US/MPL/2.0/">MPL-2.0</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://dipterix.org/threeBrain/">https://dipterix.org/threeBrain/</a>,
<a href="https://github.com/dipterix/threeBrain">https://github.com/dipterix/threeBrain</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/dipterix/threeBrain/issues">https://github.com/dipterix/threeBrain/issues</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>utils, grDevices, graphics, dipsaus, xml2, servr, png, knitr,
shiny (&ge; 1.2.0), digest (&ge; 0.6.22), freesurferformats (&ge;
0.1.7), jsonlite (&ge; 1.5), stringr (&ge; 1.3.1), htmlwidgets (&ge;
1.3), R6 (&ge; 2.3.0), gifti (&ge; 0.7.5), oro.nifti (&ge; 0.9.1)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>rmarkdown, DT, ravetools, htmltools</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-11-05 16:10:27 UTC; dipterix</td>
</tr>
<tr>
<td>Author:</td>
<td>Zhengjia Wang [aut, cre, cph],
  John Magnotti [ctb, res],
  Xiang Zhang [ctb, res],
  Brian Metzger [res],
  Elizabeth Nesbitt [res],
  Meng Li [ths],
  Michael Beauchamp [ths, ctb, dtc]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Zhengjia Wang &lt;dipterix.wang@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-11-07 18:20:03 UTC</td>
</tr>
</table>
<hr>
<h2 id='AbstractGeom'>R6 Class - Abstract Class of Geometries</h2><span id='topic+AbstractGeom'></span>

<h3>Description</h3>

<p>R6 Class - Abstract Class of Geometries
</p>


<h3>Author(s)</h3>

<p>Zhengjia Wang
</p>

<hr>
<h2 id='BlankGeom'>A geometry that renders nothing</h2><span id='topic+BlankGeom'></span>

<h3>Description</h3>

<p>This is mainly used when you want to upload group data only
</p>

<hr>
<h2 id='brain_proxy'>Shiny Proxy for Viewer</h2><span id='topic+brain_proxy'></span>

<h3>Description</h3>

<p>Shiny Proxy for Viewer
</p>


<h3>Usage</h3>

<pre><code class='language-R'>brain_proxy(outputId, session = shiny::getDefaultReactiveDomain())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="brain_proxy_+3A_outputid">outputId</code></td>
<td>
<p>shiny output ID</p>
</td></tr>
<tr><td><code id="brain_proxy_+3A_session">session</code></td>
<td>
<p>shiny session, default is current session (see <code><a href="shiny.html#topic+domains">domains</a></code>)</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>R6</code> class <code>ViewerProxy</code>
</p>

<hr>
<h2 id='brain_setup'>Setup Package, Install Environment</h2><span id='topic+brain_setup'></span>

<h3>Description</h3>

<p>Setup Package, Install Environment
</p>


<h3>Usage</h3>

<pre><code class='language-R'>brain_setup(continued = FALSE, show_example = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="brain_setup_+3A_continued">continued</code></td>
<td>
<p>logical, there are two phases of setting up environment. You
probably need to restart R session after the first phase and continue setting up.</p>
</td></tr>
<tr><td><code id="brain_setup_+3A_show_example">show_example</code></td>
<td>
<p>whether to show example of 'N27' subject at the end.</p>
</td></tr>
<tr><td><code id="brain_setup_+3A_...">...</code></td>
<td>
<p>ignored</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Zhengjia Wang
</p>

<hr>
<h2 id='calculate_rotation'>Calculate rotation matrix from non-zero vectors</h2><span id='topic+calculate_rotation'></span>

<h3>Description</h3>

<p>Calculate rotation matrix from non-zero vectors
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_rotation(vec_from, vec_to)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calculate_rotation_+3A_vec_from">vec_from</code></td>
<td>
<p>original vector, length of 3</p>
</td></tr>
<tr><td><code id="calculate_rotation_+3A_vec_to">vec_to</code></td>
<td>
<p>vector after rotation, length of 3</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A four-by-four transform matrix
</p>

<hr>
<h2 id='check_freesurfer_path'>Function to check whether 'FreeSurfer' folder has everything we need</h2><span id='topic+check_freesurfer_path'></span>

<h3>Description</h3>

<p>Function to check whether 'FreeSurfer' folder has everything we need
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_freesurfer_path(
  fs_subject_folder,
  autoinstall_template = FALSE,
  return_path = FALSE,
  check_volume = FALSE,
  check_surface = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_freesurfer_path_+3A_fs_subject_folder">fs_subject_folder</code></td>
<td>
<p>character, path to 'fs' project directory or 'RAVE' subject directory</p>
</td></tr>
<tr><td><code id="check_freesurfer_path_+3A_autoinstall_template">autoinstall_template</code></td>
<td>
<p>logical, whether 'N27' brain should be installed if missing</p>
</td></tr>
<tr><td><code id="check_freesurfer_path_+3A_return_path">return_path</code></td>
<td>
<p>logical, whether to return 'FreeSurfer' path</p>
</td></tr>
<tr><td><code id="check_freesurfer_path_+3A_check_volume">check_volume</code></td>
<td>
<p>logical, whether to check volume data</p>
</td></tr>
<tr><td><code id="check_freesurfer_path_+3A_check_surface">check_surface</code></td>
<td>
<p>logical, whether to check surface data (not implemented yet)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>logical whether the directory is valid or, if <code>return_path</code> is true,
return 'FreeSurfer' path
</p>

<hr>
<h2 id='conform_volume'>Conform imaging data in <code>'FreeSurfer'</code> way</h2><span id='topic+conform_volume'></span>

<h3>Description</h3>

<p>Reproduces conform algorithm used by <code>'FreeSurfer'</code> to conform
<code>'NIfTI'</code> and <code>'MGH'</code> images.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>conform_volume(x, save_to, dim = c(256, 256, 256))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="conform_volume_+3A_x">x</code></td>
<td>
<p>path to the image file</p>
</td></tr>
<tr><td><code id="conform_volume_+3A_save_to">save_to</code></td>
<td>
<p>path where the conformed image will be saved, must ends with
<code>'.mgz'</code></p>
</td></tr>
<tr><td><code id="conform_volume_+3A_dim">dim</code></td>
<td>
<p>positive integers of length three, the conformed dimension;
by default 'FreeSurfer' conform images to <code>1mm</code> volume cube with
<code>256x256x256</code> dimension</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing; the result will be save to <code>save_to</code>
</p>

<hr>
<h2 id='create_group'>Create a geometry group containing multiple geometries</h2><span id='topic+create_group'></span>

<h3>Description</h3>

<p>Create a geometry group containing multiple geometries
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_group(name, position = c(0, 0, 0), layer = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="create_group_+3A_name">name</code></td>
<td>
<p>string, name of the geometry</p>
</td></tr>
<tr><td><code id="create_group_+3A_position">position</code></td>
<td>
<p>x,y,z location of the group</p>
</td></tr>
<tr><td><code id="create_group_+3A_layer">layer</code></td>
<td>
<p>layer of the group. reserved</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A geometry group is a container of multiple geometries. The geometries
within the same group share the same shift and rotations (see example 1).
In ECoG/iEEG world, you might have 'MRI', 'CT', 'FreeSurfer' that have
different orientations. For example, if you want to align MRI to FreeSurfer,
Instead of calculating the position of each geometries, you can just put
all MRI components into a group, and then set transform of this group,
making the group aligned to FreeSurfer.
</p>
<p>GeomGroup also can be used to store large data. To generate 3D viewer,
'threeBrain' needs to dynamically serialize data into JSON format,
which can be read by browsers. However, a FreeSurfer brain might be ~30 MB.
This is a very large size and might take ~5 seconds to serialize.
To solve this problem, GeomGroup supports cache in its 'set_group_data'
method. This method supports caching static serialized data into a JSON file,
and allows the files to be loaded as static data objects. By &quot;static&quot;, I mean
the data is not supposed to be dynamic, and it should be &quot;read-only&quot;.
In JavaScript code, I also optimized such that you don't need to load these
large datasets repeatedly. And this allows you to load multiple subjects'
brain in a short time.
</p>


<h3>Value</h3>

<p>a GeomGroup instance
</p>


<h3>Author(s)</h3>

<p>Zhengjia Wang
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Example 1: relative position

# create group
g = create_group('Group A')

# create two spheres at 10,0,0, but s2 is relative to group A
s1 = geom_sphere('Sphere 1', radius = 2, position = c(10,0,0))
s2 = geom_sphere('Sphere 2', radius = 2, position = c(10,0,0), group = g)

# set transform (rotation)
g$set_transform(matrix(c(
  0,1,0,0,
  1,0,0,0,
  0,0,1,0,
  0,0,0,1
), byrow = TRUE, ncol = 4))

# global position for s2 is 0,10,0
if( interactive() ) { threejs_brain(s1, s2) }

# Example 2: cache

## Not run: 

# download N27 brain
# Make sure you have N27 brain downloaded to `default_template_directory()`
# download_N27()

template_dir &lt;- default_template_directory()

dat = freesurferformats::read.fs.surface(
  file.path(template_dir, 'N27/surf/lh.pial')
)
vertex = dat$vertices[,1:3]
face = dat$faces[,1:3]

# 1. dynamically serialize
mesh = geom_freemesh('lh', vertex = vertex, face = face, layer = 1)

# 2. cache
# Create group, all geometries in this group are relatively positioned
tmp_file = tempfile()
mesh = geom_freemesh('Left Hemisphere cached', vertex = vertex,
                     face = face, cache_file = tmp_file)


## End(Not run)
</code></pre>

<hr>
<h2 id='cross_prod'>Calculate cross-product of two vectors in '3D'</h2><span id='topic+cross_prod'></span>

<h3>Description</h3>

<p>Calculate cross-product of two vectors in '3D'
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cross_prod(x, y)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cross_prod_+3A_x">x</code>, <code id="cross_prod_+3A_y">y</code></td>
<td>
<p>3-dimensional vectors</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A '3D' vector that is the cross-product of <code>x</code> and <code>y</code>
</p>

<hr>
<h2 id='DataCubeGeom'>R6 Class - Generate Data Cube Geometry</h2><span id='topic+DataCubeGeom'></span>

<h3>Description</h3>

<p>R6 Class - Generate Data Cube Geometry
</p>


<h3>Author(s)</h3>

<p>Zhengjia Wang
</p>

<hr>
<h2 id='DataCubeGeom2'>R6 Class - Generate Data Cube Geometry via 3D Volume Texture</h2><span id='topic+DataCubeGeom2'></span>

<h3>Description</h3>

<p>R6 Class - Generate Data Cube Geometry via 3D Volume Texture
</p>


<h3>Author(s)</h3>

<p>Zhengjia Wang
</p>

<hr>
<h2 id='default_template_directory'>Default Directory to Store Template Brain</h2><span id='topic+default_template_directory'></span>

<h3>Description</h3>

<p>Default Directory to Store Template Brain
</p>


<h3>Usage</h3>

<pre><code class='language-R'>default_template_directory(check = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="default_template_directory_+3A_check">check</code></td>
<td>
<p>logical, check if the folder is missing, is so,
create one. This option ensures the folder is always created.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When <code>threeBrain.template_dir</code> is not set or invalid, the
function checks 'RAVE' (R Analysis and Visualization for 'iEEG',
<a href="https://openwetware.org/wiki/RAVE">https://openwetware.org/wiki/RAVE</a>) folder at home directory. If
this folder is missing, then returns results from
<code>R_user_dir('threeBrain', 'data')</code>. To override the default behavior,
use <code>options(threeBrain.template_dir=...)</code>.
</p>


<h3>Value</h3>

<p>A directory path where template brain is stored at; see also
<code><a href="#topic+download_N27">download_N27</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
default_template_directory()

</code></pre>

<hr>
<h2 id='FreeGeom'>R6 Class - Generate Geometry from Vertices and Face Indices</h2><span id='topic+FreeGeom'></span>

<h3>Description</h3>

<p>R6 Class - Generate Geometry from Vertices and Face Indices
</p>

<hr>
<h2 id='freesurfer_brain'>Read 'FreeSurfer' surface and volume files</h2><span id='topic+freesurfer_brain'></span><span id='topic+freesurfer_brain2'></span>

<h3>Description</h3>

<p>Read 'FreeSurfer' surface and volume files
</p>


<h3>Usage</h3>

<pre><code class='language-R'>freesurfer_brain(
  fs_subject_folder,
  subject_name,
  additional_surfaces = NULL,
  aligned_ct = NULL,
  use_cache = TRUE,
  use_141 = getOption("threeBrain.use141", TRUE)
)

freesurfer_brain2(
  fs_subject_folder,
  subject_name,
  volume_types = "t1",
  surface_types = "pial",
  curvature = "sulc",
  atlas_types = c("aparc+aseg", "aparc.a2009s+aseg", "aparc.DKTatlas+aseg"),
  ct_path = NULL,
  use_cache = TRUE,
  use_141 = getOption("threeBrain.use141", TRUE),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="freesurfer_brain_+3A_fs_subject_folder">fs_subject_folder</code></td>
<td>
<p>character, 'FreeSurfer' subject folder, or 'RAVE' subject folder</p>
</td></tr>
<tr><td><code id="freesurfer_brain_+3A_subject_name">subject_name</code></td>
<td>
<p>character, subject code to display with only letters and digits</p>
</td></tr>
<tr><td><code id="freesurfer_brain_+3A_additional_surfaces">additional_surfaces</code></td>
<td>
<p>character array, additional surface types to load, such as 'white', 'smoothwm'</p>
</td></tr>
<tr><td><code id="freesurfer_brain_+3A_aligned_ct">aligned_ct</code></td>
<td>
<p>character, path to 'ct_aligned_mri.nii.gz', used for electrode localization</p>
</td></tr>
<tr><td><code id="freesurfer_brain_+3A_use_cache">use_cache</code></td>
<td>
<p>logical, whether to use cached 'json' files or from raw 'FreeSurfer' files</p>
</td></tr>
<tr><td><code id="freesurfer_brain_+3A_use_141">use_141</code></td>
<td>
<p>logical, whether to use standard 141 brain for surface file, default is <code>getOption('threeBrain.use141', TRUE)</code></p>
</td></tr>
<tr><td><code id="freesurfer_brain_+3A_volume_types">volume_types</code></td>
<td>
<p>volume types, right now only support T1 image</p>
</td></tr>
<tr><td><code id="freesurfer_brain_+3A_surface_types">surface_types</code></td>
<td>
<p>surface types to load</p>
</td></tr>
<tr><td><code id="freesurfer_brain_+3A_curvature">curvature</code></td>
<td>
<p>curvature data. Only support <code>"sulc"</code> for current version</p>
</td></tr>
<tr><td><code id="freesurfer_brain_+3A_atlas_types">atlas_types</code></td>
<td>
<p>atlas types to be loaded, choices are <code>'aparc+aseg'</code>,
<code>'aparc.a2009s+aseg'</code>, <code>'aparc.DKTatlas+aseg'</code>, <code>'aseg'</code></p>
</td></tr>
<tr><td><code id="freesurfer_brain_+3A_ct_path">ct_path</code></td>
<td>
<p>an aligned CT file in 'Nifti' format</p>
</td></tr>
<tr><td><code id="freesurfer_brain_+3A_...">...</code></td>
<td>
<p>ignored</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is under FreeSurfer license.
1. Volumes:
3D viewer uses 'mri/T1.mgz' from 'FreeSurfer' to show the
volume information. 'T1.mgz' results from step 1 to 5 in 'FreeSurfer'
command 'recon-all -autorecon1', which aligns the original 'DICOM' image to 'RAS' coordinate
system, resamples to volume with <code>256x256x256</code> voxels (tri-linear by default,
check <a href="https://surfer.nmr.mgh.harvard.edu/fswiki/recon-all">https://surfer.nmr.mgh.harvard.edu/fswiki/recon-all</a>
for more information).
</p>
<p>2. Surface:
There are two options for surface files. The first choice is using
'std.141' brain generated by 'AFNI/SUMA'. This surface file re-calculates vertices
from standard 141 space, which averages the &quot;surface&quot; of 141 subjects. If you
want to map surface electrodes across different subjects, you might want to
consider this case as it's especially designed for surface mapping. However,
you'll need 'AFNI/SUMA' installed to generate the surface file. The details
can be found via <a href="https://openwetware.org/wiki/Beauchamp:CorticalSurfaceHCP">https://openwetware.org/wiki/Beauchamp:CorticalSurfaceHCP</a>,
and the 'AFNI/SUMA' command related is 'SurfToSurf'. Please generate the files
to '[FREESURFER SUBJECT DIR]/SUMA/'. The file name follows the convention of
'std.141.[lr]h.[SURFACE TYPE].[POSTFIX]', where 'lh' means left hemisphere and
'rh' means right hemisphere; 'SURFACE TYPE' can be 'pial', 'white', 'smoothwm',
and 'POSTFIX' can be 'asc', 'gii'. If multiple files for the same surface
type exists, the search order will be 'asc &gt; gii'.
The other option is to use mesh files directly from 'FreeSurfer' output located
at '[FREESURFER SUBJECT DIR]/surf'. If you want to use these surface, make sure
they are converted to 'asc' or 'gii' format.
</p>
<p>3. Electrode registration and transforms
This package provides two ways to map electrodes to standard space. For surface
electrodes, if standard 141 brain is provided, then the first option is to snap
electrodes to the nearest vertices in subject space. The key is the vertex number
matches across different subjects, hence the location of corresponding vertices
at template brain are the mapped electrode coordinates.
If standard 141 brain is missing, or the electrode type is 'stereo EEG', then
the second option is volume mapping. The idea is to map electrodes to 'MNI305'
brain. The details can be found at <a href="https://surfer.nmr.mgh.harvard.edu/fswiki/CoordinateSystems">https://surfer.nmr.mgh.harvard.edu/fswiki/CoordinateSystems</a>.
To perform volume mapping, we need 'FreeSurfer' folder 'mri/transforms'.
Currently, only linear 'Talairach' transform matrix is supported (located at
'talairach.xfm').
</p>
<p>4. Coordinates
The 3D viewer in this package uses the center of volume as the origin (0, 0, 0).
</p>


<h3>Author(s)</h3>

<p>Zhengjia Wang
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Please run `download_N27()` if `N27` is not at `default_template_directory()`

# Import from `FreeSurfer` subject folder
brain = threeBrain::freesurfer_brain(
  fs_subject_folder = file.path(default_template_directory(), 'N27'),
  subject_name = 'N27',
  additional_surfaces = c('white', 'smoothwm')
)

# Visualize. Alternatively, you can use brain$plot(...)
plot( brain )

## End(Not run)
</code></pre>

<hr>
<h2 id='freesurfer_lut'>Query the 'FreeSurfer' labels</h2><span id='topic+freesurfer_lut'></span>

<h3>Description</h3>

<p>Query the 'FreeSurfer' labels
</p>


<h3>Usage</h3>

<pre><code class='language-R'>freesurfer_lut
</code></pre>


<h3>Format</h3>

<p>An object of class <code>list</code> of length 3.
</p>


<h3>Details</h3>

<p>The 'FreeSurfer' atlases use
<a href="https://surfer.nmr.mgh.harvard.edu/fswiki/FsTutorial/AnatomicalROI/FreeSurferColorLUT">https://surfer.nmr.mgh.harvard.edu/fswiki/FsTutorial/AnatomicalROI/FreeSurferColorLUT</a>
look-up table to query indexes. The 'threeBrain' electrode localization
also uses this table to export the <code>'FSLabel'</code> from electrode. If
volume type is set to <code>'aparc_aseg'</code>, then please also use this
table to filter.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
freesurfer_lut$from_key(0:10)

freesurfer_lut$get_key("ctx-lh-supramarginal")

</code></pre>

<hr>
<h2 id='generate_smooth_envelope'>Generate smooth envelope around surface</h2><span id='topic+generate_smooth_envelope'></span>

<h3>Description</h3>

<p>Alternative to 'Matlab' version of <code>'pial-outer-smoothed'</code>,
use this function along with <code><a href="ravetools.html#topic+fill_surface">fill_surface</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>generate_smooth_envelope(
  surface_path,
  save_as = NULL,
  inflate = 3,
  verbose = TRUE,
  save_format = c("auto", "bin", "asc", "vtk", "ply", "off", "obj", "gii", "mz3", "byu")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="generate_smooth_envelope_+3A_surface_path">surface_path</code></td>
<td>
<p>path to <code>'*h.pial'</code> surface in the 'FreeSurfer'
folder, or a 3-dimensional mesh, see
<code><a href="freesurferformats.html#topic+read.fs.surface">read.fs.surface</a></code></p>
</td></tr>
<tr><td><code id="generate_smooth_envelope_+3A_save_as">save_as</code></td>
<td>
<p>save final envelope to path, or <code>NULL</code> for dry-run</p>
</td></tr>
<tr><td><code id="generate_smooth_envelope_+3A_inflate">inflate</code></td>
<td>
<p>number of <code>'voxels'</code> to inflate before fitting envelope;
must be a non-negative integer</p>
</td></tr>
<tr><td><code id="generate_smooth_envelope_+3A_verbose">verbose</code></td>
<td>
<p>whether to verbose the progress; default is true</p>
</td></tr>
<tr><td><code id="generate_smooth_envelope_+3A_save_format">save_format</code></td>
<td>
<p>format of saved file when <code>save_as</code> is not
<code>NULL</code>; see <code>format</code> argument in function
<code><a href="freesurferformats.html#topic+write.fs.surface">write.fs.surface</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A 3-dimensional mesh that contains vertices and face indices,
the result is also saved to <code>save_as</code> is specified.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if(interactive() &amp;&amp;
   file.exists(file.path(default_template_directory(), "N27"))) {

library(threeBrain)

fs_path &lt;- file.path(default_template_directory(), "N27")

# lh.pial-outer-smoothed
lh_pial &lt;- file.path(fs_path, "surf", "lh.pial")
save_as &lt;- file.path(fs_path, "surf", "lh.pial-outer-smoothed")
generate_smooth_envelope(lh_pial, save_as)

# rh.pial-outer-smoothed
rh_pial &lt;- file.path(fs_path, "surf", "rh.pial")
save_as &lt;- file.path(fs_path, "surf", "rh.pial-outer-smoothed")
generate_smooth_envelope(rh_pial, save_as)

brain &lt;- threeBrain(
  path = fs_path, subject_code = "N27",
  surface_types = 'pial-outer-smoothed'
)
brain$plot(controllers = list(
  "Surface Type" = 'pial-outer-smoothed'
))

}

</code></pre>

<hr>
<h2 id='generate_subcortical_surface'>Approximate 'sub-cortical' surfaces from 'parcellation'</h2><span id='topic+generate_subcortical_surface'></span>

<h3>Description</h3>

<p>Superseded by <code><a href="#topic+volume_to_surf">volume_to_surf</a></code>. Please do not use this function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>generate_subcortical_surface(
  atlas,
  index,
  save_prefix = NULL,
  label = NULL,
  IJK2RAS = NULL,
  grow = 1,
  remesh = TRUE,
  smooth = TRUE,
  smooth_delta = 3,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="generate_subcortical_surface_+3A_atlas">atlas</code></td>
<td>
<p>path to imaging 'parcellation', can be <code>'nii'</code> or <code>'mgz'</code> formats</p>
</td></tr>
<tr><td><code id="generate_subcortical_surface_+3A_index">index</code></td>
<td>
<p>'parcellation' index, see 'FreeSurfer' look-up table</p>
</td></tr>
<tr><td><code id="generate_subcortical_surface_+3A_save_prefix">save_prefix</code></td>
<td>
<p>parent folder to save the resulting surface</p>
</td></tr>
<tr><td><code id="generate_subcortical_surface_+3A_label">label</code></td>
<td>
<p>character label or name of the 'sub-cortical' structure, usually automatically derived from <code>index</code></p>
</td></tr>
<tr><td><code id="generate_subcortical_surface_+3A_ijk2ras">IJK2RAS</code></td>
<td>
<p>an 'Affine' matrix from 'voxel' index to <code>'tkrRAS'</code>, usually automatically derived from <code>atlas</code></p>
</td></tr>
<tr><td><code id="generate_subcortical_surface_+3A_grow">grow</code></td>
<td>
<p>amount to grow (dilate) before generating mesh</p>
</td></tr>
<tr><td><code id="generate_subcortical_surface_+3A_remesh">remesh</code>, <code id="generate_subcortical_surface_+3A_smooth">smooth</code>, <code id="generate_subcortical_surface_+3A_smooth_delta">smooth_delta</code>, <code id="generate_subcortical_surface_+3A_...">...</code></td>
<td>
<p>passed to <code><a href="ravetools.html#topic+mesh_from_volume">mesh_from_volume</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A surface mesh, containing 'atlas' index, label, surface nodes and face indices.
</p>

<hr>
<h2 id='geom_freemesh'>Creates any mesh geometry given vertices and face indices</h2><span id='topic+geom_freemesh'></span>

<h3>Description</h3>

<p>Creates any mesh geometry given vertices and face indices
</p>


<h3>Usage</h3>

<pre><code class='language-R'>geom_freemesh(
  name,
  vertex = NULL,
  face = NULL,
  position = c(0, 0, 0),
  layer = 1,
  cache_file = NULL,
  group = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="geom_freemesh_+3A_name">name</code></td>
<td>
<p>unique string in a scene to tell apart from different objects</p>
</td></tr>
<tr><td><code id="geom_freemesh_+3A_vertex">vertex</code></td>
<td>
<p>position of each vertices (3 columns)</p>
</td></tr>
<tr><td><code id="geom_freemesh_+3A_face">face</code></td>
<td>
<p>face indices indicating which 3 vertices to be linked (3 columns)</p>
</td></tr>
<tr><td><code id="geom_freemesh_+3A_position">position</code></td>
<td>
<p>x,y,z location of the geometry</p>
</td></tr>
<tr><td><code id="geom_freemesh_+3A_layer">layer</code></td>
<td>
<p>visibility of the geometry, used when there are multiple cameras 1 is visible for all cameras</p>
</td></tr>
<tr><td><code id="geom_freemesh_+3A_cache_file">cache_file</code></td>
<td>
<p>cache vertex and face data into group</p>
</td></tr>
<tr><td><code id="geom_freemesh_+3A_group">group</code></td>
<td>
<p>a GeomGroup object, if null, then the group will be generated automatically</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When generating a free mesh internally, a group must be specified,
therefore if group is <code>NULL</code> here, then a group will be generated.
However, it's always recommended to pass a group to the free mesh.
</p>


<h3>Author(s)</h3>

<p>Zhengjia Wang
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Make sure you have N27 brain downloaded to `default_template_directory()`
# threeBrain::download_N27()

n27_dir = file.path(default_template_directory(), "N27")
surf_type = 'pial'

# Locate mesh files
lh = read_fs_asc(file.path(n27_dir, sprintf('surf/lh.%s.asc', surf_type)))
rh = read_fs_asc(file.path(n27_dir, sprintf('surf/rh.%s.asc', surf_type)))

# Create groups
group = create_group(name = sprintf('Surface - %s (N27)', surf_type))

# create mesh
lh_mesh = geom_freemesh(
  name = sprintf('FreeSurfer Left Hemisphere - %s (N27)', surf_type),
  vertex = lh$vertices[,1:3],
  face = lh$faces[,1:3],
  group = group
)
rh_mesh = geom_freemesh(
  name = sprintf('FreeSurfer Right Hemisphere - %s (N27)', surf_type),
  vertex = rh$vertices[,1:3],
  face = rh$faces[,1:3],
  group = group
)


# Render
if( interactive() ) { threejs_brain(lh_mesh, rh_mesh) }




## End(Not run)
</code></pre>

<hr>
<h2 id='geom_sphere'>Create sphere geometry</h2><span id='topic+geom_sphere'></span>

<h3>Description</h3>

<p>Create sphere geometry
</p>


<h3>Usage</h3>

<pre><code class='language-R'>geom_sphere(
  name,
  radius,
  position = c(0, 0, 0),
  layer = 1,
  group = NULL,
  value = NULL,
  time_stamp = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="geom_sphere_+3A_name">name</code></td>
<td>
<p>unique string in a scene to tell apart from different objects</p>
</td></tr>
<tr><td><code id="geom_sphere_+3A_radius">radius</code></td>
<td>
<p>size of sphere</p>
</td></tr>
<tr><td><code id="geom_sphere_+3A_position">position</code></td>
<td>
<p>x,y,z location of the sphere</p>
</td></tr>
<tr><td><code id="geom_sphere_+3A_layer">layer</code></td>
<td>
<p>visibility of the geometry, used when there are multiple cameras 1 is visible for all cameras</p>
</td></tr>
<tr><td><code id="geom_sphere_+3A_group">group</code></td>
<td>
<p>a GeomGroup object</p>
</td></tr>
<tr><td><code id="geom_sphere_+3A_value">value</code>, <code id="geom_sphere_+3A_time_stamp">time_stamp</code></td>
<td>
<p>color of the sphere, used for animation/color rendering</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Zhengjia Wang
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Create a sphere with animation
g = lapply(1:10, function(ii){
  v = rep(ii, 10)
  v[1:ii] = 1:ii
  geom_sphere(paste0('s', ii), ii, value = v, position = c(11 * ii, 0,0), time_stamp = (1:10)/10)
})
if( interactive() ) { threejs_brain(.list = g) }
</code></pre>

<hr>
<h2 id='GeomGroup'>R6 Class - Generate Group of Geometries</h2><span id='topic+GeomGroup'></span>

<h3>Description</h3>

<p>R6 Class - Generate Group of Geometries
</p>


<h3>Author(s)</h3>

<p>Zhengjia Wang
</p>

<hr>
<h2 id='get_digest_header'>Function to read digest header</h2><span id='topic+get_digest_header'></span>

<h3>Description</h3>

<p>Function to read digest header
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_digest_header(file, key, if_error = NULL, .list = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_digest_header_+3A_file">file</code></td>
<td>
<p>file path to a 'JSON' file</p>
</td></tr>
<tr><td><code id="get_digest_header_+3A_key">key</code></td>
<td>
<p>character, key to extract</p>
</td></tr>
<tr><td><code id="get_digest_header_+3A_if_error">if_error</code></td>
<td>
<p>value to return if key not found or read error occurs</p>
</td></tr>
<tr><td><code id="get_digest_header_+3A_.list">.list</code></td>
<td>
<p>alternative list to supply if file is missing</p>
</td></tr>
</table>

<hr>
<h2 id='get_ijk2ras'>Get 'voxel' to world matrix</h2><span id='topic+get_ijk2ras'></span>

<h3>Description</h3>

<p>Get 'voxel' to world matrix
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_ijk2ras(x, type = c("scanner", "tkr"))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_ijk2ras_+3A_x">x</code></td>
<td>
<p>path to imaging files</p>
</td></tr>
<tr><td><code id="get_ijk2ras_+3A_type">type</code></td>
<td>
<p>world space type; choices are <code>'scanner'</code> (same as
<code>'sform'</code> or <code>'qform'</code> in) or <code>'NIfTI'</code> file headers;
or <code>'tkr'</code> (used to shared surface nodes)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A four by four matrix
</p>

<hr>
<h2 id='import_from_freesurfer'>Import from 'FreeSurfer' and create 'JSON' cache for 3D viewer</h2><span id='topic+import_from_freesurfer'></span>

<h3>Description</h3>

<p>Import from 'FreeSurfer' and create 'JSON' cache for 3D viewer
</p>


<h3>Usage</h3>

<pre><code class='language-R'>import_from_freesurfer(fs_path, subject_name, quiet = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="import_from_freesurfer_+3A_fs_path">fs_path</code></td>
<td>
<p>'FreeSurfer' subject directory</p>
</td></tr>
<tr><td><code id="import_from_freesurfer_+3A_subject_name">subject_name</code></td>
<td>
<p>subject code</p>
</td></tr>
<tr><td><code id="import_from_freesurfer_+3A_quiet">quiet</code></td>
<td>
<p>whether to suppress message or not</p>
</td></tr>
</table>


<h3>Value</h3>

<p>None.
</p>

<hr>
<h2 id='import-fs-suma'>Import 'FreeSurfer' or 'SUMA' files into the viewer structure</h2><span id='topic+import-fs-suma'></span><span id='topic+import_fs'></span><span id='topic+import_suma'></span>

<h3>Description</h3>

<p>Import 'T1-MRI', surface files, curvature/'sulcus', atlas, and
'Talairach' transform matrix into 'json' format. These functions are not
intended to be called directly, use <code><a href="#topic+import_from_freesurfer">import_from_freesurfer</a></code>
instead.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>import_fs(
  subject_name,
  fs_path,
  quiet = FALSE,
  dtype = c("T1", "surface", "curv", "atlas_volume", "atlas_surface", "xform"),
  sub_type = NULL,
  hemisphere = c("l", "r"),
  ...
)

import_suma(
  subject_name,
  fs_path,
  quiet = FALSE,
  dtype = c("T1", "surface", "curv", "atlas_volume", "atlas_surface", "xform"),
  sub_type = NULL,
  hemisphere = c("l", "r"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="import-fs-suma_+3A_subject_name">subject_name</code></td>
<td>
<p>character, subject code</p>
</td></tr>
<tr><td><code id="import-fs-suma_+3A_fs_path">fs_path</code></td>
<td>
<p>path to 'FreeSurfer' folder</p>
</td></tr>
<tr><td><code id="import-fs-suma_+3A_quiet">quiet</code>, <code id="import-fs-suma_+3A_...">...</code></td>
<td>
<p>passed from or to other methods.</p>
</td></tr>
<tr><td><code id="import-fs-suma_+3A_dtype">dtype</code></td>
<td>
<p>data type to import, choices are <code>'T1'</code>, <code>'surface'</code>,
<code>'curv'</code>, <code>'atlas_volume'</code>, <code>'atlas_surface'</code>, <code>'xform'</code></p>
</td></tr>
<tr><td><code id="import-fs-suma_+3A_sub_type">sub_type</code></td>
<td>
<p>detailed files to import. <code>'atlas_surface'</code>
is not supported for now</p>
</td></tr>
<tr><td><code id="import-fs-suma_+3A_hemisphere">hemisphere</code></td>
<td>
<p>which hemisphere to import, ignored when <code>dtype</code> is in
<code>'T1'</code>, <code>'atlas_volume'</code>, <code>'atlas_surface'</code>, <code>'xform'</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>logical, <code>TRUE</code> if the file is or has been cached, or
<code>FALSE</code> if the file is missing.
</p>

<hr>
<h2 id='LineSegmentsGeom'>R6 Class - Generate Line Segments</h2><span id='topic+LineSegmentsGeom'></span>

<h3>Description</h3>

<p>R6 Class - Generate Line Segments
</p>


<h3>Author(s)</h3>

<p>Zhengjia Wang
</p>

<hr>
<h2 id='list_electrode_prototypes'>List or load all electrode prototypes</h2><span id='topic+list_electrode_prototypes'></span><span id='topic+load_prototype'></span>

<h3>Description</h3>

<p>List all built-in and user-customized electrode prototypes. User paths
will be searched first, if multiple prototype configuration files are found
for the same type.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>list_electrode_prototypes()

load_prototype(type)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="list_electrode_prototypes_+3A_type">type</code></td>
<td>
<p>electrode type, character</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>list_electrode_prototypes</code> returns a named list, names are
the prototype types and values are the prototype configuration paths;
<code>load_prototype</code> returns the prototype instance if <code>type</code> exists,
or throw an error.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
availables &lt;- list_electrode_prototypes()
if( "sEEG-16" %in% names(availables) ) {
  proto &lt;- load_prototype( "sEEG-16" )

  print(proto, details = FALSE)
}




</code></pre>

<hr>
<h2 id='localization_module'>Launch a 'shiny' application to localize electrodes</h2><span id='topic+localization_module'></span>

<h3>Description</h3>

<p>If 'RAVE' has been installed, please use 'RAVE' modules. This function
is purely for demonstration purposes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>localization_module(
  subject_code,
  fs_path,
  ct_path = NULL,
  surfaces = "pial",
  use_141 = TRUE,
  shiny_options = list(launch.browser = TRUE),
  save_path = tempfile(pattern = "electrode", fileext = ".csv"),
  ...,
  control_presets = NULL,
  side_display = FALSE,
  controllers = list()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="localization_module_+3A_subject_code">subject_code</code></td>
<td>
<p>subject code</p>
</td></tr>
<tr><td><code id="localization_module_+3A_fs_path">fs_path</code></td>
<td>
<p>the subject's 'FreeSurfer' path</p>
</td></tr>
<tr><td><code id="localization_module_+3A_ct_path">ct_path</code></td>
<td>
<p>the file path of 'CT' scans that have already been aligned
to 'T1'; must be in 'NIFTI' format</p>
</td></tr>
<tr><td><code id="localization_module_+3A_surfaces">surfaces</code></td>
<td>
<p>which surfaces to load</p>
</td></tr>
<tr><td><code id="localization_module_+3A_use_141">use_141</code></td>
<td>
<p>whether to try 'SUMA' standard 141 surface; default is true</p>
</td></tr>
<tr><td><code id="localization_module_+3A_shiny_options">shiny_options</code></td>
<td>
<p>shiny application options; see <code>options</code> in
<code><a href="shiny.html#topic+shinyApp">shinyApp</a></code></p>
</td></tr>
<tr><td><code id="localization_module_+3A_save_path">save_path</code></td>
<td>
<p>a temporary file where the electrode table should be
cached; this file will be used to keep track of changes in case the
application is crashed or shutdown</p>
</td></tr>
<tr><td><code id="localization_module_+3A_...">...</code></td>
<td>
<p>other parameters to pass into <code><a href="#topic+freesurfer_brain2">freesurfer_brain2</a></code></p>
</td></tr>
<tr><td><code id="localization_module_+3A_control_presets">control_presets</code>, <code id="localization_module_+3A_side_display">side_display</code>, <code id="localization_module_+3A_controllers">controllers</code></td>
<td>
<p>passed to
<code><a href="#topic+threejs_brain">threejs_brain</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of <code>'ui'</code> elements, <code>'server'</code> function, and
a stand-alone <code>'app'</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# This example require N27 template brain to be installed
# see `?download_N27` for details

# using N27 to localize
fs_path &lt;- file.path(default_template_directory(), "N27")
if(interactive() &amp;&amp; dir.exists(fs_path)){
  module &lt;- localization_module("N27", fs_path)

  print(module$app)
}

</code></pre>

<hr>
<h2 id='merge_brain'>Create Multi-subject Template</h2><span id='topic+merge_brain'></span>

<h3>Description</h3>

<p>Create Multi-subject Template
</p>


<h3>Usage</h3>

<pre><code class='language-R'>merge_brain(
  ...,
  .list = NULL,
  template_surface_types = NULL,
  template_subject = unname(getOption("threeBrain.template_subject", "N27")),
  template_dir = default_template_directory()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="merge_brain_+3A_...">...</code>, <code id="merge_brain_+3A_.list">.list</code></td>
<td>
<p><code>Brain2</code> objects</p>
</td></tr>
<tr><td><code id="merge_brain_+3A_template_surface_types">template_surface_types</code></td>
<td>
<p>which template surface types to load, default is auto-guess</p>
</td></tr>
<tr><td><code id="merge_brain_+3A_template_subject">template_subject</code></td>
<td>
<p>character, subject code to be treated as template, default is 'N27'</p>
</td></tr>
<tr><td><code id="merge_brain_+3A_template_dir">template_dir</code></td>
<td>
<p>the parent directory where template subject is stored in</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Zhengjia Wang
</p>

<hr>
<h2 id='new_electrode_prototype'>Create or load new electrode prototype from existing configurations</h2><span id='topic+new_electrode_prototype'></span>

<h3>Description</h3>

<p>Create or load new electrode prototype from existing configurations
</p>


<h3>Usage</h3>

<pre><code class='language-R'>new_electrode_prototype(base_prototype, modifier = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="new_electrode_prototype_+3A_base_prototype">base_prototype</code></td>
<td>
<p>base prototype, this can be a string of prototype type
(see <code><a href="#topic+list_electrode_prototypes">list_electrode_prototypes</a></code>), path to the prototype
configuration file, configuration in 'json' format, or an electrode prototype
instance</p>
</td></tr>
<tr><td><code id="new_electrode_prototype_+3A_modifier">modifier</code></td>
<td>
<p>internally used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An electrode prototype instance
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

available_prototypes &lt;- list_electrode_prototypes()
if("Precision33x31" %in% names(available_prototypes)) {

  # Load by type name
  new_electrode_prototype("Precision33x31")

  # load by path
  path &lt;- available_prototypes[["Precision33x31"]]
  new_electrode_prototype(path)

  # load by json string
  json &lt;- readLines(path)
  new_electrode_prototype(json)

}



</code></pre>

<hr>
<h2 id='plot_slices'>Plot slices of volume</h2><span id='topic+plot_slices'></span>

<h3>Description</h3>

<p>Plot slices of volume
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_slices(
  volume,
  overlays = NULL,
  transform = NULL,
  positions = NULL,
  zoom = 1,
  pixel_width = 0.5,
  col = c("black", "white"),
  normalize = NULL,
  zclip = NULL,
  overlay_alpha = 0.3,
  zlim = normalize,
  main = "",
  title_position = c("left", "top"),
  fun = NULL,
  nc = NA,
  which = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_slices_+3A_volume">volume</code></td>
<td>
<p>path to volume (underlay)</p>
</td></tr>
<tr><td><code id="plot_slices_+3A_overlays">overlays</code></td>
<td>
<p>images to overlay on top of the underlay, can be either
a vector of paths to the overlay volume images, or a sequence of named lists.
Each list item has <code>'volume'</code> (path to the volume) and <code>'color'</code>
(color of the overlay)</p>
</td></tr>
<tr><td><code id="plot_slices_+3A_transform">transform</code></td>
<td>
<p>rotation of the volume in scanner <code>'RAS'</code> space</p>
</td></tr>
<tr><td><code id="plot_slices_+3A_positions">positions</code></td>
<td>
<p>vector of length 3 or matrix of 3 columns, the <code>'RAS'</code>
position of cross-hairs</p>
</td></tr>
<tr><td><code id="plot_slices_+3A_zoom">zoom</code></td>
<td>
<p>zoom-in radio, default is 1</p>
</td></tr>
<tr><td><code id="plot_slices_+3A_pixel_width">pixel_width</code></td>
<td>
<p>output image pixel resolution; default is <code>0.5</code>,
one pixel is 0.5 millimeters wide</p>
</td></tr>
<tr><td><code id="plot_slices_+3A_col">col</code></td>
<td>
<p>color palette, can be a sequence of colors</p>
</td></tr>
<tr><td><code id="plot_slices_+3A_normalize">normalize</code></td>
<td>
<p>range for volume data to be normalized; either <code>NULL</code>
(no normalize) or a numeric vector of length two</p>
</td></tr>
<tr><td><code id="plot_slices_+3A_zclip">zclip</code></td>
<td>
<p>clip image densities; if specified, values outside of this
range will be clipped into this range</p>
</td></tr>
<tr><td><code id="plot_slices_+3A_overlay_alpha">overlay_alpha</code></td>
<td>
<p>transparency of the overlay; default is 0.3</p>
</td></tr>
<tr><td><code id="plot_slices_+3A_zlim">zlim</code></td>
<td>
<p>image plot value range, default is identical to <code>normalize</code></p>
</td></tr>
<tr><td><code id="plot_slices_+3A_main">main</code></td>
<td>
<p>image titles</p>
</td></tr>
<tr><td><code id="plot_slices_+3A_title_position">title_position</code></td>
<td>
<p>title position; choices are <code>"left"</code> or <code>"top"</code></p>
</td></tr>
<tr><td><code id="plot_slices_+3A_fun">fun</code></td>
<td>
<p>function with two arguments that will be executed after each
image is drawn; can be used to draw cross-hairs or annotate each image</p>
</td></tr>
<tr><td><code id="plot_slices_+3A_nc">nc</code></td>
<td>
<p>number of &quot;columns&quot; in the plot when there are too many positions,
must be positive integer; default is <code>NA</code> (automatically determined)</p>
</td></tr>
<tr><td><code id="plot_slices_+3A_which">which</code></td>
<td>
<p>which plane to plot; default is <code>NULL</code>, which will trigger
new plots and add titles; set to <code>1</code> for <code>'Axial'</code> plane,
<code>2</code> for <code>'Sagittal'</code>, and <code>3</code> for <code>'Coronal'</code>.</p>
</td></tr>
<tr><td><code id="plot_slices_+3A_...">...</code></td>
<td>
<p>additional arguments passing into <code><a href="graphics.html#topic+image">image</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing
</p>

<hr>
<h2 id='read_fs_asc'>Read 'FreeSurfer' ascii file</h2><span id='topic+read_fs_asc'></span>

<h3>Description</h3>

<p>Read 'FreeSurfer' ascii file
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_fs_asc(file)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="read_fs_asc_+3A_file">file</code></td>
<td>
<p>file location</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list of vertices and face indices
</p>

<hr>
<h2 id='read_fs_labels'>Read FreeSurfer Annotations</h2><span id='topic+read_fs_labels'></span>

<h3>Description</h3>

<p>Read FreeSurfer Annotations
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_fs_labels(path, vertex_number)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="read_fs_labels_+3A_path">path</code></td>
<td>
<p>label path</p>
</td></tr>
<tr><td><code id="read_fs_labels_+3A_vertex_number">vertex_number</code></td>
<td>
<p>force to reset vertex number if raw file is incorrect</p>
</td></tr>
</table>

<hr>
<h2 id='read_fs_m3z'>Read 'FreeSurfer' m3z file</h2><span id='topic+read_fs_m3z'></span>

<h3>Description</h3>

<p>Read 'FreeSurfer' m3z file
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_fs_m3z(filename)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="read_fs_m3z_+3A_filename">filename</code></td>
<td>
<p>file location, usually located at 'mri/transforms/talairach.m3z'</p>
</td></tr>
</table>


<h3>Details</h3>

<p>An 'm3z' file is a 'gzip' binary file containing a dense vector
field that describes a 3D registration between two volumes/images.
This implementation follows the 'Matlab' implementation from the 'FreeSurfer'.
This function is released under the 'FreeSurfer' license:
<a href="https://surfer.nmr.mgh.harvard.edu/fswiki/FreeSurferSoftwareLicense">https://surfer.nmr.mgh.harvard.edu/fswiki/FreeSurferSoftwareLicense</a>.
</p>


<h3>Value</h3>

<p>registration data
</p>

<hr>
<h2 id='read_fs_mgh_mgz'>Read 'FreeSurfer' 'mgz/mgh' file</h2><span id='topic+read_fs_mgh_mgz'></span>

<h3>Description</h3>

<p>Read 'FreeSurfer' 'mgz/mgh' file
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_fs_mgh_mgz(filename)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="read_fs_mgh_mgz_+3A_filename">filename</code></td>
<td>
<p>file location</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list contains coordinate transforms and volume data
</p>

<hr>
<h2 id='read_gii2'>Function to load surface data from 'Gifti' files</h2><span id='topic+read_gii2'></span>

<h3>Description</h3>

<p>The function 'read_gii2' is a dynamic wrapper of Python 'nibabel' loader.
If no Python is detected, it will switch to 'gifti::readgii'.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_gii2(path)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="read_gii2_+3A_path">path</code></td>
<td>
<p>'Gifti' file path</p>
</td></tr>
</table>


<h3>Format</h3>

<p>An <span class="rlang"><b>R</b></span> function acting as safe wrapper for <code>nibabel.load</code>.
</p>

<hr>
<h2 id='read_mgz'>Function to load 'FreeSurfer' 'mgz/mgh' file</h2><span id='topic+read_mgz'></span>

<h3>Description</h3>

<p>The function 'read_mgz' is a dynamic wrapper of Python 'nibabel' loader.
If no Python is detected, it will switch to built-in function 'read_fs_mgh_mgz',
which has limited features.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_mgz(path)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="read_mgz_+3A_path">path</code></td>
<td>
<p>'mgz/mgh' file path</p>
</td></tr>
</table>


<h3>Format</h3>

<p>An <span class="rlang"><b>R</b></span> function acting as safe wrapper for <code>nibabel.load</code>.
</p>

<hr>
<h2 id='read_volume'>Read volume file in <code>'MGH'</code> or <code>'Nifti'</code> formats</h2><span id='topic+read_volume'></span>

<h3>Description</h3>

<p>Read volume file in <code>'MGH'</code> or <code>'Nifti'</code> formats
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_volume(file, format = c("auto", "mgh", "nii"), header_only = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="read_volume_+3A_file">file</code></td>
<td>
<p>file path</p>
</td></tr>
<tr><td><code id="read_volume_+3A_format">format</code></td>
<td>
<p>the file format</p>
</td></tr>
<tr><td><code id="read_volume_+3A_header_only">header_only</code></td>
<td>
<p>whether only read headers; default is false</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of volume data and transform matrices; if
<code>header_only=TRUE</code>, then volume data will be substituted by the
header.
</p>

<hr>
<h2 id='reexports'>Objects exported from other packages</h2><span id='topic+reexports'></span><span id='topic+read.fs.curv'></span><span id='topic+read.fs.annot'></span><span id='topic+read.fs.label'></span><span id='topic+read.fs.mgh'></span><span id='topic+read.fs.morph'></span><span id='topic+read.fs.surface'></span><span id='topic+write.fs.surface'></span><span id='topic+read.fs.volume'></span><span id='topic+read.fs.weight'></span><span id='topic+read.fs.transform'></span><span id='topic+read.nifti1.data'></span><span id='topic+read.nifti1.header'></span><span id='topic+read.nifti2.data'></span><span id='topic+read.nifti2.header'></span><span id='topic+write.nifti1'></span><span id='topic+write.nifti2'></span>

<h3>Description</h3>

<p>These objects are imported from other packages. Follow the links
below to see their documentation.
</p>

<dl>
<dt>freesurferformats</dt><dd><p><code><a href="freesurferformats.html#topic+read.fs.annot">read.fs.annot</a></code>, <code><a href="freesurferformats.html#topic+read.fs.curv">read.fs.curv</a></code>, <code><a href="freesurferformats.html#topic+read.fs.label">read.fs.label</a></code>, <code><a href="freesurferformats.html#topic+read.fs.mgh">read.fs.mgh</a></code>, <code><a href="freesurferformats.html#topic+read.fs.morph">read.fs.morph</a></code>, <code><a href="freesurferformats.html#topic+read.fs.surface">read.fs.surface</a></code>, <code><a href="freesurferformats.html#topic+read.fs.transform">read.fs.transform</a></code>, <code><a href="freesurferformats.html#topic+read.fs.volume">read.fs.volume</a></code>, <code><a href="freesurferformats.html#topic+read.fs.weight">read.fs.weight</a></code>, <code><a href="freesurferformats.html#topic+read.nifti1.data">read.nifti1.data</a></code>, <code><a href="freesurferformats.html#topic+read.nifti1.header">read.nifti1.header</a></code>, <code><a href="freesurferformats.html#topic+read.nifti2.data">read.nifti2.data</a></code>, <code><a href="freesurferformats.html#topic+read.nifti2.header">read.nifti2.header</a></code>, <code><a href="freesurferformats.html#topic+write.fs.surface">write.fs.surface</a></code>, <code><a href="freesurferformats.html#topic+write.nifti1">write.nifti1</a></code>, <code><a href="freesurferformats.html#topic+write.nifti2">write.nifti2</a></code></p>
</dd>
</dl>

<hr>
<h2 id='renderBrain'>Shiny Renderer for threeBrain Widgets</h2><span id='topic+renderBrain'></span>

<h3>Description</h3>

<p>Shiny Renderer for threeBrain Widgets
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="renderBrain_+3A_expr">expr</code></td>
<td>
<p>R expression that calls three_brain function or Brain object</p>
</td></tr>
<tr><td><code id="renderBrain_+3A_env">env</code></td>
<td>
<p>environment of expression to be evaluated</p>
</td></tr>
<tr><td><code id="renderBrain_+3A_quoted">quoted</code></td>
<td>
<p>is expr quoted? Default is false.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Zhengjia Wang
</p>

<hr>
<h2 id='reorient_volume'>Function to reshape data to 'RAS' order</h2><span id='topic+reorient_volume'></span>

<h3>Description</h3>

<p>Function to reshape data to 'RAS' order
</p>


<h3>Usage</h3>

<pre><code class='language-R'>reorient_volume(volume, Torig)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="reorient_volume_+3A_volume">volume</code></td>
<td>
<p>3-mode tensor (voxels), usually from 'mgz', 'nii', or 'BRIK' files</p>
</td></tr>
<tr><td><code id="reorient_volume_+3A_torig">Torig</code></td>
<td>
<p>a <code>4x4</code> transform matrix mapping volume ('CRS') to 'RAS'</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Reshaped tensor with dimensions corresponding to 'R', 'A', and 'S'
</p>

<hr>
<h2 id='save_brain'>Save threeBrain widgets to local file system</h2><span id='topic+save_brain'></span>

<h3>Description</h3>

<p>Save threeBrain widgets to local file system
</p>


<h3>Usage</h3>

<pre><code class='language-R'>save_brain(widget, path, title = "3D Viewer", as_zip = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="save_brain_+3A_widget">widget</code></td>
<td>
<p>generated from function 'threejs_brain'</p>
</td></tr>
<tr><td><code id="save_brain_+3A_path">path</code></td>
<td>
<p>path to save the brain widget</p>
</td></tr>
<tr><td><code id="save_brain_+3A_title">title</code></td>
<td>
<p>widget title.</p>
</td></tr>
<tr><td><code id="save_brain_+3A_as_zip">as_zip</code></td>
<td>
<p>whether to create zip file &quot;compressed.zip&quot;.</p>
</td></tr>
<tr><td><code id="save_brain_+3A_...">...</code></td>
<td>
<p>ignored, used for backward compatibility</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Zhengjia Wang
</p>

<hr>
<h2 id='seeg_prototype'>Create <code>'sEEG'</code> shaft geometry prototype</h2><span id='topic+seeg_prototype'></span>

<h3>Description</h3>

<p>Intended for creating/editing geometry prototype, please see
<code><a href="#topic+load_prototype">load_prototype</a></code> to load existing prototype
</p>


<h3>Usage</h3>

<pre><code class='language-R'>seeg_prototype(
  type,
  center_position,
  contact_widths,
  diameter = 1,
  channel_order = seq_along(center_position),
  fix_contact = 1,
  overall_length = 200,
  description = NULL,
  dry_run = FALSE,
  default_interpolation = NULL,
  viewer_options = NULL,
  overwrite = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="seeg_prototype_+3A_type">type</code></td>
<td>
<p>type string and unique identifier of the prototype</p>
</td></tr>
<tr><td><code id="seeg_prototype_+3A_center_position">center_position</code></td>
<td>
<p>numerical vector, contact center positions</p>
</td></tr>
<tr><td><code id="seeg_prototype_+3A_contact_widths">contact_widths</code></td>
<td>
<p>numerical vector or length of one, width or widths of
the contacts</p>
</td></tr>
<tr><td><code id="seeg_prototype_+3A_diameter">diameter</code></td>
<td>
<p>probe diameter</p>
</td></tr>
<tr><td><code id="seeg_prototype_+3A_channel_order">channel_order</code></td>
<td>
<p>the channel order of the contacts; default is a sequence
along the number</p>
</td></tr>
<tr><td><code id="seeg_prototype_+3A_fix_contact">fix_contact</code></td>
<td>
<p><code>NULL</code> or integer in <code>channel_order</code>, indicating
which contact is the most important and should be fixed during the
localization, default is <code>1</code> (inner-most target contact)</p>
</td></tr>
<tr><td><code id="seeg_prototype_+3A_overall_length">overall_length</code></td>
<td>
<p>probe length, default is <code>200</code></p>
</td></tr>
<tr><td><code id="seeg_prototype_+3A_description">description</code></td>
<td>
<p>prototype description</p>
</td></tr>
<tr><td><code id="seeg_prototype_+3A_dry_run">dry_run</code></td>
<td>
<p>whether not to save the prototype configurations</p>
</td></tr>
<tr><td><code id="seeg_prototype_+3A_default_interpolation">default_interpolation</code></td>
<td>
<p>default interpolation string for electrode
localization</p>
</td></tr>
<tr><td><code id="seeg_prototype_+3A_viewer_options">viewer_options</code></td>
<td>
<p>list of viewer options; this should be a list of
key-value pairs where the keys are the controller names and values are the
corresponding values when users switch to localizing the electrode group</p>
</td></tr>
<tr><td><code id="seeg_prototype_+3A_overwrite">overwrite</code></td>
<td>
<p>whether to overwrite existing configuration file; default
is false, which throws a warning when duplicated</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A electrode shaft geometry prototype; the configuration file is
saved to 'RAVE' 3rd-party repository.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>probe_head &lt;- 2
n_contacts &lt;- 12
width &lt;- 2.41
contact_spacing &lt;- 5
overall_length &lt;- 400
diameter &lt;- 1.12

contacts &lt;- probe_head + width / 2 + 0:(n_contacts-1) * contact_spacing
proto &lt;- seeg_prototype(
  type = "AdTech-sEEG-SD12R-SP05X-000",
  description = c(
    "AdTech sEEG - 12 contacts",
    "Contact length   : 2.41 mm",
    "Central spacing  : 5    mm",
    "Tip size         : 2    mm",
    "Diameter         : 1.12 mm"
  ),
  center_position = contacts,
  contact_widths = width,
  diameter = diameter,
  overall_length = overall_length,
  dry_run = TRUE
)

print(proto, details = FALSE)


</code></pre>

<hr>
<h2 id='SphereGeom'>R6 Class - Generate Sphere Geometry</h2><span id='topic+SphereGeom'></span>

<h3>Description</h3>

<p>R6 Class - Generate Sphere Geometry
</p>


<h3>Author(s)</h3>

<p>Zhengjia Wang
</p>

<hr>
<h2 id='SpriteGeom'>R6 Class - Generate Sphere Geometry</h2><span id='topic+SpriteGeom'></span>

<h3>Description</h3>

<p>R6 Class - Generate Sphere Geometry
</p>


<h3>Author(s)</h3>

<p>Zhengjia Wang
</p>

<hr>
<h2 id='template_subject'>Download and Manage Template Subjects</h2><span id='topic+template_subject'></span><span id='topic+N27'></span><span id='topic+download_template_subject'></span><span id='topic+download_N27'></span><span id='topic+set_default_template'></span><span id='topic+threebrain_finalize_installation'></span><span id='topic+available_templates'></span>

<h3>Description</h3>

<p>Download and Manage Template Subjects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>download_template_subject(
  subject_code = "N27",
  url,
  template_dir = default_template_directory()
)

download_N27(make_default = FALSE, ...)

set_default_template(
  subject_code,
  view = TRUE,
  template_dir = default_template_directory()
)

threebrain_finalize_installation(
  upgrade = c("ask", "always", "never", "data-only", "config-only"),
  async = TRUE
)

available_templates()
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="template_subject_+3A_subject_code">subject_code</code></td>
<td>
<p>character with only letters and numbers (Important); default is 'N27'</p>
</td></tr>
<tr><td><code id="template_subject_+3A_url">url</code></td>
<td>
<p>zip file address; must be specified if <code>subject_code</code> is not from the followings: <code>'bert'</code>, <code>'cvs_avg35'</code>, <code>'cvs_avg35_inMNI152'</code>, <code>'fsaverage'</code>, <code>'fsaverage_sym'</code>, or <code>'N27'</code></p>
</td></tr>
<tr><td><code id="template_subject_+3A_template_dir">template_dir</code></td>
<td>
<p>parent directory where subject's 'FreeSurfer' folder should be stored</p>
</td></tr>
<tr><td><code id="template_subject_+3A_make_default">make_default</code></td>
<td>
<p>logical, whether to make 'N27' default subject</p>
</td></tr>
<tr><td><code id="template_subject_+3A_...">...</code></td>
<td>
<p>more to pass to <code>download_template_subject</code></p>
</td></tr>
<tr><td><code id="template_subject_+3A_view">view</code></td>
<td>
<p>whether to view the subject</p>
</td></tr>
<tr><td><code id="template_subject_+3A_upgrade">upgrade</code></td>
<td>
<p>whether to check and download 'N27' brain interactively.
Choices are 'ask', 'always', and 'never'</p>
</td></tr>
<tr><td><code id="template_subject_+3A_async">async</code></td>
<td>
<p>whether to run the job in parallel to others; default is true</p>
</td></tr>
</table>


<h3>Details</h3>

<p>To view electrodes implanted in multiple subjects, it's highly
recommended to view them in a template space The detail mapping method
is discussed in function <code>freesurfer_brain</code>.
</p>
<p>To map to a template space, one idea is to find someone whose brain is
normal. In our case, the choice is subject 'N27', also known as 'Colin 27'.
function <code>download_N27</code> provides a simple and easy way to download a
partial version from the Internet.
</p>
<p>If you have any other ideas about template brain, you can use function
<code>set_default_template(subject_code, template_dir)</code> to redirect to
your choice. If your template brain is a 'Zip' file on the Internet, we
provide function <code>download_template_subject</code> to automatically install it.
</p>


<h3>Author(s)</h3>

<p>Zhengjia Wang
</p>

<hr>
<h2 id='threeBrain'>Create a brain object</h2><span id='topic+threeBrain'></span>

<h3>Description</h3>

<p>Create a brain object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>threeBrain(
  path,
  subject_code,
  surface_types = "pial",
  atlas_types,
  ...,
  template_subject = unname(getOption("threeBrain.template_subject", "N27")),
  backward_compatible = getOption("threeBrain.compatible", FALSE)
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="threeBrain_+3A_path">path</code></td>
<td>
<p>path to 'FreeSurfer' directory, or 'RAVE' subject directory
containing 'FreeSurfer' files, or simply a 'RAVE' subject</p>
</td></tr>
<tr><td><code id="threeBrain_+3A_subject_code">subject_code</code></td>
<td>
<p>subject code, characters</p>
</td></tr>
<tr><td><code id="threeBrain_+3A_surface_types">surface_types</code></td>
<td>
<p>surface types to load; default is <code>'pial'</code>,
other common types are <code>'white'</code>, <code>'smoothwm'</code></p>
</td></tr>
<tr><td><code id="threeBrain_+3A_atlas_types">atlas_types</code></td>
<td>
<p>brain atlas to load; default is <code>'wmparc'</code>,
or if not exists, <code>'aparc+aseg'</code>,
other choices are <code>'aparc.a2009s+aseg'</code>, <code>'aparc.DKTatlas+aseg'</code>,
depending on the atlas files in <code>'fs/mri'</code> folder</p>
</td></tr>
<tr><td><code id="threeBrain_+3A_...">...</code></td>
<td>
<p>reserved for future use</p>
</td></tr>
<tr><td><code id="threeBrain_+3A_template_subject">template_subject</code></td>
<td>
<p>template subject to refer to; used for group
template mapping</p>
</td></tr>
<tr><td><code id="threeBrain_+3A_backward_compatible">backward_compatible</code></td>
<td>
<p>whether to support old format; default is false</p>
</td></tr>
</table>

<hr>
<h2 id='threejs_brain'>Create a Threejs Brain and View it in Browsers</h2><span id='topic+threejs_brain'></span>

<h3>Description</h3>

<p>Create a Threejs Brain and View it in Browsers
</p>


<h3>Usage</h3>

<pre><code class='language-R'>threejs_brain(
  ...,
  .list = list(),
  width = NULL,
  height = NULL,
  background = "#FFFFFF",
  cex = 1,
  timestamp = TRUE,
  title = "",
  side_canvas = FALSE,
  side_zoom = 1,
  side_width = 250,
  side_shift = c(0, 0),
  side_display = TRUE,
  control_panel = TRUE,
  control_presets = NULL,
  control_display = TRUE,
  camera_center = c(0, 0, 0),
  camera_pos = c(500, 0, 0),
  start_zoom = 1,
  symmetric = 0,
  default_colormap = "Value",
  palettes = NULL,
  value_ranges = NULL,
  value_alias = NULL,
  show_inactive_electrodes = TRUE,
  surface_colormap = system.file("palettes", "surface", "ContinuousSample.json", package
    = "threeBrain"),
  voxel_colormap = system.file("palettes", "datacube2", "FreeSurferColorLUT.json",
    package = "threeBrain"),
  videos = list(),
  widget_id = "threebrain_data",
  tmp_dirname = NULL,
  debug = FALSE,
  enable_cache = FALSE,
  token = NULL,
  controllers = list(),
  browser_external = TRUE,
  global_data = list(),
  global_files = list(),
  qrcode = NULL,
  custom_javascript = NULL,
  show_modal = "auto",
  embed = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="threejs_brain_+3A_...">...</code>, <code id="threejs_brain_+3A_.list">.list</code></td>
<td>
<p>geometries inherit from AbstractGeom</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_width">width</code>, <code id="threejs_brain_+3A_height">height</code></td>
<td>
<p>positive integers. Width and height of the widget.
By default width='100%', and height varies.</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_background">background</code></td>
<td>
<p>character, background color such as <code>"#FFFFFF"</code> or <code>"white"</code></p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_cex">cex</code></td>
<td>
<p>positive number, relative text magnification level</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_timestamp">timestamp</code></td>
<td>
<p>logical, whether to show time-stamp at the beginning</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_title">title</code></td>
<td>
<p>viewer title</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_side_canvas">side_canvas</code></td>
<td>
<p>logical, enable side cameras to view objects from fixed perspective</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_side_zoom">side_zoom</code></td>
<td>
<p>numerical, if side camera is enabled, zoom-in level, from 1 to 5</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_side_width">side_width</code></td>
<td>
<p>positive integer, side panel size in pixels</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_side_shift">side_shift</code></td>
<td>
<p>integer of length two, side panel shift in pixels ('CSS style': top, left)</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_side_display">side_display</code></td>
<td>
<p>logical, show/hide side panels at beginning</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_control_panel">control_panel</code></td>
<td>
<p>logical, enable control panels for the widget</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_control_presets">control_presets</code></td>
<td>
<p>characters, presets to be shown in control panels</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_control_display">control_display</code></td>
<td>
<p>logical, whether to expand/collapse control UI at the beginning</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_camera_center">camera_center</code></td>
<td>
<p>numerical, length of three, XYZ position where camera should focus at</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_camera_pos">camera_pos</code></td>
<td>
<p>XYZ position of camera itself, default (0, 0, 500)</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_start_zoom">start_zoom</code></td>
<td>
<p>numerical, positive number indicating camera zoom level</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_symmetric">symmetric</code></td>
<td>
<p>numerical, default 0, color center will be mapped to this value</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_default_colormap">default_colormap</code></td>
<td>
<p>character, which color map name to display at startup</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_palettes">palettes</code></td>
<td>
<p>named list, names corresponds to color-map names if you want to change color palettes</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_value_ranges">value_ranges</code></td>
<td>
<p>named list, similar to <code>palettes</code>, value range for each values</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_value_alias">value_alias</code></td>
<td>
<p>named list, legend title for corresponding variable</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_show_inactive_electrodes">show_inactive_electrodes</code></td>
<td>
<p>logical, whether to show electrodes with no values</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_surface_colormap">surface_colormap</code></td>
<td>
<p>a color map or its path generated by <code>create_colormap(gtype="surface")</code> to render surfaces vertices; see <code><a href="#topic+create_colormap">create_colormap</a></code> for details.</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_voxel_colormap">voxel_colormap</code></td>
<td>
<p>a color map or its path generated by <code>create_colormap(gtype="volume")</code> to render volume such as atlases; see <code><a href="#topic+create_colormap">create_colormap</a></code> for details.</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_videos">videos</code></td>
<td>
<p>named list, names corresponds to color-map names, and items are generated from <code><a href="#topic+video_content">video_content</a></code></p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_widget_id">widget_id</code></td>
<td>
<p>character, internally used as unique identifiers for widgets;
only use it when you have multiple widgets in one website</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_tmp_dirname">tmp_dirname</code></td>
<td>
<p>character path, internally used, where to store temporary files</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_debug">debug</code></td>
<td>
<p>logical, internally used for debugging</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_enable_cache">enable_cache</code></td>
<td>
<p>whether to enable cache, useful when rendering the viewers repeatedly in shiny applications</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_token">token</code></td>
<td>
<p>unique character, internally used to identify widgets in 'JavaScript' <code>'localStorage'</code></p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_controllers">controllers</code></td>
<td>
<p>list to override the settings, for example <code>proxy$get_controllers()</code></p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_browser_external">browser_external</code></td>
<td>
<p>logical, use system default browser (default) or built-in one.</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_global_data">global_data</code>, <code id="threejs_brain_+3A_global_files">global_files</code></td>
<td>
<p>internally use, mainly to store orientation matrices and files.</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_qrcode">qrcode</code></td>
<td>
<p>'URL' to show in the 'QR' code; can be a character string or a named list of <code>'url'</code> and <code>'text'</code> (hyper-reference text)</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_custom_javascript">custom_javascript</code></td>
<td>
<p>customized temporary 'JavaScript' code that runs after ready state; available 'JavaScript' variables are:
</p>

<dl>
<dt><code>'groups'</code></dt><dd><p>input information about each group</p>
</dd>
<dt><code>'geoms'</code></dt><dd><p>input information about each geometry</p>
</dd>
<dt><code>'settings'</code></dt><dd><p>input information about canvas settings</p>
</dd>
<dt><code>'scene'</code></dt><dd><p>'threejs' scene object</p>
</dd>
<dt><code>'canvas'</code></dt><dd><p>canvas object</p>
</dd>
<dt><code>'gui'</code></dt><dd><p>controls data panel</p>
</dd>
<dt><code>'presets'</code></dt><dd><p>preset <code>'gui'</code> methods</p>
</dd>
</dl>
</td></tr>
<tr><td><code id="threejs_brain_+3A_show_modal">show_modal</code></td>
<td>
<p>logical or <code>"auto"</code>, whether to show a modal instead of direct rendering the viewers; designed for users who do not have <code>'WebGL'</code> support; only used in shiny applications</p>
</td></tr>
<tr><td><code id="threejs_brain_+3A_embed">embed</code></td>
<td>
<p>whether to try embedding the viewer in current run-time; default is false (will launch default web browser); set to true if running in <code>'rmarkdown'</code> or <code>'quarto'</code>, or to see the viewer in <code>'RStudio'</code> default panel.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Zhengjia Wang
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if( interactive() ) {
library(threeBrain)

# Please use `download_N27` to download N27 Collins template brain
n27_path &lt;- file.path(default_template_directory(), "N27")
if( dir.exists(n27_path) ) {

  brain &lt;- threeBrain(path = n27_path, subject_code = "N27",
                             surface_types = c('pial', 'smoothwm'))
  print(brain)

  brain$plot(
    background = "#000000",
    controllers = list(
      'Voxel Type' = 'aparc_aseg',
      'Surface Type' = 'smoothwm',
      'Blend Factor' = 1,
      'Right Opacity' = 0.3,
      'Overlay Sagittal' = TRUE
    ),
    show_modal = TRUE
  )

}
}

</code></pre>

<hr>
<h2 id='threejsBrainOutput'>Shiny Output for threeBrain Widgets</h2><span id='topic+threejsBrainOutput'></span>

<h3>Description</h3>

<p>Shiny Output for threeBrain Widgets
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="threejsBrainOutput_+3A_outputid">outputId</code></td>
<td>
<p>unique identifier for the widget</p>
</td></tr>
<tr><td><code id="threejsBrainOutput_+3A_width">width</code>, <code id="threejsBrainOutput_+3A_height">height</code></td>
<td>
<p>width and height of the widget. By default width=&quot;100
and height=&quot;500px&quot;.</p>
</td></tr>
<tr><td><code id="threejsBrainOutput_+3A_reportsize">reportSize</code></td>
<td>
<p>whether to report widget size in shiny
<code>session$clientData</code></p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Zhengjia Wang
</p>

<hr>
<h2 id='TubeGeom'>R6 Class - Generate Tube Geometry</h2><span id='topic+TubeGeom'></span>

<h3>Description</h3>

<p>R6 Class - Generate Tube Geometry
</p>


<h3>Author(s)</h3>

<p>Zhengjia Wang
</p>

<hr>
<h2 id='video_content'>Add video content to the viewer</h2><span id='topic+video_content'></span>

<h3>Description</h3>

<p>Add video content to the viewer
</p>


<h3>Usage</h3>

<pre><code class='language-R'>video_content(
  path,
  duration = Inf,
  time_start = 0,
  asp_ratio = 16/9,
  local = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="video_content_+3A_path">path</code></td>
<td>
<p>local file path or 'URL'</p>
</td></tr>
<tr><td><code id="video_content_+3A_duration">duration</code></td>
<td>
<p>duration of the video</p>
</td></tr>
<tr><td><code id="video_content_+3A_time_start">time_start</code></td>
<td>
<p>start time relative to the stimuli onset</p>
</td></tr>
<tr><td><code id="video_content_+3A_asp_ratio">asp_ratio</code></td>
<td>
<p>aspect ratio; default is <code>16/9</code></p>
</td></tr>
<tr><td><code id="video_content_+3A_local">local</code></td>
<td>
<p>used only when <code>path</code> is a 'URL': whether to download
the video before generating the viewer; see 'Details'</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The video path can be either local file path or a 'URL' from
websites. When path is from the internet, there are two options: download
the video before generating the viewer, or directly use the 'URL'.
</p>
<p>If download happens before a viewer is generated (<code>local=TRUE</code>), then
the video content is local. The viewer will be self-contained. However,
the distribution will contain the video, and the archive size might be large.
</p>
<p>If raw 'URL' is used (<code>local=FALSE</code>), then viewer is not self-contained
as the video link might break anytime. The 'screenshot' and 'record' function
might be limited if the 'URL' has different domain than yours. However,
the distribution will not contain the video, hence smaller. This works in the
scenarios when it is preferred not to share video files or they are
licensed, or simply distribution is limited. Besides, this method is slightly
faster than the local alternatives.
</p>

<hr>
<h2 id='volume_to_surf'>Generate surface file from <code>'nii'</code> or <code>'mgz'</code> volume files</h2><span id='topic+volume_to_surf'></span>

<h3>Description</h3>

<p>Generate surface file from <code>'nii'</code> or <code>'mgz'</code> volume files
</p>


<h3>Usage</h3>

<pre><code class='language-R'>volume_to_surf(
  volume,
  save_to = NA,
  lambda = 0.2,
  degree = 2,
  threshold_lb = 0.5,
  threshold_ub = NA,
  format = "auto"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="volume_to_surf_+3A_volume">volume</code></td>
<td>
<p>path to the volume file, or object from <code><a href="#topic+read_volume">read_volume</a></code>.</p>
</td></tr>
<tr><td><code id="volume_to_surf_+3A_save_to">save_to</code></td>
<td>
<p>where to save the surface file; default is <code>NA</code> (no save).</p>
</td></tr>
<tr><td><code id="volume_to_surf_+3A_lambda">lambda</code></td>
<td>
<p><code>'Laplacian'</code> smooth, the higher the smoother</p>
</td></tr>
<tr><td><code id="volume_to_surf_+3A_degree">degree</code></td>
<td>
<p><code>'Laplacian'</code> degree; default is <code>2</code></p>
</td></tr>
<tr><td><code id="volume_to_surf_+3A_threshold_lb">threshold_lb</code></td>
<td>
<p>lower threshold of the volume (to create mask); default is <code>0.5</code></p>
</td></tr>
<tr><td><code id="volume_to_surf_+3A_threshold_ub">threshold_ub</code></td>
<td>
<p>upper threshold of the volume; default is <code>NA</code> (no upper bound)</p>
</td></tr>
<tr><td><code id="volume_to_surf_+3A_format">format</code></td>
<td>
<p>The format of the file if <code>save_to</code> is a valid path,
choices include
</p>

<dl>
<dt><code>'auto'</code></dt><dd><p>Default, supports <code>'FreeSurfer'</code> binary format and
<code>'ASCII'</code> text format, based on file name suffix</p>
</dd>
<dt><code>'bin'</code></dt><dd><p><code>'FreeSurfer'</code> binary format</p>
</dd>
<dt><code>'asc'</code></dt><dd><p><code>'ASCII'</code> text format</p>
</dd>
<dt><code>'ply'</code></dt><dd><p>'Stanford' <code>'PLY'</code> format</p>
</dd>
<dt><code>'off'</code></dt><dd><p>Object file format</p>
</dd>
<dt><code>'obj'</code></dt><dd><p><code>'Wavefront'</code> object format</p>
</dd>
<dt><code>'gii'</code></dt><dd><p><code>'GIfTI'</code> format. Please avoid using <code>'gii.gz'</code> as the file suffix</p>
</dd>
<dt><code>'mz3'</code></dt><dd><p><code>'Surf-Ice'</code> format</p>
</dd>
<dt><code>'byu'</code></dt><dd><p><code>'BYU'</code> mesh format</p>
</dd>
<dt><code>'vtk'</code></dt><dd><p>Legacy <code>'VTK'</code> format</p>
</dd>
</dl>

<p><code>'gii'</code>, otherwise <code>'FreeSurfer'</code> format. Please do not use
<code>'gii.gz'</code> suffix.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Triangle <code>'rgl'</code> mesh (vertex positions in native <code>'RAS'</code>). If <code>save_to</code> is a valid path, then the mesh will be saved to this location.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+read_volume">read_volume</a></code>, <code><a href="ravetools.html#topic+vcg_isosurface">vcg_isosurface</a></code>,
<code><a href="ravetools.html#topic+vcg_smooth_implicit">vcg_smooth_implicit</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(threeBrain)
N27_path &lt;- file.path(default_template_directory(), "N27")
if(dir.exists(N27_path)) {
  aseg &lt;- file.path(N27_path, "mri", "aparc+aseg.mgz")

  # generate surface for left-hemisphere insula
  mesh &lt;- volume_to_surf(aseg, threshold_lb = 1034,
                         threshold_ub = 1036)

  if(interactive()) {
    ravetools::rgl_view({
      ravetools::rgl_call("shade3d", mesh, color = "yellow")
    })
  }
}


</code></pre>

<hr>
<h2 id='voxel_colormap'>Color maps for volume or surface data</h2><span id='topic+voxel_colormap'></span><span id='topic+create_colormap'></span><span id='topic+save_colormap'></span><span id='topic+freeserfer_colormap'></span><span id='topic+load_colormap'></span>

<h3>Description</h3>

<p>Color maps for volume or surface data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_colormap(
  gtype = c("surface", "volume"),
  dtype = c("continuous", "discrete"),
  key,
  color,
  value,
  alpha = FALSE,
  con = NULL,
  auto_rescale = FALSE,
  ...
)

save_colormap(cmap, con)

freeserfer_colormap(con)

load_colormap(con)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="voxel_colormap_+3A_gtype">gtype</code></td>
<td>
<p>geometry type, choices are <code>"surface"</code>, <code>"volume"</code></p>
</td></tr>
<tr><td><code id="voxel_colormap_+3A_dtype">dtype</code></td>
<td>
<p>data type, <code>"continuous"</code> or <code>"discrete"</code></p>
</td></tr>
<tr><td><code id="voxel_colormap_+3A_key">key</code></td>
<td>
<p>non-negative integer vector corresponding to color values;
its length must exceed 1; see 'Details'</p>
</td></tr>
<tr><td><code id="voxel_colormap_+3A_color">color</code></td>
<td>
<p>characters, corresponding to color strings for each key</p>
</td></tr>
<tr><td><code id="voxel_colormap_+3A_value">value</code></td>
<td>
<p>actual value for each key</p>
</td></tr>
<tr><td><code id="voxel_colormap_+3A_alpha">alpha</code></td>
<td>
<p>whether to respect transparency</p>
</td></tr>
<tr><td><code id="voxel_colormap_+3A_con">con</code></td>
<td>
<p>a file path to write results to or to read from. The
file path can be passed as <code>voxel_colormap</code> into <code><a href="#topic+threejs_brain">threejs_brain</a></code>.</p>
</td></tr>
<tr><td><code id="voxel_colormap_+3A_auto_rescale">auto_rescale</code></td>
<td>
<p>automatically scale the color according to image values;
only valid for continuous color maps</p>
</td></tr>
<tr><td><code id="voxel_colormap_+3A_...">...</code></td>
<td>
<p>used by continuous color maps, passed to
<code><a href="grDevices.html#topic+colorRampPalette">colorRampPalette</a></code></p>
</td></tr>
<tr><td><code id="voxel_colormap_+3A_cmap">cmap</code></td>
<td>
<p>color map object</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Internal 'JavaScript' shader implementation uses integer color <code>key</code>s to
connect color palettes and corresponding values. The keys must be
non-negative.
</p>
<p>Zero key is a special color key reserved by system. Please avoid using it
for valid values.
</p>


<h3>Value</h3>

<p>A list of color map information
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Creates a symmetric continuous colormap with 3 keys
# The color range is -10 to 10
# The colors are 'blue','white','red' for these keys

pal &lt;- create_colormap(
  gtype = "volume", dtype = "continuous",
  key = c(1,2,3), value = c(-10,0,10),
  color = c('blue','white','red'))

print( pal )

# ---------------- Get colormap key from a value ------------

# returns key index starting from
pal$get_key( -10 )

# nearest value
pal$get_key( 2 )

# set threshold, key is now 0 (no color)
pal$get_key( 2, max_delta = 1 )


# ---------------- Save and load ----------------
f &lt;- tempfile( fileext = '.json' )
save_colormap( pal, f )
cat(readLines(f), sep = '\n')

load_colormap(f)

</code></pre>

<hr>
<h2 id='voxel_cube'>Generate volume data from 'MNI' coordinates</h2><span id='topic+voxel_cube'></span><span id='topic+add_voxel_cube'></span><span id='topic+add_nifti'></span><span id='topic+create_voxel_cube'></span>

<h3>Description</h3>

<p>Generate volume data from 'MNI' coordinates
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_voxel_cube(
  brain,
  name,
  cube,
  size = c(256, 256, 256),
  trans_mat = NULL,
  trans_space_from = c("model", "scannerRAS"),
  color_format = c("RGBAFormat", "RedFormat")
)

add_nifti(
  brain,
  name,
  path,
  trans_mat = NULL,
  color_format = c("RGBAFormat", "RedFormat"),
  trans_space_from = c("model", "scannerRAS")
)

create_voxel_cube(
  mni_ras,
  value,
  colormap,
  keys = colormap$get_key(value),
  dimension = c(256, 256, 256)
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="voxel_cube_+3A_brain">brain</code></td>
<td>
<p>a 'threeBrain' brain object generated from <code><a href="#topic+freesurfer_brain2">freesurfer_brain2</a></code> or <code><a href="#topic+merge_brain">merge_brain</a></code>. If you have <code>'rave'</code> package installed, the brain can be generated from <code>rave::rave_brain2</code></p>
</td></tr>
<tr><td><code id="voxel_cube_+3A_name">name</code></td>
<td>
<p>the name of voxel cube, only letters, digits and <code>'_'</code> are allowed; other characters will be replaced by <code>'_'</code></p>
</td></tr>
<tr><td><code id="voxel_cube_+3A_cube">cube</code></td>
<td>
<p>a 3-mode array; see the following example</p>
</td></tr>
<tr><td><code id="voxel_cube_+3A_size">size</code></td>
<td>
<p>the actual size of the volume, usually dot multiplication of the dimension and voxel size</p>
</td></tr>
<tr><td><code id="voxel_cube_+3A_trans_mat">trans_mat</code></td>
<td>
<p>the transform matrix of the volume. For <code>add_voxel_cube</code>, this matrix should be from data cube geometry model center to world (<code>'tkrRAS'</code>) transform. For <code>add_nifti</code>, this matrix is the 'Nifti' <code>'RAS'</code> to world (<code>'tkrRAS'</code>) transform.</p>
</td></tr>
<tr><td><code id="voxel_cube_+3A_trans_space_from">trans_space_from</code></td>
<td>
<p>where does <code>trans_mat</code> transform begin; default is from object <code>'model'</code> space; alternative space is <code>'scannerRAS'</code>, meaning the matrix only transform volume cube from its own <code>'scannerRAS'</code> to the world space.</p>
</td></tr>
<tr><td><code id="voxel_cube_+3A_color_format">color_format</code></td>
<td>
<p>color format for the internal texture. Default is 4-channel <code>'RGBAFormat'</code>; alternative choice is <code>'RedFormat'</code>, which saves volume data with single red-channel to save space</p>
</td></tr>
<tr><td><code id="voxel_cube_+3A_path">path</code></td>
<td>
<p>'Nifti' data path</p>
</td></tr>
<tr><td><code id="voxel_cube_+3A_mni_ras">mni_ras</code></td>
<td>
<p>'MNI' 'RAS' coordinates, should be a <code>n</code>-by-3 matrix</p>
</td></tr>
<tr><td><code id="voxel_cube_+3A_value">value</code></td>
<td>
<p>data values (length <code>n</code>); used if <code>keys</code> is missing</p>
</td></tr>
<tr><td><code id="voxel_cube_+3A_colormap">colormap</code></td>
<td>
<p>a color map generated from <code>create_colormap</code>; see <code><a href="#topic+voxel_colormap">voxel_colormap</a></code> for details</p>
</td></tr>
<tr><td><code id="voxel_cube_+3A_keys">keys</code></td>
<td>
<p>integer color-keys generated from a color map with length of <code>n</code>; alternatively, you could specify <code>value</code> and <code>colormap</code> to generate keys automatically</p>
</td></tr>
<tr><td><code id="voxel_cube_+3A_dimension">dimension</code></td>
<td>
<p>volume dimension; default is a <code>256 x 256 x 256</code> array cube; must be integers and have length of 3</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>create_voxel_cube</code> returns a list of cube data and other informations;
<code>add_voxel_cube</code> returns the <code>brain</code> object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# requires N27 brain to be installed
# use `download_N27()` to download template Collins brain


# sample MNI coords
tbl &lt;- read.csv(system.file(
  'sample_data/example_cube.csv', package = 'threeBrain'
))
head(tbl)

# load colormap
cmap &lt;- load_colormap(system.file(
  'palettes/datacube2/Mixed.json', package = 'threeBrain'
))

x &lt;- create_voxel_cube(
  mni_ras = tbl[, c('x', 'y', 'z')],
  keys = tbl$key,
  dimension = c(128, 128, 128)
)


n27_path &lt;- file.path(default_template_directory(), "N27")
if( interactive() &amp;&amp; dir.exists(n27_path) ) {
  brain &lt;- merge_brain()

  # or add_voxel_cube(brain, 'example', x$cube)
  x$add_to_brain(brain, 'example')

  brain$plot(controllers = list(
    "Voxel Type" = 'example',
    'Right Opacity' = 0.3,
    'Left Opacity' = 0.3,
    'Background Color' = '#000000'
  ), voxel_colormap = cmap)
}

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
