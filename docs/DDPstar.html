<!DOCTYPE html><html lang="en"><head><title>Help for package DDPstar</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {DDPstar}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#DDPstar-package'>
<p>Density Regression via Dirichlet Process Mixtures of Normal Structured Additive Regression Models</p></a></li>
<li><a href='#dde'>
<p>Dichlorodiphenyldichloroethylene (DDE) and preterm delivery data</p></a></li>
<li><a href='#DDPstar'>
<p>Density Regression via Dirichlet Process Mixtures (DDP) of Normal Structured Additive Regression (STAR) Models</p></a></li>
<li><a href='#f'>
<p>Defining smooth terms in DDPstar formulae</p></a></li>
<li><a href='#mcmccontrol'>
<p>Markov chain Monte Carlo (MCMC) parameters</p></a></li>
<li><a href='#predict.DDPstar'>
<p>Predictions from fitted DDPstar models</p></a></li>
<li><a href='#predictive.checks.DDPstar'>
<p>Posterior predictive checks.</p></a></li>
<li><a href='#print.DDPstar'>
<p>Print method for DDPstar objects</p></a></li>
<li><a href='#priorcontrol'>
<p>Prior information for the DDPstar model</p></a></li>
<li><a href='#quantileResiduals'>
<p>Quantile residuals.</p></a></li>
<li><a href='#rae'>
<p>Defining random effects in DDPstar formulae</p></a></li>
<li><a href='#summary.DDPstar'>
<p>Summary method for DDPstar objects</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Density Regression via Dirichlet Process Mixtures of Normal
Structured Additive Regression Models</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0-1</td>
</tr>
<tr>
<td>Date:</td>
<td>2025-01-30</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats, grDevices, graphics, splines, moments, Matrix,
parallel, MASS</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Description:</td>
<td>Implements a flexible, versatile, and computationally tractable model for density regression based on a single-weights dependent Dirichlet process mixture of normal distributions model for univariate continuous responses. The model assumes an additive structure for the mean of each mixture component and the effects of continuous covariates are captured through smooth nonlinear functions. The key components of our modelling approach are penalised B-splines and their bivariate tensor product extension. The proposed method can also easily deal with parametric effects of categorical covariates, linear effects of continuous covariates, interactions between categorical and/or continuous covariates, varying coefficient terms, and random effects. Please see Rodriguez-Alvarez, Inacio et al. (2025) for more details.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL]</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-01-30 11:41:24 UTC; mrodriguez</td>
</tr>
<tr>
<td>Author:</td>
<td>Maria Xose Rodriguez-Alvarez
    <a href="https://orcid.org/0000-0002-1329-9238"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut, cre],
  Vanda Inacio <a href="https://orcid.org/0000-0001-8084-1616"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Maria Xose Rodriguez-Alvarez &lt;mxrodriguez@uvigo.gal&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-01-31 11:10:09 UTC</td>
</tr>
</table>
<hr>
<h2 id='DDPstar-package'>
Density Regression via Dirichlet Process Mixtures of Normal Structured Additive Regression Models
</h2><span id='topic+DDPstar-package'></span>

<h3>Description</h3>

<p>Implements a flexible, versatile, and computationally tractable model for density regression based on a single-weights dependent Dirichlet process mixture of normal distributions model for univariate continuous responses. The model assumes an additive structure for the mean of each mixture component and the effects of continuous covariates are captured through smooth nonlinear functions. The key components of our modelling approach are penalised B-splines and their bivariate tensor product extension. The proposed method can also easily deal with parametric effects of categorical covariates, linear effects of continuous covariates, interactions between categorical and/or continuous covariates, varying coefficient terms, and random effects. Please see Rodriguez-Alvarez, Inacio et al. (2025) for more details.
</p>


<h3>Details</h3>


<p>Index of help topics:
</p>
<pre>
DDPstar                 Density Regression via Dirichlet Process
                        Mixtures (DDP) of Normal Structured Additive
                        Regression (STAR) Models
DDPstar-package         Density Regression via Dirichlet Process
                        Mixtures of Normal Structured Additive
                        Regression Models
dde                     Dichlorodiphenyldichloroethylene (DDE) and
                        preterm delivery data
f                       Defining smooth terms in DDPstar formulae
mcmccontrol             Markov chain Monte Carlo (MCMC) parameters
predict.DDPstar         Predictions from fitted DDPstar models
predictive.checks.DDPstar
                        Posterior predictive checks.
print.DDPstar           Print method for DDPstar objects
priorcontrol            Prior information for the DDPstar model
quantileResiduals       Quantile residuals.
rae                     Defining random effects in DDPstar formulae
summary.DDPstar         Summary method for DDPstar objects
</pre>


<h3>Author(s)</h3>

<p>Maria Xose Rodriguez-Alvarez [aut, cre]
    (&lt;https://orcid.org/0000-0002-1329-9238&gt;),
  Vanda Inacio [aut] (&lt;https://orcid.org/0000-0001-8084-1616&gt;)
</p>
<p>Maintainer: Maria Xose Rodriguez-Alvarez &lt;mxrodriguez@uvigo.gal&gt;
</p>


<h3>References</h3>

<p>Eilers, P.H.C. and Marx, B.D. (1996). Flexible smoothing with B-splines and penalties. Statistical Science, <b>11</b>(2), 89-121.
</p>
<p>Eilers, P.H.C. and Marx, B.D. (2003). Multidimensional calibration with temperature interaction using two- dimensional penalized signal regression. Chemometrics and Intelligence Laboratory Systems, <b>66</b>, 159-174.
</p>
<p>De Iorio, M., Muller, P., Rosner, G. L., and MacEachern, S. N. (2004). An anova model for dependent random measures. Journal of the American Statistical Association, <b>99</b>(465), 205-215
</p>
<p>De Iorio, M., Johnson, W. O., Muller, P., and Rosner, G. L. (2009). Bayesian nonparametric nonproportional hazards survival modeling. Biometrics, <b>65</b>, 762&ndash;775.
</p>
<p>Lang, S. and Brezger, A. (2004). Bayesian P-splines. Journal of Computational and Graphical Statistics, <b>13</b>(1), 183-212.
</p>
<p>Lee, D.-J., Durban, M., and Eilers, P. (2013). Efficient two-dimensional smoothing with P-
spline ANOVA mixed models and nested bases. Computational Statistics &amp; Data Analysis, <b>61</b>, 22-37.
</p>
<p>Rodriguez-Alvarez, M. X, Inacio, V. and Klein N. (2025). Density regression via Dirichlet process mixtures of normal structured additive regression models. Accepted for publication in Statistics and Computing (DOI: 10.1007/s11222-025-10567-0).
</p>

<hr>
<h2 id='dde'>
Dichlorodiphenyldichloroethylene (DDE) and preterm delivery data
</h2><span id='topic+dde'></span>

<h3>Description</h3>

<p>Data set associated with a study aimed to evaluate the association between maternal serum concentration of the DDT metabolite DDE and preterm delivery. For details, see Longnecker et al. (2001).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("dde")</code></pre>


<h3>Format</h3>

<p>A data frame with 2312 observations on the following 2 variables.
</p>

<dl>
<dt><code>DDE</code></dt><dd><p>the level of the Dichlorodiphenyldichloroethylene (DDE)</p>
</dd>
<dt><code>GAD</code></dt><dd><p>the gestational age at delivery (GAD), in days.</p>
</dd>
</dl>



<h3>Source</h3>

<p>The dataset can be downloaded from <a href="https://github.com/tommasorigon/LSBP/blob/master/Tutorial/dde.RData">https://github.com/tommasorigon/LSBP/blob/master/Tutorial/dde.RData</a>.
</p>


<h3>References</h3>

<p>Longnecker, M. P., Klebanoff, M. A., Zhou, H., and Brock, J. W. (2001). Association between maternal serum concentration of the DDT metabolite DDE and preterm and small-for-gestational-age babies at birth. The Lancet, 358(9276):110-114.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(DDPstar)
data(dde)
summary(dde)
</code></pre>

<hr>
<h2 id='DDPstar'>
Density Regression via Dirichlet Process Mixtures (DDP) of Normal Structured Additive Regression (STAR) Models
</h2><span id='topic+DDPstar'></span>

<h3>Description</h3>

<p>This function estimates the DDPstar model proposed by Rodriguez-Alvarez, Inacio, et al. (2025).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>DDPstar(formula, data, standardise = TRUE, compute.lpml = FALSE, compute.WAIC = FALSE, 
  compute.DIC = FALSE, prior = priorcontrol(), mcmc = mcmccontrol(), verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="DDPstar_+3A_formula">formula</code></td>
<td>
<p>A <code><a href="stats.html#topic+formula">formula</a></code> object specifying the regression function associated to each component of the DDPstar model used to estimate the conditional density function of the response variable. Regarding the modelling of continuous covariates, both linear and nonlinear effects are allowed, with nonlinear effects being modelled through P-splines (see Note)</p>
</td></tr>
<tr><td><code id="DDPstar_+3A_data">data</code></td>
<td>
<p>A data frame representing the data and containing all needed variables.</p>
</td></tr>
<tr><td><code id="DDPstar_+3A_standardise">standardise</code></td>
<td>
<p>A logical value. If TRUE both the responses and the continuous covariates are standardised (i.e., the resulting variables have mean zero and standard deviation of one). The default is TRUE.</p>
</td></tr>
<tr><td><code id="DDPstar_+3A_compute.lpml">compute.lpml</code></td>
<td>
<p>A logical value. If TRUE, the log pseudo marginal likelihood (LPML, Geisser and Eddy, 1979) and the conditional predictive ordinates (CPO) are computed.</p>
</td></tr>
<tr><td><code id="DDPstar_+3A_compute.waic">compute.WAIC</code></td>
<td>
<p>A logical value. If TRUE, the widely applicable information criterion (WAIC, Gelman et al., 2014; Watanabe, 2010) is computed.</p>
</td></tr>
<tr><td><code id="DDPstar_+3A_compute.dic">compute.DIC</code></td>
<td>
<p>A logical value. If TRUE, the deviance information criterion (DIC)(Celeux et al., 2006, Spiegelhalter et al., 2002) is computed.</p>
</td></tr>
<tr><td><code id="DDPstar_+3A_prior">prior</code></td>
<td>
<p>Hyparameter specification. A list of control values to replace the default values returned by the function <code><a href="#topic+priorcontrol">priorcontrol</a></code>. See <code><a href="#topic+priorcontrol">priorcontrol</a></code> for details.</p>
</td></tr>
<tr><td><code id="DDPstar_+3A_mcmc">mcmc</code></td>
<td>
<p>A list of control values to replace the default values returned by the function <code><a href="#topic+mcmccontrol">mcmccontrol</a></code>. See <code><a href="#topic+mcmccontrol">mcmccontrol</a></code> for details.</p>
</td></tr>
<tr><td><code id="DDPstar_+3A_verbose">verbose</code></td>
<td>
<p>A logical value indicating whether additional information should be displayed while the MCMC algorithm is running. . The default is FALSE</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Our DDPstar model for the conditional density takes the following form 
</p>
<p style="text-align: center;"><code class="reqn">p(y|\boldsymbol{x}) = \sum_{l=1}^{L}\omega_{l}\phi(y\mid\mu_{l}(\boldsymbol{x}),\sigma_{l}^2),</code>
</p>

<p>where <code class="reqn">\phi(y|\mu, \sigma^2)</code> denotes the density function of the normal distribution, evaluated at <code class="reqn">y</code>, with mean <code class="reqn">\mu</code> and variance <code class="reqn">\sigma^2</code>. The regression function <code class="reqn">\mu_{l}(\boldsymbol{x})</code> can incorportate both linear and nonlinear (through P-splines) effects of continuous covariates, random effects, categorical covariates (factors) as well as interactions. Interactions between categorical and (nonlinear) continuous covariates are also allowed (factor-by curve interactions). 
</p>
<p>The mean (regression function) of each mixture component, <code class="reqn">\mu_l(\cdot)</code>, is compactly specified (see Rodriguez-Alvarez, Inacio, et al. (2025) for details) as
</p>
<p style="text-align: center;"><code class="reqn">
\mu_{l}(\boldsymbol{x}) = \underbrace{\mathbf{x}^{\top}\boldsymbol{\beta}_{l}}_{\mbox{Parametric}} + \underbrace{\sum_{r = 1}^{R}\mathbf{z}_{r}(\boldsymbol{v}_r)^{\top}\boldsymbol{\gamma}_{lr}}_{\mbox{Smooth/Random}}</code>
</p>

<p>where <code class="reqn">\mathbf{x}^{\top}\boldsymbol{\beta}_{l}</code> contains all parametric effects, including, by default, the intercept, parametric effects of categorical covariates and linear or parametric effects of continuous covariates and their interactions, as well as, the unpenalised terms associated with the P-splines formulation, and <code class="reqn">\sum_{r = 1}^{R}\mathbf{z}_{r}(\boldsymbol{v}_r)^{\top}\boldsymbol{\gamma}_{lr}</code> contains the P-splines' penalised terms, as well as, the random effects.
</p>
<p>In our DDPstar model, <code class="reqn">L</code> is a pre-specified upper bound on the number of mixture components. The <code class="reqn">\omega_{l}</code>'s result from a truncated version of the stick-breaking construction (<code class="reqn">\omega_{1} = \eta_{1}</code>; <code class="reqn">\omega_{l} = \eta_{l}\prod_{r&lt;l}(1-\eta{r})</code>, <code class="reqn">l=2,\ldots,L</code>; <code class="reqn">\eta_{1},\ldots,\eta_{L-1}\sim</code> Beta <code class="reqn">(1,\alpha)</code>; <code class="reqn">\eta_{L} = 1</code>). Further, for <code class="reqn">\boldsymbol{\beta}_{l}</code> we consider
</p>
<p style="text-align: center;"><code class="reqn">
p\left(\boldsymbol{\beta}_{l} \mid \mathbf{m}, \mathbf{S}\right) \propto \exp\left(-\frac{1}{2}\left(\boldsymbol{\beta}_{l} - \mathbf{m}\right)^{\top}\mathbf{S}^{-1}\left(\boldsymbol{\beta}_{l} - \mathbf{m}\right)\right),
</code>
</p>

<p>with conjugate hyperpriors <code class="reqn">\mathbf{m} \sim N_{Q}(\mathbf{m}_{0},\mathbf{S}_{0})</code> and <code class="reqn">\mathbf{S}^{-1}\sim W_{Q}(\nu,(\nu\Psi)^{-1})</code>, where <code class="reqn">W(\nu,(\nu\Psi)^{-1})</code> denotes a Wishart distribution with <code class="reqn">\nu</code> degrees of freedom and expectation <code class="reqn">\Psi^{-1}</code>, and <code class="reqn">Q</code> denotes the length of vector <code class="reqn">\boldsymbol{\beta}_{l}</code>. Regarding the prior distributions for the P-splines' penalised coefficients and random effect coefficients we have
</p>
<p style="text-align: center;"><code class="reqn">
p(\boldsymbol{\gamma}_{lr}\mid \tau_{lr}^{2}) \propto \exp\left(-\frac{1}{2\tau_{lr}^{2}}\boldsymbol{\gamma}_{lr}^{\top}\mathbf{K}_{r}\boldsymbol{\gamma}_{lr}\right),
</code>
</p>

<p>where the specific forms of <code class="reqn">\mathbf{K}_{r}</code> depend on the components type (see Rodriguez-Alvarez, Inacio, et al. (2025) for details). Finally, <code class="reqn">\sigma_{l}^{-2}\sim\Gamma(a_{\sigma^2},b_{\sigma^2})</code>, <code class="reqn">\tau_{lr}^{-2}\sim\Gamma(a_{\tau^2},b_{\tau^2})</code> and <code class="reqn">\alpha \sim \Gamma(a_{\alpha}, b_{\alpha})</code>, where <code class="reqn">\Gamma(a,b)</code> denotes a Gamma distribution with shape parameter <code class="reqn">a</code> and rate parameter <code class="reqn">b</code>. For a detailed description, we refer to Rodriguez-Alvarez, Inacio, et al. (2025).
</p>
<p>It is worth referring that with respect to the computation of the DIC, when <code class="reqn">L=1</code>, it is computed as in Spiegelhalter et al. (2002), and when <code class="reqn">L&gt;1</code>, DIC3 as described in Celeux et al. (2006) is computed. Also, for the computation of the conditional predictive ordinates (CPO) we follow the stable version proposed by Gelman et al. (2014).
</p>


<h3>Value</h3>

<p>An object of class <code>DDPstar</code>. It is a list containing the following objects:
</p>
<table role = "presentation">
<tr><td><code>call</code></td>
<td>
<p>The matched call.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>The original supplied data argument.</p>
</td></tr>
<tr><td><code>data_model</code></td>
<td>
<p>A list with the data used in the fit: response variable and design matrix.</p>
</td></tr>
<tr><td><code>missing.ind</code></td>
<td>
<p>A logical value indicating whether for each pair of observations (responses and covariates) missing values occur.</p>
</td></tr>
<tr><td><code>mcmc</code></td>
<td>
<p>A list of control values for the Markov chain Monte Carlo (MCMC)</p>
</td></tr>
<tr><td><code>fit</code></td>
<td>
<p>Named list with the following information: (1) <code>formula</code>: the value of the argument <code>formula</code> used in the call. (2) <code>mm</code>: information needed to construct the model matrix associated with the DDPstar model. (3) <code>beta</code>: array of dimension <code>nsave</code><code class="reqn">\times</code><code>L</code><code class="reqn">\times</code><code>K</code> with the sampled regression coefficients. (4) <code>sd</code>: matrix of dimension <code>nsave</code><code class="reqn">\times</code><code>L</code> with the sampled variances. (5) <code>probs</code>: matrix of dimension <code>nsave</code><code class="reqn">\times</code><code>L</code> with the sampled components' weights. (6) <code>tau_sm</code>: matrix of dimension <code>nsave</code><code class="reqn">\times</code><code>L</code><code class="reqn">\times</code><code>R</code> with the sampled variances for smooth/random terms. (7)<code>S</code>: matrix of dimension <code>n</code><code class="reqn">\times</code><code>nsave</code> with the sampled allocations. (8) <code>alpha</code>: vector of length <code>nsave</code> with the sampled precision parameter
of the Dirichlet Process. Here, <code>nsave</code> is the number of Gibbs sampler iterations saved, <code>L</code> is the maximum number of mixture components, <code>K</code> is the dimension of the coefficient vector (including both parametric and nonlinear/smooth/random effects), <code>R</code> is the number of nonlinear/smooth/random components, and <code>n</code> is the number of observations.</p>
</td></tr>
<tr><td><code>lpml</code></td>
<td>
<p>If computed, a list with two components: the log pseudo marginal likelihood (LPML) and the conditional predictive ordinates (CPO).</p>
</td></tr>
<tr><td><code>WAIC</code></td>
<td>
<p>If computed, a list with two components: widely applicable information criterion (WAIC) and associated complexity penalty (pW).</p>
</td></tr>
<tr><td><code>DIC</code></td>
<td>
<p>If computed, a list with two components: deviance information criterion (DIC) and associated complexity penalty (pD).</p>
</td></tr>
</table>


<h3>Note</h3>

<p>The input argument <code>formula</code> is similar to that used for the <code><a href="stats.html#topic+glm">glm</a></code> function, except that flexible specifications can be added by means of function <code><a href="#topic+f">f</a></code>. For instance, specification <code>y ~ x1 + f(x2)</code> would assume a linear effect of <code>x1</code> (if <code>x1</code> is continuous) and the effect of <code>x2</code> (assumed continuous)) would be modeled using Bayesian P-splines. Categorical variables (factors) can be also incorporated, as well as random effects (see <code><a href="#topic+rae">rae</a></code>) and interaction terms. For example, to include the factor-by-curve interaction between <code>x4</code> (continuous covariate) and <code>x3</code> (categorical covariate) we need to specify <code>y ~ x3 + f(x4, by = x3)</code>.</p>


<h3>References</h3>

<p>Celeux, G., Forbes, F., Robert C. P., and Titerrington, D. M. (2006). Deviance information criteria for missing data models. Bayesian Analysis, <b>1</b>, 651-674.
</p>
<p>Eilers, P.H.C. and Marx, B.D. (1996). Flexible smoothing with B-splines and penalties. Statistical Science, <b>11</b>(2), 89-121.
</p>
<p>Eilers, P.H.C. and Marx, B.D. (2003). Multidimensional calibration with temperature interaction using two- dimensional penalized signal regression. Chemometrics and Intelligence Laboratory Systems, <b>66</b>, 159-174.
</p>
<p>De Iorio, M., Muller, P., Rosner, G. L., and MacEachern, S. N. (2004). An anova model for dependent random measures. Journal of the American Statistical Association, <b>99</b>(465), 205-215
</p>
<p>De Iorio, M., Johnson, W. O., Muller, P., and Rosner, G. L. (2009). Bayesian nonparametric nonproportional hazards survival modeling. Biometrics, <b>65</b>, 762&ndash;775.
</p>
<p>Geisser, S. and Eddy, W.F. (1979) A Predictive Approach to Model Selection, Journal of the American Statistical Association, <b>74</b>, 153-160.
</p>
<p>Gelman, A., Carlin, J.B., Stern, H.S., Dunson, D.B., Vehtari, A., and Rubin, D.B. (2014). Bayesian Data Analysis, 3rd ed. CRC Press: Boca Raton, FL.
</p>
<p>Gelman, A., Hwang, J., and Vehtari, A. (2014). Understanding predictive information criteria for Bayesian models. Statistics and Computing, <b>24</b>, 997-1010.
</p>
<p>Lang, S. and Brezger, A. (2004). Bayesian P-splines. Journal of Computational and Graphical Statistics, <b>13</b>(1), 183-212.
</p>
<p>Lee, D.-J., Durban, M., and Eilers, P. (2013). Efficient two-dimensional smoothing with P-
spline ANOVA mixed models and nested bases. Computational Statistics &amp; Data Analysis, <b>61</b>, 22-37.
</p>
<p>Rodriguez-Alvarez, M. X, Inacio, V. and Klein N. (2025). Density regression via Dirichlet process mixtures of normal structured additive regression models. Accepted for publication in Statistics and Computing (DOI: 10.1007/s11222-025-10567-0).
</p>
<p>Speigelhalter, D. J., Best, N. G., Carlin, B. P., and van der Linde, A. (2002). Bayesian measures of model comparison and fit. Journal of the Royal Statistical Society, Ser. B, <b>64</b>, 583-639.
</p>
<p>Watanabe, S. (2010). Asymptotic Equivalence of Bayes Cross Validation and Widely Applicable Information Criterion in Singular Learning Theory. Journal of Machine Learning Research, <b>11</b>, 3571-3594.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+f">f</a></code>, <code><a href="#topic+rae">rae</a></code>, <code><a href="#topic+predict.DDPstar">predict.DDPstar</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(DDPstar)
data(dde)
dde$GAD &lt;- dde$GAD/7 # GAD in weeks

formula.dde &lt;- GAD ~ f(DDE, bdeg = 3, nseg = 20, pord = 2, atau = 1, btau = 0.005)
mcmc &lt;- mcmccontrol(nburn = 20000, nsave = 15000, nskip = 1)
prior &lt;- priorcontrol(a = 2, b = 0.5, aalpha = 2, balpha = 2, L = 20)

set.seed(10) # For reproducibility
fit_dde &lt;- DDPstar(formula = formula.dde, 
  data = dde, mcmc = mcmc, prior = prior, 
  standardise = TRUE, compute.lpml = TRUE, compute.WAIC = TRUE, compute.DIC = TRUE)
summary(fit_dde)


</code></pre>

<hr>
<h2 id='f'>
Defining smooth terms in DDPstar formulae
</h2><span id='topic+f'></span>

<h3>Description</h3>

<p>Auxiliary function used to define smooth terms using Bayesian P-splines within <code>DDPstar</code> model formulae. The function does not evaluate the smooth - it exists purely to help set up a model using P-spline based smoothers.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>f(..., by = NULL, nseg = 5, bdeg = 3, pord = 2, atau = 1, btau = 0.005,
  prior.2D = c("anisotropic", "isotropic"))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="f_+3A_...">...</code></td>
<td>
<p>a list of up to two covariates to construct the smooth term.</p>
</td></tr>
<tr><td><code id="f_+3A_by">by</code></td>
<td>
<p>a numeric or factor variable of the same dimension as each covariate. Following package <code>mgcv</code>, in the numeric case the elements multiply the smooth, evaluated at the corresponding covariate values (a &lsquo;varying coefficient model&rsquo;). Here, the smooth function does not exclude the intercept, so the <code>by</code> variable should not be added as an additional main effect. In the factor case, a replicate of the smooth is produced for each factor level. In this case, these smooths will exclude the intercept, so the factor needs to be added as a main effect as well (see details).</p>
</td></tr>
<tr><td><code id="f_+3A_nseg">nseg</code></td>
<td>
<p>the number of segments for the (marginal) B-spline bases used to represent the smooth term. Numerical vector of length equal to the number of covariates. Atomic values are also valid, being recycled. The default value is 5.</p>
</td></tr>
<tr><td><code id="f_+3A_bdeg">bdeg</code></td>
<td>
<p>the order of the polynomial for the (marginal) B-spline bases for this term. Numerical vector of length equal to the number of covariates. Atomic values are also valid, being recycled. The default value is 3 (cubic B-splines).</p>
</td></tr>
<tr><td><code id="f_+3A_pord">pord</code></td>
<td>
<p>penalty order. Numerical vector of length equal to the number of covariates. Atomic values are also valid, being recycled. The default value is 2 (second-order penalty).</p>
</td></tr>
<tr><td><code id="f_+3A_atau">atau</code></td>
<td>
<p>a numeric value. Hyperparameter; shape parameter of the gamma prior distribution for the precisions (inverse variances) of the smooth term. The default is 1.</p>
</td></tr>
<tr><td><code id="f_+3A_btau">btau</code></td>
<td>
<p>a numeric value. Hyperparameter; rate parameter of the gamma prior distribution for the precisions (inverse variances) of the smooth term. The default is 0.005.</p>
</td></tr>
<tr><td><code id="f_+3A_prior.2d">prior.2D</code></td>
<td>
<p>character string. Indicates whether the same precision parameter should be used for both variables in two-dimensional smooth functions (isotropy), or if each variable should have a different precision parameter (anisotropy). In the latter case, the Bayesian extension of the PS-ANOVA model by Lee et al. (2013) is used. The default is &quot;anisotropic&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The functions <code>f()</code> is designed to represent either one dimensional smooth functions for main effects of continuous explanatory variables or two dimensional smooth functions representing two way interactions of continuous variables using Bayesian P-splines. By default, the values of the arguments <code>nseg</code>, <code>pord</code> and <code>bdeg</code> are repeated to the length of the explanatory covariates. The two dimensional smooth terms are constructed using the tensor-product of marginal (one-dimensional) B-spline bases (Eilers and Marx, 2003). In this case, the Bayesian extension of the PS-ANOVA model by Lee et al. (2013) is considered when <code>prior.2D = "anisotropic"</code>. It is also possible to include factor-by-curve interactions between a continuous covariate (e.g., <code>x1</code>) and a categorical covariate (e.g., <code>x2</code>) by means of argument <code>by</code>: <code>y ~ x2 + f(x1, by = x2)</code>.
</p>


<h3>Value</h3>

<p>The function is interpreted in the formula of a <code>DDPstar</code> model and creates the right framework for fitting the smoother. List containing (among others) the following elements:
</p>
<table role = "presentation">
<tr><td><code>vars</code></td>
<td>
<p>names of the covariates involved in the smooth term.</p>
</td></tr>
<tr><td><code>nseg</code></td>
<td>
<p>the number of segments for the (marginal) B-spline basis for each covariate (numerical vector of length equal to the number of covariates).</p>
</td></tr>
<tr><td><code>pord</code></td>
<td>
<p>the penalty order (numerical vector of length equal to the number of covariates).</p>
</td></tr>
<tr><td><code>bdeg</code></td>
<td>
<p>the order of the polynomial for the (marginal) B-Spline bases for this term (numerical vector of length equal to the number of covariates)</p>
</td></tr>
<tr><td><code>atau</code></td>
<td>
<p>shape parameter of the gamma prior distribution</p>
</td></tr>
<tr><td><code>btau</code></td>
<td>
<p>rate parameter of the gamma prior distribution</p>
</td></tr>
</table>


<h3>References</h3>

<p>Eilers, P.H.C. and Marx, B.D. (1996). Flexible smoothing with B-splines and penalties. Statistical Science, <b>11</b>(2), 89-121.
</p>
<p>Eilers, P.H.C. and Marx, B.D. (2003). Multidimensional calibration with temperature interaction using two- dimensional penalized signal regression. Chemometrics and Intelligence Laboratory Systems, <b>66</b>, 159-174.
</p>
<p>Lang, S. and Brezger, A. (2004). Bayesian P-splines. Journal of Computational and Graphical Statistics, <b>13</b>(1), 183-212.
</p>
<p>Lee, D.-J., Durban, M., and Eilers, P. (2013). Efficient two-dimensional smoothing with P-
spline ANOVA mixed models and nested bases. Computational Statistics &amp; Data Analysis, <b>61</b>, 22-37.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rae">rae</a></code>, <code><a href="#topic+DDPstar">DDPstar</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(DDPstar)
data(dde)
dde$GAD &lt;- dde$GAD/7 # GAD in weeks

formula.dde &lt;- GAD ~ f(DDE, bdeg = 3, nseg = 20, pord = 2, atau = 1, btau = 0.005)

set.seed(10) # For reproducibility
fit_dde &lt;- DDPstar(formula = formula.dde, 
  data = dde, mcmc = list(nburn = 20000, nsave = 15000, nskip = 1), 
  prior = list(a = 2, b = 0.5, aalpha = 2, balpha = 2, L = 20), 
  standardise = TRUE, compute.lpml = TRUE, compute.WAIC = TRUE, compute.DIC = TRUE)
summary(fit_dde)


</code></pre>

<hr>
<h2 id='mcmccontrol'>
Markov chain Monte Carlo (MCMC) parameters
</h2><span id='topic+mcmccontrol'></span>

<h3>Description</h3>

<p>This function is used to set various parameters controlling the Markov chain Monte Carlo (MCMC) parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mcmccontrol(nsave = 8000, nburn = 2000, nskip = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mcmccontrol_+3A_nsave">nsave</code></td>
<td>
<p>An integer giving the total number of scans to be saved (does not include the burn-in and thinning iterations). </p>
</td></tr>
<tr><td><code id="mcmccontrol_+3A_nburn">nburn</code></td>
<td>
<p>An integer giving the number of burn-in scans.</p>
</td></tr>
<tr><td><code id="mcmccontrol_+3A_nskip">nskip</code></td>
<td>
<p>An integer giving the thinning interval,</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The value returned by this function is used as a control argument of the <code><a href="#topic+DDPstar">DDPstar</a></code> function.
</p>


<h3>Value</h3>

<p>A list with components for each of the possible arguments.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+DDPstar">DDPstar</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(DDPstar)
data(dde)
dde$GAD &lt;- dde$GAD/7 # GAD in weeks

mcmc &lt;- mcmccontrol(nburn = 20000, nsave = 15000, nskip = 1)

set.seed(10) # For reproducibility
fit_dde &lt;- DDPstar(formula = GAD ~ f(DDE, bdeg = 3, nseg = 20, pord = 2, atau = 1, btau = 0.005), 
  data = dde, mcmc = mcmc, prior = list(a = 2, b = 0.5, aalpha = 2, balpha = 2, L = 20), 
  standardise = TRUE, compute.lpml = TRUE, compute.WAIC = TRUE, compute.DIC = TRUE)
summary(fit_dde)


</code></pre>

<hr>
<h2 id='predict.DDPstar'>
Predictions from fitted DDPstar models
</h2><span id='topic+predict.DDPstar'></span>

<h3>Description</h3>

<p>Takes a fitted <code>DDPstar</code> object produced by <code>DDPstar()</code> and produces predictions for different functionals given a new set of values for the model covariates. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'DDPstar'
predict(object, what = NULL, newdata, reg.select = NULL, den.grid = NULL, 
  quant.probs = NULL, q.value = NULL, 
  parallel = c("no", "multicore", "snow"), ncpus = 1, cl = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict.DDPstar_+3A_object">object</code></td>
<td>
<p>An object of class <code>DDPstar</code> as produced by <code>DDPstar()</code>.</p>
</td></tr>
<tr><td><code id="predict.DDPstar_+3A_what">what</code></td>
<td>
<p>Character vector with the functionals to be obtained: &ldquo;regfun&rdquo; (regression function); &ldquo;varfun&rdquo; (variance function); &ldquo;quantfun&rdquo; (condional quantiles); &ldquo;denfun&rdquo; (conditional densities); ; &ldquo;probfun&rdquo; (conditional probabilities, i.e., probabilities of the form <code class="reqn">P(Y \leq y^{*} \mid X = x)</code>).</p>
</td></tr>
<tr><td><code id="predict.DDPstar_+3A_newdata">newdata</code></td>
<td>
<p>Data frame containing the values of the covariates at which predictions will be computed</p>
</td></tr>
<tr><td><code id="predict.DDPstar_+3A_reg.select">reg.select</code></td>
<td>
<p>Numeric value containing the position of the covariate effect in the DDPstar formula for which predictions are required. If NULL (and <code>"regfun"</code> is in input argument <code>what</code>), the regression function (coditional mean) is computed.</p>
</td></tr>
<tr><td><code id="predict.DDPstar_+3A_den.grid">den.grid</code></td>
<td>
<p>Numeric vector with the response variable values at which the conditional densities should be computed. Applicable and required if &ldquo;denfun&rdquo; is in argument <code>what</code>. If required and NULL, a sequence of 100 values between the minumum and the maximum of the observed responses is considered.</p>
</td></tr>
<tr><td><code id="predict.DDPstar_+3A_quant.probs">quant.probs</code></td>
<td>
<p>Numeric vector with the quantiles at which to obtain/predict the conditional quantiles. Applicable and required if &ldquo;quantfun&rdquo; is in argument <code>what</code>. If required and NULL, the deciles are computed.</p>
</td></tr>
<tr><td><code id="predict.DDPstar_+3A_q.value">q.value</code></td>
<td>
<p>Numeric vector with the response variable values at which to obtain/predict the conditional probabilities. Applicable and required if &ldquo;probfun&rdquo; is in argument <code>what</code>.</p>
</td></tr>
<tr><td><code id="predict.DDPstar_+3A_parallel">parallel</code></td>
<td>
<p>A characters string with the type of parallel operation: either &quot;no&quot; (default), &quot;multicore&quot; (not available on Windows) or &quot;snow&quot;.</p>
</td></tr>
<tr><td><code id="predict.DDPstar_+3A_ncpus">ncpus</code></td>
<td>
<p>An integer with the number of processes to be used in parallel operation. Defaults to 1.</p>
</td></tr>
<tr><td><code id="predict.DDPstar_+3A_cl">cl</code></td>
<td>
<p>An object inheriting from class <code>cluster</code> (from the <code>parallel</code> package), specifying an optional parallel or snow cluster if parallel = &quot;snow&quot;. If not supplied, a cluster on the local machine is created for the duration of the call.</p>
</td></tr>
<tr><td><code id="predict.DDPstar_+3A_...">...</code></td>
<td>
<p>Further arguments passed to or from other methods. Not yet implemented.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the following components (<code>npred</code> is the number of columns in <code>newdata</code> and <code>nsave</code> is the number of Gibbs sampler iterations saved)
</p>
<table role = "presentation">
<tr><td><code>regfun</code></td>
<td>
<p>Present if <code>"regfun"</code> is in input argument <code>what</code>. A matrix of dimension <code>npred</code><code class="reqn">\times</code><code>nsave</code> with the MCMC realisations of the regression function (conditional mean) or the desired component (if <code>reg.select</code> is used). </p>
</td></tr>
<tr><td><code>reg.select</code></td>
<td>
<p>Argument <code>reg.select</code> used in the call. Present if <code>"regfun"</code> is in input argument <code>what</code>.</p>
</td></tr>
<tr><td><code>varfun</code></td>
<td>
<p>Present if <code>"varfun"</code> is in input argument <code>what</code>. A matrix of dimension <code>npred</code><code class="reqn">\times</code><code>nsave</code> with the MCMC realisations of the conditional variance.</p>
</td></tr>
<tr><td><code>quantfun</code></td>
<td>
<p>Present if <code>"quantfun"</code> is in input argument <code>what</code>. An array of dimension <code>npred</code><code class="reqn">\times</code><code>nsave</code><code class="reqn">\times</code><code>nq</code> with the MCMC realisations of the conditional quantiles. Here <code>nq</code> is the length of argument <code>quant.probs</code>.</p>
</td></tr>
<tr><td><code>quant.probs</code></td>
<td>
<p>Argument <code>quant.probs</code> used in the call. Present if <code>"quantfun"</code> is in input argument <code>what</code>.</p>
</td></tr>
<tr><td><code>denfun</code></td>
<td>
<p>Present if <code>"denfun"</code> is in input argument <code>what</code>. An array of dimension <code>nden</code><code class="reqn">\times</code><code>npred</code><code class="reqn">\times</code><code>nsave</code> with the MCMC realisations of the conditional densities. Here <code>nden</code> is the length of argument <code>den.grid</code>.</p>
</td></tr>
<tr><td><code>den.grid</code></td>
<td>
<p>Argument <code>den.grid</code> used in the call. Present if <code>"denfun"</code> is in input argument <code>what</code>.</p>
</td></tr>
<tr><td><code>probfun</code></td>
<td>
<p>Present if <code>"probfun"</code> is in input argument <code>what</code>. An array of dimension <code>ny</code><code class="reqn">\times</code><code>npred</code><code class="reqn">\times</code><code>nsave</code> with the MCMC realisations of the conditional probabilities. Here <code>ny</code> is the length of argument <code>q.value</code></p>
</td></tr>
<tr><td><code>q.value</code></td>
<td>
<p>Argument <code>q.value</code> used in the call. Present if <code>"probfun"</code> is in input argument <code>what</code>.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+DDPstar">DDPstar</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(DDPstar)
data(dde)
dde$GAD &lt;- dde$GAD/7 # GAD in weeks

set.seed(10) # For reproducibility
fit_dde &lt;- DDPstar(formula = GAD ~ f(DDE, bdeg = 3, nseg = 20, pord = 2, atau = 1, btau = 0.005), 
 data = dde, mcmc = list(nburn = 20000, nsave = 15000, nskip = 1), 
  prior = list(a = 2, b = 0.5, aalpha = 2, balpha = 2, L = 20), 
  standardise = TRUE, compute.lpml = TRUE, compute.WAIC = TRUE)
 
# Data frame for predictions (regression, variance, quartiles and probabilities functions)
df_pred &lt;- data.frame(DDE = seq(min(dde$DDE), max(dde$DDE), length = 50))

# Data frame for conditional densities
# Compute the densities for 4 different DDE values
df_pred_den &lt;- data.frame(DDE = quantile(dde$DDE, c(0.1, 0.6, 0.9, 0.99)))
sequenceGAD &lt;- seq(min(dde$GAD), max(dde$GAD), length = 100)
 
# Regression and variance function
  reg_var_DDE &lt;- predict(fit_dde, newdata = df_pred, 
    what = c("regfun", "varfun"), 
    parallel = "multicore", 
    ncpus = 2)
    # Regression function
    reg_m  &lt;- apply(reg_var_DDE$regfun, 1, median) 
    reg_ql &lt;- apply(reg_var_DDE$regfun, 1, quantile, 0.025) 
    reg_qh &lt;- apply(reg_var_DDE$regfun, 1, quantile, 0.975)

    plot(dde$DDE, dde$GAD, xlab = "DDE (mg/L)", 
      ylab = "Gestational age at delivery (in weeks)",
      main = "Regression function")
    lines(df_pred$DDE, reg_m, lwd = 2)
    lines(df_pred$DDE, reg_ql, lty = 2)
    lines(df_pred$DDE, reg_qh, lty = 2)

    # Variance function
    var_m  &lt;- apply(reg_var_DDE$varfun, 1, median) 
    var_ql &lt;- apply(reg_var_DDE$varfun, 1, quantile, 0.025) 
    var_qh &lt;- apply(reg_var_DDE$varfun, 1, quantile, 0.975)

    plot(df_pred$DDE, var_m, type = "l", lwd = 2,
      xlab = "DDE (mg/L)", 
      ylab = "",
      main = "Variance function")
    lines(df_pred$DDE, var_ql, lty = 2)
    lines(df_pred$DDE, var_qh, lty = 2)

# Quartiles
  p &lt;- c(0.25, 0.5, 0.75)
  quart_DDE &lt;- predict(fit_dde, newdata = df_pred, 
    what = "quantfun", quant.probs = p, 
    parallel = "multicore", ncpus = 2)
  
  quart_m &lt;- apply(quart_DDE$quantfun , c(1,3), median)
  quart_ql &lt;- apply(quart_DDE$quantfun , c(1,3), quantile, 0.025)
  quart_qh &lt;- apply(quart_DDE$quantfun , c(1,3), quantile, 0.975)
  
  plot(dde$DDE, dde$GAD, xlab = "DDE (mg/L)", 
      ylab = "Gestational age at delivery (in weeks)",
      main = "Conditional quartiles")
  
  # Q1    
  lines(df_pred$DDE, quart_m[,1], lwd = 2, col = 2)
  lines(df_pred$DDE, quart_ql[,1], lty = 2, col = 2)
  lines(df_pred$DDE, quart_qh[,1], lty = 2, col = 2)
  
  # Median
  lines(df_pred$DDE, quart_m[,2], lwd = 2)
  lines(df_pred$DDE, quart_ql[,2], lty = 2)
  lines(df_pred$DDE, quart_qh[,2], lty = 2)
  
  # Q3
  lines(df_pred$DDE, quart_m[,3], lwd = 2, col = 3)
  lines(df_pred$DDE, quart_ql[,3], lty = 2, col = 3)
  lines(df_pred$DDE, quart_qh[,3], lty = 2, col = 3)

# Conditional densities
  den_DDE &lt;- predict(fit_dde, newdata = df_pred_den,
    what = "denfun", den.grid = sequenceGAD,
    parallel = "multicore", ncpus = 2)
  
  den_m  &lt;- apply(den_DDE$denfun, c(1,2), median)
  den_ql &lt;- apply(den_DDE$denfun, c(1,2), quantile, 0.025)
  den_qh &lt;- apply(den_DDE$denfun, c(1,2), quantile, 0.975)
  
  op &lt;- par(mfrow = c(2,2))
  plot(sequenceGAD, den_m[,1], type = "l", lwd = 2,
    xlab = "DDE (mg/L)",
    ylab = "",
    main = "DDE = 12.57 (10th percentile)")
  lines(sequenceGAD, den_ql[,1], lty = 2)
  lines(sequenceGAD, den_qh[,1], lty = 2)

  plot(sequenceGAD, den_m[,2], type = "l", lwd = 2,
  xlab = "DDE (mg/L)",
    ylab = "",
    main = "DDE = 28.44 (60th percentile)")
  lines(sequenceGAD, den_ql[,2], lty = 2)
  lines(sequenceGAD, den_qh[,2], lty = 2)

  plot(sequenceGAD, den_m[,3], type = "l", lwd = 2,
    xlab = "DDE (mg/L)",
    ylab = "",
    main = "DDE = 53.72 (90th percentile)")
  lines(sequenceGAD, den_ql[,3], lty = 2)
  lines(sequenceGAD, den_qh[,3], lty = 2)
  plot(sequenceGAD, den_m[,4], type = "l", lwd = 2,
    xlab = "DDE (mg/L)",
    ylab = "",
    main = "DDE = 105.47 (99th percentile)")
  lines(sequenceGAD, den_ql[,4], lty = 2)
  lines(sequenceGAD, den_qh[,4], lty = 2) 
  par(op)

# Conditional probabilities
  probs_DDE &lt;- predict(fit_dde, newdata = df_pred, 
    what = "probfun", q.value = c(37), 
    parallel = "multicore", ncpus = 2)
  
  prob_m  &lt;- apply(probs_DDE$probfun, c(1,2), median)
  prob_ql &lt;- apply(probs_DDE$probfun, c(1,2), quantile, 0.025)
  prob_qh &lt;- apply(probs_DDE$probfun, c(1,2), quantile, 0.975)
 
  plot(df_pred$DDE, prob_m, type = "l", lwd = 2, ylim = c(0, 1),
      xlab = "DDE (mg/L)", 
      ylab = "P(GAD &lt; 37 | DDE)",
      main = "Conditional Probabilities (premature delivery)")
  lines(df_pred$DDE, prob_ql, lty = 2)
  lines(df_pred$DDE, prob_qh, lty = 2)



</code></pre>

<hr>
<h2 id='predictive.checks.DDPstar'>
Posterior predictive checks.
</h2><span id='topic+predictive.checks.DDPstar'></span>

<h3>Description</h3>

<p>Implements posterior predictive checks for objects of class <code>DDPstar</code> as produced by function <code>DDPstar</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predictive.checks.DDPstar(object, statistics = c("min", "max", "kurtosis", "skewness"), 
  devnew = TRUE, ndensity = 512, trim = 0.025)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predictive.checks.DDPstar_+3A_object">object</code></td>
<td>
<p>An object of class <code>DDPstar</code> as produced by function <code>DDPstar</code>.</p>
</td></tr>
<tr><td><code id="predictive.checks.DDPstar_+3A_statistics">statistics</code></td>
<td>
<p>Character vector. Statistics to be used for the posterior predictive checking. By default, &quot;min&quot;, &quot;max&quot;, &quot;kurtosis&quot; and &quot;skewness&quot;.</p>
</td></tr>
<tr><td><code id="predictive.checks.DDPstar_+3A_devnew">devnew</code></td>
<td>
<p>A logical value. If TRUE, each plot is depicted in a new graphic device.</p>
</td></tr>
<tr><td><code id="predictive.checks.DDPstar_+3A_ndensity">ndensity</code></td>
<td>
<p>An integer giving the number of equally spaced points at which the density of the response variable and of the simulated datasets from the posterior predictive distribution (see more on Details) is to be estimated (for more details see the help of the function <code>density</code> in the <code>stats</code> package)</p>
</td></tr>
<tr><td><code id="predictive.checks.DDPstar_+3A_trim">trim</code></td>
<td>
<p>the fraction (0 to 0.5) of (simulated) test statistics to be trimmed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Compares a selected test statistic computed based on the observed response variable against the same test statistics computed based on simulated data from the posterior predictive distribution of the response variable obtained using a DDPstar model. The following graphics are depicted: (1) histograms of the desired statistics computed from simulated datasets (nsave of them) from the posterior predictive distribution of the response variable. In these plots, the estimated statistics from the observed response variable are also depicted. (2) Kernel density estimates computed computed from simulated datasets (nsave of them) from the posterior predictive distribution of the response variable. In these plots, the kernel density estimate of the observed response variable is also depicted. For a detailed discussion about predictive checks, see Gabry et al. (2019).
</p>


<h3>Value</h3>

<p>As a result, the function provides a list with the following components:
</p>
<table role = "presentation">
<tr><td><code>yrep</code></td>
<td>
<p>numeric matrix. Each column of the matrix (there are nsave of them) corresponds to a dataset generated from the posterior predictive distribution of the of the response variable.</p>
</td></tr>
<tr><td><code>y</code></td>
<td>
<p>numeric vector containing the observed response variable.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Gabry, J., Simpson, D., Vehtari, A., Betancourt, M., and Gelman, A. (2019). Visualization in Bayesian workflow. Journal of the Royal Statistical Society, Series A, 182, 1-14.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+DDPstar">DDPstar</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(DDPstar)
data(dde)
dde$GAD &lt;- dde$GAD/7 # GAD in weeks

set.seed(10) # For reproducibility
fit_dde &lt;- DDPstar(formula = GAD ~ f(DDE, bdeg = 3, nseg = 20, pord = 2, atau = 1, btau = 0.005), 
  data = dde, mcmc = list(nburn = 20000, nsave = 15000, nskip = 1), 
  prior = list(a = 2, b = 0.5, aalpha = 2, balpha = 2, L = 20), 
  standardise = TRUE, compute.lpml = TRUE, compute.WAIC = TRUE)
op &lt;- par(mfrow = c(2,3))
predictive.checks.DDPstar(fit_dde)
par(op)


</code></pre>

<hr>
<h2 id='print.DDPstar'>
Print method for DDPstar objects
</h2><span id='topic+print.DDPstar'></span>

<h3>Description</h3>

<p>Default print method for objects fitted with function <code>DDPstar()</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'DDPstar'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.DDPstar_+3A_x">x</code></td>
<td>
<p>An object of class <code>DDPstar</code> as produced by <code>DDPstar()</code>.</p>
</td></tr>
<tr><td><code id="print.DDPstar_+3A_...">...</code></td>
<td>
<p>Further arguments passed to or from other methods. Not yet implemented.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A short summary is printed.
</p>


<h3>Value</h3>

<p>No return value, called for side effects</p>


<h3>See Also</h3>

<p><code><a href="#topic+DDPstar">DDPstar</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(DDPstar)
data(dde)
dde$GAD &lt;- dde$GAD/7 # GAD in weeks

set.seed(10) # For reproducibility
fit_dde &lt;- DDPstar(formula = GAD ~ f(DDE, bdeg = 3, nseg = 20, pord = 2, atau = 1, btau = 0.005), 
  data = dde, mcmc = list(nburn = 20000, nsave = 15000, nskip = 1), 
  prior = list(a = 2, b = 0.5, aalpha = 2, balpha = 2, L = 20), 
  standardise = TRUE, compute.lpml = TRUE, compute.WAIC = TRUE, compute.DIC = TRUE)
fit_dde


</code></pre>

<hr>
<h2 id='priorcontrol'>
Prior information for the DDPstar model
</h2><span id='topic+priorcontrol'></span>

<h3>Description</h3>

<p>This function is used to set various parameters controlling the prior information to be used in the <code>DDPstar</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>priorcontrol(m0 = NA, S0 = NA, nu = NA, Psi = NA, 
  atau = 1, btau = 0.005, a = 2, b = NA, alpha.fixed = FALSE, 
  alpha = 1, aalpha = 2, balpha = 2, L = 10)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="priorcontrol_+3A_m0">m0</code></td>
<td>
<p>A numeric vector. Hyperparameter; mean vector of the (multivariate) normal prior distribution for the parametric coefficients. <code>NA</code> signals autoinitialization, with defaults: a vector, of length <code class="reqn">Q</code> (where <code class="reqn">Q</code> is the number of parametric coefficients), of zeros, if the data are standardised and the least squares estimates of the regression coefficients if the data are not standardised.</p>
</td></tr>
<tr><td><code id="priorcontrol_+3A_s0">S0</code></td>
<td>
<p>A numeric matrix. Hyperparameter; covariance matrix of the (multivariate) normal prior distribution for the parametric coefficients. <code>NA</code> signals autoinitialization, with defaults: 10<code class="reqn">I_{Q\times Q}</code> if the data are standardised (where <code class="reqn">Q</code> is the number of parametric coefficients) and <code class="reqn">\mathbf{\hat{\Sigma}}</code> if the data are not standardised, where <code class="reqn">\mathbf{\hat{\Sigma}}</code> is the estimated covariance matrix of the parametric coefficients obtained by fitting a linear model to the data.</p>
</td></tr>
<tr><td><code id="priorcontrol_+3A_nu">nu</code></td>
<td>
<p>A numeric value. Hyperparameter; degrees of freedom of the Wishart prior distribution for the precision matrix associated with the parametric coefficients. <code>NA</code> signals autoinitialization, with default <code class="reqn">Q+2</code> (where <code class="reqn">Q</code> is the number of parametric coefficients)</p>
</td></tr>
<tr><td><code id="priorcontrol_+3A_psi">Psi</code></td>
<td>
<p>A numeric matrix. Hyperparameter; scale matrix of the Wishart prior distribution for the precision matrix associated with the parametric coefficients. <code>NA</code> signals autoinitialization, with defaults: <code class="reqn">I_{Q\times Q}</code> if the data are standardised (where <code class="reqn">Q</code> is the number of parametric coefficients) and to 30<code class="reqn">\mathbf{\hat{\Sigma}}</code> if the data are not standardised, where <code class="reqn">\mathbf{\hat{\Sigma}}</code> is the estimated covariance matrix of the parametric coefficients obtained by fitting a linear model to the data.</p>
</td></tr>
<tr><td><code id="priorcontrol_+3A_atau">atau</code></td>
<td>
<p>A numeric value. Hyperparameter; shape parameter of the gamma prior distribution for the precisions (inverse variances) of the smooth/nonlinear/random terms. The default is 1.</p>
</td></tr>
<tr><td><code id="priorcontrol_+3A_btau">btau</code></td>
<td>
<p>A numeric value. Hyperparameter; rate parameter of the gamma prior distribution for the precisions (inverse variances) of the smooth/nonlinear/random terms. The default is 0.005.</p>
</td></tr>
<tr><td><code id="priorcontrol_+3A_a">a</code></td>
<td>
<p>A numeric value. Hyperparameter; shape parameter of the gamma prior distribution for the precisions (inverse variances) of each component. The default is 2.</p>
</td></tr>
<tr><td><code id="priorcontrol_+3A_b">b</code></td>
<td>
<p>A numeric value. Hyperparameter; shape parameter of the gamma prior distribution for the precisions (inverse variances) of each component. <code>NA</code> signals autoinitialization, with defaults: 0.5 if the data are standardised and <code class="reqn">\frac{\hat{\sigma}^2}{2}</code> if the data are not standardised</p>
</td></tr>
<tr><td><code id="priorcontrol_+3A_alpha.fixed">alpha.fixed</code></td>
<td>
<p>A logical value. If <code>TRUE</code>, the precision parameter of the Dirichlet Process is considered fixed. If <code>FALSE</code>, a Gamma prior distribution is placed on it.</p>
</td></tr>
<tr><td><code id="priorcontrol_+3A_alpha">alpha</code></td>
<td>
<p>A numeric value. Applicable when <code>alpha.fixed = TRUE</code>. Precision parameter of the Dirichlet Process. The default is 1.</p>
</td></tr>
<tr><td><code id="priorcontrol_+3A_aalpha">aalpha</code></td>
<td>
<p>A numeric value. Applicable when <code>alpha.fixed = FALSE</code>. Hyperparameter; shape parameter for the Gamma prior distribution of the precision parameter of the Dirichlet process prior. The default is 2.</p>
</td></tr>
<tr><td><code id="priorcontrol_+3A_balpha">balpha</code></td>
<td>
<p>A numeric value. Applicable when <code>alpha.fixed = FALSE</code>. Hyperparameter; rate parameter for the Gamma prior distribution of the precision parameter of the Dirichlet process prior. The default is 2.</p>
</td></tr>
<tr><td><code id="priorcontrol_+3A_l">L</code></td>
<td>
<p>A numeric value. Upper bound on the number of mixture components. Setting L = 1 corresponds to a normal model. The default is 10.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with components for each of the possible arguments.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+DDPstar">DDPstar</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(DDPstar)
data(dde)
dde$GAD &lt;- dde$GAD/7 # GAD in weeks

prior &lt;- priorcontrol(a = 2, b = 0.5, aalpha = 2, balpha = 2, L = 20)

set.seed(10) # For reproducibility
fit_dde &lt;- DDPstar(formula = GAD ~ f(DDE, bdeg = 3, nseg = 20, pord = 2, atau = 1, btau = 0.005), 
  data = dde, mcmc = list(nburn = 20000, nsave = 15000, nskip = 1), prior = prior, 
  standardise = TRUE, compute.lpml = TRUE, compute.WAIC = TRUE, compute.DIC = TRUE)
summary(fit_dde)


</code></pre>

<hr>
<h2 id='quantileResiduals'>
Quantile residuals.
</h2><span id='topic+quantileResiduals'></span><span id='topic+quantileResiduals.DDPstar'></span>

<h3>Description</h3>

<p>Produces quantile residuals for objects of class <code>DDPstar</code> as produced by function <code>DDPstar</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'DDPstar'
quantileResiduals(object, parallel = c("no", "multicore", "snow"), 
  ncpus = 1, cl = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="quantileResiduals_+3A_object">object</code></td>
<td>
<p>An object of class <code>DDPstar</code> as produced by function <code>DDPstar</code>.</p>
</td></tr>
<tr><td><code id="quantileResiduals_+3A_parallel">parallel</code></td>
<td>
<p>A characters string with the type of parallel operation: either &quot;no&quot; (default), &quot;multicore&quot; (not available on Windows) or &quot;snow&quot;.</p>
</td></tr>
<tr><td><code id="quantileResiduals_+3A_ncpus">ncpus</code></td>
<td>
<p>An integer with the number of processes to be used in parallel operation. Defaults to 1.</p>
</td></tr>
<tr><td><code id="quantileResiduals_+3A_cl">cl</code></td>
<td>
<p>An object inheriting from class <code>cluster</code> (from the <code>parallel</code> package), specifying an optional parallel or snow cluster if parallel = &quot;snow&quot;. If not supplied, a cluster on the local machine is created for the duration of the call.</p>
</td></tr>
<tr><td><code id="quantileResiduals_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods. Not yet implemented</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Quantile residuals (Dunn and Smyth, 1996) are based on the well-known fact that for a continuous random variable, say <code class="reqn">Y</code>, with CDF given by <code class="reqn">F</code>, one has that <code class="reqn">F(Y) \sim U(0,1)</code>. As a consequence, quantile residuals defined by <code class="reqn">\hat{r}_j = \Phi^{-1}(\hat{F}(y_j))</code>, <code class="reqn">j = 1, \ldots, n</code>, should follow, approximately, a standard normal distribution if a correct model has been specified. A quantile-quantile (QQ) plot can then be used to determine deviations of the quantile residuals from the standard normal distribution.
</p>


<h3>Value</h3>

<p>As a result, the function provides a list with the following components:
</p>
<table role = "presentation">
<tr><td><code>x</code></td>
<td>
<p>Theoretical quantiles</p>
</td></tr>
<tr><td><code>y</code></td>
<td>
<p>Sample quantiles: posterior mean</p>
</td></tr>
<tr><td><code>ymin</code></td>
<td>
<p>Sample quantiles: posterior 0.025 quantile</p>
</td></tr>
<tr><td><code>ymax</code></td>
<td>
<p>Sample quantiles: posterior 0.975 quantile</p>
</td></tr>
</table>


<h3>References</h3>

<p>Dunn, P. K. and Smyth, G. K. (1996). Randomized Quantile Residuals. Journal of Computational and Graphical Statistics, 5(3), 236-244.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+DDPstar">DDPstar</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(DDPstar)
data(dde)
dde$GAD &lt;- dde$GAD/7 # GAD in weeks

set.seed(10) # For reproducibility
fit_dde &lt;- DDPstar(formula = GAD ~ f(DDE, bdeg = 3, nseg = 20, pord = 2, atau = 1, btau = 0.005), 
  data = dde, mcmc = list(nburn = 20000, nsave = 15000, nskip = 1), 
  prior = list(a = 2, b = 0.5, aalpha = 2, balpha = 2, L = 20), 
  standardise = TRUE, compute.lpml = TRUE, compute.WAIC = TRUE)

qres &lt;- quantileResiduals.DDPstar(fit_dde)

plot(qres$x, qres$y, xlab = "Theoretical Quantiles", ylab = "Sample Quantiles", 
  cex.main = 2, cex.lab = 1.5, cex.axis = 1.5)
lines(qres$x, qres$ymin, lty = 2, lwd = 2)
lines(qres$x, qres$ymax, lty = 2, lwd = 2)
abline(a = 0, b = 1, col ="red", lwd = 2) 



</code></pre>

<hr>
<h2 id='rae'>
Defining random effects in DDPstar formulae
</h2><span id='topic+rae'></span>

<h3>Description</h3>

<p>Auxiliary function used to define random effects terms in a <code>DDPstar</code> model formula.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rae(x, atau = 1, btau = 0.005)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rae_+3A_x">x</code></td>
<td>
<p>the x-variable (factor) that defines the random effects term.</p>
</td></tr>
<tr><td><code id="rae_+3A_atau">atau</code></td>
<td>
<p>A numeric value. Hyperparameter; shape parameter of the gamma prior distribution for the precision (inverse variance) of the random effect term. The default is 1.</p>
</td></tr>
<tr><td><code id="rae_+3A_btau">btau</code></td>
<td>
<p>A numeric value. Hyperparameter; rate parameter of the gamma prior distribution for the precision (inverse variance) of the random effect term. The default is 0.005.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The functions is designed to represent random effects in DDPstar formulae. 
</p>


<h3>Value</h3>

<p>The function is interpreted in the formula of a <code>DDPstar</code> model and creates the right framework for fitting the random effect. List containing the following elements:
</p>
<table role = "presentation">
<tr><td><code>vars</code></td>
<td>
<p>name of the covariate involved.</p>
</td></tr>
<tr><td><code>atau</code></td>
<td>
<p>shape parameter of the gamma prior distribution</p>
</td></tr>
<tr><td><code>btau</code></td>
<td>
<p>rate parameter of the gamma prior distribution</p>
</td></tr>
</table>


<h3>References</h3>

<p>Rodriguez-Alvarez, M. X, Inacio, V. and Klein N. (2025). Density regression via Dirichlet process mixtures of normal structured additive regression models. Accepted for publication in Statistics and Computing (DOI: 10.1007/s11222-025-10567-0).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+f">f</a></code>, <code><a href="#topic+DDPstar">DDPstar</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># For an example including random effects, we refer to Rodriguez-Alvarez, Inacio et al. (2025) 
# and associated codes (found in https://bitbucket.org/mxrodriguez/ddpstar)
</code></pre>

<hr>
<h2 id='summary.DDPstar'>
Summary method for DDPstar objects
</h2><span id='topic+summary.DDPstar'></span>

<h3>Description</h3>

<p>Default summary method for objects fitted with function <code>DDPstar</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'DDPstar'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.DDPstar_+3A_object">object</code></td>
<td>
<p>An object of class <code>DDPstar</code> as produced by <code>DDPstar()</code>.</p>
</td></tr>
<tr><td><code id="summary.DDPstar_+3A_...">...</code></td>
<td>
<p>Further arguments passed to or from other methods. Not yet implemented.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The information printed includes: (1) the call to the function and (2) the sample size. If required, the function aso provides the log pseudo marginal likelihood (LPML), the widely applicable information criterion (WAIC) and/or the deviance information criterion (DIC).
</p>


<h3>Value</h3>

<p>No return value, called for side effects</p>


<h3>See Also</h3>

<p><code><a href="#topic+DDPstar">DDPstar</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(DDPstar)
data(dde)
dde$GAD &lt;- dde$GAD/7 # GAD in weeks

set.seed(10) # For reproducibility
fit_dde &lt;- DDPstar(formula = GAD ~ f(DDE, bdeg = 3, nseg = 20, pord = 2, atau = 1, btau = 0.005), 
  data = dde, mcmc = list(nburn = 20000, nsave = 15000, nskip = 1), 
  prior = list(a = 2, b = 0.5, aalpha = 2, balpha = 2, L = 20), 
  standardise = TRUE, compute.lpml = TRUE, compute.WAIC = TRUE, compute.DIC = TRUE)
summary(fit_dde)


</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
