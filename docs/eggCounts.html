<!DOCTYPE html><html><head><title>Help for package eggCounts</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {eggCounts}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#eggCounts-package'><p>Hierarchical modelling of faecal egg counts</p></a></li>
<li><a href='#epgs'><p>Faecal egg count samples (before and after treatment)</p></a></li>
<li><a href='#fec_stan'><p>Modelling of faecal egg count data (one-sample case)</p></a></li>
<li><a href='#fecr_probs'><p>Compute probability of the reduction parameter relative to a given threshold</p></a></li>
<li><a href='#fecr_stan'><p>Model the reduction of faecal egg count</p></a></li>
<li><a href='#fecr_stanExtra'><p>Model the reduction of faecal egg count using custom models</p></a></li>
<li><a href='#fecr_stanSimple'><p>Model the reduction of faecal egg count using a simple Bayesian model</p></a></li>
<li><a href='#fecrtCI'><p>Compute standard FECRT according to WAAVP guidelines</p></a></li>
<li><a href='#getPrior_delta'><p>Get prior parameters from Beta distribution</p></a></li>
<li><a href='#getPrior_mu'><p>Get prior parameters from Gamma distribution</p></a></li>
<li><a href='#plotCounts'><p>Plot faecal egg count data</p></a></li>
<li><a href='#simData1s'><p>Simulate faecal egg count data (1-sample situation)</p></a></li>
<li><a href='#simData2s'><p>Simulate faecal egg count data (2-sample situation)</p></a></li>
<li><a href='#stan2mcmc'><p>Convert a Stanfit object to a MCMC object</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Imports:</td>
<td>methods, utils, rstan (&ge; 2.26), rstantools (&ge; 2.3.1), boot,
coda, numbers, lattice, rootSolve</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.4.0), Rcpp (&ge; 0.12.0)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>eggCountsExtra, R.rsp, testthat</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>R.rsp</td>
</tr>
<tr>
<td>Title:</td>
<td>Hierarchical Modelling of Faecal Egg Counts</td>
</tr>
<tr>
<td>Version:</td>
<td>2.4</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-10-14</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Craig Wang &lt;craigwang247@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>An implementation of Bayesian hierarchical models
    for faecal egg count data to assess anthelmintic
    efficacy. Bayesian inference is done via MCMC sampling using 'Stan' <a href="https://mc-stan.org/">https://mc-stan.org/</a>.</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>GNU make</td>
</tr>
<tr>
<td>Additional_repositories:</td>
<td><a href="https://craigwangstat.github.io/eggCountsExtra-package/">https://craigwangstat.github.io/eggCountsExtra-package/</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>rstan (&ge; 2.26), Rcpp (&ge; 1.0.7), BH (&ge; 1.75.0),
StanHeaders (&ge; 2.26.0), RcppEigen (&ge; 0.3.3.9.1), RcppParallel
(&ge; 5.1.4)</td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>ByteCompile:</td>
<td>true</td>
</tr>
<tr>
<td>Biarch:</td>
<td>true</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://www.math.uzh.ch/pages/eggcount/">https://www.math.uzh.ch/pages/eggcount/</a></td>
</tr>
<tr>
<td>RcppModules:</td>
<td>stan_fit4paired_mod, stan_fit4unpaired_mod,
stan_fit4zipaired_mod, stan_fit4ziunpaired_mod,
stan_fit4nb_mod, stan_fit4zinb_mod, stan_fit4indefficacy_mod,
stan_fit4simple_mod</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-10-14 15:14:26 UTC; crwang</td>
</tr>
<tr>
<td>Author:</td>
<td>Craig Wang <a href="https://orcid.org/0000-0003-1804-2463"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cre],
  Michaela Paul [aut],
  Tea Isler [ctb],
  Reinhard Furrer <a href="https://orcid.org/0000-0002-6319-2332"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Trustees of Columbia University [cph] (src/init.cpp, tools/make_cc.R,
    R/stanmodels.R)</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-10-14 22:22:34 UTC</td>
</tr>
</table>
<hr>
<h2 id='eggCounts-package'>Hierarchical modelling of faecal egg counts</h2><span id='topic+eggCounts-package'></span>

<h3>Description</h3>

<p>This package implements Bayesian hierarchical models for the analysis of faecal egg count data. Bayesian inference is done via efficient MCMC sampling using Stan. Additional (experimental) models are available externally for handling FECs with potential outliers or bi-modality. The models are in <strong>eggCountsExtra</strong> package hosted on Github. 
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> eggCounts</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 2.4</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2023-10-14</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL (&gt;= 3) </td>
</tr>
<tr>
 <td style="text-align: left;">
LazyLoad: </td><td style="text-align: left;"> yes</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>


<h3>About Stan</h3>

<p>Stan is a probabilistic programming language for specifying Bayesian hierarchical models. It is computationally faster compared to conventional MCMC techniques. For the installation instruction and other information about Stan, please read <a href="https://github.com/stan-dev/rstan/wiki/RStan-Getting-Started">here</a>.</p>


<h3>Author(s)</h3>

<p>Craig Wang <a href="mailto:craig.wang@math.uzh.ch">craig.wang@math.uzh.ch</a> <br />
Michaela Paul 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

## Citations
citation('eggCounts')

## History of changes
file.show(system.file("NEWS", package = "eggCounts"))

## Demonstration
demo("fecm_stan", package = "eggCounts") 

## Install eggCountsExtra
devtools::install_github("CraigWangUZH/eggCountsExtra")

## End(Not run)</code></pre>

<hr>
<h2 id='epgs'>Faecal egg count samples (before and after treatment)</h2><span id='topic+epgs'></span>

<h3>Description</h3>

<p>This is an example dataset containing 14 eggs per gram (epg) values in sheep
before and after anthelmintic treatment of benzimidazole.
The correction factor of the diagnostic technique was 50.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(epgs)
</code></pre>


<h3>Format</h3>

<p>A data.frame containing 14 observations.</p>


<h3>References</h3>

<p>Craig Wang, Paul R. Torgerson, Johan Hoglund, Reinhard Furrer,
Zero-inflated hierarchical models for faecal egg counts to assess anthelmintic efficacy,
Veterinary Parasitology, Volume 235, 2017, Pages 20-28.
</p>

<hr>
<h2 id='fec_stan'>Modelling of faecal egg count data (one-sample case)</h2><span id='topic+fec_stan'></span>

<h3>Description</h3>

<p>Models the mean of faecal egg counts with Bayesian hierarchical models. See Details for a list of model choices.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fec_stan(fec, rawCounts = FALSE, CF = 50, zeroInflation = TRUE, 
  muPrior, kappaPrior, phiPrior, nsamples = 2000, nburnin = 1000, 
  thinning = 1, nchain = 2, ncore = 1, adaptDelta = 0.95,
  saveAll = FALSE, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fec_stan_+3A_fec">fec</code></td>
<td>
<p>numeric vector. Faecal egg counts.</p>
</td></tr>
<tr><td><code id="fec_stan_+3A_rawcounts">rawCounts</code></td>
<td>
<p>logical. If TRUE, <code>preFEC</code> and <code>postFEC</code> correspond to raw counts
(as counted on equipment). Otherwise they correspond to calculated epgs (raw counts times correction factor).
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="fec_stan_+3A_cf">CF</code></td>
<td>
<p>a positive integer or a vector of positive integers. Correction factor(s).</p>
</td></tr>
<tr><td><code id="fec_stan_+3A_zeroinflation">zeroInflation</code></td>
<td>
<p>logical. If true, uses the model with zero-inflation. Otherwise uses the model without zero-inflation</p>
</td></tr>
<tr><td><code id="fec_stan_+3A_muprior">muPrior</code></td>
<td>
<p>named list. Prior for the group mean epg parameter <code class="reqn">\mu</code>. The default prior is <code>list(priorDist = "gamma",hyperpars=c(1,0.001))</code>, i.e. a gamma distribution with shape 1 and rate 0.001, its 90% probability mass lies between 51 and 2996.</p>
</td></tr>
<tr><td><code id="fec_stan_+3A_kappaprior">kappaPrior</code></td>
<td>
<p>named list. Prior for the group dispersion parameter <code class="reqn">\kappa</code>. The default prior is <code>list(priorDist = "gamma",hyperpars=c(1,0.7))</code>, i.e. a gamma distribution with shape 1 and rate 0.7, its 90% probability mass lies between 0.1 and 4.3 with a median of 1.</p>
</td></tr>
<tr><td><code id="fec_stan_+3A_phiprior">phiPrior</code></td>
<td>
<p>named list. Prior for the zero-inflation parameter <code class="reqn">\phi</code>. The default prior is <code>list(priorDist = "beta",hyperpars=c(1,1))</code>, i.e. a uniform prior between 0 and 1.</p>
</td></tr>
<tr><td><code id="fec_stan_+3A_nsamples">nsamples</code></td>
<td>
<p>a positive integer. Number of samples for each chain (including burn-in samples).</p>
</td></tr>
<tr><td><code id="fec_stan_+3A_nburnin">nburnin</code></td>
<td>
<p>a positive integer. Number of burn-in samples.</p>
</td></tr>
<tr><td><code id="fec_stan_+3A_thinning">thinning</code></td>
<td>
<p>a positive integer. Thinning parameter, i.e. the period for saving samples.</p>
</td></tr>
<tr><td><code id="fec_stan_+3A_nchain">nchain</code></td>
<td>
<p>a positive integer. Number of chains.</p>
</td></tr>
<tr><td><code id="fec_stan_+3A_ncore">ncore</code></td>
<td>
<p>a positive integer. Number of cores to use when executing the chains in parallel.</p>
</td></tr>
<tr><td><code id="fec_stan_+3A_adaptdelta">adaptDelta</code></td>
<td>
<p>numeric. The target acceptance rate, a numeric value between 0 and 1.</p>
</td></tr>
<tr><td><code id="fec_stan_+3A_saveall">saveAll</code></td>
<td>
<p>logical. If TRUE, posterior samples for all parameters are saved in the <code>stanfit</code> object. If FALSE, only samples for <code class="reqn">\mu</code>, <code class="reqn">\kappa</code> and <code class="reqn">\phi</code> are saved. Default to FALSE.</p>
</td></tr>
<tr><td><code id="fec_stan_+3A_verbose">verbose</code></td>
<td>
<p>logical. If true, prints progress and debugging information.</p>
</td></tr>
</table>


<h3>Details</h3>



<h4>List of built-in models</h4>


<ul>
<li><p> without zero-inflation: set <code>zeroInflation = FALSE</code>
</p>
</li>
<li><p> with zero-inflation: set <code>zeroInflation = TRUE</code>
</p>
</li></ul>

<p>Note that this function only models the mean of egg counts, see <code><a href="#topic+fecr_stan">fecr_stan</a>()</code> for modelling the reduction.
</p>



<h4>Other information</h4>

<p>The first time each model with non-default priors is applied, it can take up to 20 seconds to compile the model. Currently the function only support prior distributions with two parameters. For a complete list of supported priors and their parameterization, please consult the list of distributions in <a href="https://mc-stan.org/users/documentation/">Stan User Guide</a>. 
</p>
<p>The default number of samples per chain is 2000, with 1000 burn-in samples. Normally this is sufficient in Stan. If the chains do not converge, one should tune the MCMC parameters until convergence is reached to ensure reliable results.
</p>



<h3>Value</h3>

<p>Prints out summary of <code>meanEPG</code> as the posterior mean epg. The posterior summary contains the mean, standard deviation (sd), 2.5%,  50% and 97.5% percentiles, the 95% highest posterior density interval (HPDLow95 and HPDHigh95) and the posterior mode. NOTE: we recommend to use the 95% HPD interval and the mode for further statistical analysis.
</p>
<p>The returned value is a list that consists of:
</p>
<table>
<tr><td><code>stan.samples</code></td>
<td>
<p>an object of S4 class <code><a href="rstan.html#topic+stanfit">stanfit</a></code> representing the fitted results</p>
</td></tr>
<tr><td><code>posterior.summary</code></td>
<td>
<p>a data.frame that is the same as the printed posterior summary</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Craig Wang 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+simData1s">simData1s</a></code> for simulating faecal egg count data with one sample 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## load the sample data
data(epgs)

## apply zero-infation model
model &lt;- fec_stan(epgs$before, rawCounts = FALSE, CF = 50)
</code></pre>

<hr>
<h2 id='fecr_probs'>Compute probability of the reduction parameter relative to a given threshold</h2><span id='topic+fecr_probs'></span>

<h3>Description</h3>

<p>Computes probability of the reduction parameter's marginal posterior density relative to a threshold.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fecr_probs(stanFit, threshold = 0.95, lessthan = TRUE, 
           plot = TRUE, xlab, ylab, main, verbose = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fecr_probs_+3A_stanfit">stanFit</code></td>
<td>
<p>a <code><a href="rstan.html#topic+stanfit">stanfit</a></code> object from the output of <code><a href="#topic+fecr_stan">fecr_stan</a>()</code>.</p>
</td></tr>
<tr><td><code id="fecr_probs_+3A_threshold">threshold</code></td>
<td>
<p>numeric. The default threshold is 0.95 (95%).</p>
</td></tr>
<tr><td><code id="fecr_probs_+3A_lessthan">lessthan</code></td>
<td>
<p>logical. If TRUE, the probability less than the threshold is computed. Otherwise greater or equal to the threshold is computed. Default is TRUE.</p>
</td></tr>
<tr><td><code id="fecr_probs_+3A_plot">plot</code></td>
<td>
<p>logical. If TRUE, the posterior density of the reduction is plotted with region less than the threshold shaded.</p>
</td></tr>
<tr><td><code id="fecr_probs_+3A_xlab">xlab</code>, <code id="fecr_probs_+3A_ylab">ylab</code>, <code id="fecr_probs_+3A_main">main</code></td>
<td>
<p>strings. Arguments for plotting. Only used if <code>plot = TRUE</code>.</p>
</td></tr>
<tr><td><code id="fecr_probs_+3A_verbose">verbose</code></td>
<td>
<p>logical. If TRUE, a statement with computed probability is printed.</p>
</td></tr>
<tr><td><code id="fecr_probs_+3A_...">...</code></td>
<td>
<p>additional plotting arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a numeric value indicating the probability in percentage.
</p>


<h3>Author(s)</h3>

<p>Craig Wang
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## load sample data
data(epgs)

## apply individual efficacy model to the data vectors
model &lt;- fecr_stan(epgs$before, epgs$after, rawCounts = FALSE, preCF = 10, 
                   paired = TRUE, indEfficacy = TRUE)
fecr_probs(model$stan.samples)
</code></pre>

<hr>
<h2 id='fecr_stan'>Model the reduction of faecal egg count</h2><span id='topic+fecr_stan'></span>

<h3>Description</h3>

<p>Models the reduction in faecal egg counts with Bayesian hierarchical models. See Details for a list of model choices.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fecr_stan(preFEC, postFEC, rawCounts = FALSE, preCF = 50, postCF = preCF, 
  paired = TRUE, indEfficacy = TRUE, zeroInflation = FALSE, 
  muPrior, kappaPrior, deltaPrior, phiPrior, deltakappaPrior,
  nsamples = 2000, nburnin = 1000, thinning = 1, nchain = 2, 
  ncore = 1, adaptDelta = 0.95, saveAll = FALSE, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fecr_stan_+3A_prefec">preFEC</code></td>
<td>
<p>numeric vector. Pre-treatment faecal egg counts.</p>
</td></tr>
<tr><td><code id="fecr_stan_+3A_postfec">postFEC</code></td>
<td>
<p>numeric vector. Post-treatment faecal egg counts.</p>
</td></tr>
<tr><td><code id="fecr_stan_+3A_rawcounts">rawCounts</code></td>
<td>
<p>logical. If TRUE, <code>preFEC</code> and <code>postFEC</code> correspond to raw counts
(as counted on equipment). Otherwise they correspond to calculated epgs (raw counts times correction factor).
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="fecr_stan_+3A_precf">preCF</code></td>
<td>
<p>a positive integer or a vector of positive integers. Pre-treatment correction factor(s).</p>
</td></tr>
<tr><td><code id="fecr_stan_+3A_postcf">postCF</code></td>
<td>
<p>a positive integer or a vector of positive integers. Post-treatment correction factor(s).</p>
</td></tr>
<tr><td><code id="fecr_stan_+3A_paired">paired</code></td>
<td>
<p>logical. If TRUE, uses the model for the paired design. Otherwise uses the model for the unpaired design</p>
</td></tr>
<tr><td><code id="fecr_stan_+3A_indefficacy">indEfficacy</code></td>
<td>
<p>logical. If TRUE, uses the paired model allowing for individual efficacy. Only use in combination with <code>paired = TRUE</code> and <code>zeroInflation = FALSE</code>.</p>
</td></tr>
<tr><td><code id="fecr_stan_+3A_zeroinflation">zeroInflation</code></td>
<td>
<p>logical. If TRUE, uses the model with zero-inflation. Otherwise uses the model without zero-inflation.</p>
</td></tr>
<tr><td><code id="fecr_stan_+3A_muprior">muPrior</code></td>
<td>
<p>a named list. Prior for the group mean epg parameter <code class="reqn">\mu</code>. The default prior is <code>list(priorDist = "gamma", hyperpars = c(1,0.001))</code>, i.e. a gamma distribution with shape 1 and rate 0.001, its 90% probability mass lies between 51 and 2996.</p>
</td></tr>
<tr><td><code id="fecr_stan_+3A_kappaprior">kappaPrior</code></td>
<td>
<p>a named list. Prior for the group dispersion parameter <code class="reqn">\kappa</code>. The default prior is <code>list(priorDist = "gamma", hyperpars = c(1,0.7))</code>, i.e. a gamma distribution with shape 1 and rate 0.7, its 90% probability mass lies between 0.1 and 4.3 with a median of 1.</p>
</td></tr>
<tr><td><code id="fecr_stan_+3A_deltaprior">deltaPrior</code></td>
<td>
<p>a named list. Prior for the reduction parameter <code class="reqn">\delta</code>. The default prior is <code>list(priorDist = "beta", hyperpars = c(1,1))</code>, i.e. a uniform prior between 0 and 1.</p>
</td></tr>
<tr><td><code id="fecr_stan_+3A_phiprior">phiPrior</code></td>
<td>
<p>a named list. Prior for the zero-inflation parameter <code class="reqn">\phi</code>. The default prior is <code>list(priorDist = "beta", hyperpars = c(1,1))</code>, i.e. a uniform prior between 0 and 1.</p>
</td></tr>
<tr><td><code id="fecr_stan_+3A_deltakappaprior">deltakappaPrior</code></td>
<td>
<p>a named list. Prior information for the shape parameter of reduction <code class="reqn">\delta_\kappa</code>. The default prior is <code>list(priorDist = "normal",hyperpars=c(2,1))</code>. Only used if <code>indEfficacy = TRUE</code>.</p>
</td></tr>
<tr><td><code id="fecr_stan_+3A_nsamples">nsamples</code></td>
<td>
<p>a positive integer. Number of samples for each chain (including burn-in samples).</p>
</td></tr>
<tr><td><code id="fecr_stan_+3A_nburnin">nburnin</code></td>
<td>
<p>a positive integer. Number of burn-in samples.</p>
</td></tr>
<tr><td><code id="fecr_stan_+3A_thinning">thinning</code></td>
<td>
<p>a positive integer. Thinning parameter, i.e. the period for saving samples.</p>
</td></tr>
<tr><td><code id="fecr_stan_+3A_nchain">nchain</code></td>
<td>
<p>a positive integer. Number of chains.</p>
</td></tr>
<tr><td><code id="fecr_stan_+3A_ncore">ncore</code></td>
<td>
<p>a positive integer. Number of cores to use when executing the chains in parallel.</p>
</td></tr>
<tr><td><code id="fecr_stan_+3A_adaptdelta">adaptDelta</code></td>
<td>
<p>numeric. The target acceptance rate, a numeric value between 0 and 1.</p>
</td></tr>
<tr><td><code id="fecr_stan_+3A_saveall">saveAll</code></td>
<td>
<p>logical. If TRUE, posterior samples for all parameters are saved in the <code>stanfit</code> object. If FALSE, only samples for <code class="reqn">\delta</code>, <code class="reqn">\mu</code>, <code class="reqn">\kappa</code> and <code class="reqn">\phi</code> are saved. Default to FALSE.</p>
</td></tr>
<tr><td><code id="fecr_stan_+3A_verbose">verbose</code></td>
<td>
<p>logical. If TRUE, prints progress and debugging information.</p>
</td></tr>
</table>


<h3>Details</h3>



<h4>List of built-in models</h4>


<ul>
<li><p> unpaired without zero-inflation: set <code>paired = FALSE</code>, <code>indEfficacy = FALSE</code>, <code>zeroInflation = FALSE</code>
</p>
</li>
<li><p> unpaired with zero-inflation: set <code>paired = FALSE</code>, <code>indEfficacy = FALSE</code>, <code>zeroInflation = TRUE</code>
</p>
</li>
<li><p> paired without zero-inflation: set <code>paired = TRUE</code>, <code>indEfficacy = FALSE</code>, <code>zeroInflation = FALSE</code>
</p>
</li>
<li><p> paired with zero-inflation: set <code>paired = TRUE</code>, <code>indEfficacy = FALSE</code>, <code>zeroInflation = TRUE</code>
</p>
</li>
<li><p> paired with individual efficacy: set <code>paired = TRUE</code>, <code>indEfficacy = TRUE</code>, <code>zeroInflation = FALSE</code>
</p>
</li></ul>



<h4>Prior choice</h4>

<p>Consider using non-default prior for <code class="reqn">\delta</code> when,
</p>

<ul>
<li><p> there is on average an increase in egg counts after treatment
</p>
</li>
<li><p> there are divergent-sample warnings
</p>
</li>
<li><p> there are non-convergence warnings
</p>
</li></ul>

<p>Two examples of useful non-default priors include:
</p>

<ol>
<li> <p><code>list(priorDist = "normal", hyperpars = c(1, 5))</code> for stablizing the reduction parameter without being informative. 
</p>
</li>
<li> <p><code>list(priorDist = "beta", hyperpars = c(0, 5))</code> for allowing up to 4-fold increase of egg count after treatment.
</p>
</li></ol>



<h4>Other information</h4>

<p>The first time each model with non-default priors is applied, it can take up to 20 seconds to compile the model. Currently the function only support prior distributions with two parameters. For a complete list of supported priors and their parameterization, please consult the list of distributions in <a href="https://mc-stan.org/users/documentation/">Stan User Guide</a>. 
</p>
<p>The default number of samples per chain is 2000, with 1000 burn-in samples. Normally this is sufficient in Stan. If the chains do not converge, one should tune the MCMC parameters until convergence is reached to ensure reliable results.
</p>


<h3>Value</h3>

<p>Prints out the posterior summary of <code>FECR</code> as the reduction, <code>meanEPG.untreated</code> as the mean pre-treatment epg, and <code>meanEPG.treated</code> as the mean after-treatment epg. The posterior summary contains the mean, standard deviation (sd), 2.5%,  50% and 97.5% percentiles, the 95% highest posterior density interval (HPDLow95 and HPDHigh95) and the posterior mode. 
</p>
<p>NOTE: Based on our simulation studies, we recommend to use (2.5%, 97.5%) as the 95% credible interval and the median as summary statistics of reduction for the individual efficacy model. For all other models, we recommend to use the 95% HPD interval and the mode. 
</p>
<p>The returned value is a list that consists of:
</p>
<table>
<tr><td><code>stan.samples</code></td>
<td>
<p>an object of S4 class <code><a href="rstan.html#topic+stanfit">stanfit</a></code> representing the fitted results</p>
</td></tr>
<tr><td><code>posterior.summary</code></td>
<td>
<p>a data.frame that is the same as the printed posterior summary</p>
</td></tr>
</table>


<h3>Author(s)</h3>

 
<p>Craig Wang 
</p>


<h3>References</h3>

<p><strong>Individual efficacy models:</strong>
Craig Wang, Paul R. Torgerson, Ray M. Kaplan, Melissa M. George, Reinhard Furrer. (2018)
Modelling anthelmintic resistance by extending eggCounts package to allow individual efficacy,
International Journal for Parasitology: Drugs and Drug Resistance, Volume 8, Pages 386-393. &lt;<a href="https://doi.org/10.1016/j.ijpddr.2018.07.003">doi:10.1016/j.ijpddr.2018.07.003</a>&gt;
</p>
<p><strong>Zero-inflation models:</strong>
Craig Wang, Paul R. Torgerson, Johan Hoglund, Reinhard Furrer. (2017)
Zero-inflated hierarchical models for faecal egg counts to assess anthelmintic efficacy,
Veterinary Parasitology, Volume 235, Pages 20-28. &lt;<a href="https://doi.org/10.1016/j.vetpar.2016.12.007">doi:10.1016/j.vetpar.2016.12.007</a>&gt;
</p>
<p><strong>Other models:</strong>
Paul R. Torgerson, Michaela Paul, Reinhard Furrer. (2014)
Evaluating faecal egg count reduction using a specifically designed package 'eggCounts' in R and a user friendly web interface,
International Journal for Parasitology, Volume 44, Pages 299-303. &lt;<a href="https://doi.org/10.1016/j.ijpara.2014.01.005">doi:10.1016/j.ijpara.2014.01.005</a>&gt;
</p>


<h3>See Also</h3>

<p><code><a href="#topic+simData2s">simData2s</a></code> for simulating faecal egg counts data with two samples 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## load sample data
data(epgs)

## apply individual efficacy model to the data vectors
model &lt;- fecr_stan(epgs$before, epgs$after, rawCounts = FALSE, preCF = 50, 
                   paired = TRUE, indEfficacy = TRUE)
## convert to MCMC object and inspect the summary
samples &lt;- stan2mcmc(model$stan.samples)
summary(samples)
</code></pre>

<hr>
<h2 id='fecr_stanExtra'>Model the reduction of faecal egg count using custom models</h2><span id='topic+fecr_stanExtra'></span>

<h3>Description</h3>

<p>Models the reduction in faecal egg counts with custom model formulation using Stan modelling language (for advanced users).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fecr_stanExtra(preFEC, postFEC, rawCounts = FALSE, preCF = 50, postCF = preCF, 
  modelName = NULL, modelCode = NULL, modelFile = NULL, modelData = NULL,
  nsamples = 2000, nburnin = 1000, thinning = 1, nchain = 2, 
  ncore = 1, adaptDelta = 0.95, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fecr_stanExtra_+3A_prefec">preFEC</code></td>
<td>
<p>numeric vector. Pre-treatment faecal egg counts. Not required if <code>modelData</code> is supplied.</p>
</td></tr>
<tr><td><code id="fecr_stanExtra_+3A_postfec">postFEC</code></td>
<td>
<p>numeric vector. Post-treatment faecal egg counts. Not required if <code>modelData</code> is supplied.</p>
</td></tr>
<tr><td><code id="fecr_stanExtra_+3A_rawcounts">rawCounts</code></td>
<td>
<p>logical. If TRUE, <code>preFEC</code> and <code>postFEC</code> correspond to raw counts
(as counted on equipment). Otherwise they correspond to calculated epgs (raw counts times correction factor).
Defaults to <code>FALSE</code>. Not required if <code>modelCode</code> or <code>modelFile</code> is supplied.</p>
</td></tr>
<tr><td><code id="fecr_stanExtra_+3A_precf">preCF</code></td>
<td>
<p>a positive integer or a vector of positive integers. Pre-treatment correction factor(s). Not required if <code>modelCode</code> or <code>modelFile</code> is supplied.</p>
</td></tr>
<tr><td><code id="fecr_stanExtra_+3A_postcf">postCF</code></td>
<td>
<p>a positive integer or a vector of positive integers. Post-treatment correction factor(s). Not required if <code>modelCode</code> or <code>modelFile</code> is supplied.</p>
</td></tr>
<tr><td><code id="fecr_stanExtra_+3A_modelname">modelName</code></td>
<td>
<p>string. One of four availale models (&quot;Po&quot;, &quot;UPo&quot;, &quot;ZIPo&quot;, &quot;ZIUPo&quot;) from <strong>eggCountsExtra</strong> package, which corresponds to outlier-adjusted version of paired, unpaired, paired with zero inflation and unpaired with zero inflation models. Not required if <code>modelCode</code> or <code>modelFile</code> is supplied.</p>
</td></tr>
<tr><td><code id="fecr_stanExtra_+3A_modelcode">modelCode</code></td>
<td>
<p>stan model code. Not required when <code>modelName</code> or <code>modelFile</code> is supplied.</p>
</td></tr>
<tr><td><code id="fecr_stanExtra_+3A_modelfile">modelFile</code></td>
<td>
<p>stan model file with file extension &lsquo;*.stan&rsquo;. Not required when <code>modelName</code> or <code>modelCode</code> is supplied.</p>
</td></tr>
<tr><td><code id="fecr_stanExtra_+3A_modeldata">modelData</code></td>
<td>
<p>stan data list. A named list or environment providing the data for the model, or a character vector for all the names of objects in the current enviroment used as data. Not required when <code>modelName</code> is supplied.</p>
</td></tr>
<tr><td><code id="fecr_stanExtra_+3A_nsamples">nsamples</code></td>
<td>
<p>a positive integer. Number of samples for each chain (including burn-in samples).</p>
</td></tr>
<tr><td><code id="fecr_stanExtra_+3A_nburnin">nburnin</code></td>
<td>
<p>a positive integer. Number of burn-in samples.</p>
</td></tr>
<tr><td><code id="fecr_stanExtra_+3A_thinning">thinning</code></td>
<td>
<p>a positive integer. Thinning parameter, i.e. the period for saving samples.</p>
</td></tr>
<tr><td><code id="fecr_stanExtra_+3A_nchain">nchain</code></td>
<td>
<p>a positive integer. Number of chains.</p>
</td></tr>
<tr><td><code id="fecr_stanExtra_+3A_ncore">ncore</code></td>
<td>
<p>a positive integer. Number of cores to use when executing the chains in parallel.</p>
</td></tr>
<tr><td><code id="fecr_stanExtra_+3A_adaptdelta">adaptDelta</code></td>
<td>
<p>numeric. The target acceptance rate, a numeric value between 0 and 1.</p>
</td></tr>
<tr><td><code id="fecr_stanExtra_+3A_verbose">verbose</code></td>
<td>
<p>logical. If TRUE, prints progress and debugging information.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If  <code>modelName</code> is one of c(&quot;Po&quot;, &quot;UPo&quot;, &quot;ZIPo&quot;, &quot;ZIUPo&quot;), then outlier-adjusted models are used. 
</p>

<ul>
<li><p> In paired models, outliers are those counts with postFEC &gt; preFEC. Outlier weights are assigned as the inverse of postFEC/preFEC,
</p>
</li>
<li><p> In unpaired models, outliers are those counts with postFEC greater than the 95th percentile of a Poisson distribution, where the Poisson mean is computed based on the mean of postFEC excluding postFEC &gt; Q3 + 1.5*IQR. Q3 is the 75th percentile and IQR is the interquartile range. The lowest outlier weight is assigned as 0.01, and other outliers assigned proportionally.
</p>
</li>
<li><p> In both cases, non-outliers are assigned with outlier weight = 1.
</p>
</li></ul>
 
<p>The first time each model is applied, it can take up to 20 seconds for Stan to compile the model. 
</p>
<p>The default number of samples per chain is 2000, with 1000 burn-in samples. Normally this is sufficient in Stan. If the chains do not converge, one should tune the MCMC parameters until convergence is reached to ensure reliable results.
</p>


<h3>Value</h3>

<p>Prints out the posterior summary of <code>FECR</code> as the reduction, <code>meanEPG.untreated</code> as the mean pre-treatment epg, and <code>meanEPG.treated</code> as the mean after-treatment epg. The posterior summary contains the mean, standard deviation (sd), 2.5%,  50% and 97.5% percentiles, the 95% highest posterior density interval (HPDLow95 and HPDHigh95) and the posterior mode. 
</p>
<p>The returned value is a list that consists of:
</p>
<table>
<tr><td><code>stan.model</code></td>
<td>
<p>an object of class <code><a href="rstan.html#topic+stanmodel-class">stanmodel-class</a></code> that was used</p>
</td></tr>
<tr><td><code>stan.samples</code></td>
<td>
<p>an object of S4 class <code><a href="rstan.html#topic+stanfit">stanfit</a></code> representing the fitted results</p>
</td></tr>
<tr><td><code>posterior.summary</code></td>
<td>
<p>a data.frame that is the same as the printed posterior summary. Not available for custom models.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Craig Wang
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(eggCountsExtra)
data(epgs) ## load sample data

## apply paired model with outliers 
model1 &lt;- fecr_stanExtra(epgs$before, epgs$after, rawCounts=FALSE, 
         preCF=10, modelName = "Po")
samples &lt;- stan2mcmc(model1$stan.samples)
fecr_probs(model1$stan.samples, threshold = 0.99)

## apply a simple custom model
code &lt;- "data{
  int J; // number of animals
  int y_before[J]; // after treatment McMaster count
  int y_after[J]; // before treatment McMaster count
}
parameters{
  real&lt;lower=0&gt; mu;
  real&lt;lower=0,upper=1&gt; delta;
}
model{
  mu ~ gamma(1,0.001);
  delta ~ beta(1,1);
  y_before ~ poisson(mu);
  y_after ~ poisson(mu*delta);
}"

dat &lt;- list(J = nrow(epgs), y_before = epgs$before,
            y_after = epgs$after)
model2 &lt;- fecr_stanExtra(modelCode = code, modelData = dat)

## End(Not run)</code></pre>

<hr>
<h2 id='fecr_stanSimple'>Model the reduction of faecal egg count using a simple Bayesian model</h2><span id='topic+fecr_stanSimple'></span>

<h3>Description</h3>

<p>Models the reduction in faecal egg counts with a simple Bayesian model formulation. The model is for paired design only, and it assumes Poisson distribution for the observed egg counts.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fecr_stanSimple(preFEC, postFEC, rawCounts = FALSE, 
  preCF = 50, postCF = preCF, muPrior, deltaPrior, 
  nsamples = 2000, nburnin = 1000, thinning = 1, nchain = 2, 
  ncore = 1, adaptDelta = 0.95, saveAll = FALSE, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fecr_stanSimple_+3A_prefec">preFEC</code></td>
<td>
<p>numeric vector. Pre-treatment faecal egg counts.</p>
</td></tr>
<tr><td><code id="fecr_stanSimple_+3A_postfec">postFEC</code></td>
<td>
<p>numeric vector. Post-treatment faecal egg counts.</p>
</td></tr>
<tr><td><code id="fecr_stanSimple_+3A_rawcounts">rawCounts</code></td>
<td>
<p>logical. If TRUE, <code>preFEC</code> and <code>postFEC</code> correspond to raw counts
(as counted on equipment). Otherwise they correspond to calculated epgs (raw counts times correction factor).
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="fecr_stanSimple_+3A_precf">preCF</code></td>
<td>
<p>positive integer or vector of positive integers. Pre-treatment correction factor(s).</p>
</td></tr>
<tr><td><code id="fecr_stanSimple_+3A_postcf">postCF</code></td>
<td>
<p>positive integer or vector of positive integers. Post-treatment correction factor(s).</p>
</td></tr>
<tr><td><code id="fecr_stanSimple_+3A_muprior">muPrior</code></td>
<td>
<p>named list. Prior for the group mean epg parameter <code class="reqn">\mu</code>. The default prior is <code>list(priorDist = "gamma",hyperpars=c(1,0.001))</code>, i.e. a gamma distribution with shape 1 and rate 0.001, its 90% probability mass lies between 51 and 2996.</p>
</td></tr>
<tr><td><code id="fecr_stanSimple_+3A_deltaprior">deltaPrior</code></td>
<td>
<p>named list. Prior for the reduction parameter <code class="reqn">\delta</code>. The default prior is <code>list(priorDist = "beta",hyperpars=c(1,1))</code>, i.e. a uniform prior between 0 and 1.</p>
</td></tr>
<tr><td><code id="fecr_stanSimple_+3A_nsamples">nsamples</code></td>
<td>
<p>a positive integer. Number of samples for each chain (including burn-in samples).</p>
</td></tr>
<tr><td><code id="fecr_stanSimple_+3A_nburnin">nburnin</code></td>
<td>
<p>a positive integer. Number of burn-in samples.</p>
</td></tr>
<tr><td><code id="fecr_stanSimple_+3A_thinning">thinning</code></td>
<td>
<p>a positive integer. Thinning parameter, i.e. the period for saving samples.</p>
</td></tr>
<tr><td><code id="fecr_stanSimple_+3A_nchain">nchain</code></td>
<td>
<p>a positive integer. Number of chains.</p>
</td></tr>
<tr><td><code id="fecr_stanSimple_+3A_ncore">ncore</code></td>
<td>
<p>a positive integer. Number of cores to use when executing the chains in parallel.</p>
</td></tr>
<tr><td><code id="fecr_stanSimple_+3A_adaptdelta">adaptDelta</code></td>
<td>
<p>numeric. The target acceptance rate, a numeric value between 0 and 1.</p>
</td></tr>
<tr><td><code id="fecr_stanSimple_+3A_saveall">saveAll</code></td>
<td>
<p>logical. If TRUE, posterior samples for all parameters are saved in the <code>stanfit</code> object. Otherwise only samples for <code class="reqn">\delta</code> and <code class="reqn">\mu</code> are saved. Default to FALSE.</p>
</td></tr>
<tr><td><code id="fecr_stanSimple_+3A_verbose">verbose</code></td>
<td>
<p>logical. If TRUE, prints progress and debugging information.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The first time each model with non-default priors is applied, it can take up to 20 seconds to compile the model. Currently the function only support prior distributions with two parameters. For a complete list of supported priors and their parameterization, please consult the list of distributions in <a href="https://mc-stan.org/users/documentation/">Stan User Guide</a>. 
</p>
<p>The default number of samples per chain is 2000, with 1000 burn-in samples. Normally this is sufficient in Stan. If the chains do not converge, one should tune the MCMC parameters until convergence is reached to ensure reliable results.
</p>


<h3>Value</h3>

<p>Prints out the posterior summary of <code>FECR</code> as the reduction, <code>meanEPG.untreated</code> as the mean pre-treatment epg, and <code>meanEPG.treated</code> as the mean after-treatment epg. The posterior summary contains the mean, standard deviation (sd), 2.5%,  50% and 97.5% percentiles, the 95% highest posterior density interval (HPDLow95 and HPDHigh95) and the posterior mode. 
</p>
<p>NOTE: we recommend to use the 95% HPD interval and the mode for further statistical analysis.
</p>
<p>The returned value is a list that consists of:
</p>
<table>
<tr><td><code>stan.samples</code></td>
<td>
<p>an object of S4 class <code><a href="rstan.html#topic+stanfit">stanfit</a></code> representing the fitted results</p>
</td></tr>
<tr><td><code>posterior.summary</code></td>
<td>
<p>A data.frame that is the same as the printed posterior summary</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Tea Isler <br />
Craig Wang 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+simData2s">simData2s</a></code> for simulating faecal egg counts data with two samples 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## load sample data
data(epgs)

## apply paired model with individual efficacy
model &lt;- fecr_stanSimple(epgs$before, epgs$after, 
            rawCounts = FALSE, preCF = 10)
samples &lt;- stan2mcmc(model$stan.samples)
</code></pre>

<hr>
<h2 id='fecrtCI'>Compute standard FECRT according to WAAVP guidelines</h2><span id='topic+fecrtCI'></span>

<h3>Description</h3>

<p>Computes the standard Faecal Egg Count Reduction Test together with approximate confidence interval according to the WAAVP guidelines (Coles et al., 1992, 2006). The function also returns bootstrap confidence intervals.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fecrtCI(epg1, epg2, paired = FALSE, alpha = 0.05, R = 1999)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fecrtCI_+3A_epg1">epg1</code></td>
<td>
<p>numeric vector. Faecal egg counts in untreated animals.</p>
</td></tr>
<tr><td><code id="fecrtCI_+3A_epg2">epg2</code></td>
<td>
<p>numeric vector. Faecal egg counts in treated animals.</p>
</td></tr>
<tr><td><code id="fecrtCI_+3A_paired">paired</code></td>
<td>
<p>logical. If TRUE, indicates samples are paired. Otherwise samples are unpaired.</p>
</td></tr>
<tr><td><code id="fecrtCI_+3A_alpha">alpha</code></td>
<td>
<p>numeric. Confidence level of the interval.</p>
</td></tr>
<tr><td><code id="fecrtCI_+3A_r">R</code></td>
<td>
<p>numeric. Number of bootstrap replicates.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with
</p>
<table>
<tr><td><code>estimate</code></td>
<td>
<p>estimated percentage reduction in mean epg</p>
</td></tr>
<tr><td><code>bootCI</code></td>
<td>
<p>bootstrap confidence interval</p>
</td></tr>
<tr><td><code>approxCI</code></td>
<td>
<p>approximate confidence interval</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Michaela Paul
</p>


<h3>References</h3>

<p>Coles GC, Bauer C, Borgsteede FHM, Geerts S, Klei TR, Taylor MA and Waller, PJ (1992).
World Association for the Advancement of Veterinary Parasitology (WAAVP) methods for the detection of anthelmintic resistance in nematodes of veterinary importance, Veterinary Parasitology, 44:35-44.
</p>
<p>Coles GC, Jackson F, Pomroy WE, Prichard RK, von Samson-Himmelstjerna G, Silvestre A, Taylor MA and Vercruysse J (2006). 
The detection of anthelmintic resistance in nematodes of veterinary	importance, Veterinary Parasitology, 136:167-185.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(epgs)
fecrtCI(epgs$before, epgs$after, paired = TRUE)
</code></pre>

<hr>
<h2 id='getPrior_delta'>Get prior parameters from Beta distribution</h2><span id='topic+getPrior_delta'></span>

<h3>Description</h3>

<p>Compute the shape parameters from a Beta distribution for <code class="reqn">\delta</code> based on some prior belief.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getPrior_delta(lower, upper, p = 0.7, mode, conc, plot = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getPrior_delta_+3A_lower">lower</code>, <code id="getPrior_delta_+3A_upper">upper</code>, <code id="getPrior_delta_+3A_p">p</code></td>
<td>
<p>numeric. Prior belief about the reduction. There is <code>p</code> probability that the reduction is between <code>lower</code> and <code>upper</code>. Not used if <code>mode</code> and <code>conc</code> are supplied.</p>
</td></tr>
<tr><td><code id="getPrior_delta_+3A_mode">mode</code>, <code id="getPrior_delta_+3A_conc">conc</code></td>
<td>
<p>numeric. Prior belief about the reduction. The mode and concentration parameters of a beta distribution. Higher concentration indicates smaller variance. Not used if <code>lower</code> and <code>upper</code> thresholds are supplied.</p>
</td></tr>
<tr><td><code id="getPrior_delta_+3A_plot">plot</code></td>
<td>
<p>logical. If TRUE, the prior distribution is plotted after parameters are found.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code><a href="rootSolve.html#topic+multiroot">multiroot</a></code> function from <strong>rootSolve</strong> package is used to compute the parameters.
</p>


<h3>Value</h3>

<p>Returns Beta prior parameters for <code class="reqn">\delta</code> and the printed argument to use in a <code><a href="#topic+fecr_stan">fecr_stan</a>()</code> or a <code><a href="#topic+fec_stan">fec_stan</a>()</code> function call.
</p>


<h3>Author(s)</h3>

<p>Tea Isler <br />
Craig Wang 
</p>


<h3>Examples</h3>

<pre><code class='language-R'># there is 80% probability that the reduction is between 60% and 90%
getPrior_delta(lower = 0.6, upper = 0.9, p = 0.8)
</code></pre>

<hr>
<h2 id='getPrior_mu'>Get prior parameters from Gamma distribution</h2><span id='topic+getPrior_mu'></span>

<h3>Description</h3>

<p>Compute the shape and rate parameters from a Gamma distribution for <code class="reqn">\mu</code> based on some prior belief about its cumulative distribution function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getPrior_mu(x, px, y, py, s1 = 1, s2 = 0.001, plot = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getPrior_mu_+3A_x">x</code>, <code id="getPrior_mu_+3A_px">px</code>, <code id="getPrior_mu_+3A_y">y</code>, <code id="getPrior_mu_+3A_py">py</code></td>
<td>
<p>numeric. Threshold of some prior belief about true epg. There is <code>px</code> probability that the true epg is below <code>x</code>, and there is <code>py</code> probability that the true epg is below <code>y</code>.</p>
</td></tr>
<tr><td><code id="getPrior_mu_+3A_s1">s1</code>, <code id="getPrior_mu_+3A_s2">s2</code></td>
<td>
<p>numeric. Starting values.</p>
</td></tr>
<tr><td><code id="getPrior_mu_+3A_plot">plot</code></td>
<td>
<p>logical. If TRUE, the prior distribution is plotted after parameters are found.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>multiroot</code> function from <strong>rootSolve</strong> package is used to compute the parameters.
</p>


<h3>Value</h3>

<p>Returns Gamma prior parameters for <code class="reqn">\mu</code> and the printed argument to use in a <code><a href="#topic+fecr_stan">fecr_stan</a>()</code> or a <code><a href="#topic+fec_stan">fec_stan</a>()</code> function call.
</p>


<h3>Author(s)</h3>

<p>Tea Isler <br />
Craig Wang 
</p>


<h3>Examples</h3>

<pre><code class='language-R'># there is 30% probability that the mean epg is less than 200 
# and 80% probability that the mean epg is less than 500
getPrior_mu(x = 200, px = 0.3, y = 500, py = 0.8)
</code></pre>

<hr>
<h2 id='plotCounts'>Plot faecal egg count data</h2><span id='topic+plotCounts'></span>

<h3>Description</h3>

<p>Plot egg count data to reflect changes between before and after treatment.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotCounts(data, paired = TRUE, points = TRUE, 
    points.method = "jitter",  xlabel = "", 
    ylabel = "Faecal egg counts [epg]", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotCounts_+3A_data">data</code></td>
<td>
<p>a data.frame with two columns, the first column is before treatment counts, the second column is after treatment counts.</p>
</td></tr>
<tr><td><code id="plotCounts_+3A_paired">paired</code></td>
<td>
<p>logical. If TRUE, uses the plot for the paired design. Otherwise uses the plot for the unpaired design.</p>
</td></tr>
<tr><td><code id="plotCounts_+3A_points">points</code></td>
<td>
<p>logical. If TRUE, add individual points for unpaired plot. Not used if <code>paired = TRUE</code>.</p>
</td></tr>
<tr><td><code id="plotCounts_+3A_points.method">points.method</code></td>
<td>
<p>string. It is used to separate coincident points if <code>points = TRUE</code>. One of &ldquo;jitter&rdquo;, &ldquo;stack&rdquo; or &ldquo;overplot&rdquo;.</p>
</td></tr>
<tr><td><code id="plotCounts_+3A_xlabel">xlabel</code></td>
<td>
<p>string. Label of x-axis.</p>
</td></tr>
<tr><td><code id="plotCounts_+3A_ylabel">ylabel</code></td>
<td>
<p>String. Label of y-axis.</p>
</td></tr>
<tr><td><code id="plotCounts_+3A_...">...</code></td>
<td>
<p>Additional arguments for function <code><a href="lattice.html#topic+xyplot">xyplot</a></code> if paired is TRUE, for function <code><a href="graphics.html#topic+boxplot">boxplot</a></code> otherwise.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For paired data, a xyplot is used. For unpiared data, a grouped boxplot is used.
</p>


<h3>Value</h3>

<p>A plot is drawn.
</p>


<h3>Author(s)</h3>

<p>Craig Wang
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(epgs)
plotCounts(epgs[,c("before","after")], paired = TRUE)
</code></pre>

<hr>
<h2 id='simData1s'>Simulate faecal egg count data (1-sample situation)</h2><span id='topic+simData1s'></span>

<h3>Description</h3>

<p>Simulates (zero-inflated) egg count data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simData1s(n = 10, mean = 500, kappa = 0.5, phi = 1, 
  f = 50, rounding = TRUE, seed = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simData1s_+3A_n">n</code></td>
<td>
<p>positive integer. Sample size.</p>
</td></tr>
<tr><td><code id="simData1s_+3A_mean">mean</code></td>
<td>
<p>numeric. True number of eggs per gram (epg).</p>
</td></tr>
<tr><td><code id="simData1s_+3A_kappa">kappa</code></td>
<td>
<p>numeric. Overdispersion parameter, <code class="reqn">\kappa \to \infty</code> corresponds to Poisson distribution.</p>
</td></tr>
<tr><td><code id="simData1s_+3A_phi">phi</code></td>
<td>
<p>numeric. Prevalence, i.e. proportion of infected animals, between 0 and 1.</p>
</td></tr>
<tr><td><code id="simData1s_+3A_f">f</code></td>
<td>
<p>positive integer. Correction factor of the egg counting technique, either an integer or a vector of integers with length <code>n</code>.</p>
</td></tr>
<tr><td><code id="simData1s_+3A_rounding">rounding</code></td>
<td>
<p>logical. If TRUE, the Poisson mean for the raw counts is rounded. The rounding applies since the mean epg is frequently reported as an integer value. For more information, see Details.</p>
</td></tr>
<tr><td><code id="simData1s_+3A_seed">seed</code></td>
<td>
<p>integer. Random seed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In the simulation of raw (<code>master</code>) counts, it follows a Poisson distribution with some mean. The mean is frequently rounded down if it has a very low value and <code>rounding = TRUE</code>, hence there expects to be a bias overall when <code class="reqn">\mu</code> &lt; 150. Set <code>rounding = FALSE</code> for not to have any bias in the simulated counts.
</p>


<h3>Value</h3>

<p>A data.frame with three columns, namely the observed epg (<code>obs</code>), actual number of eggs counted (<code>master</code>) and
true epg in the sample (<code>true</code>).
</p>


<h3>Author(s)</h3>

<p>Craig Wang <br />
Michaela Paul 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fec_stan">fec_stan</a></code> for analyzing faecal egg count data with one sample 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>fec &lt;- simData1s(n = 10, mean = 500, 
          kappa = 0.5, phi = 0.7)
</code></pre>

<hr>
<h2 id='simData2s'>Simulate faecal egg count data (2-sample situation)</h2><span id='topic+simData2s'></span>

<h3>Description</h3>

<p>Generates two samples of (zero-inflated) egg count data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simData2s(n = 10, preMean = 500, delta = 0.1, kappa = 0.5, 
  deltaShape = NULL, phiPre = 1, phiPost = phiPre, f = 50, 
  paired = TRUE, rounding = TRUE, seed = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simData2s_+3A_n">n</code></td>
<td>
<p>positive integer. Sample size.</p>
</td></tr>
<tr><td><code id="simData2s_+3A_premean">preMean</code></td>
<td>
<p>numeric. True pre-treatment epg.</p>
</td></tr>
<tr><td><code id="simData2s_+3A_delta">delta</code></td>
<td>
<p>numeric. Proportion of epg left after treatment, between 0 and 1. 1 - <code class="reqn">\delta</code> is reduction in mean after treatment, <code>delta</code> = 0.1 indicates a 90% reduction.</p>
</td></tr>
<tr><td><code id="simData2s_+3A_kappa">kappa</code></td>
<td>
<p>numeric. Overdispersion parameter, <code class="reqn">\kappa \to \infty</code> corresponds to Poisson distribution.</p>
</td></tr>
<tr><td><code id="simData2s_+3A_deltashape">deltaShape</code></td>
<td>
<p>numeric. Shape parameter for the distribution of reductions. If NULL, the same reduction is applied to the latent true epg of each animal.</p>
</td></tr>
<tr><td><code id="simData2s_+3A_phipre">phiPre</code></td>
<td>
<p>numeric. Pre-treatment prevalence (i.e. proportion of infected animals), between 0 and 1.</p>
</td></tr>
<tr><td><code id="simData2s_+3A_phipost">phiPost</code></td>
<td>
<p>numeric. Post-treatment prevalence, between 0 and 1.</p>
</td></tr>
<tr><td><code id="simData2s_+3A_f">f</code></td>
<td>
<p>integer or vector of integers. Correction factor of the egg counting technique</p>
</td></tr>
<tr><td><code id="simData2s_+3A_paired">paired</code></td>
<td>
<p>logical. If TRUE, paired samples are simulated. Otherwise unpaired samples are simulated.</p>
</td></tr>
<tr><td><code id="simData2s_+3A_rounding">rounding</code></td>
<td>
<p>logical. If TRUE, the Poisson mean for the raw counts is rounded. The rounding applies since the mean epg is frequently reported as an integer value. For more information, see Details.</p>
</td></tr>
<tr><td><code id="simData2s_+3A_seed">seed</code></td>
<td>
<p>an integer that will be used in a call to set.seed before simulation. If NULL, a random seed is allocated.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In the simulation of raw (<code>master</code>) counts, it follows a Poisson distribution with some mean. The mean is frequently rounded down if it has a very low value and <code>rounding = TRUE</code>, there expects to be some bias in the mean reduction when <code class="reqn">\mu</code> &lt; 150 and <code class="reqn">\delta</code> &lt; 0.1. Set <code>rounding = FALSE</code> for not to have any bias.
</p>


<h3>Value</h3>

<p>A data.frame with six columns, namely the observed epg (<code>obs</code>),
actual number of eggs counted (<code>master</code>) and true epg in the sample (<code>true</code>) for both pre- and post- treatment.
</p>


<h3>Author(s)</h3>

<p>Craig Wang <br />
Michaela Paul 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fecr_stan">fecr_stan</a></code> for analyzing faecal egg count data with two samples 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>fec &lt;- simData2s(n = 10, preMean = 500, delta = 0.1, kappa = 0.5)

## show the bias when the true reduction should be 95%
fec &lt;- simData2s(n = 1e5, preMean = 150, delta = 0.05, 
          kappa = 0.5, seed = 1)
1 - mean(fec$masterPost)/mean(fec$masterPre)
## without bias
fec &lt;- simData2s(n = 1e5, preMean = 150, delta = 0.05, 
          kappa = 0.5, seed = 1, rounding = FALSE)
1 - mean(fec$masterPost)/mean(fec$masterPre)
</code></pre>

<hr>
<h2 id='stan2mcmc'>Convert a Stanfit object to a MCMC object</h2><span id='topic+stan2mcmc'></span>

<h3>Description</h3>

<p>Converts a <code>stanfit</code> object into a <code>mcmc</code> object for easier analysis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stan2mcmc(stanFit)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stan2mcmc_+3A_stanfit">stanFit</code></td>
<td>
<p>a <code><a href="rstan.html#topic+stanfit">stanfit</a></code> object from the output of either <code>fecr_stan()</code> or <code>fec_stan()</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The output can be analyzed as a <code>mcmc</code> object with the functions from the <code>coda</code> package. NOTE: The resulting MCMC object does not contain warm-up samples and is already thinned.  
</p>


<h3>Value</h3>

<p>A MCMC object with a list of relevant parameters.
</p>


<h3>Author(s)</h3>

<p>Craig Wang
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(epgs)

## apply zero-infation model for the paired design 
model &lt;- fecr_stan(epgs$before, epgs$after, rawCounts = FALSE, 
            indEfficacy = FALSE, preCF = 10, 
            paired = TRUE, zeroInflation = TRUE)
samples &lt;- stan2mcmc(model$stan.samples)
summary(samples)
plot(samples)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
