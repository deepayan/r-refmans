<!DOCTYPE html><html><head><title>Help for package DVHmetrics</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {DVHmetrics}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#checkConstraint'><p>Check constraints on dose-volume histograms (DVH)</p></a></li>
<li><a href='#convertDVH'><p>Convert between differential and cumulative DVH</p></a></li>
<li><a href='#convertDVHsmooth'><p>Convert between differential and cumulative DVH</p></a></li>
<li><a href='#dataConstr'><p>Constraint data frame</p></a></li>
<li><a href='#dataMZ'><p>DVH data from 3 patients</p></a></li>
<li><a href='#DVHmetrics-package'><p>Analyze Dose-Volume Histograms and Check Constraints</p></a></li>
<li><a href='#getBED'><p>Calculate biologically effective dose (BED)</p></a></li>
<li><a href='#getDMEAN'><p>DMEAN and other dose metrics</p></a></li>
<li><a href='#getEQD2'><p>2Gy fractions biologically equivalent dose (EQD2)</p></a></li>
<li><a href='#getEUD'><p>Generalized equivalent uniform dose (gEUD)</p></a></li>
<li><a href='#getIsoEffD'><p>Isoeffective dose calculation</p></a></li>
<li><a href='#getMeanDVH'><p>Point-wise mean DVH with point-wise SDs</p></a></li>
<li><a href='#getMetric'><p>Calculate dose-volume-histogram metrics</p></a></li>
<li><a href='#getNTCP'><p>Normal tissue complication probability (NTCP)</p></a></li>
<li><a href='#getTCP'><p>Tumor control probability (TCP)</p></a></li>
<li><a href='#mergeDVH'><p>Merge existing DVH objects</p></a></li>
<li><a href='#print.DVHs'><p>Print basic information about one or more DVHs</p></a></li>
<li><a href='#readConstraint'><p>Read constraint definitions from text file</p></a></li>
<li><a href='#readDVH'><p>Read DVH text files</p></a></li>
<li><a href='#runGUI'><p>Open web-based GUI in browser</p></a></li>
<li><a href='#saveConstraint'><p>Save constraint result to file</p></a></li>
<li><a href='#saveDVH'><p>Save DVH diagram to file</p></a></li>
<li><a href='#saveMetric'><p>Save DVH metrics to file</p></a></li>
<li><a href='#showConstraint'><p>Display constraints for cumulative dose-volume histograms</p></a></li>
<li><a href='#showDVH'><p>Display dose volume histograms</p></a></li>
<li><a href='#showMeanDVH'><p>Show average dose volume histograms</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Analyze Dose-Volume Histograms and Check Constraints</td>
</tr>
<tr>
<td>Version:</td>
<td>0.4.2</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-03-23</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>ggplot2, grid, shiny, DT, KernSmooth, stats, utils, reshape2</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, markdown, bs4Dash</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>LazyData:</td>
<td>yes</td>
</tr>
<tr>
<td>Description:</td>
<td>Functionality for analyzing dose-volume histograms (DVH)
        in radiation oncology: Read DVH text files, calculate DVH
        metrics as well as generalized equivalent uniform dose (gEUD),
        biologically effective dose (BED), equivalent dose in 2 Gy
        fractions (EQD2), normal tissue complication probability
        (NTCP), and tumor control probability (TCP). Show DVH
        diagrams, check and visualize quality assurance constraints
        for the DVH. Includes web-based graphical user interface.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/dwoll/DVHmetrics/">https://github.com/dwoll/DVHmetrics/</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-03-23 10:37:36 UTC; Daniel</td>
</tr>
<tr>
<td>Author:</td>
<td>Daniel Wollschlaeger [aut, cre],
  Heiko Karle [aut],
  Heinz Schmidberger [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Daniel Wollschlaeger &lt;wollschlaeger@uni-mainz.de&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-03-23 11:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='checkConstraint'>Check constraints on dose-volume histograms (DVH)</h2><span id='topic+checkConstraint'></span><span id='topic+checkConstraint.DVHs'></span><span id='topic+checkConstraint.DVHLst'></span><span id='topic+checkConstraint.DVHLstLst'></span>

<h3>Description</h3>

<p>Simultaneously checks one or more quality assurance constraints on one or more DVHs. Reports compliance with each constraint as well as observed difference between linearly interpolated DVH and the given constraints in terms of (relative) dose, (relative) volume, and (relative) minimal Euclidean distance.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>checkConstraint(x, constr, byPat=TRUE, semSign=FALSE,
                sortBy=c("none", "observed", "compliance", "structure",
                         "constraint", "patID", "deltaV", "deltaD",
                         "dstMin", "dstMinRel"),
                interp=c("linear", "spline", "smooth"), ...)

## S3 method for class 'DVHs'
checkConstraint(x, constr, byPat=TRUE, semSign=FALSE,
                sortBy=c("none", "observed", "compliance", "structure",
                         "constraint", "patID", "deltaV", "deltaD",
                         "dstMin", "dstMinRel"),
                interp=c("linear", "spline", "smooth"), ...)

## S3 method for class 'DVHLst'
checkConstraint(x, constr, byPat=TRUE, semSign=FALSE,
                sortBy=c("none", "observed", "compliance", "structure",
                         "constraint", "patID", "deltaV", "deltaD",
                         "dstMin", "dstMinRel"),
                interp=c("linear", "spline", "smooth"), ...)

## S3 method for class 'DVHLstLst'
checkConstraint(x, constr, byPat=TRUE, semSign=FALSE,
                sortBy=c("none", "observed", "compliance", "structure",
                         "constraint", "patID", "deltaV", "deltaD",
                         "dstMin", "dstMinRel"),
                interp=c("linear", "spline", "smooth"), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="checkConstraint_+3A_x">x</code></td>
<td>
<p>A single DVH (object of class <code>DVHs</code>), multiple DVHs from one patient/structure (object of class <code>DVHLst</code>), or multiple DVHs from many patients/structures (object of class <code>DVHLstLst</code>). See <code><a href="#topic+readDVH">readDVH</a></code>.</p>
</td></tr>
<tr><td><code id="checkConstraint_+3A_constr">constr</code></td>
<td>
<p>One or more constraints - given as a <code>character</code> vector or as a <code>data.frame</code>. See Details.</p>
</td></tr>
<tr><td><code id="checkConstraint_+3A_bypat">byPat</code></td>
<td>
<p><code>logical</code>. Relevant if multiple DVHs are given. If <code>x</code> has class <code>DVHLst</code>: <code>byPat=TRUE</code> means that the DVHs are for one patient with multiple structures. <code>byPat=FALSE</code> means that the DVHs are for one structure from multiple patients. If <code>x</code> has class <code>DVHLstLst</code>: <code>byPat=TRUE</code> means that the DVHs are for multiple patients (list components of <code>x</code>) with multiple structures. <code>byPat=FALSE</code> means that the DVHs are for multiple structures (list components of <code>x</code>) from multiple patients.</p>
</td></tr>
<tr><td><code id="checkConstraint_+3A_semsign">semSign</code></td>
<td>
<p><code>logical</code>. Meaning of the sign of the observed dose/volume differences between DVHs and constraints. <code>semSign=TRUE</code> means that negative differences indicate constraint compliance, positive differences indicate constraint violations. With <code>semSign=FALSE</code>, the algebraic differences are returned as is.</p>
</td></tr>
<tr><td><code id="checkConstraint_+3A_sortby">sortBy</code></td>
<td>
<p><code>character</code> vector. Sorting criteria for the output data frame.</p>
</td></tr>
<tr><td><code id="checkConstraint_+3A_interp">interp</code></td>
<td>
<p><code>character</code>. Method of interpolation between DVH points: Linear interpolation using <code><a href="stats.html#topic+approxfun">approx</a></code>, monotone Hermite spline interpolation using <code><a href="stats.html#topic+splinefun">spline</a></code>, or local polynomial regression using <code><a href="KernSmooth.html#topic+locpoly">locpoly</a></code> with kernel bandwidth chosen by the direct plug-in method using <code><a href="KernSmooth.html#topic+dpill">dpill</a></code>.</p>
</td></tr>
<tr><td><code id="checkConstraint_+3A_...">...</code></td>
<td>
<p>Additional parameters passed to <code><a href="#topic+getMetric">getMetric</a></code>. Use for constraints on EUD (see <code><a href="#topic+getEUD">getEUD</a></code> for parameter names), TCP (see <code><a href="#topic+getTCP">getTCP</a></code>), and NTCP (see <code><a href="#topic+getNTCP">getNTCP</a></code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A DVH constraint is a character string that consists of three parts: The DVH metric, the comparison operator (<code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code>), and the reference value together with the measurement unit. See <code><a href="#topic+getMetric">getMetric</a></code> for defining a DVH metric, as well as for possible measurement units for dose and volume. For constraints involving the relative dose, the DVH must contain the prescription dose.
</p>
<p>Some example constraints are <code>"V10Gy &gt; 80%"</code> (more than 80% of the structure should have received 10Gy), <code>"V20% &lt; 10CC"</code> (less than 10cm^3 of the structure should have received 20% of the prescription dose), or <code>"D10CC &gt; 500cGy"</code> (The &quot;hottest&quot; 10cm^3 of the structure should have received more than 500cGy).
</p>
<p>For constraints on <code>DEUD</code>, <code>DNTCP</code> and <code>DTCP</code> (see <code><a href="#topic+getMetric">getMetric</a></code>), the reference measurement unit must be <code>Gy</code>, <code>cGy</code>, even though NTCP and TCP are probabilities. Example: <code>"DNTCP &lt; 0.5Gy"</code>.
</p>
<p>A DVH constraint can apply to a specific patient or to all patients, and to a specific structure or to all structures.
</p>

<ul>
<li><p> If constraints apply to all patients/structures in <code>x</code>, <code>constr</code> can be a <code>character</code> vector with elements like the examples above.
</p>
</li>
<li><p> If constraints apply only to some patients/structures, <code>constr</code> must be a data frame with variables <code>constraint</code>, <code>patID</code> and <code>structure</code>. Each row then defines one constraint and its scope: <code>constraint</code> must be a character string with one constraint definition as in the examples above. <code>patID</code> must be either a character string with a valid patient ID or <code>"*"</code> if the the constraint applies to all patients. <code>structure</code> must be either a character string with a valid structure or <code>"*"</code> if the the constraint applies to all structures. If variable <code>patID</code> is missing from the data frame, the constraints apply to all available patients. If variable <code>structure</code> is missing from the data frame, the constraints apply to all available structures. See <code><a href="#topic+readConstraint">readConstraint</a></code> for reading appropriate constraint <code>data.frames</code> from external text files.
</p>
</li></ul>

<p>For calculating the minimal Euclidean distance between the constraint point and the DVH, the constraint point is orthogonally projected onto each DVH segment between (interpolated) DVH nodes. The relative Euclidean distance is the minimum of these distances divided by the distance of the constraint point to the closer one of both axes (dose and volume).
</p>
<p>If volume or dose values outside the range of possible values for a structure are requested, metrics cannot be calculated, and the result will be <code>NA</code> with a warning.
</p>


<h3>Value</h3>

<p>A data frame with details on constraint compliance / violation.
</p>
<table>
<tr><td><code>patID</code></td>
<td>
<p>Patient ID</p>
</td></tr>
<tr><td><code>structure</code></td>
<td>
<p>Structure</p>
</td></tr>
<tr><td><code>constraint</code></td>
<td>
<p>The checked constraint</p>
</td></tr>
<tr><td><code>observed</code></td>
<td>
<p>The observed value for the metric given in the constraint</p>
</td></tr>
<tr><td><code>compliance</code></td>
<td>
<p>Does the DVH satisfy the constraint?</p>
</td></tr>
<tr><td><code>deltaV</code></td>
<td>
<p>Volume difference between constraint and observed DVH (for the constraint dose) in measurement unit specified by constraint</p>
</td></tr>
<tr><td><code>deltaVpc</code></td>
<td>
<p>Percent volume difference between constraint and observed DVH (for the constraint dose) relative to constraint volume</p>
</td></tr>
<tr><td><code>deltaD</code></td>
<td>
<p>Dose difference between constraint and observed DVH (for the constraint volume) in measurement unit specified by constraint</p>
</td></tr>
<tr><td><code>deltaDpc</code></td>
<td>
<p>Percent dose difference between constraint and observed DVH (for the constraint volume) relative to constraint dose</p>
</td></tr>
<tr><td><code>dstMin</code></td>
<td>
<p>Minimal Euclidean distance between constraint and the cumulative DVH, using linear interpolation</p>
</td></tr>
<tr><td><code>ptMinD</code></td>
<td>
<p>Dose coordinate of closest point on cumulative DVH to constraint</p>
</td></tr>
<tr><td><code>ptMinV</code></td>
<td>
<p>Volume coordinate of closest point on cumulative DVH to constraint</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+getMetric">getMetric</a></code>,
<code><a href="#topic+getEUD">getEUD</a></code>,
<code><a href="#topic+getNTCP">getNTCP</a></code>,
<code><a href="#topic+getTCP">getTCP</a></code>,
<code><a href="#topic+readConstraint">readConstraint</a></code>,
<code><a href="#topic+saveConstraint">saveConstraint</a></code>,
<code><a href="#topic+showConstraint">showConstraint</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>res &lt;- checkConstraint(dataMZ, c("D10CC &lt; 10Gy", "V20Gy &lt; 20%"))
head(res)

# define constraints
constr &lt;- data.frame(
    patID=c("P123", "P234"),
    structure=c("HEART", "*"),
    constraint=c("D1CC &lt; 20Gy", "V10% &gt; 8CC"),
    stringsAsFactors=FALSE)       # this is important
checkConstraint(dataMZ, constr=constr)
</code></pre>

<hr>
<h2 id='convertDVH'>Convert between differential and cumulative DVH</h2><span id='topic+convertDVH'></span><span id='topic+convertDVH.matrix'></span><span id='topic+convertDVH.DVHs'></span><span id='topic+convertDVH.DVHLst'></span><span id='topic+convertDVH.DVHLstLst'></span>

<h3>Description</h3>

<p>Convert between differential and cumulative DVH as well as between dose units.</p>


<h3>Usage</h3>

<pre><code class='language-R'>convertDVH(x, toType=c("asis", "cumulative", "differential"),
           toDoseUnit=c("asis", "GY", "CGY"),
           interp=c("asis", "linear"),
           nodes=NULL, rangeD=NULL, perDose=TRUE)

## S3 method for class 'matrix'
convertDVH(x, toType=c("asis", "cumulative", "differential"),
           toDoseUnit=c("asis", "GY", "CGY"),
           interp=c("asis", "linear"),
           nodes=NULL, rangeD=NULL, perDose=TRUE)

## S3 method for class 'DVHs'
convertDVH(x, toType=c("asis", "cumulative", "differential"),
           toDoseUnit=c("asis", "GY", "CGY"),
           interp=c("asis", "linear"),
           nodes=NULL, rangeD=NULL, perDose=TRUE)

## S3 method for class 'DVHLst'
convertDVH(x, toType=c("asis", "cumulative", "differential"),
           toDoseUnit=c("asis", "GY", "CGY"),
           interp=c("asis", "linear"),
           nodes=NULL, rangeD=NULL, perDose=TRUE)

## S3 method for class 'DVHLstLst'
convertDVH(x, toType=c("asis", "cumulative", "differential"),
           toDoseUnit=c("asis", "GY", "CGY"),
           interp=c("asis", "linear"),
           nodes=NULL, rangeD=NULL, perDose=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="convertDVH_+3A_x">x</code></td>
<td>
<p>One DVH (object of class <code>matrix</code> or <code>DVHs</code>, multiple cumulative DVHs from one patient with multiple structures (object of class <code>DVHLst</code>), or multiple cumulative DVHs from many patients, each with multiple structures (object of class <code>DVHLstLst</code>). See <code><a href="#topic+readDVH">readDVH</a></code>.</p>
</td></tr>
<tr><td><code id="convertDVH_+3A_totype">toType</code></td>
<td>
<p><code>character</code>. Convert the DVH to this type. <code>"asis"</code> keeps the current DVH type.</p>
</td></tr>
<tr><td><code id="convertDVH_+3A_todoseunit">toDoseUnit</code></td>
<td>
<p><code>character</code>. Convert the DVH to this dose unit. <code>"asis"</code> keeps the current dose unit.</p>
</td></tr>
<tr><td><code id="convertDVH_+3A_interp">interp</code></td>
<td>
<p><code>character</code>. Interpolation method for the cumulative DVH. <code>"asis"</code> for no interpolation and <code>"linear"</code> for linear interpolation.</p>
</td></tr>
<tr><td><code id="convertDVH_+3A_nodes">nodes</code></td>
<td>
<p><code>numeric</code>. Minimum number of nodes to use in linear interpolation. Number of available nodes is kept as is for <code>NULL</code> or if larger than <code>nodes</code>.</p>
</td></tr>
<tr><td><code id="convertDVH_+3A_ranged">rangeD</code></td>
<td>
<p><code>numeric</code>. Dose range for linear interpolation method. If <code>NULL</code> it is determined individally for each DVH.</p>
</td></tr>
<tr><td><code id="convertDVH_+3A_perdose">perDose</code></td>
<td>
<p><code>logical</code>. Are the differential DVH volume values per unit dose?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Depending on the input, an object of class <code>matrix</code>, <code>DVHs</code>, <code>DVHLst</code>, or <code>DVHLstLst</code>.</p>


<h3>See Also</h3>

<p><code><a href="#topic+convertDVHsmooth">convertDVHsmooth</a></code>,
<code><a href="#topic+readDVH">readDVH</a></code>,
<code><a href="#topic+showDVH">showDVH</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>res &lt;- convertDVH(dataMZ[[c(1, 1)]],
                  toType="cumulative",
                  toDoseUnit="CGY")
</code></pre>

<hr>
<h2 id='convertDVHsmooth'>Convert between differential and cumulative DVH</h2><span id='topic+convertDVHsmooth'></span><span id='topic+convertDVHsmooth.matrix'></span><span id='topic+convertDVHsmooth.DVHs'></span><span id='topic+convertDVHsmooth.DVHLst'></span><span id='topic+convertDVHsmooth.DVHLstLst'></span>

<h3>Description</h3>

<p>Convert between differential and cumulative DVH as well as between dose units, using smoothng of the differential DVH.</p>


<h3>Usage</h3>

<pre><code class='language-R'>convertDVHsmooth(x,
                 toType=c("asis", "cumulative", "differential"),
                 toDoseUnit=c("asis", "GY", "CGY"),
                 interp=c("asis", "linear", "spline", "ksmooth", "smoothSpl"),
                 nodes=NULL, rangeD=NULL, perDose=TRUE)

## S3 method for class 'matrix'
convertDVHsmooth(x,
                 toType=c("asis", "cumulative", "differential"),
                 toDoseUnit=c("asis", "GY", "CGY"),
                 interp=c("asis", "linear", "spline", "ksmooth", "smoothSpl"),
                 nodes=NULL, rangeD=NULL, perDose=TRUE)

## S3 method for class 'DVHs'
convertDVHsmooth(x,
                 toType=c("asis", "cumulative", "differential"),
                 toDoseUnit=c("asis", "GY", "CGY"),
                 interp=c("asis", "linear", "spline", "ksmooth", "smoothSpl"),
                 nodes=NULL, rangeD=NULL, perDose=TRUE)

## S3 method for class 'DVHLst'
convertDVHsmooth(x,
                 toType=c("asis", "cumulative", "differential"),
                 toDoseUnit=c("asis", "GY", "CGY"),
                 interp=c("asis", "linear", "spline", "ksmooth", "smoothSpl"),
                 nodes=NULL, rangeD=NULL, perDose=TRUE)

## S3 method for class 'DVHLstLst'
convertDVHsmooth(x,
                 toType=c("asis", "cumulative", "differential"),
                 toDoseUnit=c("asis", "GY", "CGY"),
                 interp=c("asis", "linear", "spline", "ksmooth", "smoothSpl"),
                 nodes=NULL, rangeD=NULL, perDose=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="convertDVHsmooth_+3A_x">x</code></td>
<td>
<p>One DVH (object of class <code>matrix</code> or <code>DVHs</code>, multiple cumulative DVHs from one patient with multiple structures (object of class <code>DVHLst</code>), or multiple cumulative DVHs from many patients, each with multiple structures (object of class <code>DVHLstLst</code>). See <code><a href="#topic+readDVH">readDVH</a></code>.</p>
</td></tr>
<tr><td><code id="convertDVHsmooth_+3A_totype">toType</code></td>
<td>
<p><code>character</code>. Convert the DVH to this type. <code>"asis"</code> keeps the current DVH type.</p>
</td></tr>
<tr><td><code id="convertDVHsmooth_+3A_todoseunit">toDoseUnit</code></td>
<td>
<p><code>character</code>. Convert the DVH to this dose unit. <code>"asis"</code> keeps the current dose unit.</p>
</td></tr>
<tr><td><code id="convertDVHsmooth_+3A_interp">interp</code></td>
<td>
<p><code>character</code>. Interpolation method for the differential DVH. <code>"asis"</code> and <code>"linear"</code> for no interpolation. <code>"spline"</code> for spline interpolation using <code><a href="stats.html#topic+splinefun">splinefun</a></code> (<code>"fmm"</code> for differential, <code>"monoH.FC"</code> for cumulative DVHs), <code>"ksmooth"</code> for local polynomial regression using <code><a href="KernSmooth.html#topic+locpoly">locpoly</a></code> with kernel bandwidth chosen by the direct plug-in method using <code><a href="KernSmooth.html#topic+dpill">dpill</a></code>, <code>"smoothSpl"</code> for a smoothing spline using <code><a href="stats.html#topic+smooth.spline">smooth.spline</a></code>, with the smoothing parameter chosen by generalized crossvalidation.</p>
</td></tr>
<tr><td><code id="convertDVHsmooth_+3A_nodes">nodes</code></td>
<td>
<p><code>numeric</code>. Minimum number of nodes to use in interpolation for method <code>"ksmooth"</code>. Number of available nodes is kept as is for <code>NULL</code> or if larger than <code>nodes</code>.</p>
</td></tr>
<tr><td><code id="convertDVHsmooth_+3A_ranged">rangeD</code></td>
<td>
<p><code>numeric</code>. Dose range for interpolation methods <code>"linear"</code>, <code>"spline"</code>, <code>"smoothSpl"</code>. If <code>NULL</code> it is determined individally for each DVH.</p>
</td></tr>
<tr><td><code id="convertDVHsmooth_+3A_perdose">perDose</code></td>
<td>
<p><code>logical</code>. Are the differential DVH volume values per unit dose?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Depending on the input, an object of class <code>matrix</code>, <code>DVHs</code>, <code>DVHLst</code>, or <code>DVHLstLst</code>.</p>


<h3>See Also</h3>

<p><code><a href="#topic+convertDVH">convertDVH</a></code>,
<code><a href="#topic+readDVH">readDVH</a></code>,
<code><a href="#topic+showDVH">showDVH</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>res &lt;- convertDVHsmooth(dataMZ[[c(1, 1)]],
                  toType="cumulative",
                  toDoseUnit="CGY")
</code></pre>

<hr>
<h2 id='dataConstr'>Constraint data frame</h2><span id='topic+dataConstr'></span>

<h3>Description</h3>

<p>Data frame with quality assurance constraints to use with built-in DVH object <code><a href="#topic+dataMZ">dataMZ</a></code>.</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(dataConstr)</code></pre>


<h3>Format</h3>

<p>A data frame with 6 entries for the following 3 variables.
</p>

<dl>
<dt><code>constraint</code></dt><dd><p>The constraint <code>character</code> string.</p>
</dd>
<dt><code>patID</code></dt><dd><p>The patient ID <code>character</code> string or <code>*</code> wildcard.</p>
</dd>
<dt><code>structure</code></dt><dd><p>The structure <code>character</code> string or <code>*</code> wildcard.</p>
</dd>
</dl>



<h3>Details</h3>

<p>See <code><a href="#topic+checkConstraint">checkConstraint</a></code> for the definition of a constraint.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+readConstraint">readConstraint</a></code>,
<code><a href="#topic+checkConstraint">checkConstraint</a></code>,
<code><a href="#topic+showConstraint">showConstraint</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>checkConstraint(dataMZ, constr=dataConstr)
</code></pre>

<hr>
<h2 id='dataMZ'>DVH data from 3 patients</h2><span id='topic+dataMZ'></span>

<h3>Description</h3>

<p>Data from 3 patients with radiotherapy. DVHs for 7 heart structures.</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(dataMZ)</code></pre>


<h3>Format</h3>

<p>Object of class <code>DVHLstLst</code> with 3 components corresponding to 3 patients.
</p>

<dl>
<dt><code>P123</code></dt><dd><p>Object of class <code>DVHLst</code>. 7 objects of class <code>DVHs</code> for structures AMYOCL (left anterior heart wall), AMYOCR (right anterior heart wall), AOVALVE (aortic valve), AVNODE (AV node), HEART (complete heart), PULMVALVE (pulmonary valve), MYOCARD (heart wall)</p>
</dd>
<dt><code>P234</code></dt><dd><p>Object of class <code>DVHLst</code>. 7 objects of class <code>DVHs</code> for the same structures as patient <code>P123</code>.</p>
</dd>
<dt><code>P345</code></dt><dd><p>Object of class <code>DVHLst</code>. 7 objects of class <code>DVHs</code> for the same structures as patient <code>P123</code>.</p>
</dd>
</dl>



<h3>Details</h3>

<p>Data courtesy of Department of Radiation Oncology (Prof. Dr. Schmidberger), University Medical Center Mainz, Germany.
</p>
<p>See <code><a href="#topic+readDVH">readDVH</a></code> for classes <code>DVHLstLst</code>, <code>DVHLst</code>, and <code>DVHs</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+readDVH">readDVH</a></code>,
<code><a href="#topic+print">print.DVHs</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>print(dataMZ, verbose=TRUE)
</code></pre>

<hr>
<h2 id='DVHmetrics-package'>Analyze Dose-Volume Histograms and Check Constraints</h2><span id='topic+DVHmetrics-package'></span><span id='topic+DVHmetrics'></span>

<h3>Description</h3>

<p>Functionality for analyzing dose-volume histograms
(DVH) in radiation oncology: Read DVH text files,
calculate DVH metrics, gEUD, BED, EQD2, NTCP, TCP, show DVH
diagrams, check and visualize quality assurance constraints
for the DVH. Includes web-based graphical user interface.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> DVHmetrics</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 0.4.2</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2022-03-23</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL (&gt;= 2)</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Daniel Wollschlaeger and Heiko Karle
</p>
<p>Maintainer: Daniel Wollschlaeger &lt;wollschlaeger@uni-mainz.de&gt;
</p>


<h3>References</h3>

<p>For a solution that also reads files in DICOM-RT format, see the <code>RadOnc</code> package: <a href="https://CRAN.R-project.org/package=RadOnc">https://CRAN.R-project.org/package=RadOnc</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>showDVH(dataMZ[[1]])
checkConstraint(dataMZ, "D1CC &lt; 10Gy")
</code></pre>

<hr>
<h2 id='getBED'>Calculate biologically effective dose (BED)</h2><span id='topic+getBED'></span><span id='topic+getBED.default'></span><span id='topic+getBED.DVHs'></span><span id='topic+getBED.DVHLst'></span><span id='topic+getBED.DVHLstLst'></span>

<h3>Description</h3>

<p>Calculate biologically effective dose (BED) according to the linear-quadratic model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getBED(D=NULL, fd=NULL, fn=NULL, ab=NULL)

## Default S3 method:
getBED(D=NULL, fd=NULL, fn=NULL, ab=NULL)

## S3 method for class 'DVHs'
getBED(D=NULL, fd=NULL, fn=NULL, ab=NULL)

## S3 method for class 'DVHLst'
getBED(D=NULL, fd=NULL, fn=NULL, ab=NULL)

## S3 method for class 'DVHLstLst'
getBED(D=NULL, fd=NULL, fn=NULL, ab=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getBED_+3A_d">D</code></td>
<td>
<p>Default: Total dose. If <code>NULL</code>, <code>fn</code> must be given. Alternative: One cumulative DVH (object of class <code>DVHs</code>, multiple cumulative DVHs from one patient with multiple structures (object of class <code>DVHLst</code>), or multiple cumulative DVHs from many patients, each with multiple structures (object of class <code>DVHLstLst</code>). See <code><a href="#topic+readDVH">readDVH</a></code>.</p>
</td></tr>
<tr><td><code id="getBED_+3A_fd">fd</code></td>
<td>
<p>Fractional dose. If <code>D</code> is some kind of <code>DVH</code> object, only the first element will be used.</p>
</td></tr>
<tr><td><code id="getBED_+3A_fn">fn</code></td>
<td>
<p>Number of fractions. If <code>NULL</code>, <code>D</code> must be the total dose. Ignored if <code>D</code> is some kind of <code>DVH</code> object.</p>
</td></tr>
<tr><td><code id="getBED_+3A_ab">ab</code></td>
<td>
<p>alpha/beta ratio for the relevant tissue. If some kind of <code>DVH</code> object, only the first element will be used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Default method: A data frame with variables <code>BED</code>, <code>fractDose</code>, <code>ab</code>.
</p>
<p>If <code>D</code> is some kind of <code>DVH</code> object, the same kind of object is returned with the individual dose values converted to BED.
</p>


<h3>References</h3>

<p>Fowler, J. F. (2010). 21 years of Biologically Effective Dose. British Journal of Radiology, 83, 554-568.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+getEQD2">getEQD2</a></code>,
<code><a href="#topic+getIsoEffD">getIsoEffD</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>getBED(D=50, fd=2.5, ab=c(2, 3, 4))
getBED(D=dataMZ[[c(1, 1)]], fd=1.8, ab=3)
</code></pre>

<hr>
<h2 id='getDMEAN'>DMEAN and other dose metrics</h2><span id='topic+getDMEAN'></span><span id='topic+getDMEAN.DVHs'></span><span id='topic+getDMEAN.DVHLst'></span><span id='topic+getDMEAN.DVHLstLst'></span>

<h3>Description</h3>

<p>Calculate DMEAN and other dose metrics from the (interpolated) differential DVH without relying on the values exported by the TPS.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getDMEAN(x, interp=c("linear", "spline", "ksmooth", "smoothSpl"),
         nodes=5001L)

## S3 method for class 'DVHs'
getDMEAN(x, interp=c("linear", "spline", "ksmooth", "smoothSpl"),
         nodes=5001L)

## S3 method for class 'DVHLst'
getDMEAN(x, interp=c("linear", "spline", "ksmooth", "smoothSpl"),
         nodes=5001L)

## S3 method for class 'DVHLstLst'
getDMEAN(x, interp=c("linear", "spline", "ksmooth", "smoothSpl"),
         nodes=5001L)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getDMEAN_+3A_x">x</code></td>
<td>
<p>One DVH (object of class <code>DVHs</code>, multiple DVHs from one patient with multiple structures (object of class <code>DVHLst</code>), or multiple DVHs from many patients, each with multiple structures (object of class <code>DVHLstLst</code>). See <code><a href="#topic+readDVH">readDVH</a></code>.</p>
</td></tr>
<tr><td><code id="getDMEAN_+3A_interp">interp</code></td>
<td>
<p><code>character</code>. Method of interpolation between DVH points: Linear interpolation applies to the cumulative DVH (recommended). Spline interpolation with <code><a href="stats.html#topic+splinefun">splinefun</a></code>, local polynomial regression with <code><a href="KernSmooth.html#topic+locpoly">locpoly</a></code>, and smoothing splines with <code><a href="stats.html#topic+smooth.spline">smooth.spline</a></code> apply to the differential DVH (not recommended).</p>
</td></tr>
<tr><td><code id="getDMEAN_+3A_nodes">nodes</code></td>
<td>
<p><code>numeric</code>. Minimum number of nodes to use in interpolation. Number of available nodes is kept as is for <code>NULL</code> or if larger than <code>nodes</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with the following value(s).
</p>

<dl>
<dt>patID</dt><dd><p>Patient ID.</p>
</dd>
<dt>structure</dt><dd><p>Structure name.</p>
</dd>
<dt>doseMin</dt><dd><p>Minimum dose.</p>
</dd>
<dt>doseMax</dt><dd><p>Maximum dose.</p>
</dd>
<dt>doseAvg</dt><dd><p>Mean dose.</p>
</dd>
<dt>doseMed</dt><dd><p>Median dose.</p>
</dd>
<dt>doseSD</dt><dd><p>Dose standard deviation.</p>
</dd>
<dt>doseMode</dt><dd><p>Dose mode.</p>
</dd>
<dt>doseAvgTPS</dt><dd><p>Mean dose as exported from the TPS (if available).</p>
</dd>
<dt>doseMedTPS</dt><dd><p>Median dose as exported from the TPS (if available).</p>
</dd>
<dt>doseMinTPS</dt><dd><p>Minimum dose as exported from the TPS (if available).</p>
</dd>
<dt>doseMaxTPS</dt><dd><p>Maximum dose as exported from the TPS (if available).</p>
</dd>
</dl>



<h3>See Also</h3>

<p><code><a href="#topic+getMetric">getMetric</a></code>,
<code><a href="#topic+convertDVHsmooth">convertDVHsmooth</a></code>,
<code><a href="stats.html#topic+approxfun">approxfun</a></code>,
<code><a href="stats.html#topic+splinefun">splinefun</a></code>,
<code><a href="stats.html#topic+smooth.spline">smooth.spline</a></code>,
<code><a href="KernSmooth.html#topic+dpill">dpill</a></code>,
<code><a href="KernSmooth.html#topic+locpoly">locpoly</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>getDMEAN(dataMZ[[1]], interp="linear")
</code></pre>

<hr>
<h2 id='getEQD2'>2Gy fractions biologically equivalent dose (EQD2)</h2><span id='topic+getEQD2'></span><span id='topic+getEQD2.default'></span><span id='topic+getEQD2.DVHs'></span><span id='topic+getEQD2.DVHLst'></span><span id='topic+getEQD2.DVHLstLst'></span>

<h3>Description</h3>

<p>Calculate dose in 2Gy fractions biologically equivalent dose according to the linear-quadratic model, assuming a homogeneous dose distribution within the volume.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getEQD2(D=NULL, fd=NULL, fn=NULL, ab=NULL)

## Default S3 method:
getEQD2(D=NULL, fd=NULL, fn=NULL, ab=NULL)

## S3 method for class 'DVHs'
getEQD2(D=NULL, fd=NULL, fn=NULL, ab=NULL)

## S3 method for class 'DVHLst'
getEQD2(D=NULL, fd=NULL, fn=NULL, ab=NULL)

## S3 method for class 'DVHLstLst'
getEQD2(D=NULL, fd=NULL, fn=NULL, ab=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getEQD2_+3A_d">D</code></td>
<td>
<p>Default: Total dose. If <code>NULL</code>, <code>fn</code> must be given. Alternative: One cumulative DVH (object of class <code>DVHs</code>), multiple cumulative DVHs from one patient with multiple structures (object of class <code>DVHLst</code>), or multiple cumulative DVHs from many patients, each with multiple structures (object of class <code>DVHLstLst</code>). See <code><a href="#topic+readDVH">readDVH</a></code>.</p>
</td></tr>
<tr><td><code id="getEQD2_+3A_fd">fd</code></td>
<td>
<p>Fractional dose. If <code>D</code> is some kind of <code>DVH</code> object, only the first element will be used.</p>
</td></tr>
<tr><td><code id="getEQD2_+3A_fn">fn</code></td>
<td>
<p>Number of fractions. If <code>NULL</code>, <code>D</code> must be given. Ignored if <code>D</code> is some kind of <code>DVH</code> object.</p>
</td></tr>
<tr><td><code id="getEQD2_+3A_ab">ab</code></td>
<td>
<p>alpha/beta ratio for the relevant tissue.  If <code>D</code> is some kind of <code>DVH</code> object, only the first element will be used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>EQD2 is a special case of isoeffective dose calculation with fractional dose <code>d2=2</code>, see <code><a href="#topic+getIsoEffD">getIsoEffD</a></code>. The calculation assumes a homogeneous dose distribution within the volume.
</p>


<h3>Value</h3>

<p>Default method: A data frame with variables <code>EQD2</code>, <code>fractDose</code>, <code>ab</code>.
</p>
<p>If <code>D</code> is some kind of <code>DVH</code> object, the same kind of object is returned with the individual dose values converted to EQD2.
</p>


<h3>References</h3>

<p>IAEA, &amp; ICRU. (2008). Relative biological effectiveness in ion-beam therapy (Tech. Rep. No. IAEA-TR 461). Vienna, Austria: IAEA (International Atomic Energy Agency) and ICRU (International
Commission on Radiation Units and Measurements).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+getBED">getBED</a></code>,
<code><a href="#topic+getIsoEffD">getIsoEffD</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>getEQD2(D=50, fd=2.5, ab=c(2, 3, 4))
getEQD2(dataMZ[[c(1, 1)]], fd=1.8, ab=3)
</code></pre>

<hr>
<h2 id='getEUD'>Generalized equivalent uniform dose (gEUD)</h2><span id='topic+getEUD'></span><span id='topic+getEUD.DVHs'></span><span id='topic+getEUD.DVHLst'></span><span id='topic+getEUD.DVHLstLst'></span>

<h3>Description</h3>

<p>Calculate generalized equivalent uniform dose (gEUD). May be based on EQD2.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getEUD(x, EUDa, EUDfd=NULL, EUDab=NULL, ...)

## S3 method for class 'DVHs'
getEUD(x, EUDa, EUDfd=NULL, EUDab=NULL, ...)

## S3 method for class 'DVHLst'
getEUD(x, EUDa, EUDfd=NULL, EUDab=NULL, ...)

## S3 method for class 'DVHLstLst'
getEUD(x, EUDa, EUDfd=NULL, EUDab=NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getEUD_+3A_x">x</code></td>
<td>
<p>One cumulative DVH (object of class <code>DVHs</code>, multiple cumulative DVHs from one patient with multiple structures (object of class <code>DVHLst</code>), or multiple cumulative DVHs from many patients, each with multiple structures (object of class <code>DVHLstLst</code>). See <code><a href="#topic+readDVH">readDVH</a></code>.</p>
</td></tr>
<tr><td><code id="getEUD_+3A_euda">EUDa</code></td>
<td>
<p>Exponential parameter a.</p>
</td></tr>
<tr><td><code id="getEUD_+3A_eudfd">EUDfd</code></td>
<td>
<p>If gEUD should be based on EQD2: Fraction dose.</p>
</td></tr>
<tr><td><code id="getEUD_+3A_eudab">EUDab</code></td>
<td>
<p>If gEUD should be based on EQD2: alpha/beta ratio for the relevant tissue.</p>
</td></tr>
<tr><td><code id="getEUD_+3A_...">...</code></td>
<td>
<p>Ignored. Used to catch additional arguments passed from <code><a href="#topic+getMetric">getMetric</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with variables <code>EUD</code>, <code>patID</code>, and <code>structure</code>.
</p>


<h3>References</h3>

<p>Niemierko, A. (1999). A generalized concept of equivalent uniform dose. Medical Physics, 26(6), 1100.
</p>
<p>Wu et al. (2002). Optimization of intensity modulated radiotherapy plans based on the equivalent uniform dose. International Journal of Radiation Oncology Biology Physics, 52, 224-235.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+getEQD2">getEQD2</a></code>,
<code><a href="#topic+getMetric">getMetric</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>getEUD(dataMZ[[1]], EUDa=2)

# based on EQD2
getEUD(dataMZ[[1]], EUDa=2, EUDfd=1.8, EUDab=4)
</code></pre>

<hr>
<h2 id='getIsoEffD'>Isoeffective dose calculation</h2><span id='topic+getIsoEffD'></span><span id='topic+getIsoEffD.default'></span><span id='topic+getIsoEffD.DVHs'></span><span id='topic+getIsoEffD.DVHLst'></span><span id='topic+getIsoEffD.DVHLstLst'></span>

<h3>Description</h3>

<p>Convert given (fractional) dose into a corresponding (fractional) dose for a different total dose / fractionation schedule according to the linear-quadratic model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getIsoEffD(D1=NULL, D2=NULL, fd1=NULL, fd2=NULL, ab=NULL)

## Default S3 method:
getIsoEffD(D1=NULL, D2=NULL, fd1=NULL, fd2=NULL, ab=NULL)

## S3 method for class 'DVHs'
getIsoEffD(D1=NULL, D2=NULL, fd1=NULL, fd2=NULL, ab=NULL)

## S3 method for class 'DVHLst'
getIsoEffD(D1=NULL, D2=NULL, fd1=NULL, fd2=NULL, ab=NULL)

## S3 method for class 'DVHLstLst'
getIsoEffD(D1=NULL, D2=NULL, fd1=NULL, fd2=NULL, ab=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getIsoEffD_+3A_d1">D1</code></td>
<td>
<p>Default: <code>numeric</code> vector. Total dose 1. Alternative: One cumulative DVH (object of class <code>DVHs</code>, multiple cumulative DVHs from one patient with multiple structures (object of class <code>DVHLst</code>), or multiple cumulative DVHs from many patients, each with multiple structures (object of class <code>DVHLstLst</code>). See <code><a href="#topic+readDVH">readDVH</a></code>.</p>
</td></tr>
<tr><td><code id="getIsoEffD_+3A_d2">D2</code></td>
<td>
<p><code>numeric</code> vector. Total dose 2. Ignored if <code>D</code> is some kind of <code>DVH</code> object.</p>
</td></tr>
<tr><td><code id="getIsoEffD_+3A_fd1">fd1</code></td>
<td>
<p><code>numeric</code> vector. Fractional dose 1. If <code>D</code> is some kind of <code>DVH</code> object, only the first element will be used.</p>
</td></tr>
<tr><td><code id="getIsoEffD_+3A_fd2">fd2</code></td>
<td>
<p><code>numeric</code> vector. Fractional dose 2. If <code>D</code> is some kind of <code>DVH</code> object, only the first element will be used.</p>
</td></tr>
<tr><td><code id="getIsoEffD_+3A_ab">ab</code></td>
<td>
<p><code>numeric</code> vector. alpha/beta ratio for the relevant tissue in the linear-quadatic model. If <code>D</code> is some kind of <code>DVH</code> object, only the first element will be used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>DVH</code> methods: Calculate <code>D2</code> based on <code>D1</code>, <code>fd1</code>, <code>fd2</code>, and <code>ab</code>. The default method can also calculate <code>fd2</code> based on <code>D1</code>, <code>D2</code>, <code>fd1</code>, and <code>ab</code>.
</p>


<h3>Value</h3>

<p>The (vector of) corresponding (fractional) dose value(s). If <code>D</code> is some kind of <code>DVH</code> object, the same kind of object is returned with the individual dose values converted to <code>D2</code>.
</p>


<h3>References</h3>

<p>IAEA, &amp; ICRU. (2008). Relative biological effectiveness in ion-beam therapy (Tech. Rep. No. IAEA-TR 461). Vienna, Austria: IAEA (International Atomic Energy Agency) and ICRU (International
Commission on Radiation Units and Measurements).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+getBED">getBED</a></code>,
<code><a href="#topic+getEQD2">getEQD2</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># reference: 70Gy in 2Gy fractions
# new fractionation: 3Gy fractions
# calculate corresponding dose
(D2 &lt;- getIsoEffD(D1=70, fd1=2, fd2=3, ab=c(3.5, 10)))

getIsoEffD(D1=dataMZ[[c(1, 1)]], fd1=1.8, fd2=2, ab=3.5)
</code></pre>

<hr>
<h2 id='getMeanDVH'>Point-wise mean DVH with point-wise SDs</h2><span id='topic+getMeanDVH'></span><span id='topic+getMeanDVH.DVHs'></span><span id='topic+getMeanDVH.DVHLst'></span><span id='topic+getMeanDVH.DVHLstLst'></span>

<h3>Description</h3>

<p>Returns the point-wise mean and median DVH with the point-wise standard deviation for a given list of input DVHs. Other point-wise measures may be calculated as well.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getMeanDVH(x, fun=list(mean=mean, median=median, sd=sd),
           cumul=TRUE, thin=1, byPat=TRUE, patID=NULL, structure=NULL,
           fixed=TRUE, returnDVHObj=FALSE)

## S3 method for class 'DVHs'
getMeanDVH(x, fun=list(mean=mean, median=median, sd=sd),
           cumul=TRUE, thin=1, byPat=TRUE, patID=NULL, structure=NULL,
           fixed=TRUE, returnDVHObj=FALSE)

## S3 method for class 'DVHLst'
getMeanDVH(x, fun=list(mean=mean, median=median, sd=sd),
           cumul=TRUE, thin=1, byPat=TRUE, patID=NULL, structure=NULL,
           fixed=TRUE, returnDVHObj=FALSE)

## S3 method for class 'DVHLstLst'
getMeanDVH(x, fun=list(mean=mean, median=median, sd=sd),
           cumul=TRUE, thin=1, byPat=TRUE, patID=NULL, structure=NULL,
           fixed=TRUE, returnDVHObj=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getMeanDVH_+3A_x">x</code></td>
<td>
<p>A single DVH (object of class <code>DVHs</code>), multiple DVHs from one patient/structure (object of class <code>DVHLst</code>), or multiple DVHs from many patients/structures (object of class <code>DVHLstLst</code>). See <code><a href="#topic+readDVH">readDVH</a></code>.</p>
</td></tr>
<tr><td><code id="getMeanDVH_+3A_fun">fun</code></td>
<td>
<p>Named <code>list</code> of functions that should be applied to yield 1 point-wise DVH measure. Functions must have exactly 1 return value.</p>
</td></tr>
<tr><td><code id="getMeanDVH_+3A_cumul">cumul</code></td>
<td>
<p><code>logical</code>. Get point-wise mean and SD for cumulative or differential (per unit dose) DVH?</p>
</td></tr>
<tr><td><code id="getMeanDVH_+3A_thin">thin</code></td>
<td>
<p><code>numeric</code>. The number of DVH nodes (dose values) is reduced by 1/<code>thin</code> of the maximum number of nodes in <code>x</code> before interpolating and averaging.</p>
</td></tr>
<tr><td><code id="getMeanDVH_+3A_bypat">byPat</code></td>
<td>
<p><code>logical</code>. Relevant if multiple DVHs are given. <code>byPat=TRUE</code> means that for each patient, DVHs for multiple structures are averaged point wise. <code>byPat=FALSE</code> means that for each structure, DVHs for multiple patients averaged point wise.</p>
</td></tr>
<tr><td><code id="getMeanDVH_+3A_patid">patID</code></td>
<td>
<p><code>character</code> vector. Include DVHs for these patients only when calculating mean/SD. If missing, all patients are used. Can be a regular expression with <code>fixed=FALSE</code>, see <code><a href="base.html#topic+regex">regex</a></code>.</p>
</td></tr>
<tr><td><code id="getMeanDVH_+3A_structure">structure</code></td>
<td>
<p><code>character</code> vector. Include DVHs for these structures only when calculating mean/SD. If missing, all structures are used. Can be a regular expression with <code>fixed=FALSE</code>, see <code><a href="base.html#topic+regex">regex</a></code>.</p>
</td></tr>
<tr><td><code id="getMeanDVH_+3A_fixed">fixed</code></td>
<td>
<p><code>logical</code>. Use <code>fixed=FALSE</code> for regular expression matching of <code>patID</code> and <code>structure</code>.</p>
</td></tr>
<tr><td><code id="getMeanDVH_+3A_returndvhobj">returnDVHObj</code></td>
<td>
<p><code>logical</code>. With <code>returnDVHObj=TRUE</code>, a regular DVH object is returned. In that case, <code>fun</code> may only have one component for calculating either the point-wise <code>mean</code> or <code>median</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Before calculating the point-wise mean and SD, DVHs in <code>x</code> are first linearly interpolated with <code><a href="#topic+convertDVH">convertDVH</a></code> using the same set of nodes.
</p>


<h3>Value</h3>

<p>By default (<code>returnDVHObj=FALSE</code>) returns a data frame with point-wise mean DVH averaged over structures (<code>byPat=TRUE</code>) or over patients (<code>byPat=FALSE</code>) including the point-wise standard deviation or other measures as controlled by <code>fun</code>. With <code>returnDVHObj=TRUE</code>, a DVH object is returned that is equivalent to a DVH as imported from a file. In particular, functions like <code><a href="#topic+showDVH">showDVH</a></code> or <code><a href="#topic+getMetric">getMetric</a></code> can be used on such an object.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+showDVH">showDVH</a></code>,
<code><a href="#topic+convertDVH">convertDVH</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>res1 &lt;- getMeanDVH(dataMZ, byPat=TRUE, structure=c("HEART", "AMYOCL"))
head(res1)

# average differential DVHs
# matches patients P123 and P234
res2 &lt;- getMeanDVH(dataMZ, fun=list(min=min, max=max),
                   cumul=FALSE, byPat=FALSE,
                   patID="23", fixed=FALSE)
head(res2)
</code></pre>

<hr>
<h2 id='getMetric'>Calculate dose-volume-histogram metrics</h2><span id='topic+getMetric'></span><span id='topic+getMetric.DVHs'></span><span id='topic+getMetric.DVHLst'></span><span id='topic+getMetric.DVHLstLst'></span>

<h3>Description</h3>

<p>Simultaneously calculates multiple metrics for multiple cumulative DVHs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getMetric(x, metric, patID, structure,
           sortBy=c("none", "observed", "patID", "structure", "metric"),
          splitBy=c("none", "patID", "structure", "metric"),
           interp=c("linear", "spline", "ksmooth"), fixed=TRUE, ...)

## S3 method for class 'DVHs'
getMetric(x, metric, patID, structure,
           sortBy=c("none", "observed", "patID", "structure", "metric"),
          splitBy=c("none", "patID", "structure", "metric"),
           interp=c("linear", "spline", "ksmooth"), fixed=TRUE, ...)

## S3 method for class 'DVHLst'
getMetric(x, metric, patID, structure,
           sortBy=c("none", "observed", "patID", "structure", "metric"),
          splitBy=c("none", "patID", "structure", "metric"),
           interp=c("linear", "spline", "ksmooth"), fixed=TRUE, ...)

## S3 method for class 'DVHLstLst'
getMetric(x, metric, patID, structure,
           sortBy=c("none", "observed", "patID", "structure", "metric"),
          splitBy=c("none", "patID", "structure", "metric"),
           interp=c("linear", "spline", "ksmooth"), fixed=TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getMetric_+3A_x">x</code></td>
<td>
<p>One cumulative DVH (object of class <code>DVHs</code>, multiple cumulative DVHs from one patient with multiple structures (object of class <code>DVHLst</code>), or multiple cumulative DVHs from many patients, each with multiple structures (object of class <code>DVHLstLst</code>). See <code><a href="#topic+readDVH">readDVH</a></code>.</p>
</td></tr>
<tr><td><code id="getMetric_+3A_metric">metric</code></td>
<td>
<p><code>character</code> vector defining one or more DVH metrics. See Details for their definition. For metrics involving the relative dose, the DVH must contain the prescription dose.</p>
</td></tr>
<tr><td><code id="getMetric_+3A_patid">patID</code></td>
<td>
<p><code>character</code> vector. Calculate given DVH metrics for these patients only. If missing, DVH metrics are calculated for all patients. Can be a regular expression if additional argument <code>fixed=FALSE</code> is supplied as well, see <code><a href="base.html#topic+regex">regex</a></code>.</p>
</td></tr>
<tr><td><code id="getMetric_+3A_structure">structure</code></td>
<td>
<p><code>character</code> vector. Calculate given DVH metrics for these structures only. If missing, DVH metrics are calculated for all structures. Can be a regular expression if additional argument <code>fixed=FALSE</code> is supplied as well, see <code><a href="base.html#topic+regex">regex</a></code>.</p>
</td></tr>
<tr><td><code id="getMetric_+3A_sortby">sortBy</code></td>
<td>
<p><code>character</code> vector giving the sorting criteria for the output data frame.</p>
</td></tr>
<tr><td><code id="getMetric_+3A_splitby">splitBy</code></td>
<td>
<p><code>character</code> vector. Split results into a list of data frames where list components are defined by groups from combining these variables.</p>
</td></tr>
<tr><td><code id="getMetric_+3A_interp">interp</code></td>
<td>
<p><code>character</code>. Method of interpolation between DVH points: Linear interpolation using <code><a href="stats.html#topic+approxfun">approx</a></code>, monotone Hermite spline interpolation using <code><a href="stats.html#topic+splinefun">splinefun</a></code>, or local polynomial regression using <code><a href="KernSmooth.html#topic+locpoly">locpoly</a></code> with kernel bandwidth chosen by the direct plug-in method using <code><a href="KernSmooth.html#topic+dpill">dpill</a></code>.</p>
</td></tr>
<tr><td><code id="getMetric_+3A_fixed">fixed</code></td>
<td>
<p><code>logical</code>. Use <code>fixed=FALSE</code> for regular expression matching of <code>patID</code> and <code>structure</code>.</p>
</td></tr>
<tr><td><code id="getMetric_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code><a href="#topic+getEUD">getEUD</a></code> (for <code>metric="DEUD"</code>), <code><a href="#topic+getTCP">getTCP</a></code> (for <code>metric="DTCP"</code>), or <code><a href="#topic+getNTCP">getNTCP</a></code> (for <code>metric="DNTCP"</code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A <em>pre-specified</em> DVH metric is one of the following character strings:
</p>

<ul>
<li> <p><code>"DMEAN"</code>: The volume-weighted mean dose of the structure.
</p>
</li>
<li> <p><code>"DMEDIAN"</code>: Median dose, equal to D50%
</p>
</li>
<li> <p><code>"DMIN"</code>: The minimum dose of the non-zero-dose voxels in the structure.
</p>
</li>
<li> <p><code>"DMAX"</code>: The maximum dose of the non-zero-dose voxels in the structure.
</p>
</li>
<li> <p><code>"DSD"</code>: The standard deviation of the dose in the structure.
</p>
</li>
<li> <p><code>"DRX"</code>: The prescription dose.
</p>
</li>
<li> <p><code>"DHI"</code>: The Homogeneity Index according to ICRU 83: (D2%-D98%)/D50%.
</p>
</li>
<li> <p><code>"DEUD"</code>: The generalized equivalent uniform dose (gEUD). See <code><a href="#topic+getEUD">getEUD</a></code> for mandatory and optional parameters.
</p>
</li>
<li> <p><code>"DNTCP"</code>: The normal tissue complication probability (NTCP). See <code><a href="#topic+getNTCP">getNTCP</a></code> for mandatory and optional parameters.
</p>
</li>
<li> <p><code>"DTCP"</code>: The tumor control probability (TCP). See <code><a href="#topic+getNTCP">getNTCP</a></code> for mandatory and optional parameters.
</p>
</li></ul>

<p>A <em>free</em> DVH metric is a character string which has three mandatory elements and one optional element in the following order (AAPM TG263 2018, section 9.2, note that complementary / cold metrics are not yet implemented):
</p>

<ul>
<li><p> 1st letter <code>"D"</code> or <code>"V"</code>: <code>"D"</code> If the requested value is a dose, <code>"V"</code> if it is a volume.
</p>
</li>
<li><p> 2nd element <code>&lt;number&gt;</code>: If the first letter is <code>"D"</code>, this gives the volume for which the dose value of the cumulative DVH should be reported. If the first letter is <code>"V"</code>, this gives the dose for which the volume value of the cumulative DVH should be reported.
</p>
</li>
<li><p> 3rd element <code>&lt;measurement unit&gt;</code>: The measurement unit for the 2nd element of the metric. Absolute volumes are indicated by <code>"CC"</code> for cubic centimeter, relative volumes by <code>"%"</code>. Absolute doses are indicated by <code>"Gy"</code> for Gray, <code>"cGy"</code> for Centigray, or <code>"eV/g"</code> for uncalibrated dose in DVHs exported by PRIMO. Relative doses are indicated by <code>"%"</code>.
</p>
</li>
<li><p> Optional 4th element <code>_&lt;measurement unit&gt;</code>: The measurement unit of the output value. Possible units are as for the 3rd element. If missing, dose is reported as absolute dose in the measurement unit used in the DVH. Volume is reported as relative volume in %.
</p>
</li></ul>

<p>Examples:
</p>

<ul>
<li> <p><code>"D1%"</code>: Minimal absolute dose for the &quot;hottest&quot; 1% of the structure, i.e., the maximally irradiated 1% of the structure was exposed to at least this absolute dose.
</p>
</li>
<li> <p><code>"D1CC_%"</code>: Minimal relative dose (% of prescription dose) for the maximally irradiated cm^3 of the structure.
</p>
</li>
<li> <p><code>"V500cGy"</code>: Relative structure volume in % that was exposed to at least 500cGy.
</p>
</li>
<li> <p><code>"V10%_CC"</code>: Absolute structure volume in cm^3 that was exposed to at least 10% of prescription dose.
</p>
</li></ul>

<p>If volume or dose values outside the range of possible values for a structure are requested, metrics cannot be calculated, and the result will be <code>NA</code> with a warning.
</p>
<p>DMEAN, DMEDIAN, DMIN, DMAX, DSD are taken from the exported DVH if present. Otherwise, the differential DVH is generated and used for calculating these metrics.
</p>


<h3>Value</h3>

<p>A data frame or a list with details on the calculated metrics.
</p>
<table>
<tr><td><code>patID</code></td>
<td>
<p>Patient ID</p>
</td></tr>
<tr><td><code>structure</code></td>
<td>
<p>Structure</p>
</td></tr>
<tr><td><code>metric</code></td>
<td>
<p>The calculated DVH metric</p>
</td></tr>
<tr><td><code>observed</code></td>
<td>
<p>The observed value for the DVH metric</p>
</td></tr>
</table>


<h3>References</h3>

<p>American Association of Physicists in Medicine (AAPM) Task Group TG263 (2018). Standardizing Nomenclatures in Radiation Oncology. <a href="https://www.aapm.org/pubs/reports/RPT_263.pdf">https://www.aapm.org/pubs/reports/RPT_263.pdf</a> (section 9.2 &quot;Guidelines for DVH metrics&quot;)
</p>
<p>Rancati et al. (2004). Fitting late rectal bleeding data using different NTCP models: results from an Italian multi-centric study (AIROPROS0101). Radiotherapy Oncology, 73, 21-32.
</p>
<p>Wu et al. (2002). Optimization of intensity modulated radiotherapy plans based on the equivalent uniform dose. International Journal of Radiation Oncology Biology Physics, 52, 224-235.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+saveMetric">saveMetric</a></code>,
<code><a href="#topic+getEUD">getEUD</a></code>,
<code><a href="#topic+getNTCP">getNTCP</a></code>,
<code><a href="#topic+getTCP">getTCP</a></code>,
<code><a href="#topic+getEQD2">getEQD2</a></code>,
<code><a href="stats.html#topic+approxfun">approxfun</a></code>,
<code><a href="stats.html#topic+splinefun">splinefun</a></code>,
<code><a href="KernSmooth.html#topic+dpill">dpill</a></code>,
<code><a href="KernSmooth.html#topic+locpoly">locpoly</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>getMetric(dataMZ, c("D1CC", "V10%_CC"),
          sortBy=c("metric", "structure", "observed"))

# matching patients are P123 and P234
# matching structures are AMYOCL and AMYOCR
getMetric(dataMZ, c("D1CC", "V10%_CC"),
          patID="23",
          structure=c("AMYOC", "VALVE"),
          splitBy="patID",
          fixed=FALSE)

# gEUD with a=2
getMetric(dataMZ[[c(1, 1)]], "DEUD", EUDa=2)

# gEUD based on EQD2 with a=2, 20 fractions
getMetric(dataMZ[[c(1, 1)]], "DEUD", EUDa=2, EUDfd=1.8)

# NTCP Lyman probit model with TD50=20, m=4, n=0.5
getMetric(dataMZ[[c(1, 1)]], "DNTCP",
          NTCPtd50=20, NTCPm=4, NTCPn=0.5, NTCPtype="probit")
</code></pre>

<hr>
<h2 id='getNTCP'>Normal tissue complication probability (NTCP)</h2><span id='topic+getNTCP'></span><span id='topic+getNTCP.DVHs'></span><span id='topic+getNTCP.DVHLst'></span><span id='topic+getNTCP.DVHLstLst'></span>

<h3>Description</h3>

<p>Calculate normal tissue complication probability (NTCP) from Lyman's probit model, Niemierko's logit model, the Poisson model, or the Kaellman relative seriality model. May be based on EQD2.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getNTCP(x,
        NTCPtd50=NULL, NTCPm=NULL, NTCPn=NULL, NTCPgamma50=NULL, NTCPs=NULL,
        EUDa=NULL, EUDfn=NULL, EUDab=NULL,
        NTCPtype=c("probit", "logit", "poisson", "relative_seriality"), ...)

## S3 method for class 'DVHs'
getNTCP(x,
        NTCPtd50=NULL, NTCPm=NULL, NTCPn=NULL, NTCPgamma50=NULL, NTCPs=NULL,
        EUDa=NULL, EUDfn=NULL, EUDab=NULL,
        NTCPtype=c("probit", "logit", "poisson", "relative_seriality"), ...)

## S3 method for class 'DVHLst'
getNTCP(x,
        NTCPtd50=NULL, NTCPm=NULL, NTCPn=NULL, NTCPgamma50=NULL, NTCPs=NULL,
        EUDa=NULL, EUDfn=NULL, EUDab=NULL,
        NTCPtype=c("probit", "logit", "poisson", "relative_seriality"), ...)

## S3 method for class 'DVHLstLst'
getNTCP(x,
        NTCPtd50=NULL, NTCPm=NULL, NTCPn=NULL, NTCPgamma50=NULL, NTCPs=NULL,
        EUDa=NULL, EUDfn=NULL, EUDab=NULL,
        NTCPtype=c("probit", "logit", "poisson", "relative_seriality"), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getNTCP_+3A_x">x</code></td>
<td>
<p>One cumulative DVH (object of class <code>DVHs</code>, multiple cumulative DVHs from one patient with multiple structures (object of class <code>DVHLst</code>), or multiple cumulative DVHs from many patients, each with multiple structures (object of class <code>DVHLstLst</code>). See <code><a href="#topic+readDVH">readDVH</a></code>.</p>
</td></tr>
<tr><td><code id="getNTCP_+3A_ntcptd50">NTCPtd50</code></td>
<td>
<p>Tolerance dose with 50% complication probability.</p>
</td></tr>
<tr><td><code id="getNTCP_+3A_ntcpm">NTCPm</code></td>
<td>
<p>Probit/logit Parameter m. Equal to 1 / (NTCPgamma50*sqrt(2*pi)).</p>
</td></tr>
<tr><td><code id="getNTCP_+3A_ntcpn">NTCPn</code></td>
<td>
<p>Parameter n. Equal to 1/a with exponential gEUD paramter a.</p>
</td></tr>
<tr><td><code id="getNTCP_+3A_ntcpgamma50">NTCPgamma50</code></td>
<td>
<p>Poisson parameter gamma50. Equal to 1 / (NTCPm*sqrt(2*pi))</p>
</td></tr>
<tr><td><code id="getNTCP_+3A_ntcps">NTCPs</code></td>
<td>
<p>Relative seriality parameter s.</p>
</td></tr>
<tr><td><code id="getNTCP_+3A_euda">EUDa</code></td>
<td>
<p>If gEUD should be based on EQD2: Exponential parameter a.</p>
</td></tr>
<tr><td><code id="getNTCP_+3A_eudfn">EUDfn</code></td>
<td>
<p>If gEUD should be based on EQD2: Number of fractions.</p>
</td></tr>
<tr><td><code id="getNTCP_+3A_eudab">EUDab</code></td>
<td>
<p>If gEUD should be based on EQD2: alpha/beta ratio for the relevant tissue.</p>
</td></tr>
<tr><td><code id="getNTCP_+3A_ntcptype">NTCPtype</code></td>
<td>
<p><code>"probit"</code> - Lyman probit model, <code>"logit"</code> - Niemierko logit model, <code>"poisson"</code> - Poisson model, <code>"relative_seriality"</code> - Kaellmann relative seriality model.</p>
</td></tr>
<tr><td><code id="getNTCP_+3A_...">...</code></td>
<td>
<p>Ignored. Used to catch additional arguments passed from <code><a href="#topic+getMetric">getMetric</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For the logit, probit, and Poisson method, gEUD is used for DVH reduction. This is equivalent to the Kutcher-Burman DVH reduction scheme. The probit model is given in equation (1), the logit model in eqation (2), and the Poisson model in equation (3) in Kaellman (1992), with gEUD plugged in for D. The relative seriality model is given in equation (18).
</p>


<h3>Value</h3>

<p>A data frame with variables <code>NTCP</code>, <code>patID</code>, and <code>structure</code>.
</p>


<h3>References</h3>

<p>Kaellman, P., Agren, A., &amp; Brahme, A. (1992). Tumor and normal tissue responses to fractionated non-uniform dose delivery. International Journal of Radiation Biology, 62(2), 249-262.
</p>
<p>Kutcher, G. J., Burman, C., Brewster L., Goitein, M., &amp; Mohan, R. (1991). Histogram reduction method for calculating complication probabilities for threedimensional treatment planning evaluations. International Journal of Radiation Oncology Biology Physics, 21(1), 137-146.
</p>
<p>Lyman, J. T. (1985). Complication probability as assessed from dose volume histograms. Radiation Research, 104(2), S13-19.
</p>
<p>Niemierko, A. (1999). A generalized concept of equivalent uniform dose. Medical Physics, 26(6), 1100.
</p>
<p>Rancati et al. (2004). Fitting late rectal bleeding data using different NTCP models: results from an Italian multi-centric study (AIROPROS0101). Radiotherapy Oncology, 73, 21-32.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+getTCP">getTCP</a></code>,
<code><a href="#topic+getEUD">getEUD</a></code>,
<code><a href="#topic+getMetric">getMetric</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## treatment was in 2 Gy fractions
getNTCP(dataMZ[[1]][["HEART"]],
        NTCPtd50=48, NTCPm=0.6, NTCPn=0.5, NTCPtype="probit")

getNTCP(dataMZ[[1]][["HEART"]],
        NTCPtd50=52.3, NTCPgamma=1.28, NTCPs=1, NTCPtype="relative_seriality")
</code></pre>

<hr>
<h2 id='getTCP'>Tumor control probability (TCP)</h2><span id='topic+getTCP'></span>

<h3>Description</h3>

<p>Calculate tumor control probability (TCP) from Lyman's probit model, Niemierko's logit model, the Poisson model, or the Kaellman relative seriality model. May be based on EQD2.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getTCP(x, TCPtcd50=NULL, TCPm=NULL, TCPn=NULL, TCPgamma50=NULL, NTCPs=NULL,
       EUDa=NULL, EUDfn=NULL, EUDab=NULL,
       TCPtype=c("probit", "logit", "poisson", "relative_seriality"), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getTCP_+3A_x">x</code></td>
<td>
<p>One cumulative DVH (object of class <code>DVHs</code>, multiple cumulative DVHs from one patient with multiple structures (object of class <code>DVHLst</code>), or multiple cumulative DVHs from many patients, each with multiple structures (object of class <code>DVHLstLst</code>). See <code><a href="#topic+readDVH">readDVH</a></code>.</p>
</td></tr>
<tr><td><code id="getTCP_+3A_tcptcd50">TCPtcd50</code></td>
<td>
<p>Tolerance dose with 50% tumor control probability.</p>
</td></tr>
<tr><td><code id="getTCP_+3A_tcpm">TCPm</code></td>
<td>
<p>Probit/logit Parameter m. Equal to 1 / (NTCPgamma50*sqrt(2*pi)).</p>
</td></tr>
<tr><td><code id="getTCP_+3A_tcpn">TCPn</code></td>
<td>
<p>Parameter n. Equal to 1/a with exponential gEUD paramter a.</p>
</td></tr>
<tr><td><code id="getTCP_+3A_tcpgamma50">TCPgamma50</code></td>
<td>
<p>Poisson parameter gamma50. Equal to 1 / (NTCPm*sqrt(2*pi))</p>
</td></tr>
<tr><td><code id="getTCP_+3A_ntcps">NTCPs</code></td>
<td>
<p>Relative seriality parameter s.</p>
</td></tr>
<tr><td><code id="getTCP_+3A_euda">EUDa</code></td>
<td>
<p>If gEUD should be based on EQD2: Exponential parameter a.</p>
</td></tr>
<tr><td><code id="getTCP_+3A_eudfn">EUDfn</code></td>
<td>
<p>If gEUD should be based on EQD2: Number of fractions.</p>
</td></tr>
<tr><td><code id="getTCP_+3A_eudab">EUDab</code></td>
<td>
<p>If gEUD should be based on EQD2: alpha/beta ratio for the relevant tissue.</p>
</td></tr>
<tr><td><code id="getTCP_+3A_tcptype">TCPtype</code></td>
<td>
<p><code>"probit"</code> - Lyman probit model, <code>"logit"</code> - Niemierko logit model, <code>"poisson"</code> - Poisson model, <code>"relative_seriality"</code> - Kaellmann relative seriality model..</p>
</td></tr>
<tr><td><code id="getTCP_+3A_...">...</code></td>
<td>
<p>Ignored. Used to catch additional arguments passed from <code><a href="#topic+getMetric">getMetric</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For the logit, probit, and Poisson method, gEUD is used for DVH reduction. This is equivalent to the Kutcher-Burman DVH reduction scheme. The probit model is given in equation (1), the logit model in eqation (2), and the Poisson model in equation (3) in Kaellman (1992), with gEUD plugged in for D. The relative seriality model is given in equation (18).
</p>


<h3>Value</h3>

<p>A data frame with variables <code>TCP</code>, <code>patID</code>, and <code>structure</code>.
</p>


<h3>References</h3>

<p>Kaellman, P., Agren, A., &amp; Brahme, A. (1992). Tumor and normal tissue responses to fractionated non-uniform dose delivery. International Journal of Radiation Biology, 62(2), 249-262.
</p>
<p>Kutcher, G. J., Burman, C., Brewster L., Goitein, M., &amp; Mohan, R. (1991). Histogram reduction method for calculating complication probabilities for threedimensional treatment planning evaluations. International Journal of Radiation Oncology Biology Physics, 21(1), 137-146.
</p>
<p>Lyman, J. T. (1985). Complication probability as assessed from dose volume histograms. Radiation Research, 104(2), S13-19.
</p>
<p>Niemierko, A. (1999). A generalized concept of equivalent uniform dose. Medical Physics, 26(6), 1100.
</p>
<p>Rancati et al. (2004). Fitting late rectal bleeding data using different NTCP models: results from an Italian multi-centric study (AIROPROS0101). Radiotherapy Oncology, 73, 21-32.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+getNTCP">getNTCP</a></code>,
<code><a href="#topic+getEUD">getEUD</a></code>,
<code><a href="#topic+getMetric">getMetric</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>getTCP(dataMZ[[1]],
       TCPtcd50=40, TCPm=0.6, TCPn=0.5, TCPtype="probit")
</code></pre>

<hr>
<h2 id='mergeDVH'>Merge existing DVH objects</h2><span id='topic+mergeDVH'></span>

<h3>Description</h3>

<p>Combine several existing DVH objects into one object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mergeDVH(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mergeDVH_+3A_...">...</code></td>
<td>
<p><code>DVHLstLst</code> objects.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The first object determines whether the resulting object is organized by patient or by structure. Objects need not originally come from the same treatment planning system.
</p>


<h3>Value</h3>

<p>Returns an object of class <code>DVHLstLst</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# pick some DVH files interactively
a &lt;- readDVH(type="Cadplan")

# pick other DVH files interactively
b &lt;- readDVH(type="Eclipse")

# combine DVH data
res &lt;- mergeDVH(a, b)
res

## End(Not run)
</code></pre>

<hr>
<h2 id='print.DVHs'>Print basic information about one or more DVHs</h2><span id='topic+print.DVHs'></span><span id='topic+print.DVHLst'></span><span id='topic+print.DVHLstLst'></span>

<h3>Description</h3>

<p>Print basic information (patients, structures, dose range) about one or more DVHs.</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'DVHs'
print(x, ...)

## S3 method for class 'DVHLst'
print(x, ...)

## S3 method for class 'DVHLstLst'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.DVHs_+3A_x">x</code></td>
<td>
<p>A single DVH (object of class <code>DVHs</code>), multiple DVHs from one patient/structure (object of class <code>DVHLst</code>), or multiple DVHs from many patients/structures (object of class <code>DVHLstLst</code>). See <code><a href="#topic+readDVH">readDVH</a></code>.</p>
</td></tr>
<tr><td><code id="print.DVHs_+3A_...">...</code></td>
<td>
<p>Further arguments: <code>print.DVHLst(x, verbose=TRUE)</code> prints more information about each DVH.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Prints summary information about the DVHs.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+readDVH">readDVH</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>print(dataMZ)
print(dataMZ, verbose=TRUE)
</code></pre>

<hr>
<h2 id='readConstraint'>Read constraint definitions from text file</h2><span id='topic+readConstraint'></span>

<h3>Description</h3>

<p>Reads the definition of quality assurance constraints from a text file.</p>


<h3>Usage</h3>

<pre><code class='language-R'>readConstraint(x, ...)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="readConstraint_+3A_x">x</code></td>
<td>
<p><code>character</code> string giving the path to a single text file with the constraint definition. May contain globbing symbols understood by <code><a href="base.html#topic+Sys.glob">Sys.glob</a></code>. If missing and in interactive mode, <code>readDVH</code> opens a file selector widget. See Details.</p>
</td></tr>
<tr><td><code id="readConstraint_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code><a href="utils.html#topic+read.table">read.table</a></code>, e.g., <code>sep="\t"</code> to define the column sepator as tab.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is a wrapper for <code><a href="utils.html#topic+read.table">read.table</a></code>.
</p>
<p>The text file should contain three columns with the column names <code>patID</code>, <code>structure</code>, <code>constraint</code> in the first line. Each further line then defines one constraint and the scope it applies to in terms of patients and structures. See <code><a href="#topic+checkConstraint">checkConstraint</a></code> for the definition of a constraint and for the definition of a scope. Example content:
</p>
<p><code>"patID" "structure" "constraint"</code><br />
<code>"*"     "HEART"     "D1CC &lt; 20Gy"</code><br />
<code>"234"   "*"         "V10% &gt; 8CC"</code>
</p>


<h3>Value</h3>

<p>A <code>data.frame</code> with columns <code>patID</code>, <code>structure</code>, <code>constraint</code> that can be used in functions <code><a href="#topic+checkConstraint">checkConstraint</a></code> and <code><a href="#topic+showConstraint">showConstraint</a></code>.
</p>


<h3>See Also</h3>

<p><code><a href="utils.html#topic+read.table">read.table</a></code>,
<code><a href="#topic+checkConstraint">checkConstraint</a></code>,
<code><a href="#topic+saveConstraint">saveConstraint</a></code>,
<code><a href="#topic+showConstraint">showConstraint</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
readConstraint("constraint.txt")
readConstraint()

## End(Not run)
</code></pre>

<hr>
<h2 id='readDVH'>Read DVH text files</h2><span id='topic+readDVH'></span>

<h3>Description</h3>

<p>Reads single or multiple DVH text files as exported from Varian Eclipse(TM), CadPlan(TM), OnCentra MasterPlan(TM), Philipps Pinnacle3 (TM), Elekta Monaco (TM), Tomo HiArt (TM), RaySearch Labs RayStation (TM), or Medcom ProSoma (TM). Supports cumulative and differential DVHs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>readDVH(x,
        type=c("Eclipse", "Cadplan", "Masterplan",
               "Pinnacle", "Monaco", "HiArt",
               "RayStation", "ProSoma", "PRIMO"),
        planInfo=FALSE, courseAsID=FALSE, add, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="readDVH_+3A_x">x</code></td>
<td>
<p><code>character</code> vector giving paths to DVH text files. May contain globbing symbols understood by <code><a href="base.html#topic+Sys.glob">Sys.glob</a></code>. If missing and in interactive mode, <code>readDVH</code> opens a file selector widget. Under Windows, this widget allows selecting multiple files simultaneously. For <code>type="Pinnacle"</code>, <code>x</code> should be one of the following: A directory with information for one patient, a directory with several sub-directories (one for each patient), or a zip file of such directories. Under Windows, if <code>x</code> is missing and <code>type="Pinnacle"</code>, <code>readDVH</code> opens a folder selector widget.</p>
</td></tr>
<tr><td><code id="readDVH_+3A_type">type</code></td>
<td>
<p><code>character</code>. Indicates which program the DVH text files were exported from. Supported: <code>"Cadplan"</code> (tested with version 6.4.7), <code>"Eclipse"</code> (tested with Varian Eclipse version 10-15), <code>"Masterplan"</code> (tested with OnCentra MasterPlan version 4.3), <code>"Pinnacle"</code> (tested with Pinnacle3 version 9, see Details), <code>"Monaco"</code> (tested with Elekta Monaco version 5), <code>"HiArt"</code> (TomoTherapy HiArt), <code>"RayStation"</code> (tested with RaySearch Labs RayStation version 9A), <code>"ProSoma"</code> (Medcom ProSoma), <code>"PRIMO"</code> (tested with version 0.3.1.1558).</p>
</td></tr>
<tr><td><code id="readDVH_+3A_planinfo">planInfo</code></td>
<td>
<p>Experimental: Either <code>FALSE</code> or <code>character</code> string. In the latter case, <code>readDVH</code> tries to extract additional information from the <code>Plan</code> field in the DVH file, e.g., the prescription dose for a sum plan or the boost quadrant. Undocumented, see source.</p>
</td></tr>
<tr><td><code id="readDVH_+3A_courseasid">courseAsID</code></td>
<td>
<p><code>logical</code>. If <code>TRUE</code>, the <code>Course</code> entry in the header section of a DVH file is appended to the regular patient ID. Currently supported only for <code>type="Eclipse"</code>.</p>
</td></tr>
<tr><td><code id="readDVH_+3A_add">add</code></td>
<td>
<p><code>DVHLstLst</code> object. Existing object that should be merged with the new data from the files.</p>
</td></tr>
<tr><td><code id="readDVH_+3A_...">...</code></td>
<td>
<p>Additional arguments passed on to <code><a href="base.html#topic+connections">file</a></code>. Specify UTF-8 file encoding with <code>encoding="UTF-8"</code> or <code>encoding="UTF-8-BOM"</code> (when a byte-order-mark is used). Passing additional arguments is currently not supported when reading Pinnacle files. Additional arguments are also used for <code>type="HiArt"</code> where a list <code>hiart</code> may be supplied that specifies patient IDs, absolute structure volumes, and prescription dose. Same for <code>type="RayStation"</code> with a list <code>"raystation"</code>. If Eclipse uncertainty plans are present, specify <code>uncertainty=TRUE</code> (see Details).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Absolute dose values need to be given in Gy, cGy, or eV/g for uncalibrated dose in DVHs exported by PRIMO. Absolute volume values need to be given in in cm^3.
</p>
<p>Differential DVHs are automatically converted to cumulative DVHs, but the differential DVH information is kept.
</p>
<p>Sum plans are supported.
</p>
<p>For Eclipse starting with version 13, the date format is locale dependent as it uses words for day and month. Importing those dates as class <code>Date</code> requires that the correct locale is set (see <code><a href="base.html#topic+locales">Sys.setlocale</a></code>), and that files containing accents are read using the correct encoding (see above). Otherwise, date is stored as a character string.
</p>
<p>For RayStation, only cumulative DVHs with absolute volume are currently supported. Volume is assumed to be measured in cm^3.
</p>
<p>For files with absolute volume exported from Masterplan and Tomo HiArt, you can specify <code>volume_from_dvh=TRUE</code> if the structure volume should be guessed from the maximal volume given in the DVH for each structure.
</p>
<p>Since files from HiArt, ProSoma and PRIMO do not contain info on patient ID, the current workaround is to generate a random ID.
</p>
<p>To export data from Tomo HiArt, copy to clipboard and then save to file from a text editor. Support for Tomo HiArt files is currently limited to those with absolute dose. Please send an anonymized sample file if you need to read files with relative dose. You can provide a list <code>hiart</code> with more information about patients and structures. The list should have one component for each file you import. Each component itself has to be a named list with optional components
</p>

<ul>
<li><p><code>date</code> - a character string like <code>"2022-01-16"</code> for the date
</p>
</li>
<li><p><code>patName</code> - a character string for patient name
</p>
</li>
<li><p><code>patID</code> - a character string for patient ID
</p>
</li>
<li><p><code>doseRx</code> - a character string like <code>"50.4Gy"</code> for prescription dose in the same dose unit as used in the DVHs
</p>
</li>
<li><p><code>structVol</code> - a named character vector like <code>c("PTV"=750, "LUNG"=1250)</code> giving the absolute structure volumes with names equal to structure names
</p>
</li>
<li><p><code>volumeUnit</code> - a character string, either <code>"CC"</code> or <code>"cm3"</code>, for the structure volume unit)
</p>
</li></ul>

<p>The same approach can be used for RayStation files with a list <code>raystation</code>.
</p>
<p>Pinnacle3 files have to be exported using its own scripting facility such that information from one patient is contained in one directory. A suitable export script is available on request from the package authors. The directory layout for one patient has to be as follows (experimental, likely to change in future versions):
</p>

<ul>
<li><p>Files (CSV format with column headers):
</p>

<ul>
<li><p><code>DoseInfo.csv</code> (variables <code>"PrescriptionDose cGy"</code>, <code>"NumberOfFractions"</code>, <code>"Dosis cGy"</code>)
</p>
</li>
<li><p><code>PatInfo.csv</code> (variables <code>"LastName"</code>, <code>"FirstName"</code>, <code>"MedicalRecordNumber"</code>)
</p>
</li>
<li><p><code>PlanInfo.csv</code> (variable <code>"PlanName"</code>)</p>
</li></ul>

</li>
<li><p>Directory: <code>Data</code>:
</p>

<ul>
<li><p><code>Info.csv</code> (variables <code>"Filename"</code>, <code>"RegionOfInterestName"</code>,  <code>"DoseMin cGy"</code>, <code>"DoseMax cGy"</code>, <code>"DoseMean cGy"</code>, <code>"Volume ccm"</code>)
</p>
</li>
<li><p>DVH1.csv, DVH2.csv, ...  - the actual DVH data files with names defined in <code>Info.csv</code> variable <code>"Filename"</code>. They should look like
<code style="white-space: pre;">&#8288;NumberOfDimensions = 2;
NumberOfPoints = 431;
Points[] ={
  0,0
  10,0
  ...
  4000,100
};
  &#8288;</code>
</p>
</li></ul>
</li></ul>



<h3>Value</h3>

<p>Returns an object of class <code>DVHLstLst</code>. This is a list (one component with class <code>DVHLst</code> for each original file from one patient) of lists (each component is an object of class <code>DVHs</code>). A <code>DVHs</code> object is a list with the following components:
</p>

<dl>
<dt><code>dvh</code></dt><dd><p><code>matrix</code> - cumulative DVH values</p>
</dd>
<dt><code>dvhDiff</code></dt><dd><p><code>matrix</code> - differential DVH values, only created a) if original file contained a differential DVH or b) by <code><a href="#topic+convertDVH">convertDVH</a></code></p>
</dd>
<dt><code>patID</code></dt><dd><p><code>character</code> string - patient ID</p>
</dd>
<dt><code>date</code></dt><dd><p><code>character</code> string - date of DVH export</p>
</dd>
<dt><code>type</code></dt><dd><p><code>character</code> string - cumulative or differential DVH</p>
</dd>
<dt><code>plan</code></dt><dd><p><code>character</code> string - plan name</p>
</dd>
<dt><code>course</code></dt><dd><p><code>character</code> string - course - currently Eclipse only</p>
</dd>
<dt><code>structure</code></dt><dd><p><code>character</code> string - structure name</p>
</dd>
<dt><code>structVol</code></dt><dd><p><code>numeric</code> - structure volume</p>
</dd>
<dt><code>doseUnit</code></dt><dd><p><code>character</code> string - measurement unit dose</p>
</dd>
<dt><code>volumeUnit</code></dt><dd><p><code>character</code> string - measurement unit volume</p>
</dd>
<dt><code>doseRx</code></dt><dd><p><code>numeric</code> - prescription dose</p>
</dd>
<dt><code>isoDoseRx</code></dt><dd><p><code>numeric</code> - iso-dose percentage</p>
</dd>
<dt><code>doseMin</code></dt><dd><p><code>numeric</code> - minimum dose from DVH file</p>
</dd>
<dt><code>doseMax</code></dt><dd><p><code>numeric</code> - maximum dose from DVH file</p>
</dd>
<dt><code>doseAvg</code></dt><dd><p><code>numeric</code> - average dose from DVH file</p>
</dd>
<dt><code>doseMed</code></dt><dd><p><code>numeric</code> - median dose from DVH file</p>
</dd>
<dt><code>doseSD</code></dt><dd><p><code>numeric</code> - dose standard deviation from DVH file</p>
</dd>
</dl>



<h3>See Also</h3>

<p><code><a href="base.html#topic+Sys.glob">Sys.glob</a></code>,
<code><a href="base.html#topic+readLines">readLines</a></code>,
<code><a href="#topic+print">print.DVHs</a></code>,
<code><a href="#topic+showDVH">showDVH</a></code>,
<code><a href="#topic+getMetric">getMetric</a></code>,
<code><a href="#topic+checkConstraint">checkConstraint</a></code>,
<code><a href="#topic+convertDVH">convertDVH</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# pick DVH files interactively
res &lt;- readDVH()
res

# read all txt files in subdirectory DVH
res &lt;- readDVH("DVH/*.txt", type="Eclipse")
res

## End(Not run)
</code></pre>

<hr>
<h2 id='runGUI'>Open web-based GUI in browser</h2><span id='topic+runGUI'></span>

<h3>Description</h3>

<p>Opens the web-based GUI in an external browser.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>runGUI(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="runGUI_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code><a href="shiny.html#topic+runApp">runApp</a></code>. Supply <code>port=80</code> if a web browser refuses to connect to the randomly chosen port for security reasons.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function calls <code><a href="shiny.html#topic+runApp">runApp</a></code> to run the included DVHshiny application. See <code>vignette("DVHshiny")</code> for documentation.
</p>


<h3>See Also</h3>

<p><code><a href="shiny.html#topic+runApp">runApp</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
runGUI()

## End(Not run)
</code></pre>

<hr>
<h2 id='saveConstraint'>Save constraint result to file</h2><span id='topic+saveConstraint'></span>

<h3>Description</h3>

<p>Saves results from <code><a href="#topic+checkConstraint">checkConstraint</a></code> to a text file.</p>


<h3>Usage</h3>

<pre><code class='language-R'>saveConstraint(x, ...)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="saveConstraint_+3A_x">x</code></td>
<td>
<p><code>data.frame</code> - the result from <code><a href="#topic+checkConstraint">checkConstraint</a></code>.</p>
</td></tr>
<tr><td><code id="saveConstraint_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code><a href="utils.html#topic+write.table">write.table</a></code> - e.g., <code>file="&lt;filename&gt;"</code> for the output filename, <code>dec="."</code> to define the decimal separator as point or <code>sep="\t"</code> to define the column sepator as tab.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is a wrapper for <code><a href="utils.html#topic+write.table">write.table</a></code>.</p>


<h3>See Also</h3>

<p><code><a href="utils.html#topic+write.table">write.table</a></code>,
<code><a href="#topic+checkConstraint">checkConstraint</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>res &lt;- checkConstraint(dataMZ, c("D10CC &lt; 10Gy", "V20Gy &lt; 20%"))
## Not run: 
saveConstraint(res, file="constrResults.txt", sep="\t")

## End(Not run)
</code></pre>

<hr>
<h2 id='saveDVH'>Save DVH diagram to file</h2><span id='topic+saveDVH'></span>

<h3>Description</h3>

<p>Saves one or multiple DVH diagrams to file.</p>


<h3>Usage</h3>

<pre><code class='language-R'>saveDVH(x, file="", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="saveDVH_+3A_x">x</code></td>
<td>
<p>A single <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code> object or a list of multiple <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code> objects as returned by <code><a href="#topic+showDVH">showDVH</a></code> or <code><a href="#topic+showConstraint">showConstraint</a></code>.</p>
</td></tr>
<tr><td><code id="saveDVH_+3A_file">file</code></td>
<td>
<p><code>character</code>. Path to file. The file-ending determines what kind of file is written, e.g., <code>"filename.pdf"</code> will write a pdf document, <code>"filename.jpg"</code> a JPEG image.</p>
</td></tr>
<tr><td><code id="saveDVH_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code><a href="ggplot2.html#topic+ggsave">ggsave</a></code>, e.g., <code>width</code> and <code>height</code> to determine the figure size.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is a wrapper for <code><a href="ggplot2.html#topic+ggsave">ggsave</a></code>.</p>


<h3>Value</h3>

<p>If <code>x</code> is a <code>list</code> of <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code> objects, one file is written for each list component. If <code>x</code> is a single <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code> object, one file is written.</p>


<h3>See Also</h3>

<p><code><a href="ggplot2.html#topic+ggsave">ggsave</a></code>,
<code><a href="#topic+showDVH">showDVH</a></code>,
<code><a href="#topic+showConstraint">showConstraint</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>res &lt;- showDVH(dataMZ, byPat=TRUE, structure=c("HEART", "AMYOCL"))
## Not run: 
saveDVH(res, "out.pdf")

## End(Not run)
</code></pre>

<hr>
<h2 id='saveMetric'>Save DVH metrics to file</h2><span id='topic+saveMetric'></span><span id='topic+saveMetric.data.frame'></span><span id='topic+saveMetric.list'></span>

<h3>Description</h3>

<p>Saves results from <code><a href="#topic+getMetric">getMetric</a></code> to a text file.</p>


<h3>Usage</h3>

<pre><code class='language-R'>saveMetric(x, file = "", ...)

## S3 method for class 'data.frame'
saveMetric(x, file = "", ...)

## S3 method for class 'list'
saveMetric(x, file = "", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="saveMetric_+3A_x">x</code></td>
<td>
<p><code>data.frame</code> or <code>list</code> - the result from <code><a href="#topic+getMetric">getMetric</a></code>.</p>
</td></tr>
<tr><td><code id="saveMetric_+3A_file">file</code></td>
<td>
<p><code>character</code>. Path to file.</p>
</td></tr>
<tr><td><code id="saveMetric_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code><a href="utils.html#topic+write.table">write.table</a></code> - e.g., <code>dec="."</code> to define the decimal separator as point or <code>sep="\t"</code> to define the column sepator as tab.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is a wrapper for <code><a href="utils.html#topic+write.table">write.table</a></code>.</p>


<h3>Value</h3>

<p>If <code>x</code> is a <code>list</code>, one text file is written for each list component. If <code>x</code> is a <code>data.frame</code>, one file is written.</p>


<h3>See Also</h3>

<p><code><a href="utils.html#topic+write.table">write.table</a></code>,
<code><a href="#topic+getMetric">getMetric</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>res &lt;- getMetric(dataMZ, c("D1CC", "V10%_CC"),
                 sortBy=c("metric", "structure"),
                 splitBy="patID")
## Not run: 
# not run
saveMetric(res, file="metricsResults.txt", sep="\t")

## End(Not run)
</code></pre>

<hr>
<h2 id='showConstraint'>Display constraints for cumulative dose-volume histograms</h2><span id='topic+showConstraint'></span><span id='topic+showConstraint.DVHs'></span><span id='topic+showConstraint.DVHLst'></span><span id='topic+showConstraint.DVHLstLst'></span>

<h3>Description</h3>

<p>Displays quality assurance constraints for cumulative dose-volume histograms: Either one diagram per patient - including multiple structures. Or one diagram per structure - including multiple patients.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>showConstraint(x, constr, byPat=TRUE, rel=TRUE, guessX=TRUE, guessY=TRUE,
               thresh=1, show=TRUE, visible=FALSE)

## S3 method for class 'DVHs'
showConstraint(x, constr, byPat=TRUE, rel=TRUE, guessX=TRUE, guessY=TRUE,
               thresh=1, show=TRUE, visible=FALSE)

## S3 method for class 'DVHLst'
showConstraint(x, constr, byPat=TRUE, rel=TRUE, guessX=TRUE, guessY=TRUE,
               thresh=1, show=TRUE, visible=FALSE)

## S3 method for class 'DVHLstLst'
showConstraint(x, constr, byPat=TRUE, rel=TRUE, guessX=TRUE, guessY=TRUE,
               thresh=1, show=TRUE, visible=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="showConstraint_+3A_x">x</code></td>
<td>
<p>A single DVH (object of class <code>DVHs</code>), multiple DVHs from one patient/structure (object of class <code>DVHLst</code>), or multiple DVHs from many patients/structures (object of class <code>DVHLstLst</code>). See <code><a href="#topic+readDVH">readDVH</a></code>. See Details.</p>
</td></tr>
<tr><td><code id="showConstraint_+3A_constr">constr</code></td>
<td>
<p>One or more constraints - given as a <code>character</code> vector or as a <code>data.frame</code>. See <code><a href="#topic+checkConstraint">checkConstraint</a></code> for their definition.</p>
</td></tr>
<tr><td><code id="showConstraint_+3A_bypat">byPat</code></td>
<td>
<p><code>logical</code>. Relevant if multiple DVHs are given. If <code>x</code> has class <code>DVHLstLst</code>: <code>byPat=TRUE</code> means that one diagram shows DVHs from one patient with multiple structures. <code>byPat=FALSE</code> means that one diagram shows DVHs for one structure from multiple patients.</p>
</td></tr>
<tr><td><code id="showConstraint_+3A_rel">rel</code></td>
<td>
<p><code>logical</code>. Show relative volume?</p>
</td></tr>
<tr><td><code id="showConstraint_+3A_guessx">guessX</code></td>
<td>
<p><code>logical</code>. Try to guess the best x-axis limits for better visibility of main DVH range? If <code>FALSE</code>, x-axis runs from 0 to maximum dose. If <code>TRUE</code>, x-axis runs from 0 to dose value where volume approaches 0. If a single number is given, it is interpreted as the maximum value. If a vector of two numbers is given, it is interpreted as the range of the axis.</p>
</td></tr>
<tr><td><code id="showConstraint_+3A_guessy">guessY</code></td>
<td>
<p><code>logical</code>. Try to guess the best y-axis limits? If a single number is given, it is interpreted as the maximum value. If a vector of two numbers is given, it is interpreted as the range of the axis.</p>
</td></tr>
<tr><td><code id="showConstraint_+3A_thresh">thresh</code></td>
<td>
<p><code>numeric</code> value. Relative volume threshold used with <code>guessX=TRUE</code>. Clip x-axis (+10%) such that the &quot;highest&quot; DVH is cut off at this relative volume.</p>
</td></tr>
<tr><td><code id="showConstraint_+3A_show">show</code></td>
<td>
<p><code>logical</code>. If <code>TRUE</code>, diagrams are shown, if <code>FALSE</code> diagrams are not shown - only <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code> diagram objects are silently returned.</p>
</td></tr>
<tr><td><code id="showConstraint_+3A_visible">visible</code></td>
<td>
<p><code>logical</code>. Return <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code> diagram object visibly or invisibly. <code>show=FALSE</code> with <code>visible=TRUE</code> is useful for zooming in shiny apps.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Constraints are shown as points in the cumulative DVH with an additional arrow indicating where the cumulative DVH curve should lie relative to the constraint. On each DVH curve, the point with the minimal Euclidean distance to the constraint is indicated. Note that, visually, this point only has the minimal apparent distance if the aspect ratio of the diagram is 1.
</p>
<p>If multiple diagrams are produced, they are shown in the same graphics device. If interactive inspection is required, make sure you use an R development environment that saves previous diagrams and allows navigating between them - e.g., <a href="https://www.rstudio.com/products/rstudio/download/">RStudio</a> or <a href="https://www.getarchitect.io/">OpenAnalytics Architect</a>.
</p>


<h3>Value</h3>

<p>Silently returns a <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code> diagram object, or - when multiple diagrams are constructed - a list of <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code> diagram objects.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+checkConstraint">checkConstraint</a></code>,
<code><a href="#topic+saveDVH">saveDVH</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(dataMZ)

# define constraints
constr &lt;- data.frame(
    patID=c("P123", "P234"),
    structure=c("HEART", "*"),
    constraint=c("D1CC &lt; 20Gy", "V10% &gt; 8CC"),
    stringsAsFactors=FALSE)       # this is important
showConstraint(dataMZ, constr=constr, byPat=FALSE)
</code></pre>

<hr>
<h2 id='showDVH'>Display dose volume histograms</h2><span id='topic+showDVH'></span><span id='topic+showDVH.DVHs'></span><span id='topic+showDVH.DVHLst'></span><span id='topic+showDVH.DVHLstLst'></span>

<h3>Description</h3>

<p>Displays dose volume histograms: Either one diagram per patient - including multiple structures. Or one diagram per structure - including multiple patients.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>showDVH(x, cumul=TRUE, byPat=TRUE, patID=NULL, structure=NULL,
        rel=TRUE, guessX=TRUE, guessY=TRUE, thresh=1, addMSD=FALSE,
        show=TRUE, visible=FALSE, fixed=TRUE)

## S3 method for class 'DVHs'
showDVH(x, cumul=TRUE, byPat=TRUE, patID=NULL, structure=NULL,
        rel=TRUE, guessX=TRUE, guessY=TRUE, thresh=1, addMSD=FALSE,
        show=TRUE, visible=FALSE, fixed=TRUE)

## S3 method for class 'DVHLst'
showDVH(x, cumul=TRUE, byPat=TRUE, patID=NULL, structure=NULL,
        rel=TRUE, guessX=TRUE, guessY=TRUE, thresh=1, addMSD=FALSE,
        show=TRUE, visible=FALSE, fixed=TRUE)

## S3 method for class 'DVHLstLst'
showDVH(x, cumul=TRUE, byPat=TRUE, patID=NULL, structure=NULL,
        rel=TRUE, guessX=TRUE, guessY=TRUE, thresh=1, addMSD=FALSE,
        show=TRUE, visible=FALSE, fixed=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="showDVH_+3A_x">x</code></td>
<td>
<p>A single DVH (object of class <code>DVHs</code>), multiple DVHs from one patient/structure (object of class <code>DVHLst</code>), or multiple DVHs from many patients/structures (object of class <code>DVHLstLst</code>). See <code><a href="#topic+readDVH">readDVH</a></code>. See Details.</p>
</td></tr>
<tr><td><code id="showDVH_+3A_cumul">cumul</code></td>
<td>
<p><code>logical</code>. Show cumulative or differential (per unit dose) DVH?</p>
</td></tr>
<tr><td><code id="showDVH_+3A_bypat">byPat</code></td>
<td>
<p><code>logical</code>. Relevant if multiple DVHs are given. If <code>x</code> has class <code>DVHLstLst</code>: <code>byPat=TRUE</code> means that one diagram shows DVHs from one patient with multiple structures. <code>byPat=FALSE</code> means that one diagram shows DVHs for one structure from multiple patients.</p>
</td></tr>
<tr><td><code id="showDVH_+3A_patid">patID</code></td>
<td>
<p><code>character</code> vector. Show diagram for these patients only. If missing, all patients are shown. Can be a regular expression with <code>fixed=FALSE</code>, see <code><a href="base.html#topic+regex">regex</a></code>.</p>
</td></tr>
<tr><td><code id="showDVH_+3A_structure">structure</code></td>
<td>
<p><code>character</code> vector. Show diagram for these structures only. If missing, all structures are shown. Can be a regular expression with <code>fixed=FALSE</code>, see <code><a href="base.html#topic+regex">regex</a></code>.</p>
</td></tr>
<tr><td><code id="showDVH_+3A_rel">rel</code></td>
<td>
<p><code>logical</code>. Show relative volume?</p>
</td></tr>
<tr><td><code id="showDVH_+3A_guessx">guessX</code></td>
<td>
<p><code>logical</code>. Try to guess the best x-axis limits for better visibility of main DVH range? If <code>FALSE</code>, x-axis runs from 0 to maximum dose. If <code>TRUE</code>, x-axis runs from 0 to dose value where volume approaches 0. If a single number is given, it is interpreted as the maximum value. If a vector of two numbers is given, it is interpreted as the range of the axis.</p>
</td></tr>
<tr><td><code id="showDVH_+3A_guessy">guessY</code></td>
<td>
<p><code>logical</code>. Try to guess the best y-axis limits? If a single number is given, it is interpreted as the maximum value. If a vector of two numbers is given, it is interpreted as the range of the axis.</p>
</td></tr>
<tr><td><code id="showDVH_+3A_thresh">thresh</code></td>
<td>
<p><code>numeric</code> value. Relative volume threshold used with <code>guessX=TRUE</code>. Clip x-axis (+5%) such that the &quot;highest&quot; DVH is cut off at this relative volume.</p>
</td></tr>
<tr><td><code id="showDVH_+3A_addmsd">addMSD</code></td>
<td>
<p><code>logical</code>. If <code>TRUE</code>, diagram shows the point-wise mean DVH as well as shaded areas for point-wise 1-standard deviation and 2-standard deviations around this mean. See details.</p>
</td></tr>
<tr><td><code id="showDVH_+3A_show">show</code></td>
<td>
<p><code>logical</code>. If <code>TRUE</code>, diagrams are shown, if <code>FALSE</code> diagrams are not shown - only <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code> diagram objects are silently returned.</p>
</td></tr>
<tr><td><code id="showDVH_+3A_visible">visible</code></td>
<td>
<p><code>logical</code>. Return <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code> diagram object visibly or invisibly. <code>show=FALSE</code> with <code>visible=TRUE</code> is useful for zooming in shiny apps.</p>
</td></tr>
<tr><td><code id="showDVH_+3A_fixed">fixed</code></td>
<td>
<p><code>logical</code>. Use <code>fixed=FALSE</code> for regular expression matching of <code>patID</code> and <code>structure</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If multiple diagrams are produced, they are shown in the same graphics device. If interactive inspection is required, make sure you use an R development environment that saves previous diagrams and allows navigating between them - e.g., <a href="https://www.rstudio.com/products/rstudio/download/">RStudio</a> or <a href="https://www.getarchitect.io/">OpenAnalytics Architect</a>.
</p>
<p>For <code>addMSD=TRUE</code>, the number of DVH nodes (dose values) is reduced by 1/3 of the maximum number of nodes in <code>x</code>. Before calculating the point-wise mean and SD, DVHs in <code>x</code> are first linearly interpolated using the same set of nodes.
</p>


<h3>Value</h3>

<p>Silently returns a <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code> diagram object, or - when multiple diagrams are constructed - a list of <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code> diagram objects.
</p>


<h3>See Also</h3>

<p><code><a href="ggplot2.html#topic+ggplot">ggplot</a></code>,
<code><a href="#topic+readDVH">readDVH</a></code>,
<code><a href="#topic+saveDVH">saveDVH</a></code>,
<code><a href="#topic+getMeanDVH">getMeanDVH</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>showDVH(dataMZ, byPat=TRUE, structure=c("HEART", "AMYOCL"))

# matches patients P123 and P234
showDVH(dataMZ, byPat=FALSE, patID="23", fixed=FALSE)
</code></pre>

<hr>
<h2 id='showMeanDVH'>Show average dose volume histograms</h2><span id='topic+showMeanDVH'></span>

<h3>Description</h3>

<p>Displays average dose volume histograms grouped by patients or structures.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>showMeanDVH(x, byPat=TRUE, patID=NULL, structure=NULL,
            rel=TRUE, guessX=TRUE, thresh=1, show=TRUE, fixed=TRUE,
            showSD=TRUE, color=TRUE, facet=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="showMeanDVH_+3A_x">x</code></td>
<td>
<p>A data frame as returned by <code><a href="#topic+getMeanDVH">getMeanDVH</a></code> or a list of such data frames.</p>
</td></tr>
<tr><td><code id="showMeanDVH_+3A_bypat">byPat</code></td>
<td>
<p><code>logical</code>. Relevant if multiple DVHs are given. If <code>x</code> has class <code>DVHLstLst</code>: <code>byPat=TRUE</code> means that one diagram shows DVHs from one patient with multiple structures. <code>byPat=FALSE</code> means that one diagram shows DVHs for one structure from multiple patients.</p>
</td></tr>
<tr><td><code id="showMeanDVH_+3A_patid">patID</code></td>
<td>
<p><code>character</code> vector. Show diagram for these patients only. If missing, all patients are shown. Can be a regular expression with <code>fixed=FALSE</code>, see <code><a href="base.html#topic+regex">regex</a></code>.</p>
</td></tr>
<tr><td><code id="showMeanDVH_+3A_structure">structure</code></td>
<td>
<p><code>character</code> vector. Show diagram for these structures only. If missing, all structures are shown. Can be a regular expression with <code>fixed=FALSE</code>, see <code><a href="base.html#topic+regex">regex</a></code>.</p>
</td></tr>
<tr><td><code id="showMeanDVH_+3A_rel">rel</code></td>
<td>
<p><code>logical</code>. Show relative volume?</p>
</td></tr>
<tr><td><code id="showMeanDVH_+3A_guessx">guessX</code></td>
<td>
<p><code>logical</code>. Try to clip the x-axis for better visibility of main DVH range?</p>
</td></tr>
<tr><td><code id="showMeanDVH_+3A_thresh">thresh</code></td>
<td>
<p><code>numeric</code> value. Relative volume threshold used with <code>guessX=TRUE</code>. Clip x-axis (+10%) such that the &quot;highest&quot; DVH is cut off at this relative volume.</p>
</td></tr>
<tr><td><code id="showMeanDVH_+3A_show">show</code></td>
<td>
<p><code>logical</code>. If <code>TRUE</code>, diagrams are shown, if <code>FALSE</code> diagrams are not shown - only <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code> diagram objects are silently returned.</p>
</td></tr>
<tr><td><code id="showMeanDVH_+3A_fixed">fixed</code></td>
<td>
<p><code>logical</code>. Use <code>fixed=FALSE</code> for regular expression matching of <code>patID</code> and <code>structure</code>.</p>
</td></tr>
<tr><td><code id="showMeanDVH_+3A_showsd">showSD</code></td>
<td>
<p><code>logical</code>. If <code>TRUE</code>, diagram shows shaded areas for point-wise 1-standard deviation and 2-standard deviations around this mean. See details.</p>
</td></tr>
<tr><td><code id="showMeanDVH_+3A_color">color</code></td>
<td>
<p><code>logical</code>. If <code>TRUE</code>, diagram uses color to distinguish groups. If <code>FALSE</code>, colors are greyscale, and line types are used to distinguish groups.</p>
</td></tr>
<tr><td><code id="showMeanDVH_+3A_facet">facet</code></td>
<td>
<p><code>logical</code>. If <code>TRUE</code>, different structures (for <code>byPat=FALSE</code> or different patients (for <code>byPat=TRUE</code> go into separate panels using <code><a href="ggplot2.html#topic+facet_grid">facet_grid</a></code>. If <code>FALSE</code>, everything is shown in the same panel.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>TODO
</p>


<h3>Value</h3>

<p>Silently returns a <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code> diagram object, or - when multiple diagrams are constructed - a list of <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code> diagram objects.
</p>


<h3>See Also</h3>

<p><code><a href="ggplot2.html#topic+ggplot">ggplot</a></code>,
<code><a href="#topic+showDVH">showDVH</a></code>,
<code><a href="#topic+getMeanDVH">getMeanDVH</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># mean DVH for HEART and AMYOCL averaged over patients
res &lt;- getMeanDVH(dataMZ, byPat=FALSE, structure=c("HEART", "AMYOCL"))
showMeanDVH(res)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
