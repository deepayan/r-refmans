<!DOCTYPE html><html><head><title>Help for package admiralonco</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {admiralonco}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#admiral_adrs'><p>Response Analysis Dataset</p></a></li>
<li><a href='#admiralonco-package'><p>admiralonco: Oncology Extension Package for ADaM in 'R' Asset Library</p></a></li>
<li><a href='#aval_resp'><p>Map Character Response Values to Numeric Values</p></a></li>
<li><a href='#death_event'><p>Pre-Defined Time-to-Event Source Objects</p></a></li>
<li><a href='#derive_param_bor'><p>Adds a Parameter for Best Overall Response (without confirmation)</p></a></li>
<li><a href='#derive_param_clinbenefit'><p>Adds a Parameter for Clinical Benefit</p></a></li>
<li><a href='#derive_param_confirmed_bor'><p>Adds a Parameter for Confirmed Best Overall Response</p></a></li>
<li><a href='#derive_param_confirmed_resp'><p>Adds a Parameter for Confirmed Response</p></a></li>
<li><a href='#derive_param_response'><p>Adds a Parameter Indicating If a Subject Had a Response before Progressive</p>
Disease</a></li>
<li><a href='#filter_pd'><p>Filter up to First PD (Progressive Disease) Date</p></a></li>
<li><a href='#get_crpr_dataset'><p>Get CR Records Followed by PR That Lead to a Prior Error</p></a></li>
<li><a href='#rsp_y'><p>Pre-Defined Response Event Objects</p></a></li>
<li><a href='#signal_crpr'><p>Signal CR Records Followed by PR</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Oncology Extension Package for ADaM in 'R' Asset Library</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Programming oncology specific Clinical Data Interchange Standards Consortium
    (CDISC) compliant Analysis Data Model (ADaM) datasets in 'R'. ADaM datasets are a
    mandatory part of any New Drug or Biologics License Application submitted to the
    United States Food and Drug Administration (FDA). Analysis derivations are
    implemented in accordance with the "Analysis Data Model Implementation Guide"
    (CDISC Analysis Data Model Team (2021), <a href="https://www.cdisc.org/standards/foundational/adam">https://www.cdisc.org/standards/foundational/adam</a>).
    The package is an extension package of the 'admiral' package.</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License (&ge; 2)</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/pharmaverse/admiralonco/issues">https://github.com/pharmaverse/admiralonco/issues</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://pharmaverse.github.io/admiralonco/">https://pharmaverse.github.io/admiralonco/</a>,
<a href="https://github.com/pharmaverse/admiralonco">https://github.com/pharmaverse/admiralonco</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5)</td>
</tr>
<tr>
<td>Imports:</td>
<td>admiral (&ge; 1.0.0), admiraldev (&ge; 1.0.0), dplyr (&ge; 0.8.4),
lifecycle (&ge; 0.1.0), lubridate (&ge; 1.7.4), magrittr (&ge; 1.5),
rlang (&ge; 0.4.4), tidyselect (&ge; 1.0.0)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>pharmaversesdtm, pharmaverseadam, devtools, diffdf, lintr,
pkgdown, testthat (&ge; 3.0.0), knitr, methods, miniUI,
rmarkdown, roxygen2, spelling, stringr, tibble, usethis, covr,
DT</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Config/Needs/website:</td>
<td>gert</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-12-19 17:18:27 UTC; bundfuss</td>
</tr>
<tr>
<td>Author:</td>
<td>Stefan Bundfuss [aut, cre],
  Ross Farrugia [aut],
  Amit Jain [aut],
  Andrew Smith [aut],
  Teckla Akinyi [aut],
  Samia Kabi [aut],
  Stephen Gormley [aut],
  Hinal Patel [aut],
  Vinh Nguyen [aut],
  Olga Starostecka [ctb],
  Uwe Bader [ctb],
  Karl Kennedy [ctb],
  Edoardo Mancini [ctb],
  Matt Marino [ctb],
  Gopi Vegesna [ctb],
  Thomas Neitmann [ctb],
  Annie Yang [ctb],
  Konstantina Koukourikou [ctb],
  Pavan Kumar [ctb],
  Liming Jin [ctb],
  Yirong Cao [ctb],
  Zhang Kangjie [ctb],
  F. Hoffmann-La Roche AG [cph, fnd],
  GlaxoSmithKline LLC [cph, fnd],
  Amgen Inc. [cph, fnd],
  Bristol Myers Squibb [cph, fnd]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Stefan Bundfuss &lt;stefan.bundfuss@roche.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-12-20 10:00:06 UTC</td>
</tr>
</table>
<hr>
<h2 id='admiral_adrs'>Response Analysis Dataset</h2><span id='topic+admiral_adrs'></span>

<h3>Description</h3>

<p>An example response analysis dataset
</p>


<h3>Usage</h3>

<pre><code class='language-R'>admiral_adrs
</code></pre>


<h3>Format</h3>

<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 3694 rows and 75 columns.
</p>


<h3>Source</h3>

<p>Derived from the <code>adsl</code>, <code>rs</code> and <code>tu</code> datasets using <code>{admiralonco}</code>
(<a href="https://github.com/pharmaverse/admiralonco/blob/main/inst/templates/ad_adrs.R">https://github.com/pharmaverse/admiralonco/blob/main/inst/templates/ad_adrs.R</a>)
</p>

<hr>
<h2 id='admiralonco-package'>admiralonco: Oncology Extension Package for ADaM in 'R' Asset Library</h2><span id='topic+admiralonco'></span><span id='topic+admiralonco-package'></span>

<h3>Description</h3>

<p><img src="../help/figures/logo.png" style='float: right' alt='logo' width='120' />
</p>
<p>Programming oncology specific Clinical Data Interchange Standards Consortium (CDISC) compliant Analysis Data Model (ADaM) datasets in 'R'. ADaM datasets are a mandatory part of any New Drug or Biologics License Application submitted to the United States Food and Drug Administration (FDA). Analysis derivations are implemented in accordance with the &quot;Analysis Data Model Implementation Guide&quot; (CDISC Analysis Data Model Team (2021), <a href="https://www.cdisc.org/standards/foundational/adam">https://www.cdisc.org/standards/foundational/adam</a>). The package is an extension package of the 'admiral' package.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Stefan Bundfuss <a href="mailto:stefan.bundfuss@roche.com">stefan.bundfuss@roche.com</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> Ross Farrugia
</p>
</li>
<li><p> Amit Jain
</p>
</li>
<li><p> Andrew Smith
</p>
</li>
<li><p> Teckla Akinyi
</p>
</li>
<li><p> Samia Kabi
</p>
</li>
<li><p> Stephen Gormley
</p>
</li>
<li><p> Hinal Patel
</p>
</li>
<li><p> Vinh Nguyen
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> Olga Starostecka [contributor]
</p>
</li>
<li><p> Uwe Bader [contributor]
</p>
</li>
<li><p> Karl Kennedy [contributor]
</p>
</li>
<li><p> Edoardo Mancini [contributor]
</p>
</li>
<li><p> Matt Marino [contributor]
</p>
</li>
<li><p> Gopi Vegesna [contributor]
</p>
</li>
<li><p> Thomas Neitmann [contributor]
</p>
</li>
<li><p> Annie Yang [contributor]
</p>
</li>
<li><p> Konstantina Koukourikou [contributor]
</p>
</li>
<li><p> Pavan Kumar [contributor]
</p>
</li>
<li><p> Liming Jin [contributor]
</p>
</li>
<li><p> Yirong Cao [contributor]
</p>
</li>
<li><p> Zhang Kangjie [contributor]
</p>
</li>
<li><p> F. Hoffmann-La Roche AG [copyright holder, funder]
</p>
</li>
<li><p> GlaxoSmithKline LLC [copyright holder, funder]
</p>
</li>
<li><p> Amgen Inc. [copyright holder, funder]
</p>
</li>
<li><p> Bristol Myers Squibb [copyright holder, funder]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://pharmaverse.github.io/admiralonco/">https://pharmaverse.github.io/admiralonco/</a>
</p>
</li>
<li> <p><a href="https://github.com/pharmaverse/admiralonco">https://github.com/pharmaverse/admiralonco</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/pharmaverse/admiralonco/issues">https://github.com/pharmaverse/admiralonco/issues</a>
</p>
</li></ul>


<hr>
<h2 id='aval_resp'>Map Character Response Values to Numeric Values</h2><span id='topic+aval_resp'></span>

<h3>Description</h3>

<p>Map character response values like <code>"PR"</code> or <code>"SD"</code> to numeric values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>aval_resp(arg)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="aval_resp_+3A_arg">arg</code></td>
<td>
<p>Character vector</p>
</td></tr>
</table>


<h3>Value</h3>


<ul>
<li> <p><code>1</code> if <code>arg</code> equals <code>"CR"</code>,
</p>
</li>
<li> <p><code>2</code> if <code>arg</code> equals <code>"PR"</code>,
</p>
</li>
<li> <p><code>3</code> if <code>arg</code> equals <code>"SD"</code>,
</p>
</li>
<li> <p><code>4</code> if <code>arg</code> equals <code>"NON-CR/NON-PD"</code>,
</p>
</li>
<li> <p><code>5</code> if <code>arg</code> equals <code>"PD"</code>,
</p>
</li>
<li> <p><code>6</code> if <code>arg</code> equals <code>"NE"</code>,
</p>
</li>
<li> <p><code>7</code> if <code>arg</code> equals <code>"MISSING"</code>,
</p>
</li>
<li> <p><code>NA_real_</code> otherwise
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Stefan Bundfuss
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
aval_resp(c("CR", "PR", "SD", "NON-CR/NON-PD", "PD", "NE", "MISSING", "ND", NA_character_))
</code></pre>

<hr>
<h2 id='death_event'>Pre-Defined Time-to-Event Source Objects</h2><span id='topic+death_event'></span><span id='topic+lastalive_censor'></span><span id='topic+pd_event'></span><span id='topic+lasta_censor'></span><span id='topic+rand_censor'></span><span id='topic+trts_censor'></span>

<h3>Description</h3>

<p>These pre-defined <code>tte_source</code> objects can be used as input to <code>admiral::derive_param_tte()</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>death_event

lastalive_censor

pd_event

lasta_censor

rand_censor

trts_censor
</code></pre>


<h3>Details</h3>

<p>To see the definition of the various objects simply print the object in the
R console, e.g. <code>print(death_event)</code>. For details of how to use these objects
please refer to <code><a href="admiral.html#topic+derive_param_tte">admiral::derive_param_tte()</a></code>.
</p>
<p>Printing an object will display input dataset_name, filter (if applicable), date variable,
and appropriate values for <code>EVNTDESC</code>, <code>CNSDTDSC</code>, <code>SRCDOM</code>, <code>SRCVAR</code>, and <code>SRCSEQ</code>.
</p>


<h3>See Also</h3>

<p><code><a href="admiral.html#topic+derive_param_tte">admiral::derive_param_tte()</a></code>, <code><a href="admiral.html#topic+tte_source">admiral::tte_source()</a></code>, <code><a href="admiral.html#topic+event_source">admiral::event_source()</a></code>,
<code><a href="admiral.html#topic+censor_source">admiral::censor_source()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># This shows the definition of all pre-defined `tte_source` objects that ship
# with {admiralonco}
for (obj in admiral::list_tte_source_objects(package = "admiralonco")$object) {
  cat(obj, "\n")
  print(get(obj))
  cat("\n")
}
</code></pre>

<hr>
<h2 id='derive_param_bor'>Adds a Parameter for Best Overall Response (without confirmation)</h2><span id='topic+derive_param_bor'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#superseded"><img src="../help/figures/lifecycle-superseded.svg" alt='[Superseded]' /></a> The <code>derive_param_bor()</code> function has been
superseded in favor of <code>derive_extreme_event()</code>.
</p>
<p>Adds a parameter for best overall response, without confirmation, optionally up to
first progressive disease
</p>


<h3>Usage</h3>

<pre><code class='language-R'>derive_param_bor(
  dataset,
  dataset_adsl,
  filter_source,
  source_pd = NULL,
  source_datasets = NULL,
  reference_date,
  ref_start_window,
  missing_as_ne = FALSE,
  aval_fun,
  set_values_to,
  subject_keys = get_admiral_option("subject_keys")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="derive_param_bor_+3A_dataset">dataset</code></td>
<td>
<p>The input dataframe from which the Best Overall Response will
be derived from and added to.
</p>
<p>The columns <code>PARAMCD</code>, <code>ADT</code>, and <code>AVALC</code>and the columns specified in
<code>subject_keys</code> and <code>reference_date</code> are expected.
</p>
<p>After applying <code>filter_source</code> and/or <code>source_pd</code> the column <code>ADT</code> and the
columns specified by <code>subject_keys</code> must be a unique key of the dataframe.
</p>
<p><em>Permitted Values:</em> a <code>data.frame()</code> object</p>
</td></tr>
<tr><td><code id="derive_param_bor_+3A_dataset_adsl">dataset_adsl</code></td>
<td>
<p>ADSL input dataset.
</p>
<p>The columns specified in the subject_keys argument are expected. For each subject in
the passed <code>dataset</code> a new row is added to the input <code>dataset</code>. Columns
in <code>dataset_adsl</code> that also appear in <code>dataset</code> will be populated with the
appropriate subject-specific value for these new rows.
</p>
<p><em>Permitted Values:</em> a <code>data.frame()</code> object</p>
</td></tr>
<tr><td><code id="derive_param_bor_+3A_filter_source">filter_source</code></td>
<td>
<p>Filter to be applied to <code>dataset</code> to derive the
Best Overall Response</p>
</td></tr>
<tr><td><code id="derive_param_bor_+3A_source_pd">source_pd</code></td>
<td>
<p>Date of first progressive disease (PD)
</p>
<p>If the parameter is specified, the observations of the input <code>dataset</code> for
deriving the new parameter are restricted to observations up to the
specified date. Observations at the specified date are included. For
subjects without first PD date all observations are take into account.
</p>
<p><em>Permitted Values:</em> a <code>date_source</code> object (see <code>date_source()</code>
for details)</p>
</td></tr>
<tr><td><code id="derive_param_bor_+3A_source_datasets">source_datasets</code></td>
<td>
<p>Source dataframe to be used to calculate the
first PD date
</p>
<p>A named list of dataframes is expected (although for BOR) only one dataframe is
needed. It links the <code>dataset_name</code> from <code>source_pd</code> with an existing dataframe.
</p>
<p>For example if <code>source_pd = pd_date</code> with
</p>
<div class="sourceCode r"><pre>pd_date &lt;- date_source(
  dataset_name = "adrs",
  date = ADT,
  filter = PARAMCD == PD
)
</pre></div>
<p>and the actual response dataframe in the script is <code>myadrs</code>, <code>source_datasets = list(adrs = myadrs)</code> should be specified.</p>
</td></tr>
<tr><td><code id="derive_param_bor_+3A_reference_date">reference_date</code></td>
<td>
<p>Reference date
</p>
<p>The reference date is used along with <code>ref_start_window</code> to determine those
records that occur before and after <code>ADT</code> (see Details section for further
information). Usually it is treatment start date (<code>TRTSDT</code>) or
randomization date (<code>RANDDT</code>).
</p>
<p><em>Permitted Values:</em> a numeric date column</p>
</td></tr>
<tr><td><code id="derive_param_bor_+3A_ref_start_window">ref_start_window</code></td>
<td>
<p>Stable disease time window
</p>
<p>The ref_start_window is used along with <code>reference_date</code> to determine those
records that occur before and after <code>ADT</code> (i.e. for a record determine
whether <code>ADT</code> &gt;= <code>reference_date</code> + <code>ref_start_window</code>),
see Details section for further information.
</p>
<p><em>Permitted Values:</em> a non-negative numeric scalar</p>
</td></tr>
<tr><td><code id="derive_param_bor_+3A_missing_as_ne">missing_as_ne</code></td>
<td>
<p>Consider no assessments as <code>"NE"</code>?
</p>
<p>If the argument is set to <code>TRUE</code>, the response is set to <code>"NE"</code> for
subjects in <code>dataset_adsl</code> without an assessment in the <code>dataset</code> after the
filter has been applied. Otherwise, the response is set to <code>"MISSING"</code>
for these subjects.
</p>
<p><em>Permitted Values:</em> a logical scalar</p>
</td></tr>
<tr><td><code id="derive_param_bor_+3A_aval_fun">aval_fun</code></td>
<td>
<p><em>Deprecated</em>, please use <code>set_values_to</code> instead.
</p>
<p>Function to map character analysis value (<code>AVALC</code>) to numeric analysis
value (<code>AVAL</code>)
</p>
<p>The (first) argument of the function must expect a character vector and the
function must return a numeric vector.</p>
</td></tr>
<tr><td><code id="derive_param_bor_+3A_set_values_to">set_values_to</code></td>
<td>
<p>New columns to set
</p>
<p>A named list returned by <code>exprs()</code> defining the columns to be set for the
new parameter, e.g. <code>exprs(PARAMCD = "BOR", PARAM = "Best Overall Response")</code> is expected. The values must be symbols, character strings,
numeric values, or <code>NA</code>.</p>
</td></tr>
<tr><td><code id="derive_param_bor_+3A_subject_keys">subject_keys</code></td>
<td>
<p>Columns to uniquely identify a subject
</p>
<p><em>Permitted Values:</em> A list of symbols created using <code>exprs()</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Calculates the best overall response (BOR) parameter, as detailed below.
</p>
<p>Records after PD can be removed using the source_pd and source_datasets
arguments.
</p>
<p>Note:
</p>

<ol>
<li><p> All <code>CR</code>, <code>PR</code> and <code>PD</code> response records are considered for Best Overall Response.
</p>
</li>
<li><p> All <code>SD</code> or <code>NON-CR/NON-PD</code> records where <code>ADT</code> &gt;= <code>reference_date</code> +
<code>ref_start_window</code> are also considered for Best Overall Response.
</p>
</li>
<li><p> Subjects with <strong>ONLY</strong> an <code>SD</code> or <code>NON-CR/NON-PD</code> records where <code>ADT</code> &lt;
<code>reference_date</code> + <code>ref_start_window</code> are assigned a Best Overall Response of <code>NE</code>.
</p>
</li>
<li><p> The Best Response, from the records in steps 1 to 3, is then selected in the following
order of preference: CR, PR, SD, NON-CR/NON-PD, PD, NE, MISSING
</p>
</li>
<li><p> The <code>AVAL</code> column is added and set using the <code>aval_fun(AVALC)</code> function
</p>
</li>
<li><p> The columns specified by the <code>set_values_to</code> parameter and records
are added to the dataframe passed into the <code>dataset</code> argument
</p>
</li></ol>

<p>Note: Any responses of SD or NON-CR/NON-PD that occur before <code>reference_date</code> +
<code>ref_start_window</code> are ignored in the calculation of BOR. All other responses are included
in the calculation of BOR, irrespective of the number of days from the reference date.
</p>
<p>Also Note: All columns from the input dataset are kept. For subjects with no records in
the input dataset (after the filter is applied) all columns are kept from ADSL which are
also in the input dataset.  Columns which are not to be populated for the new parameter
or populated differently (e.g. <code>RSSTRESC</code>, <code>VISIT</code>, <code>PARCATy</code>, <code>ANLzzFL</code>, ...) should be
overwritten using the <code>set_values_to</code> parameter.
</p>


<h3>Value</h3>

<p>The dataframe passed in the <code>dataset</code> argument with additional columns and/or
rows as set in the <code>set_values_to</code> argument.
</p>


<h3>Author(s)</h3>

<p>Stephen Gormley
</p>


<h3>See Also</h3>

<p>Other superseded: 
<code><a href="#topic+derive_param_clinbenefit">derive_param_clinbenefit</a>()</code>,
<code><a href="#topic+derive_param_confirmed_bor">derive_param_confirmed_bor</a>()</code>,
<code><a href="#topic+derive_param_confirmed_resp">derive_param_confirmed_resp</a>()</code>,
<code><a href="#topic+derive_param_response">derive_param_response</a>()</code>,
<code><a href="#topic+filter_pd">filter_pd</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(magrittr)
library(dplyr)
library(tibble)
library(lubridate)
library(admiral)

# Create ADSL dataset
adsl &lt;- tribble(
  ~USUBJID, ~TRTSDTC,
  "1",      "2020-01-01",
  "2",      "2019-12-12",
  "3",      "2019-11-11",
  "4",      "2019-12-30",
  "5",      "2020-01-01",
  "6",      "2020-02-02",
  "7",      "2020-02-02",
  "8",      "2020-04-01"
) %&gt;%
  mutate(
    TRTSDT = ymd(TRTSDTC),
    STUDYID = "XX1234"
  )

# Create ADRS dataset
ovr_obs &lt;- tribble(
  ~USUBJID, ~ADTC, ~AVALC, ~ANL01FL,
  "1", "2020-01-01", "PR", "Y",
  "1", "2020-02-01", "CR", "Y",
  "1", "2020-02-16", "NE", "Y",
  "1", "2020-03-01", "CR", "Y",
  "1", "2020-04-01", "SD", "Y",
  "2", "2020-01-01", "SD", "Y",
  "2", "2020-02-01", "PR", "Y",
  "2", "2020-03-01", "SD", "Y",
  "2", "2020-03-13", "CR", "Y",
  "3", "2019-11-12", "CR", "Y",
  "3", "2019-12-02", "CR", "Y",
  "3", "2020-01-01", "SD", "Y",
  "4", "2020-01-01", "PR", "Y",
  "4", "2020-03-01", "SD", "N",
  "4", "2020-04-01", "SD", "Y",
  "4", "2020-05-01", "PR", "Y",
  "4", "2020-05-15", "NON-CR/NON-PD", "Y",
  "5", "2020-01-01", "PR", "Y",
  "5", "2020-01-10", "SD", "Y",
  "5", "2020-01-20", "PR", "Y",
  "5", "2020-05-15", "NON-CR/NON-PD", "Y",
  "6", "2020-02-06", "PR", "Y",
  "6", "2020-02-16", "CR", "Y",
  "6", "2020-03-30", "PR", "Y",
  "6", "2020-04-12", "PD", "Y",
  "6", "2020-05-01", "CR", "Y",
  "6", "2020-06-01", "CR", "Y",
  "7", "2020-02-06", "PR", "Y",
  "7", "2020-02-16", "CR", "Y",
  "7", "2020-04-01", "NE", "N"
) %&gt;%
  mutate(PARAMCD = "OVR")

pd_obs &lt;-
  bind_rows(tribble(
    ~USUBJID, ~ADTC,        ~AVALC,
    "2",      "2020-03-01", "Y",
    "4",      "2020-02-01", "Y"
  ) %&gt;%
    mutate(PARAMCD = "PD"))

adrs &lt;- bind_rows(ovr_obs, pd_obs) %&gt;%
  mutate(
    ADT = ymd(ADTC),
    STUDYID = "XX1234"
  ) %&gt;%
  select(-ADTC) %&gt;%
  derive_vars_merged(
    dataset_add = adsl,
    by_vars     = exprs(STUDYID, USUBJID),
    new_vars    = exprs(TRTSDT)
  )

pd_date &lt;- date_source(
  dataset_name = "adrs",
  date         = ADT,
  filter       = PARAMCD == "PD"
)

aval_fun_pass &lt;- function(arg) {
  case_when(
    arg == "CR" ~ 11,
    arg == "PR" ~ 22,
    arg == "SD" ~ 33,
    arg == "NON-CR/NON-PD" ~ 44,
    arg == "PD" ~ 55,
    arg == "NE" ~ 66,
    arg == "MISSING" ~ 77,
    TRUE ~ NA_real_
  )
}

# Derive best overall response parameter
derive_param_bor(
  adrs,
  dataset_adsl = adsl,
  filter_source = PARAMCD == "OVR" &amp; ANL01FL == "Y",
  source_pd = pd_date,
  source_datasets = list(adrs = adrs),
  aval_fun = aval_fun_pass,
  reference_date = TRTSDT,
  ref_start_window = 28,
  set_values_to = exprs(
    PARAMCD = "BOR",
    PARAM = "Best Overall Response"
  )
) %&gt;%
  filter(PARAMCD == "BOR")
</code></pre>

<hr>
<h2 id='derive_param_clinbenefit'>Adds a Parameter for Clinical Benefit</h2><span id='topic+derive_param_clinbenefit'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#superseded"><img src="../help/figures/lifecycle-superseded.svg" alt='[Superseded]' /></a> The <code>derive_param_clinbenefit()</code> function
has been superseded in favor of <code>derive_extreme_event()</code>.
</p>
<p>Adds a parameter for clinical benefit/disease control
</p>


<h3>Usage</h3>

<pre><code class='language-R'>derive_param_clinbenefit(
  dataset,
  dataset_adsl,
  filter_source,
  source_resp,
  source_pd = NULL,
  source_datasets,
  reference_date,
  ref_start_window,
  aval_fun,
  clinben_vals = c("CR", "PR", "SD", "NON-CR/NON-PD"),
  set_values_to,
  subject_keys = get_admiral_option("subject_keys")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="derive_param_clinbenefit_+3A_dataset">dataset</code></td>
<td>
<p>Input dataset. This is the dataset to which the clinical
benefit rate parameter will be added.
</p>
<p>The variables <code>PARAMCD</code>, <code>AVALC</code>, <code>ADT</code>, and those specified by the <code>subject_keys</code>
parameter and the <code>reference_date</code> parameter are expected.
</p>
<p>After applying <code>filter_source</code> and/or <code>source_pd</code> the variable <code>ADT</code> and the
variables specified by <code>subject_keys</code> must be a unique key of the dataset.</p>
</td></tr>
<tr><td><code id="derive_param_clinbenefit_+3A_dataset_adsl">dataset_adsl</code></td>
<td>
<p>ADSL input dataset.
</p>
<p>The variables specified for <code>subject_keys</code>is expected. For each subject of
the specified dataset a new observation is added to the input dataset. Variables
in <code>dataset_adsl</code> that also appear in <code>dataset</code> will be populated with the
appropriate subject-specific value for these new observations.</p>
</td></tr>
<tr><td><code id="derive_param_clinbenefit_+3A_filter_source">filter_source</code></td>
<td>
<p>Filter condition in <code>dataset</code> that represents records
for overall disease response assessment for a subject at a given timepoint,
e.g. <code>PARAMCD == "OVR"</code> or <code>PARAMCD == "OVRLRESP"</code>.</p>
</td></tr>
<tr><td><code id="derive_param_clinbenefit_+3A_source_resp">source_resp</code></td>
<td>
<p>A <code>date_source</code> object specifying the dataset, date variable,
and filter condition used to identify response status.</p>
</td></tr>
<tr><td><code id="derive_param_clinbenefit_+3A_source_pd">source_pd</code></td>
<td>
<p>A <code>date_source</code> object specifying the dataset, date variable,
and filter condition used to identify disease progression.</p>
</td></tr>
<tr><td><code id="derive_param_clinbenefit_+3A_source_datasets">source_datasets</code></td>
<td>
<p>A named list of data sets is expected.
</p>
<p>The list must contain the names provided by the <code>dataset_name</code> field of the
<code>date_source()</code> objects specified for <code>source_pd</code> and <code>source_resp</code>.</p>
</td></tr>
<tr><td><code id="derive_param_clinbenefit_+3A_reference_date">reference_date</code></td>
<td>
<p>Name of variable representing the index date for
<code>ref_start_window</code>. A variable providing a date. An unquoted symbol is expected.</p>
</td></tr>
<tr><td><code id="derive_param_clinbenefit_+3A_ref_start_window">ref_start_window</code></td>
<td>
<p>Integer representing number of days from <code>reference_date</code>
that must elapse before an evaluable non-PD assessment counts toward determining
clinical benefit.</p>
</td></tr>
<tr><td><code id="derive_param_clinbenefit_+3A_aval_fun">aval_fun</code></td>
<td>
<p><em>Deprecated</em>, please use <code>set_values_to</code> instead.
</p>
<p>Function to map character analysis value (<code>AVALC</code>) to numeric analysis value
(<code>AVAL</code>)
</p>
<p>The (first) argument of the function must expect a character vector and the
function must return a numeric vector.</p>
</td></tr>
<tr><td><code id="derive_param_clinbenefit_+3A_clinben_vals">clinben_vals</code></td>
<td>
<p>A vector of response values to be considered when determining
clinical benefit.</p>
</td></tr>
<tr><td><code id="derive_param_clinbenefit_+3A_set_values_to">set_values_to</code></td>
<td>
<p>A named list returned by <code>exprs()</code> containing new variables
and their static value to be populated for the clinical benefit rate parameter
records, e.g. <code>exprs(PARAMCD = "CBR", PARAM = "Clinical Benefit Rate")</code>.</p>
</td></tr>
<tr><td><code id="derive_param_clinbenefit_+3A_subject_keys">subject_keys</code></td>
<td>
<p>A named list returned by <code>exprs()</code> containing variables
used to uniquely identify subjects.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Clinical benefit/disease control is first identified by looking for subjects
having response status, and then derived for subjects that have at least one
evaluable non-PD response assessment prior to first PD (Progressive Disease)
(i.e., responses inclusive of <code>CR</code>, <code>PR</code>, <code>SD</code>, and <code>NON-CR/NON-PD</code>) and after a specified
amount of time from a reference date (<code>ref_start_window</code>).
</p>
<p>Note: The user input values they wish to include when determining
clinical benefit using the argument <code>clinben_vals</code>. The default values for this are
<code>CR</code>, <code>PR</code>, <code>SD</code>, and <code>NON-CR/NON-PD</code>, as listed above. In the below example,
eligible values be limited to <code>CR</code> and <code>PR</code>.
</p>
<p>Example: <code>clinben_vals &lt;- c("CR", "PR")</code>
</p>

<ol>
<li><p> The input dataset (<code>dataset</code>) is restricted to the observations matching
<code>filter_source</code> and to observations before or at the date specified by <code>source_pd</code>.
</p>
</li>
<li><p> This dataset is further restricted to include user-generated response
assessments from <code>clinben_vals</code> or include response assessments of <code>CR</code>,
<code>PR</code>, <code>SD</code>, and <code>NON-CR/NON-PD</code>, exclude missing response assessments, and
exclude those less than <code>ref_start_window</code> after <code>reference_date</code>. The earliest
assessment by <code>ADT</code> is then selected.
</p>
</li>
<li><p> The dataset identified by <code>dataset</code> in <code>source_resp</code> is restricted
according to its <code>filter</code> argument. The variable corresponding to the <code>date</code>
parameter of <code>source_resp</code> is considered together with <code>ADT</code> from the
previous step.
</p>
</li>
<li><p> For the observations being added to <code>dataset</code>, <code>ADT</code> is set to the earlier
of the first assessment date representing an evaluable non-PD assessment prior
to first PD, or the date representing the start of response.
</p>
</li>
<li><p> For the observations being added to <code>dataset</code>, <code>AVALC</code> is set to
</p>

<ul>
<li> <p><code>Y</code> for those subjects in the <code>dataset</code> meeting the criteria for clinical
benefit above
</p>
</li>
<li> <p><code>N</code> for subjects not meeting the clinical benefit criteria in <code>dataset</code>
or the dataset identified in <code>source_resp</code>
</p>
</li>
<li> <p><code>N</code> for subjects present in <code>dataset_adsl</code> but not present in <code>dataset</code>
or the dataset identified in <code>source_resp</code>.
</p>
</li></ul>

</li>
<li> <p><code>AVAL</code> is derived using <code>AVALC</code> as input to the function specified in
<code>aval_fun</code>.
</p>
</li>
<li><p> The variables specified by <code>set_values_to</code> are added to the new observations
with values equal to the values specified in the same.
</p>
</li>
<li><p> The new observations are added to <code>dataset</code>. Variables held in common
between <code>dataset</code> and <code>dataset_adsl</code> are kept for the new observations, and
are populated with their values from <code>dataset_adsl</code>.
</p>
</li></ol>



<h3>Value</h3>

<p>The input dataset with a new parameter for clinical benefit
</p>


<h3>Author(s)</h3>

<p>Andrew Smith
</p>


<h3>See Also</h3>

<p>Other superseded: 
<code><a href="#topic+derive_param_bor">derive_param_bor</a>()</code>,
<code><a href="#topic+derive_param_confirmed_bor">derive_param_confirmed_bor</a>()</code>,
<code><a href="#topic+derive_param_confirmed_resp">derive_param_confirmed_resp</a>()</code>,
<code><a href="#topic+derive_param_response">derive_param_response</a>()</code>,
<code><a href="#topic+filter_pd">filter_pd</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(lubridate)
library(dplyr)
library(admiral)

adsl &lt;- tibble::tribble(
  ~USUBJID, ~TRTSDT,
  "01",     ymd("2020-01-14"),
  "02",     ymd("2021-02-16"),
  "03",     ymd("2021-03-09"),
  "04",     ymd("2021-04-21")
) %&gt;%
  mutate(STUDYID = "AB42")

adrs &lt;- tibble::tribble(
  ~USUBJID, ~PARAMCD, ~AVALC, ~ADT,
  "01",     "RSP",    "Y",    ymd("2021-03-14"),
  "02",     "RSP",    "N",    ymd("2021-05-07"),
  "03",     "RSP",    "N",    NA,
  "04",     "RSP",    "N",    NA,
  "01",     "PD",     "N",    NA,
  "02",     "PD",     "Y",    ymd("2021-05-07"),
  "03",     "PD",     "N",    NA,
  "04",     "PD",     "N",    NA,
  "01",     "OVR",    "SD",   ymd("2020-03-14"),
  "01",     "OVR",    "PR",   ymd("2021-04-13"),
  "02",     "OVR",    "PR",   ymd("2021-04-08"),
  "02",     "OVR",    "PD",   ymd("2021-05-07"),
  "02",     "OVR",    "CR",   ymd("2021-06-20"),
  "03",     "OVR",    "SD",   ymd("2021-03-30"),
  "04",     "OVR",    "NE",   ymd("2021-05-21"),
  "04",     "OVR",    "NA",   ymd("2021-06-30"),
  "04",     "OVR",    "NE",   ymd("2021-07-24"),
  "04",     "OVR",    "ND",   ymd("2021-09-04"),
) %&gt;%
  mutate(STUDYID = "AB42", ANL01FL = "Y") %&gt;%
  derive_vars_merged(
    dataset_add = adsl,
    by_vars = exprs(STUDYID, USUBJID),
    new_vars = exprs(TRTSDT)
  )

pd &lt;- date_source(
  dataset_name = "adrs",
  date = ADT,
  filter = PARAMCD == "PD" &amp; AVALC == "Y" &amp; ANL01FL == "Y"
)

resp &lt;- date_source(
  dataset_name = "adrs",
  date = ADT,
  filter = PARAMCD == "RSP" &amp; AVALC == "Y" &amp; ANL01FL == "Y"
)

derive_param_clinbenefit(
  dataset = adrs,
  dataset_adsl = adsl,
  filter_source = PARAMCD == "OVR" &amp; ANL01FL == "Y",
  source_resp = resp,
  source_pd = pd,
  source_datasets = list(adrs = adrs),
  reference_date = TRTSDT,
  ref_start_window = 28,
  set_values_to = exprs(
    PARAMCD = "CBR"
  )
) %&gt;%
  filter(PARAMCD == "CBR")
</code></pre>

<hr>
<h2 id='derive_param_confirmed_bor'>Adds a Parameter for Confirmed Best Overall Response</h2><span id='topic+derive_param_confirmed_bor'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#superseded"><img src="../help/figures/lifecycle-superseded.svg" alt='[Superseded]' /></a> The <code>derive_param_confirmed_bor()</code>
function has been superseded in favor of <code>derive_extreme_event()</code>.
</p>
<p>Adds a parameter for confirmed best overall response (BOR)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>derive_param_confirmed_bor(
  dataset,
  dataset_adsl,
  filter_source,
  source_pd = NULL,
  source_datasets = NULL,
  reference_date,
  ref_start_window,
  ref_confirm,
  max_nr_ne = 1,
  accept_sd = FALSE,
  missing_as_ne = FALSE,
  aval_fun,
  set_values_to,
  subject_keys = get_admiral_option("subject_keys")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="derive_param_confirmed_bor_+3A_dataset">dataset</code></td>
<td>
<p>Input dataset
</p>
<p>The <code>PARAMCD</code>, <code>ADT</code>, and <code>AVALC</code> variables and the variables specified by
<code>subject_keys</code> and <code>reference_date</code> are expected.
</p>
<p>After applying <code>filter_source</code> and/or <code>source_pd</code> the variable <code>ADT</code> and the
variables specified by <code>subject_keys</code> must be a unique key of the dataset.</p>
</td></tr>
<tr><td><code id="derive_param_confirmed_bor_+3A_dataset_adsl">dataset_adsl</code></td>
<td>
<p>ADSL input dataset
</p>
<p>The variables specified for <code>subject_keys</code> are expected. For each subject
of the specified dataset a new observation is added to the input dataset.</p>
</td></tr>
<tr><td><code id="derive_param_confirmed_bor_+3A_filter_source">filter_source</code></td>
<td>
<p>Source filter
</p>
<p>All observations in <code>dataset_source</code> fulfilling the specified condition are
considered for deriving the confirmed best overall response.</p>
</td></tr>
<tr><td><code id="derive_param_confirmed_bor_+3A_source_pd">source_pd</code></td>
<td>
<p>Date of first progressive disease (PD)
</p>
<p>If the parameter is specified, the observations of the input dataset for
deriving the new parameter are restricted to observations up to the
specified date. Observations at the specified date are included. For
subjects without first PD date all observations are take into account.
</p>
<p><em>Permitted Values:</em> a <code>date_source</code> object (see <code>admiral::date_source()</code>
for details)</p>
</td></tr>
<tr><td><code id="derive_param_confirmed_bor_+3A_source_datasets">source_datasets</code></td>
<td>
<p>Source dataset for the first PD date
</p>
<p>A named list of datasets is expected. It links the <code>dataset_name</code> from
<code>source_pd</code> with an existing dataset.
</p>
<p>For example if <code>source_pd = pd_date</code> with
</p>
<div class="sourceCode r"><pre>pd_date &lt;- date_source(
  dataset_name = "adrs",
  date = ADT,
  filter = PARAMCD == PD
)
</pre></div>
<p>and the actual response dataset in the script is <code>myadrs</code>, <code>source_datasets = list(adrs = myadrs)</code> should be specified.</p>
</td></tr>
<tr><td><code id="derive_param_confirmed_bor_+3A_reference_date">reference_date</code></td>
<td>
<p>Reference date
</p>
<p>The reference date is used for the derivation of <code>"SD"</code> and
<code>"NON-CR/NON-PD"</code> response (see &quot;Details&quot; section). Usually it is treatment
start date (<code>TRTSDT</code>) or randomization date (<code>RANDDT</code>).
</p>
<p><em>Permitted Values:</em> a numeric date variable</p>
</td></tr>
<tr><td><code id="derive_param_confirmed_bor_+3A_ref_start_window">ref_start_window</code></td>
<td>
<p>Stable disease time window
</p>
<p>Assessments at least the specified number of days after the reference date
(i.e. where <code>ADT</code> &gt;= <code>reference_date</code> + <code>ref_start_window</code>)
with response <code>"CR"</code>, <code>"PR"</code>, <code>"SD"</code>, or <code>"NON-CR/NON-PD"</code> are considered
for <code>"SD"</code> or <code>"NON-CR/NON-PD"</code> response.
</p>
<p><em>Permitted Values:</em> a non-negative numeric scalar</p>
</td></tr>
<tr><td><code id="derive_param_confirmed_bor_+3A_ref_confirm">ref_confirm</code></td>
<td>
<p>Minimum time period for confirmation
</p>
<p>The assessment and the confirmatory assessment for <code>"CR"</code> and <code>"PR"</code> have
to be at least the specified number of days apart.</p>
</td></tr>
<tr><td><code id="derive_param_confirmed_bor_+3A_max_nr_ne">max_nr_ne</code></td>
<td>
<p>The specified number of <code>"NE"</code> assessments between the assessment and the
confirmatory assessment for <code>"CR"</code> and <code>"PR"</code> response is accepted.
</p>
<p><em>Permitted Values:</em> a non-negative numeric scalar</p>
</td></tr>
<tr><td><code id="derive_param_confirmed_bor_+3A_accept_sd">accept_sd</code></td>
<td>
<p>Accept <code>"SD"</code> for <code>"PR"</code>?
</p>
<p>If the argument is set to <code>TRUE</code>, one <code>"SD"</code> assessment between the
assessment and the confirmatory assessment for <code>"PR"</code> response is accepted.
Otherwise, no <code>"SD"</code> assessment must occur between the two assessments.
</p>
<p><em>Permitted Values:</em> a logical scalar</p>
</td></tr>
<tr><td><code id="derive_param_confirmed_bor_+3A_missing_as_ne">missing_as_ne</code></td>
<td>
<p>Consider no assessments as <code>"NE"</code>?
</p>
<p>If the argument is set to <code>TRUE</code>, the response is set to <code>"NE"</code> for
subjects without an assessment in the input dataset. Otherwise, the
response is set to <code>"MISSING"</code> for these subjects.
</p>
<p><em>Permitted Values:</em> a logical scalar</p>
</td></tr>
<tr><td><code id="derive_param_confirmed_bor_+3A_aval_fun">aval_fun</code></td>
<td>
<p><em>Deprecated</em>, please use <code>set_values_to</code> instead.
</p>
<p>Function to map character analysis value (<code>AVALC</code>) to numeric analysis
value (<code>AVAL</code>)
</p>
<p>The (first) argument of the function must expect a character vector and the
function must return a numeric vector.</p>
</td></tr>
<tr><td><code id="derive_param_confirmed_bor_+3A_set_values_to">set_values_to</code></td>
<td>
<p>Variables to set
</p>
<p>A named list returned by <code>exprs()</code> defining the variables to be set for the
new parameter, e.g. <code>exprs(PARAMCD = "CBOR", PARAM = "Confirmed Best Overall Response")</code> is expected. The values must be symbols, character strings,
numeric values, or <code>NA</code>.</p>
</td></tr>
<tr><td><code id="derive_param_confirmed_bor_+3A_subject_keys">subject_keys</code></td>
<td>
<p>Variables to uniquely identify a subject
</p>
<p>A list of symbols created using <code>exprs()</code> is expected.</p>
</td></tr>
</table>


<h3>Details</h3>


<ol>
<li><p> The input dataset (<code>dataset</code>) is restricted to the observations matching
<code>filter_source</code> and to observations before or at the date specified by
<code>source_pd</code>.
</p>
</li>
<li><p> The following potential confirmed responses are selected from the
restricted input dataset:
</p>

<ul>
<li> <p><code>"CR"</code>: An assessment is considered as complete response (CR) if
</p>

<ul>
<li> <p><code>AVALC == "CR"</code>,
</p>
</li>
<li><p> there is a confirmatory assessment with <code>AVALC == "CR"</code> at least
<code>ref_confirm</code> days after the assessment,
</p>
</li>
<li><p> all assessments between the assessment and the confirmatory
assessment are <code>"CR"</code> or <code>"NE"</code>, and
</p>
</li>
<li><p> there are at most <code>max_nr_ne</code> <code>"NE"</code> assessments between the
assessment and the confirmatory assessment.
</p>
</li></ul>

</li>
<li> <p><code>"PR"</code>: An assessment is considered as partial response (PR) if
</p>

<ul>
<li> <p><code>AVALC == "PR"</code>,
</p>
</li>
<li><p> there is a confirmatory assessment with <code>AVALC %in% c("CR",   "PR")</code> at least <code>ref_confirm</code> days after the assessment,
</p>
</li>
<li><p> all assessments between the assessment and the confirmatory
assessment are <code>"CR"</code>, <code>"PR"</code>, <code>"SD"</code>, or <code>"NE"</code>,
</p>
</li>
<li><p> there is no <code>"PR"</code> assessment after a <code>"CR"</code> assessment in the
confirmation period,
</p>
</li>
<li><p> there are at most <code>max_nr_ne</code> <code>"NE"</code> assessments between the
assessment and the confirmatory assessment, and
</p>
</li>
<li><p> if the <code>accept_sd</code> argument is set to <code>TRUE</code>, one <code>"SD"</code>
assessment in the confirmation period is accepted. Otherwise, no
<code>"SD"</code> assessment must occur within the confirmation period.
</p>
</li></ul>

</li>
<li> <p><code>"SD"</code>: An assessment is considered as stable disease (SD) if
</p>

<ul>
<li> <p><code>AVALC %in% c("CR", "PR", "SD")</code> and
</p>
</li>
<li><p> the assessment is at least <code>ref_start_window</code> days after
<code>reference_date</code>.
</p>
</li></ul>

</li>
<li> <p><code>"NON-CR/NON-PD"</code>: An assessment is considered as NON-CR/NON-PD if
</p>

<ul>
<li> <p><code>AVALC = "NON-CR/NON-PD"</code> and
</p>
</li>
<li><p> the assessment is at least <code>ref_start_window</code> days after
<code>reference_date</code>.
</p>
</li></ul>

</li>
<li> <p><code>"PD"</code>: An assessment is considered as progressive disease (PD) if
<code>AVALC == "PD"</code>.
</p>
</li>
<li> <p><code>"NE"</code>: An assessment is considered as not estimable (NE) if
</p>

<ul>
<li> <p><code>AVALC == "NE"</code> or
</p>
</li>
<li> <p><code>AVALC %in% c("CR", "PR", "SD", "NON-CR/NON-PD")</code> and the
assessment is less than <code>ref_start_window</code> days after
<code>reference_date</code>.
</p>
</li></ul>

</li>
<li> <p><code>"ND"</code>: An assessment is considered as not done (ND) if <code>AVALC ==   "ND"</code>.
</p>
</li>
<li> <p><code>"MISSING"</code>: An assessment is considered as missing (MISSING) if a
subject has no observation in the input dataset.
</p>
<p>If the <code>missing_as_ne</code> argument is set to <code>TRUE</code>, <code>AVALC</code> is set to
<code>"NE"</code> for these subjects.
</p>
</li></ul>

</li>
<li><p> For each subject the best response as derived in the previous step is
selected, where <code>"CR"</code> is best and <code>"MISSING"</code> is worst in the order above.
If the best response is not unique, the first one (with respect to <code>ADT</code>)
is selected. If the selected record is from the input dataset, all
variables are kept. If the selected record is from <code>dataset_adsl</code>, all
variables which are in both <code>dataset</code> and <code>dataset_adsl</code> are kept.
</p>
</li>
<li><p> The <code>AVAL</code> variable is added and set to <code>aval_fun(AVALC)</code>.
</p>
</li>
<li><p> The variables specified by the <code>set_values_to</code> parameter are added to
the new observations.
</p>
</li>
<li><p> The new observations are added to input dataset.
</p>
</li></ol>



<h3>Value</h3>

<p>The input dataset with a new parameter for confirmed best overall
response
</p>


<h3>Author(s)</h3>

<p>Stefan Bundfuss
</p>


<h3>See Also</h3>

<p>Other superseded: 
<code><a href="#topic+derive_param_bor">derive_param_bor</a>()</code>,
<code><a href="#topic+derive_param_clinbenefit">derive_param_clinbenefit</a>()</code>,
<code><a href="#topic+derive_param_confirmed_resp">derive_param_confirmed_resp</a>()</code>,
<code><a href="#topic+derive_param_response">derive_param_response</a>()</code>,
<code><a href="#topic+filter_pd">filter_pd</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(lubridate)
library(admiral)

# Create ADSL dataset
adsl &lt;- tibble::tribble(
  ~USUBJID, ~TRTSDTC,
  "1",      "2020-01-01",
  "2",      "2019-12-12",
  "3",      "2019-11-11",
  "4",      "2019-12-30",
  "5",      "2020-01-01",
  "6",      "2020-02-02",
  "7",      "2020-02-02",
  "8",      "2020-04-01",
  "9",      "2020-03-01"
) %&gt;%
  mutate(
    TRTSDT = ymd(TRTSDTC),
    STUDYID = "XX1234"
  )

# Create ADRS dataset
ovr_obs &lt;- tibble::tribble(
  ~USUBJID, ~ADTC,        ~AVALC,
  "1",      "2020-01-01", "PR",
  "1",      "2020-02-01", "CR",
  "1",      "2020-02-16", "NE",
  "1",      "2020-03-01", "CR",
  "1",      "2020-04-01", "SD",
  "2",      "2020-01-01", "SD",
  "2",      "2020-02-01", "PR",
  "2",      "2020-03-01", "SD",
  "2",      "2020-03-13", "CR",
  "3",      "2019-11-12", "CR",
  "3",      "2019-12-02", "CR",
  "3",      "2020-01-01", "SD",
  "4",      "2020-01-01", "PR",
  "4",      "2020-03-01", "SD",
  "4",      "2020-04-01", "SD",
  "4",      "2020-05-01", "PR",
  "4",      "2020-05-15", "NON-CR/NON-PD",
  "5",      "2020-01-01", "PR",
  "5",      "2020-01-10", "SD",
  "5",      "2020-01-20", "PR",
  "5",      "2020-05-15", "NON-CR/NON-PD",
  "6",      "2020-02-06", "PR",
  "6",      "2020-02-16", "CR",
  "6",      "2020-03-30", "PR",
  "6",      "2020-04-12", "PD",
  "6",      "2020-05-01", "CR",
  "6",      "2020-06-01", "CR",
  "7",      "2020-02-06", "PR",
  "7",      "2020-02-16", "CR",
  "7",      "2020-04-01", "NE",
  "9",      "2020-03-16", "CR",
  "9",      "2020-04-01", "NE",
  "9",      "2020-04-16", "NE",
  "9",      "2020-05-01", "CR"
) %&gt;%
  mutate(PARAMCD = "OVR", ANL01FL = "Y")

pd_obs &lt;-
  bind_rows(tibble::tribble(
    ~USUBJID, ~ADTC,        ~AVALC,
    "6",      "2020-04-12", "Y"
  ) %&gt;%
    mutate(PARAMCD = "PD", ANL01FL = "Y"))

adrs &lt;- bind_rows(ovr_obs, pd_obs) %&gt;%
  mutate(
    ADT = ymd(ADTC),
    STUDYID = "XX1234"
  ) %&gt;%
  select(-ADTC) %&gt;%
  derive_vars_merged(
    dataset_add = adsl,
    by_vars = exprs(STUDYID, USUBJID),
    new_vars = exprs(TRTSDT)
  )

pd_date &lt;- date_source(
  dataset_name = "adrs",
  date = ADT,
  filter = PARAMCD == "PD" &amp; ANL01FL == "Y"
)

# Derive confirmed best overall response parameter
derive_param_confirmed_bor(
  adrs,
  dataset_adsl = adsl,
  filter_source = PARAMCD == "OVR" &amp; ANL01FL == "Y",
  source_pd = pd_date,
  source_datasets = list(adrs = adrs),
  reference_date = TRTSDT,
  ref_start_window = 28,
  ref_confirm = 28,
  set_values_to = exprs(
    PARAMCD = "CBOR",
    PARAM = "Best Confirmed Overall Response by Investigator"
  )
) %&gt;%
  filter(PARAMCD == "CBOR")

# Derive confirmed best overall response parameter (accepting SD for PR,
# accept two NEs, and considering missings as NE)
derive_param_confirmed_bor(
  adrs,
  dataset_adsl = adsl,
  filter_source = PARAMCD == "OVR" &amp; ANL01FL == "Y",
  source_pd = pd_date,
  source_datasets = list(adrs = adrs),
  reference_date = TRTSDT,
  ref_start_window = 28,
  ref_confirm = 28,
  max_nr_ne = 2,
  accept_sd = TRUE,
  missing_as_ne = TRUE,
  set_values_to = exprs(
    PARAMCD = "CBOR",
    PARAM = "Best Confirmed Overall Response by Investigator"
  )
) %&gt;%
  filter(PARAMCD == "CBOR")
</code></pre>

<hr>
<h2 id='derive_param_confirmed_resp'>Adds a Parameter for Confirmed Response</h2><span id='topic+derive_param_confirmed_resp'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#superseded"><img src="../help/figures/lifecycle-superseded.svg" alt='[Superseded]' /></a> The <code>derive_param_confirmed_resp()</code>
function has been superseded in favor of <code>derive_extreme_event()</code>.
</p>
<p>Adds a parameter for confirmed response
</p>


<h3>Usage</h3>

<pre><code class='language-R'>derive_param_confirmed_resp(
  dataset,
  dataset_adsl,
  filter_source,
  source_pd = NULL,
  source_datasets = NULL,
  ref_confirm,
  max_nr_ne = 1,
  accept_sd = FALSE,
  aval_fun,
  set_values_to,
  subject_keys = get_admiral_option("subject_keys")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="derive_param_confirmed_resp_+3A_dataset">dataset</code></td>
<td>
<p>Input dataset
</p>
<p>The <code>PARAMCD</code>, <code>ADT</code>, and <code>AVALC</code> variables and the variables specified by
<code>subject_keys</code> and <code>reference_date</code> are expected.
</p>
<p>After applying <code>filter_source</code> and/or <code>source_pd</code> the variable <code>ADT</code> and the
variables specified by <code>subject_keys</code> must be a unique key of the dataset.</p>
</td></tr>
<tr><td><code id="derive_param_confirmed_resp_+3A_dataset_adsl">dataset_adsl</code></td>
<td>
<p>ADSL input dataset
</p>
<p>The variables specified for <code>subject_keys</code> are expected. For each subject
of the specified dataset a new observation is added to the input dataset.</p>
</td></tr>
<tr><td><code id="derive_param_confirmed_resp_+3A_filter_source">filter_source</code></td>
<td>
<p>Source filter
</p>
<p>All observations in <code>dataset_source</code> fulfilling the specified condition are
considered for deriving the confirmed response.</p>
</td></tr>
<tr><td><code id="derive_param_confirmed_resp_+3A_source_pd">source_pd</code></td>
<td>
<p>Date of first progressive disease (PD)
</p>
<p>If the parameter is specified, the observations of the input dataset for
deriving the new parameter are restricted to observations up to the
specified date. Observations at the specified date are included. For
subjects without first PD date all observations are take into account.
</p>
<p><em>Permitted Values:</em> a <code>date_source</code> object (see <code>admiral::date_source()</code>
for details)</p>
</td></tr>
<tr><td><code id="derive_param_confirmed_resp_+3A_source_datasets">source_datasets</code></td>
<td>
<p>Source dataset for the first PD date
</p>
<p>A named list of datasets is expected. It links the <code>dataset_name</code> from
<code>source_pd</code> with an existing dataset.
</p>
<p>For example if <code>source_pd = pd_date</code> with
</p>
<div class="sourceCode r"><pre>pd_date &lt;- date_source(
  dataset_name = "adrs",
  date = ADT,
  filter = PARAMCD == PD
)
</pre></div>
<p>and the actual response dataset in the script is <code>myadrs</code>, <code>source_datasets = list(adrs = myadrs)</code> should be specified.</p>
</td></tr>
<tr><td><code id="derive_param_confirmed_resp_+3A_ref_confirm">ref_confirm</code></td>
<td>
<p>Minimum time period for confirmation
</p>
<p>The assessment and the confirmatory assessment for <code>"CR"</code> and <code>"PR"</code> have
to be at least the specified number of days apart.</p>
</td></tr>
<tr><td><code id="derive_param_confirmed_resp_+3A_max_nr_ne">max_nr_ne</code></td>
<td>
<p>The specified number of <code>"NE"</code> assessments between the assessment and the
confirmatory assessment for <code>"CR"</code> and <code>"PR"</code> response is accepted.
</p>
<p><em>Permitted Values:</em> a non-negative numeric scalar</p>
</td></tr>
<tr><td><code id="derive_param_confirmed_resp_+3A_accept_sd">accept_sd</code></td>
<td>
<p>Accept <code>"SD"</code> for <code>"PR"</code>?
</p>
<p>If the argument is set to <code>TRUE</code>, one <code>"SD"</code> assessment between the
assessment and the confirmatory assessment for <code>"PR"</code> response is accepted.
Otherwise, no <code>"SD"</code> assessment must occur between the two assessments.
</p>
<p><em>Permitted Values:</em> a logical scalar</p>
</td></tr>
<tr><td><code id="derive_param_confirmed_resp_+3A_aval_fun">aval_fun</code></td>
<td>
<p><em>Deprecated</em>, please use <code>set_values_to</code> instead.
</p>
<p>Function to map character analysis value (<code>AVALC</code>) to numeric analysis
value (<code>AVAL</code>)
</p>
<p>The (first) argument of the function must expect a character vector and the
function must return a numeric vector.</p>
</td></tr>
<tr><td><code id="derive_param_confirmed_resp_+3A_set_values_to">set_values_to</code></td>
<td>
<p>Variables to set
</p>
<p>A named list returned by <code>exprs()</code> defining the variables to be set for the
new parameter, e.g. <code>exprs(PARAMCD = "CRSP", PARAM = "Confirmed Response")</code>
is expected. The values must be symbols, character strings, numeric values,
or <code>NA</code>.</p>
</td></tr>
<tr><td><code id="derive_param_confirmed_resp_+3A_subject_keys">subject_keys</code></td>
<td>
<p>Variables to uniquely identify a subject
</p>
<p>A list of symbols created using <code>exprs()</code> is expected.</p>
</td></tr>
</table>


<h3>Details</h3>


<ol>
<li><p> The input dataset (<code>dataset</code>) is restricted to the observations matching
<code>filter_source</code> and to observations before or at the date specified by
<code>source_pd</code>.
</p>
</li>
<li><p> A subject is considered as responder if there is at least one
observation in the restricted dataset with
</p>

<ul>
<li> <p><code>AVALC == "CR"</code>,
</p>
</li>
<li><p> there is a confirmatory assessment with <code>AVALC == "CR"</code> at least
<code>ref_confirm</code> days after the assessment,
</p>
</li>
<li><p> all assessments between the assessment and the confirmatory
assessment are <code>"CR"</code> or <code>"NE"</code>, and
</p>
</li>
<li><p> there are at most <code>max_nr_ne</code> <code>"NE"</code> assessments between the
assessment and the confirmatory assessment.</p>
</li></ul>

<p>or at least one observation with
</p>

<ul>
<li> <p><code>AVALC == "PR"</code>,
</p>
</li>
<li><p> there is a confirmatory assessment with <code>AVALC %in% c("CR", "PR")</code> at
least <code>ref_confirm</code> days after the assessment,
</p>
</li>
<li><p> all assessments between the assessment and the confirmatory
assessment are <code>"CR"</code>, <code>"PR"</code>, <code>"SD"</code>, or <code>"NE"</code>,
</p>
</li>
<li><p> there is no <code>"PR"</code> assessment after a <code>"CR"</code> assessment in the
confirmation period,
</p>
</li>
<li><p> there are at most <code>max_nr_ne</code> <code>"NE"</code> assessments between the
assessment and the confirmatory assessment,
</p>
</li>
<li><p> if the <code>accept_sd</code> argument is set to <code>TRUE</code>, one <code>"SD"</code> assessment
in the confirmation period is accepted. Otherwise, no <code>"SD"</code> assessment
must occur within the confirmation period.
</p>
</li></ul>

</li>
<li><p> For responders <code>AVALC</code> is set to <code>"Y"</code> and <code>ADT</code> to the first date where
the response criteria are fulfilled. For all other subjects in
<code>dataset_adsl</code> <code>AVALC</code> is set to <code>"N"</code> and <code>ADT</code> to <code>NA</code>.
</p>
</li>
<li><p> The <code>AVAL</code> variable is added and set to <code>aval_fun(AVALC)</code>.
</p>
</li>
<li><p> The variables specified by the <code>set_values_to</code> parameter are added to
the new observations.
</p>
</li>
<li><p> The new observations are added to input dataset.
</p>
</li></ol>



<h3>Value</h3>

<p>The input dataset with a new parameter for confirmed response
</p>


<h3>Author(s)</h3>

<p>Stefan Bundfuss
</p>


<h3>See Also</h3>

<p>Other superseded: 
<code><a href="#topic+derive_param_bor">derive_param_bor</a>()</code>,
<code><a href="#topic+derive_param_clinbenefit">derive_param_clinbenefit</a>()</code>,
<code><a href="#topic+derive_param_confirmed_bor">derive_param_confirmed_bor</a>()</code>,
<code><a href="#topic+derive_param_response">derive_param_response</a>()</code>,
<code><a href="#topic+filter_pd">filter_pd</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(admiral)

# Create ADSL dataset
adsl &lt;- tibble::tribble(
  ~USUBJID, ~TRTSDTC,
  "1",      "2020-01-01",
  "2",      "2019-12-12",
  "3",      "2019-11-11",
  "4",      "2019-12-30",
  "5",      "2020-01-01",
  "6",      "2020-02-02",
  "7",      "2020-02-02",
  "8",      "2020-04-01",
  "9",      "2020-03-01"
) %&gt;%
  mutate(
    STUDYID = "XX1234"
  )

# Create ADRS dataset
ovr_obs &lt;- tibble::tribble(
  ~USUBJID, ~ADTC,        ~AVALC,
  "1",      "2020-01-01", "PR",
  "1",      "2020-02-01", "CR",
  "1",      "2020-02-16", "NE",
  "1",      "2020-03-01", "CR",
  "1",      "2020-04-01", "SD",
  "2",      "2020-01-01", "SD",
  "2",      "2020-02-01", "PR",
  "2",      "2020-03-01", "SD",
  "2",      "2020-03-13", "CR",
  "3",      "2019-11-12", "CR",
  "3",      "2019-12-02", "CR",
  "3",      "2020-01-01", "SD",
  "4",      "2020-01-01", "PR",
  "4",      "2020-03-01", "SD",
  "4",      "2020-04-01", "SD",
  "4",      "2020-05-01", "PR",
  "4",      "2020-05-15", "NON-CR/NON-PD",
  "5",      "2020-01-01", "PR",
  "5",      "2020-01-10", "SD",
  "5",      "2020-01-20", "PR",
  "5",      "2020-05-15", "NON-CR/NON-PD",
  "6",      "2020-02-06", "PR",
  "6",      "2020-02-16", "CR",
  "6",      "2020-03-30", "PR",
  "6",      "2020-04-12", "PD",
  "6",      "2020-05-01", "CR",
  "6",      "2020-06-01", "CR",
  "7",      "2020-02-06", "PR",
  "7",      "2020-02-16", "CR",
  "7",      "2020-04-01", "NE",
  "9",      "2020-03-16", "CR",
  "9",      "2020-04-01", "NE",
  "9",      "2020-04-16", "NE",
  "9",      "2020-05-01", "CR"
) %&gt;%
  mutate(PARAMCD = "OVR", ANL01FL = "Y")

pd_obs &lt;-
  bind_rows(tibble::tribble(
    ~USUBJID, ~ADTC,        ~AVALC,
    "6",      "2020-04-12", "Y"
  ) %&gt;%
    mutate(PARAMCD = "PD", ANL01FL = "Y"))

adrs &lt;- bind_rows(ovr_obs, pd_obs) %&gt;%
  mutate(
    ADT = lubridate::ymd(ADTC),
    STUDYID = "XX1234"
  ) %&gt;%
  select(-ADTC)

pd_date &lt;- date_source(
  dataset_name = "adrs",
  date = ADT,
  filter = PARAMCD == "PD" &amp; ANL01FL == "Y"
)

# Derive confirmed response parameter
derive_param_confirmed_resp(
  adrs,
  dataset_adsl = adsl,
  filter_source = PARAMCD == "OVR" &amp; ANL01FL == "Y",
  source_pd = pd_date,
  source_datasets = list(adrs = adrs),
  ref_confirm = 28,
  set_values_to = exprs(
    PARAMCD = "CRSP",
    PARAM = "Confirmed Response by Investigator"
  )
) %&gt;%
  filter(PARAMCD == "CRSP")

# Derive confirmed response parameter (accepting SD for PR and two NEs)
derive_param_confirmed_resp(
  adrs,
  dataset_adsl = adsl,
  filter_source = PARAMCD == "OVR" &amp; ANL01FL == "Y",
  source_pd = pd_date,
  source_datasets = list(adrs = adrs),
  ref_confirm = 28,
  max_nr_ne = 2,
  accept_sd = TRUE,
  set_values_to = exprs(
    PARAMCD = "CRSP",
    PARAM = "Confirmed Response by Investigator"
  )
) %&gt;%
  filter(PARAMCD == "CRSP")
</code></pre>

<hr>
<h2 id='derive_param_response'>Adds a Parameter Indicating If a Subject Had a Response before Progressive
Disease</h2><span id='topic+derive_param_response'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#superseded"><img src="../help/figures/lifecycle-superseded.svg" alt='[Superseded]' /></a> The <code>derive_param_response()</code> function has
been superseded in favor of <code>derive_extreme_event()</code>.
</p>
<p>Adds a parameter indicating if a response has been observed.
If a response has been observed, <code>AVALC</code> is set to &quot;Y&quot;, <code>AVAL</code> to 1 and <code>ADT</code>
is set to the
first date when a response has been observed.
If a response has not been observed, <code>AVALC</code> is set to &quot;N&quot;, <code>AVAL</code> to 0 and
<code>ADT</code> is set NA.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>derive_param_response(
  dataset,
  dataset_adsl,
  filter_source,
  source_pd = NULL,
  source_datasets = NULL,
  set_values_to,
  aval_fun,
  subject_keys = get_admiral_option("subject_keys")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="derive_param_response_+3A_dataset">dataset</code></td>
<td>
<p>Input dataset
</p>
<p>The variables specified by the <code>subject_keys</code>and <code>ADT</code> are expected.
</p>
<p>After applying <code>filter_source</code> and/or <code>source_pd</code> the variable <code>ADT</code> and the
variables specified by <code>subject_keys</code> must be a unique key of the dataset.</p>
</td></tr>
<tr><td><code id="derive_param_response_+3A_dataset_adsl">dataset_adsl</code></td>
<td>
<p>Input dataset
</p>

<ul>
<li><p> The variables specified for <code>subject_keys</code> are expected.
</p>
</li>
<li><p> For each observation of the specified dataset a new observation is added
to the input dataset. This is to capture those patients that may never have
had a tumor assessment.
</p>
</li></ul>
</td></tr>
<tr><td><code id="derive_param_response_+3A_filter_source">filter_source</code></td>
<td>
<p>Source filter
</p>
<p>All observations in the <code>dataset</code> data fulfilling the specified condition
are selected.</p>
</td></tr>
<tr><td><code id="derive_param_response_+3A_source_pd">source_pd</code></td>
<td>
<p>Sources and conditions defining the end of the assessment
period for the responses.
</p>
<p>An object of type <code>date_source</code> is expected
</p>
<p>All observations in <code>dataset</code> defining the response data fulfilling the
<code>filter_source</code> condition are considered as response if they fall before
the end of the assessment period as defined by <code>source_pd</code>.
</p>

<ul>
<li><p> For subjects with at least one response before the end of the assessment
period, <code>AVALC</code> is set to <code>"Y"</code>, <code>AVAL</code> to <code>1</code>, and <code>ADT</code> to the first
date when the response occurred.
</p>
</li>
<li><p> For all other subjects <code>AVALC</code> is set to <code>"N"</code>, <code>AVAL</code> to <code>0</code>, and
<code>ADT</code> to <code>NA</code>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="derive_param_response_+3A_source_datasets">source_datasets</code></td>
<td>
<p>Source dataset
</p>
<p>A named list of datasets with one element is expected
(e.g. <code>list(adrs= adrs)</code>).
</p>
<p>The name must match the <code>dataset_name</code> field of the
<code>admiral::date_source()</code> object specified for <code>source_pd</code>.
</p>
<p>The variables specified by the <code>subject_keys</code> argument and the <code>date</code>
field of the <code>admiral::date_source()</code> object are expected in the dataset.</p>
</td></tr>
<tr><td><code id="derive_param_response_+3A_set_values_to">set_values_to</code></td>
<td>
<p>Variables to set
</p>
<p>A named list returned by <code>exprs()</code> defining the variables to be set for the
new parameter, e.g. <code>exprs(PARAMCD = "RSP", PARAM = "Response by investigator")</code> is expected.
</p>
<p>The values must be symbols, character strings, numeric values or <code>NA</code>.</p>
</td></tr>
<tr><td><code id="derive_param_response_+3A_aval_fun">aval_fun</code></td>
<td>
<p><em>Deprecated</em>, please use <code>set_values_to</code> instead.
</p>
<p>Function to map character analysis value (<code>AVALC</code>) to numeric analysis
value (<code>AVAL</code>)
</p>
<p>The (first) argument of the function must expect a character vector and the
function must return a numeric vector.</p>
</td></tr>
<tr><td><code id="derive_param_response_+3A_subject_keys">subject_keys</code></td>
<td>
<p>Variables to uniquely identify a subject
</p>
<p>A list of symbols created using <code>exprs()</code> is expected.</p>
</td></tr>
</table>


<h3>Details</h3>


<ol>
<li><p> The Date of the end of the assessment period (e.g. Progressive disease,
as defined by <code>pd_source</code>) is added to the response dataset.
</p>
</li>
<li><p> The response dataset is restricted to observations occurring before
<strong>or on</strong> the date of progressive disease.
</p>
</li>
<li><p> For each subject (with respect to the variables specified for the
<code>subject_keys</code> parameter), the first observation (with respect to
<code>ADT</code>) where the response condition (<code>filter_source</code> parameter) is
fulfilled is selected.
</p>
</li>
<li><p> For each observation in <code>dataset_adsl</code> a new observation is created.
</p>

<ul>
<li><p> For subjects with a response <code>AVALC</code> is set to <code>"Y"</code>, <code>AVAL</code> to <code>1</code>, and
<code>ADT</code> to  the first date (<code>ADT</code>) where the response condition is fulfilled.
</p>
</li>
<li><p> For all other subjects <code>AVALC</code> is set to <code>"N"</code>, <code>AVAL</code> to <code>0</code>
and <code>ADT</code> to <code>NA</code>.
</p>
</li></ul>

</li>
<li><p> The variables specified by the <code>set_values_to</code> parameter are added to
the new observations.
</p>
</li>
<li><p> The new observations are added to input dataset.
</p>
</li></ol>



<h3>Value</h3>

<p>The input dataset with a new parameter indicating if and when a
response occurred
</p>


<h3>Author(s)</h3>

<p>Samia Kabi
</p>


<h3>See Also</h3>

<p>Other superseded: 
<code><a href="#topic+derive_param_bor">derive_param_bor</a>()</code>,
<code><a href="#topic+derive_param_clinbenefit">derive_param_clinbenefit</a>()</code>,
<code><a href="#topic+derive_param_confirmed_bor">derive_param_confirmed_bor</a>()</code>,
<code><a href="#topic+derive_param_confirmed_resp">derive_param_confirmed_resp</a>()</code>,
<code><a href="#topic+filter_pd">filter_pd</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
library(admiral)
library(lubridate)
library(tibble)

adsl &lt;- tribble(
  ~USUBJID,
  "1",
  "2",
  "3",
  "4"
) %&gt;%
  mutate(STUDYID = "XX1234")

adrs &lt;- tribble(
  ~USUBJID, ~PARAMCD, ~ADTC,         ~AVALC, ~ANL01FL,
  "1",      "OVR",    "2020-01-02",  "PR",   "Y",
  "1",      "OVR",    "2020-02-01",  "CR",   "Y",
  "1",      "OVR",    "2020-03-01",  "CR",   "Y",
  "1",      "OVR",    "2020-04-01",  "SD",   "Y",
  "1",      "PD",     NA_character_, "N",    "Y",
  "2",      "OVR",    "2021-06-15",  "SD",   "Y",
  "2",      "OVR",    "2021-07-16",  "PD",   "Y",
  "2",      "OVR",    "2021-09-14",  "PD",   "Y",
  "2",      "PD",     "2021-09-14",  "Y",    "Y",
  "3",      "OVR",    "2021-09-14",  "SD",   "Y",
  "3",      "OVR",    "2021-10-30",  "PD",   "Y",
  "3",      "OVR",    "2021-12-25",  "CR",   "Y",
  "3",      "PD",     "2021-10-30",  "Y",    "Y"
) %&gt;%
  mutate(
    STUDYID = "XX1234",
    ADT = ymd(ADTC),
    ANL01FL = "Y"
  ) %&gt;%
  select(-ADTC)

# Define the end of the assessment period for responses:
# all responses before or on the first PD will be used.
pd &lt;- date_source(
  dataset_name = "adrs",
  date = ADT,
  filter = PARAMCD == "PD" &amp; AVALC == "Y"
)
# Derive the response parameter
derive_param_response(
  dataset = adrs,
  dataset_adsl = adsl,
  filter_source = PARAMCD == "OVR" &amp; AVALC %in% c("CR", "PR") &amp; ANL01FL == "Y",
  source_pd = pd,
  source_datasets = list(adrs = adrs),
  set_values_to = exprs(
    AVAL = yn_to_numeric(AVALC),
    PARAMCD = "RSP",
    PARAM = "Response by investigator"
  ),
  subject_keys = get_admiral_option("subject_keys")
) %&gt;%
  arrange(USUBJID, PARAMCD, ADT)
</code></pre>

<hr>
<h2 id='filter_pd'>Filter up to First PD (Progressive Disease) Date</h2><span id='topic+filter_pd'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#superseded"><img src="../help/figures/lifecycle-superseded.svg" alt='[Superseded]' /></a> The <code>filter_pd()</code> function has been
superseded in favor of <code>filter_relative()</code>.
</p>
<p>Filter a dataset to only include the source parameter records up to and
including the first PD (progressive disease). These records are passed to
downstream derivations regarding responses such as BOR (best overall
response).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>filter_pd(
  dataset,
  filter,
  source_pd,
  source_datasets,
  subject_keys = get_admiral_option("subject_keys")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="filter_pd_+3A_dataset">dataset</code></td>
<td>
<p>Input dataset
</p>
<p>The variables <code>ADT</code> and those specified by <code>subject_keys</code> are expected.</p>
</td></tr>
<tr><td><code id="filter_pd_+3A_filter">filter</code></td>
<td>
<p>Filter condition for restricting the input dataset</p>
</td></tr>
<tr><td><code id="filter_pd_+3A_source_pd">source_pd</code></td>
<td>
<p>A <code>admiral::date_source()</code> object providing the date of first PD
</p>
<p>For each subject the first date (<code>date</code> field) in the provided dataset
(<code>dataset_name</code> field) restricted by <code>filter</code> field is considered as first
PD date.</p>
</td></tr>
<tr><td><code id="filter_pd_+3A_source_datasets">source_datasets</code></td>
<td>
<p>A named list of data sets is expected.
</p>
<p>The name must match the name provided by the <code>dataset_name</code> field of the
<code>admiral::date_source()</code> object specified for <code>source_pd</code>.</p>
</td></tr>
<tr><td><code id="filter_pd_+3A_subject_keys">subject_keys</code></td>
<td>
<p>Variables to uniquely identify a subject
</p>
<p>A list of symbols created using <code>exprs()</code> is expected.</p>
</td></tr>
</table>


<h3>Details</h3>


<ol>
<li><p> The input dataset (<code>dataset</code>) is restricted by <code>filter</code>.
</p>
</li>
<li><p> For each subject the first PD date is derived as the first date
(<code>source_pd$date</code>) in the source pd dataset
(<code>source_datasets[[source_pd$dataset_name]]</code>) restricted by
<code>source_pd$filter</code>.
</p>
</li>
<li><p> The restricted input dataset is restricted to records up to first PD date.
Records matching first PD date are included. For subject without any first PD
date, all records are included.
</p>
</li></ol>



<h3>Value</h3>

<p>A subset of the input dataset
</p>


<h3>Author(s)</h3>

<p>Teckla Akinyi, Stefan Bundfuss
</p>


<h3>See Also</h3>

<p>Other superseded: 
<code><a href="#topic+derive_param_bor">derive_param_bor</a>()</code>,
<code><a href="#topic+derive_param_clinbenefit">derive_param_clinbenefit</a>()</code>,
<code><a href="#topic+derive_param_confirmed_bor">derive_param_confirmed_bor</a>()</code>,
<code><a href="#topic+derive_param_confirmed_resp">derive_param_confirmed_resp</a>()</code>,
<code><a href="#topic+derive_param_response">derive_param_response</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(lubridate)
library(admiral)
library(admiralonco)

# Filter OVR records up to first PD, first PD date provided in separate BDS dataset (adevent)
adrs &lt;- tibble::tribble(
  ~STUDYID,       ~USUBJID,      ~PARAMCD, ~AVALC, ~ADT,         ~ANL01FL,
  "CDISCPILOT01", "01-701-1015", "OVR",    "CR",   "2016-01-25", "Y",
  "CDISCPILOT01", "01-701-1015", "OVR",    "SD",   "2016-02-22", NA_character_,
  "CDISCPILOT01", "01-701-1015", "OVR",    "PD",   "2016-02-22", "Y",
  "CDISCPILOT01", "01-701-1015", "BOR",    "CR",   "2016-01-25", "Y",
  "CDISCPILOT01", "01-701-1034", "OVR",    "SD",   "2015-12-07", "Y",
  "CDISCPILOT01", "01-701-1034", "OVR",    "PD",   "2016-04-25", "Y",
  "CDISCPILOT01", "01-701-1034", "OVR",    "PD",   "2016-06-25", "Y",
  "CDISCPILOT01", "01-701-1034", "BOR",    "SD",   "2015-12-07", "Y",
  "CDISCPILOT01", "01-701-1035", "OVR",    "SD",   "2016-04-25", "Y",
  "CDISCPILOT01", "01-701-1035", "OVR",    "PR",   "2016-06-25", "Y",
  "CDISCPILOT01", "01-701-1035", "BOR",    "PR",   "2016-06-25", "Y"
) %&gt;% mutate(
  ADT = as_date(ADT)
)

adevent &lt;- tibble::tribble(
  ~STUDYID,       ~USUBJID,      ~PARAMCD, ~AVALC, ~ADT,
  "CDISCPILOT01", "01-701-1015", "PD",     "Y",    "2016-02-22",
  "CDISCPILOT01", "01-701-1034", "PD",     "Y",    "2016-04-25"
) %&gt;% mutate(
  ADT = as_date(ADT)
)

pd &lt;- date_source(
  dataset_name = "adevent",
  date = ADT,
  filter = PARAMCD == "PD"
)

filter_pd(
  dataset = adrs,
  filter = PARAMCD == "OVR" &amp; ANL01FL == "Y",
  source_pd = pd,
  source_datasets = list(adevent = adevent)
)

# Filter OVR records up to first PD, first PD date provided in ADSL dataset
adsl &lt;- tibble::tribble(
  ~STUDYID,       ~USUBJID,      ~PDDT,
  "CDISCPILOT01", "01-701-1015", "2016-02-22",
  "CDISCPILOT01", "01-701-1034", "2016-04-25",
  "CDISCPILOT01", "01-701-1035", ""
) %&gt;% mutate(
  PDDT = as_date(PDDT)
)

pd &lt;- date_source(
  dataset_name = "adsl",
  date = PDDT
)

filter_pd(
  dataset = adrs,
  filter = PARAMCD == "OVR" &amp; ANL01FL == "Y",
  source_pd = pd,
  source_datasets = list(adsl = adsl)
)

# Filter OVR records up to first PD, first PD date provided in input dataset (PD parameter)
adrs &lt;- tibble::tribble(
  ~STUDYID,       ~USUBJID,      ~PARAMCD, ~AVALC, ~ADT,         ~ANL01FL,
  "CDISCPILOT01", "01-701-1015", "OVR",    "CR",   "2016-01-25", "Y",
  "CDISCPILOT01", "01-701-1015", "OVR",    "SD",   "2016-02-22", NA_character_,
  "CDISCPILOT01", "01-701-1015", "OVR",    "PD",   "2016-02-22", "Y",
  "CDISCPILOT01", "01-701-1015", "BOR",    "CR",   "2016-01-25", "Y",
  "CDISCPILOT01", "01-701-1034", "OVR",    "SD",   "2015-12-07", "Y",
  "CDISCPILOT01", "01-701-1034", "OVR",    "PD",   "2016-04-25", "Y",
  "CDISCPILOT01", "01-701-1034", "OVR",    "PD",   "2016-06-25", "Y",
  "CDISCPILOT01", "01-701-1034", "BOR",    "SD",   "2015-12-07", "Y",
  "CDISCPILOT01", "01-701-1035", "OVR",    "SD",   "2016-04-25", "Y",
  "CDISCPILOT01", "01-701-1035", "OVR",    "PR",   "2016-06-25", "Y",
  "CDISCPILOT01", "01-701-1035", "BOR",    "PR",   "2016-06-25", "Y",
  "CDISCPILOT01", "01-701-1015", "PD",     "Y",    "2016-02-22", "Y",
  "CDISCPILOT01", "01-701-1034", "PD",     "Y",    "2016-04-25", "Y"
) %&gt;% mutate(
  ADT = as_date(ADT)
)

pd &lt;- date_source(
  dataset_name = "adrs",
  date = ADT,
  filter = PARAMCD == "PD"
)

filter_pd(
  dataset = adrs,
  filter = PARAMCD == "OVR" &amp; ANL01FL == "Y",
  source_pd = pd,
  source_datasets = list(adrs = adrs)
)

# Filter OVR records up to first PD, first PD date derived from OVR records
adrs &lt;- tibble::tribble(
  ~STUDYID,       ~USUBJID,      ~PARAMCD, ~AVALC, ~ADT,         ~ANL01FL,
  "CDISCPILOT01", "01-701-1015", "OVR",    "CR",   "2016-01-25", "Y",
  "CDISCPILOT01", "01-701-1015", "OVR",    "SD",   "2016-02-22", NA_character_,
  "CDISCPILOT01", "01-701-1015", "OVR",    "PD",   "2016-02-22", "Y",
  "CDISCPILOT01", "01-701-1015", "BOR",    "CR",   "2016-01-25", "Y",
  "CDISCPILOT01", "01-701-1034", "OVR",    "SD",   "2015-12-07", "Y",
  "CDISCPILOT01", "01-701-1034", "OVR",    "PD",   "2016-04-25", "Y",
  "CDISCPILOT01", "01-701-1034", "OVR",    "PD",   "2016-06-25", "Y",
  "CDISCPILOT01", "01-701-1034", "BOR",    "SD",   "2015-12-07", "Y",
  "CDISCPILOT01", "01-701-1035", "OVR",    "SD",   "2016-04-25", "Y",
  "CDISCPILOT01", "01-701-1035", "OVR",    "PR",   "2016-06-25", "Y",
  "CDISCPILOT01", "01-701-1035", "BOR",    "PR",   "2016-06-25", "Y"
) %&gt;% mutate(
  ADT = as_date(ADT)
)

pd &lt;- date_source(
  dataset_name = "adrs",
  date = ADT,
  filter = PARAMCD == "OVR" &amp; ANL01FL == "Y" &amp; AVALC == "PD"
)

filter_pd(
  dataset = adrs,
  filter = PARAMCD == "OVR" &amp; ANL01FL == "Y",
  source_pd = pd,
  source_datasets = list(adrs = adrs)
)
</code></pre>

<hr>
<h2 id='get_crpr_dataset'>Get CR Records Followed by PR That Lead to a Prior Error</h2><span id='topic+get_crpr_dataset'></span>

<h3>Description</h3>

<p>Get CR Records Followed by PR That Lead to a Prior Error
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_crpr_dataset()
</code></pre>


<h3>Details</h3>

<p>Some <code>{admiralonco}</code> functions check that in the source records CR is not
followed by PR and throw an error otherwise. The <code>get_crpr_dataset()</code>
function allows one to retrieve the duplicate records that lead to an error.
</p>
<p>Note that the function always returns the dataset of duplicates from the last
error that has been thrown in the current R session. Thus, after restarting
the R sessions <code>get_crpr_dataset()</code> will return <code>NULL</code> and after a second
error has been thrown, the dataset of the first error can no longer be
accessed (unless it has been saved in a variable).
</p>


<h3>Value</h3>

<p>A <code>data.frame</code> or <code>NULL</code>
</p>


<h3>Author(s)</h3>

<p>Stefan Bundfuss
</p>


<h3>See Also</h3>

<p><code><a href="#topic+signal_crpr">signal_crpr()</a></code>
</p>
<p>Utilities for Dataset Checking: 
<code><a href="#topic+signal_crpr">signal_crpr</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(tibble)
library(dplyr)
library(lubridate)
library(admiralonco)
library(rlang)

adrs &lt;- tribble(
  ~USUBJID, ~ADTC,        ~AVALC,
  "1",      "2020-01-01", "PR",
  "1",      "2020-02-01", "CR",
  "1",      "2020-02-16", "NE",
  "1",      "2020-03-01", "CR",
  "2",      "2020-02-06", "PR",
  "2",      "2020-02-16", "CR",
  "2",      "2020-03-30", "PR",
) %&gt;%
  mutate(
    ADT = ymd(ADTC),
    STUDYID = "XX1234"
  )

signal_crpr(adrs, order = exprs(ADT))

get_crpr_dataset()
</code></pre>

<hr>
<h2 id='rsp_y'>Pre-Defined Response Event Objects</h2><span id='topic+rsp_y'></span><span id='topic+no_data_n'></span><span id='topic+cb_y'></span><span id='topic+bor_cr'></span><span id='topic+bor_pr'></span><span id='topic+bor_sd'></span><span id='topic+bor_non_crpd'></span><span id='topic+bor_pd'></span><span id='topic+bor_ne'></span><span id='topic+no_data_missing'></span><span id='topic+crsp_y_cr'></span><span id='topic+crsp_y_pr'></span><span id='topic+cbor_cr'></span><span id='topic+cbor_pr'></span>

<h3>Description</h3>

<p>These pre-defined <code>event()</code> and <code>event_joined()</code> objects can be used as input
to <code>admiral::derive_extreme_event()</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rsp_y

no_data_n

cb_y

bor_cr

bor_pr

bor_sd

bor_non_crpd

bor_pd

bor_ne

no_data_missing

crsp_y_cr

crsp_y_pr

cbor_cr

cbor_pr
</code></pre>


<h3>Details</h3>

<p>To see the definition of the various objects simply print the object in the
R console, e.g. <code>bor_sd</code>. For details of how to use these objects
please refer to <code><a href="admiral.html#topic+derive_extreme_event">admiral::derive_extreme_event()</a></code>.
</p>
<p>It is assumed that <code>dataset_name = "ovr"</code> refers to the dataset of the only
overall response assessments at each visit which should be considered for the
parameter derivations. For example the dataset should include only
post-baseline assessments up to first PD and before start of anti-cancer
therapy.
</p>


<h3>See Also</h3>

<p><code><a href="admiral.html#topic+derive_extreme_event">admiral::derive_extreme_event()</a></code>, <code><a href="admiral.html#topic+event">admiral::event()</a></code>, <code><a href="admiral.html#topic+event_joined">admiral::event_joined()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># This shows the definition of all pre-defined `event` objects that ship
# with {admiralonco}
exports &lt;- sort(getNamespaceExports("admiralonco"))
for (obj_name in exports) {
  obj &lt;- getExportedValue("admiralonco", obj_name)
  if (inherits(obj, "event_def")) {
    cat("\n", obj_name, ":\n", sep = "")
    print(obj, indent = 2)
  }
}
</code></pre>

<hr>
<h2 id='signal_crpr'>Signal CR Records Followed by PR</h2><span id='topic+signal_crpr'></span>

<h3>Description</h3>

<p>Signal CR Records Followed by PR
</p>


<h3>Usage</h3>

<pre><code class='language-R'>signal_crpr(
  dataset,
  order,
  msg = "Dataset contains CR records followed by PR.",
  subject_keys = get_admiral_option("subject_keys"),
  check_type = "warning"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="signal_crpr_+3A_dataset">dataset</code></td>
<td>
<p>A data frame</p>
</td></tr>
<tr><td><code id="signal_crpr_+3A_order">order</code></td>
<td>
<p>A list of variables created using <code>exprs()</code> determining the order
or the records</p>
</td></tr>
<tr><td><code id="signal_crpr_+3A_msg">msg</code></td>
<td>
<p>The condition message</p>
</td></tr>
<tr><td><code id="signal_crpr_+3A_subject_keys">subject_keys</code></td>
<td>
<p>Variables to uniquely identify a subject
</p>
<p>A list of symbols created using <code>exprs()</code> is expected.</p>
</td></tr>
<tr><td><code id="signal_crpr_+3A_check_type">check_type</code></td>
<td>
<p>Type of message to issue when detecting PR after CR.
</p>
<p><em>Permitted Values</em>: <code>"message"</code>, <code>"warning"</code> or <code>"error"</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects
</p>


<h3>Author(s)</h3>

<p>Stefan Bundfuss
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_crpr_dataset">get_crpr_dataset()</a></code>
</p>
<p>Utilities for Dataset Checking: 
<code><a href="#topic+get_crpr_dataset">get_crpr_dataset</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(tibble)
library(dplyr)
library(lubridate)
library(admiralonco)
library(rlang)

adrs &lt;- tribble(
  ~USUBJID, ~ADTC,        ~AVALC,
  "1",      "2020-01-01", "PR",
  "1",      "2020-02-01", "CR",
  "1",      "2020-02-16", "NE",
  "1",      "2020-03-01", "CR",
  "2",      "2020-02-06", "PR",
  "2",      "2020-02-16", "CR",
  "2",      "2020-03-30", "PR",
) %&gt;%
  mutate(
    ADT = ymd(ADTC),
    STUDYID = "XX1234"
  )

signal_crpr(adrs, order = exprs(ADT))
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
