<!DOCTYPE html><html><head><title>Help for package lmfor</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {lmfor}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#afterthin'>
<p>Increment core data of Scots pine trees</p></a></li>
<li><a href='#alsTree'><p>Individual tree characteristics and ALS data</p></a></li>
<li><a href='#BrkRes'>
<p>Breaking resistance (=bending strength) of birch wood samples</p></a></li>
<li><a href='#circle'><p>Plot circles of a specified radius</p></a></li>
<li><a href='#ddcomp'>
<p>Evaluate the fit of a tree diameter distribution</p></a></li>
<li><a href='#fithd'>
<p>Fit a Height-Diameter model to forest tree data using functions of package <code>nlme</code>.</p></a></li>
<li><a href='#foto'>
<p>CO2 exchange of transplanted Sphagnum fuscum moss in a chronosequence of mires.</p></a></li>
<li><a href='#HD models'>
<p>Available 2- and 3- parameter H-D model functions to be used by function <code>fithd</code>.</p></a></li>
<li><a href='#HTest'>
<p>Estimate stand density using a Horvitz&ndash;Thompson-like estimator</p></a></li>
<li><a href='#HTest_cps'>
<p>Estimate forest characteristics of interest in circular plot sampling using a Horvitz&ndash;Thompson-like estimator</p></a></li>
<li><a href='#ImputeHeights'>
<p>Impute missing tree heights into a forest data using a nonlinear (mixed-effects) model.</p></a></li>
<li><a href='#ips'>
<p>Wood-decaying fungi carried by bark beetle individuals and their mites.</p></a></li>
<li><a href='#linesplot'>
<p>A spaghetti plot of grouped data</p></a></li>
<li><a href='#lmfor-package'>
<p>Functions of Lauri Mehtatalo</p></a></li>
<li><a href='#logit-logistic'>
<p>The Four-parameter Logit-logistic Distribution</p></a></li>
<li><a href='#mywhiskers'><p>A whiskers type residual plot</p></a></li>
<li><a href='#NR'>
<p>Solve a Nonlinear Equation Using Newton-Raphson algorithm.</p></a></li>
<li><a href='#NRnum'>
<p>Solve a Systems of Nonlinear Equations Using the Newton's Method</p></a></li>
<li><a href='#patti'>
<p>Increment core data of Scots pine trees</p></a></li>
<li><a href='#percentile-based'>
<p>The Percentile-based Distribution</p></a></li>
<li><a href='#plants'>
<p>Sapling counts from sample plots of sapling stands in Finland.</p></a></li>
<li><a href='#plants2'>
<p>Sapling counts from sample plots of sapling stands in Finland.</p></a></li>
<li><a href='#plot.hdmod'>
<p>Diagnostic plot a Height-Diameter model residuals</p></a></li>
<li><a href='#predvol'><p>Individual tree volume functions for Finland</p></a></li>
<li><a href='#qqplotHD'>
<p>Normal QQ-plot of a fitted H-D model</p></a></li>
<li><a href='#qtree'>
<p>Properties of sample quantiles from a tree population described by the percentile-based diameter distribution.</p></a></li>
<li><a href='#recweib'>
<p>Recovery of Weibull parameters of tree diameter distribution using measured stand characteristics</p></a></li>
<li><a href='#scaleDMean'>
<p>The Weibull scale parameter for the given mean/median diameter and shape parameter.</p></a></li>
<li><a href='#spati'><p>Raw sample plot data of Scots pine in Ilomantsi, Finland.</p></a></li>
<li><a href='#spati2'><p>Heights and diameters of Scots pine trees in Ilomantsi, Finland.</p></a></li>
<li><a href='#stumplift'>
<p>Productivity of stump lifting machines.</p></a></li>
<li><a href='#thefdata'>
<p>Effect of thinning on individual tree growth for 62 trees.</p></a></li>
<li><a href='#thinning'>
<p>Effect of thinning on individual tree growth</p></a></li>
<li><a href='#treevol'>
<p>Individual tree volume modeling data for 8508 pine, spruce and birch trees in Finland</p></a></li>
<li><a href='#updown'>
<p>Solve a simple equation using a step halving algorithm.</p></a></li>
<li><a href='#volvff'>
<p>The Variable Form-Factor Volume Model</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Functions for Forest Biometrics</td>
</tr>
<tr>
<td>Version:</td>
<td>1.6</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-04-29</td>
</tr>
<tr>
<td>Author:</td>
<td>Lauri Mehtatalo and Kasper Kansanen</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Lauri Mehtatalo &lt;lauri.mehtatalo@luke.fi&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0), nlme, spatstat</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats4, grDevices, graphics, stats, magic, MASS, Matrix,
spatstat.geom</td>
</tr>
<tr>
<td>Suggests:</td>
<td>lme4</td>
</tr>
<tr>
<td>Description:</td>
<td>Functions for different purposes related to forest biometrics, including illustrative graphics, numerical computation, modeling height-diameter relationships, prediction of tree volumes, modelling of diameter distributions and estimation off stand density using ITD. Several empirical datasets are also included. </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-04-29 14:07:23 UTC; 03191657</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-04-29 23:40:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='afterthin'>
Increment core data of Scots pine trees
</h2><span id='topic+afterthin'></span>

<h3>Description</h3>

<p>Post-thinning growth ring measurements of 88 trees of a long-term thinning 
experiment on a naturally regenerated
Scots pine stand in Eastern Finland. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(afterthin)</code></pre>


<h3>Format</h3>

<p>A data frame with 1319 observations on the following 7 variables.
</p>

<dl>
<dt><code>Plot</code></dt><dd><p>Sample plot id, a factor with 10 levels.</p>
</dd>
<dt><code>Tree</code></dt><dd><p>Tree id, a factor with 55 levels (same tree id may occur on different plots!).</p>
</dd>
<dt><code>Year</code></dt><dd><p>Calendar year of the ring.</p>
</dd>
<dt><code>SDAfterThin</code></dt><dd><p>Stand density (trees per ha) of the sample plot.</p>
</dd>
<dt><code>SDClass</code></dt><dd><p>Thinning treatment, factor with 4 levels (1=Control, 2=Light, 3=Moderate, 4=Heavy).</p>
</dd>
<dt><code>CA</code></dt><dd><p>Current tree age in years.</p>
</dd>
<dt><code>RBA</code></dt><dd><p>Ring Basal area, <code class="reqn">mm^2</code> </p>
</dd>
</dl>



<h3>Details</h3>

<p>Long-term thinning experiment on a naturally regenerated
Scots pine stand in Eastern Finland. The experiment consists of 10
sample plots, in four different classes according
to the post-thinning stand density. The plots were thinned in winter 1986-1987. 
In winter 2006 -2007, 10 trees were felled from each plot.
A radial 5mm by 5mm segment from pith to bark was cut from each tree at height 1.3 meter height.
Ring widths from pith to bark were analyzed for
each sample, using an ITRAX X-ray microdensitometer an post-processed to
create ring widths from pith to bark were determined for
each disc. The ring widths were further transformed to ring basal areas by assuming circular, 
growth rings. For 12 trees, ring widths could not be extracted. The data includes 
ring widths for a total of 88 trees between years 1991-2005. The original data is available in data set 
<a href="#topic+patti">patti</a>.</p>


<h3>References</h3>

<p>Mehtatalo, L., Peltola, H., Kilpelainen, A. and Ikonen, V.-P. 2014. The response of basal area growth 
of Scots pine to thinning: A longitudinal analysis of tree-specific series using a nonlinear 
mixed-effects model. Forest Science 60 (4): pp. 636-644. DOI: <a href="https://doi.org/10.5849/forsci.13-059">doi:10.5849/forsci.13-059</a>.
</p>
<p>Mehtatalo, Lauri and Lappi, Juha 2020. Biometry for Forestry and Environmental Data: with examples in R. 
New York: Chapman and Hall/CRC. 426 p. <a href="https://doi.org/10.1201/9780429173462">doi:10.1201/9780429173462</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+patti">patti</a></code>, <code><a href="#topic+thefdata">thefdata</a></code>, <code><a href="#topic+thinning">thinning</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(afterthin)
par(mfcol=c(2,1),cex=0.7,mai=c(0.8,0.8,0.5,0.1))
linesplot(afterthin$CA,
		  afterthin$RBA,
		  group=afterthin$Plot:afterthin$Tree,
		  col.lin=as.numeric(afterthin$SDClass),cex=0,
		  xlab="Tree age",
		  ylab=expression("Ring basal area, "*mm^2))
		  
linesplot(afterthin$Year,
		  afterthin$RBA,
		  group=afterthin$Plot:afterthin$Tree,
		  col.lin=as.numeric(afterthin$SDClass),cex=0,
		  xlab="Year",
		  ylab=expression("Ring basal area, "*mm^2))
</code></pre>

<hr>
<h2 id='alsTree'>Individual tree characteristics and ALS data</h2><span id='topic+alsTree'></span>

<h3>Description</h3>

<p>Field-measured and remotely sensed characteristics of 1510 individual Scots Pine trees from 56 sample plots in Kiihtelysvaara, Eastern Finland. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(alsTree)</code></pre>


<h3>Format</h3>

<p>A data frame with 1510 observations on the following 15 variables.
</p>

<dl>
<dt><code>plot</code></dt><dd><p>Sample plot id, integer</p>
</dd>
<dt><code>tree</code></dt><dd><p>Tree id, integer</p>
</dd>
<dt><code>DBH</code></dt><dd><p>Tree diameter at breast height, cm</p>
</dd>
<dt><code>H</code></dt><dd><p>Tree height, m</p>
</dd>
<dt><code>V</code></dt><dd><p>Tree volume, m^2)</p>
</dd>
<dt><code>HDB</code></dt><dd><p>Height of lowest dead branch, m</p>
</dd>
<dt><code>HCB</code></dt><dd><p>Crown base height, m</p>
</dd>
<dt><code>hmax</code></dt><dd><p>Maximum return height, m</p>
</dd>
<dt><code>h20</code></dt><dd><p>20th percentile of return heights within the tree crown, m</p>
</dd>
<dt><code>h30</code></dt><dd><p>30th percentile of return heights within the tree crown, m</p>
</dd>
<dt><code>h70</code></dt><dd><p>70th percentile of return heights within the tree crown, m</p>
</dd>
<dt><code>h80</code></dt><dd><p>80th percentile of return heights within the tree crown, m</p>
</dd>
<dt><code>a_hmean</code></dt><dd><p>Mean height of returns in the 250m^2 neighbourhood of the tree, m</p>
</dd>
<dt><code>a_veg</code></dt><dd><p>Proportion of returns from vegetation in the 250m^2 neighbourhood of the tree, m</p>
</dd>
<dt><code>a_h30</code></dt><dd><p>30th percentile of returns in the 250m^2 neighbourhood around the tree, m</p>
</dd>
<dt><code>a_h70</code></dt><dd><p>70th percentile of returns in the 250m^2 neighbourhood around the tree, m</p>
</dd>
</dl>



<h3>Details</h3>

<p>Field measurements of tree diameter and height, height of dead branch and crown base height and tree location were taken from the trees in a field campaign. 
Volume was estimated based on diameter, height and upper stem diameter. 
In addition, the area was remotely sensed using airborne laser scanning. Detectable individual trees were delineated from the ALS point cloud and 
associated with the field measurements. From a large set of tree-specific ALS characteristics, the data includes those that were used in the final models of stand characteristics in Maltamo et al (2012).
</p>


<h3>References</h3>

<p>Maltamo, M., Mehtatalo, L., Vauhkonen, J. and Packalen, P. 2012. Predicting and calibrating tree attributes 
by means of airborne laser scanning and field measurements. Canadian Journal of Forest Research 42: 1896-1907.
<a href="https://doi.org/10.1139/x2012-134">doi:10.1139/x2012-134</a>
</p>
<p>Mehtatalo, Lauri and Lappi, Juha 2020. Biometry for Forestry and Environmental Data: with examples in R. 
New York: Chapman and Hall/CRC. 426 p. <a href="https://doi.org/10.1201/9780429173462">doi:10.1201/9780429173462</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(alsTree)
</code></pre>

<hr>
<h2 id='BrkRes'>
Breaking resistance (=bending strength) of birch wood samples
</h2><span id='topic+BrkRes'></span>

<h3>Description</h3>

<p>Measurements of the breaking resistance of
wood samples from a total of 118 downy birch (<em>Betula pubescens</em>) trees. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(BrkRes)</code></pre>


<h3>Format</h3>

<p>A data frame with 274 observations on the following 7 variables.
</p>

<dl>
<dt><code>Tree</code></dt><dd><p>Tree id (numeric)</p>
</dd>
<dt><code>Resistance</code></dt><dd><p>Breaking resistance, MPa</p>
</dd>
<dt><code>Density</code></dt><dd><p>Wood density (as air-dry in 12-15% moisture) , g/cm^3</p>
</dd>
<dt><code>FibreLength</code></dt><dd><p>Fibre length, mm</p>
</dd>
<dt><code>RingClass</code></dt><dd><p>Categorical with three levels indicating the position within the stem. 1=near the pitch (inside), 2=middle, 3=near the bark (outer).</p>
</dd>
<dt><code>SeedOrigin</code></dt><dd><p>Binary variable about the origin of the tree: 1=from seed, 0=sprouted. </p>
</dd>
<dt><code>Site</code></dt><dd><p>Categorical site class with four levels.</p>
</dd>
</dl>



<h3>Details</h3>

<p>A
total of 1 - 4 wood samples per tree were collected.
The samples were classified to three ring classes according to the distance of the sample
from the pith. Each sample was measured
destructively for breaking resistance in the laboratory. The measured variables 
also included wood density. The data has been collected by Hanna Joronen, Katri 
Luostarinen and  Veikko Mottonen.
</p>


<h3>References</h3>

<p>Mehtatalo, Lauri and Lappi, Juha 2020. Biometry for Forestry and Environmental Data: with examples in R. 
New York: Chapman and Hall/CRC. 426 p. <a href="https://doi.org/10.1201/9780429173462">doi:10.1201/9780429173462</a>
</p>
<p>Joronen, H. 2020. Taivutusmurtolujuuteen ja kimmokertoimeen vaikuttavat tekijat hieskoivulla 
nuorpuussa ja aikuispuussa seka niiden mallintaminen lineaarisella sekamallilla. Master's thesis, University of Eastern Finland. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(BrkRes)

brmod1 &lt;- lme(Resistance~RingClass+Density, 
          random=~RingClass-1|Tree, 
          data=BrkRes)
</code></pre>

<hr>
<h2 id='circle'>Plot circles of a specified radius</h2><span id='topic+circle'></span>

<h3>Description</h3>

<p>Adds circles of radii r at coordinates specified by x and y onto an existing plot.</p>


<h3>Usage</h3>

<pre><code class='language-R'>circle(x,y,r,border="black",lty="solid",lwd=1,fill=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="circle_+3A_x">x</code>, <code id="circle_+3A_y">y</code>, <code id="circle_+3A_r">r</code></td>
<td>
<p>Vectors of the x- and y- coordinates of the midpoints and the associated radii. 
Vectors x, y and r should be of the same length</p>
</td></tr>
<tr><td><code id="circle_+3A_border">border</code>, <code id="circle_+3A_lty">lty</code>, <code id="circle_+3A_lwd">lwd</code></td>
<td>
<p>the draving color, line type and line width of the perimeter line. 
Use border=NA to omit the perimeter.</p>
</td></tr>
<tr><td><code id="circle_+3A_fill">fill</code></td>
<td>
<p>The color used to fill the circles. fill=NULL does not fill at all.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>This function is used for its side effects on the graphical display.
</p>


<h3>Author(s)</h3>

<p>Lauri Mehtatalo &lt;<a href="mailto:lauri.mehtatalo@uef.fi">lauri.mehtatalo@uef.fi</a>&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>plot(0,type="n",xlim=c(-2,12),ylim=c(-2,12))
#Plot on average 7 tree crowns of Weibull-distributed radius at random locations
n&lt;-rpois(1,7)
circle(x=runif(n,0,10),
       y=runif(n,0,10),
       r=rweibull(n,6,2))

</code></pre>

<hr>
<h2 id='ddcomp'>
Evaluate the fit of a tree diameter distribution
</h2><span id='topic+ddcomp'></span>

<h3>Description</h3>

<p>A function to compare the fit of the observed tree diameter data (d) 
to a specified diameter distribution (density). 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ddcomp(d,density="dweibull",power=0,limits=seq(0,100),limitsd=limits,plot=FALSE,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ddcomp_+3A_d">d</code></td>
<td>
<p>numeric vector of observed diameters</p>
</td></tr> 
<tr><td><code id="ddcomp_+3A_density">density</code></td>
<td>
<p>either a valid name for a probability density function in R or
a vector of diameter class densities for diameter classes whose 
limits are given in vector limitsd</p>
</td></tr>
<tr><td><code id="ddcomp_+3A_power">power</code></td>
<td>
<p>the weight used in error index. Value 2 gives BA weight, 0 (default) the unweighted</p>
</td></tr>
<tr><td><code id="ddcomp_+3A_limits">limits</code></td>
<td>
<p>the diameter class limits to compute the error index</p>
</td></tr> 
<tr><td><code id="ddcomp_+3A_limitsd">limitsd</code></td>
<td>
<p>see the description of argument <code>density</code></p>
</td></tr> 
<tr><td><code id="ddcomp_+3A_plot">plot</code></td>
<td>
<p>logical. Should a graph be produced to illustrate the ecdf of d  and the cdf corresponding to density</p>
</td></tr>
<tr><td><code id="ddcomp_+3A_...">...</code></td>
<td>
<p>additional arguments passed to function specified by a character-type density. 
e.g. Weibull shape and scale of if density=&quot;dweibull&quot;</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The comparison is  done for mean, variance and standard deviation and shape. 
The shape is compared by computing the sum of absolute differences 
(error index) in densities for the observed data and predicted density in diameter classes
specified by &quot;limits&quot;. The error index has therefore a value between 0 (complete match) and 
2 (complete mismatch). The error index is computed for the predicted density as such (<code>ei1</code>)
and to a rescaled and switched density, which has exactly same mean and variance as the 
given diameter data (<code>e12</code>). 
</p>
<p>The error index is calculated as the sum of variable <code class="reqn">(f_{obs}-f_{pred})x^{power}</code> over the diameter classes, where <code class="reqn">x</code> is 
the midpoint of the diaemeter class and <code class="reqn">f_{obs}-f_{pred}</code> is the difference in predicted and observed frequency. 
By default, <code class="reqn">power=0</code>.
</p>


<h3>Value</h3>

<p>A list of components 
</p>
<table>
<tr><td><code>mudif</code></td>
<td>
<p>The difference in means</p>
</td></tr>
<tr><td><code>vardif</code></td>
<td>
<p>The difference in variances</p>
</td></tr>
<tr><td><code>sddif</code></td>
<td>
<p>The difference in standard deviations</p>
</td></tr>
<tr><td><code>ei1</code></td>
<td>
<p>the error index for original predicted distribution (see details)</p>
</td></tr>
<tr><td><code>ei1</code></td>
<td>
<p>the error index for scaled predicted distribution (see details)</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Lauri Mehtatalo &lt;<a href="mailto:lauri.mehtatalo@uef.fi">lauri.mehtatalo@uef.fi</a>&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Example 
# Observed diameters 
d&lt;-c(18.8,24.2,18.7,13.0,18.9,22.4,17.6,22.0,18.8,22.9,
     16.7,13.7,20.6,15.1,31.8,17.2,19.6,16.8,19.3,27.4,
	 23.7,18.2,19.7,18.9,23.0,21.4,23.8,22.1,24.2,20.9)

# Weibull(5,20) distribution in 1 cm classes (class limits from 0,...,60)
f&lt;-pweibull(1:60,5,20)-pweibull(0:59,5,20)

# compare using the classified true distribution (approximate)
ddcomp(d,density=f,limitsd=0:60,limits=0:100,plot=TRUE)

# compare b specifying a Weibull dsitribution (accurate)
ddcomp(d,density="dweibull",shape=5,scale=20,plot=TRUE)
</code></pre>

<hr>
<h2 id='fithd'>
Fit a Height-Diameter model to forest tree data using functions of package <code>nlme</code>.
</h2><span id='topic+fithd'></span>

<h3>Description</h3>

<p>Fits either linear or nonlinear Height-Diameter (H-D) model into a dataset of tree heights and diameters. 
Possible hierarchy of the data can be taken into account through random effects. 
Several commonly used nonlinear two-parameter H-D functions are available. Linear functions can be used as well.  
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fithd(d, h, plot=c(), modelName="naslund", nranp=2,
      random=NA, varf=0, na.omit=TRUE, start=NA, bh=1.3,
	  control = list(), SubModels=NA, vfstart=0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fithd_+3A_d">d</code></td>
<td>

<p>A numerical vector of tree diameters, usually given in cm.
</p>
</td></tr>
<tr><td><code id="fithd_+3A_h">h</code></td>
<td>

<p>A numerical vector of tree heights, usually given in meters. Should be of the same length as <code>d</code>. 
</p>
</td></tr>
<tr><td><code id="fithd_+3A_plot">plot</code></td>
<td>

<p>A vctor of type <code>numeric</code> or <code>factor</code>, defining the groups of the data; usually the plot indices. 
Should be of the same length as <code>d</code> and <code>h</code>.
</p>
</td></tr>
<tr><td><code id="fithd_+3A_modelname">modelName</code></td>
<td>

<p>Either (i) a character vector specifying the name of the nonlinear function or (ii) the formula specifying 
a linear model.
In case (i) the name should be one of the functions documented on the help page of <code><a href="#topic+HDmodels">HDmodels</a></code>. 
In case (ii), it should be the linear formula in the form that is entered to the function <code><a href="nlme.html#topic+lme">lme</a></code>, for example 
<code>model=h~d+I(d^2)-1</code>
</p>
</td></tr>
<tr><td><code id="fithd_+3A_nranp">nranp</code>, <code id="fithd_+3A_random">random</code></td>
<td>

<p>Parameters nranp and random specify two alternative ways to specify the random effects of the model. An easy but restricted way 
is to use argument <code>nranp</code>. It is an integer between 0 and the number of fixed parameters, and has the the following meaning 
in the case of nonlinear model: 
</p>

<ul>
<li><p> If <code>nranp=0</code>, then a model without random parameters is fitted. 
Results to a fixed-effects model, and argument <code>plot</code> is not used.  
</p>
</li>
<li><p> If <code>nranp=1</code>, then parameter a of a nonlinear function or the first coefficient of the linear formula 
is assumed to vary among plots. 
</p>
</li>
<li><p> If <code>nranp=2</code>, then a and b or the first two terms of the linear formula are assumed to vary among plots or  
</p>
</li>
<li><p> If <code>nranp=3</code>, then a b, and c of a three-parameter nonlinear model or three first coefficients of a linear model 
are assumed to vary among plots
</p>
</li></ul>

<p>In the case of linear model, the constant (if exists) it always counted as the first term.  
</p>
<p>As an alternative to nranp, argument <code>random</code> can be used to express the random part as a nlme formula, 
but without specification of the grouping structure. The provided formula is passed to the lme or nlme 
function. Argument random is always used when provided, so nranp has effect only if <code>random=NA</code> (the default).                           
</p>
</td></tr>
<tr><td><code id="fithd_+3A_varf">varf</code></td>
<td>

<p>Numeric with values 0, 1 or 2. If 0 or FALSE, no variance function is used. 
If varf=1, 2 or TRUE, then the power- type variance function var(e)=sigma^2*w^(2*delta) is used.
where weight w is the raw diameter (when varf=1 or TRUE), or w=max(1,dsd+3) (when varf=2), 
where dsd=(d-D)/SDD. Here d is tree diameter, D and SDD are the mean and standard deviation 
of diameters on the plot in question.    
</p>
</td></tr>
<tr><td><code id="fithd_+3A_na.omit">na.omit</code></td>
<td>

<p>Should missing heights be omitted. Defaults to <code>TRUE</code>.
</p>
</td></tr>  
<tr><td><code id="fithd_+3A_start">start</code></td>
<td>

<p>A vector of the starting values of the parameters of the nlme fit. 
If NA, then the starting values are computed using 
the function computing the starting values (e.g., startHDnaslund, see <code><a href="#topic+HDmodels">HDmodels</a></code>).</p>
</td></tr>
<tr><td><code id="fithd_+3A_bh">bh</code></td>
<td>

<p>The applied breast height. Defaults to 1.3 (meters).
</p>
</td></tr>
<tr><td><code id="fithd_+3A_control">control</code></td>
<td>

<p>Parameters to control of the model fitting algorithm, see <code><a href="nlme.html#topic+nlmeControl">nlmeControl</a></code> for details.
</p>
</td></tr>
<tr><td><code id="fithd_+3A_submodels">SubModels</code></td>
<td>
<p>Implemented only for nonlinear models. A character vector of length 2 or 3, 
according to the number of parameters in the model. It allows submodels for parameters a, b (and c), where 
the parameter is explaiend by plot-specific mean diameter (&quot;~dmean&quot;), plot-specific standard deviation &quot;~dsd&quot;,
or diameter standardized at plot level (&quot;~dstd&quot;), when the predictor is (d-D)/SDD (see teh documentation of argument varf). 
Defaults to NA, which corresponds to no submodels, or <code>submodels=c("~1","~1","1")</code></p>
</td></tr>
<tr><td><code id="fithd_+3A_vfstart">vfstart</code></td>
<td>

<p>Starting value of the power parameter delta of the variance function. Defaults to 0.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Depending on the model (nonlinear or linear, mixed-effects model or marginal), the the model is 
fitted using one of the following functions functions of the <code>nlme</code> package:  
<code>nlme</code>,  <code>lme</code>, <code>gls</code> or <code>gnls</code>. 
</p>
<p>See available H-D functions at <code><a href="#topic+HDmodels">HDmodels</a></code>. The user can define her own new functions
as specified at <code><a href="#topic+HDmodels">HDmodels</a></code>.
</p>


<h3>Value</h3>

<p>An object of class <code>hdmod</code>, inheriting from class <code>nlme</code>. 
</p>


<h3>Author(s)</h3>

<p>Lauri Mehtatalo &lt;<a href="mailto:lauri.mehtatalo@uef.fi">lauri.mehtatalo@uef.fi</a>&gt;
</p>


<h3>References</h3>

<p>Mehtatalo, L., Gregoire, T.G., and de Miguel, S. Modeling Height-diameter curves for height prediction. Canadian Journal of Forest Research, 45(7): 826-837, <a href="https://doi.org/10.1139/cjfr-2015-0054">doi:10.1139/cjfr-2015-0054</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+HDmodels">HDmodels</a></code> for the available functions, Functions <code><a href="nlme.html#topic+nlme">nlme</a></code>,  
<code><a href="nlme.html#topic+lme">lme</a></code>, <code><a href="nlme.html#topic+gls">gls</a></code> or <code><a href="nlme.html#topic+gnls">gnls</a></code> for details on model fitting, 
<code><a href="#topic+ImputeHeights">ImputeHeights</a></code> for imputing unobserved tree heights.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(spati)

fithd(spati$d,spati$h,spati$plot)
fithd(spati$d,spati$h,spati$plot,SubModels=c("dmean","log(dmean)"),varf=2)
</code></pre>

<hr>
<h2 id='foto'>
CO2 exchange of transplanted Sphagnum fuscum moss in a chronosequence of mires.
</h2><span id='topic+foto'></span>

<h3>Description</h3>

<p>The net carbon dioxide exchange of late successional moss species (Sphagnum fuscum) samples 
under seven levels 
of photosynthetic photon flux density in cronosequence of land uplift mires on the Finnish side 
of Bothnia Bay in Siikajoki, Finland. 
Moss samples were transplanted from the late succession site (Site 6) to all sites and photosynthetic activity 
was measured one year later for those samples which had survived.  
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(foto)</code></pre>


<h3>Format</h3>

<p>A data frame with 455 observations on the following 8 variables.
</p>

<dl>
<dt><code>Site</code></dt><dd><p>a factor with levels <code>1</code>,...,6 from the earliest successional stage to the latest </p>
</dd>
<dt><code>Treatment</code></dt><dd><p>a factor with value <code>1</code> for samples with competitor removal treatment 
and <code>0</code> for untreated control.</p>
</dd>
<dt><code>sample</code></dt><dd><p>a factor with unique value for each of the 72 survived samples</p>
</dd>
<dt><code>moisture</code></dt><dd><p>moisture of the sample</p>
</dd>
<dt><code>PARtop</code></dt><dd><p>Photosyntetically active radiation (photon flux density  <code class="reqn">\mu mol /m^2 /s^2</code>)</p>
</dd>
<dt><code>WT</code></dt><dd><p>water table, cm</p>
</dd>
<dt><code>A</code></dt><dd><p>Net CO2 exchange, <code class="reqn">\mu {mol} / g / h</code>, </p>
</dd>
<dt><code>subplot</code></dt><dd><p>a factor with unique value for each replicate</p>
</dd>
</dl>



<h3>Details</h3>

<p>The number of transplanted 
replicates per site was 12, with two samples per replicate. One of the samples was treated with 
competing vegetation removal before transplanting whereas the other was left untreated. 
The 12 replicates per site were planted in locations with 2 to 3 different ground water table levels. 
A year after the transplanting, the photosynthetic activity (A) of the survived transplanted samples 
was recorded using seven artifically created light conditions ranging 
from complete darkness (PPFD=0) to extreme light conditions (PPFD=2000)  using an open, fully controlled flow-
through gas exchange fluorescence measurement system (GFS-3000; Walz, Effeltrich, Germany).
</p>


<h3>References</h3>

<p>Laine, A.M., Ehonen, S., Juurola, E., Mehtatalo, L., and Tuittila, E-S. 2015. 
Performance of late succession species along a chronosequence: Environment does not exclude 
Sphagnum fuscum from the early stages of mire development. 
Journal of Vegetation Science 26(2): 291-301. <a href="https://doi.org/10.1111/jvs.12231">doi:10.1111/jvs.12231</a>
</p>
<p>Mehtatalo, Lauri and Lappi, Juha 2020. Biometry for Forestry and Environmental Data: with examples in R. 
New York: Chapman and Hall/CRC. 426 p. <a href="https://doi.org/10.1201/9780429173462">doi:10.1201/9780429173462</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(foto)

LightResp&lt;-function(PPFD,alpha=0.1,Pmax=10,A0=0) {
	       A0+Pmax*PPFD/(alpha+PPFD)
           }
               
library(nlme)

model5&lt;-nlme(A~LightResp(PARtop,alpha,Pmax,A0),
		fixed=list(alpha~Site+Treatment+moisture,Pmax~Site+Treatment,A0~Site),
		random=list(sample=Pmax+alpha~1),
		data=foto,
		start=c(c(80,0,0,0,0,0,0,0),c(100,0,0,0,0,0,0),c(-20,0,0,0,0,0)),
		verbose=TRUE)
</code></pre>

<hr>
<h2 id='HD+20models'>
Available 2- and 3- parameter H-D model functions to be used by function <code>fithd</code>.
</h2><span id='topic+HDnaslund'></span><span id='topic+HDmichailoff'></span><span id='topic+HDcurtis'></span><span id='topic+HDmeyer'></span><span id='topic+HDpower'></span><span id='topic+HDnaslund2'></span><span id='topic+HDnaslund3'></span><span id='topic+HDnaslund4'></span><span id='topic+HDmicment'></span><span id='topic+HDmicment2'></span><span id='topic+HDwykoff'></span><span id='topic+HDprodan'></span><span id='topic+HDlogistic'></span><span id='topic+HDrichards'></span><span id='topic+HDweibull'></span><span id='topic+HDgomperz'></span><span id='topic+HDsibbesen'></span><span id='topic+HDkorf'></span><span id='topic+HDratkowsky'></span><span id='topic+HDhossfeldIV'></span><span id='topic+startHDnaslund'></span><span id='topic+startHDmichailoff'></span><span id='topic+startHDmeyer'></span><span id='topic+startHDpower'></span><span id='topic+startHDnaslund2'></span><span id='topic+startHDnaslund3'></span><span id='topic+startHDnaslund4'></span><span id='topic+startHDmicment'></span><span id='topic+startHDmicment2'></span><span id='topic+startHDwykoff'></span><span id='topic+startHDcurtis'></span><span id='topic+startHDprodan'></span><span id='topic+startHDlogistic'></span><span id='topic+startHDrichards'></span><span id='topic+startHDweibull'></span><span id='topic+startHDgomperz'></span><span id='topic+startHDsibbesen'></span><span id='topic+startHDkorf'></span><span id='topic+startHDratkowsky'></span><span id='topic+startHDhossfeldIV'></span><span id='topic+startHDodels'></span><span id='topic+HDmodels'></span>

<h3>Description</h3>

<p>Nonlinear functions for modeling tree height on diameter. Usually called using <code>fithd</code>. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>HDnaslund(d, a, b, bh=1.3) 
HDcurtis(d, a, b, bh=1.3) 
HDmichailoff(d, a, b, bh=1.3) 
HDmeyer(d, a, b, bh=1.3) 
HDpower(d, a, b, bh=1.3)
HDnaslund2(d, a, b, bh=1.3)
HDnaslund3(d, a, b, bh=1.3)
HDnaslund4(d, a, b, bh=1.3)
HDmicment(d, a, b, bh=1.3) 
HDmicment2(d, a, b, bh=1.3) 
HDwykoff(d, a, b, bh=1.3) 


HDprodan(d, a, b, c, bh=1.3) 
HDlogistic(d, a, b, c, bh=1.3) 
HDrichards(d, a, b, c, bh=1.3) 
HDweibull(d, a, b, c, bh=1.3) 
HDgomperz(d, a, b, c, bh=1.3) 
HDsibbesen(d, a, b, c, bh=1.3) 
HDkorf(d, a, b, c, bh=1.3) 
HDratkowsky(d, a, b, c, bh=1.3) 
HDhossfeldIV(d, a, b, c, bh=1.3)

startHDnaslund(d, h, bh=1.3) 
startHDcurtis(d, h, bh=1.3) 
startHDmichailoff(d, h, bh=1.3) 
startHDmeyer(d, h, bh=1.3) 
startHDpower(d, h, bh=1.3)
startHDnaslund2(d, h, bh=1.3) 
startHDnaslund3(d, h, bh=1.3) 
startHDnaslund4(d, h, bh=1.3) 
startHDmicment(d, h, bh=1.3) 
startHDmicment2(d, h, bh=1.3) 
startHDwykoff(d, h, bh=1.3) 

startHDprodan(d, h, bh=1.3) 
startHDlogistic(d, h, bh=1.3) 
startHDrichards(d, h, bh=1.3, b=0.04) 
startHDweibull(d, h, bh=1.3) 
startHDgomperz(d, h, bh=1.3) 
startHDsibbesen(d, h, bh=1.3, a=0.5) 
startHDkorf(d, h, bh=1.3) 
startHDratkowsky(d, h, bh=1.3, c=5) 
startHDhossfeldIV(d, h, bh=1.3, c=5)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="HD+2B20models_+3A_d">d</code></td>
<td>

<p>A vector of tree diameters, usually in cm
</p>
</td></tr>
<tr><td><code id="HD+2B20models_+3A_h">h</code></td>
<td>

<p>A vector of tree heights, usually in m. The observed heights should be always above or equal to <code>bh</code>. 
</p>
</td></tr>
<tr><td><code id="HD+2B20models_+3A_a">a</code>, <code id="HD+2B20models_+3A_b">b</code>, <code id="HD+2B20models_+3A_c">c</code></td>
<td>

<p>Parameters a, b (and c for 3- parameter functions) of the applied function. See details for expressions of different functions.
</p>
</td></tr>
<tr><td><code id="HD+2B20models_+3A_bh">bh</code></td>
<td>

<p>The applied height for the measurement of tree diameter (so called breast height). Of the same unit as <code>h</code>.  
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The available 2- parameter functions are
</p>

<ul>
<li><p> Naslund:          <code class="reqn">h(d) = bh + \frac{d^2}{(a + bd)^2}</code>
</p>
</li>
<li><p> Curtis:            <code class="reqn">h(d) = bh + a \left(\frac{d}{1 + d}\right)^b</code>
</p>
</li>
<li><p> Michailoff:        <code class="reqn">h(d) = bh + a e^{-b d^{-1}}</code>
</p>
</li>
<li><p> Meyer:             <code class="reqn">h(d) = bh + a (1-e^{-b d})</code>  
</p>
</li>
<li><p> Power:             <code class="reqn">h(d) = bh + a d^b</code> 
</p>
</li>
<li><p> Naslund2:          <code class="reqn">h(d) = bh + \frac{d^2}{\left(a + e^b d\right)^2}</code>
</p>
</li>
<li><p> Naslund3:          <code class="reqn">h(d) = bh + \frac{d^2}{(e^a + b d)^2}</code>
</p>
</li>
<li><p> Naslund4:          <code class="reqn">h(d) = bh + \frac{d^2}{(e^a + e^b d)^2}</code>
</p>
</li>
<li><p> Michaelis-Menten:  <code class="reqn">h(d) = bh + \frac{a d}{b + d}</code>
</p>
</li>
<li><p> Michaelis-Menten2: <code class="reqn">h(d) = bh + \frac{d}{a + b * d}</code>
</p>
</li>
<li><p> Wykoff:            <code class="reqn">h(d) = bh + \exp\left(a + \frac{b}{d + 1}\right)</code>
</p>
</li></ul>

<p>The available 3- parameter functions are
</p>

<ul>
<li><p> Prodan:           <code class="reqn">h(d) = bh + \frac{d^2}{a + bd + c d^2}</code>
</p>
</li>
<li><p> Logistic:         <code class="reqn">h(d) = bh + \frac{a}{1 + b e^{-c d}}</code>
</p>
</li>
<li><p> Chapman-Richards: <code class="reqn">h(d) = bh + a (1 - e^{-bd})^c </code>  
</p>
</li>
<li><p> Weibull:          <code class="reqn">h(d) = bh + a (1 - e^{-b d^c}) </code>
</p>
</li>
<li><p> Gomperz:          <code class="reqn">h(d) = bh + a \exp(-b \exp(-c d)) </code>
</p>
</li>
<li><p> Sibbesen:         <code class="reqn">h(d) = bh + a d^{b d^{-c}}</code>
</p>
</li>
<li><p> Korf:             <code class="reqn">h(d) = bh + a \exp(-b d^{-c}) </code>
</p>
</li>
<li><p> Ratkowsky:        <code class="reqn">h(d) = bh + a \exp\left(\frac{-b}{d + c}\right)</code>  
</p>
</li>
<li><p> Hossfeld IV:      <code class="reqn">h(d) = bh + \frac{a}{1 + \frac{1}{bd^c}}</code>
</p>
</li></ul>

<p>For each model, two functions are provided: one computing the value of the H-D model for given diameters using given values of parameters a, b (and c),
and another returning the initial guesses of a, b (and c) for given h-d data.  
</p>
<p>The initial guesses are in most cases computed by fitting a linearized version of the model into the provided h-d data using <code>lm</code>. 
For some 3- parameter versions, 
no straightforward linearization is possible and one of the parameters is set to a fixed sensible constant. 
Those values can be seen as additional arguments in the corresponding startHD - functions. 
Details can be seen directly from the function definitions.
</p>
<p>The user can define her own functions to be used with <code>fithd</code>. 
The case-sensitive naming of the functions should follow exactly the naming convention 
shown above. In addition, the names of the of arguments, as well as their order, 
should be the same as in the functions above. 
</p>
<p>The models are named according to references in 
</p>

<ul>
<li><p> Zeide, B. 1993. Analysis of growth equations. Forest Science 39(3):594-616. <a href="https://doi.org/10.1093/forestscience/39.3.594">doi:10.1093/forestscience/39.3.594</a>
</p>
</li>
<li><p> Huang, S., Titus, S.J., and Wiens, D.P. 1992. Comparison of nonlinear height-diameter functiond for major Alberta tree species. Can J. For. Res. 22: 1297-1304. <a href="https://doi.org/10.1139/x92-172">doi:10.1139/x92-172</a> 
</p>
</li></ul>

<p>Suggestions on naming and references on the functions are welcome. 
</p>


<h3>Value</h3>

<p>For functions HDxxx, a vector of tree heights corresponding diameters <code>d</code> is returned. 
For functions startHDxxx, a named vector of initial estimates of a, b and (c).
</p>


<h3>Author(s)</h3>

<p>Lauri Mehtatalo &lt;<a href="mailto:lauri.mehtatalo@uef.fi">lauri.mehtatalo@uef.fi</a>&gt;
</p>


<h3>References</h3>

<p>Mehtatalo, L., Gregoire, T.G., and de Miguel, S. Modeling Height-diameter curves for height prediction. Canadian Journal of Forest Research, 45(7): 826-837, <a href="https://doi.org/10.1139/cjfr-2015-0054">doi:10.1139/cjfr-2015-0054</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(spati)
theta&lt;-startHDnaslund(spati$d,spati$h)
plot(spati$d,spati$h)
d&lt;-seq(0,50)
lines(d,HDnaslund(d,a=theta[1],b=theta[2]),col="red",lwd=5)
</code></pre>

<hr>
<h2 id='HTest'>
Estimate stand density using a Horvitz&ndash;Thompson-like estimator
</h2><span id='topic+HTest'></span><span id='topic+area_esh'></span><span id='topic+gg_wind'></span>

<h3>Description</h3>

<p><code>HTest</code> calculates the Horvitz&ndash;Thompson-like stand density estimate (number of trees) in a specified area based on a collection of detected trees.
</p>
<p><code>area_esh</code> is an internal function for surface area calculations that can handle empty sets.
</p>
<p><code>gg_wind</code> is an internal function that forms a union of discs based on their center points and radii.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>HTest(treelist, plotwindow, alpha)

area_esh(W)

gg_wind(treelist)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="HTest_+3A_treelist">treelist</code></td>
<td>

<p>A 3-column matrix containing the x and y coordinates of detected trees and their crown radii.
</p>
</td></tr>
<tr><td><code id="HTest_+3A_plotwindow">plotwindow</code></td>
<td>

<p>A <code>spatstat</code> object of class &rdquo;<code>owin</code>&rdquo;, representing the area where stand density estimation is done.
</p>
</td></tr>
<tr><td><code id="HTest_+3A_alpha">alpha</code></td>
<td>

<p>A tuning parameter that controls the calculation of detection probabilities, or detectabilities. Must have a value from -1 to 1.
</p>
</td></tr>
<tr><td><code id="HTest_+3A_w">W</code></td>
<td>

<p>A <code>spatstat</code> object of class &rdquo;<code>owin</code>&rdquo; or NULL.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>HTest</code> is the Horvitz&ndash;Thompson-like stand density estimator presented by Kansanen et al. (2016) to adjust individually detected trees for non-detection. It uses individual tree detection data, namely the locations and crown radii of detected trees, to calculate detection probabilities, or detectabilities, for every detected tree, and produces an estimate based on the detectabilities. The detectability for a certain tree is based on the planar set formed by the larger trees. The parameter <code>alpha</code> controls how easy it is to detect a tree of certain size from under the larger trees. If <code>alpha</code>=1, then the tree will be detected if it is not fully covered by the larger crowns. If <code>alpha</code>=0, the tree will be detected if its center point is not covered. If <code>alpha</code>=-1, the tree will be detected if it is fully outside the larger tree crowns.
</p>
<p>The object <code>treelist</code> can include trees that are not in the estimation area specified by <code>plotwindow</code>. This can be useful to take into account possible edge effects, by including trees with center points outside <code>plotwindow</code> that have crown discs that intersect <code>plotwindow</code>. The estimate is calculated only using those trees that have crown center points in <code>plotwindow</code>.
</p>
<p><code>area_esh</code> and <code>gg_wind</code> are internal helper functions used by <code>HTest</code>. First one is a shell for the <code>spatstat</code> function <code>area.owin</code>  that takes into account that an intersection of two sets can be empty, represented in the calculations as NULL. The function returns 0 in this case. Otherwise, it returns the surface area of the window <code>W</code>. The latter function forms a union of discs that is needed in the detectability calculations. 
</p>


<h3>Value</h3>

<p><code>HTest</code> returns a list with two components:
</p>
<table>
<tr><td><code>N</code></td>
<td>
<p>The estimated number of trees in <code>plotwindow</code></p>
</td></tr>
<tr><td><code>treelist</code></td>
<td>
<p>matrix with columns &rdquo;r&rdquo; and &rdquo;detectability&rdquo;, giving the tree crown radii that have been used in the estimation, as well as the detectabilities for trees with those crown radii.</p>
</td></tr>
</table>
<p><code>area_esh</code> returns 0, if <code>W</code> is NULL; otherwise, the surface area of <code>W</code>.
</p>
<p><code>gg_wind</code> returns a <code>spatstat</code> object of class &rdquo;<code>owin</code>&rdquo; representing a set formed as a union of discs.
</p>


<h3>Note</h3>

<p>These functions require the package <code>spatstat</code> (Baddeley et al. 2015) to work.
</p>


<h3>Author(s)</h3>

<p>Kasper Kansanen &lt;<a href="mailto:kasperkansanen@gmail.com">kasperkansanen@gmail.com</a>&gt;
</p>


<h3>References</h3>

<p>Kansanen, K., Vauhkonen, J.,  Lahivaara, T., and Mehtatalo., L. (2016) <em>Stand density estimators
based on individual tree detection and stochastic geometry</em>. Canadian Journal of Forest Research 46(11):1359&ndash;1366. <a href="https://doi.org/10.1139/cjfr-2016-0181">doi:10.1139/cjfr-2016-0181</a>.
</p>
<p>Baddeley, A., Rubak, E. and Turner, R. (2015) <em>Spatial Point Patterns: Methodology and Applications with R</em>. Chapman and Hall/CRC Press, London. <a href="https://doi.org/10.1201/b19708">doi:10.1201/b19708</a>
</p>
<p>Kansanen, K., Packalen, P., Lahivaara, T., Seppanen, A., Vauhkonen, J., Maltamo, M.,  and Mehtatalo., L. (2019) 
<em>Horvitz&ndash;Thompson-like stand density estimation and functional k-NN in individual tree detection</em>. Submitted manuscript.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Generate a 10x10 meter square window:
w&lt;-square(10)

# Generate 6 detected trees, 5 located in the window:
x&lt;-cbind(c(6.75, 8.65, 3.95, 2, 2, 11), 
         c(1.36, 3.10, 6.66, 2, 4, 11), 
         c(1.29, 2.31, 1.80, 2, 1.5, 3))

# Draw the set formed by  the detected tree crowns:
plot(w)
plot(gg_wind(x), add=TRUE)

# Calculate the results with different alpha:
HTest(x, w, 1)
HTest(x, w, 0)
HTest(x, w, -0.75)


</code></pre>

<hr>
<h2 id='HTest_cps'>
Estimate forest characteristics of interest in circular plot sampling using a Horvitz&ndash;Thompson-like estimator
</h2><span id='topic+HTest_cps'></span><span id='topic+detectability_cps'></span><span id='topic+visibility_thinning_cps'></span><span id='topic+ordering_cps'></span><span id='topic+polar_to_cart'></span><span id='topic+cart_to_polar'></span><span id='topic+triangle_coords'></span><span id='topic+shades'></span>

<h3>Description</h3>

<p><code>HTest_cps</code> calculates Horvitz&ndash;Thompson-like estimates of forest characteristics of interest in a specified circular area based on a collection of detected trees and their detection probabilities, or detectabilities. Also produces estimated variances and confidence intervals.
</p>
<p><code>detectability_cps</code> calculates detectabilities of trees in a circular plot sample.
</p>
<p><code>visibility_thinning_cps</code> takes a tree list and determines if the trees can be detected when a certain visibility-based detection condition is used.
</p>
<p><code>ordering_cps</code> is a helper function for preprocessing of tree lists: it takes a tree list and orders the trees based on their distance to plot centre point.
</p>
<p><code>polar_to_cart</code> and <code>cart_to_polar</code> are internal functions for transforming polar coordinates to cartesian coordinates and vice versa.
</p>
<p><code>triangle_coords</code> is an internal function that, given locations and diameters of discs, returns coordinates needed to define the areas behind the discs that are non-visible from the origin.
</p>
<p><code>shades</code> is an internal function that forms polygonal approximations of the planar sets that are non-visible from the origin.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>HTest_cps(data, total=TRUE, confidence.level=0.95)
detectability_cps(data, plot.radius, alpha=0, polar=TRUE, npoly=1024, delta=NULL)
visibility_thinning_cps(data, plot.radius, alpha=0, polar=TRUE, npoly=1024, delta=NULL)
ordering_cps(data, polar=TRUE)
polar_to_cart(X)
cart_to_polar(X)
triangle_coords(X, plot.radius, polar=TRUE)
shades(X, plot.radius, polar=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="HTest_cps_+3A_data">data</code></td>
<td>

<p>For <code>HTest_cps</code> a matrix where each row corresponds to a tree, the first column contains the detectabilities of the trees calculated with <code>detectability_cps</code>, and other columns correspond to measurements over which estimation is wanted. For <code>detectability_cps</code> a four-column matrix, each row containing the coordinates of a tree, the diameter of the tree, and an indicator if the tree has been detected (1) or not (0). In other words, each row is a vector of the form (r, phi, diameter, detected) if the locations are given in polar coordinates, or (x, y, diameter, detected) if the locations are given in cartesian coordinates. It is assumed that the trees are a sample from circular plot sampling, and that the centre point of the plot is the origin (0,0). For <code>visibility_thinning_cps</code> a three-column matrix, otherwise similar to the matrix needed by <code>detectability_cps</code> but without the &rdquo;detected&rdquo; column.
For <code>ordering_cps</code> a matrix, each row corresponding to a tree, the first three columns being either (x, y, diameter) or  (r, phi, diameter).
</p>
</td></tr>
<tr><td><code id="HTest_cps_+3A_total">total</code></td>
<td>

<p>Do you want to estimate population totals (TRUE) or population means (FALSE)?
</p>
</td></tr>
<tr><td><code id="HTest_cps_+3A_confidence.level">confidence.level</code></td>
<td>

<p>The level of the approximate confidence interval, a value between 0 and 1. For example, <code>confidence.level</code>=0.95 indicates a 95 per cent confidence interval. 
</p>
</td></tr>
<tr><td><code id="HTest_cps_+3A_plot.radius">plot.radius</code></td>
<td>

<p>Radius of the plot in which circular plot sampling has been performed.
</p>
</td></tr>
<tr><td><code id="HTest_cps_+3A_alpha">alpha</code></td>
<td>

<p>A tuning parameter that controls the calculation of detection probabilities, or detectabilities.
</p>
</td></tr>
<tr><td><code id="HTest_cps_+3A_polar">polar</code></td>
<td>

<p>Are the locations of trees given in polar coordinates (TRUE) or cartesian coordinates (FALSE)?
</p>
</td></tr>
<tr><td><code id="HTest_cps_+3A_npoly">npoly</code></td>
<td>

<p>Number of edges for the polygonal approximation of the plot boundary and the circles used to calculate the detection probabilities. Used if <code>delta</code>is NULL.
</p>
</td></tr>
<tr><td><code id="HTest_cps_+3A_delta">delta</code></td>
<td>

<p>The tolerance of the polygonal approximation of of the plot boundary and the circles used to calculate the detection probabilities: the length of the arc that will be replaced by one edge of the polygon. If given value that is different from NULL tihs will override <code>npoly</code>
</p>
</td></tr>
<tr><td><code id="HTest_cps_+3A_x">X</code></td>
<td>

<p>For <code>polar_to_cart</code> a two-column matrix, each row containing the polar coordinates (r, phi) of a point. For <code>cart_to_polar</code> a two-column matrix, each row containing the cartesian coordinates (x, y) of a point. For <code>triangle_coords</code> and <code>shades</code> a three-column matrix, each row containing either the polar coordinates and a diameter of a tree (r, phi, diameter) or the cartesian coordinates and a diameter of a tree (x, y, diameter). The coordinates define the centre point of the tree.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function <code>HTest_cps</code> produces estimates of forest characteristics of interest in a circular plot sampling situation. More specifically, it is assumed that an observer stands in a point and observes such trees that are within the fixed-area plot and are not hiding behind other trees. It is assumed that observer can record the locations and diameters of the trees that they observe. The observer can be a person or a piece of equipment, such as terrestrial laser scanner or camera.
</p>
<p>The estimation is based on a Horvitz&ndash;Thompson-like estimator presented by Kansanen et al. (2019). This construction uses approximated detection probabilities, or detectabilities, that depend on the size and distance from the plot centre of the tree for which the probability is calculated, the nonvisible area produced by trees that are closer to the centre point, and a visibility based detection condition.  It is assumed that the centre point of the sampling plot is the origin of the plane (0,0). The function <code>detectability_cps</code> is used to calculate the detectabilities.
</p>
<p>The confidence intervals that <code>HTest_cps</code> produces are based on the t-distribution if less than 50 trees have been observed, and the standard normal distribution otherwise.
</p>
<p>The parameter <code>alpha</code> is a value between -1 and 1 and it controls the detection condition. alpha=1 means that trees are detected if the stems are fully visible to the observer, alpha=0 means that they are detected if the center point is visible, and alpha=-1 means that a tree is detected if any part of the stem is visible.
</p>
<p>The estimation is not possible if the data contains trees that cover the plot centre point. 
</p>
<p>All of the variables related to distance and size, meaning the cartesian coordinates, the distance coordinate, <code>plot.radius</code>, <code>delta</code>, and tree diameters, should have the same unit, e.g. they should all be in metres.
</p>
<p>The function <code>visibility_thinning_cps</code> is useful for simulation-based testing of the estimator. Given a tree list, it classifies trees as either detected or not detected based on a visibility based detection condition.
</p>
<p>The function <code>ordering_cps</code> is a useful preprocessing step for tree lists over which estimation is needed. It reorders the rows of the tree list, corresponding to trees, based on the closest distance from the stem disc to the plot centre point. <code>detectability_cps</code> and <code>visibility_thinning_cps</code> use this ordering for their advantage, as this is the assumed order or sequence of detection. Be warned that even if you do not order the data with <code>ordering_cps</code> these functions will, and will output tree lists with this ordering!
</p>
<p>The functions <code>polar_to_cart</code>, <code>cart_to_polar</code>, <code>triangle_coords</code>, and <code>shades</code> are internal functions used by the two main functions. They can be useful for visualizing data.
</p>


<h3>Value</h3>

<p><code>HTest_cps</code> returns a four-column matrix, the columns containing an estimate, estimated variance of the estimator, and lower and upper bound of the approximate confidence interval for the estimate. Rows of the matrix correspond to the forest characteristics of interest given in columns <code>2:ncol(data)</code> of the input matrix <code>data</code>. If the input matrix has named columns, these names are used as row names of the output matrix.
</p>
<p><code>detectability_cps</code> returns a matrix with the locations and diameters of the trees given as input, the indicators of their detection, and the estimated detection probabilities.
</p>
<p><code>visibility_thinning_cps</code> returns a four-column matrix with the locations and diameters of the trees given as input and the indicators of their detection: 1, if a tree has been detected based on the detection condition given by <code>alpha</code>, and 0, otherwise.
</p>
<p><code>ordering_cps</code> returns a matrix with same dimensions as the input matrix, rows being reordered in the assumed order of detection.
</p>
<p><code>polar_to_cart</code> returns a two-column matrix of cartesian coordinates (x, y).
</p>
<p><code>cart_to_polar</code> returns a two-column matrix of polar coordinates (r, phi).
</p>
<p><code>triangle_coords</code> returns an eight-column matrix, each row containing cartesian coordinates needed for forming a polygonal representation of an area behind a tree, nonvisible from the origin.
</p>
<p><code>shades</code> returns a list of <code>owin</code> objects, each representing an area behind a tree, nonvisible from the origin.
</p>


<h3>Note</h3>

<p>These functions require the package <code>spatstat</code> (Baddeley et al. 2015) to work.
</p>


<h3>Author(s)</h3>

<p>Kasper Kansanen &lt;<a href="mailto:kasperkansanen@gmail.com">kasperkansanen@gmail.com</a>&gt;
</p>


<h3>References</h3>

<p>Baddeley, A., Rubak, E. and Turner, R. (2015) <em>Spatial Point Patterns: Methodology and Applications with R</em>. 
Chapman and Hall/CRC Press, London. <a href="https://doi.org/10.1201/b19708">doi:10.1201/b19708</a>
</p>
<p>Kansanen, K., Packalen, P., Maltamo, M., and Mehtatalo, L. (2020+) <em>Horvitz&ndash;Thompson-like estimation 
with distance-based detection probabilities for circular plot sampling of forests</em>. Biometrics. 
<a href="https://doi.org/10.1111/biom.13312">doi:10.1111/biom.13312</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Simulate a plot of radius 10 metres and stem density of 1000 trees/ha from the Poisson process:
set.seed(1)
N &lt;- rpois(1, lambda=0.1*pi*10^2)
proc &lt;- cbind(10*sqrt(runif(N, 0 ,1)),  runif(N, -pi, pi), rweibull(N, shape=12, scale=22)/100)

# Preprocess the data to the right order:
proc &lt;- ordering_cps(proc)

# Thin the data:
thinned&lt;-visibility_thinning_cps(data=proc, plot.radius=10, alpha=1)

# Calculate the detection probabilities:
detprob &lt;- detectability_cps(data=thinned, plot.radius=10, alpha=1)

# Calculate estimates of stand density (number of trees) and basal area 
# (the sum of areas covered by tree stems at breast height):
mydata&lt;-cbind(detprob[,5], 1, pi*detprob[,3]^2)

HTest_cps(data=mydata)

# Calculate estimate of mean DBH and a 99 per cent approximate confidence interval:
mydata&lt;-cbind(detprob[,5], detprob[,3])

HTest_cps(data=mydata, total=FALSE, confidence.level=0.99)

## End(Not run)
</code></pre>

<hr>
<h2 id='ImputeHeights'>
Impute missing tree heights into a forest data using a nonlinear (mixed-effects) model. 
</h2><span id='topic+ImputeHeights'></span>

<h3>Description</h3>

<p>A function to impute tree heights in a forest inventory situation where all trees have been measured 
for diameter but only some trees have been measured for height. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ImputeHeights(d, h, plot, modelName = "naslund", nranp = 2, varf = TRUE, 
              addResidual = FALSE, makeplot=TRUE, level = 1,
              start=NA, bh=1.3, control=list(),random=NA)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ImputeHeights_+3A_d">d</code></td>
<td>

<p>A numerical vector of tree diameters, usually given in cm.
</p>
</td></tr>
<tr><td><code id="ImputeHeights_+3A_h">h</code></td>
<td>

<p>A numerical vector of tree heights, usually given in meters. Should be of the same length as <code>d</code>. 
</p>
</td></tr>
<tr><td><code id="ImputeHeights_+3A_plot">plot</code></td>
<td>

<p>A vector of type <code>numeric</code> or <code>factor</code>, defining the groups of the data; usually the plot indices. 
Should be of the same length as <code>d</code> and <code>h</code>.
</p>
</td></tr>
<tr><td><code id="ImputeHeights_+3A_modelname">modelName</code></td>
<td>

<p>Either (i) a character vector specifying the name of the nonlinear function or (ii) the formula specifying 
a linear model.
In case (i) the name should be one of the functions documented on the help page of <code><a href="#topic+HDmodels">HDmodels</a></code>. 
In case (ii), it should be the linear formula in the form that is entered to the function <code><a href="nlme.html#topic+lme">lme</a></code>, for example 
<code>model=h~d+I(d^2)-1</code>
</p>
</td></tr>
<tr><td><code id="ImputeHeights_+3A_nranp">nranp</code></td>
<td>

<p>Parameters nranp and random specify two alternative ways to specify the random effects of the model. An easy but restricted way 
is to use argument <code>nranp</code>. It is an integer between 0 and the number of fixed parameters, and has the the following meaning 
in the case of nonlinear model: 
</p>

<ul>
<li><p> If <code>nranp=0</code>, then a model without random parameters is fitted. 
Results to a fixed-effects model, and argument <code>plot</code> is not used.  
</p>
</li>
<li><p> If <code>nranp=1</code>, then parameter a of a nonlinear function or the first coefficient of the linear formula 
is assumed to vary among plots. 
</p>
</li>
<li><p> If <code>nranp=2</code>, then a and b or the first two terms of the linear formula are assumed to vary among plots or  
</p>
</li>
<li><p> If <code>nranp=3</code>, then a b, and c of a three-parameter nonlinear model or three first coefficients of a linear model 
are assumed to vary among plots
</p>
</li></ul>

<p>In the case of linear model, the constant (if exists) it always counted as the first term.  
</p>
<p>As an alternative to nranp, argument <code>random</code> can be used to express the random part as a nlme formula, 
but without specification of the grouping structure. The provided formula is passed to the lme or nlme 
function. Argument random is always used when provided, so nranp has effect only if <code>random=NA</code> (the default).                           
</p>
</td></tr>
<tr><td><code id="ImputeHeights_+3A_varf">varf</code></td>
<td>

<p>Numeric with values 0, 1 or 2. If 0 or FALSE, no variance function is used. 
If varf=1, 2 or TRUE, then the power- type variance function var(e)=sigma^2*w^(2*delta) is used.
where weight w is the raw diameter (when varf=1 or TRUE), or w=max(1,dsd+3) (when varf=2), 
where dsd=(d-D)/SDD. Here d is tree diameter, D and SDD are the mean and standard deviation 
of diameters on the plot in question.    
</p>
</td></tr>
<tr><td><code id="ImputeHeights_+3A_addresidual">addResidual</code></td>
<td>

<p>Boolean. If <code>TRUE</code>, a random residual is added to the imputed height from a normal distribution using 
the estimated variance function. If also <code>level=0</code> or if the plot did not include any measured heights
to predict the random effects,  
then also a randomly selected plot effect from among the predicted plot effects is added.
The added plot effect is the same for all trees of a given plot.
</p>
</td></tr>
<tr><td><code id="ImputeHeights_+3A_makeplot">makeplot</code></td>
<td>

<p>Should a residual plot of the fitted model be produced for evaluation of goodness of fit? 
The plot is produced using the default arguments of function <code><a href="#topic+plot.hdmod">plot.hdmod</a></code>, 
and is not affected by the value of arguments <code>level</code> and <code>addResidual</code>. 
</p>
</td></tr>
<tr><td><code id="ImputeHeights_+3A_level">level</code></td>
<td>

<p>The level of prediction. 0 means fixed-effect prediction and 1 means plot-level prediction using the random effects. Has no effect if <code>nranp=0</code>. 
</p>
</td></tr>
<tr><td><code id="ImputeHeights_+3A_start">start</code>, <code id="ImputeHeights_+3A_bh">bh</code>, <code id="ImputeHeights_+3A_control">control</code>, <code id="ImputeHeights_+3A_random">random</code></td>
<td>

<p>Arguments passed to <code>fithd</code>. See documentation of <code><a href="#topic+fithd">fithd</a></code>. 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function predicts the missing 
heights using a nonlinear mixed-effects model or a nonlinear fixed-effects model. In mixed-effects model, 
plot-specific random effects can be used if other tree heights have been measured from the same plot. 
Also random, normally distributed residual can be added to the heights according to the estimated 
constant or heteroscedastic residual variance structure. 
</p>


<h3>Value</h3>

<p>A list of components
</p>
<table>
<tr><td><code>h</code></td>
<td>
<p>A vector of tree heights, including the measured heights for the trees with known height and imputed heights for the others.</p>
</td></tr>
<tr><td><code>imputed</code></td>
<td>
<p>A booelan vector of the same length as h, having value TRUE for imputed heights. Produced as <code>is.na(data$h)</code></p>
</td></tr>
<tr><td><code>model</code></td>
<td>
<p>The fitted model that was used in imputation. Fitted using <code><a href="#topic+fithd">fithd</a></code> which in turn 
calls <code><a href="nlme.html#topic+nlme">nlme</a></code> or  <code><a href="nlme.html#topic+gnls">gnls</a></code></p>
</td></tr>
<tr><td><code>predType</code></td>
<td>
<p>A vector of the same length as h, including information on the level of prediction. Value 0 means a measured height 
(no model prediction is used), value 1 means the plot-level prediction has been done using the estimated plot effects.
Value 2 means that no sample trees were available and the prediction is based on fixed part only (if level=0) or on a simulated 
plot effect (if level=1).</p>
</td></tr>
<tr><td><code>hpred</code></td>
<td>
<p>Predicted heights for all trees. Equals to vector h for trees that had missing heights.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Works only with the nonlinear functions specified in <code><a href="#topic+HDmodels">HDmodels</a></code>; does not work if the modelName is specified as a linear expression.
</p>


<h3>Author(s)</h3>

<p>Lauri Mehtatalo &lt;<a href="mailto:lauri.mehtatalo@uef.fi">lauri.mehtatalo@uef.fi</a>&gt;
</p>


<h3>References</h3>

<p>Mehtatalo, L., Gregoire, T.G., and de Miguel, S. Modeling Height-diameter curves for height prediction. Canadian Journal of Forest Research, 45(7): 826-837, <a href="https://doi.org/10.1139/cjfr-2015-0054">doi:10.1139/cjfr-2015-0054</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fithd">fithd</a></code> for model fitting and <code><a href="#topic+plot.hdmod">plot.hdmod</a></code> for plotting.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(spati) 

ImpFixed&lt;-ImputeHeights(spati$d,spati$h,spati$plot,level=0)
ImpRandom&lt;-ImputeHeights(spati$d,spati$h,spati$plot,level=1,makeplot=FALSE)
# Try also
# ImpRanRes&lt;-ImputeHeights(spati$d,spati$h,spati$plot,level=1,addResidual=TRUE,makeplot=FALSE)

plot(spati$d[!is.na(spati$h)],
     spati$h[!is.na(spati$h)],
     col=spati$plot[!is.na(spati$h)],
     main="Observations", xlab="d, cm", ylab="h, m",
     ylim=c(0,30))

plot(spati$d[ImpFixed$imputed],
     ImpFixed$h[ImpFixed$imputed],
     col=spati$plot[ImpFixed$imputed],
     main="Imputed, Naslund, Fixed", xlab="d, cm", ylab="h, m",
     ylim=c(0,30))
       
plot(spati$d[ImpRandom$imputed],
     ImpRandom$h[ImpRandom$imputed],
     col=spati$plot[ImpRandom$imputed],
     main="Imputed, Naslund, Fixed + Plot", xlab="d, cm", ylab="h, m",
     ylim=c(0,30))

# Try also
# plot(spati$d[ImpRanRes$imputed],
#     ImpRanRes$h[ImpRanRes$imputed],
#     col=spati$plot[ImpRanRes$imputed],
#     main="Imputed, Naslund, Fixed + Plot + Tree", xlab="d, cm", ylab="h, m",
#     ylim=c(0,30))
</code></pre>

<hr>
<h2 id='ips'>
Wood-decaying fungi carried by bark beetle individuals and their mites.
</h2><span id='topic+ips'></span>

<h3>Description</h3>

<p>The total number of fungal species (ophistomatoid and non-ophistomatoid fungi are coded separately) 
associated with <em>Ips typographus</em> bark beetle individuals and their mites.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(ips)</code></pre>


<h3>Format</h3>

<p>A data frame with 298 observations (bark betle individuals) on the following 5 variables.
</p>

<dl>
<dt><code>Fungi</code></dt><dd><p>The total number of fungal species associated with the individual bark beetle.</p>
</dd>
<dt><code>Ophi</code></dt><dd><p>The number of ophistomatoid fungal species.</p>
</dd>
<dt><code>Other</code></dt><dd><p>The number of non-ophistomatoid fungal species. The three first variables are related through <code class="reqn">Other+Ophi=Fungi</code>.</p>
</dd>
<dt><code>Season</code></dt><dd><p>Categorical time of data collection with three levels: spring, summer or fall. The default is spring.</p>
</dd>
<dt><code>Mites</code></dt><dd><p>The number of mites found in the bark beetle.</p>
</dd>
</dl>



<h3>Details</h3>

<p>The ophiostomatoid fungal families <em>Microascales</em> and
<em>Ophiostomatales</em> are common associates of bark beetle <em>Ips
typographus</em>, which they use to spread within the wood material. The number of
fungal species in these families is high, and a certain beetle individual can 
carry several fungal species with it. The bark beetles may have
mites attached to them, and it may be possible that some
fungal species are associated to the beetles only through the mites. 
</p>
<p>The dataset includes measurements of 289 bark beetle
individuals from a storm-felled Norway spruce forest in eastern Finland. For
each individual, the number of attached mites was determined using a
microscope. In addition the number of fungal species per
bark beetle was determined genetically. However, it was not possible to determine
whether the fungi were associated with the mites or the bark beetle itself. The
observations were collected at three different seasons: spring, summer and
fall of the same year, approximately 100 individuals in each season. The data are used to analyze the
effects of season and number of mites on the number of fungal species per bark
beetle. 
</p>


<h3>References</h3>

<p>Linnakoski, R., Mahilainen, S., Harrington, A., Vanhanen, H., Eriksson, M., Mehtatalo, L., 
Pappinen, A., Wingfield, M.J. 2016. The seasonal succession of fungi associated with Ips typographus 
beetles and their phoretic mites in an outbreak region of Finland. PLOS ONE. <a href="https://doi.org/10.1371/journal.pone.0155622">doi:10.1371/journal.pone.0155622</a>. 
</p>
<p>Mehtatalo, Lauri and Lappi, Juha 2020. Biometry for Forestry and Environmental Data: with examples in R. 
New York: Chapman and Hall/CRC. 426 p. <a href="https://doi.org/10.1201/9780429173462">doi:10.1201/9780429173462</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(ips)

ips$Mites2&lt;-ips$Mites-mean(ips$Mites)

mod1&lt;-glm(Fungi~Season+Mites,family=poisson,data=ips)
</code></pre>

<hr>
<h2 id='linesplot'>
A spaghetti plot of grouped data
</h2><span id='topic+linesplot'></span>

<h3>Description</h3>

<p>Orders the observations by <code>x</code> and thereafter plots <code>y</code> on <code>x</code> and connects observations of the same group by lines. 
Useful, for example, to plot a longitudinal dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>linesplot(x, y, group, xlab = "x", ylab = "y", 
          main = "", cex = 0.5, pch = 19, col = 1, col.lin = 1, 
          lw = FALSE, ylim = NULL, xlim = NULL, add = FALSE, lty = "solid", lwd=1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="linesplot_+3A_x">x</code>, <code id="linesplot_+3A_y">y</code></td>
<td>
<p> Numerical vectors of the same length including the x and y variables.  
</p>
</td></tr>
<tr><td><code id="linesplot_+3A_group">group</code></td>
<td>

<p>The variable specifying the group. Should be of the same length as vectors x and y.
</p>
</td></tr>
<tr><td><code id="linesplot_+3A_xlab">xlab</code>, <code id="linesplot_+3A_ylab">ylab</code>, <code id="linesplot_+3A_main">main</code>, <code id="linesplot_+3A_cex">cex</code>, <code id="linesplot_+3A_pch">pch</code>, <code id="linesplot_+3A_col">col</code>, <code id="linesplot_+3A_col.lin">col.lin</code>, <code id="linesplot_+3A_xlim">xlim</code>, <code id="linesplot_+3A_ylim">ylim</code>, <code id="linesplot_+3A_lty">lty</code>, <code id="linesplot_+3A_lwd">lwd</code></td>
<td>

<p>Graphical parameters, see <code><a href="graphics.html#topic+par">par</a></code>
</p>
</td></tr>
<tr><td><code id="linesplot_+3A_lw">lw</code></td>
<td>

<p>Boolean. Whether a loess smoother to be added onto the plot.
</p>
</td></tr>
<tr><td><code id="linesplot_+3A_add">add</code></td>
<td>

<p>Boolean. Whether to add to an existing plot or to open a new window. 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The observations within the group are connected at the increasing order of <code>x</code>. 
</p>


<h3>Value</h3>

<p>Used for its side effects.
</p>


<h3>Author(s)</h3>

<p>Lauri Mehtatalo &lt;<a href="mailto:lauri.mehtatalo@uef.fi">lauri.mehtatalo@uef.fi</a>&gt;
</p>


<h3>References</h3>

<p>Mehtatalo, Lauri and Lappi, Juha 2020. Biometry for Forestry and Environmental Data: with examples in R. 
New York: Chapman and Hall/CRC. 426 p. <a href="https://doi.org/10.1201/9780429173462">doi:10.1201/9780429173462</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>D&lt;-rep(seq(10,30),10)
H&lt;-(20+rep(rnorm(10,0,0.5),each=21))*exp(-1.5*D^(-1.3))
plot&lt;-rep(1:10,each=21)
linesplot(D,H,plot)
</code></pre>

<hr>
<h2 id='lmfor-package'>
Functions of Lauri Mehtatalo
</h2><span id='topic+lmfor-package'></span><span id='topic+lmfor'></span>

<h3>Description</h3>

<p>Functions for different purposes related to Forest biometrics, 
including illustrative graphics, numerical computation, modeling height-diameter relationships, 
prediction of tree volumes, modeling of diameter distributions and estimation off stand density using ITD. 
Several empirical datasets are also included; those data sets are used in the examples of Mehtatalo and Lappi (2020a, 2020b).
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> lmfor</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.5</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2020-06-16</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL -2 </td>
</tr>
<tr>
 <td style="text-align: left;">
LazyLoad: </td><td style="text-align: left;"> yes</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Lauri Mehtatalo &lt;<a href="mailto:lauri.mehtatalo@uef.fi">lauri.mehtatalo@uef.fi</a>&gt; and Kasper Kansanen &lt;<a href="mailto:kasperkansanen@gmail.com">kasperkansanen@gmail.com</a>&gt;
</p>


<h3>References</h3>

<p>Mehtatalo, Lauri and Lappi, Juha 2020a. Biometry for Forestry and Environmental Data: with examples in R. New York: Chapman and Hall/CRC. 426 p. <a href="https://doi.org/10.1201/9780429173462">doi:10.1201/9780429173462</a>.
</p>
<p>Mehtatalo, Lauri and Lappi, Juha 2020b. Biometry for Forestry and Environmental Data: with examples in R. Full Versions of The Web Examples. Available at <a href="http://www.biombook.org">http://www.biombook.org</a>. 
</p>

<hr>
<h2 id='logit-logistic'>
The Four-parameter Logit-logistic Distribution
</h2><span id='topic+dll'></span><span id='topic+pll'></span><span id='topic+qll'></span><span id='topic+rll'></span>

<h3>Description</h3>

<p>Density, distribution function, quantile function and random generation for the four-parameter logit-logistic distribution. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dll(x, mu, sigma, xi=0, lambda=1, log = FALSE)
pll(q, mu, sigma, xi=0, lambda=1, lower.tail=TRUE, log.p=FALSE)
qll(p, mu, sigma, xi=0, lambda=1, lower.tail=TRUE, log.p=FALSE)
rll(n, mu, sigma, xi=0, lambda=1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="logit-logistic_+3A_x">x</code>, <code id="logit-logistic_+3A_q">q</code></td>
<td>

<p>vector of quantiles
</p>
</td></tr>
<tr><td><code id="logit-logistic_+3A_p">p</code></td>
<td>

<p>vector of probabilitiies
</p>
</td></tr>
<tr><td><code id="logit-logistic_+3A_n">n</code></td>
<td>

<p>number of observations. If <code>length(n) &gt; 1</code>, the length is taken to be the number required.
</p>
</td></tr>
<tr><td><code id="logit-logistic_+3A_mu">mu</code>, <code id="logit-logistic_+3A_sigma">sigma</code>, <code id="logit-logistic_+3A_xi">xi</code>, <code id="logit-logistic_+3A_lambda">lambda</code></td>
<td>

<p>parameters of the distribution, <code>xi</code> (minimum) defaults to 0 and <code>lambda</code> (max-min) to 1. 
</p>
</td></tr>
<tr><td><code id="logit-logistic_+3A_log">log</code>, <code id="logit-logistic_+3A_log.p">log.p</code></td>
<td>

<p>logical; if TRUE, probabilities p are given as log(p)  
</p>
</td></tr>
<tr><td><code id="logit-logistic_+3A_lower.tail">lower.tail</code></td>
<td>

<p>logical; if TRUE (default), probabilities are <code class="reqn">P[X \le x]</code> otherwise <code class="reqn">P[X &gt; x]</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The logit-logistic cdf and pdf are
</p>
<p style="text-align: center;"><code class="reqn">F(d|\xi,\lambda,\mu,\sigma)  = 
 \frac{1}{1+e^{(\frac{\mu}{\sigma})}
  (\frac{d-\xi}{\xi+\lambda-d})^{-\frac{1}{\sigma}}}</code>
</p>

<p style="text-align: center;"><code class="reqn">f(d|\xi,\lambda,\mu,\sigma) =
  \frac{\lambda}{\sigma}\frac{1}{(d-\xi)(\xi+\lambda-d)}
  \frac{1}{e^{-\frac{\mu}{\sigma}}(\frac{d-\xi}{\xi+\lambda-d})^{\frac{1}{\sigma}}+e^{\frac{\mu}{\sigma}}(\frac{d-\xi}{\xi+\lambda-d})^{-\frac{1}{\sigma}}+2}</code>
</p>

<p>Parameter <code class="reqn">\xi</code> is the minimum, <code class="reqn">\lambda&gt;0</code> the width of range (max-min), <code class="reqn">\mu</code> controls the skewness and <code class="reqn">\sigma</code> the curtosis.  
</p>


<h3>Value</h3>

<p><code>dll</code> gives the density, <code>pll</code> gives the distribution function, <code>qll</code> gives the quantile function, and <code>rll</code> generates random deviates.
</p>
<p>Invalid arguments will result in return value <code>NaN</code>.
</p>
<p>The length of the result is determined by <code>n</code> for <code>rll</code>, and is the maximum of the lengths of the numerical arguments for the other functions.
</p>
<p>The numerical arguments other than <code>n</code> are recycled to the length of the result. Only the first elements of the logical arguments are used. 
</p>


<h3>Author(s)</h3>

<p>Lauri Mehtatalo &lt;<a href="mailto:lauri.mehtatalo@uef.fi">lauri.mehtatalo@uef.fi</a>&gt;
</p>


<h3>References</h3>

<p>Mingliang Wang and Keith Rennolls, 2005. Tree diameter distribution modelling: introducing the logit-logistic distribution. Canadian Journal of Forest Research, 35(6): 1305-1313, <a href="https://doi.org/10.1139/x05-057">doi:10.1139/x05-057</a>.
</p>
<p>Mehtatalo, Lauri and Lappi, Juha 2020. Biometry for Forestry and Environmental Data: with examples in R. 
New York: Chapman and Hall/CRC. 426 p. <a href="https://doi.org/10.1201/9780429173462">doi:10.1201/9780429173462</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(spati)
d&lt;-spati$d[spati$plot==22]
hist(d,freq=FALSE)
d0&lt;-seq(0,60,0.1)
lines(d0,dll(d0,0.630,0.573,3.561,35.2))
</code></pre>

<hr>
<h2 id='mywhiskers'>A whiskers type residual plot</h2><span id='topic+mywhiskers'></span>

<h3>Description</h3>

<p>A function for adding vertical lines onto residual plots to show 
</p>

<ol>
<li><p> 95% confidence intervals of means or 
</p>
</li>
<li><p> 95% confidence intervals for individual observations 
</p>
</li></ol>
<p>in the classes of the 
variable on the x-axis. Plot of the first type is useful for analyzing the fit of the assumed fixed part and plots of 
type b can be used to analyze the homogeneity of residuals. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mywhiskers(x, y, 
           nclass = 10, 
           limits = NA, 
           add = FALSE, 
           se = TRUE, 
           main = "", 
           xlab = "x", 
           ylab = "y", 
           ylim = NA, 
           lwd = 1, 
           highlight = "red")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mywhiskers_+3A_x">x</code></td>
<td>
<p> The variable on the x-axis. Usually one of the predictors or the predicted value.
</p>
</td></tr>
<tr><td><code id="mywhiskers_+3A_y">y</code></td>
<td>
<p>The variable on the y-axis. Usually model residual.
</p>
</td></tr>
<tr><td><code id="mywhiskers_+3A_nclass">nclass</code></td>
<td>

<p>The maximum number of classes to be used.
</p>
</td></tr>
<tr><td><code id="mywhiskers_+3A_limits">limits</code></td>
<td>

<p>The class limits. Alternative to nclass.
</p>
</td></tr>
<tr><td><code id="mywhiskers_+3A_add">add</code></td>
<td>

<p>logical. Whether a new graphic window is opened or the lines will be added into an exosting plot.
</p>
</td></tr>
<tr><td><code id="mywhiskers_+3A_se">se</code></td>
<td>

<p>Logical. Use standard errors of means (se=TRUE, option (a) above) or class-specific standard deviations 
(se=FALSE, option (b) above).
</p>
</td></tr>
<tr><td><code id="mywhiskers_+3A_main">main</code>, <code id="mywhiskers_+3A_xlab">xlab</code>, <code id="mywhiskers_+3A_ylab">ylab</code>, <code id="mywhiskers_+3A_ylim">ylim</code>, <code id="mywhiskers_+3A_lwd">lwd</code></td>
<td>

<p>Graphical parameters of the plot. ignored if <code>add=TRUE</code>.
</p>
</td></tr>
<tr><td><code id="mywhiskers_+3A_highlight">highlight</code></td>
<td>

<p>The color for lines that do not cross the y-axis.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function first classifies the data in <code>nclass</code> classes of variable x so that 
each class has approximately equal number of observations. 
Then the class mean and deviation s is computed for each class, where s is either 
the standard error of the mean (if <code>se=TRUE</code>) 
or standard deviation (if <code>se=FALSE</code>). 
A vertical line is plotted at the middle of each class showing the class mean by a dot and 
lines of length 3.92*s. If the line does not cross the x- axis, then the highlight color is used in the line.
With small number of observations (or lot of ties), the number of classes is decreased until 
each class includes the minimum of 2 observations.  
</p>


<h3>Value</h3>

<p>The function is usually used for its side effects (i.e., the plot). However, the values used in producing 
the plot are returned in a list of elements 
</p>

<ul>
<li><p> x: the class middlepoint <code>x</code> values.
</p>
</li>
<li><p> m: class-specific means of <code>y</code>.
</p>
</li>
<li><p> s: class-specific standard deviations or standard errors of <code>y</code> (see details).
</p>
</li>
<li><p> lb: lower ends of the class-specific lines.
</p>
</li>
<li><p> ub: upper ends of the lines.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Lauri Mehtatalo &lt;<a href="mailto:lauri.mehtatalo@uef.fi">lauri.mehtatalo@uef.fi</a>&gt;
</p>


<h3>References</h3>

<p>Mehtatalo, Lauri and Lappi, Juha 2020. Biometry for Forestry and Environmental Data: with examples in R. 
New York: Chapman and Hall/CRC. 426 p. <a href="https://doi.org/10.1201/9780429173462">doi:10.1201/9780429173462</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x&lt;-seq(1,100,1)
y&lt;-x+10*log(x)+rnorm(100,0,5)
fm1&lt;-lm(y~x)
plot(x,resid(fm1))
mywhiskers(x,resid(fm1),se=FALSE,add=TRUE)
mywhiskers(x,resid(fm1),se=TRUE,lwd=2,add=TRUE)
abline(h=0)
</code></pre>

<hr>
<h2 id='NR'>
Solve a Nonlinear Equation Using Newton-Raphson algorithm.
</h2><span id='topic+NR'></span>

<h3>Description</h3>

<p>Solves an equation equation of form <code class="reqn">f(x)=0</code>, for scalar <code class="reqn">x</code> using the Newton-Raphson algorithm.  
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NR(init, fn, gr, crit = 6, range = c(-Inf, Inf))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="NR_+3A_init">init</code></td>
<td>

<p>Numeric scalar, The initial guess for <code class="reqn">x</code>.
</p>
</td></tr>
<tr><td><code id="NR_+3A_fn">fn</code></td>
<td>

<p>An R-function returning the scalar value of <code class="reqn">f(x)</code>, with <code class="reqn">x</code> as the only argument. 
</p>
</td></tr>
<tr><td><code id="NR_+3A_gr">gr</code></td>
<td>

<p>An R-function returning the first derivative of <code class="reqn">f(x)</code>, with <code class="reqn">x</code> as the only argument. 
</p>
</td></tr>
<tr><td><code id="NR_+3A_crit">crit</code></td>
<td>

<p>Convergence criteria. The upper limit for the absolute value of <code class="reqn">f(x)</code> at an accepted the solution. 
</p>
</td></tr>
<tr><td><code id="NR_+3A_range">range</code></td>
<td>

<p>A two-unit vector giving the upper and lower bounds for <code class="reqn">x</code>. The solution is searched from within this range.   
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function is a straightforward implementation of the well-known Newton-Raphson algorithm. 
</p>


<h3>Value</h3>

<p>A list of components 
</p>
<table>
<tr><td><code>par</code></td>
<td>
<p>the value of <code class="reqn">x</code> in the solution</p>
</td></tr>
<tr><td><code>crit</code></td>
<td>
<p>the value of <code class="reqn">f(x)</code> at the solution</p>
</td></tr>
</table>
<p>If estimation fails (no solution is found during 100000 iterations), both e
lements of the solution are NA's. 
</p>


<h3>Author(s)</h3>

<p>Lauri Mehtatalo &lt;<a href="mailto:lauri.mehtatalo@uef.fi">lauri.mehtatalo@uef.fi</a>&gt;
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+NRnum">NRnum</a></code> for a vector-valued x without analytical gradients.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Numerically solve Weibull shape for a stand
## where DGM=15cm, G=15m^2/ha and N=1000 trees per ha
func&lt;-function(shape,G,N,DGM) {
##      print(G,DGM,N)
      val&lt;-pi/(4*gamma(1-2/shape)*log(2)^(2/shape))-G/(N*DGM^2)
      val
      }

grad&lt;-function(shape) {
      pi/4*(-1)*                                                            
      (gamma(1-2/shape)*log(2)^(2/shape))^(-2)*                             
      (gamma(1-2/shape)*digamma(1-2/shape)*2*shape^(-2)*log(2)^(2/shape)+   
      log(2)^(2/shape)*log(log(2))*(-2)*shape^(-2)*gamma(1-2/shape))         
      }
      
shape&lt;-NR(5,fn=function(x) func(x,G=10000*15,1000,15),gr=grad,crit=10,range=c(2.1,Inf))$par
</code></pre>

<hr>
<h2 id='NRnum'>
Solve a Systems of Nonlinear Equations Using the Newton's Method
</h2><span id='topic+NRnum'></span>

<h3>Description</h3>

<p>Solves a system of equations of form <code class="reqn">f_1(x) = 0</code>,<code class="reqn">f_2(x) = 0</code>,...,<code class="reqn">f_p(x) = 0</code> for 
vector <code class="reqn">x</code> using the multidimensional version of the Newton-Raphson algorithm. 
The gradients  are solved numerically within the function using R-function <code>numericDeriv</code>. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NRnum(init, fnlist, crit = 6, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="NRnum_+3A_init">init</code></td>
<td>

<p>vector of initial values for <code class="reqn">x</code>.
</p>
</td></tr>
<tr><td><code id="NRnum_+3A_fnlist">fnlist</code></td>
<td>

<p>list of R-functions for <code class="reqn">f_1(x)</code>, <code class="reqn">f_2(x)</code>, ..., <code class="reqn">f_p(x)</code> each function gets a vector-valued argument <code class="reqn">x</code> and returns a scalar value.
</p>
</td></tr>
<tr><td><code id="NRnum_+3A_crit">crit</code></td>
<td>

<p>Convergence criterion. Stop iteration when (<code class="reqn">|f_1(x)|+|f_2(x)|+...+|f_p(x)|&lt;crit</code>). 
</p>
</td></tr>
<tr><td><code id="NRnum_+3A_...">...</code></td>
<td>

<p>Other arguments passed to the functions of <code>fnlist</code>
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of components 
</p>
<table>
<tr><td><code>par</code></td>
<td>
<p>the value of vector <code class="reqn">x</code> in the solution</p>
</td></tr>
<tr><td><code>crit</code></td>
<td>
<p>the value of the convergence criterion at the solution</p>
</td></tr>
</table>
<p>If estimation fails (no solution is found during 100 iterations), both elements of the solution are NA's. 
</p>


<h3>Author(s)</h3>

<p>Lauri Mehtatalo, &lt;<a href="mailto:lauri.mehtatalo@uef.fi">lauri.mehtatalo@uef.fi</a>&gt;
</p>


<h3>See Also</h3>

<p>Function <code><a href="#topic+NR">NR</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Moment-based recovery of Weibull parameters
mu&lt;-14
mu2&lt;-210
muf&lt;-function(theta) theta[2]*gamma(1+1/theta[1])-mu
mu2f&lt;-function(theta) theta[2]^2*gamma(1+2/theta[1])-mu2
functions&lt;-list(muf,mu2f)
momrec&lt;-NRnum(c(3,13),functions)
momrec$par
</code></pre>

<hr>
<h2 id='patti'>
Increment core data of Scots pine trees
</h2><span id='topic+patti'></span>

<h3>Description</h3>

<p>Growth ring measurements of 88 trees of a long-term thinning 
experiment on a naturally regenerated
Scots pine stand in Eastern Finland. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(patti)</code></pre>


<h3>Format</h3>

<p>A data frame with 3604 observations on the following 9 variables.
</p>

<dl>
<dt><code>Plot</code></dt><dd><p>Sample plot id, a factor with 10 levels.</p>
</dd>
<dt><code>Tree</code></dt><dd><p>Tree id, a factor with 55 levels (same tree id may occur on different plots!).</p>
</dd>
<dt><code>SDClass</code></dt><dd><p>Thinning treatment, factor with 4 levels (1=Control, 2=Light, 3=Moderate, 4=Heavy).</p>
</dd>
<dt><code>Diam1986</code></dt><dd><p>Tree diameter in year 1986, just before the thinning.</p>
</dd>
<dt><code>Year</code></dt><dd><p>Calendar year of the ring.</p>
</dd>
<dt><code>CA</code></dt><dd><p>Current tree age in years.</p>
</dd>
<dt><code>RW</code></dt><dd><p>Ring width, <code class="reqn">mm</code> </p>
</dd>
<dt><code>RD</code></dt><dd><p>Ring density, <code class="reqn">g/cm^3</code></p>
</dd>
<dt><code>RBA</code></dt><dd><p>Ring Basal area, <code class="reqn">mm^2</code> </p>
</dd>
</dl>



<h3>Details</h3>

<p>Long-term thinning experiment on a naturally regenerated
Scots pine stand in Eastern Finland. The experiment consists of 10
sample plots, in four different classes according
to the post-thinning stand density. The plots were thinned in winter 1986-1987. 
In winter 2006&ndash;2007, 10 trees were felled from each plot.
A radial 5mm by 5mm segment from pith to bark was cut from each tree at height 1.3 meter height.
Ring widths from pith to bark were analyzed for
each sample, using an ITRAX X-ray microdensitometer an post-processed to
create ring widths from pith to bark were determined for
each disc. The ring widths were further transformed to ring basal areas by assuming circular, 
growth rings. For 12 trees, ring widths could not be extracted. The data includes 
ring widths for a total of 88 trees between years 1991-2005. 
</p>


<h3>References</h3>

<p>Mehtatalo, L., Peltola, H., Kilpelainen, A. and Ikonen, V.-P. 2014. The response of basal area growth 
of Scots pine to thinning: A longitudinal analysis of tree-specific series using a nonlinear 
mixed-effects model. Forest Science 60 (4): pp. 636-644. <a href="https://doi.org/10.5849/forsci.13-059">doi:10.5849/forsci.13-059</a>.
</p>
<p>Mehtatalo, Lauri and Lappi, Juha 2020. Biometry for Forestry and Environmental Data: with examples in R. 
New York: Chapman and Hall/CRC. 426 p. <a href="https://doi.org/10.1201/9780429173462">doi:10.1201/9780429173462</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+afterthin">afterthin</a></code>, <code><a href="#topic+thefdata">thefdata</a></code>, <code><a href="#topic+thinning">thinning</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(afterthin)
par(mfcol=c(2,1),cex=0.7,mai=c(0.8,0.8,0.5,0.1))
linesplot(afterthin$CA,
		  afterthin$RBA,
		  group=afterthin$Plot:afterthin$Tree,
		  col.lin=as.numeric(afterthin$SDClass),cex=0,
		  xlab="Tree age",
		  ylab=expression("Ring basal area, "*mm^2))
		  
linesplot(afterthin$Year,
		  afterthin$RBA,
		  group=afterthin$Plot:afterthin$Tree,
		  col.lin=as.numeric(afterthin$SDClass),cex=0,
		  xlab="Year",
		  ylab=expression("Ring basal area, "*mm^2))
</code></pre>

<hr>
<h2 id='percentile-based'>
The Percentile-based Distribution
</h2><span id='topic+dPercbas'></span><span id='topic+pPercbas'></span><span id='topic+qPercbas'></span><span id='topic+rPercbas'></span>

<h3>Description</h3>

<p>Density, distribution function, quantile function and random generation for the percentile-based distribution. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dPercbas(x, xi, F)
pPercbas(q, xi, F)
qPercbas(p, xi, F)
rPercbas(n, xi, F)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="percentile-based_+3A_x">x</code>, <code id="percentile-based_+3A_q">q</code></td>
<td>

<p>vector of quantiles
</p>
</td></tr>
<tr><td><code id="percentile-based_+3A_p">p</code></td>
<td>

<p>vector of probabilitiies
</p>
</td></tr>
<tr><td><code id="percentile-based_+3A_n">n</code></td>
<td>

<p>number of observations. If <code>length(n) &gt; 1</code>, the length is taken to be the number required.
</p>
</td></tr>
<tr><td><code id="percentile-based_+3A_xi">xi</code></td>
<td>

<p>Strictly increasing vector of percentiles corresponding to the cumulative probabilities given in <code>F</code>. Of same length as <code>F</code>. 
</p>
</td></tr>
<tr><td><code id="percentile-based_+3A_f">F</code></td>
<td>

<p>a <code>k</code>-length strictly increasing  vector of cumulative probabilities, with <code>xi[1]=0</code> and <code>xi[k]=1</code>. 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The percentile-based distribution is defined by the quantiles <code>xi</code> that correspond to the cumulative probabilities given in <code>F</code>. 
The continuous distribution is obtained by linear interpolation of the cdf. 
</p>


<h3>Value</h3>

<p><code>dll</code> gives the density, <code>pll</code> gives the distribution function, <code>qll</code> gives the quantile function, and <code>rll</code> generates random deviates.
</p>
<p>The length of the result is determined by <code>n</code> for <code>rPercbas</code>, and by the length of <code>x</code>, <code>q</code> and <code>p</code> for the other functions.
</p>


<h3>Author(s)</h3>

<p>Lauri Mehtatalo &lt;<a href="mailto:lauri.mehtatalo@uef.fi">lauri.mehtatalo@uef.fi</a>&gt;
</p>


<h3>References</h3>

<p>Borders B. E., Souter R. A., Bailey. R. L., and Ware, K. D. 1987. Percentile-based distributions characterize forest stand tables. Forest Science 33(2): 570-576.
</p>
<p>Mehtatalo, L. 2005. Localizing a predicted diameter distribution using sample information. Forest Science 51(4): 292&ndash;302. 
</p>
<p>Mehtatalo, Lauri and Lappi, Juha 2020a. Biometry for Forestry and Environmental Data: with examples in R. New York: Chapman and Hall/CRC. 426 p. 
<a href="https://doi.org/10.1201/9780429173462">doi:10.1201/9780429173462</a>
</p>
<p>Mehtatalo, Lauri and Lappi, Juha 2020b. Biometry for Forestry and Environmental Data: with examples in R. Full Versions of The Web Examples. Available at <a href="http://www.biombook.org">http://www.biombook.org</a>. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>d0&lt;-seq(0,30,0.01)
d&lt;-c(5,7,10,11,11.7,13,15,19,22,24,25,28.5)
plot(d0,pPercbas(d0,d),type="l")
hist(rPercbas(1000,d),breaks=seq(0,30,1),freq=FALSE,ylim=c(0,0.15))
lines(d0,dPercbas(d0,d),col="red")
</code></pre>

<hr>
<h2 id='plants'>
Sapling counts from sample plots of sapling stands in Finland.
</h2><span id='topic+plants'></span>

<h3>Description</h3>

<p>Grouped Norway Spruce regeneration establishment data.</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(plants)</code></pre>


<h3>Format</h3>

<p>A data frame with 1926 observations (fixed-area sample plots) from a total of 123 forest stands, with the following 8 variables.
</p>

<dl>
<dt><code>spruces</code></dt><dd><p>The number of spruce saplings (both planted and natural)</p>
</dd>
<dt><code>stand</code></dt><dd><p>The stand id)</p>
</dd>
<dt><code>hdecid</code></dt><dd><p>The mean height of deciduous tree species</p>
</dd>
<dt><code>prepar</code></dt><dd><p>Site preparation method, categorical with 4 levels</p>
</dd>
<dt><code>stones</code></dt><dd><p>Binary indicator for stoniness</p>
</dd>
<dt><code>wet</code></dt><dd><p>Binary indicator for wetness</p>
</dd>
</dl>



<h3>Details</h3>

<p>The data are collected from 123 fixed-area sample plots with similar age of planted spruce saplings. The variables have been measured on fixed-area plots.
</p>


<h3>References</h3>

<p>Miina, J. and Saksa, T. 2006. Predicting regeneration establishment in Norway spruce plantations using a multivariate multilevel model. New Forests 32: 265-283. <a href="https://doi.org/10.1007/s11056-006-9002-y">doi:10.1007/s11056-006-9002-y</a>
</p>
<p>Mehtatalo, Lauri and Lappi, Juha 2020. Biometry for Forestry and Environmental Data: with examples in R. 
New York: Chapman and Hall/CRC. 426 p. <a href="https://doi.org/10.1201/9780429173462">doi:10.1201/9780429173462</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(plants)
library(lme4)
## Not run: 
glmm1&lt;-glmer(spruces ~ (1|stand)+hdecid+as.factor(prepar)+as.factor(stones)+as.factor(wet), 
             family=poisson(), data=plants)

## End(Not run)
</code></pre>

<hr>
<h2 id='plants2'>
Sapling counts from sample plots of sapling stands in Finland.
</h2><span id='topic+plants2'></span>

<h3>Description</h3>

<p>Independent Norway Spruce regeneration establishment data.</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(plants2)</code></pre>


<h3>Format</h3>

<p>A data frame with 123 observations on the following 8 variables.
</p>

<dl>
<dt><code>planted</code></dt><dd><p>The number of planted spruce saplings on the plot</p>
</dd>
<dt><code>pines</code></dt><dd><p>The number of natural pine saplings</p>
</dd>
<dt><code>spruces</code></dt><dd><p>The number of natural spruce saplings</p>
</dd>
<dt><code>birches</code></dt><dd><p>The number natural birch  saplings</p>
</dd>
<dt><code>othersp</code></dt><dd><p>The number of natural saplings of other species</p>
</dd>
<dt><code>hcrop</code></dt><dd><p>The mean height of crop species</p>
</dd>
<dt><code>hdecid</code></dt><dd><p>The mean height of deciduous tree species</p>
</dd>
<dt><code>sitetype</code></dt><dd><p>Site fertility class (small number indicates more fertile site)</p>
</dd>
</dl>



<h3>Details</h3>

<p>The data are collected from 123 fixed-area sample plots with similar age of planted spruce saplings. The number of saplings per species and the height of 
crop species (spruce and pine) and competing vegetation (birch and other broadleaved trees) has been recorded for all plots. 
The data includes one plot per forest stand.
</p>


<h3>References</h3>

<p>Miina, J. and Saksa, T. 2006. Predicting regeneration establishment in Norway spruce plantations using a multivariate multilevel model. New Forests 32: 265-283. <a href="https://doi.org/10.1007/s11056-006-9002-y">doi:10.1007/s11056-006-9002-y</a>
</p>
<p>Mehtatalo, Lauri and Lappi, Juha 2020. Biometry for Forestry and Environmental Data: with examples in R. 
New York: Chapman and Hall/CRC. 426 p. <a href="https://doi.org/10.1201/9780429173462">doi:10.1201/9780429173462</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(plants2)

glm1 &lt;- glm(spruces ~ hdecid, family=quasipoisson(), data=plants2)
</code></pre>

<hr>
<h2 id='plot.hdmod'>
Diagnostic plot a Height-Diameter model residuals
</h2><span id='topic+plot.hdmod'></span>

<h3>Description</h3>

<p>Plotting method for class <code>hdmod</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'hdmod'
plot(x, col.point = "blue", highlight = "red", standd = TRUE, 
           cex=1, corD=FALSE, ask=TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.hdmod_+3A_x">x</code></td>
<td>

<p>A H-D model model fitted by <code><a href="#topic+fithd">fithd</a></code>.
</p>
</td></tr>
<tr><td><code id="plot.hdmod_+3A_col.point">col.point</code></td>
<td>

<p>The color used for data points
</p>
</td></tr>
<tr><td><code id="plot.hdmod_+3A_highlight">highlight</code></td>
<td>

<p>The color used to higlight classes with mean sighnificantly different from zero
</p>
</td></tr>
<tr><td><code id="plot.hdmod_+3A_standd">standd</code></td>
<td>

<p>Plot residuals against diameter standardized using the plot-specific mean and diameter (<code>standd=TRUE</code>) 
or against raw diameter (<code>standd=FALSE</code>)
</p>
</td></tr>
<tr><td><code id="plot.hdmod_+3A_cex">cex</code></td>
<td>
<p>See <code><a href="graphics.html#topic+par">par</a></code></p>
</td></tr>
<tr><td><code id="plot.hdmod_+3A_cord">corD</code></td>
<td>
<p>should predictions of random effects be plotted on mean diameter of the plot.</p>
</td></tr>
<tr><td><code id="plot.hdmod_+3A_ask">ask</code></td>
<td>
<p>ask before new plot.</p>
</td></tr>
<tr><td><code id="plot.hdmod_+3A_...">...</code></td>
<td>
<p>Other arguments, currently ignored.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function makes residual plots on a fitted H-D model, which can be used to explore whether the fixed part 
satisfactorily models the shape of H-D models. 
The residuals are plotted on diameters standardized at plot level (dsd) or on raw diameters (d) according to argument <code>standd</code>. 
Here <code class="reqn">dsd=(d-D)/SDD</code>, where <code class="reqn">d</code> is tree diameter, <code class="reqn">D</code> and <code class="reqn">SDD</code> are the mean and standard deviation 
of diameters on the plot in question.  Using plot-specific standardized diameter ensures that e.g.,
the medium-sized trees of the plot are always in the middle of the plot, which provides 
a better graph to explore the fit at the plot level in a dataset where the diameter range varies between plots.
</p>


<h3>Author(s)</h3>

<p>Lauri Mehtatalo &lt;<a href="mailto:lauri.mehtatalo@uef.fi">lauri.mehtatalo@uef.fi</a>&gt;
</p>


<h3>See Also</h3>

<p>The function plots model residuals on the required type of diameter and adds a whiskers plot 
using <code><a href="#topic+mywhiskers">mywhiskers</a></code> with argument <code>se=TRUE</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(spati)

model&lt;-fithd(spati$d,spati$h,spati$plot)

plot(model)
</code></pre>

<hr>
<h2 id='predvol'>Individual tree volume functions for Finland</h2><span id='topic+predvol'></span>

<h3>Description</h3>

<p>Predict individual tree volumes using the functions of Laasasenaho(1982). 
The volume prediction can be based on tree diameter or tree diameter and height. 
The functions applying upper stem diameter have not (yet) been implemented.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predvol(species,d,h=0,model=1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predvol_+3A_species">species</code></td>
<td>
<p> The vector of tree species. 1:Pine, 2:Spruce, 3: Silver birch. 4: Downy birch.
Other codes than 1-4 are accepted but return NA as the volume prediction. 
</p>
</td></tr>
<tr><td><code id="predvol_+3A_d">d</code></td>
<td>
<p>The vector of tree diameters at breast height (cm)
</p>
</td></tr>
<tr><td><code id="predvol_+3A_h">h</code></td>
<td>

<p>The vector of tree heights. Used only if model=2.
</p>
</td></tr>
<tr><td><code id="predvol_+3A_model">model</code></td>
<td>

<p>The model used. If model is 1, the prediction is based on tree diameter only. If model=2, then diameter and height are used.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Vectors species, dbh and height should be either scalars 
or vectors of the same length so that each element corresponds to 
one individual tree.
</p>


<h3>Value</h3>

<p>A vector of tree volumes (in liters).
</p>


<h3>Author(s)</h3>

<p>Lauri Mehtatalo &lt;<a href="mailto:lauri.mehtatalo@uef.fi">lauri.mehtatalo@uef.fi</a>&gt;
</p>


<h3>References</h3>

<p>Laasasenaho, Jouko 1982. Taper curve and volume functions for pine, spruce and birch. Comm. Inst. For. Fenn 108: 1-74.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>d&lt;-c(15,18.3,29.3,22.4)
h&lt;-c(13,18,22,19)
species&lt;-c(1,1,1,3)
predvol(species,d,h,model=2)
predvol(species,d,model=1)
</code></pre>

<hr>
<h2 id='qqplotHD'>
Normal QQ-plot of a fitted H-D model
</h2><span id='topic+qqplotHD'></span>

<h3>Description</h3>

<p>Produces a panel of graphs including the Normal qq-plot of a H-D model residuals and of the predicted random effects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>qqplotHD(model, startnew=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="qqplotHD_+3A_model">model</code></td>
<td>

<p>A nonlinear H-D model model fitted by <code><a href="#topic+fithd">fithd</a></code>.
</p>
</td></tr>
<tr><td><code id="qqplotHD_+3A_startnew">startnew</code></td>
<td>

<p>Should a new plotting window be opened?
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function extracts the residuals and the random effects of the fitted Height-Diameter model 
and produces a panel of plots including univariate Normal qq-plots of the model.
</p>


<h3>Author(s)</h3>

<p>Lauri Mehtatalo &lt;<a href="mailto:lauri.mehtatalo@uef.fi">lauri.mehtatalo@uef.fi</a>&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(spati)

model&lt;-fithd(spati$d,spati$h,spati$plot)

qqplotHD(model)
</code></pre>

<hr>
<h2 id='qtree'>
Properties of sample quantiles from a tree population described by the percentile-based diameter distribution. 
</h2><span id='topic+qtree.moments'></span><span id='topic+qtree.jointdens'></span><span id='topic+qtree.exy'></span><span id='topic+qtree.varcov'></span><span id='topic+interpolate.D'></span>

<h3>Description</h3>

<p>Function <code>qtree.moments</code> finds the expected value and variance for <code class="reqn">X_{r:n}</code>;  
the <code>r</code>:th smallest observation in an iid sample of size <code>n</code> from a population with a percentile-based distribution. 
</p>
<p>Function <code>qtree.jointdens</code> computes the bivariate pdf for two quantiles <code class="reqn">(X_{r1:n},X_{r2:n})</code> from the same sample, where <code class="reqn">r1&lt;r2</code>. 
</p>
<p>Function <code>qtree.exy</code> approximates expected value of the product  <code class="reqn">X_{r1:n}X_{r2:n}</code>, i.e. the  
integral of function <code class="reqn">x_{r1:n}x_{r2:n}f_{r1:n,r2:n}(\bm x)</code> over the two-dimensional range of <code class="reqn">\bm x</code> 
by computing for each percentile interval the function mean in a regular npts*npts grid and multiplying the mean by the area.
</p>
<p>Function <code>qtree.varcov</code> returns the expected valuers, cumulative percentage values and the variance-covariance matrices 
that correspond to given sample quantiles and underlying percentile-based distribution of the population. 
</p>
<p>Function <code>interpolate.D</code> does a bilinear interpolation of the variance-covariance matrix of percentiles 
that correspond to values <code>F</code> of the cdf to values that correspond to values  
<code>ppi</code>. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>qtree.moments(r,n,xi,F)
qtree.jointdens(x,r1,r2,n,xi,F)
qtree.exy(r1,r2,n,xi,F,npts=100) 
qtree.varcov(obs,xi,F)
interpolate.D(D,ppi,F) 
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="qtree_+3A_r">r</code>, <code id="qtree_+3A_r1">r1</code>, <code id="qtree_+3A_r2">r2</code></td>
<td>
<p>The ranks of the sample order statistics. <code>r=1</code> means the smallest, <code>r=n</code> the largest.</p>
</td></tr>
<tr><td><code id="qtree_+3A_n">n</code></td>
<td>
<p>The sample size</p>
</td></tr>
<tr><td><code id="qtree_+3A_xi">xi</code></td>
<td>
<p>The percentiles that specify the cdf in increasing order. The first element should be the population minimum and the last element should be the population maximum. A vector of same length as <code>F</code></p>
</td></tr>
<tr><td><code id="qtree_+3A_f">F</code></td>
<td>
<p>The values of the cdf that correspond to the percentiles of <code>xi</code>. The first elements should be 0 and the last 1.</p>
</td></tr>
<tr><td><code id="qtree_+3A_x">x</code></td>
<td>
<p>a matrix with two columns that gives the x-values for which the joint density is computed in <code>qtree.jointdens</code>.</p>
</td></tr>
<tr><td><code id="qtree_+3A_npts">npts</code></td>
<td>
<p>The number of regularly placed points that is used in the integral approximation of <code class="reqn">E(X_{r1:n}X_{r2:n})</code> for each percentile interval in function <code>exy</code>.</p>
</td></tr>
<tr><td><code id="qtree_+3A_obs">obs</code></td>
<td>
<p>A data frame of observed sample quantiles, possibly from several plots. The data frame should include 
(at least) columns <code>r</code> (the ranks), <code>n</code> (sample size), <code>plot</code> (plot id) and <code>d</code> (observed diameter). 
The rows should be ordered by <code>r</code> within each plot, and all observations from same plot should follow each other.</p>
</td></tr>
<tr><td><code id="qtree_+3A_d">D</code></td>
<td>
<p>The variance-covariance matrix of the residual errors (plot effects) of percentile models. The number of columns and rows should equal to the length of <code>F</code> and <code>xi</code>.</p>
</td></tr>
<tr><td><code id="qtree_+3A_ppi">ppi</code></td>
<td>
<p>The values of cdf for which the covariances needs to be interpolated in <code>interpolate.D</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Function <code>qtree.moments</code> returns a list with elements 
</p>
<table>
<tr><td><code>mu</code></td>
<td>
<p>The expected value of <code class="reqn">X_{r:n}</code>.</p>
</td></tr>
<tr><td><code>sigma2</code></td>
<td>
<p>The variance of <code class="reqn">X_{r:n}</code>.</p>
</td></tr>
<tr><td><code>x</code>, <code>y</code></td>
<td>
<p>y gives the values of the pdf of <code class="reqn">X_{r:n}</code> for values given in x for plotting purposes. Try <code>plot(sol$x,sol$y,type="l")</code>.</p>
</td></tr>
</table>
<p>Function <code>qtree.jointdens</code> returns a vector with length equal to the <code>nrow(x)</code>, including the values of the joint pdf of <code class="reqn">({X_{r1:n}},X_{r2:n})</code> in these points. 
</p>
<p>Function <code>qtree.exy</code> returns a scalar, the approximate of <code class="reqn">E(X_{r1:n}X_{r2:n})</code>. 
</p>
<p>Function <code>qtree.varcov</code> returns a list with elements
</p>
<table>
<tr><td><code>obs</code></td>
<td>
<p>The original input data frame, augmented with the expected values in column <code>Ed</code> and the corresponding values of the cdf of <code class="reqn">X</code> in column <code>pEd</code>.</p>
</td></tr> 
<tr><td><code>R</code></td>
<td>
<p>The variance-covariance matrix of the sample quantiles.</p>
</td></tr>
</table>
<p>Function <code>interpolate.D</code> returns a list with elements
</p>
<table>
<tr><td><code>D</code></td>
<td>
<p>The original variance-covariance matrix, augmented with the variances and covariances 
that correspond to the cdf values <code>ppi</code>.</p>
</td></tr>
<tr><td><code>F</code></td>
<td>
<p>The values of cdf that correspond to the augmented matrix <code>D</code>.</p>
</td></tr>
<tr><td><code>D1</code></td>
<td>
<p>The variance-covariance matrix of the percentiles that correspond to the cdf values given in <code>ppi</code></p>
</td></tr>
<tr><td><code>D2</code></td>
<td>
<p>The covariance matrix between the percentiles that correspond to <code>ppi</code> and <code>F</code></p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Lauri Mehtatalo &lt;<a href="mailto:lauri.mehtatalo@uef.fi">lauri.mehtatalo@uef.fi</a>&gt;
</p>


<h3>References</h3>

<p>Mehtatalo, L. 2005. Localizing a predicted diameter distribution using sample information. Forest Science 51(4): 292&ndash;302. 
</p>
<p>Mehtatalo, Lauri and Lappi, Juha 2020a. Biometry for Forestry and Environmental Data: with examples in R. New York: Chapman and Hall/CRC. 426 p. <a href="https://doi.org/10.1201/9780429173462">doi:10.1201/9780429173462</a>
</p>
<p>Mehtatalo, Lauri and Lappi, Juha 2020b. Biometry for Forestry and Environmental Data: with examples in R. Full Versions of The Web Examples. Available at <a href="http://www.biombook.org">http://www.biombook.org</a>. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>F&lt;-c(0,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.95,1)

# Predictions of logarithmic percentiles
xi&lt;-c(1.638,2.352,2.646,2.792,2.91,2.996,3.079,3.151,3.234,3.349,3.417,3.593)

# The variance of their prediction errors
D&lt;-matrix(c(0.161652909,0.050118692,0.022268974,0.010707222,0.006888751,0,
   0.000209963,-0.002739361,-0.005478838,-0.00655718,-0.006718843,-0.009819052,
   0.050118692,0.074627668,0.03492943,0.01564454,0.008771398,0,
   -0.002691651,-0.005102312,-0.007290366,-0.008136685,-0.00817717,-0.009026883,
   0.022268974,0.03492943,0.029281808,0.014958206,0.009351904,0,
   -0.002646641,-0.003949305,-0.00592412,-0.006556639,-0.006993025,-0.007742731,
   0.010707222,0.01564454,0.014958206,0.014182608,0.009328299,0,
   -0.001525745,-0.002448765,-0.003571811,-0.004470387,-0.004791053,-0.005410252,
   0.006888751,0.008771398,0.009351904,0.009328299,0.009799233,0,
   -0.000925308,-0.001331631,-0.002491679,-0.003277911,-0.003514961,-0.003663479,
   rep(0,12),
   0.000209963,-0.002691651,-0.002646641,-0.001525745,-0.000925308,0,
   0.003186033,0.003014887,0.002961818,0.003112953,0.003050486,0.002810937,
   -0.002739361,-0.005102312,-0.003949305,-0.002448765,-0.001331631,0,
   0.003014887,0.00592428,0.005843888,0.005793879,0.005971638,0.006247869,
   -0.005478838,-0.007290366,-0.00592412,-0.003571811,-0.002491679,0,
   0.002961818,0.005843888,0.00868157,0.008348973,0.008368812,0.008633202,
   -0.00655718,-0.008136685,-0.006556639,-0.004470387,-0.003277911,0,
   0.003112953,0.005793879,0.008348973,0.011040791,0.010962609,0.010906917,
   -0.006718843,-0.00817717,-0.006993025,-0.004791053,-0.003514961,0,
   0.003050486,0.005971638,0.008368812,0.010962609,0.013546621,0.013753718,
   -0.009819052,-0.009026883,-0.007742731,-0.005410252,-0.003663479,0,
   0.002810937,0.006247869,0.008633202,0.010906917,0.013753718,0.02496596),ncol=12)

# observed tree data, 5 trees from 2 plots
obs&lt;-data.frame(r=c(1,3,6,1,2),n=c(7,7,7,9,9),plot=c(1,1,1,2,2),d=c(10,11,27,8,12))

# See Example 11.33 in Mehtatalo and Lappi 2020b
qtrees&lt;-qtree.varcov(obs,xi,F)
obs&lt;-qtrees$obs
mustar&lt;-obs$Ed
ystar&lt;-log(obs$d)
R&lt;-qtrees$R
Dtayd&lt;-interpolate.D(D,obs$pEd)
</code></pre>

<hr>
<h2 id='recweib'>
Recovery of Weibull parameters of tree diameter distribution using measured stand characteristics
</h2><span id='topic+recweib'></span><span id='topic+func.recweib1'></span><span id='topic+func.recweib2'></span>

<h3>Description</h3>

<p>The function finds such parameters shape and scale of the Weibull diameter distribution that 
yield the given basal area, number of stems and weighted/unweighted mean/median diameter. 
Weibull function can be assumed either as the unweighted or basal-area weighted distribution. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>recweib(G, N, D, Dtype, init=NA, trace=FALSE, weight=0,minshape=0.01)
func.recweib1(lshape, G, N, D, Dtype, trace=FALSE,minshape=0.01)
func.recweib2(lshape, G, N, D, Dtype, trace=FALSE,minshape=0.01)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="recweib_+3A_g">G</code></td>
<td>
<p> The basal area in <code class="reqn">m^2/ha</code>, scalar.  </p>
</td></tr>
<tr><td><code id="recweib_+3A_n">N</code></td>
<td>
<p>The number of stems per ha, scalar. </p>
</td></tr>
<tr><td><code id="recweib_+3A_d">D</code></td>
<td>
<p>Either A: The arithmetic mean diameter, B: The basal-area weighted mean diameter, 
C: median diameter or D: The basal-area weighted median diameter of the stand, cm.</p>
</td></tr>
<tr><td><code id="recweib_+3A_dtype">Dtype</code></td>
<td>

<p>One of characters &quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, indicating which type of mean diameter was given in argument D.
</p>
</td></tr>
<tr><td><code id="recweib_+3A_init">init</code></td>
<td>
<p>The initial guess for the shape parameter (scalar). If not given, a simple model (see 
Siipilehto and Mehtatalo 2013, appendix)
is used to compute the initial guess for the unweighted case; value 4 is used as default in the basal-area weighted case. </p>
</td></tr>
<tr><td><code id="recweib_+3A_trace">trace</code></td>
<td>
<p>if TRUE, some output on the convergence of the algorithm is printed on the screen. 
</p>
</td></tr>
<tr><td><code id="recweib_+3A_weight">weight</code></td>
<td>
<p>if weight=0 (the default), Weibull function is assumed as the unweighted density. If weight=2, weibull 
function is assumed as the basal-area weighted density. Weight is also the theoretical infimum 
of the shape parameter. 
</p>
</td></tr>
<tr><td><code id="recweib_+3A_lshape">lshape</code></td>
<td>
<p>logarithmic shape parameter, (log(shape+minshape)).</p>
</td></tr>
<tr><td><code id="recweib_+3A_minshape">minshape</code></td>
<td>
<p>Minimum difference of the shape parameter and its theoretical infimum.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The recovery is based on the solution of the equation 
DQMW^2(shape,scale(D,shape))-DQM^2= 0, where DQMW(shape, scale(D,shape)) expresses the DQM of the assumed Weibull distribution
for the given value of the shape parameter and using the scale parameter that corresponds 
to the given combination of the shape parameter and the mean/median diameter given in D. 
The function which is set to zero is implemented in functions <code><a href="#topic+func.recweib1">func.recweib1</a></code> (unweighted case) and 
<code><a href="#topic+func.recweib2">func.recweib2</a></code> (ba-weighted case).
The Gauss-Newton method implemented in  <code><a href="#topic+NRnum">NRnum</a></code> is used 
for solving the equation. 
</p>


<h3>Value</h3>

<p>A list of components 
</p>
<table>
<tr><td><code>shape</code>, <code>scale</code></td>
<td>
<p>The value of the shape and scale parameters at the solution.</p>
</td></tr>
<tr><td><code>G</code>, <code>N</code>, <code>D</code>, <code>Dtype</code></td>
<td>
<p>The input arguments.</p>
</td></tr>
<tr><td><code>val</code></td>
<td>
<p>The value of the equation DQMW^2(shape,scale(D,shape))-DQM^2 at the solution</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Lauri Mehtatalo &lt;<a href="mailto:lauri.mehtatalo@uef.fi">lauri.mehtatalo@uef.fi</a>&gt; and Jouni Siipilehto
</p>


<h3>References</h3>

<p>Siipilehto, J. and Mehtatalo, L. 2013. Parameter recovery vs. parameter prediction for the
Weibull distribution validated for Scots pine stands in
Finland. Silva Fennica 47(4), article id 1057. <a href="https://doi.org/10.14214/sf.1057">doi:10.14214/sf.1057</a>
</p>
<p>Mehtatalo, Lauri and Lappi, Juha 2020a. Biometry for Forestry and Environmental Data: with examples in R. New York: Chapman and Hall/CRC. 426 p. <a href="https://doi.org/10.1201/9780429173462">doi:10.1201/9780429173462</a>
</p>
<p>Mehtatalo, Lauri and Lappi, Juha 2020b. Biometry for Forestry and Environmental Data: with examples in R. Full Versions of The Web Examples. Available at <a href="http://www.biombook.org">http://www.biombook.org</a>. 
</p>


<h3>See Also</h3>

<p>The mean diameters for options A, B, C and D are computed by functions documented at 
<code><a href="#topic+scaleDMean1">scaleDMean1</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Demonstration with 3 example stands.
# Example stand 1. Uneven-aged stand in Finland (Vesijako, Kailankulma, stand no 1):
G&lt;-17.0
N&lt;-1844
D&lt;-7.9
DG&lt;-19.6
DM&lt;-8.1
DGM&lt;-19.1
recweib(G,N,D,"A")            #  1.066123 8.099707
recweib(G,N,DG,"B")           # 1.19316  8.799652
recweib(G,N,DM,"C")           # 1.601795 10.18257
recweib(G,N,DGM,"D")          # 1.095979 8.280063
recweib(G,N,D,"A",weight=2)   # 2.590354 21.66398
recweib(G,N,DG,"B",weight=2)  # 2.563892 22.07575
recweib(G,N,DM,"C",weight=2)  # 2.998385 17.74291
recweib(G,N,DGM,"D",weight=2) # 2.566621 22.03183



# Example 2. Even aged stand in Finland (see Siipilehto &amp; Mehtatalo, Fig 2):
G_ha&lt;-9.6
N_ha&lt;-949
D&lt;-11.0
DG&lt;-12.3
DM&lt;-11.1
DGM&lt;-12.4  
recweib(G_ha,N_ha,D,"A") # 4.465673 12.05919
recweib(G_ha,N_ha,DG,"B") # 4.463991 12.05912
recweib(G_ha,N_ha,DM,"C")  # 4.410773 12.05949
recweib(G_ha,N_ha,DGM,"D") # 4.448272 12.05924


# Example 3. Assumed peaked even aged stand (see Siipilehto &amp; Mehtatalo, Fig 1):
G_ha&lt;-10.0
N_ha&lt;-1300
D&lt;-9.89
DG&lt;-10.0
DM&lt;-9.89
DGM&lt;-10.0  
recweib(G_ha,N_ha,D,"A")  #  34.542 10.04978
recweib(G_ha,N_ha,DG,"B") # 14.23261 10.22781
recweib(G_ha,N_ha,DM,"C") # 6.708882 10.44448
recweib(G_ha,N_ha,DGM,"D") # 24.45228 10.10607
</code></pre>

<hr>
<h2 id='scaleDMean'>
The Weibull scale parameter for the given mean/median diameter and shape parameter. 
</h2><span id='topic+scaleDMean1'></span><span id='topic+scaleDGMean1'></span><span id='topic+scaleDMed1'></span><span id='topic+scaleDGMed1'></span><span id='topic+scaleDMean2'></span><span id='topic+scaleDGMean2'></span><span id='topic+scaleDMed2'></span><span id='topic+scaleDGMed2'></span>

<h3>Description</h3>

<p>The function finds such scale parameter of the Weibull distribution that 
yields the given mean/median diameter. Function scaleDMean is used for  
arithmetic mean, scaleDGMean for the mean of basal-area weighted distribution, 
scaleDMed for median and scaleDGMed for the median of the basal-area weighted 
diameter distribution. Functions with number 1 in the name use Weibull functions 
as the unweighted density and functions with value 2 in the name use Weibull function as the 
basal-area weighted density. 
</p>
<p>The functions are used in the recovery of Weibull parameters using function 
<code><a href="#topic+recweib">recweib</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>scaleDMean1(D,shape)
scaleDGMean1(D,shape)
scaleDMed1(D,shape)
scaleDGMed1(D,shape)
scaleDMean2(D,shape)
scaleDGMean2(D,shape)
scaleDMed2(D,shape)
scaleDGMed2(D,shape)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="scaleDMean_+3A_d">D</code></td>
<td>
<p>The diameter</p>
</td></tr>
<tr><td><code id="scaleDMean_+3A_shape">shape</code></td>
<td>
<p>The Weibull shape parameter</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>scale</code></td>
<td>
<p>The value of the Weibull scale parameter.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Lauri Mehtatalo &lt;<a href="mailto:lauri.mehtatalo@uef.fi">lauri.mehtatalo@uef.fi</a>&gt; and Jouni Siipilehto
</p>


<h3>References</h3>

<p>Siipilehto, J. and Mehtatalo, L. 2013. Parameter recovery vs. parameter prediction for the
Weibull distribution validated for Scots pine stands in
Finland. Silva Fennica 47(4), article id 1057. <a href="https://doi.org/10.14214/sf.1057">doi:10.14214/sf.1057</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+recweib">recweib</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>scaleDMean1(15,3)
scaleDGMean1(15,3)
scaleDMed2(15,3)
scaleDGMed2(15,3)
</code></pre>

<hr>
<h2 id='spati'>Raw sample plot data of Scots pine in Ilomantsi, Finland.</h2><span id='topic+spati'></span>

<h3>Description</h3>

<p>A dataset of Scots pine growth. 
The trees were collected on 56 fixed-area sample plots. The data includes no remeasurements. 
The growth data are based on measurements of increment borer chips.</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(spati)</code></pre>


<h3>Format</h3>

<p>A data frame with 9913 observations on the following variables.
</p>

<dl>
<dt><code>plot</code></dt><dd><p>A unique sample plot id.</p>
</dd>
<dt><code>X</code></dt><dd><p>Plot size in X-direction, meters</p>
</dd>
<dt><code>Y</code></dt><dd><p>Plot size in y-direction, meters</p>
</dd>
<dt><code>N</code></dt><dd><p>Stand density, trees per ha</p>
</dd>
<dt><code>G</code></dt><dd><p>Basal area, <code class="reqn">m^2/ha</code></p>
</dd>
<dt><code>V</code></dt><dd><p>Plot volume, <code class="reqn">m^3/ha</code></p>
</dd>
<dt><code>Dg</code></dt><dd><p>Basal-area weighted mean diameter, cm</p>
</dd> 
<dt><code>Hg</code></dt><dd><p>Height of basal area median diameter tree, m</p>
</dd>
<dt><code>Tg</code></dt><dd><p>Age of basal area median tree, yr</p>
</dd>
<dt><code>Hdom</code></dt><dd><p>Dominant height, m</p>
</dd>
<dt><code>maos</code></dt><dd><p>percentage of Scots pines of the total volume</p>
</dd>
<dt><code>kuos</code></dt><dd><p>percentage of Norway spruces of the total volume</p>
</dd>
<dt><code>kanro</code></dt><dd><p>A unique sample plot id (same as plot).</p>
</dd>
<dt><code>puunro</code></dt><dd><p>Tree id within plot.</p>
</dd>
<dt><code>pl</code></dt><dd><p>tree species. 1=Scots Pine</p>
</dd>
<dt><code>xk</code></dt><dd><p>x- coordinates of trees within plot</p>
</dd>
<dt><code>yk</code></dt><dd><p>y- coordinates of trees within plot</p>
</dd>
<dt><code>d</code></dt><dd><p>Tree diameter at breast height (1.3 meters above the ground) in cm.</p>
</dd>
<dt><code>h</code></dt><dd><p>Tree height, m.</p>
</dd>
<dt><code>t</code></dt><dd><p>Tree age, years</p>
</dd>
<dt><code>dk</code></dt><dd><p>Tree diameter at stump height, cm. there seems to be some unclear issues.</p>
</dd>
<dt><code>X2b</code></dt><dd><p>Double bark thickness, mm</p>
</dd>
<dt><code>id1</code></dt><dd><p>Tree diameter growth within the 5 year period prior to the measurement. Missing data coded as -1.</p>
</dd>
<dt><code>id2</code></dt><dd><p>Tree diameter growth within the period 6-10 years prior to the measurement. Missing data coded as -1.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>The data were collected by Timo Pukkala.
</p>


<h3>References</h3>

<p>Pukkala, T. 1989. Prediction of tree diameter and height in a Scots pine stand as a
function of the spatial pattern of trees. Silva Fennica 23(2): 83-99. <a href="https://doi.org/10.14214/sf.a15532">doi:10.14214/sf.a15532</a>
</p>
<p>Mehtatalo, Lauri and Lappi, Juha 2020. Biometry for Forestry and Environmental Data: with examples in R. 
New York: Chapman and Hall/CRC. 426 p. <a href="https://doi.org/10.1201/9780429173462">doi:10.1201/9780429173462</a>
</p>

<hr>
<h2 id='spati2'>Heights and diameters of Scots pine trees in Ilomantsi, Finland.</h2><span id='topic+spati2'></span>

<h3>Description</h3>

<p>A dataset of Scots pine tree heights and diameters. 
The trees were collected on 56 fixed-area sample plots. This is a subset of the larger data set <code>spati</code>.</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(spati2)</code></pre>


<h3>Format</h3>

<p>A data frame with 1678 observations on the following 3 variables.
</p>

<dl>
<dt><code>plot</code></dt><dd><p>A unique sample plot id.</p>
</dd>
<dt><code>d</code></dt><dd><p>Tree diameter at breast height (1.3 meters above the ground) in cm.</p>
</dd>
<dt><code>h</code></dt><dd><p>Tree height, m.</p>
</dd>
<dt><code>n</code></dt><dd><p>The total number of trees on the plot.</p>
</dd>
<dt><code>dvar</code></dt><dd><p>The variance of tree diameters on the plot.</p>
</dd>
<dt><code>dmean</code></dt><dd><p>The mean of tree diameters on the plot.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>The data were collected by Timo Pukkala.
</p>


<h3>References</h3>

<p>Pukkala, T. 1989. Prediction of tree diameter and height in a Scots pine stand as a
function of the spatial pattern of trees. Silva Fennica 23(2): 83-99. <a href="https://doi.org/10.14214/sf.a15532">doi:10.14214/sf.a15532</a>
</p>
<p>Mehtatalo, Lauri and Lappi, Juha 2020. Biometry for Forestry and Environmental Data: with examples in R. 
New York: Chapman and Hall/CRC. 426 p. <a href="https://doi.org/10.1201/9780429173462">doi:10.1201/9780429173462</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(spati2)
fithd(spati2$d,spati2$h,spati2$plot)
</code></pre>

<hr>
<h2 id='stumplift'>
Productivity of stump lifting machines.
</h2><span id='topic+stumplift'></span>

<h3>Description</h3>

<p>The productivity of stump lifting machines on three Norway Spruce (Picea Abies) clearcut areas (sites). 
Stumps are lifted for use as bioenergy. The data were collected from three sites in 
Central Finland.  
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(stumplift)</code></pre>


<h3>Format</h3>

<p>A data frame with 485 observations on the following 5 variables.
</p>

<dl>
<dt><code>Stump</code></dt><dd><p>A unique stump id based on the order of processing. The successive numbers 
are usually close to each other in the clearcut area, but nearby trees do not necessarily 
have small difference in stump id.</p>
</dd>
<dt><code>Machine</code></dt><dd><p>The machine/clearcut/dirver combination. A factor with three levels.</p>
</dd>
<dt><code>Diameter</code></dt><dd><p>Stump diameter, cm.</p>
</dd>
<dt><code>Time</code></dt><dd><p>Processing time, seconds.</p>
</dd>
<dt><code>Productivity</code></dt><dd><p>Productivity, <code class="reqn">m^3</code>/effective working hour</p>
</dd>
</dl>



<h3>Details</h3>

<p>Each site was operated with different machine and driver so that the 
effect of site, machine and driver cannot be separated. The volume of each stump was 
estimated using the function of Laitila (2008), based on the stump diameter. 
A work system study was conducted to measure the processing time (seconds) and 
productivity (<code class="reqn">m^3</code>/hour) for each stump. 
</p>


<h3>References</h3>

<p>Teijo Palander, Kalle Karha, Lauri Mehtatalo 2016. 
Applying polynomial regression modeling to productivity analysis of 
sustainable stump harvesting. Scandinavian Journal of Forest Reseach. 
<a href="https://doi.org/10.1080/02827581.2016.1238957%20">doi:10.1080/02827581.2016.1238957 </a>
</p>
<p>Teijo Palander, Janne Smolander, Kalle Karha, 2015. 
Work system study of three stump-lifting devices in Finland. 
Scandinavian Journal of Forest Research 30(6) 558-567, <a href="https://doi.org/10.1080/02827581.2015.1027731">doi:10.1080/02827581.2015.1027731</a>
</p>
<p>Mehtatalo, Lauri and Lappi, Juha 2020. Biometry for Forestry and Environmental Data: with examples in R. 
New York: Chapman and Hall/CRC. 426 p. <a href="https://doi.org/10.1201/9780429173462">doi:10.1201/9780429173462</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(stumplift)
library(nlme)

modConstPow&lt;-gls(Productivity~Machine+Machine*I((Diameter-70)^2),
                 data=stumplift,
                 weights=varPower(),
                 corr=corAR1(form=~Stump|Machine))
           
</code></pre>

<hr>
<h2 id='thefdata'>
Effect of thinning on individual tree growth for 62 trees.
</h2><span id='topic+thefdata'></span>

<h3>Description</h3>

<p>Time series of estimated effect of thinning on the annual basal area growth of 62 
Scots pine trees from three different thinning intensities.  
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(thefdata)</code></pre>


<h3>Format</h3>

<p>A data frame with 1238 observations on the following 7 variables.
</p>

<dl>
<dt><code>Plot</code></dt><dd><p>Sample plot id, a factor with 10 levels.</p>
</dd>
<dt><code>Tree</code></dt><dd><p>Tree id, a factor with 55 levels (same tree id may occur on different plots!).</p>
</dd>
<dt><code>Year</code></dt><dd><p>Calendar year of the ring.</p>
</dd>
<dt><code>SDClass</code></dt><dd><p>Thinning treatment, factor with 4 levels (1=Control, 2=Light, 3=Moderate, 4=Heavy).</p>
</dd>
<dt><code>CA</code></dt><dd><p>Current tree age in years.</p>
</dd>
<dt><code>Diam1986</code></dt><dd><p>Tree diameter in 1986 (just before the thinning).</p>
</dd>
<dt><code>ThEf</code></dt><dd><p>The thinning effect in annual basal area growth, mm^2.</p>
</dd>
</dl>



<h3>Details</h3>

<p>The data are based on a long-term thinning experiment on a naturally regenerated
Scots pine stand in Eastern Finland, see documentation of <a href="#topic+afterthin">afterthin</a> and <a href="#topic+patti">patti</a> for details. 
The experiment consists of 10
sample plots, in four different classes (including an unthinned control) according
to the post-thinning stand density. The plots were thinned in winter 1986-1987. 
The undisturbed growth for each tree was predicted using a linear mixed-effect 
model with crossed year and tree effect, which was fitted to a data set including the control 
treatment for all calendar years and other trees until the year of thinning. 
The thinning effect was computed as the difference of observed growth and the undisturbed predicted growth. 
For details about the procedure used 
in extracting the thinning effect, see Example 6.6 in Mehtatalo and Lappi 2020b and for nonlinear modeling of this data, see Chapter 7 of Mehtatalo and Lappi 2020a.
The data includes only the observations after the thinning year for the tree thinned treatments (i.e., control is excluded). 
</p>


<h3>References</h3>

<p>Mehtatalo, L., Peltola, H., Kilpelainen, A. and Ikonen, V.-P. 2014. The response of basal area growth 
of Scots pine to thinning: A longitudinal analysis of tree-specific series using a nonlinear 
mixed-effects model. Forest Science 60 (4): pp. 636-644. <a href="https://doi.org/10.5849/forsci.13-059">doi:10.5849/forsci.13-059</a>.
</p>
<p>Mehtatalo, Lauri and Lappi, Juha 2020a. Biometry for Forestry and Environmental Data: with examples in R. 
New York: Chapman and Hall/CRC. 426 p. <a href="https://doi.org/10.1201/9780429173462">doi:10.1201/9780429173462</a>
</p>
<p>Mehtatalo, Lauri and Lappi, Juha 2020b. Biometry for Forestry and Environmental Data: with examples in R. 
Full Versions of The Web Examples. Available at <a href="http://www.biombook.org">http://www.biombook.org</a>. 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+patti">patti</a></code>, <code><a href="#topic+afterthin">afterthin</a></code>, <code><a href="#topic+thinning">thinning</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(thefdata)
linesplot(thefdata$Year,thefdata$ThEf, thefdata$Tree,col.lin=thefdata$SDClass)
</code></pre>

<hr>
<h2 id='thinning'>
Effect of thinning on individual tree growth
</h2><span id='topic+thinning'></span>

<h3>Description</h3>

<p>A time series of estimated effect of thinning on the annual basal area growth of a 
Scots pine tree. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(thinning)</code></pre>


<h3>Format</h3>

<p>A data frame with 23 observations on the following 3 variables.
</p>

<dl>
<dt><code>TreeID</code></dt><dd><p>Tree ID, 3_3 for all observations in this data.</p>
</dd>
<dt><code>Year</code></dt><dd><p>Calendar year (1983-2005).</p>
</dd>
<dt><code>ThEff</code></dt><dd><p>Estimated effect of thinning on the annual basal area growth in mm^2.</p>
</dd>
</dl>



<h3>Details</h3>

<p>The thinning took place between years 1986 and 1987. For details about the original measurements, see the documentation of data set <a href="#topic+patti">patti</a>, <a href="#topic+afterthin">afterthin</a>. For details about the procedure used 
in extracting the thinning effect, see Example 6.6 in Mehtatalo and Lappi 2020b and for nonlinear modeling of this data, see Chapter 7 of Mehtatalo and Lappi 2020a.</p>


<h3>References</h3>

<p>Mehtatalo, L., Peltola, H., Kilpelainen, A. and Ikonen, V.-P. 2014. The response of basal area growth 
of Scots pine to thinning: A longitudinal analysis of tree-specific series using a nonlinear 
mixed-effects model. Forest Science 60 (4): pp. 636-644. <a href="https://doi.org/10.5849/forsci.13-059">doi:10.5849/forsci.13-059</a>.
</p>
<p>Mehtatalo, Lauri and Lappi, Juha 2020a. Biometry for Forestry and Environmental Data: with examples in R. 
New York: Chapman and Hall/CRC. 426 p. <a href="https://doi.org/10.1201/9780429173462">doi:10.1201/9780429173462</a>
</p>
<p>Mehtatalo, Lauri and Lappi, Juha 2020b. Biometry for Forestry and Environmental Data: with examples in R. 
Full Versions of The Web Examples. Available at <a href="http://www.biombook.org">http://www.biombook.org</a>. 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+patti">patti</a></code>, <code><a href="#topic+afterthin">afterthin</a></code>, <code><a href="#topic+thefdata">thefdata</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(thinning)
plot(thinning$Year,thinning$ThEff,type="l")
</code></pre>

<hr>
<h2 id='treevol'>
Individual tree volume modeling data for 8508 pine, spruce and birch trees in Finland
</h2><span id='topic+treevol'></span>

<h3>Description</h3>

<p>Measurements of tree volumes from 8508 individual Scots pine (4066 trees), 
Norway spruce (2966 trees) and birch (1476 trees) trees in Finland. 
A total of 5053 trees were measured in 1970's by climbing to the standing trees, 
1534 trees by falling the trees in 1990's, 
and 1921 trees by using terrestrial laser scanning in 2010's. The trees have been 
selected from among the sample trees of national forest inventories. 
In addition to tree volumes, diameters, heights and upper diameters, the data set includes 
variables describing the grouping of the trees to stands and plots and information about the site characteristics. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(treevol)</code></pre>


<h3>Format</h3>

<p>A data frame with 8508 observations on the following 11 variables.
</p>

<dl>
<dt><code>stand</code></dt><dd><p>Stand id (numeric)</p>
</dd>
<dt><code>plot</code></dt><dd><p>Plot id (nested within stand)</p>
</dd>
<dt><code>v</code></dt><dd><p>Tree volume, dm^3</p>
</dd>
<dt><code>dbh</code></dt><dd><p>Tree diameter at 1.3m height above the stump height, cm</p>
</dd>
<dt><code>h</code></dt><dd><p>Tree height, m</p>
</dd>
<dt><code>d6</code></dt><dd><p>Tree diameter at 6m height above the stump height, cm</p>
</dd>
<dt><code>dataset</code></dt><dd><p>Categorical indicator for the dataset, (see the general description).</p>
</dd>
<dt><code>temp_sum</code></dt><dd><p>Numeric temperature sum of the site. A high value indicates warm site. </p>
</dd>
<dt><code>species</code></dt><dd><p>Categorical with three levels, tree species.</p>
</dd>
<dt><code>soil</code></dt><dd><p>Categorical with two levels: mineral soil or peatland.</p>
</dd>
<dt><code>region</code></dt><dd><p>Categorical with four levels: region.</p>
</dd>
</dl>



<h3>Details</h3>

<p>The data combines three datasets: 1) The climbed data including 2326 
Scots pine (Pinus sylvestris L.), 1864 Norway spruce (Picea abies L. Karst.) 
and 863 silver (Betula pendula Roth) and downy (Betula pubescens Ehrh.) 
birches collected 1968-1972, and 2) the felled data with 797 pines, 479 spruces 
and 258 birches collected 1988-2001, and the scanned data with 943 Scots pine, 
623 Norway spruce and 355 downy or silver birch collected 2017-2018. 
For the two older dat sets, diameter measurements are based on two perdendicular measurements 
of the stem at regularly spaced height. In the scanned data, the diemater measurements 
are based on TLS but heights are measured manually. 
For more details concerning the climbed data, see Laasasenaho (1982), 
and for the scanned data see Pitkanen et al.  (2021) and for the 
felled data see (Korhonen &amp; Maltamo 1990). 
In the climbed and felled data, the volumes of the trees were predicted using a natural 
cubic spline (splinefun, R Core Team 2021) to interpolate the taper curve between 
measured diameters at given relative heights. The volumes were obtained as a slolid of revolution based on the 
interpolated taper curve.
In scanned data,  a smoothing spline (smooth.spline, R core team 2021) 
function was used instead of an interpolating spline.
The pooled data has been used in Kangas et al. (XXXX). 
</p>


<h3>References</h3>

<p>Kangas A., Pitkanen T., Mehtatalo L., Heikkinen J. (xxxx)
Mixed linear and non-linear tree volume models with regionally varying parameters
</p>
<p>Korhonen, K. and Maltamo, M. 1990. Mannyn maanpaallisten osien kuivamassat Etela-Suomessa. 
Metsantutkimuslaitoksen tiedonantoja 371. 
</p>
<p>Laasasenaho, J. (1982). Taper curve and volume functions for pine, spruce and birch. 
Communicationes Instituti Forestalia Fennica 108: 1-74.
</p>
<p>Pitkanen, T.P., Raumonen, P., Liang, X., Lehtomaki, M. and Kangas, A.S. 2020. 
Improving TLS-based stem volume estimates by field measurements. 
Computers and Electronics in Agriculture and Forestry 180, 105882.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data(treevol)
        
treevol$formfactor&lt;-treevol$v/volvff(treevol$dbh,treevol$h,logita=100,lambda=log(0.2))
treevol$logitff&lt;-log((treevol$formfactor)/(1-(treevol$formfactor)))

ptrees&lt;-treevol[treevol$species=="pine",]
mod.init&lt;-lm(logitff~I(1/h)+h+dbh+I(h*dbh)+I(1/(h*dbh))+
                     dataset+dataset:dbh+dataset:h,data=ptrees)

mod&lt;-nlme(v~volvff(dbh,h,logita=logita,lambda=lambda),
         fixed=list(logita~I(1/h)+h+dbh+I(h*dbh)+I(1/(h*dbh))+dataset+
                           dataset:dbh+dataset:h+soil+temp_sum,
                           lambda~1),
         random=logita~1|stand/plot,
         start=c(coef(mod.init),rep(0,2),log(0.2)),
         data=ptrees,
         weights=varComb(varIdent(form=~1 |dataset),varPower()),
         method="ML",
         control=list(msVerbose=TRUE),
         verbose=TRUE)

## End(Not run)                    
</code></pre>

<hr>
<h2 id='updown'>
Solve a simple equation using a step halving algorithm.
</h2><span id='topic+updown'></span>

<h3>Description</h3>

<p>Solves equations of form <code class="reqn">f(x)=0</code>, for scalar <code class="reqn">x</code> <code class="reqn">(l&lt;=x&lt;=u)</code> using a simple step 
halving algorithm, where <code class="reqn">f(x)</code> is a monotonic continuous function. 
Initial finite upper and lower bounds for 
x are required. The algorithm first computes <code class="reqn">f</code> for <code class="reqn">x=u</code> and <code class="reqn">x=l</code>. 
If the sign was different then 
another call is performed at the midpoint <code class="reqn">x=(u+l)/2</code>, and the midpoint is 
taken as a new upper or lower bound, according to the location of sign change. 
The upper or lower bound are repeatedly updated until the 
absolute value of f at the midpoint is below a specified criteria.    
</p>


<h3>Usage</h3>

<pre><code class='language-R'>updown(l, u, fn, crit = 6)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="updown_+3A_l">l</code></td>
<td>

<p>The initial lower bound
</p>
</td></tr>
<tr><td><code id="updown_+3A_u">u</code></td>
<td>

<p>The initial upper bound
</p>
</td></tr>
<tr><td><code id="updown_+3A_fn">fn</code></td>
<td>

<p>R-function for <code class="reqn">f(x)</code>
</p>
</td></tr>
<tr><td><code id="updown_+3A_crit">crit</code></td>
<td>

<p>The convergence criteria (Maximum accepted value of f at the solution is <code class="reqn">10^{-\code{crit}}</code>).
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A scalar giving the value of <code class="reqn">x</code> at the solution. 
If the sign did not change between l and u, NA is returned. 
</p>


<h3>Warning </h3>

<p>May lead to infinite loop for non-continuous functions. Works only with monotonic 
functions.</p>


<h3>Author(s)</h3>

<p>Lauri Mehtatalo &lt;<a href="mailto:lauri.mehtatalo@uef.fi">lauri.mehtatalo@uef.fi</a>&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Compute the median of Weibull distibution
fn&lt;-function(x) pweibull(x,5,15)-0.5
updown(1,50,fn)
</code></pre>

<hr>
<h2 id='volvff'>
The Variable Form-Factor Volume Model
</h2><span id='topic+volvff'></span><span id='topic+predvff'></span>

<h3>Description</h3>

<p>An R-function for the variable form-factor volume model and a function for computing 
bias-corrected volumes augmented with parameter uncertainty from a model fitted using nlme.</p>


<h3>Usage</h3>

<pre><code class='language-R'>volvff(dbh,h,theta=NA,logita=NA,lambda=NA)
predvff(data,mod,p=0.05,varMethod="taylor",biasCorr="none",nrep=500)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="volvff_+3A_dbh">dbh</code></td>
<td>

<p>vector of individual tree diameters, cm
</p>
</td></tr>
<tr><td><code id="volvff_+3A_h">h</code></td>
<td>

<p>vector of individual tree heights (m), of same length as <code>dbh</code>.
</p>
</td></tr>
<tr><td><code id="volvff_+3A_theta">theta</code>, <code id="volvff_+3A_logita">logita</code>, <code id="volvff_+3A_lambda">lambda</code></td>
<td>

<p>The parameters <code>logita</code> and <code>lambda</code> can be given either in a two-column 
matrix where the number of rows equals to the length of <code>dbh</code>, 
or separately in objects <code>logita</code> and <code>lambda</code>, which can be 
scalars or vectors of same length as <code>dbh</code>. 
If <code>theta</code> is not <code>NA</code>, argumets <code>logita</code> 
and <code>lambda</code> are ignored.  
</p>
</td></tr>
<tr><td><code id="volvff_+3A_data">data</code></td>
<td>

<p>A data set including variables <code>dbh</code> and <code>h</code> and 
all variables that are used as second-order predictors in <code>mod</code>. 
</p>
</td></tr>
<tr><td><code id="volvff_+3A_mod">mod</code></td>
<td>

<p>A variable form-factor model fitted using <code>nlme</code>. 
Any second-order predictors can be used for parameters <code>logita</code> and 
<code>lambda</code>. The bias-correction works properly only 
if the model includes random intercepts in <code>logita</code>.   
</p>
</td></tr>
<tr><td><code id="volvff_+3A_p">p</code></td>
<td>

<p>The probability used in constructiong the confidence intervals for 
tree-level volumes and total volume. 
Symmetric <code class="reqn">100(1-p)</code>% confidence intervals are returned.  
</p>
</td></tr>
<tr><td><code id="volvff_+3A_varmethod">varMethod</code></td>
<td>

<p>Either <code>"taylor"</code>(the default) or <code>"simul"</code>. Specifies whether parameter 
uncertainty is approximated by using a linearized model based on the 
first-order Taylor approximation or by using Monte Carlo simulation.  
</p>
</td></tr>
<tr><td><code id="volvff_+3A_biascorr">biasCorr</code></td>
<td>

<p>Either <code>"none"</code>(the default), <code>"integrate"</code> or <code>"twopoint"</code>. 
Specifies whether the bias correction is not done (<code>"none"</code>), 
is done by computing expected value of the prediction over the distribution 
of random intercepts in parameter <code>logita</code>, or by using the two-point 
approximation described in Kangas et al. (XXXX).  
</p>
</td></tr>
<tr><td><code id="volvff_+3A_nrep">nrep</code></td>
<td>

<p>The number of replicates in the Monte Carlo simulation when 
<code>varMethod="simul"</code>. Ignored if <code>varMethod="taylor"</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The variance-form-factor function is of form
</p>
<p style="text-align: center;"><code class="reqn">
v(D,H,a,\lambda)=\pi \frac{\exp(a)}{1+\exp(a)} R(D,H,\lambda)^2 H
</code>
</p>

<p>where <code class="reqn">a</code> is the logit-transformed form factor and <code class="reqn">R(D,H,\lambda)</code> 
is the stem radius at stump height, which is approximated using 
</p>
<p style="text-align: center;"><code class="reqn">
R(D,H,\lambda)=w(H,\lambda)\frac{D}{2}+(1-w(H,\lambda))\frac{H}{H-B}\frac{D}{2}
</code>
</p>

<p>where the weight is taken from the right tail of the logit transformation 
</p>
<p style="text-align: center;"><code class="reqn">
    w(H,\lambda)=2-2\frac{\exp\left( \frac{H-B}{\exp(\lambda)}\right)}{1+\exp\left( \frac{H-B}{\exp(\lambda)}\right)}
    </code>
</p>

<p>Parameter uncertainty is reported because the same realized errors are used always when 
a model based on certain model fitting data is used; therefore those errors behave 
in practice like bias. Variance for total volume is computed as sum of all elements of the 
variance-covariance matrix of prediction errors of the mean. 
</p>


<h3>Value</h3>

<p>Function <code>volvff</code> returns a vector of tree volumes (in liters) that is of same length as 
vector <code>dbh</code>. In addition, attribute <code>grad</code> returns the Jacobian, which is used 
in nlme fitting for computing the derivatives of the model with respect to parameters, 
and in approximating the parameter uncertainty when <code>varMethod="taylor"</code>. 
</p>
<p>Function <code>predvff</code> returns a list with following objects
</p>
<table>
<tr><td><code>totvol</code></td>
<td>

<p>Total volume of the trees of <code>dat</code>, in <code class="reqn">m^3</code>.
</p>
</td></tr>
<tr><td><code>totvolvar</code></td>
<td>

<p>The estimated variance of <code>totvol</code>, taking into account parameter uncertainty. 
</p>
</td></tr>
<tr><td><code>totvolci</code></td>
<td>

<p>The estimated <code class="reqn">100(1-p)</code>% confidence interval of <code>totvol</code>, based on parameter uncertainty. 
If <code>varMethod="taylor"</code>, it is based on normality and 
the approximated variance <code>totvolvar</code>. 
If <code>varMethod="simul"</code>, the empirical quantiles of the 
<code>nrep</code> simulations are used. 
</p>
</td></tr>
</table>
<p>And attributes
</p>
<table>
<tr><td><code>trees</code></td>
<td>

<p>A data frame of including tree-level volumes, their variance and 95% confidence intervals.  
</p>
</td></tr>
<tr><td><code>varmu</code></td>
<td>

<p>The variance-covariance matrix of prediction errors, taking into account theparameter uncertainty. 
</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Lauri Mehtatalo &lt;<a href="mailto:lauri.mehtatalo@luke.fi">lauri.mehtatalo@luke.fi</a>&gt;
</p>


<h3>References</h3>

<p>Kangas A., Pitkanen T., Mehtatalo L., Heikkinen J. (xxxx)
Mixed linear and non-linear tree volume models with regionally varying parameters
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(lmfor)
data(treevol)

treevol$formfactor&lt;-treevol$v/volvff(treevol$dbh,treevol$h,logita=100,lambda=log(0.2))
treevol$logitff&lt;-log((treevol$formfactor)/(1-(treevol$formfactor)))

ptrees&lt;-treevol[treevol$species=="pine",]
mod.init&lt;-lm(logitff~I(1/h)+h+dbh+I(h*dbh)+I(1/(h*dbh))+
                     dataset+dataset:dbh+dataset:h,data=ptrees)

mod&lt;-nlme(v~volvff(dbh,h,logita=logita,lambda=lambda),
         fixed=list(logita~I(1/h)+h+dbh+I(h*dbh)+I(1/(h*dbh))+dataset+
                           dataset:dbh+dataset:h+soil+temp_sum,
                           lambda~1),
         random=logita~1|stand/plot,
         start=c(coef(mod.init),rep(0,2),log(0.2)),
         data=ptrees,
         weights=varComb(varIdent(form=~1 |dataset),varPower()),
         method="ML",
#         control=list(msVerbose=TRUE),
#         verbose=TRUE
)

pred1&lt;-predvff(ptrees,mod,varMethod="simul",biasCorr="integrate") 
pred1$totvol    
pred1$totvolvar
pred1$totvolci         
head(attributes(pred1)$trees)    

pred2&lt;-predvff(ptrees,mod,varMethod="taylor",biasCorr="twopoint") 
pred2$totvol    
pred2$totvolvar
pred2$totvolci         
head(attributes(pred2)$trees)   

## End(Not run)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
