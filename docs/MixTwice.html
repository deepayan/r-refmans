<!DOCTYPE html><html><head><title>Help for package MixTwice</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {MixTwice}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#mixtwice'><p>Large-scale hypothesis testing by variance mixing</p></a></li>
<li><a href='#MixTwice-package'>
<p>Large-Scale Hypothesis Testing by Variance Mixing</p></a></li>
<li><a href='#peptide_data'><p>Peptide array data example</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Large-Scale Hypothesis Testing by Variance Mixing</td>
</tr>
<tr>
<td>Version:</td>
<td>2.0</td>
</tr>
<tr>
<td>Imports:</td>
<td>alabama, ashr, fdrtool, Iso, stats</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-02-28</td>
</tr>
<tr>
<td>Author:</td>
<td>Zihao Zheng and  Michael A.Newton</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Zihao Zheng &lt;zihao.zheng@wisc.edu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Implements large-scale hypothesis testing by variance mixing. It takes two statistics per testing unit &ndash; an estimated effect and its associated squared standard error &ndash; and fits a nonparametric, shape-constrained mixture separately on two latent parameters. It reports local false discovery rates (lfdr) and local false sign rates (lfsr). Manuscript describing algorithm of MixTwice: Zheng et al(2021) &lt;<a href="https://doi.org/10.1093%2Fbioinformatics%2Fbtab162">doi:10.1093/bioinformatics/btab162</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-03-02 16:05:34 UTC; appli</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-03-02 16:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='mixtwice'>Large-scale hypothesis testing by variance mixing</h2><span id='topic+mixtwice'></span>

<h3>Description</h3>

<p>MixTwice deploys large-scale hypothesis testing in the case when testing units provide estimated effects and
estimated standard errors.  It produces empirical Bayesian local false discovery and sign rates for tests of zero effect.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mixtwice(thetaHat, s2, Btheta = 15, Bsigma2 = 10, df, 
method = c("EM-pava", "AugLag"), maxit = 100, prop = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mixtwice_+3A_thetahat">thetaHat</code></td>
<td>
<p>Estimated effect sizes (vector over testing units))</p>
</td></tr>
<tr><td><code id="mixtwice_+3A_s2">s2</code></td>
<td>
<p>Estimated squared standard errors of thetaHat (vector over testing units)</p>
</td></tr>
<tr><td><code id="mixtwice_+3A_btheta">Btheta</code></td>
<td>
<p>Grid size parameter for effect distribution</p>
</td></tr>
<tr><td><code id="mixtwice_+3A_bsigma2">Bsigma2</code></td>
<td>
<p>Grid size parameter for variance distribution</p>
</td></tr>
<tr><td><code id="mixtwice_+3A_df">df</code></td>
<td>
<p>Degrees of freedom in chisquare associated with  estimated standard error</p>
</td></tr>
<tr><td><code id="mixtwice_+3A_method">method</code></td>
<td>
<p>Method used for solving the non-parametric MLE optimization. <code>method = "EM-pava"</code> solves the optimization problem using EM approach with pool adjacent violator algorithm (pava) and <code>method = "EM-pava"</code> solves the optimization problem directly using Augmented Lagrangian approach.</p>
</td></tr>
<tr><td><code id="mixtwice_+3A_maxit">maxit</code></td>
<td>
<p>Number of iterations in EM if <code>method = "EM-pava"</code>, with default, <code>maxit = 100</code></p>
</td></tr>
<tr><td><code id="mixtwice_+3A_prop">prop</code></td>
<td>
<p>Proportion of units randomly selected to fit the distribution, with default, <code>prop = 1</code> (use all units to fit the distribution).</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>mixtwice</code> takes estimated effects and standard errors over a set of testing units. To compute local error-rate statistics, it finds nonparametric MLEs of the underlying distributions. It is similar to &quot;ashr&quot;, except that mixtwice allows both a mixing distribution of underlying effects theta as well as a mixing distribution over underlying variance parameters.  Furthermore, it treats the effect mixing distribution nonparametrically, but enforces the shape constraint that this distribution is unimodal with mode at theta=0.  (We do not assume symmetry). The distribution of variance parameters is also treated nonparametrically, but with no shape constraints. The observations are assumed to be emitted from a normal distribution (on estimated effects) and an independent Chi-square distribution (on estimated squared standard errors). 
</p>


<h3>Value</h3>

<table>
<tr><td><code>grid.theta</code></td>
<td>
<p>Support of the estimated mixing distribution on effects</p>
</td></tr>
<tr><td><code>grid.sigma2</code></td>
<td>
<p>Support of the estimated mixing distribution of variances</p>
</td></tr>
<tr><td><code>mix.theta</code></td>
<td>
<p>Estimated distribution of effect size, on grid.theta</p>
</td></tr>
<tr><td><code>mix.sigma2</code></td>
<td>
<p>Estimated distribution of variance, on grid.sigma2</p>
</td></tr>
<tr><td><code>lfdr</code></td>
<td>
<p>Local false discovery rate for each testing unit</p>
</td></tr>
<tr><td><code>lfsr</code></td>
<td>
<p>Local false sign rate for each testing unit</p>
</td></tr>
</table>


<h3>Note</h3>

<p>See Zheng et al. 2021 for further detail
</p>


<h3>Author(s)</h3>

<p>Zihao Zheng,  Michael A.Newton
</p>


<h3>References</h3>

<p>Zheng et al. <em>MixTwice: Large scale hypothesis testing for peptide 
arrays by variance mixing</em>. Bioinformatics, 2021.
</p>


<h3>See Also</h3>

<p>See Also as <code>?peptide_data</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(1)

l = 1000 ## number of testing units

neach = 20 ## number of subjects in each group

pi0 = 0.8 ## null proportion

signal1 = rep(0, l)

signal2 = signal1

signal2[1:round((1-pi0)*l)] = rnorm(round((1-pi0)*l), mean = 0, sd = 3)

## I will generate the sigma^2 parameter

sigma2 = rep(1,l)

sigma = sqrt(sigma2)

## Then I can generate data

data1 &lt;- data2 &lt;- matrix(NA, nrow = l, ncol = neach)

for (i in 1:l) {
  
  data1[i,] = rnorm(neach, mean = rep(signal1[i], each = neach), sd = sigma[i])
  data2[i,] = rnorm(neach, mean = rep(signal2[i], each = neach), sd = sigma[i])
  
}

thetaHat = rowMeans(data2) - rowMeans(data1)

sd1 = apply(data1, 1, sd)
sd2 = apply(data2, 1, sd)

s2 = sd1^2/neach + sd2^2/neach

fit.EM = mixtwice(thetaHat, s2, Btheta = 15, Bsigma2 = 10, df = 2*neach - 2,
                   method = "EM-pava", maxit = 100, prop = 1)

## you can try to visualize the result

plot(fit.EM$grid.theta, cumsum(fit.EM$mix.theta), type = "s",
     xlab = "grid.theta", ylab = "ecdf of theta", lwd = 2)

lines(ecdf(signal2 - signal1),cex = 0.1, lwd = 0.5, lty = 2, col = "red")

legend("topleft", legend = c("fit.mix", "true.mix"), col = c("black", "red"), 
       lwd = 1, pch = 19)

## calculate false discovery rate and true positive under 0.05

oo = order(fit.EM$lfdr)

# number of discovery

x1 = sum(cumsum(fit.EM$lfdr[oo])/c(1:l) &lt;= 0.05)

# number of true discovery

x2 = sum(cumsum(fit.EM$lfdr[oo])/c(1:l) &lt;= 0.05 &amp; (signal2 != 0)[oo])

# number of real positive

x3 = sum(signal2 != 0) 

# number of false discovery

x4 = sum(cumsum(fit.EM$lfdr[oo])/c(1:l) &lt;= 0.05 &amp; (signal2 == 0)[oo]) 

x4/x1 ## false discovery rate FDR

x2/x3 ## true positive rate

## null proportion estimation

max(fit.EM$mix.theta)

## you can also try using another method (Augmented Lagrangian), the result would be similar

# fit.AugLag = mixtwice2(thetaHat, s2, Btheta = 15, Bsigma2 = 10, df = 2*neach - 2,
#                        method = "AugLag", prop = 1)
</code></pre>

<hr>
<h2 id='MixTwice-package'>
Large-Scale Hypothesis Testing by Variance Mixing
</h2><span id='topic+MixTwice-package'></span><span id='topic+MixTwice'></span>

<h3>Description</h3>

<p>Implements large-scale hypothesis testing by variance mixing. It takes two statistics per testing unit &ndash; an estimated effect and its associated squared standard error &ndash; and fits a nonparametric, shape-constrained mixture separately on two latent parameters. It reports local false discovery rates (lfdr) and local false sign rates (lfsr). Manuscript describing algorithm of MixTwice: Zheng et al(2021) &lt;doi: 10.1093/bioinformatics/btab162&gt;.
</p>


<h3>Details</h3>

<p>The DESCRIPTION file:
</p>

<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> MixTwice</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Title: </td><td style="text-align: left;"> Large-Scale Hypothesis Testing by Variance Mixing</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 2.0</td>
</tr>
<tr>
 <td style="text-align: left;">
Imports: </td><td style="text-align: left;"> alabama, ashr, fdrtool, Iso, stats</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2022-02-28</td>
</tr>
<tr>
 <td style="text-align: left;">
Author: </td><td style="text-align: left;"> Zihao Zheng and  Michael A.Newton</td>
</tr>
<tr>
 <td style="text-align: left;">
Maintainer: </td><td style="text-align: left;"> Zihao Zheng &lt;zihao.zheng@wisc.edu&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
Description: </td><td style="text-align: left;"> Implements large-scale hypothesis testing by variance mixing. It takes two statistics per testing unit -- an estimated effect and its associated squared standard error -- and fits a nonparametric, shape-constrained mixture separately on two latent parameters. It reports local false discovery rates (lfdr) and local false sign rates (lfsr). Manuscript describing algorithm of MixTwice: Zheng et al(2021) &lt;doi: 10.1093/bioinformatics/btab162&gt;.</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL-2</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>


<p>Index of help topics:
</p>
<pre>
MixTwice-package        Large-Scale Hypothesis Testing by Variance
                        Mixing
mixtwice                Large-scale hypothesis testing by variance
                        mixing
peptide_data            Peptide array data example
</pre>


<h3>Author(s)</h3>

<p>Zihao Zheng and  Michael A.Newton
</p>
<p>Maintainer: Zihao Zheng &lt;zihao.zheng@wisc.edu&gt;
</p>


<h3>References</h3>

<p>Zheng et al. <em>MixTwice: Large scale hypothesis testing for peptide 
arrays by variance mixing</em>. <b>Bioinformatics</b>, 2021.
</p>
<p>Zheng  et al. <em>Disordered Antigens and Epitope Overlap Between Anti Citrullinated Protein Antibodies and Rheumatoid Factor in Rheumatoid Arthritis.</em> <b>Arthritis &amp; Rheumatology</b> 72.2 (2020): 262-272.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(peptide_data)
## For more detail and example, use ?peptide_data and ?mixtwice
</code></pre>

<hr>
<h2 id='peptide_data'>Peptide array data example</h2><span id='topic+peptide_data'></span>

<h3>Description</h3>

<p>A high-density peptide microarray example to identify peptides for which antibody binding levels differ between control subjects and rheumatoid arthritis (RA) patients expressing a specific disease marker combination (i.e., CCP+RF+ RA). 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("peptide_data")</code></pre>


<h3>Format</h3>

<p>A data frame with 152603 observations on the following 16 variables.
</p>

<p>The first 8 columns are RA patients and the remaining columns are from control subjects.

</p>


<h3>Details</h3>

<p>Each row of the data (<code>rownames(peptide_data)</code>) is a probed length-12 peptide and each column of the data (<code>colnames(peptide_data)</code>) is a subject with distinct pseudo sample ID. The binding value is doubly-log transformed using natural base to stabilize variance.
</p>


<h3>Source</h3>

<p>Zheng, Zihao, et al. <em>Disordered Antigens and Epitope Overlap Between Anti Citrullinated Protein Antibodies and Rheumatoid Factor in Rheumatoid Arthritis.</em> <b>Arthritis &amp; Rheumatology</b> 72.2 (2020): 262-272.
</p>


<h3>References</h3>

<p>Zheng et al. <em>MixTwice: Large scale hypothesis testing for peptide arrays by variance mixing</em>. Bioinformatics, 2021.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#### load the RA data

data(peptide_data)

#### visualize the data

## each row is a peptide with unique peptide sequence

## each column is a subject with information on group and pseudo ID

colnames(peptide_data)


## z-score for peptide

get_zscore = function(x){
  
  n = length(x)
  
  t = t.test(x[1:(n/2)], x[(n/2 + 1):n], var.equal = TRUE)$statistic
  
  return(qnorm(pt(t, df = n-2)))
}

z = apply(peptide_data, 1, get_zscore)

## visualize the density of z-score

hist(z, probability = TRUE, 100, ylim = c(0,0.4), col = "blue")
lines(density(rnorm(10^5)), lwd =2)



</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
