<!DOCTYPE html><html><head><title>Help for package r5r</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {r5r}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#accessibility'><p>Calculate access to opportunities</p></a></li>
<li><a href='#assert_fare_structure'><p>Assert fare structure</p></a></li>
<li><a href='#assign_decay_function'><p>Assign decay function and parameter values</p></a></li>
<li><a href='#assign_departure'><p>Check and convert POSIXct objects to strings</p></a></li>
<li><a href='#assign_drop_geometry'><p>Assign drop geometry</p></a></li>
<li><a href='#assign_max_street_time'><p>Assign max street time from walk/bike distance and speed</p></a></li>
<li><a href='#assign_max_trip_duration'><p>Assign max trip duration</p></a></li>
<li><a href='#assign_mode'><p>Check and select transport modes from user input</p></a></li>
<li><a href='#assign_opportunities'><p>Assign opportunities data</p></a></li>
<li><a href='#assign_points_input'><p>Check and convert origin and destination inputs</p></a></li>
<li><a href='#assign_shortest_path'><p>Assign shortest path</p></a></li>
<li><a href='#check_connection'><p>Check internet connection with Ipea server</p></a></li>
<li><a href='#detailed_itineraries'><p>Detailed itineraries between origin-destination pairs</p></a></li>
<li><a href='#download_r5'><p>Download <code>R5.jar</code></p></a></li>
<li><a href='#expand_od_pairs'><p>Expand origin-destination pairs</p></a></li>
<li><a href='#expanded_travel_time_matrix'><p>Calculate minute-by-minute travel times between origin destination pairs</p></a></li>
<li><a href='#fileurl_from_metadata'><p>Get most recent JAR file url from metadata</p></a></li>
<li><a href='#find_snap'><p>Find snapped locations of input points on street network</p></a></li>
<li><a href='#isochrone'><p>Estimate isochrones from a given location</p></a></li>
<li><a href='#java_to_dt'><p>Java object to data.table</p></a></li>
<li><a href='#pareto_frontier'><p>Calculate travel time and monetary cost Pareto frontier</p></a></li>
<li><a href='#r5r'><p>r5r: Rapid Realistic Routing with 'R5'</p></a></li>
<li><a href='#r5r_sitrep'><p>Generate an r5r situation report to help debug errors</p></a></li>
<li><a href='#read_fare_structure'><p>Read a fare structure object from a file</p></a></li>
<li><a href='#set_breakdown'><p>Set breakdown</p></a></li>
<li><a href='#set_cutoffs'><p>Set cutoffs</p></a></li>
<li><a href='#set_expanded_travel_times'><p>Set expanded travel times</p></a></li>
<li><a href='#set_fare_cutoffs'><p>Set monetary cutoffs</p></a></li>
<li><a href='#set_fare_structure'><p>Set the fare structure used when calculating transit fares</p></a></li>
<li><a href='#set_max_fare'><p>Set max fare</p></a></li>
<li><a href='#set_max_lts'><p>Set max Level of Transit Stress (LTS)</p></a></li>
<li><a href='#set_max_rides'><p>Set max number of rides</p></a></li>
<li><a href='#set_monte_carlo_draws'><p>Set number of Monte Carlo draws</p></a></li>
<li><a href='#set_n_threads'><p>Set number of threads</p></a></li>
<li><a href='#set_output_dir'><p>Set output directory</p></a></li>
<li><a href='#set_percentiles'><p>Set percentiles</p></a></li>
<li><a href='#set_progress'><p>Set progress argument</p></a></li>
<li><a href='#set_speed'><p>Set walk and bike speed</p></a></li>
<li><a href='#set_suboptimal_minutes'><p>Set suboptimal minutes</p></a></li>
<li><a href='#set_time_window'><p>Set time window</p></a></li>
<li><a href='#set_verbose'><p>Set verbose argument</p></a></li>
<li><a href='#setup_fare_structure'><p>Setup a fare structure to calculate the monetary costs of trips</p></a></li>
<li><a href='#setup_r5'><p>Create a transport network used for routing in R5</p></a></li>
<li><a href='#stop_r5'><p>Stop running r5r core</p></a></li>
<li><a href='#street_network_to_sf'><p>Extract OpenStreetMap network in sf format from a network.dat file</p></a></li>
<li><a href='#transit_network_to_sf'><p>Extract transit network in sf format</p></a></li>
<li><a href='#travel_time_matrix'><p>Calculate travel time matrix between origin destination pairs</p></a></li>
<li><a href='#write_fare_structure'><p>Write a fare structure object to disk</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Rapid Realistic Routing with 'R5'</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Rapid realistic routing on multimodal transport networks
    (walk, bike, public transport and car) using 'R5', the Rapid Realistic
    Routing on Real-world and Reimagined networks engine
    <a href="https://github.com/conveyal/r5">https://github.com/conveyal/r5</a>. The package allows users to generate
    detailed routing analysis or calculate travel time matrices using
    seamless parallel computing on top of the R5 Java machine.  While R5
    is developed by Conveyal, the package r5r is independently developed
    by a team at the Institute for Applied Economic Research (Ipea) with
    contributions from collaborators. Apart from the documentation in this
    package, users will find additional information on R5 documentation at
    <a href="https://docs.conveyal.com/">https://docs.conveyal.com/</a>. Although we try to keep new releases of
    r5r in synchrony with R5, the development of R5 follows Conveyal's
    independent update process. Hence, users should confirm the R5 version
    implied by the Conveyal user manual (see
    <a href="https://docs.conveyal.com/changelog">https://docs.conveyal.com/changelog</a>) corresponds with the R5 version
    that r5r depends on.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/ipeaGIT/r5r">https://github.com/ipeaGIT/r5r</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/ipeaGIT/r5r/issues">https://github.com/ipeaGIT/r5r/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.6)</td>
</tr>
<tr>
<td>Imports:</td>
<td>checkmate, concaveman, curl, data.table, httr, jsonlite, rJava
(&ge; 0.9-10), sf (&ge; 1.0-12), sfheaders, utils, zip</td>
</tr>
<tr>
<td>Suggests:</td>
<td>accessibility, covr, dplyr, ggplot2 (&ge; 3.3.1), gtfstools,
h3jsr (&ge; 1.3.0), interp, knitr, parallel, patchwork,
rmarkdown, testthat</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>Java JDK (&gt;= 11.0)</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-08-08 00:46:34 UTC; user</td>
</tr>
<tr>
<td>Author:</td>
<td>Marcus Saraiva <a href="https://orcid.org/0000-0001-6218-2338"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Rafael H. M. Pereira
    <a href="https://orcid.org/0000-0003-2125-7465"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut, cre],
  Daniel Herszenhut <a href="https://orcid.org/0000-0001-8066-1105"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Carlos Kaue Vieira Braga
    <a href="https://orcid.org/0000-0002-6104-7297"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Matthew Wigginton Conway
    <a href="https://orcid.org/0000-0002-1210-2982"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Ipea - Institute for Applied Economic Research [cph, fnd]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Rafael H. M. Pereira &lt;rafa.pereira.br@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-08-08 07:50:06 UTC</td>
</tr>
</table>
<hr>
<h2 id='accessibility'>Calculate access to opportunities</h2><span id='topic+accessibility'></span>

<h3>Description</h3>

<p>Fast computation of access to opportunities given a selected decay function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>accessibility(
  r5r_core,
  origins,
  destinations,
  opportunities_colnames = "opportunities",
  mode = "WALK",
  mode_egress = "WALK",
  departure_datetime = Sys.time(),
  time_window = 10L,
  percentiles = 50L,
  decay_function = "step",
  cutoffs = NULL,
  decay_value = NULL,
  fare_structure = NULL,
  max_fare = Inf,
  max_walk_time = Inf,
  max_bike_time = Inf,
  max_car_time = Inf,
  max_trip_duration = 120L,
  walk_speed = 3.6,
  bike_speed = 12,
  max_rides = 3,
  max_lts = 2,
  draws_per_minute = 5L,
  n_threads = Inf,
  verbose = FALSE,
  progress = FALSE,
  output_dir = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="accessibility_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="accessibility_+3A_origins">origins</code>, <code id="accessibility_+3A_destinations">destinations</code></td>
<td>
<p>Either a <code style="white-space: pre;">&#8288;POINT sf&#8288;</code> object with WGS84 CRS, or a
<code>data.frame</code> containing the columns <code>id</code>, <code>lon</code> and <code>lat</code>.</p>
</td></tr>
<tr><td><code id="accessibility_+3A_opportunities_colnames">opportunities_colnames</code></td>
<td>
<p>A character vector. The names of the columns
in the <code>destinations</code> input that tells the number of opportunities in each
location. Several different column names can be passed, in which case the
accessibility to each kind of opportunity will be calculated.</p>
</td></tr>
<tr><td><code id="accessibility_+3A_mode">mode</code></td>
<td>
<p>A character vector. The transport modes allowed for access,
transfer and vehicle legs of the trips. Defaults to <code>WALK</code>. Please see
details for other options.</p>
</td></tr>
<tr><td><code id="accessibility_+3A_mode_egress">mode_egress</code></td>
<td>
<p>A character vector. The transport mode used after egress
from the last public transport. It can be either <code>WALK</code>, <code>BICYCLE</code> or
<code>CAR</code>. Defaults to <code>WALK</code>. Ignored when public transport is not used.</p>
</td></tr>
<tr><td><code id="accessibility_+3A_departure_datetime">departure_datetime</code></td>
<td>
<p>A POSIXct object. Please note that the departure
time only influences public transport legs. When working with public
transport networks, please check the <code>calendar.txt</code> within your GTFS feeds
for valid dates. Please see details for further information on how
datetimes are parsed.</p>
</td></tr>
<tr><td><code id="accessibility_+3A_time_window">time_window</code></td>
<td>
<p>An integer. The time window in minutes for which <code>r5r</code>
will calculate multiple travel time matrices departing each minute.
Defaults to 10 minutes. By default, the function returns the result based
on median travel times, but the user can set the <code>percentiles</code> parameter to
extract more results. Please read the time window vignette for more details
on its usage <code>vignette("time_window", package = "r5r")</code></p>
</td></tr>
<tr><td><code id="accessibility_+3A_percentiles">percentiles</code></td>
<td>
<p>An integer vector (max length of 5). Specifies the
percentile to use when returning accessibility estimates within the given
time window. Please note that this parameter is applied to the travel time
estimates that generate the accessibility results, and not to the
accessibility distribution itself (i.e. if the 25th percentile is
specified, the accessibility is calculated from the 25th percentile travel
time, which may or may not be equal to the 25th percentile of the
accessibility distribution itself). Defaults to 50, returning the
accessibility calculated from the median travel time. If a vector with
length bigger than 1 is passed, the output contains an additional column
that specifies the percentile of each accessibility estimate. Due to
upstream restrictions, only 5 percentiles can be specified at a time. For
more details, please see <code>R5</code> documentation at
<a href="https://docs.conveyal.com/analysis/methodology#accounting-for-variability">https://docs.conveyal.com/analysis/methodology#accounting-for-variability</a>.</p>
</td></tr>
<tr><td><code id="accessibility_+3A_decay_function">decay_function</code></td>
<td>
<p>A string. Which decay function to use when calculating
accessibility. One of <code>step</code>, <code>exponential</code>, <code>fixed_exponential</code>, <code>linear</code>
or <code>logistic</code>. Defaults to <code>step</code>, which is equivalent to a cumulative
opportunities measure. Please see the details to understand how each
alternative works and how they relate to the <code>cutoffs</code> and <code>decay_value</code>
parameters.</p>
</td></tr>
<tr><td><code id="accessibility_+3A_cutoffs">cutoffs</code></td>
<td>
<p>A numeric vector (maximum length of 12). This parameter has
different effects for each decay function: it indicates the cutoff times
in minutes when calculating cumulative opportunities accessibility with
the <code>step</code> function, the median (or inflection point) of the decay curves
in the <code>logistic</code> and <code>linear</code> functions, and the half-life in the
<code>exponential</code> function. It has no effect when using the
<code>fixed_exponential</code> function.</p>
</td></tr>
<tr><td><code id="accessibility_+3A_decay_value">decay_value</code></td>
<td>
<p>A number. Extra parameter to be passed to the selected
<code>decay_function</code>. Has no effects when <code>decay_function</code> is either <code>step</code> or
<code>exponential</code>.</p>
</td></tr>
<tr><td><code id="accessibility_+3A_fare_structure">fare_structure</code></td>
<td>
<p>A fare structure object, following the convention
set in <code><a href="#topic+setup_fare_structure">setup_fare_structure()</a></code>. This object describes how transit fares
should be calculated. Please see the fare structure vignette to
understand how this object is structured:
<code>vignette("fare_structure", package = "r5r")</code>.</p>
</td></tr>
<tr><td><code id="accessibility_+3A_max_fare">max_fare</code></td>
<td>
<p>A number. The maximum value that trips can cost when
calculating the fastest journey between each origin and destination pair.</p>
</td></tr>
<tr><td><code id="accessibility_+3A_max_walk_time">max_walk_time</code></td>
<td>
<p>An integer. The maximum walking time (in minutes) to
access and egress the transit network, or to make transfers within the
network. Defaults to no restrictions, as long as <code>max_trip_duration</code> is
respected. The max time is considered separately for each leg (e.g. if
you set <code>max_walk_time</code> to 15, you could potentially walk up to 15 minutes
to reach transit, and up to <em>another</em> 15 minutes to reach the destination
after leaving transit). Defaults to <code>Inf</code>, no limit.</p>
</td></tr>
<tr><td><code id="accessibility_+3A_max_bike_time">max_bike_time</code></td>
<td>
<p>An integer. The maximum cycling time (in minutes) to
access and egress the transit network. Defaults to no restrictions, as long
as <code>max_trip_duration</code> is respected. The max time is considered separately
for each leg (e.g. if you set <code>max_bike_time</code> to 15 minutes, you could
potentially cycle up to 15 minutes to reach transit, and up to <em>another</em> 15
minutes to reach the destination after leaving transit). Defaults to <code>Inf</code>,
no limit.</p>
</td></tr>
<tr><td><code id="accessibility_+3A_max_car_time">max_car_time</code></td>
<td>
<p>An integer. The maximum driving time (in minutes) to
access and egress the transit network. Defaults to no restrictions, as long
as <code>max_trip_duration</code> is respected. The max time is considered separately
for each leg (e.g. if you set <code>max_car_time</code> to 15 minutes, you could
potentially drive up to 15 minutes to reach transit, and up to <em>another</em> 15
minutes to reach the destination after leaving transit). Defaults to <code>Inf</code>,
no limit.</p>
</td></tr>
<tr><td><code id="accessibility_+3A_max_trip_duration">max_trip_duration</code></td>
<td>
<p>An integer. The maximum trip duration in minutes.
Defaults to 120 minutes (2 hours).</p>
</td></tr>
<tr><td><code id="accessibility_+3A_walk_speed">walk_speed</code></td>
<td>
<p>A numeric. Average walk speed in km/h. Defaults to 3.6
km/h.</p>
</td></tr>
<tr><td><code id="accessibility_+3A_bike_speed">bike_speed</code></td>
<td>
<p>A numeric. Average cycling speed in km/h. Defaults to 12
km/h.</p>
</td></tr>
<tr><td><code id="accessibility_+3A_max_rides">max_rides</code></td>
<td>
<p>An integer. The maximum number of public transport rides
allowed in the same trip. Defaults to 3.</p>
</td></tr>
<tr><td><code id="accessibility_+3A_max_lts">max_lts</code></td>
<td>
<p>An integer between 1 and 4. The maximum level of traffic
stress that cyclists will tolerate. A value of 1 means cyclists will only
travel through the quietest streets, while a value of 4 indicates cyclists
can travel through any road. Defaults to 2. Please see details for more
information.</p>
</td></tr>
<tr><td><code id="accessibility_+3A_draws_per_minute">draws_per_minute</code></td>
<td>
<p>An integer. The number of Monte Carlo draws to
perform per time window minute when calculating travel time matrices and
when estimating accessibility. Defaults to 5. This would mean 300 draws in
a 60-minute time window, for example. This parameter only affects the
results when the GTFS feeds contain a <code>frequencies.txt</code> table.</p>
</td></tr>
<tr><td><code id="accessibility_+3A_n_threads">n_threads</code></td>
<td>
<p>An integer. The number of threads to use when running the
router in parallel. Defaults to use all available threads (Inf).</p>
</td></tr>
<tr><td><code id="accessibility_+3A_verbose">verbose</code></td>
<td>
<p>A logical. Whether to show <code>R5</code> informative messages when
running the function. Defaults to <code>FALSE</code> (please note that in such case
<code>R5</code> error messages are still shown). Setting <code>verbose</code> to <code>TRUE</code> shows
detailed output, which can be useful for debugging issues not caught by
<code>r5r</code>.</p>
</td></tr>
<tr><td><code id="accessibility_+3A_progress">progress</code></td>
<td>
<p>A logical. Whether to show a progress counter when running
the router. Defaults to <code>FALSE</code>. Only works when <code>verbose</code> is set to
<code>FALSE</code>, so the progress counter does not interfere with <code>R5</code>'s output
messages. Setting <code>progress</code> to <code>TRUE</code> may impose a small penalty for
computation efficiency, because the progress counter must be synchronized
among all active threads.</p>
</td></tr>
<tr><td><code id="accessibility_+3A_output_dir">output_dir</code></td>
<td>
<p>Either <code>NULL</code> or a path to an existing directory. When not
<code>NULL</code> (the default), the function will write one <code>.csv</code> file with the
results for each origin in the specified directory. In such case, the
function returns the path specified in this parameter. This parameter is
particularly useful when running estimates on memory-constrained settings,
because writing the results to disk prevents <code>r5r</code> from storing them in
memory.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>data.table</code> with accessibility estimates for all origin points.
This <code>data.table</code> contain columns listing the origin id, the type of
opportunities to which accessibility was calculated, the travel time
percentile considered in the accessibility estimate and the specified
cutoff values (except in when <code>decay_function</code> is <code>fixed_exponential</code>, in
which case the <code>cutoff</code> parameter is not used). If <code>output_dir</code> is not
<code>NULL</code>, the function returns the path specified in that parameter, in
which the <code>.csv</code> files containing the results are saved.
</p>


<h3>Decay functions</h3>

<p><code>R5</code> allows one to use different decay functions when calculating
accessibility. Please see the original <code>R5</code> documentation from Conveyal for
more information on each one one
(<a href="https://docs.conveyal.com/learn-more/decay-functions">https://docs.conveyal.com/learn-more/decay-functions</a>). A summary of each
available option, as well as the value passed to <code>decay_function</code> to use it
(inside parentheses) are listed below:
</p>

<ul>
<li> <p><strong>Step</strong>, also known as cumulative opportunities (<code>"step"</code>): <br />
a binary decay function used to find the sum of available opportunities
within a specific travel time cutoff.
</p>
</li>
<li> <p><strong>Logistic CDF</strong> (<code>"logistic"</code>): <br />
This is the logistic function, i.e. the cumulative distribution function of
the logistic distribution, expressed such that its parameters are the median
(inflection point) and standard deviation. This function applies a sigmoid
rolloff that has a convenient relationship to discrete choice theory. Its
parameters can be set to reflect a whole population's tolerance for making
trips with different travel times. The function's value represents the
probability that a randomly chosen member of the population would accept
making a trip, given its duration. Opportunities are then weighted by how
likely it is that a person would consider them &quot;reachable&quot;.
</p>

<ul>
<li><p> Calibration: The median parameter is controlled by the <code>cutoff</code>
parameter, leaving only the standard deviation to configure through the
<code>decay_value</code> parameter.
</p>
</li></ul>

</li>
<li> <p><strong>Fixed Exponential</strong> (<code>"fixed_exponential"</code>): <br />
This function is of the form <code>exp(-Lt)</code> where L is a single fixed decay
constant in the range (0, 1). It is constrained to be positive to ensure
weights decrease (rather than grow) with increasing travel time.
</p>

<ul>
<li><p> Calibration: This function is controlled exclusively by the <code>L</code> constant,
given by the <code>decay_value</code> parameter. Values provided in <code>cutoffs</code> are
ignored.
</p>
</li></ul>

</li>
<li> <p><strong>Half-life Exponential Decay</strong> (<code>"exponential"</code>): <br />
This is similar to the fixed-exponential option above, but in this case the
decay parameter is inferred from the <code>cutoffs</code> parameter values, which is
treated as the half-life of the decay.
</p>
</li>
<li> <p><strong>Linear</strong> (<code>"linear"</code>): <br />
This is a simple, vaguely sigmoid option, which may be useful when you have
a sense of a maximum travel time that would be tolerated by any traveler,
and a minimum time below which all travel is perceived to be equally easy.
</p>

<ul>
<li><p> Calibration: The transition region is transposable and symmetric around
the <code>cutoffs</code> parameter values, taking <code>decay_value</code> minutes to taper down
from one to zero.
</p>
</li></ul>

</li></ul>



<h3>Transport modes</h3>

<p><code>R5</code> allows for multiple combinations of transport modes. The options
include:
</p>

<ul>
<li> <p><strong>Transit modes:</strong> <code>TRAM</code>, <code>SUBWAY</code>, <code>RAIL</code>, <code>BUS</code>, <code>FERRY</code>, <code>CABLE_CAR</code>,
<code>GONDOLA</code>, <code>FUNICULAR</code>. The option <code>TRANSIT</code> automatically considers all
public transport modes available.
</p>
</li>
<li> <p><strong>Non transit modes:</strong> <code>WALK</code>, <code>BICYCLE</code>, <code>CAR</code>, <code>BICYCLE_RENT</code>,
<code>CAR_PARK</code>.
</p>
</li></ul>



<h3>Level of Traffic Stress (LTS)</h3>

<p>When cycling is enabled in <code>R5</code> (by passing the value <code>BIKE</code> to either
<code>mode</code> or <code>mode_egress</code>), setting <code>max_lts</code> will allow cycling only on
streets with a given level of danger/stress. Setting <code>max_lts</code> to 1, for
example, will allow cycling only on separated bicycle infrastructure or
low-traffic streets and routing will revert to walking when traversing any
links with LTS exceeding 1. Setting <code>max_lts</code> to 3 will allow cycling on
links with LTS 1, 2 or 3. Routing also reverts to walking if the street
segment is tagged as non-bikable in OSM (e.g. a staircase), independently of
the specified max LTS.
</p>
<p>The default methodology for assigning LTS values to network edges is based
on commonly tagged attributes of OSM ways. See more info about LTS in the
original documentation of R5 from Conveyal at
<a href="https://docs.conveyal.com/learn-more/traffic-stress">https://docs.conveyal.com/learn-more/traffic-stress</a>. In summary:
</p>

<ul>
<li> <p><strong>LTS 1</strong>: Tolerable for children. This includes low-speed, low-volume
streets, as well as those with separated bicycle facilities (such as
parking-protected lanes or cycle tracks).
</p>
</li>
<li> <p><strong>LTS 2</strong>: Tolerable for the mainstream adult population. This includes
streets where cyclists have dedicated lanes and only have to interact with
traffic at formal crossing.
</p>
</li>
<li> <p><strong>LTS 3</strong>: Tolerable for &quot;enthused and confident&quot; cyclists. This includes
streets which may involve close proximity to moderate- or high-speed
vehicular traffic.
</p>
</li>
<li> <p><strong>LTS 4</strong>: Tolerable only for &quot;strong and fearless&quot; cyclists. This
includes streets where cyclists are required to mix with moderate- to
high-speed vehicular traffic.
</p>
</li></ul>

<p>For advanced users, you can provide custom LTS values by adding a tag <code style="white-space: pre;">&#8288;&lt;key = "lts"&gt;&#8288;</code> to the <code>osm.pbf</code> file.
</p>


<h3>Datetime parsing</h3>

<p><code>r5r</code> ignores the timezone attribute of datetime objects when parsing dates
and times, using the study area's timezone instead. For example, let's say
you are running some calculations using Rio de Janeiro, Brazil, as your study
area. The datetime <code>as.POSIXct("13-05-2019 14:00:00", format = "%d-%m-%Y %H:%M:%S")</code> will be parsed as May 13th, 2019, 14:00h in
Rio's local time, as expected. But <code>as.POSIXct("13-05-2019 14:00:00", format = "%d-%m-%Y %H:%M:%S", tz = "Europe/Paris")</code> will also be parsed as
the exact same date and time in Rio's local time, perhaps surprisingly,
ignoring the timezone attribute.
</p>


<h3>Routing algorithm</h3>

<p>The <code><a href="#topic+travel_time_matrix">travel_time_matrix()</a></code>, <code><a href="#topic+expanded_travel_time_matrix">expanded_travel_time_matrix()</a></code> and
<code><a href="#topic+accessibility">accessibility()</a></code> functions use an <code>R5</code>-specific extension to the RAPTOR
routing algorithm (see Conway et al., 2017). This RAPTOR extension uses a
systematic sample of one departure per minute over the time window set by the
user in the 'time_window' parameter. A detailed description of base RAPTOR
can be found in Delling et al (2015). However, whenever the user includes
transit fares inputs to these functions, they automatically switch to use an
<code>R5</code>-specific extension to the McRAPTOR routing algorithm.
</p>

<ul>
<li><p> Conway, M. W., Byrd, A., &amp; van der Linden, M. (2017). Evidence-based
transit and land use sketch planning using interactive accessibility methods
on combined schedule and headway-based networks. Transportation Research
Record, 2653(1), 45-53. <a href="https://doi.org/10.3141/2653-06">doi:10.3141/2653-06</a>
</p>
</li>
<li><p> Delling, D., Pajor, T., &amp; Werneck, R. F. (2015). Round-based public
transit routing. Transportation Science, 49(3), 591-604.
<a href="https://doi.org/10.1287/trsc.2014.0534">doi:10.1287/trsc.2014.0534</a>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
library(r5r)

data_path &lt;- system.file("extdata/poa", package = "r5r")
r5r_core &lt;- setup_r5(data_path)
points &lt;- read.csv(file.path(data_path, "poa_hexgrid.csv"))[1:5, ]

departure_datetime &lt;- as.POSIXct(
  "13-05-2019 14:00:00",
  format = "%d-%m-%Y %H:%M:%S"
)

access &lt;- accessibility(
  r5r_core,
  origins = points,
  destinations = points,
  opportunities_colnames = "schools",
  mode = "WALK",
  departure_datetime = departure_datetime,
  decay_function = "step",
  cutoffs = 30,
  max_trip_duration = 30
)
head(access)

# using a different decay function
access &lt;- accessibility(
  r5r_core,
  origins = points,
  destinations = points,
  opportunities_colnames = "schools",
  mode = "WALK",
  departure_datetime = departure_datetime,
  decay_function = "logistic",
  cutoffs = 30,
  decay_value = 1,
  max_trip_duration = 30
)
head(access)

# using several cutoff values
access &lt;- accessibility(
  r5r_core,
  origins = points,
  destinations = points,
  opportunities_colnames = "schools",
  mode = "WALK",
  departure_datetime = departure_datetime,
  decay_function = "step",
  cutoffs = c(25, 30),
  max_trip_duration = 30
)
head(access)

# calculating access to different types of opportunities
access &lt;- accessibility(
  r5r_core,
  origins = points,
  destinations = points,
  opportunities_colnames = c("schools", "healthcare"),
  mode = "WALK",
  departure_datetime = departure_datetime,
  decay_function = "step",
  cutoffs = 30,
  max_trip_duration = 30
)
head(access)

stop_r5(r5r_core)

</code></pre>

<hr>
<h2 id='assert_fare_structure'>Assert fare structure</h2><span id='topic+assert_fare_structure'></span>

<h3>Description</h3>

<p>Asserts whether the specified fare structure object complies with the
structure set in <code><a href="#topic+setup_fare_structure">setup_fare_structure()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>assert_fare_structure(fare_structure)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="assert_fare_structure_+3A_fare_structure">fare_structure</code></td>
<td>
<p>A fare structure object, following the convention
set in <code><a href="#topic+setup_fare_structure">setup_fare_structure()</a></code>. This object describes how transit fares
should be calculated. Please see the fare structure vignette to
understand how this object is structured:
<code>vignette("fare_structure", package = "r5r")</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Throws and error upon failure and invisibly returns <code>TRUE</code> on
success.
</p>

<hr>
<h2 id='assign_decay_function'>Assign decay function and parameter values</h2><span id='topic+assign_decay_function'></span>

<h3>Description</h3>

<p>Checks and assigns decay function and values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>assign_decay_function(decay_function, decay_value)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="assign_decay_function_+3A_decay_function">decay_function</code></td>
<td>
<p>A string, the name of the decay function.</p>
</td></tr>
<tr><td><code id="assign_decay_function_+3A_decay_value">decay_value</code></td>
<td>
<p>A number, the value of decay parameter.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>list</code> with the validated decay function and parameter value.
</p>


<h3>See Also</h3>

<p>Other assigning functions: 
<code><a href="#topic+assign_departure">assign_departure</a>()</code>,
<code><a href="#topic+assign_drop_geometry">assign_drop_geometry</a>()</code>,
<code><a href="#topic+assign_max_street_time">assign_max_street_time</a>()</code>,
<code><a href="#topic+assign_max_trip_duration">assign_max_trip_duration</a>()</code>,
<code><a href="#topic+assign_mode">assign_mode</a>()</code>,
<code><a href="#topic+assign_opportunities">assign_opportunities</a>()</code>,
<code><a href="#topic+assign_points_input">assign_points_input</a>()</code>,
<code><a href="#topic+assign_shortest_path">assign_shortest_path</a>()</code>
</p>

<hr>
<h2 id='assign_departure'>Check and convert POSIXct objects to strings</h2><span id='topic+assign_departure'></span>

<h3>Description</h3>

<p>Check and convert POSIXct objects to strings
</p>


<h3>Usage</h3>

<pre><code class='language-R'>assign_departure(datetime)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="assign_departure_+3A_datetime">datetime</code></td>
<td>
<p>An object of POSIXct class.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the <code>date</code> and <code>time</code> of the trip departure as
characters.
</p>


<h3>See Also</h3>

<p>Other assigning functions: 
<code><a href="#topic+assign_decay_function">assign_decay_function</a>()</code>,
<code><a href="#topic+assign_drop_geometry">assign_drop_geometry</a>()</code>,
<code><a href="#topic+assign_max_street_time">assign_max_street_time</a>()</code>,
<code><a href="#topic+assign_max_trip_duration">assign_max_trip_duration</a>()</code>,
<code><a href="#topic+assign_mode">assign_mode</a>()</code>,
<code><a href="#topic+assign_opportunities">assign_opportunities</a>()</code>,
<code><a href="#topic+assign_points_input">assign_points_input</a>()</code>,
<code><a href="#topic+assign_shortest_path">assign_shortest_path</a>()</code>
</p>

<hr>
<h2 id='assign_drop_geometry'>Assign drop geometry</h2><span id='topic+assign_drop_geometry'></span>

<h3>Description</h3>

<p>Check the drop geometry input.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>assign_drop_geometry(drop_geometry)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="assign_drop_geometry_+3A_drop_geometry">drop_geometry</code></td>
<td>
<p>A logical.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A logical.
</p>


<h3>See Also</h3>

<p>Other assigning functions: 
<code><a href="#topic+assign_decay_function">assign_decay_function</a>()</code>,
<code><a href="#topic+assign_departure">assign_departure</a>()</code>,
<code><a href="#topic+assign_max_street_time">assign_max_street_time</a>()</code>,
<code><a href="#topic+assign_max_trip_duration">assign_max_trip_duration</a>()</code>,
<code><a href="#topic+assign_mode">assign_mode</a>()</code>,
<code><a href="#topic+assign_opportunities">assign_opportunities</a>()</code>,
<code><a href="#topic+assign_points_input">assign_points_input</a>()</code>,
<code><a href="#topic+assign_shortest_path">assign_shortest_path</a>()</code>
</p>

<hr>
<h2 id='assign_max_street_time'>Assign max street time from walk/bike distance and speed</h2><span id='topic+assign_max_street_time'></span>

<h3>Description</h3>

<p>Checks the time duration and speed inputs and converts them to distance.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>assign_max_street_time(max_time, speed, max_trip_duration, mode)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="assign_max_street_time_+3A_max_time">max_time</code></td>
<td>
<p>A numeric of length 1. Maximum walking distance (in
meters) for the whole trip. Passed from routing functions.</p>
</td></tr>
<tr><td><code id="assign_max_street_time_+3A_speed">speed</code></td>
<td>
<p>A numeric of length 1. Average walk speed in km/h.
Defaults to 3.6 Km/h. Passed from routing functions.</p>
</td></tr>
<tr><td><code id="assign_max_street_time_+3A_max_trip_duration">max_trip_duration</code></td>
<td>
<p>A numeric of length 1. Maximum trip duration in
seconds. Defaults to 120 minutes (2 hours). Passed from routing functions.</p>
</td></tr>
<tr><td><code id="assign_max_street_time_+3A_mode">mode</code></td>
<td>
<p>A string. Either <code>"bike"</code> or <code>"walk"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An <code>integer</code> representing the maximum number of minutes walking.
</p>


<h3>See Also</h3>

<p>Other assigning functions: 
<code><a href="#topic+assign_decay_function">assign_decay_function</a>()</code>,
<code><a href="#topic+assign_departure">assign_departure</a>()</code>,
<code><a href="#topic+assign_drop_geometry">assign_drop_geometry</a>()</code>,
<code><a href="#topic+assign_max_trip_duration">assign_max_trip_duration</a>()</code>,
<code><a href="#topic+assign_mode">assign_mode</a>()</code>,
<code><a href="#topic+assign_opportunities">assign_opportunities</a>()</code>,
<code><a href="#topic+assign_points_input">assign_points_input</a>()</code>,
<code><a href="#topic+assign_shortest_path">assign_shortest_path</a>()</code>
</p>

<hr>
<h2 id='assign_max_trip_duration'>Assign max trip duration</h2><span id='topic+assign_max_trip_duration'></span>

<h3>Description</h3>

<p>Check and convert the max trip duration input.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>assign_max_trip_duration(
  max_trip_duration,
  modes,
  max_walk_time,
  max_bike_time
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="assign_max_trip_duration_+3A_max_trip_duration">max_trip_duration</code></td>
<td>
<p>A number.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An <code>integer</code> representing the maximum trip duration in minutes.
</p>


<h3>See Also</h3>

<p>Other assigning functions: 
<code><a href="#topic+assign_decay_function">assign_decay_function</a>()</code>,
<code><a href="#topic+assign_departure">assign_departure</a>()</code>,
<code><a href="#topic+assign_drop_geometry">assign_drop_geometry</a>()</code>,
<code><a href="#topic+assign_max_street_time">assign_max_street_time</a>()</code>,
<code><a href="#topic+assign_mode">assign_mode</a>()</code>,
<code><a href="#topic+assign_opportunities">assign_opportunities</a>()</code>,
<code><a href="#topic+assign_points_input">assign_points_input</a>()</code>,
<code><a href="#topic+assign_shortest_path">assign_shortest_path</a>()</code>
</p>

<hr>
<h2 id='assign_mode'>Check and select transport modes from user input</h2><span id='topic+assign_mode'></span>

<h3>Description</h3>

<p>Selects the transport modes used in the routing functions. Only one direct
and access/egress modes are allowed at a time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>assign_mode(mode, mode_egress, style)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="assign_mode_+3A_mode">mode</code></td>
<td>
<p>A character vector, passed from routing functions.</p>
</td></tr>
<tr><td><code id="assign_mode_+3A_mode_egress">mode_egress</code></td>
<td>
<p>A character vector, passed from routing functions.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the transport modes to be used in the routing.
</p>


<h3>See Also</h3>

<p>Other assigning functions: 
<code><a href="#topic+assign_decay_function">assign_decay_function</a>()</code>,
<code><a href="#topic+assign_departure">assign_departure</a>()</code>,
<code><a href="#topic+assign_drop_geometry">assign_drop_geometry</a>()</code>,
<code><a href="#topic+assign_max_street_time">assign_max_street_time</a>()</code>,
<code><a href="#topic+assign_max_trip_duration">assign_max_trip_duration</a>()</code>,
<code><a href="#topic+assign_opportunities">assign_opportunities</a>()</code>,
<code><a href="#topic+assign_points_input">assign_points_input</a>()</code>,
<code><a href="#topic+assign_shortest_path">assign_shortest_path</a>()</code>
</p>

<hr>
<h2 id='assign_opportunities'>Assign opportunities data</h2><span id='topic+assign_opportunities'></span>

<h3>Description</h3>

<p>Check and create an opportunities dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>assign_opportunities(destinations, opportunities_colnames)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="assign_opportunities_+3A_destinations">destinations</code></td>
<td>
<p>Either a <code>data.frame</code> or a <code style="white-space: pre;">&#8288;POINT sf&#8288;</code>.</p>
</td></tr>
<tr><td><code id="assign_opportunities_+3A_opportunities_colnames">opportunities_colnames</code></td>
<td>
<p>A character vector with the names of the
opportunities columns in <code>destinations</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of <code>Java-Array</code> objects.
</p>


<h3>See Also</h3>

<p>Other assigning functions: 
<code><a href="#topic+assign_decay_function">assign_decay_function</a>()</code>,
<code><a href="#topic+assign_departure">assign_departure</a>()</code>,
<code><a href="#topic+assign_drop_geometry">assign_drop_geometry</a>()</code>,
<code><a href="#topic+assign_max_street_time">assign_max_street_time</a>()</code>,
<code><a href="#topic+assign_max_trip_duration">assign_max_trip_duration</a>()</code>,
<code><a href="#topic+assign_mode">assign_mode</a>()</code>,
<code><a href="#topic+assign_points_input">assign_points_input</a>()</code>,
<code><a href="#topic+assign_shortest_path">assign_shortest_path</a>()</code>
</p>

<hr>
<h2 id='assign_points_input'>Check and convert origin and destination inputs</h2><span id='topic+assign_points_input'></span>

<h3>Description</h3>

<p>Check and convert origin and destination inputs
</p>


<h3>Usage</h3>

<pre><code class='language-R'>assign_points_input(df, name)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="assign_points_input_+3A_df">df</code></td>
<td>
<p>Either a <code>data.frame</code> or a <code style="white-space: pre;">&#8288;POINT sf&#8288;</code>.</p>
</td></tr>
<tr><td><code id="assign_points_input_+3A_name">name</code></td>
<td>
<p>Object name.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>data.frame</code> with columns <code>id</code>, <code>lon</code> and <code>lat</code>.
</p>


<h3>See Also</h3>

<p>Other assigning functions: 
<code><a href="#topic+assign_decay_function">assign_decay_function</a>()</code>,
<code><a href="#topic+assign_departure">assign_departure</a>()</code>,
<code><a href="#topic+assign_drop_geometry">assign_drop_geometry</a>()</code>,
<code><a href="#topic+assign_max_street_time">assign_max_street_time</a>()</code>,
<code><a href="#topic+assign_max_trip_duration">assign_max_trip_duration</a>()</code>,
<code><a href="#topic+assign_mode">assign_mode</a>()</code>,
<code><a href="#topic+assign_opportunities">assign_opportunities</a>()</code>,
<code><a href="#topic+assign_shortest_path">assign_shortest_path</a>()</code>
</p>

<hr>
<h2 id='assign_shortest_path'>Assign shortest path</h2><span id='topic+assign_shortest_path'></span>

<h3>Description</h3>

<p>Check the shortest path input.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>assign_shortest_path(shortest_path)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="assign_shortest_path_+3A_shortest_path">shortest_path</code></td>
<td>
<p>A logical.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A logical.
</p>


<h3>See Also</h3>

<p>Other assigning functions: 
<code><a href="#topic+assign_decay_function">assign_decay_function</a>()</code>,
<code><a href="#topic+assign_departure">assign_departure</a>()</code>,
<code><a href="#topic+assign_drop_geometry">assign_drop_geometry</a>()</code>,
<code><a href="#topic+assign_max_street_time">assign_max_street_time</a>()</code>,
<code><a href="#topic+assign_max_trip_duration">assign_max_trip_duration</a>()</code>,
<code><a href="#topic+assign_mode">assign_mode</a>()</code>,
<code><a href="#topic+assign_opportunities">assign_opportunities</a>()</code>,
<code><a href="#topic+assign_points_input">assign_points_input</a>()</code>
</p>

<hr>
<h2 id='check_connection'>Check internet connection with Ipea server</h2><span id='topic+check_connection'></span>

<h3>Description</h3>

<p>Checks if there is internet connection to Ipea server to download r5r data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_connection(
  file_url = "https://www.ipea.gov.br/geobr/metadata/metadata_gpkg.csv"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_connection_+3A_file_url">file_url</code></td>
<td>
<p>A string with the file_url address of an geobr dataset</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Logical. <code>TRUE</code> if url is working, <code>FALSE</code> if not.
</p>


<h3>See Also</h3>

<p>Other support functions: 
<code><a href="#topic+fileurl_from_metadata">fileurl_from_metadata</a>()</code>,
<code><a href="#topic+stop_r5">stop_r5</a>()</code>
</p>

<hr>
<h2 id='detailed_itineraries'>Detailed itineraries between origin-destination pairs</h2><span id='topic+detailed_itineraries'></span>

<h3>Description</h3>

<p>Returns detailed trip information between origin-destination pairs. The
output includes the waiting and moving time in each trip leg, as well as some
info such as the distance traveled, the routes used and the geometry of each
leg. Please note that this function was originally conceptualized as a trip
planning functionality, similar to other commercial and non-commercial APIs
and apps (e.g. Moovit, Google's Directions API, OpenTripPlanning's
PlannerResource API). Thus, it consumes much more time and memory than the
other (more analytical) routing functions included in the package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>detailed_itineraries(
  r5r_core,
  origins,
  destinations,
  mode = "WALK",
  mode_egress = "WALK",
  departure_datetime = Sys.time(),
  time_window = 10L,
  suboptimal_minutes = 0L,
  fare_structure = NULL,
  max_fare = Inf,
  max_walk_time = Inf,
  max_bike_time = Inf,
  max_car_time = Inf,
  max_trip_duration = 120L,
  walk_speed = 3.6,
  bike_speed = 12,
  max_rides = 3,
  max_lts = 2,
  shortest_path = TRUE,
  all_to_all = FALSE,
  n_threads = Inf,
  verbose = FALSE,
  progress = FALSE,
  drop_geometry = FALSE,
  output_dir = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="detailed_itineraries_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="detailed_itineraries_+3A_origins">origins</code>, <code id="detailed_itineraries_+3A_destinations">destinations</code></td>
<td>
<p>Either a <code style="white-space: pre;">&#8288;POINT sf&#8288;</code> object with WGS84 CRS, or a
<code>data.frame</code> containing the columns <code>id</code>, <code>lon</code> and <code>lat</code>.</p>
</td></tr>
<tr><td><code id="detailed_itineraries_+3A_mode">mode</code></td>
<td>
<p>A character vector. The transport modes allowed for access,
transfer and vehicle legs of the trips. Defaults to <code>WALK</code>. Please see
details for other options.</p>
</td></tr>
<tr><td><code id="detailed_itineraries_+3A_mode_egress">mode_egress</code></td>
<td>
<p>A character vector. The transport mode used after egress
from the last public transport. It can be either <code>WALK</code>, <code>BICYCLE</code> or
<code>CAR</code>. Defaults to <code>WALK</code>. Ignored when public transport is not used.</p>
</td></tr>
<tr><td><code id="detailed_itineraries_+3A_departure_datetime">departure_datetime</code></td>
<td>
<p>A POSIXct object. Please note that the departure
time only influences public transport legs. When working with public
transport networks, please check the <code>calendar.txt</code> within your GTFS feeds
for valid dates. Please see details for further information on how
datetimes are parsed.</p>
</td></tr>
<tr><td><code id="detailed_itineraries_+3A_time_window">time_window</code></td>
<td>
<p>An integer. The time window in minutes for which <code>r5r</code>
will calculate multiple itineraries departing each minute. Defaults to 10
minutes. If the same sequence of routes appear in different minutes of the
time window, only the fastest of them will be kept in the output. This
happens because the result is not aggregated by percentile, as opposed to
other routing functions in the package. Because of that, the output may
contain trips departing after the specified <code>departure_datetime</code>, but
still within the time window. Please read the time window vignette for
more details on how this argument affects the results of each routing
function: <code>vignette("time_window", package = "r5r")</code>.</p>
</td></tr>
<tr><td><code id="detailed_itineraries_+3A_suboptimal_minutes">suboptimal_minutes</code></td>
<td>
<p>A number. The difference in minutes that each
non-optimal RAPTOR branch can have from the optimal branch without being
disregarded by the routing algorithm. This argument emulates the real-life
behaviour that makes people want to take a path that is technically not
optimal (in terms of travel time, for example) for some practical reasons
(e.g. mode preference, safety, etc). In practice, the higher this value,
the more itineraries will be returned in the final result.</p>
</td></tr>
<tr><td><code id="detailed_itineraries_+3A_fare_structure">fare_structure</code></td>
<td>
<p>A fare structure object, following the convention
set in <code><a href="#topic+setup_fare_structure">setup_fare_structure()</a></code>. This object describes how transit fares
should be calculated. Please see the fare structure vignette to
understand how this object is structured:
<code>vignette("fare_structure", package = "r5r")</code>.</p>
</td></tr>
<tr><td><code id="detailed_itineraries_+3A_max_fare">max_fare</code></td>
<td>
<p>A number. The maximum value that trips can cost when
calculating the fastest journey between each origin and destination pair.</p>
</td></tr>
<tr><td><code id="detailed_itineraries_+3A_max_walk_time">max_walk_time</code></td>
<td>
<p>An integer. The maximum walking time (in minutes) to
access and egress the transit network, or to make transfers within the
network. Defaults to no restrictions, as long as <code>max_trip_duration</code> is
respected. The max time is considered separately for each leg (e.g. if
you set <code>max_walk_time</code> to 15, you could potentially walk up to 15 minutes
to reach transit, and up to <em>another</em> 15 minutes to reach the destination
after leaving transit). Defaults to <code>Inf</code>, no limit.</p>
</td></tr>
<tr><td><code id="detailed_itineraries_+3A_max_bike_time">max_bike_time</code></td>
<td>
<p>An integer. The maximum cycling time (in minutes) to
access and egress the transit network. Defaults to no restrictions, as long
as <code>max_trip_duration</code> is respected. The max time is considered separately
for each leg (e.g. if you set <code>max_bike_time</code> to 15 minutes, you could
potentially cycle up to 15 minutes to reach transit, and up to <em>another</em> 15
minutes to reach the destination after leaving transit). Defaults to <code>Inf</code>,
no limit.</p>
</td></tr>
<tr><td><code id="detailed_itineraries_+3A_max_car_time">max_car_time</code></td>
<td>
<p>An integer. The maximum driving time (in minutes) to
access and egress the transit network. Defaults to no restrictions, as long
as <code>max_trip_duration</code> is respected. The max time is considered separately
for each leg (e.g. if you set <code>max_car_time</code> to 15 minutes, you could
potentially drive up to 15 minutes to reach transit, and up to <em>another</em> 15
minutes to reach the destination after leaving transit). Defaults to <code>Inf</code>,
no limit.</p>
</td></tr>
<tr><td><code id="detailed_itineraries_+3A_max_trip_duration">max_trip_duration</code></td>
<td>
<p>An integer. The maximum trip duration in minutes.
Defaults to 120 minutes (2 hours).</p>
</td></tr>
<tr><td><code id="detailed_itineraries_+3A_walk_speed">walk_speed</code></td>
<td>
<p>A numeric. Average walk speed in km/h. Defaults to 3.6
km/h.</p>
</td></tr>
<tr><td><code id="detailed_itineraries_+3A_bike_speed">bike_speed</code></td>
<td>
<p>A numeric. Average cycling speed in km/h. Defaults to 12
km/h.</p>
</td></tr>
<tr><td><code id="detailed_itineraries_+3A_max_rides">max_rides</code></td>
<td>
<p>An integer. The maximum number of public transport rides
allowed in the same trip. Defaults to 3.</p>
</td></tr>
<tr><td><code id="detailed_itineraries_+3A_max_lts">max_lts</code></td>
<td>
<p>An integer between 1 and 4. The maximum level of traffic
stress that cyclists will tolerate. A value of 1 means cyclists will only
travel through the quietest streets, while a value of 4 indicates cyclists
can travel through any road. Defaults to 2. Please see details for more
information.</p>
</td></tr>
<tr><td><code id="detailed_itineraries_+3A_shortest_path">shortest_path</code></td>
<td>
<p>A logical. Whether the function should only return the
fastest itinerary between each origin and destination pair (the default)
or multiple alternatives.</p>
</td></tr>
<tr><td><code id="detailed_itineraries_+3A_all_to_all">all_to_all</code></td>
<td>
<p>A logical. Whether to query routes between the 1st origin
to the 1st destination, then the 2nd origin to the 2nd destination, and so
on (<code>FALSE</code>, the default) or to query routes between all origins to all
destinations (<code>TRUE</code>).</p>
</td></tr>
<tr><td><code id="detailed_itineraries_+3A_n_threads">n_threads</code></td>
<td>
<p>An integer. The number of threads to use when running the
router in parallel. Defaults to use all available threads (Inf).</p>
</td></tr>
<tr><td><code id="detailed_itineraries_+3A_verbose">verbose</code></td>
<td>
<p>A logical. Whether to show <code>R5</code> informative messages when
running the function. Defaults to <code>FALSE</code> (please note that in such case
<code>R5</code> error messages are still shown). Setting <code>verbose</code> to <code>TRUE</code> shows
detailed output, which can be useful for debugging issues not caught by
<code>r5r</code>.</p>
</td></tr>
<tr><td><code id="detailed_itineraries_+3A_progress">progress</code></td>
<td>
<p>A logical. Whether to show a progress counter when running
the router. Defaults to <code>FALSE</code>. Only works when <code>verbose</code> is set to
<code>FALSE</code>, so the progress counter does not interfere with <code>R5</code>'s output
messages. Setting <code>progress</code> to <code>TRUE</code> may impose a small penalty for
computation efficiency, because the progress counter must be synchronized
among all active threads.</p>
</td></tr>
<tr><td><code id="detailed_itineraries_+3A_drop_geometry">drop_geometry</code></td>
<td>
<p>A logical. Whether the output should include the
geometry of each trip leg or not. The default value of <code>FALSE</code> keeps the
geometry column in the result.</p>
</td></tr>
<tr><td><code id="detailed_itineraries_+3A_output_dir">output_dir</code></td>
<td>
<p>Either <code>NULL</code> or a path to an existing directory. When not
<code>NULL</code> (the default), the function will write one <code>.csv</code> file with the
results for each origin in the specified directory. In such case, the
function returns the path specified in this parameter. This parameter is
particularly useful when running estimates on memory-constrained settings,
because writing the results to disk prevents <code>r5r</code> from storing them in
memory.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>When <code>drop_geometry</code> is <code>FALSE</code>, the function outputs a <code style="white-space: pre;">&#8288;LINESTRING sf&#8288;</code> with detailed information on the itineraries between the specified
origins and destinations. When <code>TRUE</code>, the output is a <code>data.table</code>. All
distances are in meters and travel times are in minutes. If <code>output_dir</code>
is not <code>NULL</code>, the function returns the path specified in that parameter,
in which the <code>.csv</code> files containing the results are saved.
</p>


<h3>Transport modes</h3>

<p><code>R5</code> allows for multiple combinations of transport modes. The options
include:
</p>

<ul>
<li> <p><strong>Transit modes:</strong> <code>TRAM</code>, <code>SUBWAY</code>, <code>RAIL</code>, <code>BUS</code>, <code>FERRY</code>, <code>CABLE_CAR</code>,
<code>GONDOLA</code>, <code>FUNICULAR</code>. The option <code>TRANSIT</code> automatically considers all
public transport modes available.
</p>
</li>
<li> <p><strong>Non transit modes:</strong> <code>WALK</code>, <code>BICYCLE</code>, <code>CAR</code>, <code>BICYCLE_RENT</code>,
<code>CAR_PARK</code>.
</p>
</li></ul>



<h3>Level of Traffic Stress (LTS)</h3>

<p>When cycling is enabled in <code>R5</code> (by passing the value <code>BIKE</code> to either
<code>mode</code> or <code>mode_egress</code>), setting <code>max_lts</code> will allow cycling only on
streets with a given level of danger/stress. Setting <code>max_lts</code> to 1, for
example, will allow cycling only on separated bicycle infrastructure or
low-traffic streets and routing will revert to walking when traversing any
links with LTS exceeding 1. Setting <code>max_lts</code> to 3 will allow cycling on
links with LTS 1, 2 or 3. Routing also reverts to walking if the street
segment is tagged as non-bikable in OSM (e.g. a staircase), independently of
the specified max LTS.
</p>
<p>The default methodology for assigning LTS values to network edges is based
on commonly tagged attributes of OSM ways. See more info about LTS in the
original documentation of R5 from Conveyal at
<a href="https://docs.conveyal.com/learn-more/traffic-stress">https://docs.conveyal.com/learn-more/traffic-stress</a>. In summary:
</p>

<ul>
<li> <p><strong>LTS 1</strong>: Tolerable for children. This includes low-speed, low-volume
streets, as well as those with separated bicycle facilities (such as
parking-protected lanes or cycle tracks).
</p>
</li>
<li> <p><strong>LTS 2</strong>: Tolerable for the mainstream adult population. This includes
streets where cyclists have dedicated lanes and only have to interact with
traffic at formal crossing.
</p>
</li>
<li> <p><strong>LTS 3</strong>: Tolerable for &quot;enthused and confident&quot; cyclists. This includes
streets which may involve close proximity to moderate- or high-speed
vehicular traffic.
</p>
</li>
<li> <p><strong>LTS 4</strong>: Tolerable only for &quot;strong and fearless&quot; cyclists. This
includes streets where cyclists are required to mix with moderate- to
high-speed vehicular traffic.
</p>
</li></ul>

<p>For advanced users, you can provide custom LTS values by adding a tag <code style="white-space: pre;">&#8288;&lt;key = "lts"&gt;&#8288;</code> to the <code>osm.pbf</code> file.
</p>


<h3>Datetime parsing</h3>

<p><code>r5r</code> ignores the timezone attribute of datetime objects when parsing dates
and times, using the study area's timezone instead. For example, let's say
you are running some calculations using Rio de Janeiro, Brazil, as your study
area. The datetime <code>as.POSIXct("13-05-2019 14:00:00", format = "%d-%m-%Y %H:%M:%S")</code> will be parsed as May 13th, 2019, 14:00h in
Rio's local time, as expected. But <code>as.POSIXct("13-05-2019 14:00:00", format = "%d-%m-%Y %H:%M:%S", tz = "Europe/Paris")</code> will also be parsed as
the exact same date and time in Rio's local time, perhaps surprisingly,
ignoring the timezone attribute.
</p>


<h3>Routing algorithm</h3>

<p>The <code><a href="#topic+detailed_itineraries">detailed_itineraries()</a></code> and <code><a href="#topic+pareto_frontier">pareto_frontier()</a></code> functions use an
<code>R5</code>-specific extension to the McRAPTOR routing algorithm. The
implementation used in <code>detailed_itineraries()</code> allows the router to find
paths that are optimal and less than optimal in terms of travel time, with
some heuristics around multiple access modes, riding the same patterns, etc.
The specific extension to McRAPTOR to do suboptimal path routing is not
documented yet, but a detailed description of base McRAPTOR can be found in
Delling et al (2015). The implementation used in <code>pareto_frontier()</code>, on the
other hand, returns only the fastest trip within a given monetary cutoff,
ignoring slower trips that cost the same. A detailed discussion on the
algorithm can be found in Conway and Stewart (2019).
</p>

<ul>
<li><p> Delling, D., Pajor, T., &amp; Werneck, R. F. (2015). Round-based public
transit routing. Transportation Science, 49(3), 591-604.
<a href="https://doi.org/10.1287/trsc.2014.0534">doi:10.1287/trsc.2014.0534</a>
</p>
</li>
<li><p> Conway, M. W., &amp; Stewart, A. F. (2019). Getting Charlie off the MTA: a
multiobjective optimization method to account for cost constraints in public
transit accessibility metrics. International Journal of Geographical
Information Science, 33(9), 1759-1787. <a href="https://doi.org/10.1080/13658816.2019.1605075">doi:10.1080/13658816.2019.1605075</a>
</p>
</li></ul>



<h3>See Also</h3>

<p>Other routing: 
<code><a href="#topic+expanded_travel_time_matrix">expanded_travel_time_matrix</a>()</code>,
<code><a href="#topic+pareto_frontier">pareto_frontier</a>()</code>,
<code><a href="#topic+travel_time_matrix">travel_time_matrix</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(r5r)

# build transport network
data_path &lt;- system.file("extdata/poa", package = "r5r")
r5r_core &lt;- setup_r5(data_path)

# load origin/destination points
points &lt;- read.csv(file.path(data_path, "poa_points_of_interest.csv"))

# inputs
departure_datetime &lt;- as.POSIXct(
  "13-05-2019 14:00:00",
  format = "%d-%m-%Y %H:%M:%S"
)

det &lt;- detailed_itineraries(
  r5r_core,
  origins = points[10,],
  destinations = points[12,],
  mode = c("WALK", "TRANSIT"),
  departure_datetime = departure_datetime,
  max_trip_duration = 60
)
head(det)

stop_r5(r5r_core)

</code></pre>

<hr>
<h2 id='download_r5'>Download <code>R5.jar</code></h2><span id='topic+download_r5'></span>

<h3>Description</h3>

<p>Downloads <code>R5.jar</code> and saves it locally, inside the package directory.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>download_r5(
  version = "6.9.0",
  quiet = FALSE,
  force_update = FALSE,
  temp_dir = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="download_r5_+3A_version">version</code></td>
<td>
<p>A string. The version of R5 to be downloaded. Defaults to the
latest version.</p>
</td></tr>
<tr><td><code id="download_r5_+3A_quiet">quiet</code></td>
<td>
<p>A logical. Whether to show informative messages when downloading
the file. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="download_r5_+3A_force_update">force_update</code></td>
<td>
<p>A logical. Whether to overwrite a previously downloaded
<code>R5.jar</code> in the local directory. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="download_r5_+3A_temp_dir">temp_dir</code></td>
<td>
<p>A logical. Whether the file should be saved in a temporary
directory. Defaults to <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The path to the downloaded file.
</p>


<h3>See Also</h3>

<p>Other setup: 
<code><a href="#topic+setup_r5">setup_r5</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(r5r)

download_r5(version = "6.9.0", temp_dir = TRUE)

</code></pre>

<hr>
<h2 id='expand_od_pairs'>Expand origin-destination pairs</h2><span id='topic+expand_od_pairs'></span>

<h3>Description</h3>

<p>This function is used in <code><a href="#topic+detailed_itineraries">detailed_itineraries()</a></code> to update the <code>origins</code> and
<code>destinations</code> datasets.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expand_od_pairs(origins, destinations, all_to_all)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="expand_od_pairs_+3A_origins">origins</code></td>
<td>
<p>Passed by <code><a href="#topic+detailed_itineraries">detailed_itineraries()</a></code>.</p>
</td></tr>
<tr><td><code id="expand_od_pairs_+3A_destinations">destinations</code></td>
<td>
<p>Passed by <code><a href="#topic+detailed_itineraries">detailed_itineraries()</a></code>.</p>
</td></tr>
<tr><td><code id="expand_od_pairs_+3A_all_to_all">all_to_all</code></td>
<td>
<p>Passed by <code><a href="#topic+detailed_itineraries">detailed_itineraries()</a></code>.</p>
</td></tr>
</table>

<hr>
<h2 id='expanded_travel_time_matrix'>Calculate minute-by-minute travel times between origin destination pairs</h2><span id='topic+expanded_travel_time_matrix'></span>

<h3>Description</h3>

<p>Detailed computation of travel time estimates between one or multiple origin
destination pairs. Results show the travel time of the fastest route
alternative departing each minute within a specified time window. Please
note this function can be very memory intensive for large data sets and time
windows.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expanded_travel_time_matrix(
  r5r_core,
  origins,
  destinations,
  mode = "WALK",
  mode_egress = "WALK",
  departure_datetime = Sys.time(),
  time_window = 10L,
  breakdown = FALSE,
  max_walk_time = Inf,
  max_bike_time = Inf,
  max_car_time = Inf,
  max_trip_duration = 120L,
  walk_speed = 3.6,
  bike_speed = 12,
  max_rides = 3,
  max_lts = 2,
  draws_per_minute = 5L,
  n_threads = Inf,
  verbose = FALSE,
  progress = FALSE,
  output_dir = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="expanded_travel_time_matrix_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="expanded_travel_time_matrix_+3A_origins">origins</code>, <code id="expanded_travel_time_matrix_+3A_destinations">destinations</code></td>
<td>
<p>Either a <code style="white-space: pre;">&#8288;POINT sf&#8288;</code> object with WGS84 CRS, or a
<code>data.frame</code> containing the columns <code>id</code>, <code>lon</code> and <code>lat</code>.</p>
</td></tr>
<tr><td><code id="expanded_travel_time_matrix_+3A_mode">mode</code></td>
<td>
<p>A character vector. The transport modes allowed for access,
transfer and vehicle legs of the trips. Defaults to <code>WALK</code>. Please see
details for other options.</p>
</td></tr>
<tr><td><code id="expanded_travel_time_matrix_+3A_mode_egress">mode_egress</code></td>
<td>
<p>A character vector. The transport mode used after egress
from the last public transport. It can be either <code>WALK</code>, <code>BICYCLE</code> or
<code>CAR</code>. Defaults to <code>WALK</code>. Ignored when public transport is not used.</p>
</td></tr>
<tr><td><code id="expanded_travel_time_matrix_+3A_departure_datetime">departure_datetime</code></td>
<td>
<p>A POSIXct object. Please note that the departure
time only influences public transport legs. When working with public
transport networks, please check the <code>calendar.txt</code> within your GTFS feeds
for valid dates. Please see details for further information on how
datetimes are parsed.</p>
</td></tr>
<tr><td><code id="expanded_travel_time_matrix_+3A_time_window">time_window</code></td>
<td>
<p>An integer. The time window in minutes for which <code>r5r</code>
will calculate multiple travel time matrices departing each minute.
Defaults to 10 minutes. The function returns the result based on median
travel times. Please read the time window vignette for more details on its
usage <code>vignette("time_window", package = "r5r")</code></p>
</td></tr>
<tr><td><code id="expanded_travel_time_matrix_+3A_breakdown">breakdown</code></td>
<td>
<p>A logical. Whether to include detailed information about
each trip in the output. If <code>FALSE</code> (the default), the output lists the
total time between each origin-destination pair and the routes used to
complete the trip for each minute of the specified time window. If <code>TRUE</code>,
the output includes the total access, waiting, in-vehicle and transfer
time of each trip. Please note that setting this parameter to <code>TRUE</code> makes
the function significantly slower.</p>
</td></tr>
<tr><td><code id="expanded_travel_time_matrix_+3A_max_walk_time">max_walk_time</code></td>
<td>
<p>An integer. The maximum walking time (in minutes) to
access and egress the transit network, or to make transfers within the
network. Defaults to no restrictions, as long as <code>max_trip_duration</code> is
respected. The max time is considered separately for each leg (e.g. if
you set <code>max_walk_time</code> to 15, you could potentially walk up to 15 minutes
to reach transit, and up to <em>another</em> 15 minutes to reach the destination
after leaving transit). Defaults to <code>Inf</code>, no limit.</p>
</td></tr>
<tr><td><code id="expanded_travel_time_matrix_+3A_max_bike_time">max_bike_time</code></td>
<td>
<p>An integer. The maximum cycling time (in minutes) to
access and egress the transit network. Defaults to no restrictions, as long
as <code>max_trip_duration</code> is respected. The max time is considered separately
for each leg (e.g. if you set <code>max_bike_time</code> to 15 minutes, you could
potentially cycle up to 15 minutes to reach transit, and up to <em>another</em> 15
minutes to reach the destination after leaving transit). Defaults to <code>Inf</code>,
no limit.</p>
</td></tr>
<tr><td><code id="expanded_travel_time_matrix_+3A_max_car_time">max_car_time</code></td>
<td>
<p>An integer. The maximum driving time (in minutes) to
access and egress the transit network. Defaults to no restrictions, as long
as <code>max_trip_duration</code> is respected. The max time is considered separately
for each leg (e.g. if you set <code>max_car_time</code> to 15 minutes, you could
potentially drive up to 15 minutes to reach transit, and up to <em>another</em> 15
minutes to reach the destination after leaving transit). Defaults to <code>Inf</code>,
no limit.</p>
</td></tr>
<tr><td><code id="expanded_travel_time_matrix_+3A_max_trip_duration">max_trip_duration</code></td>
<td>
<p>An integer. The maximum trip duration in minutes.
Defaults to 120 minutes (2 hours).</p>
</td></tr>
<tr><td><code id="expanded_travel_time_matrix_+3A_walk_speed">walk_speed</code></td>
<td>
<p>A numeric. Average walk speed in km/h. Defaults to 3.6
km/h.</p>
</td></tr>
<tr><td><code id="expanded_travel_time_matrix_+3A_bike_speed">bike_speed</code></td>
<td>
<p>A numeric. Average cycling speed in km/h. Defaults to 12
km/h.</p>
</td></tr>
<tr><td><code id="expanded_travel_time_matrix_+3A_max_rides">max_rides</code></td>
<td>
<p>An integer. The maximum number of public transport rides
allowed in the same trip. Defaults to 3.</p>
</td></tr>
<tr><td><code id="expanded_travel_time_matrix_+3A_max_lts">max_lts</code></td>
<td>
<p>An integer between 1 and 4. The maximum level of traffic
stress that cyclists will tolerate. A value of 1 means cyclists will only
travel through the quietest streets, while a value of 4 indicates cyclists
can travel through any road. Defaults to 2. Please see details for more
information.</p>
</td></tr>
<tr><td><code id="expanded_travel_time_matrix_+3A_draws_per_minute">draws_per_minute</code></td>
<td>
<p>An integer. The number of Monte Carlo draws to
perform per time window minute when calculating travel time matrices and
when estimating accessibility. Defaults to 5. This would mean 300 draws in
a 60-minute time window, for example. This parameter only affects the
results when the GTFS feeds contain a <code>frequencies.txt</code> table.</p>
</td></tr>
<tr><td><code id="expanded_travel_time_matrix_+3A_n_threads">n_threads</code></td>
<td>
<p>An integer. The number of threads to use when running the
router in parallel. Defaults to use all available threads (Inf).</p>
</td></tr>
<tr><td><code id="expanded_travel_time_matrix_+3A_verbose">verbose</code></td>
<td>
<p>A logical. Whether to show <code>R5</code> informative messages when
running the function. Defaults to <code>FALSE</code> (please note that in such case
<code>R5</code> error messages are still shown). Setting <code>verbose</code> to <code>TRUE</code> shows
detailed output, which can be useful for debugging issues not caught by
<code>r5r</code>.</p>
</td></tr>
<tr><td><code id="expanded_travel_time_matrix_+3A_progress">progress</code></td>
<td>
<p>A logical. Whether to show a progress counter when running
the router. Defaults to <code>FALSE</code>. Only works when <code>verbose</code> is set to
<code>FALSE</code>, so the progress counter does not interfere with <code>R5</code>'s output
messages. Setting <code>progress</code> to <code>TRUE</code> may impose a small penalty for
computation efficiency, because the progress counter must be synchronized
among all active threads.</p>
</td></tr>
<tr><td><code id="expanded_travel_time_matrix_+3A_output_dir">output_dir</code></td>
<td>
<p>Either <code>NULL</code> or a path to an existing directory. When not
<code>NULL</code> (the default), the function will write one <code>.csv</code> file with the
results for each origin in the specified directory. In such case, the
function returns the path specified in this parameter. This parameter is
particularly useful when running estimates on memory-constrained settings,
because writing the results to disk prevents <code>r5r</code> from storing them in
memory.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>data.table</code> with travel time estimates (in minutes) and the
routes used in each trip between origin and destination pairs, for each
minute of the specified time window. Each set of origin, destination and
departure minute can appear up to N times, where N is the number of Monte
Carlo draws specified in the function arguments (please note that this
only applies when the GTFS feeds that describe the transit network include
a frequencies table, otherwise only a single draw is performed). A pair is
completely absent from the final output if no trips could be completed in
any of the minutes of the time window. If for a single pair trips could be
completed in some of the minutes of the time window, but not for all of
them, the minutes in which trips couldn't be completed will have <code>NA</code>
travel time and routes used. If <code>output_dir</code> is not <code>NULL</code>, the function
returns the path specified in that parameter, in which the <code>.csv</code> files
containing the results are saved.
</p>


<h3>Transport modes</h3>

<p><code>R5</code> allows for multiple combinations of transport modes. The options
include:
</p>

<ul>
<li> <p><strong>Transit modes:</strong> <code>TRAM</code>, <code>SUBWAY</code>, <code>RAIL</code>, <code>BUS</code>, <code>FERRY</code>, <code>CABLE_CAR</code>,
<code>GONDOLA</code>, <code>FUNICULAR</code>. The option <code>TRANSIT</code> automatically considers all
public transport modes available.
</p>
</li>
<li> <p><strong>Non transit modes:</strong> <code>WALK</code>, <code>BICYCLE</code>, <code>CAR</code>, <code>BICYCLE_RENT</code>,
<code>CAR_PARK</code>.
</p>
</li></ul>



<h3>Level of Traffic Stress (LTS)</h3>

<p>When cycling is enabled in <code>R5</code> (by passing the value <code>BIKE</code> to either
<code>mode</code> or <code>mode_egress</code>), setting <code>max_lts</code> will allow cycling only on
streets with a given level of danger/stress. Setting <code>max_lts</code> to 1, for
example, will allow cycling only on separated bicycle infrastructure or
low-traffic streets and routing will revert to walking when traversing any
links with LTS exceeding 1. Setting <code>max_lts</code> to 3 will allow cycling on
links with LTS 1, 2 or 3. Routing also reverts to walking if the street
segment is tagged as non-bikable in OSM (e.g. a staircase), independently of
the specified max LTS.
</p>
<p>The default methodology for assigning LTS values to network edges is based
on commonly tagged attributes of OSM ways. See more info about LTS in the
original documentation of R5 from Conveyal at
<a href="https://docs.conveyal.com/learn-more/traffic-stress">https://docs.conveyal.com/learn-more/traffic-stress</a>. In summary:
</p>

<ul>
<li> <p><strong>LTS 1</strong>: Tolerable for children. This includes low-speed, low-volume
streets, as well as those with separated bicycle facilities (such as
parking-protected lanes or cycle tracks).
</p>
</li>
<li> <p><strong>LTS 2</strong>: Tolerable for the mainstream adult population. This includes
streets where cyclists have dedicated lanes and only have to interact with
traffic at formal crossing.
</p>
</li>
<li> <p><strong>LTS 3</strong>: Tolerable for &quot;enthused and confident&quot; cyclists. This includes
streets which may involve close proximity to moderate- or high-speed
vehicular traffic.
</p>
</li>
<li> <p><strong>LTS 4</strong>: Tolerable only for &quot;strong and fearless&quot; cyclists. This
includes streets where cyclists are required to mix with moderate- to
high-speed vehicular traffic.
</p>
</li></ul>

<p>For advanced users, you can provide custom LTS values by adding a tag <code style="white-space: pre;">&#8288;&lt;key = "lts"&gt;&#8288;</code> to the <code>osm.pbf</code> file.
</p>


<h3>Datetime parsing</h3>

<p><code>r5r</code> ignores the timezone attribute of datetime objects when parsing dates
and times, using the study area's timezone instead. For example, let's say
you are running some calculations using Rio de Janeiro, Brazil, as your study
area. The datetime <code>as.POSIXct("13-05-2019 14:00:00", format = "%d-%m-%Y %H:%M:%S")</code> will be parsed as May 13th, 2019, 14:00h in
Rio's local time, as expected. But <code>as.POSIXct("13-05-2019 14:00:00", format = "%d-%m-%Y %H:%M:%S", tz = "Europe/Paris")</code> will also be parsed as
the exact same date and time in Rio's local time, perhaps surprisingly,
ignoring the timezone attribute.
</p>


<h3>Routing algorithm</h3>

<p>The <code><a href="#topic+travel_time_matrix">travel_time_matrix()</a></code>, <code><a href="#topic+expanded_travel_time_matrix">expanded_travel_time_matrix()</a></code> and
<code><a href="#topic+accessibility">accessibility()</a></code> functions use an <code>R5</code>-specific extension to the RAPTOR
routing algorithm (see Conway et al., 2017). This RAPTOR extension uses a
systematic sample of one departure per minute over the time window set by the
user in the 'time_window' parameter. A detailed description of base RAPTOR
can be found in Delling et al (2015). However, whenever the user includes
transit fares inputs to these functions, they automatically switch to use an
<code>R5</code>-specific extension to the McRAPTOR routing algorithm.
</p>

<ul>
<li><p> Conway, M. W., Byrd, A., &amp; van der Linden, M. (2017). Evidence-based
transit and land use sketch planning using interactive accessibility methods
on combined schedule and headway-based networks. Transportation Research
Record, 2653(1), 45-53. <a href="https://doi.org/10.3141/2653-06">doi:10.3141/2653-06</a>
</p>
</li>
<li><p> Delling, D., Pajor, T., &amp; Werneck, R. F. (2015). Round-based public
transit routing. Transportation Science, 49(3), 591-604.
<a href="https://doi.org/10.1287/trsc.2014.0534">doi:10.1287/trsc.2014.0534</a>
</p>
</li></ul>



<h3>See Also</h3>

<p>Other routing: 
<code><a href="#topic+detailed_itineraries">detailed_itineraries</a>()</code>,
<code><a href="#topic+pareto_frontier">pareto_frontier</a>()</code>,
<code><a href="#topic+travel_time_matrix">travel_time_matrix</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(r5r)

# build transport network
data_path &lt;- system.file("extdata/poa", package = "r5r")
r5r_core &lt;- setup_r5(data_path)

# load origin/destination points
points &lt;- read.csv(file.path(data_path, "poa_points_of_interest.csv"))

departure_datetime &lt;- as.POSIXct(
  "13-05-2019 14:00:00",
  format = "%d-%m-%Y %H:%M:%S"
)

# by default only returns the total time between each pair in each minute of
# the specified time window
ettm &lt;- expanded_travel_time_matrix(
  r5r_core,
  origins = points,
  destinations = points,
  mode = c("WALK", "TRANSIT"),
  time_window = 20,
  departure_datetime = departure_datetime,
  max_trip_duration = 60
)
head(ettm)

# when breakdown = TRUE the output contains much more information
ettm &lt;- expanded_travel_time_matrix(
  r5r_core,
  origins = points,
  destinations = points,
  mode = c("WALK", "TRANSIT"),
  time_window = 20,
  departure_datetime = departure_datetime,
  max_trip_duration = 60,
  breakdown = TRUE
)
head(ettm)

stop_r5(r5r_core)

</code></pre>

<hr>
<h2 id='fileurl_from_metadata'>Get most recent JAR file url from metadata</h2><span id='topic+fileurl_from_metadata'></span>

<h3>Description</h3>

<p>Returns the most recent JAR file url from metadata, depending on the version.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fileurl_from_metadata(version)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fileurl_from_metadata_+3A_version">version</code></td>
<td>
<p>A string, the version of R5's to get the filename of.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The a url a string.
</p>


<h3>See Also</h3>

<p>Other support functions: 
<code><a href="#topic+check_connection">check_connection</a>()</code>,
<code><a href="#topic+stop_r5">stop_r5</a>()</code>
</p>

<hr>
<h2 id='find_snap'>Find snapped locations of input points on street network</h2><span id='topic+find_snap'></span>

<h3>Description</h3>

<p>Finds the snapped location of points on <code>R5</code> network. Snapping is a very
important step of the routing process, which is when the origins and
destinations specified by the user are actually positioned on the network
created by <code>R5</code>. The snapping process in <code>R5</code> is composed of two rounds.
First, it tries to snap the points within a radius of 300 meters from
themselves. If the first round is unsuccessful, then <code>R5</code> expands the search
radius to 1.6 km. If yet again it is unsuccessful, then the unsnapped points
won't be used during the routing process. The snapped location of each point
depends on the transport mode set by the user, because some network edges
are not available to specific modes (e.g. a pedestrian-only street cannot be
used to snap car trips).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>find_snap(r5r_core, points, mode = "WALK")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="find_snap_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="find_snap_+3A_points">points</code></td>
<td>
<p>Either a <code style="white-space: pre;">&#8288;POINT sf&#8288;</code> object with WGS84 CRS, or a <code>data.frame</code>
containing the columns <code>id</code>, <code>lon</code> and <code>lat</code>.</p>
</td></tr>
<tr><td><code id="find_snap_+3A_mode">mode</code></td>
<td>
<p>A string. Which mode to consider when trying to snap the points
to the network. Defaults to <code>WALK</code>, also allows <code>BICYCLE</code> and <code>CAR</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>data.table</code> with the original points, their respective
snapped coordinates on the street network and the Euclidean distance ( in
meters) between the original points and their snapped location. Points that
could not be snapped show <code>NA</code> coordinates and <code>found = FALSE</code>.
</p>


<h3>See Also</h3>

<p>Other network functions: 
<code><a href="#topic+street_network_to_sf">street_network_to_sf</a>()</code>,
<code><a href="#topic+transit_network_to_sf">transit_network_to_sf</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(r5r)

path &lt;- system.file("extdata/poa", package = "r5r")
r5r_core &lt;- setup_r5(data_path = path)
points &lt;- read.csv(file.path(path, "poa_hexgrid.csv"))

snap_df &lt;- find_snap(r5r_core, points, mode = "WALK")

stop_r5(r5r_core)

</code></pre>

<hr>
<h2 id='isochrone'>Estimate isochrones from a given location</h2><span id='topic+isochrone'></span>

<h3>Description</h3>

<p>Fast computation of isochrones from a given location. The
function estimates isochrones based on the travel times from the trip origin
to all nodes in the road network.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>isochrone(
  r5r_core,
  origins,
  mode = "transit",
  mode_egress = "WALK",
  cutoffs = c(0, 15, 30),
  sample_size = 0.8,
  departure_datetime = Sys.time(),
  time_window = 10L,
  max_walk_time = Inf,
  max_bike_time = Inf,
  max_car_time = Inf,
  max_trip_duration = 120L,
  walk_speed = 3.6,
  bike_speed = 12,
  max_rides = 3,
  max_lts = 2,
  draws_per_minute = 5L,
  n_threads = Inf,
  verbose = FALSE,
  progress = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="isochrone_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="isochrone_+3A_origins">origins</code></td>
<td>
<p>Either a <code style="white-space: pre;">&#8288;POINT sf&#8288;</code> object with WGS84 CRS, or a
<code>data.frame</code> containing the columns <code>id</code>, <code>lon</code> and <code>lat</code>.</p>
</td></tr>
<tr><td><code id="isochrone_+3A_mode">mode</code></td>
<td>
<p>A character vector. The transport modes allowed for access,
transfer and vehicle legs of the trips. Defaults to <code>WALK</code>. Please see
details for other options.</p>
</td></tr>
<tr><td><code id="isochrone_+3A_mode_egress">mode_egress</code></td>
<td>
<p>A character vector. The transport mode used after egress
from the last public transport. It can be either <code>WALK</code>, <code>BICYCLE</code> or
<code>CAR</code>. Defaults to <code>WALK</code>. Ignored when public transport is not used.</p>
</td></tr>
<tr><td><code id="isochrone_+3A_cutoffs">cutoffs</code></td>
<td>
<p>numeric vector. Number of minutes to define the time span of
each Isochrone. Defaults to <code>c(0, 15, 30)</code>.</p>
</td></tr>
<tr><td><code id="isochrone_+3A_sample_size">sample_size</code></td>
<td>
<p>numeric. Sample size of nodes in the road network used to
estimate isochrones. Defaults to <code>0.8</code> (80% of all nodes in the
transport network). Value can range between <code>0.2</code> and <code>1</code>. Smaller
values increase computation speed but return results with lower
precision.</p>
</td></tr>
<tr><td><code id="isochrone_+3A_departure_datetime">departure_datetime</code></td>
<td>
<p>A POSIXct object. Please note that the departure
time only influences public transport legs. When working with public
transport networks, please check the <code>calendar.txt</code> within your GTFS
feeds for valid dates. Please see details for further information on
how datetimes are parsed.</p>
</td></tr>
<tr><td><code id="isochrone_+3A_time_window">time_window</code></td>
<td>
<p>An integer. The time window in minutes for which <code>r5r</code>
will calculate multiple travel time matrices departing each minute.
Defaults to 10 minutes. The function returns the result based on
median travel times. Please read the time window vignette for more
details on its usage <code>vignette("time_window", package = "r5r")</code></p>
</td></tr>
<tr><td><code id="isochrone_+3A_max_walk_time">max_walk_time</code></td>
<td>
<p>An integer. The maximum walking time (in minutes) to
access and egress the transit network, or to make transfers within the
network. Defaults to no restrictions, as long as <code>max_trip_duration</code>
is respected. The max time is considered separately for each leg (e.g.
if you set <code>max_walk_time</code> to 15, you could potentially walk up to 15
minutes to reach transit, and up to <em>another</em> 15 minutes to reach the
destination after leaving transit). Defaults to <code>Inf</code>, no limit.</p>
</td></tr>
<tr><td><code id="isochrone_+3A_max_bike_time">max_bike_time</code></td>
<td>
<p>An integer. The maximum cycling time (in minutes) to
access and egress the transit network. Defaults to no restrictions, as
long as <code>max_trip_duration</code> is respected. The max time is considered
separately for each leg (e.g. if you set <code>max_bike_time</code> to 15 minutes,
you could potentially cycle up to 15 minutes to reach transit, and up
to <em>another</em> 15 minutes to reach the destination after leaving
transit). Defaults to <code>Inf</code>, no limit.</p>
</td></tr>
<tr><td><code id="isochrone_+3A_max_car_time">max_car_time</code></td>
<td>
<p>An integer. The maximum driving time (in minutes) to
access and egress the transit network. Defaults to no restrictions, as
long as <code>max_trip_duration</code> is respected. The max time is considered
separately for each leg (e.g. if you set <code>max_car_time</code> to 15 minutes,
you could potentially drive up to 15 minutes to reach transit, and up
to <em>another</em> 15 minutes to reach the destination after leaving transit).
Defaults to <code>Inf</code>, no limit.</p>
</td></tr>
<tr><td><code id="isochrone_+3A_max_trip_duration">max_trip_duration</code></td>
<td>
<p>An integer. The maximum trip duration in minutes.
Defaults to 120 minutes (2 hours).</p>
</td></tr>
<tr><td><code id="isochrone_+3A_walk_speed">walk_speed</code></td>
<td>
<p>A numeric. Average walk speed in km/h. Defaults to 3.6 km/h.</p>
</td></tr>
<tr><td><code id="isochrone_+3A_bike_speed">bike_speed</code></td>
<td>
<p>A numeric. Average cycling speed in km/h. Defaults to 12 km/h.</p>
</td></tr>
<tr><td><code id="isochrone_+3A_max_rides">max_rides</code></td>
<td>
<p>An integer. The maximum number of public transport rides
allowed in the same trip. Defaults to 3.</p>
</td></tr>
<tr><td><code id="isochrone_+3A_max_lts">max_lts</code></td>
<td>
<p>An integer between 1 and 4. The maximum level of traffic
stress that cyclists will tolerate. A value of 1 means cyclists will
only travel through the quietest streets, while a value of 4 indicates
cyclists can travel through any road. Defaults to 2. Please see
details for more information.</p>
</td></tr>
<tr><td><code id="isochrone_+3A_draws_per_minute">draws_per_minute</code></td>
<td>
<p>An integer. The number of Monte Carlo draws to
perform per time window minute when calculating travel time matrices and
when estimating accessibility. Defaults to 5. This would mean 300 draws in
a 60-minute time window, for example. This parameter only affects the
results when the GTFS feeds contain a <code>frequencies.txt</code> table.</p>
</td></tr>
<tr><td><code id="isochrone_+3A_n_threads">n_threads</code></td>
<td>
<p>An integer. The number of threads to use when running the
router in parallel. Defaults to use all available threads (<code>Inf</code>).</p>
</td></tr>
<tr><td><code id="isochrone_+3A_verbose">verbose</code></td>
<td>
<p>A logical. Whether to show <code>R5</code> informative messages when
running the function. Defaults to <code>FALSE</code> (please note that in such case
<code>R5</code> error messages are still shown). Setting <code>verbose</code> to <code>TRUE</code> shows
detailed output, which can be useful for debugging issues not caught by
<code>r5r</code>.</p>
</td></tr>
<tr><td><code id="isochrone_+3A_progress">progress</code></td>
<td>
<p>A logical. Whether to show a progress counter when running
the router. Defaults to <code>FALSE</code>. Only works when <code>verbose</code> is set to
<code>FALSE</code>, so the progress counter does not interfere with <code>R5</code>'s output
messages. Setting <code>progress</code> to <code>TRUE</code> may impose a small penalty for
computation efficiency, because the progress counter must be
synchronized among all active threads.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code style="white-space: pre;">&#8288;POLYGON  "sf" "data.frame"&#8288;</code> for each isochrone of each origin.
</p>


<h3>Transport modes</h3>

<p><code>R5</code> allows for multiple combinations of transport modes. The options
include:
</p>

<ul>
<li> <p><strong>Transit modes:</strong> <code>TRAM</code>, <code>SUBWAY</code>, <code>RAIL</code>, <code>BUS</code>, <code>FERRY</code>, <code>CABLE_CAR</code>,
<code>GONDOLA</code>, <code>FUNICULAR</code>. The option <code>TRANSIT</code> automatically considers all
public transport modes available.
</p>
</li>
<li> <p><strong>Non transit modes:</strong> <code>WALK</code>, <code>BICYCLE</code>, <code>CAR</code>, <code>BICYCLE_RENT</code>,
<code>CAR_PARK</code>.
</p>
</li></ul>



<h3>Level of Traffic Stress (LTS)</h3>

<p>When cycling is enabled in <code>R5</code> (by passing the value <code>BIKE</code> to either
<code>mode</code> or <code>mode_egress</code>), setting <code>max_lts</code> will allow cycling only on
streets with a given level of danger/stress. Setting <code>max_lts</code> to 1, for
example, will allow cycling only on separated bicycle infrastructure or
low-traffic streets and routing will revert to walking when traversing any
links with LTS exceeding 1. Setting <code>max_lts</code> to 3 will allow cycling on
links with LTS 1, 2 or 3. Routing also reverts to walking if the street
segment is tagged as non-bikable in OSM (e.g. a staircase), independently of
the specified max LTS.
</p>
<p>The default methodology for assigning LTS values to network edges is based
on commonly tagged attributes of OSM ways. See more info about LTS in the
original documentation of R5 from Conveyal at
<a href="https://docs.conveyal.com/learn-more/traffic-stress">https://docs.conveyal.com/learn-more/traffic-stress</a>. In summary:
</p>

<ul>
<li> <p><strong>LTS 1</strong>: Tolerable for children. This includes low-speed, low-volume
streets, as well as those with separated bicycle facilities (such as
parking-protected lanes or cycle tracks).
</p>
</li>
<li> <p><strong>LTS 2</strong>: Tolerable for the mainstream adult population. This includes
streets where cyclists have dedicated lanes and only have to interact with
traffic at formal crossing.
</p>
</li>
<li> <p><strong>LTS 3</strong>: Tolerable for &quot;enthused and confident&quot; cyclists. This includes
streets which may involve close proximity to moderate- or high-speed
vehicular traffic.
</p>
</li>
<li> <p><strong>LTS 4</strong>: Tolerable only for &quot;strong and fearless&quot; cyclists. This
includes streets where cyclists are required to mix with moderate- to
high-speed vehicular traffic.
</p>
</li></ul>

<p>For advanced users, you can provide custom LTS values by adding a tag <code style="white-space: pre;">&#8288;&lt;key = "lts"&gt;&#8288;</code> to the <code>osm.pbf</code> file.
</p>


<h3>Datetime parsing</h3>

<p><code>r5r</code> ignores the timezone attribute of datetime objects when parsing dates
and times, using the study area's timezone instead. For example, let's say
you are running some calculations using Rio de Janeiro, Brazil, as your study
area. The datetime <code>as.POSIXct("13-05-2019 14:00:00", format = "%d-%m-%Y %H:%M:%S")</code> will be parsed as May 13th, 2019, 14:00h in
Rio's local time, as expected. But <code>as.POSIXct("13-05-2019 14:00:00", format = "%d-%m-%Y %H:%M:%S", tz = "Europe/Paris")</code> will also be parsed as
the exact same date and time in Rio's local time, perhaps surprisingly,
ignoring the timezone attribute.
</p>


<h3>Routing algorithm</h3>

<p>The <code><a href="#topic+travel_time_matrix">travel_time_matrix()</a></code>, <code><a href="#topic+expanded_travel_time_matrix">expanded_travel_time_matrix()</a></code> and
<code><a href="#topic+accessibility">accessibility()</a></code> functions use an <code>R5</code>-specific extension to the RAPTOR
routing algorithm (see Conway et al., 2017). This RAPTOR extension uses a
systematic sample of one departure per minute over the time window set by the
user in the 'time_window' parameter. A detailed description of base RAPTOR
can be found in Delling et al (2015). However, whenever the user includes
transit fares inputs to these functions, they automatically switch to use an
<code>R5</code>-specific extension to the McRAPTOR routing algorithm.
</p>

<ul>
<li><p> Conway, M. W., Byrd, A., &amp; van der Linden, M. (2017). Evidence-based
transit and land use sketch planning using interactive accessibility methods
on combined schedule and headway-based networks. Transportation Research
Record, 2653(1), 45-53. <a href="https://doi.org/10.3141/2653-06">doi:10.3141/2653-06</a>
</p>
</li>
<li><p> Delling, D., Pajor, T., &amp; Werneck, R. F. (2015). Round-based public
transit routing. Transportation Science, 49(3), 591-604.
<a href="https://doi.org/10.1287/trsc.2014.0534">doi:10.1287/trsc.2014.0534</a>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
options(java.parameters = "-Xmx2G")
library(r5r)

# build transport network
data_path &lt;- system.file("extdata/poa", package = "r5r")
r5r_core &lt;- setup_r5(data_path = data_path)

# load origin/point of interest
points &lt;- read.csv(file.path(data_path, "poa_hexgrid.csv"))
origin_1 &lt;- points[936,]

departure_datetime &lt;- as.POSIXct(
  "13-05-2019 14:00:00",
  format = "%d-%m-%Y %H:%M:%S"
)

# estimate isochrone from origin_1
iso1 &lt;- isochrone(r5r_core,
                origin = origin_1,
                mode = c("walk"),
                departure_datetime = departure_datetime,
                cutoffs = seq(0, 100, 10)
                )
head(iso1)

colors &lt;- c('#ffe0a5','#ffcb69','#ffa600','#ff7c43','#f95d6a',
           '#d45087','#a05195','#665191','#2f4b7c','#003f5c')
plot(iso1['isochrone'], col = colors)

stop_r5(r5r_core)

</code></pre>

<hr>
<h2 id='java_to_dt'>Java object to data.table</h2><span id='topic+java_to_dt'></span>

<h3>Description</h3>

<p>Converts a Java object returned by r5r_core to an R data.table
</p>


<h3>Usage</h3>

<pre><code class='language-R'>java_to_dt(obj)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="java_to_dt_+3A_obj">obj</code></td>
<td>
<p>A Java Object reference</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An R data.table
</p>

<hr>
<h2 id='pareto_frontier'>Calculate travel time and monetary cost Pareto frontier</h2><span id='topic+pareto_frontier'></span>

<h3>Description</h3>

<p>Fast computation of travel time and monetary cost Pareto frontier between
origin and destination pairs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pareto_frontier(
  r5r_core,
  origins,
  destinations,
  mode = c("WALK", "TRANSIT"),
  mode_egress = "WALK",
  departure_datetime = Sys.time(),
  time_window = 10L,
  percentiles = 50L,
  max_walk_time = Inf,
  max_bike_time = Inf,
  max_car_time = Inf,
  max_trip_duration = 120L,
  fare_structure = NULL,
  fare_cutoffs = -1L,
  walk_speed = 3.6,
  bike_speed = 12,
  max_rides = 3,
  max_lts = 2,
  n_threads = Inf,
  verbose = FALSE,
  progress = FALSE,
  output_dir = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pareto_frontier_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="pareto_frontier_+3A_origins">origins</code>, <code id="pareto_frontier_+3A_destinations">destinations</code></td>
<td>
<p>Either a <code style="white-space: pre;">&#8288;POINT sf&#8288;</code> object with WGS84 CRS, or a
<code>data.frame</code> containing the columns <code>id</code>, <code>lon</code> and <code>lat</code>.</p>
</td></tr>
<tr><td><code id="pareto_frontier_+3A_mode">mode</code></td>
<td>
<p>A character vector. The transport modes allowed for access,
transfer and vehicle legs of the trips. Defaults to <code>WALK</code>. Please see
details for other options.</p>
</td></tr>
<tr><td><code id="pareto_frontier_+3A_mode_egress">mode_egress</code></td>
<td>
<p>A character vector. The transport mode used after egress
from the last public transport. It can be either <code>WALK</code>, <code>BICYCLE</code> or
<code>CAR</code>. Defaults to <code>WALK</code>. Ignored when public transport is not used.</p>
</td></tr>
<tr><td><code id="pareto_frontier_+3A_departure_datetime">departure_datetime</code></td>
<td>
<p>A POSIXct object. Please note that the departure
time only influences public transport legs. When working with public
transport networks, please check the <code>calendar.txt</code> within your GTFS feeds
for valid dates. Please see details for further information on how
datetimes are parsed.</p>
</td></tr>
<tr><td><code id="pareto_frontier_+3A_time_window">time_window</code></td>
<td>
<p>An integer. The time window in minutes for which <code>r5r</code>
will calculate multiple travel time matrices departing each minute.
Defaults to 10 minutes. By default, the function returns the result based
on median travel times, but the user can set the <code>percentiles</code> parameter to
extract more results. Please read the time window vignette for more details
on its usage <code>vignette("time_window", package = "r5r")</code></p>
</td></tr>
<tr><td><code id="pareto_frontier_+3A_percentiles">percentiles</code></td>
<td>
<p>An integer vector (max length of 5). Specifies the
percentile to use when returning travel time estimates within the given
time window. Please note that this parameter is applied to the travel time
estimates only (e.g. if the 25th percentile is specified, and the output
between A and B is 15 minutes and 10 dollars, 25% of all trips cheaper
than 10 dollars taken between these points are shorter than 15 minutes).
Defaults to 50, returning the median travel time. If a vector with length
bigger than 1 is passed, the output contains an additional column that
specifies the percentile of each travel time and monetary cost
combination. Due to upstream restrictions, only 5 percentiles can be
specified at a time. For more details, please see R5 documentation at
<a href="https://docs.conveyal.com/analysis/methodology#accounting-for-variability">https://docs.conveyal.com/analysis/methodology#accounting-for-variability</a>.</p>
</td></tr>
<tr><td><code id="pareto_frontier_+3A_max_walk_time">max_walk_time</code></td>
<td>
<p>An integer. The maximum walking time (in minutes) to
access and egress the transit network, or to make transfers within the
network. Defaults to no restrictions, as long as <code>max_trip_duration</code> is
respected. The max time is considered separately for each leg (e.g. if
you set <code>max_walk_time</code> to 15, you could potentially walk up to 15 minutes
to reach transit, and up to <em>another</em> 15 minutes to reach the destination
after leaving transit). Defaults to <code>Inf</code>, no limit.</p>
</td></tr>
<tr><td><code id="pareto_frontier_+3A_max_bike_time">max_bike_time</code></td>
<td>
<p>An integer. The maximum cycling time (in minutes) to
access and egress the transit network. Defaults to no restrictions, as long
as <code>max_trip_duration</code> is respected. The max time is considered separately
for each leg (e.g. if you set <code>max_bike_time</code> to 15 minutes, you could
potentially cycle up to 15 minutes to reach transit, and up to <em>another</em> 15
minutes to reach the destination after leaving transit). Defaults to <code>Inf</code>,
no limit.</p>
</td></tr>
<tr><td><code id="pareto_frontier_+3A_max_car_time">max_car_time</code></td>
<td>
<p>An integer. The maximum driving time (in minutes) to
access and egress the transit network. Defaults to no restrictions, as long
as <code>max_trip_duration</code> is respected. The max time is considered separately
for each leg (e.g. if you set <code>max_car_time</code> to 15 minutes, you could
potentially drive up to 15 minutes to reach transit, and up to <em>another</em> 15
minutes to reach the destination after leaving transit). Defaults to <code>Inf</code>,
no limit.</p>
</td></tr>
<tr><td><code id="pareto_frontier_+3A_max_trip_duration">max_trip_duration</code></td>
<td>
<p>An integer. The maximum trip duration in minutes.
Defaults to 120 minutes (2 hours).</p>
</td></tr>
<tr><td><code id="pareto_frontier_+3A_fare_structure">fare_structure</code></td>
<td>
<p>A fare structure object, following the convention
set in <code><a href="#topic+setup_fare_structure">setup_fare_structure()</a></code>. This object describes how transit fares
should be calculated. Please see the fare structure vignette to
understand how this object is structured:
<code>vignette("fare_structure", package = "r5r")</code>.</p>
</td></tr>
<tr><td><code id="pareto_frontier_+3A_fare_cutoffs">fare_cutoffs</code></td>
<td>
<p>A numeric vector. The monetary cutoffs that
should be considered when calculating the Pareto frontier. Most of the
time you'll want this parameter to be the combination of all possible
fares listed in you <code>fare_structure</code>. Choosing a coarse distribution of
cutoffs may result in many different trips falling within the same cutoff.
For example, if you have two different routes in your GTFS, one costing $3
and the other costing $4, and you set this parameter to <code>5</code>, the output
will tell you the fastest trips that costed up to $5, but you won't be
able to identify which route was used to complete such trips. In this
case, it would be more beneficial to set the parameter as <code>c(3, 4)</code> (you
could also specify combinations of such values, such as 6, 7, 8 and so on,
because a transit user could hypothetically benefit from making transfers
between the available routes).</p>
</td></tr>
<tr><td><code id="pareto_frontier_+3A_walk_speed">walk_speed</code></td>
<td>
<p>A numeric. Average walk speed in km/h. Defaults to 3.6
km/h.</p>
</td></tr>
<tr><td><code id="pareto_frontier_+3A_bike_speed">bike_speed</code></td>
<td>
<p>A numeric. Average cycling speed in km/h. Defaults to 12
km/h.</p>
</td></tr>
<tr><td><code id="pareto_frontier_+3A_max_rides">max_rides</code></td>
<td>
<p>An integer. The maximum number of public transport rides
allowed in the same trip. Defaults to 3.</p>
</td></tr>
<tr><td><code id="pareto_frontier_+3A_max_lts">max_lts</code></td>
<td>
<p>An integer between 1 and 4. The maximum level of traffic
stress that cyclists will tolerate. A value of 1 means cyclists will only
travel through the quietest streets, while a value of 4 indicates cyclists
can travel through any road. Defaults to 2. Please see details for more
information.</p>
</td></tr>
<tr><td><code id="pareto_frontier_+3A_n_threads">n_threads</code></td>
<td>
<p>An integer. The number of threads to use when running the
router in parallel. Defaults to use all available threads (Inf).</p>
</td></tr>
<tr><td><code id="pareto_frontier_+3A_verbose">verbose</code></td>
<td>
<p>A logical. Whether to show <code>R5</code> informative messages when
running the function. Defaults to <code>FALSE</code> (please note that in such case
<code>R5</code> error messages are still shown). Setting <code>verbose</code> to <code>TRUE</code> shows
detailed output, which can be useful for debugging issues not caught by
<code>r5r</code>.</p>
</td></tr>
<tr><td><code id="pareto_frontier_+3A_progress">progress</code></td>
<td>
<p>A logical. Whether to show a progress counter when running
the router. Defaults to <code>FALSE</code>. Only works when <code>verbose</code> is set to
<code>FALSE</code>, so the progress counter does not interfere with <code>R5</code>'s output
messages. Setting <code>progress</code> to <code>TRUE</code> may impose a small penalty for
computation efficiency, because the progress counter must be synchronized
among all active threads.</p>
</td></tr>
<tr><td><code id="pareto_frontier_+3A_output_dir">output_dir</code></td>
<td>
<p>Either <code>NULL</code> or a path to an existing directory. When not
<code>NULL</code> (the default), the function will write one <code>.csv</code> file with the
results for each origin in the specified directory. In such case, the
function returns the path specified in this parameter. This parameter is
particularly useful when running estimates on memory-constrained settings,
because writing the results to disk prevents <code>r5r</code> from storing them in
memory.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>data.table</code> with the travel time and monetary cost Pareto frontier
between the specified origins and destinations. An additional column
identifying the travel time percentile is present if more than one value
was passed to <code>percentiles</code>. Origin and destination pairs whose trips
couldn't be completed within the maximum travel time using less money than
the specified monetary cutoffs are not returned in the <code>data.table</code>. If
<code>output_dir</code> is not <code>NULL</code>, the function returns the path specified in
that parameter, in which the <code>.csv</code> files containing the results are
saved.
</p>


<h3>Transport modes</h3>

<p><code>R5</code> allows for multiple combinations of transport modes. The options
include:
</p>

<ul>
<li> <p><strong>Transit modes:</strong> <code>TRAM</code>, <code>SUBWAY</code>, <code>RAIL</code>, <code>BUS</code>, <code>FERRY</code>, <code>CABLE_CAR</code>,
<code>GONDOLA</code>, <code>FUNICULAR</code>. The option <code>TRANSIT</code> automatically considers all
public transport modes available.
</p>
</li>
<li> <p><strong>Non transit modes:</strong> <code>WALK</code>, <code>BICYCLE</code>, <code>CAR</code>, <code>BICYCLE_RENT</code>,
<code>CAR_PARK</code>.
</p>
</li></ul>



<h3>Level of Traffic Stress (LTS)</h3>

<p>When cycling is enabled in <code>R5</code> (by passing the value <code>BIKE</code> to either
<code>mode</code> or <code>mode_egress</code>), setting <code>max_lts</code> will allow cycling only on
streets with a given level of danger/stress. Setting <code>max_lts</code> to 1, for
example, will allow cycling only on separated bicycle infrastructure or
low-traffic streets and routing will revert to walking when traversing any
links with LTS exceeding 1. Setting <code>max_lts</code> to 3 will allow cycling on
links with LTS 1, 2 or 3. Routing also reverts to walking if the street
segment is tagged as non-bikable in OSM (e.g. a staircase), independently of
the specified max LTS.
</p>
<p>The default methodology for assigning LTS values to network edges is based
on commonly tagged attributes of OSM ways. See more info about LTS in the
original documentation of R5 from Conveyal at
<a href="https://docs.conveyal.com/learn-more/traffic-stress">https://docs.conveyal.com/learn-more/traffic-stress</a>. In summary:
</p>

<ul>
<li> <p><strong>LTS 1</strong>: Tolerable for children. This includes low-speed, low-volume
streets, as well as those with separated bicycle facilities (such as
parking-protected lanes or cycle tracks).
</p>
</li>
<li> <p><strong>LTS 2</strong>: Tolerable for the mainstream adult population. This includes
streets where cyclists have dedicated lanes and only have to interact with
traffic at formal crossing.
</p>
</li>
<li> <p><strong>LTS 3</strong>: Tolerable for &quot;enthused and confident&quot; cyclists. This includes
streets which may involve close proximity to moderate- or high-speed
vehicular traffic.
</p>
</li>
<li> <p><strong>LTS 4</strong>: Tolerable only for &quot;strong and fearless&quot; cyclists. This
includes streets where cyclists are required to mix with moderate- to
high-speed vehicular traffic.
</p>
</li></ul>

<p>For advanced users, you can provide custom LTS values by adding a tag <code style="white-space: pre;">&#8288;&lt;key = "lts"&gt;&#8288;</code> to the <code>osm.pbf</code> file.
</p>


<h3>Datetime parsing</h3>

<p><code>r5r</code> ignores the timezone attribute of datetime objects when parsing dates
and times, using the study area's timezone instead. For example, let's say
you are running some calculations using Rio de Janeiro, Brazil, as your study
area. The datetime <code>as.POSIXct("13-05-2019 14:00:00", format = "%d-%m-%Y %H:%M:%S")</code> will be parsed as May 13th, 2019, 14:00h in
Rio's local time, as expected. But <code>as.POSIXct("13-05-2019 14:00:00", format = "%d-%m-%Y %H:%M:%S", tz = "Europe/Paris")</code> will also be parsed as
the exact same date and time in Rio's local time, perhaps surprisingly,
ignoring the timezone attribute.
</p>


<h3>Routing algorithm</h3>

<p>The <code><a href="#topic+detailed_itineraries">detailed_itineraries()</a></code> and <code><a href="#topic+pareto_frontier">pareto_frontier()</a></code> functions use an
<code>R5</code>-specific extension to the McRAPTOR routing algorithm. The
implementation used in <code>detailed_itineraries()</code> allows the router to find
paths that are optimal and less than optimal in terms of travel time, with
some heuristics around multiple access modes, riding the same patterns, etc.
The specific extension to McRAPTOR to do suboptimal path routing is not
documented yet, but a detailed description of base McRAPTOR can be found in
Delling et al (2015). The implementation used in <code>pareto_frontier()</code>, on the
other hand, returns only the fastest trip within a given monetary cutoff,
ignoring slower trips that cost the same. A detailed discussion on the
algorithm can be found in Conway and Stewart (2019).
</p>

<ul>
<li><p> Delling, D., Pajor, T., &amp; Werneck, R. F. (2015). Round-based public
transit routing. Transportation Science, 49(3), 591-604.
<a href="https://doi.org/10.1287/trsc.2014.0534">doi:10.1287/trsc.2014.0534</a>
</p>
</li>
<li><p> Conway, M. W., &amp; Stewart, A. F. (2019). Getting Charlie off the MTA: a
multiobjective optimization method to account for cost constraints in public
transit accessibility metrics. International Journal of Geographical
Information Science, 33(9), 1759-1787. <a href="https://doi.org/10.1080/13658816.2019.1605075">doi:10.1080/13658816.2019.1605075</a>
</p>
</li></ul>



<h3>See Also</h3>

<p>Other routing: 
<code><a href="#topic+detailed_itineraries">detailed_itineraries</a>()</code>,
<code><a href="#topic+expanded_travel_time_matrix">expanded_travel_time_matrix</a>()</code>,
<code><a href="#topic+travel_time_matrix">travel_time_matrix</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(r5r)

# build transport network
data_path &lt;- system.file("extdata/poa", package = "r5r")
r5r_core &lt;- setup_r5(data_path = data_path)

# load origin/destination points
points &lt;- read.csv(file.path(data_path, "poa_hexgrid.csv"))[1:5,]

# load fare structure object
fare_structure_path &lt;- system.file(
  "extdata/poa/fares/fares_poa.zip",
  package = "r5r"
)
fare_structure &lt;- read_fare_structure(fare_structure_path)

departure_datetime &lt;- as.POSIXct(
  "13-05-2019 14:00:00",
  format = "%d-%m-%Y %H:%M:%S"
)

pf &lt;- pareto_frontier(
  r5r_core,
  origins = points,
  destinations = points,
  mode = c("WALK", "TRANSIT"),
  departure_datetime = departure_datetime,
  fare_structure = fare_structure,
  fare_cutoffs = c(4.5, 4.8, 9, 9.3, 9.6)
)
head(pf)

stop_r5(r5r_core)

</code></pre>

<hr>
<h2 id='r5r'>r5r: Rapid Realistic Routing with 'R5'</h2><span id='topic+r5r'></span><span id='topic+_PACKAGE'></span><span id='topic+r5r-package'></span>

<h3>Description</h3>

<p>Rapid realistic routing on multimodal transport networks (walk, bike, public
transport and car) using <code>R5</code>, the Rapid Realistic Routing on Real-world and
Reimagined networks engine <a href="https://github.com/conveyal/r5">https://github.com/conveyal/r5</a>. The package
allows users to generate detailed routing analysis or calculate travel time
matrices using seamless parallel computing on top of the R5 Java machine.
While <code>R5</code> is developed by Conveyal, the package <code>r5r</code> is independently
developed by a team at the Institute for Applied Economic Research (Ipea)
with contributions from collaborators. Apart from the documentation in this
package, users will find additional information on <code>R5</code> documentation at
<a href="https://docs.conveyal.com/">https://docs.conveyal.com/</a>. Although we try to keep new releases of <code>r5r</code>
in synchrony with <code>R5</code>, the development of <code>R5</code> follows Conveyal's
independent update process. Hence, users should confirm if the <code>R5</code> version
implied by the Conveyal user manual (see
<a href="https://docs.conveyal.com/changelog">https://docs.conveyal.com/changelog</a>) corresponds with the <code>R5</code> version
that <code>r5r</code> depends on.
</p>


<h3>Usage</h3>

<p>Please check the vignettes on the <a href="https://ipeagit.github.io/r5r/">website</a>.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Rafael H. M. Pereira <a href="mailto:rafa.pereira.br@gmail.com">rafa.pereira.br@gmail.com</a> (<a href="https://orcid.org/0000-0003-2125-7465">ORCID</a>)
</p>
<p>Authors:
</p>

<ul>
<li><p> Marcus Saraiva <a href="mailto:marcus.saraiva@gmail.com">marcus.saraiva@gmail.com</a> (<a href="https://orcid.org/0000-0001-6218-2338">ORCID</a>)
</p>
</li>
<li><p> Daniel Herszenhut <a href="mailto:dhersz@gmail.com">dhersz@gmail.com</a> (<a href="https://orcid.org/0000-0001-8066-1105">ORCID</a>)
</p>
</li>
<li><p> Carlos Kaue Vieira Braga <a href="mailto:kaue@kauebraga.dev">kaue@kauebraga.dev</a> (<a href="https://orcid.org/0000-0002-6104-7297">ORCID</a>)
</p>
</li>
<li><p> Matthew Wigginton Conway <a href="mailto:mwconway@asu.edu">mwconway@asu.edu</a> (<a href="https://orcid.org/0000-0002-1210-2982">ORCID</a>)
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> Ipea - Institute for Applied Economic Research [copyright holder, funder]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/ipeaGIT/r5r">https://github.com/ipeaGIT/r5r</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/ipeaGIT/r5r/issues">https://github.com/ipeaGIT/r5r/issues</a>
</p>
</li></ul>


<hr>
<h2 id='r5r_sitrep'>Generate an r5r situation report to help debug errors</h2><span id='topic+r5r_sitrep'></span>

<h3>Description</h3>

<p>The function reports a list with the following information:
</p>

<ul>
<li><p> The package version of <code>{r5r}</code> in use.
</p>
</li>
<li><p> The installed version of <code>R5.jar</code>.
</p>
</li>
<li><p> The Java version in use.
</p>
</li>
<li><p> The amount of memory set to Java through the <code>java.parameters</code> option.
</p>
</li>
<li><p> The user's Session Info.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>r5r_sitrep()
</code></pre>


<h3>Value</h3>

<p>A <code>list</code> with information of the versions of the r5r package, Java
and R5 Jar in use, the memory set to Java and user's Session Info.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
r5r_sitrep()

</code></pre>

<hr>
<h2 id='read_fare_structure'>Read a fare structure object from a file</h2><span id='topic+read_fare_structure'></span>

<h3>Description</h3>

<p>Read a fare structure object from a file
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_fare_structure(file_path, encoding = "UTF-8")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="read_fare_structure_+3A_file_path">file_path</code></td>
<td>
<p>A path pointing to a fare structure with a <code>.zip</code>
extension.</p>
</td></tr>
<tr><td><code id="read_fare_structure_+3A_encoding">encoding</code></td>
<td>
<p>A string. Passed to <code><a href="data.table.html#topic+fread">data.table::fread()</a></code>, defaults to
<code>"UTF-8"</code>. Other possible options are <code>"unknown"</code> and <code>"Latin-1"</code>. Please
note that this is not used to re-encode the input, but to enable handling
encoded strings in their native encoding.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A fare structure object.
</p>


<h3>See Also</h3>

<p>Other fare structure: 
<code><a href="#topic+setup_fare_structure">setup_fare_structure</a>()</code>,
<code><a href="#topic+write_fare_structure">write_fare_structure</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
path &lt;- system.file("extdata/poa/fares/fares_poa.zip", package = "r5r")
fare_structure &lt;- read_fare_structure(path)

</code></pre>

<hr>
<h2 id='set_breakdown'>Set breakdown</h2><span id='topic+set_breakdown'></span>

<h3>Description</h3>

<p>Sets whether travel time matrices should include detailed trip information or
not.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_breakdown(r5r_core, breakdown)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_breakdown_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="set_breakdown_+3A_breakdown">breakdown</code></td>
<td>
<p>A logical.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisibly returns <code>TRUE</code>.
</p>


<h3>See Also</h3>

<p>Other setting functions: 
<code><a href="#topic+set_cutoffs">set_cutoffs</a>()</code>,
<code><a href="#topic+set_expanded_travel_times">set_expanded_travel_times</a>()</code>,
<code><a href="#topic+set_fare_cutoffs">set_fare_cutoffs</a>()</code>,
<code><a href="#topic+set_fare_structure">set_fare_structure</a>()</code>,
<code><a href="#topic+set_max_fare">set_max_fare</a>()</code>,
<code><a href="#topic+set_max_lts">set_max_lts</a>()</code>,
<code><a href="#topic+set_max_rides">set_max_rides</a>()</code>,
<code><a href="#topic+set_monte_carlo_draws">set_monte_carlo_draws</a>()</code>,
<code><a href="#topic+set_n_threads">set_n_threads</a>()</code>,
<code><a href="#topic+set_output_dir">set_output_dir</a>()</code>,
<code><a href="#topic+set_percentiles">set_percentiles</a>()</code>,
<code><a href="#topic+set_progress">set_progress</a>()</code>,
<code><a href="#topic+set_speed">set_speed</a>()</code>,
<code><a href="#topic+set_suboptimal_minutes">set_suboptimal_minutes</a>()</code>,
<code><a href="#topic+set_time_window">set_time_window</a>()</code>,
<code><a href="#topic+set_verbose">set_verbose</a>()</code>
</p>

<hr>
<h2 id='set_cutoffs'>Set cutoffs</h2><span id='topic+set_cutoffs'></span>

<h3>Description</h3>

<p>Sets the cutoffs used when calculating accessibility.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_cutoffs(r5r_core, cutoffs, decay_function)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_cutoffs_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="set_cutoffs_+3A_cutoffs">cutoffs</code></td>
<td>
<p>A numeric vector.</p>
</td></tr>
<tr><td><code id="set_cutoffs_+3A_decay_function">decay_function</code></td>
<td>
<p>A string, the name of the decay function.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisibly returns <code>TRUE</code>.
</p>


<h3>See Also</h3>

<p>Other setting functions: 
<code><a href="#topic+set_breakdown">set_breakdown</a>()</code>,
<code><a href="#topic+set_expanded_travel_times">set_expanded_travel_times</a>()</code>,
<code><a href="#topic+set_fare_cutoffs">set_fare_cutoffs</a>()</code>,
<code><a href="#topic+set_fare_structure">set_fare_structure</a>()</code>,
<code><a href="#topic+set_max_fare">set_max_fare</a>()</code>,
<code><a href="#topic+set_max_lts">set_max_lts</a>()</code>,
<code><a href="#topic+set_max_rides">set_max_rides</a>()</code>,
<code><a href="#topic+set_monte_carlo_draws">set_monte_carlo_draws</a>()</code>,
<code><a href="#topic+set_n_threads">set_n_threads</a>()</code>,
<code><a href="#topic+set_output_dir">set_output_dir</a>()</code>,
<code><a href="#topic+set_percentiles">set_percentiles</a>()</code>,
<code><a href="#topic+set_progress">set_progress</a>()</code>,
<code><a href="#topic+set_speed">set_speed</a>()</code>,
<code><a href="#topic+set_suboptimal_minutes">set_suboptimal_minutes</a>()</code>,
<code><a href="#topic+set_time_window">set_time_window</a>()</code>,
<code><a href="#topic+set_verbose">set_verbose</a>()</code>
</p>

<hr>
<h2 id='set_expanded_travel_times'>Set expanded travel times</h2><span id='topic+set_expanded_travel_times'></span>

<h3>Description</h3>

<p>Sets whether travel time matrices should return results for each minute of
the specified time window.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_expanded_travel_times(r5r_core, expanded)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_expanded_travel_times_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="set_expanded_travel_times_+3A_expanded">expanded</code></td>
<td>
<p>A logical.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisibly returns <code>TRUE</code>.
</p>


<h3>See Also</h3>

<p>Other setting functions: 
<code><a href="#topic+set_breakdown">set_breakdown</a>()</code>,
<code><a href="#topic+set_cutoffs">set_cutoffs</a>()</code>,
<code><a href="#topic+set_fare_cutoffs">set_fare_cutoffs</a>()</code>,
<code><a href="#topic+set_fare_structure">set_fare_structure</a>()</code>,
<code><a href="#topic+set_max_fare">set_max_fare</a>()</code>,
<code><a href="#topic+set_max_lts">set_max_lts</a>()</code>,
<code><a href="#topic+set_max_rides">set_max_rides</a>()</code>,
<code><a href="#topic+set_monte_carlo_draws">set_monte_carlo_draws</a>()</code>,
<code><a href="#topic+set_n_threads">set_n_threads</a>()</code>,
<code><a href="#topic+set_output_dir">set_output_dir</a>()</code>,
<code><a href="#topic+set_percentiles">set_percentiles</a>()</code>,
<code><a href="#topic+set_progress">set_progress</a>()</code>,
<code><a href="#topic+set_speed">set_speed</a>()</code>,
<code><a href="#topic+set_suboptimal_minutes">set_suboptimal_minutes</a>()</code>,
<code><a href="#topic+set_time_window">set_time_window</a>()</code>,
<code><a href="#topic+set_verbose">set_verbose</a>()</code>
</p>

<hr>
<h2 id='set_fare_cutoffs'>Set monetary cutoffs</h2><span id='topic+set_fare_cutoffs'></span>

<h3>Description</h3>

<p>Sets the monetary cutoffs that should be considered when calculating the
Pareto frontier.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_fare_cutoffs(r5r_core, fare_cutoffs)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_fare_cutoffs_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="set_fare_cutoffs_+3A_fare_cutoffs">fare_cutoffs</code></td>
<td>
<p>A path.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisibly returns <code>TRUE</code>.
</p>


<h3>See Also</h3>

<p>Other setting functions: 
<code><a href="#topic+set_breakdown">set_breakdown</a>()</code>,
<code><a href="#topic+set_cutoffs">set_cutoffs</a>()</code>,
<code><a href="#topic+set_expanded_travel_times">set_expanded_travel_times</a>()</code>,
<code><a href="#topic+set_fare_structure">set_fare_structure</a>()</code>,
<code><a href="#topic+set_max_fare">set_max_fare</a>()</code>,
<code><a href="#topic+set_max_lts">set_max_lts</a>()</code>,
<code><a href="#topic+set_max_rides">set_max_rides</a>()</code>,
<code><a href="#topic+set_monte_carlo_draws">set_monte_carlo_draws</a>()</code>,
<code><a href="#topic+set_n_threads">set_n_threads</a>()</code>,
<code><a href="#topic+set_output_dir">set_output_dir</a>()</code>,
<code><a href="#topic+set_percentiles">set_percentiles</a>()</code>,
<code><a href="#topic+set_progress">set_progress</a>()</code>,
<code><a href="#topic+set_speed">set_speed</a>()</code>,
<code><a href="#topic+set_suboptimal_minutes">set_suboptimal_minutes</a>()</code>,
<code><a href="#topic+set_time_window">set_time_window</a>()</code>,
<code><a href="#topic+set_verbose">set_verbose</a>()</code>
</p>

<hr>
<h2 id='set_fare_structure'>Set the fare structure used when calculating transit fares</h2><span id='topic+set_fare_structure'></span>

<h3>Description</h3>

<p>Sets the fare structure used by our &quot;generic&quot; fare calculator. A value of
<code>NULL</code> is passed to <code>fare_structure</code> by the upstream routing and
accessibility functions when fares are not to be calculated.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_fare_structure(r5r_core, fare_structure)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_fare_structure_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="set_fare_structure_+3A_fare_structure">fare_structure</code></td>
<td>
<p>A fare structure object, following the convention
set in <code><a href="#topic+setup_fare_structure">setup_fare_structure()</a></code>. This object describes how transit fares
should be calculated. Please see the fare structure vignette to
understand how this object is structured:
<code>vignette("fare_structure", package = "r5r")</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisibly returns <code>TRUE</code>.
</p>


<h3>See Also</h3>

<p>Other setting functions: 
<code><a href="#topic+set_breakdown">set_breakdown</a>()</code>,
<code><a href="#topic+set_cutoffs">set_cutoffs</a>()</code>,
<code><a href="#topic+set_expanded_travel_times">set_expanded_travel_times</a>()</code>,
<code><a href="#topic+set_fare_cutoffs">set_fare_cutoffs</a>()</code>,
<code><a href="#topic+set_max_fare">set_max_fare</a>()</code>,
<code><a href="#topic+set_max_lts">set_max_lts</a>()</code>,
<code><a href="#topic+set_max_rides">set_max_rides</a>()</code>,
<code><a href="#topic+set_monte_carlo_draws">set_monte_carlo_draws</a>()</code>,
<code><a href="#topic+set_n_threads">set_n_threads</a>()</code>,
<code><a href="#topic+set_output_dir">set_output_dir</a>()</code>,
<code><a href="#topic+set_percentiles">set_percentiles</a>()</code>,
<code><a href="#topic+set_progress">set_progress</a>()</code>,
<code><a href="#topic+set_speed">set_speed</a>()</code>,
<code><a href="#topic+set_suboptimal_minutes">set_suboptimal_minutes</a>()</code>,
<code><a href="#topic+set_time_window">set_time_window</a>()</code>,
<code><a href="#topic+set_verbose">set_verbose</a>()</code>
</p>

<hr>
<h2 id='set_max_fare'>Set max fare</h2><span id='topic+set_max_fare'></span>

<h3>Description</h3>

<p>Sets the max fare allowed when calculating transit fares.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_max_fare(r5r_core, max_fare)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_max_fare_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="set_max_fare_+3A_max_fare">max_fare</code></td>
<td>
<p>A number.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisibly returns <code>TRUE</code>.
</p>


<h3>See Also</h3>

<p>Other setting functions: 
<code><a href="#topic+set_breakdown">set_breakdown</a>()</code>,
<code><a href="#topic+set_cutoffs">set_cutoffs</a>()</code>,
<code><a href="#topic+set_expanded_travel_times">set_expanded_travel_times</a>()</code>,
<code><a href="#topic+set_fare_cutoffs">set_fare_cutoffs</a>()</code>,
<code><a href="#topic+set_fare_structure">set_fare_structure</a>()</code>,
<code><a href="#topic+set_max_lts">set_max_lts</a>()</code>,
<code><a href="#topic+set_max_rides">set_max_rides</a>()</code>,
<code><a href="#topic+set_monte_carlo_draws">set_monte_carlo_draws</a>()</code>,
<code><a href="#topic+set_n_threads">set_n_threads</a>()</code>,
<code><a href="#topic+set_output_dir">set_output_dir</a>()</code>,
<code><a href="#topic+set_percentiles">set_percentiles</a>()</code>,
<code><a href="#topic+set_progress">set_progress</a>()</code>,
<code><a href="#topic+set_speed">set_speed</a>()</code>,
<code><a href="#topic+set_suboptimal_minutes">set_suboptimal_minutes</a>()</code>,
<code><a href="#topic+set_time_window">set_time_window</a>()</code>,
<code><a href="#topic+set_verbose">set_verbose</a>()</code>
</p>

<hr>
<h2 id='set_max_lts'>Set max Level of Transit Stress (LTS)</h2><span id='topic+set_max_lts'></span>

<h3>Description</h3>

<p>Set max Level of Transit Stress (LTS)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_max_lts(r5r_core, max_lts)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_max_lts_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="set_max_lts_+3A_max_lts">max_lts</code></td>
<td>
<p>A number (between 1 and 4). The maximum level of traffic
stress that cyclists will tolerate. A value of 1 means cyclists will only
travel through the quietest streets, while a value of 4 indicates cyclists
can travel through any road.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisibly returns <code>TRUE</code>.
</p>


<h3>See Also</h3>

<p>Other setting functions: 
<code><a href="#topic+set_breakdown">set_breakdown</a>()</code>,
<code><a href="#topic+set_cutoffs">set_cutoffs</a>()</code>,
<code><a href="#topic+set_expanded_travel_times">set_expanded_travel_times</a>()</code>,
<code><a href="#topic+set_fare_cutoffs">set_fare_cutoffs</a>()</code>,
<code><a href="#topic+set_fare_structure">set_fare_structure</a>()</code>,
<code><a href="#topic+set_max_fare">set_max_fare</a>()</code>,
<code><a href="#topic+set_max_rides">set_max_rides</a>()</code>,
<code><a href="#topic+set_monte_carlo_draws">set_monte_carlo_draws</a>()</code>,
<code><a href="#topic+set_n_threads">set_n_threads</a>()</code>,
<code><a href="#topic+set_output_dir">set_output_dir</a>()</code>,
<code><a href="#topic+set_percentiles">set_percentiles</a>()</code>,
<code><a href="#topic+set_progress">set_progress</a>()</code>,
<code><a href="#topic+set_speed">set_speed</a>()</code>,
<code><a href="#topic+set_suboptimal_minutes">set_suboptimal_minutes</a>()</code>,
<code><a href="#topic+set_time_window">set_time_window</a>()</code>,
<code><a href="#topic+set_verbose">set_verbose</a>()</code>
</p>

<hr>
<h2 id='set_max_rides'>Set max number of rides</h2><span id='topic+set_max_rides'></span>

<h3>Description</h3>

<p>Sets the maximum number of rides a trip can use in R5.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_max_rides(r5r_core, max_rides)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_max_rides_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="set_max_rides_+3A_max_rides">max_rides</code></td>
<td>
<p>A number. The max number of public transport rides allowed
in the same trip. Passed from routing function.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects.
</p>


<h3>See Also</h3>

<p>Other setting functions: 
<code><a href="#topic+set_breakdown">set_breakdown</a>()</code>,
<code><a href="#topic+set_cutoffs">set_cutoffs</a>()</code>,
<code><a href="#topic+set_expanded_travel_times">set_expanded_travel_times</a>()</code>,
<code><a href="#topic+set_fare_cutoffs">set_fare_cutoffs</a>()</code>,
<code><a href="#topic+set_fare_structure">set_fare_structure</a>()</code>,
<code><a href="#topic+set_max_fare">set_max_fare</a>()</code>,
<code><a href="#topic+set_max_lts">set_max_lts</a>()</code>,
<code><a href="#topic+set_monte_carlo_draws">set_monte_carlo_draws</a>()</code>,
<code><a href="#topic+set_n_threads">set_n_threads</a>()</code>,
<code><a href="#topic+set_output_dir">set_output_dir</a>()</code>,
<code><a href="#topic+set_percentiles">set_percentiles</a>()</code>,
<code><a href="#topic+set_progress">set_progress</a>()</code>,
<code><a href="#topic+set_speed">set_speed</a>()</code>,
<code><a href="#topic+set_suboptimal_minutes">set_suboptimal_minutes</a>()</code>,
<code><a href="#topic+set_time_window">set_time_window</a>()</code>,
<code><a href="#topic+set_verbose">set_verbose</a>()</code>
</p>

<hr>
<h2 id='set_monte_carlo_draws'>Set number of Monte Carlo draws</h2><span id='topic+set_monte_carlo_draws'></span>

<h3>Description</h3>

<p>Sets the number of Monte Carlo draws to be used by R5.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_monte_carlo_draws(r5r_core, draws_per_minute, time_window)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_monte_carlo_draws_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="set_monte_carlo_draws_+3A_draws_per_minute">draws_per_minute</code></td>
<td>
<p>A number.</p>
</td></tr>
<tr><td><code id="set_monte_carlo_draws_+3A_time_window">time_window</code></td>
<td>
<p>A number.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisibly returns <code>TRUE</code>.
</p>


<h3>See Also</h3>

<p>Other setting functions: 
<code><a href="#topic+set_breakdown">set_breakdown</a>()</code>,
<code><a href="#topic+set_cutoffs">set_cutoffs</a>()</code>,
<code><a href="#topic+set_expanded_travel_times">set_expanded_travel_times</a>()</code>,
<code><a href="#topic+set_fare_cutoffs">set_fare_cutoffs</a>()</code>,
<code><a href="#topic+set_fare_structure">set_fare_structure</a>()</code>,
<code><a href="#topic+set_max_fare">set_max_fare</a>()</code>,
<code><a href="#topic+set_max_lts">set_max_lts</a>()</code>,
<code><a href="#topic+set_max_rides">set_max_rides</a>()</code>,
<code><a href="#topic+set_n_threads">set_n_threads</a>()</code>,
<code><a href="#topic+set_output_dir">set_output_dir</a>()</code>,
<code><a href="#topic+set_percentiles">set_percentiles</a>()</code>,
<code><a href="#topic+set_progress">set_progress</a>()</code>,
<code><a href="#topic+set_speed">set_speed</a>()</code>,
<code><a href="#topic+set_suboptimal_minutes">set_suboptimal_minutes</a>()</code>,
<code><a href="#topic+set_time_window">set_time_window</a>()</code>,
<code><a href="#topic+set_verbose">set_verbose</a>()</code>
</p>

<hr>
<h2 id='set_n_threads'>Set number of threads</h2><span id='topic+set_n_threads'></span>

<h3>Description</h3>

<p>Sets the number of threads to be used by the r5r <code>.jar</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_n_threads(r5r_core, n_threads)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_n_threads_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="set_n_threads_+3A_n_threads">n_threads</code></td>
<td>
<p>A number, passed from the function above.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisibly returns <code>TRUE</code>.
</p>


<h3>See Also</h3>

<p>Other setting functions: 
<code><a href="#topic+set_breakdown">set_breakdown</a>()</code>,
<code><a href="#topic+set_cutoffs">set_cutoffs</a>()</code>,
<code><a href="#topic+set_expanded_travel_times">set_expanded_travel_times</a>()</code>,
<code><a href="#topic+set_fare_cutoffs">set_fare_cutoffs</a>()</code>,
<code><a href="#topic+set_fare_structure">set_fare_structure</a>()</code>,
<code><a href="#topic+set_max_fare">set_max_fare</a>()</code>,
<code><a href="#topic+set_max_lts">set_max_lts</a>()</code>,
<code><a href="#topic+set_max_rides">set_max_rides</a>()</code>,
<code><a href="#topic+set_monte_carlo_draws">set_monte_carlo_draws</a>()</code>,
<code><a href="#topic+set_output_dir">set_output_dir</a>()</code>,
<code><a href="#topic+set_percentiles">set_percentiles</a>()</code>,
<code><a href="#topic+set_progress">set_progress</a>()</code>,
<code><a href="#topic+set_speed">set_speed</a>()</code>,
<code><a href="#topic+set_suboptimal_minutes">set_suboptimal_minutes</a>()</code>,
<code><a href="#topic+set_time_window">set_time_window</a>()</code>,
<code><a href="#topic+set_verbose">set_verbose</a>()</code>
</p>

<hr>
<h2 id='set_output_dir'>Set output directory</h2><span id='topic+set_output_dir'></span>

<h3>Description</h3>

<p>Sets whether r5r should save output to a specified directory.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_output_dir(r5r_core, output_dir)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_output_dir_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="set_output_dir_+3A_output_dir">output_dir</code></td>
<td>
<p>A path.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisibly returns <code>TRUE</code>.
</p>


<h3>See Also</h3>

<p>Other setting functions: 
<code><a href="#topic+set_breakdown">set_breakdown</a>()</code>,
<code><a href="#topic+set_cutoffs">set_cutoffs</a>()</code>,
<code><a href="#topic+set_expanded_travel_times">set_expanded_travel_times</a>()</code>,
<code><a href="#topic+set_fare_cutoffs">set_fare_cutoffs</a>()</code>,
<code><a href="#topic+set_fare_structure">set_fare_structure</a>()</code>,
<code><a href="#topic+set_max_fare">set_max_fare</a>()</code>,
<code><a href="#topic+set_max_lts">set_max_lts</a>()</code>,
<code><a href="#topic+set_max_rides">set_max_rides</a>()</code>,
<code><a href="#topic+set_monte_carlo_draws">set_monte_carlo_draws</a>()</code>,
<code><a href="#topic+set_n_threads">set_n_threads</a>()</code>,
<code><a href="#topic+set_percentiles">set_percentiles</a>()</code>,
<code><a href="#topic+set_progress">set_progress</a>()</code>,
<code><a href="#topic+set_speed">set_speed</a>()</code>,
<code><a href="#topic+set_suboptimal_minutes">set_suboptimal_minutes</a>()</code>,
<code><a href="#topic+set_time_window">set_time_window</a>()</code>,
<code><a href="#topic+set_verbose">set_verbose</a>()</code>
</p>

<hr>
<h2 id='set_percentiles'>Set percentiles</h2><span id='topic+set_percentiles'></span>

<h3>Description</h3>

<p>Sets the percentiles to be used by R5.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_percentiles(r5r_core, percentiles)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_percentiles_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="set_percentiles_+3A_percentiles">percentiles</code></td>
<td>
<p>An integer vector of maximum length 5.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisibly returns <code>TRUE</code>.
</p>


<h3>See Also</h3>

<p>Other setting functions: 
<code><a href="#topic+set_breakdown">set_breakdown</a>()</code>,
<code><a href="#topic+set_cutoffs">set_cutoffs</a>()</code>,
<code><a href="#topic+set_expanded_travel_times">set_expanded_travel_times</a>()</code>,
<code><a href="#topic+set_fare_cutoffs">set_fare_cutoffs</a>()</code>,
<code><a href="#topic+set_fare_structure">set_fare_structure</a>()</code>,
<code><a href="#topic+set_max_fare">set_max_fare</a>()</code>,
<code><a href="#topic+set_max_lts">set_max_lts</a>()</code>,
<code><a href="#topic+set_max_rides">set_max_rides</a>()</code>,
<code><a href="#topic+set_monte_carlo_draws">set_monte_carlo_draws</a>()</code>,
<code><a href="#topic+set_n_threads">set_n_threads</a>()</code>,
<code><a href="#topic+set_output_dir">set_output_dir</a>()</code>,
<code><a href="#topic+set_progress">set_progress</a>()</code>,
<code><a href="#topic+set_speed">set_speed</a>()</code>,
<code><a href="#topic+set_suboptimal_minutes">set_suboptimal_minutes</a>()</code>,
<code><a href="#topic+set_time_window">set_time_window</a>()</code>,
<code><a href="#topic+set_verbose">set_verbose</a>()</code>
</p>

<hr>
<h2 id='set_progress'>Set progress argument</h2><span id='topic+set_progress'></span>

<h3>Description</h3>

<p>Indicates whether or not a progress counter must be printed during
computations. Applies to all routing functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_progress(r5r_core, progress)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_progress_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="set_progress_+3A_progress">progress</code></td>
<td>
<p>A logical, passed from the function above.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisibly returns <code>TRUE</code>.
</p>


<h3>See Also</h3>

<p>Other setting functions: 
<code><a href="#topic+set_breakdown">set_breakdown</a>()</code>,
<code><a href="#topic+set_cutoffs">set_cutoffs</a>()</code>,
<code><a href="#topic+set_expanded_travel_times">set_expanded_travel_times</a>()</code>,
<code><a href="#topic+set_fare_cutoffs">set_fare_cutoffs</a>()</code>,
<code><a href="#topic+set_fare_structure">set_fare_structure</a>()</code>,
<code><a href="#topic+set_max_fare">set_max_fare</a>()</code>,
<code><a href="#topic+set_max_lts">set_max_lts</a>()</code>,
<code><a href="#topic+set_max_rides">set_max_rides</a>()</code>,
<code><a href="#topic+set_monte_carlo_draws">set_monte_carlo_draws</a>()</code>,
<code><a href="#topic+set_n_threads">set_n_threads</a>()</code>,
<code><a href="#topic+set_output_dir">set_output_dir</a>()</code>,
<code><a href="#topic+set_percentiles">set_percentiles</a>()</code>,
<code><a href="#topic+set_speed">set_speed</a>()</code>,
<code><a href="#topic+set_suboptimal_minutes">set_suboptimal_minutes</a>()</code>,
<code><a href="#topic+set_time_window">set_time_window</a>()</code>,
<code><a href="#topic+set_verbose">set_verbose</a>()</code>
</p>

<hr>
<h2 id='set_speed'>Set walk and bike speed</h2><span id='topic+set_speed'></span>

<h3>Description</h3>

<p>This function receives the walk and bike 'speed' inputs in Km/h from routing
functions above and converts them to meters per second, which is then used
to set these speed profiles in r5r JAR.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_speed(r5r_core, speed, mode)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_speed_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="set_speed_+3A_speed">speed</code></td>
<td>
<p>A number representing the speed in km/h.</p>
</td></tr>
<tr><td><code id="set_speed_+3A_mode">mode</code></td>
<td>
<p>A string. Either <code>"bike"</code> or <code>"walk"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisibly returns <code>TRUE</code>.
</p>


<h3>See Also</h3>

<p>Other setting functions: 
<code><a href="#topic+set_breakdown">set_breakdown</a>()</code>,
<code><a href="#topic+set_cutoffs">set_cutoffs</a>()</code>,
<code><a href="#topic+set_expanded_travel_times">set_expanded_travel_times</a>()</code>,
<code><a href="#topic+set_fare_cutoffs">set_fare_cutoffs</a>()</code>,
<code><a href="#topic+set_fare_structure">set_fare_structure</a>()</code>,
<code><a href="#topic+set_max_fare">set_max_fare</a>()</code>,
<code><a href="#topic+set_max_lts">set_max_lts</a>()</code>,
<code><a href="#topic+set_max_rides">set_max_rides</a>()</code>,
<code><a href="#topic+set_monte_carlo_draws">set_monte_carlo_draws</a>()</code>,
<code><a href="#topic+set_n_threads">set_n_threads</a>()</code>,
<code><a href="#topic+set_output_dir">set_output_dir</a>()</code>,
<code><a href="#topic+set_percentiles">set_percentiles</a>()</code>,
<code><a href="#topic+set_progress">set_progress</a>()</code>,
<code><a href="#topic+set_suboptimal_minutes">set_suboptimal_minutes</a>()</code>,
<code><a href="#topic+set_time_window">set_time_window</a>()</code>,
<code><a href="#topic+set_verbose">set_verbose</a>()</code>
</p>

<hr>
<h2 id='set_suboptimal_minutes'>Set suboptimal minutes</h2><span id='topic+set_suboptimal_minutes'></span>

<h3>Description</h3>

<p>Sets the number of suboptimal minutes considered in <code><a href="#topic+detailed_itineraries">detailed_itineraries()</a></code>
routing. From R5 documentation: &quot;This parameter compensates for the fact that
GTFS does not contain information about schedule deviation (lateness). The
min-max travel time range for some trains is zero, since the trips are
reported to always have the same timings in the schedule. Such an option
does not overlap (temporally) its alternatives, and is too easily eliminated
by an alternative that is only marginally better. We want to effectively
push the max travel time of alternatives out a bit to account for the fact
that they don't always run on schedule&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_suboptimal_minutes(
  r5r_core,
  suboptimal_minutes,
  fare_structure,
  shortest_path
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_suboptimal_minutes_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="set_suboptimal_minutes_+3A_suboptimal_minutes">suboptimal_minutes</code></td>
<td>
<p>A number.</p>
</td></tr>
<tr><td><code id="set_suboptimal_minutes_+3A_fare_structure">fare_structure</code></td>
<td>
<p>A fare structure object, following the convention
set in <code><a href="#topic+setup_fare_structure">setup_fare_structure()</a></code>. This object describes how transit fares
should be calculated. Please see the fare structure vignette to
understand how this object is structured:
<code>vignette("fare_structure", package = "r5r")</code>.</p>
</td></tr>
<tr><td><code id="set_suboptimal_minutes_+3A_shortest_path">shortest_path</code></td>
<td>
<p>A logical.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisibly returns <code>TRUE</code>.
</p>


<h3>See Also</h3>

<p>Other setting functions: 
<code><a href="#topic+set_breakdown">set_breakdown</a>()</code>,
<code><a href="#topic+set_cutoffs">set_cutoffs</a>()</code>,
<code><a href="#topic+set_expanded_travel_times">set_expanded_travel_times</a>()</code>,
<code><a href="#topic+set_fare_cutoffs">set_fare_cutoffs</a>()</code>,
<code><a href="#topic+set_fare_structure">set_fare_structure</a>()</code>,
<code><a href="#topic+set_max_fare">set_max_fare</a>()</code>,
<code><a href="#topic+set_max_lts">set_max_lts</a>()</code>,
<code><a href="#topic+set_max_rides">set_max_rides</a>()</code>,
<code><a href="#topic+set_monte_carlo_draws">set_monte_carlo_draws</a>()</code>,
<code><a href="#topic+set_n_threads">set_n_threads</a>()</code>,
<code><a href="#topic+set_output_dir">set_output_dir</a>()</code>,
<code><a href="#topic+set_percentiles">set_percentiles</a>()</code>,
<code><a href="#topic+set_progress">set_progress</a>()</code>,
<code><a href="#topic+set_speed">set_speed</a>()</code>,
<code><a href="#topic+set_time_window">set_time_window</a>()</code>,
<code><a href="#topic+set_verbose">set_verbose</a>()</code>
</p>

<hr>
<h2 id='set_time_window'>Set time window</h2><span id='topic+set_time_window'></span>

<h3>Description</h3>

<p>Sets the time window to be used by R5.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_time_window(r5r_core, time_window)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_time_window_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="set_time_window_+3A_time_window">time_window</code></td>
<td>
<p>A number.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisibly returns <code>TRUE</code>.
</p>


<h3>See Also</h3>

<p>Other setting functions: 
<code><a href="#topic+set_breakdown">set_breakdown</a>()</code>,
<code><a href="#topic+set_cutoffs">set_cutoffs</a>()</code>,
<code><a href="#topic+set_expanded_travel_times">set_expanded_travel_times</a>()</code>,
<code><a href="#topic+set_fare_cutoffs">set_fare_cutoffs</a>()</code>,
<code><a href="#topic+set_fare_structure">set_fare_structure</a>()</code>,
<code><a href="#topic+set_max_fare">set_max_fare</a>()</code>,
<code><a href="#topic+set_max_lts">set_max_lts</a>()</code>,
<code><a href="#topic+set_max_rides">set_max_rides</a>()</code>,
<code><a href="#topic+set_monte_carlo_draws">set_monte_carlo_draws</a>()</code>,
<code><a href="#topic+set_n_threads">set_n_threads</a>()</code>,
<code><a href="#topic+set_output_dir">set_output_dir</a>()</code>,
<code><a href="#topic+set_percentiles">set_percentiles</a>()</code>,
<code><a href="#topic+set_progress">set_progress</a>()</code>,
<code><a href="#topic+set_speed">set_speed</a>()</code>,
<code><a href="#topic+set_suboptimal_minutes">set_suboptimal_minutes</a>()</code>,
<code><a href="#topic+set_verbose">set_verbose</a>()</code>
</p>

<hr>
<h2 id='set_verbose'>Set verbose argument</h2><span id='topic+set_verbose'></span>

<h3>Description</h3>

<p>Indicates whether R5 should output informative messages or not. Please note
that R5 error messages are still reported even when <code>verbose</code> is <code>FALSE</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_verbose(r5r_core, verbose)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_verbose_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="set_verbose_+3A_verbose">verbose</code></td>
<td>
<p>A logical, passed from function above.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisibly returns <code>TRUE</code>.
</p>


<h3>See Also</h3>

<p>Other setting functions: 
<code><a href="#topic+set_breakdown">set_breakdown</a>()</code>,
<code><a href="#topic+set_cutoffs">set_cutoffs</a>()</code>,
<code><a href="#topic+set_expanded_travel_times">set_expanded_travel_times</a>()</code>,
<code><a href="#topic+set_fare_cutoffs">set_fare_cutoffs</a>()</code>,
<code><a href="#topic+set_fare_structure">set_fare_structure</a>()</code>,
<code><a href="#topic+set_max_fare">set_max_fare</a>()</code>,
<code><a href="#topic+set_max_lts">set_max_lts</a>()</code>,
<code><a href="#topic+set_max_rides">set_max_rides</a>()</code>,
<code><a href="#topic+set_monte_carlo_draws">set_monte_carlo_draws</a>()</code>,
<code><a href="#topic+set_n_threads">set_n_threads</a>()</code>,
<code><a href="#topic+set_output_dir">set_output_dir</a>()</code>,
<code><a href="#topic+set_percentiles">set_percentiles</a>()</code>,
<code><a href="#topic+set_progress">set_progress</a>()</code>,
<code><a href="#topic+set_speed">set_speed</a>()</code>,
<code><a href="#topic+set_suboptimal_minutes">set_suboptimal_minutes</a>()</code>,
<code><a href="#topic+set_time_window">set_time_window</a>()</code>
</p>

<hr>
<h2 id='setup_fare_structure'>Setup a fare structure to calculate the monetary costs of trips</h2><span id='topic+setup_fare_structure'></span>

<h3>Description</h3>

<p>Creates a basic fare structure that describes how transit fares should be
calculated in <code><a href="#topic+travel_time_matrix">travel_time_matrix()</a></code>, <code><a href="#topic+expanded_travel_time_matrix">expanded_travel_time_matrix()</a></code>,
<code><a href="#topic+accessibility">accessibility()</a></code> and <code><a href="#topic+pareto_frontier">pareto_frontier()</a></code>. This fare structure can be
manually edited and adjusted to the existing rules in your study area, as
long as they stick to some basic premises. Please see fare structure
vignette for more information on how the fare structure works:
<code>vignette("fare_structure", package = "r5r")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>setup_fare_structure(
  r5r_core,
  base_fare,
  by = "MODE",
  debug_path = NULL,
  debug_info = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="setup_fare_structure_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="setup_fare_structure_+3A_base_fare">base_fare</code></td>
<td>
<p>A numeric. A base value used to populate the fare
structure.</p>
</td></tr>
<tr><td><code id="setup_fare_structure_+3A_by">by</code></td>
<td>
<p>A string. Describes how <code>fare_type</code>s (a classification we created
to assign fares to different routes) are distributed among routes.
Possible values are <code>MODE</code>, <code>AGENCY</code> and <code>GENERIC</code>. <code>MODE</code> is used when
the mode is what determines the price of a route (e.g. if all the buses of
a given city cost $5). <code>AGENCY</code> is used when the agency that operates each
route is what determines its price (i.e. when two different routes/modes
operated by a single agency cost the same; note that you can also use
<code>AGENCY_NAME</code>, if the agency_ids listed in your GTFS cannot be easily
interpreted). <code>GENERIC</code> is used when all the routes cost the same. Please
note that this classification can later be edited to better suit your
needs (when, for example, two types of buses cost the same, but one offers
discounts after riding the subway and the other one doesn't), but this
parameter may save you some work.</p>
</td></tr>
<tr><td><code id="setup_fare_structure_+3A_debug_path">debug_path</code></td>
<td>
<p>Either a path to a <code>.csv</code> file or <code>NULL</code>. When <code>NULL</code> (the
default), fare debugging capabilities are disabled - i.e. there's no way
to check if the fare calculation is correct. When a path is provided,
<code>r5r</code> saves different itineraries and their respective fares to the
specified file. How each itinerary is described is controlled by
<code>debug_info</code>.</p>
</td></tr>
<tr><td><code id="setup_fare_structure_+3A_debug_info">debug_info</code></td>
<td>
<p>Either a string (when <code>debug_path</code> is a path) or <code>NULL</code>
(the default). Doesn't have any effect if <code>debug_path</code> is <code>NULL</code>. When a
string, accepts the values <code>MODE</code>, <code>ROUTE</code> and <code>MODE_ROUTE</code>. These values
dictates how itinerary information is written to the output. Let's suppose
we have an itinerary composed by two transit legs: first a subway leg
whose route_id is 001, and then a bus legs whose route_id is 007. If
<code>debug_info</code> is <code>MODE</code>, then this itinerary will be described as
<code>SUBWAY|BUS</code>. If <code>ROUTE</code>, as <code>001|007</code>. If <code>MODE_ROUTE</code>, as <code style="white-space: pre;">&#8288;SUBWAY 001|BUS 007&#8288;</code>. Please note that the final debug information will contain
not only the itineraries that were in fact used in the itineraries
returned in <code><a href="#topic+travel_time_matrix">travel_time_matrix()</a></code>, <code><a href="#topic+accessibility">accessibility()</a></code> and
<code><a href="#topic+pareto_frontier">pareto_frontier()</a></code>, but all the itineraries that <code>R5</code> checked when
calculating the routes. This imposes a performance penalty when tracking
debug information (but has the positive effect of returning a larger
sample of itineraries, which might help finding some implementation issues
on the fare structure).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A fare structure object.
</p>


<h3>See Also</h3>

<p>Other fare structure: 
<code><a href="#topic+read_fare_structure">read_fare_structure</a>()</code>,
<code><a href="#topic+write_fare_structure">write_fare_structure</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(r5r)

data_path &lt;- system.file("extdata/poa", package = "r5r")
r5r_core &lt;- setup_r5(data_path)

fare_structure &lt;- setup_fare_structure(r5r_core, base_fare = 5)

# to debug fare calculation
fare_structure &lt;- setup_fare_structure(
  r5r_core,
  base_fare = 5,
  debug_path = "fare_debug.csv",
  debug_info = "MODE"
)

fare_structure$debug_settings

# debugging can be manually turned off by setting output_file to ""
fare_structure$debug_settings &lt;- ""

</code></pre>

<hr>
<h2 id='setup_r5'>Create a transport network used for routing in R5</h2><span id='topic+setup_r5'></span>

<h3>Description</h3>

<p>Builds a multimodal transport network used for routing in <code>R5</code>, combining
multiple data inputs present in the directory where the network should be
saved to. The directory must contain only one street network file (in
<code>.osm.pbf</code> format). It may optionally contain one or more public transport
GTFS feeds (in <code>GTFS.zip</code> format, where <code>GTFS</code> is the name of your feed),
when used for public transport routing, and a <code>.tif</code> file describing the
elevation profile of the study area. If there is more than one GTFS feed in
the directory, all feeds are merged. If there is already a 'network.dat'
file in the directory, the function will simply read it and load it to
memory (unless specified not to do so).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>setup_r5(
  data_path,
  verbose = FALSE,
  temp_dir = FALSE,
  elevation = "TOBLER",
  overwrite = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="setup_r5_+3A_data_path">data_path</code></td>
<td>
<p>A string pointing to the directory where data inputs are
stored and where the built <code>network.dat</code> will be saved.</p>
</td></tr>
<tr><td><code id="setup_r5_+3A_verbose">verbose</code></td>
<td>
<p>A logical. Whether to show <code>R5</code> informative messages when
running the function. Defaults to <code>FALSE</code> (please note that in such case
<code>R5</code> error messages are still shown). Setting <code>verbose</code> to <code>TRUE</code> shows
detailed output, which can be useful for debugging issues not caught by
<code>r5r</code>.</p>
</td></tr>
<tr><td><code id="setup_r5_+3A_temp_dir">temp_dir</code></td>
<td>
<p>A logical. Whether the <code>R5</code> Jar file should be saved to a
temporary directory. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="setup_r5_+3A_elevation">elevation</code></td>
<td>
<p>A string. The name of the impedance function to be used to
calculate impedance for walking and cycling based on street slopes.
Available options include <code>TOBLER</code> (Default) and <code>MINETTI</code>, or <code>NONE</code> to
ignore elevation. R5 loads elevation data from <code>.tif</code> files saved inside the
<code>data_path</code> directory. See more info in the Details below.</p>
</td></tr>
<tr><td><code id="setup_r5_+3A_overwrite">overwrite</code></td>
<td>
<p>A logical. Whether to overwrite an existing <code>network.dat</code>
or to use a cached file. Defaults to <code>FALSE</code> (i.e. use a cached network).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An <code>rJava</code> object to connect with <code>R5</code> routing engine.
</p>


<h3>Details</h3>

<p>More information about the <code>TOBLER</code> and <code>MINETTI</code> options to calculate the
effects of elevation on travel times can be found in the references below:
</p>

<ul>
<li><p> Campbell, M. J., et al (2019). Using crowdsourced fitness tracker data to
model the relationship between slope and travel rates. Applied geography, 106,
93-107. <a href="https://doi.org/10.1016/j.apgeog.2019.03.008">doi:10.1016/j.apgeog.2019.03.008</a>.
</p>
</li>
<li><p> Minetti, A. E., et al (2002). Energy cost of walking and running at extreme
uphill and downhill slopes. Journal of applied physiology. <a href="https://doi.org/10.1152/japplphysiol.01177.2001">doi:10.1152/japplphysiol.01177.2001</a>.
</p>
</li>
<li><p> Tobler, W. (1993). Three presentations on geographical analysis and modeling:
Non-isotropic geographic modeling speculations on the geometry of geography
global spatial analysis. Technical Report. National center for geographic
information and analysis. 93 (1). <a href="https://escholarship.org/uc/item/05r820mz">https://escholarship.org/uc/item/05r820mz</a>.
</p>
</li></ul>



<h3>See Also</h3>

<p>Other setup: 
<code><a href="#topic+download_r5">download_r5</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(r5r)

# directory with street network and gtfs files
data_path &lt;- system.file("extdata/poa", package = "r5r")

r5r_core &lt;- setup_r5(data_path)

</code></pre>

<hr>
<h2 id='stop_r5'>Stop running r5r core</h2><span id='topic+stop_r5'></span>

<h3>Description</h3>

<p>Stops running r5r cores.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stop_r5(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stop_r5_+3A_...">...</code></td>
<td>
<p><code>r5r_core</code> objects currently running. By default, if no cores
are supplied all running cores are stopped.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects.
</p>


<h3>See Also</h3>

<p>Other support functions: 
<code><a href="#topic+check_connection">check_connection</a>()</code>,
<code><a href="#topic+fileurl_from_metadata">fileurl_from_metadata</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(r5r)

path &lt;- system.file("extdata/poa", package = "r5r")

r5r_core &lt;- setup_r5(path)

stop_r5(r5r_core)

</code></pre>

<hr>
<h2 id='street_network_to_sf'>Extract OpenStreetMap network in sf format from a network.dat file</h2><span id='topic+street_network_to_sf'></span>

<h3>Description</h3>

<p>Extract OpenStreetMap network in sf format from a network.dat file
</p>


<h3>Usage</h3>

<pre><code class='language-R'>street_network_to_sf(r5r_core)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="street_network_to_sf_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with two components of a street network in sf format: vertices
(POINT) and edges (LINESTRING).
</p>


<h3>See Also</h3>

<p>Other network functions: 
<code><a href="#topic+find_snap">find_snap</a>()</code>,
<code><a href="#topic+transit_network_to_sf">transit_network_to_sf</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(r5r)

# build transport network
path &lt;- system.file("extdata/poa", package = "r5r")
r5r_core &lt;- setup_r5(path)

# extract street network from r5r_core
street_net &lt;- street_network_to_sf(r5r_core)

stop_r5(r5r_core)

</code></pre>

<hr>
<h2 id='transit_network_to_sf'>Extract transit network in sf format</h2><span id='topic+transit_network_to_sf'></span>

<h3>Description</h3>

<p>Extracts the transit network from a <code>network.dat</code> file (built with
<code><a href="#topic+setup_r5">setup_r5()</a></code>) in <code>sf</code> format.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>transit_network_to_sf(r5r_core)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="transit_network_to_sf_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with two components of a transit network in <code>sf</code> format:
route shapes (<code>LINESTRING</code>) and transit stops (<code>POINT</code>). The same
<code>route_id</code>/<code>short_name</code> might appear with different geometries. This occurs
when the same route is associated to more than one <code>shape_id</code>s in the GTFS
feed used to create the transit network. Some transit stops might be
returned with geometry <code style="white-space: pre;">&#8288;POINT EMPTY&#8288;</code> (i.e. missing spatial coordinates).
This may occur when a transit stop is not snapped to the road network,
possibly because the GTFS feed used to create the transit network covers an
area larger than the <code>.osm.pbf</code> input data.
</p>


<h3>See Also</h3>

<p>Other network functions: 
<code><a href="#topic+find_snap">find_snap</a>()</code>,
<code><a href="#topic+street_network_to_sf">street_network_to_sf</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(r5r)

# build transport network
path &lt;- system.file("extdata/poa", package = "r5r")
r5r_core &lt;- setup_r5(path)

# extract transit network from r5r_core
transit_net &lt;- transit_network_to_sf(r5r_core)

stop_r5(r5r_core)

</code></pre>

<hr>
<h2 id='travel_time_matrix'>Calculate travel time matrix between origin destination pairs</h2><span id='topic+travel_time_matrix'></span>

<h3>Description</h3>

<p>Fast computation of travel time estimates between one or multiple origin
destination pairs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>travel_time_matrix(
  r5r_core,
  origins,
  destinations,
  mode = "WALK",
  mode_egress = "WALK",
  departure_datetime = Sys.time(),
  time_window = 10L,
  percentiles = 50L,
  fare_structure = NULL,
  max_fare = Inf,
  max_walk_time = Inf,
  max_bike_time = Inf,
  max_car_time = Inf,
  max_trip_duration = 120L,
  walk_speed = 3.6,
  bike_speed = 12,
  max_rides = 3,
  max_lts = 2,
  draws_per_minute = 5L,
  n_threads = Inf,
  verbose = FALSE,
  progress = FALSE,
  output_dir = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="travel_time_matrix_+3A_r5r_core">r5r_core</code></td>
<td>
<p>An object to connect with the R5 routing engine, created with
<code><a href="#topic+setup_r5">setup_r5()</a></code>.</p>
</td></tr>
<tr><td><code id="travel_time_matrix_+3A_origins">origins</code>, <code id="travel_time_matrix_+3A_destinations">destinations</code></td>
<td>
<p>Either a <code style="white-space: pre;">&#8288;POINT sf&#8288;</code> object with WGS84 CRS, or a
<code>data.frame</code> containing the columns <code>id</code>, <code>lon</code> and <code>lat</code>.</p>
</td></tr>
<tr><td><code id="travel_time_matrix_+3A_mode">mode</code></td>
<td>
<p>A character vector. The transport modes allowed for access,
transfer and vehicle legs of the trips. Defaults to <code>WALK</code>. Please see
details for other options.</p>
</td></tr>
<tr><td><code id="travel_time_matrix_+3A_mode_egress">mode_egress</code></td>
<td>
<p>A character vector. The transport mode used after egress
from the last public transport. It can be either <code>WALK</code>, <code>BICYCLE</code> or
<code>CAR</code>. Defaults to <code>WALK</code>. Ignored when public transport is not used.</p>
</td></tr>
<tr><td><code id="travel_time_matrix_+3A_departure_datetime">departure_datetime</code></td>
<td>
<p>A POSIXct object. Please note that the departure
time only influences public transport legs. When working with public
transport networks, please check the <code>calendar.txt</code> within your GTFS feeds
for valid dates. Please see details for further information on how
datetimes are parsed.</p>
</td></tr>
<tr><td><code id="travel_time_matrix_+3A_time_window">time_window</code></td>
<td>
<p>An integer. The time window in minutes for which <code>r5r</code>
will calculate multiple travel time matrices departing each minute.
Defaults to 10 minutes. By default, the function returns the result based
on median travel times, but the user can set the <code>percentiles</code> parameter to
extract more results. Please read the time window vignette for more details
on its usage <code>vignette("time_window", package = "r5r")</code></p>
</td></tr>
<tr><td><code id="travel_time_matrix_+3A_percentiles">percentiles</code></td>
<td>
<p>An integer vector (max length of 5). Specifies the
percentile to use when returning travel time estimates within the given
time window. For example, if the 25th travel time percentile between A and
B is 15 minutes, 25% of all trips taken between these points within the
specified time window are shorter than 15 minutes. Defaults to 50,
returning the median travel time. If a vector with length bigger than 1 is
passed, the output contains an additional column for each percentile
specifying the percentile travel time estimate. each estimate. Due to
upstream restrictions, only 5 percentiles can be specified at a time. For
more details, please see R5 documentation at
<a href="https://docs.conveyal.com/analysis/methodology#accounting-for-variability">https://docs.conveyal.com/analysis/methodology#accounting-for-variability</a>.</p>
</td></tr>
<tr><td><code id="travel_time_matrix_+3A_fare_structure">fare_structure</code></td>
<td>
<p>A fare structure object, following the convention
set in <code><a href="#topic+setup_fare_structure">setup_fare_structure()</a></code>. This object describes how transit fares
should be calculated. Please see the fare structure vignette to
understand how this object is structured:
<code>vignette("fare_structure", package = "r5r")</code>.</p>
</td></tr>
<tr><td><code id="travel_time_matrix_+3A_max_fare">max_fare</code></td>
<td>
<p>A number. The maximum value that trips can cost when
calculating the fastest journey between each origin and destination pair.</p>
</td></tr>
<tr><td><code id="travel_time_matrix_+3A_max_walk_time">max_walk_time</code></td>
<td>
<p>An integer. The maximum walking time (in minutes) to
access and egress the transit network, or to make transfers within the
network. Defaults to no restrictions, as long as <code>max_trip_duration</code> is
respected. The max time is considered separately for each leg (e.g. if
you set <code>max_walk_time</code> to 15, you could potentially walk up to 15 minutes
to reach transit, and up to <em>another</em> 15 minutes to reach the destination
after leaving transit). Defaults to <code>Inf</code>, no limit.</p>
</td></tr>
<tr><td><code id="travel_time_matrix_+3A_max_bike_time">max_bike_time</code></td>
<td>
<p>An integer. The maximum cycling time (in minutes) to
access and egress the transit network. Defaults to no restrictions, as long
as <code>max_trip_duration</code> is respected. The max time is considered separately
for each leg (e.g. if you set <code>max_bike_time</code> to 15 minutes, you could
potentially cycle up to 15 minutes to reach transit, and up to <em>another</em> 15
minutes to reach the destination after leaving transit). Defaults to <code>Inf</code>,
no limit.</p>
</td></tr>
<tr><td><code id="travel_time_matrix_+3A_max_car_time">max_car_time</code></td>
<td>
<p>An integer. The maximum driving time (in minutes) to
access and egress the transit network. Defaults to no restrictions, as long
as <code>max_trip_duration</code> is respected. The max time is considered separately
for each leg (e.g. if you set <code>max_car_time</code> to 15 minutes, you could
potentially drive up to 15 minutes to reach transit, and up to <em>another</em> 15
minutes to reach the destination after leaving transit). Defaults to <code>Inf</code>,
no limit.</p>
</td></tr>
<tr><td><code id="travel_time_matrix_+3A_max_trip_duration">max_trip_duration</code></td>
<td>
<p>An integer. The maximum trip duration in minutes.
Defaults to 120 minutes (2 hours).</p>
</td></tr>
<tr><td><code id="travel_time_matrix_+3A_walk_speed">walk_speed</code></td>
<td>
<p>A numeric. Average walk speed in km/h. Defaults to 3.6
km/h.</p>
</td></tr>
<tr><td><code id="travel_time_matrix_+3A_bike_speed">bike_speed</code></td>
<td>
<p>A numeric. Average cycling speed in km/h. Defaults to 12
km/h.</p>
</td></tr>
<tr><td><code id="travel_time_matrix_+3A_max_rides">max_rides</code></td>
<td>
<p>An integer. The maximum number of public transport rides
allowed in the same trip. Defaults to 3.</p>
</td></tr>
<tr><td><code id="travel_time_matrix_+3A_max_lts">max_lts</code></td>
<td>
<p>An integer between 1 and 4. The maximum level of traffic
stress that cyclists will tolerate. A value of 1 means cyclists will only
travel through the quietest streets, while a value of 4 indicates cyclists
can travel through any road. Defaults to 2. Please see details for more
information.</p>
</td></tr>
<tr><td><code id="travel_time_matrix_+3A_draws_per_minute">draws_per_minute</code></td>
<td>
<p>An integer. The number of Monte Carlo draws to
perform per time window minute when calculating travel time matrices and
when estimating accessibility. Defaults to 5. This would mean 300 draws in
a 60-minute time window, for example. This parameter only affects the
results when the GTFS feeds contain a <code>frequencies.txt</code> table.</p>
</td></tr>
<tr><td><code id="travel_time_matrix_+3A_n_threads">n_threads</code></td>
<td>
<p>An integer. The number of threads to use when running the
router in parallel. Defaults to use all available threads (Inf).</p>
</td></tr>
<tr><td><code id="travel_time_matrix_+3A_verbose">verbose</code></td>
<td>
<p>A logical. Whether to show <code>R5</code> informative messages when
running the function. Defaults to <code>FALSE</code> (please note that in such case
<code>R5</code> error messages are still shown). Setting <code>verbose</code> to <code>TRUE</code> shows
detailed output, which can be useful for debugging issues not caught by
<code>r5r</code>.</p>
</td></tr>
<tr><td><code id="travel_time_matrix_+3A_progress">progress</code></td>
<td>
<p>A logical. Whether to show a progress counter when running
the router. Defaults to <code>FALSE</code>. Only works when <code>verbose</code> is set to
<code>FALSE</code>, so the progress counter does not interfere with <code>R5</code>'s output
messages. Setting <code>progress</code> to <code>TRUE</code> may impose a small penalty for
computation efficiency, because the progress counter must be synchronized
among all active threads.</p>
</td></tr>
<tr><td><code id="travel_time_matrix_+3A_output_dir">output_dir</code></td>
<td>
<p>Either <code>NULL</code> or a path to an existing directory. When not
<code>NULL</code> (the default), the function will write one <code>.csv</code> file with the
results for each origin in the specified directory. In such case, the
function returns the path specified in this parameter. This parameter is
particularly useful when running estimates on memory-constrained settings,
because writing the results to disk prevents <code>r5r</code> from storing them in
memory.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>data.table</code> with travel time estimates (in minutes) between
origin and destination pairs. Pairs whose trips couldn't be completed
within the maximum travel time and/or whose origin is too far from the
street network are not returned in the <code>data.table</code>. If <code>output_dir</code> is
not <code>NULL</code>, the function returns the path specified in that parameter, in
which the <code>.csv</code> files containing the results are saved.
</p>


<h3>Transport modes</h3>

<p><code>R5</code> allows for multiple combinations of transport modes. The options
include:
</p>

<ul>
<li> <p><strong>Transit modes:</strong> <code>TRAM</code>, <code>SUBWAY</code>, <code>RAIL</code>, <code>BUS</code>, <code>FERRY</code>, <code>CABLE_CAR</code>,
<code>GONDOLA</code>, <code>FUNICULAR</code>. The option <code>TRANSIT</code> automatically considers all
public transport modes available.
</p>
</li>
<li> <p><strong>Non transit modes:</strong> <code>WALK</code>, <code>BICYCLE</code>, <code>CAR</code>, <code>BICYCLE_RENT</code>,
<code>CAR_PARK</code>.
</p>
</li></ul>



<h3>Level of Traffic Stress (LTS)</h3>

<p>When cycling is enabled in <code>R5</code> (by passing the value <code>BIKE</code> to either
<code>mode</code> or <code>mode_egress</code>), setting <code>max_lts</code> will allow cycling only on
streets with a given level of danger/stress. Setting <code>max_lts</code> to 1, for
example, will allow cycling only on separated bicycle infrastructure or
low-traffic streets and routing will revert to walking when traversing any
links with LTS exceeding 1. Setting <code>max_lts</code> to 3 will allow cycling on
links with LTS 1, 2 or 3. Routing also reverts to walking if the street
segment is tagged as non-bikable in OSM (e.g. a staircase), independently of
the specified max LTS.
</p>
<p>The default methodology for assigning LTS values to network edges is based
on commonly tagged attributes of OSM ways. See more info about LTS in the
original documentation of R5 from Conveyal at
<a href="https://docs.conveyal.com/learn-more/traffic-stress">https://docs.conveyal.com/learn-more/traffic-stress</a>. In summary:
</p>

<ul>
<li> <p><strong>LTS 1</strong>: Tolerable for children. This includes low-speed, low-volume
streets, as well as those with separated bicycle facilities (such as
parking-protected lanes or cycle tracks).
</p>
</li>
<li> <p><strong>LTS 2</strong>: Tolerable for the mainstream adult population. This includes
streets where cyclists have dedicated lanes and only have to interact with
traffic at formal crossing.
</p>
</li>
<li> <p><strong>LTS 3</strong>: Tolerable for &quot;enthused and confident&quot; cyclists. This includes
streets which may involve close proximity to moderate- or high-speed
vehicular traffic.
</p>
</li>
<li> <p><strong>LTS 4</strong>: Tolerable only for &quot;strong and fearless&quot; cyclists. This
includes streets where cyclists are required to mix with moderate- to
high-speed vehicular traffic.
</p>
</li></ul>

<p>For advanced users, you can provide custom LTS values by adding a tag <code style="white-space: pre;">&#8288;&lt;key = "lts"&gt;&#8288;</code> to the <code>osm.pbf</code> file.
</p>


<h3>Datetime parsing</h3>

<p><code>r5r</code> ignores the timezone attribute of datetime objects when parsing dates
and times, using the study area's timezone instead. For example, let's say
you are running some calculations using Rio de Janeiro, Brazil, as your study
area. The datetime <code>as.POSIXct("13-05-2019 14:00:00", format = "%d-%m-%Y %H:%M:%S")</code> will be parsed as May 13th, 2019, 14:00h in
Rio's local time, as expected. But <code>as.POSIXct("13-05-2019 14:00:00", format = "%d-%m-%Y %H:%M:%S", tz = "Europe/Paris")</code> will also be parsed as
the exact same date and time in Rio's local time, perhaps surprisingly,
ignoring the timezone attribute.
</p>


<h3>Routing algorithm</h3>

<p>The <code><a href="#topic+travel_time_matrix">travel_time_matrix()</a></code>, <code><a href="#topic+expanded_travel_time_matrix">expanded_travel_time_matrix()</a></code> and
<code><a href="#topic+accessibility">accessibility()</a></code> functions use an <code>R5</code>-specific extension to the RAPTOR
routing algorithm (see Conway et al., 2017). This RAPTOR extension uses a
systematic sample of one departure per minute over the time window set by the
user in the 'time_window' parameter. A detailed description of base RAPTOR
can be found in Delling et al (2015). However, whenever the user includes
transit fares inputs to these functions, they automatically switch to use an
<code>R5</code>-specific extension to the McRAPTOR routing algorithm.
</p>

<ul>
<li><p> Conway, M. W., Byrd, A., &amp; van der Linden, M. (2017). Evidence-based
transit and land use sketch planning using interactive accessibility methods
on combined schedule and headway-based networks. Transportation Research
Record, 2653(1), 45-53. <a href="https://doi.org/10.3141/2653-06">doi:10.3141/2653-06</a>
</p>
</li>
<li><p> Delling, D., Pajor, T., &amp; Werneck, R. F. (2015). Round-based public
transit routing. Transportation Science, 49(3), 591-604.
<a href="https://doi.org/10.1287/trsc.2014.0534">doi:10.1287/trsc.2014.0534</a>
</p>
</li></ul>



<h3>See Also</h3>

<p>Other routing: 
<code><a href="#topic+detailed_itineraries">detailed_itineraries</a>()</code>,
<code><a href="#topic+expanded_travel_time_matrix">expanded_travel_time_matrix</a>()</code>,
<code><a href="#topic+pareto_frontier">pareto_frontier</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(r5r)

# build transport network
data_path &lt;- system.file("extdata/poa", package = "r5r")
r5r_core &lt;- setup_r5(data_path)

# load origin/destination points
points &lt;- read.csv(file.path(data_path, "poa_points_of_interest.csv"))

departure_datetime &lt;- as.POSIXct(
  "13-05-2019 14:00:00",
  format = "%d-%m-%Y %H:%M:%S"
)

ttm &lt;- travel_time_matrix(
  r5r_core,
  origins = points,
  destinations = points,
  mode = c("WALK", "TRANSIT"),
  departure_datetime = departure_datetime,
  max_trip_duration = 60
)
head(ttm)

# using a larger time window
ttm &lt;- travel_time_matrix(
  r5r_core,
  origins = points,
  destinations = points,
  mode = c("WALK", "TRANSIT"),
  departure_datetime = departure_datetime,
  time_window = 30,
  max_trip_duration = 60
)
head(ttm)

# selecting different percentiles
ttm &lt;- travel_time_matrix(
  r5r_core,
  origins = points,
  destinations = points,
  mode = c("WALK", "TRANSIT"),
  departure_datetime = departure_datetime,
  time_window = 30,
  percentiles = c(25, 50, 75),
  max_trip_duration = 60
)
head(ttm)

# use a fare structure and set a max fare to take monetary constraints into
# account
fare_structure &lt;- read_fare_structure(
  file.path(data_path, "fares/fares_poa.zip")
)
ttm &lt;- travel_time_matrix(
  r5r_core,
  origins = points,
  destinations = points,
  mode = c("WALK", "TRANSIT"),
  departure_datetime = departure_datetime,
  fare_structure = fare_structure,
  max_fare = 5,
  max_trip_duration = 60,
)
head(ttm)

stop_r5(r5r_core)

</code></pre>

<hr>
<h2 id='write_fare_structure'>Write a fare structure object to disk</h2><span id='topic+write_fare_structure'></span>

<h3>Description</h3>

<p>Writes a fare structure object do disk. Fare structure is saved as a
collection of <code>.csv</code> files inside a <code>.zip</code> file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_fare_structure(fare_structure, file_path)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="write_fare_structure_+3A_fare_structure">fare_structure</code></td>
<td>
<p>A fare structure object, following the convention
set in <code><a href="#topic+setup_fare_structure">setup_fare_structure()</a></code>. This object describes how transit fares
should be calculated. Please see the fare structure vignette to
understand how this object is structured:
<code>vignette("fare_structure", package = "r5r")</code>.</p>
</td></tr>
<tr><td><code id="write_fare_structure_+3A_file_path">file_path</code></td>
<td>
<p>A path to a <code>.zip</code> file. Where the fare structure should be
written to.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The path passed to <code>file_path</code>, invisibly.
</p>


<h3>See Also</h3>

<p>Other fare structure: 
<code><a href="#topic+read_fare_structure">read_fare_structure</a>()</code>,
<code><a href="#topic+setup_fare_structure">setup_fare_structure</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(r5r)

data_path &lt;- system.file("extdata/poa", package = "r5r")
r5r_core &lt;- setup_r5(data_path)

fare_structure &lt;- setup_fare_structure(r5r_core, base_fare = 5)

tmpfile &lt;- tempfile("sample_fare_structure", fileext = ".zip")
write_fare_structure(fare_structure, tmpfile)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
