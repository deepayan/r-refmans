<!DOCTYPE html><html lang="en"><head><title>Help for package emcAdr</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {emcAdr}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#emcAdr-package'>
<p>Evolutionary Version of the Metropolis-Hastings Algorithm</p></a></li>
<li><a href='#ATC_Tree_UpperBound_2024'><p>ATC Tree Upper Bound 2024</p></a></li>
<li><a href='#ATCtoNumeric'><p>Convert ATC Code for each patients to the corresponding DFS number of the ATC tree</p></a></li>
<li><a href='#calculate_divergence'><p>Calculate the divergence between 2 distributions (the true Distribution and the learned one)</p></a></li>
<li><a href='#clustering_genetic_algorithm'><p>Clustering of the solutions of the genetic algorithm using the hclust algorithm</p></a></li>
<li><a href='#compute_hypergeom_on_list'><p>Function used to compute the Hypergeometric score on a list of cocktails</p></a></li>
<li><a href='#compute_RR_on_list'><p>Function used to compute the Relative Risk on a list of cocktails</p></a></li>
<li><a href='#computeMetrics_size2'><p>Function used in the reference article to compare diverse Disproportionality Analysis metrics</p></a></li>
<li><a href='#csv_to_population'><p>Function used to convert your genetic algorithm results that are stored into</p>
a .csv file to a Data structure that can be used by the clustering algorithm</a></li>
<li><a href='#DistributionApproximation'><p>The MCMC method that runs the random walk on a single cocktail in order to estimate the distribution of score among cocktails of size Smax.</p></a></li>
<li><a href='#FAERS_myopathy'><p>FAERS Myopathy Dataset</p></a></li>
<li><a href='#GeneticAlgorithm'><p>Genetic algorithm, trying to reach riskiest cocktails (the ones which maximize</p>
the fitness function, Hypergeometric score in our case)</a></li>
<li><a href='#get_dissimilarity_from_cocktail_list'><p>Recover the square matrix of distance between cocktails where the index (i,j)</p>
of the matrix is the distance between cocktails i and j in an arbitrary
cocktail list</a></li>
<li><a href='#get_dissimilarity_from_genetic_results'><p>Recover the square matrix of distance between cocktails where the index (i,j)</p>
of the matrix is the distance between cocktails i and j in the genetic_results
list.</a></li>
<li><a href='#get_dissimilarity_from_txt_file'><p>Recover the square matrix of distance between cocktails where the index (i,j)</p>
of the matrix is the distance between cocktails i and j in the csv file containing
results of genetic algorithm</a></li>
<li><a href='#hclust_genetic_solution'><p>Clustering of the solutions of the genetic algorithm using the hclust algorithm</p></a></li>
<li><a href='#histogramToDitribution'><p>Convert the histogram returned by the DistributionApproximation function, to a real number distribution</p>
(that can be used in a test for example)</a></li>
<li><a href='#hyperparam_test_genetic_algorithm'><p>This function can be used in order to try different set of parameters for the genetic</p>
algorithm in a convenient way. This will run each combination of mutation_rate,
nb_elite and alphas possible nb_test_desired times. For each sets of parameters,
results will be saved in a file named according to the set of parameter. One
can regroup the results of each run in a csv file by using the print_csv function
specifying the names of each file that needs to be treated and the number of
performed runs on each parameter set</a></li>
<li><a href='#int_cocktail_to_string_cocktail'><p>Function used to convert integer cocktails (like the one outputed by the distributionApproximation function)</p>
to string cocktail in order to make them more readable</a></li>
<li><a href='#OutsandingScoreToDistribution'><p>Output the outstanding score (Outstanding_score) outputed by the MCMC algorithm</p>
in a special format</a></li>
<li><a href='#p_value_cocktails'><p>Used to add the p_value to each cocktail of cocktail list</p></a></li>
<li><a href='#p_value_csv_file'><p>Used to add the p_value to each cocktail of a csv_file that is an</p>
output of the genetic algorithm</a></li>
<li><a href='#p_value_genetic_results'><p>Used to add the p_value to each cocktail of an output of the genetic algorithm</p></a></li>
<li><a href='#p_value_on_sampled'><p>Calculate p-value of sampled value</p></a></li>
<li><a href='#plot_evolution'><p>Plot the evolution of the mean and the best value of the population used by the GeneticAlgorithm</p></a></li>
<li><a href='#plot_frequency'><p>Plot the histogram of the approximation of the RR distribution</p></a></li>
<li><a href='#print_csv'><p>Print every cocktails found during the genetic algorithm when used with the</p>
hyperparam_test_genetic_algorithm function. This enables to condense the solutions
found in each files by collapsing similar cocktail in a single row by cocktail.</a></li>
<li><a href='#qq_plot_output'><p>Make a Quantile-Quantile diagram from the output of the MCMC algorithm (DistributionAproximation)</p>
and the algorithm that exhaustively calculates the distribution</a></li>
<li><a href='#string_list_to_int_cocktails'><p>Function used to convert a string vector of drugs in form &quot;drug1:drug2&quot; to</p>
a vector of index of the ATC tree ex: c(ATC_index(drug1), ATC_index(drugs2))</a></li>
<li><a href='#trueDistributionDrugs'><p>The true distribution of the score among every single nodes of the ATC</p></a></li>
<li><a href='#trueDistributionSizeTwoCocktail'><p>The true distribution of the score among every size-two cocktails</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Evolutionary Version of the Metropolis-Hastings Algorithm</td>
</tr>
<tr>
<td>Version:</td>
<td>1.2</td>
</tr>
<tr>
<td>Date:</td>
<td>2025-01-31</td>
</tr>
<tr>
<td>Author:</td>
<td>Jules Bangard <a href="https://orcid.org/0009-0007-4670-7860"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jules Bangard &lt;jules.bangard@etu.unistra.fr&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides computational methods for detecting adverse high-order drug interactions
         from individual case safety reports using statistical techniques,
         allowing the exploration of higher-order interactions among drug cocktails.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>Rcpp (&ge; 1.0.7), ggplot2, dplyr, umap, dbscan, stats</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, gridExtra</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-02-26 12:36:14 UTC; julesbangard</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-02-27 17:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='emcAdr-package'>
Evolutionary Version of the Metropolis-Hastings Algorithm
</h2><span id='topic+emcAdr-package'></span><span id='topic+emcAdr'></span>

<h3>Description</h3>

<p>Provides computational methods for detecting adverse high-order drug interactions
         from individual case safety reports using statistical techniques,
         allowing the exploration of higher-order interactions among drug cocktails.
</p>


<h3>Author(s)</h3>

<p>Jules Bangard [aut, cre] (&lt;https://orcid.org/0009-0007-4670-7860&gt;)
</p>
<p>Maintainer: Jules Bangard &lt;jules.bangard@etu.unistra.fr&gt;
</p>


<h3>See Also</h3>

<p><code><a href="Rcpp.html#topic+Rcpp-package">Rcpp</a></code>, 
<a href="RcppArmadillo.html#topic+RcppArmadillo">RcppArmadillo</a>
</p>

<hr>
<h2 id='ATC_Tree_UpperBound_2024'>ATC Tree Upper Bound 2024</h2><span id='topic+ATC_Tree_UpperBound_2024'></span>

<h3>Description</h3>

<p>Example dataset representing the ATC tree structure, sourced from the WHO website (2024-02-23).
This dataset is provided for demonstration and testing purposes with the package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ATC_Tree_UpperBound_2024
</code></pre>


<h3>Format</h3>

<p>A data frame with 4 variables:
</p>

<dl>
<dt>ATCCode</dt><dd><p>The code of ATC nodes</p>
</dd>
<dt>Name</dt><dd><p>The name of ATC nodes</p>
</dd>
<dt>ATC_length</dt><dd><p>The number of characters in the ATCCode</p>
</dd>
<dt>upperBound</dt><dd><p>The index of the last child node in the tree</p>
</dd>
</dl>



<h3>Source</h3>

<p>World Health Organization, ATC classification register
</p>

<hr>
<h2 id='ATCtoNumeric'>Convert ATC Code for each patients to the corresponding DFS number of the ATC tree</h2><span id='topic+ATCtoNumeric'></span>

<h3>Description</h3>

<p>Convert ATC Code for each patients to the corresponding DFS number of the ATC tree
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ATCtoNumeric(patientATC, tree)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ATCtoNumeric_+3A_patientatc">patientATC</code></td>
<td>
<p>: patients observations, for each patient we got a string 
containing taken medications (ATC code)</p>
</td></tr>
<tr><td><code id="ATCtoNumeric_+3A_tree">tree</code></td>
<td>
<p>: ATC tree (we assume that there is a column 'ATCCode' )</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a matrix of the same size as patientATC but containing integer 
that are the index of the corresponding ATC code.
</p>


<h3>Examples</h3>

<pre><code class='language-R'> ATC_code &lt;- c('A01AA30 A01AB03', 'A10AC30')
 ATCtoNumeric(ATC_code, ATC_Tree_UpperBound_2024)

</code></pre>

<hr>
<h2 id='calculate_divergence'>Calculate the divergence between 2 distributions (the true Distribution and the learned one)</h2><span id='topic+calculate_divergence'></span>

<h3>Description</h3>

<p>Calculate the divergence between 2 distributions (the true Distribution and the learned one)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_divergence(
  empirical_distribution,
  true_distribution,
  method = "TV",
  Filtered = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calculate_divergence_+3A_empirical_distribution">empirical_distribution</code></td>
<td>
<p>A numeric vector of values representing the empirical distribution (return value of DistributionAproximation function)</p>
</td></tr>
<tr><td><code id="calculate_divergence_+3A_true_distribution">true_distribution</code></td>
<td>
<p>A numeric vector of values representing the true distribution computed by the trueDistributionSizeTwoCocktail function</p>
</td></tr>
<tr><td><code id="calculate_divergence_+3A_method">method</code></td>
<td>
<p>A string, either &quot;TV&quot; or &quot;KL&quot; to respectively use the total variation distance or the Kullback-Leibler divergence. (default = &quot;TV&quot;)</p>
</td></tr>
<tr><td><code id="calculate_divergence_+3A_filtered">Filtered</code></td>
<td>
<p>Should we use the filtered distribution or the normal one</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric value representing the divergence of the 2 distributions
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("ATC_Tree_UpperBound_2024")
data("FAERS_myopathy")

estimated_score_distribution = DistributionApproximation(epochs = 10,
            ATCtree = ATC_Tree_UpperBound_2024,
            observations = FAERS_myopathy[1:100,], Smax =2)
            
true_score_distribution = trueDistributionSizeTwoCocktail(ATCtree = ATC_Tree_UpperBound_2024,
            observations = FAERS_myopathy[1:100,], beta = 4)

divergence &lt;- calculate_divergence(empirical_distribution = estimated_score_distribution,
                true_distribution = true_score_distribution)

</code></pre>

<hr>
<h2 id='clustering_genetic_algorithm'>Clustering of the solutions of the genetic algorithm using the hclust algorithm</h2><span id='topic+clustering_genetic_algorithm'></span>

<h3>Description</h3>

<p>Clustering of the solutions of the genetic algorithm using the hclust algorithm
</p>


<h3>Usage</h3>

<pre><code class='language-R'>clustering_genetic_algorithm(
  genetic_results,
  ATCtree,
  dist.normalize = TRUE,
  umap_config = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="clustering_genetic_algorithm_+3A_genetic_results">genetic_results</code></td>
<td>
<p>A list of cocktails in the form of integer vector</p>
</td></tr>
<tr><td><code id="clustering_genetic_algorithm_+3A_atctree">ATCtree</code></td>
<td>
<p>ATC tree with upper bound of the DFS</p>
</td></tr>
<tr><td><code id="clustering_genetic_algorithm_+3A_dist.normalize">dist.normalize</code></td>
<td>
<p>Do we normalize the distance (so it belongs to [0;1])</p>
</td></tr>
<tr><td><code id="clustering_genetic_algorithm_+3A_umap_config">umap_config</code></td>
<td>
<p>The configuration to use in order to project the cocktails in a smaller space (umap::umap.defaults by default)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A dataframe containing UMAP 1/2 the two coordinates of each cocktails in the plane as well as the cluster number of each cocktails
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 data("ATC_Tree_UpperBound_2024")

 results = GeneticAlgorithm(epochs = 10, nbIndividuals = 10, 
            ATCtree = ATC_Tree_UpperBound_2024,
            observations = FAERS_myopathy)

 hclust_genetic_solution(genetic_results = results,
                 ATCtree = ATC_Tree_UpperBound_2024)

</code></pre>

<hr>
<h2 id='compute_hypergeom_on_list'>Function used to compute the Hypergeometric score on a list of cocktails</h2><span id='topic+compute_hypergeom_on_list'></span>

<h3>Description</h3>

<p>Function used to compute the Hypergeometric score on a list of cocktails
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compute_hypergeom_on_list(cocktails, ATCtree, observations, num_thread = 1L)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compute_hypergeom_on_list_+3A_cocktails">cocktails</code></td>
<td>
<p>: A list containing cocktails in the form of vector of integers (ATC index)</p>
</td></tr>
<tr><td><code id="compute_hypergeom_on_list_+3A_atctree">ATCtree</code></td>
<td>
<p>: ATC tree with upper bound of the DFS (without the root)</p>
</td></tr>
<tr><td><code id="compute_hypergeom_on_list_+3A_observations">observations</code></td>
<td>
<p>: observation of the AE based on the medications of each patients
(a DataFrame containing the medication on the first column and the ADR (boolean) on the second)
on which we want to compute the risk distribution</p>
</td></tr>
<tr><td><code id="compute_hypergeom_on_list_+3A_num_thread">num_thread</code></td>
<td>
<p>: Number of thread to run in parallel if openMP is available, 1 by default</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Hypergeometric score among &quot;cocktails&quot; parameters
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("ATC_Tree_UpperBound_2024")
data("FAERS_myopathy")

cocktails = list(c(561, 904),
               c(1902, 4585))

Hypergeom_of_cocktails = compute_hypergeom_on_list(cocktails = cocktails,
                              ATCtree = ATC_Tree_UpperBound_2024, 
                              observations = FAERS_myopathy)

</code></pre>

<hr>
<h2 id='compute_RR_on_list'>Function used to compute the Relative Risk on a list of cocktails</h2><span id='topic+compute_RR_on_list'></span>

<h3>Description</h3>

<p>Function used to compute the Relative Risk on a list of cocktails
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compute_RR_on_list(cocktails, ATCtree, observations, num_thread = 1L)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compute_RR_on_list_+3A_cocktails">cocktails</code></td>
<td>
<p>: A list containing cocktails in the form of vector of integers (ATC index)</p>
</td></tr>
<tr><td><code id="compute_RR_on_list_+3A_atctree">ATCtree</code></td>
<td>
<p>: ATC tree with upper bound of the DFS (without the root)</p>
</td></tr>
<tr><td><code id="compute_RR_on_list_+3A_observations">observations</code></td>
<td>
<p>: observation of the AE based on the medications of each patients
(a DataFrame containing the medication on the first column and the ADR (boolean) on the second)
on which we want to compute the risk distribution</p>
</td></tr>
<tr><td><code id="compute_RR_on_list_+3A_num_thread">num_thread</code></td>
<td>
<p>: Number of thread to run in parallel if openMP is available, 1 by default</p>
</td></tr>
</table>


<h3>Value</h3>

<p>RR score among &quot;cocktails&quot; parameters
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("ATC_Tree_UpperBound_2024")
data("FAERS_myopathy")

cocktails = list(c(561, 904),
               c(1902, 4585))

RR_of_cocktails = compute_RR_on_list(cocktails = cocktails,
                              ATCtree = ATC_Tree_UpperBound_2024, 
                              observations = FAERS_myopathy)

</code></pre>

<hr>
<h2 id='computeMetrics_size2'>Function used in the reference article to compare diverse Disproportionality Analysis metrics</h2><span id='topic+computeMetrics_size2'></span>

<h3>Description</h3>

<p>Function used in the reference article to compare diverse Disproportionality Analysis metrics
</p>


<h3>Usage</h3>

<pre><code class='language-R'>computeMetrics_size2(CocktailList, ATCtree, observations, num_thread = 1L)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="computeMetrics_size2_+3A_cocktaillist">CocktailList</code></td>
<td>
<p>: A list of cocktails on which the Disproportionality analysis metrics should be computed</p>
</td></tr>
<tr><td><code id="computeMetrics_size2_+3A_atctree">ATCtree</code></td>
<td>
<p>: ATC tree with upper bound of the DFS (without the root)</p>
</td></tr>
<tr><td><code id="computeMetrics_size2_+3A_observations">observations</code></td>
<td>
<p>: observation of the AE based on the medications of each patients
(a DataFrame containing the medication on the first column and the ADR (boolean) on the second)
on which we want to compute the risk distribution</p>
</td></tr>
<tr><td><code id="computeMetrics_size2_+3A_num_thread">num_thread</code></td>
<td>
<p>: Number of thread to run in parallel if openMP is available, 1 by default</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Multiple DA metrics computed on CocktailList cocktails
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("ATC_Tree_UpperBound_2024")
data("FAERS_myopathy")

cocktails = list(c(561, 904),
               c(1902, 4585)) # only size 2 cocktails allowed for this function

scores_of_cocktails = computeMetrics_size2(CocktailList = cocktails,
                              ATCtree = ATC_Tree_UpperBound_2024, 
                              observations = FAERS_myopathy[1:100,])

</code></pre>

<hr>
<h2 id='csv_to_population'>Function used to convert your genetic algorithm results that are stored into 
a .csv file to a Data structure that can be used by the clustering algorithm</h2><span id='topic+csv_to_population'></span>

<h3>Description</h3>

<p>Function used to convert your genetic algorithm results that are stored into 
a .csv file to a Data structure that can be used by the clustering algorithm
</p>


<h3>Usage</h3>

<pre><code class='language-R'>csv_to_population(ATC_name, filename, sep = ";")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="csv_to_population_+3A_atc_name">ATC_name</code></td>
<td>
<p>the ATC_name column of the ATC tree</p>
</td></tr>
<tr><td><code id="csv_to_population_+3A_filename">filename</code></td>
<td>
<p>Name of the file where the results are located</p>
</td></tr>
<tr><td><code id="csv_to_population_+3A_sep">sep</code></td>
<td>
<p>the separator to use when opening the csv file (';' by default)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An R List that can be used by other algorithms (e.g. clustering algorithm)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  data("ATC_Tree_UpperBound_2024")
  genetic_results = csv_to_population(ATC_Tree_UpperBound_2024$Name,
                    "path/to/output.csv")

</code></pre>

<hr>
<h2 id='DistributionApproximation'>The MCMC method that runs the random walk on a single cocktail in order to estimate the distribution of score among cocktails of size Smax.</h2><span id='topic+DistributionApproximation'></span>

<h3>Description</h3>

<p>The MCMC method that runs the random walk on a single cocktail in order to estimate the distribution of score among cocktails of size Smax.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>DistributionApproximation(
  epochs,
  ATCtree,
  observations,
  temperature = 1L,
  nbResults = 5L,
  Smax = 2L,
  p_type1 = 0.01,
  beta = 4L,
  max_score = 500L,
  num_thread = 1L,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="DistributionApproximation_+3A_epochs">epochs</code></td>
<td>
<p>: number of steps for the MCMC algorithm</p>
</td></tr>
<tr><td><code id="DistributionApproximation_+3A_atctree">ATCtree</code></td>
<td>
<p>: ATC tree with upper bound of the DFS (without the root, also see on the github repo for an example)</p>
</td></tr>
<tr><td><code id="DistributionApproximation_+3A_observations">observations</code></td>
<td>
<p>: real observation of the AE based on the medications of each patients
(a DataFrame containing the medication on the first column and the ADR (boolean) on the second)</p>
</td></tr>
<tr><td><code id="DistributionApproximation_+3A_temperature">temperature</code></td>
<td>
<p>: starting temperature, default = 1 (denoted T in the article)</p>
</td></tr>
<tr><td><code id="DistributionApproximation_+3A_nbresults">nbResults</code></td>
<td>
<p>: Number of returned solution (Cocktail of size Smax with the best oberved score during the run), 5 by default</p>
</td></tr>
<tr><td><code id="DistributionApproximation_+3A_smax">Smax</code></td>
<td>
<p>: Size of the cocktail we approximate the distribution from</p>
</td></tr>
<tr><td><code id="DistributionApproximation_+3A_p_type1">p_type1</code></td>
<td>
<p>: probability to operate type1 mutation. Note :
the probability to operate the type 2 mutation is then 1 - P_type1. P_type1 must be in [0;1]. Default is .01</p>
</td></tr>
<tr><td><code id="DistributionApproximation_+3A_beta">beta</code></td>
<td>
<p>: filter the minimum number of patients that must have taken the 
cocktail for his risk to be taken into account in the DistributionScoreBeta default is 4</p>
</td></tr>
<tr><td><code id="DistributionApproximation_+3A_max_score">max_score</code></td>
<td>
<p>: maximum number the score can take. Score greater than this 
one would be added to the distribution as the value max_score. Default is 500</p>
</td></tr>
<tr><td><code id="DistributionApproximation_+3A_num_thread">num_thread</code></td>
<td>
<p>: Number of thread to run in parallel if openMP is available, 1 by default</p>
</td></tr>
<tr><td><code id="DistributionApproximation_+3A_verbose">verbose</code></td>
<td>
<p>: Output summary (default is false)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>I no problem, return a List containing :
- ScoreDistribution : the distribution of the score as an array with each cells
representing the number of risks =  (index-1)/ 10
- Outstanding_score : An array of the score greater than max_score,
- Best_cocktails : the nbResults bests cocktails encountered during the run.
- Best_scores : Score corresponding to the bestCocktails.
- FilteredDistribution : Distribution containing score for cocktails taken by at
least beta patients.
- Best_cocktails_beta : the nbResults bests cocktails taken by at least beta patients
encountered during the run.
- Best_scores_beta : Score corresponding to the bestCocktailsBeta.
- cocktailSize : Smax parameter used during the run.
; Otherwise the list is empty
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("ATC_Tree_UpperBound_2024")
data("FAERS_myopathy")

estimation = DistributionApproximation(epochs = 10, ATCtree = ATC_Tree_UpperBound_2024,
            observations = FAERS_myopathy)

</code></pre>

<hr>
<h2 id='FAERS_myopathy'>FAERS Myopathy Dataset</h2><span id='topic+FAERS_myopathy'></span>

<h3>Description</h3>

<p>Example dataset representing drug intake and adverse event reports from FAERS.
This dataset is provided to demonstrate the functionality of genetic and MCMC algorithms in the package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>FAERS_myopathy
</code></pre>


<h3>Format</h3>

<p>A data frame with 2 columns:
</p>

<dl>
<dt>patientATC</dt><dd><p>Drug intake for each patient as a vector of ATC tree indices</p>
</dd>
<dt>patientADR</dt><dd><p>Indicates if the patient experienced myopathy as an adverse event</p>
</dd>
</dl>



<h3>Source</h3>

<p>Food &amp; Drug Administration Event Reporting System (FAERS)
</p>

<hr>
<h2 id='GeneticAlgorithm'>Genetic algorithm, trying to reach riskiest cocktails (the ones which maximize
the fitness function, Hypergeometric score in our case)</h2><span id='topic+GeneticAlgorithm'></span>

<h3>Description</h3>

<p>Genetic algorithm, trying to reach riskiest cocktails (the ones which maximize
the fitness function, Hypergeometric score in our case)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GeneticAlgorithm(
  epochs,
  nbIndividuals,
  ATCtree,
  observations,
  num_thread = 1L,
  diversity = FALSE,
  p_crossover = 0.8,
  p_mutation = 0.01,
  nbElite = 0L,
  tournamentSize = 2L,
  alpha = 1,
  summary = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="GeneticAlgorithm_+3A_epochs">epochs</code></td>
<td>
<p>: number of step or the algorithm</p>
</td></tr>
<tr><td><code id="GeneticAlgorithm_+3A_nbindividuals">nbIndividuals</code></td>
<td>
<p>: size of the population</p>
</td></tr>
<tr><td><code id="GeneticAlgorithm_+3A_atctree">ATCtree</code></td>
<td>
<p>: ATC tree with upper bound of the DFS (without the root)</p>
</td></tr>
<tr><td><code id="GeneticAlgorithm_+3A_observations">observations</code></td>
<td>
<p>: real observation of the AE based on the medications of each patients
(a DataFrame containing the medication on the first column and the ADR (boolean) on the second)</p>
</td></tr>
<tr><td><code id="GeneticAlgorithm_+3A_num_thread">num_thread</code></td>
<td>
<p>: Number of thread to run in parallel if openMP is available, 1 by default</p>
</td></tr>
<tr><td><code id="GeneticAlgorithm_+3A_diversity">diversity</code></td>
<td>
<p>: enable the diversity mechanism of the algorithm
(favor the diversity of cocktail in the population),  default is false</p>
</td></tr>
<tr><td><code id="GeneticAlgorithm_+3A_p_crossover">p_crossover</code></td>
<td>
<p>: probability to operate a crossover on the crossover phase. Default is 80%</p>
</td></tr>
<tr><td><code id="GeneticAlgorithm_+3A_p_mutation">p_mutation</code></td>
<td>
<p>: probability to operate a mutation after the crossover phase. Default is 1%</p>
</td></tr>
<tr><td><code id="GeneticAlgorithm_+3A_nbelite">nbElite</code></td>
<td>
<p>: number of best individual we keep from generation to generation. Default is 0</p>
</td></tr>
<tr><td><code id="GeneticAlgorithm_+3A_tournamentsize">tournamentSize</code></td>
<td>
<p>: size of the tournament (select the best individual 
between tournamentSize sampled individuals)</p>
</td></tr>
<tr><td><code id="GeneticAlgorithm_+3A_alpha">alpha</code></td>
<td>
<p>: when making a type 1 mutation you have (alpha / size of cocktail) chance to add a drug.</p>
</td></tr>
<tr><td><code id="GeneticAlgorithm_+3A_summary">summary</code></td>
<td>
<p>: print the summary of population at each steps ?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If no problem, return a List :
- meanFitnesses : The mean score of the population at each epochs of the algorithm.
- BestFitnesses : The best score of the population at each epochs of the algorithm.
- FinalPopulation : The final population of the algorithm when finished (medications
and corresponding scores)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("ATC_Tree_UpperBound_2024")
data("FAERS_myopathy")

results = GeneticAlgorithm(epochs = 10, nbIndividuals = 10, 
            ATCtree = ATC_Tree_UpperBound_2024,
            observations = FAERS_myopathy)

</code></pre>

<hr>
<h2 id='get_dissimilarity_from_cocktail_list'>Recover the square matrix of distance between cocktails where the index (i,j)
of the matrix is the distance between cocktails i and j in an arbitrary
cocktail list</h2><span id='topic+get_dissimilarity_from_cocktail_list'></span>

<h3>Description</h3>

<p>Recover the square matrix of distance between cocktails where the index (i,j)
of the matrix is the distance between cocktails i and j in an arbitrary
cocktail list
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_dissimilarity_from_cocktail_list(cocktails, ATCtree, normalization = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_dissimilarity_from_cocktail_list_+3A_cocktails">cocktails</code></td>
<td>
<p>: A list of cocktails in the form of a vector of integer</p>
</td></tr>
<tr><td><code id="get_dissimilarity_from_cocktail_list_+3A_atctree">ATCtree</code></td>
<td>
<p>: ATC tree with upper bound of the DFS (without the root)</p>
</td></tr>
<tr><td><code id="get_dissimilarity_from_cocktail_list_+3A_normalization">normalization</code></td>
<td>
<p>: Do we keep the distance between cocktail in the range [0;1] ?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The square matrix of distances between cocktails
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("ATC_Tree_UpperBound_2024")

cocktails = list(c(561, 904),
               c(1902, 4585)) # only size 2 cocktails allowed for this function

distance_matrix = get_dissimilarity_from_cocktail_list(cocktails = cocktails,
                              ATCtree = ATC_Tree_UpperBound_2024, 
                              normalization = TRUE)

</code></pre>

<hr>
<h2 id='get_dissimilarity_from_genetic_results'>Recover the square matrix of distance between cocktails where the index (i,j)
of the matrix is the distance between cocktails i and j in the genetic_results
list.</h2><span id='topic+get_dissimilarity_from_genetic_results'></span>

<h3>Description</h3>

<p>Recover the square matrix of distance between cocktails where the index (i,j)
of the matrix is the distance between cocktails i and j in the genetic_results
list.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_dissimilarity_from_genetic_results(genetic_results, ATCtree, normalization)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_dissimilarity_from_genetic_results_+3A_genetic_results">genetic_results</code></td>
<td>
<p>the List returned by the genetic algorithm.</p>
</td></tr>
<tr><td><code id="get_dissimilarity_from_genetic_results_+3A_atctree">ATCtree</code></td>
<td>
<p>: ATC tree with upper bound of the DFS (without the root)</p>
</td></tr>
<tr><td><code id="get_dissimilarity_from_genetic_results_+3A_normalization">normalization</code></td>
<td>
<p>: Do we keep the distance between cocktail in the range [0;1] ?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The square matrix of distances between cocktails
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 data("ATC_Tree_UpperBound_2024")
 data("FAERS_myopathy")
 
 genetic_results = GeneticAlgorithm(epochs = 10, nbIndividuals = 10,
            ATCtree = ATC_Tree_UpperBound_2024,
            observations = FAERS_myopathy)
 distance_matrix = get_dissimilarity_from_genetic_results(genetic_results = genetic_results,
                        ATCtree = ATC_Tree_UpperBound_2024, normalization = TRUE)

</code></pre>

<hr>
<h2 id='get_dissimilarity_from_txt_file'>Recover the square matrix of distance between cocktails where the index (i,j)
of the matrix is the distance between cocktails i and j in the csv file containing
results of genetic algorithm</h2><span id='topic+get_dissimilarity_from_txt_file'></span>

<h3>Description</h3>

<p>Recover the square matrix of distance between cocktails where the index (i,j)
of the matrix is the distance between cocktails i and j in the csv file containing
results of genetic algorithm
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_dissimilarity_from_txt_file(filename, ATCtree, normalization = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_dissimilarity_from_txt_file_+3A_filename">filename</code></td>
<td>
<p>: the name of the file returned by the print_csv function.</p>
</td></tr>
<tr><td><code id="get_dissimilarity_from_txt_file_+3A_atctree">ATCtree</code></td>
<td>
<p>: ATC tree with upper bound of the DFS (without the root)</p>
</td></tr>
<tr><td><code id="get_dissimilarity_from_txt_file_+3A_normalization">normalization</code></td>
<td>
<p>: Do we keep the distance between cocktail in the range [0;1] ?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The square matrix of distances between cocktails
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 data("ATC_Tree_UpperBound_2024")
 
 distance_matrix = get_dissimilarity_from_txt_file(filename = '250e_700ind_0.2mr_0ne_2alpha.txt',
                        ATCtree = ATC_Tree_UpperBound_2024, normalization = TRUE)

</code></pre>

<hr>
<h2 id='hclust_genetic_solution'>Clustering of the solutions of the genetic algorithm using the hclust algorithm</h2><span id='topic+hclust_genetic_solution'></span>

<h3>Description</h3>

<p>Clustering of the solutions of the genetic algorithm using the hclust algorithm
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hclust_genetic_solution(
  genetic_results,
  ATCtree,
  dist.normalize = TRUE,
  method = "complete"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hclust_genetic_solution_+3A_genetic_results">genetic_results</code></td>
<td>
<p>The return value of the genetic algorithm</p>
</td></tr>
<tr><td><code id="hclust_genetic_solution_+3A_atctree">ATCtree</code></td>
<td>
<p>ATC tree with upper bound of the DFS</p>
</td></tr>
<tr><td><code id="hclust_genetic_solution_+3A_dist.normalize">dist.normalize</code></td>
<td>
<p>Do we normalize the distance (so it bellongs to [0;1])</p>
</td></tr>
<tr><td><code id="hclust_genetic_solution_+3A_method">method</code></td>
<td>
<p>(from hclust function) the agglomeration method to be used. This should be (an unambiguous abbreviation of) one of &quot;ward.D&quot;, &quot;ward.D2&quot;, &quot;single&quot;, &quot;complete&quot;, &quot;average&quot; (= UPGMA), &quot;mcquitty&quot; (= WPGMA), &quot;median&quot; (= WPGMC) or &quot;centroid&quot; (= UPGMC).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the hierarchical clustering of the results of the genetic algorithm
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("ATC_Tree_UpperBound_2024")
data("FAERS_myopathy")

results = GeneticAlgorithm(epochs = 10, nbIndividuals = 10, 
            ATCtree = ATC_Tree_UpperBound_2024,
            observations = FAERS_myopathy)

hclust_genetic_solution(genetic_results = results,
                 ATCtree = ATC_Tree_UpperBound_2024)

</code></pre>

<hr>
<h2 id='histogramToDitribution'>Convert the histogram returned by the DistributionApproximation function, to a real number distribution
(that can be used in a test for example)</h2><span id='topic+histogramToDitribution'></span>

<h3>Description</h3>

<p>Convert the histogram returned by the DistributionApproximation function, to a real number distribution
(that can be used in a test for example)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>histogramToDitribution(vec)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="histogramToDitribution_+3A_vec">vec</code></td>
<td>
<p>: distribution returned by the DistributionAproximationFunction</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector containing sampled risk during the MCMC algorithm
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("ATC_Tree_UpperBound_2024")
data("FAERS_myopathy")

 DistributionApproximationResults = DistributionApproximation(epochs = 10,
            ATCtree = ATC_Tree_UpperBound_2024, observations = FAERS_myopathy)
  histogramToDitribution(DistributionApproximationResults$ScoreDistribution)

</code></pre>

<hr>
<h2 id='hyperparam_test_genetic_algorithm'>This function can be used in order to try different set of parameters for the genetic
algorithm in a convenient way. This will run each combination of mutation_rate,
nb_elite and alphas possible nb_test_desired times. For each sets of parameters,
results will be saved in a file named according to the set of parameter. One
can regroup the results of each run in a csv file by using the print_csv function
specifying the names of each file that needs to be treated and the number of 
performed runs on each parameter set</h2><span id='topic+hyperparam_test_genetic_algorithm'></span>

<h3>Description</h3>

<p>This function can be used in order to try different set of parameters for the genetic
algorithm in a convenient way. This will run each combination of mutation_rate,
nb_elite and alphas possible nb_test_desired times. For each sets of parameters,
results will be saved in a file named according to the set of parameter. One
can regroup the results of each run in a csv file by using the print_csv function
specifying the names of each file that needs to be treated and the number of 
performed runs on each parameter set
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hyperparam_test_genetic_algorithm(
  epochs,
  nb_individuals,
  ATCtree,
  observations,
  nb_test_desired,
  mutation_rate,
  nb_elite,
  alphas,
  path = "./",
  num_thread = 1L
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hyperparam_test_genetic_algorithm_+3A_epochs">epochs</code></td>
<td>
<p>: the number of epochs for the genetic algorithm</p>
</td></tr>
<tr><td><code id="hyperparam_test_genetic_algorithm_+3A_nb_individuals">nb_individuals</code></td>
<td>
<p>: the size of the population in the genetic algorithm</p>
</td></tr>
<tr><td><code id="hyperparam_test_genetic_algorithm_+3A_atctree">ATCtree</code></td>
<td>
<p>: ATC tree with upper bound of the DFS (without the root)</p>
</td></tr>
<tr><td><code id="hyperparam_test_genetic_algorithm_+3A_observations">observations</code></td>
<td>
<p>: observation of the AE based on the medications of each patients
(a DataFrame containing the medication on the first column and the ADR (boolean) on the second)
on which we want to compute the risk distribution</p>
</td></tr>
<tr><td><code id="hyperparam_test_genetic_algorithm_+3A_nb_test_desired">nb_test_desired</code></td>
<td>
<p>: number of genetic algorithm runs on each sets of parameters</p>
</td></tr>
<tr><td><code id="hyperparam_test_genetic_algorithm_+3A_mutation_rate">mutation_rate</code></td>
<td>
<p>: a vector with each mutation_rate to be tested</p>
</td></tr>
<tr><td><code id="hyperparam_test_genetic_algorithm_+3A_nb_elite">nb_elite</code></td>
<td>
<p>: a vector with each nb_elite to be tested</p>
</td></tr>
<tr><td><code id="hyperparam_test_genetic_algorithm_+3A_alphas">alphas</code></td>
<td>
<p>: a vector with each alphas to be tested</p>
</td></tr>
<tr><td><code id="hyperparam_test_genetic_algorithm_+3A_path">path</code></td>
<td>
<p>: the path where the resulting files should be written</p>
</td></tr>
<tr><td><code id="hyperparam_test_genetic_algorithm_+3A_num_thread">num_thread</code></td>
<td>
<p>: Number of thread to run in parallel if openMP is available, 1 by default</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, this function should output results of the runs of the 
genetic algorithm in a specific format supported by function print_csv
and p_value_csv_file. The files are outputed in path which is current 
directory by default.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("ATC_Tree_UpperBound_2024")
data("FAERS_myopathy")

# different parameter to test for
mutation_rate = c(.1,.2,.3)
nb_elite = c(0,1,2)
alphas = c(0.5,1,2)
hyperparam_test_genetic_algorithm(epochs = 2, nb_individuals = 2,
                              ATCtree = ATC_Tree_UpperBound_2024, 
                              observations = FAERS_myopathy,
                              nb_test_desired = 5, mutation_rate = mutation_rate,
                              nb_elite = nb_elite, alphas = alphas)

</code></pre>

<hr>
<h2 id='int_cocktail_to_string_cocktail'>Function used to convert integer cocktails (like the one outputed by the distributionApproximation function)
to string cocktail in order to make them more readable</h2><span id='topic+int_cocktail_to_string_cocktail'></span>

<h3>Description</h3>

<p>Function used to convert integer cocktails (like the one outputed by the distributionApproximation function)
to string cocktail in order to make them more readable
</p>


<h3>Usage</h3>

<pre><code class='language-R'>int_cocktail_to_string_cocktail(cocktails, ATC_name)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="int_cocktail_to_string_cocktail_+3A_cocktails">cocktails</code></td>
<td>
<p>cocktails vector to be converted (index in the ATC tree)</p>
</td></tr>
<tr><td><code id="int_cocktail_to_string_cocktail_+3A_atc_name">ATC_name</code></td>
<td>
<p>The ATC_name column of the ATC tree</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The name of integer cocktails in cocktails
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  data("ATC_Tree_UpperBound_2024")
  int_list = list(c(561, 904),
               c(1902, 4585))
  int_cocktail_to_string_cocktail(int_list, ATC_Tree_UpperBound_2024$Name)

</code></pre>

<hr>
<h2 id='OutsandingScoreToDistribution'>Output the outstanding score (Outstanding_score) outputed by the MCMC algorithm
in a special format</h2><span id='topic+OutsandingScoreToDistribution'></span>

<h3>Description</h3>

<p>Output the outstanding score (Outstanding_score) outputed by the MCMC algorithm
in a special format
</p>


<h3>Usage</h3>

<pre><code class='language-R'>OutsandingScoreToDistribution(outstanding_score, max_score)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="OutsandingScoreToDistribution_+3A_outstanding_score">outstanding_score</code></td>
<td>
<p>: Outstanding_score outputed by MCMC algorithm to be converted
to the ScoreDistribution format</p>
</td></tr>
<tr><td><code id="OutsandingScoreToDistribution_+3A_max_score">max_score</code></td>
<td>
<p>: max_score parameter used during the MCMC algorithm</p>
</td></tr>
</table>


<h3>Value</h3>

<p>outstanding_score in a format compatible with MCMC algorithm output
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 data("ATC_Tree_UpperBound_2024")
 data("FAERS_myopathy")

  DistributionApproximationResults = DistributionApproximation(epochs = 10,
            ATCtree = ATC_Tree_UpperBound_2024, observations = FAERS_myopathy)
  OutsandingScoreToDistribution(DistributionApproximationResults$Outstanding_score, max_score = 100)

</code></pre>

<hr>
<h2 id='p_value_cocktails'>Used to add the p_value to each cocktail of cocktail list</h2><span id='topic+p_value_cocktails'></span>

<h3>Description</h3>

<p>Used to add the p_value to each cocktail of cocktail list
</p>


<h3>Usage</h3>

<pre><code class='language-R'>p_value_cocktails(
  distribution_outputs,
  cocktails,
  ATCtree,
  observations,
  num_thread = 1L,
  filtred_distribution = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="p_value_cocktails_+3A_distribution_outputs">distribution_outputs</code></td>
<td>
<p>A list of distribution of cocktails of different sizes
in order to compute the p_value for multiple cocktail sizes</p>
</td></tr>
<tr><td><code id="p_value_cocktails_+3A_cocktails">cocktails</code></td>
<td>
<p>A list containing cocktails in the form of vector of integers (ATC index)</p>
</td></tr>
<tr><td><code id="p_value_cocktails_+3A_atctree">ATCtree</code></td>
<td>
<p>ATC tree with upper bound of the DFS (without the root)</p>
</td></tr>
<tr><td><code id="p_value_cocktails_+3A_observations">observations</code></td>
<td>
<p>observation of the AE based on the medications of each patients
(a DataFrame containing the medication on the first column and the ADR (boolean) on the second)
on which we want to compute the risk distribution</p>
</td></tr>
<tr><td><code id="p_value_cocktails_+3A_num_thread">num_thread</code></td>
<td>
<p>Number of thread to run in parallel if openMP is available, 1 by default</p>
</td></tr>
<tr><td><code id="p_value_cocktails_+3A_filtred_distribution">filtred_distribution</code></td>
<td>
<p>Does the p-values have to be computed using filtered distribution
or normal distribution (filtered distribution by default)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A real valued number vector representing the p-value of the inputed
cocktails computed on the distribution_outputs List.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 data("ATC_Tree_UpperBound_2024")
 data("FAERS_myopathy")
 
  DistributionApproximationResults_size2 = DistributionApproximation(epochs = 10,
            ATCtree = ATC_Tree_UpperBound_2024, observations = FAERS_myopathy, Smax = 2)
            
  DistributionApproximationResults_size3 = DistributionApproximation(epochs = 10,
            ATCtree = ATC_Tree_UpperBound_2024, observations = FAERS_myopathy, Smax = 3)
            
  score_distribution_list = list(DistributionApproximationResults_size2,
                              DistributionApproximationResults_size3)

  cocktails = list(c(561, 904),
               c(1902, 4585))
 
  p_value_cocktails(score_distribution_list, cocktails, ATC_Tree_UpperBound_2024,
                    FAERS_myopathy)

</code></pre>

<hr>
<h2 id='p_value_csv_file'>Used to add the p_value to each cocktail of a csv_file that is an
output of the genetic algorithm</h2><span id='topic+p_value_csv_file'></span>

<h3>Description</h3>

<p>Used to add the p_value to each cocktail of a csv_file that is an
output of the genetic algorithm
</p>


<h3>Usage</h3>

<pre><code class='language-R'>p_value_csv_file(
  distribution_outputs,
  filename,
  filtred_distribution = FALSE,
  sep = ";"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="p_value_csv_file_+3A_distribution_outputs">distribution_outputs</code></td>
<td>
<p>A list of distribution of cocktails of different sizes
in order to compute the p_value for multiple cocktail sizes</p>
</td></tr>
<tr><td><code id="p_value_csv_file_+3A_filename">filename</code></td>
<td>
<p>The file name of the .csv file containing the output</p>
</td></tr>
<tr><td><code id="p_value_csv_file_+3A_filtred_distribution">filtred_distribution</code></td>
<td>
<p>Does the p-values have to be computed using filtered distribution
or normal distribution (filtered distribution by default)</p>
</td></tr>
<tr><td><code id="p_value_csv_file_+3A_sep">sep</code></td>
<td>
<p>The separator used in the csv file (';' by default)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A real valued number vector representing the p-value of the inputed
csv file filename, computed on the distribution_outputs List.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 data("ATC_Tree_UpperBound_2024")
 data("FAERS_myopathy")

  DistributionApproximationResults_size2 = DistributionApproximation(epochs = 10,
            ATCtree = ATC_Tree_UpperBound_2024, observations = FAERS_myopathy, Smax = 2)
            
  DistributionApproximationResults_size3 = DistributionApproximation(epochs = 10,
            ATCtree = ATC_Tree_UpperBound_2024, observations = FAERS_myopathy, Smax = 3)
            
  score_distribution_list = list(DistributionApproximationResults_size2,
                              DistributionApproximationResults_size3)
  p_value_csv_file(score_distribution_list, "path/to/output.csv")

</code></pre>

<hr>
<h2 id='p_value_genetic_results'>Used to add the p_value to each cocktail of an output of the genetic algorithm</h2><span id='topic+p_value_genetic_results'></span>

<h3>Description</h3>

<p>Used to add the p_value to each cocktail of an output of the genetic algorithm
</p>


<h3>Usage</h3>

<pre><code class='language-R'>p_value_genetic_results(
  distribution_outputs,
  genetic_results,
  filtred_distribution = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="p_value_genetic_results_+3A_distribution_outputs">distribution_outputs</code></td>
<td>
<p>A list of distribution of cocktails of different sizes
in order to compute the p_value for multiple cocktail sizes</p>
</td></tr>
<tr><td><code id="p_value_genetic_results_+3A_genetic_results">genetic_results</code></td>
<td>
<p>outputs of the genetic algorithm</p>
</td></tr>
<tr><td><code id="p_value_genetic_results_+3A_filtred_distribution">filtred_distribution</code></td>
<td>
<p>Does the p-values have to be computed using filtered distribution
or normal distribution (filtered distribution by default)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A real valued number vector representing the p-value of the inputed
genetic algorithm results (genetic_results) computed on the 
distribution_outputs List.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 data("ATC_Tree_UpperBound_2024")
 data("FAERS_myopathy")
  DistributionApproximationResults_size2 = DistributionApproximation(epochs = 10,
            ATCtree = ATC_Tree_UpperBound_2024, observations = FAERS_myopathy, Smax = 2)
            
  DistributionApproximationResults_size3 = DistributionApproximation(epochs = 10,
            ATCtree = ATC_Tree_UpperBound_2024, observations = FAERS_myopathy, Smax = 3)
            
  score_distribution_list = list(DistributionApproximationResults_size2,
                              DistributionApproximationResults_size3)
  genetic_results = GeneticAlgorithm(epochs = 10, nbIndividuals = 20, 
            ATCtree = ATC_Tree_UpperBound_2024,
            observations = FAERS_myopathy)
  p_value_genetic_results(score_distribution_list, genetic_results)

</code></pre>

<hr>
<h2 id='p_value_on_sampled'>Calculate p-value of sampled value</h2><span id='topic+p_value_on_sampled'></span>

<h3>Description</h3>

<p>Calculate p-value of sampled value
</p>


<h3>Usage</h3>

<pre><code class='language-R'>p_value_on_sampled(
  empirical_distribution,
  sampled_values,
  isFiltered = FALSE,
  includeZeroValue = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="p_value_on_sampled_+3A_empirical_distribution">empirical_distribution</code></td>
<td>
<p>A numeric vector of values representing the empirical distribution (return value of DistributionAproximation function)</p>
</td></tr>
<tr><td><code id="p_value_on_sampled_+3A_sampled_values">sampled_values</code></td>
<td>
<p>A scalar or a vector of real valued number representing the sampled value (score to be tested)</p>
</td></tr>
<tr><td><code id="p_value_on_sampled_+3A_isfiltered">isFiltered</code></td>
<td>
<p>A boolean representing if we want to use the filtered distribution or the distribution as is (False by default)</p>
</td></tr>
<tr><td><code id="p_value_on_sampled_+3A_includezerovalue">includeZeroValue</code></td>
<td>
<p>A boolean that indicate if you want to take into account the null score (False by default)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric value representing the empirical p-value
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("ATC_Tree_UpperBound_2024")
data("FAERS_myopathy")

cocktails = list(c(561, 904),
               c(1902, 4585))
               
estimated_score_distribution = DistributionApproximation(epochs = 10,
            ATCtree = ATC_Tree_UpperBound_2024,
            observations = FAERS_myopathy)
            
Hypergeom_of_cocktails = compute_hypergeom_on_list(cocktails = cocktails,
                              ATCtree = ATC_Tree_UpperBound_2024, 
                              observations = FAERS_myopathy)
            
p_value = p_value_on_sampled(empirical_distribution = estimated_score_distribution,
      sampled_values = Hypergeom_of_cocktails)

</code></pre>

<hr>
<h2 id='plot_evolution'>Plot the evolution of the mean and the best value of the population used by the GeneticAlgorithm</h2><span id='topic+plot_evolution'></span>

<h3>Description</h3>

<p>Plot the evolution of the mean and the best value of the population used by the GeneticAlgorithm
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_evolution(
  list,
  mean_color = "#F2A900",
  best_color = "#008080",
  xlab = "Epochs",
  ylab = "Score"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_evolution_+3A_list">list</code></td>
<td>
<p>A list with 2 elements returned by the GeneticAlgorithm: &quot;mean&quot; and &quot;best&quot;, containing the numeric vectors representing the mean and best fitness of the population</p>
</td></tr>
<tr><td><code id="plot_evolution_+3A_mean_color">mean_color</code></td>
<td>
<p>A string specifying the color of the mean values</p>
</td></tr>
<tr><td><code id="plot_evolution_+3A_best_color">best_color</code></td>
<td>
<p>A string specifying the color of the best values</p>
</td></tr>
<tr><td><code id="plot_evolution_+3A_xlab">xlab</code></td>
<td>
<p>A string specifying the label for the x-axis</p>
</td></tr>
<tr><td><code id="plot_evolution_+3A_ylab">ylab</code></td>
<td>
<p>A string specifying the label for the y-axis</p>
</td></tr>
</table>


<h3>Value</h3>

<p>no returned value, should plot the evolution of the genetic algorithm
results (mean/max score for each epoch).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("ATC_Tree_UpperBound_2024")
data("FAERS_myopathy")

results = GeneticAlgorithm(epochs = 10, nbIndividuals = 10, 
            ATCtree = ATC_Tree_UpperBound_2024,
            observations = FAERS_myopathy)

plot_evolution(list = results)

</code></pre>

<hr>
<h2 id='plot_frequency'>Plot the histogram of the approximation of the RR distribution</h2><span id='topic+plot_frequency'></span>

<h3>Description</h3>

<p>Plot the histogram of the approximation of the RR distribution
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_frequency(
  estimated,
  sqrt = FALSE,
  binwidth = 0.1,
  hist_color = "#69b3a2",
  density_color = "#FF5733",
  xlab = "Score"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_frequency_+3A_estimated">estimated</code></td>
<td>
<p>The ScoreDistribution element in the list 
returned by the DistributionApproximation function</p>
</td></tr>
<tr><td><code id="plot_frequency_+3A_sqrt">sqrt</code></td>
<td>
<p>A Boolean to specify whether we normalize the estimated or not, it is recommended on large random walk.</p>
</td></tr>
<tr><td><code id="plot_frequency_+3A_binwidth">binwidth</code></td>
<td>
<p>The width of the histogram bins</p>
</td></tr>
<tr><td><code id="plot_frequency_+3A_hist_color">hist_color</code></td>
<td>
<p>The fill color for the histogram bars</p>
</td></tr>
<tr><td><code id="plot_frequency_+3A_density_color">density_color</code></td>
<td>
<p>The color for the density curve</p>
</td></tr>
<tr><td><code id="plot_frequency_+3A_xlab">xlab</code></td>
<td>
<p>Label of X axis</p>
</td></tr>
</table>


<h3>Value</h3>

<p>no returned value, should plot the histogram of the estimated distribution
(estimated).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("ATC_Tree_UpperBound_2024")
data("FAERS_myopathy")

estimation = DistributionApproximation(epochs = 10, ATCtree = ATC_Tree_UpperBound_2024,
            observations = FAERS_myopathy)

plot_frequency(estimated = estimation$ScoreDistribution)

</code></pre>

<hr>
<h2 id='print_csv'>Print every cocktails found during the genetic algorithm when used with the 
hyperparam_test_genetic_algorithm function. This enables to condense the solutions 
found in each files by collapsing similar cocktail in a single row by cocktail.</h2><span id='topic+print_csv'></span>

<h3>Description</h3>

<p>Print every cocktails found during the genetic algorithm when used with the 
hyperparam_test_genetic_algorithm function. This enables to condense the solutions 
found in each files by collapsing similar cocktail in a single row by cocktail.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>print_csv(
  input_filenames,
  observations,
  repetition,
  ATCtree,
  csv_filename = "solutions.csv"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print_csv_+3A_input_filenames">input_filenames</code></td>
<td>
<p>: A List containing filename of hyperparam_test_genetic_algorithm output file</p>
</td></tr>
<tr><td><code id="print_csv_+3A_observations">observations</code></td>
<td>
<p>: observation of the AE based on the medications of each patients
(a DataFrame containing the medication on the first column and the ADR (boolean) on the second)
on which we want to compute the risk distribution</p>
</td></tr>
<tr><td><code id="print_csv_+3A_repetition">repetition</code></td>
<td>
<p>: The parameter nb_test_desired used in the hyperparam test function</p>
</td></tr>
<tr><td><code id="print_csv_+3A_atctree">ATCtree</code></td>
<td>
<p>: ATC tree with upper bound of the DFS (without the root)</p>
</td></tr>
<tr><td><code id="print_csv_+3A_csv_filename">csv_filename</code></td>
<td>
<p>: Name of the output file, &quot;solutions.csv&quot; by default</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, should process the output of the genetic algorithm in 
files produced by hyperparam_test_genetic_algorithm and output a summary csv file.
The csv file is outputed in current directory and named after the csv_filename
variable (solutions.csv by default).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 data("ATC_Tree_UpperBound_2024")
 data("FAERS_myopathy")
 files = c('250e_700ind_0.2mr_0ne_2alpha.txt') # results of hyperparam_test_genetic_algorithm

 print_csv(input_filenames = files, observations = FAERS_myopathy,
          repetition = 5, ATCtree = ATC_Tree_UpperBound_2024)

</code></pre>

<hr>
<h2 id='qq_plot_output'>Make a Quantile-Quantile diagram from the output of the MCMC algorithm (DistributionAproximation)
and the algorithm that exhaustively calculates the distribution</h2><span id='topic+qq_plot_output'></span>

<h3>Description</h3>

<p>Make a Quantile-Quantile diagram from the output of the MCMC algorithm (DistributionAproximation)
and the algorithm that exhaustively calculates the distribution
</p>


<h3>Usage</h3>

<pre><code class='language-R'>qq_plot_output(estimated, true, filtered = FALSE, color = "steelblue")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="qq_plot_output_+3A_estimated">estimated</code></td>
<td>
<p>Outputed object of DistributionApproximation function</p>
</td></tr>
<tr><td><code id="qq_plot_output_+3A_true">true</code></td>
<td>
<p>Outputed object of either DistributionApproximation function or True distribution
computation function</p>
</td></tr>
<tr><td><code id="qq_plot_output_+3A_filtered">filtered</code></td>
<td>
<p>Make use of the classic distributuion estimation or of the filtred one
(number of patient taking the cocktail &gt; beta)</p>
</td></tr>
<tr><td><code id="qq_plot_output_+3A_color">color</code></td>
<td>
<p>The color of the dashed line of the qq-plot</p>
</td></tr>
</table>


<h3>Value</h3>

<p>no returned value, should plot the quantile-quantile plot
of the estimated distribution (estimated) vs the true distribution (true).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("ATC_Tree_UpperBound_2024")
data("FAERS_myopathy")

estimated_score_distribution = DistributionApproximation(epochs = 10,
            ATCtree = ATC_Tree_UpperBound_2024,
            observations = FAERS_myopathy[1:100,], Smax =2)
            
true_score_distribution = trueDistributionSizeTwoCocktail(ATCtree = ATC_Tree_UpperBound_2024,
            observations = FAERS_myopathy[1:100,], beta = 4)

qq_plot_output(estimated = estimated_score_distribution,
                true = true_score_distribution)

</code></pre>

<hr>
<h2 id='string_list_to_int_cocktails'>Function used to convert a string vector of drugs in form &quot;drug1:drug2&quot; to 
a vector of index of the ATC tree ex: c(ATC_index(drug1), ATC_index(drugs2))</h2><span id='topic+string_list_to_int_cocktails'></span>

<h3>Description</h3>

<p>Function used to convert a string vector of drugs in form &quot;drug1:drug2&quot; to 
a vector of index of the ATC tree ex: c(ATC_index(drug1), ATC_index(drugs2))
</p>


<h3>Usage</h3>

<pre><code class='language-R'>string_list_to_int_cocktails(ATC_name, lines)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="string_list_to_int_cocktails_+3A_atc_name">ATC_name</code></td>
<td>
<p>the ATC_name column of the ATC tree</p>
</td></tr>
<tr><td><code id="string_list_to_int_cocktails_+3A_lines">lines</code></td>
<td>
<p>A string vector of drugs cocktail in the form &quot;drug1:drug2:...:drug_n&quot;</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An R List that can be used by other algorithms (e.g. clustering algorithm)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  data("ATC_Tree_UpperBound_2024")
  string_list = c('hmg coa reductase inhibitors:nervous system',
                  'metformin:prasugrel')
  string_list_to_int_cocktails(ATC_Tree_UpperBound_2024$Name,
                              string_list)

</code></pre>

<hr>
<h2 id='trueDistributionDrugs'>The true distribution of the score among every single nodes of the ATC</h2><span id='topic+trueDistributionDrugs'></span>

<h3>Description</h3>

<p>The true distribution of the score among every single nodes of the ATC
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trueDistributionDrugs(
  ATCtree,
  observations,
  beta,
  max_score = 1000L,
  nbResults = 100L,
  num_thread = 1L
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="trueDistributionDrugs_+3A_atctree">ATCtree</code></td>
<td>
<p>: ATC tree with upper bound of the DFS (without the root)</p>
</td></tr>
<tr><td><code id="trueDistributionDrugs_+3A_observations">observations</code></td>
<td>
<p>: observation of the AE based on the medications of each patients
(a DataFrame containing the medication on the first column and the ADR (boolean) on the second)
on which we want to compute the risk distribution</p>
</td></tr>
<tr><td><code id="trueDistributionDrugs_+3A_beta">beta</code></td>
<td>
<p>: minimum number of person taking the cocktails in order to consider it
in the beta score distribution</p>
</td></tr>
<tr><td><code id="trueDistributionDrugs_+3A_max_score">max_score</code></td>
<td>
<p>: maximum number the score can take. Score greater than this 
one would be added to the distribution as the value max_score. Default is 1000</p>
</td></tr>
<tr><td><code id="trueDistributionDrugs_+3A_nbresults">nbResults</code></td>
<td>
<p>: Number of returned solution (Cocktail with the
best oberved score during the run), 100 by default</p>
</td></tr>
<tr><td><code id="trueDistributionDrugs_+3A_num_thread">num_thread</code></td>
<td>
<p>: Number of thread to run in parallel if openMP is available, 1 by default</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Return a List containing :
- ScoreDistribution : the distribution of the score as an array with each cells
representing the number of risks =  (index-1)/ 10
- Filtered_score_distribution : Distribution containing score for cocktails taken by at
least beta patients.
- Outstanding_score : An array of the score greater than max_score,
- Best_cocktails : the nbResults bests cocktails encountered during the run.
- Best_cocktails_beta : the nbResults bests cocktails taken by at least beta patients
encountered during the run.
- Best_scores : Score corresponding to the Best_cocktails.
- Best_scores_beta : Score corresponding to the Best_cocktails_beta.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("ATC_Tree_UpperBound_2024")
data("FAERS_myopathy")

size_1_score_distribution = trueDistributionDrugs(ATCtree = ATC_Tree_UpperBound_2024,
            observations = FAERS_myopathy[1:100,], beta = 4)

</code></pre>

<hr>
<h2 id='trueDistributionSizeTwoCocktail'>The true distribution of the score among every size-two cocktails</h2><span id='topic+trueDistributionSizeTwoCocktail'></span>

<h3>Description</h3>

<p>The true distribution of the score among every size-two cocktails
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trueDistributionSizeTwoCocktail(
  ATCtree,
  observations,
  beta,
  max_score = 100L,
  nbResults = 100L,
  num_thread = 1L
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="trueDistributionSizeTwoCocktail_+3A_atctree">ATCtree</code></td>
<td>
<p>: ATC tree with upper bound of the DFS (without the root)</p>
</td></tr>
<tr><td><code id="trueDistributionSizeTwoCocktail_+3A_observations">observations</code></td>
<td>
<p>: observation of the AE based on the medications of each patients
(a DataFrame containing the medication on the first column and the ADR (boolean) on the second)
on which we want to compute the risk distribution</p>
</td></tr>
<tr><td><code id="trueDistributionSizeTwoCocktail_+3A_beta">beta</code></td>
<td>
<p>: minimum number of person taking the cocktails in order to consider it
in the beta score distribution</p>
</td></tr>
<tr><td><code id="trueDistributionSizeTwoCocktail_+3A_max_score">max_score</code></td>
<td>
<p>: maximum number the score can take. Score greater than this 
one would be added to the distribution as the value max_score. Default is 1000</p>
</td></tr>
<tr><td><code id="trueDistributionSizeTwoCocktail_+3A_nbresults">nbResults</code></td>
<td>
<p>: Number of returned solution (Cocktail with the
best oberved score during the run), 100 by default</p>
</td></tr>
<tr><td><code id="trueDistributionSizeTwoCocktail_+3A_num_thread">num_thread</code></td>
<td>
<p>: Number of thread to run in parallel if openMP is available, 1 by default</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Return a List containing :
- ScoreDistribution : the distribution of the score as an array with each cells
representing the number of risks =  (index-1)/ 10
- Filtered_score_distribution : Distribution containing score for cocktails taken by at
least beta patients.
- Outstanding_score : An array of the score greater than max_score,
- Best_cocktails : the nbResults bests cocktails encountered during the run.
- Best_cocktails_beta : the nbResults bests cocktails taken by at least beta patients
encountered during the run.
- Best_scores : Score corresponding to the Best_cocktails.
- Best_scores_beta : Score corresponding to the Best_cocktails_beta.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("ATC_Tree_UpperBound_2024")
data("FAERS_myopathy")

size_2_score_distribution = trueDistributionSizeTwoCocktail(ATCtree = ATC_Tree_UpperBound_2024,
            observations = FAERS_myopathy[1:100,], beta = 4)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
