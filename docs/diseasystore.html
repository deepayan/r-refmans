<!DOCTYPE html><html><head><title>Help for package diseasystore</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {diseasystore}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#%.%'><p>Existence aware pick operator</p></a></li>
<li><a href='#age_labels'><p>Provides age_labels that follows the mg standard</p></a></li>
<li><a href='#aggregators'><p>Feature aggregators</p></a></li>
<li><a href='#available_diseasystores'><p>Detect available diseasystores</p></a></li>
<li><a href='#diseasyoption'><p>Helper function to get options related to diseasy</p></a></li>
<li><a href='#diseasystore_exists'><p>Check for the existence of a <code>diseasystore</code> for the case definition</p></a></li>
<li><a href='#diseasystore-package'><p>diseasystore: Feature Stores for the 'diseasy' Framework</p></a></li>
<li><a href='#DiseasystoreBase'><p>diseasystore base handler</p></a></li>
<li><a href='#DiseasystoreEcdcRespiratoryViruses'><p>feature store handler of EU-ECDC Respiratory viruses features</p></a></li>
<li><a href='#DiseasystoreGoogleCovid19'><p>feature store handler of Google Health COVID-19 Open Data features</p></a></li>
<li><a href='#drop_diseasystore'><p>Drop feature stores from DB</p></a></li>
<li><a href='#FeatureHandler'><p>FeatureHandler</p></a></li>
<li><a href='#get_diseasystore'><p>Get the <code>diseasystore</code> for the case definition</p></a></li>
<li><a href='#source_conn_helpers'><p>File path helper for different source_conn</p></a></li>
<li><a href='#test_diseasystore'><p>Test a given diseasy store</p></a></li>
<li><a href='#to_diseasystore_case'><p>Transform case definition to PascalCase</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Feature Stores for the 'diseasy' Framework</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.0</td>
</tr>
<tr>
<td>Description:</td>
<td>
  Simple feature stores and tools for creating personalised feature stores.
  'diseasystore' powers feature stores which can automatically link and aggregate features to a given stratification
  level. These feature stores are automatically time-versioned (powered by the 'SCDB' package) and allows you to easily
  and dynamically compute features as part of your continuous integration.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>Language:</td>
<td>en-GB</td>
</tr>
<tr>
<td>Imports:</td>
<td>checkmate, DBI, dbplyr, dplyr, glue, ISOweek, lintr,
lubridate, purrr, readr, rlang, R6, SCDB (&ge; 0.3.0), stringr,
tidyr, tidyselect, zoo</td>
</tr>
<tr>
<td>Suggests:</td>
<td>devtools, duckdb, curl, jsonlite, knitr, odbc, rmarkdown,
RSQLite, RPostgres, testthat (&ge; 3.0.0), tibble, spelling,
withr</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/ssi-dk/diseasystore">https://github.com/ssi-dk/diseasystore</a>,
<a href="https://ssi-dk.github.io/diseasystore/">https://ssi-dk.github.io/diseasystore/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/ssi-dk/diseasystore/issues">https://github.com/ssi-dk/diseasystore/issues</a></td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-03-20 11:28:23 UTC; B246705</td>
</tr>
<tr>
<td>Author:</td>
<td>Rasmus Skytte Randløv
    <a href="https://orcid.org/0000-0002-5860-3838"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut, cre],
  Marcus Munch Grünewald
    <a href="https://orcid.org/0009-0006-8090-406X"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [ctb],
  Kaare Græsbøll <a href="https://orcid.org/0000-0002-6258-8212"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [rev],
  Kasper Schou Telkamp
    <a href="https://orcid.org/0009-0001-5126-0190"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [rev],
  Lasse Engbo Christiansen
    <a href="https://orcid.org/0000-0001-5019-1931"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [rev],
  Sofia Myrup Otero [rev],
  Statens Serum Institut, SSI [cph, fnd]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Rasmus Skytte Randløv &lt;rske@ssi.dk&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-03-20 11:50:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='+25.+25'>Existence aware pick operator</h2><span id='topic++25.+25'></span>

<h3>Description</h3>

<p>Existence aware pick operator
</p>


<h3>Usage</h3>

<pre><code class='language-R'>env %.% field
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="+2B25.+2B25_+3A_env">env</code></td>
<td>
<p>(<code>object</code>)<br />
The object or environment to attempt to pick from</p>
</td></tr>
<tr><td><code id="+2B25.+2B25_+3A_field">field</code></td>
<td>
<p>(<code>character</code>)<br />
The name of the field to pick from <code>env</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>Error if the <code>field</code> does not exist in <code>env</code>, otherwise it returns <code>field</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'> t &lt;- list(a = 1, b = 2)

 t$a       # 1
 t %.% a   # 1

 t$c # NULL
 try(t %.% c) # Gives error since "c" does not exist in "t"
</code></pre>

<hr>
<h2 id='age_labels'>Provides age_labels that follows the mg standard</h2><span id='topic+age_labels'></span>

<h3>Description</h3>

<p>Provides age_labels that follows the mg standard
</p>


<h3>Usage</h3>

<pre><code class='language-R'>age_labels(age_cuts)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="age_labels_+3A_age_cuts">age_cuts</code></td>
<td>
<p>(<code>numeric()</code>)<br />
The lower bound of the groups (0 is implicitly included)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector of labels with zero-padded numerics so they can be sorted easily
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  age_labels(c(5, 12, 20, 30))
</code></pre>

<hr>
<h2 id='aggregators'>Feature aggregators</h2><span id='topic+aggregators'></span><span id='topic+key_join_sum'></span><span id='topic+key_join_max'></span><span id='topic+key_join_min'></span><span id='topic+key_join_count'></span>

<h3>Description</h3>

<p>Feature aggregators
</p>


<h3>Usage</h3>

<pre><code class='language-R'>key_join_sum(.data, feature)

key_join_max(.data, feature)

key_join_min(.data, feature)

key_join_count(.data, feature)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="aggregators_+3A_.data">.data</code></td>
<td>
<p>(<code>any</code>)<br /> The data object to perform the operation on.</p>
</td></tr>
<tr><td><code id="aggregators_+3A_feature">feature</code></td>
<td>
<p>(<code>character</code>)<br />
Name of the feature to perform the aggregation over</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A dplyr::summarise to aggregate the features together using the given function (sum/max/min/count)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  # Primarily used within the framework but can be used individually:

  data &lt;- dplyr::mutate(mtcars, key_name = rownames(mtcars), .before = dplyr::everything())

  key_join_sum(data, "mpg")    # sum(mtcars$mpg)
  key_join_max(data, "mpg")    # max(mtcars$mpg)
  key_join_min(data, "mpg")    # min(mtcars$mpg)
  key_join_count(data, "mpg")  # nrow(mtcars)
</code></pre>

<hr>
<h2 id='available_diseasystores'>Detect available diseasystores</h2><span id='topic+available_diseasystores'></span>

<h3>Description</h3>

<p>Detect available diseasystores
</p>


<h3>Usage</h3>

<pre><code class='language-R'>available_diseasystores()
</code></pre>


<h3>Value</h3>

<p>The installed diseasystores on the search path
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  available_diseasystores()  # DiseasystoreGoogleCovid19 + more from other packages
</code></pre>

<hr>
<h2 id='diseasyoption'>Helper function to get options related to diseasy</h2><span id='topic+diseasyoption'></span>

<h3>Description</h3>

<p>Helper function to get options related to diseasy
</p>


<h3>Usage</h3>

<pre><code class='language-R'>diseasyoption(option, class = "DiseasystoreBase", .default = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="diseasyoption_+3A_option">option</code></td>
<td>
<p>(<code>character(1)</code>)<br />
Name of the option to get.</p>
</td></tr>
<tr><td><code id="diseasyoption_+3A_class">class</code></td>
<td>
<p>(<code>character(1)</code> or <code style="white-space: pre;">&#8288;R6::R6class Diseasy* instance&#8288;</code>)<br />
Either the classname or the object the option applies to.</p>
</td></tr>
<tr><td><code id="diseasyoption_+3A_.default">.default</code></td>
<td>
<p>(<code>any</code>)<br />
The default value to return if no option is set.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The most specific option within the diseasy framework for the given option and class
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  # Retrieve default option for source conn
  diseasyoption("source_conn")

  # Retrieve DiseasystoreGoogleCovid19 specific option for source conn
  diseasyoption("source_conn", "DiseasystoreGoogleCovid19")

  # Try to retrieve specific option for source conn for a non existent / un-configured diseasystore
  diseasyoption("source_conn", "DiseasystoreNonExistent") # Returns default source_conn

  # Try to retrieve specific non-existent option
  diseasyoption("non_existent", "DiseasystoreGoogleCovid19", .default = "Use this")
</code></pre>

<hr>
<h2 id='diseasystore_exists'>Check for the existence of a <code>diseasystore</code> for the case definition</h2><span id='topic+diseasystore_exists'></span>

<h3>Description</h3>

<p>Check for the existence of a <code>diseasystore</code> for the case definition
</p>


<h3>Usage</h3>

<pre><code class='language-R'>diseasystore_exists(label)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="diseasystore_exists_+3A_label">label</code></td>
<td>
<p>(<code>character</code>)<br /> A character string that controls which feature store to get data from.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>TRUE if the given diseasystore can be matched to a diseasystore on the search path. FALSE otherwise.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  diseasystore_exists("Google COVID-19")  # TRUE
  diseasystore_exists("Non existent diseasystore")  # FALSE
</code></pre>

<hr>
<h2 id='diseasystore-package'>diseasystore: Feature Stores for the 'diseasy' Framework</h2><span id='topic+diseasystore'></span><span id='topic+diseasystore-package'></span>

<h3>Description</h3>

<p><img src="../help/figures/logo.png" style='float: right' alt='logo' width='120' />
</p>
<p>Simple feature stores and tools for creating personalised feature stores. 'diseasystore' powers feature stores which can automatically link and aggregate features to a given stratification level. These feature stores are automatically time-versioned (powered by the 'SCDB' package) and allows you to easily and dynamically compute features as part of your continuous integration.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Rasmus Skytte Randløv <a href="mailto:rske@ssi.dk">rske@ssi.dk</a> (<a href="https://orcid.org/0000-0002-5860-3838">ORCID</a>)
</p>
<p>Other contributors:
</p>

<ul>
<li><p> Marcus Munch Grünewald (<a href="https://orcid.org/0009-0006-8090-406X">ORCID</a>) [contributor]
</p>
</li>
<li><p> Kaare Græsbøll <a href="mailto:kagr@ssi.dk">kagr@ssi.dk</a> (<a href="https://orcid.org/0000-0002-6258-8212">ORCID</a>) [reviewer]
</p>
</li>
<li><p> Kasper Schou Telkamp (<a href="https://orcid.org/0009-0001-5126-0190">ORCID</a>) [reviewer]
</p>
</li>
<li><p> Lasse Engbo Christiansen <a href="mailto:lsec@ssi.dk">lsec@ssi.dk</a> (<a href="https://orcid.org/0000-0001-5019-1931">ORCID</a>) [reviewer]
</p>
</li>
<li><p> Sofia Myrup Otero <a href="mailto:smot@ssi.dk">smot@ssi.dk</a> [reviewer]
</p>
</li>
<li><p> Statens Serum Institut, SSI [copyright holder, funder]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/ssi-dk/diseasystore">https://github.com/ssi-dk/diseasystore</a>
</p>
</li>
<li> <p><a href="https://ssi-dk.github.io/diseasystore/">https://ssi-dk.github.io/diseasystore/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/ssi-dk/diseasystore/issues">https://github.com/ssi-dk/diseasystore/issues</a>
</p>
</li></ul>


<hr>
<h2 id='DiseasystoreBase'>diseasystore base handler</h2><span id='topic+DiseasystoreBase'></span>

<h3>Description</h3>

<p>This <code>DiseasystoreBase</code> <a href="R6.html#topic+R6Class">R6</a> class forms the basis of all feature stores.
It defines the primary methods of each feature stores as well as all of the public methods.
</p>


<h3>Value</h3>

<p>A new instance of the <code>DiseasystoreBase</code> <a href="R6.html#topic+R6Class">R6</a> class.
</p>


<h3>Active bindings</h3>

<div class="r6-active-bindings">

<dl>
<dt><code>ds_map</code></dt><dd><p>(<code style="white-space: pre;">&#8288;named list&#8288;</code>(<code>character</code>))<br />
A list that maps features known by the feature store to the corresponding feature handlers
that compute the features. Read only.</p>
</dd>
<dt><code>available_features</code></dt><dd><p>(<code>character</code>)<br />
A list of available features in the feature store. Read only.</p>
</dd>
<dt><code>label</code></dt><dd><p>(<code>character</code>)<br />
A human readable label of the feature store. Read only.</p>
</dd>
<dt><code>source_conn</code></dt><dd><p>(<code>DBIConnection</code> or <code style="white-space: pre;">&#8288;file path&#8288;</code>)<br /> Used to specify where data is located.  Read only. Can be <code>DBIConnection</code> or file path depending on the <code>diseasystore</code>.</p>
</dd>
<dt><code>target_conn</code></dt><dd><p>(<code>DBIConnection</code>)<br /> A database connection to store the computed features in.  Read only.</p>
</dd>
<dt><code>target_schema</code></dt><dd><p>(<code>character</code>)<br /> The schema to place the feature store in.  Read only. If the database backend does not support schema, the tables will be prefixed with &lt;target_schema&gt;.</p>
</dd>
<dt><code>start_date</code></dt><dd><p>(<code>Date</code>)<br /> Study period start.  Read only.</p>
</dd>
<dt><code>end_date</code></dt><dd><p>(<code>Date</code>)<br /> Study period end.  Read only.</p>
</dd>
<dt><code>slice_ts</code></dt><dd><p>(<code>Date</code> or <code>character</code>)<br /> Date or timestamp (parsable by <code>as.POSIXct</code>) to slice the database on (used if source_conn is a database).  Read only.</p>
</dd>
</dl>

</div>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-DiseasystoreBase-new"><code>DiseasystoreBase$new()</code></a>
</p>
</li>
<li> <p><a href="#method-DiseasystoreBase-finalize"><code>DiseasystoreBase$finalize()</code></a>
</p>
</li>
<li> <p><a href="#method-DiseasystoreBase-get_feature"><code>DiseasystoreBase$get_feature()</code></a>
</p>
</li>
<li> <p><a href="#method-DiseasystoreBase-key_join_features"><code>DiseasystoreBase$key_join_features()</code></a>
</p>
</li>
<li> <p><a href="#method-DiseasystoreBase-clone"><code>DiseasystoreBase$clone()</code></a>
</p>
</li></ul>


<hr>
<a id="method-DiseasystoreBase-new"></a>



<h4>Method <code>new()</code></h4>

<p>Creates a new instance of the <code>DiseasystoreBase</code> <a href="R6.html#topic+R6Class">R6</a> class.
</p>


<h5>Usage</h5>

<div class="r"><pre>DiseasystoreBase$new(
  start_date = NULL,
  end_date = NULL,
  slice_ts = NULL,
  source_conn = NULL,
  target_conn = NULL,
  target_schema = NULL,
  verbose = diseasyoption("verbose", self)
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>start_date</code></dt><dd><p>(<code>Date</code>)<br /> Study period start.</p>
</dd>
<dt><code>end_date</code></dt><dd><p>(<code>Date</code>)<br /> Study period end.</p>
</dd>
<dt><code>slice_ts</code></dt><dd><p>(<code>Date</code> or <code>character</code>)<br /> Date or timestamp (parsable by <code>as.POSIXct</code>) to slice the database on (used if source_conn is a database).</p>
</dd>
<dt><code>source_conn</code></dt><dd><p>(<code>DBIConnection</code> or <code style="white-space: pre;">&#8288;file path&#8288;</code>)<br /> Used to specify where data is located.  Can be <code>DBIConnection</code> or file path depending on the <code>diseasystore</code>.</p>
</dd>
<dt><code>target_conn</code></dt><dd><p>(<code>DBIConnection</code>)<br /> A database connection to store the computed features in.</p>
</dd>
<dt><code>target_schema</code></dt><dd><p>(<code>character</code>)<br /> The schema to place the feature store in.  If the database backend does not support schema, the tables will be prefixed with &lt;target_schema&gt;.</p>
</dd>
<dt><code>verbose</code></dt><dd><p>(<code>boolean</code>)<br />
Boolean that controls enables debugging information.</p>
</dd>
</dl>

</div>



<h5>Returns</h5>

<p>A new instance of the <code>DiseasystoreBase</code> <a href="R6.html#topic+R6Class">R6</a> class.
</p>


<hr>
<a id="method-DiseasystoreBase-finalize"></a>



<h4>Method <code>finalize()</code></h4>

<p>Closes the open DB connection when removing the object
</p>


<h5>Usage</h5>

<div class="r"><pre>DiseasystoreBase$finalize()</pre></div>


<hr>
<a id="method-DiseasystoreBase-get_feature"></a>



<h4>Method <code>get_feature()</code></h4>

<p>Computes, stores, and returns the requested feature for the study period.
</p>


<h5>Usage</h5>

<div class="r"><pre>DiseasystoreBase$get_feature(
  feature,
  start_date = self %.% start_date,
  end_date = self %.% end_date,
  slice_ts = self %.% slice_ts
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>feature</code></dt><dd><p>(<code>character</code>)<br />
The name of a feature defined in the feature store.</p>
</dd>
<dt><code>start_date</code></dt><dd><p>(<code>Date</code>)<br /> Study period start.</p>
</dd>
<dt><code>end_date</code></dt><dd><p>(<code>Date</code>)<br /> Study period end.</p>
</dd>
<dt><code>slice_ts</code></dt><dd><p>(<code>Date</code> or <code>character</code>)<br /> Date or timestamp (parsable by <code>as.POSIXct</code>) to slice the database on (used if source_conn is a database).</p>
</dd>
</dl>

</div>



<h5>Returns</h5>

<p>A tbl_dbi with the requested feature for the study period.
</p>


<hr>
<a id="method-DiseasystoreBase-key_join_features"></a>



<h4>Method <code>key_join_features()</code></h4>

<p>Joins various features from feature store assuming a primary feature (observable)
that contains keys to witch the secondary features (defined by <code>stratification</code>) can be joined.
</p>


<h5>Usage</h5>

<div class="r"><pre>DiseasystoreBase$key_join_features(
  observable,
  stratification,
  start_date = self %.% start_date,
  end_date = self %.% end_date
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>observable</code></dt><dd><p>(<code>character</code>)<br />
The name of a feature defined in the feature store</p>
</dd>
<dt><code>stratification</code></dt><dd><p>(<code>list</code>(<code>quosures</code>))<br />
Expressions in <code>stratification</code> are evaluated to find appropriate features.
These are then joined to the observable feature before <code>stratification</code> is performed.</p>
</dd>
<dt><code>start_date</code></dt><dd><p>(<code>Date</code>)<br /> Study period start.</p>
</dd>
<dt><code>end_date</code></dt><dd><p>(<code>Date</code>)<br /> Study period end.</p>
</dd>
</dl>

</div>



<h5>Returns</h5>

<p>A tbl_dbi with the requested joined features for the study period.
</p>


<hr>
<a id="method-DiseasystoreBase-clone"></a>



<h4>Method <code>clone()</code></h4>

<p>The objects of this class are cloneable with this method.
</p>


<h5>Usage</h5>

<div class="r"><pre>DiseasystoreBase$clone(deep = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>deep</code></dt><dd><p>Whether to make a deep clone.</p>
</dd>
</dl>

</div>




<h3>Examples</h3>

<pre><code class='language-R'>
  # DiseasystoreBase is mostly used as the basis of other, more specific, classes
  # The DiseasystoreBase can be initialised individually if needed.

  ds &lt;- DiseasystoreBase$new(source_conn = NULL,
                             target_conn = DBI::dbConnect(RSQLite::SQLite()))

  rm(ds)

</code></pre>

<hr>
<h2 id='DiseasystoreEcdcRespiratoryViruses'>feature store handler of EU-ECDC Respiratory viruses features</h2><span id='topic+DiseasystoreEcdcRespiratoryViruses'></span>

<h3>Description</h3>

<p>This <code>DiseasystoreEcdcRespiratoryViruses</code> <a href="R6.html#topic+R6Class">R6</a> brings support for using the EU-ECDC
Respiratory viruses weekly data repository.
See the vignette(&quot;diseasystore-ecdc-respiratory-viruses&quot;) for details on how to configure the feature store.
</p>


<h3>Value</h3>

<p>A new instance of the <code>DiseasystoreEcdcRespiratoryViruses</code> <a href="R6.html#topic+R6Class">R6</a> class.
</p>


<h3>Super class</h3>

<p><code><a href="#topic+DiseasystoreBase">diseasystore::DiseasystoreBase</a></code> -&gt; <code>DiseasystoreEcdcRespiratoryViruses</code>
</p>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-DiseasystoreEcdcRespiratoryViruses-clone"><code>DiseasystoreEcdcRespiratoryViruses$clone()</code></a>
</p>
</li></ul>



<details open><summary>Inherited methods</summary>
<ul>
<li><span class="pkg-link" data-pkg="diseasystore" data-topic="DiseasystoreBase" data-id="finalize"><a href='../../diseasystore/html/DiseasystoreBase.html#method-DiseasystoreBase-finalize'><code>diseasystore::DiseasystoreBase$finalize()</code></a></span></li>
<li><span class="pkg-link" data-pkg="diseasystore" data-topic="DiseasystoreBase" data-id="get_feature"><a href='../../diseasystore/html/DiseasystoreBase.html#method-DiseasystoreBase-get_feature'><code>diseasystore::DiseasystoreBase$get_feature()</code></a></span></li>
<li><span class="pkg-link" data-pkg="diseasystore" data-topic="DiseasystoreBase" data-id="initialize"><a href='../../diseasystore/html/DiseasystoreBase.html#method-DiseasystoreBase-initialize'><code>diseasystore::DiseasystoreBase$initialize()</code></a></span></li>
<li><span class="pkg-link" data-pkg="diseasystore" data-topic="DiseasystoreBase" data-id="key_join_features"><a href='../../diseasystore/html/DiseasystoreBase.html#method-DiseasystoreBase-key_join_features'><code>diseasystore::DiseasystoreBase$key_join_features()</code></a></span></li>
</ul>
</details>

<hr>
<a id="method-DiseasystoreEcdcRespiratoryViruses-clone"></a>



<h4>Method <code>clone()</code></h4>

<p>The objects of this class are cloneable with this method.
</p>


<h5>Usage</h5>

<div class="r"><pre>DiseasystoreEcdcRespiratoryViruses$clone(deep = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>deep</code></dt><dd><p>Whether to make a deep clone.</p>
</dd>
</dl>

</div>




<h3>Examples</h3>

<pre><code class='language-R'>
  ds &lt;- DiseasystoreEcdcRespiratoryViruses$new(
    source_conn = ".",
    target_conn = DBI::dbConnect(RSQLite::SQLite())
  )

  rm(ds)

</code></pre>

<hr>
<h2 id='DiseasystoreGoogleCovid19'>feature store handler of Google Health COVID-19 Open Data features</h2><span id='topic+DiseasystoreGoogleCovid19'></span>

<h3>Description</h3>

<p>This <code>DiseasystoreGoogleCovid19</code> <a href="R6.html#topic+R6Class">R6</a> brings support for using the Google
Health COVID-19 Open Data repository.
See the vignette(&quot;diseasystore-google-covid-19&quot;) for details on how to configure the feature store.
</p>


<h3>Value</h3>

<p>A new instance of the <code>DiseasystoreGoogleCovid19</code> <a href="R6.html#topic+R6Class">R6</a> class.
</p>


<h3>Super class</h3>

<p><code><a href="#topic+DiseasystoreBase">diseasystore::DiseasystoreBase</a></code> -&gt; <code>DiseasystoreGoogleCovid19</code>
</p>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-DiseasystoreGoogleCovid19-clone"><code>DiseasystoreGoogleCovid19$clone()</code></a>
</p>
</li></ul>



<details open><summary>Inherited methods</summary>
<ul>
<li><span class="pkg-link" data-pkg="diseasystore" data-topic="DiseasystoreBase" data-id="finalize"><a href='../../diseasystore/html/DiseasystoreBase.html#method-DiseasystoreBase-finalize'><code>diseasystore::DiseasystoreBase$finalize()</code></a></span></li>
<li><span class="pkg-link" data-pkg="diseasystore" data-topic="DiseasystoreBase" data-id="get_feature"><a href='../../diseasystore/html/DiseasystoreBase.html#method-DiseasystoreBase-get_feature'><code>diseasystore::DiseasystoreBase$get_feature()</code></a></span></li>
<li><span class="pkg-link" data-pkg="diseasystore" data-topic="DiseasystoreBase" data-id="initialize"><a href='../../diseasystore/html/DiseasystoreBase.html#method-DiseasystoreBase-initialize'><code>diseasystore::DiseasystoreBase$initialize()</code></a></span></li>
<li><span class="pkg-link" data-pkg="diseasystore" data-topic="DiseasystoreBase" data-id="key_join_features"><a href='../../diseasystore/html/DiseasystoreBase.html#method-DiseasystoreBase-key_join_features'><code>diseasystore::DiseasystoreBase$key_join_features()</code></a></span></li>
</ul>
</details>

<hr>
<a id="method-DiseasystoreGoogleCovid19-clone"></a>



<h4>Method <code>clone()</code></h4>

<p>The objects of this class are cloneable with this method.
</p>


<h5>Usage</h5>

<div class="r"><pre>DiseasystoreGoogleCovid19$clone(deep = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>deep</code></dt><dd><p>Whether to make a deep clone.</p>
</dd>
</dl>

</div>




<h3>Examples</h3>

<pre><code class='language-R'>
  ds &lt;- DiseasystoreGoogleCovid19$new(
    source_conn = ".",
    target_conn = DBI::dbConnect(RSQLite::SQLite())
  )

  rm(ds)

</code></pre>

<hr>
<h2 id='drop_diseasystore'>Drop feature stores from DB</h2><span id='topic+drop_diseasystore'></span>

<h3>Description</h3>

<p>Drop feature stores from DB
</p>


<h3>Usage</h3>

<pre><code class='language-R'>drop_diseasystore(
  pattern = NULL,
  schema = diseasyoption("target_schema"),
  conn = SCDB::get_connection()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="drop_diseasystore_+3A_pattern">pattern</code></td>
<td>
<p>(<code>character(1)</code>)<br />
Pattern to match the tables by</p>
</td></tr>
<tr><td><code id="drop_diseasystore_+3A_schema">schema</code></td>
<td>
<p>(<code>character(1)</code>)<br />
Schema the diseasystore uses to store data in</p>
</td></tr>
<tr><td><code id="drop_diseasystore_+3A_conn">conn</code></td>
<td>
<p>(<code>DBIConnection</code>)<br /> A database connection</p>
</td></tr>
</table>


<h3>Value</h3>

<p>NULL (called for side effects)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  conn &lt;- SCDB::get_connection(drv = RSQLite::SQLite())

  drop_diseasystore(conn = conn)

  DBI::dbDisconnect(conn)

</code></pre>

<hr>
<h2 id='FeatureHandler'>FeatureHandler</h2><span id='topic+FeatureHandler'></span>

<h3>Description</h3>

<p>This <code>FeatureHandler</code> <a href="R6.html#topic+R6Class">R6</a> handles individual features for the feature stores.
They define the three methods associated with features (<code>compute</code>, <code>get</code> and <code>key_join</code>).
</p>


<h3>Value</h3>

<p>A new instance of the <code>FeatureHandler</code> <a href="R6.html#topic+R6Class">R6</a> class.
</p>


<h3>Active bindings</h3>

<div class="r6-active-bindings">

<dl>
<dt><code>compute</code></dt><dd><p>(<code>function</code>)<br />
A function of the form &quot;function(start_date, end_date, slice_ts, source_conn)&quot;.
This function should compute the feature from the source connection.</p>
</dd>
<dt><code>get</code></dt><dd><p>(<code>function</code>)<br />
A function of the form &quot;function(target_table, slice_ts, target_conn)&quot;.
This function should retrieve the computed feature from the target connection.</p>
</dd>
<dt><code>key_join</code></dt><dd><p>(<code>function</code>)<br />
One of the aggregators from <a href="#topic+aggregators">aggregators</a>.</p>
</dd>
</dl>

</div>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-FeatureHandler-new"><code>FeatureHandler$new()</code></a>
</p>
</li>
<li> <p><a href="#method-FeatureHandler-clone"><code>FeatureHandler$clone()</code></a>
</p>
</li></ul>


<hr>
<a id="method-FeatureHandler-new"></a>



<h4>Method <code>new()</code></h4>

<p>Creates a new instance of the <code>FeatureHandler</code> <a href="R6.html#topic+R6Class">R6</a> class.
</p>


<h5>Usage</h5>

<div class="r"><pre>FeatureHandler$new(compute = NULL, get = NULL, key_join = NULL)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>compute</code></dt><dd><p>(<code>function</code>)<br />
A function of the form &quot;function(start_date, end_date, slice_ts, source_conn)&quot;.
This function should return a <code>data.frame</code> with the computed feature (computed from the source connection).
The <code>data.frame</code> should contain the following columns:
</p>

<ul>
<li><p> key_*: One (or more) columns containing keys to link this feature with other features
</p>
</li>
<li><p> *: One (or more) columns containing the features that are computed
</p>
</li>
<li><p> valid_from, valid_until: A set of columns containing the time period for which this feature information
is valid.<br />
</p>
</li></ul>
</dd>
<dt><code>get</code></dt><dd><p>(<code>function</code>)<br />
(Optional). A function of the form &quot;function(target_table, slice_ts, target_conn)&quot;.
This function should retrieve the computed feature from the target connection.<br /></p>
</dd>
<dt><code>key_join</code></dt><dd><p>(<code>function</code>)<br />
A function like one of the aggregators from <code><a href="#topic+aggregators">aggregators()</a></code>.
</p>
<p>The function should return an expression on the form:
dplyr::summarise(.data,
dplyr::across(.cols = tidyselect::all_of(feature),
.fns = list(n = ~ aggregation function),
.names = &quot;{.fn}&quot;),
.groups = &quot;drop&quot;)</p>
</dd>
</dl>

</div>



<h5>Returns</h5>

<p>A new instance of the <code>FeatureHandler</code> <a href="R6.html#topic+R6Class">R6</a> class.
</p>


<hr>
<a id="method-FeatureHandler-clone"></a>



<h4>Method <code>clone()</code></h4>

<p>The objects of this class are cloneable with this method.
</p>


<h5>Usage</h5>

<div class="r"><pre>FeatureHandler$clone(deep = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>deep</code></dt><dd><p>Whether to make a deep clone.</p>
</dd>
</dl>

</div>




<h3>Examples</h3>

<pre><code class='language-R'>
  # The FeatureHandler is typically configured as part of making a new Diseasystore.
  # Most often, we need only specify `compute` and `key_join` to get a functioning FeatureHandler

  # In this example we use mtcars as the basis for our features
  conn &lt;- SCDB::get_connection(drv = RSQLite::SQLite())

  # We use mtcars as our basis. First we add the rownames as an actual column
  data &lt;- dplyr::mutate(mtcars, key_name = rownames(mtcars), .before = dplyr::everything())

  # Then we add some imaginary times where these cars were produced
  data &lt;- dplyr::mutate(data,
                        production_start = as.Date(Sys.Date()) + floor(runif(nrow(mtcars)) * 100),
                        production_end   = production_start + floor(runif(nrow(mtcars)) * 365))

  dplyr::copy_to(conn, data, "mtcars")

  # In this example, the feature we want is the "maximum miles per gallon"
  # The feature in question in the mtcars data set is then "mpg" and when we need to reduce
  # our data set, we want to use the "max()" function.

  # We first write a compute function for the mpg in our modified mtcars data set
  # Our goal is to get the mpg of all cars that were in production at the between start/end_date
  compute_mpg &lt;- function(start_date, end_date, slice_ts, source_conn) {
    out &lt;- SCDB::get_table(source_conn, "mtcars", slice_ts = slice_ts) |&gt;
      dplyr::filter({{ start_date }} &lt;= .data$production_end,
                    .data$production_start &lt;= {{ end_date }}) |&gt;
      dplyr::transmute("key_name", "mpg",
                       "valid_from" = "production_start",
                       "valid_until" = "production_end")

    return(out)
  }

  # We can now combine into our FeatureHandler
  fh_max_mpg &lt;- FeatureHandler$new(compute = compute_mpg, key_join = key_join_max)

  DBI::dbDisconnect(conn)

</code></pre>

<hr>
<h2 id='get_diseasystore'>Get the <code>diseasystore</code> for the case definition</h2><span id='topic+get_diseasystore'></span>

<h3>Description</h3>

<p>Get the <code>diseasystore</code> for the case definition
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_diseasystore(label)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_diseasystore_+3A_label">label</code></td>
<td>
<p>(<code>character</code>)<br /> A character string that controls which feature store to get data from.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The diseasystore generator for the diseasystore matching the given label
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  ds &lt;- get_diseasystore("Google COVID-19")  # Returns the DiseasystoreGoogleCovid19 generator
</code></pre>

<hr>
<h2 id='source_conn_helpers'>File path helper for different source_conn</h2><span id='topic+source_conn_helpers'></span><span id='topic+source_conn_path'></span><span id='topic+source_conn_github'></span>

<h3>Description</h3>


<ul>
<li><p> source_conn_path: static url / directory.
This helper determines whether source_conn is a file path or URL and creates the full path to the
the file as needed based on the type of source_conn.
</p>
</li></ul>


<ul>
<li><p> source_conn_github: static GitHub API url / git directory.
This helper determines whether source_conn is a git directory or a GitHub API creates the full path to the
the file as needed based on the type of source_conn.
</p>
<p>A GitHub token can be configured in the &quot;GITHUB_PAT&quot; environment variable to avoid rate limiting.
</p>
<p>If the basename of the requested file contains a date, the function will use fuzzy-matching to determine the
closest matching, chronologically earlier, file location to return.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>source_conn_path(source_conn, file)

source_conn_github(source_conn, file, pull = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="source_conn_helpers_+3A_source_conn">source_conn</code></td>
<td>
<p>(<code>character(1)</code>)<br />
File location (path or URL).</p>
</td></tr>
<tr><td><code id="source_conn_helpers_+3A_file">file</code></td>
<td>
<p>(<code>character(1)</code>)<br />
Name (including path) of the file at the location.</p>
</td></tr>
<tr><td><code id="source_conn_helpers_+3A_pull">pull</code></td>
<td>
<p>(<code>logical(1)</code>)<br />
Should &quot;git pull&quot; be called on the local repository before reading files?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>(<code>character(1)</code>)<br />
The full path to the requested file.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  # Simulating a data directory
  source_conn &lt;- "data_dir"
  dir.create(source_conn)
  write.csv(mtcars, file.path(source_conn, "mtcars.csv"))
  write.csv(iris, file.path(source_conn, "iris.csv"))

  # Get file path for mtcars.csv
  source_conn_path(source_conn, "mtcars.csv")

  # Clean up
  unlink(source_conn, recursive = TRUE)
</code></pre>

<hr>
<h2 id='test_diseasystore'>Test a given diseasy store</h2><span id='topic+test_diseasystore'></span>

<h3>Description</h3>

<p>This function runs a battery of tests of the given diseasystore.
</p>
<p>The supplied diseasystore must be a generator for the diseasystore, not an instance of the diseasystore.
</p>
<p>The tests assume that data has been made available locally to run the majority of the tests.
The location of the local data should be configured in the options for &quot;source_conn&quot; of the given
diseasystore before calling test_diseasystore.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>test_diseasystore(
  diseasystore_generator = NULL,
  conn_generator = NULL,
  data_files = NULL,
  target_schema = "test_ds",
  test_start_date = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="test_diseasystore_+3A_diseasystore_generator">diseasystore_generator</code></td>
<td>
<p>(<code style="white-space: pre;">&#8288;Diseasystore*&#8288;</code>)<br />
The diseasystore R6 class generator to test.</p>
</td></tr>
<tr><td><code id="test_diseasystore_+3A_conn_generator">conn_generator</code></td>
<td>
<p>(<code>function</code>)<br />
Function that generates a <code>list</code>() of connections use as target_conn.</p>
</td></tr>
<tr><td><code id="test_diseasystore_+3A_data_files">data_files</code></td>
<td>
<p>(<code>character()</code>)<br />
List of files that should be available when testing.</p>
</td></tr>
<tr><td><code id="test_diseasystore_+3A_target_schema">target_schema</code></td>
<td>
<p>(<code>character(1)</code>)<br />
The data base schema where the tests should be run.</p>
</td></tr>
<tr><td><code id="test_diseasystore_+3A_test_start_date">test_start_date</code></td>
<td>
<p>(<code>Date</code>)<br />
The earliest date to retrieve data from during tests.</p>
</td></tr>
<tr><td><code id="test_diseasystore_+3A_...">...</code></td>
<td>
<p>Other parameters passed to the diseasystore generator.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>NULL (called for side effects)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

  withr::local_options("diseasystore.DiseasystoreEcdcRespiratoryViruses.pull" = FALSE)

  test_diseasystore(
    DiseasystoreEcdcRespiratoryViruses,
    \() list(DBI::dbConnect(RSQLite::SQLite())),
    data_files = "data/snapshots/2023-11-24_ILIARIRates.csv",
    target_schema = "test_ds",
    test_start_date = as.Date("2022-06-20"),
    slice_ts = "2023-11-24"
  )


</code></pre>

<hr>
<h2 id='to_diseasystore_case'>Transform case definition to PascalCase</h2><span id='topic+to_diseasystore_case'></span>

<h3>Description</h3>

<p>Transform case definition to PascalCase
</p>


<h3>Usage</h3>

<pre><code class='language-R'>to_diseasystore_case(label)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="to_diseasystore_case_+3A_label">label</code></td>
<td>
<p>(<code>character</code>)<br /> A character string that controls which feature store to get data from.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The given label formatted to match a Diseasystore
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  to_diseasystore_case("Google COVID-19")  # DiseasystoreGoogleCovid19
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
