<!DOCTYPE html><html lang="en-US"><head><title>Help for package Rcurvep</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {Rcurvep}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#Rcurvep-package'><p>Rcurvep: Concentration-Response Data Analysis using Curvep</p></a></li>
<li><a href='#cal_knee_point'><p>Calculate the knee point on the exponential-like curve</p></a></li>
<li><a href='#combi_run_rcurvep'><p>Run Curvep on datasets of concentration-response data with a combination of Curvep parameters</p></a></li>
<li><a href='#create_dataset'><p>Create concentration-response datasets that can be applied in the <code>run_rcurvep()</code></p></a></li>
<li><a href='#curvep'><p>The Curvep function to process one set of concentration-response data</p></a></li>
<li><a href='#curvep_defaults'><p>Default parameters of Curvep</p></a></li>
<li><a href='#estimate_dataset_bmr'><p>Estimate benchmark response (BMR) for each dataset</p></a></li>
<li><a href='#fit_cc2_modl'><p>Fit concentration-response data using Curve Class2 approach</p></a></li>
<li><a href='#fit_modls'><p>Fit one set of concentration-response data using types of models</p></a></li>
<li><a href='#get_hill_fit_config'><p>Get the default configurations for the Hill fit</p></a></li>
<li><a href='#merge_rcurvep_objs'><p>Merge results from multiple rcurvep objects</p></a></li>
<li><a href='#plot.rcurvep_bmr'><p>Plot BMR diagnostic curves</p></a></li>
<li><a href='#run_fit'><p>Run parametric fits using types of models on concentration-response datasets</p></a></li>
<li><a href='#run_rcurvep'><p>Run Curvep on datasets of concentration-response data</p></a></li>
<li><a href='#summarize_fit_output'><p>Summarize the results from the parametric fitting using types of models</p></a></li>
<li><a href='#summarize_rcurvep_output'><p>Clean and summarize the output of rcurvep object</p></a></li>
<li><a href='#zfishbeh'><p>Subsets of concentration response datasets from zebrafish neurotoxicity assays</p></a></li>
<li><a href='#zfishdev'><p>Subsets of concentration response datasets from zebrafish developmental toxicity assays</p></a></li>
<li><a href='#zfishdev_act'><p>Activity output based on simulated datasets using zfishdev_all dataset</p></a></li>
<li><a href='#zfishdev_all'><p>Full sets of concentration response datasets from zebrafish developmental toxicity assays</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Concentration-Response Data Analysis using Curvep</td>
</tr>
<tr>
<td>Version:</td>
<td>1.3.1</td>
</tr>
<tr>
<td>Description:</td>
<td>An R interface for processing concentration-response datasets using Curvep, a response noise filtering algorithm. The algorithm was described in the publications (Sedykh A et al. (2011) &lt;<a href="https://doi.org/10.1289%2Fehp.1002476">doi:10.1289/ehp.1002476</a>&gt; and Sedykh A (2016) &lt;<a href="https://doi.org/10.1007%2F978-1-4939-6346-1_14">doi:10.1007/978-1-4939-6346-1_14</a>&gt;). Other parametric fitting approaches (e.g., Hill equation) are also adopted for ease of comparison. 3-parameter Hill equation from 'tcpl' package (Filer D et al.,  &lt;<a href="https://doi.org/10.1093%2Fbioinformatics%2Fbtw680">doi:10.1093/bioinformatics/btw680</a>&gt;) and 4-parameter Hill equation from Curve Class2 approach (Wang Y et al.,  &lt;<a href="https://doi.org/10.2174%2F1875397301004010057">doi:10.2174/1875397301004010057</a>&gt;) are available. Also, methods for calculating the confidence interval around the activity metrics are also provided. The methods are based on the bootstrap approach to simulate the datasets (Hsieh J-H et al. &lt;<a href="https://doi.org/10.1093%2Ftoxsci%2Fkfy258">doi:10.1093/toxsci/kfy258</a>&gt;). The simulated datasets can be used to derive the baseline noise threshold in an assay endpoint. This threshold is critical in the toxicological studies to derive the point-of-departure (POD).</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/moggces/Rcurvep/issues">https://github.com/moggces/Rcurvep/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/moggces/Rcurvep">https://github.com/moggces/Rcurvep</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr (&ge; 1.0.0), tibble, magrittr, tidyselect, boot, tidyr,
purrr, rlang, stringr, ggplot2, Rdpack, methods, rJava, furrr</td>
</tr>
<tr>
<td>RdMacros:</td>
<td>Rdpack</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat, knitr, rmarkdown, tcpl, future</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>Java</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5)</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-01-08 22:03:06 UTC; hsiehj2</td>
</tr>
<tr>
<td>Author:</td>
<td>Jui-Hua Hsieh <a href="https://orcid.org/0000-0003-1620-1571"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Alexander Sedykh [aut],
  Fred Parham [ctb],
  Yuhong Wang [ctb],
  Tongan Zhao [aut],
  Ruili Huang [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jui-Hua Hsieh &lt;juihua.hsieh@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-01-09 08:20:32 UTC</td>
</tr>
</table>
<hr>
<h2 id='Rcurvep-package'>Rcurvep: Concentration-Response Data Analysis using Curvep</h2><span id='topic+Rcurvep'></span><span id='topic+Rcurvep-package'></span>

<h3>Description</h3>

<p>An R interface for processing concentration-response datasets using Curvep, a response noise filtering algorithm. The algorithm was described in the publications (Sedykh A et al. (2011) <a href="https://doi.org/10.1289/ehp.1002476">doi:10.1289/ehp.1002476</a> and Sedykh A (2016) <a href="https://doi.org/10.1007/978-1-4939-6346-1_14">doi:10.1007/978-1-4939-6346-1_14</a>). Other parametric fitting approaches (e.g., Hill equation) are also adopted for ease of comparison. 3-parameter Hill equation from 'tcpl' package (Filer D et al., <a href="https://doi.org/10.1093/bioinformatics/btw680">doi:10.1093/bioinformatics/btw680</a>) and 4-parameter Hill equation from Curve Class2 approach (Wang Y et al., <a href="https://doi.org/10.2174/1875397301004010057">doi:10.2174/1875397301004010057</a>) are available. Also, methods for calculating the confidence interval around the activity metrics are also provided. The methods are based on the bootstrap approach to simulate the datasets (Hsieh J-H et al. <a href="https://doi.org/10.1093/toxsci/kfy258">doi:10.1093/toxsci/kfy258</a>). The simulated datasets can be used to derive the baseline noise threshold in an assay endpoint. This threshold is critical in the toxicological studies to derive the point-of-departure (POD).
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Jui-Hua Hsieh <a href="mailto:juihua.hsieh@gmail.com">juihua.hsieh@gmail.com</a> (<a href="https://orcid.org/0000-0003-1620-1571">ORCID</a>)
</p>
<p>Authors:
</p>

<ul>
<li><p> Alexander Sedykh
</p>
</li>
<li><p> Tongan Zhao
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> Fred Parham [contributor]
</p>
</li>
<li><p> Yuhong Wang [contributor]
</p>
</li>
<li><p> Ruili Huang [contributor]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/moggces/Rcurvep">https://github.com/moggces/Rcurvep</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/moggces/Rcurvep/issues">https://github.com/moggces/Rcurvep/issues</a>
</p>
</li></ul>


<hr>
<h2 id='cal_knee_point'>Calculate the knee point on the exponential-like curve</h2><span id='topic+cal_knee_point'></span>

<h3>Description</h3>

<p>Currently two methods have been implemented to get the &quot;keen-point&quot; from the variance(y) - threshold(x) curve.
One is to use the original y values to draw a straight line between the lowest x value (p1) to highest x value (p2).
The knee-point is the x that has the longest distance to the line.
The other one is to fit the data first then use the fitted responses to do the same analysis.
Currently the first method is preferred.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cal_knee_point(d, xaxis, yaxis, p1 = NULL, p2 = NULL, plot = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cal_knee_point_+3A_d">d</code></td>
<td>
<p>A tibble.</p>
</td></tr>
<tr><td><code id="cal_knee_point_+3A_xaxis">xaxis</code></td>
<td>
<p>The column name in the <code>d</code> to be the x-axis in the exponential-like curve</p>
</td></tr>
<tr><td><code id="cal_knee_point_+3A_yaxis">yaxis</code></td>
<td>
<p>The column name in the <code>d</code> to be the y-axis in the exponential-like curve</p>
</td></tr>
<tr><td><code id="cal_knee_point_+3A_p1">p1</code></td>
<td>
<p>Default = NULL, or an integer value to manually set the first index of line.</p>
</td></tr>
<tr><td><code id="cal_knee_point_+3A_p2">p2</code></td>
<td>
<p>Default = NULL, or an integer value to manually set the last index of line.</p>
</td></tr>
<tr><td><code id="cal_knee_point_+3A_plot">plot</code></td>
<td>
<p>Default = TRUE, plot the diagnostic plot.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with two components: stats and outcome.
</p>

<ul>
<li><p> stats: a tibble, including pooled variance (pvar),
fitted responses (y_exp_fit, y_lm_fit), distance to the line (dist2l)
</p>
</li>
<li><p> outcome: a tibble, including estimated BMRs (bmr)
</p>
</li></ul>
<p>;
Suffix in the <strong>stats</strong> and <strong>outcome</strong> tibble: &quot;ori&quot; (original values), &quot;exp&quot;(exponential fit).
prefix in the <strong>outcome</strong> tibble, &quot;cor&quot; (correlation between the fitted responses and the original responses),
&quot;bmr&quot; (benchmark response), &quot;qc&quot; (quality control).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+estimate_dataset_bmr">estimate_dataset_bmr()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
inp &lt;- data.frame(
x = seq(5, 95, by = 5),
y = c(0.0537, 0.0281, 0.0119, 0.0109, 0.0062, 0.0043, 0.0043, 0.0042,
0.0041, 0.0043, 0.0044, 0.0044, 0.0046, 0.0051,
0.0055, 0.0057, 0.0072, 0.0068, 0.0035)
)

out &lt;- cal_knee_point(inp,"x", "y", plot = FALSE)
plot(out)


</code></pre>

<hr>
<h2 id='combi_run_rcurvep'>Run Curvep on datasets of concentration-response data with a combination of Curvep parameters</h2><span id='topic+combi_run_rcurvep'></span>

<h3>Description</h3>

<p>It simplifies the steps of <code><a href="#topic+run_rcurvep">run_rcurvep()</a></code> by wrapping the <code><a href="#topic+create_dataset">create_dataset()</a></code> in the function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>combi_run_rcurvep(
  d,
  n_samples = NULL,
  vdata = NULL,
  mask = 0,
  keep_sets = c("act_set", "resp_set", "fp_set"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="combi_run_rcurvep_+3A_d">d</code></td>
<td>
<p>Datasets with concentration-response data.
Examples are <a href="#topic+zfishbeh">zfishbeh</a> and <a href="#topic+zfishdev">zfishdev</a>.</p>
</td></tr>
<tr><td><code id="combi_run_rcurvep_+3A_n_samples">n_samples</code></td>
<td>
<p>NULL (default) for not to simulate responses or an integer number to indicate the number of responses per concentration to simulate.</p>
</td></tr>
<tr><td><code id="combi_run_rcurvep_+3A_vdata">vdata</code></td>
<td>
<p>NULL (default) for not to simulate responses or a vector of numeric responses in vehicle control wells to use as error.
This parameter only works when n_samples is not NULL; an experimental feature.</p>
</td></tr>
<tr><td><code id="combi_run_rcurvep_+3A_mask">mask</code></td>
<td>
<p>Default = 0, for no mask (values in the mask column all 0).
Use a vector of integers to mask the responses:
1 to mask the response at the highest concentration;
2 to mask the response at the second highest concentration, and so on.
If mask column exists, the setting will be ignored.</p>
</td></tr>
<tr><td><code id="combi_run_rcurvep_+3A_keep_sets">keep_sets</code></td>
<td>
<p>The types of output to be reported.
Allowed values: act_set, resp_set, fp_set. Multiple values are allowed.
act_set is the must.
</p>

<ul>
<li><p> act_set: activity data
</p>
</li>
<li><p> resp_set: response data
</p>
</li>
<li><p> fp_set: fingerprint data
</p>
</li></ul>
</td></tr>
<tr><td><code id="combi_run_rcurvep_+3A_...">...</code></td>
<td>
<p>Curvep settings.
See <code><a href="#topic+curvep_defaults">curvep_defaults()</a></code> for allowed parameters.
These can be used to overwrite the default values.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An rcurvep object. It has two components: result, config
The result component is also a list of output sets depending on the parameter, <em>keep_sets</em>.
The config component is a <em>curvep_config</em> object.<br />
</p>
<p>Often used columns in the <em>act_set</em>: AUC (area under the curve), wAUC (weighted AUC),
POD (point-of-departure), EC50 (Half maximal effective concentration),
nCorrected (number of corrected points).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+run_rcurvep">run_rcurvep()</a></code> <code><a href="#topic+summarize_rcurvep_output">summarize_rcurvep_output()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(zfishbeh)

# 2 simulated sample curves +
# using two thresholds +
# mask the response at the higest concentration
# only to output the act_set

out &lt;- combi_run_rcurvep(
  zfishbeh,
  n_samples = 2,
  TRSH = c(5, 10),
  mask = 1,
  keep_sets = "act_set")

# create the zfishdev_act dataset


 data(zfishdev_all)
 zfishdev_act &lt;- combi_run_rcurvep(
   zfishdev_all, n_samples = 100, keep_sets = c("act_set"),TRSH = seq(5, 95, by = 5),
   RNGE = 1000000, CARR = 20, seed = 300
 )


</code></pre>

<hr>
<h2 id='create_dataset'>Create concentration-response datasets that can be applied in the <code>run_rcurvep()</code></h2><span id='topic+create_dataset'></span>

<h3>Description</h3>

<p>The input dataset is created either by summarizing the response data
or by simulating the response data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_dataset(d, n_samples = NULL, vdata = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="create_dataset_+3A_d">d</code></td>
<td>
<p>Datasets with concentration-response data.
Examples are <a href="#topic+zfishbeh">zfishbeh</a> and <a href="#topic+zfishdev">zfishdev</a>.</p>
</td></tr>
<tr><td><code id="create_dataset_+3A_n_samples">n_samples</code></td>
<td>
<p>NULL (default) for not to simulate responses or an integer number to indicate the number of responses per concentration to simulate.</p>
</td></tr>
<tr><td><code id="create_dataset_+3A_vdata">vdata</code></td>
<td>
<p>NULL (default) for not to simulate responses or a vector of numeric responses in vehicle control wells to use as error.
This parameter only works when n_samples is not NULL; an experimental feature.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Curvep requires 1-to-1 concentration response relationship.
For the dataset that does not meet the requirement, the following strategies are applied:
</p>


<h4>Summary (when n_samples = NULL)</h4>


<ul>
<li><p> For dichotomous responses, percentage is reported (n_in/N*100).
</p>
</li>
<li><p> For continuous responses, median value of responses per concentration is reported.
</p>
</li></ul>




<h4>Simulation (when n_samples is a positive integer)</h4>


<ul>
<li><p> For dichotomous responses, bootstrap approach is used on the &quot;n_in&quot; vector
to create a vector of percent response.
</p>
</li>
<li><p> For continuous responses, options are a) direct sampling;
b) responses from the linear fit using the original data + error of responses based on the supplied vehicle control data
</p>
</li></ul>




<h3>Value</h3>

<p>The original dataset with a new column, sample_id (if n_samples is not NULL) or
the summarized dataset with columns as <a href="#topic+zfishbeh">zfishbeh</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+run_rcurvep">run_rcurvep()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# datasets with continuous response data
data(zfishbeh)

## default
d &lt;- create_dataset(zfishbeh)

## add samples
d &lt;- create_dataset(zfishbeh, n_samples = 3)

## add samples and vdata
d &lt;- create_dataset(zfishbeh, n_samples = 3, vdata = rnorm(100))

# dataset with dichotomous response data
data(zfishdev)

## default
d &lt;- create_dataset(zfishdev)

## add samples
d &lt;- create_dataset(zfishdev, n_samples = 3)

</code></pre>

<hr>
<h2 id='curvep'>The Curvep function to process one set of concentration-response data</h2><span id='topic+curvep'></span>

<h3>Description</h3>

<p>The relationship between concentration and response has to be 1 to 1.
The function is the backbone of <code><a href="#topic+run_rcurvep">run_rcurvep()</a></code> and <code><a href="#topic+combi_run_rcurvep">combi_run_rcurvep()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>curvep(
  Conc,
  Resp,
  Mask = NULL,
  TRSH = 15,
  RNGE = -100,
  MXDV = 5,
  CARR = 0,
  BSFT = 3,
  USHP = 4,
  TrustHi = FALSE,
  StrictImp = TRUE,
  DUMV = -999,
  TLOG = -24,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="curvep_+3A_conc">Conc</code></td>
<td>
<p>Array of concentrations, e.g., in Molar units, can be log-transformed, in which case internal log-transformation is skipped.</p>
</td></tr>
<tr><td><code id="curvep_+3A_resp">Resp</code></td>
<td>
<p>Array of responses at corresponding concentrations, e.g., raw measurements or normalized to controls.</p>
</td></tr>
<tr><td><code id="curvep_+3A_mask">Mask</code></td>
<td>
<p>array of 1/0 flags indicating invalidated measurements (default = NULL).</p>
</td></tr>
<tr><td><code id="curvep_+3A_trsh">TRSH</code></td>
<td>
<p>Base(zero-)line threshold (default = 15).</p>
</td></tr>
<tr><td><code id="curvep_+3A_rnge">RNGE</code></td>
<td>
<p>Target range of responses (default = -100).</p>
</td></tr>
<tr><td><code id="curvep_+3A_mxdv">MXDV</code></td>
<td>
<p>Maximum allowed deviation from monotonicity (default = 5).</p>
</td></tr>
<tr><td><code id="curvep_+3A_carr">CARR</code></td>
<td>
<p>Carryover detection threshold (default = 0, analysis skipped if set to 0)</p>
</td></tr>
<tr><td><code id="curvep_+3A_bsft">BSFT</code></td>
<td>
<p>For baseline shift issue, min.#points to detect baseline shift (default = 3, analysis skipped if set to 0).</p>
</td></tr>
<tr><td><code id="curvep_+3A_ushp">USHP</code></td>
<td>
<p>For u-shape curves, min.#points to avoid flattening (default = 4, analysis skipped if set to 0).</p>
</td></tr>
<tr><td><code id="curvep_+3A_trusthi">TrustHi</code></td>
<td>
<p>For equal sets of corrections, trusts those retaining measurements at high concentrations (default = FALSE).</p>
</td></tr>
<tr><td><code id="curvep_+3A_strictimp">StrictImp</code></td>
<td>
<p>It prevents extrapolating over concentration-range boundaries; used for POD, ECxx etc (default = TRUE).</p>
</td></tr>
<tr><td><code id="curvep_+3A_dumv">DUMV</code></td>
<td>
<p>A dummy value, default = -999.</p>
</td></tr>
<tr><td><code id="curvep_+3A_tlog">TLOG</code></td>
<td>
<p>A scaling factor for calculating the wAUC, default = -24.</p>
</td></tr>
<tr><td><code id="curvep_+3A_...">...</code></td>
<td>
<p>allow other parameters to pass</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with corrected concentration-response measurements and several calculated curve metrics.
</p>

<ul>
<li><p> resp: corrected responses
</p>
</li>
<li><p> corr: flags for corrections
</p>
</li>
<li><p> ECxx: effective concentration values at various thresholds
</p>
</li>
<li><p> Cxx: concentrations for various absolute response levels
</p>
</li>
<li><p> Emax: maximum effective concentration, slope of the mid-curve (b/w EC25 and EC75)
</p>
</li>
<li><p> wConc: response-weighted concentration
</p>
</li>
<li><p> wResp: concentration-weighed response
</p>
</li>
<li><p> POD: point-of-departure (first concentration with response &gt;TRSH)
</p>
</li>
<li><p> AUC: area-under-curve (in units of log-concentration X response)
</p>
</li>
<li><p> wAUC: AUC weighted by concentration range and POD / TLOG (-24)
</p>
</li>
<li><p> wAUC_pre: AUC weighted by concentration range and POD
</p>
</li>
<li><p> nCorrected: number of points corrected (basically, sum of flags in corr)
</p>
</li>
<li><p> Comments: warning and notes about the dose-response curve
</p>
</li>
<li><p> Settings: input parameters for this run
</p>
</li></ul>



<h3>References</h3>


<p>Sedykh A, Zhu H, Tang H, Zhang L, Richard A, Rusyn I, Tropsha A (2011).
&ldquo;Use of in vitro HTS-derived concentration-response data as biological descriptors improves the accuracy of QSAR models of in vivo toxicity.&rdquo;
<em>Environmental health perspectives</em>, <b>119</b>(3), 364-370.
ISSN 0091-6765, <a href="https://doi.org/10.1289/ehp.1002476">doi:10.1289/ehp.1002476</a>.<br />
</p>
<p>Sedykh A (2016).
&ldquo;CurveP Method for Rendering High-Throughput Screening Dose-Response Data into Digital Fingerprints.&rdquo;
<em>Methods in molecular biology (Clifton, N.J.)</em>, <b>1473</b>.
ISSN 1064-3745, <a href="https://doi.org/10.1007/978-1-4939-6346-1_14">doi:10.1007/978-1-4939-6346-1_14</a>.

</p>


<h3>See Also</h3>

<p><code><a href="#topic+run_rcurvep">run_rcurvep()</a></code> and <code><a href="#topic+combi_run_rcurvep">combi_run_rcurvep()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
curvep(Conc = c(-8, -7, -6, -5, -4) , Resp = c(0, -3, -5, -15, -30))


</code></pre>

<hr>
<h2 id='curvep_defaults'>Default parameters of Curvep</h2><span id='topic+curvep_defaults'></span>

<h3>Description</h3>

<p>Default parameters of Curvep
</p>


<h3>Usage</h3>

<pre><code class='language-R'>curvep_defaults()
</code></pre>


<h3>Value</h3>

<p>A list of parameters with class as curvep_config.
</p>

<ul>
<li><p> TRSH: (default = 15) base(zero-)line threshold
</p>
</li>
<li><p> RNGE: (default = -1000000, decreasing) target range of responses
</p>
</li>
<li><p> MXDV: (default = 5) maximum allowed deviation from monotonicity
</p>
</li>
<li><p> CARR: (default = 0) carryover detection threshold (analysis skipped if set to 0)
</p>
</li>
<li><p> BSFT: (default = 3) for baseline shift issue, min.#points to detect baseline shift (analysis skipped if set to 0)
</p>
</li>
<li><p> USHP: (default = 4) for u-shape curves, min.#points to avoid flattening (analysis skipped if set to 0)
</p>
</li>
<li><p> TrustHi: (default = TRUE)for equal sets of corrections, trusts those retaining measurements at high concentrations
</p>
</li>
<li><p> StrictImp: (default = TRUE) prevents extrapolating over concentration-range boundaries; used for POD, ECxx etc.
</p>
</li>
<li><p> DUMV: (default = -999) dummy value for inactive (not suggested to modify)
</p>
</li>
<li><p> TLOG: (default = -24) denominator for calculation wAUC (not suggested to modify)
</p>
</li>
<li><p> seed: (default = NA) can be set when bootstrapping samples
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+curvep">curvep()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# display all default settings
curvep_defaults()

# customize settings
custom_settings &lt;- curvep_defaults()
custom_settings$TRSH &lt;- 30
custom_settings



</code></pre>

<hr>
<h2 id='estimate_dataset_bmr'>Estimate benchmark response (BMR) for each dataset</h2><span id='topic+estimate_dataset_bmr'></span>

<h3>Description</h3>

<p>Currently two methods have been implemented to get the &quot;keen-point&quot; from the variance(y) - threshold(x) curve.
One is to use the original y values to draw a straight line between the lowest x value (p1) to highest x value (p2).
The knee-point is the x that has the longest distance to the line.
The other one is to fit the data first then use the fitted responses to do the same analysis.
Currently the first method is preferred.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_dataset_bmr(d, p1 = NULL, p2 = NULL, plot = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="estimate_dataset_bmr_+3A_d">d</code></td>
<td>
<p>The rcurvep object with multiple samples and TRSHs. See <code><a href="#topic+combi_run_rcurvep">combi_run_rcurvep()</a></code> for an example.</p>
</td></tr>
<tr><td><code id="estimate_dataset_bmr_+3A_p1">p1</code></td>
<td>
<p>Default = NULL, or an integer value to manually set the first index of line.</p>
</td></tr>
<tr><td><code id="estimate_dataset_bmr_+3A_p2">p2</code></td>
<td>
<p>Default = NULL, or an integer value to manually set the last index of line.</p>
</td></tr>
<tr><td><code id="estimate_dataset_bmr_+3A_plot">plot</code></td>
<td>
<p>Default = TRUE, plot the diagnostic plot.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The estimated BMR can be used in the calculation of POD.
For example, if bmr = 25.
For Curvep, <code>combi_run_rcurvep(zfishbeh, TRSH = 25)</code>.<br />
For Hill fit, <code>summarize_fit_output(run_fit(zfishbeh, modls = "hill"), thr_resp = 25, extract_only = TRUE)</code>.
</p>


<h3>Value</h3>

<p>A list with two components: stats and outcome.
</p>

<ul>
<li><p> stats: a tibble, including pooled variance (pvar),
fitted responses (y_exp_fit, y_lm_fit), distance to the line (dist2l)
</p>
</li>
<li><p> outcome: a tibble, including estimated BMRs (bmr)
</p>
</li></ul>
<p>;
Suffix in the <strong>stats</strong> and <strong>outcome</strong> tibble: &quot;ori&quot; (original values), &quot;exp&quot;(exponential fit).
prefix in the <strong>outcome</strong> tibble, &quot;cor&quot; (correlation between the fitted responses and the original responses),
&quot;bmr&quot; (benchmark response), &quot;qc&quot; (quality control).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+cal_knee_point">cal_knee_point()</a></code>, <code><a href="#topic+combi_run_rcurvep">combi_run_rcurvep()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# no extra cleaning
data(zfishdev_act)
bmr_out &lt;- estimate_dataset_bmr(zfishdev_act, plot = FALSE)
plot(bmr_out)

# if want to do extra cleaning...
actm &lt;- summarize_rcurvep_output(zfishdev_act, clean_only = TRUE, inactivate = "CARRY_OVER")

bmr_out &lt;- estimate_dataset_bmr(actm, plot = FALSE)


</code></pre>

<hr>
<h2 id='fit_cc2_modl'>Fit concentration-response data using Curve Class2 approach</h2><span id='topic+fit_cc2_modl'></span>

<h3>Description</h3>

<p>Curve Class2 uses 4-parameter Hill model to fit the data.
The algorithm assumes the responses are in percentile.
Curve Class2 classifies the curves based on fit quality and response magnitude.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_cc2_modl(Conc, Resp, classSD = 5, minYrange = 20, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fit_cc2_modl_+3A_conc">Conc</code></td>
<td>
<p>A vector of log10 concentrations.</p>
</td></tr>
<tr><td><code id="fit_cc2_modl_+3A_resp">Resp</code></td>
<td>
<p>A vector of numeric responses.</p>
</td></tr>
<tr><td><code id="fit_cc2_modl_+3A_classsd">classSD</code></td>
<td>
<p>A standard deviation (SD) derived from the responses in the vehicle control.
it is used for classification of the curves. Default = 5%.</p>
</td></tr>
<tr><td><code id="fit_cc2_modl_+3A_minyrange">minYrange</code></td>
<td>
<p>A minimum response range (max activity - min activity) required to apply curve fitting.
Curve fitting will not be attempted if the response range is less than the cutoff.
Default = 20%.</p>
</td></tr>
<tr><td><code id="fit_cc2_modl_+3A_...">...</code></td>
<td>
<p>for additional curve class2 parameters (currently none)</p>
</td></tr>
</table>


<h3>Details</h3>


<dl>
<dt>cc2 = 1.1</dt><dd><p>2-asymptote curve, pvalue &lt; 0.05, emax &gt; 6\*classSD</p>
</dd>
<dt>cc2 = 1.2</dt><dd><p>2-asymptote curve, pvalue &lt; 0.05, emax &lt;= 6\*classSD &amp; emax &gt; 3\*classSD</p>
</dd>
<dt>cc2 = 1.3</dt><dd><p>2-asymptote curve, pvalue &gt;= 0.05, emax &gt; 6\*classSD</p>
</dd>
<dt>cc2 = 1.4</dt><dd><p>2-asymptote curve, pvalue &gt;= 0.05, emax &lt;= 6\*classSD &amp; emax &gt; 3\*classSD</p>
</dd>
<dt>cc2 = 2.1</dt><dd><p>1-asymptote curve, pvalue &lt; 0.05, emax &gt; 6\*classSD</p>
</dd>
<dt>cc2 = 2.2</dt><dd><p>1-asymptote curve, pvalue &lt; 0.05, emax &lt;= 6\*classSD &amp; emax &gt; 3\*classSD</p>
</dd>
<dt>cc2 = 2.3</dt><dd><p>1-asymptote curve, pvalue &gt;= 0.05, emax &gt; 6\*classSD</p>
</dd>
<dt>cc2 = 2.4</dt><dd><p>1-asymptote curve, pvalue &gt;= 0.05, emax &lt;= 6\*classSD &amp; emax &gt; 3\*classSD</p>
</dd>
<dt>cc2 = 3</dt><dd><p>single point activity, pvalue = NA, emax &gt; 3\*classSD</p>
</dd>
<dt>cc2 = 4</dt><dd><p>inactive, pvalue  &gt;= 0.05, emax &lt;= 3\*classSD</p>
</dd>
<dt>cc2 = 5</dt><dd><p>inconclusive, high bt, further investigation is needed</p>
</dd>
</dl>



<h3>Value</h3>

<p>A list of output parameters from Curve Class2 model fit.
If the data are fit or not fittable (fit = 0), the default value for tp, ga, gw, bt pvalue, masks, nmasks is NA.
For cc2 = 4, it is still possible to have fit parameters.
</p>

<ul>
<li><p> modl: model type, i.e., cc2
</p>
</li>
<li><p> fit: fittable, 1 (yes) or 0 (no)
</p>
</li>
<li><p> aic: NA, it is not calculated for this model. The parameter is kept for compatability.
</p>
</li>
<li><p> cc2: curve class2, default = 4
</p>
</li>
<li><p> tp: model top, &lt;0 means the fit for decreasing direction is preferred
</p>
</li>
<li><p> ga: ac50 (log10 scale)
</p>
</li>
<li><p> gw: Hill coefficient
</p>
</li>
<li><p> bt: model bottom
</p>
</li>
<li><p> pvalue: from F-test, for fit quality
</p>
</li>
<li><p> r2: fitness
</p>
</li>
<li><p> masks: a string to indicate at which positions of response are masked
</p>
</li>
<li><p> nmasks: number of masked responses
</p>
</li></ul>



<h3>References</h3>


<p>Huang R (2022).
&ldquo;A Quantitative High-Throughput Screening Data Analysis Pipeline for Activity Profiling.&rdquo;
<em>Methods in molecular biology (Clifton, N.J.)</em>, <b>2474</b>, 133â€”145.
ISSN 1064-3745, <a href="https://doi.org/10.1007/978-1-0716-2213-1_13">doi:10.1007/978-1-0716-2213-1_13</a>.

</p>


<h3>See Also</h3>

<p><code><a href="#topic+fit_modls">fit_modls()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
fit_cc2_modl(c(-9, -8, -7, -6, -5, -4), c(0, 2, 30, 40, 50, 60))



</code></pre>

<hr>
<h2 id='fit_modls'>Fit one set of concentration-response data using types of models</h2><span id='topic+fit_modls'></span>

<h3>Description</h3>

<p>A convenient function to fit data using available models
and to sort the outcomes by AIC values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_modls(Conc, Resp, Mask = NULL, modls, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fit_modls_+3A_conc">Conc</code></td>
<td>
<p>A vector of log10 concentrations.</p>
</td></tr>
<tr><td><code id="fit_modls_+3A_resp">Resp</code></td>
<td>
<p>A vector of numeric responses.</p>
</td></tr>
<tr><td><code id="fit_modls_+3A_mask">Mask</code></td>
<td>
<p>Default = NULL or a vector of 1 or 0.
1 is for masking the respective response.</p>
</td></tr>
<tr><td><code id="fit_modls_+3A_modls">modls</code></td>
<td>
<p>The model types for the fitting.
Currently available models are 3-parameter Hill model (hill), constant model (cnst),
and Curve Class2 4-parameter Hill model (cc2).
Multiple values are only allowed for the hill and cnst combination.</p>
</td></tr>
<tr><td><code id="fit_modls_+3A_...">...</code></td>
<td>
<p>The named input configurations for replacing the default configurations.
The input configuration needs to add model type as the prefix.
For example, hill_pdir = -1 will set the Hill fit only to the decreasing direction.
Another common parameter for cc2 model is cc2_classSD.
The default value of cc2_classSD is 5%, which might be too small for noiser endpoints.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The backbone of fit method using hill (3-parameter Hill model) and cnst (constant model) is based on the implementation from tcpl package.
But the lower bound of ga is lower by log10(1/100).
The cc2 model is the 4-parameter Hill model from Curve Class2.
</p>


<h3>Value</h3>

<p>A list of components named by the models.
The models are sorted by their AIC values (when multiple models are used).
Thus, the first component has the best fit.
</p>


<h4>hill</h4>

<p>Fit output from Hill equation
</p>

<ul>
<li><p> modl: model type, i.e., hill
</p>
</li>
<li><p> fit: fittable, 1 (yes) or 0 (no)
</p>
</li>
<li><p> aic: AIC value
</p>
</li>
<li><p> tp: model top, &lt;0 means the fit for decreasing direction is preferred
</p>
</li>
<li><p> ga: ac50 (log10 scale)
</p>
</li>
<li><p> gw: Hill coefficient
</p>
</li>
<li><p> er: scale term for Student's t distribution
</p>
</li></ul>




<h4>cnst</h4>

<p>Fit output from constant model
</p>

<ul>
<li><p> modl: model type, i.e., cnst
</p>
</li>
<li><p> fit: fittable?, 1 or 0
</p>
</li>
<li><p> aic: AIC value
</p>
</li>
<li><p> er: scale term
</p>
</li></ul>




<h4>cc2</h4>

<p>Fit output from Curve Class 2 model
</p>

<ul>
<li><p> modl: model type, i.e., cc2
</p>
</li>
<li><p> fit: fittable, 1 (yes) or 0 (no)
</p>
</li>
<li><p> aic: NA, it is not calculated for this model. The parameter is kept for compatability.
</p>
</li>
<li><p> cc2: curve class2, default = 4
</p>
</li>
<li><p> tp: model top, &lt;0 means the fit for decreasing direction is preferred
</p>
</li>
<li><p> ga: ac50 (log10 scale)
</p>
</li>
<li><p> gw: Hill coefficient
</p>
</li>
<li><p> bt: model bottom
</p>
</li>
<li><p> pvalue: from F-test, for fit quality
</p>
</li>
<li><p> r2: fitness
</p>
</li>
<li><p> masks: a string to indicate at which positions of response are masked
</p>
</li>
<li><p> nmasks: number of masked responses
</p>
</li></ul>




<h3>See Also</h3>

<p><code><a href="tcpl.html#topic+Models">tcpl::tcplObjHill()</a></code>, <code><a href="tcpl.html#topic+Models">tcpl::tcplObjCnst()</a></code>, <code><a href="#topic+get_hill_fit_config">get_hill_fit_config()</a></code>
<code><a href="#topic+fit_cc2_modl">fit_cc2_modl()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
concd &lt;- c(-9, -8, -7, -6, -5, -4)
respd &lt;- c(0, 2, 30, 40, 50, 20)
maskd &lt;- c(0, 0, 0, 0, 0, 1)

# run hill only
fit_modls(concd, respd, modls = "hill")

# run hill only + increasing direction only
fit_modls(concd, respd, modls = "hill", hill_pdir = 1)

# run cc2 only + change of classSD
fit_modls(concd, respd, modls = "cc2", cc2_classSD = 10)

# run hill + cnst
fit_modls(concd, respd, modls = c("hill", "cnst"))

# run with mask at the highest concentration
fit_modls(concd, respd, maskd, modls = "hill")


</code></pre>

<hr>
<h2 id='get_hill_fit_config'>Get the default configurations for the Hill fit</h2><span id='topic+get_hill_fit_config'></span>

<h3>Description</h3>

<p>The function gives the default settings by using one set of concentration-response data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_hill_fit_config(Conc, Resp, optimf = "tcplObjHill")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_hill_fit_config_+3A_conc">Conc</code></td>
<td>
<p>A vector of log10 concentrations.</p>
</td></tr>
<tr><td><code id="get_hill_fit_config_+3A_resp">Resp</code></td>
<td>
<p>A vector of numeric responses.</p>
</td></tr>
<tr><td><code id="get_hill_fit_config_+3A_optimf">optimf</code></td>
<td>
<p>The default optimized function is <code><a href="tcpl.html#topic+Models">tcpl::tcplObjHill()</a></code>.
but can be changed to ObjHillnorm().</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of input configurations.
</p>

<ul>
<li><p> theta: initial values of parameters for Hill equation: tp, ga, gw, er
</p>
</li>
<li><p> f: the object function
</p>
</li>
<li><p> ui: the bound matrix
</p>
</li>
<li><p> ci: the bound constraints
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="tcpl.html#topic+Models">tcpl::tcplObjHill()</a></code>, <code><a href="#topic+fit_modls">fit_modls()</a></code>
</p>

<hr>
<h2 id='merge_rcurvep_objs'>Merge results from multiple rcurvep objects</h2><span id='topic+merge_rcurvep_objs'></span>

<h3>Description</h3>

<p>Sometimes user may want to try multiple curvep setting and pick the one that can capture the shape (wAUC != 0).
The highest absolute wAUC from the chemical-endpoint(-sample_id) pair will be picked.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>merge_rcurvep_objs(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="merge_rcurvep_objs_+3A_...">...</code></td>
<td>
<p>rcurvep objects</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an updated rcurvep object with config = NULL
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(zfishbeh)

# combine default + mask
out1 &lt;- combi_run_rcurvep(zfishbeh, TRSH = 10)
out2 &lt;- combi_run_rcurvep(zfishbeh, TRSH = 10, mask = 1)
m1 &lt;- merge_rcurvep_objs(out1, out2)

# use same set of samples to combine
out1 &lt;- combi_run_rcurvep(zfishbeh, TRSH = 10, n_samples = 2, seed = 300)
out2 &lt;- combi_run_rcurvep(zfishbeh, TRSH = 10, mask = 1, n_samples = 2, seed = 300)
m1 &lt;- merge_rcurvep_objs(out1, out2)

</code></pre>

<hr>
<h2 id='plot.rcurvep_bmr'>Plot BMR diagnostic curves</h2><span id='topic+plot.rcurvep_bmr'></span>

<h3>Description</h3>

<p>Plot BMR diagnostic curves
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'rcurvep_bmr'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.rcurvep_bmr_+3A_x">x</code></td>
<td>
<p>The rcurvep_bmr object from <code><a href="#topic+estimate_dataset_bmr">estimate_dataset_bmr()</a></code>.</p>
</td></tr>
<tr><td><code id="plot.rcurvep_bmr_+3A_...">...</code></td>
<td>
<p>Allowed values: n_in_page, number of endpoints in a page.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggplot object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(zfishdev_act)
bmr_out &lt;- estimate_dataset_bmr(zfishdev_act, plot = FALSE)
plot(bmr_out)

</code></pre>

<hr>
<h2 id='run_fit'>Run parametric fits using types of models on concentration-response datasets</h2><span id='topic+run_fit'></span>

<h3>Description</h3>

<p>Confidence intervals of activity metrics can be obtained through bootstrap approach.
The bootstrap samples are generated by adding the residuals (the difference between the original responses and the Hill fit) to
the fitted response (only for Hill equation, 3-parameter).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>run_fit(d, modls, keep_sets = c("fit_set", "resp_set"), n_samples = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="run_fit_+3A_d">d</code></td>
<td>
<p>Datasets with concentration-response data.
An example is <a href="#topic+zfishbeh">zfishbeh</a>.
mask column is optional.</p>
</td></tr>
<tr><td><code id="run_fit_+3A_modls">modls</code></td>
<td>
<p>The model types for the fitting.
Currently available models are 3-parameter Hill model (hill), constant model (cnst),
and Curve Class2 4-parameter Hill model (cc2).
Multiple values are only allowed for the hill and cnst combination.</p>
</td></tr>
<tr><td><code id="run_fit_+3A_keep_sets">keep_sets</code></td>
<td>
<p>Output datasets. Multiple values are allowed.
Default values are fit_set and resp_set.
fit_set is a must.
</p>

<ul>
<li><p> fit_set: a tibble with output from model fits
</p>
</li>
<li><p> resp_set: a tibble with fitted response data from the winning model.
If winning model is hill + no fit or cc2 + hit=4(inactive), response is NA.
If winning model is cnst, median of all responses is reported for each concentration.
</p>
</li></ul>
</td></tr>
<tr><td><code id="run_fit_+3A_n_samples">n_samples</code></td>
<td>
<p>NULL (default) for no bootstrap samples are generated or number of samples to be generated from bootstrapping.
When n_samples is not NULL, modls currently needs to be hill.</p>
</td></tr>
<tr><td><code id="run_fit_+3A_...">...</code></td>
<td>
<p>The named input configurations for replacing the default configurations.
The input configuration needs to add model type as the prefix.
For example, hill_pdir = -1 will set the Hill fit only to the decreasing direction.
Add cc2_classSD = 10 will set the classification SD to 10%.
Often 5% or 10% are used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of named components: result and result_nested.
The result component is also a list of output sets depending on the parameter, <em>keep_sets</em>.
The result_nested component is a tibble with input data nested in a column, input,
and output data nested in a column, output.
</p>


<h3>Data structure</h3>

<p>output
|- result (list)
|   |- fit_set
|   |- resp_set
|
|- result_nested (tibble)
</p>
<p>The prefix of the column names in the <em>fit_set</em> are the used models.
The <em>win_modl</em> is the winning model.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fit_modls">fit_modls()</a></code> for model fit information and the following analyses using <code><a href="#topic+summarize_fit_output">summarize_fit_output()</a></code>.
for dichotomous response (see <a href="#topic+zfishdev">zfishdev</a>), use <code>create_dataset()</code> first.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# It is suggested to use na.omit on the dataset to see if any data will be removed

# use hill + cnst model
fitd &lt;- run_fit(zfishbeh, modls = c("hill", "cnst"))

# use only hill model and fit only to the decreasing direction, keep only the fit_set output
fitd &lt;- run_fit(zfishbeh, modls = "hill", keep_sets = "fit_set", hill_pdir = -1)

# use cc2 model + higher classification SD
fitd &lt;- run_fit(zfishbeh, modls = "cc2", cc2_classSD = 10)

# fit to the bootstrap samples using hill
fitd &lt;- run_fit(zfishbeh, n_samples = 2, modls = "hill")



</code></pre>

<hr>
<h2 id='run_rcurvep'>Run Curvep on datasets of concentration-response data</h2><span id='topic+run_rcurvep'></span>

<h3>Description</h3>

<p>The concentration-response relationship per endpoint and chemical has to be 1-to-1.
If not, use <code><a href="#topic+create_dataset">create_dataset()</a></code> for pre-processing or
use <code><a href="#topic+combi_run_rcurvep">combi_run_rcurvep()</a></code>, which has both pre-processing and more flexible parameter controls.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>run_rcurvep(
  d,
  mask = 0,
  config = curvep_defaults(),
  keep_sets = c("act_set", "resp_set", "fp_set"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="run_rcurvep_+3A_d">d</code></td>
<td>
<p>Datasets with columns: endpoint, chemical, conc, and resp, mask (optional)
Example datasets as <a href="#topic+zfishbeh">zfishbeh</a>.
It is required that the baseline of responses in the resp column to be 0.</p>
</td></tr>
<tr><td><code id="run_rcurvep_+3A_mask">mask</code></td>
<td>
<p>Default = 0, for no mask (values in the mask column all 0).
Use a vector of integers to mask the responses:
1 to mask the response at the highest concentration;
2 to mask the response at the second highest concentration, and so on.
If mask column exists, the setting will be ignored.</p>
</td></tr>
<tr><td><code id="run_rcurvep_+3A_config">config</code></td>
<td>
<p>Default configurations set by <code><a href="#topic+curvep_defaults">curvep_defaults()</a></code>.</p>
</td></tr>
<tr><td><code id="run_rcurvep_+3A_keep_sets">keep_sets</code></td>
<td>
<p>The types of output to be reported.
Allowed values: act_set, resp_set, fp_set. Multiple values are allowed.
act_set is the must.
</p>

<ul>
<li><p> act_set: activity data
</p>
</li>
<li><p> resp_set: response data
</p>
</li>
<li><p> fp_set: fingerprint data
</p>
</li></ul>
</td></tr>
<tr><td><code id="run_rcurvep_+3A_...">...</code></td>
<td>
<p>Curvep settings.
See <code><a href="#topic+curvep_defaults">curvep_defaults()</a></code> for allowed parameters.
These can be used to overwrite the default values.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An rcurvep object. It has two components: result, config
The result component is also a list of output sets depending on the parameter, <em>keep_sets</em>.
The config component is a <em>curvep_config</em> object.<br />
</p>
<p>Often used columns in the <em>act_set</em>: AUC (area under the curve), wAUC (weighted AUC),
POD (point-of-departure), EC50 (Half maximal effective concentration),
nCorrected (number of corrected points).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+create_dataset">create_dataset()</a></code>, <code><a href="#topic+combi_run_rcurvep">combi_run_rcurvep()</a></code>, <code><a href="#topic+curvep_defaults">curvep_defaults()</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(zfishbeh)
d &lt;- create_dataset(zfishbeh)

# default
out &lt;- run_rcurvep(d)

# change TRSH
out &lt;- run_rcurvep(d, TRSH = 30)

# mask response at highest and second highest concentration
out &lt;- run_rcurvep(d, mask = c(1, 2))


</code></pre>

<hr>
<h2 id='summarize_fit_output'>Summarize the results from the parametric fitting using types of models</h2><span id='topic+summarize_fit_output'></span>

<h3>Description</h3>

<p>The function first extracts the activity data based on the fit the supplied input parameters.
In addition, summary of activity data (e.g., confidence interval, hit confidence) can be produced.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>summarize_fit_output(
  d,
  thr_resp = 20,
  perc_resp = 10,
  ci_level = 0.95,
  extract_only = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summarize_fit_output_+3A_d">d</code></td>
<td>
<p>The output from the <code><a href="#topic+run_fit">run_fit()</a></code>.</p>
</td></tr>
<tr><td><code id="summarize_fit_output_+3A_thr_resp">thr_resp</code></td>
<td>
<p>The response cutoff to calculate the potency. Default = 20 (POD20)</p>
</td></tr>
<tr><td><code id="summarize_fit_output_+3A_perc_resp">perc_resp</code></td>
<td>
<p>The percentage cutoff to calculate the potency. Default = 10 (EC10).</p>
</td></tr>
<tr><td><code id="summarize_fit_output_+3A_ci_level">ci_level</code></td>
<td>
<p>The confidence level for the activity metrics. Default is = 0.95.</p>
</td></tr>
<tr><td><code id="summarize_fit_output_+3A_extract_only">extract_only</code></td>
<td>
<p>Whether act_summary data should be produced. Default = FALSE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A tibble, act_set is generated. When (extract_only = FALSE), a tibble, act_summary is generated with confidence intervals of the activity metrics.
The quantile approach is used to calculate the confidence interval.
Currently only bootstrap calculations from hill (3-parameter) can generate confidence interval
For potency activity metrics, if value is NA, highest tested concentration is used in the summary.
For other activity metrics, if value is NA, 0 is used in the summary.
</p>


<h3>Value</h3>

<p>A list of named components: result and result_nested (and act_summary).
The result and result_nested are the copy from the output of <code><a href="#topic+run_fit">run_fit()</a></code>.
An act_set is added under the result component.
If (extract_only = FALSE), an act_summary is added.
</p>


<h3>Hit definition</h3>



<h4>cnst</h4>

<p>If the cnst is the winning model and the median of responses larger than the thr_resp, it is considered as an hit.
The median of responses is reported as Emax and the lowest tested concentration is reported as EC50, POD, ECxx.
</p>



<h4>hill</h4>

<p>The hit (=1) is considered having POD &lt; max tested concentration.
</p>



<h4>cc2</h4>

<p>The hit value is from the cc2 value
</p>



<h3>Output structure</h3>

<p>output
|- result (list)
|   |- fit_set (tibble, all output from the respective fit model included)
|   |- resp_set (tibble)
|   |- act_set (tibble, EC50, ECxx, Emax, POD, slope, hit)
|
|- result_nested (tibble)
|- act_summary (tibble, confidence interval)
</p>


<h3>activity metrics</h3>


<dl>
<dt>hit</dt><dd><p>hit call, see above definition</p>
</dd>
<dt>EC50</dt><dd><p>half maximal effect concentration</p>
</dd>
<dt>ECxx</dt><dd><p>effect concentration at XX percent, depending on the perc_resp </p>
</dd>
<dt>POD</dt><dd><p>point-of-departure, depending on the thr_resp</p>
</dd>
<dt>Emax</dt><dd><p>max effect - min effect from the fit</p>
</dd>
<dt>slope</dt><dd><p>slope factor from the fit</p>
</dd>
</dl>



<h3>See Also</h3>

<p><code><a href="#topic+run_fit">run_fit()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# generate some fit outputs


## fit only
fitd1 &lt;- run_fit(zfishbeh, modls = "cc2")

## fit + bootstrap samples
fitd2 &lt;- run_fit(zfishbeh, n_samples = 3, modls = "hill")

## fit using hill + cnst
fitd3 &lt;- run_fit(zfishbeh, modls = c("hill", "cnst"))


# only to extract the activity data
sumd1 &lt;- summarize_fit_output(fitd1, extract_only = TRUE)
sumd3 &lt;- summarize_fit_output(fitd3, extract_only = TRUE)

# calculate EC20 instead of default EC10
sumd1 &lt;- summarize_fit_output(fitd1, extract_only = TRUE, perc_resp  = 20)

# calculate POD using a higher noise level (e.g., 40)
## this number depends on the response unit
sumd1 &lt;- summarize_fit_output(fitd1, extract_only = TRUE, thr_resp  = 40)

# calculate confidence intervals based on the bootstrap samples
sumd2 &lt;- summarize_fit_output(fitd2)



</code></pre>

<hr>
<h2 id='summarize_rcurvep_output'>Clean and summarize the output of rcurvep object</h2><span id='topic+summarize_rcurvep_output'></span>

<h3>Description</h3>

<p>Clean and summarize the output of rcurvep object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>summarize_rcurvep_output(
  d,
  inactivate = NULL,
  ci_level = 0.95,
  clean_only = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summarize_rcurvep_output_+3A_d">d</code></td>
<td>
<p>The rcurvep object from <code><a href="#topic+combi_run_rcurvep">combi_run_rcurvep()</a></code> and <code><a href="#topic+run_rcurvep">run_rcurvep()</a></code>.</p>
</td></tr>
<tr><td><code id="summarize_rcurvep_output_+3A_inactivate">inactivate</code></td>
<td>
<p>A character string, default = NULL,
to make the curve with this string in the Comments column as inactive.
or a vector of index for the rows in the act_set that needs to be inactive</p>
</td></tr>
<tr><td><code id="summarize_rcurvep_output_+3A_ci_level">ci_level</code></td>
<td>
<p>Default = 0.95 (95 percent of confidence interval).</p>
</td></tr>
<tr><td><code id="summarize_rcurvep_output_+3A_clean_only">clean_only</code></td>
<td>
<p>Default = FALSE, only the 1st, 2nd task will be performed (see Details).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function can perform the following tasks:
</p>

<ol>
<li><p> add an column, hit, in the <em>act_set</em>
</p>
</li>
<li><p> unhit (make result as inactive) if the Comments column contains a certain string
</p>
</li>
<li><p> summarize the results
</p>
</li></ol>

<p>The curve is considered as &quot;hit&quot; if its responses are monotonic after processing by Curvep.
However, often, if the curve is &quot;INVERSE&quot; (yet monotonic) is not considered as an active curve.
By using the information in the Comments column, we can &quot;unhit&quot; these cases.
</p>
<p>When (clean_only = FALSE, default), a tibble, act_summary is generated with confidence intervals of the activity metrics.
The quantile approach is used to calculate the confidence interval.
For potency activity metrics, if value is NA, highest tested concentration is used in the summary.
For other activity metrics, if value is NA, 0 is used in the summary.
</p>


<h3>Value</h3>

<p>A list of named components: result and config (and act_summary).
The result and config are the copy of the input d (but with modifications if <em>inactivate</em> is not NULL).
If (clean_only = FALSE), an <em>act_summary</em> is added.
</p>
<p>Suffix meaning in column names in <em>act_summary</em>: med (median), cil (lower end confidence interval),
ciu (higher end confidence interval)
Often used columns in <em>act_summary</em>: n_curves (number of curves used in summary), hit_confidence (fraction of active in n_curves)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+combi_run_rcurvep">combi_run_rcurvep()</a></code>, <code><a href="#topic+run_rcurvep">run_rcurvep()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(zfishbeh)

# original datasets
out &lt;- combi_run_rcurvep(zfishbeh, n_samples = NULL, TRSH = c(5, 10))
out_res &lt;- summarize_rcurvep_output(out)


# unhit when comment has "INVERSE"
out &lt;- summarize_rcurvep_output(out, inactivate = "INVERSE")

# unhit for certain rows in act_set
out &lt;- summarize_rcurvep_output(out, inactivate = c(2,3))

# simulated datasets
out &lt;- combi_run_rcurvep(zfishbeh, n_samples = 3, TRSH = c(5, 10))
out_res &lt;- summarize_rcurvep_output(out)


</code></pre>

<hr>
<h2 id='zfishbeh'>Subsets of concentration response datasets from zebrafish neurotoxicity assays</h2><span id='topic+zfishbeh'></span>

<h3>Description</h3>

<p>The datasets contain 11 toxicity endpoints and 2 chemicals.
The responses have been normalized so that the baseline is 0.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>zfishbeh
</code></pre>


<h3>Format</h3>

<p>A tibble with 2123 rows and 4 columns:
</p>

<dl>
<dt>endpoint</dt><dd><p>endpoint name</p>
</dd>
<dt>chemical</dt><dd><p>chemical name + CASRN</p>
</dd>
<dt>conc</dt><dd><p>concentrations in log10(M) format</p>
</dd>
<dt>resp</dt><dd><p>responses after normalized using the vehicle control on each plate</p>
</dd>
</dl>



<h3>Source</h3>

<p>Biobide study S-BBD-0017/15
</p>

<hr>
<h2 id='zfishdev'>Subsets of concentration response datasets from zebrafish developmental toxicity assays</h2><span id='topic+zfishdev'></span>

<h3>Description</h3>

<p>The datasets contain 4 toxicity endpoints and 3 chemicals.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>zfishdev
</code></pre>


<h3>Format</h3>

<p>A tibble with 96 rows and 5 columns:
</p>

<dl>
<dt>endpoint</dt><dd><p>endpoint name + at time point measured</p>
</dd>
<dt>chemical</dt><dd><p>chemical name + CASRN</p>
</dd>
<dt>conc</dt><dd><p>concentrations in log10(M) format</p>
</dd>
<dt>n_in</dt><dd><p>number of incidence</p>
</dd>
<dt>N</dt><dd><p>number of embryos</p>
</dd>
</dl>



<h3>Source</h3>

<p>Biobide study S-BBD-00016/15
</p>

<hr>
<h2 id='zfishdev_act'>Activity output based on simulated datasets using zfishdev_all dataset</h2><span id='topic+zfishdev_act'></span>

<h3>Description</h3>

<p>The data is an rcurvep object from the <code><a href="#topic+combi_run_rcurvep">combi_run_rcurvep()</a></code>.
See <code><a href="#topic+combi_run_rcurvep">combi_run_rcurvep()</a></code> for the code to reproduce this dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>zfishdev_act
</code></pre>


<h3>Format</h3>

<p>A list of two named components: result and config.
The result component is a list with one component: act_set.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+estimate_dataset_bmr">estimate_dataset_bmr()</a></code>
</p>

<hr>
<h2 id='zfishdev_all'>Full sets of concentration response datasets from zebrafish developmental toxicity assays</h2><span id='topic+zfishdev_all'></span>

<h3>Description</h3>

<p>The datasets contain 4 toxicity endpoints and 32 chemicals.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>zfishdev_all
</code></pre>


<h3>Format</h3>

<p>A tibble with 512 rows and 5 columns:
</p>


<h3>Source</h3>

<p>Biobide study S-BBD-00016/15
</p>


<h3>See Also</h3>

<p><a href="#topic+zfishdev">zfishdev</a>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
