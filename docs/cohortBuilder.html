<!DOCTYPE html><html><head><title>Help for package cohortBuilder</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {cohortBuilder}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#.as_constructor'><p>Attach proper class to filter constructor</p></a></li>
<li><a href='#.gen_id'><p>Generate random ID</p></a></li>
<li><a href='#.get_item'><p>Return list of objects matching provided condition.</p></a></li>
<li><a href='#.get_method'><p>Get function definition</p></a></li>
<li><a href='#.if_value'><p>Return default value if values are equal</p></a></li>
<li><a href='#%-&gt;%'><p>Operator simplifying adding steps or filters to Cohort and Source objects</p></a></li>
<li><a href='#add_filter'><p>Add filter definition</p></a></li>
<li><a href='#add_source'><p>Add source to Cohort object.</p></a></li>
<li><a href='#add_step'><p>Add filtering step definition</p></a></li>
<li><a href='#attrition'><p>Show attrition plot.</p></a></li>
<li><a href='#binding-keys'><p>Describe data relations with binding keys</p></a></li>
<li><a href='#code'><p>Return reproducible data filtering code.</p></a></li>
<li><a href='#Cohort'><p>R6 class representing Cohort object.</p></a></li>
<li><a href='#cohort-methods'><p>Cohort related methods</p></a></li>
<li><a href='#cohortBuilder-package'><p>Create data source cohort</p></a></li>
<li><a href='#create-cohort'><p>Create new 'Cohort' object</p></a></li>
<li><a href='#creating-filters'><p>Define custom filter.</p></a></li>
<li><a href='#data_key'><p>Define Source dataset key</p></a></li>
<li><a href='#description'><p>Show source data or filter description</p></a></li>
<li><a href='#filter'><p>Define Cohort filter</p></a></li>
<li><a href='#filter-source-types'><p>Filter Source types methods</p></a></li>
<li><a href='#filter-types'><p>Filter types</p></a></li>
<li><a href='#get_data'><p>Get step related data</p></a></li>
<li><a href='#get_state'><p>Get Cohort configuration state.</p></a></li>
<li><a href='#hooks'><p>Cohort hooks.</p></a></li>
<li><a href='#librarian'><p>Sample of library database</p></a></li>
<li><a href='#managing-cohort'><p>Managing the Cohort object</p></a></li>
<li><a href='#managing-source'><p>Managing the Source object</p></a></li>
<li><a href='#plot_data'><p>Plot filter related Cohort data.</p></a></li>
<li><a href='#primary_keys'><p>Define Source datasets primary keys</p></a></li>
<li><a href='#restore'><p>Restore Cohort object.</p></a></li>
<li><a href='#rm_filter'><p>Remove filter definition</p></a></li>
<li><a href='#rm_step'><p>Remove filtering step definition</p></a></li>
<li><a href='#run'><p>Trigger data calculations.</p></a></li>
<li><a href='#set_source'><p>Create Cohort source</p></a></li>
<li><a href='#Source'><p>R6 class representing a data source</p></a></li>
<li><a href='#source-layer'><p>Source compatibility methods.</p></a></li>
<li><a href='#stat'><p>Get Cohort related statistics.</p></a></li>
<li><a href='#step'><p>Create filtering step</p></a></li>
<li><a href='#sum_up'><p>Sum up Cohort state.</p></a></li>
<li><a href='#tblist'><p>Create in memory tables connection</p></a></li>
<li><a href='#update_filter'><p>Update filter definition</p></a></li>
<li><a href='#update_source'><p>Update source in Cohort object.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Data Source Agnostic Filtering Tools</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.0</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Krystian Igras &lt;krystian8207@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Common API for filtering data stored in different data models.
    Provides multiple filter types and reproducible R code.
    Works standalone or with 'shinyCohortBuilder' as the GUI for interactive Shiny apps.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>R6, jsonlite, purrr, tibble, dplyr (&ge; 1.0.0), tidyr,
magrittr, glue, ggplot2, rlang (&ge; 1.0), formatR</td>
</tr>
<tr>
<td>KeepSource:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 3.0.0), shiny, knitr, rmarkdown</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Collate:</td>
<td>'cohortBuilder-package.R' 'cohort_methods.R'
'source_methods.R' 'step.R' 'filter.R' 'attrition.R'
'bind_keys.R' 'hooks.R' 'list_operators.R' 'repro_code_utils.R'
'source_tblist.R' 'data.R'</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/r-world-devs/cohortBuilder/">https://github.com/r-world-devs/cohortBuilder/</a>,
<a href="https://r-world-devs.github.io/cohortBuilder/">https://r-world-devs.github.io/cohortBuilder/</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-02-28 13:46:51 UTC; krystiai</td>
</tr>
<tr>
<td>Author:</td>
<td>Krystian Igras [cre, aut],
  Adam Fory≈õ [ctb]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-02-28 17:02:33 UTC</td>
</tr>
</table>
<hr>
<h2 id='.as_constructor'>Attach proper class to filter constructor</h2><span id='topic+.as_constructor'></span>

<h3>Description</h3>

<p>Attach proper class to filter constructor
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.as_constructor(filter_constructor)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id=".as_constructor_+3A_filter_constructor">filter_constructor</code></td>
<td>
<p>Function defining filter.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A function having 'cb_filter_constructor' class attached.
</p>

<hr>
<h2 id='.gen_id'>Generate random ID</h2><span id='topic+.gen_id'></span>

<h3>Description</h3>

<p>Generate random ID
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.gen_id()
</code></pre>


<h3>Value</h3>

<p>A character type value.
</p>

<hr>
<h2 id='.get_item'>Return list of objects matching provided condition.</h2><span id='topic+.get_item'></span>

<h3>Description</h3>

<p>Return list of objects matching provided condition.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.get_item(list_obj, attribute, value, operator = `==`)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id=".get_item_+3A_list_obj">list_obj</code></td>
<td>
<p>List of R objects.</p>
</td></tr>
<tr><td><code id=".get_item_+3A_attribute">attribute</code></td>
<td>
<p>Object attribute name.</p>
</td></tr>
<tr><td><code id=".get_item_+3A_value">value</code></td>
<td>
<p>Object value.</p>
</td></tr>
<tr><td><code id=".get_item_+3A_operator">operator</code></td>
<td>
<p>Logical operator - two-argument function taking 'list_obj' attribute
value as the first one, and 'value' as the second one.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A subset of list object matching provided condition.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>my_list &lt;- list(
  list(id = 1, name = "a"),
  list(id = 2, name = "b")
)
.get_item(my_list, "id", 1)
.get_item(my_list, "name", c("b", "c"), identical)

</code></pre>

<hr>
<h2 id='.get_method'>Get function definition</h2><span id='topic+.get_method'></span>

<h3>Description</h3>

<p>Whenever the function with provided name exists anywhere, the one is
returned (or the first one if multiple found).
Return NULL otherwise.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.get_method(name)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id=".get_method_+3A_name">name</code></td>
<td>
<p>Name of the function.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Function - when found in any namespace or NULL otherwise.
</p>

<hr>
<h2 id='.if_value'>Return default value if values are equal</h2><span id='topic+.if_value'></span>

<h3>Description</h3>

<p>Return default value if values are equal
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.if_value(x, value, default)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id=".if_value_+3A_x">x</code></td>
<td>
<p>Condition to be compared with value.</p>
</td></tr>
<tr><td><code id=".if_value_+3A_value">value</code></td>
<td>
<p>Value to be compared with x.</p>
</td></tr>
<tr><td><code id=".if_value_+3A_default">default</code></td>
<td>
<p>Default value to be returned when 'x' is identical to 'value'.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Evaluated condition or provided default value.
</p>

<hr>
<h2 id='+25-+26gt+3B+25'>Operator simplifying adding steps or filters to Cohort and Source objects</h2><span id='topic++25-+3E+25'></span>

<h3>Description</h3>

<p>When called with filter or step object, runs add_filter and add_step respectively.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>x %-&gt;% object
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="+2B25-+2B26gt+2B3B+2B25_+3A_x">x</code></td>
<td>
<p>Source or Cohort object. Otherwise works as a standard pipe operator.</p>
</td></tr>
<tr><td><code id="+2B25-+2B26gt+2B3B+2B25_+3A_object">object</code></td>
<td>
<p>Filter or step to be added to 'x'.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>And object ('Source' or 'Cohort') having new filter of step added.
</p>

<hr>
<h2 id='add_filter'>Add filter definition</h2><span id='topic+add_filter'></span><span id='topic+add_filter.Cohort'></span><span id='topic+add_filter.Source'></span>

<h3>Description</h3>

<p>Add filter definition
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_filter(x, filter, step_id, ...)

## S3 method for class 'Cohort'
add_filter(x, filter, step_id, run_flow = FALSE, ...)

## S3 method for class 'Source'
add_filter(x, filter, step_id, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="add_filter_+3A_x">x</code></td>
<td>
<p>An object to add filter to.</p>
</td></tr>
<tr><td><code id="add_filter_+3A_filter">filter</code></td>
<td>
<p>Filter definition created with <a href="#topic+filter">filter</a>.</p>
</td></tr>
<tr><td><code id="add_filter_+3A_step_id">step_id</code></td>
<td>
<p>Id of the step to add the filter to.
If missing, filter is added to the last step.</p>
</td></tr>
<tr><td><code id="add_filter_+3A_...">...</code></td>
<td>
<p>Other parameters passed to specific S3 method.</p>
</td></tr>
<tr><td><code id="add_filter_+3A_run_flow">run_flow</code></td>
<td>
<p>If 'TRUE', data flow is run after the filter is added.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Method dependent object (i.e. 'Cohort' or 'Source') having filter added in selected step.
</p>


<h3>See Also</h3>

<p><a href="#topic+managing-cohort">managing-cohort</a>, <a href="#topic+managing-source">managing-source</a>
</p>

<hr>
<h2 id='add_source'>Add source to Cohort object.</h2><span id='topic+add_source'></span>

<h3>Description</h3>

<p>When Cohort object has been created without source, the method allows to
attach it.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_source(x, source)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="add_source_+3A_x">x</code></td>
<td>
<p>Cohort object.</p>
</td></tr>
<tr><td><code id="add_source_+3A_source">source</code></td>
<td>
<p>Source object to be attached.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The 'Cohort' class object with 'Source' attached to it.
</p>


<h3>See Also</h3>

<p><a href="#topic+managing-cohort">managing-cohort</a>
</p>

<hr>
<h2 id='add_step'>Add filtering step definition</h2><span id='topic+add_step'></span><span id='topic+add_step.Cohort'></span><span id='topic+add_step.Source'></span>

<h3>Description</h3>

<p>Add filtering step definition
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_step(x, step, ...)

## S3 method for class 'Cohort'
add_step(
  x,
  step,
  run_flow = FALSE,
  hook = list(pre = get_hook("pre_add_step_hook"), post = get_hook("post_add_step_hook")),
  ...
)

## S3 method for class 'Source'
add_step(x, step, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="add_step_+3A_x">x</code></td>
<td>
<p>An object to add step to.</p>
</td></tr>
<tr><td><code id="add_step_+3A_step">step</code></td>
<td>
<p>Step definition created with <a href="#topic+step">step</a>.</p>
</td></tr>
<tr><td><code id="add_step_+3A_...">...</code></td>
<td>
<p>Other parameters passed to specific S3 method.</p>
</td></tr>
<tr><td><code id="add_step_+3A_run_flow">run_flow</code></td>
<td>
<p>If 'TRUE', data flow is run after the step is added.</p>
</td></tr>
<tr><td><code id="add_step_+3A_hook">hook</code></td>
<td>
<p>List of hooks describing methods to run before/after the step is added.
See <a href="#topic+hooks">hooks</a> for more details.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Method dependent object (i.e. 'Cohort' or 'Source') having new step added.
</p>


<h3>See Also</h3>

<p><a href="#topic+managing-cohort">managing-cohort</a>, <a href="#topic+managing-source">managing-source</a>
</p>

<hr>
<h2 id='attrition'>Show attrition plot.</h2><span id='topic+attrition'></span>

<h3>Description</h3>

<p>Show attrition plot.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>attrition(x, ..., percent = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="attrition_+3A_x">x</code></td>
<td>
<p>Cohort object.</p>
</td></tr>
<tr><td><code id="attrition_+3A_...">...</code></td>
<td>
<p>Source specific parameters required to generate attrition.</p>
</td></tr>
<tr><td><code id="attrition_+3A_percent">percent</code></td>
<td>
<p>Should attrition changes be presented with percentage values.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Plot object of class 'ggplot'.
</p>


<h3>See Also</h3>

<p><a href="#topic+cohort-methods">cohort-methods</a>
</p>

<hr>
<h2 id='binding-keys'>Describe data relations with binding keys</h2><span id='topic+binding-keys'></span><span id='topic+bind_keys'></span><span id='topic+bind_key'></span>

<h3>Description</h3>

<p>When source consists of multiple datasets, binding keys allow to define what
relations occur between them.
When binding keys are defined, applying filtering on one dataset may result with
updating (filtering) the other ones.
</p>
<p>For example having two tables in Source:
'book(book_id, author_id, title)'
'authors(author_id, name, surname)'
if we filter 'authors' table, we way want to return only books for the selected authors.
</p>
<p>With binding keys you could achieve it by providing 'binding_keys' parameter for Source
as below:
</p>
<pre>
  binding_keys = bind_keys(
    bind_key(
      update = data_key('books', 'author_id'),
      data_key('authors', 'author_id')
    )
  )
</pre>
<p>Or if we want to have two-way relation, just define another binding key:
</p>
<pre>
  binding_keys = bind_keys(
    bind_key(
      update = data_key('books', 'author_id'),
      data_key('authors', 'author_id')
    ),
    bind_key(
      update = data_key('authors', 'author_id'),
      data_key('books', 'author_id')
    )
  )
</pre>
<p>As a result, whenever 'books' or 'authors' is filtered, the other table will be updated as well.
</p>
<p>In order to understand binding keys concept we need to describe the following functions:
</p>

<ul>
<li><p><a href="#topic+data_key">data_key</a> Defines which table column should be used to describe relation.
</p>
</li>
<li><p>bind_key Defines what relation occur between datasets.
</p>
</li>
<li><p>bind_keys If needed, allows to define more than one relation.
</p>
</li></ul>

<p>- 'data_key' - requires to provide two parameters:
</p>

<ul>
<li><p>dataset Name of the dataset existing in Source.
</p>
</li>
<li><p>key Single character string or vector storing column names that are keys, which should be used to describe relation.
</p>
</li></ul>

<p>For example &lsquo;data_key(&rsquo;books', 'author_id')'.
</p>
<p>- 'bind_key' - requires to provide two obligatory parameters
</p>

<ul>
<li><p>update Data key describing which table should be updated.
</p>
</li>
<li><p>... <strong>Triggering data keys</strong>. One or more data keys describing on which dataset(s) the one in 'update' is dependent.
</p>
</li></ul>

<p>The output of 'bind_key' function is named <strong>binding key</strong>.
'bind_key' offers two extra parameters 'post' and 'activate'.
See below to learn how these parameters affect the final result.
</p>
<p>- 'bind_keys' - takes only binding keys as parameters
The function is used to define 'binding_keys' parameter of Source.
Whenever you define a single or more binding keys wrap them with 'bind_keys'.
</p>
<p>It's worth to mention that binding key describes inner-join like relation.
That means the updated table's key is intersection of its key and keys of
remaining tables defined in binding key.
</p>
<p>Another important note is that binding keys order matters - binding is performed
sequentially, taking into account returned data from the previous bindings.
</p>
<p>You may achieve more flexibility with two parameters:
</p>

<ul>
<li><p>activate
</p>
</li>
<li><p>post
</p>
</li></ul>

<p><strong>Active tables and 'activate' parameter</strong>
</p>
<p>We name a table 'active' that is attached to at least one active filter (in a step).
</p>
<p>When having defined binding key, e.g.
</p>
<pre>
  bind_key(
    update = data_key('books', 'author_id'),
    data_key('authors', 'author_id')
  )
</pre>
<p>the key is taken into account only when at least one triggering table is active.
So in the above example binding key will update 'books' only when 'authors' was
filtered (more precisely when any filter attached to 'authors' is active).
</p>
<p>The 'activate = TRUE' parameter setup, lets us to decide whether 'update' table
should be marked as active as well when the binding finish.
This allows to build dependency chains between table.
</p>
<p>Let's explain this in the below example. Having defined another table in Source
'borrowed(book_id, user_id, date)' and binding key:
</p>
<pre>
  bind_keys(
    bind_key(
      update = data_key('books', 'book_id'),
      data_key('borrowed', 'book_id')
    ),
    bind_key(
      update = data_key('authors', 'author_id'),
      data_key('books', 'author_id')
    )
  )
</pre>
<p>Let's consider the case when table 'borrowed' is active, 'books' is not.
What happens during the binding process:
1. Based on the first binding key, active 'borrowed' triggers this one.
2. As a result 'books' is modified.
</p>
<p>What should happen with the second binding key.
We have two options:
1. 'books' could be marked as active as well so it triggers the second key.
2. 'books' could remain inactive so the second key is not triggered.
It will be triggered only when 'books' is directly filtered (activated).
</p>
<p>You may choose between 1 and 2 with 'activate = TRUE' (the default)  and 'activate = FALSE'
respectively.
</p>
<p>So in the above example (because 'activate = TRUE' by default) the authors table
will also be modified by the second binding key.
</p>
<p>To turn off this behavior we just need to:
</p>
<pre>
  bind_keys(
    bind_key(
      update = data_key('books', 'book_id'),
      data_key('borrowed', 'book_id'),
      activate = TRUE
    ),
    bind_key(
      update = data_key('authors', 'author_id'),
      data_key('books', 'author_id')
    )
  )
</pre>
<p><strong>Bind filtered on unfiltered data - 'post' parameter</strong>
</p>
<p>Let's tart with the below binding key example:
</p>
<pre>
  bind_keys(
    bind_key(
      update = data_key('authors', 'author_id'),
      data_key('books', 'author_id')
    )
  )
</pre>
<p>Let's assume 'authors' table is filtered and we apply filtering for 'books' table.
We may want to achieve one of the two results:
1. 'authors' filters should be taken into account while binding.
2. we should take unfiltered 'authors' an apply binding based on 'books' choices.
</p>
<p>We can achieve 1 and 2 with defining 'post = TRUE' (the default) and 'post = FALSE' respectively.
</p>
<p>So the following setup:
</p>
<pre>
  bind_keys(
    bind_key(
      update = data_key('authors', 'author_id'),
      data_key('books', 'author_id'),
      post = FALSE
    )
  )
</pre>
<p>Whenever 'books' is changed will result with filtering only the authors that written selected books -
no extra 'authors' filters will be applied.
</p>
<p>There might be the situation when table was already bound but there is another
one binding key to be executed on the same table.
</p>
<p>In this case 'post = FALSE' case will remain the same - unfiltered table will be taken.
More to that filtering and previous binding related to this table will be ignored.
In case of 'post = TRUE' the previously bound table will be updated.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bind_keys(...)

bind_key(update, ..., post = TRUE, activate = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="binding-keys_+3A_...">...</code></td>
<td>
<p>In case of 'bind_keys', binding keys created with 'bind_key'.
In case of 'bind_key', data keys describing triggering tables.</p>
</td></tr>
<tr><td><code id="binding-keys_+3A_update">update</code></td>
<td>
<p>Data key describing table to update.</p>
</td></tr>
<tr><td><code id="binding-keys_+3A_post">post</code></td>
<td>
<p>Update filtered or unfiltered table.</p>
</td></tr>
<tr><td><code id="binding-keys_+3A_activate">activate</code></td>
<td>
<p>Mark bound table as active.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of class 'bind_keys' storing 'bind_key' class objects ('bind_keys') or
'bind_key' class list ('bind_key').
</p>

<hr>
<h2 id='code'>Return reproducible data filtering code.</h2><span id='topic+code'></span>

<h3>Description</h3>

<p>Return reproducible data filtering code.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>code(
  x,
  include_source = TRUE,
  include_methods = c(".pre_filtering", ".post_filtering", ".run_binding"),
  include_action = c("pre_filtering", "post_filtering", "run_binding"),
  modifier = .repro_code_tweak,
  mark_step = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="code_+3A_x">x</code></td>
<td>
<p>Cohort object.</p>
</td></tr>
<tr><td><code id="code_+3A_include_source">include_source</code></td>
<td>
<p>If 'TRUE' source generating code will be included.</p>
</td></tr>
<tr><td><code id="code_+3A_include_methods">include_methods</code></td>
<td>
<p>Which methods definition should be included in the result.</p>
</td></tr>
<tr><td><code id="code_+3A_include_action">include_action</code></td>
<td>
<p>Which action should be returned in the result.
'pre_filtering'/'.post_filtering' - to include data transformation before/after filtering.
s'run_binding' - data binding transformation.</p>
</td></tr>
<tr><td><code id="code_+3A_modifier">modifier</code></td>
<td>
<p>A function taking data frame (storing reproducible code metadata) as
an argument, and returning data frame with 'expr' column which is then
combined into a single expression (final result of 'get_code').
See <a href="#topic+.repro_code_tweak">.repro_code_tweak</a>.</p>
</td></tr>
<tr><td><code id="code_+3A_mark_step">mark_step</code></td>
<td>
<p>Include information which filtering step is performed.</p>
</td></tr>
<tr><td><code id="code_+3A_...">...</code></td>
<td>
<p>Other parameters passed to <a href="formatR.html#topic+tidy_source">tidy_source</a>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><a href="formatR.html#topic+tidy_source">tidy_source</a> output storing reproducible code for generating final step data.
</p>


<h3>See Also</h3>

<p><a href="#topic+cohort-methods">cohort-methods</a>
</p>

<hr>
<h2 id='Cohort'>R6 class representing Cohort object.</h2><span id='topic+Cohort'></span>

<h3>Description</h3>

<p>R6 class representing Cohort object.
</p>
<p>R6 class representing Cohort object.
</p>


<h3>Details</h3>

<p>Cohort object is designed to make operations on source data possible.
</p>


<h3>Public fields</h3>

<div class="r6-fields">

<dl>
<dt><code>attributes</code></dt><dd><p>List of Cohort attributes defined while creating a new Cohort object.</p>
</dd>
</dl>

</div>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-Cohort-new"><code>Cohort$new()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-add_source"><code>Cohort$add_source()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-update_source"><code>Cohort$update_source()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-get_source"><code>Cohort$get_source()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-add_step"><code>Cohort$add_step()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-copy_step"><code>Cohort$copy_step()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-remove_step"><code>Cohort$remove_step()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-add_filter"><code>Cohort$add_filter()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-remove_filter"><code>Cohort$remove_filter()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-update_filter"><code>Cohort$update_filter()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-clear_filter"><code>Cohort$clear_filter()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-clear_step"><code>Cohort$clear_step()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-sum_up_state"><code>Cohort$sum_up_state()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-get_state"><code>Cohort$get_state()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-restore"><code>Cohort$restore()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-get_data"><code>Cohort$get_data()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-plot_data"><code>Cohort$plot_data()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-show_attrition"><code>Cohort$show_attrition()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-get_stats"><code>Cohort$get_stats()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-show_help"><code>Cohort$show_help()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-get_code"><code>Cohort$get_code()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-run_flow"><code>Cohort$run_flow()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-run_step"><code>Cohort$run_step()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-bind_data"><code>Cohort$bind_data()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-describe_state"><code>Cohort$describe_state()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-get_step"><code>Cohort$get_step()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-get_filter"><code>Cohort$get_filter()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-update_cache"><code>Cohort$update_cache()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-get_cache"><code>Cohort$get_cache()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-list_active_filters"><code>Cohort$list_active_filters()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-last_step_id"><code>Cohort$last_step_id()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-modify"><code>Cohort$modify()</code></a>
</p>
</li>
<li> <p><a href="#method-Cohort-clone"><code>Cohort$clone()</code></a>
</p>
</li></ul>


<hr>
<a id="method-Cohort-new"></a>



<h4>Method <code>new()</code></h4>

<p>Create Cohort object.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$new(
  source,
  ...,
  run_flow = FALSE,
  hook = list(pre = get_hook("pre_cohort_hook"), post = get_hook("post_cohort_hook"))
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>source</code></dt><dd><p>Source object created with <a href="#topic+set_source">set_source</a>.</p>
</dd>
<dt><code>...</code></dt><dd><p>Steps definition (optional). Can be also defined as a sequence of
filters - the filters will be added to the first step.</p>
</dd>
<dt><code>run_flow</code></dt><dd><p>If 'TRUE', data flow is run after the operation is completed.</p>
</dd>
<dt><code>hook</code></dt><dd><p>List of hooks describing methods before/after the Cohort is created.
See <a href="#topic+hooks">hooks</a> for more details.</p>
</dd>
</dl>

</div>



<h5>Returns</h5>

<p>The object of class 'Cohort'.
</p>


<hr>
<a id="method-Cohort-add_source"></a>



<h4>Method <code>add_source()</code></h4>

<p>Add Source to Cohort object.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$add_source(source)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>source</code></dt><dd><p>Source object created with <a href="#topic+set_source">set_source</a>.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-update_source"></a>



<h4>Method <code>update_source()</code></h4>

<p>Update Source in the Cohort object.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$update_source(
  source,
  keep_steps = !has_steps(source),
  run_flow = FALSE,
  hook = list(pre = get_hook("pre_update_source_hook"), post =
    get_hook("post_update_source_hook"))
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>source</code></dt><dd><p>Source object created with <a href="#topic+set_source">set_source</a>.</p>
</dd>
<dt><code>keep_steps</code></dt><dd><p>If 'TRUE', steps definition remains unchanged when updating source.
If 'FALSE' steps configuration is deleted.
If vector of type integer, specified steps will remain.</p>
</dd>
<dt><code>run_flow</code></dt><dd><p>If 'TRUE', data flow is run after the operation is completed.</p>
</dd>
<dt><code>hook</code></dt><dd><p>List of hooks describing methods before/after the Cohort is created.
See <a href="#topic+hooks">hooks</a> for more details.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-get_source"></a>



<h4>Method <code>get_source()</code></h4>

<p>Return Source object attached to Cohort.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$get_source()</pre></div>


<hr>
<a id="method-Cohort-add_step"></a>



<h4>Method <code>add_step()</code></h4>

<p>Add filtering step definition
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$add_step(
  step,
  run_flow = FALSE,
  hook = list(pre = get_hook("pre_add_step_hook"), post = get_hook("post_add_step_hook"))
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>step</code></dt><dd><p>Step definition created with <a href="#topic+step">step</a>.</p>
</dd>
<dt><code>run_flow</code></dt><dd><p>If 'TRUE', data flow is run after the operation is completed.</p>
</dd>
<dt><code>hook</code></dt><dd><p>List of hooks describing methods before/after the Cohort is created.
See <a href="#topic+hooks">hooks</a> for more details.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-copy_step"></a>



<h4>Method <code>copy_step()</code></h4>

<p>Copy selected step.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$copy_step(step_id, filters, run_flow = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>step_id</code></dt><dd><p>Id of the step to be copied. If missing the last step is taken.
The copied step is added as the last one in the Cohort.</p>
</dd>
<dt><code>filters</code></dt><dd><p>List of Source-evaluated filters to copy to new step.</p>
</dd>
<dt><code>run_flow</code></dt><dd><p>If 'TRUE', data flow is run after the operation is completed.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-remove_step"></a>



<h4>Method <code>remove_step()</code></h4>

<p>Remove filtering step definition
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$remove_step(
  step_id,
  run_flow = FALSE,
  hook = list(pre = get_hook("pre_rm_step_hook"), post = get_hook("post_rm_step_hook"))
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>step_id</code></dt><dd><p>Id of the step to remove.</p>
</dd>
<dt><code>run_flow</code></dt><dd><p>If 'TRUE', data flow is run after the operation is completed.</p>
</dd>
<dt><code>hook</code></dt><dd><p>List of hooks describing methods before/after the Cohort is created.
See <a href="#topic+hooks">hooks</a> for more details.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-add_filter"></a>



<h4>Method <code>add_filter()</code></h4>

<p>Add filter definition
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$add_filter(filter, step_id, run_flow = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>filter</code></dt><dd><p>Filter definition created with <a href="#topic+filter">filter</a>.</p>
</dd>
<dt><code>step_id</code></dt><dd><p>Id of the step to add the filter to.
If missing, filter is added to the last step.</p>
</dd>
<dt><code>run_flow</code></dt><dd><p>If 'TRUE', data flow is run after the operation is completed.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-remove_filter"></a>



<h4>Method <code>remove_filter()</code></h4>

<p>Remove filter definition
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$remove_filter(step_id, filter_id, run_flow = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>step_id</code></dt><dd><p>Id of the step from which filter should be removed.</p>
</dd>
<dt><code>filter_id</code></dt><dd><p>Id of the filter to be removed.</p>
</dd>
<dt><code>run_flow</code></dt><dd><p>If 'TRUE', data flow is run after the operation is completed.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-update_filter"></a>



<h4>Method <code>update_filter()</code></h4>

<p>Update filter definition
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$update_filter(step_id, filter_id, ..., active, run_flow = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>step_id</code></dt><dd><p>Id of the step where filter is defined.</p>
</dd>
<dt><code>filter_id</code></dt><dd><p>Id of the filter to be updated.</p>
</dd>
<dt><code>...</code></dt><dd><p>Filter parameters that should be updated.</p>
</dd>
<dt><code>active</code></dt><dd><p>Mark filter as active ('TRUE') or inactive ('FALSE').</p>
</dd>
<dt><code>run_flow</code></dt><dd><p>If 'TRUE', data flow is run after the operation is completed.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-clear_filter"></a>



<h4>Method <code>clear_filter()</code></h4>

<p>Reset filter to its default values.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$clear_filter(step_id, filter_id, run_flow = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>step_id</code></dt><dd><p>Id of the step where filter is defined.</p>
</dd>
<dt><code>filter_id</code></dt><dd><p>Id of the filter which should be cleared.</p>
</dd>
<dt><code>run_flow</code></dt><dd><p>If 'TRUE', data flow is run after the operation is completed.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-clear_step"></a>



<h4>Method <code>clear_step()</code></h4>

<p>Reset all filters included in selected step.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$clear_step(step_id, run_flow = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>step_id</code></dt><dd><p>Id of the step where filters should be cleared.</p>
</dd>
<dt><code>run_flow</code></dt><dd><p>If 'TRUE', data flow is run after the operation is completed.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-sum_up_state"></a>



<h4>Method <code>sum_up_state()</code></h4>

<p>Sum up Cohort configuration - Source, steps definition and evaluated data.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$sum_up_state()</pre></div>


<hr>
<a id="method-Cohort-get_state"></a>



<h4>Method <code>get_state()</code></h4>

<p>Get Cohort configuration state.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$get_state(step_id, json = FALSE, extra_fields = NULL)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>step_id</code></dt><dd><p>If provided, the selected step state is returned.</p>
</dd>
<dt><code>json</code></dt><dd><p>If TRUE, return state in JSON format.</p>
</dd>
<dt><code>extra_fields</code></dt><dd><p>Names of extra fields included in filter to be added to state.
Restore Cohort configuration.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-restore"></a>



<h4>Method <code>restore()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>Cohort$restore(
  state,
  modifier = function(prev_state, state) {
     state
 },
  run_flow = FALSE,
  hook = list(pre = get_hook("pre_restore_hook"), post = get_hook("post_restore_hook"))
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>state</code></dt><dd><p>List or JSON string containing steps and filters configuration.</p>
</dd>
<dt><code>modifier</code></dt><dd><p>Function two parameters combining the previous and provided state.
The returned state is then restored.</p>
</dd>
<dt><code>run_flow</code></dt><dd><p>If 'TRUE', data flow is run after the operation is completed.</p>
</dd>
<dt><code>hook</code></dt><dd><p>List of hooks describing methods before/after the Cohort is created.
See <a href="#topic+hooks">hooks</a> for more details.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-get_data"></a>



<h4>Method <code>get_data()</code></h4>

<p>Get step related data
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$get_data(step_id, state = "post", collect = TRUE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>step_id</code></dt><dd><p>Id of the step from which to source data.</p>
</dd>
<dt><code>state</code></dt><dd><p>Return data before (&quot;pre&quot;) or after (&quot;post&quot;) step filtering?</p>
</dd>
<dt><code>collect</code></dt><dd><p>Return raw data source ('FALSE') object or collected (to R memory) data ('TRUE').</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-plot_data"></a>



<h4>Method <code>plot_data()</code></h4>

<p>Plot filter specific data summary.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$plot_data(step_id, filter_id, ..., state = "post")</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>step_id</code></dt><dd><p>Id of the step where filter is defined.</p>
</dd>
<dt><code>filter_id</code></dt><dd><p>Id of the filter for which the plot should be returned</p>
</dd>
<dt><code>...</code></dt><dd><p>Another parameters passed to filter specific method.</p>
</dd>
<dt><code>state</code></dt><dd><p>Generate plot on data before (&quot;pre&quot;) or after (&quot;post&quot;) step filtering?</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-show_attrition"></a>



<h4>Method <code>show_attrition()</code></h4>

<p>Show attrition plot.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$show_attrition(..., percent = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>...</code></dt><dd><p>Source specific parameters required to generate attrition.</p>
</dd>
<dt><code>percent</code></dt><dd><p>Should attrition changes be presented with percentage values.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-get_stats"></a>



<h4>Method <code>get_stats()</code></h4>

<p>Get Cohort related statistics.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$get_stats(step_id, filter_id, ..., state = "post")</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>step_id</code></dt><dd><p>When 'filter_id' specified, 'step_id' precises from which step the filter comes from.
Otherwise data from specified step is used to calculate required statistics.</p>
</dd>
<dt><code>filter_id</code></dt><dd><p>If not missing, filter related data statistics are returned.</p>
</dd>
<dt><code>...</code></dt><dd><p>Specific parameters passed to filter related method.</p>
</dd>
<dt><code>state</code></dt><dd><p>Should the stats be calculated on data before (&quot;pre&quot;) or after (&quot;post&quot;)
filtering in specified step.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-show_help"></a>



<h4>Method <code>show_help()</code></h4>

<p>Show source data or filter description
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$show_help(
  field,
  step_id,
  filter_id,
  modifier = getOption("cb_help_modifier", default = function(x) x)
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>field</code></dt><dd><p>Name of the source description field provided as 'description' argument to <a href="#topic+set_source">set_source</a>.
If missing, 'step_id' and 'filter_id' are used to return filter description.</p>
</dd>
<dt><code>step_id</code></dt><dd><p>Id of the filter step to return description of.</p>
</dd>
<dt><code>filter_id</code></dt><dd><p>Id of the filter to return description of.</p>
</dd>
<dt><code>modifier</code></dt><dd><p>A function taking the description as argument.
The function can be used to modify its argument (convert to html, display in browser etc.).</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-get_code"></a>



<h4>Method <code>get_code()</code></h4>

<p>Return reproducible data filtering code.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$get_code(
  include_source = TRUE,
  include_methods = c(".pre_filtering", ".post_filtering", ".run_binding"),
  include_action = c("pre_filtering", "post_filtering", "run_binding"),
  modifier = .repro_code_tweak,
  mark_step = TRUE,
  ...
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>include_source</code></dt><dd><p>If 'TRUE' source generating code will be included.</p>
</dd>
<dt><code>include_methods</code></dt><dd><p>Which methods definition should be included in the result.</p>
</dd>
<dt><code>include_action</code></dt><dd><p>Which action should be returned in the result.
'pre_filtering'/'.post_filtering' - to include data transformation before/after filtering.
s'run_binding' - data binding transformation.</p>
</dd>
<dt><code>modifier</code></dt><dd><p>A function taking data frame (storing reproducible code metadata) as
an argument, and returning data frame with 'expr' column which is then
combined into a single expression (final result of 'get_code').
See <a href="#topic+.repro_code_tweak">.repro_code_tweak</a>.</p>
</dd>
<dt><code>mark_step</code></dt><dd><p>Include information which filtering step is performed.</p>
</dd>
<dt><code>...</code></dt><dd><p>Other parameters passed to <a href="formatR.html#topic+tidy_source">tidy_source</a>.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-run_flow"></a>



<h4>Method <code>run_flow()</code></h4>

<p>Trigger data calculations sequentially.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$run_flow(
  min_step,
  hook = list(pre = get_hook("pre_run_flow_hook"), post = get_hook("post_run_flow_hook"))
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>min_step</code></dt><dd><p>Step id starting from the calculation will be started.</p>
</dd>
<dt><code>hook</code></dt><dd><p>List of hooks describing methods before/after the Cohort is created.
See <a href="#topic+hooks">hooks</a> for more details.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-run_step"></a>



<h4>Method <code>run_step()</code></h4>

<p>Trigger data calculations for selected step.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$run_step(
  step_id,
  hook = list(pre = get_hook("pre_run_step_hook"), post = get_hook("post_run_step_hook"))
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>step_id</code></dt><dd><p>Id of the step for which to run data calculation.</p>
</dd>
<dt><code>hook</code></dt><dd><p>List of hooks describing methods before/after the Cohort is created.
See <a href="#topic+hooks">hooks</a> for more details.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-bind_data"></a>



<h4>Method <code>bind_data()</code></h4>

<p>Run data binding for selected step.
See more at <a href="#topic+binding-keys">binding-keys</a>.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$bind_data(step_id)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>step_id</code></dt><dd><p>Id of the step for which to bind the data.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-describe_state"></a>



<h4>Method <code>describe_state()</code></h4>

<p>Print defined steps configuration.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$describe_state()</pre></div>


<hr>
<a id="method-Cohort-get_step"></a>



<h4>Method <code>get_step()</code></h4>

<p>Get selected step configuration.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$get_step(step_id)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>step_id</code></dt><dd><p>Id of the step to be returned.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-get_filter"></a>



<h4>Method <code>get_filter()</code></h4>

<p>Get selected filter configuration.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$get_filter(step_id, filter_id, method = function(x) x)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>step_id</code></dt><dd><p>Id of the step where filter is defined.</p>
</dd>
<dt><code>filter_id</code></dt><dd><p>If of the filter to be returned.</p>
</dd>
<dt><code>method</code></dt><dd><p>Custom function taking filters list as argument.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-update_cache"></a>



<h4>Method <code>update_cache()</code></h4>

<p>Update filter or step cache.
Caching is saving step and filter attached data statistics such as number of
data rows, filter choices or frequencies.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$update_cache(step_id, filter_id, state = "post")</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>step_id</code></dt><dd><p>Id of the step for which caching should be applied.
If 'filter_id' is not missing, the parameter describes id of the step where filter should be found.</p>
</dd>
<dt><code>filter_id</code></dt><dd><p>Id of the filter for which caching should be applied.</p>
</dd>
<dt><code>state</code></dt><dd><p>Should caching be done on data before (&quot;pre&quot;) or after (&quot;post&quot;)
filtering in specified step.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-get_cache"></a>



<h4>Method <code>get_cache()</code></h4>

<p>Return step of filter specific cache.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$get_cache(step_id, filter_id, state = "post")</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>step_id</code></dt><dd><p>Id of the step for which cached data should be returned
If 'filter_id' is not missing, the parameter describes id of the step where filter should be found.</p>
</dd>
<dt><code>filter_id</code></dt><dd><p>Id of the filter for which cache data should be returned.</p>
</dd>
<dt><code>state</code></dt><dd><p>Should cache be returned on data before (&quot;pre&quot;) or after (&quot;post&quot;)
filtering in specified step.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-list_active_filters"></a>



<h4>Method <code>list_active_filters()</code></h4>

<p>List active filters included in selected step.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$list_active_filters(step_id)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>step_id</code></dt><dd><p>Id of the step where filters should be found.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-last_step_id"></a>



<h4>Method <code>last_step_id()</code></h4>

<p>Return id of the last existing step in Cohort.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$last_step_id()</pre></div>


<hr>
<a id="method-Cohort-modify"></a>



<h4>Method <code>modify()</code></h4>

<p>Helper method enabling to run non-standard operation on Cohort object.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$modify(modifier)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>modifier</code></dt><dd><p>Function of two arguments 'self' and 'private'.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Cohort-clone"></a>



<h4>Method <code>clone()</code></h4>

<p>The objects of this class are cloneable with this method.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cohort$clone(deep = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>deep</code></dt><dd><p>Whether to make a deep clone.</p>
</dd>
</dl>

</div>



<hr>
<h2 id='cohort-methods'>Cohort related methods</h2><span id='topic+cohort-methods'></span>

<h3>Description</h3>

<p>The list of methods designed for getting Cohort-related details.
</p>

<ul>
<li><p><a href="#topic+plot_data">plot_data</a> Plot filter related Cohort data.
</p>
</li>
<li><p><a href="#topic+stat">stat</a> Get Cohort related statistics.
</p>
</li>
<li><p><a href="#topic+code">code</a> Return reproducible data filtering code.
</p>
</li>
<li><p><a href="#topic+get_data">get_data</a> Get step related data.
</p>
</li>
<li><p><a href="#topic+sum_up">sum_up</a> Sum up Cohort state.
</p>
</li>
<li><p><a href="#topic+get_state">get_state</a> Save Cohort state.
</p>
</li>
<li><p><a href="#topic+restore">restore</a> Restore Cohort state.
</p>
</li>
<li><p><a href="#topic+attrition">attrition</a> Show attrition plot.
</p>
</li>
<li><p><a href="#topic+description">description</a> Show Source or filter related description.
</p>
</li></ul>



<h3>Value</h3>

<p>Various type outputs dependent on the selected method.
See each method documentation for details.
</p>

<hr>
<h2 id='cohortBuilder-package'>Create data source cohort</h2><span id='topic+cohortBuilder-package'></span>

<h3>Description</h3>

<p>Create data source cohort
</p>

<hr>
<h2 id='create-cohort'>Create new 'Cohort' object</h2><span id='topic+create-cohort'></span><span id='topic+cohort'></span>

<h3>Description</h3>

<p>Cohort object is designed to make operations on source data possible.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cohort(
  source,
  ...,
  run_flow = FALSE,
  hook = list(pre = get_hook("pre_cohort_hook"), post = get_hook("post_cohort_hook"))
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create-cohort_+3A_source">source</code></td>
<td>
<p>Source object created with <a href="#topic+set_source">set_source</a>.</p>
</td></tr>
<tr><td><code id="create-cohort_+3A_...">...</code></td>
<td>
<p>Steps definition (optional). Can be also defined as a sequence of
filters - the filters will be added to the first step.</p>
</td></tr>
<tr><td><code id="create-cohort_+3A_run_flow">run_flow</code></td>
<td>
<p>If 'TRUE', data flow is run after the operation is completed.</p>
</td></tr>
<tr><td><code id="create-cohort_+3A_hook">hook</code></td>
<td>
<p>List of hooks describing methods before/after the Cohort is created.
See <a href="#topic+hooks">hooks</a> for more details.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The object of class 'Cohort'.
</p>

<hr>
<h2 id='creating-filters'>Define custom filter.</h2><span id='topic+creating-filters'></span><span id='topic+def_filter'></span><span id='topic+new_filter'></span>

<h3>Description</h3>

<p>Methods available for creating new filters easier.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>def_filter(
  type,
  id = .gen_id(),
  name = id,
  input_param = NULL,
  filter_data,
  get_stats,
  plot_data,
  get_params,
  get_data,
  get_defaults
)

new_filter(
  filter_type,
  source_type,
  input_param = "value",
  extra_params = "",
  file
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="creating-filters_+3A_type">type</code></td>
<td>
<p>Filter type.</p>
</td></tr>
<tr><td><code id="creating-filters_+3A_id">id</code></td>
<td>
<p>Filter id.</p>
</td></tr>
<tr><td><code id="creating-filters_+3A_name">name</code></td>
<td>
<p>Filter name.</p>
</td></tr>
<tr><td><code id="creating-filters_+3A_input_param">input_param</code></td>
<td>
<p>Name of the parameter taking filtering value.</p>
</td></tr>
<tr><td><code id="creating-filters_+3A_filter_data">filter_data</code></td>
<td>
<p>Function of 'data_object' parameter defining filtering logic on Source data object.</p>
</td></tr>
<tr><td><code id="creating-filters_+3A_get_stats">get_stats</code></td>
<td>
<p>Function of 'data_object' and 'name' parameters defining what and how data statistics should be calculated.</p>
</td></tr>
<tr><td><code id="creating-filters_+3A_plot_data">plot_data</code></td>
<td>
<p>Function of 'data_object' parameter defining how filter data should be plotted.</p>
</td></tr>
<tr><td><code id="creating-filters_+3A_get_params">get_params</code></td>
<td>
<p>Function of 'name' parameter returning filter parameters (if names is skipped all the parameters are returned).</p>
</td></tr>
<tr><td><code id="creating-filters_+3A_get_data">get_data</code></td>
<td>
<p>Function of 'data_object' returning filter related data.</p>
</td></tr>
<tr><td><code id="creating-filters_+3A_get_defaults">get_defaults</code></td>
<td>
<p>Function of 'data_object' and 'cache_object' parameters returning default 'input_param' parameter value.</p>
</td></tr>
<tr><td><code id="creating-filters_+3A_filter_type">filter_type</code></td>
<td>
<p>Type of new filter.</p>
</td></tr>
<tr><td><code id="creating-filters_+3A_source_type">source_type</code></td>
<td>
<p>Type of source for which filter should be defined.</p>
</td></tr>
<tr><td><code id="creating-filters_+3A_extra_params">extra_params</code></td>
<td>
<p>Vector of extra parameters name that should be available for filter.</p>
</td></tr>
<tr><td><code id="creating-filters_+3A_file">file</code></td>
<td>
<p>File path where filter should be created.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>'def_filter' designates list of parameters and methods required to define new type of filter.
</p>
<p>'new_filter' creates a new file with new filter definition template.
</p>
<p>See vignettes(&quot;custom-filters&quot;) to learn how to create a custom filter.
</p>


<h3>Value</h3>

<p>A list of filter specific values and methods ('def_filter') or no value ('new_filter').
</p>

<hr>
<h2 id='data_key'>Define Source dataset key</h2><span id='topic+data_key'></span>

<h3>Description</h3>

<p>Data keys are used to define <a href="#topic+primary_keys">primary_keys</a> and <a href="#topic+binding-keys">binding-keys</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data_key(dataset, key)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="data_key_+3A_dataset">dataset</code></td>
<td>
<p>Name of the dataset included in Source.</p>
</td></tr>
<tr><td><code id="data_key_+3A_key">key</code></td>
<td>
<p>Character or character vector storing column names to be used as table keys.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>'data_key' class list of two objects: 'dataset' and 'key' storing name and vector of
data key names respectively.
</p>

<hr>
<h2 id='description'>Show source data or filter description</h2><span id='topic+description'></span>

<h3>Description</h3>

<p>If defined allows to check the provided description related to source data or configured filters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>description(
  x,
  field,
  step_id,
  filter_id,
  modifier = getOption("cb_help_modifier", default = function(x) x)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="description_+3A_x">x</code></td>
<td>
<p>Cohort object.</p>
</td></tr>
<tr><td><code id="description_+3A_field">field</code></td>
<td>
<p>Name of the source description field provided as 'description' argument to <a href="#topic+set_source">set_source</a>.
If missing, 'step_id' and 'filter_id' are used to return filter description.</p>
</td></tr>
<tr><td><code id="description_+3A_step_id">step_id</code></td>
<td>
<p>Id of the filter step to return description of.</p>
</td></tr>
<tr><td><code id="description_+3A_filter_id">filter_id</code></td>
<td>
<p>Id of the filter to return description of.</p>
</td></tr>
<tr><td><code id="description_+3A_modifier">modifier</code></td>
<td>
<p>A function taking the description as argument.
The function can be used to modify its argument (convert to html, display in browser etc.).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Any object (or its subset) attached to Source of filter via description argument.
</p>


<h3>See Also</h3>

<p><a href="#topic+cohort-methods">cohort-methods</a>
</p>

<hr>
<h2 id='filter'>Define Cohort filter</h2><span id='topic+filter'></span><span id='topic+filter.character'></span>

<h3>Description</h3>

<p>Define Cohort filter
</p>


<h3>Usage</h3>

<pre><code class='language-R'>filter(type, ...)

## S3 method for class 'character'
filter(type, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="filter_+3A_type">type</code></td>
<td>
<p>Type of filter to use.</p>
</td></tr>
<tr><td><code id="filter_+3A_...">...</code></td>
<td>
<p>Filter type-specific parameters (see <a href="#topic+filter-types">filter-types</a>),
and filter source-specific parameters (see <a href="#topic+filter-source-types">filter-source-types</a>).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A function of class 'cb_filter_constructor'.
</p>

<hr>
<h2 id='filter-source-types'>Filter Source types methods</h2><span id='topic+filter-source-types'></span><span id='topic+cb_filter.discrete'></span><span id='topic+cb_filter.discrete_text'></span><span id='topic+cb_filter.range'></span><span id='topic+cb_filter.date_range'></span><span id='topic+cb_filter.multi_discrete'></span><span id='topic+cb_filter.discrete.tblist'></span><span id='topic+cb_filter.discrete_text.tblist'></span><span id='topic+cb_filter.range.tblist'></span><span id='topic+cb_filter.date_range.tblist'></span><span id='topic+cb_filter.multi_discrete.tblist'></span>

<h3>Description</h3>

<p>Filter Source types methods
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cb_filter.discrete(source, ...)

cb_filter.discrete_text(source, ...)

cb_filter.range(source, ...)

cb_filter.date_range(source, ...)

cb_filter.multi_discrete(source, ...)

## S3 method for class 'tblist'
cb_filter.discrete(
  source,
  type = "discrete",
  id = .gen_id(),
  name = id,
  variable,
  value = NA,
  dataset,
  keep_na = TRUE,
  ...,
  description = NULL,
  active = TRUE
)

## S3 method for class 'tblist'
cb_filter.discrete_text(
  source,
  type = "discrete_text",
  id = .gen_id(),
  name = id,
  variable,
  value = NA,
  dataset,
  ...,
  description = NULL,
  active = TRUE
)

## S3 method for class 'tblist'
cb_filter.range(
  source,
  type = "range",
  id = .gen_id(),
  name = id,
  variable,
  range = NA,
  dataset,
  keep_na = TRUE,
  ...,
  description = NULL,
  active = TRUE
)

## S3 method for class 'tblist'
cb_filter.date_range(
  source,
  type = "date_range",
  id = .gen_id(),
  name = id,
  variable,
  range = NA,
  dataset,
  keep_na = TRUE,
  ...,
  description = NULL,
  active = TRUE
)

## S3 method for class 'tblist'
cb_filter.multi_discrete(
  source,
  type = "multi_discrete",
  id = .gen_id(),
  name = id,
  values,
  variables,
  dataset,
  keep_na = TRUE,
  ...,
  description = NULL,
  active = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="filter-source-types_+3A_source">source</code></td>
<td>
<p>Source object.</p>
</td></tr>
<tr><td><code id="filter-source-types_+3A_...">...</code></td>
<td>
<p>Source type specific parameters (or extra ones if not matching specific S3 method arguments).</p>
</td></tr>
<tr><td><code id="filter-source-types_+3A_type">type</code></td>
<td>
<p>Character string defining filter type (having class of the same value as type).</p>
</td></tr>
<tr><td><code id="filter-source-types_+3A_id">id</code></td>
<td>
<p>Id of the filter.</p>
</td></tr>
<tr><td><code id="filter-source-types_+3A_name">name</code></td>
<td>
<p>Filter name.</p>
</td></tr>
<tr><td><code id="filter-source-types_+3A_variable">variable</code></td>
<td>
<p>Dataset variable used for filtering.</p>
</td></tr>
<tr><td><code id="filter-source-types_+3A_value">value</code></td>
<td>
<p>Value(s) to be used for filtering.</p>
</td></tr>
<tr><td><code id="filter-source-types_+3A_dataset">dataset</code></td>
<td>
<p>Dataset name to be used for filtering.</p>
</td></tr>
<tr><td><code id="filter-source-types_+3A_keep_na">keep_na</code></td>
<td>
<p>If 'TRUE', NA values are included.</p>
</td></tr>
<tr><td><code id="filter-source-types_+3A_description">description</code></td>
<td>
<p>Filter description (optional).</p>
</td></tr>
<tr><td><code id="filter-source-types_+3A_active">active</code></td>
<td>
<p>If FALSE filter will be skipped during Cohort filtering.</p>
</td></tr>
<tr><td><code id="filter-source-types_+3A_range">range</code></td>
<td>
<p>Variable range to be applied in filtering.</p>
</td></tr>
<tr><td><code id="filter-source-types_+3A_values">values</code></td>
<td>
<p>Named list of values to be applied in filtering.
The names should relate to the ones included in 'variables' parameter.</p>
</td></tr>
<tr><td><code id="filter-source-types_+3A_variables">variables</code></td>
<td>
<p>Vector of variable names to be used in filtering.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of filter-specific metadata and methods - result of evaluation of
'cb_filter_constructor' function on 'Source' object.
</p>

<hr>
<h2 id='filter-types'>Filter types</h2><span id='topic+filter-types'></span><span id='topic+filter.discrete'></span><span id='topic+filter.discrete_text'></span><span id='topic+filter.range'></span><span id='topic+filter.date_range'></span><span id='topic+filter.multi_discrete'></span>

<h3>Description</h3>

<p>Filter types
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'discrete'
filter(
  type,
  id,
  name,
  ...,
  active = getOption("cb_active_filter", default = TRUE)
)

## S3 method for class 'discrete_text'
filter(
  type,
  id,
  name,
  ...,
  description = NULL,
  active = getOption("cb_active_filter", default = TRUE)
)

## S3 method for class 'range'
filter(
  type,
  id,
  name,
  ...,
  description = NULL,
  active = getOption("cb_active_filter", default = TRUE)
)

## S3 method for class 'date_range'
filter(
  type,
  id,
  name,
  ...,
  description = NULL,
  active = getOption("cb_active_filter", default = TRUE)
)

## S3 method for class 'multi_discrete'
filter(
  type,
  id,
  name,
  ...,
  description = NULL,
  active = getOption("cb_active_filter", default = TRUE)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="filter-types_+3A_type">type</code></td>
<td>
<p>Character string defining filter type (having class of the same value as type).</p>
</td></tr>
<tr><td><code id="filter-types_+3A_id">id</code></td>
<td>
<p>Id of the filter.</p>
</td></tr>
<tr><td><code id="filter-types_+3A_name">name</code></td>
<td>
<p>Filter name.</p>
</td></tr>
<tr><td><code id="filter-types_+3A_...">...</code></td>
<td>
<p>Source specific parameters passed to filter (see <a href="#topic+filter-source-types">filter-source-types</a>).</p>
</td></tr>
<tr><td><code id="filter-types_+3A_active">active</code></td>
<td>
<p>If FALSE filter will be skipped during Cohort filtering.</p>
</td></tr>
<tr><td><code id="filter-types_+3A_description">description</code></td>
<td>
<p>Filter description object. Preferable a character value.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A function of class 'cb_filter_constructor'.
</p>

<hr>
<h2 id='get_data'>Get step related data</h2><span id='topic+get_data'></span>

<h3>Description</h3>

<p>Get step related data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_data(x, step_id, state = "post", collect = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_data_+3A_x">x</code></td>
<td>
<p>Cohort object.</p>
</td></tr>
<tr><td><code id="get_data_+3A_step_id">step_id</code></td>
<td>
<p>Id of the step from which to source data.</p>
</td></tr>
<tr><td><code id="get_data_+3A_state">state</code></td>
<td>
<p>Return data before (&quot;pre&quot;) or after (&quot;post&quot;) step filtering?</p>
</td></tr>
<tr><td><code id="get_data_+3A_collect">collect</code></td>
<td>
<p>Return raw data source ('FALSE') object or collected (to R memory) data ('TRUE').</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Subset of Source-specific data connection object or its evaluated version.
</p>


<h3>See Also</h3>

<p><a href="#topic+cohort-methods">cohort-methods</a>
</p>

<hr>
<h2 id='get_state'>Get Cohort configuration state.</h2><span id='topic+get_state'></span>

<h3>Description</h3>

<p>Get Cohort configuration state.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_state(x, step_id, json = FALSE, extra_fields = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_state_+3A_x">x</code></td>
<td>
<p>Cohort object.</p>
</td></tr>
<tr><td><code id="get_state_+3A_step_id">step_id</code></td>
<td>
<p>If provided, the selected step state is returned.</p>
</td></tr>
<tr><td><code id="get_state_+3A_json">json</code></td>
<td>
<p>If TRUE, return state in JSON format.</p>
</td></tr>
<tr><td><code id="get_state_+3A_extra_fields">extra_fields</code></td>
<td>
<p>Names of extra fields included in filter to be added to state.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List object of character string being the list convertion to JSON format.
</p>


<h3>See Also</h3>

<p><a href="#topic+cohort-methods">cohort-methods</a>
</p>

<hr>
<h2 id='hooks'>Cohort hooks.</h2><span id='topic+hooks'></span><span id='topic+add_hook'></span><span id='topic+get_hook'></span>

<h3>Description</h3>

<p>In order to make integration of 'cohortBuilder' package with other layers/packages easier,
hooks system was introduced.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_hook(name, method)

get_hook(name)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hooks_+3A_name">name</code></td>
<td>
<p>Name of the hook. See Details section.</p>
</td></tr>
<tr><td><code id="hooks_+3A_method">method</code></td>
<td>
<p>Function to be assigned as hook.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Many <a href="#topic+Cohort">Cohort</a> methods allow to define 'hook' parameter.
For such method, 'hook' is a list containing two values: 'pre' and 'post',
storing functions (hooks) executed before and after the method is run respectively.
</p>
<p>Each 'hook' is a function of two obligatory parameters:
</p>

<ul>
<li><p>public Cohort object.
</p>
</li>
<li><p>private Private environment of Cohort object.
</p>
</li></ul>

<p>When Cohort method, for which hook is defined, allow to pass custom parameters,
the ones should be also available in hook definition (with some exclusions, see below).
</p>
<p>For example 'Cohort$remove_step' has three parameters:
</p>

<ul>
<li><p>step_id
</p>
</li>
<li><p>run_flow
</p>
</li>
<li><p>hook
</p>
</li></ul>

<p>By the implementation, the parameters that we should skip are 'run_flow' and 'hook',
so the hook should have three parameters 'public', 'private' and 'step_id'.
</p>
<p>There are two ways of defining hooks for the specific method.
The first one is to define the method 'hook' directly as its parameter (while calling the method).
</p>
<p>The second option can be achieved with usage of 'add_hook' (and 'get_hook') function.
The default 'hook' parameter for each method is constructed as below:
</p>
<pre>
remove_step = function(step_id, run_flow = FALSE,
  hook = list(
    pre = get_hook("pre_rm_step_hook"),
    post = get_hook("post_rm_step_hook")
  )
)
</pre>
<p>'Pre' hooks are defined with 'pre_&lt;method_name&gt;_hook' and 'Post' ones as 'post_&lt;method_name&gt;_hook'.
As a result calling 'add_hook(&quot;pre_remove_step_hook&quot;, function(public, private, step_id) ...)'
will result with specifying a new pre-hook for 'remove_step' method.
</p>
<p>You may add as many hooks as you want.
The order of hooks execution is followed by the order or registering process.
If you want to check currently registered hooks for the specific method, just use:
</p>
<pre>
get_hook("pre_&lt;method_name&gt;_hook")
</pre>


<h3>Value</h3>

<p>No returned value ('add_hook') or the list of functions ('get_hook').
</p>

<hr>
<h2 id='librarian'>Sample of library database</h2><span id='topic+librarian'></span>

<h3>Description</h3>

<p>A list containing four data frames reflecting library management database.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>librarian
</code></pre>


<h3>Format</h3>

<p>A list of four data frames:
</p>
<p><strong>books</strong> - books on store
</p>

<dl>
<dt>isbn</dt><dd><p>book ISBN number</p>
</dd>
<dt>title</dt><dd><p>book title</p>
</dd>
<dt>genre</dt><dd><p>comma separated book genre</p>
</dd>
<dt>publisher</dt><dd><p>name of book publisher</p>
</dd>
<dt>author</dt><dd><p>name of book author</p>
</dd>
<dt>copies</dt><dd><p>total number of book copies on store</p>
</dd>
</dl>

<p><strong>borrowers</strong> - registered library members
</p>

<dl>
<dt>id</dt><dd><p>member unique id</p>
</dd>
<dt>registered</dt><dd><p>date the member joined library</p>
</dd>
<dt>address</dt><dd><p>member address</p>
</dd>
<dt>name</dt><dd><p>full member name</p>
</dd>
<dt>phone_number</dt><dd><p>member phone number</p>
</dd>
<dt>program</dt><dd><p>membership program type (standard, premium or vip)</p>
</dd>
</dl>

<p><strong>issues</strong> - borrowed books events
</p>

<dl>
<dt>id</dt><dd><p>unique event id</p>
</dd>
<dt>borrower_id</dt><dd><p>id of the member that borrowed the book</p>
</dd>
<dt>isbn</dt><dd><p>is of the borrowed book</p>
</dd>
<dt>date</dt><dd><p>date of borrow event</p>
</dd>
</dl>

<p><strong>returns</strong> - returned books events
</p>

<dl>
<dt>id</dt><dd><p>event id equal to borrow issue id</p>
</dd>
<dt>date</dt><dd><p>date of return event</p>
</dd>
</dl>


<hr>
<h2 id='managing-cohort'>Managing the Cohort object</h2><span id='topic+managing-cohort'></span>

<h3>Description</h3>

<p>The list of methods designed for managing the Cohort configuration and state.
</p>

<ul>
<li><p><a href="#topic+add_source">add_source</a> Add source to Cohort object.
</p>
</li>
<li><p><a href="#topic+update_source">update_source</a> Update Cohort object source.
</p>
</li>
<li><p><a href="#topic+add_step">add_step</a> Add step to Cohort object.
</p>
</li>
<li><p><a href="#topic+rm_step">rm_step</a> Remove step from Cohort object.
</p>
</li>
<li><p><a href="#topic+add_filter">add_filter</a> Add filter to Cohort step.
</p>
</li>
<li><p><a href="#topic+rm_filter">rm_filter</a> Remove filter from Cohort step.
</p>
</li>
<li><p><a href="#topic+update_filter">update_filter</a> Update filter configuration.
</p>
</li>
<li><p><a href="#topic+run">run</a> Run data filtering.
</p>
</li></ul>



<h3>Value</h3>

<p>The object of class 'Cohort' having the modified configuration dependent on the used method.
</p>

<hr>
<h2 id='managing-source'>Managing the Source object</h2><span id='topic+managing-source'></span>

<h3>Description</h3>

<p>The list of methods designed for managing the Source configuration and state.
</p>

<ul>
<li><p><a href="#topic+add_step">add_step</a> Add step to Source object.
</p>
</li>
<li><p><a href="#topic+rm_step">rm_step</a> Remove step from Source object.
</p>
</li>
<li><p><a href="#topic+add_filter">add_filter</a> Add filter to Source step.
</p>
</li>
<li><p><a href="#topic+rm_filter">rm_filter</a> Remove filter from Source step.
</p>
</li>
<li><p><a href="#topic+update_filter">update_filter</a> Update filter configuration.
</p>
</li></ul>



<h3>Value</h3>

<p>The object of class 'Source' having the modified configuration dependent on the used method.
</p>


<h3>See Also</h3>

<p>managing-cohort
</p>

<hr>
<h2 id='plot_data'>Plot filter related Cohort data.</h2><span id='topic+plot_data'></span>

<h3>Description</h3>

<p>For specified filter the method calls filter-related plot method to present data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_data(x, step_id, filter_id, ..., state = "post")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_data_+3A_x">x</code></td>
<td>
<p>Cohort object.</p>
</td></tr>
<tr><td><code id="plot_data_+3A_step_id">step_id</code></td>
<td>
<p>Id of step in which the filter was defined..</p>
</td></tr>
<tr><td><code id="plot_data_+3A_filter_id">filter_id</code></td>
<td>
<p>Filter id.</p>
</td></tr>
<tr><td><code id="plot_data_+3A_...">...</code></td>
<td>
<p>Another parameters passed to filter plotting method.</p>
</td></tr>
<tr><td><code id="plot_data_+3A_state">state</code></td>
<td>
<p>Generate plot based on data before (&quot;pre&quot;) or after (&quot;post&quot;) filtering.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Filter-specific plot.
</p>


<h3>See Also</h3>

<p><a href="#topic+cohort-methods">cohort-methods</a>
</p>

<hr>
<h2 id='primary_keys'>Define Source datasets primary keys</h2><span id='topic+primary_keys'></span>

<h3>Description</h3>

<p>Primary keys can be defined as 'primary_keys' parameter of <a href="#topic+set_source">set_source</a> method.
Currently, primary keys are used only to show keys information in attrition plot (See <a href="#topic+attrition">attrition</a>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>primary_keys(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="primary_keys_+3A_...">...</code></td>
<td>
<p>Data keys describing tables primary keys.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of class 'primary_keys' storing <a href="#topic+data_key">data_key</a>s objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>primary_keys(
  data_key('books', 'book_id'),
  data_key('borrowed', c('user_id', 'books_id', 'date'))
)

</code></pre>

<hr>
<h2 id='restore'>Restore Cohort object.</h2><span id='topic+restore'></span>

<h3>Description</h3>

<p>The method allows to restore Cohort object with provided configuration state.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>restore(
  x,
  state,
  modifier = function(prev_state, state) state,
  run_flow = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="restore_+3A_x">x</code></td>
<td>
<p>Cohort object.</p>
</td></tr>
<tr><td><code id="restore_+3A_state">state</code></td>
<td>
<p>List or JSON string containing steps and filters configuration.
See <a href="#topic+get_state">get_state</a>.</p>
</td></tr>
<tr><td><code id="restore_+3A_modifier">modifier</code></td>
<td>
<p>Function two parameters combining the previous and provided state.
The returned state is then restored.</p>
</td></tr>
<tr><td><code id="restore_+3A_run_flow">run_flow</code></td>
<td>
<p>If TRUE, filtering flow is applied when the operation is finished.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The 'Cohort' class object having the state restored based on provided config.
</p>


<h3>See Also</h3>

<p><a href="#topic+cohort-methods">cohort-methods</a>
</p>

<hr>
<h2 id='rm_filter'>Remove filter definition</h2><span id='topic+rm_filter'></span><span id='topic+rm_filter.Cohort'></span><span id='topic+rm_filter.Source'></span>

<h3>Description</h3>

<p>Remove filter definition
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rm_filter(x, step_id, filter_id, ...)

## S3 method for class 'Cohort'
rm_filter(x, step_id, filter_id, run_flow = FALSE, ...)

## S3 method for class 'Source'
rm_filter(x, step_id, filter_id, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rm_filter_+3A_x">x</code></td>
<td>
<p>An object from which filter should be removed.</p>
</td></tr>
<tr><td><code id="rm_filter_+3A_step_id">step_id</code></td>
<td>
<p>Id of the step from which filter should be removed.</p>
</td></tr>
<tr><td><code id="rm_filter_+3A_filter_id">filter_id</code></td>
<td>
<p>Id of the filter to be removed.</p>
</td></tr>
<tr><td><code id="rm_filter_+3A_...">...</code></td>
<td>
<p>Other parameters passed to specific S3 method.</p>
</td></tr>
<tr><td><code id="rm_filter_+3A_run_flow">run_flow</code></td>
<td>
<p>If 'TRUE', data flow is run after the filter is removed.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Method dependent object (i.e. 'Cohort' or 'Source') having selected filter removed.
</p>


<h3>See Also</h3>

<p><a href="#topic+managing-cohort">managing-cohort</a>, <a href="#topic+managing-source">managing-source</a>
</p>

<hr>
<h2 id='rm_step'>Remove filtering step definition</h2><span id='topic+rm_step'></span><span id='topic+rm_step.Cohort'></span><span id='topic+rm_step.Source'></span>

<h3>Description</h3>

<p>Remove filtering step definition
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rm_step(x, step_id, ...)

## S3 method for class 'Cohort'
rm_step(
  x,
  step_id,
  run_flow = FALSE,
  hook = list(pre = get_hook("pre_rm_step_hook"), post = get_hook("post_rm_step_hook")),
  ...
)

## S3 method for class 'Source'
rm_step(x, step_id, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rm_step_+3A_x">x</code></td>
<td>
<p>An object from which step should be removed.</p>
</td></tr>
<tr><td><code id="rm_step_+3A_step_id">step_id</code></td>
<td>
<p>Id of the step to remove.</p>
</td></tr>
<tr><td><code id="rm_step_+3A_...">...</code></td>
<td>
<p>Other parameters passed to specific S3 method.</p>
</td></tr>
<tr><td><code id="rm_step_+3A_run_flow">run_flow</code></td>
<td>
<p>If 'TRUE', data flow is run after the step is removed.</p>
</td></tr>
<tr><td><code id="rm_step_+3A_hook">hook</code></td>
<td>
<p>List of hooks describing methods before/after the Cohort is created.
See <a href="#topic+hooks">hooks</a> for more details.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Method dependent object (i.e. 'Cohort' or 'Source') having selected step removed.
</p>


<h3>See Also</h3>

<p><a href="#topic+managing-cohort">managing-cohort</a>, <a href="#topic+managing-source">managing-source</a>
</p>

<hr>
<h2 id='run'>Trigger data calculations.</h2><span id='topic+run'></span>

<h3>Description</h3>

<p>Trigger data calculations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>run(x, min_step_id, step_id)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="run_+3A_x">x</code></td>
<td>
<p>Cohort object.</p>
</td></tr>
<tr><td><code id="run_+3A_min_step_id">min_step_id</code></td>
<td>
<p>Step id starting from the calculation will be started.
Used only when 'step_id' is missing.</p>
</td></tr>
<tr><td><code id="run_+3A_step_id">step_id</code></td>
<td>
<p>Id of the step for which to run data calculation.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The object of class 'Cohort' having up-to-date data based on the Cohort state.
</p>


<h3>See Also</h3>

<p><a href="#topic+managing-cohort">managing-cohort</a>
</p>

<hr>
<h2 id='set_source'>Create Cohort source</h2><span id='topic+set_source'></span><span id='topic+set_source.tblist'></span>

<h3>Description</h3>

<p>Source is an object storing information about data source such as source type,
primary keys and relations between stored data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_source(
  dtconn,
  ...,
  primary_keys = NULL,
  binding_keys = NULL,
  source_code = NULL,
  description = NULL
)

## S3 method for class 'tblist'
set_source(
  dtconn,
  primary_keys = NULL,
  binding_keys = NULL,
  source_code = NULL,
  description = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_source_+3A_dtconn">dtconn</code></td>
<td>
<p>An object defining source data connection.</p>
</td></tr>
<tr><td><code id="set_source_+3A_...">...</code></td>
<td>
<p>Source type specific parameters. Available in 'attributes' list of resulting object.</p>
</td></tr>
<tr><td><code id="set_source_+3A_primary_keys">primary_keys</code></td>
<td>
<p>Definition of primary keys describing source data (if valid).
When provided, affects the output of attrition data plot. See <a href="#topic+primary_keys">primary_keys</a>.</p>
</td></tr>
<tr><td><code id="set_source_+3A_binding_keys">binding_keys</code></td>
<td>
<p>Definition of binding keys describing relations in source data (if valid).
When provided, affects post filtering data. See <a href="#topic+binding-keys">binding-keys</a>.</p>
</td></tr>
<tr><td><code id="set_source_+3A_source_code">source_code</code></td>
<td>
<p>Expression presenting low-level code for creating source.
When provided, used as a part of reproducible code output.</p>
</td></tr>
<tr><td><code id="set_source_+3A_description">description</code></td>
<td>
<p>A named list storing the source objects description.
Can be accessed with <a href="#topic+description">description</a> Cohort method.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>R6 object of class inherited from 'dtconn'.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>mtcars_source &lt;- set_source(
  tblist(mtcars = mtcars),
  source_code = quote({
    source &lt;- list(dtconn = list(datasets = mtcars))
  })
)
mtcars_source$attributes
</code></pre>

<hr>
<h2 id='Source'>R6 class representing a data source</h2><span id='topic+Source'></span>

<h3>Description</h3>

<p>R6 class representing a data source
</p>
<p>R6 class representing a data source
</p>


<h3>Details</h3>

<p>Source is an object storing information about data source such as source type,
primary keys and relations between stored data.
</p>


<h3>Public fields</h3>

<div class="r6-fields">

<dl>
<dt><code>dtconn</code></dt><dd><p>Data connection object the Source if based on.</p>
</dd>
<dt><code>description</code></dt><dd><p>Source object description list.</p>
</dd>
<dt><code>attributes</code></dt><dd><p>Extra source parameters passed when source is defined.</p>
</dd>
<dt><code>options</code></dt><dd><p>Extra configuration options.</p>
</dd>
<dt><code>binding_keys</code></dt><dd><p>Source data relations expressed as <a href="#topic+binding-keys">binding-keys</a>.</p>
</dd>
<dt><code>primary_keys</code></dt><dd><p>Source data primary keys expressed as <a href="#topic+primary_keys">primary_keys</a>.</p>
</dd>
<dt><code>source_code</code></dt><dd><p>An expression which allows to recreate basic source structure.</p>
</dd>
</dl>

</div>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-Source-new"><code>Source$new()</code></a>
</p>
</li>
<li> <p><a href="#method-Source-get"><code>Source$get()</code></a>
</p>
</li>
<li> <p><a href="#method-Source-get_steps"><code>Source$get_steps()</code></a>
</p>
</li>
<li> <p><a href="#method-Source-add_step"><code>Source$add_step()</code></a>
</p>
</li>
<li> <p><a href="#method-Source-rm_step"><code>Source$rm_step()</code></a>
</p>
</li>
<li> <p><a href="#method-Source-add_filter"><code>Source$add_filter()</code></a>
</p>
</li>
<li> <p><a href="#method-Source-rm_filter"><code>Source$rm_filter()</code></a>
</p>
</li>
<li> <p><a href="#method-Source-update_filter"><code>Source$update_filter()</code></a>
</p>
</li>
<li> <p><a href="#method-Source-clone"><code>Source$clone()</code></a>
</p>
</li></ul>


<hr>
<a id="method-Source-new"></a>



<h4>Method <code>new()</code></h4>

<p>Create a new 'Source' object.
</p>


<h5>Usage</h5>

<div class="r"><pre>Source$new(
  dtconn,
  ...,
  primary_keys = NULL,
  binding_keys = NULL,
  source_code = NULL,
  description = NULL,
  options = list(display_binding = TRUE)
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>dtconn</code></dt><dd><p>An object defining source data connection.</p>
</dd>
<dt><code>...</code></dt><dd><p>Extra Source parameters. Stored within 'attributes' field.</p>
</dd>
<dt><code>primary_keys</code></dt><dd><p>Definition of data 'primary_keys', if appropriate. See <a href="#topic+primary_keys">primary_keys</a>.</p>
</dd>
<dt><code>binding_keys</code></dt><dd><p>Definition of relations between data, if appropriate. See <a href="#topic+binding-keys">binding-keys</a>.</p>
</dd>
<dt><code>source_code</code></dt><dd><p>A quote object that allows to recreate basic source structure.
Used as a part of reproducible code output, see <a href="#topic+code">code</a>.</p>
</dd>
<dt><code>description</code></dt><dd><p>A named list storing the source objects description.
Can be accessed with <a href="#topic+description">description</a> Cohort method.</p>
</dd>
<dt><code>options</code></dt><dd><p>List of options affecting methods output. Currently supported only 'display_binding'
specifying whether reproducible code should include bindings definition.</p>
</dd>
</dl>

</div>



<h5>Returns</h5>

<p>A new 'Source' object of class 'Source' (and 'dtconn' object class appended).
</p>


<hr>
<a id="method-Source-get"></a>



<h4>Method <code>get()</code></h4>

<p>Get selected 'Source' object 'attribute'.
</p>


<h5>Usage</h5>

<div class="r"><pre>Source$get(param)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>param</code></dt><dd><p>Name of the attribute.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Source-get_steps"></a>



<h4>Method <code>get_steps()</code></h4>

<p>Returns filtering steps definition, if defined for 'Source'.
</p>


<h5>Usage</h5>

<div class="r"><pre>Source$get_steps()</pre></div>


<hr>
<a id="method-Source-add_step"></a>



<h4>Method <code>add_step()</code></h4>

<p>Add filtering step definition.
</p>


<h5>Usage</h5>

<div class="r"><pre>Source$add_step(step)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>step</code></dt><dd><p>Step definition created with <a href="#topic+step">step</a>.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Source-rm_step"></a>



<h4>Method <code>rm_step()</code></h4>

<p>Remove filtering step definition.
</p>


<h5>Usage</h5>

<div class="r"><pre>Source$rm_step(step_id)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>step_id</code></dt><dd><p>Id of the step to be removed.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Source-add_filter"></a>



<h4>Method <code>add_filter()</code></h4>

<p>Add filter definition to selected step.
</p>


<h5>Usage</h5>

<div class="r"><pre>Source$add_filter(filter, step_id)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>filter</code></dt><dd><p>Filter definition created with <a href="#topic+filter">filter</a>.</p>
</dd>
<dt><code>step_id</code></dt><dd><p>Id of the step to include the filter to.
If skipped the last step is used.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Source-rm_filter"></a>



<h4>Method <code>rm_filter()</code></h4>

<p>Remove filter definition from selected step.
</p>


<h5>Usage</h5>

<div class="r"><pre>Source$rm_filter(step_id, filter_id)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>step_id</code></dt><dd><p>Id of the step where filter is defined.</p>
</dd>
<dt><code>filter_id</code></dt><dd><p>Id of the filter to be removed.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Source-update_filter"></a>



<h4>Method <code>update_filter()</code></h4>

<p>Update filter definition.
</p>


<h5>Usage</h5>

<div class="r"><pre>Source$update_filter(step_id, filter_id, ...)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>step_id</code></dt><dd><p>Id of the step where filter is defined.</p>
</dd>
<dt><code>filter_id</code></dt><dd><p>Id of the filter to be updated.</p>
</dd>
<dt><code>...</code></dt><dd><p>Parameters with its new values.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-Source-clone"></a>



<h4>Method <code>clone()</code></h4>

<p>The objects of this class are cloneable with this method.
</p>


<h5>Usage</h5>

<div class="r"><pre>Source$clone(deep = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>deep</code></dt><dd><p>Whether to make a deep clone.</p>
</dd>
</dl>

</div>



<hr>
<h2 id='source-layer'>Source compatibility methods.</h2><span id='topic+source-layer'></span><span id='topic+.init_step'></span><span id='topic+.init_step.default'></span><span id='topic+.collect_data'></span><span id='topic+.collect_data.default'></span><span id='topic+.get_stats'></span><span id='topic+.get_stats.default'></span><span id='topic+.pre_filtering'></span><span id='topic+.post_filtering'></span><span id='topic+.post_binding'></span><span id='topic+.repro_code_tweak'></span><span id='topic+.pre_filtering.default'></span><span id='topic+.post_filtering.default'></span><span id='topic+.post_binding.default'></span><span id='topic+.get_attrition_label'></span><span id='topic+.get_attrition_label.default'></span><span id='topic+.get_attrition_count'></span><span id='topic+.get_attrition_count.default'></span><span id='topic+.run_binding'></span><span id='topic+.run_binding.default'></span><span id='topic+.init_step.tblist'></span><span id='topic+.collect_data.tblist'></span><span id='topic+.get_stats.tblist'></span>

<h3>Description</h3>

<p>List of methods that allow compatibility of different source types.
Most of the methods should be defined in order to make new source layer functioning.
See 'Details' section for more information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.init_step(source, ...)

## Default S3 method:
.init_step(source, ...)

.collect_data(source, data_object)

## Default S3 method:
.collect_data(source, data_object)

.get_stats(source, data_object)

## Default S3 method:
.get_stats(source, data_object)

.pre_filtering(source, data_object, step_id)

.post_filtering(source, data_object, step_id)

.post_binding(source, data_object, step_id)

.repro_code_tweak(source, code_data)

## Default S3 method:
.pre_filtering(source, data_object, step_id)

## Default S3 method:
.post_filtering(source, data_object, step_id)

## Default S3 method:
.post_binding(source, data_object, step_id)

.get_attrition_label(source, step_id, step_filters, ...)

## Default S3 method:
.get_attrition_label(source, step_id, step_filters, ...)

.get_attrition_count(source, data_stats, ...)

## Default S3 method:
.get_attrition_count(source, data_stats, ...)

.run_binding(source, ...)

## Default S3 method:
.run_binding(source, binding_key, data_object_pre, data_object_post, ...)

## S3 method for class 'tblist'
.init_step(source, ...)

## S3 method for class 'tblist'
.collect_data(source, data_object)

## S3 method for class 'tblist'
.get_stats(source, data_object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="source-layer_+3A_source">source</code></td>
<td>
<p>Source object.</p>
</td></tr>
<tr><td><code id="source-layer_+3A_...">...</code></td>
<td>
<p>Other parameters passed to specific method.</p>
</td></tr>
<tr><td><code id="source-layer_+3A_data_object">data_object</code></td>
<td>
<p>Object that allows source data access.
'data_object' is the result of '.init_step' method (or object of the same structure).</p>
</td></tr>
<tr><td><code id="source-layer_+3A_step_id">step_id</code></td>
<td>
<p>Name of the step visible in resulting plot.</p>
</td></tr>
<tr><td><code id="source-layer_+3A_code_data">code_data</code></td>
<td>
<p>Data frame storing 'type', 'expr' and filter or step related columns.</p>
</td></tr>
<tr><td><code id="source-layer_+3A_step_filters">step_filters</code></td>
<td>
<p>List of step filters.</p>
</td></tr>
<tr><td><code id="source-layer_+3A_data_stats">data_stats</code></td>
<td>
<p>Data frame presenting statistics for each filtering step.</p>
</td></tr>
<tr><td><code id="source-layer_+3A_binding_key">binding_key</code></td>
<td>
<p>Binding key describing currently processed relation.</p>
</td></tr>
<tr><td><code id="source-layer_+3A_data_object_pre">data_object_pre</code></td>
<td>
<p>Object storing unfiltered data in the current step (previous step result).</p>
</td></tr>
<tr><td><code id="source-layer_+3A_data_object_post">data_object_post</code></td>
<td>
<p>Object storing current data (including active filtering and previously done bindings).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The package is designed to make the functionality work with multiple data sources.
Data source can be based for example on list of tables, connection to database schema
or API service that allows to access and operate on data.
In order to make new source type layer functioning, the following list of methods
should be defined:
</p>

<ul>
<li><p>.init_source Defines how to extract data object from source.
Each filtering step assumes to be operating on resulting data object
(further named data_object) and returns object of the same type and structure.
</p>
</li>
<li><p>.collect_data Defines how to collect data (into R memory) from 'data_object'.
</p>
</li>
<li><p>.get_stats Defines what 'data_object' statistics should be
calculated and how. When provided the stats can be extracted using <a href="#topic+stat">stat</a>.
</p>
</li>
<li><p>.pre_filtering (optional) Defines what operation on 'data_object' should be
performed before applying filtering in the step.
</p>
</li>
<li><p>.post_filtering (optional) Defines what operation on 'data_object' should be
performed after applying filtering in the step (before running binding).
</p>
</li>
<li><p>.post_binding (optional) Defines what operation on 'data_object' should be
performed after applying binding in the step.
</p>
</li>
<li><p>.run_binding (optional) Defines how to handle post filtering data binding.
See more about binding keys at <a href="#topic+binding-keys">binding-keys</a>.
</p>
</li>
<li><p>.get_attrition_count and .get_attrition_label Methods defining how to
get statistics and labels for attrition plot.
</p>
</li>
<li><p>.repro_code_tweak (optional) Default method passed as a 'modifier'
argument of <a href="#topic+code">code</a> function. Aims to modify reproducible code into the final format.
</p>
</li></ul>

<p>Except from the above methods, you may extend the existing or new source with providing
custom filtering methods. See <a href="#topic+creating-filters">creating-filters</a>.
In order to see more details about how to implement custom source check 'vignette(&quot;custom-extensions&quot;)'.
</p>


<h3>Value</h3>

<p>Depends on specific method. See 'vignette(&quot;custom-extensions&quot;)' for more details.
</p>

<hr>
<h2 id='stat'>Get Cohort related statistics.</h2><span id='topic+stat'></span>

<h3>Description</h3>

<p>Display data statistics related to specified step or filter.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stat(x, step_id, filter_id, ..., state = "post")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stat_+3A_x">x</code></td>
<td>
<p>Cohort object.</p>
</td></tr>
<tr><td><code id="stat_+3A_step_id">step_id</code></td>
<td>
<p>When 'filter_id' specified, 'step_id' precises from which step the filter comes from.
Otherwise data from specified step is used to calculate required statistics.</p>
</td></tr>
<tr><td><code id="stat_+3A_filter_id">filter_id</code></td>
<td>
<p>If not missing, filter related data statistics are returned.</p>
</td></tr>
<tr><td><code id="stat_+3A_...">...</code></td>
<td>
<p>Specific parameters passed to filter related method.</p>
</td></tr>
<tr><td><code id="stat_+3A_state">state</code></td>
<td>
<p>Should the stats be calculated on data before (&quot;pre&quot;) or after (&quot;post&quot;)
filtering in specified step.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of filter-specific values summing up underlying filter data.
</p>


<h3>See Also</h3>

<p><a href="#topic+cohort-methods">cohort-methods</a>
</p>

<hr>
<h2 id='step'>Create filtering step</h2><span id='topic+step'></span>

<h3>Description</h3>

<p>Steps all to perform multiple stages of Source data filtering.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>step(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="step_+3A_...">...</code></td>
<td>
<p>Filters. See <a href="#topic+filter">filter</a>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of class 'cb_step' storing filters configuration.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(magrittr)
iris_step_1 &lt;- step(
  filter('discrete', dataset = 'iris', variable = 'Species', value = 'setosa'),
  filter('discrete', dataset = 'iris', variable = 'Petal.Length', range = c(1.5, 2))
)
iris_step_2 &lt;- step(
  filter('discrete', dataset = 'iris', variable = 'Sepal.Length', range = c(5, 10))
)

# Add step directly to Cohort
iris_source &lt;- set_source(tblist(iris = iris))
coh &lt;- iris_source %&gt;%
  cohort(
    iris_step_1,
    iris_step_2
  ) %&gt;%
  run()

nrow(get_data(coh, step_id = 1)$iris)
nrow(get_data(coh, step_id = 2)$iris)

# Add step to Cohort using add_step method
coh &lt;- iris_source %&gt;%
  cohort()
coh &lt;- coh %&gt;%
  add_step(iris_step_1) %&gt;%
  add_step(iris_step_2) %&gt;%
  run()

</code></pre>

<hr>
<h2 id='sum_up'>Sum up Cohort state.</h2><span id='topic+sum_up'></span>

<h3>Description</h3>

<p>Sum up Cohort state.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sum_up(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sum_up_+3A_x">x</code></td>
<td>
<p>Cohort object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>None (invisible NULL). Printed summary of Cohort state.
</p>


<h3>See Also</h3>

<p><a href="#topic+cohort-methods">cohort-methods</a>
</p>

<hr>
<h2 id='tblist'>Create in memory tables connection</h2><span id='topic+tblist'></span><span id='topic+as.tblist'></span>

<h3>Description</h3>

<p>Create data connection as a list of loaded data frames.
The object should be used as 'dtconn' argument of <a href="#topic+set_source">set_source</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tblist(..., names)

as.tblist(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tblist_+3A_...">...</code></td>
<td>
<p>additional arguments to be passed to or from methods.</p>
</td></tr>
<tr><td><code id="tblist_+3A_names">names</code></td>
<td>
<p>A character vector describing provided tables names.
If missing names are constructed based on provided tables objects.</p>
</td></tr>
<tr><td><code id="tblist_+3A_x">x</code></td>
<td>
<p>an R object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Object of class 'tblist' being a named list of data frames.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>str(tblist(mtcars))
str(tblist(mtcars, iris))
str(tblist(MT = mtcars, IR = iris))
str(tblist(mtcars, iris, names = c("MT", "IR")))

</code></pre>

<hr>
<h2 id='update_filter'>Update filter definition</h2><span id='topic+update_filter'></span><span id='topic+update_filter.Cohort'></span><span id='topic+update_filter.Source'></span>

<h3>Description</h3>

<p>Update filter definition
</p>


<h3>Usage</h3>

<pre><code class='language-R'>update_filter(x, step_id, filter_id, ...)

## S3 method for class 'Cohort'
update_filter(x, step_id, filter_id, ..., run_flow = FALSE)

## S3 method for class 'Source'
update_filter(x, step_id, filter_id, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="update_filter_+3A_x">x</code></td>
<td>
<p>An object in which the filter should be updated.</p>
</td></tr>
<tr><td><code id="update_filter_+3A_step_id">step_id</code></td>
<td>
<p>Id of the step where filter is defined.</p>
</td></tr>
<tr><td><code id="update_filter_+3A_filter_id">filter_id</code></td>
<td>
<p>Id of the filter to be updated.</p>
</td></tr>
<tr><td><code id="update_filter_+3A_...">...</code></td>
<td>
<p>Filter parameters that should be updated.</p>
</td></tr>
<tr><td><code id="update_filter_+3A_run_flow">run_flow</code></td>
<td>
<p>If 'TRUE', data flow is run after the filter is updated.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Method dependent object (i.e. 'Cohort' or 'Source') having selected filter updated.
</p>


<h3>See Also</h3>

<p><a href="#topic+managing-cohort">managing-cohort</a>, <a href="#topic+managing-source">managing-source</a>
</p>

<hr>
<h2 id='update_source'>Update source in Cohort object.</h2><span id='topic+update_source'></span>

<h3>Description</h3>

<p>Update source in Cohort object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>update_source(x, source, keep_steps = !has_steps(source), run_flow = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="update_source_+3A_x">x</code></td>
<td>
<p>Cohort object.</p>
</td></tr>
<tr><td><code id="update_source_+3A_source">source</code></td>
<td>
<p>Source object to be updated in Cohort.</p>
</td></tr>
<tr><td><code id="update_source_+3A_keep_steps">keep_steps</code></td>
<td>
<p>If 'TRUE', steps definition remain unchanged when updating source.
If 'FALSE' steps configuration is deleted.
If vector of type integer, specified steps will remain.</p>
</td></tr>
<tr><td><code id="update_source_+3A_run_flow">run_flow</code></td>
<td>
<p>If 'TRUE', data flow is run after the source is updated.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The 'Cohort' class object with updated 'Source' definition.
</p>


<h3>See Also</h3>

<p><a href="#topic+managing-cohort">managing-cohort</a>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
