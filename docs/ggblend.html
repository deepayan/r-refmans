<!DOCTYPE html><html><head><title>Help for package ggblend</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ggblend}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#ggblend-package'><p>Blending and compositing for ggplot2</p></a></li>
<li><a href='#adjust'><p>Adjust layer params and aesthetics (Layer operation)</p></a></li>
<li><a href='#affine_transform'><p>Translate, scale, and rotate ggplot2 layers (Layer operation)</p></a></li>
<li><a href='#blend'><p>Blend ggplot2 layers (Layer operation)</p></a></li>
<li><a href='#copy'><p>Copy layers then adjust params and aesthetics (Layer operation)</p></a></li>
<li><a href='#layer_list'><p>Lists of layer-like objects</p></a></li>
<li><a href='#layer-like'><p>ggplot2 layer-like objects</p></a></li>
<li><a href='#nop'><p>Identity (&quot;no-op&quot;) transformation (Layer operation)</p></a></li>
<li><a href='#operation_composition'><p>Layer operation composition</p></a></li>
<li><a href='#operation_product'><p>Layer operation products</p></a></li>
<li><a href='#operation_sum'><p>Layer operation sums</p></a></li>
<li><a href='#operation-class'><p>Layer operations</p></a></li>
<li><a href='#partition'><p>Partition a layer into subgroups (Layer operation)</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Blending and Compositing Algebra for 'ggplot2'</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Algebra of operations for blending, copying, adjusting, and 
    compositing layers in 'ggplot2'. Supports copying and adjusting the 
    aesthetics or parameters of an existing layer, partitioning a layer 
    into multiple pieces for re-composition, applying affine transformations
    to layers, and combining layers (or partitions of layers) using blend modes
    (including commutative blend modes, like multiply and darken). Blend 
    mode support is particularly useful for creating plots with overlapping 
    groups where the layer drawing order does not change the output; 
    see Kindlmann and Scheidegger (2014) &lt;<a href="https://doi.org/10.1109%2FTVCG.2014.2346325">doi:10.1109/TVCG.2014.2346325</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.2)</td>
</tr>
<tr>
<td>Imports:</td>
<td>methods, grid, ggplot2 (&ge; 3.4.0), rlang</td>
</tr>
<tr>
<td>Suggests:</td>
<td>covr, testthat (&ge; 3.0.0), fontquiver, showtext, sysfonts,
ggnewscale</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/mjskay/ggblend/issues/new">https://github.com/mjskay/ggblend/issues/new</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://mjskay.github.io/ggblend/">https://mjskay.github.io/ggblend/</a>,
<a href="https://github.com/mjskay/ggblend/">https://github.com/mjskay/ggblend/</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-05-21 04:21:44 UTC; matth</td>
</tr>
<tr>
<td>Author:</td>
<td>Matthew Kay <a href="https://orcid.org/0000-0001-9446-0419"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cre, cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Matthew Kay &lt;mjskay@northwestern.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-05-22 08:30:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='ggblend-package'>Blending and compositing for ggplot2</h2><span id='topic+ggblend-package'></span><span id='topic+ggblend'></span>

<h3>Description</h3>

<p><span class="pkg">ggblend</span> is an R package that adds support for R 4.2 blend modes
(e.g. <code>"multiply"</code>, <code>"overlay"</code>, etc) to <span class="pkg">ggplot2</span>.
</p>


<h3>Details</h3>

<p>The primary support for blending is provided by the <code>blend()</code> function,
which can be used to augment <code><a href="ggplot2.html#topic+ggplot">ggplot()</a></code> layers/geoms or lists of
layers/geoms in a <code><a href="ggplot2.html#topic+ggplot">ggplot()</a></code> specification.
</p>
<p>For example, one can replace something like this:
</p>
<div class="sourceCode"><pre>df |&gt;
  ggplot(aes(x, y)) +
  geom_X(...) +
  geom_Y(...) +
  geom_Z(...)
</pre></div>
<p>With something like this:
</p>
<div class="sourceCode"><pre>df |&gt;
  ggplot(aes(x, y)) +
  geom_X(...) +
  geom_Y(...) |&gt; blend("multiply") +
  geom_Z(...)
</pre></div>
<p>In order to apply a &quot;multiply&quot; blend to the layer with <code>geom_Y(...)</code>.
</p>


<h3>Package options</h3>

<p>The following global options can be set using <code><a href="base.html#topic+options">options()</a></code> to modify the
behavior of <span class="pkg">ggblend</span>:
</p>

<ul>
<li> <p><code>"ggblend.check_blend"</code>: If <code>TRUE</code> (default), <code><a href="#topic+blend">blend()</a></code> will warn if
you attempt to use a blend mode not supported by the current graphics
device, as reported by <code>dev.capabilities()$compositing</code>. Since this check
can be unreliable on some devices (they will report not support a blend
mode that they do support), you can disable this warning by setting this
option to <code>FALSE</code>.
</p>
</li>
<li> <p><code>"ggblend.check_affine_transform"</code>: If <code>TRUE</code> (default), <code><a href="#topic+affine_transform">affine_transform()</a></code> will warn if
you attempt to use a blend mode not supported by the current graphics
device, as reported by <code>dev.capabilities()$transformation</code>. Since this check
can be unreliable on some devices (they will report not support a blend
mode that they do support), you can disable this warning by setting this
option to <code>FALSE</code>.
</p>
</li></ul>


<hr>
<h2 id='adjust'>Adjust layer params and aesthetics (Layer operation)</h2><span id='topic+adjust'></span><span id='topic+adjust-class'></span>

<h3>Description</h3>

<p>A layer <a href="#topic+operation">operation</a> for adjusting the params and aesthetic mappings of
a <a href="#topic+layer-like">layer-like</a> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>adjust(object, mapping = aes(), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="adjust_+3A_object">object</code></td>
<td>
<p>One of:
</p>

<ul>
<li><p> A <a href="#topic+layer-like">layer-like</a> object: applies this operation to the layer.
</p>
</li>
<li><p> A missing argument: creates an <a href="#topic+operation">operation</a>
</p>
</li>
<li><p> Anything else: creates an <a href="#topic+operation">operation</a>, passing <code>object</code> along to the
<code>mapping</code> argument
</p>
</li></ul>
</td></tr>
<tr><td><code id="adjust_+3A_mapping">mapping</code></td>
<td>
<p>An aesthetic created using <code>aes()</code>. Mappings provided here
will overwrite mappings in <code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code>s when this <a href="#topic+operation">operation</a> is applied to
them.</p>
</td></tr>
<tr><td><code id="adjust_+3A_...">...</code></td>
<td>
<p><code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code> parameters, such as would be passed to a <code>geom_...()</code>
or <code>stat_...()</code> call. Params provided here will overwrite params in layers when
this <a href="#topic+operation">operation</a> is applied to them.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <a href="#topic+layer-like">layer-like</a> object (if <code>object</code> is <a href="#topic+layer-like">layer-like</a>) or an <a href="#topic+operation">operation</a> (if not).
</p>


<h3>See Also</h3>

<p><a href="#topic+operation">operation</a> for a description of layer operations.
</p>
<p>Other layer operations: 
<code><a href="#topic+affine_transform">affine_transform</a></code>,
<code><a href="#topic+blend">blend</a></code>,
<code><a href="#topic+copy">copy</a></code>,
<code><a href="#topic+nop">nop</a></code>,
<code><a href="#topic+partition">partition</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(ggplot2)

# Here we use adjust() with nop() ( + 1) to create a copy of
# the stat_smooth layer, putting a white outline around it.
set.seed(1234)
k = 1000
data.frame(
  x = seq(1, 10, length.out = k),
  y = rnorm(k, seq(1, 2, length.out = k) + c(0, 0.5)),
  g = c("a", "b")
) |&gt;
  ggplot(aes(x, y, color = g)) +
  geom_point() +
  stat_smooth(method = lm, formula = y ~ x, linewidth = 1.5, se = FALSE) *
    (adjust(aes(group = g), color = "white", linewidth = 4) + 1) +
  scale_color_brewer(palette = "Dark2")

# (note this could also be done with copy_under())

</code></pre>

<hr>
<h2 id='affine_transform'>Translate, scale, and rotate ggplot2 layers (Layer operation)</h2><span id='topic+affine_transform'></span><span id='topic+affine_transform-class'></span>

<h3>Description</h3>

<p>Transform objects within a single layer (geom) or across multiple layers (geoms)
using affine transformations, like translation, scale, and rotation. Uses
the built-in compositing support in graphical devices added in R 4.2.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>affine_transform(object, x = 0, y = 0, width = 1, height = 1, angle = 0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="affine_transform_+3A_object">object</code></td>
<td>
<p>One of:
</p>

<ul>
<li><p> A <a href="#topic+layer-like">layer-like</a> object: applies this operation to the layer.
</p>
</li>
<li><p> A missing argument: creates an <a href="#topic+operation">operation</a>
</p>
</li>
<li><p> A <code>numeric()</code> or <code>unit()</code> giving the x-axis translation,
which takes the place of the <code>x</code> argument.
</p>
</li></ul>
</td></tr>
<tr><td><code id="affine_transform_+3A_x">x</code></td>
<td>
<p>A <code>numeric()</code> or <code>unit()</code> giving the x translation to apply.</p>
</td></tr>
<tr><td><code id="affine_transform_+3A_y">y</code></td>
<td>
<p>A <code>numeric()</code> or <code>unit()</code> giving the y translation to apply.</p>
</td></tr>
<tr><td><code id="affine_transform_+3A_width">width</code></td>
<td>
<p>A <code>numeric()</code> or <code>unit()</code> giving the width.</p>
</td></tr>
<tr><td><code id="affine_transform_+3A_height">height</code></td>
<td>
<p>A <code>numeric()</code> or <code>unit()</code> giving the height.</p>
</td></tr>
<tr><td><code id="affine_transform_+3A_angle">angle</code></td>
<td>
<p>A <code>numeric()</code> giving the angle to rotate, in degrees.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Applies an affine transformation (translation, scaling, rotation) to a layer.
</p>
<p><strong>Note:</strong> due to limitations in the implementation of scaling and rotation,
currently these operations can only be performed relative to the center of
the plot. In future versions, the translation and rotation origin may be
configurable.
</p>


<h3>Value</h3>

<p>A <a href="#topic+layer-like">layer-like</a> object (if <code>object</code> is <a href="#topic+layer-like">layer-like</a>) or an <a href="#topic+operation">operation</a> (if not).
</p>


<h3>Supported devices</h3>

<p>Transformation is not currently supported by all graphics devices. As of this writing,
at least <code>png(type = "cairo")</code>, <code>svg()</code>, and <code>cairo_pdf()</code> are known to support
blending.
</p>
<p><code>affine_transform()</code> attempts to auto-detect support for affine transformation using <code>dev.capabilities()</code>.
You may receive a warning when using <code>affine_transform()</code> if it appears transformation is not
supported by the current graphics device. This warning <strong>either</strong> means (1)
your graphics device does not support transformation (in which case you should
switch to one that does) or (2) your graphics device
supports transformation but incorrectly reports that it does not. Unfortunately,
not all graphics devices that support transformation appear to correctly <em>report</em>
that they support transformation, so even if auto-detection fails, <code>blend()</code> will
still attempt to apply the transformation, just in case.
</p>
<p>If the warning is issued and the output is still correctly transformed, this is
likely a bug in the graphics device. You can report the bug to the authors of
the graphics device if you wish; in the mean time, you can use
<code>options(ggblend.check_affine_transform = FALSE)</code> to disable the check.
</p>


<h3>References</h3>

<p>Murrell, Paul (2021):
<a href="https://www.stat.auckland.ac.nz/~paul/Reports/GraphicsEngine/groups/groups.html">Groups, Compositing Operators, and Affine Transformations in R Graphics</a>.
The University of Auckland. Report.
<a href="https://doi.org/10.17608/k6.auckland.17009120.v1">doi:10.17608/k6.auckland.17009120.v1</a>.
</p>


<h3>See Also</h3>

<p><a href="#topic+operation">operation</a> for a description of layer operations.
</p>
<p>Other layer operations: 
<code><a href="#topic+adjust">adjust</a></code>,
<code><a href="#topic+blend">blend</a></code>,
<code><a href="#topic+copy">copy</a></code>,
<code><a href="#topic+nop">nop</a></code>,
<code><a href="#topic+partition">partition</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(ggplot2)

# a simple dataset:
set.seed(1234)
data.frame(x = rnorm(100), y = rnorm(100)) |&gt;
  ggplot(aes(x, y)) +
  geom_point() +
  xlim(-5, 5)

# we could scale and translate copies of the point cloud
# (though I'm not sure why...)
data.frame(x = rnorm(100), y = rnorm(100)) |&gt;
  ggplot(aes(x, y)) +
  geom_point() * (
    affine_transform(x = -unit(100, "pt"), width = 0.5) |&gt; adjust(color = "red") +
    affine_transform(width = 0.5) +
    affine_transform(x = unit(100, "pt"), width = 0.5) |&gt; adjust(color = "blue")
  ) +
  xlim(-5, 5)

</code></pre>

<hr>
<h2 id='blend'>Blend ggplot2 layers (Layer operation)</h2><span id='topic+blend'></span><span id='topic+blend-class'></span>

<h3>Description</h3>

<p>Blend objects within a single layer (geom) or across multiple layers (geoms)
using graphical blending modes, such as <code>"multiply"</code>, <code>"overlay"</code>, etc. Uses
the built-in compositing support in graphical devices added in R 4.2.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>blend(object, blend = "over", alpha = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="blend_+3A_object">object</code></td>
<td>
<p>One of:
</p>

<ul>
<li><p> A <a href="#topic+layer-like">layer-like</a> object: applies this operation to the layer.
</p>
</li>
<li><p> A missing argument: creates an <a href="#topic+operation">operation</a>
</p>
</li>
<li><p> A string (character vector of length 1) giving the name of a blend,
which takes the place of the <code>blend</code> argument.
</p>
</li></ul>
</td></tr>
<tr><td><code id="blend_+3A_blend">blend</code></td>
<td>
<p>The blend mode to use. The default mode, <code>"over"</code>, corresponds to
the &quot;usual&quot; blend mode of drawing objects on top of each other.
The list of supported blend modes depends on your graphical device
(see Murrell 2021), and are listed in <code>dev.capabilities()$compositing</code>.
Blend modes can include: <code>"clear"</code>,
<code>"source"</code>, <code>"over"</code>, <code>"in"</code>, <code>"out"</code>, <code>"atop"</code>, <code>"dest"</code>, <code>"dest.over"</code>,
<code>"dest.in"</code>, <code>"dest.out"</code>, <code>"dest.atop"</code>, <code>"xor"</code>, <code>"add"</code>, <code>"saturate"</code>,
<code>"multiply"</code>, <code>"screen"</code>, <code>"overlay"</code>, <code>"darken"</code>, <code>"lighten"</code>,
<code>"color.dodge"</code>, <code>"color.burn"</code>, <code>"hard.light"</code>, <code>"soft.light"</code>,
<code>"difference"</code>, and <code>"exclusion"</code>
</p>
<p>Blend modes like <code>"multiply"</code>, <code>"darken"</code>, and <code>"lighten"</code> are particularly useful as they
are <em>commutative</em>: the result is the same whichever order they are applied in.
</p>
<p>A warning is issued if the current graphics device does not appear to support
the requested blend mode. In some cases this warning may be spurious, so
it can be disabled by setting <code>options(ggblend.check_blend = FALSE)</code>.</p>
</td></tr>
<tr><td><code id="blend_+3A_alpha">alpha</code></td>
<td>
<p>A numeric between <code>0</code> and <code>1</code> (inclusive). The opacity of a
transparency mask applied to objects prior to blending.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>object</code> is a single layer / geometry and the <code>partition</code> aesthetic <em>is not</em> set, every
graphical object (<code><a href="grid.html#topic+grob">grob()</a></code>) output by the geometry will be blended together
using the <code>blend</code> blend mode. If <code>alpha != 1</code>, a transparency mask with the
provided alpha level will be applied to each grob before blending.
</p>
<p>If <code>object</code> is a single layer / geometry and the <code>partition</code> aesthetic <em>is</em> set,
the geometry will be rendered for each subset of the data defined by the
<code>partition</code> aesthetic, a transparency mask with the provided <code>alpha</code> level
will be applied to each resulting group as a whole (if <code>alpha != 1</code>), then these groups
will be blended together using the <code>blend</code> blend mode.
</p>
<p>If <code>object</code> is a list of layers / geometries, those layers will be rendered
separately, a transparency mask with the provided <code>alpha</code> level
will be applied to each layer as a whole (if <code>alpha != 1</code>), then these layers
will be blended together using the <code>blend</code> blend mode.
</p>
<p>If a <code>blend()</code> is multiplied by a list of layers using <code>*</code>, it acts on each
layer individually (as if each layer were passed to <code>blend()</code>).
</p>


<h3>Value</h3>

<p>A <a href="#topic+layer-like">layer-like</a> object (if <code>object</code> is <a href="#topic+layer-like">layer-like</a>) or an <a href="#topic+operation">operation</a> (if not).
</p>


<h3>Supported devices</h3>

<p>Blending is not currently supported by all graphics devices. As of this writing,
at least <code>png(type = "cairo")</code>, <code>svg()</code>, and <code>cairo_pdf()</code> are known to support
blending.
</p>
<p><code>blend()</code> attempts to auto-detect support for blending using <code>dev.capabilities()</code>.
You may receive a warning when using <code>blend()</code> if it appears blending is not
supported by the current graphics device. This warning <strong>either</strong> means (1)
your graphics device does not support blending (in which case you should
switch to one that does) or (2) your graphics device
supports blending but incorrectly reports that it does not. Unfortunately,
not all graphics devices that support blending appear to correctly <em>report</em>
that they support blending, so even if auto-detection fails, <code>blend()</code> will
still attempt to apply the blend, just in case.
</p>
<p>If the warning is issued and the output is still correctly blended, this is
likely a bug in the graphics device. You can report the bug to the authors of
the graphics device if you wish; in the mean time, you can use
<code>options(ggblend.check_blend = FALSE)</code> to disable the check.
</p>


<h3>References</h3>

<p>Murrell, Paul (2021):
<a href="https://www.stat.auckland.ac.nz/~paul/Reports/GraphicsEngine/groups/groups.html">Groups, Compositing Operators, and Affine Transformations in R Graphics</a>.
The University of Auckland. Report.
<a href="https://doi.org/10.17608/k6.auckland.17009120.v1">doi:10.17608/k6.auckland.17009120.v1</a>.
</p>


<h3>See Also</h3>

<p><a href="#topic+operation">operation</a> for a description of layer operations.
</p>
<p>Other layer operations: 
<code><a href="#topic+adjust">adjust</a></code>,
<code><a href="#topic+affine_transform">affine_transform</a></code>,
<code><a href="#topic+copy">copy</a></code>,
<code><a href="#topic+nop">nop</a></code>,
<code><a href="#topic+partition">partition</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(ggplot2)

# create two versions of a dataset, where draw order can affect output
set.seed(1234)
df_a = data.frame(x = rnorm(500, 0), y = rnorm(500, 1), set = "a")
df_b = data.frame(x = rnorm(500, 1), y = rnorm(500, 2), set = "b")
df_ab = rbind(df_a, df_b) |&gt;
  transform(order = "draw a then b")
df_ba = rbind(df_b, df_a) |&gt;
  transform(order = "draw b then a")
df = rbind(df_ab, df_ba)

# Using the "darken" blend mode, draw order does not matter:
df |&gt;
  ggplot(aes(x, y, color = set)) +
  geom_point(size = 3) |&gt; blend("darken") +
  scale_color_brewer(palette = "Set2") +
  facet_grid(~ order)

# Using the "multiply" blend mode, we can see density within groups:
df |&gt;
  ggplot(aes(x, y, color = set)) +
  geom_point(size = 3) |&gt; blend("multiply") +
  scale_color_brewer(palette = "Set2") +
  facet_grid(~ order)

# blend() on a single geom by default blends all grobs in that geom together
# using the requested blend mode. If we wish to blend within specific data
# subsets using normal blending ("over") but between subsets using the
# requested blend mode, we can set the partition aesthetic. This will
# make "multiply" behave more like "darken":
df |&gt;
  ggplot(aes(x, y, color = set, partition = set)) +
  geom_point(size = 3) |&gt; blend("multiply") +
  scale_color_brewer(palette = "Set2") +
  facet_grid(~ order)

# We can also blend lists of geoms together; these geoms are rendered using
# normal ("over") blending (unless a blend() call is applied to a specific
# sub-layer, as in the first layer below) and then blended together using
# the requested blend mode.
df |&gt;
  ggplot(aes(x, y, color = set)) +
  list(
    geom_point(size = 3) |&gt; blend("darken"),
    geom_vline(xintercept = 0, color = "gray75", linewidth = 1.5),
    geom_hline(yintercept = 0, color = "gray75", linewidth = 1.5)
  ) |&gt; blend("hard.light") +
  scale_color_brewer(palette = "Set2") +
  facet_grid(~ order)

</code></pre>

<hr>
<h2 id='copy'>Copy layers then adjust params and aesthetics (Layer operation)</h2><span id='topic+copy'></span><span id='topic+copy_over'></span><span id='topic+copy_under'></span>

<h3>Description</h3>

<p>A layer <a href="#topic+operation">operation</a> for copying and then adjusting the params and aesthetic
mappings of a <a href="#topic+layer-like">layer-like</a> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>copy_over(object, mapping = aes(), ...)

copy_under(object, mapping = aes(), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="copy_+3A_object">object</code></td>
<td>
<p>One of:
</p>

<ul>
<li><p> A <a href="#topic+layer-like">layer-like</a> object: applies this operation to the layer.
</p>
</li>
<li><p> A missing argument: creates an <a href="#topic+operation">operation</a>
</p>
</li>
<li><p> Anything else: creates an <a href="#topic+operation">operation</a>, passing <code>object</code> along to the
<code>mapping</code> argument
</p>
</li></ul>
</td></tr>
<tr><td><code id="copy_+3A_mapping">mapping</code></td>
<td>
<p>An aesthetic created using <code>aes()</code>. Mappings provided here
will overwrite mappings in <code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code>s when this <a href="#topic+operation">operation</a> is applied to
them.</p>
</td></tr>
<tr><td><code id="copy_+3A_...">...</code></td>
<td>
<p><code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code> parameters, such as would be passed to a <code>geom_...()</code>
or <code>stat_...()</code> call. Params provided here will overwrite params in layers when
this <a href="#topic+operation">operation</a> is applied to them.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>These are shortcuts for duplicating a layer and then applying <code><a href="#topic+adjust">adjust()</a></code>.
Specifically:
</p>

<ul>
<li> <p><code>copy_over(...)</code> is equivalent to <code>1 + adjust(...)</code>
</p>
</li>
<li> <p><code>copy_under(...)</code> is equivalent to <code>adjust(...) + 1</code>
</p>
</li></ul>



<h3>Value</h3>

<p>A <a href="#topic+layer-like">layer-like</a> object (if <code>object</code> is <a href="#topic+layer-like">layer-like</a>) or an <a href="#topic+operation">operation</a> (if not).
</p>


<h3>See Also</h3>

<p><a href="#topic+operation">operation</a> for a description of layer operations.
</p>
<p>Other layer operations: 
<code><a href="#topic+adjust">adjust</a></code>,
<code><a href="#topic+affine_transform">affine_transform</a></code>,
<code><a href="#topic+blend">blend</a></code>,
<code><a href="#topic+nop">nop</a></code>,
<code><a href="#topic+partition">partition</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ggplot2)

# here we use copy_under() to create a copy of
# the stat_smooth layer, putting a white outline around it.
set.seed(1234)
k = 1000
data.frame(
  x = seq(1, 10, length.out = k),
  y = rnorm(k, seq(1, 2, length.out = k) + c(0, 0.5)),
  g = c("a", "b")
) |&gt;
  ggplot(aes(x, y, color = g)) +
  geom_point() +
  stat_smooth(method = lm, formula = y ~ x, linewidth = 1.5, se = FALSE) *
    copy_under(aes(group = g), color = "white", linewidth = 4) +
  scale_color_brewer(palette = "Dark2")

</code></pre>

<hr>
<h2 id='layer_list'>Lists of layer-like objects</h2><span id='topic+layer_list'></span><span id='topic+layer_list-class'></span><span id='topic+as_layer_list'></span><span id='topic+as_layer_list.layer_list'></span><span id='topic+as_layer_list.list'></span><span id='topic+as_layer_list.LayerInstance'></span><span id='topic++2B+2Clayer_list+2Clayer_list-method'></span><span id='topic+show+2Clayer_list-method'></span>

<h3>Description</h3>

<p>A list of <a href="#topic+layer-like">layer-like</a> objects, which can be used in layer <a href="#topic+operation">operation</a>s
(through function application or multiplication) or added to a <code><a href="ggplot2.html#topic+ggplot2">ggplot2()</a></code>
object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>layer_list(...)

as_layer_list(x)

## S3 method for class 'layer_list'
as_layer_list(x)

## S3 method for class 'list'
as_layer_list(x)

## S3 method for class 'LayerInstance'
as_layer_list(x)

## S4 method for signature 'layer_list,layer_list'
e1 + e2

## S4 method for signature 'layer_list'
show(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="layer_list_+3A_x">x</code>, <code id="layer_list_+3A_...">...</code></td>
<td>
<p><a href="#topic+layer-like">layer-like</a> objects</p>
</td></tr>
<tr><td><code id="layer_list_+3A_object">object</code>, <code id="layer_list_+3A_e1">e1</code>, <code id="layer_list_+3A_e2">e2</code></td>
<td>
<p><code><a href="#topic+layer_list">layer_list()</a></code>s</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For the most part, users of <span class="pkg">ggblend</span> need not worry about this class.
It is used internally to simplify multiple dispatch on binary operators, as
the alternative (<code><a href="base.html#topic+list">list()</a></code>s of <code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code>s) is more cumbersome.
<span class="pkg">ggblend</span> converts input lists to this format as needed.
</p>


<h3>Value</h3>

<p>An object of class <code>"layer_list"</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ggplot2)

# layer_list()s act just like list()s of layer()s in that they can
# be added to ggplot() objects
data.frame(x = 1:10) |&gt;
  ggplot(aes(x, x)) +
  layer_list(
    geom_line(),
    geom_point()
  )

</code></pre>

<hr>
<h2 id='layer-like'>ggplot2 layer-like objects</h2><span id='topic+layer-like'></span><span id='topic+layer'></span><span id='topic+is_layer_like'></span><span id='topic+as_layer_like'></span><span id='topic+as_layer_like.default'></span><span id='topic+as_layer_like.LayerInstance'></span><span id='topic+as_layer_like.list'></span><span id='topic+as_layer_like.layer_list'></span>

<h3>Description</h3>

<p>For technical reasons related to how <span class="pkg">ggplot2</span> implements layers, there
is no single class from which all valid <span class="pkg">ggplot2</span> layers and lists of
layers inherit. Thus, <span class="pkg">ggblend</span> <a href="#topic+operation">operation</a>s supports a variety of &quot;layer-like&quot;
objects, documented here (see <em>Details</em>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_layer_like(x)

as_layer_like(x)

## Default S3 method:
as_layer_like(x)

## S3 method for class 'LayerInstance'
as_layer_like(x)

## S3 method for class 'list'
as_layer_like(x)

## S3 method for class 'layer_list'
as_layer_like(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="layer-like_+3A_x">x</code></td>
<td>
<p>A <a href="#topic+layer-like">layer-like</a> object. See <em>Details</em>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><span class="pkg">ggblend</span> <a href="#topic+operation">operation</a>s can be applied to several <code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code>-like objects,
including:
</p>

<ul>
<li><p> objects of class <code>"LayerInstance"</code>; e.g. <code>stat</code>s and <code>geom</code>s.
</p>
</li>
<li> <p><code><a href="base.html#topic+list">list()</a></code>s of layer-like objects.
</p>
</li>
<li> <p><code><a href="#topic+layer_list">layer_list()</a></code>s, which are a more type-safe version of <code><a href="base.html#topic+list">list()</a></code>s of
layer-like objects.
</p>
</li></ul>

<p>Anywhere in <span class="pkg">ggblend</span> where a function parameter is documented as being
<a href="#topic+layer-like">layer-like</a>, it can be any of the above object types.
</p>


<h3>Value</h3>

<p>For <code>is_layer_like()</code>, a <code>logical</code>: <code>TRUE</code> if <code>x</code> is layer-like, <code>FALSE</code> otherwise.
</p>
<p>For <code>as_layer_like()</code>, a <code>"LayerInstance"</code> or a <code><a href="#topic+layer_list">layer_list()</a></code>.
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>is_layer_like()</code>: checks if an object is layer-like according to <span class="pkg">ggblend</span>.
</p>
</li>
<li> <p><code>as_layer_like()</code>: validates that an object is layer-like and converts
it to a <code>"LayerInstance"</code> or <code><a href="#topic+layer_list">layer_list()</a></code>.
</p>
</li></ul>


<h3>Examples</h3>

<pre><code class='language-R'>library(ggplot2)

is_layer_like(geom_line())
is_layer_like(list(geom_line()))
is_layer_like(list(geom_line(), scale_x_continuous()))
is_layer_like(list(geom_line(), "abc"))
</code></pre>

<hr>
<h2 id='nop'>Identity (&quot;no-op&quot;) transformation (Layer operation)</h2><span id='topic+nop'></span><span id='topic+nop-class'></span>

<h3>Description</h3>

<p>A layer <a href="#topic+operation">operation</a> which returns the input <a href="#topic+layer-like">layer-like</a> object unchanged.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nop(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nop_+3A_object">object</code></td>
<td>
<p>One of:
</p>

<ul>
<li><p> A <a href="#topic+layer-like">layer-like</a> object: applies this operation to the layer.
</p>
</li>
<li><p> A missing argument: creates an <a href="#topic+operation">operation</a>
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>When <code>numeric()</code>s are used with <a href="#topic+operation">operation</a>s, they are converted into
sums of <code>nop()</code>s.
</p>


<h3>Value</h3>

<p>A <a href="#topic+layer-like">layer-like</a> object (if <code>object</code> is <a href="#topic+layer-like">layer-like</a>) or an <a href="#topic+operation">operation</a> (if not).
</p>


<h3>See Also</h3>

<p><a href="#topic+operation">operation</a> for a description of layer operations.
</p>
<p>Other layer operations: 
<code><a href="#topic+adjust">adjust</a></code>,
<code><a href="#topic+affine_transform">affine_transform</a></code>,
<code><a href="#topic+blend">blend</a></code>,
<code><a href="#topic+copy">copy</a></code>,
<code><a href="#topic+partition">partition</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ggplot2)

# adding a nop to another operation is equivalent to adding a numeric
adjust() + nop()

# and vice versa
adjust() + 2

# here we use adjust() with nop() ( + 1) to create a copy of
# the stat_smooth layer, putting a white outline around it.
set.seed(1234)
k = 1000
data.frame(
  x = seq(1, 10, length.out = k),
  y = rnorm(k, seq(1, 2, length.out = k) + c(0, 0.5)),
  g = c("a", "b")
) |&gt;
  ggplot(aes(x, y, color = g)) +
  geom_point() +
  stat_smooth(method = lm, formula = y ~ x, linewidth = 1.5, se = FALSE) *
    (adjust(aes(group = g), color = "white", linewidth = 4) + 1) +
  scale_color_brewer(palette = "Dark2")

# (note this could also be done with copy_under())

</code></pre>

<hr>
<h2 id='operation_composition'>Layer operation composition</h2><span id='topic+operation_composition'></span><span id='topic+operation_composition-class'></span>

<h3>Description</h3>

<p><a href="#topic+operation">operation</a>s can be composed together to form chains of operations, which
when multiplied by (applied to) <a href="#topic+layer-like">layer-like</a> objects, return modified <a href="#topic+layer-like">layer-like</a> objects. In
contrast to <a href="#topic+operation_product">operation_product</a>s, compositions of operations are not
distributive over sums of <a href="#topic+operation">operation</a>s or <a href="#topic+layer-like">layer-like</a> objects.
</p>


<h3>Details</h3>

<p>Operation composition is achieved through function application, typically
using the pipe operator (<code style="white-space: pre;">&#8288;|&gt;&#8288;</code>); e.g. <code style="white-space: pre;">&#8288;operation1 |&gt; operation2&#8288;</code>.
</p>
<p>The output of composing <span class="pkg">ggblend</span> <a href="#topic+operation">operation</a>s depends on the types of
objects being composed:
</p>

<ul>
<li><p> If you compose an <a href="#topic+operation">operation</a> with an <a href="#topic+operation">operation</a>, they are merged into
a single <a href="#topic+operation">operation</a> that applies each <a href="#topic+operation">operation</a> in sequence, without
distributing over layers.
</p>
</li>
<li><p> If you compose an <a href="#topic+operation">operation</a> with a <a href="#topic+layer-like">layer-like</a> object, that operation is applied
to the layer, returning a new <a href="#topic+layer-like">layer-like</a> object. The operation is applied to the
layer as a whole, not any sub-parts (e.g. sub-layers or graphical objects).
</p>
</li></ul>



<h3>Value</h3>

<p>An <a href="#topic+operation">operation</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(ggplot2)

# composing operations together chains them
adjust(color = "red") |&gt; blend("multiply")

# unlike multiplication, composition does not follow the distributive law
mult_op = (adjust(aes(y = 11 -x), color = "skyblue") + 1) * blend("multiply")
mult_op

comp_op = (adjust(aes(y = 11 -x), color = "skyblue") + 1) |&gt; blend("multiply")
comp_op

# multiplication by a geom returns a modified version of that geom
data.frame(x = 1:10) |&gt;
  ggplot(aes(x = x, y = x)) +
  geom_line(linewidth = 10, color = "red") * comp_op

</code></pre>

<hr>
<h2 id='operation_product'>Layer operation products</h2><span id='topic+operation_product'></span><span id='topic+operation_product-class'></span><span id='topic++2A+2Coperation+2CANY-method'></span><span id='topic++2A+2CANY+2Coperation-method'></span><span id='topic++2A+2Cadjust+2Cadjust-method'></span><span id='topic++2A+2Cnop+2Cnop-method'></span><span id='topic++2A+2Coperation+2Cnop-method'></span><span id='topic++2A+2Coperation_sum+2Cnop-method'></span><span id='topic++2A+2Cnop+2Coperation-method'></span><span id='topic++2A+2Cnop+2Coperation_sum-method'></span><span id='topic+prod+2Coperation-method'></span><span id='topic++2A+2Coperation+2Coperation-method'></span><span id='topic++2A+2Cnumeric+2Coperation-method'></span><span id='topic++2A+2Coperation+2Cnumeric-method'></span><span id='topic++2A+2Coperation+2Coperation_sum-method'></span><span id='topic++2A+2Coperation_sum+2Coperation-method'></span><span id='topic++2A+2Coperation_sum+2Coperation_sum-method'></span>

<h3>Description</h3>

<p><a href="#topic+operation">operation</a>s can be multiplied together to form chains of operations, which
when multiplied by (applied to) <a href="#topic+layer-like">layer-like</a> objects, return modified <a href="#topic+layer-like">layer-like</a> objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'operation,ANY'
e1 * e2

## S4 method for signature 'ANY,operation'
e1 * e2

## S4 method for signature 'adjust,adjust'
e1 * e2

## S4 method for signature 'nop,nop'
e1 * e2

## S4 method for signature 'operation,nop'
e1 * e2

## S4 method for signature 'operation_sum,nop'
e1 * e2

## S4 method for signature 'nop,operation'
e1 * e2

## S4 method for signature 'nop,operation_sum'
e1 * e2

## S4 method for signature 'operation'
prod(x, ..., na.rm = FALSE)

## S4 method for signature 'operation,operation'
e1 * e2

## S4 method for signature 'numeric,operation'
e1 * e2

## S4 method for signature 'operation,numeric'
e1 * e2

## S4 method for signature 'operation,operation_sum'
e1 * e2

## S4 method for signature 'operation_sum,operation'
e1 * e2

## S4 method for signature 'operation_sum,operation_sum'
e1 * e2
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="operation_product_+3A_e1">e1</code></td>
<td>
<p>an <a href="#topic+operation">operation</a>, <a href="#topic+layer-like">layer-like</a>, or <code><a href="base.html#topic+numeric">numeric()</a></code></p>
</td></tr>
<tr><td><code id="operation_product_+3A_e2">e2</code></td>
<td>
<p>an <a href="#topic+operation">operation</a>, <a href="#topic+layer-like">layer-like</a>, or <code><a href="base.html#topic+numeric">numeric()</a></code></p>
</td></tr>
<tr><td><code id="operation_product_+3A_x">x</code>, <code id="operation_product_+3A_...">...</code></td>
<td>
<p><a href="#topic+operation">operation</a>s</p>
</td></tr>
<tr><td><code id="operation_product_+3A_na.rm">na.rm</code></td>
<td>
<p>ignored</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Multiplication of <span class="pkg">ggblend</span> <a href="#topic+operation">operation</a>s depends on the types of
objects being multiplied:
</p>

<ul>
<li><p> If you multiply an <a href="#topic+operation">operation</a> with an <a href="#topic+operation">operation</a>, they are merged into
a single <a href="#topic+operation">operation</a> that applies each <a href="#topic+operation">operation</a> in sequence.
</p>
</li>
<li><p> If you multiply an <a href="#topic+operation">operation</a> with a <a href="#topic+layer-like">layer-like</a> object, that operation is applied
to the layer, returning a new <a href="#topic+layer-like">layer-like</a> object.
</p>
</li>
<li><p> If you multiply an <a href="#topic+operation">operation</a> by a <code><a href="base.html#topic+numeric">numeric()</a></code> <em>n</em>, a new <a href="#topic+operation">operation</a> that
repeats the input <a href="#topic+operation">operation</a> is <em>n</em> times is returned.
</p>
</li></ul>



<h3>Value</h3>

<p>An <a href="#topic+operation">operation</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ggplot2)

# multiplying operations by numerics repeats them...
adjust(color = "red") * 2

# multiplying operations together chains (or merges) them
adjust(color = "red") * adjust(linewidth = 2)

# multiplication obeys the distributive law
op = (adjust(aes(y = 11 -x), color = "skyblue") + 1) * (adjust(color = "white", linewidth = 4) + 1)
op

# multiplication by a geom returns a modified version of that geom
data.frame(x = 1:10) |&gt;
  ggplot(aes(x = x, y = x)) +
  geom_line(linewidth = 2) * op

</code></pre>

<hr>
<h2 id='operation_sum'>Layer operation sums</h2><span id='topic+operation_sum'></span><span id='topic+operation_sum-class'></span><span id='topic+sum+2Coperation-method'></span><span id='topic++2B+2Coperation+2Coperation-method'></span><span id='topic++2B+2Coperation+2Cnumeric-method'></span><span id='topic++2B+2Cnumeric+2Coperation-method'></span><span id='topic+format+2Coperation_sum-method'></span>

<h3>Description</h3>

<p><a href="#topic+operation">operation</a>s can be added together to form stacks of operations, which
when multiplied by (applied to) <a href="#topic+layer-like">layer-like</a> objects, those <a href="#topic+layer-like">layer-like</a> objects are distributed
over the <a href="#topic+operation">operation</a>s (i.e. copied).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'operation'
sum(x, ..., na.rm = FALSE)

## S4 method for signature 'operation,operation'
e1 + e2

## S4 method for signature 'operation,numeric'
e1 + e2

## S4 method for signature 'numeric,operation'
e1 + e2

## S4 method for signature 'operation_sum'
format(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="operation_sum_+3A_x">x</code>, <code id="operation_sum_+3A_...">...</code></td>
<td>
<p><a href="#topic+operation">operation</a>s</p>
</td></tr>
<tr><td><code id="operation_sum_+3A_na.rm">na.rm</code></td>
<td>
<p>ignored</p>
</td></tr>
<tr><td><code id="operation_sum_+3A_e1">e1</code></td>
<td>
<p>an <a href="#topic+operation">operation</a> or <code><a href="base.html#topic+numeric">numeric()</a></code></p>
</td></tr>
<tr><td><code id="operation_sum_+3A_e2">e2</code></td>
<td>
<p>an <a href="#topic+operation">operation</a> or <code><a href="base.html#topic+numeric">numeric()</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Addition of <span class="pkg">ggblend</span> <a href="#topic+operation">operation</a>s depends on the types of
objects being summed:
</p>

<ul>
<li><p> If you add an <a href="#topic+operation">operation</a> to an <a href="#topic+operation">operation</a>, they are merged into
a single <a href="#topic+operation">operation</a> that copies input <a href="#topic+layer-like">layer-like</a> objects, one for each <a href="#topic+operation">operation</a>.
</p>
</li>
<li><p> If you add an <a href="#topic+operation">operation</a> to a <code><a href="base.html#topic+numeric">numeric()</a></code> <em>n</em>, it is equivalent to
adding <code>*</code> <code><a href="#topic+nop">nop()</a></code>s to that <a href="#topic+operation">operation</a>.
</p>
</li></ul>



<h3>Value</h3>

<p>An <a href="#topic+operation">operation</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ggplot2)

# adding operations together creates a sum of operations
adjust(color = "red") + adjust(linewidth = 2)

# addition and multiplication obey the distributive law
op = (adjust(aes(y = 11 -x), color = "skyblue") + 1) * (adjust(color = "white", linewidth = 4) + 1)
op

# multiplication by a geom returns a modified version of that geom,
# distributed over the sum of the operations
data.frame(x = 1:10) |&gt;
  ggplot(aes(x = x, y = x)) +
  geom_line(linewidth = 2) * op
</code></pre>

<hr>
<h2 id='operation-class'>Layer operations</h2><span id='topic+operation-class'></span><span id='topic+operation'></span><span id='topic+show+2Coperation-method'></span><span id='topic+format+2Coperation-method'></span><span id='topic+format+2Cadjust-method'></span><span id='topic+format+2Caffine_transform-method'></span><span id='topic+format+2Cblend-method'></span><span id='topic+format+2Coperation_composition-method'></span><span id='topic+format+2Cnop-method'></span><span id='topic+format+2Coperation_product-method'></span>

<h3>Description</h3>

<p>Layer <a href="#topic+operation">operation</a>s are composable transformations that can be applied to <span class="pkg">ggplot2</span>
<a href="#topic+layer-like">layer-like</a> objects, such as <code>stat</code>s, <code>geom</code>s, and lists of <code>stat</code>s and
<code>geom</code>s; see the <a href="#topic+layer-like">layer-like</a> documentation page for a description of valid
<a href="#topic+layer-like">layer-like</a> objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'operation'
show(object)

## S4 method for signature 'operation'
format(x, ...)

## S4 method for signature 'adjust'
format(x, ...)

## S4 method for signature 'affine_transform'
format(x, ...)

## S4 method for signature 'blend'
format(x, ...)

## S4 method for signature 'operation_composition'
format(x, ...)

## S4 method for signature 'nop'
format(x, ...)

## S4 method for signature 'operation_product'
format(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="operation-class_+3A_x">x</code>, <code id="operation-class_+3A_object">object</code></td>
<td>
<p>An <a href="#topic+operation">operation</a>.</p>
</td></tr>
<tr><td><code id="operation-class_+3A_...">...</code></td>
<td>
<p>Further arguments passed to other methods.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="#topic+operation">operation</a>s can be composed using the <code>+</code> and <code>*</code> operators (see <a href="#topic+operation_sum">operation_sum</a>
and <a href="#topic+operation_product">operation_product</a>). Addition and multiplication of <a href="#topic+operation">operation</a>s and <a href="#topic+layer-like">layer-like</a>
objects obeys the distributive law.
</p>
<p><a href="#topic+operation">operation</a>s can be applied to <a href="#topic+layer-like">layer-like</a> objects using <code>*</code> or <code style="white-space: pre;">&#8288;|&gt;&#8288;</code>, with slightly
different results:
</p>

<ul>
<li><p> Using <code>*</code>, application of <a href="#topic+operation">operation</a>s to a list of <a href="#topic+layer-like">layer-like</a> objects <em>is</em> distributive. For example,
<code>list(geom_line(), geom_point()) * blend("multiply")</code> is
equivalent to <code>list(geom_line() * blend("multiply"), geom_point() * blend("multiply"))</code>;
i.e. it multiply-blends the contents of the two layers individually.
</p>
</li>
<li><p> Using <code style="white-space: pre;">&#8288;|&gt;&#8288;</code>, application of <a href="#topic+operation">operation</a>s to a list of <a href="#topic+layer-like">layer-like</a> objects is <em>not</em>
distributive (unless the only reasonable interpretation of applying the
transformation is necessarily distributive; e.g. <code>adjust()</code>). For example,
<code>list(geom_line(), geom_point()) |&gt; blend("multiply")</code> would multiply-blend
both layers together, rather than multiply-blending the contents of the
two layers individually.
</p>
</li></ul>



<h3>Value</h3>

<p>For <code>show()</code>, an <code><a href="base.html#topic+invisible">invisible()</a></code> copy of the input.
</p>
<p>For <code>format()</code>, a character string representing the input.
</p>


<h3>Methods (by generic)</h3>


<ul>
<li> <p><code>show(operation)</code>: Print an <a href="#topic+operation">operation</a>.
</p>
</li>
<li> <p><code>format(operation)</code>: Format an <a href="#topic+operation">operation</a> for printing.
</p>
</li></ul>


<h3>Examples</h3>

<pre><code class='language-R'>library(ggplot2)

# operations can stand alone
adjust(aes(color = x))

# they can also be applied to layers through multiplication or piping
geom_line() |&gt; adjust(aes(color = x))
geom_line() * adjust(aes(color = x))

# layer operations act as a small algebra, and can be combined through
# multiplication and addition
(adjust(fill = "green") + 1) * blend("multiply")

</code></pre>

<hr>
<h2 id='partition'>Partition a layer into subgroups (Layer operation)</h2><span id='topic+partition'></span>

<h3>Description</h3>

<p>A layer <a href="#topic+operation">operation</a> for adding a <code>partition</code> aesthetic to a <a href="#topic+layer">layer</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>partition(object, partition)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="partition_+3A_object">object</code></td>
<td>
<p>One of:
</p>

<ul>
<li><p> A <a href="#topic+layer-like">layer-like</a> object: applies this operation to the layer.
</p>
</li>
<li><p> A missing argument: creates an <a href="#topic+operation">operation</a>
</p>
</li>
<li><p> Anything else: creates an <a href="#topic+operation">operation</a>, passing <code>object</code> along to the
<code>partition</code> argument
</p>
</li></ul>
</td></tr>
<tr><td><code id="partition_+3A_partition">partition</code></td>
<td>
<p>One of:
</p>

<ul>
<li><p> A list of quosures, such as returned by <code><a href="ggplot2.html#topic+vars">vars()</a></code>, giving a (possibly multi-)
column expression for the <code>partition</code> aesthetic. These expressions are
combined using <code><a href="base.html#topic+interaction">interaction()</a></code> to be passed on to <code>aes(partition = ...)</code>
</p>
</li>
<li><p> A one-sided formula, giving a single-column expression for the <code>partition</code>
aesthetic, which is passed on to <code>aes_(partition = ...)</code>.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>This is a shortcut for setting the <code>partition</code> aesthetic of a <a href="#topic+layer">layer</a>.
</p>

<ul>
<li> <p><code>partition(~ XXX)</code> is roughly equivalent to <code>adjust(aes(partition = XXX))</code>
</p>
</li>
<li> <p><code>partition(vars(X, Y, ...))</code> is roughly equivalent to <code>adjust(aes(partition = interaction(X, Y, ...)))</code>
</p>
</li></ul>

<p>When a <a href="#topic+layer">layer</a> with a <code>partition</code> aesthetic is used by the following
<a href="#topic+operation">operation</a>s, the effects of the operations are applied across groups:
</p>

<ul>
<li> <p><code><a href="#topic+blend">blend()</a></code>: Blends graphical objects within the subgroups defined by the
partition together using normal (<code>"over"</code>) blending before applying its
blend between subgroups.
</p>
</li></ul>



<h3>Value</h3>

<p>A <a href="#topic+layer-like">layer-like</a> object (if <code>object</code> is <a href="#topic+layer-like">layer-like</a>) or an <a href="#topic+operation">operation</a> (if not).
</p>


<h3>See Also</h3>

<p><a href="#topic+operation">operation</a> for a description of layer operations.
</p>
<p>Other layer operations: 
<code><a href="#topic+adjust">adjust</a></code>,
<code><a href="#topic+affine_transform">affine_transform</a></code>,
<code><a href="#topic+blend">blend</a></code>,
<code><a href="#topic+copy">copy</a></code>,
<code><a href="#topic+nop">nop</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(ggplot2)

# create two versions of a dataset, where draw order can affect output
set.seed(1234)
df_a = data.frame(x = rnorm(500, 0), y = rnorm(500, 1), set = "a")
df_b = data.frame(x = rnorm(500, 1), y = rnorm(500, 2), set = "b")
df_ab = rbind(df_a, df_b) |&gt;
  transform(order = "draw a then b")
df_ba = rbind(df_b, df_a) |&gt;
  transform(order = "draw b then a")
df = rbind(df_ab, df_ba)

# Using the "multiply" blend mode, draw order does not matter, but
# the "multiply" blend is applied to all points, creating dark regions
# outside the intersection:
df |&gt;
  ggplot(aes(x, y, color = set)) +
  geom_point(size = 3, alpha = 0.5) |&gt; blend("multiply") +
  scale_color_brewer(palette = "Set1") +
  facet_grid(~ order)

# By partitioning (either through |&gt; partition(vars(set)) or aes(partition = set))
# we will blend using the default blend mode (over) first, then we can apply the
# "multiply" blend just between the two sets, so the regions outside the
# intersection are not blended using "multiply":
df |&gt;
  ggplot(aes(x, y, color = set, partition = set)) +
  geom_point(size = 3, alpha = 0.5) |&gt; blend("multiply") +
  scale_color_brewer(palette = "Set1") +
  facet_grid(~ order)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
