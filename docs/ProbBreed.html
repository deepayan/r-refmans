<!DOCTYPE html><html><head><title>Help for package ProbBreed</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ProbBreed}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#bayes_met'><p>Bayesian model for multi-environment trials</p></a></li>
<li><a href='#extr_outs'><p>Extracting outputs from <code>bayes_met()</code> objects</p></a></li>
<li><a href='#maize'><p>Maize real data set</p></a></li>
<li><a href='#prob_sup'><p>Probabilities of superior performance and stability</p></a></li>
<li><a href='#ProbBreed-package'><p>ProbBreed: Probability Theory for Selecting Candidates in Plant Breeding</p></a></li>
<li><a href='#soy'><p>Soybean real data set</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Probability Theory for Selecting Candidates in Plant Breeding</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.3.1</td>
</tr>
<tr>
<td>Description:</td>
<td>Use probability theory under the Bayesian framework for calculating the risk of selecting candidates in a multi-environment context [Dias et al. (2022) &lt;<a href="https://doi.org/10.1007%2Fs00122-022-04041-y">doi:10.1007/s00122-022-04041-y</a>&gt;]. Contained are functions used to fit a Bayesian multi-environment model (based on the available presets), extract posterior values and maximum posterior values, compute the variance components, check the modelâ€™s convergence, and calculate the probabilities. For both across and within-environments scopes, the package computes the probability of superior performance and the pairwise probability of superior performance. Furthermore, the probability of superior stability and the pairwise probability of superior stability across environments is estimated. A joint probability of superior performance and stability is also provided. </td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/saulo-chaves/ProbBreed">https://github.com/saulo-chaves/ProbBreed</a>,
<a href="https://saulo-chaves.github.io/ProbBreed_site/">https://saulo-chaves.github.io/ProbBreed_site/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/saulo-chaves/ProbBreed/issues">https://github.com/saulo-chaves/ProbBreed/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/AGPL-3">AGPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>ggplot2, rstan, rlang, lifecycle</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, plotly, rmarkdown</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>UseLTO:</td>
<td>true</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-11-29 15:56:58 UTC; saulo</td>
</tr>
<tr>
<td>Author:</td>
<td>Saulo Chaves <a href="https://orcid.org/0000-0002-0694-1798"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Kaio Dias <a href="https://orcid.org/0000-0002-9171-1021"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cph],
  Matheus Krause <a href="https://orcid.org/0000-0003-2411-9287"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Saulo Chaves &lt;saulo.chaves@ufv.br&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-11-29 16:30:06 UTC</td>
</tr>
</table>
<hr>
<h2 id='bayes_met'>Bayesian model for multi-environment trials</h2><span id='topic+bayes_met'></span>

<h3>Description</h3>

<p>This function runs a Bayesian model for analyzing data from
Multi-environment trials using <code>rstan</code>, the <code>R</code> interface to <code>Stan</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bayes_met(
  data,
  gen,
  loc,
  repl,
  trait,
  reg = NULL,
  year = NULL,
  res.het = FALSE,
  iter = 2000,
  cores = 2,
  chains = 4,
  pars = NA,
  warmup = floor(iter/2),
  thin = 1,
  seed = sample.int(.Machine$integer.max, 1),
  init = "random",
  verbose = FALSE,
  algorithm = c("NUTS", "HMC", "Fixed_param"),
  control = NULL,
  include = TRUE,
  show_messages = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bayes_met_+3A_data">data</code></td>
<td>
<p>A data frame containing the observations.</p>
</td></tr>
<tr><td><code id="bayes_met_+3A_gen">gen</code>, <code id="bayes_met_+3A_loc">loc</code></td>
<td>
<p>A string. The name of the
column that corresponds to the evaluated genotype and location, respectively. If
the environment is a combination of other factors (for instance, location-year),
the name of the column that contains this information must be attributed to <code>loc</code>.</p>
</td></tr>
<tr><td><code id="bayes_met_+3A_repl">repl</code></td>
<td>
<p>A string, a vector, or <code>NULL</code>. If the trial is randomized in complete blocks,
<code>repl</code> will be a string representing the name of the column
that corresponds to the blocks. If the trial is randomized in incomplete blocks design,
<code>repl</code> will be a string vector containing the name of the column that corresponds to
the replicate and block effects on the first and second positions, respectively.
If the data do not have replicates, <code>repl</code> will be <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="bayes_met_+3A_trait">trait</code></td>
<td>
<p>A string. The name of the column that corresponds to the analysed variable.</p>
</td></tr>
<tr><td><code id="bayes_met_+3A_reg">reg</code></td>
<td>
<p>A string or NULL. If the data has information of regions,
<code>reg</code> will be a string with the name of the column that corresponds to the
region information. Otherwise, <code>reg = NULL</code> (default).</p>
</td></tr>
<tr><td><code id="bayes_met_+3A_year">year</code></td>
<td>
<p>A string or NULL. If the data set has information of time-related
environmental factors (years, seasons...), <code>year</code> will be a string with the
name of the column that corresponds to the time information. Otherwise, <code>year = NULL</code> (default).</p>
</td></tr>
<tr><td><code id="bayes_met_+3A_res.het">res.het</code></td>
<td>
<p>Logical, indicating if the model should consider heterogeneous
residual variances. Default is <code>FALSE</code>. If <code>TRUE</code>, the model will estimate one
residual variance per location.</p>
</td></tr>
<tr><td><code id="bayes_met_+3A_iter">iter</code></td>
<td>
<p>A positive integer specifying the number of iterations for each 
chain (including warmup). The default is 2000.</p>
</td></tr>
<tr><td><code id="bayes_met_+3A_cores">cores</code></td>
<td>
<p>Number of cores to use when executing the chains in parallel,
which defaults to 1 but we recommend setting the <code>mc.cores</code> option 
to be as many processors as the hardware and RAM allow (up to the 
number of chains).</p>
</td></tr>
<tr><td><code id="bayes_met_+3A_chains">chains</code></td>
<td>
<p>A positive integer specifying the number of Markov chains. 
The default is 4.</p>
</td></tr>
<tr><td><code id="bayes_met_+3A_pars">pars</code></td>
<td>
<p>A vector of character strings specifying parameters of interest. 
The default is <code>NA</code> indicating all parameters in the model. 
If <code>include = TRUE</code>, only samples for parameters named in <code>pars</code> 
are stored in the fitted results. Conversely, if <code>include = FALSE</code>, 
samples for all parameters <em>except</em> those named in <code>pars</code> are 
stored in the fitted results.</p>
</td></tr>
<tr><td><code id="bayes_met_+3A_warmup">warmup</code></td>
<td>
<p>A positive integer specifying the number of warmup (aka burnin)
iterations per chain. If step-size adaptation is on (which it is by default), 
this also controls the number of iterations for which adaptation is run (and
hence these warmup samples should not be used for inference). The number of 
warmup iterations should be smaller than <code>iter</code> and the default is
<code>iter/2</code>.</p>
</td></tr>
<tr><td><code id="bayes_met_+3A_thin">thin</code></td>
<td>
<p>A positive integer specifying the period for saving samples. 
The default is 1, which is usually the recommended value.</p>
</td></tr>
<tr><td><code id="bayes_met_+3A_seed">seed</code></td>
<td>
<p>The seed for random number generation. The default is generated 
from 1 to the maximum integer supported by <span class="rlang"><b>R</b></span> on the machine. Even if 
multiple chains are used, only one seed is needed, with other chains having 
seeds derived from that of the first chain to avoid dependent samples.
When a seed is specified by a number, <code>as.integer</code> will be applied to it. 
If <code>as.integer</code> produces <code>NA</code>, the seed is generated randomly. 
The seed can also be specified as a character string of digits, such as
<code>"12345"</code>, which is converted to integer.</p>
</td></tr>
<tr><td><code id="bayes_met_+3A_init">init</code></td>
<td>
<p>Initial values specification. See the detailed documentation for 
the init argument in <code><a href="rstan.html#topic+stan">stan</a></code>.</p>
</td></tr>
<tr><td><code id="bayes_met_+3A_verbose">verbose</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code>: flag indicating whether 
to print intermediate output from Stan on the console, which might
be helpful for model debugging.</p>
</td></tr>
<tr><td><code id="bayes_met_+3A_algorithm">algorithm</code></td>
<td>
<p>One of sampling algorithms that are implemented in Stan. 
Current options are <code>"NUTS"</code> (No-U-Turn sampler, Hoffman and Gelman 2011, Betancourt 2017), 
<code>"HMC"</code> (static HMC), or <code>"Fixed_param"</code>. The default and 
preferred algorithm is <code>"NUTS"</code>.</p>
</td></tr>
<tr><td><code id="bayes_met_+3A_control">control</code></td>
<td>
<p>A named <code>list</code> of parameters to control the sampler's
behavior. See the details in the documentation for the <code>control</code> argument
in <code><a href="rstan.html#topic+stan">stan</a></code>.</p>
</td></tr>
<tr><td><code id="bayes_met_+3A_include">include</code></td>
<td>
<p>Logical scalar defaulting to <code>TRUE</code> indicating
whether to include or exclude the parameters given by the 
<code>pars</code> argument. If <code>FALSE</code>, only entire multidimensional
parameters can be excluded, rather than particular elements of them.</p>
</td></tr>
<tr><td><code id="bayes_met_+3A_show_messages">show_messages</code></td>
<td>
<p>Either a logical scalar (defaulting to <code>TRUE</code>)
indicating whether to print the summary of Informational Messages to
the screen after a chain is finished or a character string naming a path
where the summary is stored. Setting to <code>FALSE</code> is not recommended
unless you are very sure that the model is correct up to numerical 
error.</p>
</td></tr>
<tr><td><code id="bayes_met_+3A_...">...</code></td>
<td>
<p>Additional arguments can be <code>chain_id</code>, <code>init_r</code>, 
<code>test_grad</code>, <code>append_samples</code>, <code>refresh</code>,
<code>enable_random_init</code>. See the documentation in <code><a href="rstan.html#topic+stan">stan</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>More details about the usage of <code>bayes_met</code> and other function of
the <code>ProbBreed</code> package can be found at <a href="https://saulo-chaves.github.io/ProbBreed_site/">https://saulo-chaves.github.io/ProbBreed_site/</a>.
Information on solutions to solve convergence or mixing issue can be found at
<a href="https://mc-stan.org/misc/warnings.html">https://mc-stan.org/misc/warnings.html</a>.
</p>


<h3>Value</h3>

<p>An object of S4 class <code>stanfit</code> representing
the fitted results. Slot <code>mode</code> for this object
indicates if the sampling is done or not.
</p>


<h3>Methods</h3>


<dl>
<dt><code>sampling</code></dt><dd><p><code>signature(object = "stanmodel")</code>
Call a sampler (NUTS, HMC, or Fixed_param depending on parameters) 
to draw samples from the model defined by S4 class <code>stanmodel</code> 
given the data, initial values, etc. 
</p>
</dd>
</dl>



<h3>See Also</h3>

<p><code><a href="rstan.html#topic+stanmodel-method-sampling">rstan::sampling()</a></code>, <code><a href="rstan.html#topic+stan">rstan::stan()</a></code>, <code><a href="rstan.html#topic+stanfit-class">rstan::stanfit()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
mod = bayes_met(data = maize,
                gen = "Hybrid",
                loc = "Location",
                repl = c("Rep", "Block"),
                year = NULL,
                reg = 'Region',
                res.het = FALSE,
                trait = 'GY',
                iter = 6000, cores = 4, chains = 4)
                
</code></pre>

<hr>
<h2 id='extr_outs'>Extracting outputs from <code><a href="#topic+bayes_met">bayes_met()</a></code> objects</h2><span id='topic+extr_outs'></span>

<h3>Description</h3>

<p>This function extracts outputs of the Bayesian model fitted
using <code><a href="#topic+bayes_met">bayes_met()</a></code>, and provides some diagnostics about the model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extr_outs(
  data,
  trait,
  model,
  probs = c(0.025, 0.975),
  check.stan.diag = TRUE,
  verbose = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extr_outs_+3A_data">data</code></td>
<td>
<p>A data frame containing the observations</p>
</td></tr>
<tr><td><code id="extr_outs_+3A_trait">trait</code></td>
<td>
<p>A character representing the name of the column that
corresponds to the analysed trait</p>
</td></tr>
<tr><td><code id="extr_outs_+3A_model">model</code></td>
<td>
<p>An object containing the Bayesian model fitted using <code>rstan</code></p>
</td></tr>
<tr><td><code id="extr_outs_+3A_probs">probs</code></td>
<td>
<p>A vector with two elements representing the probabilities
(in decimal scale) that will be considered for computing the quantiles.</p>
</td></tr>
<tr><td><code id="extr_outs_+3A_check.stan.diag">check.stan.diag</code></td>
<td>
<p>A logical value indicating whether the function should
extract some diagnostic using native <code>rstan</code> functions.</p>
</td></tr>
<tr><td><code id="extr_outs_+3A_verbose">verbose</code></td>
<td>
<p>A logical value. If <code>TRUE</code>, the function will indicate the
completed steps. Defaults to <code>FALSE</code></p>
</td></tr>
<tr><td><code id="extr_outs_+3A_...">...</code></td>
<td>
<p>Passed to <code><a href="rstan.html#topic+stan_plot_diagnostics">rstan::stan_diag()</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>More details about the usage of <code>extr_outs</code>, as well as the other function of
the <code>ProbBreed</code> package can be found at <a href="https://saulo-chaves.github.io/ProbBreed_site/">https://saulo-chaves.github.io/ProbBreed_site/</a>.
</p>


<h3>Value</h3>

<p>The function returns a list with:
</p>

<ul>
<li> <p><code>post</code> : a list with the posterior of the effects, and the data
generated by the model
</p>
</li>
<li> <p><code>map</code> : a list with the maximum posterior values of each effect
</p>
</li>
<li> <p><code>ppcheck</code> : a matrix containing the p-values of maximum, minimum,
median, mean and standard deviation; effective number of parameters, WAIC2
value, Rhat and effective sample size.
</p>
</li>
<li> <p><code>plots</code> : a list with three types of ggplots: histograms, trace plots and density
plots. These will be available for all effects declared at the <code>effects</code> argument.
</p>
</li>
<li> <p><code>stan_plots</code>: If <code>check.stan.diag = TRUE</code>, a list with plots generated by <code><a href="rstan.html#topic+stan_plot_diagnostics">rstan::stan_diag()</a></code>
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="rstan.html#topic+stan_plot_diagnostics">rstan::stan_diag()</a></code>, <code><a href="ggplot2.html#topic+ggplot">ggplot2::ggplot()</a></code>, <code><a href="rstan.html#topic+check_hmc_diagnostics">rstan::check_hmc_diagnostics()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
mod = bayes_met(data = maize,
                gen = "Hybrid",
                loc = "Location",
                repl = c("Rep", "Block"),
                year = NULL,
                reg = 'Region',
                res.het = FALSE,
                trait = 'GY',
                iter = 6000, cores = 4, chains = 4)

outs = extr_outs(data = maize, trait = "GY", model = mod,
                 probs = c(0.05, 0.95),
                 check.stan.diag = TRUE,
                 verbose = TRUE)
                 
</code></pre>

<hr>
<h2 id='maize'>Maize real data set</h2><span id='topic+maize'></span>

<h3>Description</h3>

<p>This dataset belongs to value of cultivation and use maize trials of
Embrapa Maize and Sorghum, and was used by Dias et al. (2022).
It contains the grain yield of 32 single-cross hybrids and four commercial checks
(36 genotypes in total) evaluated in 16 locations across
five regions or mega-environments. These trials were laid out in incomplete blocks
design, using a block size of 6 and two replications per trial.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>maize
</code></pre>


<h3>Format</h3>



<h4><code>maize</code></h4>

<p>A data frame with 823 rows and 6 columns:
</p>

<dl>
<dt>Location</dt><dd><p>16 locations</p>
</dd>
<dt>Region</dt><dd><p>5 regions</p>
</dd>
<dt>Rep</dt><dd><p>2 replicates</p>
</dd>
<dt>Block</dt><dd><p>6 blocks</p>
</dd>
<dt>Hybrid</dt><dd><p>36 genotypes</p>
</dd>
<dt>GY</dt><dd><p>Grain yield (phenotypes)</p>
</dd>
</dl>




<h3>Source</h3>


<p>Dias, K. O. G, Santos J. P. R., Krause, M. D., Piepho H. -P., GuimarÃ£es, L. J. M.,
Pastina, M. M., and Garcia, A. A. F. (2022). Leveraging probability concepts
for cultivar recommendation in multi-environment trials. <em>Theoretical and
Applied Genetics</em>, 133(2):443-455. <a href="https://doi.org/10.1007/s00122-022-04041-y">doi:10.1007/s00122-022-04041-y</a>

</p>

<hr>
<h2 id='prob_sup'>Probabilities of superior performance and stability</h2><span id='topic+prob_sup'></span>

<h3>Description</h3>

<p>This function estimates the probabilities of superior performance and stability
across environments (<code>marginal</code> output). It also computes the probabilities
of superior performance within environments (<code>conditional</code> output).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prob_sup(
  data,
  trait,
  gen,
  loc,
  reg = NULL,
  year = NULL,
  mod.output,
  int,
  increase = TRUE,
  save.df = FALSE,
  interactive = FALSE,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="prob_sup_+3A_data">data</code></td>
<td>
<p>A data frame containing the phenotypic data</p>
</td></tr>
<tr><td><code id="prob_sup_+3A_trait">trait</code>, <code id="prob_sup_+3A_gen">gen</code>, <code id="prob_sup_+3A_loc">loc</code></td>
<td>
<p>A string. The name of the columns that correspond to
the trait, genotype and location information, respectively. If
the environment is a combination of other factors (for instance, location-year),
the name of the column that contains this information must be attributed to <code>loc</code>.</p>
</td></tr>
<tr><td><code id="prob_sup_+3A_reg">reg</code></td>
<td>
<p>A string or NULL. If the dataset has information about regions,
<code>reg</code> will be a string with the name of the column that corresponds to the
region information. Otherwise, <code>reg = NULL</code> (default).</p>
</td></tr>
<tr><td><code id="prob_sup_+3A_year">year</code></td>
<td>
<p>A string or NULL. If the data set has information about time-related
environmental factors (years, seasons...), <code>year</code> will be a string with the
name of the column that corresponds to the time information. Otherwise, <code>year = NULL</code> (default).</p>
</td></tr>
<tr><td><code id="prob_sup_+3A_mod.output">mod.output</code></td>
<td>
<p>An object from the <code><a href="#topic+extr_outs">extr_outs()</a></code> function</p>
</td></tr>
<tr><td><code id="prob_sup_+3A_int">int</code></td>
<td>
<p>A number representing the selection intensity
(between 0 and 1)</p>
</td></tr>
<tr><td><code id="prob_sup_+3A_increase">increase</code></td>
<td>
<p>Logical. Indicates the direction of the selection.
<code>TRUE</code> (default) for increasing the trait value, <code>FALSE</code> otherwise.</p>
</td></tr>
<tr><td><code id="prob_sup_+3A_save.df">save.df</code></td>
<td>
<p>Logical. Should the data frames be saved in the work directory?
<code>TRUE</code> for saving, <code>FALSE</code> (default) otherwise.</p>
</td></tr>
<tr><td><code id="prob_sup_+3A_interactive">interactive</code></td>
<td>
<p>Logical. Should ggplots be converted into interactive plots?
If <code>TRUE</code>, the function loads the <code>plotly</code> package and uses the <code><a href="plotly.html#topic+ggplotly">plotly::ggplotly()</a></code>
command.</p>
</td></tr>
<tr><td><code id="prob_sup_+3A_verbose">verbose</code></td>
<td>
<p>A logical value. If <code>TRUE</code>, the function will indicate the
completed steps. Defaults to <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Probabilities provide the risk of recommending a selection candidate for a target
population of environments or for a specific environment. The function <code>prob_sup()</code>
computes the probabilities of superior performance and the probabilities of superior stability:
</p>
<ul>
<li><p> Probability of superior performance</p>
</li></ul>

<p>Let <code class="reqn">\Omega</code> represent the subset of selected genotypes based on their
performance across environments. A given genotype <code class="reqn">j</code> will belong to <code class="reqn">\Omega</code>
if its genotypic marginal value (<code class="reqn">\hat{g}_j</code>) is high or low enough compared to
its peers. <code>prob_sup()</code> leverages the Monte Carlo discretized sampling
from the posterior distribution to emulate the occurrence of <code class="reqn">S</code> trials. Then,
the probability of the <code class="reqn">j^{th}</code> genotype belonging to <code class="reqn">\Omega</code> is the
ratio of success (<code class="reqn">\hat{g}_j \in \Omega</code>) events and the total number of sampled events,
as follows:
</p>
<p style="text-align: center;"><code class="reqn">Pr(\hat{g}_j \in \Omega \vert y) = \frac{1}{S}\sum_{s=1}^S{I(\hat{g}_j^{(s)} \in \Omega \vert y)}</code>
</p>

<p>where <code class="reqn">S</code> is the total number of samples (<code class="reqn">s = 1, 2, ..., S</code>),
and <code class="reqn">I(g_j^{(s)} \in \Omega \vert y)</code> is an indicator variable that can assume
two values: (1) if <code class="reqn">\hat{g}_j^{(s)} \in \Omega</code> in the <code class="reqn">s^{th}</code> sample,
and (0) otherwise. <code class="reqn">S</code> is conditioned to the number of iterations and chains
previously set at <code><a href="#topic+bayes_met">bayes_met()</a></code>.
</p>
<p>Similarly, the conditional probability of superior performance can be applied to
individual environments. Let <code class="reqn">\Omega_k</code> represent the subset of superior
genotypes in the <code class="reqn">k^{th}</code> environment, so that the probability of the
<code class="reqn">j^{th} \in \Omega_k</code> can calculated as follows:
</p>
<p style="text-align: center;"><code class="reqn">Pr(\hat{g}_{jk} \in \Omega_k \vert y) = \frac{1}{S} \sum_{s=1}^S I(\hat{g}_{jk}^{(s)} \in \Omega_k \vert y)</code>
</p>

<p>where <code class="reqn">I(\hat{g}_{jk}^{(s)} \in \Omega_k \vert y)</code> is an indicator variable
mapping success (1) if <code class="reqn">\hat{g}_{jk}^{(s)}</code> exists in <code class="reqn">\Omega_k</code>, and
failure (0) otherwise, and <code class="reqn">\hat{g}_{jk}^{(s)} = \hat{g}_j^{(s)} + \widehat{ge}_{jk}^{(s)}</code>.
Note that when computing conditional probabilities (i.e., conditional to the
<code class="reqn">k^{th}</code> environment or mega-environment), we are accounting for
the interaction of the <code class="reqn">j^{th}</code> genotype with the <code class="reqn">k^{th}</code>
environment.
</p>
<p>The pairwise probabilities of superior performance can also be calculated across
or within environments. This metric assesses the probability of the <code class="reqn">j^{th}</code>
genotype being superior to another experimental genotype or a commercial check.
The calculations are as follows, across and within environments, respectively:
</p>
<p style="text-align: center;"><code class="reqn">Pr(\hat{g}_{j} &gt; \hat{g}_{j^\prime} \vert y) = \frac{1}{S} \sum_{s=1}^S I(\hat{g}_{j}^{(s)} &gt; \hat{g}_{j^\prime}^{(s)} \vert y)</code>
</p>

<p>or
</p>
<p style="text-align: center;"><code class="reqn">Pr(\hat{g}_{jk} &gt; \hat{g}_{j^\prime k} \vert y) = \frac{1}{S} \sum_{s=1}^S I(\hat{g}_{jk}^{(s)} &gt; \hat{g}_{j^\prime k}^{(s)} \vert y)</code>
</p>

<p>These equations are set for when the selection direction is positive. If
<code>increase = FALSE</code>, <code class="reqn">&gt;</code> is simply switched by <code class="reqn">&lt;</code>.
</p>
<ul>
<li><p> Probability of superior stability</p>
</li></ul>

<p>Probabilities of superior performance highlight experimental genotypes with
high agronomic stability. For ecological stability (invariance), the probability
of superior stability is the more adequate. Making a direct analogy with the
method of Shukla (1972), a stable genotype is the one that has a low variance
of the GEI (genotype-by-environment interaction) effects <code class="reqn">[var(\widehat{ge})]</code>.
Using the same probability principles previously described, the probability
of superior stability is given as follows:
</p>
<p style="text-align: center;"><code class="reqn">Pr[var(\widehat{ge}_{jk}) \in \Omega \vert y] = \frac{1}{S} \sum_{s=1}^S I[var(\widehat{ge}_{jk}^{(s)}) \in \Omega \vert y]</code>
</p>

<p>where <code class="reqn">I[var(\widehat{ge}_{jk}^{(s)}) \in \Omega \vert y]</code> indicates if
<code class="reqn">var(\widehat{ge}_{jk}^{(s)})</code> exists in <code class="reqn">\Omega</code> (1) or not (0).
Pairwise probabilities of superior stability are also possible in this context:
</p>
<p style="text-align: center;"><code class="reqn">Pr[var(\widehat{ge}_{jk}) &lt; var(\widehat{ge}_{j^\prime k}) \vert y] = \frac{1}{S} \sum_{s=1}^S I[var(\widehat{ge}_{jk})^{(s)} &lt; var(\widehat{ge}_{j^\prime k})^{(s)} \vert y]</code>
</p>

<p>Note that <code class="reqn">j</code> will be superior to <code class="reqn">j^\prime</code> if it has a <strong>lower</strong>
variance of the genotype-by-environment interaction effect. This is true regardless
if <code>increase</code> is set to <code>TRUE</code> or <code>FALSE</code>.
</p>
<p>The joint probability independent events is the product of the individual probabilities.
The estimated genotypic main effects and the variances of GEI effects are independent
by design, thus the joint probability of superior performance and stability as follows:
</p>
<p style="text-align: center;"><code class="reqn">Pr[\hat{g}_j \in \Omega \cap var(\widehat{ge}_{jk}) \in \Omega] = Pr(\hat{g}_j \in \Omega) \times Pr[var(\widehat{ge}_{jk}) \in \Omega]</code>
</p>

<p>The estimation of these probabilities are strictly related to some key questions that
constantly arises in plant breeding:
</p>

<ul>
<li> <p><strong>What is the risk of recommending a selection candidate for a target population of environments?</strong>
</p>
</li>
<li> <p><strong>What is the probability of a given selection candidate having good performance if
recommended to a target population of environments? And for a specific environment?</strong>
</p>
</li>
<li> <p><strong>What is the probability of a given selection candidate having better performance
than a cultivar check in the target population of environments? And in specific environments?</strong>
</p>
</li>
<li> <p><strong>How probable is it that a given selection candidate performs similarly across environments?</strong>
</p>
</li>
<li> <p><strong>What are the chances that a given selection candidate is more stable
than a cultivar check in the target population of environments?</strong>
</p>
</li>
<li> <p><strong>What is the probability that a given selection candidate having a
superior and invariable performance across environments?</strong>
</p>
</li></ul>

<p>More details about the usage of <code>prob_sup</code>, as well as the other function of
the <code>ProbBreed</code> package can be found at <a href="https://saulo-chaves.github.io/ProbBreed_site/">https://saulo-chaves.github.io/ProbBreed_site/</a>.
</p>


<h3>Value</h3>

<p>The function returns two lists, one with the <code>marginal</code> probabilities, and
another with the <code>conditional</code> probabilities.
</p>
<p>The <code>marginal</code> list has:
</p>

<ul>
<li> <p><code>df</code> : A list of data frames containing the calculated probabilities:
</p>

<ul>
<li> <p><code>perfo</code>: the probabilities of superior performance.
</p>
</li>
<li> <p><code>pair_perfo</code>: the pairwise probabilities of superior performance.
</p>
</li>
<li> <p><code>stabi</code>: the probabilities of superior stability. Can be <code>stabi_gl</code>,
<code>stabi_gm</code> (when <code>reg</code> is not <code>NULL</code>) or <code>stabi_gt</code> (when <code>year</code> is not <code>NULL</code>).
</p>
</li>
<li> <p><code>pair_stabi</code>: the pairwise probabilities of superior stability.
Can be <code>pair_stabi_gl</code>, <code>pair_stabi_gm</code> (when <code>reg</code> is not <code>NULL</code>) or
<code>pair_stabi_gt</code> (when <code>year</code> is not <code>NULL</code>).
</p>
</li>
<li> <p><code>joint_prob</code>: the joint probabilities of superior performance and stability.
</p>
</li></ul>

</li>
<li> <p><code>plot</code> : A list of ggplots illustrating the outputs:
</p>

<ul>
<li> <p><code>g_hpd</code>: a caterpillar plot representing the marginal genotypic value of
each genotype, and their respective highest posterior density interval (95% represented by the
thick line, and 97.5% represented by the thin line).
</p>
</li>
<li> <p><code>perfo</code>: a bar plot illustrating the probabilities of superior performance
</p>
</li>
<li> <p><code>pair_perfo</code>: a heatmap representing the pairwise probability of superior
performance (the probability of genotypes at the <em>x</em>-axis being superior
to those on the <em>y</em>-axis).
</p>
</li>
<li> <p><code>stabi</code>: a bar plot with the probabilities of superior stability.
Different plots are generated for <code>stabi_gl</code>, <code>stabi_gm</code> and <code>stabi_gt</code> if <code>reg</code>
or/and <code>year</code> are not <code>NULL</code>.
</p>
</li>
<li> <p><code>pair_stabi</code>: a heatmap with the pairwise probabilities of superior stability.
Different plots are generated for <code>stabi_gl</code>, <code>stabi_gm</code> and <code>stabi_gt</code> if <code>reg</code>
or/and <code>year</code> are not <code>NULL</code>. This plot represents
the probability of genotypes at the <em>x</em>-axis being superior
to those on <em>y</em>-axis.
</p>
</li>
<li> <p><code>joint_prob</code>: a plot with the probabilities of superior performance,
probabilities of superior stability and the joint probabilities of superior
performance and stability.
</p>
</li></ul>

</li></ul>

<p>The <code>conditional</code> list has:
</p>

<ul>
<li> <p><code>df</code> : A list with:
</p>

<ul>
<li> <p><code>prob</code>: data frames containing the probabilities of superior performance
within environments. Can be <code>prob_loc</code>, <code>prob_reg</code> (if <code>reg</code> is not <code>NULL</code>), and
<code>prob_year</code> (if <code>year</code> is not <code>NULL</code>).
</p>
</li>
<li> <p><code>pwprob</code>: lists with the pairwise probabilities of superior performance
within environments. Can be <code>pwprob_loc</code>, <code>pwprob_reg</code> (if <code>reg</code> is not <code>NULL</code>), and
<code>pwprob_year</code> (if <code>year</code> is not <code>NULL</code>).
</p>
</li></ul>

</li>
<li> <p><code>plot</code> : A list with:
</p>

<ul>
<li> <p><code>prob</code>: heatmaps with the probabilities of superior performance within
environments. Can be <code>prob_loc</code>, <code>prob_reg</code> (if <code>reg</code> is not <code>NULL</code>), and
<code>prob_year</code> (if <code>year</code> is not <code>NULL</code>).
</p>
</li>
<li> <p><code>pwprob</code>: a list of heatmaps representing the pairwise probability of superior
performance within environments. Can be <code>pwprob_loc</code>, <code>pwprob_reg</code> (if <code>reg</code> is not <code>NULL</code>), and
<code>pwprob_year</code> (if <code>year</code> is not <code>NULL</code>). The interpretation is the same as in the
<code>pair_perfo</code> in the <code>marginal</code> list: the probability of genotypes at the <em>x</em>-axis being superior
to those on <em>y</em>-axis.
</p>
</li></ul>

</li></ul>



<h3>References</h3>

<p>Dias, K. O. G, Santos J. P. R., Krause, M. D., Piepho H. -P., GuimarÃ£es, L. J. M.,
Pastina, M. M., and Garcia, A. A. F. (2022). Leveraging probability concepts
for cultivar recommendation in multi-environment trials. <em>Theoretical and
Applied Genetics</em>, 133(2):443-455. <a href="https://doi.org/10.1007/s00122-022-04041-y">doi:10.1007/s00122-022-04041-y</a>
</p>
<p>Shukla, G. K. (1972) Some statistical aspects of partioning genotype environmental
componentes of variability. <em>Heredity</em>, 29:237-245. <a href="https://doi.org/10.1038/hdy.1972.87">doi:10.1038/hdy.1972.87</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
mod = bayes_met(data = maize,
                gen = "Hybrid",
                loc = "Location",
                repl = c("Rep", "Block"),
                year = NULL,
                reg = 'Region',
                res.het = FALSE,
                trait = 'GY',
                iter = 6000, cores = 4, chains = 4)

outs = extr_outs(data = maize, trait = "GY", model = mod,
                 probs = c(0.05, 0.95),
                 check.stan.diag = TRUE,
                 verbose = TRUE)

results = prob_sup(data = maize,
                   trait = "GY",
                   gen = "Hybrid",
                   loc = "Location",
                   reg = 'Region',
                   year = NULL,
                   mod.output = outs,
                   int = .2,
                   increase = TRUE,
                   save.df = FALSE,
                   interactive = FALSE,
                   verbose = FALSE)


</code></pre>

<hr>
<h2 id='ProbBreed-package'>ProbBreed: Probability Theory for Selecting Candidates in Plant Breeding</h2><span id='topic+ProbBreed'></span><span id='topic+ProbBreed-package'></span>

<h3>Description</h3>

<p>Use probability theory under the Bayesian framework for calculating the risk of selecting candidates in a multi-environment context [Dias et al. (2022) <a href="https://doi.org/10.1007/s00122-022-04041-y">doi:10.1007/s00122-022-04041-y</a>]. Contained are functions used to fit a Bayesian multi-environment model (based on the available presets), extract posterior values and maximum posterior values, compute the variance components, check the modelâ€™s convergence, and calculate the probabilities. For both across and within-environments scopes, the package computes the probability of superior performance and the pairwise probability of superior performance. Furthermore, the probability of superior stability and the pairwise probability of superior stability across environments is estimated. A joint probability of superior performance and stability is also provided.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Saulo Chaves <a href="mailto:saulo.chaves@ufv.br">saulo.chaves@ufv.br</a> (<a href="https://orcid.org/0000-0002-0694-1798">ORCID</a>)
</p>
<p>Authors:
</p>

<ul>
<li><p> Kaio Dias <a href="mailto:kaio.o.dias@ufv.br">kaio.o.dias@ufv.br</a> (<a href="https://orcid.org/0000-0002-9171-1021">ORCID</a>) [copyright holder]
</p>
</li>
<li><p> Matheus Krause <a href="mailto:mdkrause@iastate.edu">mdkrause@iastate.edu</a> (<a href="https://orcid.org/0000-0003-2411-9287">ORCID</a>)
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/saulo-chaves/ProbBreed">https://github.com/saulo-chaves/ProbBreed</a>
</p>
</li>
<li> <p><a href="https://saulo-chaves.github.io/ProbBreed_site/">https://saulo-chaves.github.io/ProbBreed_site/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/saulo-chaves/ProbBreed/issues">https://github.com/saulo-chaves/ProbBreed/issues</a>
</p>
</li></ul>


<hr>
<h2 id='soy'>Soybean real data set</h2><span id='topic+soy'></span>

<h3>Description</h3>

<p>This dataset belongs to the USDA Northern Region Uniform Soybean Tests,
and it is a subset of the data used by Krause et al. (2023). It contains the
empirical best linear unbiased estimates of genotypic means of the seed yield
from 39 experimental genotypes evaluated in 14 locations across three
regions or mega-environments. The original data, available at the package
<code>SoyURT</code>, has 4,257 experimental genotypes evaluated at 63 locations and
31 years resulting in 591 location-year combinations (environments) with
39,006 yield values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>soy
</code></pre>


<h3>Format</h3>



<h4><code>soy</code></h4>

<p>A data frame with 823 rows and 6 columns:
</p>

<dl>
<dt>Loc</dt><dd><p>14 locations</p>
</dd>
<dt>Reg</dt><dd><p>Regions containing the evaluated environments: 1, 2 and 3</p>
</dd>
<dt>Gen</dt><dd><p>39 experimental genotypes</p>
</dd>
<dt>Y</dt><dd><p>435 EBLUEs (phenotypes)</p>
</dd>
</dl>




<h3>Source</h3>


<p>Krause MD, Dias KOG, Singh AK, Beavis WD. 2023. Using soybean
historical field trial data to study genotype by environment
variation and identify mega-environments with the integration
of genetic and non-genetic factors. bioRxiv : the preprint server for biology.
doi: https://doi.org/10.1101/2022.04.11.487885

</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
