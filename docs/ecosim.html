<!DOCTYPE html><html><head><title>Help for package ecosim</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ecosim}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#calcres'>
<p>Performs a Simulation of the Model Passed as the Argument</p></a></li>
<li><a href='#calcres-methods'><p><code>calcres</code></p></a></li>
<li><a href='#calcsens'>
<p>Performs a Sensitivity Analysis of the Model Passed as the Argument</p></a></li>
<li><a href='#calcsens-methods'><p><code>calcsens</code></p></a></li>
<li><a href='#ecosim-package'>
<p>Toolbox for Aquatic Ecosystem Modeling</p></a></li>
<li><a href='#link-class'><p>Class <code>"link"</code></p></a></li>
<li><a href='#plotres'>
<p>Plot Simulation Results</p></a></li>
<li><a href='#process-class'><p>Class <code>"process"</code></p></a></li>
<li><a href='#randnorm'>
<p>Sample from a Univariate Normal or Lognormal Distribution</p></a></li>
<li><a href='#randou'>
<p>Sample from an Ornstein-Uhlenbeck Process</p></a></li>
<li><a href='#reactor-class'><p>Class <code>"reactor"</code></p></a></li>
<li><a href='#system-class'><p>Class <code>"system"</code></p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Toolbox for Aquatic Ecosystem Modeling</td>
</tr>
<tr>
<td>Version:</td>
<td>1.3-4</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-08-28</td>
</tr>
<tr>
<td>Author:</td>
<td>Peter Reichert</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Peter Reichert &lt;peter.reichert@emeriti.eawag.ch&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Classes and methods for implementing aquatic ecosystem models,
  for running these models, and for visualizing their results.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Depends:</td>
<td>methods, deSolve, stoichcalc</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-08-28 09:22:43 UTC; peter</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-08-28 10:30:03 UTC</td>
</tr>
</table>
<hr>
<h2 id='calcres'>
Performs a Simulation of the Model Passed as the Argument
</h2><span id='topic+calcres'></span>

<h3>Description</h3>

<p>Calculates a dynamic solution of the model defined by the argument and returns a numeric matrix with the volumes and substance and organism 
concentrations of all reactors at all points in time. <br /><br />
This function integrates the system of ordinary differential equations numerically using the function <code><a href="deSolve.html#topic+ode">ode</a></code> of the package <code><a href="deSolve.html#topic+deSolve">deSolve</a></code>.
The results can be visualized with arbitrary R functions or a summary of all results can be produced with the function <br /><br />
<code><a href="#topic+plotres">plotres</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calcres(system,method="lsoda",...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calcres_+3A_system">system</code></td>
<td>

<p>Object of type <code><a href="#topic+system-class">system-class</a></code> that defines the model.
</p>
</td></tr>
<tr><td><code id="calcres_+3A_method">method</code></td>
<td>

<p>Integration algorithm to be used for numerically solving the system of ordinary differential equations.
Available algorithms: 
&quot;lsoda&quot;, 
&quot;lsode&quot;, 
&quot;lsodes&quot;, 
&quot;lsodar&quot;, 
&quot;vode&quot;, 
&quot;daspk&quot;,
&quot;euler&quot;, 
&quot;rk4&quot;, 
&quot;ode23&quot;, 
&quot;ode45&quot;, 
&quot;radau&quot;, 
&quot;bdf&quot;, 
&quot;bdf_d&quot;, 
&quot;adams&quot;, 
&quot;impAdams&quot;, 
&quot;impAdams_d&quot;.
See function <code><a href="deSolve.html#topic+ode">ode</a></code> of the package <code><a href="deSolve.html#topic+deSolve">deSolve</a></code> for more details on the integration algorithms.
</p>
</td></tr>
<tr><td><code id="calcres_+3A_...">...</code></td>
<td>

<p>Further arguments are passed to the solver.
See function <code><a href="deSolve.html#topic+ode">ode</a></code> of the package <code><a href="deSolve.html#topic+deSolve">deSolve</a></code> for more details on the integration algorithms and their control parameters.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The function returns a numeric matrix with the volumes and concentrations of substances and organisms of all reactors (columns) for all points in time (rows)</p>


<h3>Author(s)</h3>

<p>Peter Reichert &lt;peter.reichert@emeriti.eawag.ch&gt;
</p>


<h3>References</h3>

<p>Omlin, M., Reichert, P. and Forster, R., Biogeochemical model of lake Zurich: Model equations and results, Ecological Modelling 141(1-3), 77-103, 2001. <br /><br />
Reichert, P., Borchardt, D., Henze, M., Rauch, W., Shanahan, P., Somlyody, L. and Vanrolleghem, P., River Water Quality Model no. 1 (RWQM1): II. Biochemical process equations, Water Sci. Tech. 43(5), 11-30, 2001. <br /><br />
Reichert, P. and Schuwirth, N., A generic framework for deriving process stoichiometry in environmental models, Environmental Modelling &amp; Software, 25, 1241-1251, 2010. <br /><br />
Soetaert, K., Petzoldt, T., and Woodrow Setzer, R. Solving differential equations in R: Package deSolve. Journal of Statistical Software, 33(9), 2010. <br /><br />
Soetaert, K., Cash, J., and Mazzia, F. Solving Differential Equations in R. Springer, Heidelberg, Germany. 2012.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+process-class">process-class</a></code>,
<code><a href="#topic+reactor-class">reactor-class</a></code>,
<code><a href="#topic+link-class">link-class</a></code>,
<code><a href="#topic+system-class">system-class</a></code>,
<code><a href="#topic+plotres">plotres</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Definition of parameters:
# =========================

param    &lt;- list(k.gro.ALG   = 1,        # 1/d
                 k.gro.ZOO   = 0.8,      # m3/gDM/d
                 k.death.ALG = 0.4,      # 1/d
                 k.death.ZOO = 0.08,     # 1/d
                 K.HPO4      = 0.002,    # gP/m3
                 Y.ZOO       = 0.2,      # gDM/gDM
                 alpha.P.ALG = 0.002,    # gP/gDM
                 A           = 8.5e+006, # m2
                 h.epi       = 4,        # m
                 Q.in        = 4,        # m3/s
                 C.ALG.ini   = 0.05,     # gDM/m3
                 C.ZOO.ini   = 0.1,      # gDM/m3
                 C.HPO4.ini  = 0.02,     # gP/m3
                 C.HPO4.in   = 0.04)     # gP/m3             

# Definition of transformation processes:
# =======================================

# Growth of algae:
# ----------------

gro.ALG   &lt;- new(Class  = "process",
                 name   = "Growth of algae",
                 rate   = expression(k.gro.ALG
                                     *C.HPO4/(K.HPO4+C.HPO4)
                                     *C.ALG),
                 stoich = list(C.ALG  = expression(1),              # gDM/gDM
                               C.HPO4 = expression(-alpha.P.ALG)))  # gP/gDM

# Death of algae:
# ---------------

death.ALG &lt;- new(Class = "process",
                 name   = "Death of algae",
                 rate   = expression(k.death.ALG*C.ALG),
                 stoich = list(C.ALG  = expression(-1)))            # gDM/gDM

# Growth of zooplankton:
# ----------------------

gro.ZOO   &lt;- new(Class  = "process",
                 name   = "Growth of zooplankton",
                 rate   = expression(k.gro.ZOO
                                     *C.ALG
                                     *C.ZOO),
                 stoich = list(C.ZOO  = expression(1),              # gDM/gDM
                               C.ALG  = expression(-1/Y.ZOO)))      # gP/gDM

# Death of zooplankton:
# ---------------------

death.ZOO &lt;- new(Class  = "process",
                 name   = "Death of zooplankton",
                 rate   = expression(k.death.ZOO*C.ZOO),
                 stoich = list(C.ZOO  = expression(-1)))            # gDM/gDM

# Definition of reactor:
# ======================

# Epilimnion:
# -----------

epilimnion &lt;- 
   new(Class            = "reactor",
       name             = "Epilimnion",
       volume.ini       = expression(A*h.epi),
       conc.pervol.ini  = list(C.HPO4 = expression(C.HPO4.ini),     # gP/m3
                               C.ALG  = expression(C.ALG.ini),      # gDM/m3
                               C.ZOO  = expression(C.ZOO.ini)),     # gDM/m3
       inflow           = expression(Q.in*86400),                   # m3/d
       inflow.conc      = list(C.HPO4 = expression(C.HPO4.in),
                               C.ALG  = 0,
                               C.ZOO  = 0),
       outflow          = expression(Q.in*86400),
       processes        = list(gro.ALG,death.ALG,gro.ZOO,death.ZOO))

# Definition of system:
# =====================

# Lake system:
# ------------

system &lt;- new(Class    = "system",
              name     = "Lake",
              reactors = list(epilimnion),
              param    = param,
              t.out    = seq(0,365,by=1))

# Perform simulation:
# ===================

res &lt;- calcres(system)

# Plot results:
# =============
                 
plotres(res)              # plot to screen

# plotres(res,file="ecosim_example_plot1.pdf")  # plot to pdf file

plotres(res, colnames=c("C.ALG", "C.ZOO"))  # plot selected variables

plotres(res, colnames=list("C.HPO4",c("C.ALG", "C.ZOO")))

plotres(res[1:100,], colnames=list("C.HPO4",c("C.ALG", "C.ZOO"))) # plot selected time steps

# plotres(res      = res,    # plot to pdf file
#         colnames = list("C.HPO4",c("C.ALG","C.ZOO")),
#         file     = "ecosim_example_plot2.pdf",
#         width    = 8,
#         height   = 4)
</code></pre>

<hr>
<h2 id='calcres-methods'><code>calcres</code></h2><span id='topic+calcres-methods'></span><span id='topic+calcres+2CANY-method'></span><span id='topic+calcres+2Csystem-method'></span>

<h3>Description</h3>

<p><code><a href="#topic+calcres">calcres</a></code> calculates a dynamic solution of the model defined by the argument.
</p>


<h3>Methods</h3>


<dl>
<dt><code>signature(system = "ANY")</code></dt><dd>
</dd>
<dt><code>signature(system = "system")</code></dt><dd>
</dd>
</dl>

<hr>
<h2 id='calcsens'>
Performs a Sensitivity Analysis of the Model Passed as the Argument
</h2><span id='topic+calcsens'></span>

<h3>Description</h3>

<p>Calculates dynamic solutions of the model defined by the argument with modified parameter values.
Each of the specified parameters is multiplied in sequence by the provided scaling factors to produce
complete model output matrices for all individual parameter modifications. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calcsens(system, param.sens, scaling.factors=c(1,0.5,2))</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calcsens_+3A_system">system</code></td>
<td>

<p>Object of type <code><a href="#topic+system-class">system-class</a></code> that defines the model.
</p>
</td></tr>
<tr><td><code id="calcsens_+3A_param.sens">param.sens</code></td>
<td>

<p>Vector of parameter names for which sensitivity analysis should be performed.
The names must be a subset of the names used in the parameter entry of the argument <code>system</code>.
</p>
</td></tr>
<tr><td><code id="calcsens_+3A_scaling.factors">scaling.factors</code></td>
<td>

<p>Numerical vector of scaling factors with which the parameters should be multiplied.
It is recommended that the scaling factors include unity as the first entry to get the basic simulation results.
The default is to use the scaling factors 1, 0.5 and 2.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The function returns a list of lists of result matrices of the method <code><a href="#topic+calcres-methods">calcres-methods</a></code>.
The outer list is over the parameters, the inner list over the different values of each parameter.
Note that the function <code><a href="#topic+plotres">plotres</a></code> can be used to plot the results.
</p>


<h3>Author(s)</h3>

<p>Peter Reichert &lt;peter.reichert@emeriti.eawag.ch&gt;
</p>


<h3>References</h3>

<p>Omlin, M., Reichert, P. and Forster, R., Biogeochemical model of lake Zurich: Model equations and results, Ecological Modelling 141(1-3), 77-103, 2001. <br /><br />
Reichert, P., Borchardt, D., Henze, M., Rauch, W., Shanahan, P., Somlyody, L. and Vanrolleghem, P., River Water Quality Model no. 1 (RWQM1): II. Biochemical process equations, Water Sci. Tech. 43(5), 11-30, 2001. <br /><br />
Reichert, P. and Schuwirth, N., A generic framework for deriving process stoichiometry in environmental models, Environmental Modelling &amp; Software, 25, 1241-1251, 2010. <br /><br />
Soetaert, K., Petzoldt, T., and Woodrow Setzer, R. Solving differential equations in R: Package deSolve. Journal of Statistical Software, 33(9), 2010. <br /><br />
Soetaert, K., Cash, J., and Mazzia, F. Solving Differential Equations in R. Springer, Heidelberg, Germany. 2012.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+process-class">process-class</a></code>,
<code><a href="#topic+reactor-class">reactor-class</a></code>,
<code><a href="#topic+link-class">link-class</a></code>,
<code><a href="#topic+system-class">system-class</a></code>,
<code><a href="#topic+plotres">plotres</a></code>.
<code><a href="#topic+calcres-methods">calcres-methods</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Definition of parameters:
# =========================

param    &lt;- list(k.gro.ALG   = 1,        # 1/d
                 k.gro.ZOO   = 0.8,      # m3/gDM/d
                 k.death.ALG = 0.4,      # 1/d
                 k.death.ZOO = 0.08,     # 1/d
                 K.HPO4      = 0.002,    # gP/m3
                 Y.ZOO       = 0.2,      # gDM/gDM
                 alpha.P.ALG = 0.002,    # gP/gDM
                 A           = 8.5e+006, # m2
                 h.epi       = 4,        # m
                 Q.in        = 4,        # m3/s
                 C.ALG.ini   = 0.05,     # gDM/m3
                 C.ZOO.ini   = 0.1,      # gDM/m3
                 C.HPO4.ini  = 0.02,     # gP/m3
                 C.HPO4.in   = 0.04)     # gP/m3             

# Definition of transformation processes:
# =======================================

# Growth of algae:
# ----------------

gro.ALG   &lt;- new(Class  = "process",
                 name   = "Growth of algae",
                 rate   = expression(k.gro.ALG
                                     *C.HPO4/(K.HPO4+C.HPO4)
                                     *C.ALG),
                 stoich = list(C.ALG  = expression(1),              # gDM/gDM
                               C.HPO4 = expression(-alpha.P.ALG)))  # gP/gDM

# Death of algae:
# ---------------

death.ALG &lt;- new(Class = "process",
                 name   = "Death of algae",
                 rate   = expression(k.death.ALG*C.ALG),
                 stoich = list(C.ALG  = expression(-1)))            # gDM/gDM

# Growth of zooplankton:
# ----------------------

gro.ZOO   &lt;- new(Class  = "process",
                 name   = "Growth of zooplankton",
                 rate   = expression(k.gro.ZOO
                                     *C.ALG
                                     *C.ZOO),
                 stoich = list(C.ZOO  = expression(1),              # gDM/gDM
                               C.ALG  = expression(-1/Y.ZOO)))      # gP/gDM

# Death of zooplankton:
# ---------------------

death.ZOO &lt;- new(Class  = "process",
                 name   = "Death of zooplankton",
                 rate   = expression(k.death.ZOO*C.ZOO),
                 stoich = list(C.ZOO  = expression(-1)))            # gDM/gDM

# Definition of reactor:
# ======================

# Epilimnion:
# -----------

epilimnion &lt;- 
   new(Class            = "reactor",
       name             = "Epilimnion",
       volume.ini       = expression(A*h.epi),
       conc.pervol.ini  = list(C.HPO4 = expression(C.HPO4.ini),     # gP/m3
                               C.ALG  = expression(C.ALG.ini),      # gDM/m3
                               C.ZOO  = expression(C.ZOO.ini)),     # gDM/m3
       inflow           = expression(Q.in*86400),                   # m3/d
       inflow.conc      = list(C.HPO4 = expression(C.HPO4.in),
                               C.ALG  = 0,
                               C.ZOO  = 0),
       outflow          = expression(Q.in*86400),
       processes        = list(gro.ALG,death.ALG,gro.ZOO,death.ZOO))

# Definition of system:
# =====================

# Lake system:
# ------------

system &lt;- new(Class    = "system",
              name     = "Lake",
              reactors = list(epilimnion),
              param    = param,
              t.out    = seq(0,365,by=1))

# Perform simulation:
# ===================

res &lt;- calcres(system)

# Plot results:
# =============
                 
plotres(res)              # plot to screen

# plotres(res,file="ecosim_example_plot1.pdf")  # plot to pdf file

plotres(res, colnames=c("C.ALG", "C.ZOO"))  # plot selected variables

plotres(res, colnames=list("C.HPO4",c("C.ALG", "C.ZOO")))

plotres(res[1:100,], colnames=list("C.HPO4",c("C.ALG", "C.ZOO"))) # plot selected time steps

# plotres(res      = res,    # plot to pdf file
#         colnames = list("C.HPO4",c("C.ALG","C.ZOO")),
#         file     = "ecosim_example_plot2.pdf",
#         width    = 8,
#         height   = 4)

# Perform sensitivity analysis:
# =============================
 
res.sens &lt;- calcsens(system,param.sens=c("k.gro.ALG","k.gro.ZOO"))

# Plot results of sensitivity analysis:
# =====================================
 
plotres(res.sens)              # plot to screen

# plotres(res.sens,file="ecosim_example_plot3.pdf")  # plot to pdf file
</code></pre>

<hr>
<h2 id='calcsens-methods'><code>calcsens</code></h2><span id='topic+calcsens-methods'></span><span id='topic+calcsens+2CANY-method'></span><span id='topic+calcsens+2Csystem-method'></span>

<h3>Description</h3>

<p><code><a href="#topic+calcsens">calcsens</a></code> Performs a sensitivity analysis of the model passed as the argument.
</p>


<h3>Methods</h3>


<dl>
<dt><code>signature(system = "ANY")</code></dt><dd>
</dd>
<dt><code>signature(system = "system")</code></dt><dd>
</dd>
</dl>

<hr>
<h2 id='ecosim-package'>
Toolbox for Aquatic Ecosystem Modeling
</h2><span id='topic+ecosim-package'></span><span id='topic+ecosim'></span>

<h3>Description</h3>

<p>Classes and methods for implementing aquatic ecosystem models,
for running these models, and for visualizing their results. <br /><br />
Models are built by constructing objects of the classes <br /><br />
<code><a href="#topic+process-class">process-class</a></code>, <br />
<code><a href="#topic+reactor-class">reactor-class</a></code>, <br />
<code><a href="#topic+link-class">link-class</a></code>, <br />
<code><a href="#topic+system-class">system-class</a></code>. <br /><br />
A transformation processes (<code><a href="#topic+process-class">process-class</a></code>) is defined by a process rate (expression describing the dependence of the rate on substance or organism concentrations and external influence factors) and stoichiometric coefficients that describe how the rate affects different substances or organisms.
It is recommended to calculate the stoichiometric coefficients with the function <code>calc.stoich.coef</code> of the package <code><a href="stoichcalc.html#topic+stoichcalc">stoichcalc</a></code> from substance and organism compositions.
The output of this function can directly be used for the process definition.
A reactor (<code><a href="#topic+reactor-class">reactor-class</a></code>) describes a well-mixed compartment of the environment (or of a laboratory system).
For each reactor, inflow, outflow, substance and organism input and transformation processes can be defined.
A link (<code><a href="#topic+link-class">link-class</a></code>) describes advective and/or diffusive exchange of substances and/or organisms between well-mixed reactors.
Finally, a system (<code><a href="#topic+system-class">system-class</a></code>) consists of a single reactor or a set of isolated or linked reactors and can be used to describe a community or meta-community model of an ecosystem and the biogeochemical cycles. <br /><br />
Once a model is described by an object of the class system (<code><a href="#topic+system-class">system-class</a></code>), simulations can be performed using the member function <br /><br />
<code><a href="#topic+calcres">calcres</a></code>. <br /><br />
This function integrates the system of ordinary differential equations numerically using the function <code><a href="deSolve.html#topic+ode">ode</a></code> of the package <code><a href="deSolve.html#topic+deSolve">deSolve</a></code> and produces time series of the volumes and substance and organisms concentrations as a R matrix.
The results can be visualized with arbitrary R functions or a summary of all results can be produced with the function <br /><br />
<code><a href="#topic+plotres">plotres</a></code>. <br /><br />
Similarly, sensitivity analyses can be performed with the member function <br /><br />
<code><a href="#topic+calcsens">calcsens</a></code>. <br /><br />
This function produces a list of lists of output matrices of the format produced by
<code><a href="#topic+calcres">calcres</a></code>.
The function <code><a href="#topic+plotres">plotres</a></code> is also able to deal with this slightly more complex
output format. <br /><br />
To propagate stochasticity and uncertainty to the results, stochastic parameter time series can be generated with the function <br /><br />
<code><a href="#topic+randou">randou</a></code> <br /><br />
and parameter samples can be sampled with the function <br /><br />
<code><a href="#topic+randnorm">randnorm</a></code> <br /><br />
to get a sample from the predictive distribution by Monte Carlo simulation.
Again, the results can be plotted with the function <code><a href="#topic+plotres">plotres</a></code>.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> ecosim</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.3-4</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2023-08-28</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL (&gt;= 2)</td>
</tr>
<tr>
 <td style="text-align: left;">
Depends: </td><td style="text-align: left;"> deSolve, stoichcalc</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Note</h3>

<p>The following demos are available:<br /><br />
lakemodel_simple <br />
lakemodel_intermediate <br />
lakemodel_complex <br />
rivermodel_simple <br />
rivermodel_complex <br />
</p>


<h3>Author(s)</h3>

<p>Peter Reichert
</p>
<p>Maintainer: Peter Reichert &lt;peter.reichert@emeriti.eawag.ch&gt;
</p>


<h3>References</h3>

<p>Omlin, M., Reichert, P. and Forster, R., Biogeochemical model of lake Zurich: Model equations and results, Ecological Modelling 141(1-3), 77-103, 2001. <br /><br />
Reichert, P., Borchardt, D., Henze, M., Rauch, W., Shanahan, P., Somlyody, L. and Vanrolleghem, P., River Water Quality Model no. 1 (RWQM1): II. Biochemical process equations, Water Sci. Tech. 43(5), 11-30, 2001. <br /><br />
Reichert, P. and Schuwirth, N., A generic framework for deriving process stoichiometry in environmental models, Environmental Modelling &amp; Software, 25, 1241-1251, 2010. <br /><br />
Soetaert, K., Petzoldt, T., and Woodrow Setzer, R. Solving differential equations in R: Package deSolve. Journal of Statistical Software, 33(9), 2010. <br /><br />
Soetaert, K., Cash, J., and Mazzia, F. Solving Differential Equations in R. Springer, Heidelberg, Germany. 2012.
</p>


<h3>See Also</h3>

<p><code><a href="deSolve.html#topic+deSolve">deSolve</a></code>,
<code><a href="stoichcalc.html#topic+stoichcalc">stoichcalc</a></code>,
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Definition of parameters:
# =========================

param    &lt;- list(k.gro.ALG   = 1,        # 1/d
                 k.gro.ZOO   = 0.8,      # m3/gDM/d
                 k.death.ALG = 0.4,      # 1/d
                 k.death.ZOO = 0.08,     # 1/d
                 K.HPO4      = 0.002,    # gP/m3
                 Y.ZOO       = 0.2,      # gDM/gDM
                 alpha.P.ALG = 0.002,    # gP/gDM
                 A           = 8.5e+006, # m2
                 h.epi       = 4,        # m
                 Q.in        = 4,        # m3/s
                 C.ALG.ini   = 0.05,     # gDM/m3
                 C.ZOO.ini   = 0.1,      # gDM/m3
                 C.HPO4.ini  = 0.02,     # gP/m3
                 C.HPO4.in   = 0.04)     # gP/m3             

# Definition of transformation processes:
# =======================================

# Growth of algae:
# ----------------

gro.ALG   &lt;- new(Class  = "process",
                 name   = "Growth of algae",
                 rate   = expression(k.gro.ALG
                                     *C.HPO4/(K.HPO4+C.HPO4)
                                     *C.ALG),
                 stoich = list(C.ALG  = expression(1),              # gDM/gDM
                               C.HPO4 = expression(-alpha.P.ALG)))  # gP/gDM

# Death of algae:
# ---------------

death.ALG &lt;- new(Class = "process",
                 name   = "Death of algae",
                 rate   = expression(k.death.ALG*C.ALG),
                 stoich = list(C.ALG  = expression(-1)))            # gDM/gDM

# Growth of zooplankton:
# ----------------------

gro.ZOO   &lt;- new(Class  = "process",
                 name   = "Growth of zooplankton",
                 rate   = expression(k.gro.ZOO
                                     *C.ALG
                                     *C.ZOO),
                 stoich = list(C.ZOO  = expression(1),              # gDM/gDM
                               C.ALG  = expression(-1/Y.ZOO)))      # gP/gDM

# Death of zooplankton:
# ---------------------

death.ZOO &lt;- new(Class  = "process",
                 name   = "Death of zooplankton",
                 rate   = expression(k.death.ZOO*C.ZOO),
                 stoich = list(C.ZOO  = expression(-1)))            # gDM/gDM

# Definition of reactor:
# ======================

# Epilimnion:
# -----------

epilimnion &lt;- 
   new(Class            = "reactor",
       name             = "Epilimnion",
       volume.ini       = expression(A*h.epi),
       conc.pervol.ini  = list(C.HPO4 = expression(C.HPO4.ini),     # gP/m3
                               C.ALG  = expression(C.ALG.ini),      # gDM/m3
                               C.ZOO  = expression(C.ZOO.ini)),     # gDM/m3
       inflow           = expression(Q.in*86400),                   # m3/d
       inflow.conc      = list(C.HPO4 = expression(C.HPO4.in),
                               C.ALG  = 0,
                               C.ZOO  = 0),
       outflow          = expression(Q.in*86400),
       processes        = list(gro.ALG,death.ALG,gro.ZOO,death.ZOO))

# Definition of system:
# =====================

# Lake system:
# ------------

system &lt;- new(Class    = "system",
              name     = "Lake",
              reactors = list(epilimnion),
              param    = param,
              t.out    = seq(0,365,by=1))

# Perform simulation:
# ===================

res &lt;- calcres(system)

# Plot results:
# =============
                 
plotres(res)              # plot to screen

# plotres(res,file="ecosim_example_plot1.pdf")  # plot to pdf file

plotres(res, colnames=c("C.ALG", "C.ZOO"))  # plot selected variables

plotres(res, colnames=list("C.HPO4",c("C.ALG", "C.ZOO")))

plotres(res[1:100,], colnames=list("C.HPO4",c("C.ALG", "C.ZOO"))) # plot selected time steps

# plotres(res      = res,    # plot to pdf file
#         colnames = list("C.HPO4",c("C.ALG","C.ZOO")),
#         file     = "ecosim_example_plot2.pdf",
#         width    = 8,
#         height   = 4)

# Perform sensitivity analysis:
# =============================
 
res.sens &lt;- calcsens(system,param.sens=c("k.gro.ALG","k.gro.ZOO"))

# Plot results of sensitivity analysis:
# =====================================
 
plotres(res.sens)              # plot to screen

# plotres(res.sens,file="ecosim_example_plot3.pdf")  # plot to pdf file
</code></pre>

<hr>
<h2 id='link-class'>Class <code>"link"</code></h2><span id='topic+link-class'></span>

<h3>Description</h3>

<p>This class represents a link between mixed reactors.
A link is characterized by
the two reactors it connects to,
the flow through the link,
advective transfer coefficients, and
diffusive exchange coefficients.
</p>


<h3>Objects from the Class</h3>

<p>Objects can be created by calls of the form <code>new("link", ...)</code>.
</p>


<h3>Slots</h3>


<dl>
<dt><code>name</code>:</dt><dd><p>Character string specifying the name of the process.</p>
</dd>
<dt><code>from</code>:</dt><dd><p>Character string specifying the name of the reactor where the link starts.</p>
</dd>
<dt><code>to</code>:</dt><dd><p>Character string specifying the name of the reactor where the link ends.</p>
</dd>
<dt><code>flow</code>:</dt><dd><p>Expression specifying the flow through the link.</p>
</dd>
<dt><code>qadv.gen</code>:</dt><dd><p>Expression specifying a general advective transfer coefficient</p>
</dd>
<dt><code>qadv.spec</code>:</dt><dd><p>List of expressions specifying substance/organism-specific advective transfer coefficients.</p>
</dd>
<dt><code>qdiff.gen</code>:</dt><dd><p>Expression specifying a general diffusive exchange coefficient.</p>
</dd>
<dt><code>qdiff.spec</code>:</dt><dd><p>List of expressions specifying substance/organism-specific diffusion coefficients.</p>
</dd>
</dl>



<h3>Methods</h3>


<dl>
<dt>calc.rates.statevar.link</dt><dd><p>Calculates rates of change; internal use only.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Peter Reichert &lt;peter.reichert@emeriti.eawag.ch&gt;
</p>


<h3>References</h3>

<p>Omlin, M., Reichert, P. and Forster, R., Biogeochemical model of lake Zurich: Model equations and results, Ecological Modelling 141(1-3), 77-103, 2001. <br /><br />
Reichert, P., Borchardt, D., Henze, M., Rauch, W., Shanahan, P., Somlyody, L. and Vanrolleghem, P., River Water Quality Model no. 1 (RWQM1): II. Biochemical process equations, Water Sci. Tech. 43(5), 11-30, 2001. <br /><br />
Reichert, P. and Schuwirth, N., A generic framework for deriving process stoichiometry in environmental models, Environmental Modelling &amp; Software, 25, 1241-1251, 2010.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+process-class">process-class</a></code>,
<code><a href="#topic+reactor-class">reactor-class</a></code>,
<code><a href="#topic+system-class">system-class</a></code>,
<code><a href="#topic+calcres">calcres</a></code>,
<code><a href="#topic+plotres">plotres</a></code>.
</p>

<hr>
<h2 id='plotres'>
Plot Simulation Results
</h2><span id='topic+plotres'></span>

<h3>Description</h3>

<p>Produces a simple standardized plot of the results generated by <code><a href="#topic+calcres">calcres</a></code> 
or, more generally, 
plots of all or selected columns of a matrix as a function of the row names interpreted as numbers.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotres(res,colnames=list(),
        file=NA,width=7,height=7,
        ncol=NA,nrow=NA,
        lwd=2,
        col=c("black","red","blue","pink","orange","violet","cyan","brown","purple"),
        lty=c("solid",paste(2*4:1,2,sep=""),paste(paste(2*4:2,2,sep=""),22,sep="")),
        main=NA,xlab=NA,ylab=NA)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotres_+3A_res">res</code></td>
<td>

<p>Numerical matrix, list of numerical matrices or list of lists of numerical matrices of data to be plotted.
If <code>res</code> is a single numerical matrix, all columns or the columns selected under <code>colnames</code> are plotted 
versus the row names that are converted to numerics.
If <code>res</code> is a list of numerical matrices, the same plots are produced as for a single numerical matrix, 
but in all plots multiple lines are produced from the different list entries.
In the legend, the column names are then appended by the names of the lists.
If <code>res</code> is a list of lists of numerical matrices, a set of plots according to the description above are produced.
Note that the format of <code>res</code> is compatible with the output of the member functions <code><a href="#topic+calcres">calcres</a></code> and
<code><a href="#topic+calcsens">calcsens</a></code> of the class <code><a href="#topic+system-class">system-class</a></code>.
</p>
</td></tr>
<tr><td><code id="plotres_+3A_colnames">colnames</code></td>
<td>

<p>Selection of column names to be plotted. 
Each list element defines a plot and may contain a vector of column names in which case multiple lines are plotted
into the same plot.
An empty list indicates that all columns should be plotted.
</p>
</td></tr>
<tr><td><code id="plotres_+3A_file">file</code></td>
<td>

<p>Optional file name to which the plot should be redirected. The file will be written in pdf format.
</p>
</td></tr>
<tr><td><code id="plotres_+3A_width">width</code></td>
<td>

<p>Optional width of the graphics region of the pdf in inches.
</p>
</td></tr>
<tr><td><code id="plotres_+3A_height">height</code></td>
<td>

<p>Optional height of the graphics region of the pdf in inches.
</p>
</td></tr>
<tr><td><code id="plotres_+3A_ncol">ncol</code></td>
<td>

<p>Optional number of columns of plots to be plotted on the same page.
</p>
</td></tr>
<tr><td><code id="plotres_+3A_nrow">nrow</code></td>
<td>

<p>Optional number of rows of plots to be plotted on the same page.
</p>
</td></tr>
<tr><td><code id="plotres_+3A_lwd">lwd</code></td>
<td>

<p>Optional line width(s); values are recycled if more lines are plotted then line widths provided.
</p>
</td></tr>
<tr><td><code id="plotres_+3A_lty">lty</code></td>
<td>

<p>Optional line type(s); values are recycled if more lines are plotted then line types provided.
</p>
</td></tr>
<tr><td><code id="plotres_+3A_col">col</code></td>
<td>

<p>Optional line color(s); values are recycled if more lines are plotted then line colors provided.
</p>
</td></tr>
<tr><td><code id="plotres_+3A_main">main</code></td>
<td>

<p>Optional title(s) of plots; values are recycled if more plots are produced than titles provided.
</p>
</td></tr>
<tr><td><code id="plotres_+3A_xlab">xlab</code></td>
<td>

<p>Optional label(s) of the x axes; values are recycled if more plots are produced than labels provided.
</p>
</td></tr>
<tr><td><code id="plotres_+3A_ylab">ylab</code></td>
<td>

<p>Optional label(s) of the y axes; values are recycled if more plots are produced than labels provided.
</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Peter Reichert &lt;peter.reichert@emeriti.eawag.ch&gt;
</p>


<h3>See Also</h3>

<p><code><a href="#topic+process-class">process-class</a></code>,
<code><a href="#topic+reactor-class">reactor-class</a></code>
<code><a href="#topic+link-class">link-class</a></code>
<code><a href="#topic+system-class">system-class</a></code>
<code><a href="#topic+calcres">calcres</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Definition of parameters:
# =========================

param    &lt;- list(k.gro.ALG   = 1,        # 1/d
                 k.gro.ZOO   = 0.8,      # m3/gDM/d
                 k.death.ALG = 0.4,      # 1/d
                 k.death.ZOO = 0.08,     # 1/d
                 K.HPO4      = 0.002,    # gP/m3
                 Y.ZOO       = 0.2,      # gDM/gDM
                 alpha.P.ALG = 0.002,    # gP/gDM
                 A           = 8.5e+006, # m2
                 h.epi       = 4,        # m
                 Q.in        = 4,        # m3/s
                 C.ALG.ini   = 0.05,     # gDM/m3
                 C.ZOO.ini   = 0.1,      # gDM/m3
                 C.HPO4.ini  = 0.02,     # gP/m3
                 C.HPO4.in   = 0.04)     # gP/m3             

# Definition of transformation processes:
# =======================================

# Growth of algae:
# ----------------

gro.ALG   &lt;- new(Class  = "process",
                 name   = "Growth of algae",
                 rate   = expression(k.gro.ALG
                                     *C.HPO4/(K.HPO4+C.HPO4)
                                     *C.ALG),
                 stoich = list(C.ALG  = expression(1),              # gDM/gDM
                               C.HPO4 = expression(-alpha.P.ALG)))  # gP/gDM

# Death of algae:
# ---------------

death.ALG &lt;- new(Class = "process",
                 name   = "Death of algae",
                 rate   = expression(k.death.ALG*C.ALG),
                 stoich = list(C.ALG  = expression(-1)))            # gDM/gDM

# Growth of zooplankton:
# ----------------------

gro.ZOO   &lt;- new(Class  = "process",
                 name   = "Growth of zooplankton",
                 rate   = expression(k.gro.ZOO
                                     *C.ALG
                                     *C.ZOO),
                 stoich = list(C.ZOO  = expression(1),              # gDM/gDM
                               C.ALG  = expression(-1/Y.ZOO)))      # gP/gDM

# Death of zooplankton:
# ---------------------

death.ZOO &lt;- new(Class  = "process",
                 name   = "Death of zooplankton",
                 rate   = expression(k.death.ZOO*C.ZOO),
                 stoich = list(C.ZOO  = expression(-1)))            # gDM/gDM

# Definition of reactor:
# ======================

# Epilimnion:
# -----------

epilimnion &lt;- 
   new(Class            = "reactor",
       name             = "Epilimnion",
       volume.ini       = expression(A*h.epi),
       conc.pervol.ini  = list(C.HPO4 = expression(C.HPO4.ini),     # gP/m3
                               C.ALG  = expression(C.ALG.ini),      # gDM/m3
                               C.ZOO  = expression(C.ZOO.ini)),     # gDM/m3
       inflow           = expression(Q.in*86400),                   # m3/d
       inflow.conc      = list(C.HPO4 = expression(C.HPO4.in),
                               C.ALG  = 0,
                               C.ZOO  = 0),
       outflow          = expression(Q.in*86400),
       processes        = list(gro.ALG,death.ALG,gro.ZOO,death.ZOO))

# Definition of system:
# =====================

# Lake system:
# ------------

system &lt;- new(Class    = "system",
              name     = "Lake",
              reactors = list(epilimnion),
              param    = param,
              t.out    = seq(0,365,by=1))

# Perform simulation:
# ===================

res &lt;- calcres(system)

# Plot results:
# =============
                 
plotres(res)              # plot to screen

# plotres(res,file="ecosim_example_plot1.pdf")  # plot to pdf file

plotres(res, colnames=c("C.ALG", "C.ZOO"))  # plot selected variables

plotres(res, colnames=list("C.HPO4",c("C.ALG", "C.ZOO")))

plotres(res[1:100,], colnames=list("C.HPO4",c("C.ALG", "C.ZOO"))) # plot selected time steps

# plotres(res      = res,    # plot to pdf file
#         colnames = list("C.HPO4",c("C.ALG","C.ZOO")),
#         file     = "ecosim_example_plot2.pdf",
#         width    = 8,
#         height   = 4)

# Perform sensitivity analysis:
# =============================
 
res.sens &lt;- calcsens(system,param.sens=c("k.gro.ALG","k.gro.ZOO"))

# Plot results of sensitivity analysis:
# =====================================
 
plotres(res.sens)              # plot to screen

# plotres(res.sens,file="ecosim_example_plot3.pdf")  # plot to pdf file
</code></pre>

<hr>
<h2 id='process-class'>Class <code>"process"</code></h2><span id='topic+process-class'></span>

<h3>Description</h3>

<p>This class represents a transformation process of substances/organisms in the modelled system.
Such a process is characterized by a transformation rate and a list of stoichiometric coefficients for the affected substances and organisms.
It is recommended to calculate the stoichiometric coefficients with the function <code>calc.stoich.coef</code> of the package <code><a href="stoichcalc.html#topic+stoichcalc">stoichcalc</a></code> from substance and organism compositions.
The output of this function can directly be used for the process definition.
</p>


<h3>Objects from the Class</h3>

<p>Objects can be created by calls of the form <code>new("process", ...)</code>.
</p>


<h3>Slots</h3>


<dl>
<dt><code>name</code>:</dt><dd><p>Character string specifying the name of the process.</p>
</dd>
<dt><code>rate</code>:</dt><dd><p>Expression characterizing the dependence of the transformation rate on substance/organism concentrations and external influence factors</p>
</dd>
<dt><code>stoich</code>:</dt><dd><p>List of expressions or numbers defining the stoichiometric coefficient of the substance/organism given by the label of the list component.</p>
</dd>
<dt><code>pervol</code>:</dt><dd><p>Logical variable defining the process rate as per volume of the reactor (pervol=TRUE) or per surface area (pervol=FALSE).</p>
</dd>
</dl>



<h3>Methods</h3>


<dl>
<dt>calc.trans.rates</dt><dd><p>Calculates transformation rates; internal use only.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Peter Reichert &lt;peter.reichert@emeriti.eawag.ch&gt;
</p>


<h3>References</h3>

<p>Omlin, M., Reichert, P. and Forster, R., Biogeochemical model of lake Zurich: Model equations and results, Ecological Modelling 141(1-3), 77-103, 2001. <br /><br />
Reichert, P., Borchardt, D., Henze, M., Rauch, W., Shanahan, P., Somlyody, L. and Vanrolleghem, P., River Water Quality Model no. 1 (RWQM1): II. Biochemical process equations, Water Sci. Tech. 43(5), 11-30, 2001. <br /><br />
Reichert, P. and Schuwirth, N., A generic framework for deriving process stoichiometry in environmental models, Environmental Modelling &amp; Software, 25, 1241-1251, 2010.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+reactor-class">reactor-class</a></code>,
<code><a href="#topic+link-class">link-class</a></code>,
<code><a href="#topic+system-class">system-class</a></code>,
<code><a href="#topic+calcres">calcres</a></code>,
<code><a href="#topic+plotres">plotres</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Definition of parameters:
# =========================

param    &lt;- list(k.gro.ALG   = 1,        # 1/d
                 k.gro.ZOO   = 0.8,      # m3/gDM/d
                 k.death.ALG = 0.4,      # 1/d
                 k.death.ZOO = 0.08,     # 1/d
                 K.HPO4      = 0.002,    # gP/m3
                 Y.ZOO       = 0.2,      # gDM/gDM
                 alpha.P.ALG = 0.002,    # gP/gDM
                 A           = 8.5e+006, # m2
                 h.epi       = 4,        # m
                 Q.in        = 4,        # m3/s
                 C.ALG.ini   = 0.05,     # gDM/m3
                 C.ZOO.ini   = 0.1,      # gDM/m3
                 C.HPO4.ini  = 0.02,     # gP/m3
                 C.HPO4.in   = 0.04)     # gP/m3             

# Definition of transformation processes:
# =======================================

# Growth of algae:
# ----------------

gro.ALG   &lt;- new(Class  = "process",
                 name   = "Growth of algae",
                 rate   = expression(k.gro.ALG
                                     *C.HPO4/(K.HPO4+C.HPO4)
                                     *C.ALG),
                 stoich = list(C.ALG  = expression(1),              # gDM/gDM
                               C.HPO4 = expression(-alpha.P.ALG)))  # gP/gDM

# Death of algae:
# ---------------

death.ALG &lt;- new(Class = "process",
                 name   = "Death of algae",
                 rate   = expression(k.death.ALG*C.ALG),
                 stoich = list(C.ALG  = expression(-1)))            # gDM/gDM

# Growth of zooplankton:
# ----------------------

gro.ZOO   &lt;- new(Class  = "process",
                 name   = "Growth of zooplankton",
                 rate   = expression(k.gro.ZOO
                                     *C.ALG
                                     *C.ZOO),
                 stoich = list(C.ZOO  = expression(1),              # gDM/gDM
                               C.ALG  = expression(-1/Y.ZOO)))      # gP/gDM

# Death of zooplankton:
# ---------------------

death.ZOO &lt;- new(Class  = "process",
                 name   = "Death of zooplankton",
                 rate   = expression(k.death.ZOO*C.ZOO),
                 stoich = list(C.ZOO  = expression(-1)))            # gDM/gDM
</code></pre>

<hr>
<h2 id='randnorm'>
Sample from a Univariate Normal or Lognormal Distribution
</h2><span id='topic+randnorm'></span>

<h3>Description</h3>

<p>Samples from a univariate Normal or Lognormal distribution with parameters valid in the original units.
Just invokes a parameter transformation and calls <code><a href="stats.html#topic+rnorm">rnorm</a></code> as users often prefer to specify uncertainty in their original units rather than on the log scale as it is done in <code><a href="stats.html#topic+rlnorm">rlnorm</a></code>. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>randnorm(mean=0,sd=1,log=FALSE,n=1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="randnorm_+3A_mean">mean</code></td>
<td>

<p>Mean of the random variable.
</p>
</td></tr>
<tr><td><code id="randnorm_+3A_sd">sd</code></td>
<td>

<p>Standard deviation of the random variable.
</p>
</td></tr>
<tr><td><code id="randnorm_+3A_log">log</code></td>
<td>

<p>Indicator whether the log of the variable should be normally distributed (log=TRUE) rather than the variable itself.
(Note: mean and sd are interpreted in original units also for log=TRUE.)
</p>
</td></tr>
<tr><td><code id="randnorm_+3A_n">n</code></td>
<td>

<p>Sample size.
</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Peter Reichert &lt;peter.reichert@emeriti.eawag.ch&gt;
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+rnorm">rnorm</a></code>,
<code><a href="stats.html#topic+rlnorm">rlnorm</a></code>,
<code><a href="#topic+randou">randou</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>n &lt;- 10000

samp &lt;- randnorm(mean=0,sd=1,n=n)
plot(1:length(samp),samp,xlab="index",ylab="y",cex=0.2)
mean(samp)
sd(samp)

samp &lt;- randnorm(mean=2,sd=2,log=TRUE,n=n)
plot(1:length(samp),samp,ylim=c(0,25),xlab="index",ylab="y",cex=0.2)
mean(samp)
sd(samp)
</code></pre>

<hr>
<h2 id='randou'>
Sample from an Ornstein-Uhlenbeck Process
</h2><span id='topic+randou'></span>

<h3>Description</h3>

<p>Samples from an Ornstein-Uhlenbeck process and optionally exponetiates the results.
In contrast to most parameterizations, sd represents the asymptotic standard deviation rather than the coefficient in the drift term of the corresponding stochastic differential equation.
As in <code><a href="#topic+randnorm">randnorm</a></code>, mean and sd are interpreted in original, not in log-transformed units to facilitate the characterization of uncertainty in original units.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>randou(mean=0,sd=1,tau=0.1,y0=NA,t=0:1000/1000,log=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="randou_+3A_mean">mean</code></td>
<td>

<p>Asymptotic mean of the process.
</p>
</td></tr>
<tr><td><code id="randou_+3A_sd">sd</code></td>
<td>

<p>Asymptotic standard deviation of the process.
</p>
</td></tr>
<tr><td><code id="randou_+3A_tau">tau</code></td>
<td>

<p>Correlation time of the process.
</p>
</td></tr>
<tr><td><code id="randou_+3A_y0">y0</code></td>
<td>

<p>Starting value of the process. If no value is given, the starting value will be drawn randomly from the asymptotic distribution.
</p>
</td></tr>
<tr><td><code id="randou_+3A_t">t</code></td>
<td>

<p>Time points at which the process should be sampled.
(Note: the value at t[1] will be the starting value y0.)
</p>
</td></tr>
<tr><td><code id="randou_+3A_log">log</code></td>
<td>

<p>Indicator whether the log of the variable should be an Ornstein-Uhlenbeck process (log=TRUE) rather than the variable itself.
(Note: mean and sd are interpreted in original units also for log=TRUE.)
</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Peter Reichert &lt;peter.reichert@emeriti.eawag.ch&gt;
</p>


<h3>See Also</h3>

<p><code><a href="#topic+randnorm">randnorm</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>n &lt;- 10000
tau &lt;- 0.1

proc1 &lt;- randou(mean=0,sd=1,tau=tau,y0= 0,t=0:n/n,log=FALSE)
proc2 &lt;- randou(mean=0,sd=1,tau=tau,y0= 1,t=0:n/n,log=FALSE)
proc3 &lt;- randou(mean=0,sd=1,tau=tau,y0=-1,t=0:n/n,log=FALSE)
plot(proc1,xlim=c(0,1),ylim=c(-2.5,2.5),xlab="t",ylab="y",type="l")
lines(proc2,col="red")
lines(proc3,col="blue")
abline(h=0)
mean(proc1$y)
mean(proc2$y)
mean(proc3$y)
sd(proc1$y)
sd(proc2$y)
sd(proc3$y)

procl1 &lt;- randou(mean=2,sd=2,tau=tau,y0=1,t=0:n/n,log=TRUE)
procl2 &lt;- randou(mean=2,sd=2,tau=tau,y0=2,t=0:n/n,log=TRUE)
procl3 &lt;- randou(mean=2,sd=2,tau=tau,y0=3,t=0:n/n,log=TRUE)
plot(procl1,xlim=c(0,1),ylim=c(0,6),xlab="t",ylab="y",type="l")
lines(procl2,col="red")
lines(procl3,col="blue")
mean(procl1$y)
mean(procl2$y)
mean(procl3$y)
sd(procl1$y)
sd(procl2$y)
sd(procl3$y)
</code></pre>

<hr>
<h2 id='reactor-class'>Class <code>"reactor"</code></h2><span id='topic+reactor-class'></span>

<h3>Description</h3>

<p>This class represents a well-mixed part of the system as a &quot;reactor&quot;.
A reactor is characterized by 
its initial volume, 
a surface area available for sessile organisms or attached substances,
initial concentrations of substances and organisms in the water column and on the surface area,
input into the reactor not associated with  inflow,
inflow into the reactor
substance and organism concentrations in the inflow,
outflow out of the reactor,
environmental conditions to which the reactor is exposed, and
processes active in the reactor.
</p>


<h3>Objects from the Class</h3>

<p>Objects can be created by calls of the form <code>new("reactor", ...)</code>.
</p>


<h3>Slots</h3>


<dl>
<dt><code>name</code>:</dt><dd><p>Character string specifying the name of the reactor.</p>
</dd>
<dt><code>volume.ini</code>:</dt><dd><p>Expression specifying the initial volume of the reactor</p>
</dd>
<dt><code>area</code>:</dt><dd><p>Expression specifying the surface area available for sessile organisms or attached substances.</p>
</dd>
<dt><code>conc.pervol.ini</code>:</dt><dd><p>List of expressions specifying the initial concentrations of substances/organisms in the reactor.</p>
</dd>
<dt><code>conc.perarea.ini</code>:</dt><dd><p>List of expressions specifying the initial surface density of sessile organisms or attached substances.</p>
</dd>
<dt><code>input</code>:</dt><dd><p>List of expressions specifying the input of substances/organisms into the reactor.</p>
</dd>
<dt><code>inflow</code>:</dt><dd><p>Expression specifying the volumetric inflow rate into the reactor.</p>
</dd>
<dt><code>inflow.conc</code>:</dt><dd><p>List of expressions specifying the substance/organism concentrations in the inflow.</p>
</dd>
<dt><code>outflow</code>:</dt><dd><p>Expression specifying the volumetric outflow rate of the reactor.</p>
</dd>
<dt><code>cond</code>:</dt><dd><p>List of expressions specifying the environmental conditions to which the reactor is exposed.</p>
</dd>
<dt><code>processes</code>:</dt><dd><p>List of processes that are active in the reactor.</p>
</dd>
<dt><code>a</code>:</dt><dd><p>Evaluated area; for internal use only.</p>
</dd>
</dl>



<h3>Methods</h3>


<dl>
<dt>calc.rates.statevar.reactor</dt><dd><p>Calculates rates of change; internal use only.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Peter Reichert &lt;peter.reichert@emeriti.eawag.ch&gt;
</p>


<h3>References</h3>

<p>Omlin, M., Reichert, P. and Forster, R., Biogeochemical model of lake Zurich: Model equations and results, Ecological Modelling 141(1-3), 77-103, 2001. <br /><br />
Reichert, P., Borchardt, D., Henze, M., Rauch, W., Shanahan, P., Somlyody, L. and Vanrolleghem, P., River Water Quality Model no. 1 (RWQM1): II. Biochemical process equations, Water Sci. Tech. 43(5), 11-30, 2001. <br /><br />
Reichert, P. and Schuwirth, N., A generic framework for deriving process stoichiometry in environmental models, Environmental Modelling &amp; Software, 25, 1241-1251, 2010.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+process-class">process-class</a></code>,
<code><a href="#topic+link-class">link-class</a></code>,
<code><a href="#topic+system-class">system-class</a></code>,
<code><a href="#topic+calcres">calcres</a></code>,
<code><a href="#topic+plotres">plotres</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Definition of parameters:
# =========================

param    &lt;- list(k.gro.ALG   = 1,        # 1/d
                 k.gro.ZOO   = 0.8,      # m3/gDM/d
                 k.death.ALG = 0.4,      # 1/d
                 k.death.ZOO = 0.08,     # 1/d
                 K.HPO4      = 0.002,    # gP/m3
                 Y.ZOO       = 0.2,      # gDM/gDM
                 alpha.P.ALG = 0.002,    # gP/gDM
                 A           = 8.5e+006, # m2
                 h.epi       = 4,        # m
                 Q.in        = 4,        # m3/s
                 C.ALG.ini   = 0.05,     # gDM/m3
                 C.ZOO.ini   = 0.1,      # gDM/m3
                 C.HPO4.ini  = 0.02,     # gP/m3
                 C.HPO4.in   = 0.04)     # gP/m3             

# Definition of transformation processes:
# =======================================

# Growth of algae:
# ----------------

gro.ALG   &lt;- new(Class  = "process",
                 name   = "Growth of algae",
                 rate   = expression(k.gro.ALG
                                     *C.HPO4/(K.HPO4+C.HPO4)
                                     *C.ALG),
                 stoich = list(C.ALG  = expression(1),              # gDM/gDM
                               C.HPO4 = expression(-alpha.P.ALG)))  # gP/gDM

# Death of algae:
# ---------------

death.ALG &lt;- new(Class = "process",
                 name   = "Death of algae",
                 rate   = expression(k.death.ALG*C.ALG),
                 stoich = list(C.ALG  = expression(-1)))            # gDM/gDM

# Growth of zooplankton:
# ----------------------

gro.ZOO   &lt;- new(Class  = "process",
                 name   = "Growth of zooplankton",
                 rate   = expression(k.gro.ZOO
                                     *C.ALG
                                     *C.ZOO),
                 stoich = list(C.ZOO  = expression(1),              # gDM/gDM
                               C.ALG  = expression(-1/Y.ZOO)))      # gP/gDM

# Death of zooplankton:
# ---------------------

death.ZOO &lt;- new(Class  = "process",
                 name   = "Death of zooplankton",
                 rate   = expression(k.death.ZOO*C.ZOO),
                 stoich = list(C.ZOO  = expression(-1)))            # gDM/gDM

# Definition of reactor:
# ======================

# Epilimnion:
# -----------

epilimnion &lt;- 
   new(Class            = "reactor",
       name             = "Epilimnion",
       volume.ini       = expression(A*h.epi),
       conc.pervol.ini  = list(C.HPO4 = expression(C.HPO4.ini),     # gP/m3
                               C.ALG  = expression(C.ALG.ini),      # gDM/m3
                               C.ZOO  = expression(C.ZOO.ini)),     # gDM/m3
       inflow           = expression(Q.in*86400),                   # m3/d
       inflow.conc      = list(C.HPO4 = expression(C.HPO4.in),
                               C.ALG  = 0,
                               C.ZOO  = 0),
       outflow          = expression(Q.in*86400),
       processes        = list(gro.ALG,death.ALG,gro.ZOO,death.ZOO))
</code></pre>

<hr>
<h2 id='system-class'>Class <code>"system"</code></h2><span id='topic+system-class'></span>

<h3>Description</h3>

<p>This class represents a system consisting of linked reactors, substances/organisms in the reactors and transformation processes. <br /><br />
Once a model is described by an object of the class system (<code><a href="#topic+system-class">system-class</a></code>), simulations can be performed using the member function <br /><br />
<code><a href="#topic+calcres">calcres</a></code>, <br /><br />
This function integrates the system of ordinary differential equations numerically using the function <code><a href="deSolve.html#topic+ode">ode</a></code> of the package <code><a href="deSolve.html#topic+deSolve">deSolve</a></code> and produces time series of the volumes and substance and organisms concentrations as a R matrix.
The results can be visualized with arbitrary R functions or a summary of all results can be produced with the function <br /><br />
<code><a href="#topic+plotres">plotres</a></code>.
</p>


<h3>Objects from the Class</h3>

<p>Objects can be created by calls of the form <code>new("system", ...)</code>.
</p>


<h3>Slots</h3>


<dl>
<dt><code>name</code>:</dt><dd><p>Character string specifying the name of the system.</p>
</dd>
<dt><code>reactors</code>:</dt><dd><p>List of reactors that build the system.</p>
</dd>
<dt><code>links</code>:</dt><dd><p>List of links that connect the reactors.</p>
</dd>
<dt><code>cond</code>:</dt><dd><p>List of expressions that specify global environmental conditions to which all reactrs are exposed.</p>
</dd>
<dt><code>param</code>:</dt><dd><p>List of model parameters in the form of numerical values or lists of vectors for x and y values describing a realization of a time-dependent parameter.</p>
</dd>
<dt><code>t.out</code>:</dt><dd><p>Numeric vector of points in time at which output should be calculated.</p>
</dd>
</dl>



<h3>Methods</h3>


<dl>
<dt>calcres</dt><dd><p>Calculates simulation results, see <code><a href="#topic+calcres">calcres</a></code></p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Peter Reichert &lt;peter.reichert@emeriti.eawag.ch&gt;
</p>


<h3>References</h3>

<p>Omlin, M., Reichert, P. and Forster, R., Biogeochemical model of lake Zurich: Model equations and results, Ecological Modelling 141(1-3), 77-103, 2001. <br /><br />
Reichert, P., Borchardt, D., Henze, M., Rauch, W., Shanahan, P., Somlyody, L. and Vanrolleghem, P., River Water Quality Model no. 1 (RWQM1): II. Biochemical process equations, Water Sci. Tech. 43(5), 11-30, 2001. <br /><br />
Reichert, P. and Schuwirth, N., A generic framework for deriving process stoichiometry in environmental models, Environmental Modelling &amp; Software, 25, 1241-1251, 2010. <br /><br />
Soetaert, K., Petzoldt, T., and Woodrow Setzer, R. Solving differential equations in R: Package deSolve. Journal of Statistical Software, 33(9), 2010. <br /><br />
Soetaert, K., Cash, J., and Mazzia, F. Solving Differential Equations in R. Springer, Heidelberg, Germany. 2012.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+process-class">process-class</a></code>,
<code><a href="#topic+reactor-class">reactor-class</a></code>,
<code><a href="#topic+link-class">link-class</a></code>,
<code><a href="#topic+calcres">calcres</a></code>,
<code><a href="#topic+plotres">plotres</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Definition of parameters:
# =========================

param    &lt;- list(k.gro.ALG   = 1,        # 1/d
                 k.gro.ZOO   = 0.8,      # m3/gDM/d
                 k.death.ALG = 0.4,      # 1/d
                 k.death.ZOO = 0.08,     # 1/d
                 K.HPO4      = 0.002,    # gP/m3
                 Y.ZOO       = 0.2,      # gDM/gDM
                 alpha.P.ALG = 0.002,    # gP/gDM
                 A           = 8.5e+006, # m2
                 h.epi       = 4,        # m
                 Q.in        = 4,        # m3/s
                 C.ALG.ini   = 0.05,     # gDM/m3
                 C.ZOO.ini   = 0.1,      # gDM/m3
                 C.HPO4.ini  = 0.02,     # gP/m3
                 C.HPO4.in   = 0.04)     # gP/m3             

# Definition of transformation processes:
# =======================================

# Growth of algae:
# ----------------

gro.ALG   &lt;- new(Class  = "process",
                 name   = "Growth of algae",
                 rate   = expression(k.gro.ALG
                                     *C.HPO4/(K.HPO4+C.HPO4)
                                     *C.ALG),
                 stoich = list(C.ALG  = expression(1),              # gDM/gDM
                               C.HPO4 = expression(-alpha.P.ALG)))  # gP/gDM

# Death of algae:
# ---------------

death.ALG &lt;- new(Class = "process",
                 name   = "Death of algae",
                 rate   = expression(k.death.ALG*C.ALG),
                 stoich = list(C.ALG  = expression(-1)))            # gDM/gDM

# Growth of zooplankton:
# ----------------------

gro.ZOO   &lt;- new(Class  = "process",
                 name   = "Growth of zooplankton",
                 rate   = expression(k.gro.ZOO
                                     *C.ALG
                                     *C.ZOO),
                 stoich = list(C.ZOO  = expression(1),              # gDM/gDM
                               C.ALG  = expression(-1/Y.ZOO)))      # gP/gDM

# Death of zooplankton:
# ---------------------

death.ZOO &lt;- new(Class  = "process",
                 name   = "Death of zooplankton",
                 rate   = expression(k.death.ZOO*C.ZOO),
                 stoich = list(C.ZOO  = expression(-1)))            # gDM/gDM

# Definition of reactor:
# ======================

# Epilimnion:
# -----------

epilimnion &lt;- 
   new(Class            = "reactor",
       name             = "Epilimnion",
       volume.ini       = expression(A*h.epi),
       conc.pervol.ini  = list(C.HPO4 = expression(C.HPO4.ini),     # gP/m3
                               C.ALG  = expression(C.ALG.ini),      # gDM/m3
                               C.ZOO  = expression(C.ZOO.ini)),     # gDM/m3
       inflow           = expression(Q.in*86400),                   # m3/d
       inflow.conc      = list(C.HPO4 = expression(C.HPO4.in),
                               C.ALG  = 0,
                               C.ZOO  = 0),
       outflow          = expression(Q.in*86400),
       processes        = list(gro.ALG,death.ALG,gro.ZOO,death.ZOO))

# Definition of system:
# =====================

# Lake system:
# ------------

system &lt;- new(Class    = "system",
              name     = "Lake",
              reactors = list(epilimnion),
              param    = param,
              t.out    = seq(0,365,by=1))
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
