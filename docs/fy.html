<!DOCTYPE html><html><head><title>Help for package fy</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {fy}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#fy-package'><p>Utilities for financial years</p></a></li>
<li><a href='#is_fy'><p>Convenience functions for dealing with financial years</p></a></li>
<li><a href='#next_fy'><p>Next and previous financial years</p></a></li>
<li><a href='#validate_fys_permitted'><p>Verifying validity of financial years</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Utilities for Financial Years</td>
</tr>
<tr>
<td>Version:</td>
<td>0.4.2</td>
</tr>
<tr>
<td>Description:</td>
<td>In Australia, a financial year (or fiscal year) is the period from 1 July to 30 June
     of the following calendar year. As such, many databases need to represent and 
     validate financial years efficiently. While the use of integer years with a convention that  
     they represent the year ending is common, it may lead to ambiguity with calendar years.
     On the other hand, string representations may be too inefficient and do not easily admit
     arithmetic operations. This package tries to make validation of financial years quicker while
     retaining clarity.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.0</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.1.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>fastmatch, data.table, hutils, utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 2.1.0), withr, rlang, zoo, covr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-09-12 06:54:18 UTC; hughp</td>
</tr>
<tr>
<td>Author:</td>
<td>Hugh Parsonage [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Hugh Parsonage &lt;hugh.parsonage@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-09-12 08:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='fy-package'>Utilities for financial years</h2><span id='topic+fy'></span><span id='topic+fy-package'></span>

<h3>Description</h3>

<p>A financial year starts halfway through a calendar year.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Hugh Parsonage <a href="mailto:hugh.parsonage@gmail.com">hugh.parsonage@gmail.com</a>
</p>

<hr>
<h2 id='is_fy'>Convenience functions for dealing with financial years</h2><span id='topic+is_fy'></span><span id='topic+fy.year'></span><span id='topic+yr2fy'></span><span id='topic+fy2yr'></span><span id='topic+fy2date'></span><span id='topic+date2fy'></span><span id='topic+.yr2fy'></span><span id='topic+qtr2fy'></span>

<h3>Description</h3>

<p>Convenience functions for dealing with financial years
</p>


<h3>Usage</h3>

<pre><code class='language-R'>yr2fy(
  yr_ending,
  assume1901_2100 = .getOption("fy.assume1901_2100",
    .getOption("grattan.assume1901_2100", TRUE))
)

.yr2fy(yr_ending)

fy2yr(x, validate = TRUE)

fy2date(x, validate = TRUE)

date2fy(date)

qtr2fy(yq)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is_fy_+3A_yr_ending">yr_ending</code></td>
<td>
<p>An integer representing a year.</p>
</td></tr>
<tr><td><code id="is_fy_+3A_assume1901_2100">assume1901_2100</code></td>
<td>
<p>For <code>yr2fy</code>, assume that <code>yr_ending</code> is between 1901 and 2100,
for performance. By default, set to <code>getOption("fy.assume1901_2100", TRUE)</code>.</p>
</td></tr>
<tr><td><code id="is_fy_+3A_x">x</code></td>
<td>
<p>A character vector suspected to be a financial year.</p>
</td></tr>
<tr><td><code id="is_fy_+3A_validate">validate</code></td>
<td>
<p>If <code>TRUE</code>, the default, inputs that are expected to be financial years
are first validated. Validation should be very fast, though some use-cases may require this be skipped.</p>
</td></tr>
<tr><td><code id="is_fy_+3A_date">date</code></td>
<td>
<p>A string or date for which the financial year is desired. Note that <code>yr2fy</code> does not check its argument is an integer.</p>
</td></tr>
<tr><td><code id="is_fy_+3A_yq">yq</code></td>
<td>
<p>A character vector representing year quarters in <code>1066-Q2</code> format.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code><a href="#topic+valid-fys">valid-fys</a></code> for allowed forms of <code>x</code>.
</p>


<h3>Value</h3>

<p>For <code>is_fy</code>, a logical, whether its argument is a financial year.
The following forms are allowed: <code>2012-13</code>, <code>201213</code>, <code>2012 13</code>, as well as
<code>2012&lt;dash&gt;13</code> for some dash symbols.
For <code>fy.year</code>, <code>yr2fy</code>, and <code>date2fy</code>, the financial year.
For the inverses, a numeric corresponding to the year.
</p>
<p><code>fy.year</code> was an alias for <code>yr2fy</code>, and is now defunct.
</p>
<p><code>fy2yr</code> converts a financial year to the year ending: <code>fy2yr("2016-17")</code> returns 2017.
<code>yr2fy</code> is the inverse: <code>yr2fy(fy2yr("2016-17")) == "2016-17"</code>.
</p>
<p><code>fy2date</code> converts a financial year to the 30 June of the financial year ending.
</p>
<p><code>date2fy</code> converts a date to the corresponding financial year.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>is_fy("2012-13")
is_fy("2012-14")
yr2fy(2012)
fy2yr("2015-16")
date2fy("2014-08-09")
</code></pre>

<hr>
<h2 id='next_fy'>Next and previous financial years</h2><span id='topic+next_fy'></span><span id='topic+prev_fy'></span>

<h3>Description</h3>

<p>Next and previous financial years
</p>


<h3>Usage</h3>

<pre><code class='language-R'>next_fy(fy, h = 1L)

prev_fy(fy, h = 1L)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="next_fy_+3A_fy">fy</code></td>
<td>
<p>A financial year as a character vector.</p>
</td></tr>
<tr><td><code id="next_fy_+3A_h">h</code></td>
<td>
<p>An integer, the &quot;horizon&quot; to go forward (for <code>next_fy</code>) or
backward (for <code>prev_fy</code>).</p>
</td></tr>
</table>

<hr>
<h2 id='validate_fys_permitted'>Verifying validity of financial years</h2><span id='topic+validate_fys_permitted'></span><span id='topic+valid-fys'></span>

<h3>Description</h3>

<p>Many functions expect financial years.
Determining that they are validly entered is often quite
computationally costly, relative to the core calculations.
These internal functions provide mechanisms to check validity
quickly, while still providing clear, accurate error messages.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>validate_fys_permitted(
  to_verify,
  permitted_fys = NULL,
  min.yr = NULL,
  max.yr = NULL,
  deparsed = deparse(substitute(to_verify)),
  allow.projection = TRUE,
  earliest_permitted_financial_year = "earliest permitted financial year",
  latest_permitted_financial_year = "latest permitted financial year",
  .retain_fmatches = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="validate_fys_permitted_+3A_to_verify">to_verify</code></td>
<td>
<p>A user-provided value, purporting to be
character vector of financial years.</p>
</td></tr>
<tr><td><code id="validate_fys_permitted_+3A_permitted_fys">permitted_fys</code></td>
<td>
<p>A character vector of valid financial years.</p>
</td></tr>
<tr><td><code id="validate_fys_permitted_+3A_min.yr">min.yr</code>, <code id="validate_fys_permitted_+3A_max.yr">max.yr</code></td>
<td>
<p>Integers specifying the range of <code>to_verify</code>.
If <code>NULL</code>, no restriction on the upper or lower bound of the range.</p>
</td></tr>
<tr><td><code id="validate_fys_permitted_+3A_deparsed">deparsed</code></td>
<td>
<p>A string indicating the argument that the user provided.
Should generally be provided explicitly as the default is unlikely
to be user-friendly.</p>
</td></tr>
<tr><td><code id="validate_fys_permitted_+3A_allow.projection">allow.projection</code></td>
<td>
<p>If <code>FALSE</code> emit a different error message.</p>
</td></tr>
<tr><td><code id="validate_fys_permitted_+3A_earliest_permitted_financial_year">earliest_permitted_financial_year</code>, <code id="validate_fys_permitted_+3A_latest_permitted_financial_year">latest_permitted_financial_year</code></td>
<td>
<p>Text
for earliest/latest permitted financial year when <code>min.yr</code>/<code>max.yr</code>
condition is violated.</p>
</td></tr>
<tr><td><code id="validate_fys_permitted_+3A_.retain_fmatches">.retain_fmatches</code></td>
<td>
<p>If <code>TRUE</code>, the function may retain an attribute
<code>fy_fmatches</code>  an integer vector of the matches against the financial years
<code>"1900-01"</code> to <code>"2099-00"</code>. A trade-off between memory and runtime from
not recalculating matches.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The preferred form is <code>"2012-13"</code>, and this function
returns all elements of <code>to_verify</code> in this form. That is, it does
not preserve the input form.
</p>
<p>Other forms that are recognized (and converted) are:
</p>

<ul>
<li><p>&quot;201213&quot;
</p>
</li>
<li><p>&quot;2012 13&quot;
</p>
</li>
<li><p>&quot;2012<code>\u2011</code>13&quot;
</p>
</li>
<li><p>&quot;2012<code>\u2012</code>13&quot;
</p>
</li>
<li><p>&quot;2012<code>\u2013</code>13&quot;
</p>
</li>
<li><p>&quot;2012<code>\u2014</code>13&quot;
</p>
</li>
<li><p>&quot;2012-2013&quot;
</p>
</li></ul>



<h3>Value</h3>

<p>If <code>to_verify</code> contains valid financial years
they are returned all in the form <code>2013-14</code>. If they were
already in that form, they obtain the following attributes:
</p>

<dl>
<dt><code>fy_all_fy</code></dt><dd><p><code>TRUE</code> if all the financial years are valid.</p>
</dd>
<dt><code>fy_min_yr</code></dt><dd><p>An integer, the earliest year ending in <code>to_verify</code>.</p>
</dd>
<dt><code>fy_max_yr</code></dt><dd><p>An integer, the latest year ending in <code>to_verify</code>.</p>
</dd>
<dt><code>fy_fmatches</code></dt><dd><p>An integer vector, the matches with the prebuilt financial years.</p>
</dd>
</dl>



<h3>Benchmarks</h3>

<pre>
 x &lt;- rep_len(yr2fy(2004L), 1e9)
 bench::system_time(validate_fys_permitted(x))
 #&gt; process    real
 #&gt;  3.578s  3.576s
 x &lt;- rep_len(yr2fy(1980:2016), 1e9)

 bench::system_time(validate_fys_permitted(x))
 #&gt; process    real
 #&gt;  3.766s  3.753s
</pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
