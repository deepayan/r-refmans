<!DOCTYPE html><html lang="en"><head><title>Help for package magmaR</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {magmaR}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#authentication-and-environments'><p>Starting out and working with different Etna environments</p></a></li>
<li><a href='#magmaRset'><p>Set up your magma environment and authentication</p></a></li>
<li><a href='#query'><p>Search-like function that can obtain linked data from distinct models.</p></a></li>
<li><a href='#retrieve'><p>Download data from magma as a tsv, and convert to a data.frame</p></a></li>
<li><a href='#retrieve_SpecialCases'><p>Helper functions that utilize special cases of magma /retrieve</p></a></li>
<li><a href='#retrieveJSON'><p>Download data from magma as a json, and convert to a list</p></a></li>
<li><a href='#retrieveMatrix'><p>Download data from magma that is stored as a matrix</p></a></li>
<li><a href='#retrieveMetadata'><p>Download data from magma of one model, but transformed into the shape of a different model's records.</p></a></li>
<li><a href='#retrieveProjects'><p>Helper function that retrieves all the projectName options which a user has access to, from janus.</p></a></li>
<li><a href='#updateFromDF'><p>Easier to use wrapper of <code>updateValues</code></p></a></li>
<li><a href='#updateMatrix'><p>A matrix-specific wrapper of <code>updateValues</code></p></a></li>
<li><a href='#updateValues'><p>Analogous to the '/update' function of magma</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>R-Client for Interacting with the 'UCSF Data Library'</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.3</td>
</tr>
<tr>
<td>Description:</td>
<td>A client for interacting with 'magma', the data warehouse of the
    'UCSF Data Library'. 'magmaR' includes functions for querying and
    downloading data from 'magma', in order to enable working with such data in
    R, as well as for uploading local data to 'magma'.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>crul, jsonlite, utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>dittoSeq, BiocStyle, vcr, webmockr, testthat, knitr,
rmarkdown</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-01-24 23:44:26 UTC; dan</td>
</tr>
<tr>
<td>Author:</td>
<td>Daniel Bunis [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Daniel Bunis &lt;daniel.bunis@ucsf.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-01-25 00:00:03 UTC</td>
</tr>
</table>
<hr>
<h2 id='authentication-and-environments'>Starting out and working with different Etna environments</h2><span id='topic+authentication-and-environments'></span>

<h3>Description</h3>

<p>Starting out and working with different Etna environments
</p>


<h3>Authorization via 'token's</h3>

<p>Access to magma via magmaR is authenticated via 'token's which users can obtain from Janus.
A valid token must be provided to magmaR before any calls to magma can be successfully performed.
To provide this token, users should obtain their token from Janus, then provide it to magmaR functions using the <code><a href="#topic+magmaRset">magmaRset</a></code> function.
See the function's own documentation and other functions' examples for further details and usage code.
</p>


<h3>Non-production Environments</h3>

<p>The code base relies on 2 different ecosystems of all of its components for purposes of
&quot;development&quot; of new tools and features, and
&quot;production&quot;, the release version which most users see.
We won't get into the details too much more here, but users with access to the development environment can access it magmaR.
</p>
<p>To do so, users should provide the <code>url</code> of their alternative version of magma to magmaR functions using the <code><a href="#topic+magmaRset">magmaRset</a></code> function.
If proxy or other curl-request settings need to be adjusted, users can provide these via the <code>opts</code> input of this same <code><a href="#topic+magmaRset">magmaRset</a></code> function.
At a minimum, you will likely want to use <code>opts = list(ssl_verifyhost = FALSE, ssl_verifypeer = FALSE)</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+magmaRset">magmaRset</a></code>
</p>

<hr>
<h2 id='magmaRset'>Set up your magma environment and authentication</h2><span id='topic+magmaRset'></span>

<h3>Description</h3>

<p>Set up your magma environment and authentication
</p>


<h3>Usage</h3>

<pre><code class='language-R'>magmaRset(
  token = NULL,
  url = "https://magma.ucsf.edu",
  opts = list(followlocation = FALSE)
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="magmaRset_+3A_token">token</code></td>
<td>
<p>Single string. Your personal token from <a href="https://janus.ucsf.edu">https://janus.ucsf.edu</a>. 
</p>
<p>When not explicitly given, you will be prompted to input it via the console.</p>
</td></tr>
<tr><td><code id="magmaRset_+3A_url">url</code></td>
<td>
<p>Single string. The url of the production, staging, or development version of magma that you you would like to target.
See <code><a href="#topic+authentication-and-environments">authentication-and-environments</a></code> for more information.</p>
</td></tr>
<tr><td><code id="magmaRset_+3A_opts">opts</code></td>
<td>
<p>A named list of curl options and the values to give them (ex: <code>list(followlocation = FALSE, othersetting = 42)</code>).
Generally, most users can ignore this input, but it can be useful for adjusting proxy settings for particular development environment setup.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function compiles a list, from the given inputs, of the information needed by other <code>magmaR</code> functions
to properly route and authenticate a call to magma.
</p>


<h3>Value</h3>

<p>A list with three components: token, url, and opts.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if (interactive()) {
    
    # THE DEFAULT:
    # When run in this way, it will ask you to give your token.
    # And the resulting $url will be the standard, production, magma url.
    prod &lt;- magmaRset()
    print(prod)
         
    # TARGET = staging:
    # Give the proper url.
    # Again, because we are not providing our token to the call, it will ask.
    stage &lt;- magmaRset(url = "https://magma-stage.ucsf.edu")
    print(stage)
    
    # We can also give additional curl options to the 'opts' input:
    prod_opts &lt;- magmaRset(token = prod$token,
        opts = list(proxyport = 1234))
    print(prod_opts)
    
    # Now we can retrieve data with...
    retrieve(
        target = prod,
        projectName = "example",
        modelName = "rna_seq",
        recordNames = "all",
        attributeNames = "all",
        filter = "")
}

</code></pre>

<hr>
<h2 id='query'>Search-like function that can obtain linked data from distinct models.</h2><span id='topic+query'></span>

<h3>Description</h3>

<p>Analogous to the '/query' function of magma.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>query(target, projectName, queryTerms = list(), format = c("list", "df"), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="query_+3A_target">target</code></td>
<td>
<p>A list, which can be created using <code><a href="#topic+magmaRset">magmaRset</a></code>, containing your authorization 'token' (a string), a 'url' of magma to target (a string), and optional 'opts' for specifying additions parameters for curl requests (a named list).</p>
</td></tr>
<tr><td><code id="query_+3A_projectname">projectName</code></td>
<td>
<p>Single string. The name of the project you would like to interact with. For options, see <code><a href="#topic+retrieveProjects">retrieveProjects</a></code>.</p>
</td></tr>
<tr><td><code id="query_+3A_queryterms">queryTerms</code></td>
<td>
<p>A list of strings where list elements are query predicates and verbs. See <a href="https://mountetna.github.io/magma.html#query">https://mountetna.github.io/magma.html#query</a> for details.</p>
</td></tr>
<tr><td><code id="query_+3A_format">format</code></td>
<td>
<p>Either &quot;list&quot; or &quot;df&quot; (=dataframe). This sets the desired output format. The list option is the more raw form.</p>
</td></tr>
<tr><td><code id="query_+3A_...">...</code></td>
<td>
<p>Additional parameters passed along to the internal '.retrieve()', '.query()', or '.update()' functions,
for troubleshooting or advanced-user purposes only: </p>

<ul>
<li> <p><code>request.only</code> (Logical) &amp; <code>json.params.only</code> (Logical) which 1) stop the function before its main curl request to magma and 2) returns the values that would have been sent to magma in either of two formats.
</p>
</li>
<li> <p><code>verbose</code> (Logical) sets whether to report the status of the curl request after it is performed.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>This function initially mimics the activity of the magma's /query functionality,
which is documented here <a href="https://mountetna.github.io/magma.html#query">https://mountetna.github.io/magma.html#query</a>.
</p>
<p>Afterwards, the json list output of magma/query is converted into an R list, and then the <code>format</code> input determines whether it should be wrangled further:
</p>

<ul>
<li> <p><code>format = "list"</code>, default: R list output directly.
</p>
</li>
<li> <p><code>format = "df"</code>: R list converted into a dataframe where data comes from the list$answer and column names come from the list$format
</p>
</li></ul>



<h3>Value</h3>

<p>A list, default, if <code>format == "list"</code>,
</p>
<p>OR A dataframe conversion if <code>format = "df"</code>
</p>


<h3>See Also</h3>

<p><a href="https://mountetna.github.io/magma.html#query">https://mountetna.github.io/magma.html#query</a> for documentation of the underlying magma/query function.
</p>
<p><code><a href="#topic+retrieveProjects">retrieveProjects</a></code> for exploring options for the <code>projectName</code> input.
</p>
<p><code><a href="#topic+retrieveModels">retrieveModels</a></code>, <code><a href="#topic+retrieveIds">retrieveIds</a></code>, and <code><a href="#topic+retrieveAttributes">retrieveAttributes</a></code> and <code><a href="#topic+retrieveTemplate">retrieveTemplate</a></code> for exploring the project structure and determining <code>queryTerm</code> options.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if (interactive()) {
    # First, we use magmaRset to create an object which will tell other magmaR
    #  functions our authentication token (as well as some other optional bits).
    # When run in this way, it will ask you to give your token.
    magma &lt;- magmaRset()
    
    ### To obtain the 'group' attribute, from the subject-model, that are
    #   associated with records of the rna_seq-model:

    # "Raw" output of query:
    query_list &lt;- query(
        target = magma,
        projectName = "example",
        queryTerms = 
            list('rna_seq',
                 '::all',
                 'biospecimen',
                 'subject',
                 'group'))
    print(query_list)
                 
    # Or instead re-formatted to a dataframe, which may be easier for
    #   downstream applications in R:
    query_df &lt;- query(
        target = magma,
        projectName = "example",
        queryTerms = 
            list('rna_seq',
                 '::all',
                 'biospecimen',
                 'subject',
                 'group'),
        format = 'df')
    print(query_df)
}

</code></pre>

<hr>
<h2 id='retrieve'>Download data from magma as a tsv, and convert to a data.frame</h2><span id='topic+retrieve'></span>

<h3>Description</h3>

<p>Analogous to the '/retrieve' function of magma, with <code>format = "tsv"</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>retrieve(
  target,
  projectName,
  modelName,
  recordNames = "all",
  attributeNames = "all",
  filter = "",
  page = NULL,
  pageSize = 10,
  showDisconnected = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="retrieve_+3A_target">target</code></td>
<td>
<p>A list, which can be created using <code><a href="#topic+magmaRset">magmaRset</a></code>, containing your authorization 'token' (a string), a 'url' of magma to target (a string), and optional 'opts' for specifying additions parameters for curl requests (a named list).</p>
</td></tr>
<tr><td><code id="retrieve_+3A_projectname">projectName</code></td>
<td>
<p>Single string. The name of the project you would like to interact with. For options, see <code><a href="#topic+retrieveProjects">retrieveProjects</a></code>.</p>
</td></tr>
<tr><td><code id="retrieve_+3A_modelname">modelName</code></td>
<td>
<p>Single string. The name of the subset data structure within the project, which are referred to as 'model's in magma, to interact with.
For options, see <code><a href="#topic+retrieveModels">retrieveModels</a></code> or https://timur.ucsf.edu/&lt;projectName&gt;/map.</p>
</td></tr>
<tr><td><code id="retrieve_+3A_recordnames">recordNames</code></td>
<td>
<p>Single string or string vector indicating which particular sample/tube/etc. records to target.
Options are &quot;all&quot; or any combination of individual record names. To retrieve individual options, see <code><a href="#topic+retrieveIds">retrieveIds</a></code>.</p>
</td></tr>
<tr><td><code id="retrieve_+3A_attributenames">attributeNames</code></td>
<td>
<p>Single string or string vector indicating which features of the data to target.
Options are &quot;all&quot; or any combination of individual attribute names. To retrieve individual options, see <code><a href="#topic+retrieveAttributes">retrieveAttributes</a></code>.</p>
</td></tr>
<tr><td><code id="retrieve_+3A_filter">filter</code></td>
<td>
<p>String. Potential filter(s) of the data.
Example: &quot;&lt;targetAttributeName&gt;~GYN&quot; to filter to records where &lt;targetAttributeName&gt; contains &quot;GYN&quot;.
</p>
<p>Refer to <a href="https://mountetna.github.io/magma.html#retrieve">https://mountetna.github.io/magma.html#retrieve</a> for more details about options and format.</p>
</td></tr>
<tr><td><code id="retrieve_+3A_page">page</code></td>
<td>
<p>Integer. For retrieving just a portion of the data, sets which slice to get.</p>
</td></tr>
<tr><td><code id="retrieve_+3A_pagesize">pageSize</code></td>
<td>
<p>Integer. For retrieving just a portion of the data, sets slice/page size, which is equivalent to the a number of rows.</p>
</td></tr>
<tr><td><code id="retrieve_+3A_showdisconnected">showDisconnected</code></td>
<td>
<p>Boolean. Set to true to access &quot;disconnected&quot; records, which are records that are missing an (upstream) parent linkage, and so do not connect up with the project's top-level project record.
Generally, disconnected records are ones that were deemed low quality in some way, thus were purposefully disconnected from the rest of the dataset.
But sometimes a record might just be disconnected because an upload went awry.</p>
</td></tr>
<tr><td><code id="retrieve_+3A_...">...</code></td>
<td>
<p>Additional parameters passed along to the internal '.retrieve()', '.query()', or '.update()' functions,
for troubleshooting or advanced-user purposes only: </p>

<ul>
<li> <p><code>request.only</code> (Logical) &amp; <code>json.params.only</code> (Logical) which 1) stop the function before its main curl request to magma and 2) returns the values that would have been sent to magma in either of two formats.
</p>
</li>
<li> <p><code>verbose</code> (Logical) sets whether to report the status of the curl request after it is performed.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>This function makes a curl get request to magma/retrieve, with properly reformatted versions of user inputs, plus <code>format = "tsv"</code>.
Then, it converts the tsv-string output into a dataframe.
</p>
<p>Note: When <code>format = "tsv"</code>, magma/retrieve returns just an identifier for matrix-type attributes.
To retrieve underlying data for such attributes, use the specialized <code><a href="#topic+retrieveMatrix">retrieveMatrix</a></code> function.
</p>


<h3>Value</h3>

<p>A dataframe
</p>


<h3>See Also</h3>

<p><code><a href="#topic+retrieveMatrix">retrieveMatrix</a></code> for retrieving attributes of type matrix.
</p>
<p><code><a href="#topic+retrieveJSON">retrieveJSON</a></code> for similar functionality to <code>retrieve</code>, but where the call to magma/retrieve is made with <code>format = "json"</code> and the output is a list.
This output often contains more information, and can retrieve data for attribute types of type matrix, which are not returned by the current function.
But in most cases, the data returned by <code>retrieve</code> and <code>retrieveMatrix</code> will suffice.
</p>
<p><a href="https://mountetna.github.io/magma.html#retrieve">https://mountetna.github.io/magma.html#retrieve</a> for documentation of the underlying magma/retrieve function.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if (interactive()) {
    # First, we use magmaRset to create an object which will tell other magmaR
    #  functions our authentication token (as well as some other optional bits).
    # When run in this way, it will ask you to give your token.
    magma &lt;- magmaRset()
    
    # Now we can retrieve data with...
    retrieve(
        target = magma,
        projectName = "example",
        modelName = "rna_seq",
        recordNames = "all",
        attributeNames = "all",
        filter = "")
}

</code></pre>

<hr>
<h2 id='retrieve_SpecialCases'>Helper functions that utilize special cases of magma /retrieve</h2><span id='topic+retrieve_SpecialCases'></span><span id='topic+retrieveTemplate'></span><span id='topic+retrieveModels'></span><span id='topic+retrieveIds'></span><span id='topic+retrieveAttributes'></span>

<h3>Description</h3>

<p>Helper functions that utilize special cases of magma /retrieve
</p>


<h3>Usage</h3>

<pre><code class='language-R'>retrieveTemplate(target, projectName, ...)

retrieveModels(target, projectName, ...)

retrieveIds(target, projectName, modelName, ...)

retrieveAttributes(target, projectName, modelName, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="retrieve_SpecialCases_+3A_target">target</code></td>
<td>
<p>A list, which can be created using <code><a href="#topic+magmaRset">magmaRset</a></code>, containing your authorization 'token' (a string), a 'url' of magma to target (a string), and optional 'opts' for specifying additions parameters for curl requests (a named list).</p>
</td></tr>
<tr><td><code id="retrieve_SpecialCases_+3A_projectname">projectName</code></td>
<td>
<p>Single string. The name of the project you would like to interact with. For options, see <code><a href="#topic+retrieveProjects">retrieveProjects</a></code>.</p>
</td></tr>
<tr><td><code id="retrieve_SpecialCases_+3A_...">...</code></td>
<td>
<p>Additional parameters passed along to the internal '.retrieve()', '.query()', or '.update()' functions,
for troubleshooting or advanced-user purposes only: </p>

<ul>
<li> <p><code>request.only</code> (Logical) &amp; <code>json.params.only</code> (Logical) which 1) stop the function before its main curl request to magma and 2) returns the values that would have been sent to magma in either of two formats.
</p>
</li>
<li> <p><code>verbose</code> (Logical) sets whether to report the status of the curl request after it is performed.
</p>
</li></ul>
</td></tr>
<tr><td><code id="retrieve_SpecialCases_+3A_modelname">modelName</code></td>
<td>
<p>Single string. The name of the subset data structure within the project, which are referred to as 'model's in magma, to interact with.
For options, see <code><a href="#topic+retrieveModels">retrieveModels</a></code> or https://timur.ucsf.edu/&lt;projectName&gt;/map.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>These functions aim to help users determine acceptable inputs to other magmaR functions without needing to leave R.
</p>
<p>They make properly crafted calls to <code><a href="#topic+retrieve">retrieve</a></code> which target either the &quot;template&quot; or &quot;identifier&quot; special cases outlined in <a href="https://mountetna.github.io/magma.html#retrieve">https://mountetna.github.io/magma.html#retrieve</a>,
followed by directly returning the output (<code>retrieveTemplate</code> and <code>retrieveIds</code>),
by returning just a targeted portion of that output (<code>retrieveModels</code>),
or by returning a targeted portion of a subsequent single-record call to <code><a href="#topic+retrieve">retrieve</a></code> (<code>retrieveAttributes</code>).
</p>


<h3>Value</h3>

<p>retrieveTemplate = a list conversion of the project's template json.
</p>
<p>retrieveModels = a string vector of model names
</p>
<p>retrieveIds = a string vector of record names/identifiers.
</p>
<p>retrieveAttributes = a string vector of attribute names.
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>retrieveTemplate()</code>: Retrieve the template for a given project
</p>
</li>
<li> <p><code>retrieveModels()</code>: Retrieve the modelNames for a given project
</p>
</li>
<li> <p><code>retrieveIds()</code>: Retrieve all the identifiers/recordNames for a given project-model pair.
</p>
</li>
<li> <p><code>retrieveAttributes()</code>: Retrieve all the attribute options for a given project-model pair.
</p>
</li></ul>


<h3>Examples</h3>

<pre><code class='language-R'>
if (interactive()) {
    # First, we use magmaRset to create an object which will tell other magmaR
    #  functions our authentication token (as well as some other optional bits).
    # When run in this way, it will ask you to give your token.
    magma &lt;- magmaRset()
    
    template &lt;- retrieveTemplate(
        target = magma,
        projectName = "example")
    str(template, max.level = 4)
        
    models &lt;- retrieveModels(
        target = magma,
        projectName = "example")
    print(models)    

    ids &lt;- retrieveIds(
        target = magma,
        projectName = "example",
        modelName = "rna_seq")
    print(ids)
        
    atts &lt;- retrieveAttributes(
        target = magma,
        projectName = "example",
        modelName = "subject")
    print(atts)
}
</code></pre>

<hr>
<h2 id='retrieveJSON'>Download data from magma as a json, and convert to a list</h2><span id='topic+retrieveJSON'></span>

<h3>Description</h3>

<p>Analogous to the '/retrieve' function of magma, with <code>format = "json"</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>retrieveJSON(
  target,
  projectName,
  modelName,
  recordNames = "all",
  attributeNames = "all",
  filter = "",
  page = NULL,
  pageSize = 10,
  showDisconnected = FALSE,
  hideTemplate = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="retrieveJSON_+3A_target">target</code></td>
<td>
<p>A list, which can be created using <code><a href="#topic+magmaRset">magmaRset</a></code>, containing your authorization 'token' (a string), a 'url' of magma to target (a string), and optional 'opts' for specifying additions parameters for curl requests (a named list).</p>
</td></tr>
<tr><td><code id="retrieveJSON_+3A_projectname">projectName</code></td>
<td>
<p>Single string. The name of the project you would like to interact with. For options, see <code><a href="#topic+retrieveProjects">retrieveProjects</a></code>.</p>
</td></tr>
<tr><td><code id="retrieveJSON_+3A_modelname">modelName</code></td>
<td>
<p>Single string. The name of the subset data structure within the project, which are referred to as 'model's in magma, to interact with.
For options, see <code><a href="#topic+retrieveModels">retrieveModels</a></code> or https://timur.ucsf.edu/&lt;projectName&gt;/map.</p>
</td></tr>
<tr><td><code id="retrieveJSON_+3A_recordnames">recordNames</code></td>
<td>
<p>Single string or string vector indicating which particular sample/tube/etc. records to target.
Options are &quot;all&quot; or any combination of individual record names. To retrieve individual options, see <code><a href="#topic+retrieveIds">retrieveIds</a></code>.</p>
</td></tr>
<tr><td><code id="retrieveJSON_+3A_attributenames">attributeNames</code></td>
<td>
<p>Single string or string vector indicating which features of the data to target.
Options are &quot;all&quot; or any combination of individual attribute names. To retrieve individual options, see <code><a href="#topic+retrieveAttributes">retrieveAttributes</a></code>.</p>
</td></tr>
<tr><td><code id="retrieveJSON_+3A_filter">filter</code></td>
<td>
<p>String. Potential filter(s) of the data.
Example: &quot;&lt;targetAttributeName&gt;~GYN&quot; to filter to records where &lt;targetAttributeName&gt; contains &quot;GYN&quot;.
</p>
<p>Refer to <a href="https://mountetna.github.io/magma.html#retrieve">https://mountetna.github.io/magma.html#retrieve</a> for more details about options and format.</p>
</td></tr>
<tr><td><code id="retrieveJSON_+3A_page">page</code></td>
<td>
<p>Integer. For retrieving just a portion of the data, sets which slice to get.</p>
</td></tr>
<tr><td><code id="retrieveJSON_+3A_pagesize">pageSize</code></td>
<td>
<p>Integer. For retrieving just a portion of the data, sets slice/page size, which is equivalent to the a number of rows.</p>
</td></tr>
<tr><td><code id="retrieveJSON_+3A_showdisconnected">showDisconnected</code></td>
<td>
<p>Boolean. Set to true to access &quot;disconnected&quot; records, which are records that are missing an (upstream) parent linkage, and so do not connect up with the project's top-level project record.
Generally, disconnected records are ones that were deemed low quality in some way, thus were purposefully disconnected from the rest of the dataset.
But sometimes a record might just be disconnected because an upload went awry.</p>
</td></tr>
<tr><td><code id="retrieveJSON_+3A_hidetemplate">hideTemplate</code></td>
<td>
<p>Logical. Allows to leave out the project template from the return. Often this does not matter much, but the template can be bulky.</p>
</td></tr>
<tr><td><code id="retrieveJSON_+3A_...">...</code></td>
<td>
<p>Additional parameters passed along to the internal '.retrieve()', '.query()', or '.update()' functions,
for troubleshooting or advanced-user purposes only: </p>

<ul>
<li> <p><code>request.only</code> (Logical) &amp; <code>json.params.only</code> (Logical) which 1) stop the function before its main curl request to magma and 2) returns the values that would have been sent to magma in either of two formats.
</p>
</li>
<li> <p><code>verbose</code> (Logical) sets whether to report the status of the curl request after it is performed.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>This function makes a call to magma/retrieve with <code>format = "json"</code>.
Then, it converts the json output into a list which is more compatible with R.
</p>


<h3>Value</h3>

<p>A list
</p>


<h3>See Also</h3>

<p><code><a href="#topic+retrieve">retrieve</a></code> for similar functionality, but where the call to magma/retrieve will be made with <code>format = "tsv"</code> and the output is a dataframe.
</p>
<p><code><a href="#topic+retrieveMatrix">retrieveMatrix</a></code> for matrix data-targeted utilization of this current <code>retreiveJSON</code> function, followed by automated restructuring of the return into a matrix format.
</p>
<p><a href="https://mountetna.github.io/magma.html#retrieve">https://mountetna.github.io/magma.html#retrieve</a> for documentation of the underlying magma/retrieve function.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if (interactive()) {
    # First, we use magmaRset to create an object which will tell other magmaR
    #  functions our authentication token (as well as some other optional bits).
    # When run in this way, it will ask you to give your token.
    magma &lt;- magmaRset()
    
    # Now we can retrieve data as json (-&gt;list) with...
    json_out &lt;- retrieveJSON(
        target = magma,
        projectName = "example",
        modelName = "rna_seq",
        recordNames = "all",
        attributeNames = "all",
        filter = "")
    # The return will be a nested list with data in a 'documents' element and
    #  some extra information about each attribute in a 'template' element.
    str(json_out, max.level = 4)

    # Often, the 'template' part is bulky but not needed, so its retrieval may
    #  be turned off by giving hideTemplaate = TRUE'
    json_out &lt;- retrieveJSON(
        target = magma,
        projectName = "example",
        modelName = "rna_seq",
        recordNames = "all",
        attributeNames = "all",
        filter = "",
        hideTemplate = TRUE)
    str(json_out, max.level = 4)
}

</code></pre>

<hr>
<h2 id='retrieveMatrix'>Download data from magma that is stored as a matrix</h2><span id='topic+retrieveMatrix'></span>

<h3>Description</h3>

<p>Download data from magma that is stored as a matrix
</p>


<h3>Usage</h3>

<pre><code class='language-R'>retrieveMatrix(
  target,
  projectName,
  modelName,
  recordNames = "all",
  attributeNames,
  filter = "",
  page = NULL,
  pageSize = 10,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="retrieveMatrix_+3A_target">target</code></td>
<td>
<p>A list, which can be created using <code><a href="#topic+magmaRset">magmaRset</a></code>, containing your authorization 'token' (a string), a 'url' of magma to target (a string), and optional 'opts' for specifying additions parameters for curl requests (a named list).</p>
</td></tr>
<tr><td><code id="retrieveMatrix_+3A_projectname">projectName</code></td>
<td>
<p>Single string. The name of the project you would like to interact with. For options, see <code><a href="#topic+retrieveProjects">retrieveProjects</a></code>.</p>
</td></tr>
<tr><td><code id="retrieveMatrix_+3A_modelname">modelName</code></td>
<td>
<p>Single string. The name of the subset data structure within the project, which are referred to as 'model's in magma, to interact with.
For options, see <code><a href="#topic+retrieveModels">retrieveModels</a></code> or https://timur.ucsf.edu/&lt;projectName&gt;/map.</p>
</td></tr>
<tr><td><code id="retrieveMatrix_+3A_recordnames">recordNames</code></td>
<td>
<p>Single string or string vector indicating which particular sample/tube/etc. records to target.
Options are &quot;all&quot; or any combination of individual record names. To retrieve individual options, see <code><a href="#topic+retrieveIds">retrieveIds</a></code>.</p>
</td></tr>
<tr><td><code id="retrieveMatrix_+3A_attributenames">attributeNames</code></td>
<td>
<p>Single string or string vector indicating which features of the data to target.
Options are &quot;all&quot; or any combination of individual attribute names. To retrieve individual options, see <code><a href="#topic+retrieveAttributes">retrieveAttributes</a></code>.</p>
</td></tr>
<tr><td><code id="retrieveMatrix_+3A_filter">filter</code></td>
<td>
<p>String. Potential filter(s) of the data.
Example: &quot;&lt;targetAttributeName&gt;~GYN&quot; to filter to records where &lt;targetAttributeName&gt; contains &quot;GYN&quot;.
</p>
<p>Refer to <a href="https://mountetna.github.io/magma.html#retrieve">https://mountetna.github.io/magma.html#retrieve</a> for more details about options and format.</p>
</td></tr>
<tr><td><code id="retrieveMatrix_+3A_page">page</code></td>
<td>
<p>Integer. For retrieving just a portion of the data, sets which slice to get.</p>
</td></tr>
<tr><td><code id="retrieveMatrix_+3A_pagesize">pageSize</code></td>
<td>
<p>Integer. For retrieving just a portion of the data, sets slice/page size, which is equivalent to the a number of rows.</p>
</td></tr>
<tr><td><code id="retrieveMatrix_+3A_...">...</code></td>
<td>
<p>Additional parameters passed along to the internal '.retrieve()', '.query()', or '.update()' functions,
for troubleshooting or advanced-user purposes only: </p>

<ul>
<li> <p><code>request.only</code> (Logical) &amp; <code>json.params.only</code> (Logical) which 1) stop the function before its main curl request to magma and 2) returns the values that would have been sent to magma in either of two formats.
</p>
</li>
<li> <p><code>verbose</code> (Logical) sets whether to report the status of the curl request after it is performed.
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>a matrix
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if (interactive()) {
    # First, we use magmaRset to create an object which will tell other magmaR
    #  functions our authentication token (as well as some other optional bits).
    # When run in this way, it will ask you to give your token.
    magma &lt;- magmaRset()
    
    retrieveMatrix(
        target = magma,
        projectName = "example",
        modelName = "rna_seq",
        recordNames = "all",
        attributeNames = "gene_counts")
}

</code></pre>

<hr>
<h2 id='retrieveMetadata'>Download data from magma of one model, but transformed into the shape of a different model's records.</h2><span id='topic+retrieveMetadata'></span>

<h3>Description</h3>

<p>Retrieve data from one model (&quot;meta&quot;) transformed into the shape of linked records of a different model (&quot;target&quot;).
For example, one could get subject-level information for an RNAseq counts matrix with this function.
The output would contain columns of subject-level attributes, and rows that are the RNAseq-model records.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>retrieveMetadata(
  target,
  projectName,
  meta_modelName,
  meta_attributeNames = "all",
  target_modelName,
  target_recordNames = "all",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="retrieveMetadata_+3A_target">target</code></td>
<td>
<p>A list, which can be created using <code><a href="#topic+magmaRset">magmaRset</a></code>, containing your authorization 'token' (a string), a 'url' of magma to target (a string), and optional 'opts' for specifying additions parameters for curl requests (a named list).</p>
</td></tr>
<tr><td><code id="retrieveMetadata_+3A_projectname">projectName</code></td>
<td>
<p>Single string. The name of the project you would like to interact with. For options, see <code><a href="#topic+retrieveProjects">retrieveProjects</a></code>.</p>
</td></tr>
<tr><td><code id="retrieveMetadata_+3A_meta_modelname">meta_modelName</code>, <code id="retrieveMetadata_+3A_meta_attributenames">meta_attributeNames</code></td>
<td>
<p>Strings which indicate the &quot;meta&quot;data to retrieve.
They work the same as inputs of other functions without the <code>meta_</code> portion.</p>
</td></tr>
<tr><td><code id="retrieveMetadata_+3A_target_modelname">target_modelName</code>, <code id="retrieveMetadata_+3A_target_recordnames">target_recordNames</code></td>
<td>
<p>Strings which indicate the &quot;target&quot; data that meta-data is desired to be reshaped into.
They work the same as inputs of other functions without the <code>target_</code> portion, and
these inputs ultimately set which records of &quot;meta&quot; model data to actually obtain.</p>
</td></tr>
<tr><td><code id="retrieveMetadata_+3A_...">...</code></td>
<td>
<p>Additional parameters passed along to the internal '.retrieve()', '.query()', or '.update()' functions,
for troubleshooting or advanced-user purposes only: </p>

<ul>
<li> <p><code>request.only</code> (Logical) &amp; <code>json.params.only</code> (Logical) which 1) stop the function before its main curl request to magma and 2) returns the values that would have been sent to magma in either of two formats.
</p>
</li>
<li> <p><code>verbose</code> (Logical) sets whether to report the status of the curl request after it is performed.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>This function retrieves data from one model (the &quot;meta&quot; model) transformed so that rows of the returned dataframe correspond to records of a different model (the &quot;target&quot; model).
</p>
<p>Internally, it first determines the path, through child-parent model linkages, to navigate from the meta_model to the target_model.
</p>
<p>Then, it performs calls to <code><a href="#topic+query">query</a></code> in order to retrieve identifier linkage along that path.
The identifier linkage is turned into a dataframe of identifier traces.
</p>
<p>Next, it performs a call to <code><a href="#topic+retrieve">retrieve</a></code> to obtain the wanted metadata as a dataframe.
</p>
<p>(If linkage paths would create any 1:many mappings of target data records to metadata records, data of extra records are shifted &quot;rightwards&quot; into columns appended with &quot;_#&quot; in their names.
This is a reliable, though imperfect, method so we hope to implement alternatives in the future.)
</p>
<p>Finally, the dataframe of linkage path identifiers is merged with the metadata dataframe, reshaping the metadata to properly have one row per requested <code>target_recordName</code>.
</p>


<h3>Value</h3>

<p>A dataframe with rows = <code>target_recordNames</code> and columns = model identifiers and either <code>meta_attributeNames</code> or repeats of <code>meta_attributeNames_#</code> when there are 1:many mappings of target data records to metadata records.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+retrieve">retrieve</a></code> and <code><a href="#topic+retrieveMatrix">retrieveMatrix</a></code> which will likely be useful for retrieving associated &quot;target&quot; data.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if (interactive()) {
    # First, we use magmaRset to create an object which will tell other magmaR
    #  functions our authentication token (as well as some other optional bits).
    # When run in this way, it will ask you to give your token.
    magma &lt;- magmaRset()
    
    # Running like this will ask for input of your janus token one time.
    retrieveMetadata(
        target = magma,
        projectName = "example",
        meta_modelName = "subject",
        meta_attributeNames = "group",
        target_modelName = "rna_seq",
        target_recordNames = "all")
}

</code></pre>

<hr>
<h2 id='retrieveProjects'>Helper function that retrieves all the projectName options which a user has access to, from janus.</h2><span id='topic+retrieveProjects'></span>

<h3>Description</h3>

<p>Helper function that retrieves all the projectName options which a user has access to, from janus.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>retrieveProjects(target, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="retrieveProjects_+3A_target">target</code></td>
<td>
<p>A list, which can be created using <code><a href="#topic+magmaRset">magmaRset</a></code>, containing your authorization 'token' (a string), a 'url' of magma to target (a string), and optional 'opts' for specifying additions parameters for curl requests (a named list).</p>
</td></tr>
<tr><td><code id="retrieveProjects_+3A_verbose">verbose</code></td>
<td>
<p>Logical. Sets whether to report the status of the '/projects' curl request sent to janus.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function takes in the user's <code>target</code> containing their authorization token, and a url targeting either magma or janus.
It then converts the given url to target janus, and makes a curl request to &lt;janus-url&gt;/projects in order to return which projects a user can access.
</p>


<h3>Value</h3>

<p>A data.frame where elements of the 'project_name' column reflect what can be given to <code>projectName</code> inputs of other magmaR functions.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if (interactive()) {
    retrieveProjects(target = magmaRset())
}

</code></pre>

<hr>
<h2 id='updateFromDF'>Easier to use wrapper of <code><a href="#topic+updateValues">updateValues</a></code></h2><span id='topic+updateFromDF'></span>

<h3>Description</h3>

<p>A wrapper of <code><a href="#topic+updateValues">updateValues</a></code> which takes in updates in the form of a dataframe, csv, tsv, with rows = records and columns = attributes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>updateFromDF(
  target,
  projectName,
  modelName,
  df,
  autolink = FALSE,
  dryRun = FALSE,
  separator = ",",
  auto.proceed = FALSE,
  revisions.only = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="updateFromDF_+3A_target">target</code></td>
<td>
<p>A list, which can be created using <code><a href="#topic+magmaRset">magmaRset</a></code>, containing your authorization 'token' (a string), a 'url' of magma to target (a string), and optional 'opts' for specifying additions parameters for curl requests (a named list).</p>
</td></tr>
<tr><td><code id="updateFromDF_+3A_projectname">projectName</code></td>
<td>
<p>Single string. The name of the project you would like to interact with. For options, see <code><a href="#topic+retrieveProjects">retrieveProjects</a></code>.</p>
</td></tr>
<tr><td><code id="updateFromDF_+3A_modelname">modelName</code></td>
<td>
<p>Single string. The name of the subset data structure within the project, which are referred to as 'model's in magma, to interact with.
For options, see <code><a href="#topic+retrieveModels">retrieveModels</a></code> or https://timur.ucsf.edu/&lt;projectName&gt;/map.</p>
</td></tr>
<tr><td><code id="updateFromDF_+3A_df">df</code></td>
<td>
<p>A dataframe, containing the data to upload to magma.
</p>
<p>Alternatively, a String specifying the file path of a file containing such data.
</p>
<p>See below for additional formatting details.</p>
</td></tr>
<tr><td><code id="updateFromDF_+3A_autolink">autolink</code></td>
<td>
<p>Logical. FALSE by default for safety, but often you will want to set it to TRUE. Passed through to magma, this parameter controls whether the system will attempt to connect all targeted records up with the project's root.
Specifically, this means the system will 
1) determine parent records of all targeted records if it can, based on the project's gnomon grammar, 
2) continue parent determination for those parent records, repeating this process until reaching the project's root (the project record),
then 3) creates any of these records that don't currently exist,
and finally 4) creates all the assumed parent-child linkages</p>
</td></tr>
<tr><td><code id="updateFromDF_+3A_dryrun">dryRun</code></td>
<td>
<p>Logical. FALSE by default. Passed through to magma, this parameter controls whether the system will only test whether the update is valid without making changes to the database.</p>
</td></tr>
<tr><td><code id="updateFromDF_+3A_separator">separator</code></td>
<td>
<p>String indicating the field separator to use if providing <code>df</code> as a file path.
Default = <code>","</code>.
Use <code>"\t"</code> for tsvs.</p>
</td></tr>
<tr><td><code id="updateFromDF_+3A_auto.proceed">auto.proceed</code></td>
<td>
<p>Logical. When set to TRUE, the function does not ask before proceeding forward with the 'magma/update'.</p>
</td></tr>
<tr><td><code id="updateFromDF_+3A_revisions.only">revisions.only</code></td>
<td>
<p>Logical. For troubleshooting purposes, when set to <code>TRUE</code>, no data will be sent to magma.
Instead, the list structure that would have been passed to the <code>revisions</code> input of <code><a href="#topic+updateValues">updateValues</a></code> is returned as output.</p>
</td></tr>
<tr><td><code id="updateFromDF_+3A_...">...</code></td>
<td>
<p>Additional parameters passed along to the internal '.retrieve()', '.query()', or '.update()' functions,
for troubleshooting or advanced-user purposes only: </p>

<ul>
<li> <p><code>request.only</code> (Logical) &amp; <code>json.params.only</code> (Logical) which 1) stop the function before its main curl request to magma and 2) returns the values that would have been sent to magma in either of two formats.
</p>
</li>
<li> <p><code>verbose</code> (Logical) sets whether to report the status of the curl request after it is performed.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>This function provides a simple method for updating multiple attributes of multiple magma records provided as a rectangular dataframe, or equivalent file structure.
It utilizes the magma/query function, documented here <a href="https://mountetna.github.io/magma.html#update">https://mountetna.github.io/magma.html#update</a>,
to upload data after converting to the format required by that function.
</p>
<p>Upload targets the <code>df</code>'s row-indicated records and column-indicated attributes of the <code>modelName</code> model of <code>projectName</code> project.
</p>
<p><code>df</code> data are provided either as a dataframe, or file path which points toward such data.
If given as a file path, the <code>separator</code> input can be used to adjust for whether the file is a csv (the default, <code>separator = ","</code>), or tsv, <code>separator = "\t"</code>, or other format.
</p>
<p>The data structure:
</p>

<ul>
<li><p> Rows = records, with the first column indicating the record identifiers.
</p>
</li>
<li><p> Columns = represent the data desired to be given for each attribute.
</p>
</li>
<li><p> Column Names (or the top row when providing a file) = attribute names.
Except for the first column (ignored as this column's data are used as identifiers), all column names must be valid attribute names of the target <code>modelName</code>.
</p>
</li></ul>

<p>This data is read in, presented to the user for inspection, then transformed to the necessary format and passed along to <code><a href="#topic+updateValues">updateValues</a></code>.
</p>
<p>The <code>updateValues()</code> function will then summarize records to be updated and allow the user to double-check this information before proceeding.
</p>
<p>This user-prompt step can be bypassed (useful when running in a non-interactive way) by setting <code>auto.proceed = TRUE</code>, but NOTE:
It is a good idea to always check carefully before proceeding, if possible.
Data can be overwritten with NAs or zeros or the like, but improperly named records cannot be easily removed.
</p>


<h3>Value</h3>

<p>None directly.
</p>
<p>The function sends data to magma, and the only outputs are information reported via the console.
</p>


<h3>Use Case. Using this function to change records' identifiers</h3>

<p>To do so, provide a file or dataframe where
1) The first column, named something random Iits name will be ignored.), contains current identifiers;
2) Some other column, named as the attribute which is treated as the identifier for the model, contains the new identifiers
</p>
<p>To determine the identifier attribute's name, you can use <code><a href="#topic+retrieveTemplate">retrieveTemplate</a></code>:
</p>
<p><code>retrieveTemplate(&lt;target&gt;, &lt;projectName&gt;)$models$&lt;modelName&gt;$template$identifier</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+updateMatrix">updateMatrix</a></code> for uploading matrix data
</p>
<p><code><a href="#topic+updateValues">updateValues</a></code> for a more direct replica of <code>magma/update</code> which is more flexible, though a bit more complicated to use.
</p>
<p><a href="https://mountetna.github.io/magma.html#update">https://mountetna.github.io/magma.html#update</a> for documentation of the underlying <code>magma/update</code> function.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if (interactive()) {
    # First, we use magmaRset to create an object which will tell other magmaR
    #  functions our authentication token (as well as some other optional bits).
    # When run in this way, it will ask you to give your token.
    magma &lt;- magmaRset()
    
    ### Note that you likely do not have write-permissions for the 'example'
    # project, so this code can be expected to give an authorization error.
    
    ### Retrieve some data from magma, which will be in the proper format.
    df &lt;- retrieve(
        magma, projectName = "example", modelName = "rna_seq",
        recordNames = "all",
        attributeNames = c("tube_name", "biospecimen", "cell_number")
        )
    df
    
    updateFromDF(
        target = magma,
        projectName = "example",
        modelName = "rna_seq",
        df = df)
}

</code></pre>

<hr>
<h2 id='updateMatrix'>A matrix-specific wrapper of <code><a href="#topic+updateValues">updateValues</a></code></h2><span id='topic+updateMatrix'></span>

<h3>Description</h3>

<p>A matrix-specific wrapper of <code><a href="#topic+updateValues">updateValues</a></code> which can take in a matrix, data.frame, or file path, directly.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>updateMatrix(
  target,
  projectName,
  modelName,
  attributeName,
  matrix,
  autolink = FALSE,
  dryRun = FALSE,
  separator = ",",
  auto.proceed = FALSE,
  revisions.only = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="updateMatrix_+3A_target">target</code></td>
<td>
<p>A list, which can be created using <code><a href="#topic+magmaRset">magmaRset</a></code>, containing your authorization 'token' (a string), a 'url' of magma to target (a string), and optional 'opts' for specifying additions parameters for curl requests (a named list).</p>
</td></tr>
<tr><td><code id="updateMatrix_+3A_projectname">projectName</code></td>
<td>
<p>Single string. The name of the project you would like to interact with. For options, see <code><a href="#topic+retrieveProjects">retrieveProjects</a></code>.</p>
</td></tr>
<tr><td><code id="updateMatrix_+3A_modelname">modelName</code></td>
<td>
<p>Single string. The name of the subset data structure within the project, which are referred to as 'model's in magma, to interact with.
For options, see <code><a href="#topic+retrieveModels">retrieveModels</a></code> or https://timur.ucsf.edu/&lt;projectName&gt;/map.</p>
</td></tr>
<tr><td><code id="updateMatrix_+3A_attributename">attributeName</code></td>
<td>
<p>String naming the matrix attribute for which to upload data.</p>
</td></tr>
<tr><td><code id="updateMatrix_+3A_matrix">matrix</code></td>
<td>
<p>A matrix or dataframe containing the data to upload to magma.
</p>
<p>Alternatively, a String specifying the file path of a file containing such data.
</p>
<p>No matter the provision method, colnames must be record identifiers, and rownames should match the values of 'options' associated with the target 'attribute'.
Check the 'See Also' section below for how to determine the needed 'options'.</p>
</td></tr>
<tr><td><code id="updateMatrix_+3A_autolink">autolink</code></td>
<td>
<p>Logical. FALSE by default for safety, but often you will want to set it to TRUE. Passed through to magma, this parameter controls whether the system will attempt to connect all targeted records up with the project's root.
Specifically, this means the system will 
1) determine parent records of all targeted records if it can, based on the project's gnomon grammar, 
2) continue parent determination for those parent records, repeating this process until reaching the project's root (the project record),
then 3) creates any of these records that don't currently exist,
and finally 4) creates all the assumed parent-child linkages</p>
</td></tr>
<tr><td><code id="updateMatrix_+3A_dryrun">dryRun</code></td>
<td>
<p>Logical. FALSE by default. Passed through to magma, this parameter controls whether the system will only test whether the update is valid without making changes to the database.</p>
</td></tr>
<tr><td><code id="updateMatrix_+3A_separator">separator</code></td>
<td>
<p>String indicating the field separator to use if providing <code>matrix</code> as a file path.
Default = <code>","</code>.</p>
</td></tr>
<tr><td><code id="updateMatrix_+3A_auto.proceed">auto.proceed</code></td>
<td>
<p>Logical. When set to TRUE, the function does not ask before proceeding forward with the 'magma/update'.</p>
</td></tr>
<tr><td><code id="updateMatrix_+3A_revisions.only">revisions.only</code></td>
<td>
<p>Logical. For troubleshooting purposes, when set to <code>TRUE</code>, no data will be sent to magma.
Instead, the list structure that would have been passed to the <code>revisions</code> input of <code><a href="#topic+updateValues">updateValues</a></code> is returned as output.</p>
</td></tr>
<tr><td><code id="updateMatrix_+3A_...">...</code></td>
<td>
<p>Additional parameters passed along to the internal '.retrieve()', '.query()', or '.update()' functions,
for troubleshooting or advanced-user purposes only: </p>

<ul>
<li> <p><code>request.only</code> (Logical) &amp; <code>json.params.only</code> (Logical) which 1) stop the function before its main curl request to magma and 2) returns the values that would have been sent to magma in either of two formats.
</p>
</li>
<li> <p><code>verbose</code> (Logical) sets whether to report the status of the curl request after it is performed.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>This function utilizes the magma/query function, documented here <a href="https://mountetna.github.io/magma.html#update">https://mountetna.github.io/magma.html#update</a>,
to upload data to a matrix attribute (named <code>attributeName</code>) of the <code>modelName</code> model of <code>projectName</code> project.
</p>
<p><code>matrix</code> data are provided either as a matrix, dataframe, or file path which points toward such data.
If given as a file path, the <code>separator</code> input can be used to adjust for whether the file is a csv (the default, <code>separator = ","</code>), or tsv, <code>separator = "\t"</code>, or other format.
</p>
<p>Data is then validated by ensuring that all row names are among the valid 'options' of the target attribute (See the See Also section below for a note on how to explore these options yourself.).
Rows are reordered to be in the same order as these 'options'.
</p>
<p>For any missing 'options', rows of NAs are added.
</p>
<p>The data is then transformed and passed along to <code><a href="#topic+updateValues">updateValues</a></code>.
</p>
<p>The <code>updateValues()</code> function will summarize records to be updated and allow the user to double-check this information before proceeding.
</p>
<p>This user-prompt step can be bypassed (useful when running in a non-interactive way) by setting <code>auto.proceed = TRUE</code>, but NOTE:
It is a good idea to always check carefully before proceeding, if possible.
Data can be overwritten with NAs or zeros or the like, but improperly named records cannot be easily removed.
</p>


<h3>Value</h3>

<p>None directly.
</p>
<p>The function sends data to magma, and the only outputs are information reported via the console.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+updateFromDF">updateFromDF</a></code> for a more flexible function for uploading multiple attributes-worth of (non-matrix) data at a time.
</p>
<p><code><a href="#topic+updateValues">updateValues</a></code> for the more direct replica of <code>magma/update</code> which is more even more flexible that <code>updateFromDF</code>, though a bit more complicated to use.
</p>
<p><code><a href="#topic+retrieveTemplate">retrieveTemplate</a></code>, then check the <code>&lt;output&gt;$models$&lt;modelName&gt;$template$attributes$&lt;attributeName&gt;$options</code> to explore the rownames that your matrix should have.
</p>
<p><a href="https://mountetna.github.io/magma.html#update">https://mountetna.github.io/magma.html#update</a> for documentation of the underlying <code>magma/update</code> function.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if (interactive()) {
    # First, we use magmaRset to create an object which will tell other magmaR
    #  functions our authentication token (as well as some other optional bits).
    # When run in this way, it will ask you to give your token.
    magma &lt;- magmaRset()
    
    ### Note that you likely do not have write-permissions for the 'example'
    # project, so this code can be expected to give an authorization error.
    
    ### Retrieve some data from magma, then update that same data.
    mat &lt;- retrieveMatrix(magma, "example", "rna_seq", "all", "gene_tpm")

    updateMatrix(
        target = magma,
        projectName = "example",
        modelName = "rna_seq",
        attributeName = "gene_tpm",
        matrix = mat)
}

</code></pre>

<hr>
<h2 id='updateValues'>Analogous to the '/update' function of magma</h2><span id='topic+updateValues'></span>

<h3>Description</h3>

<p>Analogous to the '/update' function of magma, allows data to be sent to magma (by users with at least &quot;editor&quot; authorization).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>updateValues(
  target,
  projectName,
  revisions = list(),
  auto.proceed = FALSE,
  autolink = FALSE,
  dryRun = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="updateValues_+3A_target">target</code></td>
<td>
<p>A list, which can be created using <code><a href="#topic+magmaRset">magmaRset</a></code>, containing your authorization 'token' (a string), a 'url' of magma to target (a string), and optional 'opts' for specifying additions parameters for curl requests (a named list).</p>
</td></tr>
<tr><td><code id="updateValues_+3A_projectname">projectName</code></td>
<td>
<p>Single string. The name of the project you would like to interact with. For options, see <code><a href="#topic+retrieveProjects">retrieveProjects</a></code>.</p>
</td></tr>
<tr><td><code id="updateValues_+3A_revisions">revisions</code></td>
<td>
<p>A list of named lists containing the data to be updated.
</p>
<p>List structure:
</p>

<ul>
<li><p> top level name(s): modelNames, can be 1 or more.
</p>
</li>
<li><p> 2nd level name(s): recordNames, can be 1 or more.
</p>
</li>
<li><p> 3rd level name(s) &amp; contents: the attributes to update &amp; the values to use.
</p>
</li></ul>

<p>See <a href="https://mountetna.github.io/magma.html#update">https://mountetna.github.io/magma.html#update</a> for additional formatting details.</p>
</td></tr>
<tr><td><code id="updateValues_+3A_auto.proceed">auto.proceed</code></td>
<td>
<p>Logical. When set to TRUE, the function does not ask before proceeding forward with the 'magma/update'.</p>
</td></tr>
<tr><td><code id="updateValues_+3A_autolink">autolink</code></td>
<td>
<p>Logical. FALSE by default for safety, but often you will want to set it to TRUE. Passed through to magma, this parameter controls whether the system will attempt to connect all targeted records up with the project's root.
Specifically, this means the system will 
1) determine parent records of all targeted records if it can, based on the project's gnomon grammar, 
2) continue parent determination for those parent records, repeating this process until reaching the project's root (the project record),
then 3) creates any of these records that don't currently exist,
and finally 4) creates all the assumed parent-child linkages</p>
</td></tr>
<tr><td><code id="updateValues_+3A_dryrun">dryRun</code></td>
<td>
<p>Logical. FALSE by default. Passed through to magma, this parameter controls whether the system will only test whether the update is valid without making changes to the database.</p>
</td></tr>
<tr><td><code id="updateValues_+3A_...">...</code></td>
<td>
<p>Additional parameters passed along to the internal '.retrieve()', '.query()', or '.update()' functions,
for troubleshooting or advanced-user purposes only: </p>

<ul>
<li> <p><code>request.only</code> (Logical) &amp; <code>json.params.only</code> (Logical) which 1) stop the function before its main curl request to magma and 2) returns the values that would have been sent to magma in either of two formats.
</p>
</li>
<li> <p><code>verbose</code> (Logical) sets whether to report the status of the curl request after it is performed.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>This function mimics the activity of the magma/update function, documented here <a href="https://mountetna.github.io/magma.html#update">https://mountetna.github.io/magma.html#update</a>,
with the main difference being that the <code>revisions</code> input should be in nested list format rather than nested hash (because R does not support hash structures).
</p>
<p>Internally, the function:
</p>
<p>1. Summarizes records of each model that will be targeted for updating.
</p>
<p>2. Prompts the user before proceeding (unless <code>auto.proceed</code> is set to <code>TRUE</code>)
</p>
<p>3. Directly passes its inputs along to magma/update via a curl request.
</p>


<h3>Value</h3>

<p>None directly.
</p>
<p>The function sends data to magma, and the only outputs are information reported via the console.
</p>


<h3>See Also</h3>

<p><a href="https://mountetna.github.io/magma.html#update">https://mountetna.github.io/magma.html#update</a> for documentation of the underlying magma/update function.
</p>
<p><code><a href="#topic+updateMatrix">updateMatrix</a></code> for a matrix-dedicated version of this function which can be provided a matrix, or matrix's file location, directly.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if (interactive()) {
    # First, we use magmaRset to create an object which will tell other magmaR
    #  functions our authentication token (as well as some other optional bits).
    # When run in this way, it will ask you to give your token.
    magma &lt;- magmaRset()
    
    # Note that you likely do not have write-permissions for the 'example'
    # project, so this code can be expected to give an authorization error.

    updateValues(
        target = magma,
        projectName = "example",
        autolink = TRUE,
        dryRun = FALSE,
        revisions = list(
            # model
            'rna_seq' = list(
                # record
                'EXAMPLE-HS1-WB1-RSQ1' = list(
                    # attribute
                    'fraction' = list(
                        # value(s)
                        "Tcells"
                        )
                    )
                )
            )
        )
}

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
