<!DOCTYPE html><html lang="en"><head><title>Help for package wql</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {wql}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#wql-package'><p>The main purpose of <span class="pkg">wql</span> is to explore seasonal time series through</p>
plots and nonparametric trend tests. It was created originally to examine
water quality data sets (hence, &ldquo;wql&rdquo;) but is suitable as a more
general purpose set of tools for looking at annual or seasonal time series.</a></li>
<li><a href='#date2decyear'><p>date2decyear</p></a></li>
<li><a href='#DateTime-class'><p>Class &quot;DateTime&quot;</p></a></li>
<li><a href='#decompTs'><p>Decompose a time series</p></a></li>
<li><a href='#decyear2date'><p>decyear2date</p></a></li>
<li><a href='#ec2pss'><p>Convert conductivity to salinity</p></a></li>
<li><a href='#eof'><p>Empirical orthogonal function analysis</p></a></li>
<li><a href='#eofNum'><p>Plot EOF percent variance</p></a></li>
<li><a href='#eofPlot'><p>Plot EOF analysis results</p></a></li>
<li><a href='#interpTs'><p>Interpolate or substitute missing time series values</p></a></li>
<li><a href='#layerMean'><p>layerMean</p></a></li>
<li><a href='#leapYear'><p>leapYear</p></a></li>
<li><a href='#mannKen'><p>Mann-Kendall trend test and the Sen slope</p></a></li>
<li><a href='#meanSub'><p>meanSub</p></a></li>
<li><a href='#monthCor'><p>monthCor</p></a></li>
<li><a href='#monthNum'><p>monthNum</p></a></li>
<li><a href='#mts2ts'><p>Converts matrix to vector time series for various analyses</p></a></li>
<li><a href='#oxySol'><p>Dissolved oxygen at saturation</p></a></li>
<li><a href='#pett'><p>Nonparametric Change-Point Detection</p></a></li>
<li><a href='#phenoAmp'><p>Phenological amplitude</p></a></li>
<li><a href='#phenoAmp-methods'><p>Methods for Function phenoAmp</p></a></li>
<li><a href='#phenoPhase'><p>Phenological phase</p></a></li>
<li><a href='#phenoPhase-methods'><p>Methods for Function phenoPhase</p></a></li>
<li><a href='#plotSeason'><p>Plots seasonal patterns for a time series</p></a></li>
<li><a href='#plotTs'><p>Time series plot</p></a></li>
<li><a href='#plotTsAnom'><p>Anomaly plot of time series</p></a></li>
<li><a href='#plotTsTile'><p>Image plot of monthly time series</p></a></li>
<li><a href='#R2pss'><p>R2pss</p></a></li>
<li><a href='#seaKen'><p>Seasonal and Regional Kendall trend test</p></a></li>
<li><a href='#seaRoll'><p>Rolling Seasonal Kendall trend test</p></a></li>
<li><a href='#seasonTrend'><p>Determine seasonal trends</p></a></li>
<li><a href='#sfbay'><p>San Francisco Bay water quality data</p></a></li>
<li><a href='#trendHomog'><p>Trend homogeneity test</p></a></li>
<li><a href='#ts2df'><p>Convert time series to data frame</p></a></li>
<li><a href='#tsMake'><p>Create time series from water quality data</p></a></li>
<li><a href='#tsMake-methods'><p>Methods for Function tsMake</p></a></li>
<li><a href='#tsSub'><p>tsSub</p></a></li>
<li><a href='#wqData'><p>Construct an object of class &quot;WqData&quot;</p></a></li>
<li><a href='#WqData-class'><p>Class WqData</p></a></li>
<li><a href='#years'><p>Miscellaneous utility functions</p></a></li>
<li><a href='#zoo-class'><p>Class &quot;zoo&quot;</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Exploring Water Quality Monitoring Data</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.2</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jemma Stachelek &lt;jemma.stachelek@gmail.com&gt;</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/jsta/wql">https://github.com/jsta/wql</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/jsta/wql/issues">https://github.com/jsta/wql/issues</a></td>
</tr>
<tr>
<td>Description:</td>
<td>Functions to assist in the processing and
    exploration of data from environmental monitoring programs.
    The package name stands for "water quality" and reflects the
    original focus on time series data for physical and chemical
    properties of water, as well as the biota. Intended for
    programs that sample approximately monthly, quarterly or
    annually at discrete stations, a feature of many legacy data
    sets. Most of the functions should be useful for analysis of
    similar-frequency time series regardless of the subject
    matter.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>graphics, grDevices, methods, stats, ggplot2 (&ge; 1.0),
reshape2, zoo</td>
</tr>
<tr>
<td>LazyData:</td>
<td>yes</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-01-22 16:27:19 UTC; jsta</td>
</tr>
<tr>
<td>Author:</td>
<td>Alan Jassby [aut],
  James Cloern [ctb],
  Jemma Stachelek [ctb, cre]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-01-23 10:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='wql-package'>The main purpose of <span class="pkg">wql</span> is to explore seasonal time series through
plots and nonparametric trend tests. It was created originally to examine
water quality data sets (hence, &ldquo;wql&rdquo;) but is suitable as a more
general purpose set of tools for looking at annual or seasonal time series.</h2><span id='topic+wql-package'></span><span id='topic+_PACKAGE'></span><span id='topic+wql'></span>

<h3>Description</h3>

<p>One of the more tedious tasks in exploring environmental data sets is
creating usable time series from the original complex data sets, especially
when you want many series at will that group data in different ways. So
<span class="pkg">wql</span> also provides a way of transforming data sets to a common format
that then allows a diversity of time series to be created quickly. A few
functions are specific to the fields of limnology and oceanography.
</p>


<h3>Details</h3>

<p>The plots are designed for easy use, not for publication-quality graphs.
Nonetheless, extensive customization is possible by passing options through
<code>...{}</code>, adding annotations in the case of base graphics, and adding
layers in the case of <span class="pkg">ggplot2</span> objects.
</p>
<p>Two functions are used mainly for preparing the times series:
</p>
 <ul>
<li><p> a function that transforms incoming data to a common data
structure in the form of the <code>WqData</code> class </p>
</li>
<li><p> a function that
easily prepares time series objects from this class </p>
</li></ul>

<p>The <code>WqData</code> class can be easily adapted to non-aquatic data.
Obviously, the <code>depth</code> field can be used for elevation in atmospheric
studies. But more generally, the <code>site</code> and <code>depth</code> fields can be
used for many two-way classifications and don't need to refer to spatial
location.
</p>
<p>Some of the time series functions include:
</p>
 <ul>
<li><p> a variety of plots to examine changes in seasonal patterns
</p>
</li>
<li><p> nonparametric trend tests </p>
</li>
<li><p> time series interpolation and related
manipulations </p>
</li>
<li><p> a simple decomposition of a series into different time
scales </p>
</li>
<li><p> phenological analyses </p>
</li>
<li><p> the use of empirical orthogonal
functions to detect multiple independent mechanisms underlying temporal
change </p>
</li></ul>

<p>A few functions are specialized for the aquatic sciences:
</p>
 <ul>
<li><p> converting between oxygen concentrations and percent
saturation </p>
</li>
<li><p> converting between salinity and conductivity </p>
</li></ul>

<p>The capabilities of <span class="pkg">wql</span> are more fully explained in the accompanying
vignette: &ldquo;wql: Exploring environmental monitoring data&rdquo;.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Jemma Stachelek <a href="mailto:jemma.stachelek@gmail.com">jemma.stachelek@gmail.com</a> [contributor]
</p>
<p>Authors:
</p>

<ul>
<li><p> Alan Jassby
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> James Cloern [contributor]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/jsta/wql">https://github.com/jsta/wql</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/jsta/wql/issues">https://github.com/jsta/wql/issues</a>
</p>
</li></ul>


<hr>
<h2 id='date2decyear'>date2decyear</h2><span id='topic+date2decyear'></span>

<h3>Description</h3>

<p>date2decyear
</p>


<h3>Usage</h3>

<pre><code class='language-R'>date2decyear(w)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="date2decyear_+3A_w">w</code></td>
<td>
<p>date</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>

<hr>
<h2 id='DateTime-class'>Class &quot;DateTime&quot;</h2><span id='topic+DateTime-class'></span>

<h3>Description</h3>

<p>A class union of <code>"Date"</code> and <code>"POSIXct"</code> classes.
</p>


<h3>Objects from the Class</h3>

<p>A virtual Class: No objects may be created
from it.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+WqData-class">WqData-class</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
showClass("DateTime")

</code></pre>

<hr>
<h2 id='decompTs'>Decompose a time series</h2><span id='topic+decompTs'></span>

<h3>Description</h3>

<p>The function decomposes a time series into a long-term mean, annual,
seasonal and &quot;events&quot; component. The decomposition can be multiplicative or
additive, and based on median or mean centering.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>decompTs(
  x,
  event = TRUE,
  type = c("mult", "add"),
  center = c("median", "mean")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="decompTs_+3A_x">x</code></td>
<td>
<p>a monthly time series vector</p>
</td></tr>
<tr><td><code id="decompTs_+3A_event">event</code></td>
<td>
<p>whether or not an &quot;events&quot; component should be determined</p>
</td></tr>
<tr><td><code id="decompTs_+3A_type">type</code></td>
<td>
<p>the type of decomposition, either multiplicative (&quot;mult&quot;) or
additive (&quot;add&quot;)</p>
</td></tr>
<tr><td><code id="decompTs_+3A_center">center</code></td>
<td>
<p>the method of centering, either median or mean</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The rationale for this simple approach to decomposing a time series, with
examples of its application, is given by Cloern and Jassby (2010). It is
motivated by the observation that many important events for estuaries (e.g.,
persistent dry periods, species invasions) start or stop suddenly. Smoothing
to extract the annualized term, which can disguise the timing of these
events and make analysis of them unnecessarily difficult, is not used.
</p>
<p>A multiplicative decomposition will typically be useful for a biological
community- or population-related variable (e.g., chlorophyll-a) that
experiences exponential changes in time and is approximately lognormal,
whereas an additive decomposition is more suitable for a normal variable.
The default centering method is the median, especially appropriate for
series that have large, infrequent events.
</p>
<p>If <code>event = TRUE</code>, the seasonal component represents a recurring
monthly pattern and the events component a residual series. Otherwise, the
seasonal component becomes the residual series. The latter is appropriate
when seasonal patterns change systematically over time. You can use
<code><a href="#topic+plotSeason">plotSeason</a></code> and <code><a href="#topic+seasonTrend">seasonTrend</a></code> to investigate the
way seasonality changes.
</p>


<h3>Value</h3>

<p>A monthly time series matrix with the following individual time
series: </p>
<table role = "presentation">
<tr><td><code>original</code></td>
<td>
<p>original time series</p>
</td></tr> <tr><td><code>annual</code></td>
<td>
<p>annual mean
series</p>
</td></tr> <tr><td><code>seasonal</code></td>
<td>
<p>repeating seasonal component</p>
</td></tr> <tr><td><code>events</code></td>
<td>
<p>optionally, the residual or &quot;events&quot; series</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>


<h3>References</h3>

<p>Cloern, J.E. and Jassby, A.D. (2010) Patterns and scales of
phytoplankton variability in estuarine-coastal ecosystems. <em>Estuaries
and Coasts</em> <b>33,</b> 230&ndash;241.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plotSeason">plotSeason</a></code>, <code><a href="#topic+seasonTrend">seasonTrend</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Apply the function to a single series (Station 27) and plot it:
y &lt;- decompTs(sfbayChla[, 's27'])
y
plot(y, nc=1, main="")

</code></pre>

<hr>
<h2 id='decyear2date'>decyear2date</h2><span id='topic+decyear2date'></span>

<h3>Description</h3>

<p>decyear2date
</p>


<h3>Usage</h3>

<pre><code class='language-R'>decyear2date(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="decyear2date_+3A_x">x</code></td>
<td>
<p>date</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>

<hr>
<h2 id='ec2pss'>Convert conductivity to salinity</h2><span id='topic+ec2pss'></span>

<h3>Description</h3>

<p>Electrical conductivity data are converted to salinity using the Practical
Salinity Scale and an extension for salinities below 2.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ec2pss(ec, t, p = 0)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ec2pss_+3A_ec">ec</code></td>
<td>
<p>conductivity, mS/cm</p>
</td></tr>
<tr><td><code id="ec2pss_+3A_t">t</code></td>
<td>
<p>temperature, Celsius</p>
</td></tr>
<tr><td><code id="ec2pss_+3A_p">p</code></td>
<td>
<p>gauge pressure, decibar</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>ec2pss</code> converts electrical conductivity data to salinity using the
Practical Salinity Scale 1978 in the range of 2-42 (Fofonoff and Millard
1983). Salinities below 2 are calculated using the extension of the
Practical Salinity Scale (Hill et al. 1986).
</p>
<p><code>R2pss</code> is the same function, except that conductivity ratios rather
than conductivities are used as input.
</p>


<h3>Value</h3>

<p><code>ec2pss</code> and <code>R2pss</code> both return salinity values on the
Practical Salinity Scale.
</p>


<h3>Note</h3>

<p>Input pressures are not absolute pressures but rather gauge pressures.
Gauge pressures are measured relative to 1 standard atmosphere, so the gauge
pressure at the surface is 0.
</p>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>


<h3>References</h3>

<p>Fofonoff N.P. and Millard Jr R.C. (1983) <em>Algorithms for
Computation of Fundamental Properties of Seawater.</em> UNESCO Technical Papers
in Marine Science 44. UNESCO, Paris, 53 p.
</p>
<p>Hill K.D., Dauphinee T.M. and Woods D.J. (1986) The extension of the
Practical Salinity Scale 1978 to low salinities. <em>IEEE Journal of
Oceanic Engineering</em> <b>11,</b> 109-112.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Check values from Fofonoff and Millard (1983):
R = c(1, 1.2, 0.65) 
t = c(15, 20, 5)
p = c(0, 2000, 1500)
R2pss(R, t, p)  # 35.000 37.246 27.995
# Repeat calculation with equivalent conductivity values by setting 
# ec &lt;- R * C(35, 15, 0):
ec = c(1, 1.2, 0.65) * 42.9140
ec2pss(ec, t, p)  # same results

</code></pre>

<hr>
<h2 id='eof'>Empirical orthogonal function analysis</h2><span id='topic+eof'></span>

<h3>Description</h3>

<p>Finds and rotates empirical orthogonal functions (EOFs).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>eof(x, n, scale. = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="eof_+3A_x">x</code></td>
<td>
<p>a data frame or matrix, with no missing values</p>
</td></tr>
<tr><td><code id="eof_+3A_n">n</code></td>
<td>
<p>number of EOFs to retain for rotation</p>
</td></tr>
<tr><td><code id="eof_+3A_scale.">scale.</code></td>
<td>
<p>logical indicating whether the (centered) variables should be
scaled to have unit variance</p>
</td></tr>
</table>


<h3>Details</h3>

<p>EOF analysis is used to study patterns of variability (&ldquo;modes&rdquo;) in a
matrix time series and how these patterns change with time
(&ldquo;amplitude time series&rdquo;). Hannachi et al. (2007) give a detailed
discussion of this exploratory approach with emphasis on meteorological
data. In oceanography and climatology, the time series represent
observations at different spatial locations (columns) over time (rows). But
columns can also be seasons of the year (Jassby et al. 1999) or even a
combination of seasons and depth layers (Jassby et al. 1990). EOF analysis
uses the same techniques as principal component analysis, but the time
series are observations of the same variable in the same units. Scaling the
data is optional, but it is the default here.
</p>
<p>Eigenvectors (unscaled EOFs) and corresponding eigenvalues (amount of
explained variance) are found by singular value decomposition of the
centered and (optionally) scaled data matrix using <code><a href="stats.html#topic+prcomp">prcomp</a></code>. In
order to facilitate a physical interpretation of the variability modes, a
subset consisting of the <code>n</code> most important EOFs is rotated (Richman
1986). <code><a href="#topic+eofNum">eofNum</a></code> can be used to help choose <code>n</code>. Hannachi et
al. (2007) recommend orthogonal rotation of EOFs scaled by the square root
of the corresponding eigenvalues to avoid possible computation problems and
reduce sensitivity to the choice of <code>n</code>. We follow this recommendation
here, using the <code><a href="stats.html#topic+varimax">varimax</a></code> method for the orthogonal rotation.
</p>
<p>Note that the signs of the EOFs are arbitrary.
</p>


<h3>Value</h3>

<p>A list with the following members: </p>
<table role = "presentation">
<tr><td><code>REOF</code></td>
<td>
<p>a matrix with rotated
EOFs</p>
</td></tr> <tr><td><code>amplitude</code></td>
<td>
<p>a matrix with amplitude time series of
<abbr><span class="acronym">REOF</span></abbr>s</p>
</td></tr> <tr><td><code>eigen.pct</code></td>
<td>
<p>all eigenvalues of correlation matrix as
percent of total variance</p>
</td></tr> <tr><td><code>variance</code></td>
<td>
<p>variance explained by retained
EOFs</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>


<h3>References</h3>

<p>Hannachi, A., Jolliffe, I.T., and Stephenson, D.B. (2007)
Empirical orthogonal functions and related techniques in atmospheric
science: A review. <em>International Journal of Climatology</em> <b>27,</b>
1119&ndash;1152.
</p>
<p>Jassby, A.D., Powell, T.M., and Goldman, C.R. (1990) Interannual
fluctuations in primary production: Direct physical effects and the trophic
cascade at Castle Lake, California (USA). <em>Limnology and Oceanography</em>
<b>35,</b> 1021&ndash;1038.
</p>
<p>Jassby, A.D., Goldman, C.R., Reuter, J.E., and Richards, R.C. (1999) Origins
and scale dependence of temporal variability in the transparency of Lake
Tahoe, California-Nevada. <em>Limnology and Oceanography</em> <b>44,</b>
282&ndash;294.
</p>
<p>Richman, M. (1986) Rotation of principal components. <em>Journal of
Climatology</em> <b>6,</b> 293&ndash;335.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+eofNum">eofNum</a></code>, <code><a href="#topic+eofPlot">eofPlot</a></code>,
<code><a href="#topic+monthCor">monthCor</a></code>, <code><a href="#topic+ts2df">ts2df</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Create an annual matrix time series
chla1 &lt;- aggregate(sfbayChla, 1, mean, na.rm = TRUE)
chla1 &lt;- chla1[, 1:12]  # remove stations with missing years
# eofNum (see examples) suggests n = 1
eof(chla1, 1)

</code></pre>

<hr>
<h2 id='eofNum'>Plot EOF percent variance</h2><span id='topic+eofNum'></span>

<h3>Description</h3>

<p>Plots the variances associated with empirical orthogonal functions (EOF).
Useful for deciding how many EOFs to retain for rotation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>eofNum(x, n = nrow(x), scale. = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="eofNum_+3A_x">x</code></td>
<td>
<p>a data frame or matrix, with no missing values</p>
</td></tr>
<tr><td><code id="eofNum_+3A_n">n</code></td>
<td>
<p>effective sample size</p>
</td></tr>
<tr><td><code id="eofNum_+3A_scale.">scale.</code></td>
<td>
<p>logical indicating whether the (centered) variables should be
scaled to have unit variance</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Calculates the eigenvalues from an EOF analysis, as described in
<code><a href="#topic+eof">eof</a></code>. The eigenvalues are plotted against eigenvalue number
(sometimes called a &ldquo;scree plot&rdquo;), and the cumulative variance as %
of total is plotted over each eigenvalue. The approximate 0.95 confidence
limits are depicted for each eigenvalue using North et al.'s (1982)
rule-of-thumb, which ignores any autocorrelation in the data. If the
autocorrelation structure is assessed separately and can be expressed in
terms of effective sample size (e.g., Thiebaux and Zwiers 1984), then
<code>n</code> can be set equal to this number.
</p>
<p>There is no universal rule for deciding how many of the EOFs should be
retained for rotation (Hannachi et al. 2007). In practice, the number is
chosen by requiring a minimum cumulative variance, looking for a sharp break
in the spectrum, requiring that confidence limits not overlap, various Monte
Carlo methods, or many other techniques. The plot produced here enables the
first three methods.
</p>


<h3>Value</h3>

<p>A plot of the eigenvectors.
</p>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>


<h3>References</h3>

<p>Hannachi, A., Jolliffe, I.T., and Stephenson, D.B. (2007)
Empirical orthogonal functions and related techniques in atmospheric
science: A review. <em>International Journal of Climatology</em> <b>27,</b>
1119&ndash;1152.
</p>
<p>North, G., Bell, T., Cahalan, R., and Moeng, F. (1982) Sampling errors in
the estimation of empirical orthogonal functions. <em>Monthly Weather
Review</em> <b>110,</b> 699&ndash;706.
</p>
<p>Thiebaux H.J. and Zwiers F.W. (1984) The interpretation and estimation of
effective sample sizes. <em>Journal of Climate and Applied Meteorology</em>
<b>23,</b> 800&ndash;811.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+eof">eof</a></code>, <code><a href="#topic+interpTs">interpTs</a></code>, <code><a href="#topic+monthCor">monthCor</a></code>,
<code><a href="#topic+eofPlot">eofPlot</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Create an annual time series data matrix from sfbay chlorophyll data
# Average over each year
chla1 &lt;- aggregate(sfbayChla, 1, mean, na.rm = TRUE)  
chla1 &lt;- chla1[, 1:12]  # remove stations with missing years
eofNum(chla1)
# These stations appear to act as one with respect to chlorophyll
# variability on the annual scale because there's one dominant EOF.

</code></pre>

<hr>
<h2 id='eofPlot'>Plot EOF analysis results</h2><span id='topic+eofPlot'></span>

<h3>Description</h3>

<p>Plots the rotated empirical orthogonal functions or amplitude time series
resulting from <code><a href="#topic+eof">eof</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>eofPlot(x, type = c("coef", "amp"), rev = FALSE, ord = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="eofPlot_+3A_x">x</code></td>
<td>
<p>result of the function <code><a href="#topic+eof">eof</a></code></p>
</td></tr>
<tr><td><code id="eofPlot_+3A_type">type</code></td>
<td>
<p>whether the EOF coefficients or amplitudes should be plotted</p>
</td></tr>
<tr><td><code id="eofPlot_+3A_rev">rev</code></td>
<td>
<p>logical indicating whether coefficients and amplitudes should be
multiplied by <code>-1</code></p>
</td></tr>
<tr><td><code id="eofPlot_+3A_ord">ord</code></td>
<td>
<p>logical indicating whether coefficients should be ordered by size</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When the columns of the original data have a natural order, such as stations
along a transect or months of the year, there may be no need to reorder the
EOF coefficients. But if there is no natural order, such as when columns
represents disparate sites around the world, the plot can be more
informative if coefficients are ordered by size (<code>ord = TRUE</code>).
</p>
<p>Coefficients and amplitudes for a given EOF may be more easily interpreted
if <code>rev = TRUE</code>, because the sign of the first coefficient is
arbitrarily determined and all the other signs follow from that choice.
</p>


<h3>Value</h3>

<p>A plot of the EOF coefficients or amplitudes.
</p>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>


<h3>See Also</h3>

<p><code><a href="#topic+eof">eof</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Create an annual matrix time series
chla1 &lt;- aggregate(sfbayChla, 1, mean, na.rm = TRUE)
chla1 &lt;- chla1[, 1:12]  # remove stations with missing years

# eofNum (see examples) suggests n = 1
e1 &lt;- eof(chla1, n = 1)
eofPlot(e1, type = 'coef')
eofPlot(e1, type = 'amp')

</code></pre>

<hr>
<h2 id='interpTs'>Interpolate or substitute missing time series values</h2><span id='topic+interpTs'></span>

<h3>Description</h3>

<p>Imterpolates or substitutes missing data in a time series for gaps up to a
specified size.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>interpTs(
  x,
  type = c("linear", "series.median", "series.mean", "cycle.median", "cycle.mean"),
  gap = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="interpTs_+3A_x">x</code></td>
<td>
<p>object of class <code>"ts"</code> or <code>"mts"</code></p>
</td></tr>
<tr><td><code id="interpTs_+3A_type">type</code></td>
<td>
<p>method of interpolation or substitution</p>
</td></tr>
<tr><td><code id="interpTs_+3A_gap">gap</code></td>
<td>
<p>maximum gap to be replaced</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When <code>type = "linear"</code>, the function performs linear interpolation of
any <code>NA</code> runs of length smaller than or equal to <code>gap</code>. When
<code>gap = NULL</code>, gaps of any size will be replaced. Does not change
leading or trailing <code>NA</code> runs. This interpolation approach is best for
periods of low biological activity when sampling is routinely suspended.
</p>
<p>When <code>type = "series.median"</code> or <code>"series.mean"</code>, missing values
are replaced by the overall median or mean, respectively. This may be
desirable when missing values are not allowed but one wants, for example, to
avoid spurious enhancement of trends.
</p>
<p>When <code>type = "cycle.median"</code> or <code>type = "cycle.mean"</code>, missing
values are replaced by the median or mean, respectively, for the same cycle
position (i.e., same month, quarter, etc., depending on the frequency). This
may give more realistic series than using the overall mean or median.
</p>
<p>Intended for time series but first three types will work with any vector or
matrix. Matrices will be interpolated by column.
</p>


<h3>Value</h3>

<p>The time series with some or all missing values replaced.
</p>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>


<h3>See Also</h3>

<p><code><a href="#topic+decompTs">decompTs</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
### Interpolate a vector time series and highlight the imputed data
chl27 &lt;- sfbayChla[, 's27']
x1 &lt;- interpTs(chl27, gap = 3)
plot(x1, col = 'red')
lines(chl27, col = 'blue')
x2 &lt;- interpTs(chl27, type = "series.median", gap = 3)
plot(x2, col = 'red')
lines(chl27, col = 'blue')

### Interpolate a matrix time series and plot results
x3 &lt;- interpTs(sfbayChla, type = "cycle.mean", gap = 1)
plot(x3[, 1:10], main = "SF Bay Chl-a\n(gaps of 1 month replaced)")

</code></pre>

<hr>
<h2 id='layerMean'>layerMean</h2><span id='topic+layerMean'></span>

<h3>Description</h3>

<p>Acts on a matrix or data frame with depth in the first
column and observations for different variables (or different sites, or
different times) in each of the remaining columns. The trapezoidal mean over
the given depths is calculated for each of the variables. Replicate depths
are averaged, and missing values or data with only one unique depth are
handled. Data are not extrapolated to cover missing values at the top or
bottom of the layer. The result can differ markedly from the simple mean
even for equal spacing of depths, because the top and bottom values are
weighted by 0.5 in a trapezoidal mean.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>layerMean(d)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="layerMean_+3A_d">d</code></td>
<td>
<p>data.frame</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>

<hr>
<h2 id='leapYear'>leapYear</h2><span id='topic+leapYear'></span>

<h3>Description</h3>

<p><code>TRUE</code> if <code>x</code> is a leap year, <code>FALSE</code>
otherwise.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>leapYear(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="leapYear_+3A_x">x</code></td>
<td>
<p>integer year</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>

<hr>
<h2 id='mannKen'>Mann-Kendall trend test and the Sen slope</h2><span id='topic+mannKen'></span>

<h3>Description</h3>

<p>Applies Kendall's tau test for the significance of a monotonic time series
trend (Mann 1945). Also calculates the Sen slope as an estimate of this
trend.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mannKen(
  x,
  plot = FALSE,
  type = c("slope", "relative"),
  order = FALSE,
  pval = 0.05,
  pchs = c(19, 21),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mannKen_+3A_x">x</code></td>
<td>
<p>A numeric vector, matrix or data frame</p>
</td></tr>
<tr><td><code id="mannKen_+3A_plot">plot</code></td>
<td>
<p>Should the trends be plotted when x is a matrix or data frame?</p>
</td></tr>
<tr><td><code id="mannKen_+3A_type">type</code></td>
<td>
<p>Type of trend to be plotted, actual or relative</p>
</td></tr>
<tr><td><code id="mannKen_+3A_order">order</code></td>
<td>
<p>Should the plotted trends be ordered by size?</p>
</td></tr>
<tr><td><code id="mannKen_+3A_pval">pval</code></td>
<td>
<p>p-value for significance</p>
</td></tr>
<tr><td><code id="mannKen_+3A_pchs">pchs</code></td>
<td>
<p>Plot symbols for significant and not significant trend
estimates, respectively</p>
</td></tr>
<tr><td><code id="mannKen_+3A_...">...</code></td>
<td>
<p>Other arguments to pass to plotting function</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The Sen slope (alternately, Theil or Theil-Sen slope)&mdash;the median slope
joining all pairs of observations&mdash;is expressed by quantity per unit time.
The fraction of missing slopes involving the first and last fifths of the
data are provided so that the appropriateness of the slope estimate can be
assessed and results flagged. Schertz et al. [1991] discuss this and related
decisions about missing data. Other results are used for further analysis by
other functions. Serial correlation is ignored, so the interval between
points should be long enough to avoid strong serial correlation.
</p>
<p>For the relative slope, the slope joining each pair of observations is
divided by the first of the pair before the overall median is taken. The
relative slope makes sense only as long as the measurement scale is
non-negative (not, e.g., temperature on the Celsius scale). Comparing
relative slopes is useful when the variables in <code>x</code> have different
units.
</p>
<p>If <code>plot = TRUE</code>, then either the Sen slope (<code>type = "slope"</code>) or
the relative Sen slope (<code>type = "relative"</code>) are plotted. The plot
symbols indicate, respectively, that the trend is significant or not
significant. The plot can be customized by passing any arguments used by
<code><a href="graphics.html#topic+dotchart">dotchart</a></code> such as <code>xlab</code> or <code>xlim</code>, as well as
graphical parameters described in <code><a href="graphics.html#topic+par">par</a></code>.
</p>


<h3>Value</h3>

<p>A list of the following if <code>x</code> is a vector:
</p>
<table role = "presentation">
<tr><td><code>sen.slope</code></td>
<td>
<p>Sen slope</p>
</td></tr> <tr><td><code>sen.slope.rel</code></td>
<td>
<p>Relative Sen slope</p>
</td></tr>
<tr><td><code>p.value</code></td>
<td>
<p>Significance of slope</p>
</td></tr> <tr><td><code>S</code></td>
<td>
<p>Kendall's S</p>
</td></tr>
<tr><td><code>varS</code></td>
<td>
<p>Variance of S</p>
</td></tr> <tr><td><code>miss</code></td>
<td>
<p>Fraction of missing slopes connecting
first and last fifths of <code>x</code></p>
</td></tr></table>
<p> or a matrix with corresponding columns if
<code>x</code> is a matrix or data frame.
</p>


<h3>Note</h3>

<p>Approximate p-values with corrections for ties and continuity are used
if <code class="reqn">n &gt; 10</code> or if there are any ties. Otherwise, exact p-values based on
Table B8 of Helsel and Hirsch (2002) are used. In the latter case, <code class="reqn">p =
0.0001</code> should be interpreted as <code class="reqn">p &lt; 0.0002</code>.
</p>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>


<h3>References</h3>

<p>Mann, H.B. (1945) Nonparametric tests against trend.
<em>Econometrica</em> <b>13,</b> 245&ndash;259.
</p>
<p>Helsel, D.R. and Hirsch, R.M. (2002) <em>Statistical methods in water
resources.</em> Techniques of Water Resources Investigations, Book 4, chapter
A3. U.S. Geological Survey. 522 pages.
<a href="https://doi.org/10.3133/twri04A3">doi:10.3133/twri04A3</a>
</p>
<p>Schertz, T.L., Alexander, R.B., and Ohe, D.J. (1991) <em>The computer
program EStimate TREND (ESTREND), a system for the detection of trends in
water-quality data.</em> Water-Resources Investigations Report 91-4040, U.S.
Geological Survey.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+seaKen">seaKen</a></code>, <code><a href="#topic+seasonTrend">seasonTrend</a></code>,
<code><a href="#topic+tsSub">tsSub</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
tsp(Nile)  # an annual time series
mannKen(Nile)

y &lt;- sfbayChla
y1 &lt;- interpTs(y, gap=1)  # interpolate single-month gaps only
y2 &lt;- aggregate(y1, 1, mean, na.rm=FALSE)
mannKen(y2)
mannKen(y2, plot=TRUE) # missing data means missing trend estimates
mannKen(y2, plot=TRUE, xlim = c(0.1, 0.25))
mannKen(y2, plot=TRUE, type='relative', order = TRUE, pval = .001,
  xlab = "Relative trend")
legend("topleft", legend = "p &lt; 0.001", pch = 19, bty="n")

</code></pre>

<hr>
<h2 id='meanSub'>meanSub</h2><span id='topic+meanSub'></span>

<h3>Description</h3>

<p>meanSub
</p>


<h3>Usage</h3>

<pre><code class='language-R'>meanSub(x, sub, na.rm = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="meanSub_+3A_x">x</code></td>
<td>
<p>numeric vector</p>
</td></tr>
<tr><td><code id="meanSub_+3A_sub">sub</code></td>
<td>
<p>integer index</p>
</td></tr>
<tr><td><code id="meanSub_+3A_na.rm">na.rm</code></td>
<td>
<p>logical</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>

<hr>
<h2 id='monthCor'>monthCor</h2><span id='topic+monthCor'></span>

<h3>Description</h3>

<p>monthCor
</p>


<h3>Usage</h3>

<pre><code class='language-R'>monthCor(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="monthCor_+3A_x">x</code></td>
<td>
<p>ts</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>

<hr>
<h2 id='monthNum'>monthNum</h2><span id='topic+monthNum'></span>

<h3>Description</h3>

<p>Converts dates to the corresponding numeric month.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>monthNum(y)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="monthNum_+3A_y">y</code></td>
<td>
<p>date</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>

<hr>
<h2 id='mts2ts'>Converts matrix to vector time series for various analyses</h2><span id='topic+mts2ts'></span>

<h3>Description</h3>

<p>First aggregates multivariate matrix time series by year. Then converts to a
vector time series in which &ldquo;seasons&rdquo; correspond to these annualized
values for the original variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mts2ts(x, seas = 1:frequency(x), na.rm = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mts2ts_+3A_x">x</code></td>
<td>
<p>An object of class &quot;mts&quot;</p>
</td></tr>
<tr><td><code id="mts2ts_+3A_seas">seas</code></td>
<td>
<p>Numeric vector of seasons to aggregate in original time series.</p>
</td></tr>
<tr><td><code id="mts2ts_+3A_na.rm">na.rm</code></td>
<td>
<p>Should missing data be ignored when aggregating?</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>seas</code> parameter enables focusing the subsequent analysis on
seasons of special interest, or to ignore seasons where there are too many
missing data. The function can be used in conjunction with <code>seaKen</code> to
conduct a Regional Kendall trend analysis. Sometimes just plotting the
resulting function can be useful for exploring a spatial transect over time.
</p>


<h3>Value</h3>

<p>A vector time series
</p>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>


<h3>See Also</h3>

<p><code><a href="#topic+seaKen">seaKen</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Quick plot a spatial transect of chlorophyll a during the 
## spring bloom period (Feb-Apr) for each year.
y &lt;- mts2ts(sfbayChla, seas = 2:4)
plot(y, type = 'n')
abline(v = 1978:2010, col = 'lightgrey')
lines(y, type = 'h')

</code></pre>

<hr>
<h2 id='oxySol'>Dissolved oxygen at saturation</h2><span id='topic+oxySol'></span>

<h3>Description</h3>

<p>Finds dissolved oxygen concentration in equilibrium with water-saturated
air.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>oxySol(t, S, P = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="oxySol_+3A_t">t</code></td>
<td>
<p>temperature, degrees C</p>
</td></tr>
<tr><td><code id="oxySol_+3A_s">S</code></td>
<td>
<p>salinity, on the Practical Salinity Scale</p>
</td></tr>
<tr><td><code id="oxySol_+3A_p">P</code></td>
<td>
<p>pressure, atm</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Calculations are based on the approach of Benson and Krause (1984), using
Green and Carritt's (1967) equation for dependence of water vapor partial
pressure on <code>t</code> and <code>S</code>. Equations are valid for temperature in
the range 0-40 C and salinity in the range 0-40.
</p>


<h3>Value</h3>

<p>Dissolved oxygen concentration in mg/L at 100% saturation. If
<code>P = NULL</code>, saturation values at 1 atm are calculated.
</p>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>


<h3>References</h3>

<p>Benson, B.B. and Krause, D. (1984) The concentration and
isotopic fractionation of oxygen dissolved in fresh-water and seawater in
equilibrium with the atmosphere. <em>Limnology and Oceanography</em>
<b>29,</b> 620-632.
</p>
<p>Green, E.J. and Carritt, D.E. (1967) New tables for oxygen saturation of
seawater. <em>Journal of Marine Research</em> <b>25,</b> 140-147.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Convert DO into % saturation for 1-m depth at Station 32.
# Use convention of expressing saturation at 1 atm.
sfb1 &lt;- subset(sfbay, depth == 1 &amp; stn == 32)
dox.pct &lt;- with(sfb1, 100 * dox/oxySol(temp, sal))
summary(dox.pct)

</code></pre>

<hr>
<h2 id='pett'>Nonparametric Change-Point Detection</h2><span id='topic+pett'></span>

<h3>Description</h3>

<p>Locates a single change-point in an annual series based on the Pettitt test.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pett(x, plot = FALSE, order = FALSE, pval = 0.05, pchs = c(19, 21), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pett_+3A_x">x</code></td>
<td>
<p>a numeric vector, matrix or data frame with no missing interior
values</p>
</td></tr>
<tr><td><code id="pett_+3A_plot">plot</code></td>
<td>
<p>Should the trends be plotted when x is a matrix?</p>
</td></tr>
<tr><td><code id="pett_+3A_order">order</code></td>
<td>
<p>Should the plotted trends be ordered by size?</p>
</td></tr>
<tr><td><code id="pett_+3A_pval">pval</code></td>
<td>
<p>p-value for significance</p>
</td></tr>
<tr><td><code id="pett_+3A_pchs">pchs</code></td>
<td>
<p>Plot symbols for significant and not significant trend
estimates, respectively</p>
</td></tr>
<tr><td><code id="pett_+3A_...">...</code></td>
<td>
<p>Other arguments to pass to plotting function</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Pettitt's (1979) method is a rank-based nonparametric test for abrupt
changes in a time series. It uses the Mann-Whitney statistic for testing
that two samples (before and after the change-point) come from the same
distribution, choosing the change-point that maximizes the statistic. The
<em>p</em>-value is approximate but accurate to 0.01 for <code class="reqn">p \le</code> 0.5.
Serial correlation is ignored, so the interval between points should be long
enough to avoid strong serial correlation. The size of the change is
estimated as the median difference between all pairs of observations in
which the first one is after the change-point and the second is up to the
change-point.
</p>
<p>Missing values are allowed at the beginning or end of each variable but
interior missing values will produce an NA. Otherwise the change-point might
not be meaningful.
</p>
<p>If <code>plot = TRUE</code>, a dot plot of <code>change.times</code> is shown. If
<code>sort = TRUE</code>, the dots are sorted by <code>change.time</code>. The plot
symbols indicate, respectively, that the trend is significant or not
significant. The plot can be customized by passing any arguments used by
<code><a href="graphics.html#topic+dotchart">dotchart</a></code> such as <code>xlab</code>, as well as graphical parameters
described in <code><a href="graphics.html#topic+par">par</a></code>.
</p>


<h3>Value</h3>

<p>A list of the following if <code>x</code> is a vector:
</p>
<table role = "presentation">
<tr><td><code>pettitt.K</code></td>
<td>
<p>Pettitt's statistic</p>
</td></tr> <tr><td><code>p.value</code></td>
<td>
<p>significance
probability for statistic</p>
</td></tr> <tr><td><code>change.point</code></td>
<td>
<p>last position preceding
change to new level</p>
</td></tr> <tr><td><code>change.time</code></td>
<td>
<p>if available, time of change.point
position</p>
</td></tr> <tr><td><code>change.size</code></td>
<td>
<p>median of all differences between points after
and up to change.point</p>
</td></tr></table>
<p> or a matrix with corresponding columns if <code>x</code>
is a matrix or data frame.
</p>


<h3>Note</h3>

<p>The <code>change.point</code> returned by these functions is the last
position before the series actually changes, for consistency with the
original Pettitt test. But for reporting purposes, the following position
might be more appropriate to call the &ldquo;change-point&rdquo;.
</p>
<p>The Pettitt test produces a supposed change-point, even when the trend is
smooth, or when the abrupt change is smaller than the long-term smooth
change. Remove any smooth, long-term trend before applying this test.
</p>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>


<h3>References</h3>

<p>Pettitt, A. N. (1979) A non-parametric approach to the
change-point problem. <em>Journal of the Royal Statistical Society. Series
C (Applied Statistics)</em> <b>28(2),</b> 126&ndash;135.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# data from Pettitt (1979, Table 1):
y &lt;- c(-1.05, 0.96, 1.22, 0.58, -0.98, -0.03, -1.54, -0.71, -0.35, 0.66, 
0.44, 0.91, -0.02, -1.42, 1.26, -1.02, -0.81, 1.66, 1.05, 0.97, 2.14, 1.22, 
-0.24, 1.60, 0.72, -0.12, 0.44, 0.03, 0.66, 0.56, 1.37, 1.66, 0.10, 0.80, 
1.29, 0.49, -0.07, 1.18, 3.29, 1.84)
pett(y) # K=232, p=0.0146, change-point=17, the same results as Pettitt
# identify the year of a change-point in an annual time series:
pett(Nile)
# apply to a matrix time series:
y &lt;- ts.intersect(Nile, LakeHuron)
pett(y)
pett(y, plot = TRUE, xlab = "Change-point")
legend("topleft", legend = "p &lt; 0.05", pch = 19, bty="n")
# note how a smooth trend can disguise a change-point:
# smooth trend with change-point at 75
y &lt;- 1:100 + c(rep(0, 75), rep(10, 25)) 
pett(y) # gives 50, erroneously
pett(residuals(lm(y~I(1:100)))) # removing trend gives 75, correctly

</code></pre>

<hr>
<h2 id='phenoAmp'>Phenological amplitude</h2><span id='topic+phenoAmp'></span><span id='topic+phenoAmp+2Cts-method'></span><span id='topic+phenoAmp+2Czoo-method'></span>

<h3>Description</h3>

<p>Finds various measures of the amplitude of the annual cycle, or of some
specified season range.
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="phenoAmp_+3A_x">x</code></td>
<td>
<p>A seasonal time series, or a class <code>zoo</code> object.</p>
</td></tr>
<tr><td><code id="phenoAmp_+3A_season.range">season.range</code></td>
<td>
<p>A vector of two numbers specifying the season range to
be considered.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>phenoAmp</code> gives three measures of the amplitude of a seasonal cycle:
the range, the variance, and the median absolute deviation, along with the
mean and median to allow calculation of other statistics as well.
</p>
<p>These measures can be restricted to a subset of the year by giving the
desired range of season numbers. This can be useful for isolating measures
of, say, the spring and autumn phytoplankton blooms in temperate waters. In
the case of a monthly time series, for example, a non-missing value is
required for every month or the result will be <code>NA</code>, so using a period
shorter than one year can also help avoid any months that are typically not
covered by the sampling program. Similarly, in the case of dated
observations, a shorter period can help avoid times of sparse data. The
method for time series allows for other than monthly frequencies, but
<code>season.range</code> is always interpreted as months for <code>zoo</code> objects.
</p>
<p>Note that the amplitude is sensitive to the number of samples for small
numbers. This could be a problem for <code>zoo</code> objects if the sample number
is changing greatly from year to year, depending on the amplitude measure
and the underlying data distribution. So use <code>ts</code> objects or make sure
that the sample number stays more or less the same over time.
</p>
<p><code><a href="#topic+tsMake">tsMake</a></code> can be used to produce <code>ts</code> and <code>zoo</code> objects
suitable as arguments to this function.
</p>


<h3>Value</h3>

<p>A matrix of class <code>ts</code> or <code>zoo</code> with individual series for
the range, variance, median absolute deviation, mean, median and &ndash; in the
case of <code>zoo</code> objects &ndash; number of samples.
</p>


<h3>References</h3>

<p>Cloern, J.E. and Jassby, A.D. (2008) Complex seasonal patterns
of primary producers at the land-sea interface. <em>Ecology Letters</em>
<b>11,</b> 1294&ndash;1303.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+phenoPhase">phenoPhase</a></code>, <code><a href="#topic+tsMake">tsMake</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
y &lt;- sfbayChla[, "s27"]
phenoAmp(y) # entire year
# i.e., Jan-Jun only, which yields results for more years
phenoAmp(y, c(1, 6))

</code></pre>

<hr>
<h2 id='phenoAmp-methods'>Methods for Function phenoAmp</h2><span id='topic+phenoAmp-methods'></span>

<h3>Description</h3>

<p>Finds various measures of the amplitude of the annual cycle.
</p>


<h3>Methods</h3>

 <dl>
<dt>list(&quot;signature(x = \&quot;ts\&quot;)&quot;)</dt><dd><p>See
<code><a href="#topic+phenoAmp+2Cts-method">phenoAmp,ts-method</a></code></p>
</dd> <dt>list(&quot;signature(x = \&quot;zoo\&quot;)&quot;)</dt><dd><p>See
<code><a href="#topic+phenoAmp+2Czoo-method">phenoAmp,zoo-method</a></code></p>
</dd> </dl>


<hr>
<h2 id='phenoPhase'>Phenological phase</h2><span id='topic+phenoPhase'></span><span id='topic+phenoPhase+2Cts-method'></span><span id='topic+phenoPhase+2Czoo-method'></span>

<h3>Description</h3>

<p>Finds various measures of the phase of the annual cycle, or of some
specified month range.
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="phenoPhase_+3A_x">x</code></td>
<td>
<p>A seasonal time series, or a class <code>zoo</code> object.</p>
</td></tr>
<tr><td><code id="phenoPhase_+3A_season.range">season.range</code></td>
<td>
<p>A vector of two numbers specifying the season range to
be considered.</p>
</td></tr>
<tr><td><code id="phenoPhase_+3A_out">out</code></td>
<td>
<p>The form of the output.</p>
</td></tr>
<tr><td><code id="phenoPhase_+3A_...">...</code></td>
<td>
<p>Additional arguments to be passed for changing integration
defaults.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>phenoPhase</code> gives three measures of the phasing of a seasonal cycle:
the time of the maximum (Cloern and Jassby 2008), the <em>fulcrum</em> or
center of gravity, and the weighted mean season (Colebrook 1979). The latter
has sometimes been referred to in the literature as &ldquo;centre of
gravity&rdquo;, but it is not actually the same. These measures differ in their
sensitivity to changes in the seasonal pattern, and therefore also in their
susceptibility to sampling variability. The time of maximum is the most
sensitive, the weighted mean the least.
</p>
<p>These measures can be restricted to a subset of the year by giving the
desired range of seasons. This can be useful for isolating measures of, say,
the spring and autumn phytoplankton blooms in temperate waters. In the case
of a seasonal time series, a non-missing value is required for every season
or the result will be <code>NA</code>, so using a period shorter than one year can
also help avoid any seasons that are typically not covered by the sampling
program. Similarly, in the case of dated observations, a shorter period can
help avoid times of sparse data. The method for time series allows for other
than monthly frequencies, but <code>season.range</code> is always interpreted as
months for <code>zoo</code> objects. The method for time series requires data for
all seasons in <code>season.range</code>. The method for <code>zoo</code> objects will
provide a result regardless of number of sampling days, so make sure that
data are sufficient for a meaningful result.
</p>
<p>The measures are annum-centric, i.e., they reflect the use of calendar year
as the annum, which may not be appropriate for cases in which important
features occur in winter and span two calendar years. Such cases can be
handled by lagging the time series by an appropriate number of months, or by
subtracting an appropriate number of days from the individual dates.
</p>
<p><code><a href="#topic+tsMake">tsMake</a></code> can be used to produce <code>ts</code> and <code>zoo</code> objects
suitable as arguments to this function.
</p>
<p>The default parameters used for the <code>integrate</code> function in
<code>phenoPhase</code> may fail for certain datasets. Try increasing the number
of subdivisions above its default of 100 by adding, for example,
<code>subdivisions = 1000</code> to the arguments of <code>phenoPhase</code>.
</p>


<h3>Value</h3>

<p>A data frame with columns year, time of the maximum, fulcrum,
weighted mean time and &ndash; in the case of <code>zoo</code> objects &ndash; number of
observations. In the case of seasonal time series, the results are all given
as decimal seasons of the year. In the case of dated observations, the
results can be dates, day of the year, or julian day with an origin of
1970-01-01, depending on the option <code>out</code>.
</p>


<h3>References</h3>

<p>Cloern, J.E. and Jassby, A.D. (2008) Complex seasonal patterns
of primary producers at the land-sea interface. <em>Ecology Letters</em>
<b>11,</b> 1294&ndash;1303.
</p>
<p>Colebrook, J.M. (1979) Continuous plankton records - seasonal cycles of
phytoplankton and copepods in the North Atlantic ocean and the North Sea.
<em>Marine Biology</em> <b>51,</b> 23&ndash;32.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+phenoAmp">phenoAmp</a></code>, <code><a href="#topic+tsMake">tsMake</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# ts example
y &lt;- sfbayChla[, "s27"]
p1 &lt;- phenoPhase(y)
p1
apply(p1, 2, sd, na.rm = TRUE)  # max.time &gt; fulcrum &gt; mean.wt
phenoPhase(y, c(3, 10))

# zoo example
sfb &lt;- wqData(sfbay, c(1, 3, 4), 5:12, site.order = TRUE, type = "wide",
  time.format = "%m/%d/%Y")
y &lt;- tsMake(sfb, focus = "chl", layer = c(0, 5), type = "zoo")
phenoPhase(y[, "s27"])

</code></pre>

<hr>
<h2 id='phenoPhase-methods'>Methods for Function phenoPhase</h2><span id='topic+phenoPhase-methods'></span>

<h3>Description</h3>

<p>Finds various measures of the phase of the annual cycle.
</p>


<h3>Methods</h3>

 <dl>
<dt>list(&quot;signature(x = \&quot;ts\&quot;)&quot;)</dt><dd><p>See
<code><a href="#topic+phenoPhase+2Cts-method">phenoPhase,ts-method</a></code></p>
</dd> <dt>list(&quot;signature(x =
\&quot;zoo\&quot;)&quot;)</dt><dd><p>See <code><a href="#topic+phenoPhase+2Czoo-method">phenoPhase,zoo-method</a></code></p>
</dd> </dl>


<hr>
<h2 id='plotSeason'>Plots seasonal patterns for a time series</h2><span id='topic+plotSeason'></span>

<h3>Description</h3>

<p>Divides the time range for a monthly time series into different eras and
plots composites of seasonal pattern. Can also plot each month separately
for the entire record.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotSeason(
  x,
  type = c("by.era", "by.month"),
  num.era = 4,
  same.plot = TRUE,
  ylab = NULL,
  num.col = 3
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plotSeason_+3A_x">x</code></td>
<td>
<p>Monthly time series</p>
</td></tr>
<tr><td><code id="plotSeason_+3A_type">type</code></td>
<td>
<p>Plot seasonal pattern by era, or each month for the entire
record</p>
</td></tr>
<tr><td><code id="plotSeason_+3A_num.era">num.era</code></td>
<td>
<p>Integer number of eras, or vector of era year breaks</p>
</td></tr>
<tr><td><code id="plotSeason_+3A_same.plot">same.plot</code></td>
<td>
<p>Should eras be plotted by month?</p>
</td></tr>
<tr><td><code id="plotSeason_+3A_ylab">ylab</code></td>
<td>
<p>Optional character string label for y-axis</p>
</td></tr>
<tr><td><code id="plotSeason_+3A_num.col">num.col</code></td>
<td>
<p>Number of columns when plotted <code>"by.month"</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>num.era</code> is an integer, the time range is divided into that many
equal eras; otherwise, the time range is divided into eras determined by the
<code>num.era</code> vector of years. When plotted <code>"by.era"</code> and
<code>same.plot = FALSE</code>, the composite patterns are plotted in a horizontal
row for easier comparison, which limits the number of periods that can be
examined. Boxes based on fewer than half of the maximum possible years
available are outlined in red. If <code>same.plot = TRUE</code>, a single plot is
produced with era boxplots arranged by month. When plotted
<code>"by.month"</code>, values for each month are first converted to standardized
anomalies, i.e., by subtraction of long-term mean and division by standard
deviation. As always, and especially with these plots, experiment with the
device aspect ratio and size to get the clearest information.
</p>


<h3>Value</h3>

<p>A plot (and the corresponding object of class <code>"ggplot"</code>).
</p>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>


<h3>See Also</h3>

<p><code><a href="#topic+decompTs">decompTs</a></code>, <code><a href="#topic+seasonTrend">seasonTrend</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
chl27 &lt;- sfbayChla[, "s27"]
plotSeason(chl27, num.era = c(1978, 1988, 1998, 2008), ylab = "Stn 27 Chl-a")
## Not run: 
plotSeason(chl27, num.era = 3, same.plot = FALSE, ylab = "Stn 27 Chl-a")
plotSeason(chl27, "by.month", ylab = "Stn 27 Chl-a")

## End(Not run)

</code></pre>

<hr>
<h2 id='plotTs'>Time series plot</h2><span id='topic+plotTs'></span>

<h3>Description</h3>

<p>Creates line plot of vector or matrix time series, including any data
surrounded by NAs as additional points.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotTs(
  x,
  dot.size = 1,
  xlab = NULL,
  ylab = NULL,
  strip.labels = colnames(x),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plotTs_+3A_x">x</code></td>
<td>
<p>matrix or vector time series</p>
</td></tr>
<tr><td><code id="plotTs_+3A_dot.size">dot.size</code></td>
<td>
<p>size of dots representing isolated data points</p>
</td></tr>
<tr><td><code id="plotTs_+3A_xlab">xlab</code></td>
<td>
<p>optional x-axis label</p>
</td></tr>
<tr><td><code id="plotTs_+3A_ylab">ylab</code></td>
<td>
<p>optional y-axis label</p>
</td></tr>
<tr><td><code id="plotTs_+3A_strip.labels">strip.labels</code></td>
<td>
<p>labels for individual time series plots</p>
</td></tr>
<tr><td><code id="plotTs_+3A_...">...</code></td>
<td>
<p>additional options</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The basic time series line plot ignores data points that are adjacent to
missing data, i.e., not directly connected to other observations. This can
lead to an uninformative plot when there are many missing data. If one
includes both a point and line plot, the resulting graph can be cluttered
and difficult to decipher. <code>plotTs</code> plots only isolated points as well
as lines joining adjacent observations.
</p>
<p>Options are passed to the underlying <code>facet_wrap</code> function in
<span class="pkg">ggplot2</span>. The main ones of interest are <code>ncol</code> for setting the
number of plotting columns and <code>scales = "free_y"</code> for allowing the y
scales of the different plots to be independent.
</p>


<h3>Value</h3>

<p>A plot or plots and corresponding object of class &ldquo;ggplot&rdquo;.
</p>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plotTsAnom">plotTsAnom</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Chlorophyll at 4 stations in SF Bay
chl &lt;- sfbayChla[, 1:4]
plotTs(chl, dot.size = 1.5, ylab = 'Chl-a', strip.labels = paste('Station',
  substring(colnames(chl), 2, 3)), ncol = 1, scales = "free_y")

</code></pre>

<hr>
<h2 id='plotTsAnom'>Anomaly plot of time series</h2><span id='topic+plotTsAnom'></span>

<h3>Description</h3>

<p>Series are illustrated by vertical lines extending from individual data
values to the long-term mean. The axes are not scaled in any way. Anomaly
plots are useful for visualizing shifts in time series levels.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotTsAnom(x, xlab = NULL, ylab = NULL, strip.labels = colnames(x), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plotTsAnom_+3A_x">x</code></td>
<td>
<p>matrix or vector time series</p>
</td></tr>
<tr><td><code id="plotTsAnom_+3A_xlab">xlab</code></td>
<td>
<p>optional x-axis label</p>
</td></tr>
<tr><td><code id="plotTsAnom_+3A_ylab">ylab</code></td>
<td>
<p>optional y-axis label</p>
</td></tr>
<tr><td><code id="plotTsAnom_+3A_strip.labels">strip.labels</code></td>
<td>
<p>labels for individual time series plots</p>
</td></tr>
<tr><td><code id="plotTsAnom_+3A_...">...</code></td>
<td>
<p>additional options</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Options are passed to the underlying <code>facet_wrap</code> function in
<span class="pkg">ggplot2</span>. The main ones of interest are <code>ncol</code> for setting the
number of plotting columns and <code>scales = "free_y"</code> for allowing the y
scales of the different plots to be independent.
</p>


<h3>Value</h3>

<p>A plot and corresponding object of class &ldquo;ggplot&rdquo;.
</p>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plotTs">plotTs</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Spring bloom size for 6 stations in SF Bay
bloom &lt;- aggregate(sfbayChla[, 1:6], 1, meanSub, sub=3:5)
plotTsAnom(bloom, ylab = 'Chl-a', strip.labels = paste('Station',
  substring(colnames(bloom), 2, 3)), ncol = 2, scales = "free_y")

</code></pre>

<hr>
<h2 id='plotTsTile'>Image plot of monthly time series</h2><span id='topic+plotTsTile'></span>

<h3>Description</h3>

<p>Monthly values are transformed into deciles or other bins, and corresponding
colors are plotted in a month by year matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotTsTile(
  x,
  plot.title = NULL,
  legend.title = NULL,
  four = TRUE,
  loganom = TRUE,
  square = TRUE,
  legend = TRUE,
  trim = TRUE,
  overall = TRUE,
  stat = c("median", "mean")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plotTsTile_+3A_x">x</code></td>
<td>
<p>monthly time series.</p>
</td></tr>
<tr><td><code id="plotTsTile_+3A_plot.title">plot.title</code></td>
<td>
<p>plot title.</p>
</td></tr>
<tr><td><code id="plotTsTile_+3A_legend.title">legend.title</code></td>
<td>
<p>legend title.</p>
</td></tr>
<tr><td><code id="plotTsTile_+3A_four">four</code></td>
<td>
<p>logical indicating if data should be binned into 4 special
groups or into deciles.</p>
</td></tr>
<tr><td><code id="plotTsTile_+3A_loganom">loganom</code></td>
<td>
<p>logical indicating if data should be transformed into
log-anomalies.</p>
</td></tr>
<tr><td><code id="plotTsTile_+3A_square">square</code></td>
<td>
<p>logical indicating if tiles should be square.</p>
</td></tr>
<tr><td><code id="plotTsTile_+3A_legend">legend</code></td>
<td>
<p>logical indicating if a legend should be included.</p>
</td></tr>
<tr><td><code id="plotTsTile_+3A_trim">trim</code></td>
<td>
<p>logical indicating if leading and trailing NA values should be
removed.</p>
</td></tr>
<tr><td><code id="plotTsTile_+3A_overall">overall</code></td>
<td>
<p>determines whether anomalies are calculated with respect to
overall mean or to long-term mean for the same month.</p>
</td></tr>
<tr><td><code id="plotTsTile_+3A_stat">stat</code></td>
<td>
<p>determines whether anomalies are calculated and binned using
mean or median.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>four = TRUE</code>, then <code>x</code> is first divided into a positive and
negative bin. Each bin is then further divided into two bins by its mean,
yielding a total of four bins. If <code>four=FALSE</code>, then <code>x</code> is simply
divided into deciles. In either case, each bin has its own assigned color,
with colors ranging from dark blue (smallest numbers) through light blue and
pink to red.
</p>
<p>Although <code>four = TRUE</code> can be useful for any data in which 0 represents
a value with special significance, it is especially so for data converted
into log-anomalies, i.e., <code>log10(x/xbar)</code> where <code>xbar = mean(x,
na.rm=TRUE)</code>. The mean month then has value 0, and a value of -1, for
example, indicates original data equal to one-tenth the mean. Log-anomaly
transforms can be particularly appropriate for biological populations, in
which variability is often approximately proportional to the mean.
</p>
<p>When <code>loganom = TRUE</code>, the anomalies are calculated with respect to the
overall mean month. This differs from, for example, the log-anomaly
zooplankton plot of O'Brien et al. (2008), in which a monthly anomaly is
calculated with respect to the mean value of the same month. To get the
latter behavior, set <code>overall = FALSE</code>. A further option is to set
<code>stat = "median"</code> rather than the default <code>stat = "mean"</code>, in
which case <code>xbar = median(x, na.rm = TRUE)</code>, and the positive and
negative bins are each divided into two bins by their median instead of
mean. Using combinations of these different options can reveal complementary
information.
</p>
<p>You may want to set <code>square = FALSE</code> and then adjust the plot window
manually if you plan to use the plot in a subsequent layout or if there is
too much white space.
</p>


<h3>Value</h3>

<p>An image plot of monthly values classified into either deciles or
into four bins as described above (and corresponding object of class
&ldquo;ggplot&rdquo;).
</p>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>


<h3>References</h3>

<p>O'Brien T., Lopez-Urrutia A., Wiebe P.H., Hay S. (editors)
(2008) <em>ICES Zooplankton Status Report 2006/2007.</em> ICES Cooperative
Research Report 292, International Council for the Exploration of the Sea,
Copenhagen, 168 p.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# plot log-anomalies in four bins
chl27 = sfbayChla[, 's27']
plotTsTile(chl27, legend.title = 'Chl log-anomaly')

# plot deciles
plotTsTile(chl27, plot.title = 'SF Bay station 27', legend.title =
	'chlorophyll', four = FALSE, loganom = FALSE, square = FALSE)

</code></pre>

<hr>
<h2 id='R2pss'>R2pss</h2><span id='topic+R2pss'></span>

<h3>Description</h3>

<p>R2pss
</p>


<h3>Usage</h3>

<pre><code class='language-R'>R2pss(R, t, p = 0)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="R2pss_+3A_r">R</code></td>
<td>
<p>conductivity ratio, dimensionless</p>
</td></tr>
<tr><td><code id="R2pss_+3A_t">t</code></td>
<td>
<p>temperature, Celsius</p>
</td></tr>
<tr><td><code id="R2pss_+3A_p">p</code></td>
<td>
<p>gauge pressure, decibar</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>

<hr>
<h2 id='seaKen'>Seasonal and Regional Kendall trend test</h2><span id='topic+seaKen'></span>

<h3>Description</h3>

<p>Calculates the Seasonal or Regional Kendall test of trend significance,
including an estimate of the Sen slope.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>seaKen(
  x,
  plot = FALSE,
  type = c("slope", "relative"),
  order = FALSE,
  pval = 0.05,
  mval = 0.5,
  pchs = c(19, 21),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="seaKen_+3A_x">x</code></td>
<td>
<p>A numeric vector, matrix or data frame made up of seasonal time
series</p>
</td></tr>
<tr><td><code id="seaKen_+3A_plot">plot</code></td>
<td>
<p>Should the trends be plotted when x is a matrix or data frame?</p>
</td></tr>
<tr><td><code id="seaKen_+3A_type">type</code></td>
<td>
<p>Type of trend to be plotted, actual or relative to series median</p>
</td></tr>
<tr><td><code id="seaKen_+3A_order">order</code></td>
<td>
<p>Should the plotted trends be ordered by size?</p>
</td></tr>
<tr><td><code id="seaKen_+3A_pval">pval</code></td>
<td>
<p>p-value for significance</p>
</td></tr>
<tr><td><code id="seaKen_+3A_mval">mval</code></td>
<td>
<p>Minimum fraction of seasons needed with non-missing slope
estimates</p>
</td></tr>
<tr><td><code id="seaKen_+3A_pchs">pchs</code></td>
<td>
<p>Plot symbols for significant and not significant trend
estimates, respectively</p>
</td></tr>
<tr><td><code id="seaKen_+3A_...">...</code></td>
<td>
<p>Other arguments to pass to plotting function</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The Seasonal Kendall test (Hirsch et al. 1982) is based on the Mann-Kendall
tests for the individual seasons (see <code><a href="#topic+mannKen">mannKen</a></code> for additional
details). <em>p</em>-values provided here are not corrected for serial
correlation among seasons.
</p>
<p>If <code>plot = TRUE</code>, then either the Sen slope in units per year
(<code>type = "slope"</code>) or the relative slope in fraction per year
(<code>type = "relative"</code>) is plotted. The relative slope is defined
identically to the Sen slope except that each slope is divided by the first
of the two values that describe the slope. Plotting the relative slope is
useful when the variables in <code>x</code> are always positive and have different
units.
</p>
<p>The plot symbols indicate, respectively, that the trend is statistically
significant or not. The plot can be customized by passing any arguments used
by <code><a href="graphics.html#topic+dotchart">dotchart</a></code> such as <code>xlab</code>, as well as graphical
parameters described in <code><a href="graphics.html#topic+par">par</a></code>.
</p>
<p>If <code>mval</code> or more of the seasonal slope estimates are missing, then
that trend is considered to be missing. The seasonal slope estimate
(<code><a href="#topic+mannKen">mannKen</a></code>), in turn, is missing if half or more of the possible
comparisons between the first and last 20% of the years are missing.
</p>
<p>The function can be used in conjunction with <code>mts2ts</code> to calculate a
Regional Kendall test of significance for annualized data, along with a
regional estimate of trend (Helsel and Frans 2006). See the examples below.
</p>


<h3>Value</h3>

<p>A list of the following if <code>x</code> is a vector: <code>seaKen</code>
returns a list with the following members: </p>
<table role = "presentation">
<tr><td><code>sen.slope</code></td>
<td>
<p>Sen slope</p>
</td></tr>
<tr><td><code>sen.slope.pct</code></td>
<td>
<p>Sen slope as percent of mean</p>
</td></tr>
<tr><td><code>p.value</code></td>
<td>
<p>significance of slope</p>
</td></tr> <tr><td><code>miss</code></td>
<td>
<p>for each season, the
fraction missing of slopes connecting first and last 20% of the years</p>
</td></tr></table>
<p> or a
matrix with corresponding columns if <code>x</code> is a matrix or data frame.
</p>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>


<h3>References</h3>

<p>Helsel, D.R. and Frans, L. (2006) Regional Kendall test for
trend. <em>Environmental Science and Technology</em> <b>40(13),</b> 4066-4073.
</p>
<p>Hirsch, R.M., Slack, J.R., and Smith, R.A. (1982) Techniques of trend
analysis for monthly water quality data. <em>Water Resources Research</em>
<b>18,</b> 107-121.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mannKen">mannKen</a></code>, <code><a href="#topic+mts2ts">mts2ts</a></code>,
<code><a href="#topic+trendHomog">trendHomog</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Seasonal Kendall test:
chl &lt;- sfbayChla # monthly chlorophyll at 16 stations in San Francisco Bay
seaKen(sfbayChla[, 's27']) # results for a single series at station 27
seaKen(sfbayChla) # results for all stations
seaKen(sfbayChla, plot=TRUE, type="relative", order=TRUE)

# Regional Kendall test:
# Use mts2ts to change 16 series into a single series with 16 "seasons"
seaKen(mts2ts(chl))  # too many missing data
# better when just Feb-Apr, spring bloom period,
# but last 4 stations still missing too much.
seaKen(mts2ts(chl, seas = 2:4)) 
seaKen(mts2ts(chl[, 1:12], 2:4)) # more reliable result

</code></pre>

<hr>
<h2 id='seaRoll'>Rolling Seasonal Kendall trend test</h2><span id='topic+seaRoll'></span>

<h3>Description</h3>

<p>Calculates the Seasonal Kendall test of significance, including an estimate
of the Sen slope, for rolling windows over a time series.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>seaRoll(
  x,
  w = 10,
  plot = FALSE,
  pval = 0.05,
  mval = 0.5,
  pchs = c(19, 21),
  xlab = NULL,
  ylab = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="seaRoll_+3A_x">x</code></td>
<td>
<p>A seasonal time series vector.</p>
</td></tr>
<tr><td><code id="seaRoll_+3A_w">w</code></td>
<td>
<p>The window width for &ldquo;rolling&rdquo; estimates of slope.</p>
</td></tr>
<tr><td><code id="seaRoll_+3A_plot">plot</code></td>
<td>
<p>Indicates if a plot should be drawn</p>
</td></tr>
<tr><td><code id="seaRoll_+3A_pval">pval</code></td>
<td>
<p>p-value for significance</p>
</td></tr>
<tr><td><code id="seaRoll_+3A_mval">mval</code></td>
<td>
<p>Minimum fraction of seasons needed with non-missing slope
estimates</p>
</td></tr>
<tr><td><code id="seaRoll_+3A_pchs">pchs</code></td>
<td>
<p>Plot symbols for significant and not significant trend
estimates, respectively</p>
</td></tr>
<tr><td><code id="seaRoll_+3A_xlab">xlab</code></td>
<td>
<p>Optional label for x-axis</p>
</td></tr>
<tr><td><code id="seaRoll_+3A_ylab">ylab</code></td>
<td>
<p>Optional label for y-axis</p>
</td></tr>
<tr><td><code id="seaRoll_+3A_...">...</code></td>
<td>
<p>Other arguments to pass to plotting function</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function <code>seaRoll</code> applies <code>seaKen</code> to rolling time windows of
width <code>w</code>. A minimum <code>w</code> of five years is required. For any
window, a season is considered missing if half or more of the possible
comparisons between the first and last 20% of the years is missing. If
<code>mval</code> or more of the seasons are missing, then that windowed trend is
considered to be missing.
</p>
<p>If <code>plot = TRUE</code>, a point plot will be drawn with the Sen slope plotted
at the leading year of the trend window. The plot symbols indicate,
respectively, that the trend is significant or not significant. The plot can
be customized by passing any arguments used by <code><a href="graphics.html#topic+plot.default">plot.default</a></code>,
as well as graphical parameters described in <code><a href="graphics.html#topic+par">par</a></code>.
</p>


<h3>Value</h3>

<p><code>seaRoll</code> returns a matrix with one row per time window
containing the Sen slope, the relative Sen slope, and the <em>p-</em>value.
Rows are labelled with the leading year of the window.
</p>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>


<h3>See Also</h3>

<p><code><a href="#topic+seaKen">seaKen</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
chl27 &lt;- sfbayChla[, 's27']
seaRoll(chl27)
seaRoll(chl27, plot = TRUE)

</code></pre>

<hr>
<h2 id='seasonTrend'>Determine seasonal trends</h2><span id='topic+seasonTrend'></span>

<h3>Description</h3>

<p>Finds the trend for each season and each variable in a time series.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>seasonTrend(x, plot = FALSE, type = c("slope", "relative"), pval = 0.05, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="seasonTrend_+3A_x">x</code></td>
<td>
<p>Time series vector, or time series matrix with column names</p>
</td></tr>
<tr><td><code id="seasonTrend_+3A_plot">plot</code></td>
<td>
<p>Should the results be plotted?</p>
</td></tr>
<tr><td><code id="seasonTrend_+3A_type">type</code></td>
<td>
<p>Type of trend to be plotted, actual or relative to series median</p>
</td></tr>
<tr><td><code id="seasonTrend_+3A_pval">pval</code></td>
<td>
<p>p-value for significance</p>
</td></tr>
<tr><td><code id="seasonTrend_+3A_...">...</code></td>
<td>
<p>Further options to pass to plotting function</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The Mann-Kendall test is applied for each season and series (in the case of
a matrix). The actual and relative Sen slope (actual divided by median for
that specific season and series); the p-value for the trend; and the
fraction of missing slopes involving the first and last fifths of the data
are calculated (see <code><a href="#topic+mannKen">mannKen</a></code>).
</p>
<p>If <code>plot = TRUE</code>, each season for each series is represented by a bar
showing the trend. The fill colour indicates whether <code class="reqn">p &lt; 0.05</code> or not.
If the fraction of missing slopes is 0.5 or more, the corresponding trends
are omitted.
</p>
<p>Parameters can be passed to the plotting function, in particular, to
<code>facet_wrap</code> in <span class="pkg">ggplot2</span>. The most useful parameters here are
<code>ncol</code> (or <code>nrow</code>), which determines the number of columns (or
rows) of plots, and <code>scales</code>, which can be set to <code>"free_y"</code> to
allow the y-axis to change for each time series. Like all <span class="pkg">ggplot2</span>
objects, the plot output can also be customized extensively by modifying and
adding layers.
</p>


<h3>Value</h3>

<p>A data frame with the following fields: </p>
<table role = "presentation">
<tr><td><code>series</code></td>
<td>
<p>series names</p>
</td></tr>
<tr><td><code>season</code></td>
<td>
<p>season number</p>
</td></tr> <tr><td><code>sen.slope</code></td>
<td>
<p>Sen slope in original units
per year</p>
</td></tr> <tr><td><code>sen.slope.rel</code></td>
<td>
<p>Sen slope divided by median for that specific
season and series</p>
</td></tr> <tr><td><code>p</code></td>
<td>
<p>p-value for the trend according to the
Mann-Kendall test.</p>
</td></tr> <tr><td><code>missing</code></td>
<td>
<p>Proportion of slopes joining first and
last fifths of the data that are missing</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mannKen">mannKen</a></code>, <code><a href="#topic+plotSeason">plotSeason</a></code>,
<code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
x &lt;- sfbayChla
seasonTrend(x)
seasonTrend(x, plot = TRUE, ncol = 4)

</code></pre>

<hr>
<h2 id='sfbay'>San Francisco Bay water quality data</h2><span id='topic+sfbay'></span><span id='topic+sfbayStns'></span><span id='topic+sfbayVars'></span><span id='topic+sfbayChla'></span>

<h3>Description</h3>

<p>Selected observations and variables from U.S. Geological Survey water
quality stations in south San Francisco Bay. Data include <abbr><span class="acronym">CTD</span></abbr> and
nutrient measurements.
</p>


<h3>Format</h3>

<p><code>sfbay</code> is a data frame with 23207 observations (rows) of 12
variables (columns):
</p>

<table>
<tr>
 <td style="text-align: right;"> <code>[, 1]</code> </td><td style="text-align: left;"> <code>date</code> </td><td style="text-align: left;"> date</td>
</tr>
<tr>
 <td style="text-align: right;"> <code>[, 2]</code> </td><td style="text-align: left;">
<code>time</code> </td><td style="text-align: left;"> time</td>
</tr>
<tr>
 <td style="text-align: right;"> <code>[, 3]</code> </td><td style="text-align: left;"> <code>stn</code> </td><td style="text-align: left;"> station code</td>
</tr>
<tr>
 <td style="text-align: right;">
<code>[, 4]</code> </td><td style="text-align: left;"> <code>depth</code> </td><td style="text-align: left;"> measurement depth</td>
</tr>
<tr>
 <td style="text-align: right;"> <code>[, 5]</code> </td><td style="text-align: left;">
<code>chl</code> </td><td style="text-align: left;"> chlorophyll <em>a</em></td>
</tr>
<tr>
 <td style="text-align: right;"> <code>[, 6]</code> </td><td style="text-align: left;"> <code>dox.pct</code>
</td><td style="text-align: left;"> dissolved oxygen</td>
</tr>
<tr>
 <td style="text-align: right;"> <code>[, 7]</code> </td><td style="text-align: left;"> <code>spm</code> </td><td style="text-align: left;"> suspended
particulate matter</td>
</tr>
<tr>
 <td style="text-align: right;"> <code>[, 8]</code> </td><td style="text-align: left;"> <code>ext</code> </td><td style="text-align: left;"> extinction
coefficient</td>
</tr>
<tr>
 <td style="text-align: right;"> <code>[, 9]</code> </td><td style="text-align: left;"> <code>sal</code> </td><td style="text-align: left;"> salinity</td>
</tr>
<tr>
 <td style="text-align: right;"> <code>[, 10]</code>
</td><td style="text-align: left;"> <code>temp</code> </td><td style="text-align: left;"> water temperature</td>
</tr>
<tr>
 <td style="text-align: right;"> <code>[, 11]</code> </td><td style="text-align: left;"> <code>nox</code>
</td><td style="text-align: left;"> nitrate + nitrite</td>
</tr>
<tr>
 <td style="text-align: right;"> <code>[, 12]</code> </td><td style="text-align: left;"> <code>nhx</code> </td><td style="text-align: left;"> ammonium</td>
</tr>
<tr>
 <td style="text-align: right;"> </td>
</tr>

</table>

<p><code>sfbayStns</code> is a data frame with 16 observations of 6 variables:
</p>

<table>
<tr>
 <td style="text-align: right;"> <code>[, 1]</code> </td><td style="text-align: left;"> <code>site</code> </td><td style="text-align: left;"> station code</td>
</tr>
<tr>
 <td style="text-align: right;"> <code>[,
2]</code> </td><td style="text-align: left;"> <code>description</code> </td><td style="text-align: left;"> station description</td>
</tr>
<tr>
 <td style="text-align: right;"> <code>[, 3]</code> </td><td style="text-align: left;">
<code>lat</code> </td><td style="text-align: left;"> latitude</td>
</tr>
<tr>
 <td style="text-align: right;"> <code>[, 4]</code> </td><td style="text-align: left;"> <code>long</code> </td><td style="text-align: left;"> longitude</td>
</tr>
<tr>
 <td style="text-align: right;">
<code>[, 5]</code> </td><td style="text-align: left;"> <code>depthMax</code> </td><td style="text-align: left;"> maximum depth, in m</td>
</tr>
<tr>
 <td style="text-align: right;"> <code>[, 6]</code>
</td><td style="text-align: left;"> <code>distFrom36</code> </td><td style="text-align: left;"> distance from station 36, in km</td>
</tr>
<tr>
 <td style="text-align: right;"> </td>
</tr>

</table>

<p><code>sfbayVars</code> is a data frame with 7 observations of 3 variables:
</p>

<table>
<tr>
 <td style="text-align: right;"> <code>[, 1]</code> </td><td style="text-align: left;"> <code>variable</code> </td><td style="text-align: left;"> water quality variable
code</td>
</tr>
<tr>
 <td style="text-align: right;"> <code>[, 2]</code> </td><td style="text-align: left;"> <code>description</code> </td><td style="text-align: left;"> description</td>
</tr>
<tr>
 <td style="text-align: right;"> <code>[,
3]</code> </td><td style="text-align: left;"> <code>units</code> </td><td style="text-align: left;"> measurement units</td>
</tr>
<tr>
 <td style="text-align: right;"> </td>
</tr>

</table>

<p><code>sfbayChla</code> is a time series matrix (380 months <code>x</code> 16 stations)
of average 0-5 m chlorophyll <em>a</em> concentrations calculated from the
data in <code>sfbay</code>.
</p>


<h3>Details</h3>

<p>The original downloaded dataset was modified by taking a subset of six
well-sampled stations and the period 1985&ndash;2004. Variable names were also
simplified. The data frames <code>sfbayStns</code> and <code>sfbayVars</code> describe
the stations and water quality variables in more detail; they were created
from information at the same web site. Note that the station numbers in
<code>sfbayStns</code> have been prefixed with <code>s</code> to make station codes into
legal variable names. <code>sfbayChla</code> was constructed from the entire
downloaded sfbay dataset and encompasses the period 1969&ndash;2009.
</p>


<h3>Source</h3>

<p>Downloaded from <a href="https://sfbay.wr.usgs.gov/water-quality-database/">https://sfbay.wr.usgs.gov/water-quality-database/</a> on
2009-11-17.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(sfbay)
str(sfbay)
str(sfbayStns)
str(sfbayVars)
plot(sfbayChla[, 1:10], main = "SF Bay Chl-a")

</code></pre>

<hr>
<h2 id='trendHomog'>Trend homogeneity test</h2><span id='topic+trendHomog'></span>

<h3>Description</h3>

<p>Tests for homogeneity of seasonal trends using method proposed by van Belle
and Hughes (1984). Seasons with insufficient data as defined in
<code><a href="#topic+mannKen">mannKen</a></code> are ignored.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trendHomog(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="trendHomog_+3A_x">x</code></td>
<td>
<p>A vector time series with frequency &gt; 1</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>chisq.trend</code></td>
<td>
<p>&quot;Trend&quot; chi-square.</p>
</td></tr>
<tr><td><code>chisq.homog</code></td>
<td>
<p>&quot;Homogeneous&quot; chi-square.</p>
</td></tr> <tr><td><code>p.value</code></td>
<td>
<p>For null
hypothesis that trends are homogeneous.</p>
</td></tr> <tr><td><code>n</code></td>
<td>
<p>Number of seasons used.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>


<h3>References</h3>

<p>van Belle, G. and Hughes, J.P. (1984) Nonparametric tests for
trend in water quality. <em>Water Resources Research</em> <b>20,</b> 127-136.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+seaKen">seaKen</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Apply to a monthly vector time series to test homogeneity
## of seasonal trends.
x &lt;- sfbayChla[, 's27']
trendHomog(x)

</code></pre>

<hr>
<h2 id='ts2df'>Convert time series to data frame</h2><span id='topic+ts2df'></span>

<h3>Description</h3>

<p>Convert monthly time series vector to a year <code>x</code> month data frame for
several possible subsequent analyses. Leading and trailing empty rows are
removed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ts2df(x, mon1 = 1, addYr = FALSE, omit = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ts2df_+3A_x">x</code></td>
<td>
<p>monthly time series vector</p>
</td></tr>
<tr><td><code id="ts2df_+3A_mon1">mon1</code></td>
<td>
<p>starting month number, i.e., first column of the data frame</p>
</td></tr>
<tr><td><code id="ts2df_+3A_addyr">addYr</code></td>
<td>
<p>rows are normally labelled with the year of the starting month,
but <code>addYr = TRUE</code> will add 1 to this year number</p>
</td></tr>
<tr><td><code id="ts2df_+3A_omit">omit</code></td>
<td>
<p>if <code>TRUE</code>, then rows with any <code>NA</code> will be removed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Our main use of <code>ts2df</code> is to convert a single monthly time series into
a year <code>x</code> month data frame for EOF analysis of interannual
variability.
</p>
<p><code>monthCor</code> finds the month-to-month correlations in a monthly time
series <code>x</code>. It is useful for deciding where to start the 12-month
period for an <code>EOF</code> analysis (<code>mon1</code> in <code>ts2df</code>), namely, at
a time of low serial correlation in <code>x</code>.
</p>


<h3>Value</h3>

<p>An <code>n x 12</code> data frame, where <code>n</code> is the number of years.
</p>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>


<h3>References</h3>

<p>Craddock, J. (1965) A meteorological application of principal
component analysis. <em>Statistician</em> <b>15,</b> 143&ndash;156.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+eof">eof</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# San Francisco Bay station 27 chlorophyll has the lowest serial 
# correlation in Oct-Nov, with Sep-Oct a close second
chl27 &lt;- sfbayChla[, 's27']
monthCor(chl27)

# Convert to a data frame with October, the first month of the 
# local "water year", in the first column
tsp(chl27)
chl27 &lt;- round(chl27, 1)
ts2df(chl27, mon1 = 10, addYr = TRUE)
ts2df(chl27, mon1 = 10, addYr = TRUE, omit = TRUE)

</code></pre>

<hr>
<h2 id='tsMake'>Create time series from water quality data</h2><span id='topic+tsMake'></span><span id='topic+tsMake+2CWqData-method'></span>

<h3>Description</h3>

<p>Creates a matrix time series object from an object of class <code>"WqData"</code>,
either all variables for a single site or all sites for a single variable.
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tsMake_+3A_object">object</code></td>
<td>
<p>Object of class <code>"WqData"</code>.</p>
</td></tr>
<tr><td><code id="tsMake_+3A_focus">focus</code></td>
<td>
<p>Name of a site or water quality variable.</p>
</td></tr>
<tr><td><code id="tsMake_+3A_layer">layer</code></td>
<td>
<p>Number specifying a single depth; a numeric vector of length 2
specifying top and bottom depths of layer; a list specifying multiple depths
and/or layers; or just the string <code>"max.depths"</code>.</p>
</td></tr>
<tr><td><code id="tsMake_+3A_type">type</code></td>
<td>
<p><code>ts.mon</code> to get a monthly time series, <code>zoo</code> to get an
object of class <code>"zoo"</code> with individual observation dates.</p>
</td></tr>
<tr><td><code id="tsMake_+3A_qprob">qprob</code></td>
<td>
<p>quantile probability, a number between 0 and 1.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When <code>qprob = NULL</code>, the function averages all included depths for each
day, the implicit assumption being that the layer is well-mixed and/or the
samples are evenly distributed with depth in the layer. If <code>layer =
"max.depths"</code>, then only the value at the maximum depth for each time, site
and variable combination will be used. If no layer is specified, all depths
will be used.
</p>
<p>The function produces a matrix time series of all variables for the
specified site or all sites for the specified variable. If <code>type =
"ts.mon"</code>, available daily data are averaged to produce a monthly time
series, from which a quarterly or annual series can be created if needed. If
you want values for the actual dates of observation, then set <code>type =
"zoo"</code>.
</p>
<p>When <code>qprob</code> is a number from 0 to 1, it is interpreted as a
probability and the corresponding quantile is used to aggregate observations
within the specified layer. So to get the maximum, for example, use qprob =
1. If <code>type = "ts.mon"</code>, the same quantile is used to aggregate all the
available daily values.
</p>


<h3>Value</h3>

<p>A matrix of class <code>"mts"</code> or <code>"zoo"</code>.
</p>


<h3>Note</h3>

<p>The layer list is allowed to include negative numbers, which may have
been used in the <code>WqData</code> object to denote variables that apply to the
water column as a whole, such as, say, -1 for light attenuation coefficient.
This enables <code>focus = 's27'</code> and <code>layer = list(-1, c(0, 5))</code> to
produce a time series matrix for station 27 that includes both attenuation
coefficient and chlorophyll averaged over the top 5 m. Negative numbers may
also have been used in the <code>WqData</code> object to identify qualitative
depths such as &ldquo;near bottom&rdquo;, which is not uncommon in historical
data sets. So data from such depths can be aggregated easily with other data
to make these time series.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+WqData-class">WqData-class</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Create new WqData object
sfb &lt;- wqData(sfbay, c(1, 3:4), 5:12, site.order = TRUE,
  time.format = "%m/%d/%Y", type = "wide")

# Find means in the 0-10 m layer
y &lt;- tsMake(sfb, focus = "s27", layer = c(0, 10))
plot(y, main = "Station 27")
# Or select medians in the same layer
y1 &lt;- tsMake(sfb, focus = "s27", layer = c(0, 10), qprob = 0.5)
plot(y1, main = "Station 27")
# Compare means:medians
apply(y / y1, 2, mean, na.rm = TRUE)

# Combine a layer with a single additional depth
y &lt;- tsMake(sfb, focus = "chl", layer = list(c(0, 2), 5))
plot(y, main = "Chlorophyll a, ug/L")

# Use values from the deepest samples
y &lt;- tsMake(sfb, focus = "dox", layer = "max.depths", type = "zoo")
head(y)
plot(y, type = "h", main = "'Bottom' DO, mg/L")

</code></pre>

<hr>
<h2 id='tsMake-methods'>Methods for Function tsMake</h2><span id='topic+tsMake-methods'></span>

<h3>Description</h3>

<p>Creates a matrix of observations indexed by time.
</p>


<h3>Methods</h3>

 <dl>
<dt>list(&quot;signature(x = \&quot;WqData\&quot;)&quot;)</dt><dd><p>See
<code><a href="#topic+tsMake+2CWqData-method">tsMake,WqData-method</a></code></p>
</dd> </dl>


<hr>
<h2 id='tsSub'>tsSub</h2><span id='topic+tsSub'></span>

<h3>Description</h3>

<p>tsSub
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tsSub(x1, seas = 1:frequency(x1))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tsSub_+3A_x1">x1</code></td>
<td>
<p>ts</p>
</td></tr>
<tr><td><code id="tsSub_+3A_seas">seas</code></td>
<td>
<p>numeric</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>

<hr>
<h2 id='wqData'>Construct an object of class &quot;WqData&quot;</h2><span id='topic+wqData'></span>

<h3>Description</h3>

<p><code>wqData</code> is a constructor for the <code>"WqData"</code> class that is often
more convenient to use than <code>new</code>. It converts a data.frame containing
water quality data in &ldquo;long&rdquo; or &ldquo;wide&rdquo; format to a
<code>"WqData"</code> object. In &ldquo;long&rdquo; format, observations are all in one
column and a second column is used to designate the variable being observed.
In &ldquo;wide&rdquo; format, observations for each variable are in a separate
column.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wqData(
  data,
  locus,
  wqdata,
  site.order,
  time.format = "%Y-%m-%d",
  type = c("long", "wide")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="wqData_+3A_data">data</code></td>
<td>
<p>Data frame containing water quality data.</p>
</td></tr>
<tr><td><code id="wqData_+3A_locus">locus</code></td>
<td>
<p>Character or numeric vector designating column names or
numbers, respectively, in <code>data</code> that correspond to <code>time</code>,
<code>site</code> and <code>depth</code>.</p>
</td></tr>
<tr><td><code id="wqData_+3A_wqdata">wqdata</code></td>
<td>
<p>In the case of &ldquo;long&rdquo; data, character or numeric vector
designating column names or numbers, respectively, in <code>data</code> that
correspond to <code>variable</code> and <code>value</code>. In the case of &ldquo;wide&rdquo;
data, character or numeric vector designating column names or numbers,
respectively, in <code>data</code> that denote water quality variable data.</p>
</td></tr>
<tr><td><code id="wqData_+3A_site.order">site.order</code></td>
<td>
<p>If <code>TRUE</code>, <code>site</code> factor levels will be ordered
in alphanumeric order.</p>
</td></tr>
<tr><td><code id="wqData_+3A_time.format">time.format</code></td>
<td>
<p>Conversion specification for <code>time</code> defined by
<abbr><span class="acronym">ISO C/POSIX</span></abbr> standard (see <code><a href="base.html#topic+strptime">strptime</a></code>).</p>
</td></tr>
<tr><td><code id="wqData_+3A_type">type</code></td>
<td>
<p>Either &ldquo;long&rdquo; or &ldquo;wide&rdquo; <code>data</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If the data are already in long format, the function has little to do but
rename the data fields. If in wide format, the <span class="pkg">reshape2</span> package is
called to <code>melt</code> the data. The function also removes <code>NA</code>
observations, converts <code>site</code> to (possibly ordered) factors with valid
variable names, and converts <code>time</code> to class <code>"Date"</code> or
<code>"POSIXct"</code> and ISO 8601 format, depending on <code>time.format</code>.
</p>


<h3>Value</h3>

<p>An object of class <code>"WqData"</code>.
</p>


<h3>Author(s)</h3>

<p>Alan Jassby, James Cloern
</p>


<h3>References</h3>

<p>International Organization for Standardization (2004) ISO 8601.
Data elements and interchange formats - Information interchange -
Representation of dates and times.
</p>


<h3>See Also</h3>

<p><code><a href="base.html#topic+as.Date">as.Date</a></code>, <code><a href="base.html#topic+strptime">strptime</a></code>,
<code><a href="#topic+WqData-class">WqData-class</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run:  

# Create new WqData object from sfbay data. First combine date and time
# into a single string after making sure that all times have 4 digits.
sfb &lt;- within(sfbay, time &lt;- substring(10000 + time, 2, 5))
sfb &lt;- within(sfb, time &lt;- paste(date, time, sep = ' '))
sfb &lt;- wqData(sfb, 2:4, 5:12, site.order = TRUE, type = "wide",
    time.format = "%m/%d/%Y %H%M")

head(sfb)
tail(sfb)

# If time of day were not required, then the following would suffice:
sfb &lt;- wqData(sfbay, c(1,3,4), 5:12, site.order = TRUE, type = "wide", 
  time.format = "%m/%d/%Y")

## End(Not run)

</code></pre>

<hr>
<h2 id='WqData-class'>Class WqData</h2><span id='topic+WqData-class'></span><span id='topic++5B+2CWqData-method'></span><span id='topic+summary+2CWqData-method'></span><span id='topic+plot+2CWqData-method'></span>

<h3>Description</h3>

<p>A simple extension or subclass of the <code>"data.frame"</code> class for typical
&ldquo;discrete&rdquo; water quality monitoring programs that examine phenomena
on a time scale of days or longer. It requires water quality data to be in a
specific &ldquo;long&rdquo; format, although a generating function
<code><a href="#topic+wqData">wqData</a></code> can be used for different forms of data.
</p>


<h3>Objects from the Class</h3>

<p>Objects can be created by calls of the form
<code>new("WqData", d)</code>, where <code>d</code> is a data.frame. <code>d</code> should
have columns named <code>time, site, depth, variable, value</code> of class
<code>"DateTime", "factor", "numeric", "factor", "numeric"</code>, respectively.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+DateTime-class">DateTime-class</a></code>, <code><a href="#topic+tsMake+2CWqData-method">tsMake,WqData-method</a></code>,
<code><a href="#topic+wqData">wqData</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
showClass("WqData")
# Construct the WqData object sfb as shown in the wqData examples.
sfb &lt;- wqData(sfbay, c(1, 3, 4), 5:12, site.order = TRUE, type = "wide",
  time.format = "%m/%d/%Y")
# Summarize the data
summary(sfb)
# Create boxplot summary of data
plot(sfb, vars = c("chl", "dox", "spm"), num.col = 2)
# Extract some of the data as a WqData object
sfb[1:10, ]  # first 10 observations
sfb[sfb$depth == 20, ]  # all observations at 20 m

</code></pre>

<hr>
<h2 id='years'>Miscellaneous utility functions</h2><span id='topic+years'></span>

<h3>Description</h3>

<p>A variety of small utilities used in other functions.
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="years_+3A_d">d</code></td>
<td>
<p>A numeric matrix or data frame with depth in the first column and
observations for some variable in each of the remaining columns.</p>
</td></tr>
<tr><td><code id="years_+3A_na.rm">na.rm</code></td>
<td>
<p>Should missing data be removed?</p>
</td></tr>
<tr><td><code id="years_+3A_seas">seas</code></td>
<td>
<p>An integer vector of seasons to be retained.</p>
</td></tr>
<tr><td><code id="years_+3A_sub">sub</code></td>
<td>
<p>An integer vector.</p>
</td></tr>
<tr><td><code id="years_+3A_w">w</code></td>
<td>
<p>A vector of class <code>"Date"</code>.</p>
</td></tr>
<tr><td><code id="years_+3A_x">x</code></td>
<td>
<p>A numeric vector.</p>
</td></tr>
<tr><td><code id="years_+3A_x1">x1</code></td>
<td>
<p>A matrix or vector time series.</p>
</td></tr>
<tr><td><code id="years_+3A_y">y</code></td>
<td>
<p>A vector of class <code>"Date"</code> or <code>"POSIX"</code> date-time.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>date2decyear</code>: Converts object of class <code>"Date"</code> to decimal year
assuming time of day is noon.
</p>
<p><code>decyear2date</code>: Converts decimal year to object of class <code>"Date"</code>.
</p>
<p><code>layerMean</code>: Acts on a matrix or data frame with depth in the first
column and observations for different variables (or different sites, or
different times) in each of the remaining columns. The trapezoidal mean over
the given depths is calculated for each of the variables. Replicate depths
are averaged, and missing values or data with only one unique depth are
handled. Data are not extrapolated to cover missing values at the top or
bottom of the layer. The result can differ markedly from the simple mean
even for equal spacing of depths, because the top and bottom values are
weighted by 0.5 in a trapezoidal mean.
</p>
<p><code>leapYear</code>: <code>TRUE</code> if <code>x</code> is a leap year, <code>FALSE</code>
otherwise.
</p>
<p><code>meanSub</code>: Mean of a subset of a vector.
</p>
<p><code>monthNum</code>: Converts dates to the corresponding numeric month.
</p>
<p><code>tsSub</code>: Drops seasons from a matrix or vector time series.
</p>
<p><code>years</code>: Converts dates to the corresponding numeric years.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
dates &lt;- as.Date(c("1996-01-01", "1999-12-31", "2004-02-29", "2005-03-01"))
date2decyear(dates)

decyear2date(c(1996.0014, 1999.9986, 2004.1626, 2005.1630))

z &lt;- c(1, 2, 3, 5, 10)  # 5 depths
x &lt;- matrix(rnorm(30), nrow = 5)  # 6 variables at 5 depths
layerMean(cbind(z, x))

leapYear(seq(1500, 2000, 100))
leapYear(c(1996.9, 1997))

## Aggregate monthly time series over Feb-Apr only.
aggregate(sfbayChla, 1, meanSub, sub = 2:4)

monthNum(as.Date(c("2007-03-17", "2003-06-01")))

## Ignore certain seasons in a Seasonal Kendall test.
c27 &lt;- sfbayChla[, "s27"]
seaKen(tsSub(c27))  # Aug and Dec missing the most key data
seaKen(tsSub(c27, seas = c(1:7, 9:11)))

y &lt;- Sys.time()
years(y)

</code></pre>

<hr>
<h2 id='zoo-class'>Class &quot;zoo&quot;</h2><span id='topic+zoo-class'></span>

<h3>Description</h3>

<p>Registration of S3 class <code>"zoo"</code> as a formally defined class. Used here
to allow the <code>"zoo"</code> class to appear in method signatures.
</p>


<h3>Objects from the Class</h3>

<p>A virtual Class: No objects may be created
from it.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+phenoAmp">phenoAmp</a></code>, <code><a href="#topic+phenoPhase">phenoPhase</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
showClass("zoo")

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
