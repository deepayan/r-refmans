<!DOCTYPE html><html><head><title>Help for package fdrci</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {fdrci}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#fdr_od'><p>Tail-area FDR and Confidence Interval</p></a></li>
<li><a href='#fdrci-package'><p>Permutation-Based FDR Point and Confidence Interval Estimation</p></a></li>
<li><a href='#FDRplot'><p>Plot results of FDR table generated by fdrTbl()</p></a></li>
<li><a href='#fdrTbl'><p>FDR Estimate and Confidence Interval Sequence Table</p></a></li>
<li><a href='#meff.jm'><p>Estimate the Effective Number of Tests</p></a></li>
<li><a href='#MV_q'><p>MV q-values and confidence intervals</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Permutation-Based FDR Point and Confidence Interval Estimation</td>
</tr>
<tr>
<td>Version:</td>
<td>2.4</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-10-17</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Imports:</td>
<td>ggplot2, stats</td>
</tr>
<tr>
<td>Description:</td>
<td>FDR functions for permutation-based estimators, including pi0 as well as FDR
             confidence intervals. The confidence intervals account for dependencies between
             tests by the incorporation of an overdispersion parameter, which is estimated
             from the permuted data. Also included are options for an analog parametric approach.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/Artistic-2.0">Artistic-2.0</a></td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.2</td>
</tr>
<tr>
<td>Suggests:</td>
<td>rmarkdown, knitr, GEOquery, dplyr, foreach</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-10-17 23:47:06 UTC; joshuamillstein</td>
</tr>
<tr>
<td>Author:</td>
<td>Joshua Millstein [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Joshua Millstein &lt;joshua.millstein@usc.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-10-18 02:12:32 UTC</td>
</tr>
</table>
<hr>
<h2 id='fdr_od'>Tail-area FDR and Confidence Interval</h2><span id='topic+fdr_od'></span>

<h3>Description</h3>

<p>This function can be used to estimate FDR, corresponding confidence
interval, and pi0, the proportion of true null hypotheses, given a selected
significance threshold, and results from permuted data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fdr_od(
  obsp,
  permp = NULL,
  pnm,
  ntests,
  thres,
  cl = 0.95,
  c1 = NA,
  meff = TRUE,
  seff = TRUE,
  mymat,
  nperms = 5
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fdr_od_+3A_obsp">obsp</code></td>
<td>
<p>observed vector of p-values.</p>
</td></tr>
<tr><td><code id="fdr_od_+3A_permp">permp</code></td>
<td>
<p>list of dataframes that include a column of permutation
p-values (or statistics) in each. The length of the list permp = number of
permutations. If <code>permp = NULL</code>, then the parametric estimator is calculated.</p>
</td></tr>
<tr><td><code id="fdr_od_+3A_pnm">pnm</code></td>
<td>
<p>name of column in each list component dataframe that includes
p-values (or statistics).</p>
</td></tr>
<tr><td><code id="fdr_od_+3A_ntests">ntests</code></td>
<td>
<p>total number of observed tests, which is usually the same as
the length of obsp and the number of rows in each permp dataframe. However,
this may not be the case if results were filtered by a p-value threshold or
statistic threshold. If filtering was conducted then thres must be smaller
(more extreme) than the filtering criterion.</p>
</td></tr>
<tr><td><code id="fdr_od_+3A_thres">thres</code></td>
<td>
<p>significance threshold.</p>
</td></tr>
<tr><td><code id="fdr_od_+3A_cl">cl</code></td>
<td>
<p>confidence level (default is .95).</p>
</td></tr>
<tr><td><code id="fdr_od_+3A_c1">c1</code></td>
<td>
<p>overdispersion parameter. If this parameter is not specified
(default initial value is NA), then the parameter is estimated from the
data. If all tests are known to be independent, then this parameter should
be set to 1.</p>
</td></tr>
<tr><td><code id="fdr_od_+3A_meff">meff</code></td>
<td>
<p>(For parametric estimation, if <code>permp = NULL</code>.) Logical. <code>TRUE</code> implies the calculation of the effective number of tests based on the JM estimator (Default is <code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="fdr_od_+3A_seff">seff</code></td>
<td>
<p>(For parametric estimation, if <code>permp = NULL</code>.) Logical. <code>TRUE</code> implies the calculation of the effective number of rejected hypotheses based on the JM estimator (Default is <code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="fdr_od_+3A_mymat">mymat</code></td>
<td>
<p>(For parametric estimation, if <code>permp = NULL</code>.) Matrix. Design matrix used to calculate the p-values provided in <code>obsp</code>.</p>
</td></tr>
<tr><td><code id="fdr_od_+3A_nperms">nperms</code></td>
<td>
<p>(For parametric estimation, if <code>permp = NULL</code>.) Integer. Number of permutations needed to estimate the effective number of (rejected) tests. (Must be non-zero, default is 5)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If a very large number of tests are conducted, it may be useful to filter
results, that is, save only results of those tests that meet some relaxed
nominal significance threshold. This alleviates the need to record results
for tests that are clearly non-significant. Results from fdr_od() are valid
as long as thres &lt; the relaxed nomimal significance threshold for both
observed and permuted results. It is not necessary for the input to fdr_od()
to be p-values, however, fdr_od() is designed for statistics in which
smaller values are more extreme than larger values as is the case for
p-values. Therefore, if raw statistics are used, then a transformation may
be necessary to insure that smaller values are more likely associated with
false null hypotheses than larger values. In certain situations, for
instance when a large proportion of tests meet the significance threshold,
<code>pi0</code> is estimated to be very small, and thus has a large influence on the FDR
estimate. To limit this influence, <code>pi0</code> is constrained to be .5 or greater,
resulting in a more conservative estimate under these conditions.
</p>


<h3>Value</h3>

<p>For the permutation-based estimator: 
A list which includes: </p>
<table>
<tr><td><code>FDR</code></td>
<td>
<p>FDR point estimate</p>
</td></tr> <tr><td><code>ll</code></td>
<td>
<p>lower confidence limit</p>
</td></tr> <tr><td><code>ul</code></td>
<td>
<p>upper confidence limit</p>
</td></tr> <tr><td><code>pi0</code></td>
<td>
<p>proportion of true null hypotheses</p>
</td></tr> <tr><td><code>c1</code></td>
<td>
<p>overdispersion parameter</p>
</td></tr>
<tr><td><code>S</code></td>
<td>
<p>observed number of positive tests</p>
</td></tr> <tr><td><code>Sp</code></td>
<td>
<p>total number of
positive tests summed across all permuted result sets</p>
</td></tr>
</table>
<p>For the parametric-based estimator:
A list which includes: </p>
<table>
<tr><td><code>FDR</code></td>
<td>
<p>FDR point estimate</p>
</td></tr> <tr><td><code>ll</code></td>
<td>
<p>lower confidence limit</p>
</td></tr> <tr><td><code>ul</code></td>
<td>
<p>upper confidence limit</p>
</td></tr> <tr><td><code>M</code></td>
<td>
<p>total number of tests</p>
</td></tr>
<tr><td><code>M.eff</code></td>
<td>
<p>effective number of tests. <code>NA</code> if <code>meff = FALSE</code></p>
</td></tr>
<tr><td><code>S</code></td>
<td>
<p>observed number of positive tests</p>
</td></tr><tr><td><code>S.eff</code></td>
<td>
<p>effective number of positive tests. <code>NA</code> if <code>seff = FALSE</code></p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Joshua Millstein, Eric S. Kawaguchi
</p>


<h3>References</h3>

<p>Millstein J, Volfson D. 2013. Computationally efficient
permutation-based confidence interval estimation for tail-area FDR.
Frontiers in Genetics | Statistical Genetics and Methodology 4(179):1-11.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
ss=100
nvar=100
X = as.data.frame(matrix(rnorm(ss*nvar),nrow=ss,ncol=nvar))
e = as.data.frame(matrix(rnorm(ss*nvar),nrow=ss,ncol=nvar))
Y = .1*X + e
nperm = 10

myanalysis = function(X,Y){
	ntests = ncol(X)
	rslts = as.data.frame(matrix(NA,nrow=ntests,ncol=2))
	names(rslts) = c("ID","pvalue")
	rslts[,"ID"] = 1:ntests
	for(i in 1:ntests){
		fit = cor.test(X[,i],Y[,i],na.action="na.exclude",
			alternative="two.sided",method="pearson")
		rslts[i,"pvalue"] = fit$p.value
	}
	return(rslts)
} # End myanalysis

# Generate observed results
obs = myanalysis(X,Y)

## Generate permuted results
perml = vector('list',nperm)
for(p_ in 1:nperm){
	X1 = X[order(runif(nvar)),]
	perml[[p_]] = myanalysis(X1,Y)
}

## FDR results (permutation)
fdr_od(obs$pvalue,perml,"pvalue",nvar, thres = .05)

## FDR results (parametric)
fdr_od(obs$pvalue, permp = NULL, thres = 0.05, meff = FALSE, seff = FALSE, mymat = X)
</code></pre>

<hr>
<h2 id='fdrci-package'>Permutation-Based FDR Point and Confidence Interval Estimation</h2><span id='topic+fdrci-package'></span><span id='topic+fdrci'></span>

<h3>Description</h3>

<p>FDR functions for permutation-based estimators, including pi0 as well as FDR
confidence intervals.  The confidence intervals account for dependencies
between tests by the incorporation of an overdispersion parameter, which is
estimated from the permuted data. The package also includes a parametric 
analog of the same approach.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;"> Package: </td><td style="text-align: left;"> fdrci</td>
</tr>
<tr>
 <td style="text-align: left;"> Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;"> Version: </td><td style="text-align: left;">
2.4</td>
</tr>
<tr>
 <td style="text-align: left;"> Date: </td><td style="text-align: left;"> 2022-10-17</td>
</tr>
<tr>
 <td style="text-align: left;"> License: </td><td style="text-align: left;"> Artistic-2.0</td>
</tr>
<tr>
 <td style="text-align: left;"> LazyLoad: </td><td style="text-align: left;">
yes</td>
</tr>
<tr>
 <td style="text-align: left;"> </td>
</tr>

</table>
<p> This method is designed to compute FDR when a permutation-based
approach has been utilized. The objective here is to identify a subset of
positive tests that have corresponding statistics with a more exteme
distribution than the permuted results, which are assumed to represent the
null. The significance of the subset is described in terms of the FDR and
uncertainty in the FDR estimate by computing a confidence interval. Say a
set of p-values(or simply a set of test statistics) were recorded for a set
of hypothesis tests, and data were permuted B times with test results
generated for each permutation. The function fdr_od() can be used to
estimate FDR and and a confidence interval along with pi0, the proportion of
true null hypotheses, given a selected significance threshold. The function
fdrTbl()uses fdr_od() to create a table of results over a sequence of
possible significance thresholds. Finally, the function FDRplot will plot
results from fdrTbl(), facilitating the selection of a final significance
threshold.
</p>


<h3>Author(s)</h3>

<p>Joshua Millstein
</p>
<p>Maintainer: Joshua Millstein &lt;joshua.millstein@usc.edu&gt; Joshua Millstein
</p>


<h3>References</h3>

<p>Millstein J, Volfson D. 2013. Computationally efficient
permutation-based confidence interval estimation for tail-area FDR.
Frontiers in Genetics | Statistical Genetics and Methodology 4(179):1-11.
</p>
<p>Millstein, J., Battaglin, F., Arai, H., Zhang, W., Jayachandran, P., 
Soni, S., Parikh, A.R., Mancao, C. and Lenz, H.J., 2022. fdrci: FDR 
confidence interval selection and adjustment for large-scale hypothesis 
testing. Bioinformatics advances, 2(1), p.vbac047.
</p>

<hr>
<h2 id='FDRplot'>Plot results of FDR table generated by fdrTbl()</h2><span id='topic+FDRplot'></span>

<h3>Description</h3>

<p>This function plots FDR point and CI estimates over a sequence of 
possible significance thresholds. Results from fdrTbl() can be plotted directly as input to FDRplot.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>FDRplot(
  plotdat,
  lowerbound,
  upperbound,
  ymax = 1,
  annot = "",
  xpos = 0.8,
  ypos = 0.8
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="FDRplot_+3A_plotdat">plotdat</code></td>
<td>
<p>a table that is returned from fdrTbl(), or results formated in the same way.</p>
</td></tr>
<tr><td><code id="FDRplot_+3A_lowerbound">lowerbound</code></td>
<td>
<p>-log10(p-value) lower bound for the x-axis of the plot.</p>
</td></tr>
<tr><td><code id="FDRplot_+3A_upperbound">upperbound</code></td>
<td>
<p>-log10(p-value) upper bound for the x-axis of the plot.</p>
</td></tr>
<tr><td><code id="FDRplot_+3A_ymax">ymax</code></td>
<td>
<p>upper limit for range of the y-axis.</p>
</td></tr>
<tr><td><code id="FDRplot_+3A_annot">annot</code></td>
<td>
<p>annotation text to be added to plot area.</p>
</td></tr>
<tr><td><code id="FDRplot_+3A_xpos">xpos</code></td>
<td>
<p>x-axis position for annot</p>
</td></tr>
<tr><td><code id="FDRplot_+3A_ypos">ypos</code></td>
<td>
<p>y-axis position for annot</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ggplot2 object
</p>


<h3>Author(s)</h3>

<p>Joshua Millstein, <a href="mailto:joshua.millstein@usc.edu">joshua.millstein@usc.edu</a>
</p>
<p>Joshua Millstein
</p>


<h3>References</h3>

<p>Millstein J, Volfson D. 2013. Computationally efficient permutation-based confidence interval estimation for tail-area FDR. Frontiers in Genetics | Statistical Genetics and Methodology 4(179):1-11.
</p>
<p>Millstein J, Volfson D. 2013. Computationally efficient
permutation-based confidence interval estimation for tail-area FDR.
Frontiers in Genetics | Statistical Genetics and Methodology 4(179):1-11.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ss = 100
nvar = 100
X = as.data.frame(matrix(rnorm(ss*nvar),nrow=ss,ncol=nvar))
e = as.data.frame(matrix(rnorm(ss*nvar),nrow=ss,ncol=nvar))
Y = .1*X + e
nperm = 10

myanalysis = function(X,Y){
	ntests = ncol(X)
	rslts = as.data.frame(matrix(NA,nrow=ntests,ncol=2))
	names(rslts) = c("ID","pvalue")
	rslts[,"ID"] = 1:ntests
	for(i in 1:ntests){
		fit = cor.test(X[,i],Y[,i],na.action="na.exclude",
			alternative="two.sided",method="pearson")
		rslts[i,"pvalue"] = fit$p.value
	}
	return(rslts)
} # End myanalysis

# Generate observed results
obs = myanalysis(X,Y)

# Generate permuted results
perml = vector('list',nperm)
for(perm in 1:nperm){
	X1 = X[order(runif(nvar)),]
	perml[[perm]] = myanalysis(X1,Y)
}

# FDR results table
myfdrtbl = fdrTbl(obs$pvalue,perml,"pvalue",nvar,0,3)
# Plot results
FDRplot(myfdrtbl,0,3,annot="A. An Example")

</code></pre>

<hr>
<h2 id='fdrTbl'>FDR Estimate and Confidence Interval Sequence Table</h2><span id='topic+fdrTbl'></span>

<h3>Description</h3>

<p>Computes FDR estimates and confidence intervals for a sequence of potential
significance thresholds.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fdrTbl(
  obs.vec,
  perm.list = NULL,
  pname,
  ntests,
  lowerbound,
  upperbound,
  incr = 0.1,
  cl = 0.95,
  c1 = NA,
  correct = "none",
  meff = TRUE,
  seff = TRUE,
  mymat,
  nperms = 5
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fdrTbl_+3A_obs.vec">obs.vec</code></td>
<td>
<p>observed vector of p-values.</p>
</td></tr>
<tr><td><code id="fdrTbl_+3A_perm.list">perm.list</code></td>
<td>
<p>list of dataframes that include a column of permutation
p-values (or statistics) in each. The length of the list permp = number of
permutations.</p>
</td></tr>
<tr><td><code id="fdrTbl_+3A_pname">pname</code></td>
<td>
<p>name of column in each list component dataframe that includes
p-values (or statistics).</p>
</td></tr>
<tr><td><code id="fdrTbl_+3A_ntests">ntests</code></td>
<td>
<p>total number of observed tests, which is usually the same as
the length of obs.vec and the number of rows in each perm.list dataframe.
However, this may not be the case if results were filtered by a p-value
threshold or statistic threshold. If filtering was conducted then lowerbound
must be greater (more extreme) than the filtering criterion.</p>
</td></tr>
<tr><td><code id="fdrTbl_+3A_lowerbound">lowerbound</code></td>
<td>
<p>lowerbound refers to the range of -log10(p-value) over
which fdr is computed for a sequence of thresholds</p>
</td></tr>
<tr><td><code id="fdrTbl_+3A_upperbound">upperbound</code></td>
<td>
<p>upperbound refers to the range of -log10(p-value) over
which fdr is computed for a sequence of thresholds</p>
</td></tr>
<tr><td><code id="fdrTbl_+3A_incr">incr</code></td>
<td>
<p>value by which to increment the sequence from lowerbound to
upperbound on a -log10(p-value) scale. Default is 0.1.</p>
</td></tr>
<tr><td><code id="fdrTbl_+3A_cl">cl</code></td>
<td>
<p>confidence level (default is .95).</p>
</td></tr>
<tr><td><code id="fdrTbl_+3A_c1">c1</code></td>
<td>
<p>overdispersion parameter to account for dependencies among tests. If 
all tests are known to be independent, then this parameter should be set to 1.</p>
</td></tr>
<tr><td><code id="fdrTbl_+3A_correct">correct</code></td>
<td>
<p>&quot;none&quot;, &quot;BH&quot;, should confidence intervals be corrected for 
multiplicity using a modification of the Benjamini and Yekutieli (2005) approach 
for selecting and correcting intervals? (default is &quot;none&quot;)</p>
</td></tr>
<tr><td><code id="fdrTbl_+3A_meff">meff</code></td>
<td>
<p>(For parametric estimation, if <code>perm.list = NULL</code>.) Logical. To be passed into <code>fdr_od</code>. <code>TRUE</code> implies the calculation of the effective number of tests based on the JM estimator (Default is <code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="fdrTbl_+3A_seff">seff</code></td>
<td>
<p>(For parametric estimation, if <code>perm.list = NULL</code>.) Logical. To be passed into <code>fdr_od</code>. <code>TRUE</code> implies the calculation of the effective number of rejected hypotheses based on the JM estimator (Default is <code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="fdrTbl_+3A_mymat">mymat</code></td>
<td>
<p>(For parametric estimation, if <code>perm.list = NULL</code>.) Matrix. To be passed into <code>fdr_od</code>. Design matrix used to calculate the p-values provided in <code>obsp</code>.</p>
</td></tr>
<tr><td><code id="fdrTbl_+3A_nperms">nperms</code></td>
<td>
<p>(For parametric estimation, if <code>perm.list = NULL</code>.) Integer. To be passed into <code>fdr_od</code>. Number of permutations needed to estimate the effective number of (rejected) tests. (Must be non-zero, default is 5)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>fdrTbl calls fdr_od for a series of discovery thresholds. 
Output from fdrTbl() can be used for FDRplot() input.
</p>
<p>If correct = &quot;BH&quot;, then confidence intervals will be corrected according to
the thresholds specified by lowerbound, upperbound, and incr. Thresholds will 
be selected if FDR is determined to be significantly different than 1. First
a Z-score test is conducted using the Millstein &amp; Volfson standard error estimate.
Then BH FDR is computed according to the Benjamini and Yekutieli (2005) approach.
CIs for selected thresholds will be adjusted to account for multiple CI estimation.
For thresholds that are not selected, NA values are returned.
</p>


<h3>Value</h3>

<p>A dataframe is returned where rows correspond to p-value thresholds
in the sequence from lowerbound to upperbound and columns are:
</p>
<p>If permutation:
c(&quot;threshold&quot;,&quot;fdr&quot;,&quot;ll&quot;,&quot;ul&quot;,&quot;pi0&quot;,&quot;odp&quot;,&quot;S&quot;,&quot;Sp&quot;) </p>
<table>
<tr><td><code>threshold</code></td>
<td>
<p>p-value threshold chosen to define positive tests</p>
</td></tr> <tr><td><code>fdr</code></td>
<td>
<p>estimated
FDR at the chosen p-value threshold</p>
</td></tr> <tr><td><code>ll</code></td>
<td>
<p>estimated lower 95%
confidence bound for the FDR estimate</p>
</td></tr> <tr><td><code>ul</code></td>
<td>
<p>estimated upper 95%
confidence bound for the FDR estimate</p>
</td></tr> <tr><td><code>pi0</code></td>
<td>
<p>estimated percent of true
null hypotheses</p>
</td></tr> <tr><td><code>odp</code></td>
<td>
<p>estimated over-dispersion parameter</p>
</td></tr> <tr><td><code>S</code></td>
<td>
<p>observed number of positive tests</p>
</td></tr> <tr><td><code>Sp</code></td>
<td>
<p>total number of positive
tests summed across all permuted result sets</p>
</td></tr>
</table>
<p>If parametric:
c(&quot;threshold&quot;,&quot;fdr&quot;,&quot;ll&quot;,&quot;ul&quot;,&quot;M&quot;,&quot;M.eff&quot;,&quot;S&quot;,&quot;S.eff&quot;) </p>
<table>
<tr><td><code>threshold</code></td>
<td>
<p>p-value threshold chosen to define positive tests</p>
</td></tr> <tr><td><code>fdr</code></td>
<td>
<p>estimated
FDR at the chosen p-value threshold</p>
</td></tr> <tr><td><code>ll</code></td>
<td>
<p>estimated lower 95%
confidence bound for the FDR estimate</p>
</td></tr> <tr><td><code>ul</code></td>
<td>
<p>estimated upper 95%
confidence bound for the FDR estimate</p>
</td></tr> <tr><td><code>M</code></td>
<td>
<p>total number of tests</p>
</td></tr>
<tr><td><code>M.eff</code></td>
<td>
<p>Effective number of tests via the JM estimator</p>
</td></tr> <tr><td><code>S</code></td>
<td>
<p>observed number of positive tests</p>
</td></tr> <tr><td><code>S.eff</code></td>
<td>
<p>effective number of positive tests via the JM estimator</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Joshua Millstein, Eric S. Kawaguchi
</p>


<h3>References</h3>

<p>Millstein J, Volfson D. 2013. Computationally efficient
permutation-based confidence interval estimation for tail-area FDR.
Frontiers in Genetics | Statistical Genetics and Methodology 4(179):1-11.
</p>
<p>Benjamini, Yoav, and Daniel Yekutieli. &quot;False discovery rate adjusted multiple 
confidence intervals for selected parameters.&quot; Journal of the American Statistical 
Association 100.469 (2005): 71-81.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

n.row=100
n.col=100
X = as.data.frame(matrix(rnorm(n.row*n.col),nrow=n.row,ncol=n.col))
e = as.data.frame(matrix(rnorm(n.row*n.col),nrow=n.row,ncol=n.col))
Y = .1*X + e
nperm = 10

myanalysis = function(X,Y){
	ntests = ncol(X)
	rslts = as.data.frame(matrix(NA,nrow=ntests,ncol=2))
	names(rslts) = c("ID","pvalue")
	rslts[,"ID"] = 1:ntests
	for(i in 1:ntests){
		fit = cor.test(X[,i],Y[,i],na.action="na.exclude",
			alternative="two.sided",method="pearson")
		rslts[i,"pvalue"] = fit$p.value
	}
	return(rslts)
} # End myanalysis

## Generate observed results
obs = myanalysis(X,Y)

## Generate permuted results
perml = vector('list',nperm)
for(perm in 1:nperm){
	X1 = X[order(runif(n.col)),]
	perml[[perm]] = myanalysis(X1,Y)
}

## FDR results table
fdrTbl(obs$pvalue,perml,"pvalue",n.col,1,2)
fdrTbl(obs$pvalue,perml,"pvalue",n.col,1,2,correct="BH")

## FDR results table (parametric)
fdrTbl(obs$pvalue, NULL, "pvalue",n.col,1,2,meff = TRUE, seff = TRUE, mymat = X, nperms = 5)

</code></pre>

<hr>
<h2 id='meff.jm'>Estimate the Effective Number of Tests</h2><span id='topic+meff.jm'></span>

<h3>Description</h3>

<p>Estimate the effective number of tests using a permutation-based approach.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>meff.jm(mydat, B = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="meff.jm_+3A_mydat">mydat</code></td>
<td>
<p>A design matrix with <code class="reqn">n</code> observations (rows) and <code class="reqn">p</code> covariates (columns).</p>
</td></tr>
<tr><td><code id="meff.jm_+3A_b">B</code></td>
<td>
<p>Integer. Number of permutations to perform. (Default is 1)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The effective no of independent vars is the sum of the scaled eigenvalues for truly independent vars (n) 
minus the variance inflation of the top eigenvalues, that is, (observed - permuted)
The sum of the eigenvalues of the correlation matrix = trace = sum of diag = n.
The eigenvalues of variables X can be thought of as normalized 
Dependencies between variables will increase the magnitude of top eigenvalues,
therefore, the effective number of independent variables is equal to the proportion of the
sum of eigenvalues attributed to independence minus the proportion attributed to dependencies.
</p>


<h3>Value</h3>

<p>Numeric. Returns the estimated effective number of tests averaged over <code>B</code> permutations.
</p>


<h3>Author(s)</h3>

<p>Joshua Millstein, Eric S. Kawaguchi
</p>


<h3>References</h3>

<p>Millstein J, Volfson D. 2013. Computationally efficient
permutation-based confidence interval estimation for tail-area FDR.
Frontiers in Genetics | Statistical Genetics and Methodology 4(179):1-11.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Independent
ss=300
nvar=100
X = as.data.frame(matrix(rnorm(ss * nvar), nrow = ss, ncol = nvar))
meff.jm(X, B = 5)

# High correlation
S = matrix(0.9, nvar, nvar)
diag(S) = 1
X = as.matrix(X) %*% chol(S)
meff.jm(X, B = 5)
</code></pre>

<hr>
<h2 id='MV_q'>MV q-values and confidence intervals</h2><span id='topic+MV_q'></span>

<h3>Description</h3>

<p>q-values with confidence intervals are generated, based in the Millstein and Volfson (MV) estimators.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MV_q(obsp, permp, pnm, ntests, cl = 0.95, c1 = NA)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="MV_q_+3A_obsp">obsp</code></td>
<td>
<p>observed vector of p-values.</p>
</td></tr>
<tr><td><code id="MV_q_+3A_permp">permp</code></td>
<td>
<p>list of dataframes that include a column of permutation
p-values (or statistics) in each. The length of the list permp = number of
permutations.</p>
</td></tr>
<tr><td><code id="MV_q_+3A_pnm">pnm</code></td>
<td>
<p>name of column in each list component dataframe that includes
p-values (or statistics).</p>
</td></tr>
<tr><td><code id="MV_q_+3A_ntests">ntests</code></td>
<td>
<p>total number of observed tests, which is usually the same as
the length of obsp and the number of rows in each permp dataframe. However,
this may not be the case if results were filtered by a p-value threshold or
statistic threshold. If filtering was conducted then thres must be smaller
(more extreme) than the filtering criterion.</p>
</td></tr>
<tr><td><code id="MV_q_+3A_cl">cl</code></td>
<td>
<p>confidence level (default is .95).</p>
</td></tr>
<tr><td><code id="MV_q_+3A_c1">c1</code></td>
<td>
<p>overdispersion parameter. If this parameter is not specified
(default initial value is NA), then the parameter is estimated from the
data. If all tests are known to be independent, then this parameter should
be set to 1.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Millstein and Volfson (2013) FDR is based on the idea that FDR is estimated at a level specified by the investigator. 
Storey and Tibshirani (2003) developed the q-value concept, where FDR is estimated at each observed p-value. 
However, Millstein and Volfson argued that in order to be informative, uncertainty in the estimate should be 
quantified, thus the development of confidence intervals for FDR. The MV FDR estimator is less conservative than the BH estimator.
</p>


<h3>Value</h3>

<p>A dataframe which includes: </p>
<table>
<tr><td><code>q</code></td>
<td>
<p>q-value corresponding to the respective p-value</p>
</td></tr> <tr><td><code>q.ll</code></td>
<td>
<p>q-value lower limit</p>
</td></tr> <tr><td><code>q.ul</code></td>
<td>
<p>q-value upper limit</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Joshua Millstein
</p>


<h3>References</h3>

<p>Millstein J, Volfson D. 2013. Computationally efficient permutation-based confidence interval estimation for tail-area FDR. 
Frontiers in Genetics | Statistical Genetics and Methodology 4(179):1-11.
</p>
<p>Storey, John D., and Robert Tibshirani. &quot;Statistical significance for genomewide studies.&quot; 
Proceedings of the National Academy of Sciences 100.16 (2003): 9440-9445.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ss=100
nvar=100
X = as.data.frame(matrix(rnorm(ss*nvar),nrow=ss,ncol=nvar))
e = as.data.frame(matrix(rnorm(ss*nvar),nrow=ss,ncol=nvar))
Y = .1*X + e
nperm = 10

myanalysis = function(X,Y){
	ntests = ncol(X)
	rslts = as.data.frame(matrix(NA,nrow=ntests,ncol=2))
	names(rslts) = c("ID","pvalue")
	rslts[,"ID"] = 1:ntests
	for(i in 1:ntests){
		fit = cor.test(X[,i],Y[,i],na.action="na.exclude",
			alternative="two.sided",method="pearson")
		rslts[i,"pvalue"] = fit$p.value
	}
	return(rslts)
} # End myanalysis

# Generate observed results
obs = myanalysis(X,Y)

# Generate permuted results
perml = vector('list',nperm)
for(p_ in 1:nperm){
	X1 = X[order(runif(nvar)),]
	perml[[p_]] = myanalysis(X1,Y)
}

q.values.MV = MV_q(obs$pvalue,perml,"pvalue",nvar)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
