<!DOCTYPE html><html lang="en"><head><title>Help for package webSDM</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {webSDM}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#webSDM-package'><p>webSDM: Including Known Interactions in Species Distribution Models</p></a></li>
<li><a href='#buildFormula'><p>Builds SDM formulae</p></a></li>
<li><a href='#coef.SDMfit'><p>Gets regression coefficients from a local model, i.e. a SDMfit object.</p></a></li>
<li><a href='#coef.trophicSDMfit'><p>Gets regression coefficients from a fitted trophicSDM model.</p></a></li>
<li><a href='#computeVariableImportance'><p>Computes variable importance of (groups of) variables of fitted a trophicSDM model.</p></a></li>
<li><a href='#evaluateModelFit'><p>Evaluates prediction goodness of fit</p></a></li>
<li><a href='#G'><p>Simulated environemntal covariates G</p></a></li>
<li><a href='#global'><p>Global</p></a></li>
<li><a href='#loo.trophicSDMfit'><p>Computes an approximation of loo for the whole model</p></a></li>
<li><a href='#plot.SDMfit'><p>Plots the regression coefficients of a local model</p></a></li>
<li><a href='#plot.trophicSDMfit'><p>Plots the regression coefficients of a fitted trophicSDM model</p></a></li>
<li><a href='#plotG'><p>Plots the metaweb G</p></a></li>
<li><a href='#plotG_inferred'><p>Plot the metaweb G according to the inferred coefficients</p></a></li>
<li><a href='#predict.SDMfit'><p>Predicts with a local model</p></a></li>
<li><a href='#predict.trophicSDMfit'><p>Computes predicted values from the fitted trophicSDMfit model</p></a></li>
<li><a href='#predictPotential'><p>Predicts species potential niche</p></a></li>
<li><a href='#print.SDMfit'><p>Prints a SDMfit object</p></a></li>
<li><a href='#print.trophicSDMfit'><p>Prints a fitted trophicSDM model</p></a></li>
<li><a href='#SDMfit'><p>Fitting a single-species SDM</p></a></li>
<li><a href='#summary.SDMfit'><p>Summary of a fitted SDMfit model</p></a></li>
<li><a href='#summary.trophicSDMfit'><p>Summary of a fitted trophicSDM model</p></a></li>
<li><a href='#trophicSDM'><p>Fitting a trophic Species distribution model</p></a></li>
<li><a href='#trophicSDM_CV'><p>Compute K-fold cross-validation predicted values from a fitted trophicSDM model</p></a></li>
<li><a href='#X'><p>Simulated environmental covariates X</p></a></li>
<li><a href='#Y'><p>Simulated species distribution Y</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Including Known Interactions in Species Distribution Models</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1-5</td>
</tr>
<tr>
<td>Description:</td>
<td>A collection of tools to fit and work with trophic Species Distribution Models. Trophic Species Distribution Models combine knowledge of trophic interactions with Bayesian structural equation models that model each species as a function of its prey (or predators) and environmental conditions. It exploits the topological ordering of the known trophic interaction network to predict species distribution in space and/or time, where the prey (or predator) distribution is unavailable. The method implemented by the package is described in Poggiato, Andréoletti, Pollock and Thuiller (2022) &lt;<a href="https://doi.org/10.22541%2Fau.166853394.45823739%2Fv1">doi:10.22541/au.166853394.45823739/v1</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Imports:</td>
<td>GGally, abind, bayesplot, brms, broom.mixed, dismo, dplyr,
ggplot2, glmnet, gridExtra, igraph, jtools, rstanarm,
rstantools, utils</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/giopogg/webSDM">https://github.com/giopogg/webSDM</a>,
<a href="https://giopogg.github.io/webSDM/">https://giopogg.github.io/webSDM/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/giopogg/webSDM/issues">https://github.com/giopogg/webSDM/issues</a></td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, reshape2, devtools, loo, randomForest,
network, sna, scales, intergraph</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-06-24 10:32:16 UTC; Giovanni</td>
</tr>
<tr>
<td>Author:</td>
<td>Giovanni Poggiato [aut, cre, cph],
  Jérémy Andréoletti [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Giovanni Poggiato &lt;giov.poggiato@gmail.com&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-06-24 12:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='webSDM-package'>webSDM: Including Known Interactions in Species Distribution Models</h2><span id='topic+webSDM'></span><span id='topic+webSDM-package'></span>

<h3>Description</h3>

<p>A collection of tools to fit and work with trophic Species Distribution Models. Trophic Species Distribution Models combine knowledge of trophic interactions with Bayesian structural equation models that model each species as a function of its prey (or predators) and environmental conditions. It exploits the topological ordering of the known trophic interaction network to predict species distribution in space and/or time, where the prey (or predator) distribution is unavailable. The method implemented by the package is described in Poggiato, Andréoletti, Pollock and Thuiller (2022) <a href="https://doi.org/10.22541/au.166853394.45823739/v1">doi:10.22541/au.166853394.45823739/v1</a>.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Giovanni Poggiato <a href="mailto:giov.poggiato@gmail.com">giov.poggiato@gmail.com</a> [copyright holder]
</p>
<p>Authors:
</p>

<ul>
<li><p> Jérémy Andréoletti
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/giopogg/webSDM">https://github.com/giopogg/webSDM</a>
</p>
</li>
<li> <p><a href="https://giopogg.github.io/webSDM/">https://giopogg.github.io/webSDM/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/giopogg/webSDM/issues">https://github.com/giopogg/webSDM/issues</a>
</p>
</li></ul>


<hr>
<h2 id='buildFormula'>Builds SDM formulae</h2><span id='topic+buildFormula'></span>

<h3>Description</h3>

<p>Builds the formula of both the abiotic and biotic terms to fit a single species SDM based on the input parameters. The function is called inside the SDMfit function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>buildFormula(
  form.init,
  species,
  sp.formula = NULL,
  sp.partition = NULL,
  useBRMS
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="buildFormula_+3A_form.init">form.init</code></td>
<td>
<p>The abiotic part of the formula</p>
</td></tr>
<tr><td><code id="buildFormula_+3A_species">species</code></td>
<td>
<p>The preys (or predators) of the focal species</p>
</td></tr>
<tr><td><code id="buildFormula_+3A_sp.formula">sp.formula</code></td>
<td>
<p>optional parameter for composite variables. See ?trophicSDM</p>
</td></tr>
<tr><td><code id="buildFormula_+3A_sp.partition">sp.partition</code></td>
<td>
<p>optional parameter to specify groups of species for composite variables. See ?trophicSDM</p>
</td></tr>
<tr><td><code id="buildFormula_+3A_usebrms">useBRMS</code></td>
<td>
<p>whether brms is used (TRUE if penal = &quot;coeff.signs&quot; and method = &quot;stan_glm).</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Giovanni Poggiato and Jérémy Andréoletti
</p>

<hr>
<h2 id='coef.SDMfit'>Gets regression coefficients from a local model, i.e. a SDMfit object.</h2><span id='topic+coef.SDMfit'></span>

<h3>Description</h3>

<p>Gets regression coefficients (eventually standardised) of a local model, i.e. a SDMfit object. p-values or credible intervals are returned when available.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'SDMfit'
coef(object, standardise = FALSE, level = 0.95, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="coef.SDMfit_+3A_object">object</code></td>
<td>
<p>A SDMfit object, typically obtained with trophicSDM() and available in the field $model of a trophicSDMfit object</p>
</td></tr>
<tr><td><code id="coef.SDMfit_+3A_standardise">standardise</code></td>
<td>
<p>Whether to standardise regression coefficients. Default to FALSE. If TRUE, coefficients are standardised using the latent variable standardisation (see Grace et al. 2018) for more details.</p>
</td></tr>
<tr><td><code id="coef.SDMfit_+3A_level">level</code></td>
<td>
<p>The confidence level of credible intervals, only available for stan_glm method. Default to 0.95.</p>
</td></tr>
<tr><td><code id="coef.SDMfit_+3A_...">...</code></td>
<td>
<p>additional arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A table containing the inferred coefficients (with credible intervals or p-values when available).
</p>


<h3>Author(s)</h3>

<p>Giovanni Poggiato
</p>


<h3>References</h3>

<p>Grace, J. B., Johnson, D. J., Lefcheck, J. S., and Byrnes, J. E. K.. 2018. Quantifying relative importance: computing standardized effects in models with binary outcomes. Ecosphere 9(6):e02283.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Y, X, G)
# define abiotic part of the model
env.formula = "~ X_1 + X_2"
# Run the model with bottom-up control using stan_glm as fitting method and no penalisation
m = trophicSDM(Y,X,G, env.formula, iter = 100,
               family = binomial(link = "logit"), penal = NULL, 
               mode = "prey", method = "stan_glm")
# unstandardised regression coefficients
coef(m$model$Y5)
#standardised regression coefficients with 90% credible intervals
coef(m$model$Y5, standardised = TRUE, level = 0.9)
# Run the same model using glm as fitting method
# (set iter = 1000 to obtain reliable results)
m = trophicSDM(Y,X,G, env.formula, 
               family = binomial(link = "logit"), penal = NULL, 
               mode = "prey", method = "glm")
# Now we have p-values instead of credible intervals
coef(m$model$Y5)

# Notice that unstandardised coefficients are always accessible
# in the fitted model:
m$model$Y5$coef
</code></pre>

<hr>
<h2 id='coef.trophicSDMfit'>Gets regression coefficients from a fitted trophicSDM model.</h2><span id='topic+coef.trophicSDMfit'></span>

<h3>Description</h3>

<p>Gets regression coefficients (eventually standardised) of a fitted trophicSDM. p-values or credible intervals are returned when available.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'trophicSDMfit'
coef(object, standardise = FALSE, level = 0.95, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="coef.trophicSDMfit_+3A_object">object</code></td>
<td>
<p>A trophicSDMfit object obtained with trophicSDM()</p>
</td></tr>
<tr><td><code id="coef.trophicSDMfit_+3A_standardise">standardise</code></td>
<td>
<p>Whether to standardise regression coefficients. Default to FALSE. If TRUE, coefficients are standardised using the latent variable standardisation (see Grace et al. 2018) for more details.</p>
</td></tr>
<tr><td><code id="coef.trophicSDMfit_+3A_level">level</code></td>
<td>
<p>The confidence level of credible intervals, only available for stan_glm method. Default to 0.95.</p>
</td></tr>
<tr><td><code id="coef.trophicSDMfit_+3A_...">...</code></td>
<td>
<p>additional arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing, for each species, the inferred coefficients (with credible intervals or p-values when available).
</p>


<h3>Author(s)</h3>

<p>Giovanni Poggiato
</p>


<h3>References</h3>

<p>Grace, J. B., Johnson, D. J., Lefcheck, J. S., and Byrnes, J. E. K.. 2018. Quantifying relative importance: computing standardized effects in models with binary outcomes. Ecosphere 9(6):e02283.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Y, X, G)
# define abiotic part of the model
env.formula = "~ X_1 + X_2"
# Run the model with bottom-up control using stan_glm as fitting method and no penalisation
# (set iter = 1000 to obtain reliable results)
m = trophicSDM(Y,X,G, env.formula, iter = 100,
               family = binomial(link = "logit"), penal = NULL, 
               mode = "prey", method = "stan_glm")
# unstandardised regression coefficients
coef(m)
#standardised regression coefficients with 90% credible intervals
coef(m, standardised = TRUE, level = 0.9)
# Run the same model using glm as fitting method
m = trophicSDM(Y, X, G, env.formula, 
               family = binomial(link = "logit"), penal = NULL, 
               mode = "prey", method = "glm")
# Now we have p-values instead of credible intervals
coef(m)

# Notice that unstandardised coefficients are always accessible
# in the fitted model:
m$coef
</code></pre>

<hr>
<h2 id='computeVariableImportance'>Computes variable importance of (groups of) variables of fitted a trophicSDM model.</h2><span id='topic+computeVariableImportance'></span>

<h3>Description</h3>

<p>Computes variable importance of (groups of) variables of fitted a trophicSDM model, for each species. Variable importance are computed as the standardised regression coefficients (summed across species of the same group). Standardisation is done using latent variable standardisation described in Grace et al. 2018.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>computeVariableImportance(tSDM, groups = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="computeVariableImportance_+3A_tsdm">tSDM</code></td>
<td>
<p>A trophicSDMfit object obtained with trophicSDM()</p>
</td></tr>
<tr><td><code id="computeVariableImportance_+3A_groups">groups</code></td>
<td>
<p>A list where each element is group. Each group is specified as a vector containing species or environmental covariates names of a given group. Each element of the list (i.e. each group) has to be named.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A groups x species matrix containing variable importance for each groups of variables and each species.
</p>


<h3>Author(s)</h3>

<p>Giovanni Poggiato
</p>


<h3>References</h3>

<p>Grace, J. B., Johnson, D. J., Lefcheck, J. S., and Byrnes, J. E. K.. 2018. Quantifying relative importance: computing standardized effects in models with binary outcomes. Ecosphere 9(6):e02283.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Y, X, G)
# define abiotic part of the model
env.formula = "~ X_1 + X_2"
# Run the model with bottom-up control using stan_glm as fitting method and no penalisation
# (set iter = 1000 to obtain reliable results)
m = trophicSDM(Y, X, G, env.formula, iter = 100,
               family = binomial(link = "logit"), penal = NULL, 
               mode = "prey", method = "stan_glm")
#Compute the importance of each variable
computeVariableImportance(m)
#Compute the importance of three different set of variables
computeVariableImportance(m, groups =list("X" = c("X_1","X_2"), 
                                             "Ybasal" = c("Y1","Y2","Y3"),
                                             "Ypredator"= c("Y4", "Y5", "Y6")))
</code></pre>

<hr>
<h2 id='evaluateModelFit'>Evaluates prediction goodness of fit</h2><span id='topic+evaluateModelFit'></span>

<h3>Description</h3>

<p>Evaluate goodness of fit by comparing a true versus a predicted dataset of species distribution. Ypredicted is typically predicted using a prediction method of trophicSDM (in cross-validation if <code>trophicSDM_CV()</code> is used).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>evaluateModelFit(tSDM, Ynew = NULL, Ypredicted = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="evaluateModelFit_+3A_tsdm">tSDM</code></td>
<td>
<p>A trophicSDMfit object obtained with <code>trophicSDM()</code>.</p>
</td></tr>
<tr><td><code id="evaluateModelFit_+3A_ynew">Ynew</code></td>
<td>
<p>A sites x species matrix containing the true species occurrences state. If set to NULL (default), it is set to the species distribution data Y on which the model is fitted.</p>
</td></tr>
<tr><td><code id="evaluateModelFit_+3A_ypredicted">Ypredicted</code></td>
<td>
<p>A sites x species matrix containing the predicted species occurrences state. If set to NULL (default), it is set to the fitted values, i.e. predictions on the dataset used to train the model.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A table specifying the goodness of fit metrics for each species. For presence-absence data, the model computes TSS and AUC. For Gaussian data, the R2.
</p>


<h3>Author(s)</h3>

<p>Giovanni Poggiato
</p>


<h3>References</h3>

<p>Grace, J. B., Johnson, D. J., Lefcheck, J. S., and Byrnes, J. E. K.. 2018. Quantifying relative importance: computing standardized effects in models with binary outcomes. Ecosphere 9(6):e02283.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Y, X, G)
# define abiotic part of the model
env.formula = "~ X_1 + X_2"
# Run the model with bottom-up control using stan_glm as fitting method and no penalisation
# (set iter = 1000 to obtain reliable results)
m = trophicSDM(Y, X, G, env.formula, iter = 20,
               family = binomial(link = "logit"), penal = NULL, 
               mode = "prey", method = "stan_glm")
# Evaluate the quality of model predictions on the training
# Predict (fullPost = FALSE) as we used stan_glm to fit the model
# but here we are only intested in the posterior mean
Ypred = predict(m, fullPost = FALSE)
# format predictions to obtain a sites x species dataset whose
# columns are ordered as Ynew
Ypred = do.call(cbind,
                lapply(Ypred, function(x) x$predictions.mean))
                
Ypred = Ypred[,colnames(Y)]
evaluateModelFit(m, Ynew = Y, Ypredicted = Ypred)

# Note that this is equivalent to `evaluateModelFit(m)`
# If we fitted the model using "glm"
m = trophicSDM(Y, X, G, env.formula,
               family = binomial(link = "logit"), penal = NULL, 
               mode = "prey", method = "glm")
Ypred = predict(m, fullPost = FALSE)
# format predictions to obtain a sites x species dataset whose
# columns are ordered as Ynew
Ypred = do.call(cbind, Ypred)
Ypred = Ypred[,colnames(Y)]

evaluateModelFit(m, Ynew = Y, Ypredicted = Ypred)
# Note that this is equivalent to:

evaluateModelFit(m)

</code></pre>

<hr>
<h2 id='G'>Simulated environemntal covariates G</h2><span id='topic+G'></span>

<h3>Description</h3>

<p>Simulated environemntal covariates G
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(G)
</code></pre>


<h3>Format</h3>

<p>A simulated graph of trophic interactions G
</p>


<h3>Author(s)</h3>

<p>Giovanni Poggiato
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(G)
</code></pre>

<hr>
<h2 id='global'>Global</h2><span id='topic+global'></span>

<h3>Description</h3>

<p>Declare global variables
</p>

<hr>
<h2 id='loo.trophicSDMfit'>Computes an approximation of loo for the whole model</h2><span id='topic+loo.trophicSDMfit'></span>

<h3>Description</h3>

<p>Only works if method = 'stan_glm'. The global loo is computed by summing the loo of all the local models (since the likelihood factorises, the log-likelihood can be summed)This is an implementation of the methods described in Vehtari, Gelman, and Gabry (2017) and Vehtari, Simpson, Gelman, Yao, and Gabry (2019).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'trophicSDMfit'
loo(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="loo.trophicSDMfit_+3A_x">x</code></td>
<td>
<p>A trophicSDMfit object obtained with trophicSDM()</p>
</td></tr>
<tr><td><code id="loo.trophicSDMfit_+3A_...">...</code></td>
<td>
<p>additional arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The value of the loo for the whole model
</p>


<h3>Author(s)</h3>

<p>Giovanni Poggiato
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Y, X, G)
# define abiotic part of the model
env.formula = "~ X_1 + X_2"
# Run the model with bottom-up control using stan_glm as fitting method and no penalisation
m = trophicSDM(Y,X,G, env.formula,
               family = binomial(link = "logit"), penal = NULL, iter = 50,
               mode = "prey", method = "stan_glm")
brms::loo(m)
</code></pre>

<hr>
<h2 id='plot.SDMfit'>Plots the regression coefficients of a local model</h2><span id='topic+plot.SDMfit'></span>

<h3>Description</h3>

<p>Plots the regression coefficients of a local SDMfit model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'SDMfit'
plot(x, level = 0.95, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.SDMfit_+3A_x">x</code></td>
<td>
<p>A SDMfit object, typically obtained with trophicSDM() and available in the field $model of a trophicSDMfit object</p>
</td></tr>
<tr><td><code id="plot.SDMfit_+3A_level">level</code></td>
<td>
<p>the confidence level of the confidence intervals</p>
</td></tr>
<tr><td><code id="plot.SDMfit_+3A_...">...</code></td>
<td>
<p>additional arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A plot of the regression coefficients of the fitted local SDM
</p>


<h3>Author(s)</h3>

<p>Giovanni Poggiato
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Y, X, G)
# define abiotic part of the model
env.formula = "~ X_1 + X_2"
# Run the model with bottom-up control using stan_glm as fitting method and no penalisation
# (set iter = 1000 to obtain reliable results)
m = trophicSDM(Y, X, G, env.formula, iter = 50,
               family = binomial(link = "logit"), penal = NULL,
               mode = "prey", method = "stan_glm")
# Plot species Y6

plot(m$model$Y6)

</code></pre>

<hr>
<h2 id='plot.trophicSDMfit'>Plots the regression coefficients of a fitted trophicSDM model</h2><span id='topic+plot.trophicSDMfit'></span>

<h3>Description</h3>

<p>Plots the regression coefficients of a fitted trophicSDM model. A subset of species to be plotted can be specified in the parameter<code>species</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'trophicSDMfit'
plot(x, species = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.trophicSDMfit_+3A_x">x</code></td>
<td>
<p>A trophicSDMfit object obtained with trophicSDM()</p>
</td></tr>
<tr><td><code id="plot.trophicSDMfit_+3A_species">species</code></td>
<td>
<p>A vector of species names to be plot. If NULL (default), all species are plotted.</p>
</td></tr>
<tr><td><code id="plot.trophicSDMfit_+3A_...">...</code></td>
<td>
<p>additional arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A plot of the regression coefficients of the fitted tropic SDM
</p>


<h3>Author(s)</h3>

<p>Giovanni Poggiato
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Y, X, G)
# define abiotic part of the model
env.formula = "~ X_1 + X_2"
# Run the model with bottom-up control using stan_glm as fitting method and no penalisation
# (set iter = 1000 to obtain reliable results)
m = trophicSDM(Y, X, G, env.formula, iter = 50,
               family = binomial(link = "logit"), penal = NULL, 
               mode = "prey", method = "stan_glm")
# Plot just the first three species

plot(m, species = c("Y1","Y2","Y3"))

# If species = NULL (default), all species are plotted.
</code></pre>

<hr>
<h2 id='plotG'>Plots the metaweb G</h2><span id='topic+plotG'></span>

<h3>Description</h3>

<p>Plots the metaweb G used to fit the trophicSDM model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotG(tSDM)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plotG_+3A_tsdm">tSDM</code></td>
<td>
<p>A trophicSDMfit object obtained with trophicSDM()</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggnet object
</p>


<h3>Author(s)</h3>

<p>Giovanni Poggiato
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Y, X, G)
# define abiotic part of the model
env.formula = "~ X_1 + X_2"
# Run the model with bottom-up control using stan_glm as fitting method and no penalisation
# (set iter = 1000 to obtain reliable results)
m = trophicSDM(Y, X, G, env.formula, iter = 100,
               family = binomial(link = "logit"), penal = NULL, 
               mode = "prey", method = "stan_glm")

plotG(m)

</code></pre>

<hr>
<h2 id='plotG_inferred'>Plot the metaweb G according to the inferred coefficients</h2><span id='topic+plotG_inferred'></span>

<h3>Description</h3>

<p>Plot the metaweb G with links colored accordingly to the inferred prey-predator regression coefficients of a fitted trophicSDM model. Plots the metaweb G, where each predator-prey link is colored according to whether the related regression coefficient if inferred as positive (in red), negative (in blue) or non-significant (dashed grey line) according to the confidence level specified in &quot;level&quot;. Estimates of the significant standardised regression coefficients are pasted on the links. Only works if species are modeled as a function of their preys or predators without composite variables (i.e., the function only works if tSDM is fitted with sp.formula = NULL and sp.partition = NULL)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotG_inferred(tSDM, level = 0.9)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plotG_inferred_+3A_tsdm">tSDM</code></td>
<td>
<p>A trophicSDMfit object obtained with trophicSDM()</p>
</td></tr>
<tr><td><code id="plotG_inferred_+3A_level">level</code></td>
<td>
<p>The confidence level used to decide whether regression coefficients are non-significant or not. Default to 0.9.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggnet object
</p>


<h3>Author(s)</h3>

<p>Giovanni Poggiato
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Y, X, G)
# define abiotic part of the model
env.formula = "~ X_1 + X_2"
# Run the model with bottom-up control using stan_glm as fitting method and no penalisation
# (set iter = 1000 to obtain reliable results)
m = trophicSDM(Y, X, G, env.formula, 
               family = binomial(link = "logit"), penal = NULL, 
               mode = "prey", method = "glm")

plotG_inferred(m)

</code></pre>

<hr>
<h2 id='predict.SDMfit'>Predicts with a local model</h2><span id='topic+predict.SDMfit'></span>

<h3>Description</h3>

<p>Computes predicted values for a local model, i.e., a fitted SDMfit object This is sequentially called, for each species, by the function trophicSDM.predict
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'SDMfit'
predict(object, newdata, pred_samples = NULL, prob.cov = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict.SDMfit_+3A_object">object</code></td>
<td>
<p>A SDMfit object, typically obtained with trophicSDM() and available in the field $model of a trophicSDMfit object</p>
</td></tr>
<tr><td><code id="predict.SDMfit_+3A_newdata">newdata</code></td>
<td>
<p>A matrix containing both environmental covariates and the biotic variables that the local model uses to predict the species distribution.</p>
</td></tr>
<tr><td><code id="predict.SDMfit_+3A_pred_samples">pred_samples</code></td>
<td>
<p>Number of samples to draw from species posterior predictive distribution when method = &quot;stan_glm&quot;. If NULL, set by the default to the number of iterations/10.</p>
</td></tr>
<tr><td><code id="predict.SDMfit_+3A_prob.cov">prob.cov</code></td>
<td>
<p>Only for presence-absence data. If set to FALSE, it gives back also predicted presence-absences (which is then used by trophicSDM.predict to predict the predators).</p>
</td></tr>
<tr><td><code id="predict.SDMfit_+3A_...">...</code></td>
<td>
<p>additional arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing for each species the predicted value at each sites. If method = &quot;stan_glm&quot;, then each element of the list is a sites x pred_samples matrix containing the posterior predictive distribution of the species at each sites. If prob.cov = TRUE, it returns a list containing:
</p>

<ul>
<li> <p><code>predictions.prob</code>: Predicted probabilities of presence.
</p>
</li>
<li> <p><code>predictions.bin</code>: Predicted probabilities of presence.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Giovanni Poggiato and Jérémy Andréoletti
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Y, X, G)
# define abiotic part of the model
env.formula = "~ X_1 + X_2"
# Run the model with bottom-up control using stan_glm as fitting method and no penalisation
# (set iter = 1000 to obtain reliable results)
m = trophicSDM(Y, X, G, env.formula, iter = 100,
               family = binomial(link = "logit"), penal = NULL, 
               mode = "prey", method = "stan_glm")
# In order to predict non-basal species, we need to also provide
# the predicted occurrences of its preys. Here we compute the probability of
# presence of species Y4 at environemntal conditions c(0.5,0.5)
# when its prey Y3 is present.
predict(m$model$Y4, newdata = data.frame(X_1 = 0.5, X_2 = 0.5, Y3 = 1), pred_samples = 10)
</code></pre>

<hr>
<h2 id='predict.trophicSDMfit'>Computes predicted values from the fitted trophicSDMfit model</h2><span id='topic+predict.trophicSDMfit'></span>

<h3>Description</h3>

<p>Computes predicted values from the fitted trophicSDMfit model at environmental conditions specified by <code>Xnew</code>. Once predictions have been obtained, their quality can eventually be evaluated with <code>evaluateModelFit()</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'trophicSDMfit'
predict(
  object,
  Xnew = NULL,
  prob.cov = FALSE,
  pred_samples = NULL,
  run.parallel = FALSE,
  verbose = FALSE,
  fullPost = TRUE,
  filter.table = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict.trophicSDMfit_+3A_object">object</code></td>
<td>
<p>A trophicSDMfit object obtained with trophicSDM()</p>
</td></tr>
<tr><td><code id="predict.trophicSDMfit_+3A_xnew">Xnew</code></td>
<td>
<p>a matrix specifying the environmental covariates for the predictions to be made. If NULL (default), predictions are done on the training dataset (e.g. by setting Xnew = tSDM$data$X).</p>
</td></tr>
<tr><td><code id="predict.trophicSDMfit_+3A_prob.cov">prob.cov</code></td>
<td>
<p>Parameter to predict with trophicSDM with presence-absence data. Whether to use predicted probability of presence (prob.cov = T) or the transformed presence-absences (default, prov.cov = F) to predict species distribution.</p>
</td></tr>
<tr><td><code id="predict.trophicSDMfit_+3A_pred_samples">pred_samples</code></td>
<td>
<p>Number of samples to draw from species posterior predictive distribution when method = &quot;stan_glm&quot;. If NULL, set by the default to the number of iterations/10.</p>
</td></tr>
<tr><td><code id="predict.trophicSDMfit_+3A_run.parallel">run.parallel</code></td>
<td>
<p>Whether to use parallelise code when possible. Can speed up computation time.</p>
</td></tr>
<tr><td><code id="predict.trophicSDMfit_+3A_verbose">verbose</code></td>
<td>
<p>Whether to print advances of the algorithm</p>
</td></tr>
<tr><td><code id="predict.trophicSDMfit_+3A_fullpost">fullPost</code></td>
<td>
<p>Optional parameter for stan_glm only. Whether to give back the full posterior predictive distribution (default, fullPost = TRUE) or just the posterior mean, and 2.5% and 97.5% quantiles,</p>
</td></tr>
<tr><td><code id="predict.trophicSDMfit_+3A_filter.table">filter.table</code></td>
<td>
<p>Optional, default to NULL, should be provided only if the users wants to filter some species predictions. A sites x species matrix of zeros and ones.</p>
</td></tr>
<tr><td><code id="predict.trophicSDMfit_+3A_...">...</code></td>
<td>
<p>additional arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing for each species the predicted value at each sites. If method = &quot;stan_glm&quot;, then each element of the list is a sites x pred_samples matrix containing the posterior predictive distribution of the species at each sites.
</p>


<h3>Author(s)</h3>

<p>Giovanni Poggiato and Jérémy Andréoletti
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Y, X, G)
# define abiotic part of the model
env.formula = "~ X_1 + X_2"
# Run the model with bottom-up control using stan_glm as fitting method and no penalisation
# (set iter = 1000 to obtain reliable results)
m = trophicSDM(Y, X, G, env.formula, iter = 50,
               family = binomial(link = "logit"), penal = NULL, 
               mode = "prey", method = "stan_glm")
# We can now evaluate species probabilities of presence for the environmental conditions c(0.5, 0.5)
predict(m, Xnew = data.frame(X_1 = 0.5, X_2 = 0.5))
# Obtain 50 draws from the posterior predictive distribution of species (pred_samples = 10)
# using predicted presence-absences of species to predict their predators (prob.cov = TRUE)
# Since we don't specify Xnew, the function sets Xnew = X by default
Ypred = predict(m, fullPost = TRUE, pred_samples = 10, prob.cov = FALSE)
# We can ask the function to only give back posterior mean and 95% credible intervals with
# fullPost = F

Ypred = predict(m, fullPost = TRUE, pred_samples = 30, prob.cov = FALSE)

# If we fit the model using in a frequentist  way (e.g. glm)
m = trophicSDM(Y, X, G, env.formula, 
               family = binomial(link = "logit"), penal = NULL, 
               mode = "prey", method = "glm")
# We are obliged to set pred_samples = 1 
# (this is done by default if pred_samples is not provided)
# In the frequentist case, fullPost is useless.
 Ypred = predict(m, pred_samples = 1, prob.cov = FALSE)
</code></pre>

<hr>
<h2 id='predictPotential'>Predicts species potential niche</h2><span id='topic+predictPotential'></span>

<h3>Description</h3>

<p>Computes predicted values of the potential niches of species from the fitted trophicSDMfit model at environmental conditions specified by <code>Xnew</code>. Predictions are obtained by setting preys to present when mode = &quot;prey&quot; or setting predators to absent when mode = &quot;predator&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predictPotential(
  tSDM,
  Xnew = NULL,
  pred_samples = NULL,
  verbose = FALSE,
  fullPost = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predictPotential_+3A_tsdm">tSDM</code></td>
<td>
<p>A trophicSDMfit object obtained with trophicSDM()</p>
</td></tr>
<tr><td><code id="predictPotential_+3A_xnew">Xnew</code></td>
<td>
<p>a matrix specifying the environmental covariates for the predictions to be made. If NULL (default), predictions are done on the training dataset (e.g. by setting Xnew = tSDM$data$X).</p>
</td></tr>
<tr><td><code id="predictPotential_+3A_pred_samples">pred_samples</code></td>
<td>
<p>Number of samples to draw from species posterior predictive distribution when method = &quot;stan_glm&quot;. If NULL, set by the default to the number of iterations/10.</p>
</td></tr>
<tr><td><code id="predictPotential_+3A_verbose">verbose</code></td>
<td>
<p>Whether to print advances of the algorithm.</p>
</td></tr>
<tr><td><code id="predictPotential_+3A_fullpost">fullPost</code></td>
<td>
<p>Optional parameter for stan_glm only. Whether to give back the full posterior predictive distribution (default, fullPost = TRUE) or just the posterior mean, and 2.5% and 97.5% quantiles.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing for each species the predicted value at each sites. If method = &quot;stan_glm&quot;, then each element of the list is a sites x pred_samples matrix containing the posterior predictive distribution of the species at each sites.
</p>


<h3>Author(s)</h3>

<p>Giovanni Poggiato and Jérémy Andréoletti
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Y, X, G)
# define abiotic part of the model
env.formula = "~ X_1 + X_2"
# Run the model with bottom-up control using stan_glm as fitting method and no penalisation
# (set iter = 1000 to obtain reliable results)
m = trophicSDM(Y, X, G, env.formula, iter = 100,
               family = binomial(link = "logit"), penal = NULL, 
               mode = "prey", method = "stan_glm")
# Obtain 100 draws from the posterior predictive distribution of species potential niche
# (pred_samples = 50)
# Since we don't specify Xnew, the function sets Xnew = X by default
Ypred = predictPotential(m, fullPost = TRUE, pred_samples = 50)
# We can ask the function to only give back posterior mean and 95% credible intervals with
# fullPost = FALSE

Ypred = predictPotential(m, fullPost = FALSE, pred_samples = 50)

#' We can now evaluate species probabilities of presence for the enviromental
# conditions c(0.5, 0.5)
predictPotential(m, Xnew = data.frame(X_1 = 0.5, X_2 = 0.5), pred_samples = 50)

# If we fit the model using in a frequentist  way (e.g. glm)
m = trophicSDM(Y, X, G, env.formula, 
               family = binomial(link = "logit"), penal = NULL, 
               mode = "prey", method = "glm")
# We are obliged to set pred_samples = 1 
# (this is done by default if pred_samples is not provided)
# In the frequentist case, fullPost is useless.
Ypred = predictPotential(m, pred_samples = 1)
</code></pre>

<hr>
<h2 id='print.SDMfit'>Prints a SDMfit object</h2><span id='topic+print.SDMfit'></span>

<h3>Description</h3>

<p>Prints a SDMfit object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'SDMfit'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.SDMfit_+3A_x">x</code></td>
<td>
<p>A SDMfit object, typically obtained with trophicSDM() and available in the field $model of a trophicSDMfit object</p>
</td></tr>
<tr><td><code id="print.SDMfit_+3A_...">...</code></td>
<td>
<p>additional arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Prints a summary of the local SDM
</p>


<h3>Author(s)</h3>

<p>Giovanni Poggiato
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Y, X, G)
# define abiotic part of the model
env.formula = "~ X_1 + X_2"
# Run the model with bottom-up control using stan_glm as fitting method and no penalisation
# (set iter = 1000 to obtain reliable results)
m = trophicSDM(Y, X, G, env.formula, iter = 100,
               family = binomial(link = "logit"), penal = NULL, 
               mode = "prey", method = "stan_glm")
m$model$Y1
</code></pre>

<hr>
<h2 id='print.trophicSDMfit'>Prints a fitted trophicSDM model</h2><span id='topic+print.trophicSDMfit'></span>

<h3>Description</h3>

<p>Prints a fitted trophicSDM model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'trophicSDMfit'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.trophicSDMfit_+3A_x">x</code></td>
<td>
<p>A trophicSDMfit object obtained with trophicSDM()</p>
</td></tr>
<tr><td><code id="print.trophicSDMfit_+3A_...">...</code></td>
<td>
<p>additional arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Prints a summary of the fitted trophic SDM
</p>


<h3>Author(s)</h3>

<p>Giovanni Poggiato
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Y, X, G)
# define abiotic part of the model
env.formula = "~ X_1 + X_2"
# Run the model with bottom-up control using stan_glm as fitting method and no penalisation
# (set iter = 1000 to obtain reliable results)
trophicSDM(Y, X, G, env.formula, iter = 100,
               family = binomial(link = "logit"), penal = NULL, 
               mode = "prey", method = "stan_glm")
</code></pre>

<hr>
<h2 id='SDMfit'>Fitting a single-species SDM</h2><span id='topic+SDMfit'></span>

<h3>Description</h3>

<p>SDMfit is used to fit a single species SDM, what we call a 'local model' of trophicSDM. It returns an object of class 'SDMfit'. Requires basically the same inputs of trophicSDM, with the requirement to specify with the parameter 'focal' the species that is modeled by the SDMfit.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SDMfit(
  focal,
  Y,
  X,
  G,
  formula.foc,
  sp.formula = NULL,
  sp.partition = NULL,
  mode = "prey",
  method = "stan_glm",
  family,
  penal = NULL,
  iter = 1000,
  chains = 2,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="SDMfit_+3A_focal">focal</code></td>
<td>
<p>the name of the species to be modeled</p>
</td></tr>
<tr><td><code id="SDMfit_+3A_y">Y</code></td>
<td>
<p>The sites x species matrix containing observed species distribution (e.g. presence-absence).</p>
</td></tr>
<tr><td><code id="SDMfit_+3A_x">X</code></td>
<td>
<p>The design matrix, i.e. sites x predictor matrix containing the value of each explanatory variable (e.g. the environmental conditions) at each site.</p>
</td></tr>
<tr><td><code id="SDMfit_+3A_g">G</code></td>
<td>
<p>The species interaction network (aka metaweb). Needs to be an igraph object. Links must go from predator to preys. It needs to be a directed acyclic graph.</p>
</td></tr>
<tr><td><code id="SDMfit_+3A_formula.foc">formula.foc</code></td>
<td>
<p>The formula for the abiotic part of the species distribution model.</p>
</td></tr>
<tr><td><code id="SDMfit_+3A_sp.formula">sp.formula</code></td>
<td>
<p>(optional) It allows to specify a particular definition of the biotic part of the model, e.g., using composite variables (e.g., richness), or an interaction of the biotic and abiotic component. More details in 'Details'.</p>
</td></tr>
<tr><td><code id="SDMfit_+3A_sp.partition">sp.partition</code></td>
<td>
<p>(optional) a list to specify groups of species that are used to compute composite variables, e.g., a species can be modeled as a function of the richness of each group of preys. It has to be a list, each element is a vector containing the names of species in the group.</p>
</td></tr>
<tr><td><code id="SDMfit_+3A_mode">mode</code></td>
<td>
<p>&quot;prey&quot; if bottom-up control (default), &quot;predators&quot; otherwise. Notice that G needs to be such that links point from predators to prey.</p>
</td></tr>
<tr><td><code id="SDMfit_+3A_method">method</code></td>
<td>
<p>which SDM method to use. For now the available choices are: &quot;glm&quot; (frequentist) or &quot;stan_glm&quot; (full Bayesian MCMC, default). Notice that using &quot;glm&quot; does not allow error propagation when predicting.</p>
</td></tr>
<tr><td><code id="SDMfit_+3A_family">family</code></td>
<td>
<p>the family parameter of the glm function (see glm). family=gaussian(link =&quot;identity&quot;) for gaussian data or family=binomial(link = &quot;logit&quot;) or binomial(link = &quot;probit&quot;) for presence-absence data.</p>
</td></tr>
<tr><td><code id="SDMfit_+3A_penal">penal</code></td>
<td>
<p>(optional, default to NULL) Penalisation method to shrink regression coefficients.If NULL (default), the model does not penalise the regression coefficient. For now, available penalisation method are &quot;horshoe&quot; for stan_glm, &quot;elasticnet&quot; for glm and  &quot;coeff.signs&quot; (prey coefficients are set to positive and predator coefficients to negative) for glm and stan_glm.</p>
</td></tr>
<tr><td><code id="SDMfit_+3A_iter">iter</code></td>
<td>
<p>(for method=&quot;stan_glm&quot; only) Number of iterations for each MCMC chain if stan_glm is used</p>
</td></tr>
<tr><td><code id="SDMfit_+3A_chains">chains</code></td>
<td>
<p>(for method=&quot;stan_glm&quot; only) Number of MCMC chains (default to 2)</p>
</td></tr>
<tr><td><code id="SDMfit_+3A_verbose">verbose</code></td>
<td>
<p>Whether to print algorithm progresses</p>
</td></tr>
</table>


<h3>Details</h3>

<p>&quot;sp.formula&quot; and &quot;sp.partition&quot; can be combined to define any kind of composite variables for the biotic part of the formula. &quot;sp.formula&quot; can be :
</p>

<ul>
<li><p> A string defining a formula as function of &quot;richness&quot;. E.g., sp.formula=&quot;richness+I(richness)^2&quot; (species are modeled as a function of a quadratic polynomial of their prey richness), &quot;I(richness&gt;0)&quot; (species are modeled as a function of a dummy variable that is equal to 1 when at least one species is present). Importantly, when group of preys (or predators) are specified by &quot;sp.partition&quot;, species are modeled as a function of the composite variable specified by &quot;sp.formula&quot; for each of their prey groups.<br />
</p>
</li>
<li><p> A more flexible option is to specify sp.formula as a list (whose names are species' names) that contains for each species the definition biotic part of the model. Notice that, in this case, the function does not check that the model is a DAG. This allow to define any kind of composite variable, or to model interactions between environmental covariates and preys (or predators).
</p>
</li></ul>



<h3>Value</h3>

<p>A list containing 'm', a &quot;SDMfit&quot; object and 'form.all', a string describing the formula of the SDMfit object. The &quot;SDM&quot; fit object contains:
</p>
<table role = "presentation">
<tr><td><code>model</code></td>
<td>
<p>The output of the function used to fit the SDM. E.g., an object of class &quot;glm&quot; is method = &quot;glm&quot;, an object of class &quot;stanreg&quot; if method = &quot;stan_glm&quot;.</p>
</td></tr>
<tr><td><code>Y</code></td>
<td>
<p>A numeric vector of standard errors on parameters</p>
</td></tr>
<tr><td><code>form.all</code></td>
<td>
<p>The formula used to fit the SDM (both abiotic and biotic terms)</p>
</td></tr>
<tr><td><code>method</code>, <code>family</code>, <code>penal</code>, <code>iter</code>, <code>chains</code></td>
<td>
<p>The input parameters used to fit the SDM.</p>
</td></tr>
<tr><td><code>sp.name</code></td>
<td>
<p>The name of the species modeled</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>The model.frame data.frame used to fit the model</p>
</td></tr>
<tr><td><code>coef</code></td>
<td>
<p>The inferred coefficients (with credible intervals or p-values when available)</p>
</td></tr>
<tr><td><code>AIC</code></td>
<td>
<p>The AIC of the local model</p>
</td></tr>
<tr><td><code>log.lik</code></td>
<td>
<p>The log.likelihood of the local model</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Giovanni Poggiato and Jérémy Andréoletti
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Y,X,G)
# Run a local model (i.e. a SDM) for species Y6
mySDM = SDMfit("Y6", Y, X, G, "~X_1 + X_2", mode = "prey",
       method = "stan_glm", family = binomial(link = "logit"))
mySDM$m
</code></pre>

<hr>
<h2 id='summary.SDMfit'>Summary of a fitted SDMfit model</h2><span id='topic+summary.SDMfit'></span>

<h3>Description</h3>

<p>Summary of a fitted SDMfit model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'SDMfit'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.SDMfit_+3A_object">object</code></td>
<td>
<p>A SDMfit object, typically obtained with trophicSDM() and available in the field $model of a trophicSDMfit object</p>
</td></tr>
<tr><td><code id="summary.SDMfit_+3A_...">...</code></td>
<td>
<p>additional arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Prints a summary of the local SDM
</p>


<h3>Author(s)</h3>

<p>Giovanni Poggiato
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Y, X, G)
# define abiotic part of the model
env.formula = "~ X_1 + X_2"
# Run the model with bottom-up control using stan_glm as fitting method and no penalisation
# (set iter = 1000 to obtain reliable results)
m = trophicSDM(Y, X, G, env.formula, iter = 100,
               family = binomial(link = "logit"), penal = NULL, 
               mode = "prey", method = "stan_glm")
summary(m$model$Y1)
</code></pre>

<hr>
<h2 id='summary.trophicSDMfit'>Summary of a fitted trophicSDM model</h2><span id='topic+summary.trophicSDMfit'></span>

<h3>Description</h3>

<p>Summary of a fitted trophicSDM model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'trophicSDMfit'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.trophicSDMfit_+3A_object">object</code></td>
<td>
<p>A trophicSDMfit object obtained with trophicSDM()</p>
</td></tr>
<tr><td><code id="summary.trophicSDMfit_+3A_...">...</code></td>
<td>
<p>additional arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Prints a summary of the fitted trophic SDM
</p>


<h3>Author(s)</h3>

<p>Giovanni Poggiato
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Y, X, G)
# define abiotic part of the model
env.formula = "~ X_1 + X_2"
# Run the model with bottom-up control using stan_glm as fitting method and no penalisation
# (set iter = 1000 to obtain reliable results)
m = trophicSDM(Y, X, G, env.formula, iter = 100,
               family = binomial(link = "logit"), penal = NULL, 
               mode = "prey", method = "stan_glm")
summary(m)
</code></pre>

<hr>
<h2 id='trophicSDM'>Fitting a trophic Species distribution model</h2><span id='topic+trophicSDM'></span>

<h3>Description</h3>

<p>trophicSDM is used to fit a trophic species distribution model. Requires the species distribution data Y (the sites x species matrix), explanatory variables X and a directed acyclic graph G containing species interactions (i.e., the metaweb, with links going from predators to prey). The function fits the distribution of each species as a function of their preys (with mode = &quot;prey&quot;, by default) or predators (if set mode = &quot;predator&quot;).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trophicSDM(
  Y,
  X,
  G,
  env.formula = NULL,
  sp.formula = NULL,
  sp.partition = NULL,
  penal = NULL,
  mode = "prey",
  method = "stan_glm",
  family,
  iter = 500,
  chains = 2,
  run.parallel = FALSE,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="trophicSDM_+3A_y">Y</code></td>
<td>
<p>The sites x species matrix containing observed species distribution (e.g. presence-absence).</p>
</td></tr>
<tr><td><code id="trophicSDM_+3A_x">X</code></td>
<td>
<p>The design matrix, i.e. sites x predictor matrix containing the value of each explanatory variable (e.g. the environmental conditions) at each site.</p>
</td></tr>
<tr><td><code id="trophicSDM_+3A_g">G</code></td>
<td>
<p>The species interaction network (aka metaweb). Needs to be an igraph object. Links must go from predator to preys. It needs to be a directed acyclic graph.</p>
</td></tr>
<tr><td><code id="trophicSDM_+3A_env.formula">env.formula</code></td>
<td>
<p>The definition of the abiotic part of the model. It can be :
</p>

<ul>
<li><p> a string specifying the formula (e.g. &quot;~ X_1 + X_2&quot;). In this case, the same environmental variables are used for every species.
</p>
</li>
<li><p> A list that contains for each species the formula that describes the abiotic part of the model. In this case, different species can be modeled as a function of different environmental covariates. The names of the list must coincide with the names of the species.
</p>
</li></ul>
</td></tr>
<tr><td><code id="trophicSDM_+3A_sp.formula">sp.formula</code></td>
<td>
<p>(optional) It allows to specify a particular definition of the biotic part of the model, e.g., using composite variables (e.g., richness), or an interaction of the biotic and abitic component. More details in 'Details'.</p>
</td></tr>
<tr><td><code id="trophicSDM_+3A_sp.partition">sp.partition</code></td>
<td>
<p>(optional) a list to specify groups of species that are used to compute composite variables, e.g., a species can be modeled as a function of the richness of each group of preys. It has to be a list, each element is a vector containing the names of species in the group. More details in 'Details'.</p>
</td></tr>
<tr><td><code id="trophicSDM_+3A_penal">penal</code></td>
<td>
<p>Penalisation method to shrink regression coefficients. If <code>NULL</code> (default), the model does not penalise the regression coefficient. For now, available penalization method are  <code>"horshoe"</code> for method stan_glm, <code>"elasticnet"</code> for method glm. It is also possible to constrain the sign of biotic coefficients (prey coefficients are set to positive and predator coefficients to negative) by setting <code>"coeff.signs"</code> for methods glm and stan_glm.</p>
</td></tr>
<tr><td><code id="trophicSDM_+3A_mode">mode</code></td>
<td>
<p>&quot;prey&quot; if bottom-up control (default), &quot;predators&quot; otherwise. Notice that G needs to be such that links point from predators to prey.</p>
</td></tr>
<tr><td><code id="trophicSDM_+3A_method">method</code></td>
<td>
<p>which SDM method to use. For now the available choices are: <code>"glm"</code> (frequentist) or <code>"stan_glm"</code> (full bayesian MCMC, default). Notice that using &quot;glm&quot; does not allow error propagation when predicting.</p>
</td></tr>
<tr><td><code id="trophicSDM_+3A_family">family</code></td>
<td>
<p>the family parameter of the glm function (see <code>glm</code>). <code>gaussian(link = "identity")</code> for gaussian data. <code>binomial(link = "logit")</code> or <code>binomial(link = "probit")</code> for presence-absence data.</p>
</td></tr>
<tr><td><code id="trophicSDM_+3A_iter">iter</code></td>
<td>
<p>(for <code>"stan_glm"</code> only) Number of iterations for each MCMC chain if stan_glm is used</p>
</td></tr>
<tr><td><code id="trophicSDM_+3A_chains">chains</code></td>
<td>
<p>(for <code>"stan_glm"</code> only) Number of MCMC chains (default to 2)</p>
</td></tr>
<tr><td><code id="trophicSDM_+3A_run.parallel">run.parallel</code></td>
<td>
<p>Whether species models are fitted in parallel (can speed computational up time). Default to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="trophicSDM_+3A_verbose">verbose</code></td>
<td>
<p>Whether to print algorithm progresses</p>
</td></tr>
</table>


<h3>Details</h3>

<p>&quot;sp.formula&quot; and &quot;sp.partition&quot; can be combined to define any kind of composite variables for the biotic part of the formula. &quot;sp.formula&quot; can be :
</p>

<ul>
<li><p> A string defining a formula as function of &quot;richness&quot;, e.g., <code>"richness+I(richness)^2"</code> (species are modeled as a function of a quadratic polynomial of their prey richness), <code>"I(richness&gt;0)"</code> (species are modeled as a function of a dummy variable that is equal to 1 when at least one species is present). Importantly, when group of preys (or predators) are specified by &quot;sp.partition&quot;, species are modeled as a function of the composite variable specified by &quot;sp.formula&quot; for each of their prey (or predator) groups.
</p>
</li>
<li><p> A more flexible option is to specify sp.formula as a list (whose names are species' names) that contains for each species the definition of the biotic part of the model. Notice that, in this case, the function does not check that the model is a DAG. This allow to define any kind of composite variable, or to model interactions between environmental covariates and preys (or predators).
</p>
</li></ul>



<h3>Value</h3>

<p>A &quot;trophicSDMfit&quot; object, containing:
</p>
<table role = "presentation">
<tr><td><code>model</code></td>
<td>
<p>A list containing the local models (i.e. a SDM for each species). Each local model is an object of class &quot;SDMfit&quot;. See <code>?SDMfit</code> for more informations.</p>
</td></tr>
<tr><td><code>Y</code></td>
<td>
<p>A numeric vector of standard errors on parameters</p>
</td></tr>
<tr><td><code>form.all</code></td>
<td>
<p>A list describing each species formula (both biotic and abiotic terms)</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>A list containing all the data used to fit the model</p>
</td></tr>
<tr><td><code>model.call</code></td>
<td>
<p>A list containing the modeling choices of the fitted model (e.g. method, penalisation...)</p>
</td></tr>
<tr><td><code>coef</code></td>
<td>
<p>A list containing, for each species, the inferred coefficients (with credible intervals or p-values when available)</p>
</td></tr>
<tr><td><code>MCMC.diag</code></td>
<td>
<p>MCMC convergence metrics, only available for MCMC methods</p>
</td></tr>
<tr><td><code>AIC</code></td>
<td>
<p>Model's AIC</p>
</td></tr>
<tr><td><code>log.lik</code></td>
<td>
<p>Model's log.likelihood</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Giovanni Poggiato and Jérémy Andréoletti
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Y, X, G)
# define abiotic part of the model
env.formula = "~ X_1 + X_2"
# Run the model with bottom-up control using stan_glm as fitting method and no penalisation
# Increase the number of iterations to obtain reliable results.
m = trophicSDM(Y,X,G, env.formula, iter = 50,
               family = binomial(link = "logit"), penal = NULL, 
               mode = "prey", method = "stan_glm")
print(m)

# Access local models (e.g. species "Y5")
m$model$Y5
coef(m$model$Y5)
# The fitted model can be plotted with `plot(m)`

# Fit a sparse model in the Bayesian framework with the horshoe prior

m = trophicSDM(Y,X,G, env.formula, 
               family = binomial(link = "logit"), penal = "horshoe", 
               mode = "prey", method = "stan_glm")

# Fit frequentist glm
m = trophicSDM(Y,X,G, env.formula, 
               family = binomial(link = "logit"), penal = NULL, 
               mode = "prey", method = "glm")
               
# With elasticnet penalty   
m = trophicSDM(Y,X,G, env.formula, 
               family = binomial(link = "logit"), penal = "elasticnet", 
               mode = "prey", method = "glm")

#### Composite variables
# See vignette 'Composite variables' for a complete introduction to the use of composite variables
# Model species as a function of a quadratic polynomial of prey richness
m = trophicSDM(Y,X,G, env.formula, 
               family = binomial(link = "logit"), penal = NULL, 
               sp.formula = "richness + I(richness^2)",
               mode = "prey", method = "glm")
m$form.all
# Notice that for predators that feed on a single prey (with presence-absence data),
# their richness and the square of their richness is exactly the same variable
# In this case, `trophicSDM()` removes the redundant variable but prints a warning message

# Model species as a function of a dummy variable saying whether they have at leaste one prey
m = trophicSDM(Y,X,G, env.formula, 
               family = binomial(link = "logit"), penal = NULL, 
               sp.formula = "I(richness&gt;0)",
               mode = "prey", method = "glm")
m$form.all

# Define group of preys and model species as a function of the richness (with a quadratic term)
# of these groups of preys separately

# Species Y1 and Y2 belong to the same group, species Y3 and Y4 are both alone in their group and 
# species Y5 and Y6 form another group
sp.partition = list(c("Y1","Y2"),c("Y3"),c("Y4"), c("Y5","Y6"))

m = trophicSDM(Y,X,G, env.formula, 
               family = binomial(link = "logit"), penal = NULL, 
               sp.partition = sp.partition,
               sp.formula = "richness + I(richness^2)",
               mode = "prey", method = "glm")
m$form.all

</code></pre>

<hr>
<h2 id='trophicSDM_CV'>Compute K-fold cross-validation predicted values from a fitted trophicSDM model</h2><span id='topic+trophicSDM_CV'></span>

<h3>Description</h3>

<p>Once the CV predicted values are obtained, their quality can be evaluated with <code>evaluateModelFit()</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trophicSDM_CV(
  tSDM,
  K,
  partition = NULL,
  prob.cov = FALSE,
  pred_samples = NULL,
  iter = NULL,
  chains = NULL,
  run.parallel = FALSE,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="trophicSDM_CV_+3A_tsdm">tSDM</code></td>
<td>
<p>A trophicSDMfit object obtained with trophicSDM()</p>
</td></tr>
<tr><td><code id="trophicSDM_CV_+3A_k">K</code></td>
<td>
<p>The number of folds for the K-fold cross validation</p>
</td></tr>
<tr><td><code id="trophicSDM_CV_+3A_partition">partition</code></td>
<td>
<p>Optional parameter. A partition vector to specify a partition in K fold for cross validation</p>
</td></tr>
<tr><td><code id="trophicSDM_CV_+3A_prob.cov">prob.cov</code></td>
<td>
<p>Parameter to predict with trophicSDM with presence-absence data. Whether to use predicted probability of presence (prob.cov = T) or the transformed presence-absences (default, prov.cov = F) to predict species distribution.</p>
</td></tr>
<tr><td><code id="trophicSDM_CV_+3A_pred_samples">pred_samples</code></td>
<td>
<p>Number of samples to draw from species posterior predictive distribution when method = &quot;stan_glm&quot;. If NULL, set by the default to the number of iterations/10.</p>
</td></tr>
<tr><td><code id="trophicSDM_CV_+3A_iter">iter</code></td>
<td>
<p>For method = &quot;stan_glm&quot;: number of iterations of each MCMC chains to fit the trophicSDM model. Default to the number of iterations used to fit the provided trophicSDMfit object</p>
</td></tr>
<tr><td><code id="trophicSDM_CV_+3A_chains">chains</code></td>
<td>
<p>For method = &quot;stan_glm&quot;: number of MCMC chains to fit the trophicSDM model. Default to the number of iterations used to fit the provided trophicSDMfit object</p>
</td></tr>
<tr><td><code id="trophicSDM_CV_+3A_run.parallel">run.parallel</code></td>
<td>
<p>Whether to use parallelise code when possible. Default to TRUE. Can speed up computation time</p>
</td></tr>
<tr><td><code id="trophicSDM_CV_+3A_verbose">verbose</code></td>
<td>
<p>Whether to print advances of the algorithm</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing:
</p>
<table role = "presentation">
<tr><td><code>meanPred</code></td>
<td>
<p>a sites x species matrix of predicted occurrences of species for each site (e.g. probability of presence). With stan_glm the posterior predictive mean is return</p>
</td></tr>
<tr><td><code>Pred975</code>, <code>Pred025</code></td>
<td>
<p>Only for method = &quot;stan_glm&quot;, the 97.5% and 2.5% quantiles of the predictive posterior distribution</p>
</td></tr>
<tr><td><code>partition</code></td>
<td>
<p>the partition vector used to compute the K fold cross-validation</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Giovanni Poggiato
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Y, X, G)
# define abiotic part of the model
env.formula = "~ X_1 + X_2"
# Run the model with bottom-up control using glm as fitting method and no penalisation
# (set iter = 1000 to obtain reliable results)

m = trophicSDM(Y, X, G, env.formula, iter = 50, 
               family = binomial(link = "logit"), penal = NULL, 
               mode = "prey", method = "stan_glm")

# Run a 3-fold (K=3) cross validation. Predictions is done using presence-absences of preys
# (prob.cov = FALSE, see ?predict.trophicSDM) with 50 draws from the posterior distribution
# (pred_samples = 50)
CV = trophicSDM_CV(m, K = 3, prob.cov = FALSE, pred_samples = 10, run.parallel = FALSE)
# Use predicted values to evaluate model goodness of fit in cross validation
Ypred = CV$meanPred[,colnames(Y)]

evaluateModelFit(m, Ynew = Y, Ypredicted = Ypred)

# Now with K = 2 and by specifying the partition of site
m = trophicSDM(Y, X, G, env.formula, iter = 50,
               family = binomial(link = "logit"), penal = NULL, 
               mode = "prey", method = "glm")
partition = c(rep(1,500),rep(2,500))
CV = trophicSDM_CV(m, K = 2, partition = partition, prob.cov = FALSE,
                   pred_samples = 10, run.parallel = FALSE)
Ypred = CV$meanPred[,colnames(Y)]
evaluateModelFit(m, Ynew = Y, Ypredicted = Ypred)
</code></pre>

<hr>
<h2 id='X'>Simulated environmental covariates X</h2><span id='topic+X'></span>

<h3>Description</h3>

<p>Simulated environmental covariates X
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(X)
</code></pre>


<h3>Format</h3>

<p>A site x covariates matrix X
</p>


<h3>Author(s)</h3>

<p>Giovanni Poggiato
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(X)
</code></pre>

<hr>
<h2 id='Y'>Simulated species distribution Y</h2><span id='topic+Y'></span>

<h3>Description</h3>

<p>Simulated species distribution Y
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(Y)
</code></pre>


<h3>Format</h3>

<p>A site x species matrix Y, a site x covariates matrix X and a trophic interaction network G (object igraph)
</p>


<h3>Author(s)</h3>

<p>Giovanni Poggiato
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Y)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
