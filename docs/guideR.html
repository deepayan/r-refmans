<!DOCTYPE html><html lang="en-US"><head><title>Help for package guideR</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {guideR}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#guideR-package'><p>guideR: Miscellaneous Statistical Functions Used in 'guide-R'</p></a></li>
<li><a href='#install_dependencies'><p>Install / Update project dependencies</p></a></li>
<li><a href='#is_different'><p>Comparison tests considering <code>NA</code> as values to be compared</p></a></li>
<li><a href='#leading_zeros'><p>Add leading zeros</p></a></li>
<li><a href='#long_to_periods'><p>Transform a data frame from long format to period format</p></a></li>
<li><a href='#observed_vs_theoretical'><p>Plot observed vs predicted distribution of a fitted model</p></a></li>
<li><a href='#periods_to_long'><p>Transform a data frame from period format to long format</p></a></li>
<li><a href='#plot_inertia_from_tree'><p>Plot inertia, absolute loss and relative loss from a classification tree</p></a></li>
<li><a href='#plot_proportions'><p>Plot proportions by sub-groups</p></a></li>
<li><a href='#proportion'><p>Compute proportions</p></a></li>
<li><a href='#round_preserve_sum'><p>Round values while preserve their rounded sum in R</p></a></li>
<li><a href='#step_with_na'><p>Apply <code>step()</code>, taking into account missing values</p></a></li>
<li><a href='#titanic'><p>Titanic data set in long format</p></a></li>
<li><a href='#unrowwise'><p>Remove row-wise grouping</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Miscellaneous Statistical Functions Used in 'guide-R'</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Companion package for the manual
  'guide-R : Guide pour l’analyse de données d’enquêtes avec R' available at
  <a href="https://larmarange.github.io/guide-R/">https://larmarange.github.io/guide-R/</a>. 'guideR' implements miscellaneous
  functions introduced in 'guide-R' to facilitate statistical analysis and
  manipulation of survey data.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://larmarange.github.io/guideR/">https://larmarange.github.io/guideR/</a>,
<a href="https://github.com/larmarange/guideR">https://github.com/larmarange/guideR</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/larmarange/guideR/issues">https://github.com/larmarange/guideR/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.2)</td>
</tr>
<tr>
<td>Imports:</td>
<td>cli, dplyr, forcats, ggplot2, labelled, lifecycle, pak,
patchwork, purrr, renv, rlang, scales, srvyr, stats, stringr,
tidyr, tidyselect</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Suggests:</td>
<td>broom.helpers, FactoMineR, nnet, spelling, survey, survival,
testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-03-16 12:07:50 UTC; josep</td>
</tr>
<tr>
<td>Author:</td>
<td>Joseph Larmarange <a href="https://orcid.org/0000-0001-7097-700X"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Joseph Larmarange &lt;joseph@larmarange.net&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-03-16 12:20:01 UTC</td>
</tr>
</table>
<hr>
<h2 id='guideR-package'>guideR: Miscellaneous Statistical Functions Used in 'guide-R'</h2><span id='topic+guideR'></span><span id='topic+guideR-package'></span>

<h3>Description</h3>

<p>Companion package for the manual 'guide-R : Guide pour l’analyse de données d’enquêtes avec R' available at <a href="https://larmarange.github.io/guide-R/">https://larmarange.github.io/guide-R/</a>. 'guideR' implements miscellaneous functions introduced in 'guide-R' to facilitate statistical analysis and manipulation of survey data.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Joseph Larmarange <a href="mailto:joseph@larmarange.net">joseph@larmarange.net</a> (<a href="https://orcid.org/0000-0001-7097-700X">ORCID</a>)
</p>


<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://larmarange.github.io/guideR/">https://larmarange.github.io/guideR/</a>
</p>
</li>
<li> <p><a href="https://github.com/larmarange/guideR">https://github.com/larmarange/guideR</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/larmarange/guideR/issues">https://github.com/larmarange/guideR/issues</a>
</p>
</li></ul>


<hr>
<h2 id='install_dependencies'>Install / Update project dependencies</h2><span id='topic+install_dependencies'></span>

<h3>Description</h3>

<p>This function uses <code><a href="renv.html#topic+dependencies">renv::dependencies()</a></code> to identify R package dependencies
in a project and then calls <code><a href="pak.html#topic+pkg_install">pak::pkg_install()</a></code> to install / update these
packages.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>install_dependencies(ask = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="install_dependencies_+3A_ask">ask</code></td>
<td>
<p>Whether to ask for confirmation when installing a different
version of a package that is already installed. Installations that only add
new packages never require confirmation.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>(Invisibly) A data frame with information about the installed
package(s).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
install_dependencies()

## End(Not run)
</code></pre>

<hr>
<h2 id='is_different'>Comparison tests considering <code>NA</code> as values to be compared</h2><span id='topic+is_different'></span><span id='topic+is_equal'></span><span id='topic+cumdifferent'></span><span id='topic+num_cycle'></span>

<h3>Description</h3>

<p><code>is_different()</code> and <code>is_equal()</code> performs comparison tests, considering
<code>NA</code> values as legitimate values (see examples).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_different(x, y)

is_equal(x, y)

cumdifferent(x)

num_cycle(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="is_different_+3A_x">x</code>, <code id="is_different_+3A_y">y</code></td>
<td>
<p>Vectors to be compared.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>cum_different()</code> allows to identify groups of continuous rows that have
the same value. <code>num_cycle()</code> could be used to identify sub-groups that
respect a certain condition (see examples).
</p>
<p><code>is_equal(x, y)</code> is equivalent to
<code>(x == y &amp; !is.na(x) &amp; !is.na(y)) | (is.na(x) &amp; is.na(y))</code>, and
<code>is_different(x, y)</code> is equivalent to
<code>(x != y &amp; !is.na(x) &amp; !is.na(y)) | xor(is.na(x), is.na(y))</code>.
</p>


<h3>Value</h3>

<p>A vector of the same length as <code>x</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>v &lt;- c("a", "b", NA)
is_different(v, "a")
is_different(v, NA)
is_equal(v, "a")
is_equal(v, NA)
d &lt;- dplyr::tibble(group = c("a", "a", "b", "b", "a", "b", "c", "a"))
d |&gt;
  dplyr::mutate(
    subgroup = cumdifferent(group),
    sub_a = num_cycle(group == "a")
  )
</code></pre>

<hr>
<h2 id='leading_zeros'>Add leading zeros</h2><span id='topic+leading_zeros'></span>

<h3>Description</h3>

<p>Add leading zeros
</p>


<h3>Usage</h3>

<pre><code class='language-R'>leading_zeros(x, left_digits = NULL, digits = 0, prefix = "", suffix = "", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="leading_zeros_+3A_x">x</code></td>
<td>
<p>a numeric vector</p>
</td></tr>
<tr><td><code id="leading_zeros_+3A_left_digits">left_digits</code></td>
<td>
<p>number of digits before decimal point, automatically
computed if not provided</p>
</td></tr>
<tr><td><code id="leading_zeros_+3A_digits">digits</code></td>
<td>
<p>number of digits after decimal point</p>
</td></tr>
<tr><td><code id="leading_zeros_+3A_prefix">prefix</code>, <code id="leading_zeros_+3A_suffix">suffix</code></td>
<td>
<p>Symbols to display before and after value</p>
</td></tr>
<tr><td><code id="leading_zeros_+3A_...">...</code></td>
<td>
<p>additional parameters passed to <code><a href="base.html#topic+formatc">base::formatC()</a></code>,
as <code>big.mark</code> or <code>decimal.mark</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A character vector of the same length as <code>x</code>.
</p>


<h3>See Also</h3>

<p><code><a href="base.html#topic+formatc">base::formatC()</a></code>, <code><a href="base.html#topic+sprintf">base::sprintf()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>v &lt;- c(2, 103.24, 1042.147, 12.4566, NA)
leading_zeros(v)
leading_zeros(v, digits = 1)
leading_zeros(v, left_digits = 6, big.mark = " ")
leading_zeros(c(0, 6, 12, 18), prefix = "M")
</code></pre>

<hr>
<h2 id='long_to_periods'>Transform a data frame from long format to period format</h2><span id='topic+long_to_periods'></span>

<h3>Description</h3>

<p>Transform a data frame from long format to period format
</p>


<h3>Usage</h3>

<pre><code class='language-R'>long_to_periods(data, id, start, stop = NULL, by = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="long_to_periods_+3A_data">data</code></td>
<td>
<p>A data frame, or a data frame extension (e.g. a tibble).</p>
</td></tr>
<tr><td><code id="long_to_periods_+3A_id">id</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt;
Column containing individual ids</p>
</td></tr>
<tr><td><code id="long_to_periods_+3A_start">start</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt;
Time variable indicating the beginning of each row</p>
</td></tr>
<tr><td><code id="long_to_periods_+3A_stop">stop</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt;
Optional time variable indicating the end of each row. If not provided, it
will be derived from the dataset, considering that each row ends at the
beginning of the next one.</p>
</td></tr>
<tr><td><code id="long_to_periods_+3A_by">by</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt;
Co-variables to consider (optional)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+periods_to_long">periods_to_long()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>d &lt;- dplyr::tibble(
  patient = c(1, 2, 3, 3, 4, 4, 4),
  begin = c(0, 0, 0, 1, 0, 36, 39),
  end = c(50, 6, 1, 16, 36, 39, 45),
  covar = c("no", "no", "no", "yes", "no", "yes", "yes")
)
d

d |&gt; long_to_periods(id = patient, start = begin, stop = end)
d |&gt; long_to_periods(id = patient, start = begin, stop = end, by = covar)

# If stop not provided, it is deduced.
# However, it considers that observation ends at the last start time.
d |&gt; long_to_periods(id = patient, start = begin)
</code></pre>

<hr>
<h2 id='observed_vs_theoretical'>Plot observed vs predicted distribution of a fitted model</h2><span id='topic+observed_vs_theoretical'></span>

<h3>Description</h3>

<p>Plot observed vs predicted distribution of a fitted model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>observed_vs_theoretical(model)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="observed_vs_theoretical_+3A_model">model</code></td>
<td>
<p>A statistical model.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Has been tested with <code><a href="stats.html#topic+lm">stats::lm()</a></code> and <code><a href="stats.html#topic+glm">stats::glm()</a></code> models. It may work
with other types of models, but without any warranty.
</p>


<h3>Value</h3>

<p>A <code>ggplot2</code> plot.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># a linear model
mod &lt;- lm(Sepal.Length ~ Sepal.Width + Species, data = iris)
mod |&gt; observed_vs_theoretical()

# a logistic regression
mod &lt;- glm(
  as.factor(Survived) ~ Class + Sex,
  data = titanic,
  family = binomial()
)
mod |&gt; observed_vs_theoretical()
</code></pre>

<hr>
<h2 id='periods_to_long'>Transform a data frame from period format to long format</h2><span id='topic+periods_to_long'></span>

<h3>Description</h3>

<p>Transform a data frame from period format to long format
</p>


<h3>Usage</h3>

<pre><code class='language-R'>periods_to_long(
  data,
  start,
  stop,
  time_step = 1,
  time_name = "time",
  keep = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="periods_to_long_+3A_data">data</code></td>
<td>
<p>A data frame, or a data frame extension (e.g. a tibble).</p>
</td></tr>
<tr><td><code id="periods_to_long_+3A_start">start</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt;
Time variable indicating the beginning of each row</p>
</td></tr>
<tr><td><code id="periods_to_long_+3A_stop">stop</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt;
Optional time variable indicating the end of each row. If not provided, it
will be derived from the dataset, considering that each row ends at the
beginning of the next one.</p>
</td></tr>
<tr><td><code id="periods_to_long_+3A_time_step">time_step</code></td>
<td>
<p>(numeric) Desired value for the time variable.</p>
</td></tr>
<tr><td><code id="periods_to_long_+3A_time_name">time_name</code></td>
<td>
<p>(character) Name of the time variable.</p>
</td></tr>
<tr><td><code id="periods_to_long_+3A_keep">keep</code></td>
<td>
<p>(logical) Should start and stop variable be kept in the results?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+long_to_periods">long_to_periods()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>d &lt;- dplyr::tibble(
  patient = c(1, 2, 3, 3),
  begin = c(0, 2, 0, 3),
  end = c(6, 4, 2, 8),
  covar = c("no", "yes", "no", "yes")
)
d

d |&gt; periods_to_long(start = begin, stop = end)
d |&gt; periods_to_long(start = begin, stop = end, time_step = 5)
</code></pre>

<hr>
<h2 id='plot_inertia_from_tree'>Plot inertia, absolute loss and relative loss from a classification tree</h2><span id='topic+plot_inertia_from_tree'></span><span id='topic+get_inertia_from_tree'></span>

<h3>Description</h3>

<p>Plot inertia, absolute loss and relative loss from a classification tree
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_inertia_from_tree(tree, k_max = 15)

get_inertia_from_tree(tree, k_max = 15)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_inertia_from_tree_+3A_tree">tree</code></td>
<td>
<p>A dendrogram, i.e. an <a href="stats.html#topic+hclust">stats::hclust</a> object,
an <a href="FactoMineR.html#topic+HCPC">FactoMineR::HCPC</a> object or an object that can be converted to an
<a href="stats.html#topic+hclust">stats::hclust</a> object with <code><a href="stats.html#topic+as.hclust">stats::as.hclust()</a></code>.</p>
</td></tr>
<tr><td><code id="plot_inertia_from_tree_+3A_k_max">k_max</code></td>
<td>
<p>Maximum number of clusters to return / plot.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>ggplot2</code> plot or a tibble.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>hc &lt;- hclust(dist(USArrests))
get_inertia_from_tree(hc)
plot_inertia_from_tree(hc)
</code></pre>

<hr>
<h2 id='plot_proportions'>Plot proportions by sub-groups</h2><span id='topic+plot_proportions'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
See <code><a href="#topic+proportion">proportion()</a></code> for more details on the way proportions and confidence
intervals are computed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_proportions(
  data,
  condition,
  by = NULL,
  geom = "bar",
  ...,
  show_overall = TRUE,
  overall_label = "Overall",
  show_ci = TRUE,
  conf_level = 0.95,
  ci_color = "black",
  show_pvalues = TRUE,
  pvalues_test = c("fisher", "chisq"),
  pvalues_labeller = scales::label_pvalue(add_p = TRUE),
  pvalues_size = 3.5,
  show_labels = TRUE,
  labels_labeller = scales::label_percent(1),
  labels_size = 3.5,
  labels_color = "black",
  show_overall_line = FALSE,
  overall_line_type = "dashed",
  overall_line_color = "black",
  overall_line_width = 0.5,
  facet_labeller = ggplot2::label_wrap_gen(width = 50, multi_line = TRUE),
  flip = FALSE,
  return_data = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_proportions_+3A_data">data</code></td>
<td>
<p>A data frame, data frame extension (e.g. a tibble),
or a survey design object.</p>
</td></tr>
<tr><td><code id="plot_proportions_+3A_condition">condition</code></td>
<td>
<p>&lt;<code><a href="rlang.html#topic+args_data_masking">data-masking</a></code>&gt; A condition
defining a proportion (see examples).</p>
</td></tr>
<tr><td><code id="plot_proportions_+3A_by">by</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt; List of variables to
group by (comparison is done separately for each variable).</p>
</td></tr>
<tr><td><code id="plot_proportions_+3A_geom">geom</code></td>
<td>
<p>Geometry to use for plotting proportions (<code>"bar"</code> by default).</p>
</td></tr>
<tr><td><code id="plot_proportions_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to the geom defined by <code>geom</code>.</p>
</td></tr>
<tr><td><code id="plot_proportions_+3A_show_overall">show_overall</code></td>
<td>
<p>Display &quot;Overall&quot; column?</p>
</td></tr>
<tr><td><code id="plot_proportions_+3A_overall_label">overall_label</code></td>
<td>
<p>Label for the overall column.</p>
</td></tr>
<tr><td><code id="plot_proportions_+3A_show_ci">show_ci</code></td>
<td>
<p>Display confidence intervals?</p>
</td></tr>
<tr><td><code id="plot_proportions_+3A_conf_level">conf_level</code></td>
<td>
<p>Confidence level for the confidence intervals.</p>
</td></tr>
<tr><td><code id="plot_proportions_+3A_ci_color">ci_color</code></td>
<td>
<p>Color of the error bars representing confidence intervals.</p>
</td></tr>
<tr><td><code id="plot_proportions_+3A_show_pvalues">show_pvalues</code></td>
<td>
<p>Display p-values in the top-left corner?</p>
</td></tr>
<tr><td><code id="plot_proportions_+3A_pvalues_test">pvalues_test</code></td>
<td>
<p>Test to compute p-values for data frames: <code>"fisher"</code> for
<code><a href="stats.html#topic+fisher.test">stats::fisher.test()</a></code> (with <code>simulate.p.value = TRUE</code>) or <code>"chisq"</code> for
<code><a href="stats.html#topic+chisq.test">stats::chisq.test()</a></code>. Has no effect on survey objects for those
<code><a href="survey.html#topic+svychisq">survey::svychisq()</a></code> is used.</p>
</td></tr>
<tr><td><code id="plot_proportions_+3A_pvalues_labeller">pvalues_labeller</code></td>
<td>
<p>Labeller function for p-values.</p>
</td></tr>
<tr><td><code id="plot_proportions_+3A_pvalues_size">pvalues_size</code></td>
<td>
<p>Text size for p-values.</p>
</td></tr>
<tr><td><code id="plot_proportions_+3A_show_labels">show_labels</code></td>
<td>
<p>Display proportion labels?</p>
</td></tr>
<tr><td><code id="plot_proportions_+3A_labels_labeller">labels_labeller</code></td>
<td>
<p>Labeller function for proportion labels.</p>
</td></tr>
<tr><td><code id="plot_proportions_+3A_labels_size">labels_size</code></td>
<td>
<p>Size of proportion labels.</p>
</td></tr>
<tr><td><code id="plot_proportions_+3A_labels_color">labels_color</code></td>
<td>
<p>Color of proportion labels.</p>
</td></tr>
<tr><td><code id="plot_proportions_+3A_show_overall_line">show_overall_line</code></td>
<td>
<p>Add an overall line?</p>
</td></tr>
<tr><td><code id="plot_proportions_+3A_overall_line_type">overall_line_type</code></td>
<td>
<p>Line type of the overall line.</p>
</td></tr>
<tr><td><code id="plot_proportions_+3A_overall_line_color">overall_line_color</code></td>
<td>
<p>Color of the overall line.</p>
</td></tr>
<tr><td><code id="plot_proportions_+3A_overall_line_width">overall_line_width</code></td>
<td>
<p>Line width of the overall line.</p>
</td></tr>
<tr><td><code id="plot_proportions_+3A_facet_labeller">facet_labeller</code></td>
<td>
<p>Labeller function for strip labels.</p>
</td></tr>
<tr><td><code id="plot_proportions_+3A_flip">flip</code></td>
<td>
<p>Flip x and y axis?</p>
</td></tr>
<tr><td><code id="plot_proportions_+3A_return_data">return_data</code></td>
<td>
<p>Return data used instead of the plot?</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>titanic |&gt;
  plot_proportions(
    Survived == "Yes",
    overall_label = "All",
    labels_color = "white"
  )

titanic |&gt;
  plot_proportions(
    Survived == "Yes",
    by = c(Class, Sex),
    fill = "lightblue"
  )


titanic |&gt;
  plot_proportions(
    Survived == "Yes",
    by = c(Class, Sex),
    fill = "lightblue",
    flip = TRUE
  )

titanic |&gt;
  plot_proportions(
    Survived == "Yes",
    by = c(Class, Sex),
    geom = "point",
    color = "red",
    size = 3,
    show_labels = FALSE
  )

titanic |&gt;
  plot_proportions(
    Survived == "Yes",
    by = c(Class, Sex),
    geom = "area",
    fill = "lightgreen",
    show_overall = FALSE
  )

titanic |&gt;
  plot_proportions(
    Survived == "Yes",
    by = c(Class, Sex),
    geom = "line",
    color = "purple",
    ci_color = "darkblue",
    show_overall = FALSE
  )

titanic |&gt;
  plot_proportions(
    Survived == "Yes",
    by = -Survived,
    mapping = ggplot2::aes(fill = variable),
    color = "black",
    show.legend = FALSE,
    show_overall_line = TRUE,
    show_pvalues = FALSE
 )

# works with survey object
titanic |&gt;
  srvyr::as_survey() |&gt;
  plot_proportions(
    Survived == "Yes",
    by = c(Class, Sex),
    fill = "darksalmon",
    color = "black",
    show_overall_line = TRUE
 )

</code></pre>

<hr>
<h2 id='proportion'>Compute proportions</h2><span id='topic+proportion'></span><span id='topic+proportion.data.frame'></span><span id='topic+proportion.survey.design'></span><span id='topic+proportion.default'></span>

<h3>Description</h3>

<p><code>proportion()</code> lets you quickly count observations (like <code><a href="dplyr.html#topic+count">dplyr::count()</a></code>)
and compute relative proportions. Proportions are computed separately by
group (see examples).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>proportion(data, ...)

## S3 method for class 'data.frame'
proportion(
  data,
  ...,
  .by = NULL,
  .na.rm = FALSE,
  .weight = NULL,
  .scale = 100,
  .sort = FALSE,
  .drop = FALSE,
  .conf.int = FALSE,
  .conf.level = 0.95,
  .options = list(correct = TRUE)
)

## S3 method for class 'survey.design'
proportion(
  data,
  ...,
  .by = NULL,
  .na.rm = FALSE,
  .scale = 100,
  .sort = FALSE,
  .conf.int = FALSE,
  .conf.level = 0.95,
  .options = NULL
)

## Default S3 method:
proportion(
  data,
  ...,
  .na.rm = FALSE,
  .scale = 100,
  .sort = FALSE,
  .drop = FALSE,
  .conf.int = FALSE,
  .conf.level = 0.95,
  .options = list(correct = TRUE)
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="proportion_+3A_data">data</code></td>
<td>
<p>A vector, a data frame, data frame extension (e.g. a tibble),
or a survey design object.</p>
</td></tr>
<tr><td><code id="proportion_+3A_...">...</code></td>
<td>
<p>&lt;<code><a href="rlang.html#topic+args_data_masking">data-masking</a></code>&gt; Variable(s) for those
computing proportions.</p>
</td></tr>
<tr><td><code id="proportion_+3A_.by">.by</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt; Optional additional
variables to group by (in addition to those eventually previously declared
using <code><a href="dplyr.html#topic+group_by">dplyr::group_by()</a></code>).</p>
</td></tr>
<tr><td><code id="proportion_+3A_.na.rm">.na.rm</code></td>
<td>
<p>Should <code>NA</code> values be removed
(from variables declared in <code>...</code>)?</p>
</td></tr>
<tr><td><code id="proportion_+3A_.weight">.weight</code></td>
<td>
<p>&lt;<code><a href="rlang.html#topic+args_data_masking">data-masking</a></code>&gt; Frequency
weights. Can be <code>NULL</code> or a variable.</p>
</td></tr>
<tr><td><code id="proportion_+3A_.scale">.scale</code></td>
<td>
<p>A scaling factor applied to proportion. Use <code>1</code> for keeping
proportions unchanged.</p>
</td></tr>
<tr><td><code id="proportion_+3A_.sort">.sort</code></td>
<td>
<p>If <code>TRUE</code>, will show the highest proportions at the top.</p>
</td></tr>
<tr><td><code id="proportion_+3A_.drop">.drop</code></td>
<td>
<p>If <code>TRUE</code>, will remove empty groups from the output.</p>
</td></tr>
<tr><td><code id="proportion_+3A_.conf.int">.conf.int</code></td>
<td>
<p>If <code>TRUE</code>, will estimate confidence intervals.</p>
</td></tr>
<tr><td><code id="proportion_+3A_.conf.level">.conf.level</code></td>
<td>
<p>Confidence level for the returned confidence intervals.</p>
</td></tr>
<tr><td><code id="proportion_+3A_.options">.options</code></td>
<td>
<p>Additional arguments passed to <code><a href="stats.html#topic+prop.test">stats::prop.test()</a></code>
or <code><a href="srvyr.html#topic+survey_mean">srvyr::survey_prop()</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble.
</p>
<p>A tibble with one row per group.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># using a vector
titanic$Class |&gt; proportion()

# univariable table
titanic |&gt; proportion(Class)
titanic |&gt; proportion(Class, .sort = TRUE)
titanic |&gt; proportion(Class, .conf.int = TRUE)
titanic |&gt; proportion(Class, .conf.int = TRUE, .scale = 1)

# bivariable table
titanic |&gt; proportion(Class, Survived) # proportions of the total
titanic |&gt; proportion(Survived, .by = Class) # row proportions
titanic |&gt; # equivalent syntax
  dplyr::group_by(Class) |&gt;
  proportion(Survived)

# combining 3 variables or more
titanic |&gt; proportion(Class, Sex, Survived)
titanic |&gt; proportion(Sex, Survived, .by = Class)
titanic |&gt; proportion(Survived, .by = c(Class, Sex))

# missing values
dna &lt;- titanic
dna$Survived[c(1:20, 500:530)] &lt;- NA
dna |&gt; proportion(Survived)
dna |&gt; proportion(Survived, .na.rm = TRUE)


## SURVEY DATA ------------------------------------------------------

ds &lt;- srvyr::as_survey(titanic)

# univariable table
ds |&gt; proportion(Class)
ds |&gt; proportion(Class, .sort = TRUE)
ds |&gt; proportion(Class, .conf.int = TRUE)
ds |&gt; proportion(Class, .conf.int = TRUE, .scale = 1)

# bivariable table
ds |&gt; proportion(Class, Survived) # proportions of the total
ds |&gt; proportion(Survived, .by = Class) # row proportions
ds |&gt; dplyr::group_by(Class) |&gt; proportion(Survived)

# combining 3 variables or more
ds |&gt; proportion(Class, Sex, Survived)
ds |&gt; proportion(Sex, Survived, .by = Class)
ds |&gt; proportion(Survived, .by = c(Class, Sex))

# missing values
dsna &lt;- srvyr::as_survey(dna)
dsna |&gt; proportion(Survived)
dsna |&gt; proportion(Survived, .na.rm = TRUE)

</code></pre>

<hr>
<h2 id='round_preserve_sum'>Round values while preserve their rounded sum in R</h2><span id='topic+round_preserve_sum'></span>

<h3>Description</h3>

<p>Sometimes, the sum of rounded numbers (e.g., using <code><a href="base.html#topic+Round">base::round()</a></code>) is not
the same as their rounded sum.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>round_preserve_sum(x, digits = 0)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="round_preserve_sum_+3A_x">x</code></td>
<td>
<p>Numerical vector to sum.</p>
</td></tr>
<tr><td><code id="round_preserve_sum_+3A_digits">digits</code></td>
<td>
<p>Number of decimals for rounding.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This solution applies the following algorithm
</p>

<ul>
<li><p> Round down to the specified number of decimal places
</p>
</li>
<li><p> Order numbers by their remainder values
</p>
</li>
<li><p> Increment the specified decimal place of values with <em>k</em> largest
remainders, where <em>k</em> is the number of values that must be incremented to
preserve their rounded sum
</p>
</li></ul>



<h3>Value</h3>

<p>A numerical vector of same length as <code>x</code>.
</p>


<h3>Source</h3>

<p><a href="https://biostatmatt.com/archives/2902">https://biostatmatt.com/archives/2902</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sum(c(0.333, 0.333, 0.334))
round(c(0.333, 0.333, 0.334), 2)
sum(round(c(0.333, 0.333, 0.334), 2))
round_preserve_sum(c(0.333, 0.333, 0.334), 2)
sum(round_preserve_sum(c(0.333, 0.333, 0.334), 2))
</code></pre>

<hr>
<h2 id='step_with_na'>Apply <code>step()</code>, taking into account missing values</h2><span id='topic+step_with_na'></span><span id='topic+step_with_na.default'></span><span id='topic+step_with_na.svyglm'></span>

<h3>Description</h3>

<p>When your data contains missing values, concerned observations are removed
from a model. However, then at a later stage, you try to apply a descending
stepwise approach to reduce your model by minimization of AIC, you may
encounter an error because the number of rows has changed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>step_with_na(model, ...)

## Default S3 method:
step_with_na(model, ..., full_data = eval(model$call$data))

## S3 method for class 'svyglm'
step_with_na(model, ..., design)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="step_with_na_+3A_model">model</code></td>
<td>
<p>A model object.</p>
</td></tr>
<tr><td><code id="step_with_na_+3A_...">...</code></td>
<td>
<p>Additional parameters passed to <code><a href="stats.html#topic+step">stats::step()</a></code>.</p>
</td></tr>
<tr><td><code id="step_with_na_+3A_full_data">full_data</code></td>
<td>
<p>Full data frame used for the model, including missing data.</p>
</td></tr>
<tr><td><code id="step_with_na_+3A_design">design</code></td>
<td>
<p>Survey design previously passed to <code><a href="survey.html#topic+svyglm">survey::svyglm()</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>step_with_na()</code> applies the following strategy:
</p>

<ul>
<li><p> recomputes the models using only complete cases;
</p>
</li>
<li><p> applies <code><a href="stats.html#topic+step">stats::step()</a></code>;
</p>
</li>
<li><p> recomputes the reduced model using the full original dataset.
</p>
</li></ul>

<p><code>step_with_na()</code> has been tested with <code><a href="stats.html#topic+lm">stats::lm()</a></code>, <code><a href="stats.html#topic+glm">stats::glm()</a></code>,
<code><a href="nnet.html#topic+multinom">nnet::multinom()</a></code>, <code><a href="survey.html#topic+svyglm">survey::svyglm()</a></code> and <code><a href="survival.html#topic+coxph">survival::coxph()</a></code>.
It may be working with other types of models, but with no warranty.
</p>
<p>In some cases, it may be necessary to provide the full dataset initially
used to estimate the model.
</p>
<p><code>step_with_na()</code> may not work inside other functions. In that case, you
may try to pass <code>full_data</code> to the function.
</p>


<h3>Value</h3>

<p>The stepwise-selected model.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(42)
d &lt;- titanic |&gt;
  dplyr::mutate(
    Group = sample(
      c("a", "b", NA),
      dplyr::n(),
      replace = TRUE
    )
  )
mod &lt;- glm(as.factor(Survived) ~ ., data = d, family = binomial())
# step(mod) should produce an error
mod2 &lt;- step_with_na(mod)
mod2


## WITH SURVEY ---------------------------------------

library(survey)
ds &lt;- d |&gt;
  dplyr::mutate(Survived = as.factor(Survived)) |&gt;
  srvyr::as_survey()
mods &lt;- survey::svyglm(
  Survived ~ Class + Group + Sex,
  design = ds,
  family = quasibinomial()
)
mod2s &lt;- step_with_na(mods, design = ds)
mod2s

</code></pre>

<hr>
<h2 id='titanic'>Titanic data set in long format</h2><span id='topic+titanic'></span>

<h3>Description</h3>

<p>This <code>titanic</code> dataset is equivalent to
<code>datasets::Titanic |&gt; dplyr::as_tibble() |&gt; tidyr::uncount(n)</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>titanic
</code></pre>


<h3>Format</h3>

<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 2201 rows and 4 columns.
</p>


<h3>See Also</h3>

<p><a href="datasets.html#topic+Titanic">datasets::Titanic</a>
</p>

<hr>
<h2 id='unrowwise'>Remove row-wise grouping</h2><span id='topic+unrowwise'></span>

<h3>Description</h3>

<p>Remove row-wise grouping created with <code><a href="dplyr.html#topic+rowwise">dplyr::rowwise()</a></code> while preserving
any other grouping declared with <code><a href="dplyr.html#topic+group_by">dplyr::group_by()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>unrowwise(data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="unrowwise_+3A_data">data</code></td>
<td>
<p>A tibble.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>titanic |&gt; dplyr::rowwise()
titanic |&gt; dplyr::rowwise() |&gt; unrowwise()

titanic |&gt; dplyr::group_by(Sex, Class) |&gt; dplyr::rowwise()
titanic |&gt; dplyr::group_by(Sex, Class) |&gt; dplyr::rowwise() |&gt; unrowwise()
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
