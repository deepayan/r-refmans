<!DOCTYPE html><html lang="en"><head><title>Help for package CTNote</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {CTNote}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#collapse_lattice'><p>Combine Multiple Simple Study Design &quot;Lattices&quot;</p></a></li>
<li><a href='#count_matches'><p>Count Periods of Substance Use / Abstinence</p></a></li>
<li><a href='#detect_in_window'><p>Detect Visits before Matching a Fuzzy Sub-Pattern</p></a></li>
<li><a href='#detect_subpattern'><p>Detect a Consecutive Sub-Pattern</p></a></li>
<li><a href='#egOpioidsCTN0094'><p>Opioid Use by Study Day for Example CTN-0094 Participants</p></a></li>
<li><a href='#impute_missing_visits'><p>Naively Impute Missing Visits</p></a></li>
<li><a href='#measure_abstinence_period'><p>Measure the Length of the Longest Abstinent Period</p></a></li>
<li><a href='#measure_retention'><p>Measure Length of Use Pattern before Dropout</p></a></li>
<li><a href='#outcomesCTN0094'><p>All Treatment Outcomes for CTN-0094 Participants</p></a></li>
<li><a href='#recode_missing_visits'><p>Recode Missing or Ambiguous UDS in a Subject Use Pattern</p></a></li>
<li><a href='#view_by_lattice'><p>View a Pattern through a Study Design &quot;Lattice&quot;</p></a></li>
<li><a href='#weight_positive_visits'><p>Weight Visits in a Subject Use Pattern</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>CTN Outcomes, Treatments, and Endpoints</td>
</tr>
<tr>
<td>Description:</td>
<td>The Clinical Trials Network (CTN) of the U.S. National Institute
  of Drug Abuse sponsored the CTN-0094 research team to harmonize data sets
  from three nationally-representative clinical trials for opioid use disorder
  (OUD). The CTN-0094 team herein provides a coded collection of trial outcomes
  and endpoints used in various OUD clinical trials over the past 50 years.
  These coded outcome functions are used to contrast and cluster different
  clinical outcome functions based on daily or weekly patient urine screenings.
  Note that we abbreviate urine drug screen as "UDS" and urine opioid screen as
  "UOS". For the example data sets (based on clinical trials data harmonized by
  the CTN-0094 research team), UDS and UOS are largely interchangeable.</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.1</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.1.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>stringi, stringr</td>
</tr>
<tr>
<td>Suggests:</td>
<td>ape, kableExtra, knitr, readxl, rmarkdown, survival, testthat
(&ge; 3.0.0), tidyverse</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://ctn-0094.github.io/CTNote/">https://ctn-0094.github.io/CTNote/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/CTN-0094/CTNote/issues">https://github.com/CTN-0094/CTNote/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-10-01 16:46:55 UTC; gabrielodom</td>
</tr>
<tr>
<td>Author:</td>
<td>Gabriel Odom <a href="https://orcid.org/0000-0003-1341-4555"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Laura Brandt <a href="https://orcid.org/0000-0001-7551-221X"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Raymond Balise <a href="https://orcid.org/0000-0002-9856-5901"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Layla Bouzoubaa <a href="https://orcid.org/0000-0002-6616-0950"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Gabriel Odom &lt;gabriel.odom@fiu.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-10-03 07:30:04 UTC</td>
</tr>
</table>
<hr>
<h2 id='collapse_lattice'>Combine Multiple Simple Study Design &quot;Lattices&quot;</h2><span id='topic+collapse_lattice'></span>

<h3>Description</h3>

<p>Given a vector of simple study visits patterns, combine them
into a more complex study visit lattice
</p>


<h3>Usage</h3>

<pre><code class='language-R'>collapse_lattice(lattice_patterns, times)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="collapse_lattice_+3A_lattice_patterns">lattice_patterns</code></td>
<td>
<p>A character vector of simple study design lattices</p>
</td></tr>
<tr><td><code id="collapse_lattice_+3A_times">times</code></td>
<td>
<p>An integer vector indicating the number of times to repeat each
simple lattice. The length of the <code>times</code> argument should match the
length of the <code>lattice_patterns</code> argument.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function was designed to handle outcomes where the clinical
trial protocol has staggered or non-sequential visits. For example, if we
observed the pattern <code>"-ooo"</code>, in most cases we would interpret this
to mean that the subject was present in the clinic for the first visit, but
missed the next three visits. Some trial outcomes would then count the
three missing visits as all positive or as a relapse. However, this use
pattern could have been observed late during subject follow-up, during
which time the protocol could be that the subject was only required to
visit the clinic monthly (so long as the supplied UDS was negative).
</p>
<p>This function is basically a wrapper around the <code><a href="base.html#topic+paste0">paste0</a></code>
function with <code>collapse = ""</code>. We added support to repeat subpatterns.
</p>


<h3>Value</h3>

<p>The combined lattice pattern, built up from combinations of the
smaller lattices.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  
  # Example 1: a 16 week observation period with visits every 4 weeks:
  # "___o___o___o___o"
  collapse_lattice(
    lattice_patterns = "___o",
    times = 4
  )
  
  # Example 2: 24 week observation period with weekly visits for the first
  #   12 weeks, then monthly visits (during the second week) thereafter:
  # "oooooooooooo_o___o___o__"
  collapse_lattice(
    lattice_patterns = c("o", "_o__"),
    times = c(12, 3)
  )
  
  # Example 3: 6 week observation period with clinic visits on set days,
  #   M-W-F for the first 3 weeks, then Monday only for the next 3 weeks:
  # "o_o_o__o_o_o__o_o_o__o______o______o______"
  collapse_lattice(
    lattice_patterns = c("o_o_o__", "o______"),
    times = c(3, 3)
  )
  
  
</code></pre>

<hr>
<h2 id='count_matches'>Count Periods of Substance Use / Abstinence</h2><span id='topic+count_matches'></span>

<h3>Description</h3>

<p>Given a use pattern string, count the number of times that
pattern contains a certain substance use indicator
</p>


<h3>Usage</h3>

<pre><code class='language-R'>count_matches(
  use_pattern,
  match_is,
  start = 1,
  end = -1,
  mixed_results_are = NULL,
  mixed_weight = 0.5,
  proportion = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="count_matches_+3A_use_pattern">use_pattern</code></td>
<td>
<p>A character string showing the daily, by visit, or weekly
substance use pattern for a single subject</p>
</td></tr>
<tr><td><code id="count_matches_+3A_match_is">match_is</code></td>
<td>
<p>A single character value of the use indicator of interest;
e.g. <code>"+"</code> is use positive or <code>"-"</code> is use negative.</p>
</td></tr>
<tr><td><code id="count_matches_+3A_start">start</code></td>
<td>
<p>These two arguments give the integer range wherein to look for
the use sub-pattern of interest. Usually, start should be the week of
randomization. Defaults to 1.</p>
</td></tr>
<tr><td><code id="count_matches_+3A_end">end</code></td>
<td>
<p>The end of the detection range. This is often the end of followup
(denoted by -1, the default value, which represents the last item in the
string), or this could be a set number of weeks or visits, such as 12 weeks
or 48 visits.</p>
</td></tr>
<tr><td><code id="count_matches_+3A_mixed_results_are">mixed_results_are</code></td>
<td>
<p>A single character value indicating a partial use
week; e.g. <code>"*"</code> means that the subject had at least one positive and
at least one negative test of the substance(s) of interest for that week.
Defaults to <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="count_matches_+3A_mixed_weight">mixed_weight</code></td>
<td>
<p>A fraction showing the proportional use value for a
mixed result week. For example, some studies state that a positive UDS
counts as three days of use (3/7), while other studies regard a positive
UDS as five days of use (5/7). This value should be substance-specific,
but we default to 0.5.</p>
</td></tr>
<tr><td><code id="count_matches_+3A_proportion">proportion</code></td>
<td>
<p>Should this function return the count or proportion of
matching use periods? Defaults to <code>FALSE</code>, signifying that the count
of matches will be returned. Note that if the remaining string (after
trimming to the values of <code>start</code> and <code>end</code>) has length 0, then
this function will return 0 rather than NaN (0/0). When interpreting this
value, 0 represents that the subject had no use periods matching the chosen
outcome.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>At current, we allow for many symbols in the use pattern &quot;word&quot;,
such as &quot;_&quot; for missing by study design, &quot;o&quot; missing for protocol
non-compliance (the most common form of missing), &quot;+&quot; for positive, &quot;-&quot; for
negative, and &quot;*&quot; for mixed positive and negative results (this usually
comes up when the visit represents multiple days and there are both
positive and negative results in those days; for example, a subject is
tested weekly; they provided a positive test on Tuesday but came back to
provide a negative test the following day).
</p>


<h3>Value</h3>

<p>A single integer (real) value measuring the count (proportion) of the
use periods for which the subject had the substance use value of interest
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  # This pattern represents 26 weeks of treatment UDS
  pattern_char &lt;- "++++*o-------+--+-o-o-o+o+"
  
  # Replace any missing UDS ("o") with positive
  cleanPattern_char &lt;- recode_missing_visits(pattern_char)
  
  # Example: find the proportion of the subject's negative use weeks after
  #   randomization but before the end of a 12-week observation
  #   period
  count_matches(
    cleanPattern_char,
    match_is = "-",
    end = 12,
    mixed_results_are = "*",
    mixed_weight = 0.5,
    proportion = TRUE
  )
  
  # Example: find the number of times the subject used non-study opioids
  #   after being clean at least one week
  count_matches(
    cleanPattern_char,
    match_is = "-+"
  )
  
</code></pre>

<hr>
<h2 id='detect_in_window'>Detect Visits before Matching a Fuzzy Sub-Pattern</h2><span id='topic+detect_in_window'></span>

<h3>Description</h3>

<p>Given a use pattern string, use fuzzy logic to detect if a
sub-pattern of interest is present within a specified detection window and
how many visits are required to find said match.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>detect_in_window(
  use_pattern,
  window_width = 4L,
  threshold = 3L,
  offset = window_width - threshold,
  match_is = c("+", "o", "-")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="detect_in_window_+3A_use_pattern">use_pattern</code></td>
<td>
<p>A character string showing the daily, by visit, or weekly</p>
</td></tr>
<tr><td><code id="detect_in_window_+3A_window_width">window_width</code></td>
<td>
<p>How wide should the inspection window be? Defaults to
four visits.</p>
</td></tr>
<tr><td><code id="detect_in_window_+3A_threshold">threshold</code></td>
<td>
<p>How many successes or failures are required within the
specified window? Defaults to three.</p>
</td></tr>
<tr><td><code id="detect_in_window_+3A_offset">offset</code></td>
<td>
<p>In the case of an event, where in the detection window should
the event time be recorded? Defaults to <code>window_width - threshold</code>;
that is, the start of the actual pattern. Another option would be 0, which
indicates that the event should be recorded at the start of the window in
which it was detected.</p>
</td></tr>
<tr><td><code id="detect_in_window_+3A_match_is">match_is</code></td>
<td>
<p>What constitutes the outcome of interest? <code>"+"</code>
represents positive UDS as the visit event of interest, <code>"-"</code> is
negative, and <code>"o"</code> means that the subject did not provide a valid UDS
during the time period in question.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function can be used to calculate time-to-event (survival)
metrics for the subjects in treatment. For example, the default arguments
represent a definition of relapse (&quot;three or more positive UDS within a
four-week window&quot;). Thus, the output of this function under default values
would be time until first relapse and a relapse indicator.
</p>
<p>Concerning the <code>offset</code> argument: take, for example, the use pattern
<code>"-------++++"</code>. The subject began to use the substance(s) of interest
by week 8. If our relapse definition was to detect 4 weeks of use in a 4
week window, then the relapse time would be recorded at week 8. Similarly,
we would expect that if our relapse definition was to detect 2 or 3 weeks
of use in a 4 week window, that the relapse time would also be week 8. This
is why the default value of the <code>offset</code> argument is what it is: we
&quot;shift&quot; the detection of the use until the start of the use. However, if
you see the pattern above and believe that the relapse should be recorded
at week 7 for relapse defined as 3 weeks of use in a 4-week window or at
week 6 for 2 weeks of use in a 4-week window, then set <code>offset = 0</code>.
</p>
<p>Defining the use symbols: at current, we allow for many symbols in the use
pattern &quot;word&quot;, such as &quot;_&quot; for missing by study design, &quot;o&quot; missing for
protocol non-compliance (the most common form of missing), &quot;+&quot; for
positive, &quot;-&quot; for negative, and &quot;*&quot; for mixed positive and negative results
(this usually comes up when the visit represents multiple days and there
are both positive and negative results in those days; for example, a
subject is tested weekly; they provided a positive test on Tuesday but came
back to provide a negative test the following day).
</p>


<h3>Value</h3>

<p>A two column data frame with (a) column <code>time</code> representing the
number of visits until the first window with a match is detected and (b)
column <code>event</code> indicating if the match occurs in any window of the use
pattern.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  # Find the first relapse event
  detect_in_window("o-o+++")
  
  # Find the start of the window that contains the first relapse event
  detect_in_window("o-o+++", offset = 0)
  
  # Find the first positive UDS
  detect_in_window("o-o+++", window_width = 1L, threshold = 1L)
  
</code></pre>

<hr>
<h2 id='detect_subpattern'>Detect a Consecutive Sub-Pattern</h2><span id='topic+detect_subpattern'></span>

<h3>Description</h3>

<p>Given a use pattern string, detect if that pattern contains a
consecutive sub-pattern of interest
</p>


<h3>Usage</h3>

<pre><code class='language-R'>detect_subpattern(use_pattern, subpattern, start = 1, end = -1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="detect_subpattern_+3A_use_pattern">use_pattern</code></td>
<td>
<p>A character string showing the daily, by visit, or weekly
substance use pattern for a single subject</p>
</td></tr>
<tr><td><code id="detect_subpattern_+3A_subpattern">subpattern</code></td>
<td>
<p>A character string containing the sub-pattern of interest.
For example, if study dropout is seven consecutive missing UDS, then the
sub-pattern would be &quot;ooooooo&quot;.</p>
</td></tr>
<tr><td><code id="detect_subpattern_+3A_start">start</code></td>
<td>
<p>These two arguments give the integer range wherein to look for
the use sub-pattern of interest. Usually, start should be the week of
randomization. Defaults to 1.</p>
</td></tr>
<tr><td><code id="detect_subpattern_+3A_end">end</code></td>
<td>
<p>The end of the detection range. This is often the end of followup
(denoted by -1, the default value, which represents the last item in the
string), or this could be a set number of weeks or visits, such as 12 weeks
or 48 visits.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function can be used to detect consecutive periods of drug
abstinence, drug use, or study non-compliance (as measured by failure to
supply urine). For example, to detect if the subject had three consecutive
use weeks, the sub-pattern would be set to <code>"+++"</code>.
</p>
<p>At current, we allow for many symbols in the use pattern &quot;word&quot;, such as
&quot;_&quot; for missing by study design, &quot;o&quot; missing for protocol non-compliance
(the most common form of missing), &quot;+&quot; for positive, &quot;-&quot; for negative, and
&quot;*&quot; for mixed positive and negative results (this usually comes up when the
visit represents multiple days and there are both positive and negative
results in those days; for example, a subject is tested weekly; they
provided a positive test on Tuesday but came back to provide a negative
test the following day).
</p>


<h3>Value</h3>

<p>A single logical value indicating if the use subpattern is present in
the overall use pattern string
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  # This pattern represents 26 weeks of treatment UDS
  pattern_char &lt;- "+++++o-------+--+-o-o-o+o+"
  
  # Replace any missing UDS ("o") with positive
  cleanPattern_char &lt;- recode_missing_visits(pattern_char)
  
  # Example: detect if the subject was able to stay clean for at least 4
  #   weeks after randomization but before the end of a 12-week observation
  #   period
  detect_subpattern(
    cleanPattern_char,
    subpattern = "----",
    end = 12
  )
  
  # Example: detect if the subject was abstinent during the last 3 weeks
  detect_subpattern(
    cleanPattern_char,
    subpattern = "---",
    start = -3, 
    end = -1
  )
  
</code></pre>

<hr>
<h2 id='egOpioidsCTN0094'>Opioid Use by Study Day for Example CTN-0094 Participants</h2><span id='topic+egOpioidsCTN0094'></span>

<h3>Description</h3>

<p>This data set is a table with daily positive opioid use
indicator for 10 participants from the CTN-0094 harmonized data sets. This
subset is to be used as an example of timeline-style opioid use data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(egOpioidsCTN0094)
</code></pre>


<h3>Format</h3>

<p>A tibble with 71 rows and
3 columns. These columns include
</p>

<dl>
<dt>who</dt><dd><p>Patient ID</p>
</dd>
<dt>what</dt><dd><p>A factor indicating what substance(s) were present in the
urine on day <code>when</code>; trivially, all substances are &quot;opioids&quot; for this
example data.</p>
</dd>
<dt>when</dt><dd><p>The number of days since signed study consent</p>
</dd>
</dl>



<h3>Details</h3>

<p>This data is created in the script
<code>inst/scripts/create_allDrugs_opioid_subset_20220916.R</code>. The &quot;when&quot; column
measures the number of days after signed consent for the participant that
the opioid-positive urine screen was collected.
</p>

<hr>
<h2 id='impute_missing_visits'>Naively Impute Missing Visits</h2><span id='topic+impute_missing_visits'></span>

<h3>Description</h3>

<p>Given a use pattern string with missing visits, make naive
imputations for each missing visit
</p>


<h3>Usage</h3>

<pre><code class='language-R'>impute_missing_visits(
  use_pattern,
  method = c("locf", "locfD", "mode", "kNV"),
  missing_is = "o",
  mixed_is = "*",
  tiebreaker = "+",
  k = 1,
  knvWeights_num = c(o = NA, `+` = 1, `*` = 0.5, `-` = 0),
  quietly = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="impute_missing_visits_+3A_use_pattern">use_pattern</code></td>
<td>
<p>A character string showing the daily, by visit, or weekly
substance use pattern for a single subject</p>
</td></tr>
<tr><td><code id="impute_missing_visits_+3A_method">method</code></td>
<td>
<p>Which naive imputation method should be used? Current supported
options are <code>"locf"</code> (last observation carried forward),
<code>"locfD"</code> (last observation carried forward until dropout),
<code>"mode"</code> (most common non-missing value), and <code>"kNV"</code> (k nearest
visits).</p>
</td></tr>
<tr><td><code id="impute_missing_visits_+3A_missing_is">missing_is</code></td>
<td>
<p>Which single character is used to mark missing UDS in a
use pattern string? Defaults to <code>"o"</code>.</p>
</td></tr>
<tr><td><code id="impute_missing_visits_+3A_mixed_is">mixed_is</code></td>
<td>
<p>Which single character is used to mark mixed UDS (both
positive and negative UDS for the visit block) in a use pattern string?
Defaults to <code>"*"</code>. When imputing by the mode, all mixed result UDS
will be assigned the <code>tiebreaker</code> value in order to calculate the mode
but will remain unchanged in the returned use pattern string.</p>
</td></tr>
<tr><td><code id="impute_missing_visits_+3A_tiebreaker">tiebreaker</code></td>
<td>
<p>In the event of ties between two modes, should positive or
negative UDS be the mode? Defaults to positive (<code>"+"</code>).</p>
</td></tr>
<tr><td><code id="impute_missing_visits_+3A_k">k</code></td>
<td>
<p>The number of nearest visits to use in kNV imputation. This defaults
to 1; we recommend that this parameter stays at 1 unless the use patterns
in your data have extraordinarily few missing values.</p>
</td></tr>
<tr><td><code id="impute_missing_visits_+3A_knvweights_num">knvWeights_num</code></td>
<td>
<p>A named vector matching the use pattern word &quot;letters&quot;
to their numerical use values. The names of this vector should match the
&quot;letters&quot; of the use pattern word exactly; use backticks to escape special
characters. For example, if the study protocol counts a mixed result (one
positive and one negative UDS in a single observation period [week]) as
worth three &quot;use days&quot;, then mixed results should have a  weight of 3/7.
Additionally, a study protocol may count missing values as five &quot;use days&quot;
out of a week. The defaults for this function are to leave <code>"o"</code> as
missing (<code>NA</code>), and give weights of 1, 1/2, and 0 for visits with
<code>"+"</code>, <code>"*"</code>, and <code>"-"</code> UDS, respectively.</p>
</td></tr>
<tr><td><code id="impute_missing_visits_+3A_quietly">quietly</code></td>
<td>
<p>Should warning messages be muted? Defaults to <code>FALSE</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>If you would like to replace all UDS for missing visits with a
single, pre-specified value (such as positive), please use
<code><a href="#topic+recode_missing_visits">recode_missing_visits</a></code> instead. Furthermore, there will most
likely still be missing values in the use pattern even after imputation.
This would occur if all the values are missing, if the first values of the
use pattern are missing (if LOCF is used), if the first and/or last values
of the use pattern are missing (if LOCF-D is used), or if there are back to
back missing visits (if kNV with <code>k = 1</code> is used). Because of this,
you may need to call <code><a href="#topic+recode_missing_visits">recode_missing_visits</a></code> in a pipeline
after this function to replace or remove the remaining non-imputable
missing visits.
</p>
<p>If you are using the kNV imputation option, there are some caveats to
consider. Due to rounding rules, any rounding ties are broken by order of
the values to the <code>knvWeights_num</code> vector. For instance, consider a
subject who had a negative UDS in one week, then a missing UDS for the next
week, and then two UDS in the following week (of which one was positive and
the other was negative). This is represented by the use pattern
<code>"-o*"</code>. The default behavior of the kNV method is to impute this to
<code>"-**"</code> because the order of the <code>knvWeights_num</code> vector has
<code>"+"</code>, then <code>"*"</code>, then <code>"-"</code> UDS values. In this order, a
positive result trumps a mixed result, and a mixed result trumps a negative
result. Similarly, the use pattern <code>"+o*"</code> will be imputed to
<code>"++*"</code> by default.
</p>
<p>At current, we allow for many symbols in the use pattern &quot;word&quot;, such as
&quot;_&quot; for missing by study design, &quot;o&quot; missing for protocol non-compliance
(the most common form of missing), &quot;+&quot; for positive, &quot;-&quot; for negative, and
&quot;*&quot; for mixed positive and negative results (this usually comes up when the
visit represents multiple days and there are both positive and negative
results in those days; for example, a subject is tested weekly; they
provided a positive test on Tuesday but came back to provide a negative
test the following day).
</p>


<h3>Value</h3>

<p>A use pattern string the same length as <code>use_pattern</code> with
missing values imputed according to the chosen imputation method.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  pattern_char &lt;- "__++++*o-------+--+-o-o-o+o+oooooo"
  impute_missing_visits(pattern_char)
  impute_missing_visits(pattern_char, method = "locfD")
  impute_missing_visits(pattern_char, method = "mode")
  
  pattern2_char &lt;- "ooooooooooo"
  impute_missing_visits(pattern2_char)
  
</code></pre>

<hr>
<h2 id='measure_abstinence_period'>Measure the Length of the Longest Abstinent Period</h2><span id='topic+measure_abstinence_period'></span>

<h3>Description</h3>

<p>Find the longest number of sequential visits in the pattern with
negative UDS
</p>


<h3>Usage</h3>

<pre><code class='language-R'>measure_abstinence_period(use_pattern_binary, use_is = "+")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="measure_abstinence_period_+3A_use_pattern_binary">use_pattern_binary</code></td>
<td>
<p>A character string showing the daily, by visit, or
weekly substance use pattern for a single subject, recoded to binary use
or abstinence indicators.</p>
</td></tr>
<tr><td><code id="measure_abstinence_period_+3A_use_is">use_is</code></td>
<td>
<p>Which single character is used to mark positive UDS in the
use pattern string? Defaults to <code>"+"</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The use pattern MUST be in binary code for this function to work.
For use patterns coded in our default language (see the &quot;dictionary&quot; in the
Details section for <code><a href="#topic+measure_retention">measure_retention</a></code>), the binary form would
have all &quot;_&quot; (missing by study protocol) visits replaced with &quot;-&quot; and all
&quot;o&quot; (missing for non-compliance) and &quot;*&quot; (mixed positive and negative)
visits replaced with &quot;+&quot;. See the example below.
</p>


<h3>Value</h3>

<p>An integer measuring the longest number of sequential visits for
which the subject was abstinent from the substance(s) of interest. If the
subject's entire use pattern is missing, then this will be 0.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  pattern_char &lt;- "__++++*o-------+--+-o-o-o+o+oooooo"
  
  # replace "_" with "-"
  pattern2_char &lt;- recode_missing_visits(
    pattern_char,
    missing_is = "_",
    missing_becomes = "-"
  )
  # replace "o" with "+"
  pattern3_char &lt;- recode_missing_visits(pattern2_char)
  # replace "*" with "+"
  pattern4_char &lt;- recode_missing_visits(pattern3_char, missing_is = "*")
  
  measure_abstinence_period(pattern4_char)
  
</code></pre>

<hr>
<h2 id='measure_retention'>Measure Length of Use Pattern before Dropout</h2><span id='topic+measure_retention'></span>

<h3>Description</h3>

<p>Find the number of visits in the pattern until the last subject
contact
</p>


<h3>Usage</h3>

<pre><code class='language-R'>measure_retention(use_pattern, missing_is = "o")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="measure_retention_+3A_use_pattern">use_pattern</code></td>
<td>
<p>A character string showing the daily, by visit, or weekly
substance use pattern for a single subject</p>
</td></tr>
<tr><td><code id="measure_retention_+3A_missing_is">missing_is</code></td>
<td>
<p>Which single character is used to mark missing UDS in a
use pattern string? Defaults to <code>"o"</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>At current, we allow for many symbols in the use pattern &quot;word&quot;,
such as &quot;_&quot; for missing by study design, &quot;o&quot; missing for protocol
non-compliance (the most common form of missing), &quot;+&quot; for positive, &quot;-&quot; for
negative, and &quot;*&quot; for mixed positive and negative results (this usually
comes up when the visit represents multiple days and there are both
positive and negative results in those days; for example, a subject is
tested weekly; they provided a positive test on Tuesday but came back to
provide a negative test the following day).
</p>


<h3>Value</h3>

<p>An integer measuring the number of visits before the subject was lost
to follow-up. If the subject's entire use pattern is missing, then this
will be 0.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  pattern_char &lt;- "__++++*o-------+--+-o-o-o+o+oooooo"
  measure_retention(pattern_char)
  
  pattern2_char &lt;- "ooooooooooo"
  measure_retention(pattern2_char)
  
</code></pre>

<hr>
<h2 id='outcomesCTN0094'>All Treatment Outcomes for CTN-0094 Participants</h2><span id='topic+outcomesCTN0094'></span>

<h3>Description</h3>

<p>This data set is a table of 53 treatment outcomes calculated on
3560 participants from three clinical trials to assess the efficacy of
medication-assisted treatment for opioid use disorder.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(outcomesCTN0094)
</code></pre>


<h3>Format</h3>

<p>A tibble with 3,560 rows and
63 columns. These columns include
</p>

<dl>
<dt>who</dt><dd><p>Patient ID</p>
</dd>
<dt>usePatternUDS</dt><dd><p>A character string containing the &quot;use pattern
word&quot;, which represents the weekly opioid use for each participant
after their day of randomization. For more information, see
<code>link[ctn0094DataExtra]{derived_weeklyOpioidPattern}</code></p>
</dd>
<dt>...</dt><dd><p>The calculated treatment outcomes for 53 endpoints. Some
endpoints are composites of &quot;time to event&quot; and an &quot;event&quot; indicator,
but these are included as two separate columns and are named <code style="white-space: pre;">&#8288;*_time&#8288;</code>
and <code style="white-space: pre;">&#8288;*_event&#8288;</code>, respectively.</p>
</dd>
</dl>



<h3>Details</h3>

<p>These outcomes are based on a harmonized set of data from three
clinical trials. The harmonized data from these trials are contained in
the packages <code>ctn0094data</code> and <code>ctn0094DataExtra</code>. These outcomes are
calculated in the three abstinence, relapse, and reduction &quot;library&quot;
vignettes of this package. The data dictionary is currently stored as an
Excel spreadsheet in <code>inst/suppl_docs/definitions_20220405.xlsx</code>.
</p>

<hr>
<h2 id='recode_missing_visits'>Recode Missing or Ambiguous UDS in a Subject Use Pattern</h2><span id='topic+recode_missing_visits'></span>

<h3>Description</h3>

<p>Replace all missing UDS <code>"o"</code> in a use pattern string
</p>


<h3>Usage</h3>

<pre><code class='language-R'>recode_missing_visits(
  use_pattern,
  missing_is = "o",
  missing_becomes = c("+", "", "-")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="recode_missing_visits_+3A_use_pattern">use_pattern</code></td>
<td>
<p>A character string showing the daily, by visit, or weekly
substance use pattern for a single subject</p>
</td></tr>
<tr><td><code id="recode_missing_visits_+3A_missing_is">missing_is</code></td>
<td>
<p>Which single character is used to mark missing UDS in a
use pattern string? Defaults to <code>"o"</code>.</p>
</td></tr>
<tr><td><code id="recode_missing_visits_+3A_missing_becomes">missing_becomes</code></td>
<td>
<p>How should missing UDS be treated? Defaults to marking
the subject as positive for that missing period. Options are <code>"+"</code> for
positive, <code>""</code> for ignore, or <code>"-"</code> for negative (note that this
last option should only be used in case where the &quot;missing&quot; UDS is a
regular and expected artefact of the study design and the preceding and
following UDS are both negative).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>At current, we allow for many symbols in the use pattern &quot;word&quot;,
such as &quot;_&quot; for missing by study design, &quot;o&quot; missing for protocol
non-compliance (the most common form of missing), &quot;+&quot; for positive, &quot;-&quot; for
negative, and &quot;*&quot; for mixed positive and negative results (this usually
comes up when the visit represents multiple days and there are both
positive and negative results in those days; for example, a subject is
tested weekly; they provided a positive test on Tuesday but came back to
provide a negative test the following day).
</p>


<h3>Value</h3>

<p>A character string with all missing UDS values (marked as <code>"o"</code>
unless a different value is supplied to <code>missing_is</code>) replaces by the
value supplied to <code>missing_becomes</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  pattern_char &lt;- "__++++*o-------+--+-o-o-o+o+"
  
  # Default: change all missing weeks to positive
  recode_missing_visits(pattern_char)
  
  # Other example: remove all weeks with no UDS by design
  recode_missing_visits(pattern_char, missing_is = "_", missing_becomes = "")
  
</code></pre>

<hr>
<h2 id='view_by_lattice'>View a Pattern through a Study Design &quot;Lattice&quot;</h2><span id='topic+view_by_lattice'></span>

<h3>Description</h3>

<p>Given a use pattern string and the pattern of study visits,
view only the use pattern string components which are congruent with the
study design
</p>


<h3>Usage</h3>

<pre><code class='language-R'>view_by_lattice(
  use_pattern,
  lattice_pattern,
  visit_is = "o",
  no_visit_is = "_"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="view_by_lattice_+3A_use_pattern">use_pattern</code></td>
<td>
<p>A character string showing the daily, by visit, or weekly
substance use pattern for a single subject</p>
</td></tr>
<tr><td><code id="view_by_lattice_+3A_lattice_pattern">lattice_pattern</code></td>
<td>
<p>A character string containing the study design for
subject visits. For example, a study design with required visits on Monday,
Wednesday, and Friday would have the lattice pattern <code>"o_o_o__"</code>,
where <code>"o"</code> represents a day wherein the subject should visit the
clinic (per study protocol) and <code>"_"</code> represents the other non-visit
days. These symbols are set by <code>visit_is</code> and <code>no_visit_is</code>,
respectively.</p>
</td></tr>
<tr><td><code id="view_by_lattice_+3A_visit_is">visit_is</code></td>
<td>
<p>Symbol indicating that the subject should appear in the
clinic for that time period, as dictated by the study protocol. Defaults to
<code>"o"</code> (because the outcome of the UDS will be unknown before the study
has been designed).</p>
</td></tr>
<tr><td><code id="view_by_lattice_+3A_no_visit_is">no_visit_is</code></td>
<td>
<p>Symbol indicating that the subject is not required to
appear in the clinic for that time period, as dictated by the study
protocol. Defaults to <code>"_"</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function was designed to handle outcomes where the clinical
trial protocol has staggered or non-sequential visits. For example, if we
observed the pattern <code>"-ooo"</code>, in most cases we would interpret this
to mean that the subject was present in the clinic for the first visit, but
missed the next three visits. Some trial outcomes would then count the
three missing visits as all positive or as a relapse. However, this use
pattern could have been observed late during subject follow-up, during
which time the protocol could be that the subject was only required to
visit the clinic monthly (so long as the supplied UDS was negative).
</p>
<p>Many lattice patterns can be easily constructed by using the function
<code><a href="#topic+collapse_lattice">collapse_lattice</a></code>. For example, to repeat the
&quot;Monday-Wednesday-Friday&quot; visit pattern noted above 4 times, you can use
<code>collapse_lattice("o_o_o__", 4)</code> to create a vector of weekly visit
patterns, then collapse (concatenate) them all together. More complex visit
patterns can be constructed in a similar manner: first create a vector of
simple repeating visit patterns, then collapse them all together, setting
the number of repeats with the <code>times</code> argument.
</p>
<p>At current, this package allows for many symbols in the use pattern &quot;word&quot;,
such as &quot;_&quot; for missing by study design, &quot;o&quot; missing for protocol
non-compliance (the most common form of missing), &quot;+&quot; for positive, &quot;-&quot; for
negative, and &quot;*&quot; for mixed positive and negative results (this usually
comes up when the visit represents multiple days and there are both
positive and negative results in those days; for example, a subject is
tested weekly; they provided a positive test on Tuesday but came back to
provide a negative test the following day).
</p>


<h3>Value</h3>

<p>A variant of <code>use_pattern</code>, but with all non-protocol visits set
to <code>"_"</code>. In most cases, this use pattern vector would be then passed
to <code><a href="#topic+impute_missing_visits">impute_missing_visits</a></code> so that the <code>"_"</code> visits could
be replaced with the last observed UDS. See the Examples below.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  # This pattern represents 26 weeks of treatment UDS
  pattern_char  &lt;- "+++++o-------+--+-o-o-o+o+"
  pattern2_char &lt;- recode_missing_visits(pattern_char)
  
  # Example 1: a 16 week observation period with visits every 4 weeks
  lattice1_char &lt;- "___o___o___o___o"
  useLattice1_char &lt;- view_by_lattice(
    use_pattern = pattern2_char,
    lattice_pattern = lattice1_char
  )
  useLattice1_char
  impute_missing_visits(useLattice1_char, method = "locf", missing_is = "_")
  
  # Example 2: 24 week observation period with weekly visits for the first
  #   12 weeks, then monthly visits (during the second week) thereafter
  lattice2_char &lt;- "oooooooooooo_o___o___o__"
  useLattice2_char &lt;- view_by_lattice(
    use_pattern = pattern2_char,
    lattice_pattern = lattice2_char
  )
  useLattice2_char
  impute_missing_visits(useLattice2_char, method = "locf", missing_is = "_")
     
</code></pre>

<hr>
<h2 id='weight_positive_visits'>Weight Visits in a Subject Use Pattern</h2><span id='topic+weight_positive_visits'></span>

<h3>Description</h3>

<p>Add numeric weights to a use pattern string
</p>


<h3>Usage</h3>

<pre><code class='language-R'>weight_positive_visits(
  use_pattern,
  weights_num = c(`+` = 1, `*` = 0.5, o = 0.22, `-` = 0),
  posPenalty_num = NULL,
  missPenalty_num = NULL,
  scaleMax = 120L,
  scale = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="weight_positive_visits_+3A_use_pattern">use_pattern</code></td>
<td>
<p>A character string showing the daily, by visit, or weekly
substance use pattern for a single subject</p>
</td></tr>
<tr><td><code id="weight_positive_visits_+3A_weights_num">weights_num</code></td>
<td>
<p>A named numeric vector mapping the symbols in the use
pattern to non-negative numeric values. The default values, 1 for positive
UDS (<code>"+"</code>), 0.22 for missing UDS (<code>"o"</code>), and 0 for negative UDS
(<code>"-"</code>), are the values set in Ling et al. (1976); see the &quot;Details&quot;
section for more information. The default value for a mixed weekly result
(<code>"*"</code>: at least one positive and at least one negative UDS in a
single week) is the average of a positive and negative weight (0.5 by
default).</p>
</td></tr>
<tr><td><code id="weight_positive_visits_+3A_pospenalty_num">posPenalty_num</code></td>
<td>
<p>A numeric vector showing the penalty for having a
positive or mixed UDS (<code>"+"</code> or <code>"*"</code>) at each week in the use
pattern. Defaults to <code>NULL</code>, implying that a positive UDS should have
the same weight at any week in the pattern. One other useful option would
be to set the weights to increase along the length of the study protocol,
so that the penalty for having a positive UDS is grows larger the longer a
participant is in treatment. See the Examples for more information.</p>
</td></tr>
<tr><td><code id="weight_positive_visits_+3A_misspenalty_num">missPenalty_num</code></td>
<td>
<p>A numeric vector showing the penalty for having a
missing UDS (<code>"o"</code>) at each week in the use pattern. Defaults to
<code>NULL</code>, implying that a missing UDS should have the same weight at any
week in the pattern. One other useful option would be to set the weights to
decrease along the length of the study protocol, so that the penalty for
missing a clinic visit grows smaller the longer a participant has continued
in treatment.</p>
</td></tr>
<tr><td><code id="weight_positive_visits_+3A_scalemax">scaleMax</code></td>
<td>
<p>Standardize the score to which maximum? Defaults to 120 to
match the scoring scale in Ling et al. (1976). See &quot;Details&quot; for more.</p>
</td></tr>
<tr><td><code id="weight_positive_visits_+3A_scale">scale</code></td>
<td>
<p>Scale the resulting score to a standard maximum (given by the
<code>scaleMax</code> argument). This defaults to <code>TRUE</code>; this should not be
changed unless you are a developer and you are trying to debug your code.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function exists to code the treatment outcome defined in Ling
et al. (1976): <a href="https://doi.org/10.1001/archpsyc.1976.01770060043007">doi:10.1001/archpsyc.1976.01770060043007</a>. This definition
requires other CTNote:: functions as well, but this function was written
specifically for that definition.
</p>
<p>The <code>weights_num</code> argument is the static &quot;penalty&quot; for positive and
missing UDS values; this will not change over the protocol weeks. These
values are then multiplied by the penalty vectors (<code>posPenalty_num</code>
and <code>missPenalty_num</code>).
</p>


<h3>Value</h3>

<p>A numeric value: the results of the sum of all the visit weight
values for the use pattern
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  pattern_char &lt;- "++o+*-------+--+-o-o-o+o+"
  
  
  ###  Defaults  ###
  # See how the weights map to the symbols (DO NOT use in practice)
  weight_positive_visits(pattern_char, scale = FALSE)
  
  # Score this use pattern via default settings
  weight_positive_visits(pattern_char)
  
  
  ###  Increase Static Weight of Missing UDS  ###
  # Because the score for a missing UDS from the Ling et al. (1976) paper was
  #   an estimated value from their data, other weights may better represent
  #   modern addiction behavior patterns. For instance, we believe that 
  #   missing UDS values may be worse than a positive UDS in some instances,
  #   because they indicate that the subject is no longer participating in 
  #   treatment at all. We then should change the static weights to reflect
  #   this.
  weight_positive_visits(
    pattern_char,
    weights_num = c(`+` = 0.8, `*` = 0.4, `o` = 1, `-` = 0)
  )
  
  
  ###  Increasing Positive UDS Penalty  ###
  # Score this use pattern using an increasing positive UDS penalty (similar
  #   to that shown in Lint et al. (1976))
  newPosPenal_num &lt;- seq(
    from = 1, to  = 5, 
    length = stringr::str_length(pattern_char)
  )
  weight_positive_visits(pattern_char, posPenalty_num = newPosPenal_num)
  
  
  ###  Variable Missing UDS Penalty  ###
  # Score this use pattern using a step-down missing UDS penalty (based on
  #   the idea that missing values during the treatment induction period are
  #   much worse than missing any other time in the study)
  newMissPenal_num &lt;- rep(1, stringr::str_length(pattern_char))
  newMissPenal_num[1:4] &lt;- 3
  weight_positive_visits(pattern_char, missPenalty_num = newMissPenal_num)
  
  
  ###  Composite Penalties  ###
  # Score this use pattern with both increasing positive UDS and step-down
  #   missing UDS penalties, while adjusting the weights.
  weight_positive_visits(
    pattern_char,
    weights_num = c(`+` = 0.8, `*` = 0.4, `o` = 1, `-` = 0),
    posPenalty_num = newPosPenal_num,
    missPenalty_num = newMissPenal_num
  )
  
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
