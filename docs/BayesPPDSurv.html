<!DOCTYPE html><html lang="en"><head><title>Help for package BayesPPDSurv</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {BayesPPDSurv}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#BayesPPDSurv-package'><p>Bayesian sample size determination using the power and normalized power prior for survival data</p></a></li>
<li><a href='#approximate.prior.beta'><p>Approximating the normalized power prior for <code class="reqn">\beta</code> for the proportional hazards model with piecewise constant hazard and random a0</p></a></li>
<li><a href='#melanoma'><p>Melanoma Clinical Trials E1684 and E1690</p></a></li>
<li><a href='#phm.fixed.a0'><p>Model fitting for the proportional hazards model with piecewise constant hazard and fixed a0</p></a></li>
<li><a href='#phm.random.a0'><p>Model fitting for the proportional hazards model with piecewise constant hazard and random a0</p></a></li>
<li><a href='#power.phm.fixed.a0'><p>Power/type I error calculation for the proportional hazards model with piecewise constant hazard and fixed a0</p></a></li>
<li><a href='#power.phm.random.a0'><p>Power/type I error calculation for the proportional hazards model with piecewise constant hazard and random a0</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Bayesian Power Prior Design for Survival Data</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.3</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-04-08</td>
</tr>
<tr>
<td>Description:</td>
<td>Bayesian power/type I error calculation and model fitting using 
  the power prior and the normalized power prior for proportional hazards models
  with piecewise constant hazard. The methodology and examples of 
  applying the package are detailed in &lt;<a href="https://doi.org/10.48550%2FarXiv.2404.05118">doi:10.48550/arXiv.2404.05118</a>&gt;.
  The Bayesian clinical trial design methodology is described in 
  Chen et al. (2011) &lt;<a href="https://doi.org/10.1111%2Fj.1541-0420.2011.01561.x">doi:10.1111/j.1541-0420.2011.01561.x</a>&gt;, 
  and Psioda and Ibrahim (2019) &lt;<a href="https://doi.org/10.1093%2Fbiostatistics%2Fkxy009">doi:10.1093/biostatistics/kxy009</a>&gt;. 
  The proportional hazards model with piecewise constant hazard is detailed in 
  Ibrahim et al. (2001) &lt;<a href="https://doi.org/10.1007%2F978-1-4757-3447-8">doi:10.1007/978-1-4757-3447-8</a>&gt;. </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.1</td>
</tr>
<tr>
<td>Imports:</td>
<td>Rcpp, dplyr, tidyr</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo, RcppDist</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-04-09 17:35:03 UTC; angie</td>
</tr>
<tr>
<td>Author:</td>
<td>Yueqi Shen [aut, cre],
  Matthew A. Psioda [aut],
  Joseph G. Ibrahim [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Yueqi Shen &lt;ys137@live.unc.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-04-09 17:50:04 UTC</td>
</tr>
</table>
<hr>
<h2 id='BayesPPDSurv-package'>Bayesian sample size determination using the power and normalized power prior for survival data</h2><span id='topic+BayesPPDSurv-package'></span>

<h3>Description</h3>

<p>The <span class="pkg">BayesPPDSurv</span> (Bayesian Power Prior Design for Survival Data) package provides two categories of functions:
functions for Bayesian power/type I error calculation and functions for model fitting.
</p>


<h3>References</h3>

<p>Ibrahim, J. G., Chen, M.-H. and Sinha, D. (2001). Bayesian Survival Analysis. New York: Springer Science &amp; Business Media.
</p>
<p>Psioda, M. A. and Ibrahim, J. G. (2019). Bayesian clinical trial design using historical data that inform the treatment effect. Biostatistics 20, 400–415.
</p>
<p>Shen, Y., Psioda, M. A., and Joseph, J. G. (2023). BayesPPD: an R package for Bayesian sample size determination using the power and normalized power prior for generalized linear models. The R Journal, 14(4).
</p>

<hr>
<h2 id='approximate.prior.beta'>Approximating the normalized power prior for <code class="reqn">\beta</code> for the proportional hazards model with piecewise constant hazard and random a0</h2><span id='topic+approximate.prior.beta'></span>

<h3>Description</h3>

<p>Approximation of the normalized power prior for <code class="reqn">\beta</code> for the proportional hazards model with piecewise constant hazard and random <code class="reqn">a_0</code>.
The function returns discrete samples of <code class="reqn">\beta</code> from the normalized power prior, and the user can use any mixture of multivariate normal distributions as an
approximation for the normalized power prior for <code class="reqn">\beta</code>.
This function is used to produce <code>prior.beta.mvn</code> in the function <code><a href="#topic+power.phm.random.a0">power.phm.random.a0</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>approximate.prior.beta(
  historical,
  n.intervals,
  change.points = NULL,
  prior.a0.shape1 = rep(1, 10),
  prior.a0.shape2 = rep(1, 10),
  prior.beta.mean = rep(0, 50),
  prior.beta.sd = rep(1000, 50),
  prior.lambda0.hp1 = rep(10^(-5), 50),
  prior.lambda0.hp2 = rep(10^(-5), 50),
  lower.limits = rep(-100, 50),
  upper.limits = rep(100, 50),
  slice.widths = rep(0.1, 50),
  nMC = 10000,
  nBI = 250
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="approximate.prior.beta_+3A_historical">historical</code></td>
<td>
<p>List of historical dataset(s). East historical dataset is stored in a list which contains four <em>named</em> elements: <code>time</code>, <code>event</code>, <code>X</code> and <code>S</code>.
</p>

<ul>
<li> <p><code>time</code> is a vector of follow up times.
</p>
</li>
<li> <p><code>event</code> is a vector of status indicators. Normally 0=alive and 1=dead.
</p>
</li>
<li> <p><code>X</code> is a matrix of covariates. The first column must be the treatment indicator.
</p>
</li>
<li> <p><code>S</code> is a vector of integers, where each integer represents the stratum that the subject belongs to. For example, if there are three strata, S can take values 1, 2 or 3.
</p>
</li></ul>
</td></tr>
<tr><td><code id="approximate.prior.beta_+3A_n.intervals">n.intervals</code></td>
<td>
<p>Vector of integers, indicating the number of intervals for the baseline hazards for each stratum. The length of the vector should be equal to the total number of strata.</p>
</td></tr>
<tr><td><code id="approximate.prior.beta_+3A_change.points">change.points</code></td>
<td>
<p>List of vectors. Each vector in the list contains the change points for the baseline hazards for each stratum. The length of the list should be equal to the total number of strata.
For a given stratum, if there is only one interval, then <code>change.points</code> should be <code>NULL</code> for that stratum.
By default, we assign the change points so that the same number of events are observed in all the intervals in the historical data.</p>
</td></tr>
<tr><td><code id="approximate.prior.beta_+3A_prior.a0.shape1">prior.a0.shape1</code></td>
<td>
<p>Vector of the first shape parameters of the independent beta priors for <code class="reqn">a_0</code>. The length of the vector should be equal to the number of historical datasets. The default is a vector of one's.</p>
</td></tr>
<tr><td><code id="approximate.prior.beta_+3A_prior.a0.shape2">prior.a0.shape2</code></td>
<td>
<p>Vector of the second shape parameters of the independent beta priors for <code class="reqn">a_0</code>. The length of the vector should be equal to the number of historical datasets. The default is a vector of one's.</p>
</td></tr>
<tr><td><code id="approximate.prior.beta_+3A_prior.beta.mean">prior.beta.mean</code></td>
<td>
<p>Vector of means of the normal initial prior on <code class="reqn">\beta</code>. The default value is zero for all the elements of <code class="reqn">\beta</code>.</p>
</td></tr>
<tr><td><code id="approximate.prior.beta_+3A_prior.beta.sd">prior.beta.sd</code></td>
<td>
<p>Vector of standard deviations of the normal initial prior on <code class="reqn">\beta</code>. The default value is 10^3 for all the elements of <code class="reqn">\beta</code>.</p>
</td></tr>
<tr><td><code id="approximate.prior.beta_+3A_prior.lambda0.hp1">prior.lambda0.hp1</code></td>
<td>
<p>Vector of first hyperparameters of the Gamma prior on <code class="reqn">\lambda_0</code>.
The length of the vector should be equal to the dimension of <code class="reqn">\lambda_0</code>, i.e., the total number of intervals for all strata. The default value is 10^(-5) for all the elements of <code class="reqn">\lambda_0</code>.</p>
</td></tr>
<tr><td><code id="approximate.prior.beta_+3A_prior.lambda0.hp2">prior.lambda0.hp2</code></td>
<td>
<p>Vector of second hyperparameters of the Gamma prior on <code class="reqn">\lambda_0</code>.
The length of the vector should be equal to the dimension of <code class="reqn">\lambda_0</code>, i.e., the total number of intervals for all strata. The default value is 10^(-5) for all the elements of <code class="reqn">\lambda_0</code>.</p>
</td></tr>
<tr><td><code id="approximate.prior.beta_+3A_lower.limits">lower.limits</code></td>
<td>
<p>Vector of lower limits for <code class="reqn">\beta</code> to be used by the slice sampler. The length of the vector should be equal to the length of <code class="reqn">\beta</code>. The default is -100 for all the elements of <code class="reqn">\beta</code> (may not be appropriate for all situations).</p>
</td></tr>
<tr><td><code id="approximate.prior.beta_+3A_upper.limits">upper.limits</code></td>
<td>
<p>Vector of upper limits for <code class="reqn">\beta</code> to be used by the slice sampler. The length of the vector should be equal to the length of <code class="reqn">\beta</code>. The default is 100 for all the elements of <code class="reqn">\beta</code> (may not be appropriate for all situations).</p>
</td></tr>
<tr><td><code id="approximate.prior.beta_+3A_slice.widths">slice.widths</code></td>
<td>
<p>Vector of initial slice widths for <code class="reqn">\beta</code> to be used by the slice sampler. The length of the vector should be equal to the total number of parameters. The default is 0.1 for all the elements of <code class="reqn">\beta</code> (may not be appropriate for all situations).</p>
</td></tr>
<tr><td><code id="approximate.prior.beta_+3A_nmc">nMC</code></td>
<td>
<p>Number of iterations (excluding burn-in samples) for the slice sampler. The default is 10,000.</p>
</td></tr>
<tr><td><code id="approximate.prior.beta_+3A_nbi">nBI</code></td>
<td>
<p>Number of burn-in samples for the slice sampler. The default is 250.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is used to produce <code>prior.beta.mvn</code> in the function <code><a href="#topic+power.phm.random.a0">power.phm.random.a0</a></code>. It approximates the normalized power prior for <code class="reqn">\beta</code> when <code class="reqn">a_0</code> is modeled as random.
The function returns discrete samples of <code class="reqn">\beta</code> from the normalized power prior, and the user can use any mixture of multivariate normal distributions as an
approximation for the normalized power prior for <code class="reqn">\beta</code>.
</p>
<p>Baseline hazard parameters for the
current and historical data are NOT shared.
The baseline hazards of the historical data are denoted by <code class="reqn">\lambda_0</code>. We assume Gamma priors for <code class="reqn">\lambda_0</code>
and independent normal initial priors for <code class="reqn">\beta</code>.
</p>
<p>Posterior samples are obtained through slice sampling.
The default lower limits are -100 for <code class="reqn">\beta</code>. The default upper limits
for the parameters are 100. The default slice widths for the parameters are 0.1.
The defaults may not be appropriate for all situations, and the user can specify the appropriate limits
and slice width for each parameter.
</p>


<h3>Value</h3>

<p>Samples of <code class="reqn">\beta</code> (approximating the normalized power prior) are returned.
</p>


<h3>References</h3>

<p>Ibrahim, J. G., Chen, M.-H. and Sinha, D. (2001). Bayesian Survival Analysis. New York: Springer Science &amp; Business Media.
</p>
<p>Psioda, M. A. and Ibrahim, J. G. (2019). Bayesian clinical trial design using historical data that inform the treatment effect. Biostatistics 20, 400–415.
</p>
<p>Shen, Y., Psioda, M. A., and Joseph, J. G. (2023). BayesPPD: an R package for Bayesian sample size determination using the power and normalized power prior for generalized linear models. The R Journal, 14(4).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+phm.random.a0">phm.random.a0</a></code> and <code><a href="#topic+power.phm.random.a0">power.phm.random.a0</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Simulate two historical datasets
n &lt;- 100
P &lt;- 4
time1 &lt;- round(rexp(n, rate=0.5),1)
event1 &lt;- rep(1,n)
X1 &lt;- matrix(rbinom(n*P,prob=0.5,size=1), ncol=P)
S1 &lt;- c(rep(1,n/2),rep(2,n/2))
time2 &lt;- round(rexp(n, rate=0.7),1)
event2 &lt;- rep(1,n)
X2 &lt;- matrix(rbinom(n*P,prob=0.5,size=1), ncol=P)
S2 &lt;- c(rep(1,n/2),rep(2,n/2))
historical &lt;- list(list(time=time1, event=event1, X=X1, S=S1),
                   list(time=time2, event=event2, X=X2, S=S2))

# We choose three intervals for the first stratum and two intervals for the second stratum
n.intervals &lt;- c(3,2) 
change.points &lt;- list(c(1,2), 2)

# Get samples from the approximate normalized power prior for beta
nMC &lt;- 100 # nMC should be larger in practice
nBI &lt;- 50
prior.beta &lt;- approximate.prior.beta(historical, n.intervals, change.points=change.points,
                                     prior.a0.shape1=c(1,1), prior.a0.shape2=c(1,1), 
                                     nMC=nMC, nBI=nBI)
prior_beta_mu=colMeans(prior.beta)
prior_beta_sigma=cov(prior.beta) 

# Aprroximate the discrete sames with a single multivariate normal with weight one.
# The user can use any mixture of multivariate normal distributions as an 
# approximation for the normalized power prior for beta.
prior.beta.mvn &lt;- list(list(prior_beta_mu, prior_beta_sigma, 1))
# prior.beta.mvn is a parameter for phm.random.a0() and power.phm.random.a0()



</code></pre>

<hr>
<h2 id='melanoma'>Melanoma Clinical Trials E1684 and E1690</h2><span id='topic+melanoma'></span>

<h3>Description</h3>

<p>A dataset for the E1684 clinical trial (1996) and the E1690 clinical trial (2000) conducted to assess the utility of interferon alfa-2b (INF) as an adjuvant therapy following surgery for deep primary or regionally metastatic melanoma.
This dataset contains subjects in disease stage four only, i.e., regional lymph node recurrence at any interval
after appropriate surgery for primary melanoma of any depth.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>melanoma
</code></pre>


<h3>Format</h3>

<p>A data frame with 381 rows and 5 variables:
</p>

<dl>
<dt>study</dt><dd><p>study number (1684 or 1690)</p>
</dd>
<dt>failtime</dt><dd><p>time to relapse in years</p>
</dd>
<dt>rfscens</dt><dd><p>censoring indicator for time to relapse (0 = did not relapse, 1 = relapsed)</p>
</dd>
<dt>trt</dt><dd><p>treatment (1 if IFN and 0 if Observation)</p>
</dd>
<dt>stratum</dt><dd><p>stratum index (1 if number of positive nodes &lt;= 2 and 2 if number of positive nodes &gt;= 3</p>
</dd>
</dl>



<h3>Source</h3>

<p>Kirkwood, J. M., J. G. Ibrahim, V. K. Sondak, J. Richards, L. E. Flaherty, M. S. Ernstoff, T. J. Smith,
U. Rao, M. Steele, and R. H. Blum (2000, Jun). High- and low-dose interferon alfa-2b in high-risk
melanoma: first analysis of intergroup trial e1690/s9111/c9190. Journal of Clinical Oncology 18 (12),
2444–2458.
</p>
<p>Kirkwood, J. M., M. H. Strawderman, M. S. Ernstoff, T. J. Smith, E. C. Borden, and R. H. Blum
(1996). Interferon alfa-2b adjuvant therapy of high-risk resected cutaneous melanoma: the eastern
cooperative oncology group trial est 1684. Journal of Clinical Oncology 14, 7–17.
</p>

<hr>
<h2 id='phm.fixed.a0'>Model fitting for the proportional hazards model with piecewise constant hazard and fixed a0</h2><span id='topic+phm.fixed.a0'></span>

<h3>Description</h3>

<p>Model fitting using power priors for the proportional hazards model with piecewise constant hazard and fixed <code class="reqn">a_0</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phm.fixed.a0(
  time = NULL,
  event = NULL,
  X = NULL,
  S = NULL,
  historical,
  a0,
  n.intervals,
  change.points = NULL,
  shared.blh = FALSE,
  prior.beta = "Normal",
  prior.beta.mean = rep(0, 50),
  prior.beta.sd = rep(1000, 50),
  prior.lambda = "Gamma",
  prior.lambda.hp1 = rep(10^(-5), 50),
  prior.lambda.hp2 = rep(10^(-5), 50),
  prior.lambda0.hp1 = rep(10^(-5), 50),
  prior.lambda0.hp2 = rep(10^(-5), 50),
  lower.limits = NULL,
  upper.limits = rep(100, 50),
  slice.widths = rep(0.1, 50),
  current.data = TRUE,
  nMC = 10000,
  nBI = 250
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="phm.fixed.a0_+3A_time">time</code></td>
<td>
<p>Vector of follow up times.</p>
</td></tr>
<tr><td><code id="phm.fixed.a0_+3A_event">event</code></td>
<td>
<p>Vector of status indicators. Normally 0=alive and 1=dead.</p>
</td></tr>
<tr><td><code id="phm.fixed.a0_+3A_x">X</code></td>
<td>
<p>Matrix of covariates. The first column must be the treatment indicator.</p>
</td></tr>
<tr><td><code id="phm.fixed.a0_+3A_s">S</code></td>
<td>
<p>Vector of integers, where each integer represents the stratum that the subject belongs to. For example, if there are three strata, S can take values 1, 2 or 3.</p>
</td></tr>
<tr><td><code id="phm.fixed.a0_+3A_historical">historical</code></td>
<td>
<p>List of historical dataset(s). East historical dataset is stored in a list which contains four <em>named</em> elements: <code>time</code>, <code>event</code>, <code>X</code> and <code>S</code>.
</p>

<ul>
<li> <p><code>time</code> is a vector of follow up times.
</p>
</li>
<li> <p><code>event</code> is a vector of status indicators. Normally 0=alive and 1=dead.
</p>
</li>
<li> <p><code>X</code> is a matrix of covariates. The first column must be the treatment indicator.
</p>
</li>
<li> <p><code>S</code> is a vector of integers, where each integer represents the stratum that the subject belongs to. For example, if there are three strata, S can take values 1, 2 or 3.
</p>
</li></ul>
</td></tr>
<tr><td><code id="phm.fixed.a0_+3A_a0">a0</code></td>
<td>
<p>Vector containing numbers between 0 and 1 indicating the discounting parameter value for each historical dataset. The length of the vector should be equal to the length of <code>historical</code>.</p>
</td></tr>
<tr><td><code id="phm.fixed.a0_+3A_n.intervals">n.intervals</code></td>
<td>
<p>Vector of integers, indicating the number of intervals for the baseline hazards for each stratum. The length of the vector should be equal to the total number of strata.</p>
</td></tr>
<tr><td><code id="phm.fixed.a0_+3A_change.points">change.points</code></td>
<td>
<p>List of vectors. Each vector in the list contains the change points for the baseline hazards for each stratum. The length of the list should be equal to the total number of strata.
For a given stratum, if there is only one interval, then <code>change.points</code> should be <code>NULL</code> for that stratum.
By default, we assign the change points so that the same number of events are observed in all the intervals in the pooled current and historical data.</p>
</td></tr>
<tr><td><code id="phm.fixed.a0_+3A_shared.blh">shared.blh</code></td>
<td>
<p>Logical value indicating whether baseline hazard parameters are shared between the current and historical data. If TRUE, baseline hazard parameters are shared. The default value is FALSE.</p>
</td></tr>
<tr><td><code id="phm.fixed.a0_+3A_prior.beta">prior.beta</code></td>
<td>
<p>Prior used for <code class="reqn">\beta</code>. The choices are &quot;Uniform&quot; and &quot;Normal&quot;. If <code>prior.beta</code> is &quot;Uniform&quot;, the uniform improper prior is used.
If <code>prior.beta</code> is &quot;Normal&quot;, independent normal priors are used for each element of <code class="reqn">\beta</code>. The default choice is &quot;Normal&quot;.</p>
</td></tr>
<tr><td><code id="phm.fixed.a0_+3A_prior.beta.mean">prior.beta.mean</code></td>
<td>
<p>(Only applies if <code>prior.beta</code> is &quot;Normal&quot;) vector of means of the normal prior on <code class="reqn">\beta</code>. The default value is zero for all the elements of <code class="reqn">\beta</code>.</p>
</td></tr>
<tr><td><code id="phm.fixed.a0_+3A_prior.beta.sd">prior.beta.sd</code></td>
<td>
<p>(Only applies if <code>prior.beta</code> is &quot;Normal&quot;) vector of standard deviations of the normal prior on <code class="reqn">\beta</code>. The default value is 10^3 for all the elements of <code class="reqn">\beta</code>.</p>
</td></tr>
<tr><td><code id="phm.fixed.a0_+3A_prior.lambda">prior.lambda</code></td>
<td>
<p>Prior used for <code class="reqn">\lambda</code>. The choices are &quot;Gamma&quot;, &quot;Log-normal&quot; and &quot;Improper&quot;. The default choice is &quot;Gamma&quot;.
</p>
<p>If <code>prior.lambda</code> is &quot;Gamma&quot;, then the prior on the first element of <code class="reqn">\lambda</code> is
</p>
<p>Gamma(shape=<code>prior.lambda.hp1[1]</code>, rate=<code>prior.lambda.hp2[1]</code>).
</p>
<p>If <code>prior.lambda</code> is &quot;Log-normal&quot;, then the prior on the first element of <code class="reqn">\lambda</code> is Log-normal(mean=<code>prior.lambda.hp1[1]</code>, sd=<code>prior.lambda.hp2[1]</code>).
</p>
<p>If <code>prior.lambda</code> is &quot;Improper&quot;, then the prior on each element of <code class="reqn">\lambda</code> is the improper prior <code class="reqn">\lambda^{-1}</code>.</p>
</td></tr>
<tr><td><code id="phm.fixed.a0_+3A_prior.lambda.hp1">prior.lambda.hp1</code></td>
<td>
<p>(Only applies if <code>prior.lambda</code> is &quot;Gamma&quot; or &quot;Log-normal&quot;) Vector of first hyperparameters of the prior on <code class="reqn">\lambda</code>.
The length of the vector should be equal to the dimension of <code class="reqn">\lambda</code>, i.e., the total number of intervals for all strata. The default value is 10^(-5) for all the elements of <code class="reqn">\lambda</code>.</p>
</td></tr>
<tr><td><code id="phm.fixed.a0_+3A_prior.lambda.hp2">prior.lambda.hp2</code></td>
<td>
<p>(Only applies if <code>prior.lambda</code> is &quot;Gamma&quot; or &quot;Log-normal&quot;) Vector of second hyperparameters of the prior on <code class="reqn">\lambda</code>.
The length of the vector should be equal to the dimension of <code class="reqn">\lambda</code>, i.e., the total number of intervals for all strata. The default value is 10^(-5) for all the elements of <code class="reqn">\lambda</code>.</p>
</td></tr>
<tr><td><code id="phm.fixed.a0_+3A_prior.lambda0.hp1">prior.lambda0.hp1</code></td>
<td>
<p>(Only applies if <code>shared.blh</code> is FALSE and if <code>prior.lambda</code> is &quot;Gamma&quot; or &quot;Log-normal&quot;) Vector of first hyperparameters of the prior on <code class="reqn">\lambda_0</code>.
We assume the same distribution choice for the prior for <code class="reqn">\lambda_0</code> and <code class="reqn">\lambda</code>.
The length of the vector should be equal to the dimension of <code class="reqn">\lambda_0</code>, i.e., the total number of intervals for all strata. The default value is 10^(-5) for all the elements of <code class="reqn">\lambda_0</code>.</p>
</td></tr>
<tr><td><code id="phm.fixed.a0_+3A_prior.lambda0.hp2">prior.lambda0.hp2</code></td>
<td>
<p>(Only applies if <code>shared.blh</code> is FALSE and if <code>prior.lambda</code> is &quot;Gamma&quot; or &quot;Log-normal&quot;) Vector of second hyperparameters of the prior on <code class="reqn">\lambda_0</code>.
We assume the same distribution choice for the prior for <code class="reqn">\lambda_0</code> and <code class="reqn">\lambda</code>.
The length of the vector should be equal to the dimension of <code class="reqn">\lambda_0</code>, i.e., the total number of intervals for all strata. The default value is 10^(-5) for all the elements of <code class="reqn">\lambda_0</code>.</p>
</td></tr>
<tr><td><code id="phm.fixed.a0_+3A_lower.limits">lower.limits</code></td>
<td>
<p>Vector of lower limits for parameters (<code class="reqn">\beta</code>, <code class="reqn">\lambda</code>, and <code class="reqn">\lambda_0</code>, in this order) to be used by the slice sampler. The length of the vector should be equal to the total number of parameters. The default is -100 for <code class="reqn">\beta</code> and 0 for <code class="reqn">\lambda</code> and <code class="reqn">\lambda_0</code> (may not be appropriate for all situations).</p>
</td></tr>
<tr><td><code id="phm.fixed.a0_+3A_upper.limits">upper.limits</code></td>
<td>
<p>Vector of upper limits for parameters (<code class="reqn">\beta</code>, <code class="reqn">\lambda</code>, and <code class="reqn">\lambda_0</code>, in this order) to be used by the slice sampler. The length of the vector should be equal to the total number of parameters. The default is 100 for all parameters (may not be appropriate for all situations).</p>
</td></tr>
<tr><td><code id="phm.fixed.a0_+3A_slice.widths">slice.widths</code></td>
<td>
<p>Vector of initial slice widths for parameters (<code class="reqn">\beta</code>, <code class="reqn">\lambda</code>, and <code class="reqn">\lambda_0</code>, in this order) to be used by the slice sampler. The length of the vector should be equal to the total number of parameters. The default is 0.1 for all parameters (may not be appropriate for all situations).</p>
</td></tr>
<tr><td><code id="phm.fixed.a0_+3A_current.data">current.data</code></td>
<td>
<p>Logical value indicating whether current data is included. The default is TRUE. If FALSE, only historical data is included in the analysis,
and the posterior samples can be used as a discrete approximation to the sampling prior in
<code><a href="#topic+power.phm.fixed.a0">power.phm.fixed.a0</a></code> and <code><a href="#topic+power.phm.random.a0">power.phm.random.a0</a></code>.</p>
</td></tr>
<tr><td><code id="phm.fixed.a0_+3A_nmc">nMC</code></td>
<td>
<p>Number of iterations (excluding burn-in samples) for the slice sampler. The default is 10,000.</p>
</td></tr>
<tr><td><code id="phm.fixed.a0_+3A_nbi">nBI</code></td>
<td>
<p>Number of burn-in samples for the slice sampler. The default is 250.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The proportional hazards model with piecewise constant hazard is implemented.
We assume <code class="reqn">\beta</code> is the regression coefficients. We assume the first column of the covariate matrix is the treatment indicator,
and the corresponding parameter is <code class="reqn">\beta_1</code>. The baseline hazards of the current data are denoted by <code class="reqn">\lambda</code>.
The baseline hazards of the historical data are denoted by <code class="reqn">\lambda_0</code>.
If the baseline hazards are shared between the historical and current data, then <code class="reqn">\lambda_0</code>=<code class="reqn">\lambda</code>.
</p>
<p>Posterior samples are obtained through slice sampling.
The default lower limits are -100 for <code class="reqn">\beta</code> and 0 for <code class="reqn">\lambda</code> and <code class="reqn">\lambda_0</code>. The default upper limits
for the parameters are 100. The default slice widths for the parameters are 0.1.
The defaults may not be appropriate for all situations, and the user can specify the appropriate limits
and slice width for each parameter.
</p>


<h3>Value</h3>

<p>Posterior samples of <code class="reqn">\beta</code>, <code class="reqn">\lambda</code> and <code class="reqn">\lambda_0</code> (if baseline hazards are not shared between the current and historical data) are returned.
</p>


<h3>References</h3>

<p>Ibrahim, J. G., Chen, M.-H. and Sinha, D. (2001). Bayesian Survival Analysis. New York: Springer Science &amp; Business Media.
</p>
<p>Psioda, M. A. and Ibrahim, J. G. (2019). Bayesian clinical trial design using historical data that inform the treatment effect. Biostatistics 20, 400–415.
</p>
<p>Shen, Y., Psioda, M. A., and Joseph, J. G. (2023). BayesPPD: an R package for Bayesian sample size determination using the power and normalized power prior for generalized linear models. The R Journal, 14(4).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+power.phm.fixed.a0">power.phm.fixed.a0</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(1)
# Simulate current data
n &lt;- 50
P &lt;- 4
time &lt;- round(rexp(n, rate=0.5),1)
event &lt;- rep(1,n)
X &lt;- matrix(rbinom(n*P,prob=0.5,size=1), ncol=P)
S &lt;- c(rep(1,n/2),rep(2,n/2))

# Simulate two historical datasets
n &lt;- 100
time1 &lt;- round(rexp(n, rate=0.5),1)
event1 &lt;- rep(1,n)
X1 &lt;- matrix(rbinom(n*P,prob=0.5,size=1), ncol=P)
S1 &lt;- c(rep(1,n/2),rep(2,n/2))
time2 &lt;- round(rexp(n, rate=0.7),1)
event2 &lt;- rep(1,n)
X2 &lt;- matrix(rbinom(n*P,prob=0.5,size=1), ncol=P)
S2 &lt;- c(rep(1,n/2),rep(2,n/2))
historical &lt;- list(list(time=time1, event=event1, X=X1, S=S1),
                   list(time=time2, event=event2, X=X2, S=S2))

# a0 is 0.3 for the first historical dataset and 0.6 for the second
a0 &lt;- c(0.3, 0.6)


# We choose three intervals for the first stratum and two intervals for the second stratum
n.intervals &lt;- c(3,2) 
change.points &lt;- list(c(1,2), 2)


nMC &lt;- 1000 # nMC should be larger in practice
nBI &lt;- 50

result &lt;- phm.fixed.a0(time=time, event=event, X=X, S=S,
                       historical=historical, a0=a0, n.intervals=n.intervals, 
                       change.points=change.points, nMC=nMC, nBI=nBI)

# posterior mean of beta
colMeans(result$beta_samples) 
# posterior mean of baseline hazards for stratum 1
colMeans(result$lambda_samples[[1]]) 
# posterior mean of baseline hazards for stratum 2
colMeans(result$lambda_samples[[2]]) 
# posterior mean of historical baseline hazards for stratum 1
colMeans(result$lambda0_samples[[1]]) 
# posterior mean of historical baseline hazards for stratum 2
colMeans(result$lambda0_samples[[2]]) 




</code></pre>

<hr>
<h2 id='phm.random.a0'>Model fitting for the proportional hazards model with piecewise constant hazard and random a0</h2><span id='topic+phm.random.a0'></span>

<h3>Description</h3>

<p>Model fitting using the normalized power prior for the proportional hazards model with piecewise constant hazard and random <code class="reqn">a_0</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phm.random.a0(
  time,
  event,
  X,
  S,
  historical,
  n.intervals,
  change.points = NULL,
  prior.beta.mvn = NULL,
  prior.beta.mean = rep(0, 50),
  prior.beta.sd = rep(1000, 50),
  prior.lambda0.hp1 = rep(10^(-5), 50),
  prior.lambda0.hp2 = rep(10^(-5), 50),
  prior.a0.shape1 = rep(1, 10),
  prior.a0.shape2 = rep(1, 10),
  prior.lambda.hp1 = rep(10^(-5), 50),
  prior.lambda.hp2 = rep(10^(-5), 50),
  lower.limits = NULL,
  upper.limits = rep(100, 50),
  slice.widths = rep(0.1, 50),
  nMC = 10000,
  nBI = 250
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="phm.random.a0_+3A_time">time</code></td>
<td>
<p>Vector of follow up times.</p>
</td></tr>
<tr><td><code id="phm.random.a0_+3A_event">event</code></td>
<td>
<p>Vector of status indicators. Normally 0=alive and 1=dead.</p>
</td></tr>
<tr><td><code id="phm.random.a0_+3A_x">X</code></td>
<td>
<p>Matrix of covariates. The first column must be the treatment indicator.</p>
</td></tr>
<tr><td><code id="phm.random.a0_+3A_s">S</code></td>
<td>
<p>Vector of integers, where each integer represents the stratum that the subject belongs to. For example, if there are three strata, S can take values 1, 2 or 3.</p>
</td></tr>
<tr><td><code id="phm.random.a0_+3A_historical">historical</code></td>
<td>
<p>List of historical dataset(s). East historical dataset is stored in a list which contains four <em>named</em> elements: <code>time</code>, <code>event</code>, <code>X</code> and <code>S</code>.
</p>

<ul>
<li> <p><code>time</code> is a vector of follow up times.
</p>
</li>
<li> <p><code>event</code> is a vector of status indicators. Normally 0=alive and 1=dead.
</p>
</li>
<li> <p><code>X</code> is a matrix of covariates. The first column must be the treatment indicator.
</p>
</li>
<li> <p><code>S</code> is a vector of integers, where each integer represents the stratum that the subject belongs to. For example, if there are three strata, S can take values 1, 2 or 3.
</p>
</li></ul>
</td></tr>
<tr><td><code id="phm.random.a0_+3A_n.intervals">n.intervals</code></td>
<td>
<p>Vector of integers, indicating the number of intervals for the baseline hazards for each stratum. The length of the vector should be equal to the total number of strata.</p>
</td></tr>
<tr><td><code id="phm.random.a0_+3A_change.points">change.points</code></td>
<td>
<p>List of vectors. Each vector in the list contains the change points for the baseline hazards for each stratum. The length of the list should be equal to the total number of strata.
For a given stratum, if there is only one interval, then <code>change.points</code> should be <code>NULL</code> for that stratum.
By default, we assign the change points so that the same number of events are observed in all the intervals in the pooled current and historical data.</p>
</td></tr>
<tr><td><code id="phm.random.a0_+3A_prior.beta.mvn">prior.beta.mvn</code></td>
<td>
<p>List of multivariate normal approximations of the normalized power prior for <code class="reqn">\beta</code>. Each element in the list is a list with three components,
the mean vector, the covariance matrix and the weight of the multivariate normal distribution. The normalized power prior for <code class="reqn">\beta</code>
is approximated by the weighted mixture of the multivariate normal distributions provided. By default (<code>prior.beta.mvn=NULL</code>), a single multivariate normal distribution is assumed.
The user can use the <code><a href="#topic+approximate.prior.beta">approximate.prior.beta</a></code> function to obtain samples of <code class="reqn">\beta</code> from the normalized power prior, and use any mixture of multivariate normals to approximate
the normalized power prior for <code class="reqn">\beta</code>.</p>
</td></tr>
<tr><td><code id="phm.random.a0_+3A_prior.beta.mean">prior.beta.mean</code></td>
<td>
<p>(Only applies if <code>prior.beta.mvn=NULL</code>) Vector of means of the normal initial prior on <code class="reqn">\beta</code>. The default value is zero for all the elements of <code class="reqn">\beta</code>.</p>
</td></tr>
<tr><td><code id="phm.random.a0_+3A_prior.beta.sd">prior.beta.sd</code></td>
<td>
<p>(Only applies if <code>prior.beta.mvn=NULL</code>) Vector of standard deviations of the normal initial prior on <code class="reqn">\beta</code>. The default value is 10^3 for all the elements of <code class="reqn">\beta</code>.</p>
</td></tr>
<tr><td><code id="phm.random.a0_+3A_prior.lambda0.hp1">prior.lambda0.hp1</code></td>
<td>
<p>(Only applies if <code>prior.beta.mvn=NULL</code>) Vector of first hyperparameters of the Gamma prior on <code class="reqn">\lambda_0</code>.
The length of the vector should be equal to the dimension of <code class="reqn">\lambda_0</code>, i.e., the total number of intervals for all strata. The default value is 10^(-5) for all the elements of <code class="reqn">\lambda_0</code>.</p>
</td></tr>
<tr><td><code id="phm.random.a0_+3A_prior.lambda0.hp2">prior.lambda0.hp2</code></td>
<td>
<p>(Only applies if <code>prior.beta.mvn=NULL</code>) Vector of second hyperparameters of the Gamma prior on <code class="reqn">\lambda_0</code>.
The length of the vector should be equal to the dimension of <code class="reqn">\lambda_0</code>, i.e., the total number of intervals for all strata. The default value is 10^(-5) for all the elements of <code class="reqn">\lambda_0</code>.</p>
</td></tr>
<tr><td><code id="phm.random.a0_+3A_prior.a0.shape1">prior.a0.shape1</code></td>
<td>
<p>(Only applies if <code>prior.beta.mvn=NULL</code>) Vector of the first shape parameters of the independent beta priors for <code class="reqn">a_0</code>. The length of the vector should be equal to the number of historical datasets. The default is a vector of one's.</p>
</td></tr>
<tr><td><code id="phm.random.a0_+3A_prior.a0.shape2">prior.a0.shape2</code></td>
<td>
<p>(Only applies if <code>prior.beta.mvn=NULL</code>) Vector of the second shape parameters of the independent beta priors for <code class="reqn">a_0</code>. The length of the vector should be equal to the number of historical datasets. The default is a vector of one's.</p>
</td></tr>
<tr><td><code id="phm.random.a0_+3A_prior.lambda.hp1">prior.lambda.hp1</code></td>
<td>
<p>Vector of first hyperparameters of the Gamma prior on <code class="reqn">\lambda</code>.
The length of the vector should be equal to the dimension of <code class="reqn">\lambda</code>, i.e., the total number of intervals for all strata. The default value is 10^(-5) for all the elements of <code class="reqn">\lambda</code>.</p>
</td></tr>
<tr><td><code id="phm.random.a0_+3A_prior.lambda.hp2">prior.lambda.hp2</code></td>
<td>
<p>Vector of second hyperparameters of the Gamma prior on <code class="reqn">\lambda</code>.
The length of the vector should be equal to the dimension of <code class="reqn">\lambda</code>, i.e., the total number of intervals for all strata. The default value is 10^(-5) for all the elements of <code class="reqn">\lambda</code>.</p>
</td></tr>
<tr><td><code id="phm.random.a0_+3A_lower.limits">lower.limits</code></td>
<td>
<p>Vector of lower limits for parameters (<code class="reqn">\beta</code> and <code class="reqn">\lambda</code>, in this order) to be used by the slice sampler. The length of the vector should be equal to the total number of parameters. The default is -100 for <code class="reqn">\beta</code> and 0 for <code class="reqn">\lambda</code> (may not be appropriate for all situations).</p>
</td></tr>
<tr><td><code id="phm.random.a0_+3A_upper.limits">upper.limits</code></td>
<td>
<p>Vector of upper limits for parameters (<code class="reqn">\beta</code> and <code class="reqn">\lambda</code>, in this order) to be used by the slice sampler. The length of the vector should be equal to the total number of parameters. The default is 100 for all parameters (may not be appropriate for all situations).</p>
</td></tr>
<tr><td><code id="phm.random.a0_+3A_slice.widths">slice.widths</code></td>
<td>
<p>Vector of initial slice widths for parameters (<code class="reqn">\beta</code> and <code class="reqn">\lambda</code>, in this order) to be used by the slice sampler. The length of the vector should be equal to the total number of parameters. The default is 0.1 for all parameters (may not be appropriate for all situations).</p>
</td></tr>
<tr><td><code id="phm.random.a0_+3A_nmc">nMC</code></td>
<td>
<p>Number of iterations (excluding burn-in samples) for the slice sampler. The default is 10,000.</p>
</td></tr>
<tr><td><code id="phm.random.a0_+3A_nbi">nBI</code></td>
<td>
<p>Number of burn-in samples for the slice sampler. The default is 250.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The proportional hazards model with piecewise constant hazard is implemented.
We assume <code class="reqn">\beta</code> is the regression coefficients. We assume the first column of the covariate matrix is the treatment indicator,
and the corresponding parameter is <code class="reqn">\beta_1</code>. Here <code class="reqn">a_0</code> is modeled as random with a normalized power prior.
</p>
<p>The normalized power prior for <code class="reqn">\beta</code> is approximated by a weighted mixture of multivariate normal distributions provided in <code>prior.beta.mvn</code>.
The user can use the <code><a href="#topic+approximate.prior.beta">approximate.prior.beta</a></code> function to obtain samples of <code class="reqn">\beta</code> from the normalized power prior, and use any mixture of multivariate normals to approximate
the normalized power prior for <code class="reqn">\beta</code>. By default, a single multivariate normal distribution is assumed.
</p>
<p>Posterior samples are obtained through slice sampling.
The default lower limits are -100 for <code class="reqn">\beta</code> and 0 for <code class="reqn">\lambda</code>. The default upper limits
for the parameters are 100. The default slice widths for the parameters are 0.1.
The defaults may not be appropriate for all situations, and the user can specify the appropriate limits
and slice width for each parameter.
</p>


<h3>Value</h3>

<p>Posterior samples of <code class="reqn">\beta</code> and <code class="reqn">\lambda</code> are returned.
</p>


<h3>References</h3>

<p>Ibrahim, J. G., Chen, M.-H. and Sinha, D. (2001). Bayesian Survival Analysis. New York: Springer Science &amp; Business Media.
</p>
<p>Psioda, M. A. and Ibrahim, J. G. (2019). Bayesian clinical trial design using historical data that inform the treatment effect. Biostatistics 20, 400–415.
</p>
<p>Shen, Y., Psioda, M. A., and Joseph, J. G. (2023). BayesPPD: an R package for Bayesian sample size determination using the power and normalized power prior for generalized linear models. The R Journal, 14(4).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+power.phm.random.a0">power.phm.random.a0</a></code> and <code><a href="#topic+approximate.prior.beta">approximate.prior.beta</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


set.seed(1)
# Simulate current data
n &lt;- 50
P &lt;- 4
time &lt;- round(rexp(n, rate=0.5),1)
event &lt;- rep(1,n)
X &lt;- matrix(rbinom(n*P,prob=0.5,size=1), ncol=P)
S &lt;- c(rep(1,n/2),rep(2,n/2))

# Simulate two historical datasets
n &lt;- 100
time1 &lt;- round(rexp(n, rate=0.5),1)
event1 &lt;- rep(1,n)
X1 &lt;- matrix(rbinom(n*P,prob=0.5,size=1), ncol=P)
S1 &lt;- c(rep(1,n/2),rep(2,n/2))
time2 &lt;- round(rexp(n, rate=0.7),1)
event2 &lt;- rep(1,n)
X2 &lt;- matrix(rbinom(n*P,prob=0.5,size=1), ncol=P)
S2 &lt;- c(rep(1,n/2),rep(2,n/2))
historical &lt;- list(list(time=time1, event=event1, X=X1, S=S1),
                   list(time=time2, event=event2, X=X2, S=S2))

# We choose three intervals for the first stratum and two intervals for the second stratum
n.intervals &lt;- c(3,2) 
change.points &lt;- list(c(1,2), 2)

# Get samples from the approximate normalized power prior for beta
nMC &lt;- 100 # nMC should be larger in practice
nBI &lt;- 50
prior.beta &lt;- approximate.prior.beta(historical, n.intervals, change.points=change.points,
                                     prior.a0.shape1=c(1,1), prior.a0.shape2=c(1,1), 
                                     nMC=nMC, nBI=nBI)
prior_beta_mu=colMeans(prior.beta)
prior_beta_sigma=cov(prior.beta) 

# Aprroximate the discrete sames with a single multivariate normal with weight one
prior.beta.mvn &lt;- list(list(prior_beta_mu, prior_beta_sigma, 1))

result &lt;- phm.random.a0(time=time, event=event, X=X, S=S,
                        historical=historical, n.intervals=n.intervals, 
                        change.points=change.points, 
                        prior.beta.mvn=prior.beta.mvn,
                        nMC=nMC, nBI=nBI)

# posterior mean of beta
colMeans(result$beta_samples) 
# posterior mean of baseline hazards for stratum 1
colMeans(result$lambda_samples[[1]]) 
# posterior mean of baseline hazards for stratum 2
colMeans(result$lambda_samples[[2]]) 



</code></pre>

<hr>
<h2 id='power.phm.fixed.a0'>Power/type I error calculation for the proportional hazards model with piecewise constant hazard and fixed a0</h2><span id='topic+power.phm.fixed.a0'></span>

<h3>Description</h3>

<p>Power/type I error calculation using power priors for the proportional hazards model with piecewise constant hazard and fixed <code class="reqn">a_0</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>power.phm.fixed.a0(
  historical,
  a0,
  n.subjects,
  n.events,
  n.intervals,
  change.points = NULL,
  shared.blh = FALSE,
  samp.prior.beta,
  samp.prior.lambda,
  x.samples = matrix(),
  s.samples = NULL,
  dist.enroll,
  param.enroll,
  rand.prob = 0.5,
  prob.drop = 0,
  param.drop = 0,
  dist.csr = "Constant",
  param.csr = 10000,
  min.follow.up = 0,
  max.follow.up = 10000,
  prior.beta = "Normal",
  prior.beta.mean = rep(0, 50),
  prior.beta.sd = rep(1000, 50),
  prior.lambda = "Gamma",
  prior.lambda.hp1 = rep(10^(-5), 50),
  prior.lambda.hp2 = rep(10^(-5), 50),
  prior.lambda0.hp1 = rep(10^(-5), 50),
  prior.lambda0.hp2 = rep(10^(-5), 50),
  lower.limits = NULL,
  upper.limits = rep(100, 50),
  slice.widths = rep(0.1, 50),
  nMC = 10000,
  nBI = 250,
  delta = 0,
  nullspace.ineq = "&gt;",
  gamma = 0.95,
  N = 10000
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="power.phm.fixed.a0_+3A_historical">historical</code></td>
<td>
<p>List of historical dataset(s). East historical dataset is stored in a list which contains four <em>named</em> elements: <code>time</code>, <code>event</code>, <code>X</code> and <code>S</code>.
</p>

<ul>
<li> <p><code>time</code> is a vector of follow up times.
</p>
</li>
<li> <p><code>event</code> is a vector of status indicators. Normally 0=alive and 1=dead.
</p>
</li>
<li> <p><code>X</code> is a matrix of covariates. The first column must be the treatment indicator.
</p>
</li>
<li> <p><code>S</code> is a vector of integers, where each integer represents the stratum that the subject belongs to. For example, if there are three strata, S can take values 1, 2 or 3.
</p>
</li></ul>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_a0">a0</code></td>
<td>
<p>Vector containing numbers between 0 and 1 indicating the discounting parameter value for each historical dataset. The length of the vector should be equal to the length of <code>historical</code>.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_n.subjects">n.subjects</code></td>
<td>
<p>Number of subjects enrolled.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_n.events">n.events</code></td>
<td>
<p>Number of events at which the trial will stop.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_n.intervals">n.intervals</code></td>
<td>
<p>Vector of integers, indicating the number of intervals for the baseline hazards for each stratum. The length of the vector should be equal to the total number of strata.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_change.points">change.points</code></td>
<td>
<p>List of vectors. Each vector in the list contains the change points for the baseline hazards for each stratum. The length of the list should be equal to the total number of strata.
For a given stratum, if there is only one interval, then <code>change.points</code> should be <code>NULL</code> for that stratum. By default, we assign the change points so that the same number of events are observed in all the intervals in the historical data.
These change points are used for data generation. The change points used during model fitting are assigned by default so that the same number of events are observed in all the intervals in the pooled historical and generated current data.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_shared.blh">shared.blh</code></td>
<td>
<p>Logical value indicating whether baseline hazard parameters are shared between the current and historical data. If TRUE, baseline hazard parameters are shared. The default value is FALSE.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_samp.prior.beta">samp.prior.beta</code></td>
<td>
<p>Matrix of possible values of <code class="reqn">\beta</code> to sample (with replacement) from. Each row is a possible <code class="reqn">\beta</code> vector (a realization from the sampling prior for <code class="reqn">\beta</code>).</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_samp.prior.lambda">samp.prior.lambda</code></td>
<td>
<p>List of matrices, where each matrix represents the sampling prior for the baseline hazards for each stratum. The number of columns of each matrix should be equal to the number of intervals for that stratum.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_x.samples">x.samples</code></td>
<td>
<p>(Only applies when there is no historical dataset) matrix of possible values of covariates from which covariate vectors are sampled with replacement.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_s.samples">s.samples</code></td>
<td>
<p>(Only applies when there is no historical dataset) vector of possible values of the stratum index from which the stratum indices are sampled with replacement.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_dist.enroll">dist.enroll</code></td>
<td>
<p>Distribution for enrollment times. The choices are &quot;Uniform&quot; or &quot;Exponential&quot;.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_param.enroll">param.enroll</code></td>
<td>
<p>Parameter for the distribution of enrollment times. If <code>dist.enroll</code> is &quot;Uniform&quot;, the enrollment times follow Unif(0, <code>param.enroll</code>). If <code>dist.enroll</code> is &quot;Exponential&quot;,
the enrollment times follow Exponential(rate=<code>param.enroll</code>).</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_rand.prob">rand.prob</code></td>
<td>
<p>Randomization probability for the treated group. The default value is 0.5.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_prob.drop">prob.drop</code></td>
<td>
<p>Probability of subjects dropping out of the study (non-administrative censoring). The default value is zero.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_param.drop">param.drop</code></td>
<td>
<p>Parameter for dropout time simulations. The dropout times follow Unif(0, <code>param.drop</code>). The default value is zero.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_dist.csr">dist.csr</code></td>
<td>
<p>Distribution for (administrative) censorship times. The choices are &quot;Uniform&quot;, &quot;Constant&quot; and &quot;Exponential&quot;. The default choice is &quot;Constant&quot;.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_param.csr">param.csr</code></td>
<td>
<p>Parameter for the (administrative) censorship times. If <code>dist.csr</code> is &quot;Uniform&quot;, the censorship times follow Unif(0, <code>param.csr</code>).
If <code>dist.csr</code> is &quot;Constant&quot;, the censorship times of all subjects are equal to <code>param.csr</code>.
If <code>dist.csr</code> is &quot;Exponential&quot;, the censorship times follow Exponential(rate=<code>param.csr</code>).
The default value is 10^4.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_min.follow.up">min.follow.up</code></td>
<td>
<p>Minimum amount of time for which subjects are followed up. The default value is zero.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_max.follow.up">max.follow.up</code></td>
<td>
<p>Maximum amount of time for which subjects are followed up. The default value is 10^4.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_prior.beta">prior.beta</code></td>
<td>
<p>Prior used for <code class="reqn">\beta</code>. The choices are &quot;Uniform&quot; and &quot;Normal&quot;. If <code>prior.beta</code> is &quot;Uniform&quot;, the uniform improper prior is used.
If <code>prior.beta</code> is &quot;Normal&quot;, independent normal priors are used for each element of <code class="reqn">\beta</code>. The default choice is &quot;Normal&quot;.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_prior.beta.mean">prior.beta.mean</code></td>
<td>
<p>(Only applies if <code>prior.beta</code> is &quot;Normal&quot;) vector of means of the normal prior on <code class="reqn">\beta</code>. The default value is zero for all the elements of <code class="reqn">\beta</code>.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_prior.beta.sd">prior.beta.sd</code></td>
<td>
<p>(Only applies if <code>prior.beta</code> is &quot;Normal&quot;) vector of standard deviations of the normal prior on <code class="reqn">\beta</code>. The default value is 10^3 for all the elements of <code class="reqn">\beta</code>.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_prior.lambda">prior.lambda</code></td>
<td>
<p>Prior used for <code class="reqn">\lambda</code>. The choices are &quot;Gamma&quot;, &quot;Log-normal&quot; and &quot;Improper&quot;. The default choice is &quot;Gamma&quot;.
</p>
<p>If <code>prior.lambda</code> is &quot;Gamma&quot;, then the prior on the first element of <code class="reqn">\lambda</code> is
</p>
<p>Gamma(shape=<code>prior.lambda.hp1[1]</code>, rate=<code>prior.lambda.hp2[1]</code>).
</p>
<p>If <code>prior.lambda</code> is &quot;Log-normal&quot;, then the prior on the first element of <code class="reqn">\lambda</code> is Log-normal(mean=<code>prior.lambda.hp1[1]</code>, sd=<code>prior.lambda.hp2[1]</code>).
</p>
<p>If <code>prior.lambda</code> is &quot;Improper&quot;, then the prior on each element of <code class="reqn">\lambda</code> is the improper prior <code class="reqn">\lambda^{-1}</code>.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_prior.lambda.hp1">prior.lambda.hp1</code></td>
<td>
<p>(Only applies if <code>prior.lambda</code> is &quot;Gamma&quot; or &quot;Log-normal&quot;) Vector of first hyperparameters of the prior on <code class="reqn">\lambda</code>.
The length of the vector should be equal to the dimension of <code class="reqn">\lambda</code>, i.e., the total number of intervals for all strata. The default value is 10^(-5) for all the elements of <code class="reqn">\lambda</code>.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_prior.lambda.hp2">prior.lambda.hp2</code></td>
<td>
<p>(Only applies if <code>prior.lambda</code> is &quot;Gamma&quot; or &quot;Log-normal&quot;) Vector of second hyperparameters of the prior on <code class="reqn">\lambda</code>.
The length of the vector should be equal to the dimension of <code class="reqn">\lambda</code>, i.e., the total number of intervals for all strata. The default value is 10^(-5) for all the elements of <code class="reqn">\lambda</code>.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_prior.lambda0.hp1">prior.lambda0.hp1</code></td>
<td>
<p>(Only applies if <code>shared.blh</code> is FALSE and if <code>prior.lambda</code> is &quot;Gamma&quot; or &quot;Log-normal&quot;) Vector of first hyperparameters of the prior on <code class="reqn">\lambda_0</code>.
We assume the same distribution choice for the prior for <code class="reqn">\lambda_0</code> and <code class="reqn">\lambda</code>.
The length of the vector should be equal to the dimension of <code class="reqn">\lambda_0</code>, i.e., the total number of intervals for all strata. The default value is 10^(-5) for all the elements of <code class="reqn">\lambda_0</code>.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_prior.lambda0.hp2">prior.lambda0.hp2</code></td>
<td>
<p>(Only applies if <code>shared.blh</code> is FALSE and if <code>prior.lambda</code> is &quot;Gamma&quot; or &quot;Log-normal&quot;) Vector of second hyperparameters of the prior on <code class="reqn">\lambda_0</code>.
We assume the same distribution choice for the prior for <code class="reqn">\lambda_0</code> and <code class="reqn">\lambda</code>.
The length of the vector should be equal to the dimension of <code class="reqn">\lambda_0</code>, i.e., the total number of intervals for all strata. The default value is 10^(-5) for all the elements of <code class="reqn">\lambda_0</code>.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_lower.limits">lower.limits</code></td>
<td>
<p>Vector of lower limits for parameters (<code class="reqn">\beta</code>, <code class="reqn">\lambda</code>, and <code class="reqn">\lambda_0</code>, in this order) to be used by the slice sampler. The length of the vector should be equal to the total number of parameters. The default is -100 for <code class="reqn">\beta</code> and 0 for <code class="reqn">\lambda</code> and <code class="reqn">\lambda_0</code> (may not be appropriate for all situations).</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_upper.limits">upper.limits</code></td>
<td>
<p>Vector of upper limits for parameters (<code class="reqn">\beta</code>, <code class="reqn">\lambda</code>, and <code class="reqn">\lambda_0</code>, in this order) to be used by the slice sampler. The length of the vector should be equal to the total number of parameters. The default is 100 for all parameters (may not be appropriate for all situations).</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_slice.widths">slice.widths</code></td>
<td>
<p>Vector of initial slice widths for parameters (<code class="reqn">\beta</code>, <code class="reqn">\lambda</code>, and <code class="reqn">\lambda_0</code>, in this order) to be used by the slice sampler. The length of the vector should be equal to the total number of parameters. The default is 0.1 for all parameters (may not be appropriate for all situations).</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_nmc">nMC</code></td>
<td>
<p>Number of iterations (excluding burn-in samples) for the slice sampler. The default is 10,000.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_nbi">nBI</code></td>
<td>
<p>Number of burn-in samples for the slice sampler. The default is 250.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_delta">delta</code></td>
<td>
<p>Prespecified constant that defines the boundary of the null hypothesis. The default is zero.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_nullspace.ineq">nullspace.ineq</code></td>
<td>
<p>Character string specifying the inequality of the null hypothesis. The options are &quot;&gt;&quot; and &quot;&lt;&quot;. If &quot;&gt;&quot; is specified, the null hypothesis is <code class="reqn">H_0</code>: <code class="reqn">\beta_1</code> <code class="reqn">\ge</code> <code class="reqn">\delta</code>. If &quot;&lt;&quot; is specified, the null hypothesis is <code class="reqn">H_0</code>: <code class="reqn">\beta_1</code> <code class="reqn">\le</code> <code class="reqn">\delta</code>. The default choice is &quot;&gt;&quot;.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_gamma">gamma</code></td>
<td>
<p>Posterior probability threshold for rejecting the null. The null hypothesis is rejected if posterior probability is greater <code>gamma</code>. The default is 0.95.</p>
</td></tr>
<tr><td><code id="power.phm.fixed.a0_+3A_n">N</code></td>
<td>
<p>Number of simulated datasets to generate. The default is 10,000.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The proportional hazards model with piecewise constant hazard is implemented.
We assume <code class="reqn">\beta</code> is the regression coefficients. We assume the first column of the covariate matrix is the treatment indicator,
and the corresponding parameter is <code class="reqn">\beta_1</code>. The baseline hazards of the current data are denoted by <code class="reqn">\lambda</code>.
The baseline hazards of the historical data are denoted by <code class="reqn">\lambda_0</code>.
If the baseline hazards are shared between the historical and current data, then <code class="reqn">\lambda_0</code>=<code class="reqn">\lambda</code>.
</p>
<p>To perform sample size determination, we test the hypotheses
</p>
<p style="text-align: center;"><code class="reqn">H_0: \beta_1 \ge \delta</code>
</p>
<p> and </p>
<p style="text-align: center;"><code class="reqn">H_1: \beta_1 &lt; \delta.</code>
</p>

<p>If historical datasets are provided, the algorithm samples with replacement from the historical covariates to construct the simulated datasets.
Otherwise, the algorithm samples with replacement from <code>x.samples</code>. One of the arguments <code>historical</code> and <code>x.samples</code> must be provided.
</p>
<p>The sampling prior for the treatment parameter can be generated from a normal distribution (see examples).
For example, suppose one wants to compute the power for the hypotheses <code class="reqn">H_0: \beta_1 \ge 0</code> and <code class="reqn">H_1: \beta_1 &lt; 0.</code>
To approximate the sampling prior for <code class="reqn">\beta_1</code>, one can simply sample from a normal distribution with negative mean,
so that the mass of the prior falls in the alternative space. Conversely, to compute the type I error rate, one can
sample from a normal distribution with positive mean, so that the mass of the prior falls in the null space.
</p>
<p>The sampling prior for the other parameters (<code class="reqn">\beta_2</code>, ..., <code class="reqn">\beta_p</code>, <code class="reqn">\lambda</code> and <code class="reqn">\lambda_0</code>) can be generated from the posterior based on the historical data.
This can be achieved by the function <a href="#topic+phm.fixed.a0">phm.fixed.a0</a>
with <code>current.data</code> set to <code>FALSE</code> (see the vignette).
</p>
<p>Posterior samples are obtained through slice sampling.
The default lower limits are -100 for <code class="reqn">\beta</code> and 0 for <code class="reqn">\lambda</code> and <code class="reqn">\lambda_0</code>. The default upper limits
for the parameters are 100. The default slice widths for the parameters are 0.1.
The defaults may not be appropriate for all situations, and the user can specify the appropriate limits
and slice width for each parameter.
</p>
<p>If a sampling prior with support in the null space is used, the value returned is a Bayesian type I error rate.
If a sampling prior with support in the alternative space is used, the value returned is a Bayesian power.
</p>


<h3>Value</h3>

<p>Power or type I error is returned, depending on the sampling prior used.
The posterior probabilities of the alternative hypothesis are returned.
The average posterior means of <code class="reqn">\beta</code>, <code class="reqn">\lambda</code> and <code class="reqn">\lambda_0</code>
(if the baseline hazard parameters are not shared) are also returned.
</p>


<h3>References</h3>

<p>Ibrahim, J. G., Chen, M.-H. and Sinha, D. (2001). Bayesian Survival Analysis. New York: Springer Science &amp; Business Media.
</p>
<p>Psioda, M. A. and Ibrahim, J. G. (2019). Bayesian clinical trial design using historical data that inform the treatment effect. Biostatistics 20, 400–415.
</p>
<p>Shen, Y., Psioda, M. A., and Joseph, J. G. (2023). BayesPPD: an R package for Bayesian sample size determination using the power and normalized power prior for generalized linear models. The R Journal, 14(4).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+phm.fixed.a0">phm.fixed.a0</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

# Simulate two historical datasets
set.seed(1)
n &lt;- 100
P &lt;- 4
time1 &lt;- round(rexp(n, rate=0.5),1)
event1 &lt;- rep(1,n)
X1 &lt;- matrix(rbinom(n*P,prob=0.5,size=1), ncol=P)
S1 &lt;- c(rep(1,n/2),rep(2,n/2))
time2 &lt;- round(rexp(n, rate=0.7),1)
event2 &lt;- rep(1,n)
X2 &lt;- matrix(rbinom(n*P,prob=0.5,size=1), ncol=P)
S2 &lt;- c(rep(1,n/2),rep(2,n/2))
historical &lt;- list(list(time=time1, event=event1, X=X1, S=S1),
                   list(time=time2, event=event2, X=X2, S=S2))

# a0 is 0.3 for the first historical dataset and 0.6 for the second
a0 &lt;- c(0.3, 0.6)

n.subjects &lt;- 100
n.events &lt;- 30

# We choose three intervals for the first stratum and two intervals for the second stratum
n.intervals &lt;- c(3,2) 
change.points &lt;- list(c(1,2),1)


# Generate sampling priors

# The null hypothesis here is H0: beta_1 &gt;= 0. To calculate power,
# we can provide samples of beta_1 such that the mass of beta_1 &lt; 0.
# To calculate type I error, we can provide samples of beta_1 such that
# the mass of beta_1 &gt;= 0.
samp.prior.beta1 &lt;- rnorm(100, mean=-1, sd=1)
# Here, mass is put on the alternative region, so power is calculated.
samp.prior.beta &lt;- cbind(samp.prior.beta1, matrix(rnorm(100*(P-1)), 100, P-1))

# Point mass sampling priors are used for lambda
lambda_strat1 &lt;- matrix(c(0.5, 0.5, 0.5), nrow=1)
lambda_strat2 &lt;- matrix(c(0.7, 0.7), nrow=1)
samp.prior.lambda &lt;- list(lambda_strat1, lambda_strat2)


nMC &lt;- 100 # nMC should be larger in practice
nBI &lt;- 50
N &lt;- 5 # N should be larger in practice

result &lt;- power.phm.fixed.a0(historical=historical, a0=a0, n.subjects=n.subjects, 
                             n.events=n.events, n.intervals=n.intervals,
                             change.points=change.points, 
                             samp.prior.beta=samp.prior.beta, 
                             samp.prior.lambda=samp.prior.lambda,
                             dist.enroll="Uniform", param.enroll=0.5,
                             nMC=nMC, nBI=nBI, delta=0, nullspace.ineq="&gt;", N=N)
result$`power/type I error`
result$`average posterior mean of beta`
result$`average posterior mean of lambda`
result$`average posterior mean of lambda0`



</code></pre>

<hr>
<h2 id='power.phm.random.a0'>Power/type I error calculation for the proportional hazards model with piecewise constant hazard and random a0</h2><span id='topic+power.phm.random.a0'></span>

<h3>Description</h3>

<p>Power/type I error calculation using the normalized power prior for the proportional hazards model with piecewise constant hazard and random <code class="reqn">a_0</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>power.phm.random.a0(
  historical,
  n.subjects,
  n.events,
  n.intervals,
  change.points = NULL,
  samp.prior.beta,
  samp.prior.lambda,
  dist.enroll,
  param.enroll,
  rand.prob = 0.5,
  prob.drop = 0,
  param.drop = 0,
  dist.csr = "Constant",
  param.csr = 10000,
  min.follow.up = 0,
  max.follow.up = 10000,
  prior.beta.mvn = NULL,
  prior.beta.mean = rep(0, 50),
  prior.beta.sd = rep(1000, 50),
  prior.lambda0.hp1 = rep(10^(-5), 50),
  prior.lambda0.hp2 = rep(10^(-5), 50),
  prior.a0.shape1 = rep(1, 10),
  prior.a0.shape2 = rep(1, 10),
  prior.lambda.hp1 = rep(10^(-5), 50),
  prior.lambda.hp2 = rep(10^(-5), 50),
  lower.limits = NULL,
  upper.limits = rep(100, 50),
  slice.widths = rep(0.1, 50),
  nMC = 10000,
  nBI = 250,
  delta = 0,
  nullspace.ineq = "&gt;",
  gamma = 0.95,
  N = 10000
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="power.phm.random.a0_+3A_historical">historical</code></td>
<td>
<p>List of historical dataset(s). East historical dataset is stored in a list which contains four <em>named</em> elements: <code>time</code>, <code>event</code>, <code>X</code> and <code>S</code>.
</p>

<ul>
<li> <p><code>time</code> is a vector of follow up times.
</p>
</li>
<li> <p><code>event</code> is a vector of status indicators. Normally 0=alive and 1=dead.
</p>
</li>
<li> <p><code>X</code> is a matrix of covariates. The first column must be the treatment indicator.
</p>
</li>
<li> <p><code>S</code> is a vector of integers, where each integer represents the stratum that the subject belongs to. For example, if there are three strata, S can take values 1, 2 or 3.
</p>
</li></ul>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_n.subjects">n.subjects</code></td>
<td>
<p>Number of subjects enrolled.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_n.events">n.events</code></td>
<td>
<p>Number of events at which the trial will stop.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_n.intervals">n.intervals</code></td>
<td>
<p>Vector of integers, indicating the number of intervals for the baseline hazards for each stratum. The length of the vector should be equal to the total number of strata.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_change.points">change.points</code></td>
<td>
<p>List of vectors. Each vector in the list contains the change points for the baseline hazards for each stratum. The length of the list should be equal to the total number of strata.
For a given stratum, if there is only one interval, then <code>change.points</code> should be <code>NULL</code> for that stratum. By default, we assign the change points so that the same number of events are observed in all the intervals in the historical data.
These change points are used for data generation. The change points used during model fitting are assigned by default so that the same number of events are observed in all the intervals in the pooled historical and generated current data.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_samp.prior.beta">samp.prior.beta</code></td>
<td>
<p>Matrix of possible values of <code class="reqn">\beta</code> to sample (with replacement) from. Each row is a possible <code class="reqn">\beta</code> vector (a realization from the sampling prior for <code class="reqn">\beta</code>).</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_samp.prior.lambda">samp.prior.lambda</code></td>
<td>
<p>List of matrices, where each matrix represents the sampling prior for the baseline hazards for each stratum. The number of columns of each matrix should be equal to the number of intervals for that stratum.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_dist.enroll">dist.enroll</code></td>
<td>
<p>Distribution for enrollment times. The choices are &quot;Uniform&quot; or &quot;Exponential&quot;.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_param.enroll">param.enroll</code></td>
<td>
<p>Parameter for the distribution of enrollment times. If <code>dist.enroll</code> is &quot;Uniform&quot;, the enrollment times follow Unif(0, <code>param.enroll</code>). If <code>dist.enroll</code> is &quot;Exponential&quot;,
the enrollment times follow Exponential(rate=<code>param.enroll</code>).</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_rand.prob">rand.prob</code></td>
<td>
<p>Randomization probability for the treated group. The default value is 0.5.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_prob.drop">prob.drop</code></td>
<td>
<p>Probability of subjects dropping out of the study (non-administrative censoring). The default value is zero.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_param.drop">param.drop</code></td>
<td>
<p>Parameter for dropout time simulations. The dropout times follow Unif(0, <code>param.drop</code>). The default value is zero.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_dist.csr">dist.csr</code></td>
<td>
<p>Distribution for (administrative) censorship times. The choices are &quot;Uniform&quot;, &quot;Constant&quot; and &quot;Exponential&quot;. The default choice is &quot;Constant&quot;.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_param.csr">param.csr</code></td>
<td>
<p>Parameter for the (administrative) censorship times. If <code>dist.csr</code> is &quot;Uniform&quot;, the censorship times follow Unif(0, <code>param.csr</code>).
If <code>dist.csr</code> is &quot;Constant&quot;, the censorship times of all subjects are equal to <code>param.csr</code>.
If <code>dist.csr</code> is &quot;Exponential&quot;, the censorship times follow Exponential(rate=<code>param.csr</code>).
The default value is 10^4.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_min.follow.up">min.follow.up</code></td>
<td>
<p>Minimum amount of time for which subjects are followed up. The default value is zero.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_max.follow.up">max.follow.up</code></td>
<td>
<p>Maximum amount of time for which subjects are followed up. The default value is 10^4.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_prior.beta.mvn">prior.beta.mvn</code></td>
<td>
<p>List of multivariate normal approximations of the normalized power prior for <code class="reqn">\beta</code>. Each element in the list is a list with three components,
the mean vector, the covariance matrix and the weight of the multivariate normal distribution. The normalized power prior for <code class="reqn">\beta</code>
is approximated by the weighted mixture of the multivariate normal distributions provided. By default (<code>prior.beta.mvn=NULL</code>), a single multivariate normal distribution is assumed.
The user can use the <code><a href="#topic+approximate.prior.beta">approximate.prior.beta</a></code> function to obtain samples of <code class="reqn">\beta</code> from the normalized power prior, and use any mixture of multivariate normals to approximate
the normalized power prior for <code class="reqn">\beta</code>.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_prior.beta.mean">prior.beta.mean</code></td>
<td>
<p>(Only applies if <code>prior.beta.mvn=NULL</code>) Vector of means of the normal initial prior on <code class="reqn">\beta</code>. The default value is zero for all the elements of <code class="reqn">\beta</code>.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_prior.beta.sd">prior.beta.sd</code></td>
<td>
<p>(Only applies if <code>prior.beta.mvn=NULL</code>) Vector of standard deviations of the normal initial prior on <code class="reqn">\beta</code>. The default value is 10^3 for all the elements of <code class="reqn">\beta</code>.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_prior.lambda0.hp1">prior.lambda0.hp1</code></td>
<td>
<p>(Only applies if <code>prior.beta.mvn=NULL</code>) Vector of first hyperparameters of the Gamma prior on <code class="reqn">\lambda_0</code>.
The length of the vector should be equal to the dimension of <code class="reqn">\lambda_0</code>, i.e., the total number of intervals for all strata. The default value is 10^(-5) for all the elements of <code class="reqn">\lambda_0</code>.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_prior.lambda0.hp2">prior.lambda0.hp2</code></td>
<td>
<p>(Only applies if <code>prior.beta.mvn=NULL</code>) Vector of second hyperparameters of the Gamma prior on <code class="reqn">\lambda_0</code>.
The length of the vector should be equal to the dimension of <code class="reqn">\lambda_0</code>, i.e., the total number of intervals for all strata. The default value is 10^(-5) for all the elements of <code class="reqn">\lambda_0</code>.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_prior.a0.shape1">prior.a0.shape1</code></td>
<td>
<p>(Only applies if <code>prior.beta.mvn=NULL</code>) Vector of the first shape parameters of the independent beta priors for <code class="reqn">a_0</code>. The length of the vector should be equal to the number of historical datasets. The default is a vector of one's.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_prior.a0.shape2">prior.a0.shape2</code></td>
<td>
<p>(Only applies if <code>prior.beta.mvn=NULL</code>) Vector of the second shape parameters of the independent beta priors for <code class="reqn">a_0</code>. The length of the vector should be equal to the number of historical datasets. The default is a vector of one's.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_prior.lambda.hp1">prior.lambda.hp1</code></td>
<td>
<p>Vector of first hyperparameters of the Gamma prior on <code class="reqn">\lambda</code>.
The length of the vector should be equal to the dimension of <code class="reqn">\lambda</code>, i.e., the total number of intervals for all strata. The default value is 10^(-5) for all the elements of <code class="reqn">\lambda</code>.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_prior.lambda.hp2">prior.lambda.hp2</code></td>
<td>
<p>Vector of second hyperparameters of the Gamma prior on <code class="reqn">\lambda</code>.
The length of the vector should be equal to the dimension of <code class="reqn">\lambda</code>, i.e., the total number of intervals for all strata. The default value is 10^(-5) for all the elements of <code class="reqn">\lambda</code>.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_lower.limits">lower.limits</code></td>
<td>
<p>Vector of lower limits for parameters (<code class="reqn">\beta</code> and <code class="reqn">\lambda</code>, in this order) to be used by the slice sampler. The length of the vector should be equal to the total number of parameters. The default is -100 for <code class="reqn">\beta</code> and 0 for <code class="reqn">\lambda</code> (may not be appropriate for all situations).</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_upper.limits">upper.limits</code></td>
<td>
<p>Vector of upper limits for parameters (<code class="reqn">\beta</code> and <code class="reqn">\lambda</code>, in this order) to be used by the slice sampler. The length of the vector should be equal to the total number of parameters. The default is 100 for all parameters (may not be appropriate for all situations).</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_slice.widths">slice.widths</code></td>
<td>
<p>Vector of initial slice widths for parameters (<code class="reqn">\beta</code> and <code class="reqn">\lambda</code>, in this order) to be used by the slice sampler. The length of the vector should be equal to the total number of parameters. The default is 0.1 for all parameters (may not be appropriate for all situations).</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_nmc">nMC</code></td>
<td>
<p>Number of iterations (excluding burn-in samples) for the slice sampler. The default is 10,000.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_nbi">nBI</code></td>
<td>
<p>Number of burn-in samples for the slice sampler. The default is 250.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_delta">delta</code></td>
<td>
<p>Prespecified constant that defines the boundary of the null hypothesis. The default is zero.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_nullspace.ineq">nullspace.ineq</code></td>
<td>
<p>Character string specifying the inequality of the null hypothesis. The options are &quot;&gt;&quot; and &quot;&lt;&quot;. If &quot;&gt;&quot; is specified, the null hypothesis is <code class="reqn">H_0</code>: <code class="reqn">\beta_1</code> <code class="reqn">\ge</code> <code class="reqn">\delta</code>. If &quot;&lt;&quot; is specified, the null hypothesis is <code class="reqn">H_0</code>: <code class="reqn">\beta_1</code> <code class="reqn">\le</code> <code class="reqn">\delta</code>. The default choice is &quot;&gt;&quot;.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_gamma">gamma</code></td>
<td>
<p>Posterior probability threshold for rejecting the null. The null hypothesis is rejected if posterior probability is greater <code>gamma</code>. The default is 0.95.</p>
</td></tr>
<tr><td><code id="power.phm.random.a0_+3A_n">N</code></td>
<td>
<p>Number of simulated datasets to generate. The default is 10,000.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The proportional hazards model with piecewise constant hazard is implemented.
We assume <code class="reqn">\beta</code> is the regression coefficients. We assume the first column of the covariate matrix is the treatment indicator,
and the corresponding parameter is <code class="reqn">\beta_1</code>. Here <code class="reqn">a_0</code> is modeled as random with a normalized power prior.
</p>
<p>The normalized power prior for <code class="reqn">\beta</code> is approximated by a weighted mixture of multivariate normal distributions provided in <code>prior.beta.mvn</code>.
The user can use the <code><a href="#topic+approximate.prior.beta">approximate.prior.beta</a></code> function to obtain samples of <code class="reqn">\beta</code> from the normalized power prior, and use any mixture of multivariate normals to approximate
the normalized power prior for <code class="reqn">\beta</code>. By default, a single multivariate normal distribution is assumed.
</p>
<p>Baseline hazard parameters for the
current and historical data are NOT shared. The baseline hazards of the current data are denoted by <code class="reqn">\lambda</code>.
The baseline hazards of the historical data are denoted by <code class="reqn">\lambda_0</code>. We assume Gamma priors for
<code class="reqn">\lambda</code> and <code class="reqn">\lambda_0</code>.
</p>
<p>To perform sample size determination, we test the hypotheses
</p>
<p style="text-align: center;"><code class="reqn">H_0: \beta_1 \ge \delta</code>
</p>
<p> and </p>
<p style="text-align: center;"><code class="reqn">H_1: \beta_1 &lt; \delta.</code>
</p>

<p>The sampling prior for the treatment parameter can be generated from a normal distribution (see examples).
For example, suppose one wants to compute the power for the hypotheses <code class="reqn">H_0: \beta_1 \ge 0</code> and <code class="reqn">H_1: \beta_1 &lt; 0.</code>
To approximate the sampling prior for <code class="reqn">\beta_1</code>, one can simply sample from a normal distribution with negative mean,
so that the mass of the prior falls in the alternative space. Conversely, to compute the type I error rate, one can
sample from a normal distribution with positive mean, so that the mass of the prior falls in the null space.
</p>
<p>The sampling prior for the other parameters (<code class="reqn">\beta_2</code>, ..., <code class="reqn">\beta_p</code> and <code class="reqn">\lambda</code>) can be generated from the posterior based on the historical data.
This can be achieved by the function <a href="#topic+phm.fixed.a0">phm.fixed.a0</a>
with <code>current.data</code> set to <code>FALSE</code> (see the vignette).
</p>
<p>Posterior samples are obtained through slice sampling.
The default lower limits are -100 for <code class="reqn">\beta</code> and 0 for <code class="reqn">\lambda</code>. The default upper limits
for the parameters are 100. The default slice widths for the parameters are 0.1.
The defaults may not be appropriate for all situations, and the user can specify the appropriate limits
and slice width for each parameter.
</p>
<p>If a sampling prior with support in the null space is used, the value returned is a Bayesian type I error rate.
If a sampling prior with support in the alternative space is used, the value returned is a Bayesian power.
</p>


<h3>Value</h3>

<p>Power or type I error is returned, depending on the sampling prior used.
The posterior probabilities of the alternative hypothesis are returned.
The average posterior means of <code class="reqn">\beta</code> and <code class="reqn">\lambda</code> are also returned.
</p>


<h3>References</h3>

<p>Ibrahim, J. G., Chen, M.-H. and Sinha, D. (2001). Bayesian Survival Analysis. New York: Springer Science &amp; Business Media.
</p>
<p>Psioda, M. A. and Ibrahim, J. G. (2019). Bayesian clinical trial design using historical data that inform the treatment effect. Biostatistics 20, 400–415.
</p>
<p>Shen, Y., Psioda, M. A., and Joseph, J. G. (2023). BayesPPD: an R package for Bayesian sample size determination using the power and normalized power prior for generalized linear models. The R Journal, 14(4).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+phm.random.a0">phm.random.a0</a></code> and <code><a href="#topic+approximate.prior.beta">approximate.prior.beta</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

# Simulate two historical datasets
set.seed(1)
n &lt;- 100
P &lt;- 4
time1 &lt;- round(rexp(n, rate=0.5),1)
event1 &lt;- rep(1,n)
X1 &lt;- matrix(rbinom(n*P,prob=0.5,size=1), ncol=P)
S1 &lt;- c(rep(1,n/2),rep(2,n/2))
time2 &lt;- round(rexp(n, rate=0.7),1)
event2 &lt;- rep(1,n)
X2 &lt;- matrix(rbinom(n*P,prob=0.5,size=1), ncol=P)
S2 &lt;- c(rep(1,n/2),rep(2,n/2))
historical &lt;- list(list(time=time1, event=event1, X=X1, S=S1),
                   list(time=time2, event=event2, X=X2, S=S2))

n.subjects &lt;- 100
n.events &lt;- 30

# We choose three intervals for the first stratum and two intervals for the second stratum
n.intervals &lt;- c(3,2) 
change.points &lt;- list(c(1,2),1)

# Generate sampling priors

# The null hypothesis here is H0: beta_1 &gt;= 0. To calculate power,
# we can provide samples of beta_1 such that the mass of beta_1 &lt; 0.
# To calculate type I error, we can provide samples of beta_1 such that
# the mass of beta_1 &gt;= 0.
samp.prior.beta1 &lt;- rnorm(100, mean=-1, sd=1)
# Here, mass is put on the alternative region, so power is calculated.
samp.prior.beta &lt;- cbind(samp.prior.beta1, matrix(rnorm(100*(P-1)), 100, P-1))

# Point mass sampling priors are used for lambda
lambda_strat1 &lt;- matrix(c(0.5, 0.5, 0.5), nrow=1)
lambda_strat2 &lt;- matrix(c(0.7, 0.7), nrow=1)
samp.prior.lambda &lt;- list(lambda_strat1, lambda_strat2)


nMC &lt;- 50 # nMC should be larger in practice
nBI &lt;- 50
N &lt;- 5 # N should be larger in practice

result &lt;- power.phm.random.a0(historical=historical, n.subjects=n.subjects, 
                              n.events=n.events, n.intervals=n.intervals,
                              change.points=change.points,  
                              samp.prior.beta=samp.prior.beta, 
                              samp.prior.lambda=samp.prior.lambda,
                              prior.a0.shape1 = c(1,1), prior.a0.shape2 = c(1,1),
                              dist.enroll="Uniform", param.enroll=0.5,
                              nMC=nMC, nBI=nBI, delta=0, nullspace.ineq="&gt;", N=N)
result$`power/type I error`
result$`average posterior mean of beta`
result$`average posterior mean of lambda`



</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
