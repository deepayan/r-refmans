<!DOCTYPE html><html lang="en"><head><title>Help for package CLVTools</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {CLVTools}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#CLVTools-package'><p>Customer Lifetime Value Tools</p></a></li>
<li><a href='#apparelDynCov'><p>Time-varying Covariates for the Apparel Retailer Dataset</p></a></li>
<li><a href='#apparelDynCovFuture'><p>Future Time-varying Covariates for the Apparel Retailer Dataset</p></a></li>
<li><a href='#apparelStaticCov'><p>Time-invariant Covariates for the Apparel Retailer Dataset</p></a></li>
<li><a href='#apparelTrans'><p>Apparel Retailer Dataset</p></a></li>
<li><a href='#as.clv.data'><p>Coerce to clv.data object</p></a></li>
<li><a href='#as.data.frame.clv.data'><p>Coerce to a Data Frame</p></a></li>
<li><a href='#as.data.table.clv.data'><p>Coerce to a Data Table</p></a></li>
<li><a href='#bgbb'><p>BG/BB models - Work In Progress</p></a></li>
<li><a href='#bgnbd'><p>BG/NBD models</p></a></li>
<li><a href='#bgnbd_CET'><p>BG/NBD: Conditional Expected Transactions</p></a></li>
<li><a href='#bgnbd_expectation'><p>BG/NBD: Unconditional Expectation</p></a></li>
<li><a href='#bgnbd_LL'><p>BG/NBD: Log-Likelihood functions</p></a></li>
<li><a href='#bgnbd_PAlive'><p>BG/NBD: Probability of Being Alive</p></a></li>
<li><a href='#bgnbd_pmf'><p>BG/NBD: Probability Mass Function (PMF)</p></a></li>
<li><a href='#cdnow'><p>CDNOW dataset</p></a></li>
<li><a href='#clv.bgnbd-class'><p>Result of fitting the BG/NBD model without covariates</p></a></li>
<li><a href='#clv.bgnbd.static.cov-class'><p>Result of fitting the BG/NBD model with static covariates</p></a></li>
<li><a href='#clv.bootstrapped.apply'><p>Bootstrapping: Fit a model again on sampled data and apply method</p></a></li>
<li><a href='#clv.data-class'><p>Transactional data to fit CLV models</p></a></li>
<li><a href='#clv.data.dynamic.covariates-class'><p>Transactional and dynamic covariates data to fit CLV models</p></a></li>
<li><a href='#clv.data.static.covariates-class'><p>Transactional and static covariates data to fit CLV models</p></a></li>
<li><a href='#clv.fitted-class'><p>Fitted model without covariates</p></a></li>
<li><a href='#clv.fitted.spending-class'><p>Fitted Spending Model</p></a></li>
<li><a href='#clv.fitted.transactions-class'><p>Fitted Transaction Model without covariates</p></a></li>
<li><a href='#clv.fitted.transactions.dynamic.cov-class'><p>Fitted CLV Model with Dynamic covariates</p></a></li>
<li><a href='#clv.fitted.transactions.static.cov-class'><p>Fitted Transaction Model with Static covariates</p></a></li>
<li><a href='#clv.gg-class'><p>Result of fitting the Gamma-Gamma model</p></a></li>
<li><a href='#clv.ggomnbd-class'><p>Result of fitting the GGompertz/NBD model without covariates</p></a></li>
<li><a href='#clv.ggomnbd.static.cov-class'><p>Result of fitting the GGompertz/NBD model with static covariates</p></a></li>
<li><a href='#clv.model-class'><p>CLV Model providing model related functionalities</p></a></li>
<li><a href='#clv.model.bgnbd.no.cov-class'><p>CLV Model functionality for BG/NBD without covariates</p></a></li>
<li><a href='#clv.model.bgnbd.static.cov-class'><p>CLV Model functionality for BG/NBD with static covariates</p></a></li>
<li><a href='#clv.model.gg-class'><p>CLV Model functionality for the Gamma-Gamma spending model</p></a></li>
<li><a href='#clv.model.ggomnbd.no.cov-class'><p>CLV Model functionality for GGompertz/NBD without covariates</p></a></li>
<li><a href='#clv.model.ggomnbd.static.cov-class'><p>CLV Model functionality for GGompertz/NBD with static covariates</p></a></li>
<li><a href='#clv.model.no.correlation-class'><p>CLV Model without support for life-trans correlation</p></a></li>
<li><a href='#clv.model.pnbd.dynamic.cov-class'><p>CLV Model functionality for PNBD with dynamic covariates</p></a></li>
<li><a href='#clv.model.pnbd.no.cov-class'><p>CLV Model functionality for Pareto/NBD without covariates</p></a></li>
<li><a href='#clv.model.pnbd.static.cov-class'><p>CLV Model functionality for Pareto/NBD with static covariates</p></a></li>
<li><a href='#clv.model.with.correlation-class'><p>CLV Model providing life-trans correlation related functionalities</p></a></li>
<li><a href='#clv.pnbd-class'><p>Result of fitting the Pareto/NBD model without covariates</p></a></li>
<li><a href='#clv.pnbd.dynamic.cov-class'><p>Result of fitting the Pareto/NBD model with dynamic covariates</p></a></li>
<li><a href='#clv.pnbd.static.cov-class'><p>Result of fitting the Pareto/NBD model with static covariates</p></a></li>
<li><a href='#clv.time-class'><p>Time Unit defining conceptual periods</p></a></li>
<li><a href='#clv.time.date-class'><p>Date based time-units</p></a></li>
<li><a href='#clv.time.datetime-class'><p>POSIXct based time-units</p></a></li>
<li><a href='#clv.time.days-class'><p>Time unit representing a single Day</p></a></li>
<li><a href='#clv.time.hours-class'><p>Time unit representing a single hour</p></a></li>
<li><a href='#clv.time.weeks-class'><p>Time unit representing a single Week</p></a></li>
<li><a href='#clv.time.years-class'><p>Time unit representing a single Year</p></a></li>
<li><a href='#clvdata'><p>Create an object for transactional data required to estimate CLV</p></a></li>
<li><a href='#fitted.clv.fitted'><p>Extract Unconditional Expectation</p></a></li>
<li><a href='#gg'><p>Gamma/Gamma Spending model</p></a></li>
<li><a href='#gg_LL'><p>Gamma-Gamma: Log-Likelihood Function</p></a></li>
<li><a href='#ggomnbd'><p>Gamma-Gompertz/NBD model</p></a></li>
<li><a href='#ggomnbd_CET'><p>GGompertz/NBD: Conditional Expected Transactions</p></a></li>
<li><a href='#ggomnbd_expectation'><p>GGompertz/NBD: Unconditional Expectation</p></a></li>
<li><a href='#ggomnbd_LL'><p>GGompertz/NBD: Log-Likelihood functions</p></a></li>
<li><a href='#ggomnbd_PAlive'><p>GGompertz/NBD: Probability of Being Alive</p></a></li>
<li><a href='#ggomnbd_PMF'><p>GGompertz/NBD: Probability Mass Function (PMF)</p></a></li>
<li><a href='#latentAttrition'><p>Formula Interface for Latent Attrition Models</p></a></li>
<li><a href='#lrtest'><p>Likelihood Ratio Test of Nested Models</p></a></li>
<li><a href='#newcustomer'><p>New customer prediction data</p></a></li>
<li><a href='#nobs.clv.data'><p>Number of observations</p></a></li>
<li><a href='#nobs.clv.fitted'><p>Number of observations</p></a></li>
<li><a href='#plot.clv.data'><p>Plot Diagnostics for the Transaction data in a clv.data Object</p></a></li>
<li><a href='#plot.clv.fitted.spending'><p>Plot expected and actual mean spending per transaction</p></a></li>
<li><a href='#plot.clv.fitted.transactions'><p>Plot Diagnostics for a Fitted Transaction Model</p></a></li>
<li><a href='#pmf'><p>Probability Mass Function</p></a></li>
<li><a href='#pnbd'><p>Pareto/NBD models</p></a></li>
<li><a href='#pnbd_CET'><p>Pareto/NBD: Conditional Expected Transactions</p></a></li>
<li><a href='#pnbd_DERT'><p>Pareto/NBD: Discounted Expected Residual Transactions</p></a></li>
<li><a href='#pnbd_expectation'><p>Pareto/NBD: Unconditional Expectation</p></a></li>
<li><a href='#pnbd_LL'><p>Pareto/NBD: Log-Likelihood functions</p></a></li>
<li><a href='#pnbd_PAlive'><p>Pareto/NBD: Probability of Being Alive</p></a></li>
<li><a href='#pnbd_pmf'><p>Pareto/NBD: Probability Mass Function (PMF)</p></a></li>
<li><a href='#predict.clv.fitted.spending'><p>Infer customers' spending</p></a></li>
<li><a href='#predict.clv.fitted.transactions'><p>Predict CLV from a fitted transaction model</p></a></li>
<li><a href='#print.clv.time'><p>Summarizing a CLV time object</p></a></li>
<li><a href='#SetDynamicCovariates'><p>Add Dynamic Covariates to a CLV data object</p></a></li>
<li><a href='#SetStaticCovariates'><p>Add Static Covariates to a CLV data object</p></a></li>
<li><a href='#spending'><p>Formula Interface for Spending Models</p></a></li>
<li><a href='#subset.clv.data'><p>Subsetting clv.data</p></a></li>
<li><a href='#summary.clv.data'><p>Summarizing a CLV data object</p></a></li>
<li><a href='#summary.clv.fitted'><p>Summarizing a fitted CLV model</p></a></li>
<li><a href='#vcov.clv.fitted'><p>Calculate Variance-Covariance Matrix for CLV Models fitted with Maximum Likelihood Estimation</p></a></li>
<li><a href='#vec_gsl_hyp2f0_e'><p>GSL Hypergeometric 2F0 for equal length vectors</p></a></li>
<li><a href='#vec_gsl_hyp2f1_e'><p>GSL Hypergeometric 2F1 for equal length vectors</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Tools for Customer Lifetime Value Estimation</td>
</tr>
<tr>
<td>Version:</td>
<td>0.11.2</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-12-01</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0), methods</td>
</tr>
<tr>
<td>Description:</td>
<td>
    A set of state-of-the-art probabilistic modeling approaches to derive estimates of individual customer lifetime values (CLV).
    Commonly, probabilistic approaches focus on modelling 3 processes, i.e. individuals' attrition, transaction, and spending process. 
    Latent customer attrition models, which are also known as "buy-'til-you-die models", model the attrition as well as the transaction process. 
    They are used to make inferences and predictions about transactional patterns of individual customers such as their future purchase behavior. 
    Moreover, these models have also been used to predict individualsâ€™ long-term engagement in activities such as playing an online game or 
    posting to a social media platform. The spending process is usually modelled by a separate probabilistic model. Combining these results yields in 
    lifetime values estimates for individual customers.
    This package includes fast and accurate implementations of various probabilistic models for non-contractual settings 
    (e.g., grocery purchases or hotel visits). All implementations support time-invariant covariates, which can be used to control for e.g., 
    socio-demographics. If such an extension has been proposed in literature, we further provide the possibility to control for time-varying 
    covariates to control for e.g., seasonal patterns. 
    Currently, the package includes the following latent attrition models to model individuals' attrition and transaction process: 
    [1] Pareto/NBD model (Pareto/Negative-Binomial-Distribution), 
    [2] the Extended Pareto/NBD model (Pareto/Negative-Binomial-Distribution with time-varying covariates), 
    [3] the BG/NBD model (Beta-Gamma/Negative-Binomial-Distribution) and the 
    [4] GGom/NBD (Gamma-Gompertz/Negative-Binomial-Distribution). 
    Further, we provide an implementation of the Gamma/Gamma model to model the spending process of individuals.</td>
</tr>
<tr>
<td>Imports:</td>
<td>data.table (&ge; 1.12.0), digest (&ge; 0.6.0), Formula (&ge; 1.2-4),
ggplot2 (&ge; 3.2.0), lubridate (&ge; 1.7.8), numDeriv (&ge;
2016.8-1.1), Matrix (&ge; 1.2-17), MASS, optimx (&ge; 2019-12.02),
Rcpp(&ge; 0.12.12), stats, utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>covr, knitr, rmarkdown, xml2, testthat (&ge; 3.0.0), lmtest</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/bachmannpatrick/CLVTools">https://github.com/bachmannpatrick/CLVTools</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/bachmannpatrick/CLVTools/issues">https://github.com/bachmannpatrick/CLVTools/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo (&ge; 0.11.4.0.1), RcppGSL (&ge; 0.3.7),
testthat</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>GNU GSL</td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Collate:</td>
<td>'CLVTools.R' 'RcppExports.R' 'all_generics.R'
'catch-routine-registration.R' 'class_clv_time.R'
'class_clv_data.R' 'class_clv_model.R' 'class_clv_fitted.R'
'class_clv_fitted_transactions.R'
'class_clv_model_nocorrelation.R' 'class_clv_model_bgnbd.R'
'class_clv_bgnbd.R' 'class_clv_fitted_transactions_staticcov.R'
'class_clv_data_staticcovariates.R'
'class_clv_model_bgnbd_staticcov.R'
'class_clv_bgnbd_staticcov.R'
'class_clv_data_dynamiccovariates.R'
'class_clv_fitted_spending.R'
'class_clv_fitted_transactions_dynamiccov.R'
'class_clv_model_gg.R' 'class_clv_gg.R'
'class_clv_model_ggomnbd_nocov.R' 'class_clv_ggomnbd.R'
'class_clv_model_ggomnbd_staticcov.R'
'class_clv_ggomnbd_staticcov.R'
'class_clv_model_withcorrelation.R' 'class_clv_model_pnbd.R'
'class_clv_model_pnbd_staticcov.R'
'class_clv_model_pnbd_dynamiccov.R' 'class_clv_pnbd.R'
'class_clv_pnbd_dynamiccov.R' 'class_clv_pnbd_staticcov.R'
'class_clv_time_date.R' 'class_clv_time_datetime.R'
'class_clv_time_days.R' 'class_clv_time_hours.R'
'class_clv_time_weeks.R' 'class_clv_time_years.R'
'clv_template_controlflow_estimate.R'
'clv_template_controlflow_pmf.R'
'clv_template_controlflow_predict.R' 'data.R'
'f_DoExpectation.R' 'f_clvdata_inputchecks.R'
'f_clvfitted_inputchecks.R' 'f_generics_clvdata.R'
'f_generics_clvdatadyncov.R' 'f_generics_clvdatastaticcov.R'
'f_generics_clvfitted.R' 'f_generics_clvfitted_estimate.R'
'f_generics_clvfittedspending.R'
'f_generics_clvfittedtransactions.R'
'f_generics_clvfittedtransactionsdyncov.R'
'f_generics_clvfittedtransactionsstaticcov.R'
'f_generics_clvfittedtransactionsstaticcov_estimate.R'
'f_generics_clvpnbddyncov.R' 'f_interface_bgbb.R'
'f_interface_bgnbd.R' 'f_interface_bootstrappedapply.R'
'f_interface_clvdata.R' 'f_interface_gg.R'
'f_interface_ggomnbd.R' 'f_interface_latentattrition.R'
'f_interface_lrtest.R' 'f_interface_newcustomer.R'
'f_interface_pmf.R' 'f_interface_pnbd.R'
'f_interface_predict_clvfittedspending.R'
'f_interface_predict_clvfittedtransactions.R'
'f_interface_setdynamiccovariates.R'
'f_interface_setstaticcovariates.R' 'f_interface_spending.R'
'f_s3generics_clvdata.R' 'f_s3generics_clvdata_dynamiccov.R'
'f_s3generics_clvdata_plot.R'
'f_s3generics_clvdata_staticcov.R' 'f_s3generics_clvfitted.R'
'f_s3generics_clvfittedspending_plot.R'
'f_s3generics_clvfittedtransactions_plot.R'
'f_s3generics_clvfittedtransactions_staticcov.R'
'f_s3generics_clvtime.R' 'interlayer_callLL.R'
'interlayer_callnextinterlayer.R' 'interlayer_constraints.R'
'interlayer_correlation.R' 'interlayer_manager.R'
'interlayer_regularization.R' 'pnbd_dyncov_ABCD.R'
'pnbd_dyncov_BkSum.R' 'pnbd_dyncov_CET.R' 'pnbd_dyncov_DECT.R'
'pnbd_dyncov_createwalks.R' 'pnbd_dyncov_expectation.R'
'pnbd_dyncov_palive.R'</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/testthat/parallel:</td>
<td>false</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-12-02 21:43:54 UTC; rstudio</td>
</tr>
<tr>
<td>Author:</td>
<td>Patrick Bachmann [cre, aut],
  Niels Kuebler [aut],
  Markus Meierer [aut],
  Jeffrey Naef [aut],
  E. Shin Oblander [aut],
  Patrik Schilter [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Patrick Bachmann &lt;pbachma@ethz.ch&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-12-02 22:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='CLVTools-package'>Customer Lifetime Value Tools</h2><span id='topic+CLVTools'></span><span id='topic+CLVTools-package'></span>

<h3>Description</h3>

<p>CLVTools is a toolbox for various probabilistic customer attrition models
for non-contractual settings. It provides a framework, which is capable
of unifying different probabilistic customer attrition models. This package
provides tools to estimate the number of future transactions of individual
customers as well as the probability of customers being alive in future
periods. Further, the average spending by customers can be estimated.
Multiplying the future transactions conditional on being alive and the
predicted individual spending per transaction results in an individual CLV value.
</p>
<p>The implemented models require transactional data from non-contractual
businesses (i.e. customers' purchase history).
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Patrick Bachmann <a href="mailto:pbachma@ethz.ch">pbachma@ethz.ch</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> Niels Kuebler <a href="mailto:niels.kuebler@uzh.ch">niels.kuebler@uzh.ch</a>
</p>
</li>
<li><p> Markus Meierer <a href="mailto:markus.meierer@business.uzh.ch">markus.meierer@business.uzh.ch</a>
</p>
</li>
<li><p> Jeffrey Naef <a href="mailto:naef@stat.math.ethz.ch">naef@stat.math.ethz.ch</a>
</p>
</li>
<li><p> E. Shin Oblander <a href="mailto:eoblander23@gsb.columbia.edu">eoblander23@gsb.columbia.edu</a>
</p>
</li>
<li><p> Patrik Schilter <a href="mailto:patrik.schilter@gmail.com">patrik.schilter@gmail.com</a>
</p>
</li></ul>



<h3>See Also</h3>

<p>Development for CLVTools can be followed via the GitHub repository
at <a href="https://github.com/bachmannpatrick/CLVTools">https://github.com/bachmannpatrick/CLVTools</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


data("cdnow")

# Create a CLV data object, split data in estimation and holdout sample
clv.data.cdnow &lt;- clvdata(data.transactions = cdnow, date.format = "ymd",
                          time.unit = "week", estimation.split = 39, name.id = "Id")

# summary of data
summary(clv.data.cdnow)

# Fit a PNBD model without covariates on the first 39 periods
pnbd.cdnow &lt;- pnbd(clv.data.cdnow,
                   start.params.model = c(r=0.5, alpha=8, s=0.5, beta=10))
# inspect fit
summary(pnbd.cdnow)

# Predict 10 periods (weeks) ahead from estimation end
#   and compare to actuals in this period
pred.out &lt;- predict(pnbd.cdnow, prediction.end = 10)

# Plot the fitted model to the actual repeat transactions
plot(pnbd.cdnow)



</code></pre>

<hr>
<h2 id='apparelDynCov'>Time-varying Covariates for the Apparel Retailer Dataset</h2><span id='topic+apparelDynCov'></span>

<h3>Description</h3>

<p>This simulated data contains seasonal information and additional covariates on all 600 customers in the &quot;apparelTrans&quot; dataset.
This information can be used as time-varying covariates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("apparelDynCov")
</code></pre>


<h3>Format</h3>

<p>A data.table with 187,800 rows and 5 variables
</p>

<dl>
<dt>Id</dt><dd><p>Customer Id</p>
</dd>
<dt>Cov.Date</dt><dd><p>Date of contextual factor</p>
</dd>
<dt>High.Season</dt><dd><p>Seasonal variable: 1 indicating a time-period that is considered &quot;high season&quot;.</p>
</dd>
<dt>Gender</dt><dd><p>0=male, 1=female</p>
</dd>
<dt>Channel</dt><dd><p>Acquisition channel: 0=online, 1=offline</p>
</dd>
</dl>


<hr>
<h2 id='apparelDynCovFuture'>Future Time-varying Covariates for the Apparel Retailer Dataset</h2><span id='topic+apparelDynCovFuture'></span>

<h3>Description</h3>

<p>This simulated data contains seasonal information and additional covariates on all 600 customers in the &quot;apparelTrans&quot; after the last transaction in the dataset.
This information can be used as time-varying covariates for prediction future customer behavior.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("apparelDynCovFuture")
</code></pre>


<h3>Format</h3>

<p>A data.table with 56,400 rows and 5 variables
</p>

<dl>
<dt>Id</dt><dd><p>Customer Id</p>
</dd>
<dt>Cov.Date</dt><dd><p>Date of contextual factor</p>
</dd>
<dt>High.Season</dt><dd><p>Seasonal variable: 1 indicating a time-period that is considered &quot;high season&quot;.</p>
</dd>
<dt>Gender</dt><dd><p>0=male, 1=female</p>
</dd>
<dt>Channel</dt><dd><p>Acquisition channel: 0=online, 1=offline</p>
</dd>
</dl>


<hr>
<h2 id='apparelStaticCov'>Time-invariant Covariates for the Apparel Retailer Dataset</h2><span id='topic+apparelStaticCov'></span>

<h3>Description</h3>

<p>This simulated data contains additional demographic information on all 600 customers in the
&quot;apparelTrans&quot; dataset. This information can be used as time-invariant covariates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("apparelStaticCov")
</code></pre>


<h3>Format</h3>

<p>A <code>data.table</code> with 600 rows and 3 variables:
</p>

<dl>
<dt>Id</dt><dd><p>Customer Id</p>
</dd>
<dt>Gender</dt><dd><p>0=male, 1=female</p>
</dd>
<dt>Channel</dt><dd><p>Acquisition channel: 0=online, 1=offline</p>
</dd>
</dl>


<hr>
<h2 id='apparelTrans'>Apparel Retailer Dataset</h2><span id='topic+apparelTrans'></span>

<h3>Description</h3>

<p>This is a simulated dataset containing the entire purchase history of customers made their first purchase at an
apparel retailer on January 2nd 2005. In total the dataset contains 600 customers who made
3,187 transactions between January 2005 and end of December 2010.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("apparelTrans")
</code></pre>


<h3>Format</h3>

<p>A <code>data.table</code> with 3,187 rows and 3 variables:
</p>

<dl>
<dt><code>Id</code></dt><dd><p>Customer Id</p>
</dd>
<dt><code>Date</code></dt><dd><p>Date of purchase</p>
</dd>
<dt><code>Price</code></dt><dd><p>Price of purchase</p>
</dd>
</dl>


<hr>
<h2 id='as.clv.data'>Coerce to clv.data object</h2><span id='topic+as.clv.data'></span><span id='topic+as.clv.data.data.frame'></span><span id='topic+as.clv.data.data.table'></span>

<h3>Description</h3>

<p>Functions to coerce transaction data to a <code>clv.data</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as.clv.data(
  x,
  date.format = "ymd",
  time.unit = "weeks",
  estimation.split = NULL,
  name.id = "Id",
  name.date = "Date",
  name.price = "Price",
  ...
)

## S3 method for class 'data.frame'
as.clv.data(
  x,
  date.format = "ymd",
  time.unit = "weeks",
  estimation.split = NULL,
  name.id = "Id",
  name.date = "Date",
  name.price = "Price",
  ...
)

## S3 method for class 'data.table'
as.clv.data(
  x,
  date.format = "ymd",
  time.unit = "weeks",
  estimation.split = NULL,
  name.id = "Id",
  name.date = "Date",
  name.price = "Price",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as.clv.data_+3A_x">x</code></td>
<td>
<p>Transaction data.</p>
</td></tr>
<tr><td><code id="as.clv.data_+3A_date.format">date.format</code></td>
<td>
<p>Character string that indicates the format of the date variable in the data used. See details.</p>
</td></tr>
<tr><td><code id="as.clv.data_+3A_time.unit">time.unit</code></td>
<td>
<p>What time unit defines a period. May be abbreviated, capitalization is ignored. See details.</p>
</td></tr>
<tr><td><code id="as.clv.data_+3A_estimation.split">estimation.split</code></td>
<td>
<p>Indicates the length of the estimation period. See details.</p>
</td></tr>
<tr><td><code id="as.clv.data_+3A_name.id">name.id</code></td>
<td>
<p>Column name of the customer id in <code>x</code>.</p>
</td></tr>
<tr><td><code id="as.clv.data_+3A_name.date">name.date</code></td>
<td>
<p>Column name of the transaction date in <code>x</code>.</p>
</td></tr>
<tr><td><code id="as.clv.data_+3A_name.price">name.price</code></td>
<td>
<p>Column name of price in <code>x</code>. NULL if no spending data is present.</p>
</td></tr>
<tr><td><code id="as.clv.data_+3A_...">...</code></td>
<td>
<p>Ignored</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See section &quot;Details&quot; of <a href="#topic+clvdata">clvdata</a> for more details on parameters and usage.
</p>


<h3>Examples</h3>

<pre><code class='language-R'> # dont test because ncpu=2 limit on cran (too fast)
data(cdnow)

# Turn data.table of transaction data into a clv.data object,
#  using default date format and column names but no holdout period
clv.cdnow &lt;- as.clv.data(cdnow)


</code></pre>

<hr>
<h2 id='as.data.frame.clv.data'>Coerce to a Data Frame</h2><span id='topic+as.data.frame.clv.data'></span>

<h3>Description</h3>

<p>Extract a copy of the transaction data stored in the given clv.data object
into a data.frame.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'clv.data'
as.data.frame(
  x,
  row.names = NULL,
  optional = NULL,
  ids = NULL,
  sample = c("full", "estimation", "holdout"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as.data.frame.clv.data_+3A_x">x</code></td>
<td>
<p>An object of class <code>clv.data</code>.</p>
</td></tr>
<tr><td><code id="as.data.frame.clv.data_+3A_row.names">row.names</code></td>
<td>
<p>Ignored</p>
</td></tr>
<tr><td><code id="as.data.frame.clv.data_+3A_optional">optional</code></td>
<td>
<p>Ignored</p>
</td></tr>
<tr><td><code id="as.data.frame.clv.data_+3A_ids">ids</code></td>
<td>
<p>Character vector of customer ids for which transactions should be extracted. <code>NULL</code> extracts all.</p>
</td></tr>
<tr><td><code id="as.data.frame.clv.data_+3A_sample">sample</code></td>
<td>
<p>Name of sample for which transactions should be extracted,
either &quot;estimation&quot;, &quot;holdout&quot;, or &quot;full&quot; (default).</p>
</td></tr>
<tr><td><code id="as.data.frame.clv.data_+3A_...">...</code></td>
<td>
<p>Ignored</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>data.frame</code> with columns <code>Id</code>, <code>Date</code>, and <code>Price</code> (if present).
</p>


<h3>Examples</h3>

<pre><code class='language-R'> 
data("cdnow")
clv.data.cdnow &lt;- clvdata(data.transactions = cdnow,
                          date.format="ymd",
                          time.unit = "w",
                          estimation.split = 37)

# Extract all transaction data (all ids, estimation and holdout period)
df.trans &lt;- as.data.frame(clv.data.cdnow)

# Extract transaction data of estimation period
df.trans &lt;- as.data.frame(clv.data.cdnow, sample="estimation")

# Extract transaction data of ids "1", "2", and "999"
#  (estimation and holdout period)
df.trans &lt;- as.data.frame(clv.data.cdnow, ids = c("1", "2", "999"))

# Extract transaction data of ids "1", "2", and "999" in estimation period
df.trans &lt;- as.data.frame(clv.data.cdnow, ids = c("1", "2", "999"),
                          sample="estimation")


</code></pre>

<hr>
<h2 id='as.data.table.clv.data'>Coerce to a Data Table</h2><span id='topic+as.data.table.clv.data'></span>

<h3>Description</h3>

<p>Extract a copy of the transaction data stored in the given clv.data object
into a data.table.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'clv.data'
as.data.table(
  x,
  keep.rownames = FALSE,
  ids = NULL,
  sample = c("full", "estimation", "holdout"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as.data.table.clv.data_+3A_x">x</code></td>
<td>
<p>An object of class <code>clv.data</code>.</p>
</td></tr>
<tr><td><code id="as.data.table.clv.data_+3A_keep.rownames">keep.rownames</code></td>
<td>
<p>Ignored</p>
</td></tr>
<tr><td><code id="as.data.table.clv.data_+3A_ids">ids</code></td>
<td>
<p>Character vector of customer ids for which transactions should be extracted. <code>NULL</code> extracts all.</p>
</td></tr>
<tr><td><code id="as.data.table.clv.data_+3A_sample">sample</code></td>
<td>
<p>Name of sample for which transactions should be extracted,
either &quot;estimation&quot;, &quot;holdout&quot;, or &quot;full&quot; (default).</p>
</td></tr>
<tr><td><code id="as.data.table.clv.data_+3A_...">...</code></td>
<td>
<p>Ignored</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>data.table</code> with columns <code>Id</code>, <code>Date</code>, and <code>Price</code> (if present).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(data.table)
 
data("cdnow")
clv.data.cdnow &lt;- clvdata(data.transactions = cdnow,
                          date.format="ymd",
                          time.unit = "w",
                          estimation.split = 37)

# Extract all transaction data (all ids, estimation and holdout period)
dt.trans &lt;- as.data.table(clv.data.cdnow)

# Extract transaction data of estimation period
dt.trans &lt;- as.data.table(clv.data.cdnow, sample="estimation")

# Extract transaction data of ids "1", "2", and "999"
#  (estimation and holdout period)
dt.trans &lt;- as.data.table(clv.data.cdnow, ids = c("1", "2", "999"))

# Extract transaction data of ids "1", "2", and "999" in estimation period
dt.trans &lt;- as.data.table(clv.data.cdnow, ids = c("1", "2", "999"),
                          sample="estimation")


</code></pre>

<hr>
<h2 id='bgbb'>BG/BB models - Work In Progress</h2><span id='topic+bgbb'></span><span id='topic+bgbb+2Cclv.data-method'></span><span id='topic+bgbb+2Cclv.data.static.covariates-method'></span><span id='topic+bgbb+2Cclv.data.dynamic.covariates-method'></span>

<h3>Description</h3>

<p>Fits BG/BB models on transactional data with static and without covariates. Not yet implemented.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'clv.data'
bgbb(
  clv.data,
  start.params.model = c(),
  optimx.args = list(),
  verbose = TRUE,
  ...
)

## S4 method for signature 'clv.data.static.covariates'
bgbb(
  clv.data,
  start.params.model = c(),
  optimx.args = list(),
  verbose = TRUE,
  names.cov.life = c(),
  names.cov.trans = c(),
  start.params.life = c(),
  start.params.trans = c(),
  names.cov.constr = c(),
  start.params.constr = c(),
  reg.lambdas = c(),
  ...
)

## S4 method for signature 'clv.data.dynamic.covariates'
bgbb(
  clv.data,
  start.params.model = c(),
  optimx.args = list(),
  verbose = TRUE,
  names.cov.life = c(),
  names.cov.trans = c(),
  start.params.life = c(),
  start.params.trans = c(),
  names.cov.constr = c(),
  start.params.constr = c(),
  reg.lambdas = c(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="bgbb_+3A_clv.data">clv.data</code></td>
<td>
<p>The data object on which the model is fitted.</p>
</td></tr>
<tr><td><code id="bgbb_+3A_start.params.model">start.params.model</code></td>
<td>
<p>Named start parameters containing the optimization start parameters for the model without covariates.</p>
</td></tr>
<tr><td><code id="bgbb_+3A_optimx.args">optimx.args</code></td>
<td>
<p>Additional arguments to control the optimization which are forwarded to <code><a href="optimx.html#topic+optimx">optimx::optimx</a></code>.
If multiple optimization methods are specified, only the result of the last method is further processed.</p>
</td></tr>
<tr><td><code id="bgbb_+3A_verbose">verbose</code></td>
<td>
<p>Show details about the running of the function.</p>
</td></tr>
<tr><td><code id="bgbb_+3A_...">...</code></td>
<td>
<p>Ignored</p>
</td></tr>
<tr><td><code id="bgbb_+3A_names.cov.life">names.cov.life</code></td>
<td>
<p>Which of the set Lifetime covariates should be used. Missing parameter indicates all covariates shall be used.</p>
</td></tr>
<tr><td><code id="bgbb_+3A_names.cov.trans">names.cov.trans</code></td>
<td>
<p>Which of the set Transaction covariates should be used. Missing parameter indicates all covariates shall be used.</p>
</td></tr>
<tr><td><code id="bgbb_+3A_start.params.life">start.params.life</code></td>
<td>
<p>Named start parameters containing the optimization start parameters for all lifetime covariates.</p>
</td></tr>
<tr><td><code id="bgbb_+3A_start.params.trans">start.params.trans</code></td>
<td>
<p>Named start parameters containing the optimization start parameters for all transaction covariates.</p>
</td></tr>
<tr><td><code id="bgbb_+3A_names.cov.constr">names.cov.constr</code></td>
<td>
<p>Which covariates should be forced to use the same parameters for the lifetime and transaction process. The covariates need to be present as both, lifetime and transaction covariates.</p>
</td></tr>
<tr><td><code id="bgbb_+3A_start.params.constr">start.params.constr</code></td>
<td>
<p>Named start parameters containing the optimization start parameters for the constraint covariates.</p>
</td></tr>
<tr><td><code id="bgbb_+3A_reg.lambdas">reg.lambdas</code></td>
<td>
<p>Named lambda parameters used for the L2 regularization of the lifetime and the transaction covariate parameters. Lambdas have to be &gt;= 0.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No value is returned.
</p>

<hr>
<h2 id='bgnbd'>BG/NBD models</h2><span id='topic+bgnbd'></span><span id='topic+bgnbd+2Cclv.data.dynamic.covariates-method'></span><span id='topic+bgnbd+2Cclv.data-method'></span><span id='topic+bgnbd+2Cclv.data.static.covariates-method'></span>

<h3>Description</h3>

<p>Fits BG/NBD models on transactional data without and with static covariates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'clv.data'
bgnbd(
  clv.data,
  start.params.model = c(),
  optimx.args = list(),
  verbose = TRUE,
  ...
)

## S4 method for signature 'clv.data.static.covariates'
bgnbd(
  clv.data,
  start.params.model = c(),
  optimx.args = list(),
  verbose = TRUE,
  names.cov.life = c(),
  names.cov.trans = c(),
  start.params.life = c(),
  start.params.trans = c(),
  names.cov.constr = c(),
  start.params.constr = c(),
  reg.lambdas = c(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="bgnbd_+3A_clv.data">clv.data</code></td>
<td>
<p>The data object on which the model is fitted.</p>
</td></tr>
<tr><td><code id="bgnbd_+3A_start.params.model">start.params.model</code></td>
<td>
<p>Named start parameters containing the optimization start parameters for the model without covariates.</p>
</td></tr>
<tr><td><code id="bgnbd_+3A_optimx.args">optimx.args</code></td>
<td>
<p>Additional arguments to control the optimization which are forwarded to <code><a href="optimx.html#topic+optimx">optimx::optimx</a></code>.
If multiple optimization methods are specified, only the result of the last method is further processed.</p>
</td></tr>
<tr><td><code id="bgnbd_+3A_verbose">verbose</code></td>
<td>
<p>Show details about the running of the function.</p>
</td></tr>
<tr><td><code id="bgnbd_+3A_...">...</code></td>
<td>
<p>Ignored</p>
</td></tr>
<tr><td><code id="bgnbd_+3A_names.cov.life">names.cov.life</code></td>
<td>
<p>Which of the set Lifetime covariates should be used. Missing parameter indicates all covariates shall be used.</p>
</td></tr>
<tr><td><code id="bgnbd_+3A_names.cov.trans">names.cov.trans</code></td>
<td>
<p>Which of the set Transaction covariates should be used. Missing parameter indicates all covariates shall be used.</p>
</td></tr>
<tr><td><code id="bgnbd_+3A_start.params.life">start.params.life</code></td>
<td>
<p>Named start parameters containing the optimization start parameters for all lifetime covariates.</p>
</td></tr>
<tr><td><code id="bgnbd_+3A_start.params.trans">start.params.trans</code></td>
<td>
<p>Named start parameters containing the optimization start parameters for all transaction covariates.</p>
</td></tr>
<tr><td><code id="bgnbd_+3A_names.cov.constr">names.cov.constr</code></td>
<td>
<p>Which covariates should be forced to use the same parameters for the lifetime and transaction process. The covariates need to be present as both, lifetime and transaction covariates.</p>
</td></tr>
<tr><td><code id="bgnbd_+3A_start.params.constr">start.params.constr</code></td>
<td>
<p>Named start parameters containing the optimization start parameters for the constraint covariates.</p>
</td></tr>
<tr><td><code id="bgnbd_+3A_reg.lambdas">reg.lambdas</code></td>
<td>
<p>Named lambda parameters used for the L2 regularization of the lifetime and the transaction covariate parameters. Lambdas have to be &gt;= 0.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Model parameters for the BG/NBD model are <code>r, alpha, a, and b</code>. <br />
<code>r</code>: shape parameter of the Gamma distribution of the purchase process. <br />
<code>alpha</code>: scale parameter of the Gamma distribution of the purchase process. <br />
<code>a</code>: shape parameter of the Beta distribution of the dropout process.<br />
<code>b</code>: shape parameter of the Beta distribution of the dropout process.
</p>
<p>If no start parameters are given, r = 1, alpha = 3, a = 1, b = 3 is used.
All model start parameters are required to be &gt; 0. If no start values are given for the
covariate parameters, 0.1 is used.
</p>
<p>Note that the DERT expression has not been derived (yet) and it consequently is not possible to calculated
values for DERT and CLV.
</p>


<h4>The BG/NBD model</h4>

<p>The BG/NBD is an &quot;easy&quot; alternative to the Pareto/NBD model that is easier to implement. The BG/NBD model slight adapts
the behavioral &quot;story&quot; associated with the Pareto/NBD model in order to simplify the implementation. The BG/NBD model uses a beta-geometric and
exponential gamma mixture distributions to model customer behavior. The key difference to the Pareto/NBD model is that a customer can only
churn right after a transaction. This simplifies computations significantly, however has the drawback that a customer cannot churn until he/she
makes a transaction. The Pareto/NBD model assumes that a customer can churn at any time.
</p>



<h4>BG/NBD model with static covariates</h4>

<p>The standard BG/NBD model captures heterogeneity was solely using Gamma distributions.
However, often exogenous knowledge, such as for example customer demographics, is available.
The supplementary knowledge may explain part of the heterogeneity among the customers and
therefore increase the predictive accuracy of the model. In addition, we can rely on these
parameter estimates for inference, i.e. identify and quantify effects of contextual factors
on the two underlying purchase and attrition processes. For technical details we refer to
the technical note by Fader and Hardie (2007).
</p>
<p>The likelihood function is the likelihood function associated with the basic model where
alpha, a, and b are replaced with alpha = alpha0*exp(-g1z1), a = a_0*exp(g2z2), and b = b0*exp(g3z2)
while r remains unchanged. Note that in the current implementation, we constrain the covariate parameters
and data for the lifetime process to be equal (g2=g3 and z2=z3).
</p>



<h3>Value</h3>

<p>Depending on the data object on which the model was fit, <code>bgnbd</code> returns either an object of
class <a href="#topic+clv.bgnbd-class">clv.bgnbd</a> or <a href="#topic+clv.bgnbd.static.cov-class">clv.bgnbd.static.cov</a>.
</p>
<p>The function <code><a href="#topic+summary.clv.fitted">summary</a></code> can be used to obtain and print a summary of the results.
The generic accessor functions <code>coefficients</code>, <code><a href="#topic+vcov.clv.fitted">vcov</a></code>, <code><a href="#topic+fitted.clv.fitted">fitted</a></code>,
<code>logLik</code>, <code>AIC</code>, <code>BIC</code>, and <code>nobs</code> are available.
</p>


<h3>References</h3>

<p>Fader PS, Hardie BGS, Lee KL (2005). &ldquo;&ldquo;Counting Your Customers&rdquo; the Easy Way:
An Alternative to the Pareto/NBD Model&rdquo; Marketing Science, 24(2), 275-284.
</p>
<p>Fader PS, Hardie BGS (2013). &ldquo;Overcoming the BG/NBD Model's #NUM! Error Problem&rdquo;
URL <a href="http://brucehardie.com/notes/027/bgnbd_num_error.pdf">http://brucehardie.com/notes/027/bgnbd_num_error.pdf</a>.
</p>
<p>Fader PS, Hardie BGS (2007). &ldquo;Incorporating time-invariant covariates into the
Pareto/NBD and BG/NBD models.&rdquo;
URL <a href="http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf">http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf</a>.
</p>
<p>Fader PS, Hardie BGS, Lee KL (2007). &ldquo;Creating a Fit Histogram for the BG/NBD Model&rdquo;
URL <a href="https://www.brucehardie.com/notes/014/bgnbd_fit_histogram.pdf">https://www.brucehardie.com/notes/014/bgnbd_fit_histogram.pdf</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+clvdata">clvdata</a></code> to create a clv data object, <code><a href="#topic+SetStaticCovariates">SetStaticCovariates</a></code>
to add static covariates to an existing clv data object.
</p>
<p><a href="#topic+gg">gg</a> to fit customer's average spending per transaction with the <code>Gamma-Gamma</code> model
</p>
<p><code><a href="#topic+predict.clv.fitted.transactions">predict</a></code> to predict expected transactions, probability of being alive, and customer lifetime value for every customer
</p>
<p><code><a href="#topic+plot.clv.fitted.transactions">plot</a></code> to plot the unconditional expectation as predicted by the fitted model
</p>
<p><code><a href="#topic+pmf">pmf</a></code> for the probability to make exactly x transactions in the estimation period, given by the probability mass function (PMF).
</p>
<p><code><a href="#topic+newcustomer">newcustomer</a></code> to predict the expected number of transactions for an average new customer.
</p>
<p>The generic functions <code><a href="#topic+vcov.clv.fitted">vcov</a></code>, <code><a href="#topic+summary.clv.fitted">summary</a></code>, <code><a href="#topic+fitted.clv.fitted">fitted</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("apparelTrans")
clv.data.apparel &lt;- clvdata(apparelTrans, date.format = "ymd",
                            time.unit = "w", estimation.split = 52)

# Fit standard bgnbd model
bgnbd(clv.data.apparel)

# Give initial guesses for the model parameters
bgnbd(clv.data.apparel,
     start.params.model = c(r=0.5, alpha=15, a = 2, b=5))


# pass additional parameters to the optimizer (optimx)
#    Use Nelder-Mead as optimization method and print
#    detailed information about the optimization process
apparel.bgnbd &lt;- bgnbd(clv.data.apparel,
                     optimx.args = list(method="Nelder-Mead",
                                        control=list(trace=6)))

# estimated coefs
coef(apparel.bgnbd)

# summary of the fitted model
summary(apparel.bgnbd)

# predict CLV etc for holdout period
predict(apparel.bgnbd)

# predict CLV etc for the next 15 periods
predict(apparel.bgnbd, prediction.end = 15)


# To estimate the bgnbd model with static covariates,
#   add static covariates to the data
data("apparelStaticCov")
clv.data.static.cov &lt;-
 SetStaticCovariates(clv.data.apparel,
                     data.cov.life = apparelStaticCov,
                     names.cov.life = c("Gender", "Channel"),
                     data.cov.trans = apparelStaticCov,
                     names.cov.trans = c("Gender", "Channel"))

# Fit bgnbd with static covariates
bgnbd(clv.data.static.cov)

# Give initial guesses for both covariate parameters
bgnbd(clv.data.static.cov, start.params.trans = c(Gender=0.75, Channel=0.7),
                   start.params.life  = c(Gender=0.5, Channel=0.5))

# Use regularization
bgnbd(clv.data.static.cov, reg.lambdas = c(trans = 5, life=5))

# Force the same coefficient to be used for both covariates
bgnbd(clv.data.static.cov, names.cov.constr = "Gender",
                   start.params.constr = c(Gender=0.5))

# Fit model only with the Channel covariate for life but
# keep all trans covariates as is
bgnbd(clv.data.static.cov, names.cov.life = c("Channel"))

</code></pre>

<hr>
<h2 id='bgnbd_CET'>BG/NBD: Conditional Expected Transactions</h2><span id='topic+bgnbd_CET'></span><span id='topic+bgnbd_nocov_CET'></span><span id='topic+bgnbd_staticcov_CET'></span>

<h3>Description</h3>

<p>Calculates the expected number of transactions in a given time period based
on a customer's past transaction behavior and the BG/NBD model parameters.
</p>

<dl>
<dt><code>bgnbd_nocov_CET</code></dt><dd><p> Conditional Expected Transactions without covariates</p>
</dd>
<dt><code>bgnbd_staticcov_CET</code></dt><dd><p> Conditional Expected Transactions with static covariates</p>
</dd>
</dl>



<h3>Usage</h3>

<pre><code class='language-R'>bgnbd_nocov_CET(r, alpha, a, b, dPeriods, vX, vT_x, vT_cal)

bgnbd_staticcov_CET(
  r,
  alpha,
  a,
  b,
  dPeriods,
  vX,
  vT_x,
  vT_cal,
  vCovParams_trans,
  vCovParams_life,
  mCov_trans,
  mCov_life
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="bgnbd_CET_+3A_r">r</code></td>
<td>
<p>shape parameter of the Gamma distribution of the purchase process</p>
</td></tr>
<tr><td><code id="bgnbd_CET_+3A_alpha">alpha</code></td>
<td>
<p>scale parameter of the Gamma distribution of the purchase process</p>
</td></tr>
<tr><td><code id="bgnbd_CET_+3A_a">a</code></td>
<td>
<p>shape parameter of the Beta distribution of the lifetime process</p>
</td></tr>
<tr><td><code id="bgnbd_CET_+3A_b">b</code></td>
<td>
<p>shape parameter of the Beta distribution of the lifetime process</p>
</td></tr>
<tr><td><code id="bgnbd_CET_+3A_dperiods">dPeriods</code></td>
<td>
<p>number of periods to predict</p>
</td></tr>
<tr><td><code id="bgnbd_CET_+3A_vx">vX</code></td>
<td>
<p>Frequency vector of length n counting the numbers of purchases.</p>
</td></tr>
<tr><td><code id="bgnbd_CET_+3A_vt_x">vT_x</code></td>
<td>
<p>Recency vector of length n.</p>
</td></tr>
<tr><td><code id="bgnbd_CET_+3A_vt_cal">vT_cal</code></td>
<td>
<p>Vector of length n indicating the total number of periods of observation.</p>
</td></tr>
<tr><td><code id="bgnbd_CET_+3A_vcovparams_trans">vCovParams_trans</code></td>
<td>
<p>Vector of estimated parameters for the transaction covariates.</p>
</td></tr>
<tr><td><code id="bgnbd_CET_+3A_vcovparams_life">vCovParams_life</code></td>
<td>
<p>Vector of estimated parameters for the lifetime covariates.</p>
</td></tr>
<tr><td><code id="bgnbd_CET_+3A_mcov_trans">mCov_trans</code></td>
<td>
<p>Matrix containing the covariates data affecting the transaction process. One column for each covariate.</p>
</td></tr>
<tr><td><code id="bgnbd_CET_+3A_mcov_life">mCov_life</code></td>
<td>
<p>Matrix containing the covariates data affecting the lifetime process. One column for each covariate.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>mCov_trans</code> is a matrix containing the covariates data of
the time-invariant covariates that affect the transaction process.
Each column represents a different covariate. For every column a gamma parameter
needs to added to <code>vCovParams_trans</code> at the respective position.
</p>
<p><code>mCov_life</code> is a matrix containing the covariates data of
the time-invariant covariates that affect the lifetime process.
Each column represents a different covariate. For every column a gamma parameter
needs to added to <code>vCovParams_life</code> at the respective position.
</p>


<h3>Value</h3>

<p>Returns a vector containing the conditional expected transactions for the existing
customers in the BG/NBD model.
</p>


<h3>References</h3>

<p>Fader PS, Hardie BGS, Lee KL (2005). &ldquo;&ldquo;Counting Your Customers&rdquo; the Easy Way:
An Alternative to the Pareto/NBD Model&rdquo; Marketing Science, 24(2), 275-284.
</p>
<p>Fader PS, Hardie BGS (2013). &ldquo;Overcoming the BG/NBD Model's #NUM! Error Problem&rdquo;
URL <a href="http://brucehardie.com/notes/027/bgnbd_num_error.pdf">http://brucehardie.com/notes/027/bgnbd_num_error.pdf</a>.
</p>
<p>Fader PS, Hardie BGS (2007). &ldquo;Incorporating time-invariant covariates into the
Pareto/NBD and BG/NBD models.&rdquo;
URL <a href="http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf">http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf</a>.
</p>
<p>Fader PS, Hardie BGS, Lee KL (2007). &ldquo;Creating a Fit Histogram for the BG/NBD Model&rdquo;
URL <a href="https://www.brucehardie.com/notes/014/bgnbd_fit_histogram.pdf">https://www.brucehardie.com/notes/014/bgnbd_fit_histogram.pdf</a>
</p>

<hr>
<h2 id='bgnbd_expectation'>BG/NBD: Unconditional Expectation</h2><span id='topic+bgnbd_expectation'></span><span id='topic+bgnbd_nocov_expectation'></span><span id='topic+bgnbd_staticcov_expectation'></span>

<h3>Description</h3>

<p>Computes the expected number of repeat transactions in the interval (0, vT_i]
for a randomly selected customer, where 0 is defined as the point when the customer came alive.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bgnbd_nocov_expectation(r, alpha, a, b, vT_i)

bgnbd_staticcov_expectation(r, vAlpha_i, vA_i, vB_i, vT_i)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="bgnbd_expectation_+3A_r">r</code></td>
<td>
<p>shape parameter of the Gamma distribution of the purchase process</p>
</td></tr>
<tr><td><code id="bgnbd_expectation_+3A_alpha">alpha</code></td>
<td>
<p>scale parameter of the Gamma distribution of the purchase process</p>
</td></tr>
<tr><td><code id="bgnbd_expectation_+3A_a">a</code></td>
<td>
<p>shape parameter of the Beta distribution of the lifetime process</p>
</td></tr>
<tr><td><code id="bgnbd_expectation_+3A_b">b</code></td>
<td>
<p>shape parameter of the Beta distribution of the lifetime process</p>
</td></tr>
<tr><td><code id="bgnbd_expectation_+3A_vt_i">vT_i</code></td>
<td>
<p>Number of periods since the customer came alive</p>
</td></tr>
<tr><td><code id="bgnbd_expectation_+3A_valpha_i">vAlpha_i</code></td>
<td>
<p>Vector of individual parameters alpha</p>
</td></tr>
<tr><td><code id="bgnbd_expectation_+3A_va_i">vA_i</code></td>
<td>
<p>Vector of individual parameters a</p>
</td></tr>
<tr><td><code id="bgnbd_expectation_+3A_vb_i">vB_i</code></td>
<td>
<p>Vector of individual parameters b</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns the expected transaction values according to the chosen model.
</p>


<h3>References</h3>

<p>Fader PS, Hardie BGS, Lee KL (2005). &ldquo;&ldquo;Counting Your Customers&rdquo; the Easy Way:
An Alternative to the Pareto/NBD Model&rdquo; Marketing Science, 24(2), 275-284.
</p>
<p>Fader PS, Hardie BGS (2013). &ldquo;Overcoming the BG/NBD Model's #NUM! Error Problem&rdquo;
URL <a href="http://brucehardie.com/notes/027/bgnbd_num_error.pdf">http://brucehardie.com/notes/027/bgnbd_num_error.pdf</a>.
</p>
<p>Fader PS, Hardie BGS (2007). &ldquo;Incorporating time-invariant covariates into the
Pareto/NBD and BG/NBD models.&rdquo;
URL <a href="http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf">http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf</a>.
</p>
<p>Fader PS, Hardie BGS, Lee KL (2007). &ldquo;Creating a Fit Histogram for the BG/NBD Model&rdquo;
URL <a href="https://www.brucehardie.com/notes/014/bgnbd_fit_histogram.pdf">https://www.brucehardie.com/notes/014/bgnbd_fit_histogram.pdf</a>
</p>

<hr>
<h2 id='bgnbd_LL'>BG/NBD: Log-Likelihood functions</h2><span id='topic+bgnbd_LL'></span><span id='topic+bgnbd_nocov_LL_ind'></span><span id='topic+bgnbd_nocov_LL_sum'></span><span id='topic+bgnbd_staticcov_LL_ind'></span><span id='topic+bgnbd_staticcov_LL_sum'></span>

<h3>Description</h3>

<p>Calculates the Log-Likelihood values for the BG/NBD model with and without covariates.
</p>
<p>The function <code>bgnbd_nocov_LL_ind</code> calculates the individual log-likelihood
values for each customer for the given parameters.
</p>
<p>The function <code>bgnbd_nocov_LL_sum</code> calculates the log-likelihood value summed
across customers for the given parameters.
</p>
<p>The function <code>bgnbd_staticcov_LL_ind</code> calculates the individual log-likelihood
values for each customer for the given parameters and covariates.
</p>
<p>The function <code>bgnbd_staticcov_LL_sum</code> calculates the individual log-likelihood values summed
across customers.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bgnbd_nocov_LL_ind(vLogparams, vX, vT_x, vT_cal)

bgnbd_nocov_LL_sum(vLogparams, vX, vT_x, vT_cal, vN)

bgnbd_staticcov_LL_ind(vParams, vX, vT_x, vT_cal, mCov_life, mCov_trans)

bgnbd_staticcov_LL_sum(vParams, vX, vT_x, vT_cal, vN, mCov_life, mCov_trans)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="bgnbd_LL_+3A_vlogparams">vLogparams</code></td>
<td>
<p>vector with the BG/NBD model parameters at log scale. See Details.</p>
</td></tr>
<tr><td><code id="bgnbd_LL_+3A_vx">vX</code></td>
<td>
<p>Frequency vector of length n counting the numbers of purchases.</p>
</td></tr>
<tr><td><code id="bgnbd_LL_+3A_vt_x">vT_x</code></td>
<td>
<p>Recency vector of length n.</p>
</td></tr>
<tr><td><code id="bgnbd_LL_+3A_vt_cal">vT_cal</code></td>
<td>
<p>Vector of length n indicating the total number of periods of observation.</p>
</td></tr>
<tr><td><code id="bgnbd_LL_+3A_vn">vN</code></td>
<td>
<p>The value (&quot;number of times observed&quot;) with which the LL value of this observation is multiplied before summing across customers.</p>
</td></tr>
<tr><td><code id="bgnbd_LL_+3A_vparams">vParams</code></td>
<td>
<p>vector with the parameters for the BG/NBD model at log scale and the static covariates at original scale. See Details.</p>
</td></tr>
<tr><td><code id="bgnbd_LL_+3A_mcov_life">mCov_life</code></td>
<td>
<p>Matrix containing the covariates data affecting the lifetime process. One column for each covariate.</p>
</td></tr>
<tr><td><code id="bgnbd_LL_+3A_mcov_trans">mCov_trans</code></td>
<td>
<p>Matrix containing the covariates data affecting the transaction process. One column for each covariate.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>vLogparams</code> is a vector with model parameters <code>r, alpha_0, a, b</code> at log-scale, in this order.
</p>
<p><code>vParams</code> is vector with the BG/NBD model parameters at log scale,
followed by the parameters for the lifetime covariates at original scale and then
followed by the parameters for the transaction covariates at original scale
</p>
<p><code>mCov_trans</code> is a matrix containing the covariates data of
the time-invariant covariates that affect the transaction process.
Each column represents a different covariate. For every column a gamma parameter
needs to added to <code>vLogparams</code> at the respective position.
</p>
<p><code>mCov_life</code> is a matrix containing the covariates data of
the time-invariant covariates that affect the lifetime process.
Each column represents a different covariate. For every column a gamma parameter
needs to added to <code>vLogparams</code> at the respective position.
</p>


<h3>Value</h3>

<p>Returns the respective Log-Likelihood value(s) for the BG/NBD model
with or without covariates.
</p>


<h3>References</h3>

<p>Fader PS, Hardie BGS, Lee KL (2005). &ldquo;&ldquo;Counting Your Customers&rdquo; the Easy Way:
An Alternative to the Pareto/NBD Model&rdquo; Marketing Science, 24(2), 275-284.
</p>
<p>Fader PS, Hardie BGS (2013). &ldquo;Overcoming the BG/NBD Model's #NUM! Error Problem&rdquo;
URL <a href="http://brucehardie.com/notes/027/bgnbd_num_error.pdf">http://brucehardie.com/notes/027/bgnbd_num_error.pdf</a>.
</p>
<p>Fader PS, Hardie BGS (2007). &ldquo;Incorporating time-invariant covariates into the
Pareto/NBD and BG/NBD models.&rdquo;
URL <a href="http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf">http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf</a>.
</p>
<p>Fader PS, Hardie BGS, Lee KL (2007). &ldquo;Creating a Fit Histogram for the BG/NBD Model&rdquo;
URL <a href="https://www.brucehardie.com/notes/014/bgnbd_fit_histogram.pdf">https://www.brucehardie.com/notes/014/bgnbd_fit_histogram.pdf</a>
</p>

<hr>
<h2 id='bgnbd_PAlive'>BG/NBD: Probability of Being Alive</h2><span id='topic+bgnbd_PAlive'></span><span id='topic+bgnbd_nocov_PAlive'></span><span id='topic+bgnbd_staticcov_PAlive'></span>

<h3>Description</h3>

<p>Calculates the probability of a customer being alive at the end of the calibration period,
based on a customer's past transaction behavior and the BG/NBD model parameters.
</p>

<dl>
<dt><code>bgnbd_nocov_PAlive</code></dt><dd><p> P(alive) for the BG/NBD model without covariates</p>
</dd>
<dt><code>bgnbd_staticcov_PAlive</code></dt><dd><p> P(alive) for the BG/NBD model with static covariates</p>
</dd>
</dl>



<h3>Usage</h3>

<pre><code class='language-R'>bgnbd_nocov_PAlive(r, alpha, a, b, vX, vT_x, vT_cal)

bgnbd_staticcov_PAlive(
  r,
  alpha,
  a,
  b,
  vX,
  vT_x,
  vT_cal,
  vCovParams_trans,
  vCovParams_life,
  mCov_trans,
  mCov_life
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="bgnbd_PAlive_+3A_r">r</code></td>
<td>
<p>shape parameter of the Gamma distribution of the purchase process</p>
</td></tr>
<tr><td><code id="bgnbd_PAlive_+3A_alpha">alpha</code></td>
<td>
<p>scale parameter of the Gamma distribution of the purchase process</p>
</td></tr>
<tr><td><code id="bgnbd_PAlive_+3A_a">a</code></td>
<td>
<p>shape parameter of the Beta distribution of the lifetime process</p>
</td></tr>
<tr><td><code id="bgnbd_PAlive_+3A_b">b</code></td>
<td>
<p>shape parameter of the Beta distribution of the lifetime process</p>
</td></tr>
<tr><td><code id="bgnbd_PAlive_+3A_vx">vX</code></td>
<td>
<p>Frequency vector of length n counting the numbers of purchases.</p>
</td></tr>
<tr><td><code id="bgnbd_PAlive_+3A_vt_x">vT_x</code></td>
<td>
<p>Recency vector of length n.</p>
</td></tr>
<tr><td><code id="bgnbd_PAlive_+3A_vt_cal">vT_cal</code></td>
<td>
<p>Vector of length n indicating the total number of periods of observation.</p>
</td></tr>
<tr><td><code id="bgnbd_PAlive_+3A_vcovparams_trans">vCovParams_trans</code></td>
<td>
<p>Vector of estimated parameters for the transaction covariates.</p>
</td></tr>
<tr><td><code id="bgnbd_PAlive_+3A_vcovparams_life">vCovParams_life</code></td>
<td>
<p>Vector of estimated parameters for the lifetime covariates.</p>
</td></tr>
<tr><td><code id="bgnbd_PAlive_+3A_mcov_trans">mCov_trans</code></td>
<td>
<p>Matrix containing the covariates data affecting the transaction process. One column for each covariate.</p>
</td></tr>
<tr><td><code id="bgnbd_PAlive_+3A_mcov_life">mCov_life</code></td>
<td>
<p>Matrix containing the covariates data affecting the lifetime process. One column for each covariate.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>mCov_trans</code> is a matrix containing the covariates data of
the time-invariant covariates that affect the transaction process.
Each column represents a different covariate. For every column a gamma parameter
needs to added to <code>vCovParams_trans</code> at the respective position.
</p>
<p><code>mCov_life</code> is a matrix containing the covariates data of
the time-invariant covariates that affect the lifetime process.
Each column represents a different covariate. For every column a gamma parameter
needs to added to <code>vCovParams_life</code> at the respective position.
</p>


<h3>Value</h3>

<p>Returns a vector with the PAlive for each customer.
</p>


<h3>References</h3>

<p>Fader PS, Hardie BGS, Lee KL (2005). &ldquo;&ldquo;Counting Your Customers&rdquo; the Easy Way:
An Alternative to the Pareto/NBD Model&rdquo; Marketing Science, 24(2), 275-284.
</p>
<p>Fader PS, Hardie BGS (2013). &ldquo;Overcoming the BG/NBD Model's #NUM! Error Problem&rdquo;
URL <a href="http://brucehardie.com/notes/027/bgnbd_num_error.pdf">http://brucehardie.com/notes/027/bgnbd_num_error.pdf</a>.
</p>
<p>Fader PS, Hardie BGS (2007). &ldquo;Incorporating time-invariant covariates into the
Pareto/NBD and BG/NBD models.&rdquo;
URL <a href="http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf">http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf</a>.
</p>
<p>Fader PS, Hardie BGS, Lee KL (2007). &ldquo;Creating a Fit Histogram for the BG/NBD Model&rdquo;
URL <a href="https://www.brucehardie.com/notes/014/bgnbd_fit_histogram.pdf">https://www.brucehardie.com/notes/014/bgnbd_fit_histogram.pdf</a>
</p>

<hr>
<h2 id='bgnbd_pmf'>BG/NBD: Probability Mass Function (PMF)</h2><span id='topic+bgnbd_pmf'></span><span id='topic+bgnbd_nocov_PMF'></span><span id='topic+bgnbd_staticcov_PMF'></span>

<h3>Description</h3>

<p>Calculate P(X(t)=x), the probability that a randomly selected customer
makes exactly x transactions in the interval (0, t].
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bgnbd_nocov_PMF(r, alpha, a, b, x, vT_i)

bgnbd_staticcov_PMF(r, x, vAlpha_i, vA_i, vB_i, vT_i)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="bgnbd_pmf_+3A_r">r</code></td>
<td>
<p>shape parameter of the Gamma distribution of the purchase process</p>
</td></tr>
<tr><td><code id="bgnbd_pmf_+3A_alpha">alpha</code></td>
<td>
<p>scale parameter of the Gamma distribution of the purchase process</p>
</td></tr>
<tr><td><code id="bgnbd_pmf_+3A_a">a</code></td>
<td>
<p>shape parameter of the Beta distribution of the lifetime process</p>
</td></tr>
<tr><td><code id="bgnbd_pmf_+3A_b">b</code></td>
<td>
<p>shape parameter of the Beta distribution of the lifetime process</p>
</td></tr>
<tr><td><code id="bgnbd_pmf_+3A_x">x</code></td>
<td>
<p>The number of transactions to calculate the probability for (unsigned integer).</p>
</td></tr>
<tr><td><code id="bgnbd_pmf_+3A_vt_i">vT_i</code></td>
<td>
<p>Number of periods since the customer came alive.</p>
</td></tr>
<tr><td><code id="bgnbd_pmf_+3A_valpha_i">vAlpha_i</code></td>
<td>
<p>Vector of individual parameters alpha</p>
</td></tr>
<tr><td><code id="bgnbd_pmf_+3A_va_i">vA_i</code></td>
<td>
<p>Vector of individual parameters a</p>
</td></tr>
<tr><td><code id="bgnbd_pmf_+3A_vb_i">vB_i</code></td>
<td>
<p>Vector of individual parameters b</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a vector of probabilities.
</p>


<h3>References</h3>

<p>Fader PS, Hardie BGS, Lee KL (2005). &ldquo;&ldquo;Counting Your Customers&rdquo; the Easy Way:
An Alternative to the Pareto/NBD Model&rdquo; Marketing Science, 24(2), 275-284.
</p>
<p>Fader PS, Hardie BGS (2013). &ldquo;Overcoming the BG/NBD Model's #NUM! Error Problem&rdquo;
URL <a href="http://brucehardie.com/notes/027/bgnbd_num_error.pdf">http://brucehardie.com/notes/027/bgnbd_num_error.pdf</a>.
</p>
<p>Fader PS, Hardie BGS (2007). &ldquo;Incorporating time-invariant covariates into the
Pareto/NBD and BG/NBD models.&rdquo;
URL <a href="http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf">http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf</a>.
</p>
<p>Fader PS, Hardie BGS, Lee KL (2007). &ldquo;Creating a Fit Histogram for the BG/NBD Model&rdquo;
URL <a href="https://www.brucehardie.com/notes/014/bgnbd_fit_histogram.pdf">https://www.brucehardie.com/notes/014/bgnbd_fit_histogram.pdf</a>
</p>

<hr>
<h2 id='cdnow'>CDNOW dataset</h2><span id='topic+cdnow'></span>

<h3>Description</h3>

<p>A dataset containing the entire purchase history up to the end of June 1998
of the cohort of 23,570 individuals who made their first-ever purchase at CDNOW in the first quarter
of 1997.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("cdnow")
</code></pre>


<h3>Format</h3>

<p>A <code>data.table</code> with 6696 rows and 4 variables:
</p>

<dl>
<dt><code>Id</code></dt><dd><p>Customer Id</p>
</dd>
<dt><code>Date</code></dt><dd><p>Date of purchase</p>
</dd>
<dt><code>CDs</code></dt><dd><p>Amount of CDs purchased</p>
</dd>
<dt><code>Price</code></dt><dd><p>Price of purchase</p>
</dd>
</dl>



<h3>References</h3>

<p>Fader, Peter S. and Bruce G.,S. Hardie, (2001), &quot;Forecasting Repeat Sales at CDNOW:
A Case Study,&quot; Interfaces, 31 (May-June), Part 2 of 2, p94-107.
</p>

<hr>
<h2 id='clv.bgnbd-class'>Result of fitting the BG/NBD model without covariates</h2><span id='topic+clv.bgnbd-class'></span>

<h3>Description</h3>

<p>Output from fitting the BG/NBD model on data without covariates. It constitutes the estimation
result and is returned to the user to use it as input to other methods such as to make
predictions or plot the unconditional expectation.
</p>
<p>Inherits from <a href="#topic+clv.fitted.transactions-class">clv.fitted.transactions</a> in order to execute all steps required for fitting a model
without covariates and it contains an instance of class <a href="#topic+clv.model.bgnbd.no.cov-class">clv.model.bgnbd.no.cov</a> which
provides the required BG/NBD (no covariates) specific functionalities.
</p>


<h3>Slots</h3>


<dl>
<dt><code>cbs</code></dt><dd><p>Single <code>data.table</code> that is the Customer-By-Sufficiency matrix with information about
each customers' recency, frequency, and total time observed in number of time-units
and as defined by the BG/NBD model.</p>
</dd>
</dl>


<h3>See Also</h3>

<p><a href="#topic+clv.fitted-class">clv.fitted</a>, <a href="#topic+clv.fitted.transactions-class">clv.fitted.transactions</a>, <a href="#topic+clv.model.bgnbd.no.cov-class">clv.model.bgnbd.no.cov</a>, <a href="#topic+clv.bgnbd.static.cov-class">clv.bgnbd.static.cov</a>
</p>

<hr>
<h2 id='clv.bgnbd.static.cov-class'>Result of fitting the BG/NBD model with static covariates</h2><span id='topic+clv.bgnbd.static.cov-class'></span>

<h3>Description</h3>

<p>Output from fitting the BG/NBD model on data with static covariates. It constitutes the
estimation result and is returned to the user to use it as input to other methods such as
to make predictions or plot the unconditional expectation.
</p>
<p>Inherits from <a href="#topic+clv.fitted.transactions.static.cov-class">clv.fitted.transactions.static.cov</a> in order to execute all steps required for fitting a model
with static covariates and it contains an instance of class <a href="#topic+clv.model.bgnbd.static.cov-class">clv.model.bgnbd.static.cov</a> which
provides the required BG/NBD (static covariates) specific functionalities.
</p>


<h3>Slots</h3>


<dl>
<dt><code>cbs</code></dt><dd><p>Single <code>data.table</code> that is the Customer-By-Sufficiency matrix with information about
each customers' recency, frequency, and total time observed in number of time-units
and as defined by the BG/NBD model.</p>
</dd>
</dl>


<h3>See Also</h3>

<p><a href="#topic+clv.fitted.transactions.static.cov-class">clv.fitted.transactions.static.cov</a>, <a href="#topic+clv.model.bgnbd.static.cov-class">clv.model.bgnbd.static.cov</a>, <a href="#topic+clv.bgnbd-class">clv.bgnbd</a>
</p>

<hr>
<h2 id='clv.bootstrapped.apply'>Bootstrapping: Fit a model again on sampled data and apply method</h2><span id='topic+clv.bootstrapped.apply'></span>

<h3>Description</h3>

<p>Given a fitted model, sample new data from the <code>clv.data</code> stored in it and re-fit the model on it.
Which customers are selected into the new data is determined by <code>fn.sample</code>.
The model is fit on the new data with the same options with which it was originally fit,
including <code>optimx.args</code>, <code>verbose</code> and start parameters. If required,
any option can be changed by passing it as <code>...</code>.
After the model is fit, <code>fn.boot.apply</code> is applied to it and
the value it returns is collected in a list which is eventually returned.
</p>
<p>The estimation and holdout periods are preserved exactly as in the original data.
This is regardless of how the actually sampled transactions would define these periods.
This way, each customer's model summary data (<code>cbs</code>) generated from the
sampled data remains the same as on the original data.
This makes sampling from the <code>clv.data</code> object equivalent to sampling
directly from the model summary data.
</p>
<p>Note that the Id of customers which are sampled more than once gains a suffix &quot;_BOOTSTRAP_ID_&lt;number&gt;&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>clv.bootstrapped.apply(object, num.boots, fn.boot.apply, fn.sample = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="clv.bootstrapped.apply_+3A_object">object</code></td>
<td>
<p>Fitted model</p>
</td></tr>
<tr><td><code id="clv.bootstrapped.apply_+3A_num.boots">num.boots</code></td>
<td>
<p>number of times to sample data and re-fit the model</p>
</td></tr>
<tr><td><code id="clv.bootstrapped.apply_+3A_fn.boot.apply">fn.boot.apply</code></td>
<td>
<p>Method to apply on each model estimated on the sampled data. See examples.</p>
</td></tr>
<tr><td><code id="clv.bootstrapped.apply_+3A_fn.sample">fn.sample</code></td>
<td>
<p>Method sampling customer ids for creating the bootstrapped data. Receives and returns
a vector of ids (string). If <code>NULL</code>, ids are sampled with replacement until reaching original length. See examples.</p>
</td></tr>
<tr><td><code id="clv.bootstrapped.apply_+3A_...">...</code></td>
<td>
<p>Passed to the model estimation method. See examples.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a list containing the results of <code>fn.boot.apply</code>
</p>


<h3>See Also</h3>

<p>For possible inputs to <code>...</code> see <a href="#topic+pnbd">pnbd</a>, <a href="#topic+ggomnbd">ggomnbd</a>, <a href="#topic+bgnbd">bgnbd</a>.
</p>
<p>Internal methods <code>clv.data.create.bootstrapping.data</code> to create a <code>clv.data</code>
object of given customer ids and <code>clv.fitted.estimate.same.specification.on.new.data</code> to
estimate a model again on new data with its original specification.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("cdnow")

clv.cdnow &lt;- clvdata(data.transactions = cdnow, date.format="ymd",
                     time.unit = "weeks", estimation.split=37)

pnbd.cdnow &lt;- pnbd(clv.cdnow)

# bootstrapped model coefs while sampling 50 percent
# of customers without replacement
clv.bootstrapped.apply(pnbd.cdnow, num.boots=5, fn.boot.apply=coef,
fn.sample=function(x){
sample(x, size = as.integer(0.5*length(x)), replace = FALSE)})

# sample customers with built-in standard logic and
# return predictions until end of holdout period in original
# data.
# prediction.end is not required because the bootstrapped
# data contains the same estimation and holdout periods
# as the original data, even if the transactions of the sampled
# customers .
clv.bootstrapped.apply(pnbd.cdnow, num.boots=5, fn.sample=NULL,
fn.boot.apply=function(x){predict(x)})

# return the fitted models
# forward additional arguments to the model fitting method
clv.bootstrapped.apply(pnbd.cdnow, num.boots=5, fn.sample=NULL,
fn.boot.apply=return,
# args for ..., forwarded to pnbd()
verbose=FALSE, optimx.args=list(method="Nelder-Mead"),
start.params.model=coef(pnbd.cdnow))


</code></pre>

<hr>
<h2 id='clv.data-class'>Transactional data to fit CLV models</h2><span id='topic+clv.data-class'></span><span id='topic+show+2Cclv.data-method'></span>

<h3>Description</h3>

<p>Stores the processed transactional data and holds an object of class <a href="#topic+clv.time-class">clv.time</a>
which stores further information about the split in an estimation and holdout sample.
</p>
<p>A <code>clv.data</code> object serves as input into the various model fitting functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'clv.data'
show(object)
</code></pre>


<h3>Slots</h3>


<dl>
<dt><code>call</code></dt><dd><p>Single language of the call used to create the object</p>
</dd>
<dt><code>name</code></dt><dd><p>Human-readable name of the type of transactional data</p>
</dd>
<dt><code>clv.time</code></dt><dd><p>clv.time object that stores and is used for processing all timepoint related information</p>
</dd>
<dt><code>data.transactions</code></dt><dd><p>Single <code>data.table</code> containing the original transaction data, with columns renamed to 'Id', 'Date', 'Price'</p>
</dd>
<dt><code>data.repeat.trans</code></dt><dd><p>Single <code>data.table</code> containing only the repeat transactions</p>
</dd>
<dt><code>has.spending</code></dt><dd><p>Single logical whether the data contains information about the amount spent per transaction</p>
</dd>
<dt><code>has.holdout</code></dt><dd><p>Single logical whether the data is split in a holdout and estimation period</p>
</dd>
</dl>


<h3>See Also</h3>

<p><a href="#topic+clv.time-class">clv.time</a>
</p>

<hr>
<h2 id='clv.data.dynamic.covariates-class'>Transactional and dynamic covariates data to fit CLV models</h2><span id='topic+clv.data.dynamic.covariates-class'></span><span id='topic+show+2Cclv.data.dynamic.covariates-method'></span>

<h3>Description</h3>

<p>Extends the class <a href="#topic+clv.data.static.covariates-class">clv.data.static.covariates</a>,
but adds no additional slots to it. The purpose of this class rather is to define different behaviors
suitable for dynamic covariates.
</p>
<p>The <code>data.table</code>s stored in the slots <code>data.cov.life</code> and <code>data.cov.trans</code>
each contain an additional column <code>Cov.Date</code> for the timepoint of the covariate.
</p>
<p>An object of this class serves as input to fit models with dynamic covariates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'clv.data.dynamic.covariates'
show(object)
</code></pre>


<h3>Slots</h3>


<dl>
<dt><code>data.cov.life</code></dt><dd><p>Single <code>data.table</code> with all static covariate data for the lifetime process</p>
</dd>
<dt><code>data.cov.trans</code></dt><dd><p>Single <code>data.table</code> with all static covariate data for the transaction process</p>
</dd>
<dt><code>names.cov.data.life</code></dt><dd><p>Character vector with names of the dynamic lifetime covariates.</p>
</dd>
<dt><code>names.cov.data.trans</code></dt><dd><p>Character vector with names of the dynamic transaction covariates.</p>
</dd>
</dl>


<h3>See Also</h3>

<p>Definition of the parent class <a href="#topic+clv.data.static.covariates-class">clv.data.static.covariates</a>.
</p>
<p>For fitting dynamic covariate models: <code><a href="#topic+pnbd">pnbd</a></code>
</p>

<hr>
<h2 id='clv.data.static.covariates-class'>Transactional and static covariates data to fit CLV models</h2><span id='topic+clv.data.static.covariates-class'></span><span id='topic+show+2Cclv.data.static.covariates-method'></span>

<h3>Description</h3>

<p>Extends the class <a href="#topic+clv.data-class">clv.data</a> and adds slots to store data and names of
static covariates for both processes.
An object of this class then serves as input to fit models with static covariates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'clv.data.static.covariates'
show(object)
</code></pre>


<h3>Slots</h3>


<dl>
<dt><code>data.cov.life</code></dt><dd><p>Single <code>data.table</code> with all static covariate data for the lifetime process</p>
</dd>
<dt><code>data.cov.trans</code></dt><dd><p>Single <code>data.table</code> with all static covariate data for the transaction process</p>
</dd>
<dt><code>names.cov.data.life</code></dt><dd><p>Character vector with names of the static lifetime covariates.</p>
</dd>
<dt><code>names.cov.data.trans</code></dt><dd><p>Character vector with names of the static transaction covariates.</p>
</dd>
</dl>


<h3>See Also</h3>

<p>Definition of the parent class <a href="#topic+clv.data-class">clv.data</a>.
</p>
<p>For fitting covariate models: <code><a href="#topic+pnbd">pnbd</a></code>
</p>

<hr>
<h2 id='clv.fitted-class'>Fitted model without covariates</h2><span id='topic+clv.fitted-class'></span><span id='topic+show+2Cclv.fitted-method'></span>

<h3>Description</h3>

<p>The class stores the transaction data and various optimization outputs and options.
It is created already when model fitting is initiated and is then used to perform no covariate specific steps
during the estimation process.
Serves as parent classes to fitted transaction and spending models.
</p>
<p>Created with an existing clv.data and clv.model object (or subclasses thereof).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'clv.fitted'
show(object)
</code></pre>


<h3>Slots</h3>


<dl>
<dt><code>call</code></dt><dd><p>Single language of the call used to create the object</p>
</dd>
<dt><code>clv.model</code></dt><dd><p>Single object of (sub-) class <code>clv.model</code> that determines model-specific behavior.</p>
</dd>
<dt><code>clv.data</code></dt><dd><p>Single object of (sub-) class <code>clv.data</code> that contains the data and temporal information to fit the model to.</p>
</dd>
<dt><code>model.specification.args</code></dt><dd><p>Model specification given by the user with which the model was fit. Used to re-fit the model on new data (bootstrapping).</p>
</dd>
<dt><code>prediction.params.model</code></dt><dd><p>Numeric vector of the model parameters, set and used solely when predicting. Named after model parameters in original scale and derived from <code>coef()</code>.</p>
</dd>
<dt><code>optimx.estimation.output</code></dt><dd><p>A single object of class <code>optimx</code> as returned from method <code>optimx::optimx</code> after optimizing the log-likelihood fitting the model.</p>
</dd>
<dt><code>optimx.hessian</code></dt><dd><p>Single matrix that is the hessian extracted from the last row of the optimization output stored in the slot <code>optimx.estimation.output</code>.</p>
</dd>
</dl>


<h3>See Also</h3>

<p><a href="#topic+clv.fitted.spending-class">clv.fitted.spending</a>, <a href="#topic+clv.fitted.transactions-class">clv.fitted.transactions</a>, <a href="#topic+clv.fitted.transactions.static.cov-class">clv.fitted.transactions.static.cov</a>, <a href="#topic+clv.fitted.transactions.dynamic.cov-class">clv.fitted.transactions.dynamic.cov</a>
</p>

<hr>
<h2 id='clv.fitted.spending-class'>Fitted Spending Model</h2><span id='topic+clv.fitted.spending-class'></span>

<h3>Description</h3>

<p>Extends the class <code>clv.fitted</code> with slots for spending models and performs steps during the
estimation, prediction and plotting process that are specific to all spending models.
</p>


<h3>Slots</h3>


<dl>
<dt><code>estimation.removed.first.transaction</code></dt><dd><p>Single boolean whether every customers' first transaction was removed when counting transactions.</p>
</dd>
</dl>


<h3>See Also</h3>

<p>Definition of the parent class <a href="#topic+clv.fitted-class">clv.fitted</a>
</p>
<p>For transaction models <a href="#topic+clv.fitted.transactions-class">clv.fitted.transactions</a>
</p>

<hr>
<h2 id='clv.fitted.transactions-class'>Fitted Transaction Model without covariates</h2><span id='topic+clv.fitted.transactions-class'></span>

<h3>Description</h3>

<p>Extends the class <code>clv.fitted</code> to performs steps during the
estimation, prediction and plotting process that are specific to all transaction models.
</p>


<h3>See Also</h3>

<p>Definition of the parent class <a href="#topic+clv.fitted-class">clv.fitted</a>
</p>
<p>For spending models <a href="#topic+clv.fitted.spending-class">clv.fitted.spending</a>
</p>

<hr>
<h2 id='clv.fitted.transactions.dynamic.cov-class'>Fitted CLV Model with Dynamic covariates</h2><span id='topic+clv.fitted.transactions.dynamic.cov-class'></span>

<h3>Description</h3>

<p>Extends the class <a href="#topic+clv.fitted.transactions.static.cov-class">clv.fitted.transactions.static.cov</a> but adds no
additional slots to it. The purpose of this class rather is to perform steps during the fitting
process that are specific to dynamic covariates models.
</p>


<h3>See Also</h3>

<p><a href="#topic+clv.fitted-class">clv.fitted</a>, <a href="#topic+clv.fitted.transactions.static.cov-class">clv.fitted.transactions.static.cov</a>
</p>

<hr>
<h2 id='clv.fitted.transactions.static.cov-class'>Fitted Transaction Model with Static covariates</h2><span id='topic+clv.fitted.transactions.static.cov-class'></span><span id='topic+show+2Cclv.fitted.transactions.static.cov-method'></span>

<h3>Description</h3>

<p>Extends the class <code>clv.fitted.transactions</code> with slots to accommodate the various additional
optimization options that can be used for covariates models.
Also used to perform steps during the estimation process that are specific to static covariates models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'clv.fitted.transactions.static.cov'
show(object)
</code></pre>


<h3>Slots</h3>


<dl>
<dt><code>estimation.used.constraints</code></dt><dd><p>Single boolean whether the estimation constraint any covariate parameters to be the same for both processes.</p>
</dd>
<dt><code>names.original.params.constr</code></dt><dd><p>Character vector with the original names of the constraint covariate parameters. Length zero if none are constraint.</p>
</dd>
<dt><code>names.original.params.free.life</code></dt><dd><p>Character vector with the original names of the not constraint lifetime covariate parameters. Length zero if none are free.</p>
</dd>
<dt><code>names.original.params.free.trans</code></dt><dd><p>Character vector with the original names of the not constraint transaction covariate parameters. Length zero if none are free.</p>
</dd>
<dt><code>names.prefixed.params.constr</code></dt><dd><p>Character vector with the prefixed names of the constraint covariate parameters during optimization. Length zero if none are constraint.</p>
</dd>
<dt><code>names.prefixed.params.free.life</code></dt><dd><p>Character vector with the prefixed names of the not constraint lifetime covariate parameters during optimization. Length zero if none are free.</p>
</dd>
<dt><code>names.prefixed.params.free.trans</code></dt><dd><p>Character vector with the prefixed names of the not constraint transaction covariate parameters during optimization. Length zero if none are free.</p>
</dd>
<dt><code>names.prefixed.params.after.constr.life</code></dt><dd><p>Character vector containing the names of all constraint and free lifetime covariates parameters with lifetime prefixes only. Needed after reduplicating the constraint parameters.</p>
</dd>
<dt><code>names.prefixed.params.after.constr.trans</code></dt><dd><p>Character vector containing the names of all constraint and free transaction covariates parameters with transaction prefixes only. Needed after reduplicating the constraint parameters.</p>
</dd>
<dt><code>estimation.used.regularization</code></dt><dd><p>Single boolean whether the estimation used regularization.</p>
</dd>
<dt><code>reg.lambda.life</code></dt><dd><p>Single numeric with the lambda used for regularizing the lifetime covariate parameters. Length zero if regularization is not used.</p>
</dd>
<dt><code>reg.lambda.trans</code></dt><dd><p>Single numeric with the lambda used for regularizing the transaction covariate parameters. Length zero if regularization is not used.</p>
</dd>
<dt><code>prediction.params.life</code></dt><dd><p>Numeric vector of the lifetime covariate parameters, set and used solely when predicting. Named after lifetime covariates and derived from <code>coef()</code>.</p>
</dd>
<dt><code>prediction.params.trans</code></dt><dd><p>Numeric vector of the transaction covariate parameters, set and used solely when predicting. Named after transaction covariates and derived from <code>coef()</code>.</p>
</dd>
</dl>


<h3>See Also</h3>

<p><a href="#topic+clv.fitted-class">clv.fitted</a>, <a href="#topic+clv.fitted.transactions-class">clv.fitted.transactions</a>, <a href="#topic+clv.fitted.transactions.dynamic.cov-class">clv.fitted.transactions.dynamic.cov</a>
</p>

<hr>
<h2 id='clv.gg-class'>Result of fitting the Gamma-Gamma model</h2><span id='topic+clv.gg-class'></span>

<h3>Description</h3>

<p>Output from fitting the Gamma-Gamma model on transactional data. It constitutes the estimation
result and is returned to the user to use it as input to other methods such as to diagnose the model
fit or to predict customer's future spending.
</p>
<p>Inherits from <a href="#topic+clv.fitted.spending-class">clv.fitted.spending</a> in order to execute all steps required to fit a model or to predict
future spending. Contains an instance of class <a href="#topic+clv.model.gg-class">clv.model.gg</a> which
provides the required Gamma-Gamma specific functionalities.
</p>


<h3>Slots</h3>


<dl>
<dt><code>cbs</code></dt><dd><p>Single <code>data.table</code> that contains information about
each customers' mean spending per transaction (Spending) and the number of purchases (x) which
both depend on whether the first transaction was removed or not.</p>
</dd>
</dl>


<h3>See Also</h3>

<p><a href="#topic+clv.fitted-class">clv.fitted</a>, <a href="#topic+clv.fitted.spending-class">clv.fitted.spending</a>, <a href="#topic+clv.model.gg-class">clv.model.gg</a>
</p>

<hr>
<h2 id='clv.ggomnbd-class'>Result of fitting the GGompertz/NBD model without covariates</h2><span id='topic+clv.ggomnbd-class'></span>

<h3>Description</h3>

<p>Output from fitting the GGompertz/NBD model on data without covariates. It constitutes the estimation
result and is returned to the user to use it as input to other methods such as to make
predictions or plot the unconditional expectation.
</p>
<p>Inherits from <a href="#topic+clv.fitted.transactions-class">clv.fitted.transactions</a> in order to execute all steps required for fitting a model
without covariates and it contains an instance of class <a href="#topic+clv.model.ggomnbd.no.cov-class">clv.model.ggomnbd.no.cov</a> which
provides the required GGompertz/NBD (no covariates) specific functionalities.
</p>


<h3>Slots</h3>


<dl>
<dt><code>cbs</code></dt><dd><p>Single <code>data.table</code> that is the Customer-By-Sufficiency matrix with information about
each customers' recency, frequency, and total time observed in number of time-units
and as defined by the GGompertz/NBD model.</p>
</dd>
</dl>


<h3>See Also</h3>

<p><a href="#topic+clv.fitted-class">clv.fitted</a>, <a href="#topic+clv.fitted.transactions-class">clv.fitted.transactions</a>, <a href="#topic+clv.model.ggomnbd.no.cov-class">clv.model.ggomnbd.no.cov</a>, <a href="#topic+clv.ggomnbd.static.cov-class">clv.ggomnbd.static.cov</a>
</p>

<hr>
<h2 id='clv.ggomnbd.static.cov-class'>Result of fitting the GGompertz/NBD model with static covariates</h2><span id='topic+clv.ggomnbd.static.cov-class'></span>

<h3>Description</h3>

<p>Output from fitting the GGompertz/NBD model on data with static covariates. It constitutes the
estimation result and is returned to the user to use it as input to other methods such as
to make predictions or plot the unconditional expectation.
</p>
<p>Inherits from <a href="#topic+clv.fitted.transactions.static.cov-class">clv.fitted.transactions.static.cov</a> in order to execute all steps required for fitting a model
with static covariates and it contains an instance of class <a href="#topic+clv.model.ggomnbd.static.cov-class">clv.model.ggomnbd.static.cov</a> which
provides the required GGompertz/NBD (static covariates) specific functionalities.
</p>


<h3>Slots</h3>


<dl>
<dt><code>cbs</code></dt><dd><p>Single <code>data.table</code> that is the Customer-By-Sufficiency matrix with information about
each customers' recency, frequency, and total time observed in number of time-units
and as defined by the GGompertz/NBD model.</p>
</dd>
</dl>


<h3>See Also</h3>

<p><a href="#topic+clv.fitted.transactions.static.cov-class">clv.fitted.transactions.static.cov</a>, <a href="#topic+clv.model.ggomnbd.static.cov-class">clv.model.ggomnbd.static.cov</a>, <a href="#topic+clv.ggomnbd-class">clv.ggomnbd</a>
</p>

<hr>
<h2 id='clv.model-class'>CLV Model providing model related functionalities</h2><span id='topic+clv.model-class'></span>

<h3>Description</h3>

<p>Objects of class <code>clv.fitted</code> contain an instance of class clv.model that is called
whenever a model-related step is performed (Strategy pattern).
</p>
<p>This class is the abstract parent class from which new clv models inherit. It implements
only stubs (with stop()) for all methods that need to be implemented in order
to obtain a functional <code>clv.fitted</code> object.
</p>


<h3>Slots</h3>


<dl>
<dt><code>name.model</code></dt><dd><p>Name of the model as it should be displayed</p>
</dd>
<dt><code>fn.model.generic</code></dt><dd><p>Method (generic) to apply on (sub-class of) clv.data in order to fit the model.</p>
</dd>
<dt><code>names.original.params.model</code></dt><dd><p>character vector that defines the names of the model parameters as they should be reported</p>
</dd>
<dt><code>names.prefixed.params.model</code></dt><dd><p>character vector that defines the names of the model parameters as they are named during LL optimization</p>
</dd>
<dt><code>start.params.model</code></dt><dd><p>numeric vector of default values at original scale that should be used for the LL optimization if the user does not provide start parameters. Named with <code>names.original.params.model</code>.</p>
</dd>
<dt><code>optimx.defaults</code></dt><dd><p>list of default arguments for calling <code><a href="optimx.html#topic+optimx">optimx</a></code> with <code>do.call</code>. Named after the respective arguments in optimx.</p>
</dd>
</dl>


<h3>See Also</h3>

<p>CLV model subclasses with and without support for fitting with correlation <a href="#topic+clv.model.with.correlation-class">clv.model.with.correlation</a>, <a href="#topic+clv.model.no.correlation-class">clv.model.no.correlation</a>
</p>
<p>Class using its instances: <a href="#topic+clv.fitted-class">clv.fitted</a>
</p>

<hr>
<h2 id='clv.model.bgnbd.no.cov-class'>CLV Model functionality for BG/NBD without covariates</h2><span id='topic+clv.model.bgnbd.no.cov-class'></span>

<h3>Description</h3>

<p>This class implements the functionalities and model-specific steps which are required
to fit the BG/NBD model without covariates.
</p>


<h3>See Also</h3>

<p>Other clv model classes <a href="#topic+clv.model-class">clv.model</a>, <a href="#topic+clv.model.bgnbd.static.cov-class">clv.model.bgnbd.static.cov</a>
</p>
<p>Classes using its instance: <a href="#topic+clv.fitted-class">clv.fitted</a>
</p>

<hr>
<h2 id='clv.model.bgnbd.static.cov-class'>CLV Model functionality for BG/NBD with static covariates</h2><span id='topic+clv.model.bgnbd.static.cov-class'></span>

<h3>Description</h3>

<p>This class implements the functionalities and model-specific steps which are required
to fit the BG/NBD model with static covariates.
</p>


<h3>See Also</h3>

<p>Other clv model classes <a href="#topic+clv.model-class">clv.model</a>, <a href="#topic+clv.model.bgnbd.no.cov-class">clv.model.bgnbd.no.cov</a>
</p>
<p>Classes using its instance: <a href="#topic+clv.fitted.transactions.static.cov-class">clv.fitted.transactions.static.cov</a>
</p>

<hr>
<h2 id='clv.model.gg-class'>CLV Model functionality for the Gamma-Gamma spending model</h2><span id='topic+clv.model.gg-class'></span>

<h3>Description</h3>

<p>This class implements the functionalities and model-specific steps which are required
to fit the Gamma-Gamma spending model.
</p>

<hr>
<h2 id='clv.model.ggomnbd.no.cov-class'>CLV Model functionality for GGompertz/NBD without covariates</h2><span id='topic+clv.model.ggomnbd.no.cov-class'></span>

<h3>Description</h3>

<p>This class implements the functionalities and model-specific steps which are required
to fit the GGompertz/NBD model without covariates.
</p>


<h3>See Also</h3>

<p>Other clv model classes <a href="#topic+clv.model-class">clv.model</a>, <a href="#topic+clv.model.ggomnbd.static.cov-class">clv.model.ggomnbd.static.cov</a>
</p>
<p>Classes using its instance: <a href="#topic+clv.fitted-class">clv.fitted</a>
</p>

<hr>
<h2 id='clv.model.ggomnbd.static.cov-class'>CLV Model functionality for GGompertz/NBD with static covariates</h2><span id='topic+clv.model.ggomnbd.static.cov-class'></span>

<h3>Description</h3>

<p>This class implements the functionalities and model-specific steps which are required
to fit the GGompertz/NBD model with static covariates.
</p>


<h3>See Also</h3>

<p>Other clv model classes <a href="#topic+clv.model-class">clv.model</a>, <a href="#topic+clv.model.ggomnbd.no.cov-class">clv.model.ggomnbd.no.cov</a>
</p>
<p>Classes using its instance: <a href="#topic+clv.fitted.transactions.static.cov-class">clv.fitted.transactions.static.cov</a>
</p>

<hr>
<h2 id='clv.model.no.correlation-class'>CLV Model without support for life-trans correlation</h2><span id='topic+clv.model.no.correlation-class'></span>

<h3>Description</h3>

<p>This class serves as a parent class to other clv.model classes that cannot be fit with correlation between the
lifetime and transaction process.
</p>


<h3>See Also</h3>

<p>Parent class <a href="#topic+clv.model-class">clv.model</a>
</p>
<p>CLV model subclasses  <a href="#topic+clv.model.bgnbd.no.cov-class">clv.model.bgnbd.no.cov</a>, <a href="#topic+clv.model.ggomnbd.no.cov-class">clv.model.ggomnbd.no.cov</a>
</p>

<hr>
<h2 id='clv.model.pnbd.dynamic.cov-class'>CLV Model functionality for PNBD with dynamic covariates</h2><span id='topic+clv.model.pnbd.dynamic.cov-class'></span>

<h3>Description</h3>

<p>This class implements the functionalities and model-specific steps which are required
to fit the Pareto/NBD model with dynamic covariates.
</p>


<h3>See Also</h3>

<p>Other clv model classes <a href="#topic+clv.model-class">clv.model</a>, <a href="#topic+clv.model.pnbd.no.cov-class">clv.model.pnbd.no.cov</a>, <a href="#topic+clv.model.pnbd.static.cov-class">clv.model.pnbd.static.cov</a>
</p>
<p>Classes using its instance: <a href="#topic+clv.fitted.transactions.dynamic.cov-class">clv.fitted.transactions.dynamic.cov</a>
</p>

<hr>
<h2 id='clv.model.pnbd.no.cov-class'>CLV Model functionality for Pareto/NBD without covariates</h2><span id='topic+clv.model.pnbd.no.cov-class'></span>

<h3>Description</h3>

<p>This class implements the functionalities and model-specific steps which are required
to fit the Pareto/NBD model without covariates.
</p>


<h3>See Also</h3>

<p>Other clv model classes <a href="#topic+clv.model-class">clv.model</a>, <a href="#topic+clv.model.pnbd.static.cov-class">clv.model.pnbd.static.cov</a>, <a href="#topic+clv.model.pnbd.dynamic.cov-class">clv.model.pnbd.dynamic.cov</a>
</p>
<p>Classes using its instance: <a href="#topic+clv.fitted-class">clv.fitted</a>
</p>

<hr>
<h2 id='clv.model.pnbd.static.cov-class'>CLV Model functionality for Pareto/NBD with static covariates</h2><span id='topic+clv.model.pnbd.static.cov-class'></span>

<h3>Description</h3>

<p>This class implements the functionalities and model-specific steps which are required
to fit the Pareto/NBD model with static covariates.
</p>


<h3>See Also</h3>

<p>Other clv model classes <a href="#topic+clv.model-class">clv.model</a>, <a href="#topic+clv.model.pnbd.no.cov-class">clv.model.pnbd.no.cov</a>, <a href="#topic+clv.model.pnbd.dynamic.cov-class">clv.model.pnbd.dynamic.cov</a>
</p>
<p>Classes using its instance: <a href="#topic+clv.fitted.transactions.static.cov-class">clv.fitted.transactions.static.cov</a>
</p>

<hr>
<h2 id='clv.model.with.correlation-class'>CLV Model providing life-trans correlation related functionalities</h2><span id='topic+clv.model.with.correlation-class'></span>

<h3>Description</h3>

<p>This class serves as a parent class to other clv.model classes and provides the functionality needed
to fit a model with correlation between the lifetime and transaction process.
</p>


<h3>Slots</h3>


<dl>
<dt><code>estimation.used.correlation</code></dt><dd><p>Single boolean whether the correlation was estimated.</p>
</dd>
<dt><code>name.prefixed.cor.param.m</code></dt><dd><p>Single character vector of the internal name used for the correlation parameter during optimization.</p>
</dd>
<dt><code>name.correlation.cor</code></dt><dd><p>Single character vector of the external name used for the correlation parameter.</p>
</dd>
</dl>


<h3>See Also</h3>

<p>Parent class <a href="#topic+clv.model-class">clv.model</a>
</p>
<p>CLV model subclasses  <a href="#topic+clv.model.pnbd.no.cov-class">clv.model.pnbd.no.cov</a>, <a href="#topic+clv.model.pnbd.static.cov-class">clv.model.pnbd.static.cov</a>, <a href="#topic+clv.model.pnbd.dynamic.cov-class">clv.model.pnbd.dynamic.cov</a>
</p>

<hr>
<h2 id='clv.pnbd-class'>Result of fitting the Pareto/NBD model without covariates</h2><span id='topic+clv.pnbd-class'></span>

<h3>Description</h3>

<p>Output from fitting the Pareto/NBD model on data without covariates. It constitutes the estimation
result and is returned to the user to use it as input to other methods such as to make
predictions or plot the unconditional expectation.
</p>
<p>Inherits from <a href="#topic+clv.fitted.transactions-class">clv.fitted.transactions</a> in order to execute all steps required for fitting a model
without covariates and it contains an instance of class <a href="#topic+clv.model.pnbd.no.cov-class">clv.model.pnbd.no.cov</a> which
provides the required Pareto/NBD (no covariates) specific functionalities.
</p>


<h3>Slots</h3>


<dl>
<dt><code>cbs</code></dt><dd><p>Single <code>data.table</code> that is the Customer-By-Sufficiency matrix with information about
each customers' recency, frequency, and total time observed in number of time-units
and as defined by the Pareto/NBD model.</p>
</dd>
</dl>


<h3>See Also</h3>

<p><a href="#topic+clv.fitted.transactions-class">clv.fitted.transactions</a>, <a href="#topic+clv.model.pnbd.no.cov-class">clv.model.pnbd.no.cov</a>, <a href="#topic+clv.pnbd.static.cov-class">clv.pnbd.static.cov</a>, <a href="#topic+clv.pnbd.dynamic.cov-class">clv.pnbd.dynamic.cov</a>
</p>

<hr>
<h2 id='clv.pnbd.dynamic.cov-class'>Result of fitting the Pareto/NBD model with dynamic covariates</h2><span id='topic+clv.pnbd.dynamic.cov-class'></span>

<h3>Description</h3>

<p>Output from fitting the Pareto/NBD model on data with dynamic covariates. It constitutes the
estimation result and is returned to the user to use it as input to other methods such as
to make predictions or plot the unconditional expectation.
</p>
<p>Inherits from <code>clv.fitted.transactions.dynamic.cov</code> in order to execute all steps required for fitting a model
with dynamic covariates and it contains an instance of class <code>clv.model.pnbd.dynamic.cov</code> which
provides the required Pareto/NBD (dynamic covariates) specific functionalities.
</p>


<h3>Slots</h3>


<dl>
<dt><code>cbs</code></dt><dd><p>Single <code>data.table</code> that is the Customer-By-Sufficiency matrix with information about
each customers' recency, frequency, and total time observed in number of time-units
and as defined by the Pareto/NBD model.</p>
</dd>
</dl>


<h3>See Also</h3>

<p><a href="#topic+clv.fitted.transactions.dynamic.cov-class">clv.fitted.transactions.dynamic.cov</a>, <a href="#topic+clv.model.pnbd.dynamic.cov-class">clv.model.pnbd.dynamic.cov</a>, <a href="#topic+clv.pnbd-class">clv.pnbd</a>, <a href="#topic+clv.pnbd.static.cov-class">clv.pnbd.static.cov</a>
</p>

<hr>
<h2 id='clv.pnbd.static.cov-class'>Result of fitting the Pareto/NBD model with static covariates</h2><span id='topic+clv.pnbd.static.cov-class'></span>

<h3>Description</h3>

<p>Output from fitting the Pareto/NBD model on data with static covariates. It constitutes the
estimation result and is returned to the user to use it as input to other methods such as
to make predictions or plot the unconditional expectation.
</p>
<p>Inherits from <a href="#topic+clv.fitted.transactions.static.cov-class">clv.fitted.transactions.static.cov</a> in order to execute all steps required for fitting a model
with static covariates and it contains an instance of class <a href="#topic+clv.model.pnbd.static.cov-class">clv.model.pnbd.static.cov</a> which
provides the required Pareto/NBD (static covariates) specific functionalities.
</p>


<h3>Slots</h3>


<dl>
<dt><code>cbs</code></dt><dd><p>Single <code>data.table</code> that is the Customer-By-Sufficiency matrix with information about
each customers' recency, frequency, and total time observed in number of time-units
and as defined by the Pareto/NBD model.</p>
</dd>
</dl>


<h3>See Also</h3>

<p><a href="#topic+clv.fitted.transactions.static.cov-class">clv.fitted.transactions.static.cov</a>, <a href="#topic+clv.model.pnbd.static.cov-class">clv.model.pnbd.static.cov</a>, <a href="#topic+clv.pnbd-class">clv.pnbd</a>, <a href="#topic+clv.pnbd.dynamic.cov-class">clv.pnbd.dynamic.cov</a>
</p>

<hr>
<h2 id='clv.time-class'>Time Unit defining conceptual periods</h2><span id='topic+clv.time-class'></span><span id='topic+show+2Cclv.time-method'></span>

<h3>Description</h3>

<p>Represents a time unit and offers methods for time unit related functionality.
It stores all information related to timepoints (i.e. time and dates) of the
estimation and holdout sample periods and offers methods to parse user input
and to do 'time-unit math'.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'clv.time'
show(object)
</code></pre>


<h3>Details</h3>

<p>This encapsulation of all time unit functionality in one class allows for custom type of
time units such as Bi-weekly or irregularly spaced time units.
</p>
<p><code>clv.time</code> is a virtual class and sub-classes implement the actual parsing and calculations.
</p>
<p><a href="#topic+clv.time.date-class">clv.time.date</a> uses data type <code>Date</code> for time units equal or
greater than a single day that do not require a time of day.
</p>
<p><a href="#topic+clv.time.datetime-class">clv.time.datetime</a> uses data type <code>POSIXct</code> for
time units smaller than a single day.
</p>


<h3>Slots</h3>


<dl>
<dt><code>timepoint.estimation.start</code></dt><dd><p>Single <code>Date</code> or <code>POSIXct</code> that stores the start of the estimation period.</p>
</dd>
<dt><code>timepoint.estimation.end</code></dt><dd><p>Single <code>Date</code> or <code>POSIXct</code> that stores the end of the estimation period.</p>
</dd>
<dt><code>timepoint.holdout.start</code></dt><dd><p>Single <code>Date</code> or <code>POSIXct</code> that stores the start of the holdout period.</p>
</dd>
<dt><code>timepoint.holdout.end</code></dt><dd><p>Single <code>Date</code> or <code>POSIXct</code> that stores the end of the holdout period.</p>
</dd>
<dt><code>time.format</code></dt><dd><p>Single character vector with the format that is used to parse dates and times given as characters.</p>
</dd>
<dt><code>estimation.period.in.tu</code></dt><dd><p>Single numeric indicating the length of the estimation period in number of time units.</p>
</dd>
<dt><code>holdout.period.in.tu</code></dt><dd><p>Single numeric indicating the length of the holdout period in number of time units.</p>
</dd>
<dt><code>name.time.unit</code></dt><dd><p>Single character vector storing the human-readable name of the time unit for output.</p>
</dd>
</dl>


<h3>See Also</h3>

<p><a href="#topic+summary.clv.time">summary.clv.time</a> for a summary about an object of class <code>clv.time</code>
</p>
<p><a href="#topic+clv.time.days-class">clv.time.days</a> for an implementation of time unit 'Days'
</p>
<p><a href="#topic+clv.time.weeks-class">clv.time.weeks</a> for an implementation of time unit 'Weeks'
</p>
<p><a href="#topic+clv.time.years-class">clv.time.years</a> for an implementation of time unit 'Years'
</p>

<hr>
<h2 id='clv.time.date-class'>Date based time-units</h2><span id='topic+clv.time.date-class'></span>

<h3>Description</h3>

<p>Virtual base class for time units that need only whole day granularity.
This class processes time and dates at day level ignoring the time of day
and stores all timepoints using data type <code>Date</code>.
</p>


<h3>Slots</h3>


<dl>
<dt><code>timepoint.estimation.start</code></dt><dd><p>Single <code>Date</code> that stores the start of the estimation period.</p>
</dd>
<dt><code>timepoint.estimation.end</code></dt><dd><p>Single <code>Date</code> that stores the end of the estimation period.</p>
</dd>
<dt><code>timepoint.holdout.start</code></dt><dd><p>Single <code>Date</code> that stores the start of the holdout period.</p>
</dd>
<dt><code>timepoint.holdout.end</code></dt><dd><p>Single <code>Date</code> that stores the end of the holdout period.</p>
</dd>
</dl>


<h3>See Also</h3>

<p>For time unit implementations based on this class: <a href="#topic+clv.time.days-class">clv.time.days</a>, <a href="#topic+clv.time.weeks-class">clv.time.weeks</a>, <a href="#topic+clv.time.years-class">clv.time.years</a>
</p>

<hr>
<h2 id='clv.time.datetime-class'>POSIXct based time-units</h2><span id='topic+clv.time.datetime-class'></span>

<h3>Description</h3>

<p>Virtual base class for time units that define periods smaller than a single day.
This class processes time and dates at the single seconds level and
stores all timepoints using data type <code>POSIXct</code>.
</p>


<h3>Slots</h3>


<dl>
<dt><code>timepoint.estimation.start</code></dt><dd><p>Single <code>POSIXct</code> that stores the start of the estimation period.</p>
</dd>
<dt><code>timepoint.estimation.end</code></dt><dd><p>Single <code>POSIXct</code> that stores the end of the estimation period.</p>
</dd>
<dt><code>timepoint.holdout.start</code></dt><dd><p>Single <code>POSIXct</code> that stores the start of the holdout period.</p>
</dd>
<dt><code>timepoint.holdout.end</code></dt><dd><p>Single <code>POSIXct</code> that stores the end of the holdout period.</p>
</dd>
<dt><code>timezone</code></dt><dd><p>Single character vector indicating the enforced timezone when parsing inputs to timepoints.
Defaults to UTC, but may be overwritten by a subclass to enforce a different timezone than UTC.</p>
</dd>
</dl>


<h3>See Also</h3>

<p>For time unit implementations based on this class: <a href="#topic+clv.time.hours-class">clv.time.hours</a>
</p>

<hr>
<h2 id='clv.time.days-class'>Time unit representing a single Day</h2><span id='topic+clv.time.days-class'></span>

<h3>Description</h3>

<p>Inherits from <code>clv.time.date</code> and therefore stores all timepoints
with instances of class <code>Date</code>. Hence, no temporal resolution finer than 1 day is
possible with this time unit.
</p>


<h3>See Also</h3>

<p><a href="#topic+clv.time-class">clv.time</a>
</p>
<p><a href="#topic+clv.time.date-class">clv.time.date</a>
</p>

<hr>
<h2 id='clv.time.hours-class'>Time unit representing a single hour</h2><span id='topic+clv.time.hours-class'></span>

<h3>Description</h3>

<p>Time unit representing a single hour
</p>

<hr>
<h2 id='clv.time.weeks-class'>Time unit representing a single Week</h2><span id='topic+clv.time.weeks-class'></span>

<h3>Description</h3>

<p>Inherits from <code>clv.time.date</code> and therefore stores all timepoints
with instances of class <code>Date</code>. Hence, no temporal resolution finer than 1 day is
possible with this time unit.
</p>

<hr>
<h2 id='clv.time.years-class'>Time unit representing a single Year</h2><span id='topic+clv.time.years-class'></span>

<h3>Description</h3>

<p>Inherits from <code>clv.time.date</code> and therefore stores all timepoints
with instances of class <code>Date</code>. Hence, no temporal resolution finer than 1 day is
possible with this time unit.
</p>

<hr>
<h2 id='clvdata'>Create an object for transactional data required to estimate CLV</h2><span id='topic+clvdata'></span>

<h3>Description</h3>

<p>Creates a data object that contains the prepared transaction data and that is used as input for
model fitting. The transaction data may be split in an estimation and holdout sample if desired.
The model then will only be fit on the estimation sample.
</p>
<p>If covariates should be used when fitting a model, covariate data can be added
to an object returned from this function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>clvdata(
  data.transactions,
  date.format,
  time.unit,
  estimation.split = NULL,
  name.id = "Id",
  name.date = "Date",
  name.price = "Price"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="clvdata_+3A_data.transactions">data.transactions</code></td>
<td>
<p>Transaction data as <code>data.frame</code> or <code>data.table</code>. See details.</p>
</td></tr>
<tr><td><code id="clvdata_+3A_date.format">date.format</code></td>
<td>
<p>Character string that indicates the format of the date variable in the data used. See details.</p>
</td></tr>
<tr><td><code id="clvdata_+3A_time.unit">time.unit</code></td>
<td>
<p>What time unit defines a period. May be abbreviated, capitalization is ignored. See details.</p>
</td></tr>
<tr><td><code id="clvdata_+3A_estimation.split">estimation.split</code></td>
<td>
<p>Indicates the length of the estimation period. See details.</p>
</td></tr>
<tr><td><code id="clvdata_+3A_name.id">name.id</code></td>
<td>
<p>Column name of the customer id in <code>data.transactions</code>.</p>
</td></tr>
<tr><td><code id="clvdata_+3A_name.date">name.date</code></td>
<td>
<p>Column name of the transaction date in <code>data.transactions</code>.</p>
</td></tr>
<tr><td><code id="clvdata_+3A_name.price">name.price</code></td>
<td>
<p>Column name of price in <code>data.transactions</code>. NULL if no spending data is present.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>data.transactions</code> A <code>data.frame</code> or <code>data.table</code> with customers' purchase history.
Every transaction record consists of a purchase date and a customer id.
Optionally, the price of the transaction may be included to also allow for prediction
of future customer spending.
</p>
<p><code>time.unit</code> The definition of a single period. Currently available are <code>"hours"</code>, <code>"days"</code>, <code>"weeks"</code>, and <code>"years"</code>.
May be abbreviated.
</p>
<p><code>date.format</code> A single format to use when parsing any date that is given as character input. This includes
the dates given in <code>data.transaction</code>, <code>estimation.split</code>, or as an input to any other function at
a later point, such as <code>prediction.end</code> in <code>predict</code>.
The function <code><a href="lubridate.html#topic+parse_date_time">parse_date_time</a></code> of package <code>lubridate</code> is used to parse inputs
and hence all formats it accepts in argument <code>orders</code> can be used. For example, a date of format &quot;year-month-day&quot;
(i.e., &quot;2010-06-17&quot;) is indicated with <code>"ymd"</code>. Other combinations such as <code>"dmy"</code>, <code>"dym"</code>,
<code>"ymd HMS"</code>, or <code>"HMS dmy"</code> are possible as well.
</p>
<p><code>estimation.split</code> May be specified as either the number of periods since the first transaction or the timepoint
(either as character, Date, or POSIXct) at which the estimation period ends. The indicated timepoint itself will be part of the estimation sample.
If no value is provided or set to <code>NULL</code>, the whole dataset will used for fitting the model (no holdout sample).
</p>


<h4>Aggregation of Transactions</h4>

<p>Multiple transactions by the same customer that occur on the minimally representable temporal resolution are aggregated to a
single transaction with their spending summed. For time units <code>days</code> and any other coarser <code>Date</code>-based
time units (i.e. <code>weeks</code>, <code>years</code>), this means that transactions on the same day are combined.
When using finer time units such as <code>hours</code> which are based on <code>POSIXct</code>, transactions on the same second are aggregated.
</p>
<p>For the definition of repeat-purchases, combined transactions are viewed as a single transaction. Hence, repeat-transactions
are determined from the aggregated transactions.
</p>



<h3>Value</h3>

<p>An object of class <code>clv.data</code>.
See the class definition <a href="#topic+clv.data-class">clv.data</a>
for more details about the returned object.
</p>
<p>The function <code>summary</code> can be used to obtain and print a summary of the data.
The generic accessor function <code>nobs</code> is available to read out the number of customers.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+SetStaticCovariates">SetStaticCovariates</a></code> to add static covariates
</p>
<p><code><a href="#topic+SetDynamicCovariates">SetDynamicCovariates</a></code> for how to add dynamic covariates
</p>
<p><code><a href="#topic+plot.clv.data">plot</a></code> to plot the repeat transactions
</p>
<p><code><a href="#topic+summary.clv.data">summary</a></code> to summarize the transaction data
</p>
<p><code><a href="#topic+pnbd">pnbd</a></code> to fit Pareto/NBD models on a <code>clv.data</code> object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


data("cdnow")

# create clv data object with weekly periods
#    and no splitting
clv.data.cdnow &lt;- clvdata(data.transactions = cdnow,
                          date.format="ymd",
                          time.unit = "weeks")

# same but split after 37 periods
clv.data.cdnow &lt;- clvdata(data.transactions = cdnow,
                          date.format="ymd",
                          time.unit = "w",
                          estimation.split = 37)

# same but estimation end on the 15th Oct 1997
clv.data.cdnow &lt;- clvdata(data.transactions = cdnow,
                          date.format="ymd",
                          time.unit = "w",
                          estimation.split = "1997-10-15")

# summary of the transaction data
summary(clv.data.cdnow)

# plot the total number of transactions per period
plot(clv.data.cdnow)

## Not run: 
# create data with the weekly periods defined to
#   start on Mondays

# set start of week to Monday
oldopts &lt;- options("lubridate.week.start"=1)

# create clv.data while Monday is the beginning of the week
clv.data.cdnow &lt;- clvdata(data.transactions = cdnow,
                          date.format="ymd",
                          time.unit = "weeks")

# Dynamic covariates now have to be supplied for every Monday

# set week start to what it was before
options(oldopts)

## End(Not run)




</code></pre>

<hr>
<h2 id='fitted.clv.fitted'>Extract Unconditional Expectation</h2><span id='topic+fitted.clv.fitted'></span>

<h3>Description</h3>

<p>Extract the unconditional expectation (future transactions unconditional on being &quot;alive&quot;) from a fitted clv model.
This is the unconditional expectation data that is used when plotting the fitted model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'clv.fitted'
fitted(object, prediction.end = NULL, verbose = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fitted.clv.fitted_+3A_object">object</code></td>
<td>
<p>A fitted clv model for which the unconditional expectation is desired.</p>
</td></tr>
<tr><td><code id="fitted.clv.fitted_+3A_prediction.end">prediction.end</code></td>
<td>
<p> Until what point in time to predict. This can be the number of periods (numeric) or a form of date/time object. See details.</p>
</td></tr>
<tr><td><code id="fitted.clv.fitted_+3A_verbose">verbose</code></td>
<td>
<p>Show details about the running of the function.</p>
</td></tr>
<tr><td><code id="fitted.clv.fitted_+3A_...">...</code></td>
<td>
<p>Ignored</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>prediction.end</code> indicates until when to predict or plot and can be given as either
a point in time (of class <code>Date</code>, <code>POSIXct</code>, or <code>character</code>) or the number of periods.
If <code>prediction.end</code> is of class character, the date/time format set when creating the data object is used for parsing.
If <code>prediction.end</code> is the number of periods, the end of the fitting period serves as the reference point
from which periods are counted. Only full periods may be specified.
If <code>prediction.end</code> is omitted or NULL, it defaults to the end of the holdout period if present and to the
end of the estimation period otherwise.
</p>
<p>The first prediction period is defined to start right after the end of the estimation period.
If for example weekly time units are used and the estimation period ends on Sunday 2019-01-01, then the first day
of the first prediction period is Monday 2019-01-02. Each prediction period includes a total of 7 days and
the first prediction period therefore will end on, and include, Sunday 2019-01-08. Subsequent prediction periods
again start on Mondays and end on Sundays.
If <code>prediction.end</code> indicates a timepoint on which to end, this timepoint is included in the prediction period.
</p>


<h3>Value</h3>

<p>A <code>data.table</code> which contains the following columns:
</p>
<table role = "presentation">
<tr><td><code>period.until</code></td>
<td>
<p>The timepoint that marks the end (up until and including) of the period to which the data in this row refers.</p>
</td></tr>
<tr><td><code>period.num</code></td>
<td>
<p>The number of this period. </p>
</td></tr>
<tr><td><code>expectation</code></td>
<td>
<p>The value of the unconditional expectation for the period that ends on <code>period.until</code>.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+plot.clv.fitted.transactions">plot</a></code> to plot the unconditional expectation
</p>

<hr>
<h2 id='gg'>Gamma/Gamma Spending model</h2><span id='topic+gg'></span><span id='topic+gg+2Cclv.data-method'></span>

<h3>Description</h3>

<p>Fits the Gamma-Gamma model on a given object of class <code>clv.data</code> to predict customers' mean
spending per transaction.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'clv.data'
gg(
  clv.data,
  start.params.model = c(),
  remove.first.transaction = TRUE,
  optimx.args = list(),
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gg_+3A_clv.data">clv.data</code></td>
<td>
<p>The data object on which the model is fitted.</p>
</td></tr>
<tr><td><code id="gg_+3A_start.params.model">start.params.model</code></td>
<td>
<p>Named start parameters containing the optimization start parameters for the model without covariates.</p>
</td></tr>
<tr><td><code id="gg_+3A_remove.first.transaction">remove.first.transaction</code></td>
<td>
<p>Whether customer's first transaction are removed. If <code>TRUE</code> all zero-repeaters are excluded from model fitting.</p>
</td></tr>
<tr><td><code id="gg_+3A_optimx.args">optimx.args</code></td>
<td>
<p>Additional arguments to control the optimization which are forwarded to <code><a href="optimx.html#topic+optimx">optimx::optimx</a></code>.
If multiple optimization methods are specified, only the result of the last method is further processed.</p>
</td></tr>
<tr><td><code id="gg_+3A_verbose">verbose</code></td>
<td>
<p>Show details about the running of the function.</p>
</td></tr>
<tr><td><code id="gg_+3A_...">...</code></td>
<td>
<p>Ignored</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Model parameters for the G/G model are <code>p, q, and gamma</code>. <br />
<code>p</code>: shape parameter of the Gamma distribution of the spending process. <br />
<code>q</code>: shape parameter of the Gamma distribution to account for customer heterogeneity. <br />
<code>gamma</code>: scale parameter of the Gamma distribution to account for customer heterogeneity.<br />
If no start parameters are given, p=0.5, q=15, gamma=2 is used for all model parameters. All parameters are required
to be &gt; 0.
</p>
<p>The Gamma-Gamma model cannot be estimated for data that contains negative prices.
Customers with a mean spending of zero or a transaction count of zero are ignored during model fitting.
</p>


<h4>The G/G model</h4>

<p>The G/G model allows to predict a value for future customer transactions. Usually, the G/G model is used
in combination with a probabilistic model predicting customer transaction such as the Pareto/NBD or the BG/NBD model.
</p>



<h3>Value</h3>

<p>An object of class <a href="#topic+clv.gg-class">clv.gg</a> is returned.
</p>
<p>The function <code><a href="#topic+summary.clv.fitted">summary</a></code> can be used to obtain and print a summary of the results.
The generic accessor functions <code>coefficients</code>, <code><a href="#topic+vcov.clv.fitted">vcov</a></code>, <code><a href="#topic+fitted.clv.fitted">fitted</a></code>,
<code>logLik</code>, <code>AIC</code>, <code>BIC</code>, and <code>nobs</code> are available.
</p>


<h3>References</h3>

<p>Colombo R, Jiang W (1999). &ldquo;A stochastic RFM model.&rdquo;
Journal of Interactive Marketing, 13(3), 2-12.
</p>
<p>Fader PS, Hardie BG, Lee K (2005). &ldquo;RFM and CLV: Using Iso-Value Curves for
Customer Base Analysis.&rdquo; Journal of Marketing Research, 42(4), 415-430.
</p>
<p>Fader PS, Hardie BG (2013). &ldquo;The Gamma-Gamma Model of Monetary Value.&rdquo;
URL <a href="http://www.brucehardie.com/notes/025/gamma_gamma.pdf">http://www.brucehardie.com/notes/025/gamma_gamma.pdf</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+clvdata">clvdata</a></code> to create a clv data object.
</p>
<p><code><a href="#topic+plot.clv.data">plot</a></code> to plot diagnostics of the transaction data, incl. of spending.
</p>
<p><code><a href="#topic+predict.clv.fitted.spending">predict</a></code> to predict expected mean spending for every customer.
</p>
<p><code><a href="#topic+plot.clv.fitted.spending">plot</a></code> to plot the density of customer's mean transaction value compared to the model's prediction.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("apparelTrans")
clv.data.apparel &lt;- clvdata(apparelTrans, date.format = "ymd",
                            time.unit = "w", estimation.split = 52)

# Fit the gg model
gg(clv.data.apparel)

# Give initial guesses for the model parameters
gg(clv.data.apparel,
     start.params.model = c(p=0.5, q=15, gamma=2))


# pass additional parameters to the optimizer (optimx)
#    Use Nelder-Mead as optimization method and print
#    detailed information about the optimization process
apparel.gg &lt;- gg(clv.data.apparel,
                     optimx.args = list(method="Nelder-Mead",
                                        control=list(trace=6)))

# estimated coefs
coef(apparel.gg)

# summary of the fitted model
summary(apparel.gg)

# Plot model vs empirical distribution
plot(apparel.gg)

# predict mean spending and compare against
#    actuals in the holdout period
predict(apparel.gg)

</code></pre>

<hr>
<h2 id='gg_LL'>Gamma-Gamma: Log-Likelihood Function</h2><span id='topic+gg_LL'></span>

<h3>Description</h3>

<p>Calculates the Log-Likelihood value for the Gamma-Gamma model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gg_LL(vLogparams, vX, vM_x, vN)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gg_LL_+3A_vlogparams">vLogparams</code></td>
<td>
<p>a vector containing the log of the parameters p, q, gamma</p>
</td></tr>
<tr><td><code id="gg_LL_+3A_vx">vX</code></td>
<td>
<p>frequency vector of length n counting the numbers of purchases</p>
</td></tr>
<tr><td><code id="gg_LL_+3A_vm_x">vM_x</code></td>
<td>
<p>the observed average spending for every customer during the calibration time.</p>
</td></tr>
<tr><td><code id="gg_LL_+3A_vn">vN</code></td>
<td>
<p>The value (&quot;number of times observed&quot;) with which the LL value of this observation is multiplied before summing across customers.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>vLogparams</code> is a vector with the parameters for the Gamma-Gamma model.
It has three parameters (p, q, gamma). The scale parameter for each transaction
is distributed across customers according to a gamma distribution with
parameters q (shape) and gamma (scale).
</p>


<h3>Value</h3>

<p>Returns the Log-Likelihood value for the Gamma-Gamma model.
</p>


<h3>References</h3>

<p>Colombo R, Jiang W (1999). &ldquo;A stochastic RFM model.&rdquo;
Journal of Interactive Marketing, 13(3), 2-12.
</p>
<p>Fader PS, Hardie BG, Lee K (2005). &ldquo;RFM and CLV: Using Iso-Value Curves for
Customer Base Analysis.&rdquo; Journal of Marketing Research, 42(4), 415-430.
</p>
<p>Fader PS, Hardie BG (2013). &ldquo;The Gamma-Gamma Model of Monetary Value.&rdquo;
URL <a href="http://www.brucehardie.com/notes/025/gamma_gamma.pdf">http://www.brucehardie.com/notes/025/gamma_gamma.pdf</a>.
</p>

<hr>
<h2 id='ggomnbd'>Gamma-Gompertz/NBD model</h2><span id='topic+ggomnbd'></span><span id='topic+ggomnbd+2Cclv.data.dynamic.covariates-method'></span><span id='topic+ggomnbd+2Cclv.data-method'></span><span id='topic+ggomnbd+2Cclv.data.static.covariates-method'></span>

<h3>Description</h3>

<p>Fits Gamma-Gompertz/NBD models on transactional data with static and without covariates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'clv.data'
ggomnbd(
  clv.data,
  start.params.model = c(),
  optimx.args = list(),
  verbose = TRUE,
  ...
)

## S4 method for signature 'clv.data.static.covariates'
ggomnbd(
  clv.data,
  start.params.model = c(),
  optimx.args = list(),
  verbose = TRUE,
  names.cov.life = c(),
  names.cov.trans = c(),
  start.params.life = c(),
  start.params.trans = c(),
  names.cov.constr = c(),
  start.params.constr = c(),
  reg.lambdas = c(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ggomnbd_+3A_clv.data">clv.data</code></td>
<td>
<p>The data object on which the model is fitted.</p>
</td></tr>
<tr><td><code id="ggomnbd_+3A_start.params.model">start.params.model</code></td>
<td>
<p>Named start parameters containing the optimization start parameters for the model without covariates.</p>
</td></tr>
<tr><td><code id="ggomnbd_+3A_optimx.args">optimx.args</code></td>
<td>
<p>Additional arguments to control the optimization which are forwarded to <code><a href="optimx.html#topic+optimx">optimx::optimx</a></code>.
If multiple optimization methods are specified, only the result of the last method is further processed.</p>
</td></tr>
<tr><td><code id="ggomnbd_+3A_verbose">verbose</code></td>
<td>
<p>Show details about the running of the function.</p>
</td></tr>
<tr><td><code id="ggomnbd_+3A_...">...</code></td>
<td>
<p>Ignored</p>
</td></tr>
<tr><td><code id="ggomnbd_+3A_names.cov.life">names.cov.life</code></td>
<td>
<p>Which of the set Lifetime covariates should be used. Missing parameter indicates all covariates shall be used.</p>
</td></tr>
<tr><td><code id="ggomnbd_+3A_names.cov.trans">names.cov.trans</code></td>
<td>
<p>Which of the set Transaction covariates should be used. Missing parameter indicates all covariates shall be used.</p>
</td></tr>
<tr><td><code id="ggomnbd_+3A_start.params.life">start.params.life</code></td>
<td>
<p>Named start parameters containing the optimization start parameters for all lifetime covariates.</p>
</td></tr>
<tr><td><code id="ggomnbd_+3A_start.params.trans">start.params.trans</code></td>
<td>
<p>Named start parameters containing the optimization start parameters for all transaction covariates.</p>
</td></tr>
<tr><td><code id="ggomnbd_+3A_names.cov.constr">names.cov.constr</code></td>
<td>
<p>Which covariates should be forced to use the same parameters for the lifetime and transaction process. The covariates need to be present as both, lifetime and transaction covariates.</p>
</td></tr>
<tr><td><code id="ggomnbd_+3A_start.params.constr">start.params.constr</code></td>
<td>
<p>Named start parameters containing the optimization start parameters for the constraint covariates.</p>
</td></tr>
<tr><td><code id="ggomnbd_+3A_reg.lambdas">reg.lambdas</code></td>
<td>
<p>Named lambda parameters used for the L2 regularization of the lifetime and the transaction covariate parameters. Lambdas have to be &gt;= 0.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Model parameters for the GGompertz/NBD model are <code>r, alpha, beta, b and s</code>. <br />
<code>r</code>: shape parameter of the Gamma distribution of the purchase process.
The smaller <code>r</code>, the stronger the heterogeneity of the purchase process.<br />
<code>alpha</code>: scale parameter of the Gamma distribution of the purchase process.<br />
<code>beta</code>: scale parameter for the Gamma distribution for the lifetime process.<br />
<code>b</code>: scale parameter of the Gompertz distribution (constant across customers).<br />
<code>s</code>: shape parameter of the Gamma distribution for the lifetime process.
The smaller <code>s</code>, the stronger the heterogeneity of customer lifetimes.
</p>
<p>If no start parameters are given, r=0.5, alpha=2, b=0.1, s=1, beta=0.1 is used.
All model start parameters are required to be &gt; 0. If no start values are given for the covariate parameters,
0.1 is used.
</p>
<p>Note that the DERT expression has not been derived (yet) and it consequently is not possible to calculated
values for DERT and CLV.
</p>


<h4>The Gamma-Gompertz/NBD model</h4>

<p>There are two key differences of the gamma/Gompertz/NBD (GGompertz/NBD) model compared to the relative to the well-known Pareto/NBD
model: (i) its probability density function can exhibit a mode at zero or an interior mode, and (ii) it can be skewed
to the right or to the left. Therefore, the GGompertz/NBD model is more flexible than the Pareto/NBD model.
According to Bemmaor and Glady (2012) can indicate substantial differences in expected residual lifetimes compared to the Pareto/NBD.
The GGompertz/NBD tends to be appropriate when firms are reputed and their offerings are differentiated.
</p>



<h3>Value</h3>

<p>Depending on the data object on which the model was fit, <code>ggomnbd</code> returns either an object of
class <a href="#topic+clv.ggomnbd-class">clv.ggomnbd</a> or <a href="#topic+clv.ggomnbd.static.cov-class">clv.ggomnbd.static.cov</a>.
</p>
<p>The function <code><a href="#topic+summary.clv.fitted">summary</a></code> can be used to obtain and print a summary of the results.
The generic accessor functions <code>coefficients</code>, <code><a href="#topic+vcov.clv.fitted">vcov</a></code>, <code><a href="#topic+fitted.clv.fitted">fitted</a></code>,
<code>logLik</code>, <code>AIC</code>, <code>BIC</code>, and <code>nobs</code> are available.
</p>


<h3>References</h3>

<p>Bemmaor AC, Glady N (2012). &ldquo;Modeling Purchasing Behavior with Sudden &ldquo;Death&rdquo;: A Flexible Customer
Lifetime Model&rdquo; Management Science, 58(5), 1012-1021.
</p>
<p>Adler J (2022).  &ldquo;Comment on â€œModeling Purchasing Behavior with Sudden &ldquo;Death&rdquo;: A Flexible Customer
Lifetime Model&rdquo; Management Science 69(3):1929-1930.
</p>
<p>The expression for the PMF was derived by Adler J (2024). (unpublished)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+clvdata">clvdata</a></code> to create a clv data object, <code><a href="#topic+SetStaticCovariates">SetStaticCovariates</a></code>
to add static covariates to an existing clv data object.
</p>
<p><a href="#topic+gg">gg</a> to fit customer's average spending per transaction with the <code>Gamma-Gamma</code> model
</p>
<p><code><a href="#topic+predict.clv.fitted.transactions">predict</a></code> to predict expected transactions, probability of being alive, and customer lifetime value for every customer
</p>
<p><code><a href="#topic+plot.clv.fitted.transactions">plot</a></code> to plot the unconditional expectation as predicted by the fitted model
</p>
<p><code><a href="#topic+pmf">pmf</a></code> for the probability to make exactly x transactions in the estimation period, given by the probability mass function (PMF).
</p>
<p><code><a href="#topic+newcustomer">newcustomer</a></code> to predict the expected number of transactions for an average new customer.
</p>
<p>The generic functions <code><a href="#topic+vcov.clv.fitted">vcov</a></code>, <code><a href="#topic+summary.clv.fitted">summary</a></code>, <code><a href="#topic+fitted.clv.fitted">fitted</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("apparelTrans")
clv.data.apparel &lt;- clvdata(apparelTrans, date.format = "ymd",
                            time.unit = "w", estimation.split = 52)

# Fit standard ggomnbd model
ggomnbd(clv.data.apparel)

# Give initial guesses for the model parameters
ggomnbd(clv.data.apparel,
     start.params.model = c(r=0.5, alpha=15, b=5, beta=10, s=0.5))


# pass additional parameters to the optimizer (optimx)
#    Use Nelder-Mead as optimization method and print
#    detailed information about the optimization process
apparel.ggomnbd &lt;- ggomnbd(clv.data.apparel,
                     optimx.args = list(method="Nelder-Mead",
                                        control=list(trace=6)))

# estimated coefs
coef(apparel.ggomnbd)

# summary of the fitted model
summary(apparel.ggomnbd)

# predict CLV etc for holdout period
predict(apparel.ggomnbd)

# predict CLV etc for the next 15 periods
predict(apparel.ggomnbd, prediction.end = 15)


# To estimate the ggomnbd model with static covariates,
#   add static covariates to the data
data("apparelStaticCov")
clv.data.static.cov &lt;-
 SetStaticCovariates(clv.data.apparel,
                     data.cov.life = apparelStaticCov,
                     names.cov.life = c("Gender", "Channel"),
                     data.cov.trans = apparelStaticCov,
                     names.cov.trans = c("Gender", "Channel"))

# Fit ggomnbd with static covariates
ggomnbd(clv.data.static.cov)

# Give initial guesses for both covariate parameters
ggomnbd(clv.data.static.cov, start.params.trans = c(Gender=0.75, Channel=0.7),
                   start.params.life  = c(Gender=0.5, Channel=0.5))

# Use regularization
ggomnbd(clv.data.static.cov, reg.lambdas = c(trans = 5, life=5))

# Force the same coefficient to be used for both covariates
ggomnbd(clv.data.static.cov, names.cov.constr = "Gender",
                   start.params.constr = c(Gender=0.5))

# Fit model only with the Channel covariate for life but
# keep all trans covariates as is
ggomnbd(clv.data.static.cov, names.cov.life = c("Channel"))

</code></pre>

<hr>
<h2 id='ggomnbd_CET'>GGompertz/NBD: Conditional Expected Transactions</h2><span id='topic+ggomnbd_CET'></span><span id='topic+ggomnbd_nocov_CET'></span><span id='topic+ggomnbd_staticcov_CET'></span>

<h3>Description</h3>

<p>Calculates the expected number of transactions in a given time period based
on a customer's past transaction behavior and the GGompertz/NBD model parameters.
</p>

<dl>
<dt><code>ggomnbd_nocov_CET</code></dt><dd><p> Conditional Expected Transactions without covariates</p>
</dd>
<dt><code>ggomnbd_staticcov_CET</code></dt><dd><p> Conditional Expected Transactions with static covariates</p>
</dd>
</dl>



<h3>Usage</h3>

<pre><code class='language-R'>ggomnbd_nocov_CET(r, alpha_0, b, s, beta_0, dPeriods, vX, vT_x, vT_cal)

ggomnbd_staticcov_CET(
  r,
  alpha_0,
  b,
  s,
  beta_0,
  dPeriods,
  vX,
  vT_x,
  vT_cal,
  vCovParams_trans,
  vCovParams_life,
  mCov_life,
  mCov_trans
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ggomnbd_CET_+3A_r">r</code></td>
<td>
<p>shape parameter of the Gamma distribution of the purchase process.
The smaller r, the stronger the heterogeneity of the purchase process.</p>
</td></tr>
<tr><td><code id="ggomnbd_CET_+3A_alpha_0">alpha_0</code></td>
<td>
<p>scale parameter of the Gamma distribution of the purchase process.</p>
</td></tr>
<tr><td><code id="ggomnbd_CET_+3A_b">b</code></td>
<td>
<p>scale parameter of the Gompertz distribution (constant across customers)</p>
</td></tr>
<tr><td><code id="ggomnbd_CET_+3A_s">s</code></td>
<td>
<p>shape parameter of the Gamma distribution for the lifetime process
The smaller s, the stronger the heterogeneity of customer lifetimes.</p>
</td></tr>
<tr><td><code id="ggomnbd_CET_+3A_beta_0">beta_0</code></td>
<td>
<p>scale parameter for the Gamma distribution for the lifetime process</p>
</td></tr>
<tr><td><code id="ggomnbd_CET_+3A_dperiods">dPeriods</code></td>
<td>
<p>number of periods to predict</p>
</td></tr>
<tr><td><code id="ggomnbd_CET_+3A_vx">vX</code></td>
<td>
<p>Frequency vector of length n counting the numbers of purchases.</p>
</td></tr>
<tr><td><code id="ggomnbd_CET_+3A_vt_x">vT_x</code></td>
<td>
<p>Recency vector of length n.</p>
</td></tr>
<tr><td><code id="ggomnbd_CET_+3A_vt_cal">vT_cal</code></td>
<td>
<p>Vector of length n indicating the total number of periods of observation.</p>
</td></tr>
<tr><td><code id="ggomnbd_CET_+3A_vcovparams_trans">vCovParams_trans</code></td>
<td>
<p>Vector of estimated parameters for the transaction covariates.</p>
</td></tr>
<tr><td><code id="ggomnbd_CET_+3A_vcovparams_life">vCovParams_life</code></td>
<td>
<p>Vector of estimated parameters for the lifetime covariates.</p>
</td></tr>
<tr><td><code id="ggomnbd_CET_+3A_mcov_life">mCov_life</code></td>
<td>
<p>Matrix containing the covariates data affecting the lifetime process. One column for each covariate.</p>
</td></tr>
<tr><td><code id="ggomnbd_CET_+3A_mcov_trans">mCov_trans</code></td>
<td>
<p>Matrix containing the covariates data affecting the transaction process. One column for each covariate.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>mCov_trans</code> is a matrix containing the covariates data of
the time-invariant covariates that affect the transaction process.
Each column represents a different covariate. For every column a gamma parameter
needs to added to <code>vCovParams_trans</code> at the respective position.
</p>
<p><code>mCov_life</code> is a matrix containing the covariates data of
the time-invariant covariates that affect the lifetime process.
Each column represents a different covariate. For every column a gamma parameter
needs to added to <code>vCovParams_life</code> at the respective position.
</p>


<h3>Value</h3>

<p>Returns a vector containing the conditional expected transactions for the existing
customers in the GGompertz/NBD model.
</p>


<h3>References</h3>

<p>Bemmaor AC, Glady N (2012). &ldquo;Modeling Purchasing Behavior with Sudden &ldquo;Death&rdquo;: A Flexible Customer
Lifetime Model&rdquo; Management Science, 58(5), 1012-1021.
</p>
<p>Adler J (2022).  &ldquo;Comment on â€œModeling Purchasing Behavior with Sudden &ldquo;Death&rdquo;: A Flexible Customer
Lifetime Model&rdquo; Management Science 69(3):1929-1930.
</p>
<p>The expression for the PMF was derived by Adler J (2024). (unpublished)
</p>

<hr>
<h2 id='ggomnbd_expectation'>GGompertz/NBD: Unconditional Expectation</h2><span id='topic+ggomnbd_expectation'></span><span id='topic+ggomnbd_nocov_expectation'></span><span id='topic+ggomnbd_staticcov_expectation'></span>

<h3>Description</h3>

<p>Computes the expected number of repeat transactions in the interval (0, vT_i]
for a randomly selected customer, where 0 is defined as the point when the customer came alive.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ggomnbd_nocov_expectation(r, alpha_0, b, s, beta_0, vT_i)

ggomnbd_staticcov_expectation(r, b, s, vAlpha_i, vBeta_i, vT_i)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ggomnbd_expectation_+3A_r">r</code></td>
<td>
<p>shape parameter of the Gamma distribution of the purchase process.
The smaller r, the stronger the heterogeneity of the purchase process.</p>
</td></tr>
<tr><td><code id="ggomnbd_expectation_+3A_alpha_0">alpha_0</code></td>
<td>
<p>scale parameter of the Gamma distribution of the purchase process.</p>
</td></tr>
<tr><td><code id="ggomnbd_expectation_+3A_b">b</code></td>
<td>
<p>scale parameter of the Gompertz distribution (constant across customers)</p>
</td></tr>
<tr><td><code id="ggomnbd_expectation_+3A_s">s</code></td>
<td>
<p>shape parameter of the Gamma distribution for the lifetime process
The smaller s, the stronger the heterogeneity of customer lifetimes.</p>
</td></tr>
<tr><td><code id="ggomnbd_expectation_+3A_beta_0">beta_0</code></td>
<td>
<p>scale parameter for the Gamma distribution for the lifetime process</p>
</td></tr>
<tr><td><code id="ggomnbd_expectation_+3A_vt_i">vT_i</code></td>
<td>
<p>Number of periods since the customer came alive</p>
</td></tr>
<tr><td><code id="ggomnbd_expectation_+3A_valpha_i">vAlpha_i</code></td>
<td>
<p>Vector of individual parameters alpha</p>
</td></tr>
<tr><td><code id="ggomnbd_expectation_+3A_vbeta_i">vBeta_i</code></td>
<td>
<p>Vector of individual parameters beta</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns the expected transaction values according to the chosen model.
</p>


<h3>References</h3>

<p>Bemmaor AC, Glady N (2012). &ldquo;Modeling Purchasing Behavior with Sudden &ldquo;Death&rdquo;: A Flexible Customer
Lifetime Model&rdquo; Management Science, 58(5), 1012-1021.
</p>
<p>Adler J (2022).  &ldquo;Comment on â€œModeling Purchasing Behavior with Sudden &ldquo;Death&rdquo;: A Flexible Customer
Lifetime Model&rdquo; Management Science 69(3):1929-1930.
</p>
<p>The expression for the PMF was derived by Adler J (2024). (unpublished)
</p>

<hr>
<h2 id='ggomnbd_LL'>GGompertz/NBD: Log-Likelihood functions</h2><span id='topic+ggomnbd_LL'></span><span id='topic+ggomnbd_nocov_LL_ind'></span><span id='topic+ggomnbd_nocov_LL_sum'></span><span id='topic+ggomnbd_staticcov_LL_ind'></span><span id='topic+ggomnbd_staticcov_LL_sum'></span>

<h3>Description</h3>

<p>Calculates the Log-Likelihood values for the GGompertz/NBD model with and without covariates.
</p>
<p>The function <code>ggomnbd_nocov_LL_ind</code> calculates the individual log-likelihood
values for each customer for the given parameters.
</p>
<p>The function <code>ggomnbd_nocov_LL_sum</code> calculates the log-likelihood value summed
across customers for the given parameters.
</p>
<p>The function <code>ggomnbd_staticcov_LL_ind</code> calculates the individual log-likelihood
values for each customer for the given parameters and covariates.
</p>
<p>The function <code>ggomnbd_staticcov_LL_sum</code> calculates the individual log-likelihood values summed
across customers.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ggomnbd_nocov_LL_ind(vLogparams, vX, vT_x, vT_cal)

ggomnbd_nocov_LL_sum(vLogparams, vX, vT_x, vT_cal, vN)

ggomnbd_staticcov_LL_ind(vParams, vX, vT_x, vT_cal, mCov_life, mCov_trans)

ggomnbd_staticcov_LL_sum(vParams, vX, vT_x, vT_cal, vN, mCov_life, mCov_trans)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ggomnbd_LL_+3A_vlogparams">vLogparams</code></td>
<td>
<p>vector with the GGompertz/NBD model parameters at log scale. See Details.</p>
</td></tr>
<tr><td><code id="ggomnbd_LL_+3A_vx">vX</code></td>
<td>
<p>Frequency vector of length n counting the numbers of purchases.</p>
</td></tr>
<tr><td><code id="ggomnbd_LL_+3A_vt_x">vT_x</code></td>
<td>
<p>Recency vector of length n.</p>
</td></tr>
<tr><td><code id="ggomnbd_LL_+3A_vt_cal">vT_cal</code></td>
<td>
<p>Vector of length n indicating the total number of periods of observation.</p>
</td></tr>
<tr><td><code id="ggomnbd_LL_+3A_vn">vN</code></td>
<td>
<p>The value (&quot;number of times observed&quot;) with which the LL value of this observation is multiplied before summing across customers.</p>
</td></tr>
<tr><td><code id="ggomnbd_LL_+3A_vparams">vParams</code></td>
<td>
<p>vector with the parameters for the GGompertz/NBD model at log scale and the static covariates at original scale. See Details.</p>
</td></tr>
<tr><td><code id="ggomnbd_LL_+3A_mcov_life">mCov_life</code></td>
<td>
<p>Matrix containing the covariates data affecting the lifetime process. One column for each covariate.</p>
</td></tr>
<tr><td><code id="ggomnbd_LL_+3A_mcov_trans">mCov_trans</code></td>
<td>
<p>Matrix containing the covariates data affecting the transaction process. One column for each covariate.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>vLogparams</code> is a vector with model parameters <code>r, alpha_0, b, s, beta_0</code> at log-scale, in this order.
</p>
<p><code>vParams</code> is vector with the GGompertz/NBD model parameters at log scale,
followed by the parameters for the lifetime covariates at original scale and then
followed by the parameters for the transaction covariates at original scale
</p>
<p><code>mCov_trans</code> is a matrix containing the covariates data of
the time-invariant covariates that affect the transaction process.
Each column represents a different covariate. For every column a gamma parameter
needs to added to <code>vParams</code> at the respective position.
</p>
<p><code>mCov_life</code> is a matrix containing the covariates data of
the time-invariant covariates that affect the lifetime process.
Each column represents a different covariate. For every column a gamma parameter
needs to added to <code>vParams</code> at the respective position.
</p>


<h3>Value</h3>

<p>Returns the respective Log-Likelihood value(s) for the GGompertz/NBD model
with or without covariates.
</p>


<h3>References</h3>

<p>Bemmaor AC, Glady N (2012). &ldquo;Modeling Purchasing Behavior with Sudden &ldquo;Death&rdquo;: A Flexible Customer
Lifetime Model&rdquo; Management Science, 58(5), 1012-1021.
</p>
<p>Adler J (2022).  &ldquo;Comment on â€œModeling Purchasing Behavior with Sudden &ldquo;Death&rdquo;: A Flexible Customer
Lifetime Model&rdquo; Management Science 69(3):1929-1930.
</p>
<p>The expression for the PMF was derived by Adler J (2024). (unpublished)
</p>

<hr>
<h2 id='ggomnbd_PAlive'>GGompertz/NBD: Probability of Being Alive</h2><span id='topic+ggomnbd_PAlive'></span><span id='topic+ggomnbd_staticcov_PAlive'></span><span id='topic+ggomnbd_nocov_PAlive'></span>

<h3>Description</h3>

<p>Calculates the probability of a customer being alive at the end of the calibration period,
based on a customer's past transaction behavior and the GGompertz/NBD model parameters.
</p>

<dl>
<dt><code>ggomnbd_nocov_PAlive</code></dt><dd><p> P(alive) for the GGompertz/NBD model without covariates</p>
</dd>
<dt><code>ggomnbd_staticcov_PAlive</code></dt><dd><p> P(alive) for the GGompertz/NBD model with static covariates</p>
</dd>
</dl>



<h3>Usage</h3>

<pre><code class='language-R'>ggomnbd_staticcov_PAlive(
  r,
  alpha_0,
  b,
  s,
  beta_0,
  vX,
  vT_x,
  vT_cal,
  vCovParams_trans,
  vCovParams_life,
  mCov_life,
  mCov_trans
)

ggomnbd_nocov_PAlive(r, alpha_0, b, s, beta_0, vX, vT_x, vT_cal)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ggomnbd_PAlive_+3A_r">r</code></td>
<td>
<p>shape parameter of the Gamma distribution of the purchase process.
The smaller r, the stronger the heterogeneity of the purchase process.</p>
</td></tr>
<tr><td><code id="ggomnbd_PAlive_+3A_alpha_0">alpha_0</code></td>
<td>
<p>scale parameter of the Gamma distribution of the purchase process.</p>
</td></tr>
<tr><td><code id="ggomnbd_PAlive_+3A_b">b</code></td>
<td>
<p>scale parameter of the Gompertz distribution (constant across customers)</p>
</td></tr>
<tr><td><code id="ggomnbd_PAlive_+3A_s">s</code></td>
<td>
<p>shape parameter of the Gamma distribution for the lifetime process
The smaller s, the stronger the heterogeneity of customer lifetimes.</p>
</td></tr>
<tr><td><code id="ggomnbd_PAlive_+3A_beta_0">beta_0</code></td>
<td>
<p>scale parameter for the Gamma distribution for the lifetime process</p>
</td></tr>
<tr><td><code id="ggomnbd_PAlive_+3A_vx">vX</code></td>
<td>
<p>Frequency vector of length n counting the numbers of purchases.</p>
</td></tr>
<tr><td><code id="ggomnbd_PAlive_+3A_vt_x">vT_x</code></td>
<td>
<p>Recency vector of length n.</p>
</td></tr>
<tr><td><code id="ggomnbd_PAlive_+3A_vt_cal">vT_cal</code></td>
<td>
<p>Vector of length n indicating the total number of periods of observation.</p>
</td></tr>
<tr><td><code id="ggomnbd_PAlive_+3A_vcovparams_trans">vCovParams_trans</code></td>
<td>
<p>Vector of estimated parameters for the transaction covariates.</p>
</td></tr>
<tr><td><code id="ggomnbd_PAlive_+3A_vcovparams_life">vCovParams_life</code></td>
<td>
<p>Vector of estimated parameters for the lifetime covariates.</p>
</td></tr>
<tr><td><code id="ggomnbd_PAlive_+3A_mcov_life">mCov_life</code></td>
<td>
<p>Matrix containing the covariates data affecting the lifetime process. One column for each covariate.</p>
</td></tr>
<tr><td><code id="ggomnbd_PAlive_+3A_mcov_trans">mCov_trans</code></td>
<td>
<p>Matrix containing the covariates data affecting the transaction process. One column for each covariate.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>mCov_trans</code> is a matrix containing the covariates data of
the time-invariant covariates that affect the transaction process.
Each column represents a different covariate. For every column a gamma parameter
needs to added to <code>vCovParams_trans</code> at the respective position.
</p>
<p><code>mCov_life</code> is a matrix containing the covariates data of
the time-invariant covariates that affect the lifetime process.
Each column represents a different covariate. For every column a gamma parameter
needs to added to <code>vCovParams_life</code> at the respective position.
</p>


<h3>Value</h3>

<p>Returns a vector with the PAlive for each customer.
</p>


<h3>References</h3>

<p>Bemmaor AC, Glady N (2012). &ldquo;Modeling Purchasing Behavior with Sudden &ldquo;Death&rdquo;: A Flexible Customer
Lifetime Model&rdquo; Management Science, 58(5), 1012-1021.
</p>
<p>Adler J (2022).  &ldquo;Comment on â€œModeling Purchasing Behavior with Sudden &ldquo;Death&rdquo;: A Flexible Customer
Lifetime Model&rdquo; Management Science 69(3):1929-1930.
</p>
<p>The expression for the PMF was derived by Adler J (2024). (unpublished)
</p>

<hr>
<h2 id='ggomnbd_PMF'>GGompertz/NBD: Probability Mass Function (PMF)</h2><span id='topic+ggomnbd_PMF'></span><span id='topic+ggomnbd_nocov_PMF'></span><span id='topic+ggomnbd_staticcov_PMF'></span>

<h3>Description</h3>

<p>Calculate P(X(t)=x), the probability that a randomly selected customer
makes exactly x transactions in the interval (0, t].
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ggomnbd_nocov_PMF(r, alpha_0, b, s, beta_0, x, vT_i)

ggomnbd_staticcov_PMF(
  r,
  alpha_0,
  b,
  s,
  beta_0,
  x,
  vCovParams_trans,
  vCovParams_life,
  mCov_life,
  mCov_trans,
  vT_i
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ggomnbd_PMF_+3A_r">r</code></td>
<td>
<p>shape parameter of the Gamma distribution of the purchase process.
The smaller r, the stronger the heterogeneity of the purchase process.</p>
</td></tr>
<tr><td><code id="ggomnbd_PMF_+3A_alpha_0">alpha_0</code></td>
<td>
<p>scale parameter of the Gamma distribution of the purchase process.</p>
</td></tr>
<tr><td><code id="ggomnbd_PMF_+3A_b">b</code></td>
<td>
<p>scale parameter of the Gompertz distribution (constant across customers)</p>
</td></tr>
<tr><td><code id="ggomnbd_PMF_+3A_s">s</code></td>
<td>
<p>shape parameter of the Gamma distribution for the lifetime process
The smaller s, the stronger the heterogeneity of customer lifetimes.</p>
</td></tr>
<tr><td><code id="ggomnbd_PMF_+3A_beta_0">beta_0</code></td>
<td>
<p>scale parameter for the Gamma distribution for the lifetime process</p>
</td></tr>
<tr><td><code id="ggomnbd_PMF_+3A_x">x</code></td>
<td>
<p>The number of transactions to calculate the probability for (unsigned integer).</p>
</td></tr>
<tr><td><code id="ggomnbd_PMF_+3A_vt_i">vT_i</code></td>
<td>
<p>Number of periods since the customer came alive.</p>
</td></tr>
<tr><td><code id="ggomnbd_PMF_+3A_vcovparams_trans">vCovParams_trans</code></td>
<td>
<p>Vector of estimated parameters for the transaction covariates.</p>
</td></tr>
<tr><td><code id="ggomnbd_PMF_+3A_vcovparams_life">vCovParams_life</code></td>
<td>
<p>Vector of estimated parameters for the lifetime covariates.</p>
</td></tr>
<tr><td><code id="ggomnbd_PMF_+3A_mcov_life">mCov_life</code></td>
<td>
<p>Matrix containing the covariates data affecting the lifetime process. One column for each covariate.</p>
</td></tr>
<tr><td><code id="ggomnbd_PMF_+3A_mcov_trans">mCov_trans</code></td>
<td>
<p>Matrix containing the covariates data affecting the transaction process. One column for each covariate.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>mCov_trans</code> is a matrix containing the covariates data of
the time-invariant covariates that affect the transaction process.
Each column represents a different covariate. For every column a gamma parameter
needs to added to <code>vCovParams_trans</code> at the respective position.
</p>
<p><code>mCov_life</code> is a matrix containing the covariates data of
the time-invariant covariates that affect the lifetime process.
Each column represents a different covariate. For every column a gamma parameter
needs to added to <code>vCovParams_life</code> at the respective position.
</p>


<h3>Value</h3>

<p>Returns a vector of probabilities.
</p>


<h3>References</h3>

<p>Bemmaor AC, Glady N (2012). &ldquo;Modeling Purchasing Behavior with Sudden &ldquo;Death&rdquo;: A Flexible Customer
Lifetime Model&rdquo; Management Science, 58(5), 1012-1021.
</p>
<p>Adler J (2022).  &ldquo;Comment on â€œModeling Purchasing Behavior with Sudden &ldquo;Death&rdquo;: A Flexible Customer
Lifetime Model&rdquo; Management Science 69(3):1929-1930.
</p>
<p>The expression for the PMF was derived by Adler J (2024). (unpublished)
</p>

<hr>
<h2 id='latentAttrition'>Formula Interface for Latent Attrition Models</h2><span id='topic+latentAttrition'></span>

<h3>Description</h3>

<p>Fit latent attrition models for transaction behavior, using a formula to specify the covariates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>latentAttrition(
  formula,
  family,
  data,
  optimx.args = list(),
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="latentAttrition_+3A_formula">formula</code></td>
<td>
<p>Formula to select and transform covariates in <code>data</code>. Has to be left empty if <code>data</code> contains no covariates. See Details.</p>
</td></tr>
<tr><td><code id="latentAttrition_+3A_family">family</code></td>
<td>
<p>A latentAttrition model. One of <code>pnbd</code>,  <code>bgnbd</code>, or <code>ggomnbd</code>.</p>
</td></tr>
<tr><td><code id="latentAttrition_+3A_data">data</code></td>
<td>
<p>A <code>clv.data</code> object.</p>
</td></tr>
<tr><td><code id="latentAttrition_+3A_optimx.args">optimx.args</code></td>
<td>
<p>Additional arguments to control the optimization which are forwarded to <code><a href="optimx.html#topic+optimx">optimx::optimx</a></code>.
If multiple optimization methods are specified, only the result of the last method is further processed.</p>
</td></tr>
<tr><td><code id="latentAttrition_+3A_verbose">verbose</code></td>
<td>
<p>Show details about the running of the function.</p>
</td></tr>
<tr><td><code id="latentAttrition_+3A_...">...</code></td>
<td>
<p>Forwarded to model specified in <code>family</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A two-part formula is used to select and transform the covariates stored in <code>data</code> before the model is estimated on it.
May not be given if <code>data</code> contains no covariates.
</p>
<p>The formula left hand side (LHS) has to remain empty and may never be specified.
</p>
<p>The formula right hand side (RHS) follows a two-part notation using <code>|</code> as separator.
</p>

<ul>
<li><p> 1st part: Which covariates to include for the lifetime process, potentially transforming them and adding interactions. The dot ('.') refers to all lifetime covariates.
</p>
</li>
<li><p> 2nd part: Which covariates to include for the transaction process, potentially transforming them and adding interactions. The dot ('.') refers to all transaction covariates
</p>
</li></ul>

<p>e.g: <code> ~ covlife | covtrans</code>
</p>
<p>See the example section for illustrations on how to specify the formula parameter.
</p>


<h3>See Also</h3>

<p>Models for inputs to family: <a href="#topic+pnbd">pnbd</a>, <a href="#topic+ggomnbd">ggomnbd</a>, <a href="#topic+bgnbd">bgnbd</a>.
</p>
<p><a href="#topic+spending">spending</a> to fit spending models with a formula interface
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

data("apparelTrans")
data("apparelStaticCov")

clv.nocov &lt;-
    clvdata(apparelTrans, time.unit="w", date.format="ymd")

# Create static covariate data with 2 covariates
clv.staticcov  &lt;-
  SetStaticCovariates(clv.nocov,
                      data.cov.life  = apparelStaticCov,
                      names.cov.life = c("Gender", "Channel"),
                      data.cov.trans = apparelStaticCov,
                      names.cov.trans = c("Gender", "Channel"))

# Fit models without covariates.
# Note that NO formula may be specified in this case
latentAttrition(formula =, family=pnbd, data=clv.nocov)
latentAttrition(formula =, family=bgnbd, data=clv.nocov)
latentAttrition(formula =, family=ggomnbd, data=clv.nocov)

# Fit pnbd with start parameters and correlation
# required args are passed as part of '...'
latentAttrition(formula =, family=pnbd, data=clv.nocov,
                use.cor=TRUE,
                start.params.model=c(r=1, alpha=10, s=2, beta=8))


# Fit pnbd with all present covariates
latentAttrition(formula=~.|., family=pnbd, data=clv.staticcov)

# Fit pnbd with selected covariates
latentAttrition(formula=~Gender|Channel+Gender, family=pnbd,
                data=clv.staticcov)

# Fit pnbd with start parameters for covariates
latentAttrition(formula=~Gender|., family=pnbd,
                data=clv.staticcov,
                start.params.life = c(Gender = 0.6),
                start.params.trans = c(Gender = 0.6, Channel = 0.4))

# Fit pnbd with transformed covariate data
latentAttrition(formula=~Gender|I(log(Channel+2)), family=pnbd,
                data=clv.staticcov)

# Fit pnbd with all covs and regularization
latentAttrition(formula=~.|., family=pnbd, data=clv.staticcov,
                reg.lambdas = c(life=3, trans=8))

# Fit pnbd with all covs and constraint parameters for Channel
latentAttrition(formula=~.|., family=pnbd, data=clv.staticcov,
                names.cov.constr='Channel')




</code></pre>

<hr>
<h2 id='lrtest'>Likelihood Ratio Test of Nested Models</h2><span id='topic+lrtest'></span><span id='topic+lrtest.clv.fitted'></span><span id='topic+lrtest+2Cclv.fitted-method'></span>

<h3>Description</h3>

<p><code>lrtest</code> carries out likelihood ratio tests to compare nested CLV models
of the same family that were fitted on the same transaction data.
</p>
<p>The method compares each two consecutive models.
An asymptotic likelihood ratio test is carried out: Twice the difference in
log-likelihoods is compared with a Chi-squared distribution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'clv.fitted'
lrtest(object, ..., name = NULL)

lrtest(object, ...)

## S4 method for signature 'clv.fitted'
lrtest(object, ..., name = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="lrtest_+3A_object">object</code></td>
<td>
<p>An fitted model object inheriting from <code>clv.fitted</code>.</p>
</td></tr>
<tr><td><code id="lrtest_+3A_...">...</code></td>
<td>
<p>Other models objects fitted on the same transaction data</p>
</td></tr>
<tr><td><code id="lrtest_+3A_name">name</code></td>
<td>
<p>A character vector of names to use for the models in the resulting output.
If given, a name has to be provided for <code>object</code> and each model in <code>...</code>.
If not given, the default model names are used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>data.frame</code> of class &quot;anova&quot; which contains the log-likelihood,
degrees of freedom, the difference in degrees of freedom, likelihood ratio
Chi-squared statistic and corresponding p-value.
</p>

<hr>
<h2 id='newcustomer'>New customer prediction data</h2><span id='topic+newcustomer'></span><span id='topic+newcustomer.static'></span><span id='topic+newcustomer.dynamic'></span><span id='topic+newcustomer.spending'></span>

<h3>Description</h3>

<p>The methods documented here are to be used together with
<a href="#topic+predict.clv.fitted.transactions">predict (transactions)</a> to obtain
the expected number of transactions of an average newly alive customer and
with <a href="#topic+predict.clv.fitted.spending">predict (spending)</a> to obtain
the expected spending of an average newly alive customer.
This prediction is only sensible for (fictional) customers without order history:
Customers which just came alive and have not had the chance to reveal any more of their behavior.
</p>
<p>The methods described here produce the data required as input to
<code>predict(newdata=)</code> to make this new customer prediction.
This is mostly covariate data for static and dynamic covariate models.
See details for the required format.
</p>
<p><code>newcustomer()</code>, <code>newcustomer.static()</code>, <code>newcustomer.dynamic()</code>:
To predict the number of transactions a single, fictional, average new customer is expected to make in
the <code>num.periods</code> periods since making the first transaction (&quot;coming alive&quot;).
</p>
<p><code>newcustomer.spending()</code>: To estimate how much a single, fictional, average
new customer is expected to spend on average per transaction.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>newcustomer(num.periods)

newcustomer.static(num.periods, data.cov.life, data.cov.trans)

newcustomer.dynamic(
  num.periods,
  data.cov.life,
  data.cov.trans,
  first.transaction
)

newcustomer.spending()
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="newcustomer_+3A_num.periods">num.periods</code></td>
<td>
<p>A positive, numeric scalar indicating the number of periods to predict.</p>
</td></tr>
<tr><td><code id="newcustomer_+3A_data.cov.life">data.cov.life</code></td>
<td>
<p>Numeric-only covariate data for the lifetime process for a single customer, <code>data.table</code> or <code>data.frame</code>. See details.</p>
</td></tr>
<tr><td><code id="newcustomer_+3A_data.cov.trans">data.cov.trans</code></td>
<td>
<p>Numeric-only covariate data for the transaction process for a single customer, <code>data.table</code> or <code>data.frame</code>. See details.</p>
</td></tr>
<tr><td><code id="newcustomer_+3A_first.transaction">first.transaction</code></td>
<td>
<p>For dynamic covariate models only: The time point of the first transaction of the customer (&quot;coming alive&quot;) for which a prediction is made.
Has to be within the time range of the covariate data.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The covariate data has to contain one column for every covariate parameter in the fitted model. Only numeric values are allowed, no factors or characters.
No customer Id is required because the data on which the model was fit is not used for this prediction.
</p>
<p>For <code>newcustomer.static()</code>: One column for every covariate parameter in the estimated model.
No column <code>Id</code>. Exactly 1 row of numeric covariate data. <br />
For example: <code>data.frame(Gender=1, Age=30, Channel=0)</code>.
</p>
<p>For <code>newcustomer.dynamic()</code>: One column for every covariate parameter in the estimated model.
No column <code>Id</code>. A column <code>Cov.Date</code> with time points that mark the start of the period defined by <code>time.unit</code>.
For every <code>Cov.Date</code>, exactly 1 row of numeric covariate data. <br />
For example for weekly covariates: <code>data.frame(Cov.Date=c("2000-01-03", "2000-01-10"), Gender=c(1,1), Channel=c(1, 1), High.Season=c(0,1,0))</code> <br />
If <code>Cov.Date</code> is of type character, the <code>date.format</code> given when creating the the <code>clv.data</code> object is used to parse it.
The data has to cover the time from the customer's first transaction <code>first.transaction</code>
to the end of the prediction period given by <code>t</code>. It does not have to cover the same time range as when fitting the model.
See examples.
</p>
<p>For models with dynamic covariates, the time point of the first purchase (<code>first.transaction</code>) is
additionally required because the exact covariates that are active during the prediction period have
to be known.
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>newcustomer()</code></td>
<td>
<p>An object of class <code>clv.newcustomer.no.cov</code></p>
</td></tr>
<tr><td><code>newcustomer.static()</code></td>
<td>
<p>An object of class <code>clv.newcustomer.static.cov</code></p>
</td></tr>
<tr><td><code>newcustomer.dynamic()</code></td>
<td>
<p>An object of class <code>clv.newcustomer.dynamic.cov</code></p>
</td></tr>
<tr><td><code>newcustomer.spending()</code></td>
<td>
<p>An object of class <code>clv.newcustomer.spending</code></p>
</td></tr>
</table>


<h3>See Also</h3>

<p><a href="#topic+predict.clv.fitted.transactions">predict (transactions)</a> to use the output of the methods described here.
</p>
<p><a href="#topic+predict.clv.fitted.spending">predict (spending)</a> to use the output of the methods described here.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("apparelTrans")
data("apparelStaticCov")
data("apparelDynCov")

clv.data.apparel &lt;- clvdata(apparelTrans, date.format = "ymd",
                            time.unit = "w", estimation.split = 52)
clv.data.static.cov &lt;-
 SetStaticCovariates(clv.data.apparel,
                     data.cov.life = apparelStaticCov,
                     names.cov.life = "Gender",
                     data.cov.trans = apparelStaticCov,
                     names.cov.trans = c("Gender", "Channel"))
clv.data.dyn.cov &lt;-
  SetDynamicCovariates(clv.data = clv.data.apparel,
                       data.cov.life = apparelDynCov,
                       data.cov.trans = apparelDynCov,
                       names.cov.life = c("High.Season", "Gender"),
                       names.cov.trans = c("High.Season", "Gender"),
                       name.date = "Cov.Date")



# No covariate model
p.apparel &lt;- pnbd(clv.data.apparel)

# Predict the number of transactions an average new
# customer is expected to make in the first 3.68 weeks
predict(
  p.apparel,
  newdata=newcustomer(num.periods=3.68)
)


# Spending model
gg.apparel &lt;- gg(clv.data.apparel)
predict(gg.apparel, newdata = newcustomer.spending())



# Static covariate model
p.apparel.static &lt;- pnbd(clv.data.static.cov)

# Predict the number of transactions an average new
# customer who is female (Gender=1) and who was acquired
# online (Channel=1) is expected to make in the first 3.68 weeks
predict(
  p.apparel.static,
  newdata=newcustomer.static(
    num.periods=3.68,
    # For the lifetime process, only Gender was used when fitting
    data.cov.life=data.frame(Gender=1),
    data.cov.trans=data.frame(Gender=1, Channel=0)
  )
)


## Not run: 
# Dynamic covariate model

p.apparel.dyn &lt;- pnbd(clv.data.dyn.cov)

# Predict the number of transactions an average new
# customer who is male (Gender=0), who did not purchase during
# high.season, and who was
# acquired on "2005-02-16" (first.transaction) is expected
# to make in the first 2.12 weeks.
# Note that the time range is very different from the one used
# when fitting the model. Cov.Date still has to match the
# beginning of the week.
predict(
  p.apparel.dyn,
  newdata=newcustomer.dynamic(
    num.periods=2.12,
    data.cov.life=data.frame(
      Cov.Date=c("2051-02-12", "2051-02-19", "2051-02-26"),
      Gender=c(0, 0, 0),
      High.Season=c(4, 0, 7)),
    data.cov.trans=data.frame(
      Cov.Date=c("2051-02-12", "2051-02-19", "2051-02-26"),
      Gender=c(0, 0, 0),
      High.Season=c(4, 0, 7)),
    first.transaction = "2051-02-16"
  )
)

## End(Not run)


</code></pre>

<hr>
<h2 id='nobs.clv.data'>Number of observations</h2><span id='topic+nobs.clv.data'></span>

<h3>Description</h3>

<p>The number of observations is defined as the number of unique customers in the transaction data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'clv.data'
nobs(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="nobs.clv.data_+3A_object">object</code></td>
<td>
<p>An object of class clv.data.</p>
</td></tr>
<tr><td><code id="nobs.clv.data_+3A_...">...</code></td>
<td>
<p>Ignored</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The number of customers.
</p>

<hr>
<h2 id='nobs.clv.fitted'>Number of observations</h2><span id='topic+nobs.clv.fitted'></span>

<h3>Description</h3>

<p>The number of observations is defined as the number of unique customers for which the model was fit.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'clv.fitted'
nobs(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="nobs.clv.fitted_+3A_object">object</code></td>
<td>
<p>An object of class clv.fitted.</p>
</td></tr>
<tr><td><code id="nobs.clv.fitted_+3A_...">...</code></td>
<td>
<p>Ignored</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The number of customers.
</p>

<hr>
<h2 id='plot.clv.data'>Plot Diagnostics for the Transaction data in a clv.data Object</h2><span id='topic+plot.clv.data'></span>

<h3>Description</h3>

<p>Depending on the value of parameter <code>which</code>, one of the following plots will be produced.
Note that the <code>sample</code> parameter determines the period for which the
selected plot is made (either estimation, holdout, or full).
</p>


<h4>Tracking Plot</h4>

<p>Plot the aggregated repeat transactions per period over the given time-horizon (<code>prediction.end</code>).
See Details for the definition of plotting periods.
</p>



<h4>Frequency Plot</h4>

<p>Plot the distribution of transactions or repeat transactions per customer, after aggregating transactions
of the same customer on a single time point.
Note that if <code>trans.bins</code> is changed, <code>label.remaining</code> usually needs to be adapted as well.
</p>



<h4>Spending Plot</h4>

<p>Plot the empirical density of either customer's average spending per transaction or the value
of every transaction in the data, after aggregating transactions of the same customer on a single time point.
Note that in all cases this includes all transactions and not only repeat-transactions.
</p>



<h4>Interpurchase Time Plot</h4>

<p>Plot the empirical density of customer's mean time (in number of periods) between transactions,
after aggregating transactions of the same customer on a single time point.
Note that customers without repeat-transactions are removed.
</p>



<h4>Transaction Timing Plot</h4>

<p>Plot the transaction timings of selected or sampled customers on their respective timelines.
</p>



<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'clv.data'
plot(
  x,
  which = c("tracking", "frequency", "spending", "interpurchasetime", "timings"),
  prediction.end = NULL,
  cumulative = FALSE,
  trans.bins = 0:9,
  count.repeat.trans = TRUE,
  count.remaining = TRUE,
  label.remaining = "10+",
  mean.spending = TRUE,
  annotate.ids = FALSE,
  ids = c(),
  sample = c("estimation", "full", "holdout"),
  geom = "line",
  color = "black",
  plot = TRUE,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.clv.data_+3A_x">x</code></td>
<td>
<p>The clv.data object to plot</p>
</td></tr>
<tr><td><code id="plot.clv.data_+3A_which">which</code></td>
<td>
<p>Which plot to produce, either &quot;tracking&quot;, &quot;frequency&quot;, &quot;spending&quot;, &quot;interpurchasetime&quot;, or &quot;timings&quot;.
May be abbreviated but only one may be selected. Defaults to &quot;tracking&quot;.</p>
</td></tr>
<tr><td><code id="plot.clv.data_+3A_prediction.end">prediction.end</code></td>
<td>
<p>&quot;tracking&quot;: Until what point in time to plot. This can be the number of periods (numeric) or a form of date/time object. See details.</p>
</td></tr>
<tr><td><code id="plot.clv.data_+3A_cumulative">cumulative</code></td>
<td>
<p>&quot;tracking&quot;: Whether the cumulative actual repeat transactions should be plotted.</p>
</td></tr>
<tr><td><code id="plot.clv.data_+3A_trans.bins">trans.bins</code></td>
<td>
<p>&quot;frequency&quot;: Vector of integers indicating the number of transactions (x axis) for which the customers should be counted.</p>
</td></tr>
<tr><td><code id="plot.clv.data_+3A_count.repeat.trans">count.repeat.trans</code></td>
<td>
<p>&quot;frequency&quot;: Whether repeat transactions (TRUE, default) or all transactions (FALSE) should be counted.</p>
</td></tr>
<tr><td><code id="plot.clv.data_+3A_count.remaining">count.remaining</code></td>
<td>
<p>&quot;frequency&quot;: Whether the customers which are not captured with <code>trans.bins</code> should be counted in a separate last bar.</p>
</td></tr>
<tr><td><code id="plot.clv.data_+3A_label.remaining">label.remaining</code></td>
<td>
<p>&quot;frequency&quot;: Label for the last bar, if <code>count.remaining=TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot.clv.data_+3A_mean.spending">mean.spending</code></td>
<td>
<p>&quot;spending&quot;: Whether customer's mean spending per transaction (<code>TRUE</code>, default) or the
value of every transaction in the data (<code>FALSE</code>) should be plotted.</p>
</td></tr>
<tr><td><code id="plot.clv.data_+3A_annotate.ids">annotate.ids</code></td>
<td>
<p>&quot;timings&quot;: Whether timelines should be annotated with customer ids.</p>
</td></tr>
<tr><td><code id="plot.clv.data_+3A_ids">ids</code></td>
<td>
<p>&quot;timings&quot;: A character vector of customer ids or a single integer specifying the number of customers to sample.
Defaults to <code>NULL</code> for which 50 random customers are selected.</p>
</td></tr>
<tr><td><code id="plot.clv.data_+3A_sample">sample</code></td>
<td>
<p>Name of the sample for which the plot should be made, either
&quot;estimation&quot;, &quot;full&quot;, or &quot;holdout&quot;. Defaults to &quot;estimation&quot;. Not for &quot;tracking&quot; and &quot;timing&quot;.</p>
</td></tr>
<tr><td><code id="plot.clv.data_+3A_geom">geom</code></td>
<td>
<p>&quot;spending&quot; and &quot;interpurchasetime&quot;: The geometric object of ggplot2 to display the data. Forwarded to
<a href="ggplot2.html#topic+stat_density">ggplot2::stat_density</a>.</p>
</td></tr>
<tr><td><code id="plot.clv.data_+3A_color">color</code></td>
<td>
<p>Color of resulting geom object in the plot. Not for &quot;tracking&quot; and &quot;timing&quot;.</p>
</td></tr>
<tr><td><code id="plot.clv.data_+3A_plot">plot</code></td>
<td>
<p>Whether a plot should be created or only the assembled data returned.</p>
</td></tr>
<tr><td><code id="plot.clv.data_+3A_verbose">verbose</code></td>
<td>
<p>Show details about the running of the function.</p>
</td></tr>
<tr><td><code id="plot.clv.data_+3A_...">...</code></td>
<td>
<p>Forwarded to <a href="ggplot2.html#topic+stat_density">ggplot2::stat_density</a> (&quot;spending&quot;, &quot;interpurchasetime&quot;)
or <a href="ggplot2.html#topic+geom_bar">ggplot2::geom_bar</a> (&quot;frequency&quot;). Not for &quot;tracking&quot; and &quot;timings&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>prediction.end</code> indicates until when to predict or plot and can be given as either
a point in time (of class <code>Date</code>, <code>POSIXct</code>, or <code>character</code>) or the number of periods.
If <code>prediction.end</code> is of class character, the date/time format set when creating the data object is used for parsing.
If <code>prediction.end</code> is the number of periods, the end of the fitting period serves as the reference point
from which periods are counted. Only full periods may be specified.
If <code>prediction.end</code> is omitted or NULL, it defaults to the end of the holdout period if present and to the
end of the estimation period otherwise.
</p>
<p>The first prediction period is defined to start right after the end of the estimation period.
If for example weekly time units are used and the estimation period ends on Sunday 2019-01-01, then the first day
of the first prediction period is Monday 2019-01-02. Each prediction period includes a total of 7 days and
the first prediction period therefore will end on, and include, Sunday 2019-01-08. Subsequent prediction periods
again start on Mondays and end on Sundays.
If <code>prediction.end</code> indicates a timepoint on which to end, this timepoint is included in the prediction period.
</p>
<p>If there are no repeat transactions until <code>prediction.end</code>, only the time for which there is data
is plotted. If the data is returned (i.e. with argument <code>plot=FALSE</code>), the respective rows
contain <code>NA</code> in column <code>Number of Repeat Transactions</code>.
</p>


<h3>Value</h3>

<p>An object of class <code>ggplot</code> from package <code>ggplot2</code> is returned by default.
If <code>plot=FALSE</code>, the data that would have been used to create the plot is returned.
Depending on which plot was selected, this is a <code>data.table</code>
which contains some of the following columns:
</p>
<table role = "presentation">
<tr><td><code>Id</code></td>
<td>
<p>Customer Id</p>
</td></tr>
<tr><td><code>period.until</code></td>
<td>
<p>The timepoint that marks the end (up until and including) of the period to which the data in this row refers.</p>
</td></tr>
<tr><td><code>Spending</code></td>
<td>
<p>Spending as defined by parameter <code>mean.spending</code>.</p>
</td></tr>
<tr><td><code>mean.interpurchase.time</code></td>
<td>
<p>Mean number of periods between transactions per customer,
excluding customers with no repeat-transactions.</p>
</td></tr>
<tr><td><code>num.transactions</code></td>
<td>
<p>The number of (repeat) transactions, depending on <code>count.repeat.trans</code>.</p>
</td></tr>
<tr><td><code>num.customers</code></td>
<td>
<p>The number of customers.</p>
</td></tr>
<tr><td><code>type</code></td>
<td>
<p>&quot;timings&quot;: Which purpose the value in this row is used for.</p>
</td></tr>
<tr><td><code>variable</code></td>
<td>
<p>&quot;tracking&quot;: The number of actual repeat transactions in the period that ends at <code>period.until</code>.<br />
&quot;timings&quot;: Coordinate (x or y) for which to use the value in this row for.</p>
</td></tr>
<tr><td><code>value</code></td>
<td>
<p>&quot;timings&quot;:  Date or numeric (stored as string) <br />
&quot;tracking&quot;: numeric</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><a href="ggplot2.html#topic+stat_density">ggplot2::stat_density</a> and <a href="ggplot2.html#topic+geom_bar">ggplot2::geom_bar</a>
for possible arguments to <code>...</code>
</p>
<p><a href="#topic+plot.clv.fitted.transactions">plot</a> to plot fitted transaction models
</p>
<p><a href="#topic+plot.clv.fitted.spending">plot</a> to plot fitted spending models
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


data("cdnow")
clv.cdnow &lt;- clvdata(cdnow, time.unit="w",estimation.split=37,
                     date.format="ymd")

### TRACKING PLOT
# Plot the actual repeat transactions
plot(clv.cdnow)
# same, explicitly
plot(clv.cdnow, which="tracking")

# plot cumulative repeat transactions
plot(clv.cdnow, cumulative=TRUE)

# Dont automatically plot but tweak further
library(ggplot2) # for ggtitle()
gg.cdnow &lt;- plot(clv.cdnow)
# change Title
gg.cdnow + ggtitle("CDnow repeat transactions")

# Dont return a plot but only the data from
#   which it would have been created
dt.plot.data &lt;- plot(clv.cdnow, plot=FALSE)


### FREQUENCY PLOT
plot(clv.cdnow, which="frequency")

# Bins from 0 to 15, all remaining in bin labelled "16+"
plot(clv.cdnow, which="frequency", trans.bins=0:15,
     label.remaining="16+")

# Count all transactions, not only repeat
#  Note that the bins have to be adapted to start from 1
plot(clv.cdnow, which="frequency", count.repeat.trans = FALSE,
     trans.bins=1:9)


### SPENDING DENSITY
# plot customer's average transaction value
plot(clv.cdnow, which="spending", mean.spending = TRUE)

# distribution of the values of every transaction
plot(clv.cdnow, which="spending", mean.spending = FALSE)


### INTERPURCHASE TIME DENSITY
# plot as small points, in blue
plot(clv.cdnow, which="interpurchasetime",
     geom="point", color="blue", size=0.02)


### TIMING PATTERNS
# selected customers and annotating them
plot(clv.cdnow, which="timings", ids=c("123", "1041"), annotate.ids=TRUE)

# plot 25 random customers
plot(clv.cdnow, which="timings", ids=25)

# plot all customers
plot(clv.cdnow, which="timings", ids=nobs(clv.cdnow))


</code></pre>

<hr>
<h2 id='plot.clv.fitted.spending'>Plot expected and actual mean spending per transaction</h2><span id='topic+plot.clv.fitted.spending'></span><span id='topic+plot+2Cclv.fitted.spending-method'></span>

<h3>Description</h3>

<p>Compares the density of the observed average spending per transaction (empirical distribution) to the
model's distribution of mean transaction spending (weighted by the actual number of transactions).
See <code><a href="#topic+plot.clv.data">plot.clv.data</a></code> to plot more nuanced diagnostics for the transaction data only.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'clv.fitted.spending'
plot(x, n = 256, verbose = TRUE, ...)

## S4 method for signature 'clv.fitted.spending'
plot(x, n = 256, verbose = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.clv.fitted.spending_+3A_x">x</code></td>
<td>
<p>The fitted spending model to plot</p>
</td></tr>
<tr><td><code id="plot.clv.fitted.spending_+3A_n">n</code></td>
<td>
<p>Number of points at which the empirical and model density are calculated. Should be a power of two.</p>
</td></tr>
<tr><td><code id="plot.clv.fitted.spending_+3A_verbose">verbose</code></td>
<td>
<p>Show details about the running of the function.</p>
</td></tr>
<tr><td><code id="plot.clv.fitted.spending_+3A_...">...</code></td>
<td>
<p>Ignored</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>ggplot</code> from package <code>ggplot2</code> is returned by default.
</p>


<h3>References</h3>

<p>Colombo R, Jiang W (1999). &ldquo;A stochastic RFM model.&rdquo;
Journal of Interactive Marketing, 13(3), 2-12.
</p>
<p>Fader PS, Hardie BG, Lee K (2005). &ldquo;RFM and CLV: Using Iso-Value Curves for
Customer Base Analysis.&rdquo; Journal of Marketing Research, 42(4), 415-430.
</p>
<p>Fader PS, Hardie BG (2013). &ldquo;The Gamma-Gamma Model of Monetary Value.&rdquo;
URL <a href="http://www.brucehardie.com/notes/025/gamma_gamma.pdf">http://www.brucehardie.com/notes/025/gamma_gamma.pdf</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.clv.fitted.transactions">plot</a></code> for transaction models
</p>
<p><code><a href="#topic+plot.clv.data">plot</a></code> for transaction diagnostics of <code>clv.data</code> objects
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("cdnow")

clv.cdnow &lt;- clvdata(cdnow,
  date.format="ymd",
  time.unit = "week",
  estimation.split = "1997-09-30")

est.gg &lt;- gg(clv.data = clv.cdnow)

# Compare empirical to theoretical distribution
plot(est.gg)

## Not run: 
# Modify the created plot further
library(ggplot2)
gg.cdnow &lt;- plot(est.gg)
gg.cdnow + ggtitle("CDnow Spending Distribution")

## End(Not run)


</code></pre>

<hr>
<h2 id='plot.clv.fitted.transactions'>Plot Diagnostics for a Fitted Transaction Model</h2><span id='topic+plot.clv.fitted.transactions'></span><span id='topic+plot'></span><span id='topic+plot+2Cclv.fitted.transactions-method'></span>

<h3>Description</h3>

<p>Depending on the value of parameter <code>which</code>, one of the following plots will be produced.
See <code><a href="#topic+plot.clv.data">plot.clv.data</a></code> to plot more nuanced diagnostics for the transaction data only.
For comparison, other models can be drawn into the same plot by specifying them in <code>other.models</code> (see examples).
</p>


<h4>Tracking Plot</h4>

<p>Plot the actual repeat transactions and overlay it with the repeat transaction as predicted
by the fitted model. Currently, following previous literature, the in-sample unconditional
expectation is plotted in the holdout period. In the future, we might add the option to also
plot the summed CET for the holdout period as an alternative evaluation metric.
Note that only whole periods can be plotted and that the prediction end might not exactly match <code>prediction.end</code>.
See the Note section for more details.
</p>



<h4>PMF Plot</h4>

<p>Plot the actual and expected number of customers which made a given number of repeat
transaction in the estimation period. The expected number is based on the PMF of the fitted model,
the probability to make exactly a given number of repeat transactions in the estimation period.
For each bin, the expected number is the sum of all customers' individual PMF value.
Note that if <code>trans.bins</code> is changed, <code>label.remaining</code> needs to be adapted as well.
</p>



<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'clv.fitted.transactions'
plot(
  x,
  which = c("tracking", "pmf"),
  other.models = list(),
  prediction.end = NULL,
  cumulative = FALSE,
  trans.bins = 0:9,
  calculate.remaining = TRUE,
  label.remaining = "10+",
  newdata = NULL,
  transactions = TRUE,
  label = NULL,
  plot = TRUE,
  verbose = TRUE,
  ...
)

## S4 method for signature 'clv.fitted.transactions'
plot(
  x,
  which = c("tracking", "pmf"),
  other.models = list(),
  prediction.end = NULL,
  cumulative = FALSE,
  trans.bins = 0:9,
  calculate.remaining = TRUE,
  label.remaining = "10+",
  newdata = NULL,
  transactions = TRUE,
  label = NULL,
  plot = TRUE,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.clv.fitted.transactions_+3A_x">x</code></td>
<td>
<p>The fitted transaction model for which to produce diagnostic plots</p>
</td></tr>
<tr><td><code id="plot.clv.fitted.transactions_+3A_which">which</code></td>
<td>
<p>Which plot to produce, either &quot;tracking&quot; or &quot;pmf&quot;. May be abbreviated but only one may be selected. Defaults to &quot;tracking&quot;.</p>
</td></tr>
<tr><td><code id="plot.clv.fitted.transactions_+3A_other.models">other.models</code></td>
<td>
<p>List of fitted transaction models to plot. List names are used as colors, standard colors are chosen if unnamed (see examples).
The <code>clv.data</code> object stored in each model is used if no <code>newdata</code> is given.</p>
</td></tr>
<tr><td><code id="plot.clv.fitted.transactions_+3A_prediction.end">prediction.end</code></td>
<td>
<p>&quot;tracking&quot;: Until what point in time to plot. This can be the number of periods (numeric) or a form of date/time object. See details.</p>
</td></tr>
<tr><td><code id="plot.clv.fitted.transactions_+3A_cumulative">cumulative</code></td>
<td>
<p>&quot;tracking&quot;: Whether the cumulative expected (and actual) transactions should be plotted.</p>
</td></tr>
<tr><td><code id="plot.clv.fitted.transactions_+3A_trans.bins">trans.bins</code></td>
<td>
<p>&quot;pmf&quot;: Vector of positive integer numbers (&gt;=0) indicating the number of repeat transactions (x axis) to plot. Should contain 0 in nearly all cases as it refers to repeat-transactions.</p>
</td></tr>
<tr><td><code id="plot.clv.fitted.transactions_+3A_calculate.remaining">calculate.remaining</code></td>
<td>
<p>&quot;pmf&quot;: Whether the probability for the remaining number of transactions not in <code>trans.bins</code> should be calculated.</p>
</td></tr>
<tr><td><code id="plot.clv.fitted.transactions_+3A_label.remaining">label.remaining</code></td>
<td>
<p>&quot;pmf&quot;: Label for the last bar, if <code>calculate.remaining=TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot.clv.fitted.transactions_+3A_newdata">newdata</code></td>
<td>
<p>An object of class clv.data for which the plotting should be made with the fitted model.
If none or NULL is given, the plot is made for the data on which the model was fit.
If <code>other.models</code> was specified, the data in each model is replaced with <code>newdata</code>.</p>
</td></tr>
<tr><td><code id="plot.clv.fitted.transactions_+3A_transactions">transactions</code></td>
<td>
<p>Whether the actual observed repeat transactions should be plotted.</p>
</td></tr>
<tr><td><code id="plot.clv.fitted.transactions_+3A_label">label</code></td>
<td>
<p>Character vector to label each model. If NULL, the model(s) internal name is used (see examples).</p>
</td></tr>
<tr><td><code id="plot.clv.fitted.transactions_+3A_plot">plot</code></td>
<td>
<p>Whether a plot is created or only the assembled data is returned.</p>
</td></tr>
<tr><td><code id="plot.clv.fitted.transactions_+3A_verbose">verbose</code></td>
<td>
<p>Show details about the running of the function.</p>
</td></tr>
<tr><td><code id="plot.clv.fitted.transactions_+3A_...">...</code></td>
<td>
<p>Ignored</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>prediction.end</code> indicates until when to predict or plot and can be given as either
a point in time (of class <code>Date</code>, <code>POSIXct</code>, or <code>character</code>) or the number of periods.
If <code>prediction.end</code> is of class character, the date/time format set when creating the data object is used for parsing.
If <code>prediction.end</code> is the number of periods, the end of the fitting period serves as the reference point
from which periods are counted. Only full periods may be specified.
If <code>prediction.end</code> is omitted or NULL, it defaults to the end of the holdout period if present and to the
end of the estimation period otherwise.
</p>
<p>The first prediction period is defined to start right after the end of the estimation period.
If for example weekly time units are used and the estimation period ends on Sunday 2019-01-01, then the first day
of the first prediction period is Monday 2019-01-02. Each prediction period includes a total of 7 days and
the first prediction period therefore will end on, and include, Sunday 2019-01-08. Subsequent prediction periods
again start on Mondays and end on Sundays.
If <code>prediction.end</code> indicates a timepoint on which to end, this timepoint is included in the prediction period.
</p>
<p>The <code>newdata</code> argument has to be a clv data object of the exact same class as the data object
on which the model was fit. In case the model was fit with covariates, <code>newdata</code> needs to contain identically
named covariate data.
</p>
<p>The use case for <code>newdata</code> is mainly two-fold: First, to estimate model parameters only on a
sample of the data and then use the fitted model object to predict or plot for the full data set provided through <code>newdata</code>.
Second, for models with dynamic covariates, to provide a clv data object with longer covariates than contained in the data
on which the model was estimated what allows to predict or plot further. When providing <code>newdata</code>, some models
might require additional steps that can significantly increase runtime.
</p>


<h3>Value</h3>

<p>An object of class <code>ggplot</code> from package <code>ggplot2</code> is returned by default.
If <code>plot=FALSE</code>, the data that would have been used to create the plot is returned.
Depending on which plot was selected, this is a data.table which contains the
following columns:
</p>
<p>For the Tracking plot:
</p>
<table role = "presentation">
<tr><td><code>period.until</code></td>
<td>
<p>The timepoint that marks the end (up until and including) of the period to which the data in this row refers.</p>
</td></tr>
<tr><td><code>variable</code></td>
<td>
<p>Type of variable that 'value' refers to. Either &quot;model name&quot; or &quot;Actual&quot; (if <code>transactions=TRUE</code>).</p>
</td></tr>
<tr><td><code>value</code></td>
<td>
<p>Depending on variable either (Actual) the actual number of repeat transactions in the period that ends at <code>period.until</code>,
or the unconditional expectation for the period that ends on <code>period.until</code> (&quot;model name&quot;).</p>
</td></tr>
</table>
<p>For the PMF plot:
</p>
<table role = "presentation">
<tr><td><code>num.transactions</code></td>
<td>
<p>The number of repeat transactions in the estimation period (as ordered factor).</p>
</td></tr>
<tr><td><code>variable</code></td>
<td>
<p>Type of variable that 'value' refers to. Either &quot;model name&quot; or &quot;Actual&quot; (if <code>transactions=TRUE</code>).</p>
</td></tr>
<tr><td><code>value</code></td>
<td>
<p>Depending on variable either (Actual) the actual number of customers which have the respective number of repeat transactions,
or the number of customers which are expected to have the respective number of repeat transactions, as by the fitted model (&quot;model name&quot;).</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Because the unconditional expectation for a period is derived as the difference of
the cumulative expectations calculated at the beginning and at end of the period,
all timepoints for which the expectation is calculated are required to be spaced exactly 1 time unit apart.
</p>
<p>If <code>prediction.end</code> does not coincide with the start of a time unit, the last timepoint
for which the expectation is calculated and plotted therefore is not <code>prediction.end</code>
but the start of the first time unit after <code>prediction.end</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.clv.fitted.spending">plot.clv.fitted.spending</a></code> for diagnostics of spending models
</p>
<p><code><a href="#topic+plot.clv.data">plot.clv.data</a></code> for transaction diagnostics of <code>clv.data</code> objects
</p>
<p><code><a href="#topic+pmf">pmf</a></code> for the values on which the PMF plot is based
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

data("cdnow")

# Fit ParetoNBD model on the CDnow data
clv.cdnow &lt;- clvdata(cdnow, time.unit="w",
                           estimation.split=37,
                           date.format="ymd")
pnbd.cdnow &lt;- pnbd(clv.cdnow)

## TRACKING PLOT
# Plot actual repeat transaction, overlayed with the
#  expected repeat transactions as by the fitted model
plot(pnbd.cdnow)

# Plot cumulative expected transactions of only the model
plot(pnbd.cdnow, cumulative=TRUE, transactions=FALSE)

# Plot until 2001-10-21
plot(pnbd.cdnow, prediction.end = "2001-10-21")

# Plot until 2001-10-21, as date
plot(pnbd.cdnow,
     prediction.end = lubridate::dym("21-2001-10"))

# Plot 15 time units after end of estimation period
plot(pnbd.cdnow, prediction.end = 15)

# Save the data generated for plotting
#   (period, actual transactions, expected transactions)
plot.out &lt;- plot(pnbd.cdnow, prediction.end = 15)

# A ggplot object is returned that can be further tweaked
library("ggplot2")
gg.pnbd.cdnow &lt;- plot(pnbd.cdnow)
gg.pnbd.cdnow + ggtitle("PNBD on CDnow")


## PMF PLOT
plot(pnbd.cdnow, which="pmf")

# For transactions 0 to 15, also have
#  to change label for remaining
plot(pnbd.cdnow, which="pmf", trans.bins=0:15,
     label.remaining="16+")

# For transactions 0 to 15 bins, no remaining
plot(pnbd.cdnow, which="pmf", trans.bins=0:15,
     calculate.remaining=FALSE)

## MODEL COMPARISON
# compare vs bgnbd
bgnbd.cdnow &lt;- bgnbd(clv.cdnow)
ggomnbd.cdnow &lt;- ggomnbd(clv.cdnow)

# specify colors as names of other.models
# note that ggomnbd collapses into the pnbd on this dataset
plot(pnbd.cdnow, cumulative=TRUE,
     other.models=list(blue=bgnbd.cdnow, "#00ff00"=ggomnbd.cdnow))

# specify names as label, using standard colors
plot(pnbd.cdnow, which="pmf",
     other.models=list(bgnbd.cdnow),
     label=c("Pareto/NBD", "BG/NBD"))


</code></pre>

<hr>
<h2 id='pmf'>Probability Mass Function</h2><span id='topic+pmf'></span><span id='topic+pmf+2Cclv.fitted.transactions-method'></span>

<h3>Description</h3>

<p>Calculate P(X(t)=x), the probability to make exactly <code>x</code> repeat transactions in
the interval (0, t]. This interval is in the estimation period and excludes values of <code>t=0</code>.
Note that here <code>t</code> is defined as the observation period <code>T.cal</code> which differs by customer.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'clv.fitted.transactions'
pmf(object, x = 0:5)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pmf_+3A_object">object</code></td>
<td>
<p>The fitted transaction model.</p>
</td></tr>
<tr><td><code id="pmf_+3A_x">x</code></td>
<td>
<p>Vector of positive integer numbers (&gt;=0) indicating the number of repeat transactions x for
which the PMF should be calculated.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a <code>data.table</code> with ids and depending on <code>x</code>, multiple columns of PMF values, each column
for one value in <code>x</code>.
</p>
<table role = "presentation">
<tr><td><code>Id</code></td>
<td>
<p>customer identification</p>
</td></tr>
<tr><td><code>pmf.x.Y</code></td>
<td>
<p>PMF values for Y number of transactions</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>The model fitting functions <code><a href="#topic+pnbd">pnbd</a>,
<a href="#topic+bgnbd">bgnbd</a>, <a href="#topic+ggomnbd">ggomnbd</a></code>.
</p>
<p><code><a href="#topic+plot.clv.fitted.transactions">plot</a></code> to visually compare
the PMF values against actuals.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("cdnow")

# Fit the ParetoNBD model on the CDnow data
pnbd.cdnow &lt;- pnbd(clvdata(cdnow, time.unit="w",
                           estimation.split=37,
                           date.format="ymd"))

# Calculate the PMF for 0 to 10 transactions
#  in the estimation period
pmf(pnbd.cdnow, x=0:10)

# Compare vs. actuals (CBS in estimation period):
# x    mean(pmf)    actual percentage of x
# 0    0.616514     1432/2357= 0.6075519
# 1    0.168309     436/2357 = 0.1849809
# 2    0.080971     208/2357 = 0.0882478
# 3    0.046190     100/2357 = 0.0424268
# 4    0.028566     60/2357  = 0.0254561
# 5    0.018506     36/2357  = 0.0152737
# 6    0.012351     27/2357  = 0.0114552
# 7    0.008415     21/2357  = 0.0089096
# 8    0.005822     5/2357   = 0.0021213
# 9    0.004074     4/2357   = 0.0016971
# 10   0.002877     7/2357   = 0.0029699


</code></pre>

<hr>
<h2 id='pnbd'>Pareto/NBD models</h2><span id='topic+pnbd'></span><span id='topic+pnbd+2Cclv.data-method'></span><span id='topic+pnbd+2Cclv.data.static.covariates-method'></span><span id='topic+pnbd+2Cclv.data.dynamic.covariates-method'></span>

<h3>Description</h3>

<p>Fits Pareto/NBD models on transactional data with and without covariates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'clv.data'
pnbd(
  clv.data,
  start.params.model = c(),
  use.cor = FALSE,
  start.param.cor = c(),
  optimx.args = list(),
  verbose = TRUE,
  ...
)

## S4 method for signature 'clv.data.static.covariates'
pnbd(
  clv.data,
  start.params.model = c(),
  use.cor = FALSE,
  start.param.cor = c(),
  optimx.args = list(),
  verbose = TRUE,
  names.cov.life = c(),
  names.cov.trans = c(),
  start.params.life = c(),
  start.params.trans = c(),
  names.cov.constr = c(),
  start.params.constr = c(),
  reg.lambdas = c(),
  ...
)

## S4 method for signature 'clv.data.dynamic.covariates'
pnbd(
  clv.data,
  start.params.model = c(),
  use.cor = FALSE,
  start.param.cor = c(),
  optimx.args = list(),
  verbose = TRUE,
  names.cov.life = c(),
  names.cov.trans = c(),
  start.params.life = c(),
  start.params.trans = c(),
  names.cov.constr = c(),
  start.params.constr = c(),
  reg.lambdas = c(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pnbd_+3A_clv.data">clv.data</code></td>
<td>
<p>The data object on which the model is fitted.</p>
</td></tr>
<tr><td><code id="pnbd_+3A_start.params.model">start.params.model</code></td>
<td>
<p>Named start parameters containing the optimization start parameters for the model without covariates.</p>
</td></tr>
<tr><td><code id="pnbd_+3A_use.cor">use.cor</code></td>
<td>
<p>Whether the correlation between the transaction and lifetime process should be estimated.</p>
</td></tr>
<tr><td><code id="pnbd_+3A_start.param.cor">start.param.cor</code></td>
<td>
<p>Start parameter for the optimization of the correlation.</p>
</td></tr>
<tr><td><code id="pnbd_+3A_optimx.args">optimx.args</code></td>
<td>
<p>Additional arguments to control the optimization which are forwarded to <code><a href="optimx.html#topic+optimx">optimx::optimx</a></code>.
If multiple optimization methods are specified, only the result of the last method is further processed.</p>
</td></tr>
<tr><td><code id="pnbd_+3A_verbose">verbose</code></td>
<td>
<p>Show details about the running of the function.</p>
</td></tr>
<tr><td><code id="pnbd_+3A_...">...</code></td>
<td>
<p>Ignored</p>
</td></tr>
<tr><td><code id="pnbd_+3A_names.cov.life">names.cov.life</code></td>
<td>
<p>Which of the set Lifetime covariates should be used. Missing parameter indicates all covariates shall be used.</p>
</td></tr>
<tr><td><code id="pnbd_+3A_names.cov.trans">names.cov.trans</code></td>
<td>
<p>Which of the set Transaction covariates should be used. Missing parameter indicates all covariates shall be used.</p>
</td></tr>
<tr><td><code id="pnbd_+3A_start.params.life">start.params.life</code></td>
<td>
<p>Named start parameters containing the optimization start parameters for all lifetime covariates.</p>
</td></tr>
<tr><td><code id="pnbd_+3A_start.params.trans">start.params.trans</code></td>
<td>
<p>Named start parameters containing the optimization start parameters for all transaction covariates.</p>
</td></tr>
<tr><td><code id="pnbd_+3A_names.cov.constr">names.cov.constr</code></td>
<td>
<p>Which covariates should be forced to use the same parameters for the lifetime and transaction process. The covariates need to be present as both, lifetime and transaction covariates.</p>
</td></tr>
<tr><td><code id="pnbd_+3A_start.params.constr">start.params.constr</code></td>
<td>
<p>Named start parameters containing the optimization start parameters for the constraint covariates.</p>
</td></tr>
<tr><td><code id="pnbd_+3A_reg.lambdas">reg.lambdas</code></td>
<td>
<p>Named lambda parameters used for the L2 regularization of the lifetime and the transaction covariate parameters. Lambdas have to be &gt;= 0.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Model parameters for the Pareto/NBD model are <code>r, alpha, s, and beta</code>. <br />
<code>s</code>: shape parameter of the Gamma distribution for the lifetime process.
The smaller s, the stronger the heterogeneity of customer lifetimes. <br />
<code>beta</code>: rate parameter for the Gamma distribution for the lifetime process. <br />
<code>r</code>: shape parameter of the Gamma distribution of the purchase process.
The smaller r, the stronger the heterogeneity of the purchase process.<br />
<code>alpha</code>: rate parameter of the Gamma distribution of the purchase process.
</p>
<p>Based on these parameters, the average purchase rate while customers are active
is r/alpha and the average dropout rate is s/beta.
</p>
<p>Ideally, the starting parameters for r and s represent your best guess
concerning the heterogeneity of customers in their buy and die rate.
If covariates are included into the model additionally parameters for the
covariates affecting the attrition and the purchase process are part of the model.
</p>
<p>If no start parameters are given, r=0.5, alpha=15, s=0.5, beta=10 is used for all model parameters and 0.1 for covariate parameters.
The model start parameters are required to be &gt; 0.
</p>


<h4>The Pareto/NBD model</h4>

<p>The Pareto/NBD is the first model addressing the issue of modeling customer purchases and
attrition simultaneously for non-contractual settings. The model uses a Pareto distribution,
a combination of an Exponential and a Gamma distribution, to explicitly model customers'
(unobserved) attrition behavior in addition to customers' purchase process.<br />
In general, the Pareto/NBD model consist of two parts. A first process models the purchase
behavior of customers as long as the customers are active. A second process models customers'
attrition. Customers live (and buy) for a certain unknown time until they become inactive
and &quot;die&quot;. Customer attrition is unobserved. Inactive customers may not be reactivated.
For technical details we refer to the original paper by Schmittlein, Morrison and Colombo
(1987) and the detailed technical note of Fader and Hardie (2005).
</p>



<h4>Pareto/NBD model with static covariates</h4>

<p>The standard Pareto/NBD model captures heterogeneity was solely using Gamma distributions.
However, often exogenous knowledge, such as for example customer demographics, is available.
The supplementary knowledge may explain part of the heterogeneity among the customers and
therefore increase the predictive accuracy of the model. In addition, we can rely on these
parameter estimates for inference, i.e. identify and quantify effects of contextual factors
on the two underlying purchase and attrition processes. For technical details we refer to
the technical note by Fader and Hardie (2007).
</p>



<h4>Pareto/NBD model with dynamic covariates</h4>

<p>In many real-world applications customer purchase and attrition behavior may be
influenced by covariates that vary over time. In consequence, the timing of a purchase
and the corresponding value of at covariate a that time becomes relevant. Time-varying
covariates can affect customer on aggregated level as well as on an individual level:
In the first case, all customers are affected simultaneously, in the latter case a
covariate is only relevant for a particular customer. For technical details we refer to
the paper by Bachmann, Meierer and NÃ¤f (2020).
</p>



<h3>Value</h3>

<p>Depending on the data object on which the model was fit, <code>pnbd</code> returns either an object of
class <a href="#topic+clv.pnbd-class">clv.pnbd</a>, <a href="#topic+clv.pnbd.static.cov-class">clv.pnbd.static.cov</a>, or <a href="#topic+clv.pnbd.dynamic.cov-class">clv.pnbd.dynamic.cov</a>.
</p>
<p>The function <code><a href="#topic+summary.clv.fitted">summary</a></code> can be used to obtain and print a summary of the results.
The generic accessor functions <code>coefficients</code>, <code><a href="#topic+vcov.clv.fitted">vcov</a></code>, <code><a href="#topic+fitted.clv.fitted">fitted</a></code>,
<code>logLik</code>, <code>AIC</code>, <code>BIC</code>, and <code>nobs</code> are available.
</p>


<h3>Note</h3>

<p>The Pareto/NBD model with dynamic covariates can currently not be fit with data that has a temporal resolution
of less than one day (data that was built with time unit <code>hours</code>).
</p>


<h3>References</h3>

<p>Schmittlein DC, Morrison DG, Colombo R (1987). &ldquo;Counting Your Customers:
Who-Are They and What Will They Do Next?&rdquo; Management Science, 33(1), 1-24.
</p>
<p>Bachmann P, Meierer M, Naef, J (2021). &ldquo;The Role of Time-Varying Contextual Factors
in Latent Attrition Models for Customer Base Analysis&rdquo; Marketing Science 40(4). 783-809.
</p>
<p>Fader PS, Hardie BGS (2005). &ldquo;A Note on Deriving the Pareto/NBD Model and
Related Expressions.&rdquo;
URL <a href="http://www.brucehardie.com/notes/009/pareto_nbd_derivations_2005-11-05.pdf">http://www.brucehardie.com/notes/009/pareto_nbd_derivations_2005-11-05.pdf</a>.
</p>
<p>Fader PS, Hardie BGS (2007). &ldquo;Incorporating time-invariant covariates into the
Pareto/NBD and BG/NBD models.&rdquo;
URL <a href="http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf">http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf</a>.
</p>
<p>Fader PS, Hardie BGS (2020). &ldquo;Deriving an Expression for P(X(t)=x) Under
the Pareto/NBD Model.&rdquo;
URL <a href="https://www.brucehardie.com/notes/012/pareto_NBD_pmf_derivation_rev.pdf">https://www.brucehardie.com/notes/012/pareto_NBD_pmf_derivation_rev.pdf</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+clvdata">clvdata</a></code> to create a clv data object, <code><a href="#topic+SetStaticCovariates">SetStaticCovariates</a></code>
to add static covariates to an existing clv data object.
</p>
<p><a href="#topic+gg">gg</a> to fit customer's average spending per transaction with the <code>Gamma-Gamma</code> model
</p>
<p><code><a href="#topic+predict.clv.fitted.transactions">predict</a></code> to predict expected transactions, probability of being alive, and customer lifetime value for every customer
</p>
<p><code><a href="#topic+plot.clv.fitted.transactions">plot</a></code> to plot the unconditional expectation as predicted by the fitted model
</p>
<p><code><a href="#topic+pmf">pmf</a></code> for the probability to make exactly x transactions in the estimation period, given by the probability mass function (PMF).
</p>
<p><code><a href="#topic+newcustomer">newcustomer</a></code> to predict the expected number of transactions for an average new customer.
</p>
<p>The generic functions <code><a href="#topic+vcov.clv.fitted">vcov</a></code>, <code><a href="#topic+summary.clv.fitted">summary</a></code>, <code><a href="#topic+fitted.clv.fitted">fitted</a></code>.
</p>
<p><code><a href="#topic+SetDynamicCovariates">SetDynamicCovariates</a></code> to add dynamic covariates on which the <code>pnbd</code> model can be fit.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("apparelTrans")
clv.data.apparel &lt;- clvdata(apparelTrans, date.format = "ymd",
                            time.unit = "w", estimation.split = 52)

# Fit standard pnbd model
pnbd(clv.data.apparel)

# Give initial guesses for the model parameters
pnbd(clv.data.apparel,
     start.params.model = c(r=0.5, alpha=15, s=0.5, beta=10))


# pass additional parameters to the optimizer (optimx)
#    Use Nelder-Mead as optimization method and print
#    detailed information about the optimization process
apparel.pnbd &lt;- pnbd(clv.data.apparel,
                     optimx.args = list(method="Nelder-Mead",
                                        control=list(trace=6)))

# estimated coefs
coef(apparel.pnbd)

# summary of the fitted model
summary(apparel.pnbd)

# predict CLV etc for holdout period
predict(apparel.pnbd)

# predict CLV etc for the next 15 periods
predict(apparel.pnbd, prediction.end = 15)


# Estimate correlation as well
pnbd(clv.data.apparel, use.cor = TRUE)


# To estimate the pnbd model with static covariates,
#   add static covariates to the data
data("apparelStaticCov")
clv.data.static.cov &lt;-
 SetStaticCovariates(clv.data.apparel,
                     data.cov.life = apparelStaticCov,
                     names.cov.life = c("Gender", "Channel"),
                     data.cov.trans = apparelStaticCov,
                     names.cov.trans = c("Gender", "Channel"))

# Fit pnbd with static covariates
pnbd(clv.data.static.cov)

# Give initial guesses for both covariate parameters
pnbd(clv.data.static.cov, start.params.trans = c(Gender=0.75, Channel=0.7),
                   start.params.life  = c(Gender=0.5, Channel=0.5))

# Use regularization
pnbd(clv.data.static.cov, reg.lambdas = c(trans = 5, life=5))

# Force the same coefficient to be used for both covariates
pnbd(clv.data.static.cov, names.cov.constr = "Gender",
                   start.params.constr = c(Gender=0.5))

# Fit model only with the Channel covariate for life but
# keep all trans covariates as is
pnbd(clv.data.static.cov, names.cov.life = c("Channel"))

# Add dynamic covariates data to the data object
#   add dynamic covariates to the data

## Not run: 
data("apparelDynCov")
clv.data.dyn.cov &lt;-
  SetDynamicCovariates(clv.data = clv.data.apparel,
                       data.cov.life = apparelDynCov,
                       data.cov.trans = apparelDynCov,
                       names.cov.life = c("High.Season", "Gender", "Channel"),
                       names.cov.trans = c("High.Season", "Gender", "Channel"),
                       name.date = "Cov.Date")


# Fit PNBD with dynamic covariates
pnbd(clv.data.dyn.cov)

# The same fitting options as for the
#  static covariate are available
pnbd(clv.data.dyn.cov, reg.lambdas = c(trans=10, life=2))

## End(Not run)


</code></pre>

<hr>
<h2 id='pnbd_CET'>Pareto/NBD: Conditional Expected Transactions</h2><span id='topic+pnbd_CET'></span><span id='topic+pnbd_nocov_CET'></span><span id='topic+pnbd_staticcov_CET'></span>

<h3>Description</h3>

<p>Calculates the expected number of transactions in a given time period based
on a customer's past transaction behavior and the Pareto/NBD model parameters.
</p>

<dl>
<dt><code>pnbd_nocov_CET</code></dt><dd><p> Conditional Expected Transactions without covariates</p>
</dd>
<dt><code>pnbd_staticcov_CET</code></dt><dd><p> Conditional Expected Transactions with static covariates</p>
</dd>
</dl>



<h3>Usage</h3>

<pre><code class='language-R'>pnbd_nocov_CET(r, alpha_0, s, beta_0, dPeriods, vX, vT_x, vT_cal)

pnbd_staticcov_CET(
  r,
  alpha_0,
  s,
  beta_0,
  dPeriods,
  vX,
  vT_x,
  vT_cal,
  vCovParams_trans,
  vCovParams_life,
  mCov_trans,
  mCov_life
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pnbd_CET_+3A_r">r</code></td>
<td>
<p>shape parameter of the Gamma distribution of the purchase process. The smaller r, the stronger the heterogeneity of the purchase process</p>
</td></tr>
<tr><td><code id="pnbd_CET_+3A_alpha_0">alpha_0</code></td>
<td>
<p>rate parameter of the Gamma distribution of the purchase process</p>
</td></tr>
<tr><td><code id="pnbd_CET_+3A_s">s</code></td>
<td>
<p>shape parameter of the Gamma distribution for the lifetime process. The smaller s, the stronger the heterogeneity of customer lifetimes</p>
</td></tr>
<tr><td><code id="pnbd_CET_+3A_beta_0">beta_0</code></td>
<td>
<p>rate parameter for the Gamma distribution for the lifetime process.</p>
</td></tr>
<tr><td><code id="pnbd_CET_+3A_dperiods">dPeriods</code></td>
<td>
<p>number of periods to predict</p>
</td></tr>
<tr><td><code id="pnbd_CET_+3A_vx">vX</code></td>
<td>
<p>Frequency vector of length n counting the numbers of purchases.</p>
</td></tr>
<tr><td><code id="pnbd_CET_+3A_vt_x">vT_x</code></td>
<td>
<p>Recency vector of length n.</p>
</td></tr>
<tr><td><code id="pnbd_CET_+3A_vt_cal">vT_cal</code></td>
<td>
<p>Vector of length n indicating the total number of periods of observation.</p>
</td></tr>
<tr><td><code id="pnbd_CET_+3A_vcovparams_trans">vCovParams_trans</code></td>
<td>
<p>Vector of estimated parameters for the transaction covariates.</p>
</td></tr>
<tr><td><code id="pnbd_CET_+3A_vcovparams_life">vCovParams_life</code></td>
<td>
<p>Vector of estimated parameters for the lifetime covariates.</p>
</td></tr>
<tr><td><code id="pnbd_CET_+3A_mcov_trans">mCov_trans</code></td>
<td>
<p>Matrix containing the covariates data affecting the transaction process. One column for each covariate.</p>
</td></tr>
<tr><td><code id="pnbd_CET_+3A_mcov_life">mCov_life</code></td>
<td>
<p>Matrix containing the covariates data affecting the lifetime process. One column for each covariate.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>mCov_trans</code> is a matrix containing the covariates data of
the time-invariant covariates that affect the transaction process.
Each column represents a different covariate. For every column a gamma parameter
needs to added to <code>vCovParams_trans</code> at the respective position.
</p>
<p><code>mCov_life</code> is a matrix containing the covariates data of
the time-invariant covariates that affect the lifetime process.
Each column represents a different covariate. For every column a gamma parameter
needs to added to <code>vCovParams_life</code> at the respective position.
</p>


<h3>Value</h3>

<p>Returns a vector containing the conditional expected transactions for the existing
customers in the Pareto/NBD model.
</p>


<h3>References</h3>

<p>Schmittlein DC, Morrison DG, Colombo R (1987). &ldquo;Counting Your Customers:
Who-Are They and What Will They Do Next?&rdquo; Management Science, 33(1), 1-24.
</p>
<p>Bachmann P, Meierer M, Naef, J (2021). &ldquo;The Role of Time-Varying Contextual Factors
in Latent Attrition Models for Customer Base Analysis&rdquo; Marketing Science 40(4). 783-809.
</p>
<p>Fader PS, Hardie BGS (2005). &ldquo;A Note on Deriving the Pareto/NBD Model and
Related Expressions.&rdquo;
URL <a href="http://www.brucehardie.com/notes/009/pareto_nbd_derivations_2005-11-05.pdf">http://www.brucehardie.com/notes/009/pareto_nbd_derivations_2005-11-05.pdf</a>.
</p>
<p>Fader PS, Hardie BGS (2007). &ldquo;Incorporating time-invariant covariates into the
Pareto/NBD and BG/NBD models.&rdquo;
URL <a href="http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf">http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf</a>.
</p>
<p>Fader PS, Hardie BGS (2020). &ldquo;Deriving an Expression for P(X(t)=x) Under
the Pareto/NBD Model.&rdquo;
URL <a href="https://www.brucehardie.com/notes/012/pareto_NBD_pmf_derivation_rev.pdf">https://www.brucehardie.com/notes/012/pareto_NBD_pmf_derivation_rev.pdf</a>
</p>

<hr>
<h2 id='pnbd_DERT'>Pareto/NBD: Discounted Expected Residual Transactions</h2><span id='topic+pnbd_DERT'></span><span id='topic+pnbd_nocov_DERT'></span><span id='topic+pnbd_staticcov_DERT'></span>

<h3>Description</h3>

<p>Calculates the discounted expected residual transactions.
</p>

<dl>
<dt><code>pnbd_nocov_DERT</code></dt><dd><p> Discounted expected residual transactions for the Pareto/NBD model without covariates</p>
</dd>
<dt><code>pnbd_staticcov_DERT</code></dt><dd><p> Discounted expected residual transactions for the Pareto/NBD model with static covariates</p>
</dd>
</dl>



<h3>Usage</h3>

<pre><code class='language-R'>pnbd_nocov_DERT(
  r,
  alpha_0,
  s,
  beta_0,
  continuous_discount_factor,
  vX,
  vT_x,
  vT_cal
)

pnbd_staticcov_DERT(
  r,
  alpha_0,
  s,
  beta_0,
  continuous_discount_factor,
  vX,
  vT_x,
  vT_cal,
  mCov_life,
  mCov_trans,
  vCovParams_life,
  vCovParams_trans
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pnbd_DERT_+3A_r">r</code></td>
<td>
<p>shape parameter of the Gamma distribution of the purchase process. The smaller r, the stronger the heterogeneity of the purchase process</p>
</td></tr>
<tr><td><code id="pnbd_DERT_+3A_alpha_0">alpha_0</code></td>
<td>
<p>rate parameter of the Gamma distribution of the purchase process</p>
</td></tr>
<tr><td><code id="pnbd_DERT_+3A_s">s</code></td>
<td>
<p>shape parameter of the Gamma distribution for the lifetime process. The smaller s, the stronger the heterogeneity of customer lifetimes</p>
</td></tr>
<tr><td><code id="pnbd_DERT_+3A_beta_0">beta_0</code></td>
<td>
<p>rate parameter for the Gamma distribution for the lifetime process.</p>
</td></tr>
<tr><td><code id="pnbd_DERT_+3A_continuous_discount_factor">continuous_discount_factor</code></td>
<td>
<p>continuous discount factor to use</p>
</td></tr>
<tr><td><code id="pnbd_DERT_+3A_vx">vX</code></td>
<td>
<p>Frequency vector of length n counting the numbers of purchases.</p>
</td></tr>
<tr><td><code id="pnbd_DERT_+3A_vt_x">vT_x</code></td>
<td>
<p>Recency vector of length n.</p>
</td></tr>
<tr><td><code id="pnbd_DERT_+3A_vt_cal">vT_cal</code></td>
<td>
<p>Vector of length n indicating the total number of periods of observation.</p>
</td></tr>
<tr><td><code id="pnbd_DERT_+3A_mcov_life">mCov_life</code></td>
<td>
<p>Matrix containing the covariates data affecting the lifetime process. One column for each covariate.</p>
</td></tr>
<tr><td><code id="pnbd_DERT_+3A_mcov_trans">mCov_trans</code></td>
<td>
<p>Matrix containing the covariates data affecting the transaction process. One column for each covariate.</p>
</td></tr>
<tr><td><code id="pnbd_DERT_+3A_vcovparams_life">vCovParams_life</code></td>
<td>
<p>Vector of estimated parameters for the lifetime covariates.</p>
</td></tr>
<tr><td><code id="pnbd_DERT_+3A_vcovparams_trans">vCovParams_trans</code></td>
<td>
<p>Vector of estimated parameters for the transaction covariates.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>mCov_trans</code> is a matrix containing the covariates data of
the time-invariant covariates that affect the transaction process.
Each column represents a different covariate. For every column a gamma parameter
needs to added to <code>vCovParams_trans</code> at the respective position.
</p>
<p><code>mCov_life</code> is a matrix containing the covariates data of
the time-invariant covariates that affect the lifetime process.
Each column represents a different covariate. For every column a gamma parameter
needs to added to <code>vCovParams_life</code> at the respective position.
</p>


<h3>Value</h3>

<p>Returns a vector with the DERT for each customer.
</p>


<h3>References</h3>

<p>Schmittlein DC, Morrison DG, Colombo R (1987). &ldquo;Counting Your Customers:
Who-Are They and What Will They Do Next?&rdquo; Management Science, 33(1), 1-24.
</p>
<p>Bachmann P, Meierer M, Naef, J (2021). &ldquo;The Role of Time-Varying Contextual Factors
in Latent Attrition Models for Customer Base Analysis&rdquo; Marketing Science 40(4). 783-809.
</p>
<p>Fader PS, Hardie BGS (2005). &ldquo;A Note on Deriving the Pareto/NBD Model and
Related Expressions.&rdquo;
URL <a href="http://www.brucehardie.com/notes/009/pareto_nbd_derivations_2005-11-05.pdf">http://www.brucehardie.com/notes/009/pareto_nbd_derivations_2005-11-05.pdf</a>.
</p>
<p>Fader PS, Hardie BGS (2007). &ldquo;Incorporating time-invariant covariates into the
Pareto/NBD and BG/NBD models.&rdquo;
URL <a href="http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf">http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf</a>.
</p>
<p>Fader PS, Hardie BGS (2020). &ldquo;Deriving an Expression for P(X(t)=x) Under
the Pareto/NBD Model.&rdquo;
URL <a href="https://www.brucehardie.com/notes/012/pareto_NBD_pmf_derivation_rev.pdf">https://www.brucehardie.com/notes/012/pareto_NBD_pmf_derivation_rev.pdf</a>
</p>

<hr>
<h2 id='pnbd_expectation'>Pareto/NBD: Unconditional Expectation</h2><span id='topic+pnbd_expectation'></span><span id='topic+pnbd_nocov_expectation'></span><span id='topic+pnbd_staticcov_expectation'></span>

<h3>Description</h3>

<p>Computes the expected number of repeat transactions in the interval (0, vT_i]
for a randomly selected customer, where 0 is defined as the point when the customer came alive.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pnbd_nocov_expectation(r, s, alpha_0, beta_0, vT_i)

pnbd_staticcov_expectation(r, s, vAlpha_i, vBeta_i, vT_i)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pnbd_expectation_+3A_r">r</code></td>
<td>
<p>shape parameter of the Gamma distribution of the purchase process. The smaller r, the stronger the heterogeneity of the purchase process</p>
</td></tr>
<tr><td><code id="pnbd_expectation_+3A_s">s</code></td>
<td>
<p>shape parameter of the Gamma distribution for the lifetime process. The smaller s, the stronger the heterogeneity of customer lifetimes</p>
</td></tr>
<tr><td><code id="pnbd_expectation_+3A_alpha_0">alpha_0</code></td>
<td>
<p>rate parameter of the Gamma distribution of the purchase process</p>
</td></tr>
<tr><td><code id="pnbd_expectation_+3A_beta_0">beta_0</code></td>
<td>
<p>rate parameter for the Gamma distribution for the lifetime process.</p>
</td></tr>
<tr><td><code id="pnbd_expectation_+3A_vt_i">vT_i</code></td>
<td>
<p>Number of periods since the customer came alive</p>
</td></tr>
<tr><td><code id="pnbd_expectation_+3A_valpha_i">vAlpha_i</code></td>
<td>
<p>Vector of individual parameters alpha</p>
</td></tr>
<tr><td><code id="pnbd_expectation_+3A_vbeta_i">vBeta_i</code></td>
<td>
<p>Vector of individual parameters beta</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns the expected transaction values according to the chosen model.
</p>


<h3>References</h3>

<p>Schmittlein DC, Morrison DG, Colombo R (1987). &ldquo;Counting Your Customers:
Who-Are They and What Will They Do Next?&rdquo; Management Science, 33(1), 1-24.
</p>
<p>Bachmann P, Meierer M, Naef, J (2021). &ldquo;The Role of Time-Varying Contextual Factors
in Latent Attrition Models for Customer Base Analysis&rdquo; Marketing Science 40(4). 783-809.
</p>
<p>Fader PS, Hardie BGS (2005). &ldquo;A Note on Deriving the Pareto/NBD Model and
Related Expressions.&rdquo;
URL <a href="http://www.brucehardie.com/notes/009/pareto_nbd_derivations_2005-11-05.pdf">http://www.brucehardie.com/notes/009/pareto_nbd_derivations_2005-11-05.pdf</a>.
</p>
<p>Fader PS, Hardie BGS (2007). &ldquo;Incorporating time-invariant covariates into the
Pareto/NBD and BG/NBD models.&rdquo;
URL <a href="http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf">http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf</a>.
</p>
<p>Fader PS, Hardie BGS (2020). &ldquo;Deriving an Expression for P(X(t)=x) Under
the Pareto/NBD Model.&rdquo;
URL <a href="https://www.brucehardie.com/notes/012/pareto_NBD_pmf_derivation_rev.pdf">https://www.brucehardie.com/notes/012/pareto_NBD_pmf_derivation_rev.pdf</a>
</p>

<hr>
<h2 id='pnbd_LL'>Pareto/NBD: Log-Likelihood functions</h2><span id='topic+pnbd_LL'></span><span id='topic+pnbd_nocov_LL_ind'></span><span id='topic+pnbd_nocov_LL_sum'></span><span id='topic+pnbd_staticcov_LL_ind'></span><span id='topic+pnbd_staticcov_LL_sum'></span>

<h3>Description</h3>

<p>Calculates the Log-Likelihood values for the Pareto/NBD model with and without covariates.
</p>
<p>The function <code>pnbd_nocov_LL_ind</code> calculates the individual log-likelihood
values for each customer for the given parameters.
</p>
<p>The function <code>pnbd_nocov_LL_sum</code> calculates the log-likelihood value summed
across customers for the given parameters.
</p>
<p>The function <code>pnbd_staticcov_LL_ind</code> calculates the individual log-likelihood
values for each customer for the given parameters and covariates.
</p>
<p>The function <code>pnbd_staticcov_LL_sum</code> calculates the individual log-likelihood values summed
across customers.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pnbd_nocov_LL_ind(vLogparams, vX, vT_x, vT_cal)

pnbd_nocov_LL_sum(vLogparams, vX, vT_x, vT_cal, vN)

pnbd_staticcov_LL_ind(vParams, vX, vT_x, vT_cal, mCov_life, mCov_trans)

pnbd_staticcov_LL_sum(vParams, vX, vT_x, vT_cal, vN, mCov_life, mCov_trans)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pnbd_LL_+3A_vlogparams">vLogparams</code></td>
<td>
<p>vector with the Pareto/NBD model parameters at log scale. See Details.</p>
</td></tr>
<tr><td><code id="pnbd_LL_+3A_vx">vX</code></td>
<td>
<p>Frequency vector of length n counting the numbers of purchases.</p>
</td></tr>
<tr><td><code id="pnbd_LL_+3A_vt_x">vT_x</code></td>
<td>
<p>Recency vector of length n.</p>
</td></tr>
<tr><td><code id="pnbd_LL_+3A_vt_cal">vT_cal</code></td>
<td>
<p>Vector of length n indicating the total number of periods of observation.</p>
</td></tr>
<tr><td><code id="pnbd_LL_+3A_vn">vN</code></td>
<td>
<p>The value (&quot;number of times observed&quot;) with which the LL value of this observation is multiplied before summing across customers.</p>
</td></tr>
<tr><td><code id="pnbd_LL_+3A_vparams">vParams</code></td>
<td>
<p>vector with the parameters for the Pareto/NBD model at log scale and the static covariates at original scale. See Details.</p>
</td></tr>
<tr><td><code id="pnbd_LL_+3A_mcov_life">mCov_life</code></td>
<td>
<p>Matrix containing the covariates data affecting the lifetime process. One column for each covariate.</p>
</td></tr>
<tr><td><code id="pnbd_LL_+3A_mcov_trans">mCov_trans</code></td>
<td>
<p>Matrix containing the covariates data affecting the transaction process. One column for each covariate.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>vLogparams</code> is a vector with model parameters <code>r, alpha_0, s, beta_0</code> at log-scale, in this order.
</p>
<p><code>vParams</code> is vector with the Pareto/NBD model parameters at log scale,
followed by the parameters for the lifetime covariates at original scale and then
followed by the parameters for the transaction covariates at original scale
</p>
<p><code>mCov_trans</code> is a matrix containing the covariates data of
the time-invariant covariates that affect the transaction process.
Each column represents a different covariate. For every column a gamma parameter
needs to added to <code>vParams</code> at the respective position.
</p>
<p><code>mCov_life</code> is a matrix containing the covariates data of
the time-invariant covariates that affect the lifetime process.
Each column represents a different covariate. For every column a gamma parameter
needs to added to <code>vParams</code> at the respective position.
</p>


<h3>Value</h3>

<p>Returns the respective Log-Likelihood value(s) for the Pareto/NBD model
with or without covariates.
</p>


<h3>References</h3>

<p>Schmittlein DC, Morrison DG, Colombo R (1987). &ldquo;Counting Your Customers:
Who-Are They and What Will They Do Next?&rdquo; Management Science, 33(1), 1-24.
</p>
<p>Bachmann P, Meierer M, Naef, J (2021). &ldquo;The Role of Time-Varying Contextual Factors
in Latent Attrition Models for Customer Base Analysis&rdquo; Marketing Science 40(4). 783-809.
</p>
<p>Fader PS, Hardie BGS (2005). &ldquo;A Note on Deriving the Pareto/NBD Model and
Related Expressions.&rdquo;
URL <a href="http://www.brucehardie.com/notes/009/pareto_nbd_derivations_2005-11-05.pdf">http://www.brucehardie.com/notes/009/pareto_nbd_derivations_2005-11-05.pdf</a>.
</p>
<p>Fader PS, Hardie BGS (2007). &ldquo;Incorporating time-invariant covariates into the
Pareto/NBD and BG/NBD models.&rdquo;
URL <a href="http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf">http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf</a>.
</p>
<p>Fader PS, Hardie BGS (2020). &ldquo;Deriving an Expression for P(X(t)=x) Under
the Pareto/NBD Model.&rdquo;
URL <a href="https://www.brucehardie.com/notes/012/pareto_NBD_pmf_derivation_rev.pdf">https://www.brucehardie.com/notes/012/pareto_NBD_pmf_derivation_rev.pdf</a>
</p>

<hr>
<h2 id='pnbd_PAlive'>Pareto/NBD: Probability of Being Alive</h2><span id='topic+pnbd_PAlive'></span><span id='topic+pnbd_nocov_PAlive'></span><span id='topic+pnbd_staticcov_PAlive'></span>

<h3>Description</h3>

<p>Calculates the probability of a customer being alive at the end of the calibration period,
based on a customer's past transaction behavior and the Pareto/NBD model parameters.
</p>

<dl>
<dt><code>pnbd_nocov_PAlive</code></dt><dd><p> P(alive) for the Pareto/NBD model without covariates</p>
</dd>
<dt><code>pnbd_staticcov_PAlive</code></dt><dd><p> P(alive) for the Pareto/NBD model with static covariates</p>
</dd>
</dl>



<h3>Usage</h3>

<pre><code class='language-R'>pnbd_nocov_PAlive(r, alpha_0, s, beta_0, vX, vT_x, vT_cal)

pnbd_staticcov_PAlive(
  r,
  alpha_0,
  s,
  beta_0,
  vX,
  vT_x,
  vT_cal,
  vCovParams_trans,
  vCovParams_life,
  mCov_trans,
  mCov_life
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pnbd_PAlive_+3A_r">r</code></td>
<td>
<p>shape parameter of the Gamma distribution of the purchase process. The smaller r, the stronger the heterogeneity of the purchase process</p>
</td></tr>
<tr><td><code id="pnbd_PAlive_+3A_alpha_0">alpha_0</code></td>
<td>
<p>rate parameter of the Gamma distribution of the purchase process</p>
</td></tr>
<tr><td><code id="pnbd_PAlive_+3A_s">s</code></td>
<td>
<p>shape parameter of the Gamma distribution for the lifetime process. The smaller s, the stronger the heterogeneity of customer lifetimes</p>
</td></tr>
<tr><td><code id="pnbd_PAlive_+3A_beta_0">beta_0</code></td>
<td>
<p>rate parameter for the Gamma distribution for the lifetime process.</p>
</td></tr>
<tr><td><code id="pnbd_PAlive_+3A_vx">vX</code></td>
<td>
<p>Frequency vector of length n counting the numbers of purchases.</p>
</td></tr>
<tr><td><code id="pnbd_PAlive_+3A_vt_x">vT_x</code></td>
<td>
<p>Recency vector of length n.</p>
</td></tr>
<tr><td><code id="pnbd_PAlive_+3A_vt_cal">vT_cal</code></td>
<td>
<p>Vector of length n indicating the total number of periods of observation.</p>
</td></tr>
<tr><td><code id="pnbd_PAlive_+3A_vcovparams_trans">vCovParams_trans</code></td>
<td>
<p>Vector of estimated parameters for the transaction covariates.</p>
</td></tr>
<tr><td><code id="pnbd_PAlive_+3A_vcovparams_life">vCovParams_life</code></td>
<td>
<p>Vector of estimated parameters for the lifetime covariates.</p>
</td></tr>
<tr><td><code id="pnbd_PAlive_+3A_mcov_trans">mCov_trans</code></td>
<td>
<p>Matrix containing the covariates data affecting the transaction process. One column for each covariate.</p>
</td></tr>
<tr><td><code id="pnbd_PAlive_+3A_mcov_life">mCov_life</code></td>
<td>
<p>Matrix containing the covariates data affecting the lifetime process. One column for each covariate.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>mCov_trans</code> is a matrix containing the covariates data of
the time-invariant covariates that affect the transaction process.
Each column represents a different covariate. For every column a gamma parameter
needs to added to <code>vCovParams_trans</code> at the respective position.
</p>
<p><code>mCov_life</code> is a matrix containing the covariates data of
the time-invariant covariates that affect the lifetime process.
Each column represents a different covariate. For every column a gamma parameter
needs to added to <code>vCovParams_life</code> at the respective position.
</p>


<h3>Value</h3>

<p>Returns a vector with the PAlive for each customer.
</p>


<h3>References</h3>

<p>Schmittlein DC, Morrison DG, Colombo R (1987). &ldquo;Counting Your Customers:
Who-Are They and What Will They Do Next?&rdquo; Management Science, 33(1), 1-24.
</p>
<p>Bachmann P, Meierer M, Naef, J (2021). &ldquo;The Role of Time-Varying Contextual Factors
in Latent Attrition Models for Customer Base Analysis&rdquo; Marketing Science 40(4). 783-809.
</p>
<p>Fader PS, Hardie BGS (2005). &ldquo;A Note on Deriving the Pareto/NBD Model and
Related Expressions.&rdquo;
URL <a href="http://www.brucehardie.com/notes/009/pareto_nbd_derivations_2005-11-05.pdf">http://www.brucehardie.com/notes/009/pareto_nbd_derivations_2005-11-05.pdf</a>.
</p>
<p>Fader PS, Hardie BGS (2007). &ldquo;Incorporating time-invariant covariates into the
Pareto/NBD and BG/NBD models.&rdquo;
URL <a href="http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf">http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf</a>.
</p>
<p>Fader PS, Hardie BGS (2020). &ldquo;Deriving an Expression for P(X(t)=x) Under
the Pareto/NBD Model.&rdquo;
URL <a href="https://www.brucehardie.com/notes/012/pareto_NBD_pmf_derivation_rev.pdf">https://www.brucehardie.com/notes/012/pareto_NBD_pmf_derivation_rev.pdf</a>
</p>

<hr>
<h2 id='pnbd_pmf'>Pareto/NBD: Probability Mass Function (PMF)</h2><span id='topic+pnbd_pmf'></span><span id='topic+pnbd_nocov_PMF'></span><span id='topic+pnbd_staticcov_PMF'></span>

<h3>Description</h3>

<p>Calculate P(X(t)=x), the probability that a randomly selected customer
makes exactly x transactions in the interval (0, t].
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pnbd_nocov_PMF(r, alpha_0, s, beta_0, x, vT_i)

pnbd_staticcov_PMF(r, s, x, vAlpha_i, vBeta_i, vT_i)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pnbd_pmf_+3A_r">r</code></td>
<td>
<p>shape parameter of the Gamma distribution of the purchase process. The smaller r, the stronger the heterogeneity of the purchase process</p>
</td></tr>
<tr><td><code id="pnbd_pmf_+3A_alpha_0">alpha_0</code></td>
<td>
<p>rate parameter of the Gamma distribution of the purchase process</p>
</td></tr>
<tr><td><code id="pnbd_pmf_+3A_s">s</code></td>
<td>
<p>shape parameter of the Gamma distribution for the lifetime process. The smaller s, the stronger the heterogeneity of customer lifetimes</p>
</td></tr>
<tr><td><code id="pnbd_pmf_+3A_beta_0">beta_0</code></td>
<td>
<p>rate parameter for the Gamma distribution for the lifetime process.</p>
</td></tr>
<tr><td><code id="pnbd_pmf_+3A_x">x</code></td>
<td>
<p>The number of transactions to calculate the probability for (unsigned integer).</p>
</td></tr>
<tr><td><code id="pnbd_pmf_+3A_vt_i">vT_i</code></td>
<td>
<p>Number of periods since the customer came alive.</p>
</td></tr>
<tr><td><code id="pnbd_pmf_+3A_valpha_i">vAlpha_i</code></td>
<td>
<p>Vector of individual parameters alpha.</p>
</td></tr>
<tr><td><code id="pnbd_pmf_+3A_vbeta_i">vBeta_i</code></td>
<td>
<p>Vector of individual parameters beta.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a vector of probabilities.
</p>


<h3>References</h3>

<p>Schmittlein DC, Morrison DG, Colombo R (1987). &ldquo;Counting Your Customers:
Who-Are They and What Will They Do Next?&rdquo; Management Science, 33(1), 1-24.
</p>
<p>Bachmann P, Meierer M, Naef, J (2021). &ldquo;The Role of Time-Varying Contextual Factors
in Latent Attrition Models for Customer Base Analysis&rdquo; Marketing Science 40(4). 783-809.
</p>
<p>Fader PS, Hardie BGS (2005). &ldquo;A Note on Deriving the Pareto/NBD Model and
Related Expressions.&rdquo;
URL <a href="http://www.brucehardie.com/notes/009/pareto_nbd_derivations_2005-11-05.pdf">http://www.brucehardie.com/notes/009/pareto_nbd_derivations_2005-11-05.pdf</a>.
</p>
<p>Fader PS, Hardie BGS (2007). &ldquo;Incorporating time-invariant covariates into the
Pareto/NBD and BG/NBD models.&rdquo;
URL <a href="http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf">http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf</a>.
</p>
<p>Fader PS, Hardie BGS (2020). &ldquo;Deriving an Expression for P(X(t)=x) Under
the Pareto/NBD Model.&rdquo;
URL <a href="https://www.brucehardie.com/notes/012/pareto_NBD_pmf_derivation_rev.pdf">https://www.brucehardie.com/notes/012/pareto_NBD_pmf_derivation_rev.pdf</a>
</p>

<hr>
<h2 id='predict.clv.fitted.spending'>Infer customers' spending</h2><span id='topic+predict.clv.fitted.spending'></span><span id='topic+predict+2Cclv.fitted.spending-method'></span>

<h3>Description</h3>

<p>Infer customer's mean spending per transaction and compare it to the actual mean spending in the holdout period.
</p>


<h4>New customer prediction</h4>

<p>The fitted model can also be used to estimate the spending that a single, (fictional), average
newly alive customer is expected to make at the moment of the first transaction.
This is, for a customer which has no existing order history and that just &quot;came alive&quot;.
</p>
<p>The data on which the model was fit and which is stored in it is NOT used for this prediction.
See examples and <a href="#topic+newcustomer">newcustomer.spending</a> for more details.
</p>



<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'clv.fitted.spending'
predict(
  object,
  newdata = NULL,
  uncertainty = c("none", "boots"),
  level = 0.9,
  num.boots = 100,
  verbose = TRUE,
  ...
)

## S4 method for signature 'clv.fitted.spending'
predict(
  object,
  newdata = NULL,
  uncertainty = c("none", "boots"),
  level = 0.9,
  num.boots = 100,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict.clv.fitted.spending_+3A_object">object</code></td>
<td>
<p>A fitted spending model for which prediction is desired.</p>
</td></tr>
<tr><td><code id="predict.clv.fitted.spending_+3A_newdata">newdata</code></td>
<td>
<p>A <code>clv.data</code> object or data for the new customer prediction (see <a href="#topic+newcustomer">newcustomer.spending</a>).
If none or NULL is given, predictions are made for the data on which the model was fit.</p>
</td></tr>
<tr><td><code id="predict.clv.fitted.spending_+3A_uncertainty">uncertainty</code></td>
<td>
<p>Method to produce confidence intervals of the predictions (parameter uncertainty). Either &quot;none&quot; (default) or &quot;boots&quot;.</p>
</td></tr>
<tr><td><code id="predict.clv.fitted.spending_+3A_level">level</code></td>
<td>
<p>Required confidence level, if <code>uncertainty="boots"</code>.</p>
</td></tr>
<tr><td><code id="predict.clv.fitted.spending_+3A_num.boots">num.boots</code></td>
<td>
<p>Number of bootstrap repetitions, if <code>uncertainty="boots"</code>. A low number may not produce intervals for all customers if they are not sampled.</p>
</td></tr>
<tr><td><code id="predict.clv.fitted.spending_+3A_verbose">verbose</code></td>
<td>
<p>Show details about the running of the function.</p>
</td></tr>
<tr><td><code id="predict.clv.fitted.spending_+3A_...">...</code></td>
<td>
<p>Ignored</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>newdata</code> is provided, the individual customer statistics underlying the model are calculated
the same way as when the model was fit initially. Hence, if <code>remove.first.transaction</code> was <code>TRUE</code>,
this will be applied to <code>newdata</code> as well.
</p>
<p>To predict for new customers, the output of <a href="#topic+newcustomer">newcustomer.spending</a> has to be given to <code>newdata</code>. See examples.
</p>


<h3>Value</h3>

<p>An object of class <code>data.table</code> with columns:
</p>
<table role = "presentation">
<tr><td><code>Id</code></td>
<td>
<p>The respective customer identifier</p>
</td></tr>
<tr><td><code>actual.mean.spending</code></td>
<td>
<p>Actual mean spending per transaction in the holdout period. Only if there is a holdout period otherwise it is not reported.</p>
</td></tr>
<tr><td><code>predicted.mean.spending</code></td>
<td>
<p>The mean spending per transaction as predicted by the fitted spending model.</p>
</td></tr>
</table>
<p>If predicting for new customers (using <code>newcustomer.spending()</code>), a numeric scalar
indicating the expected spending is returned instead.
</p>


<h3>Uncertainty Estimates</h3>

<p>Bootstrapping is used to provide confidence intervals of all predicted metrics.
These provide an estimate of parameter uncertainty.
To create bootstrapped data, customer ids are sampled with replacement until reaching original
length and all transactions of the sampled customers are used to create a new <code>clv.data</code> object.
A new model is fit on the bootstrapped data with the exact same specification as used when
fitting <code>object</code> (incl. start parameters and 'optimx.args') and it is then used to predict on this data.
</p>
<p>It is highly recommended to fit the original model (<code>object</code>) with a robust optimization
method, such as Nelder-Mead (<code>optimx.args=list(method='Nelder-Mead')</code>).
This ensures that the model can also be fit on the bootstrapped data.
</p>
<p>All prediction parameters, incl <code>prediction.end</code> and <code>continuous.discount.factor</code>, are forwarded
to the prediction on the bootstrapped data.
Per customer, the boundaries of the confidence intervals of each predicted metric are the
sample quantiles (<code>quantile(x, probs=c((1-level)/2, 1-(1-level)/2)</code>).
</p>
<p>See <a href="#topic+clv.bootstrapped.apply">clv.bootstrapped.apply</a> to create a custom bootstrapping procedure.
</p>


<h3>See Also</h3>

<p>models to predict spending: <a href="#topic+gg">gg</a>.
</p>
<p>models to predict transactions: <a href="#topic+pnbd">pnbd</a>, <a href="#topic+bgnbd">bgnbd</a>, <a href="#topic+ggomnbd">ggomnbd</a>.
</p>
<p><code><a href="#topic+predict.clv.fitted.transactions">predict</a></code> for transaction models
</p>
<p><code><a href="#topic+newcustomer">newdata.spending</a></code> to create data to predict for customers without order history
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("apparelTrans")

# Fit gg model on data
apparel.holdout &lt;- clvdata(apparelTrans, time.unit="w",
                           estimation.split = 52, date.format = "ymd")
apparel.gg &lt;- gg(apparel.holdout)

# Estimate customers' mean spending per transaction
predict(apparel.gg)

# Estimate the mean spending per transaction a single,
# fictional, average new customer is expected to make
# See ?newcustomer.spending() for more examples
predict(apparel.gg, newdata=newcustomer.spending())



</code></pre>

<hr>
<h2 id='predict.clv.fitted.transactions'>Predict CLV from a fitted transaction model</h2><span id='topic+predict.clv.fitted.transactions'></span><span id='topic+predict'></span><span id='topic+predict+2Cclv.fitted.transactions-method'></span>

<h3>Description</h3>

<p>Probabilistic customer attrition models predict in general three expected characteristics for every customer:
</p>

<ul>
<li><p> &quot;conditional expected transactions&quot; (<code>CET</code>), which is the number of transactions to expect from a customer
during the prediction period,
</p>
</li>
<li><p> &quot;probability of a customer being alive&quot; (<code>PAlive</code>) at the end of the estimation period and
</p>
</li>
<li><p> &quot;discounted expected residual transactions&quot; (<code>DERT</code>) for every customer, which is the total number of
transactions for the residual lifetime of a customer discounted to the end of the estimation period.
In the case of time-varying covariates, instead of <code>DERT</code>, &quot;discounted expected conditional transactions&quot; (<code>DECT</code>)
is predicted. <code>DECT</code> does only cover a finite time horizon in contrast to <code>DERT</code>.
For <code>continuous.discount.factor=0</code>, <code>DECT</code> corresponds to <code>CET</code>.
</p>
</li></ul>

<p>In order to derive a monetary value such as CLV, customer spending has to be considered.
If the <code>clv.data</code> object contains spending information, customer spending can be predicted using a Gamma/Gamma spending model for
parameter <code>predict.spending</code> and the predicted CLV is be calculated (if the transaction model supports <code>DERT/DECT</code>).
In this case, the prediction additionally contains the following two columns:
</p>

<ul>
<li><p> &quot;predicted.mean.spending&quot;, the mean spending per transactions as predicted by the spending model.
</p>
</li>
<li><p> &quot;CLV&quot;, the customer lifetime value. CLV is the product of DERT/DECT and predicted spending.
</p>
</li></ul>

<p>Uncertainty estimates are available for all predicted quantities using bootstrapping.
</p>


<h4>New customer prediction</h4>

<p>The fitted model can also be used to predict the number of transactions a fictional, single, average
newly alive customer is expected to make at the moment of the first transaction (&quot;coming alive&quot;).
This is, for a customer which has no existing order history.
For covariate models, the prediction is for an average customer with the given covariates.
</p>
<p>The individual-level unconditional expectation that is also used for the
<a href="#topic+plot.clv.fitted.transactions">tracking plot</a> is used to obtain this prediction.
For models without covariates, the prediction hence is the same for all customers
and independent of when a customer comes alive.
For models with covariates, the prediction is the same for all customers
with the same covariates.
</p>
<p>The data on which the model was fit and which is stored in it is NOT used for this prediction.
See examples and <a href="#topic+newcustomer">newcustomer</a> for more details.
</p>



<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'clv.fitted.transactions'
predict(
  object,
  newdata = NULL,
  prediction.end = NULL,
  predict.spending = gg,
  continuous.discount.factor = log(1 + 0.1),
  uncertainty = c("none", "boots"),
  level = 0.9,
  num.boots = 100,
  verbose = TRUE,
  ...
)

## S4 method for signature 'clv.fitted.transactions'
predict(
  object,
  newdata = NULL,
  prediction.end = NULL,
  predict.spending = gg,
  continuous.discount.factor = log(1 + 0.1),
  uncertainty = c("none", "boots"),
  level = 0.9,
  num.boots = 100,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict.clv.fitted.transactions_+3A_object">object</code></td>
<td>
<p>A fitted clv transaction model for which prediction is desired.</p>
</td></tr>
<tr><td><code id="predict.clv.fitted.transactions_+3A_newdata">newdata</code></td>
<td>
<p>A clv data object or data for the new customer prediction (see <a href="#topic+newcustomer">newcustomer</a>) for which predictions should
be made with the fitted model. If none or NULL is given, predictions are made for the data on which the model was fit.</p>
</td></tr>
<tr><td><code id="predict.clv.fitted.transactions_+3A_prediction.end">prediction.end</code></td>
<td>
<p> Until what point in time to predict. This can be the number of periods (numeric) or a form of date/time object. See details.</p>
</td></tr>
<tr><td><code id="predict.clv.fitted.transactions_+3A_predict.spending">predict.spending</code></td>
<td>
<p>Whether and how to predict spending and based on it also CLV, if possible. See details.</p>
</td></tr>
<tr><td><code id="predict.clv.fitted.transactions_+3A_continuous.discount.factor">continuous.discount.factor</code></td>
<td>
<p>continuous discount factor to use to calculate <code>DERT/DECT</code>. Defaults to a 10% continuous annual rate. See details.</p>
</td></tr>
<tr><td><code id="predict.clv.fitted.transactions_+3A_uncertainty">uncertainty</code></td>
<td>
<p>Method to produce confidence intervals of the predictions (parameter uncertainty). Either &quot;none&quot; (default) or &quot;boots&quot;.</p>
</td></tr>
<tr><td><code id="predict.clv.fitted.transactions_+3A_level">level</code></td>
<td>
<p>Required confidence level, if <code>uncertainty="boots"</code>.</p>
</td></tr>
<tr><td><code id="predict.clv.fitted.transactions_+3A_num.boots">num.boots</code></td>
<td>
<p>Number of bootstrap repetitions, if <code>uncertainty="boots"</code>. A low number may not produce intervals for all customers if they are not sampled.</p>
</td></tr>
<tr><td><code id="predict.clv.fitted.transactions_+3A_verbose">verbose</code></td>
<td>
<p>Show details about the running of the function.</p>
</td></tr>
<tr><td><code id="predict.clv.fitted.transactions_+3A_...">...</code></td>
<td>
<p>Ignored</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>predict.spending</code> indicates whether to predict customers' spending and if so, the spending model to use.
Accepted inputs are either a logical (<code>TRUE/FALSE</code>), a method to fit a spending model (i.e. <code><a href="#topic+gg">gg</a></code>), or
an already fitted spending model. If provided <code>TRUE</code>, a Gamma-Gamma model is fit with default options. If argument
<code>newdata</code> is provided, the spending model is fit on <code>newdata</code>. Predicting spending is only possible if
the transaction data contains spending information. See examples for illustrations of valid inputs.
</p>
<p>The <code>newdata</code> argument has to be a clv data object of the exact same class as the data object
on which the model was fit. In case the model was fit with covariates, <code>newdata</code> needs to contain identically
named covariate data.
</p>
<p>The use case for <code>newdata</code> is mainly two-fold: First, to estimate model parameters only on a
sample of the data and then use the fitted model object to predict or plot for the full data set provided through <code>newdata</code>.
Second, for models with dynamic covariates, to provide a clv data object with longer covariates than contained in the data
on which the model was estimated what allows to predict or plot further. When providing <code>newdata</code>, some models
might require additional steps that can significantly increase runtime.
</p>
<p>To predict for new customers, the output of <a href="#topic+newcustomer">newcustomer</a> has to be given to <code>newdata</code>. See examples.
</p>
<p><code>prediction.end</code> indicates until when to predict or plot and can be given as either
a point in time (of class <code>Date</code>, <code>POSIXct</code>, or <code>character</code>) or the number of periods.
If <code>prediction.end</code> is of class character, the date/time format set when creating the data object is used for parsing.
If <code>prediction.end</code> is the number of periods, the end of the fitting period serves as the reference point
from which periods are counted. Only full periods may be specified.
If <code>prediction.end</code> is omitted or NULL, it defaults to the end of the holdout period if present and to the
end of the estimation period otherwise.
</p>
<p>The first prediction period is defined to start right after the end of the estimation period.
If for example weekly time units are used and the estimation period ends on Sunday 2019-01-01, then the first day
of the first prediction period is Monday 2019-01-02. Each prediction period includes a total of 7 days and
the first prediction period therefore will end on, and include, Sunday 2019-01-08. Subsequent prediction periods
again start on Mondays and end on Sundays.
If <code>prediction.end</code> indicates a timepoint on which to end, this timepoint is included in the prediction period.
</p>
<p><code>continuous.discount.factor</code> is the continuous rate used to discount the expected residual
transactions (<code>DERT/DECT</code>). An annual rate of (100 x d)% equals a continuous rate delta = ln(1+d).
To account for time units which are not annual, the continuous rate has to be further adjusted
to delta=ln(1+d)/k, where k are the number of time units in a year.
</p>


<h3>Value</h3>

<p>An object of class <code>data.table</code> with columns:
</p>
<table role = "presentation">
<tr><td><code>Id</code></td>
<td>
<p>The respective customer identifier</p>
</td></tr>
<tr><td><code>period.first</code></td>
<td>
<p>First timepoint of prediction period</p>
</td></tr>
<tr><td><code>period.last</code></td>
<td>
<p>Last timepoint of prediction period</p>
</td></tr>
<tr><td><code>period.length</code></td>
<td>
<p>Number of time units covered by the period indicated by <code>period.first</code> and <code>period.last</code> (including both ends).</p>
</td></tr>
<tr><td><code>PAlive</code></td>
<td>
<p>Probability to be alive at the end of the estimation period</p>
</td></tr>
<tr><td><code>CET</code></td>
<td>
<p>The Conditional Expected Transactions: The number of transactions expected until prediction.end.</p>
</td></tr>
<tr><td><code>DERT or DECT</code></td>
<td>
<p>Discounted Expected Residual Transactions or Discounted Expected Conditional Transactions for dynamic covariates models</p>
</td></tr>
<tr><td><code>actual.x</code></td>
<td>
<p>Actual number of transactions until prediction.end. Only if there is a holdout period and the prediction ends in it, otherwise not reported.</p>
</td></tr>
<tr><td><code>actual.total.spending</code></td>
<td>
<p>Actual total spending until prediction.end. Only if there is a holdout period and the prediction ends in it, otherwise not reported.</p>
</td></tr>
<tr><td><code>predicted.mean.spending</code></td>
<td>
<p>The mean spending per transactions as predicted by the spending model.</p>
</td></tr>
<tr><td><code>predicted.total.spending</code></td>
<td>
<p>The predicted total spending until prediction.end (<code>CET*predicted.mean.spending</code>).</p>
</td></tr>
<tr><td><code>predicted.CLV</code></td>
<td>
<p>Customer Lifetime Value based on <code>DERT/DECT</code> and <code>predicted.mean.spending</code>.</p>
</td></tr>
</table>
<p>If predicting for new customers (using <code>newcustomer()</code>), a numeric scalar indicating the expected
number of transactions is returned instead.
</p>


<h3>Uncertainty Estimates</h3>

<p>Bootstrapping is used to provide confidence intervals of all predicted metrics.
These provide an estimate of parameter uncertainty.
To create bootstrapped data, customer ids are sampled with replacement until reaching original
length and all transactions of the sampled customers are used to create a new <code>clv.data</code> object.
A new model is fit on the bootstrapped data with the exact same specification as used when
fitting <code>object</code> (incl. start parameters and 'optimx.args') and it is then used to predict on this data.
</p>
<p>It is highly recommended to fit the original model (<code>object</code>) with a robust optimization
method, such as Nelder-Mead (<code>optimx.args=list(method='Nelder-Mead')</code>).
This ensures that the model can also be fit on the bootstrapped data.
</p>
<p>All prediction parameters, incl <code>prediction.end</code> and <code>continuous.discount.factor</code>, are forwarded
to the prediction on the bootstrapped data.
Per customer, the boundaries of the confidence intervals of each predicted metric are the
sample quantiles (<code>quantile(x, probs=c((1-level)/2, 1-(1-level)/2)</code>).
</p>
<p>See <a href="#topic+clv.bootstrapped.apply">clv.bootstrapped.apply</a> to create a custom bootstrapping procedure.
</p>


<h3>See Also</h3>

<p>models to predict transactions: <a href="#topic+pnbd">pnbd</a>, <a href="#topic+bgnbd">bgnbd</a>, <a href="#topic+ggomnbd">ggomnbd</a>.
</p>
<p>models to predict spending: <a href="#topic+gg">gg</a>.
</p>
<p><code><a href="#topic+predict.clv.fitted.spending">predict</a></code> for spending models
</p>
<p><a href="#topic+clv.bootstrapped.apply">clv.bootstrapped.apply</a> for bootstrapped model estimation
</p>
<p><code><a href="#topic+newcustomer">newcustomer</a></code> to create data to predict for newly alive customers.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


data("apparelTrans")
# Fit pnbd standard model on data, WITH holdout
apparel.holdout &lt;- clvdata(apparelTrans, time.unit="w",
                           estimation.split=52, date.format="ymd")
apparel.pnbd &lt;- pnbd(apparel.holdout)

# Predict until the end of the holdout period
predict(apparel.pnbd)

# Predict until 10 periods (weeks in this case) after
#   the end of the 37 weeks fitting period
predict(apparel.pnbd, prediction.end = 10) # ends on 2010-11-28

# Predict until 31th Dec 2016 with the timepoint as a character
predict(apparel.pnbd, prediction.end = "2016-12-31")

# Predict until 31th Dec 2016 with the timepoint as a Date
predict(apparel.pnbd, prediction.end = lubridate::ymd("2016-12-31"))


# Predict future transactions but not spending and CLV
predict(apparel.pnbd, predict.spending = FALSE)

# Predict spending by fitting a Gamma-Gamma model
predict(apparel.pnbd, predict.spending = gg)

# Fit a spending model separately and use it to predict spending
apparel.gg &lt;- gg(apparel.holdout, remove.first.transaction = FALSE)
predict(apparel.pnbd, predict.spending = apparel.gg)


# Fit pnbd standard model WITHOUT holdout
pnc &lt;- pnbd(clvdata(apparelTrans, time.unit="w", date.format="ymd"))

# This fails, because without holdout, a prediction.end is required
## Not run: 
predict(pnc)

## End(Not run)

# But it works if providing a prediction.end
predict(pnc, prediction.end = 10) # ends on 2016-12-17

# Predict the number of transactions a single, fictional, average new
# customer is expected to make in the first 3.45 weeks since coming alive
# See ?newcustomer() for more examples
predict(apparel.pnbd, newdata = newcustomer(num.periods=3.45))





</code></pre>

<hr>
<h2 id='print.clv.time'>Summarizing a CLV time object</h2><span id='topic+print.clv.time'></span><span id='topic+summary.clv.time'></span>

<h3>Description</h3>

<p>Summary method for CLV time objects that provides information about the start and end date of
the estimation and possible holdout sample.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'clv.time'
print(x, digits = max(3L, getOption("digits") - 3L), ...)

## S3 method for class 'clv.time'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.clv.time_+3A_x">x</code></td>
<td>
<p>An object of class <code>"summary.clv.time"</code>, usually, a result of a call to <code>summary.clv.time</code>.</p>
</td></tr>
<tr><td><code id="print.clv.time_+3A_digits">digits</code></td>
<td>
<p>The number of significant digits to use when printing.</p>
</td></tr>
<tr><td><code id="print.clv.time_+3A_...">...</code></td>
<td>
<p>Ignored.</p>
</td></tr>
<tr><td><code id="print.clv.time_+3A_object">object</code></td>
<td>
<p>A CLV time object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>This function computes and returns summary statistics of the
time related information stored in <code>object</code>. It returns a list of
class <code>summary.clv.time</code> that contains the elements:
</p>
<table role = "presentation">
<tr><td><code>time.unit</code></td>
<td>
<p>What time unit defines a single period.</p>
</td></tr>
<tr><td><code>estimation.period.in.tu</code></td>
<td>
<p>Length of estimation period in time units.</p>
</td></tr>
<tr><td><code>has.holdout</code></td>
<td>
<p>Whether the object has a holdout data sample.</p>
</td></tr>
<tr><td><code>holdout.period.in.tu</code></td>
<td>
<p>Length of holdout period in time units, if any.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+summary.clv.data">summary.clv.data</a></code> for how to summarize a clv data object
</p>

<hr>
<h2 id='SetDynamicCovariates'>Add Dynamic Covariates to a CLV data object</h2><span id='topic+SetDynamicCovariates'></span>

<h3>Description</h3>

<p>Add dynamic covariate data to an existing data object of class <code>clv.data</code>.
The returned object can be used to fit models with dynamic covariates.
</p>
<p>No covariate data can be added to a clv data object which already has any covariate set.
</p>
<p>At least 1 covariate is needed for both processes and no categorical covariate may be of only a single category.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SetDynamicCovariates(
  clv.data,
  data.cov.life,
  data.cov.trans,
  names.cov.life,
  names.cov.trans,
  name.id = "Id",
  name.date = "Date"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="SetDynamicCovariates_+3A_clv.data">clv.data</code></td>
<td>
<p>CLV data object to add the covariates data to.</p>
</td></tr>
<tr><td><code id="SetDynamicCovariates_+3A_data.cov.life">data.cov.life</code></td>
<td>
<p>Dynamic covariate data as <code>data.frame</code> or <code>data.table</code> for the lifetime process.</p>
</td></tr>
<tr><td><code id="SetDynamicCovariates_+3A_data.cov.trans">data.cov.trans</code></td>
<td>
<p>Dynamic covariate data as <code>data.frame</code> or <code>data.table</code> for the transaction process.</p>
</td></tr>
<tr><td><code id="SetDynamicCovariates_+3A_names.cov.life">names.cov.life</code></td>
<td>
<p>Vector with names of the columns in <code>data.cov.life</code> that contain the covariates.</p>
</td></tr>
<tr><td><code id="SetDynamicCovariates_+3A_names.cov.trans">names.cov.trans</code></td>
<td>
<p>Vector with names of the columns in <code>data.cov.trans</code> that contain the covariates.</p>
</td></tr>
<tr><td><code id="SetDynamicCovariates_+3A_name.id">name.id</code></td>
<td>
<p>Name of the column to find the Id data for both, <code>data.cov.life</code> and <code>data.cov.trans</code>.</p>
</td></tr>
<tr><td><code id="SetDynamicCovariates_+3A_name.date">name.date</code></td>
<td>
<p>Name of the column to find the Date data for both, <code>data.cov.life</code> and <code>data.cov.trans</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>data.cov.life</code> and <code>data.cov.trans</code> are <code>data.frame</code>s or <code>data.table</code>s that
each contain exactly 1 row for every combination of timepoint and customer.
For each customer appearing in the transaction data
there needs to be covariate data at every timepoint that marks the start of a period as defined
by <code>time.unit</code>. It has to range from the start of the estimation sample (<code>timepoint.estimation.start</code>)
until the end of the period in which the end of the holdout sample (<code>timepoint.holdout.end</code>) falls.
See the the provided data <code>apparelDynCov</code> for illustration.
Covariates of class <code>character</code> or <code>factor</code> are converted to k-1 numeric dummies.
</p>
<p><code>Date as character</code>
If the Date column in the covariate data is of type <code>character</code>, the <code>date.format</code> given when
creating the the <code>clv.data</code> object is used for parsing.
</p>


<h3>Value</h3>

<p>An object of class <code>clv.data.dynamic.covariates</code>.
See the class definition <a href="#topic+clv.data.dynamic.covariates-class">clv.data.dynamic.covariates</a>
for more details about the returned object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data("apparelTrans")
data("apparelDynCov")

# Create a clv data object without covariates
clv.data.apparel &lt;- clvdata(apparelTrans, time.unit="w",
                            date.format="ymd")

# Add dynamic covariate data
clv.data.dyn.cov  &lt;-
   SetDynamicCovariates(clv.data.apparel,
                       data.cov.life  = apparelDynCov,
                       names.cov.life = c("High.Season", "Gender", "Channel"),
                       data.cov.trans = apparelDynCov,
                       names.cov.trans = c("High.Season", "Gender", "Channel"),
                       name.id = "Id",
                       name.date = "Cov.Date")

# summary output about covariates data
summary(clv.data.dyn.cov)

# fit pnbd model with dynamic covariates
pnbd(clv.data.dyn.cov)

## End(Not run)

</code></pre>

<hr>
<h2 id='SetStaticCovariates'>Add Static Covariates to a CLV data object</h2><span id='topic+SetStaticCovariates'></span>

<h3>Description</h3>

<p>Add static covariate data to an existing data object of class <code>clv.data</code>.
The returned object then can be used to fit models with static covariates.
</p>
<p>No covariate data can be added to a clv data object which already has any covariate set.
</p>
<p>At least 1 covariate is needed for both processes and no categorical covariate may be of only a single category.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SetStaticCovariates(
  clv.data,
  data.cov.life,
  data.cov.trans,
  names.cov.life,
  names.cov.trans,
  name.id = "Id"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="SetStaticCovariates_+3A_clv.data">clv.data</code></td>
<td>
<p>CLV data object to add the covariates data to.</p>
</td></tr>
<tr><td><code id="SetStaticCovariates_+3A_data.cov.life">data.cov.life</code></td>
<td>
<p>Static covariate data as <code>data.frame</code> or <code>data.table</code> for the lifetime process.</p>
</td></tr>
<tr><td><code id="SetStaticCovariates_+3A_data.cov.trans">data.cov.trans</code></td>
<td>
<p>Static covariate data as <code>data.frame</code> or <code>data.table</code> for the transaction process.</p>
</td></tr>
<tr><td><code id="SetStaticCovariates_+3A_names.cov.life">names.cov.life</code></td>
<td>
<p>Vector with names of the columns in <code>data.cov.life</code> that contain the covariates.</p>
</td></tr>
<tr><td><code id="SetStaticCovariates_+3A_names.cov.trans">names.cov.trans</code></td>
<td>
<p>Vector with names of the columns in <code>data.cov.trans</code> that contain the covariates.</p>
</td></tr>
<tr><td><code id="SetStaticCovariates_+3A_name.id">name.id</code></td>
<td>
<p>Name of the column to find the Id data for both, <code>data.cov.life</code> and <code>data.cov.trans</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>data.cov.life</code> and <code>data.cov.trans</code> are <code>data.frame</code>s or <code>data.table</code>s that
each contain exactly one single row of covariate data for every customer appearing in the
transaction data. Covariates of class <code>character</code> or <code>factor</code> are converted
to k-1 numeric dummy variables.
</p>


<h3>Value</h3>

<p>An object of class <code>clv.data.static.covariates</code>.
See the class definition <a href="#topic+clv.data.static.covariates-class">clv.data.static.covariates</a>
for more details about the returned object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


data("apparelTrans")
data("apparelStaticCov")

# Create a clv data object without covariates
clv.data.apparel &lt;- clvdata(apparelTrans, time.unit="w",
                            date.format="ymd")

# Add static covariate data
clv.data.apparel.cov  &lt;-
   SetStaticCovariates(clv.data.apparel,
                       data.cov.life  = apparelStaticCov,
                       names.cov.life = "Gender",
                       data.cov.trans = apparelStaticCov,
                       names.cov.trans = "Gender",
                       name.id = "Id")

# more summary output
summary(clv.data.apparel.cov)

# fit model with static covariates
pnbd(clv.data.apparel.cov)


</code></pre>

<hr>
<h2 id='spending'>Formula Interface for Spending Models</h2><span id='topic+spending'></span>

<h3>Description</h3>

<p>Fit models for customer spending (currently only the Gamma-Gamma model).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spending(family, data, optimx.args = list(), verbose = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="spending_+3A_family">family</code></td>
<td>
<p>A spending model (currently only <code>gg</code>).</p>
</td></tr>
<tr><td><code id="spending_+3A_data">data</code></td>
<td>
<p>A <code>clv.data</code> object.</p>
</td></tr>
<tr><td><code id="spending_+3A_optimx.args">optimx.args</code></td>
<td>
<p>Additional arguments to control the optimization which are forwarded to <code><a href="optimx.html#topic+optimx">optimx::optimx</a></code>.
If multiple optimization methods are specified, only the result of the last method is further processed.</p>
</td></tr>
<tr><td><code id="spending_+3A_verbose">verbose</code></td>
<td>
<p>Show details about the running of the function.</p>
</td></tr>
<tr><td><code id="spending_+3A_...">...</code></td>
<td>
<p>Forwarded to model specified in <code>family</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns an object of the respective model which was fit.
</p>


<h3>See Also</h3>

<p>Spending models for <code>family</code>: <a href="#topic+gg">gg</a>.
</p>
<p><a href="#topic+latentAttrition">latentAttrition</a> to fit latent attrition models with a
formula interface
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

data("cdnow")
clv.cdnow &lt;- clvdata(data.transactions = cdnow, date.format="ymd",
                     time.unit = "weeks")

# Fit gg
spending(family=gg, data=clv.cdnow)

# Fit gg with start params
spending(family=gg, data=clv.cdnow,
         start.params.model=c(p=0.5, q=15, gamma=2))

# Fit gg, do not remove first transaction
spending(family=gg, data=clv.cdnow, remove.first.transaction=FALSE)


## No formula may be given to specify covariates because currently
## no spending model uses covariates




</code></pre>

<hr>
<h2 id='subset.clv.data'>Subsetting clv.data</h2><span id='topic+subset.clv.data'></span><span id='topic+subset'></span>

<h3>Description</h3>

<p>Returns a subset of the transaction data stored within the given <code>clv.data</code> object which meet conditions.
The given expression are forwarded to the <code>data.table</code> of transactions.
Possible rows to subset and select are <code>Id</code>, <code>Date</code>, and <code>Price</code> (if present).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'clv.data'
subset(x, subset, select, sample = c("full", "estimation", "holdout"), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="subset.clv.data_+3A_x">x</code></td>
<td>
<p><code>clv.data</code> to subset</p>
</td></tr>
<tr><td><code id="subset.clv.data_+3A_subset">subset</code></td>
<td>
<p>logical expression indicating rows to keep</p>
</td></tr>
<tr><td><code id="subset.clv.data_+3A_select">select</code></td>
<td>
<p>expression indicating columns to keep</p>
</td></tr>
<tr><td><code id="subset.clv.data_+3A_sample">sample</code></td>
<td>
<p>Name of sample for which transactions should be extracted,</p>
</td></tr>
<tr><td><code id="subset.clv.data_+3A_...">...</code></td>
<td>
<p>further arguments passed to <code>data.table::subset</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A copy of the <code>data.table</code> of selected transactions. May contain columns <code>Id</code>, <code>Date</code>, and <code>Price</code>.
</p>


<h3>See Also</h3>

<p><code>data.table</code>'s <code><a href="data.table.html#topic+subset">subset</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 # dont test because ncpu=2 limit on cran (too fast)
library(data.table) # for between()
data(cdnow)

clv.cdnow &lt;- clvdata(cdnow,
  date.format="ymd",
  time.unit = "week",
  estimation.split = "1997-09-30")

# all transactions of customer "1"
subset(clv.cdnow, Id=="1")
subset(clv.cdnow, subset = Id=="1")

# all transactions of customer "111" in the estimation period...
subset(clv.cdnow, Id=="111", sample="estimation")
# ... and in the holdout period
subset(clv.cdnow, Id=="111", sample="holdout")

# all transactions of customers "1", "2", and "999"
subset(clv.cdnow, Id %in% c("1","2","999"))

# all transactions on "1997-02-16"
subset(clv.cdnow, Date == "1997-02-16")

# all transactions between "1997-02-01" and "1997-02-16"
subset(clv.cdnow, Date &gt;= "1997-02-01" &amp; Date &lt;= "1997-02-16")
# same using data.table's between
subset(clv.cdnow, between(Date, "1997-02-01","1997-02-16"))

# all transactions with a value between 50 and 100
subset(clv.cdnow, Price &gt;= 50 &amp; Price &lt;= 100)
# same using data.table's between
subset(clv.cdnow, between(Price, 50, 100))

# only keep Id of transactions on "1997-02-16"
subset(clv.cdnow, Date == "1997-02-16", "Id")


</code></pre>

<hr>
<h2 id='summary.clv.data'>Summarizing a CLV data object</h2><span id='topic+summary.clv.data'></span><span id='topic+print.summary.clv.data'></span><span id='topic+summary.clv.data.dynamic.covariates'></span><span id='topic+print.summary.clv.data.dynamic.covariates'></span><span id='topic+summary.clv.data.static.covariates'></span><span id='topic+print.summary.clv.data.static.covariates'></span>

<h3>Description</h3>

<p>Summary method for objects of class <code>clv.data</code> that provides information about the estimation and
possible holdout sample, and descriptive statistics of the transaction data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'clv.data'
summary(object, ids = NULL, ...)

## S3 method for class 'summary.clv.data'
print(x, digits = max(3L, getOption("digits") - 3L), ...)

## S3 method for class 'clv.data.dynamic.covariates'
summary(object, ...)

## S3 method for class 'summary.clv.data.dynamic.covariates'
print(x, digits = max(3L, getOption("digits") - 3L), ...)

## S3 method for class 'clv.data.static.covariates'
summary(object, ...)

## S3 method for class 'summary.clv.data.static.covariates'
print(x, digits = max(3L, getOption("digits") - 3L), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.clv.data_+3A_object">object</code></td>
<td>
<p>A CLV data object containing transactional data and potentially also contextual factors.</p>
</td></tr>
<tr><td><code id="summary.clv.data_+3A_ids">ids</code></td>
<td>
<p>A character vector of customer ids for which the transaction data is summarized. Defaults to
<code>NULL</code> for all customers.</p>
</td></tr>
<tr><td><code id="summary.clv.data_+3A_...">...</code></td>
<td>
<p>Ignored</p>
</td></tr>
<tr><td><code id="summary.clv.data_+3A_x">x</code></td>
<td>
<p>An object of class <code>"summary.clv.data"</code>, usually, a result of a call to <code>summary.clv.data</code>.</p>
</td></tr>
<tr><td><code id="summary.clv.data_+3A_digits">digits</code></td>
<td>
<p>The number of significant digits to use when printing.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If applicable, the summary statistics are provided separately for the estimation and holdout period as well as
for the overall time period (estimation + holdout). By using the <code>ids</code> argument, the summary statistics can
be limited to a subset of customers.
</p>

<dl>
<dt><code>Number of customers</code></dt><dd><p>Count of individual customers.</p>
</dd>
<dt><code>First Transaction in period</code></dt><dd><p>Time point of the first transaction occurring in the indicated period.</p>
</dd>
<dt><code>Last Transaction in period</code></dt><dd><p>Time point of the last transaction occurring in the indicated period.</p>
</dd>
<dt><code>Total # Transactions</code></dt><dd><p>Count of transactions occurring in the indicated period.</p>
</dd>
<dt><code>Mean # Transactions per cust</code></dt><dd><p>Average transactions per customer in the indicated period,
including standard deviation (SD).</p>
</dd>
<dt><code>Mean Spending per Transaction</code></dt><dd><p>Average spending per customer in the indicated period, including
standard deviation (SD). Spending statistics are only available if spending data was provided when creating the object.</p>
</dd>
<dt><code>Total Spending</code></dt><dd><p>Sum of customer spending during the indicated period.</p>
</dd>
<dt><code>Total # zero repeaters</code></dt><dd><p>Number of customers who purchased only once during the estimation period.</p>
</dd>
<dt><code>Percentage of zero repeaters</code></dt><dd><p>Percentage of customers who purchased only once during the estimation period.</p>
</dd>
<dt><code>Mean Interpurchase time</code></dt><dd><p>Average time (in number of periods) between two transactions of the same customer,
including standard deviation (SD).</p>
</dd>
</dl>



<h3>Value</h3>

<p>This function computes and returns summary statistics of the
transactional and covariates data given in <code>object</code>. This is a list of
class <code>summary.clv.data</code> and contains the elements:
</p>
<table role = "presentation">
<tr><td><code>name</code></td>
<td>
<p>Human readable description of the type of data.</p>
</td></tr>
<tr><td><code>summary.clv.time</code></td>
<td>
<p>Summary information about the stored <code>clv.time</code> object.</p>
</td></tr>
<tr><td><code>descriptives.transactions</code></td>
<td>
<p>A <code>data.table</code> with summary statistics of
the transactions overall and in the estimation and holdout sample.</p>
</td></tr>
<tr><td><code>selected.ids</code></td>
<td>
<p>Ids for which the transaction data was summarized. <code>NULL</code> if all Ids were used.</p>
</td></tr>
</table>
<p>For static covariates data, the list additionally is of class <code>summary.clv.data.static.covariates</code>
and further contains the elements:
</p>
<table role = "presentation">
<tr><td><code>names.cov.data.trans</code></td>
<td>
<p>Names of the covariates for the Transaction process.</p>
</td></tr>
<tr><td><code>names.cov.data.life</code></td>
<td>
<p>Names of the covariates for the Lifetime process.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+plot.clv.data">plot</a></code> for how to plot a clv data object
</p>
<p><code><a href="#topic+clvdata">clvdata</a></code> for how to create a clv data object
</p>
<p><code><a href="#topic+SetStaticCovariates">SetStaticCovariates</a></code> for how to add static covariates
</p>
<p><code><a href="#topic+SetDynamicCovariates">SetDynamicCovariates</a></code> for how to add dynamic covariates
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


data("apparelTrans")
clv.data.apparel &lt;- clvdata(apparelTrans, date.format = "ymd",
                            time.unit = "w",
                            estimation.split = 52)

# summary of transaction data and split
summary(clv.data.apparel)

# transaction summary of customer "1219"
summary(clv.data.apparel, ids="1219")

# transaction summary of customers "1", "10", "100", and "1000"
summary(clv.data.apparel, ids=c("1", "10", "100", "1000"))

# add contextual factors
data("apparelStaticCov")
clv.data.apparel.cov &lt;-
 SetStaticCovariates(clv.data.apparel,
                     data.cov.life = apparelStaticCov,
                     names.cov.life = "Gender",
                     data.cov.trans = apparelStaticCov,
                     names.cov.trans = "Gender")

# additional info about the covariates
summary(clv.data.apparel.cov)


</code></pre>

<hr>
<h2 id='summary.clv.fitted'>Summarizing a fitted CLV model</h2><span id='topic+summary.clv.fitted'></span><span id='topic+summary.clv.fitted.transactions.static.cov'></span><span id='topic+print.summary.clv.fitted'></span>

<h3>Description</h3>

<p>Summary method for fitted CLV models that provides statistics about the estimated parameters
and information about the optimization process. If multiple optimization methods were used
(for example if specified in parameter <code>optimx.args</code>), all information here refers to
the last method/row of the resulting <code>optimx</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'clv.fitted'
summary(object, ...)

## S3 method for class 'clv.fitted.transactions.static.cov'
summary(object, ...)

## S3 method for class 'summary.clv.fitted'
print(
  x,
  digits = max(3L, getOption("digits") - 3L),
  signif.stars = getOption("show.signif.stars"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.clv.fitted_+3A_object">object</code></td>
<td>
<p>A fitted CLV model</p>
</td></tr>
<tr><td><code id="summary.clv.fitted_+3A_...">...</code></td>
<td>
<p>Ignored for <code>summary</code>, forwarded to <code>printCoefmat</code> for <code>print</code>.</p>
</td></tr>
<tr><td><code id="summary.clv.fitted_+3A_x">x</code></td>
<td>
<p>an object of class <code>"summary.clv.no.covariates"</code>, usually, a result of a call to <code>summary.clv.no.covariates</code>.</p>
</td></tr>
<tr><td><code id="summary.clv.fitted_+3A_digits">digits</code></td>
<td>
<p>the number of significant digits to use when printing.</p>
</td></tr>
<tr><td><code id="summary.clv.fitted_+3A_signif.stars">signif.stars</code></td>
<td>
<p>logical. If TRUE, &lsquo;significance stars&rsquo; are printed for each coefficient.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>This function computes and returns a list of summary information of the fitted model
given in <code>object</code>. It returns a list of class <code>summary.clv.no.covariates</code> that contains the
following components:
</p>
<table role = "presentation">
<tr><td><code>name.model</code></td>
<td>
<p>the name of the fitted model.</p>
</td></tr>
<tr><td><code>call</code></td>
<td>
<p>The call used to fit the model.</p>
</td></tr>
<tr><td><code>tp.estimation.start</code></td>
<td>
<p>Date or POSIXct indicating when the fitting period started.</p>
</td></tr>
<tr><td><code>tp.estimation.end</code></td>
<td>
<p>Date or POSIXct indicating when the fitting period ended.</p>
</td></tr>
<tr><td><code>estimation.period.in.tu</code></td>
<td>
<p>Length of fitting period in <code>time.unit</code>s.</p>
</td></tr>
<tr><td><code>time.unit</code></td>
<td>
<p>Time unit that defines a single period.</p>
</td></tr>
<tr><td><code>coefficients</code></td>
<td>
<p>a <code>px4</code> matrix with columns for the estimated coefficients, its standard error,
the t-statistic and corresponding (two-sided) p-value.</p>
</td></tr>
<tr><td><code>estimated.LL</code></td>
<td>
<p>the value of the log-likelihood function at the found solution.</p>
</td></tr>
<tr><td><code>AIC</code></td>
<td>
<p>Akaike's An Information Criterion for the fitted model.</p>
</td></tr>
<tr><td><code>BIC</code></td>
<td>
<p>Schwarz' Bayesian Information Criterion for the fitted model.</p>
</td></tr>
<tr><td><code>KKT1</code></td>
<td>
<p>Karush-Kuhn-Tucker optimality conditions of the first order, as returned by optimx.</p>
</td></tr>
<tr><td><code>KKT2</code></td>
<td>
<p>Karush-Kuhn-Tucker optimality conditions of the second order, as returned by optimx.</p>
</td></tr>
<tr><td><code>fevals</code></td>
<td>
<p>The number of calls to the log-likelihood function during optimization.</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p>The last method used to obtain the final solution.</p>
</td></tr>
<tr><td><code>additional.options</code></td>
<td>
<p>A list of additional options used for model fitting.
</p>

<dl>
<dt>Correlation</dt><dd><p>Whether the correlation between the purchase and the attrition process was estimated.</p>
</dd>
<dt>estimated.param.cor</dt><dd><p>Correlation coefficient measuring the correlation between the two processes, if used.</p>
</dd></dl>
</td></tr>
</table>
<p>For models fits with static covariates, the list additionally is of class <code>summary.clv.static.covariates</code>
and the list in <code>additional.options</code> contains the following elements:
</p>
<table role = "presentation">
<tr><td><code>additional.options</code></td>
<td>


<dl>
<dt>Regularization</dt><dd><p>Whether L2 regularization for parameters of contextual factors was used.</p>
</dd>
<dt>lambda.life</dt><dd><p>The regularization lambda used for the parameters of the Lifetime process, if used.</p>
</dd>
<dt>lambda.trans</dt><dd><p>The regularization lambda used for the parameters of the Transaction process, if used.</p>
</dd>
<dt>Constraint covs</dt><dd><p>Whether any covariate parameters were forced to be the same for both processes.</p>
</dd>
<dt>Constraint params</dt><dd><p>Name of the covariate parameters which were constraint, if used.</p>
</dd></dl>
</td></tr>
</table>


<h3>See Also</h3>

<p>The model fitting functions <code><a href="#topic+pnbd">pnbd</a></code>.
</p>
<p>Function <code>coef</code> will extract the <code>coefficients</code> matrix including summary statistics and
function <code>vcov</code> will extract the <code>vcov</code> from the returned summary object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

data("apparelTrans")

# Fit pnbd standard model, no covariates
clv.data.apparel &lt;- clvdata(apparelTrans, time.unit="w",
                                estimation.split=52, date.format="ymd")
pnbd.apparel &lt;- pnbd(clv.data.apparel)

# summary about model fit
summary(pnbd.apparel)

# Add static covariate data
data("apparelStaticCov")
data.apparel.cov  &lt;-
   SetStaticCovariates(clv.data.apparel,
                       data.cov.life  = apparelStaticCov,
                       names.cov.life = "Gender",
                       data.cov.trans = apparelStaticCov,
                       names.cov.trans = "Gender",
                       name.id = "Id")

# fit model with covariates and regualization
pnbd.apparel.cov &lt;- pnbd(data.apparel.cov,
                         reg.lambdas = c(life=2, trans=4))

# additional summary about covariate parameters
#   and used regularization
summary(pnbd.apparel.cov)



</code></pre>

<hr>
<h2 id='vcov.clv.fitted'>Calculate Variance-Covariance Matrix for CLV Models fitted with Maximum Likelihood Estimation</h2><span id='topic+vcov.clv.fitted'></span>

<h3>Description</h3>

<p>Returns the variance-covariance matrix of the parameters of the fitted model object.
The variance-covariance matrix is derived from the Hessian that results from the optimization procedure.
First, the Moore-Penrose generalized inverse of the Hessian is used to obtain an estimate of the
variance-covariance matrix.
Next, because some parameters may be transformed for the purpose of restricting their value during
the log-likelihood estimation, the variance estimates are adapted to
be comparable to the reported coefficient estimates.
If the result is not positive definite, <a href="Matrix.html#topic+nearPD">Matrix::nearPD</a> is used
with standard settings to find the nearest positive definite matrix.
</p>
<p>If multiple estimation methods were used, the Hessian of the last method is used.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'clv.fitted'
vcov(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vcov.clv.fitted_+3A_object">object</code></td>
<td>
<p>a fitted clv model object</p>
</td></tr>
<tr><td><code id="vcov.clv.fitted_+3A_...">...</code></td>
<td>
<p>Ignored</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix of the estimated covariances between the parameters of the model.
The row and column names correspond to the parameter names given by the <code>coef</code> method.
</p>


<h3>See Also</h3>

<p><a href="MASS.html#topic+ginv">MASS::ginv</a>, <a href="Matrix.html#topic+nearPD">Matrix::nearPD</a>
</p>

<hr>
<h2 id='vec_gsl_hyp2f0_e'>GSL Hypergeometric 2F0 for equal length vectors</h2><span id='topic+vec_gsl_hyp2f0_e'></span>

<h3>Description</h3>

<p>Calculate the hypergeometric 2f0 using the GSL library (gsl_sf_hyperg_2F0_e)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vec_gsl_hyp2f0_e(vA, vB, vZ)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vec_gsl_hyp2f0_e_+3A_va">vA</code></td>
<td>
<p>Vector of values for parameter a</p>
</td></tr>
<tr><td><code id="vec_gsl_hyp2f0_e_+3A_vb">vB</code></td>
<td>
<p>Vector of values for parameter b</p>
</td></tr>
<tr><td><code id="vec_gsl_hyp2f0_e_+3A_vz">vZ</code></td>
<td>
<p>Vector of values for parameter z</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List with vector of values and vector of gsl status codes
</p>

<hr>
<h2 id='vec_gsl_hyp2f1_e'>GSL Hypergeometric 2F1 for equal length vectors</h2><span id='topic+vec_gsl_hyp2f1_e'></span>

<h3>Description</h3>

<p>Calculate the hypergeometric 2f1 using the GSL library (gsl_sf_hyperg_2F1_e)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vec_gsl_hyp2f1_e(vA, vB, vC, vZ)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vec_gsl_hyp2f1_e_+3A_va">vA</code></td>
<td>
<p>Vector of values for parameter a</p>
</td></tr>
<tr><td><code id="vec_gsl_hyp2f1_e_+3A_vb">vB</code></td>
<td>
<p>Vector of values for parameter b</p>
</td></tr>
<tr><td><code id="vec_gsl_hyp2f1_e_+3A_vc">vC</code></td>
<td>
<p>Vector of values for parameter c</p>
</td></tr>
<tr><td><code id="vec_gsl_hyp2f1_e_+3A_vz">vZ</code></td>
<td>
<p>Vector of values for parameter z</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List with vector of values and vector of gsl status codes
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
