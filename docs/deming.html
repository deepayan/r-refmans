<!DOCTYPE html><html lang="en"><head><title>Help for package deming</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {deming}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#arsenate'><p>Comparison of two assays for arsenate.</p></a></li>
<li><a href='#deming'><p>Fit a generalized Deming regression</p></a></li>
<li><a href='#ferritin'><p>Validation of a ferritin assay</p></a></li>
<li><a href='#pbreg'><p>Passing-Bablock regressin</p></a></li>
<li><a href='#theilsen'><p>Theil-Sen regression</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Deming, Theil-Sen, Passing-Bablock and Total Least Squares
Regression</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Terry Therneau &lt;therneau.terry@mayo.edu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Generalized Deming regression, Theil-Sen regression and Passing-Bablock regression functions.</td>
</tr>
<tr>
<td>Imports:</td>
<td>boot</td>
</tr>
<tr>
<td>Priority:</td>
<td>optional</td>
</tr>
<tr>
<td>Version:</td>
<td>1.4-1</td>
</tr>
<tr>
<td>LazyData:</td>
<td>Yes</td>
</tr>
<tr>
<td>Author:</td>
<td>Terry Therneau</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/LGPL-2">LGPL-2</a> | <a href="https://www.r-project.org/Licenses/LGPL-2.1">LGPL-2.1</a> | <a href="https://www.r-project.org/Licenses/LGPL-3">LGPL-3</a> [expanded from: LGPL (&ge; 2)]</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-06-26 14:22:29 UTC; therneau</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-06-26 15:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='arsenate'>Comparison of two assays for arsenate.</h2><span id='topic+arsenate'></span>

<h3>Description</h3>

<p>Arsenate(V) ion in natural river waters, as determined
by two assay methods.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(arsenate)</code></pre>


<h3>Format</h3>

<p>A data frame with 30 observations on the following 4 variables.
</p>

<dl>
<dt><code>aas</code></dt><dd><p>micrograms/liter, by continuous selective reduction and
atomic absorbtion spectectromitry</p>
</dd>
<dt><code>se.aas</code></dt><dd><p>estimated standard error of the result</p>
</dd>
<dt><code>aes</code></dt><dd><p>micrograms/liter, by non-selective reduction, 
cold trapping, and atomic emission spectroscopy</p>
</dd>
<dt><code>se.aes</code></dt><dd><p>estimated standard error of the result</p>
</dd>
</dl>



<h3>Source</h3>

 
<p>The data is found in BD Ripley and M Thompson, Regression techniques 
for the detection of analytical bias, Analyst 112:377-383, 1987.
</p>

<hr>
<h2 id='deming'>Fit a generalized Deming regression</h2><span id='topic+deming'></span>

<h3>Description</h3>

<p>Find the MLE line relating x and y when both are measured with
error.  When the variances of x and y are constant and equal, this is the
special case of Deming regression.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>deming(formula, data, subset, weights, na.action, cv=FALSE,
       xstd, ystd, stdpat, conf=.95, jackknife=TRUE, dfbeta=FALSE,
       id, x=FALSE, y=FALSE, model=TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="deming_+3A_formula">formula</code></td>
<td>
<p>a model formula with a single continuous response on the left
and a single continuous predictor on the right.</p>
</td></tr>
<tr><td><code id="deming_+3A_data">data</code></td>
<td>

<p>an optional data frame, list or environment containing the variables in the model.
</p>
</td></tr>
<tr><td><code id="deming_+3A_subset">subset</code></td>
<td>
<p>an optional vector specifying a subset of observations to be 
used in the fitting process.</p>
</td></tr>
<tr><td><code id="deming_+3A_weights">weights</code></td>
<td>
<p>an optional vector of weights to be used in the fitting process. 
Should be NULL or a numeric vector.</p>
</td></tr></table>
<p> I
</p>
<table role = "presentation">
<tr><td><code id="deming_+3A_na.action">na.action</code></td>
<td>
<p>a function which indicates what should happen when the data 
contain NAs. The default is set by the na.action setting of <code>options</code>.
The 'factory fresh' default is <code>na.omit</code>, the <code>na.exclude</code> option
is often useful.</p>
</td></tr>
<tr><td><code id="deming_+3A_xstd">xstd</code></td>
<td>
<p>optional, the variable name of a vector that contains explicit
error values for each of the predictor values. This data overrides
the <code>cv</code> option if both are present.</p>
</td></tr>
<tr><td><code id="deming_+3A_ystd">ystd</code></td>
<td>
<p>optional, the variable name of a vector that contains explicit
error values for each of the response values. This data overrides
the <code>cv</code> option if both are present.</p>
</td></tr>
<tr><td><code id="deming_+3A_cv">cv</code></td>
<td>
<p>constant coefficient of variation?  The default of
false corresponds to ordinary Deming regression, i.e., an assumption
of constant error.  A value of <code>cv=TRUE</code> corresponds to the
assumption of constant coefficient of variation. </p>
</td></tr>
<tr><td><code id="deming_+3A_stdpat">stdpat</code></td>
<td>
<p>pattern for the standard deviation, see comments below.
If this is missing the default is based on the <code>cv</code> option.</p>
</td></tr>
<tr><td><code id="deming_+3A_conf">conf</code></td>
<td>
<p>confidence level for the confidence interval</p>
</td></tr>
<tr><td><code id="deming_+3A_jackknife">jackknife</code></td>
<td>
<p>compute a jackknife estimate of variance.</p>
</td></tr>
<tr><td><code id="deming_+3A_dfbeta">dfbeta</code></td>
<td>
<p>return the dfbeta matrix from the jackknife
computation.</p>
</td></tr>
<tr><td><code id="deming_+3A_id">id</code></td>
<td>
<p>grouping values for the grouped jackknife</p>
</td></tr>
<tr><td><code id="deming_+3A_x">x</code>, <code id="deming_+3A_y">y</code>, <code id="deming_+3A_model">model</code></td>
<td>
<p>logicals. If TRUE the corresponding components of the fit 
(the model frame, the model matrix, or the response) is returned.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Ordinary least squares regression minimizes the sum of distances between
the y values and the regression line, Deming regression minimizes the
sum of distances in both the x and y direction.
As such it is often appropriate when both x and y are measured with
error.  A common use is in comparing two assays, each of which is designed
to quantify the same compound.
</p>
<p>The standard deviation of the x variate variate will often be of the form
<code class="reqn">\sigma(c + dx)</code> for c and d some constants,
where <code class="reqn">\sigma</code> is the overal scale factor; similarly for y with
constants e and f.
Ordinary Deming regression corresponds to c=1 and d=0, i.e., constant
variation over the range of the data.
A more realistic assumption for many laboratory measurments is c=0 and
d=1, i.e., constant coefficient of variation.
Laboratory tests are often assumed to have constant coefficient of
variation rather than constant variance.
</p>
<p>There are 3 ways to specify the variation.  The first is to directly
set the pattern of (c,d,e,f) for the $x$ and $y$ standard deviations.
If this is omitted, a default of (0,1,0,1) or (1,0,1,0) is chosen, based
on whether the <code>cv</code> option is TRUE or FALSE, respectively.
As a third option, the user can specifiy <code>xstd</code> and <code>ystd</code>
directly as vectors of data values.  In this last case any values for
the <code>stdpat</code> or <code>ccs</code> options are ignored.
Note that the two calls <code>deming(y ~ x, cv=TRUE)</code> and
<code>deming(y ~ x, xstd=x, ystd=y)</code> are subtly different.  In the second
the standard deviation values are based on the data, and in the first
they will be based on the fitted values.  The two outcomes will often be
nearly identical.
</p>
<p>Although a <code>cv</code> option of TRUE is often much better
justified than an assumption of constant variance,
assumpting a perfectly constant CV can also be questionable.
Most actual biologic assays will have both a constant and a
proportional component of error, with the former becoming dominant for values
near zero and the latter dominant elsewhere.
If all of the results are far from zero, however, the constant part may
be ignored.
</p>
<p>Many times an assay will be done in duplicate, in which case the paired
results can have correlated errors due to sample handling or
manipulation that preceeds splitting it into separate aliquots for
assay, and the ordinary variance will be too small (as it also is when
the duplicate values are averaged together before fitting the regression
line.)  A correct grouped jackknife estimate of variance is obtained in
this case by setting <code>id</code> to a vector of sample identifiers.
</p>


<h3>Value</h3>

<p>a object of class 'deming' containing the components:
</p>
<table role = "presentation">
<tr><td><code>coefficient</code></td>
<td>
<p>the coefficient vector, containing the intercept and 
slope.</p>
</td></tr>
<tr><td><code>variance</code></td>
<td>
<p>The jackknife or bootstrap estimate of variance</p>
</td></tr>
<tr><td><code>ci</code></td>
<td>
<p>bootstrap confidence intervals, if nboot &gt;0</p>
</td></tr>
<tr><td><code>dfbeta</code></td>
<td>
<p>pptionally, the dfbeta residuals.  A 2 column matrix,
each row is the change in the coefficient vector if that observation is
removed from the data.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Terry Therneau</p>


<h3>References</h3>

<p>BD Ripley and M Thompson, Regression techniques for the detection
of analytical bias, Analyst 112:377-383, 1987.
</p>
<p>K Linnet, Estimation of the linear relationship between the
measurements of two methods with proportional errors.  
Statistics in Medicine 9:1463-1473, 1990.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Data from Ripley and Thompson
fit &lt;- deming(aes ~ aas, data=arsenate, xstd=se.aas, ystd=se.aes)
print(fit)
## Not run: 
            Coef se(coef) lower 0.95 upper 0.95
Intercept 0.1064   0.2477    -0.3790     0.5919
Slope     0.9730   0.1430     0.6928     1.2532

   Scale= 1.358 

## End(Not run)
plot(1:30, fit$dfbeta[,2]) #subject 22 has a large effect on the slope

# Constant proportional error fit (constant CV)
fit2 &lt;- deming(new.lot ~ old.lot, ferritin, cv=TRUE,
                subset=(period==3))
</code></pre>

<hr>
<h2 id='ferritin'>Validation of a ferritin assay</h2><span id='topic+ferritin'></span><span id='topic+ferritin2'></span>

<h3>Description</h3>

<p>For each of seven periods in which there was a new
batch of reagent, a small set of patient samples was assayed for ferritin
content using both the old and new batches.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(ferritin)</code></pre>


<h3>Format</h3>

<p>A data frame with 162 observations on the following 4 variables.
</p>

<dl>
<dt><code>sample</code></dt><dd><p>sample identifier</p>
</dd>
<dt><code>period</code></dt><dd><p>the transition number, 1 to 7</p>
</dd>
<dt><code>old.lot</code></dt><dd><p>assay result using the old lot of the reagent</p>
</dd>
<dt><code>new.lot</code></dt><dd><p>assay result using the new lot</p>
</dd>
</dl>



<h3>Details</h3>

<p>The samples from each period are distinct.  
In the second data set <code>ferritin2</code> outliers have been
added to the data for period 2, excess noise added to one lot in
period 4, and deterministic laboratory error to period 6.
</p>


<h3>Source</h3>

<p>Blinded data from a clinical laboratory.</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(ferritin)
temp &lt;- ferritin[ferritin$period &lt;4,]
plot(temp$old.lot, temp$new.lot, type='n', log='xy',
     xlab="Old lot", ylab="New Lot")
text(temp$old.lot, temp$new.lot, temp$period,
         col=temp$period)
</code></pre>

<hr>
<h2 id='pbreg'>Passing-Bablock regressin</h2><span id='topic+pbreg'></span>

<h3>Description</h3>

<p>Passing-Bablock regression is a robust regression method for two variables
that is symmetric in x and y.</p>


<h3>Usage</h3>

<pre><code class='language-R'>pbreg(formula, data, subset, weights, na.action, conf=.95,
     nboot = 0, method=1, eps=sqrt(.Machine$double.eps),
     x = FALSE, y = FALSE, model = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pbreg_+3A_formula">formula</code></td>
<td>
<p>a model formula with a single continuous response on the left
and a single continuous predictor on the right.</p>
</td></tr>
<tr><td><code id="pbreg_+3A_data">data</code></td>
<td>

<p>an optional data frame, list or environment containing the variables in the model.
</p>
</td></tr>
<tr><td><code id="pbreg_+3A_subset">subset</code></td>
<td>
<p>an optional vector specifying a subset of observations to be 
used in the fitting process.</p>
</td></tr>
<tr><td><code id="pbreg_+3A_weights">weights</code></td>
<td>
<p>an optional vector of weights to be used in the fitting process. 
Should be NULL or a numeric vector.</p>
</td></tr></table>
<p> I
</p>
<table role = "presentation">
<tr><td><code id="pbreg_+3A_na.action">na.action</code></td>
<td>
<p>a function which indicates what should happen when the data 
contain NAs. The default is set by the na.action setting of <code>options</code>.
The 'factory fresh' default for R is <code>na.omit</code>, the
<code>na.exclude</code> option is often useful.</p>
</td></tr>
<tr><td><code id="pbreg_+3A_conf">conf</code></td>
<td>
<p>the width of the computed confidence limit</p>
</td></tr>
<tr><td><code id="pbreg_+3A_nboot">nboot</code></td>
<td>
<p>number of bootstrap samples used to compute standard
errors and/or confidence limits.</p>
</td></tr>
<tr><td><code id="pbreg_+3A_method">method</code></td>
<td>
<p>which of 3 related methods to use for the computation</p>
</td></tr>
<tr><td><code id="pbreg_+3A_eps">eps</code></td>
<td>
<p>the tolerance used to detect tied values in x and y</p>
</td></tr>
<tr><td><code id="pbreg_+3A_x">x</code>, <code id="pbreg_+3A_y">y</code>, <code id="pbreg_+3A_model">model</code></td>
<td>
<p>logicals. If TRUE the corresponding components of the fit 
(the model frame, the model matrix, or the response) is returned.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>There are 3 related estimators under this heading. 
Method 1 is the original Passing-Bablock (1983) method, which is equal
to a Theil-Sen estimate symmetric about the y=x line.  Method 2 is
the first extended method of the 1988 paper, designed to be scale invariant.
Method 3 is the second extended method from
the 1985 paper, the &quot;scissors&quot; estimate which is symmetric about both
the x and y axes, and is also scale invariant.
</p>
<p>The default confidence interval estimate is based on that derived by
Sen, which is in turn based on the relationship to Kendall's tau.
A theoretical justification of this approach for methods 2 and 3 is
lacking, and we recommend a bootstrap based confidence interval based
on 500-1000 replications.
</p>


<h3>Value</h3>

<p>pbreg returns an object of <code>class</code> &quot;pbreg&quot;.
The generic accessor functions
<code>coef</code>, <code>fitted</code> and <code>residuals</code>
extract the relevant components.
</p>


<h3>Author(s)</h3>

<p>Terry Therneau</p>


<h3>References</h3>

<p>Passing, H. and Bablock, W. (1983).
A new biometrical procedure for testing the equality of measurements 
from two different analytical methods. Application of linear 
regression procedures for method comparison studies in Clinical Chemistry, 
Part I. J. Clin. Chem. Clin. Biochem. 21:709-720.
</p>
<p>Passing, H.  and Bablock, W. (1984).
Comparison of several regression procedures for method comparison
studies and determination of sample size. Application of linear 
regression procedures for method comparison studies in Clinical Chemistry, 
Part II. J. Clin. Chem. Clin. Biochem. 22:431-435.
</p>
<p>Bablock, W., Passing, H., Bender, R. and 
Schneider, B. (1988).
A general regression procedure for method transformations.
Application of linear 
regression procedures for method comparison studies in Clinical Chemistry, 
Part III. J. Clin. Chem. Clin. Biochem. 26:783-790.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+deming">deming</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>afit1 &lt;- pbreg(aes ~ aas, data= arsenate)
afit2 &lt;- pbreg(aas ~ aes, data= arsenate)
rbind(coef(afit1), coef(afit2))  # symmetric results
1/coef(afit1)[2]
</code></pre>

<hr>
<h2 id='theilsen'>Theil-Sen regression</h2><span id='topic+theilsen'></span>

<h3>Description</h3>

<p>Thiel-Sen regression is a robust regression method for two variables.
The symmetric option gives a variant that is symmentric in x and y.</p>


<h3>Usage</h3>

<pre><code class='language-R'>theilsen(formula, data, subset, weights, na.action, conf=.95,
     nboot = 0, symmetric=FALSE, eps=sqrt(.Machine$double.eps),
     x = FALSE, y = FALSE, model = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="theilsen_+3A_formula">formula</code></td>
<td>
<p>a model formula with a single continuous response on the left
and a single continuous predictor on the right.</p>
</td></tr>
<tr><td><code id="theilsen_+3A_data">data</code></td>
<td>

<p>an optional data frame, list or environment containing the variables
in the model.
</p>
</td></tr>
<tr><td><code id="theilsen_+3A_subset">subset</code></td>
<td>
<p>an optional vector specifying a subset of observations to be 
used in the fitting process.</p>
</td></tr>
<tr><td><code id="theilsen_+3A_weights">weights</code></td>
<td>
<p>an optional vector of weights to be used in the
fitting process.</p>
</td></tr>
<tr><td><code id="theilsen_+3A_na.action">na.action</code></td>
<td>
<p>a function which indicates what should happen when the data 
contain NAs. The default is set by the na.action setting of <code>options</code>.</p>
</td></tr>
<tr><td><code id="theilsen_+3A_conf">conf</code></td>
<td>
<p>the width of the computed confidence limit.</p>
</td></tr> 
<tr><td><code id="theilsen_+3A_nboot">nboot</code></td>
<td>
<p>number of bootstrap samples used to compute standard
errors and/or confidence limits.  If this is 0 or missing then an
asypmtotic formula is used.</p>
</td></tr>
<tr><td><code id="theilsen_+3A_symmetric">symmetric</code></td>
<td>
<p>compute an estimate whose slope is symmetric in x
and y.</p>
</td></tr>
<tr><td><code id="theilsen_+3A_eps">eps</code></td>
<td>
<p>the tolerance used to detect tied values in x and y</p>
</td></tr>
<tr><td><code id="theilsen_+3A_x">x</code>, <code id="theilsen_+3A_y">y</code>, <code id="theilsen_+3A_model">model</code></td>
<td>
<p>logicals. If TRUE the corresponding components of the fit 
(the model frame, the model matrix, or the response) is returned.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>One way to characterize the slope of an ordinary least squares line
is that <code class="reqn">\rho(x, r)</code> =0, where where <code class="reqn">\rho</code> is the
correlation coefficient and r is the vector of residuals from the
fitted line.
Thiel-Sen regression replaces <code class="reqn">\rho</code> with Kendall's
<code class="reqn">\tau</code>, a non-parametric alternative.
It it resistant to outliers while retaining good statistical
efficiency.
</p>
<p>The symmetric form of the estimate is based on solving the inverse
equation: find that rotation of the original data such that
<code class="reqn">\tau(x,y)=0</code> for the rotated data.
(In a similar fashion,the rotation such the least squares slope is zero yields
Deming regression.)
In this case it is possible to have multiple solutions, i.e., slopes
that yeild a 0 correlation, although this is rare unless the deviations
from the fitted line are large.
</p>
<p>The default confidence interval estimate is based on the result of
Sen, which is in turn based on the relationship to Kendall's tau and
is essentially an inversion of the confidence interval for tau.
The argument does not extend to the symmetric case, for which we
recommend using a bootstrap confidence interval based on
500-1000 replications.
</p>


<h3>Value</h3>

<p>theilsen returns an object of <code>class</code> &quot;theilsen&quot; with components
</p>
<table role = "presentation">
<tr><td><code>coefficients</code></td>
<td>
<p>the intercept and slope</p>
</td></tr>
<tr><td><code>residuals</code></td>
<td>
<p>residuals from the fitted line</p>
</td></tr>
<tr><td><code>angle</code></td>
<td>
<p>if the symmetric option is chosen, this contains all of the
solutions for the angle of the regression line</p>
</td></tr>
<tr><td><code>n</code></td>
<td>
<p>number of data points</p>
</td></tr>
<tr><td><code>model</code>, <code>x</code>, <code>y</code></td>
<td>
<p>optional componets as specified by the x, y, and
model arguments</p>
</td></tr>
<tr><td><code>terms</code></td>
<td>
<p>the terms object corresponding to the formula</p>
</td></tr>
<tr><td><code>na.action</code></td>
<td>
<p>na.action information, if applicable</p>
</td></tr>
<tr><td><code>call</code></td>
<td>
<p>a copy of the call to the function</p>
</td></tr>
</table>
<p>The generic accessor functions
<code>coef</code>, <code>residuals</code>, and <code>terms</code>
extract the relevant components.
</p>


<h3>Author(s)</h3>

<p>Terry Therneau</p>


<h3>References</h3>

<p>Thiel, H. (1950), 
A rank-invariant method of linear and polynomial regression analysis. 
I, II, III, Nederl. Akad. Wetensch., Proc. 53: 386-392, 521-525, 1397-1412.
</p>
<p>Sen, P.B. (1968), 
Estimates of the regression coefficient based on Kendall's tau,
Journal of the American Statistical Association 63: 1379-1389. 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+deming">deming</a></code>, <code><a href="#topic+pbreg">pbreg</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>afit1 &lt;- theilsen(aes ~ aas, symmetric=TRUE, data= arsenate)
afit2 &lt;- theilsen(aas ~ aes, symmetric=TRUE, data= arsenate)
rbind(coef(afit1), coef(afit2))  # symmetric results
1/coef(afit1)[2]
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
