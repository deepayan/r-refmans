<!DOCTYPE html><html lang="en"><head><title>Help for package scopr</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {scopr}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#experiment_info'><p>Retrieve information about an experiment</p></a></li>
<li><a href='#link_ethoscope_metadata_remote'><p>Link ethoscope metadata to the matching result files</p></a></li>
<li><a href='#list_result_files'><p>List all available result files</p></a></li>
<li><a href='#load_ethoscope'><p>Load data from ethoscope result files</p></a></li>
<li><a href='#no_region_id_metadata'><p>Simple toy metadata defining three experiments, with one condition (<code>test</code>) per experiment.</p>
Implicitly, 20 individuals are in each experiment
It serves as a simple example.</a></li>
<li><a href='#region_id_metadata'><p>Simple toy metadata experimental conditions for 15 individuals in three experiments.</p>
the condition (<code>test</code>) is linked to the experiments, and another condition (<code>treatment</code>) is per individual.
It serves as a simple example.
#'</a></li>
<li><a href='#scopr_example'><p>Get path to scopr example</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Read Ethoscope Data</td>
</tr>
<tr>
<td>Date:</td>
<td>2025-01-17</td>
</tr>
<tr>
<td>Version:</td>
<td>0.3.5</td>
</tr>
<tr>
<td>Description:</td>
<td>Handling of behavioural data from the Ethoscope platform 
    (Geissmann, Garcia Rodriguez, Beckwith, French, Jamasb and Gilestro (2017) &lt;<a href="https://doi.org/10.1371%2Fjournal.pbio.2003026">doi:10.1371/journal.pbio.2003026</a>&gt;).
    Ethoscopes (<a href="https://giorgiogilestro.notion.site/Ethoscope-User-Manual-a9739373ae9f4840aa45b277f2f0e3a7">https://giorgiogilestro.notion.site/Ethoscope-User-Manual-a9739373ae9f4840aa45b277f2f0e3a7</a>) are an open source/open hardware framework made of 
    interconnected raspberry pis (<a href="https://www.raspberrypi.org">https://www.raspberrypi.org</a>) designed to quantify the behaviour of multiple 
    small animals in a distributed and real-time fashion. The default tracking algorithm records primary variables
    such as xy coordinates, dimensions and speed.
    This package is part of the rethomics framework <a href="https://rethomics.github.io/">https://rethomics.github.io/</a>.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.00), behavr</td>
</tr>
<tr>
<td>Imports:</td>
<td>data.table, readr, stringr, RSQLite, memoise</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat, covr, knitr, ggetho, zeitgebr</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/rethomics/scopr">https://github.com/rethomics/scopr</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/rethomics/scopr/issues">https://github.com/rethomics/scopr/issues</a></td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-01-28 13:07:16 UTC; quentin</td>
</tr>
<tr>
<td>Author:</td>
<td>Quentin Geissmann [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Quentin Geissmann &lt;qgeissmann@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-01-28 13:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='experiment_info'>Retrieve information about an experiment</h2><span id='topic+experiment_info'></span>

<h3>Description</h3>

<p>This function is used to obtain experimental information &ndash; such as <em>time and date</em> of the experiment,
<em>acquisition device</em>, and <em>version of the software</em> &ndash;
embedded in a result file (<code>.db</code>) generated by the ethoscope platform.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>experiment_info(FILE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="experiment_info_+3A_file">FILE</code></td>
<td>
<p>the name of the input file</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list containing fields for metadata entries
</p>


<h3>See Also</h3>


<ul>
<li> <p><a href="#topic+load_ethoscope">load_ethoscope</a> &ndash; to load the actual data
</p>
</li>
<li> <p><a href="#topic+list_result_files">list_result_files</a> &ndash; to list available files
</p>
</li></ul>


<hr>
<h2 id='link_ethoscope_metadata_remote'>Link ethoscope metadata to the matching result files</h2><span id='topic+link_ethoscope_metadata_remote'></span><span id='topic+link_ethoscope_metadata'></span>

<h3>Description</h3>

<p>These functions augment metadata so it can be subsequently loaded (with <a href="#topic+load_ethoscope">load_ethoscope</a>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>link_ethoscope_metadata_remote(
  x,
  remote_dir,
  result_dir,
  index_file = "index.txt",
  overwrite_local = FALSE,
  verbose = TRUE
)

link_ethoscope_metadata(x, result_dir = NULL, index_file = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="link_ethoscope_metadata_remote_+3A_x">x</code></td>
<td>
<p>object such as a <a href="base.html#topic+data.frame">data.frame</a>, or the name of a file (see detail)</p>
</td></tr>
<tr><td><code id="link_ethoscope_metadata_remote_+3A_remote_dir">remote_dir</code></td>
<td>
<p>the url of the result directory on the data server</p>
</td></tr>
<tr><td><code id="link_ethoscope_metadata_remote_+3A_result_dir">result_dir</code></td>
<td>
<p>the directory where all data are saved</p>
</td></tr>
<tr><td><code id="link_ethoscope_metadata_remote_+3A_index_file">index_file</code></td>
<td>
<p>the name of an index_file, in <code>result_dir</code> (useful for loading remote data).</p>
</td></tr>
<tr><td><code id="link_ethoscope_metadata_remote_+3A_overwrite_local">overwrite_local</code></td>
<td>
<p>whether to download all files.
The default, <code>FALSE</code>, is to only fetch files if they are newer on the remote.</p>
</td></tr>
<tr><td><code id="link_ethoscope_metadata_remote_+3A_verbose">verbose</code></td>
<td>
<p>whether to print progress (a logical)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>These function will augment metadata from two different types of inputs (<code>x</code>):
</p>

<ol>
<li><p> A <a href="base.html#topic+data.frame">data.frame</a> (recomended)
In this case, the function will try to match requested data with data available on <code>result_dir</code>.
The provided <a href="data.table.html#topic+data.table">data.table::data.table</a> has typically one row per requested individual and the columns
(not necessarily in this order):
</p>

<ul>
<li> <p><code>machine_name</code> &ndash; the name of the machine in which the individual was (e.g. <code>"ETHOSCOPE_001"</code>)
</p>
</li>
<li> <p><code>date</code> &ndash; the start date of the experiment formatted as <code>"YYYY-MM-DD"</code>
</p>
</li>
<li> <p><code>region_id</code> &ndash; the ROI in which the animal was. When <em>not provided, all regions are queried</em>.
</p>
</li>
<li> <p><code>time</code> &ndash; the start time of the experiment formatted as &quot;HH:MM:SS&quot;.
When <em>not provided</em>, and multiple experiment for the same machine exist, <em>only the last one is loaded</em>.
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;???&#8288;</code> &ndash; any number of arbitrary columns* to associate <code>conditions</code>/<code>treatments</code>/<code>genotypes</code>/... to the previous columns.
</p>
</li></ul>

</li>
<li><p> The name of a CSV file that contains a table as described in <code>1</code>.
</p>
</li>
<li><p> A vector of <code>.db</code> files to be read.
</p>
</li></ol>



<h3>Value</h3>

<p>a <a href="data.table.html#topic+data.table">data.table::data.table</a> with the same rows as x, and extra columns for further data loading
</p>


<h3>References</h3>


<ul>
<li> <p><a href="https://rethomics.github.io/metadata.html">metadata tutorial</a> &ndash; how to work with metadata
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><a href="#topic+load_ethoscope">load_ethoscope</a> &ndash; to load the actual data
</p>
</li>
<li> <p><a href="#topic+list_result_files">list_result_files</a> &ndash; to list available file
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Metadata with no region_id -&gt; all regions will be loaded with the same metadata
dir &lt;- paste0(scopr_example_dir(), "/ethoscope_results/")
data(no_region_id_metadata)
metadata &lt;- link_ethoscope_metadata(no_region_id_metadata, dir)
print(metadata)

# Metadata with region_id -&gt;  only stated regions will be loaded with specific metadata
data(region_id_metadata)
metadata &lt;- link_ethoscope_metadata(region_id_metadata, dir)
print(metadata)

## Not run: 
# If your files are stored on a remote server,
# this will download to a local directory only the needed files
REMOTE &lt;- "ftp://a/remote/server/"
LOCAL_DIR &lt;- "/where/I/store/the/data/"
metadata &lt;- link_ethoscope_metadata_remote(region_id_metadata,
                                           REMOTE,
                                           LOCAL_DIR)


## End(Not run)
</code></pre>

<hr>
<h2 id='list_result_files'>List all available result files</h2><span id='topic+list_result_files'></span>

<h3>Description</h3>

<p>This function discovers all ethoscope result files and put them in a <a href="data.table.html#topic+data.table">data.table::data.table</a>.
This is useful to figure out when and which experiments were performed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>list_result_files(result_dir, index_file = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="list_result_files_+3A_result_dir">result_dir</code></td>
<td>
<p>the root directory where all data are saved, or the path to a remote directory.</p>
</td></tr>
<tr><td><code id="list_result_files_+3A_index_file">index_file</code></td>
<td>
<p>the name of an index_file, in <code>result_dir</code> (needed for loading remote data).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <a href="data.table.html#topic+data.table">data.table::data.table</a>.
Each row is a single experimental file, and columns describe details such as its <code>path</code>, start <code>date</code> and <code>time</code>,
and the name and id of the ethoscope used.
</p>


<h3>See Also</h3>


<ul>
<li> <p><a href="#topic+load_ethoscope">load_ethoscope</a> &ndash; to load the actual data
</p>
</li>
<li> <p><a href="#topic+experiment_info">experiment_info</a> &ndash; to show the metadata of a specific experiment
</p>
</li></ul>


<hr>
<h2 id='load_ethoscope'>Load data from ethoscope result files</h2><span id='topic+load_ethoscope'></span>

<h3>Description</h3>

<p>This function is used to import behavioural data generated
by the <a href="https://giorgiogilestro.notion.site/Ethoscope-User-Manual-a9739373ae9f4840aa45b277f2f0e3a7">ethoscope platform</a>.
That is it loads multiple <code>.db</code> files into a single <code>R</code> <a href="behavr.html#topic+behavr">behavr::behavr</a> table.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>load_ethoscope(
  metadata,
  min_time = 0,
  max_time = Inf,
  reference_hour = NULL,
  verbose = TRUE,
  columns = NULL,
  cache = NULL,
  ncores = 1,
  FUN = NULL,
  map_arg = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="load_ethoscope_+3A_metadata">metadata</code></td>
<td>
<p><a href="data.table.html#topic+data.table">data.table::data.table</a> used to load data (see detail)</p>
</td></tr>
<tr><td><code id="load_ethoscope_+3A_min_time">min_time</code>, <code id="load_ethoscope_+3A_max_time">max_time</code></td>
<td>
<p>load only data between <code>min_time</code> and <code>max_time</code> (in seconds).
This time is <em>relative to the start of the experiment</em>.</p>
</td></tr>
<tr><td><code id="load_ethoscope_+3A_reference_hour">reference_hour</code></td>
<td>
<p>hour, in the day, to use as ZT0 reference.
When unspecified, time will be relative to the start of the experiment.</p>
</td></tr>
<tr><td><code id="load_ethoscope_+3A_verbose">verbose</code></td>
<td>
<p>whether to print progress (a logical)</p>
</td></tr>
<tr><td><code id="load_ethoscope_+3A_columns">columns</code></td>
<td>
<p>optional vector of columns to be selected from the db file.
Time (t) is always implicitly selected.
When <code>NULL</code> and if <code>FUN</code> is set, columns can be retrieved automatically (from the attributes of <code>FUN</code>).</p>
</td></tr>
<tr><td><code id="load_ethoscope_+3A_cache">cache</code></td>
<td>
<p>the name of a local directory to cache results for faster subsequent data loading.</p>
</td></tr>
<tr><td><code id="load_ethoscope_+3A_ncores">ncores</code></td>
<td>
<p>number of cores to use for optional parallel processing (experimental).</p>
</td></tr>
<tr><td><code id="load_ethoscope_+3A_fun">FUN</code></td>
<td>
<p>function (optional) to transform the data from each individual
immediately after is has been loaded.</p>
</td></tr>
<tr><td><code id="load_ethoscope_+3A_map_arg">map_arg</code></td>
<td>
<p>a list to map <code>FUN</code> arguments to metavariables values. See details</p>
</td></tr>
<tr><td><code id="load_ethoscope_+3A_...">...</code></td>
<td>
<p>extra arguments to be passed to <code>FUN</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>the linked metadata should be generated using <a href="#topic+link_ethoscope_metadata">link_ethoscope_metadata</a>.
<code>map_arg</code> is a list of the form <code>list(fun_arg = "metavariable")</code>.
When provided, <code>FUN</code> will set specific arguments (<code>fun_arg</code>) to the value of a (quoted) metavariable.
</p>


<h3>Value</h3>

<p>A <a href="behavr.html#topic+behavr">behavr::behavr</a> table.
In addition to the metadata, it contains the data, with the columns:
</p>

<ul>
<li> <p><code>id</code> &ndash; autogenerated unique identifier, one per animal
</p>
</li>
<li> <p><code>t</code> &ndash; time (s)
</p>
</li>
<li><p> Several variables recorded by ethoscopes (position, angle, width/height and others), or computed by <code>FUN</code>.
Distance units (e.g. xy position, height/width) are expressed as a fraction of the width of the ROI they originate from.
</p>
</li></ul>



<h3>References</h3>


<ul>
<li> <p><a href="https://rethomics.github.io/behavr.html">behavr tutorial</a> &ndash; how to work with the obtained <a href="behavr.html#topic+behavr">behavr::behavr</a> table
</p>
</li></ul>



<h3>See Also</h3>


<ul>
<li> <p><a href="behavr.html#topic+behavr">behavr::behavr</a> &ndash; to understand the output format
</p>
</li>
<li> <p><a href="#topic+experiment_info">experiment_info</a> &ndash; to show information about a file/experiment
</p>
</li>
<li> <p><a href="#topic+list_result_files">list_result_files</a> &ndash; to list available files
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>dir &lt;- paste0(scopr_example_dir(), "/ethoscope_results/")
data(region_id_metadata)
metadata &lt;- link_ethoscope_metadata(region_id_metadata, dir)
print(metadata)

# Default data loading
dt &lt;- load_ethoscope(metadata)
dt

# We use reference hour to set zt0 to 09:00 GMT
dt &lt;- load_ethoscope(metadata, reference_hour=9)
dt

# Only load x and y positions
dt &lt;- load_ethoscope(metadata, columns=c("x", "y"), reference_hour=9)
dt
# apply function whilst loading the data
dt &lt;- load_ethoscope(metadata, reference_hour=9, FUN=head)
dt

</code></pre>

<hr>
<h2 id='no_region_id_metadata'>Simple toy metadata defining three experiments, with one condition (<code>test</code>) per experiment.
Implicitly, 20 individuals are in each experiment
It serves as a simple example.</h2><span id='topic+no_region_id_metadata'></span>

<h3>Description</h3>

<p>Simple toy metadata defining three experiments, with one condition (<code>test</code>) per experiment.
Implicitly, 20 individuals are in each experiment
It serves as a simple example.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>no_region_id_metadata
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 3 rows and 4 columns.
</p>


<h3>Author(s)</h3>

<p>Quentin Geissmann
</p>

<hr>
<h2 id='region_id_metadata'>Simple toy metadata experimental conditions for 15 individuals in three experiments.
the condition (<code>test</code>) is linked to the experiments, and another condition (<code>treatment</code>) is per individual.
It serves as a simple example.
#'</h2><span id='topic+region_id_metadata'></span>

<h3>Description</h3>

<p>Simple toy metadata experimental conditions for 15 individuals in three experiments.
the condition (<code>test</code>) is linked to the experiments, and another condition (<code>treatment</code>) is per individual.
It serves as a simple example.
#'
</p>


<h3>Usage</h3>

<pre><code class='language-R'>region_id_metadata
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 15 rows and 6 columns.
</p>


<h3>Author(s)</h3>

<p>Quentin Geissmann
</p>

<hr>
<h2 id='scopr_example'>Get path to scopr example</h2><span id='topic+scopr_example'></span><span id='topic+scopr_example_dir'></span>

<h3>Description</h3>

<p><code>scopr</code> comes with a sample DAM2 files in its <code>inst/extdata</code>
directory. <code>scopr_example</code> allow  make them easy to access.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>scopr_example(path = NULL)

scopr_example_dir()
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="scopr_example_+3A_path">path</code></td>
<td>
<p>Name of file. If <code>NULL</code>, the example files will be listed.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'># list all files
scopr_example()
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
