<!DOCTYPE html><html><head><title>Help for package HydroCode</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {HydroCode}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#is.odd'><p>Number Type</p></a></li>
<li><a href='#is.upstream'><p>Comparison of Pfafstetter Coded Basins</p></a></li>
<li><a href='#rhineCCM2'><p>CCM2 River and Catchment of the Rhine Catchment, Rivers only</p></a></li>
<li><a href='#rhineHYBASlev08'><p>HydroBASINS Level 08 Data of the Rhine Catchment</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Hydrological Codes</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-03-26</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.3</td>
</tr>
<tr>
<td>Description:</td>
<td>Pfafstetter Hydrological Codes 
    as cited in Verdin and Verdin (1999) &lt;<a href="https://doi.org/10.1016%2FS0022-1694%2899%2900011-6">doi:10.1016/S0022-1694(99)00011-6</a>&gt; 
    are decoded for upstream or downstream queries.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>parallel, sp</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-03-26 14:01:36 UTC; thorsten</td>
</tr>
<tr>
<td>Author:</td>
<td>Thorsten Pohlert <a href="https://orcid.org/0000-0003-3855-3025"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Thorsten Pohlert &lt;thorsten.pohlert@gmx.de&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-03-26 21:50:11 UTC</td>
</tr>
</table>
<hr>
<h2 id='is.odd'>Number Type</h2><span id='topic+is.odd'></span><span id='topic+is.even'></span>

<h3>Description</h3>

<p><code>is.odd</code> tests
whether a number is odd. <code>is.even</code>
returns the opposite
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is.odd(x)

is.even(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is.odd_+3A_x">x</code></td>
<td>
<p>numeric object to be tested</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a vector of type logical
</p>


<h3>Note</h3>

<p>if <code>x</code> contains <code>NA</code> the function returns <code>NA</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- seq(1, 9, 2)
is.odd(x)
y &lt;- seq(2, 8, 2)
is.even(y)
# NA values
x[1] &lt;- NA
is.odd(x)

</code></pre>

<hr>
<h2 id='is.upstream'>Comparison of Pfafstetter Coded Basins</h2><span id='topic+is.upstream'></span><span id='topic++25up+25'></span><span id='topic+is.downstream'></span><span id='topic++25down+25'></span>

<h3>Description</h3>

<p>One point (river segment or subbasin) with Pfafstetter code <b>a</b>
on the water system can be queried for beeing upstream or downstream
as compared to one or many points <b>b</b> on the water system.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is.upstream(a, b)

a %up% b

is.downstream(a, b)

a %down% b
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is.upstream_+3A_a">a</code></td>
<td>
<p>numeric, Pfafstetter coded point</p>
</td></tr>
<tr><td><code id="is.upstream_+3A_b">b</code></td>
<td>
<p>numeric, one or more Pfaffstetter coded points</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For the scientific background of the Pfafstetter coding system see
the literature reference.
</p>
<p>The following option(s) can be set via,
e.g. <code>options("hydrocode.X" = XX)</code>:
</p>

<dl>
<dt><code>hydrocode.parallel</code>:</dt><dd><p>logical. Defaults to <code>FALSE</code>.
The runtime may or may not decrease for very large vectors (length &gt; 50000)
on multi-threading processors.</p>
</dd>
<dt><code>hydrocode.alloddorzero</code>:</dt><dd><p>logical. Defaults to <code>FALSE</code>.
This refers to the original Pfafstetter coding system and tests, whether
all <code>n</code> numbers are odd, <code>[13579]{n}</code>. Hydrocodes that contain
the digit <code>0</code> are interpreted as closed catchments (endorheic basins).
This setting works, e.g. with the Pfafstetter coded table <code>riversegments</code> of
<em>CCM River and Catchment Database, v2.1</em> (European Commission - JRC, 2007;
Vogt et al., 2007).
For decoding the Pfafstetter coded tables of the <em>HydroBASIN, v1c</em> dataset
(Lehner and Grill, 2013), this option should be set to
<code>options("hydrocode.alloddorzero" = TRUE)</code>. This tests for all <code>n</code>
numbers are odd or zero, <code>[013579]{n}</code>.</p>
</dd>
</dl>



<h3>Value</h3>

<p>a vector of type logical
</p>


<h3>References</h3>

<p>A. L. de Jager and J. V. Vogt, 2010,
Development and Demonstration of a
Structured Hydrological Feature Coding
System for Europe,
<em>Hydrological Sciences Journal</em>, <b>55</b>,
661&ndash;75, <a href="https://doi.org/10.1080/02626667.2010.490786">doi:10.1080/02626667.2010.490786</a>.
</p>
<p>B. Lehner and G. Grill, 2013, Global river hydrography and network
routing: baseline data and new approaches to study the world’s
large river systems, <em>Hydrological Processes</em>, <b>27</b>,
2171&ndash;2186, <a href="https://doi.org/10.1002/hyp.9740">doi:10.1002/hyp.9740</a>.
</p>
<p>K. L. Verdin and J. P. Verdin, 1999,
A topological system for delineation and codification
of the Earth’s river basins,
<em>Journal of Hydrology</em>, <b>218</b>, 1&ndash;12,
<a href="https://doi.org/10.1016/S0022-1694%2899%2900011-6">doi:10.1016/S0022-1694(99)00011-6</a>.
</p>
<p>J. Vogt, P. Soille, A. de Jager, E. Rimavičiūtė,
W. Mehl, S. Foisneau, K. Bódis, et al., 2007,
<em>A Pan-European River and Catchment Database</em>,
Publications Office: Luxembourg, <a href="https://doi.org/10.2788/35907">doi:10.2788/35907</a>.
</p>
<p>Wikipedia contributors, 2019,
Pfafstetter Coding System,
In <em>Wikipedia, The Free Encyclopedia</em>,
Retrieved 13:23, November 9, 2019,
<a href="https://en.wikipedia.org/w/index.php?title=Pfafstetter_Coding_System&amp;oldid=907987995">https://en.wikipedia.org/w/index.php?title=Pfafstetter_Coding_System&amp;oldid=907987995</a>
</p>


<h3>See Also</h3>

<p><code><a href="base.html#topic+options">options</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## example from Wikipedia
## 8835 is upstream of segments 8833 and 8811,
## but not segments 8832, 8821 or 9135
dwn &lt;- c(8833, 8811, 8832, 8821, 9135)
is.upstream(8835, dwn)

## works with operator
8835 %up% dwn

## this will produce errors
## Not run: 
is.upstream("12h", 123)
is.upstream(12.4, 123)

## End(Not run)

## example from Verdin and Verdin, 1999, p. 10
b &lt;- c(8883, 8881, 8879, 8877, 8875, 8873, 8871, 8859,
       8857, 8855, 8853, 8851, 8839, 8837, 8835, 8833,
       8831, 8819, 8817, 8815, 8813, 8811, 8886, 8887,
       8888, 8889)
a &lt;- 8885
a %down% b

## example from Vogt et al. (2007),
## pollution source at 464.
## Which subcatchments are
## affected? Mixed levels of subdivisions.
a &lt;- 464
b &lt;- c(465, 466, 467, 47, 48, 49,
       463, 461, 41, 43, 45, 452,
       454)
a %up% b

## same hydro codes return TRUE per default
112 %up% 112
112 %down% 112

</code></pre>

<hr>
<h2 id='rhineCCM2'>CCM2 River and Catchment of the Rhine Catchment, Rivers only</h2><span id='topic+rhineCCM2'></span>

<h3>Description</h3>

<p>This spatial dataset is a subset of the data layer <code>RIVERSEGMENTS</code>
of the tile <code>WGS84_W2003</code> from the CCM River and
Catchment Database v2.1 (Vogt et al. 2007). The original data format was
PGeo (ESRI Personal GeoDatabase).
The subset consists of rivers within the Rhine basin, i.e.
<code>WSO_ID = 291110</code>. In order to save disk space,
the fields of the attribute table were shortened.
</p>


<h3>Format</h3>

<p>An Object of class SpatialLinesDataFrame with 30343 features.
The attribute table comprises 2 fields:
</p>

<dl>
<dt>WSO1_ID</dt><dd><p>int, unique river segment identifier</p>
</dd>
<dt>PFAFSTETTER</dt><dd><p>num, Pfafstetter code according to CCM2</p>
</dd>
</dl>

<p>The PROJ.4 string
is <code>+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0</code>.
</p>


<h3>Source</h3>

<p>CCM River and Catchment Database
(C) European Commission - JRC, 2007.
</p>


<h3>References</h3>

<p>J. Vogt, P. Soille, A. de Jager, E. Rimavičiūtė,
W. Mehl, S. Foisneau, K. Bódis, et al., 2007,
<em>A Pan-European River and Catchment Database</em>,
Publications Office: Luxembourg, <a href="https://doi.org/10.2788/35907">doi:10.2788/35907</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
## get the flowpath from a head catchment to
## the sea
## Be patient, this might take a while.
system.time(fps &lt;- 973842223 %up% rhineCCM2$PFAFSTETTER)
flowpath &lt;- subset(rhineCCM2, subset = fps)
sp::plot(flowpath)

## does parallel threats increase the speed
## and provide the same results?
op.old &lt;- options()
options("hydrocode.parallel" = TRUE)
system.time(fpp &lt;- 973842223 %up% rhineCCM2$PFAFSTETTER)
all.equal(fps, fpp)

## reset previous settings
options(op.old)

## End(Not run)
</code></pre>

<hr>
<h2 id='rhineHYBASlev08'>HydroBASINS Level 08 Data of the Rhine Catchment</h2><span id='topic+rhineHYBASlev08'></span>

<h3>Description</h3>

<p>This spatial dataset is a subset of the data layer
<code>hybas_eu_lev08_v1c</code> from the HydroBASINS v1.c database
(Lehner and Grill, 2013).
The original data format was SHP (ESRI Shape File).
The subset consists of subbasins within the Rhine basin, i.e.
<code>MAIN_BAS = 2080023010</code>.
</p>


<h3>Format</h3>

<p>An Object of class SpatialPolygonsDataFrame with 289 features.
The attribute table comprises 13 fields:
</p>

<dl>
<dt>HYBAS_ID</dt><dd><p>factor, unique basin identifier</p>
</dd>
<dt>NEXT_DOWN</dt><dd><p>factor, Hybas_id of the next downstream polygon</p>
</dd>
<dt>NEXT_SINK</dt><dd><p>factor, Hybas_id of the next downstream sink</p>
</dd>
<dt>MAIN_BAS</dt><dd><p>factor, Hybas_id of the most downstream sink, i.e. the outlet of the main river basin</p>
</dd>
<dt>DIST_SINK</dt><dd><p>numeric, Distance from polygon outlet to the next
downstream sink along the river network, in kilometers</p>
</dd>
<dt>DIST_MAIN</dt><dd><p>numeric, Distance from polygon outlet to
the most downstream sink, i.e. the outlet of the
main river basin along the river network, in kilometers</p>
</dd>
<dt>SUB_AREA</dt><dd><p>numeric, Area of the individual polygon (i.e. sub-basin), in square kilometers</p>
</dd>
<dt>UP_AREA</dt><dd><p>numeric, Total upstream area, in square kilometers,
calculated from the headwaters to the polygon location (including the polygon)</p>
</dd>
<dt>PFAF_IF</dt><dd><p>int, the Pfafstetter code</p>
</dd>
<dt>ENDO</dt><dd><p>int, Indicator for endorheic (inland) basins without
surface flow connection to the ocean: 0 = not part of an endorheic basin;
1 = part of an endorheic basin; 2 = sink (i.e. most downstream polygon)
of an endorheic basin.</p>
</dd>
<dt>COAST</dt><dd><p>int, indicator for lumped coastal basins: 0 = no; 1 = yes</p>
</dd>
<dt>ORDER</dt><dd><p>int, Indicator of river order (classical ordering system):
order 1 represents the main stem river from sink to source;
order 2 represents all tributaries that flow into a 1 st order
river; order 3 represents all tributaries that flow into a 2 nd order river;
etc.; order 0 is used for conglomerates of small coastal watersheds</p>
</dd>
<dt>SORT</dt><dd><p>int, Indicator showing the record number (sequence)
in which the original polygons are stored in the shapefile
(i.e. counting upwards from 1 in the original shapefile).</p>
</dd>
</dl>

<p>The PROJ.4 string is
<code>+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84+towgs84=0,0,0</code>
</p>


<h3>Source</h3>

<p>This product rhineHYBASlev08 incorporates data from the HydroSHEDS database which is (C) World
Wildlife Fund, Inc. (2006-2013) and has been used herein under license. WWF has not evaluated the data as altered and
incorporated within rhineHYBASlev08, and therefore gives no warranty regarding its accuracy,
completeness, currency or suitability for any particular purpose. Portions of the HydroSHEDS database incorporate data
which are the intellectual property rights of (C) USGS (2006-2008), NASA (2000-2005), ESRI (1992-1998), CIAT (2004-2006),
UNEP-WCMC (1993), WWF (2004), Commonwealth of Australia (2007), and Her Royal Majesty and the British Crown and
are used under license. The HydroSHEDS database and more information are available at http://www.hydrosheds.org.
</p>


<h3>References</h3>

<p>B. Lehner and G. Grill, 2013, Global river hydrography and network
routing: baseline data and new approaches to study the world’s
large river systems, <em>Hydrological Processes</em>, <b>27</b>,
2171&ndash;2186, <a href="https://doi.org/10.1002/hyp.9740">doi:10.1002/hyp.9740</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
## Catchment of gauge Mainz / Rhein
## HYBAS uses a modified version of Pfafstetter
op.old &lt;- options()
options("hydrocode.alloddorzero" = TRUE)
ok &lt;- is.downstream(23263070, rhineHYBASlev08$PFAF_ID)
MzBas &lt;- subset(rhineHYBASlev08, subset = ok)
sp::plot(rhineHYBASlev08)
sp::plot(MzBas, add = TRUE, col = "red")

## get catchment size
## AEO : 98206 km2 according to website
sum(MzBas$SUB_AREA)

## reset previous settings
options(op.old)

## End(Not run)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
