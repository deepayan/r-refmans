<!DOCTYPE html><html><head><title>Help for package multilevelmediation</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {multilevelmediation}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#boot.modmed.mlm'><p>Boot function for (moderated) mediation with 2-level multilevel models</p></a></li>
<li><a href='#boot.modmed.mlm.custom'><p>Bootstrapping multilevel mediation model (without boot package)</p></a></li>
<li><a href='#bootresid.modmed.mlm'><p>Custom function for residual bootstrap for (moderated) multilevel mediation</p></a></li>
<li><a href='#BPG06dat'><p>Simulated dataset from Bauer, Preacher, and Gil (2006)</p></a></li>
<li><a href='#extract.boot.modmed.mlm'><p>Post-processing of bootstrap results from boot.modmed.mlm</p></a></li>
<li><a href='#extract.modmed.mlm'><p>Post-processing of a model fit with modmed.mlm</p></a></li>
<li><a href='#extract.modmed.mlm.brms'><p>Post-processing of results from modmed.mlm.brms</p></a></li>
<li><a href='#modmed.mlm'><p>Model definition and estimation function for two-level (moderated) mediation</p></a></li>
<li><a href='#modmed.mlm.brms'><p>Custom model fitting function for a 1-1-1 (moderated) mediation for the brms code</p></a></li>
<li><a href='#simdat'><p>A simulated dataset with moderator</p></a></li>
<li><a href='#stack_bpg'><p>Stacks data in the style of Bauer-Preacher-Gil for multilevel mediation</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Utility Functions for Multilevel Mediation Analysis</td>
</tr>
<tr>
<td>Version:</td>
<td>0.3.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-02-27</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Carl F. Falk &lt;carl.falk@mcgill.ca&gt;</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/falkcarl/multilevelmediation">https://github.com/falkcarl/multilevelmediation</a></td>
</tr>
<tr>
<td>Description:</td>
<td>The ultimate goal is to support 2-2-1, 2-1-1, and 1-1-1 models for
 multilevel mediation, the option of a moderating variable for either the a, b,
 or both paths, and covariates. Currently the 1-1-1 model is supported
 and several options of random effects; the initial code for bootstrapping was
 evaluated in simulations by Falk, Vogel, Hammami, and Miočević (2024) &lt;<a href="https://doi.org/10.3758%2Fs13428-023-02079-4">doi:10.3758/s13428-023-02079-4</a>&gt;.
 Support for Bayesian estimation using 'brms' comprises ongoing work. Currently
 only continuous mediators and outcomes are supported. Factors for any
 predictors must be numerically represented.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>Imports:</td>
<td>furrr, future, matrixcalc, MCMCpack, nlme, parallel,
parallelly, stats, tidyr, brms, posterior</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 3.0.0), boot</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-02-28 00:21:41 UTC; CarlFalkMcGill</td>
</tr>
<tr>
<td>Author:</td>
<td>Carl F. Falk [cre, aut],
  Todd Vogel [aut],
  Sarah Hammami [aut],
  Milica Miočević [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-02-29 11:50:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='boot.modmed.mlm'>Boot function for (moderated) mediation with 2-level multilevel models</h2><span id='topic+boot.modmed.mlm'></span>

<h3>Description</h3>

<p>Boot function for (moderated) mediation with 2-level multilevel models
</p>


<h3>Usage</h3>

<pre><code class='language-R'>boot.modmed.mlm(
  data,
  indices,
  L2ID,
  ...,
  type = "all",
  modval1 = NULL,
  modval2 = NULL,
  boot.lvl = c("both", "1", "2")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="boot.modmed.mlm_+3A_data">data</code></td>
<td>
<p>Data frame in long format.</p>
</td></tr>
<tr><td><code id="boot.modmed.mlm_+3A_indices">indices</code></td>
<td>
<p><code>boot</code> requires the function signature to accept a vector of
index numbers and so this argument is required. If the index numbers are all in order starting at 1,
then the relevant model will be fit to the data without any resampling. If some other vector is supplied,
then resampling is done as described in details.</p>
</td></tr>
<tr><td><code id="boot.modmed.mlm_+3A_l2id">L2ID</code></td>
<td>
<p>Name of column that contains grouping variable in 'data' (e.g., &quot;SubjectID&quot;)</p>
</td></tr>
<tr><td><code id="boot.modmed.mlm_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code><a href="#topic+modmed.mlm">modmed.mlm</a></code> to define the mediation analysis model.</p>
</td></tr>
<tr><td><code id="boot.modmed.mlm_+3A_type">type</code></td>
<td>
<p>Character that defines what information to extract from the model. Default and options are in <code><a href="#topic+extract.modmed.mlm">extract.modmed.mlm</a></code>.
As examples, &quot;indirect&quot; will compute the indirect effect, &quot;all&quot; will save all random and fixed effects for possible additional
computations, &quot;indirect.diff&quot; will compute the difference in the indirect effect at two values of a possible moderating variable.</p>
</td></tr>
<tr><td><code id="boot.modmed.mlm_+3A_modval1">modval1</code></td>
<td>
<p>(Optional) Numeric. If the model has a moderator, this value will be passed to <code><a href="#topic+extract.modmed.mlm">extract.modmed.mlm</a></code>
to compute the indirect effect or other effects at that value. See <code><a href="#topic+extract.modmed.mlm">extract.modmed.mlm</a></code> for details.</p>
</td></tr>
<tr><td><code id="boot.modmed.mlm_+3A_modval2">modval2</code></td>
<td>
<p>(Optional). If the model has a moderator, it is possible to compute the difference in the indirect
at two values of the moderator. If given and an appropriate option for such a difference is chosen for <code>type</code>,
this value and that of <code>modval1</code> will be passed to <code><a href="#topic+extract.modmed.mlm">extract.modmed.mlm</a></code> to compute and save the difference.
This is useful for obtaining a CI for the difference in the indirect effect at two different levels of the moderator.</p>
</td></tr>
<tr><td><code id="boot.modmed.mlm_+3A_boot.lvl">boot.lvl</code></td>
<td>
<p>Character that defines at what level resampling should occur. Options are &quot;both&quot;, &quot;1&quot;, or &quot;2&quot;. &quot;both&quot; will sample L2 units
and then L1 units w/in each cluster. This has been noted to result in unequal sample sizes if the original clusters did not have equal sample sizes.
&quot;2&quot; resamples only L2 units and leaves all L1 units intact. &quot;1&quot; will assume that whatever indices are fed from the boot function will
be used. This probably only makes sense if <code>strata</code> is specified.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Implements function to do bootstrapping with the 1-1-1 multilevel mediation analysis models as used in Falk, Vogel,
Hammami &amp; Miočević (in press). For use with boot package. This function aides in implementing case resampling methods
with support for resampling at level 2, level 1, or both (e.g., see Hox and van de Schoot, 2013; van der Leeden, Meijer, &amp; Busing, 2008).
These functions also support moderated mediation. See also <code><a href="#topic+modmed.mlm">modmed.mlm</a></code>. Note that <code><a href="stats.html#topic+nlm">nlm</a></code> was used as the optimizer
for some of the examples below as it was found to be faster for the models/simulations studied by Falk et al (in press).
</p>


<h3>Value</h3>

<p>A vector of parameter estimates, depending on the value of <code>type</code> specified as input. Once the model is estimated,
<code><a href="#topic+extract.modmed.mlm">extract.modmed.mlm</a> is used to obtain the parameter estimates.</code>
</p>


<h3>References</h3>

<p>Bauer, D. J., Preacher, K. J., &amp; Gil, K. M. (2006). Conceptualizing and testing random indirect effects and moderated mediation in multilevel models: New procedures and recommendations. Psychological Methods, 11(2), 142–163. <a href="https://doi.org/10.1037/1082-989X.11.2.142">doi:10.1037/1082-989X.11.2.142</a>
</p>
<p>Falk, C. F., Vogel, T., Hammami, S., &amp; Miočević, M. (in press). Multilevel mediation analysis in R: A comparison of bootstrap and Bayesian approaches. Behavior Research Methods. <a href="https://doi.org/10.3758/s13428-023-02079-4">doi:10.3758/s13428-023-02079-4</a>  Preprint: <a href="https://doi.org/10.31234/osf.io/ync34">doi:10.31234/osf.io/ync34</a>
</p>
<p>Hox, J., &amp; van de Schoot, R. (2013). Robust methods for multilevel analysis. In M. A. Scott, J. S. Simonoff &amp; B. D. Marx (Eds.), The SAGE Handbook of Multilevel Modeling (pp. 387-402). SAGE Publications Ltd. <a href="https://doi.org/10.4135/9781446247600.n22">doi:10.4135/9781446247600.n22</a>
</p>
<p>van der Leeden, R., Meijer, E., &amp; Busing, F. M. T. A. (2008). Resampling multilevel models. In J. de Leeuw &amp; E. Meijer (Eds.), Handbook of Multilevel Analysis (pp. 401-433). Springer.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


# Note that for all examples below, R should be increased to something
#  MUCH larger (e.g., 1000). Small values here are used only so that the code
#  runs relatively quickly when tested.

## Mediation for 1-1-1 model
data(BPG06dat)

#Setup parallel processing
# snow appears to work on Windows; something else may be better on Unix/Mac/Linux
library(parallel)
library(boot)
ncpu&lt;-2
RNGkind("L'Ecuyer-CMRG") # set type of random number generation that works in parallel
cl&lt;-makeCluster(ncpu)
clusterSetRNGStream(cl, 9912) # set random number seeds for cluster

# bootstrap all fixed and random effects (type="all")
boot.result&lt;-boot(BPG06dat, statistic=boot.modmed.mlm, R=10,
  L2ID = "id", X = "x", Y = "y", M = "m",
  random.a=TRUE, random.b=TRUE, random.cprime=TRUE,
  type="all",
  control=list(opt="nlm"),
  parallel="snow",ncpus=ncpu,cl=cl)

# Point estimate and 95% CI for indirect effect
extract.boot.modmed.mlm(boot.result, type="indirect", ci.conf=.95)

stopCluster(cl) # shut down cluster

## Moderated mediation

data(simdat)

# Note: use of nlm apparently fails in this moderated mediation model
# default optimizer for lme instead is used

## Bootstrap w/ moderation of a and b paths
set.seed(1234)

boot.result2&lt;-boot(simdat, statistic=boot.modmed.mlm, R=5,
 L2ID = "L2id", X = "X", Y = "Y", M = "M",
   random.a=TRUE, random.b=TRUE, random.cprime=TRUE,
   moderator = "mod", mod.a=TRUE, mod.b=TRUE,
   type="all")

# indirect effect point estimate and 95% CI when moderator = 0
extract.boot.modmed.mlm(boot.result2, type="indirect")
extract.boot.modmed.mlm(boot.result2, type="indirect", modval1=0)

# indirect effect point estimate and 95% CI when moderator = 1
extract.boot.modmed.mlm(boot.result2, type="indirect", modval1=1)

# indirect effect difference point estimate and 95% CI
extract.boot.modmed.mlm(boot.result2, type="indirect.diff",
   modval1=0, modval2=1)

# Example to not fail when using missing values
# See documentation for lme function from the nlme package for other
# options for na.action
dat.miss &lt;- BPG06dat
dat.miss$m[c(1,2,3,4)]&lt;-NA
dat.miss$y[c(5,6,7,8)]&lt;-NA
boot.result&lt;-boot(dat.miss, statistic=boot.modmed.mlm, R=5,
  L2ID = "id", X = "x", Y = "y", M = "m",
  random.a=TRUE, random.b=TRUE, random.cprime=TRUE,
  type="all",
  control=list(opt="nlm"),
  na.action = na.omit)


</code></pre>

<hr>
<h2 id='boot.modmed.mlm.custom'>Bootstrapping multilevel mediation model (without boot package)</h2><span id='topic+boot.modmed.mlm.custom'></span>

<h3>Description</h3>

<p>Bootstrapping multilevel mediation model (without boot package)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>boot.modmed.mlm.custom(
  data,
  L2ID,
  ...,
  return.type = "all",
  modval1 = NULL,
  modval2 = NULL,
  nrep = 500,
  boot.type = c("caseboth", "case2", "case1", "resid"),
  parallel.type = c("lapply", "parallel", "furrr"),
  ncores = NULL,
  seed = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="boot.modmed.mlm.custom_+3A_data">data</code></td>
<td>
<p>Data frame in long format. The function will do restructuring using <code><a href="#topic+stack_bpg">stack_bpg</a></code>.</p>
</td></tr>
<tr><td><code id="boot.modmed.mlm.custom_+3A_l2id">L2ID</code></td>
<td>
<p>Name of column that contains grouping variable in 'data' (e.g., &quot;SubjectID&quot;)</p>
</td></tr>
<tr><td><code id="boot.modmed.mlm.custom_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code><a href="#topic+modmed.mlm">modmed.mlm</a></code> or <code><a href="nlme.html#topic+lme">lme</a></code> to define the mediation analysis model or do estimation, respectively.</p>
</td></tr>
<tr><td><code id="boot.modmed.mlm.custom_+3A_return.type">return.type</code></td>
<td>
<p>Character that defines what information to extract from the model. Default and options are in <code><a href="#topic+extract.modmed.mlm">extract.modmed.mlm</a></code>.
As examples, &quot;indirect&quot; will compute the indirect effect, &quot;all&quot; will save all random and fixed effects for possible additional
computations, &quot;indirect.diff&quot; will compute the difference in the indirect effect at two values of a possible moderating variable.</p>
</td></tr>
<tr><td><code id="boot.modmed.mlm.custom_+3A_modval1">modval1</code></td>
<td>
<p>(Optional) Numeric. If the model has a moderator, this value will be passed to <code><a href="#topic+extract.modmed.mlm">extract.modmed.mlm</a></code>
to compute the indirect effect or other effects at that value. See <code><a href="#topic+extract.modmed.mlm">extract.modmed.mlm</a></code> for details.</p>
</td></tr>
<tr><td><code id="boot.modmed.mlm.custom_+3A_modval2">modval2</code></td>
<td>
<p>(Optional). If the model has a moderator, it is possible to compute the difference in the indirect
at two values of the moderator. If given and an appropriate option for such a difference is chosen for <code>type</code>,
this value and that of <code>modval1</code> will be passed to <code><a href="#topic+extract.modmed.mlm">extract.modmed.mlm</a></code> to compute and save the difference.
This is useful for obtaining a CI for the difference in the indirect effect at two different levels of the moderator.</p>
</td></tr>
<tr><td><code id="boot.modmed.mlm.custom_+3A_nrep">nrep</code></td>
<td>
<p>Number of bootstrap replications to perform. Pick a small number just for testing purposes, something larger (e.g., 1000 or more) for analyses.</p>
</td></tr>
<tr><td><code id="boot.modmed.mlm.custom_+3A_boot.type">boot.type</code></td>
<td>
<p>Character indicating the type of bootstrapping to perform. Options are: &quot;caseboth&quot;, &quot;case2&quot;, &quot;case1&quot;, or &quot;resid&quot;.</p>
</td></tr>
<tr><td><code id="boot.modmed.mlm.custom_+3A_parallel.type">parallel.type</code></td>
<td>
<p>Character indicating type of parallel processing (if any) to use. Options are &quot;lapply&quot; (no parallel processing),&quot;parallel&quot;
(uses <code><a href="parallel.html#topic+parallel">parallel</a></code> package), or &quot;furrr&quot; (uses <code><a href="furrr.html#topic+furrr">furrr</a></code> package.</p>
</td></tr>
<tr><td><code id="boot.modmed.mlm.custom_+3A_ncores">ncores</code></td>
<td>
<p>Integer indicating the number of processing cores to attempt to use.</p>
</td></tr>
<tr><td><code id="boot.modmed.mlm.custom_+3A_seed">seed</code></td>
<td>
<p>Integer to set random number seed, for replication purposes. Note that replication may be somewhat R version or platform dependent.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function was written to do all four kinds of bootstrapping outlined in Falk, Vogel, Hammami &amp; Miočević (in press):
case resampling at both levels, at level 2 only, at level 1 only, and the residual-based bootstrap (e.g., see Hox and van de Schoot, 2013;
van der Leeden, Meijer, &amp; Busing, 2008). These functions also support moderated mediation. See also <code><a href="#topic+modmed.mlm">modmed.mlm</a></code>.
Note that <code><a href="stats.html#topic+nlm">nlm</a></code> was used as the optimizer for some of the examples below as it was found to be faster for the models/simulations
studied by Falk et al (in press). Note that Level 1 only bootstrapping is typically not recommended. See Falk et al. (in press) for details.
</p>
<p>This function is different from the original functions used for the publication and that as of this writing still appear here: <code><a href="#topic+boot.modmed.mlm">boot.modmed.mlm</a></code>
and here: <code><a href="#topic+bootresid.modmed.mlm">bootresid.modmed.mlm</a></code> . The present function seeks to unify case bootstrapping and residual-based bootstrapping in the same function. Furthermore,
this newer function is also aimed at attempting to bypass the need for using the <code>boot</code> package to do computations and parallel processing.
Some performance gains in terms of speed have been observed via use of this function instead of <code>boot</code> in conjunction with <code><a href="#topic+boot.modmed.mlm">boot.modmed.mlm</a></code>.
Although somewhat slower, <code><a href="furrr.html#topic+furrr">furrr</a></code> can also be used if one would like a progress bar.
</p>


<h3>Value</h3>

<p>A list with the following elements. Note that <code>t0</code> and <code>t</code> are intended to trick the <code><a href="boot.html#topic+boot">boot</a></code>
package into working with some if its functions.
</p>

<ul>
<li><p><code>call</code> Call/arguments used when invoking this function. Useful for later extracting things like indirect effect.
</p>
</li>
<li><p><code>t0</code> Parameter estimates based on the dataset.
</p>
</li>
<li><p><code>t</code> Bootstrap distribution of all parameter estimates.
</p>
</li>
<li><p><code>model</code> Fitted model to restructured data as one would obtain from <code><a href="#topic+modmed.mlm">modmed.mlm</a></code>.
</p>
</li>
<li><p><code>conv</code> Whether model fit to restructured dataset converged.
</p>
</li>
<li><p><code>args</code> Arguments used when calling <code><a href="#topic+modmed.mlm">modmed.mlm</a></code>. Useful for later extracting things like indirect effect.
</p>
</li></ul>



<h3>References</h3>

<p>Bauer, D. J., Preacher, K. J., &amp; Gil, K. M. (2006). Conceptualizing and testing random indirect effects and moderated mediation in multilevel models: New procedures and recommendations. Psychological Methods, 11(2), 142–163. <a href="https://doi.org/10.1037/1082-989X.11.2.142">doi:10.1037/1082-989X.11.2.142</a>
</p>
<p>Falk, C. F., Vogel, T., Hammami, S., &amp; Miočević, M. (in press). Multilevel mediation analysis in R: A comparison of bootstrap and Bayesian approaches. Behavior Research Methods. <a href="https://doi.org/10.3758/s13428-023-02079-4">doi:10.3758/s13428-023-02079-4</a>  Preprint: <a href="https://doi.org/10.31234/osf.io/ync34">doi:10.31234/osf.io/ync34</a>
</p>
<p>Hox, J., &amp; van de Schoot, R. (2013). Robust methods for multilevel analysis. In M. A. Scott, J. S. Simonoff &amp; B. D. Marx (Eds.), The SAGE Handbook of Multilevel Modeling (pp. 387-402). SAGE Publications Ltd. <a href="https://doi.org/10.4135/9781446247600.n22">doi:10.4135/9781446247600.n22</a>
</p>
<p>van der Leeden, R., Meijer, E., &amp; Busing, F. M. T. A. (2008). Resampling multilevel models. In J. de Leeuw &amp; E. Meijer (Eds.), Handbook of Multilevel Analysis (pp. 401-433). Springer.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


data(BPG06dat)

# Note that for all examples below, nrep should be increased to something
#  MUCH larger (e.g., 1000). Small values here are used only so that the code
#  runs relatively quickly when tested.

# double bootstrap, no parallel processing
boot.result&lt;-boot.modmed.mlm.custom(BPG06dat, nrep=10, L2ID="id", X="x", Y="y", M="m",
  boot.type="caseboth",
  control=list(opt="nlm"), seed=1234)

extract.boot.modmed.mlm(boot.result, type="indirect", ci.conf=.95)

# residual bootstrap, parallel package
boot.result&lt;-boot.modmed.mlm.custom(BPG06dat, nrep=10, L2ID="id", X="x", Y="y", M="m",
  boot.type="resid", random.a=TRUE, random.b=TRUE,
  parallel.type="parallel",ncores=2,seed=2299,
  control=list(opt="nlm"))

extract.boot.modmed.mlm(boot.result, type="indirect", ci.conf=.95)



# Example with moderation
data(simdat)

# moderation
boot.result&lt;-boot.modmed.mlm.custom(simdat, nrep=5, L2ID = "L2id", X = "X", Y = "Y", M = "M",
   boot.type="caseboth",
   random.a=TRUE, random.b=TRUE, random.cprime=TRUE,
   moderator = "mod", mod.a=TRUE, mod.b=TRUE,
   random.mod.a = TRUE, random.mod.b = TRUE,
  parallel.type="parallel",ncores=2,seed=2299)

extract.boot.modmed.mlm(boot.result, type="indirect")

# indirect effect point estimate and 95% CI when moderator = 0
extract.boot.modmed.mlm(boot.result, type="indirect", modval1=0)

# indirect effect point estimate and 95% CI when moderator = 1
 extract.boot.modmed.mlm(boot.result, type="indirect", modval1=1)

# indirect effect difference point estimate and 95% CI
extract.boot.modmed.mlm(boot.result, type="indirect.diff",
  modval1=0, modval2=1)


</code></pre>

<hr>
<h2 id='bootresid.modmed.mlm'>Custom function for residual bootstrap for (moderated) multilevel mediation</h2><span id='topic+bootresid.modmed.mlm'></span>

<h3>Description</h3>

<p>Custom function for residual bootstrap for (moderated) multilevel mediation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bootresid.modmed.mlm(
  data,
  L2ID,
  R = 1000,
  X,
  Y,
  M,
  moderator = NULL,
  covars.m = NULL,
  covars.y = NULL,
  ...,
  type = "all",
  modval1 = NULL,
  modval2 = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bootresid.modmed.mlm_+3A_data">data</code></td>
<td>
<p>Data frame in long format.</p>
</td></tr>
<tr><td><code id="bootresid.modmed.mlm_+3A_l2id">L2ID</code></td>
<td>
<p>Name of column that contains grouping variable in 'data' (e.g., &quot;SubjectID&quot;)</p>
</td></tr>
<tr><td><code id="bootresid.modmed.mlm_+3A_r">R</code></td>
<td>
<p>Number of resamples</p>
</td></tr>
<tr><td><code id="bootresid.modmed.mlm_+3A_x">X</code></td>
<td>
<p>(Character) Name of column that contains the X independent variable in <code>data</code>.</p>
</td></tr>
<tr><td><code id="bootresid.modmed.mlm_+3A_y">Y</code></td>
<td>
<p>(Character) Name of column that contains the Y dependent variable in <code>data</code>.</p>
</td></tr>
<tr><td><code id="bootresid.modmed.mlm_+3A_m">M</code></td>
<td>
<p>(Character) Name of column that contains the M mediating variable in <code>data</code>.</p>
</td></tr>
<tr><td><code id="bootresid.modmed.mlm_+3A_moderator">moderator</code></td>
<td>
<p>Optional Character that contains name of column that contains the moderator variable in <code>data</code></p>
</td></tr>
<tr><td><code id="bootresid.modmed.mlm_+3A_covars.m">covars.m</code></td>
<td>
<p>(Character vector) Optional covariates to include in the model for M.</p>
</td></tr>
<tr><td><code id="bootresid.modmed.mlm_+3A_covars.y">covars.y</code></td>
<td>
<p>(Character vector) Optional covariates to include in the model for Y.</p>
</td></tr>
<tr><td><code id="bootresid.modmed.mlm_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code><a href="#topic+modmed.mlm">modmed.mlm</a></code> to define the mediation analysis model.</p>
</td></tr>
<tr><td><code id="bootresid.modmed.mlm_+3A_type">type</code></td>
<td>
<p>Character that defines what information to extract from the model. Default and options are in <code><a href="#topic+extract.modmed.mlm">extract.modmed.mlm</a></code>.
As examples, &quot;indirect&quot; will compute the indirect effect, &quot;all&quot; will save all random and fixed effects for possible additional
computations, &quot;indirect.diff&quot; will compute the difference in the indirect effect at two values of a possible moderating variable.</p>
</td></tr>
<tr><td><code id="bootresid.modmed.mlm_+3A_modval1">modval1</code></td>
<td>
<p>(Optional) Numeric. If the model has a moderator, this value will be passed to <code><a href="#topic+extract.modmed.mlm">extract.modmed.mlm</a></code>
to compute the indirect effect or other effects at that value. See <code>extract.modmed.mlm</code> for details.</p>
</td></tr>
<tr><td><code id="bootresid.modmed.mlm_+3A_modval2">modval2</code></td>
<td>
<p>(Optional). If the model has a moderator, it is possible to compute the difference in the indirect
at two values of the moderator. If given and an appropriate option for such a difference is chosen for <code>type</code>,
this value and that of <code>modval1</code> will be passed to <code><a href="#topic+extract.modmed.mlm">extract.modmed.mlm</a></code> to compute and save the difference.
This is useful for obtaining a CI for the difference in the indirect effect at two different levels of the moderator.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function restructures data following Bauer, Pearcher, &amp; Gil (2006) and then conducts residual-based
bootstrapping in order to later obtain confidence intervals for the indirect effect and other coefficients.
The residual-based bootstrap is described in Falk, Vogel, Hammami, &amp; Miočević's manuscript (in press), but
generally follows the procedure by Carpenter, Goldstein, &amp; Rashbash (2003; See also Lai, 2021). Currently this function
does not support parallel processing. See the newer <code><a href="#topic+boot.modmed.mlm.custom">boot.modmed.mlm.custom</a></code> version for a re-write that does.
</p>


<h3>Value</h3>

<p>A list with the following elements. Note that <code>t0</code> and <code>t</code> are intended to trick the <code><a href="boot.html#topic+boot">boot</a></code>
package into working with some if its functions.
</p>

<ul>
<li><p><code>t0</code> Parameter estimates based on the dataset.
</p>
</li>
<li><p><code>t</code> Bootstrap distribution of all parameter estimates.
</p>
</li>
<li><p><code>model</code> Fitted model to restructured data as one would obtain from <code>modmed.mlm</code>.
</p>
</li>
<li><p><code>call</code> Call/arguments used when invoking this function. Useful for later extracting things like indirect effect.
</p>
</li></ul>



<h3>References</h3>

<p>Bauer, D. J., Preacher, K. J., &amp; Gil, K. M. (2006). Conceptualizing and testing random indirect		effects and moderated mediation in multilevel models: new procedures and	recommendations. Psychological Methods, 11(2), 142-163. <a href="https://doi.org/10.1037/1082-989X.11.2.142">doi:10.1037/1082-989X.11.2.142</a>
</p>
<p>Carpenter, J. R., Goldstein, H., &amp; Rasbash, J. (2003). A novel bootstrap procedure for assessing the relationship between class size and achievement. Applied Statistics, 52(4), 431-443.
</p>
<p>Falk, C. F., Vogel, T., Hammami, S., &amp; Miočević, M. (in press). Multilevel mediation analysis in R: A comparison of bootstrap and Bayesian approaches. Behavior Research Methods. <a href="https://doi.org/10.3758/s13428-023-02079-4">doi:10.3758/s13428-023-02079-4</a>  Preprint: <a href="https://doi.org/10.31234/osf.io/ync34">doi:10.31234/osf.io/ync34</a>
</p>
<p>Lai, M. (2021). Bootstrap confidence intervals for multilevel standardized effect size. Multivariate Behavioral Research, 56(4), 558-578. <a href="https://doi.org/10.1080/00273171.2020.1746902">doi:10.1080/00273171.2020.1746902</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Example data for 1-1-1 w/o moderation
data(BPG06dat)

# Note that R should be set to something MUCH larger, such as 1000 or greater.
# A low number here is chosen only so testing this example code goes relatively
# quickly
bootresid &lt;- bootresid.modmed.mlm(BPG06dat,L2ID="id", X="x", Y="y", M="m",
  R=5, random.a=TRUE, random.b=TRUE, random.cprime=TRUE,
  control=list(opt="nlm")
  )

extract.boot.modmed.mlm(bootresid, type="indirect")



</code></pre>

<hr>
<h2 id='BPG06dat'>Simulated dataset from Bauer, Preacher, and Gil (2006)</h2><span id='topic+BPG06dat'></span>

<h3>Description</h3>

<p>In supplementary materials, Bauer, Preacher, and Gil (2006) provide a simulated dataset in SAS format.
That dataset is replicated here.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>BPG06dat
</code></pre>


<h3>Format</h3>

<p>A data frame with 800 observations (from 100 subjects) and 4 variables
</p>

<dl>
<dt>id</dt><dd><p>Level 2 or subject ID</p>
</dd>
<dt>x</dt><dd><p>Predictor</p>
</dd>
<dt>m</dt><dd><p>Mediator</p>
</dd>
<dt>y</dt><dd><p>Outcome</p>
</dd>
</dl>



<h3>Source</h3>

<p><a href="https://psycnet.apa.org/doi/10.1037/1082-989X.11.2.142">https://psycnet.apa.org/doi/10.1037/1082-989X.11.2.142</a>
</p>


<h3>References</h3>

<p>Bauer, D. J., Preacher, K. J., &amp; Gil, K. M. (2006). Conceptualizing and testing random indirect effects and moderated mediation in multilevel models: New procedures and recommendations. Psychological Methods, 11(2), 142–163. <a href="https://doi.org/10.1037/1082-989X.11.2.142">doi:10.1037/1082-989X.11.2.142</a>
</p>

<hr>
<h2 id='extract.boot.modmed.mlm'>Post-processing of bootstrap results from boot.modmed.mlm</h2><span id='topic+extract.boot.modmed.mlm'></span>

<h3>Description</h3>

<p>Post-processing of bootstrap results from boot.modmed.mlm
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract.boot.modmed.mlm(
  boot.obj,
  type = c("indirect", "a", "b", "cprime", "covab", "indirect.diff", "a.diff", "b.diff",
    "cprime.diff"),
  ci.type = "perc",
  ci.conf = 0.95,
  modval1 = NULL,
  modval2 = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract.boot.modmed.mlm_+3A_boot.obj">boot.obj</code></td>
<td>
<p>Result of <code>boot</code> using <code><a href="#topic+boot.modmed.mlm">boot.modmed.mlm</a></code></p>
</td></tr>
<tr><td><code id="extract.boot.modmed.mlm_+3A_type">type</code></td>
<td>
<p>Character indicating which piece of information to extract from the model
&quot;indirect&quot;: value of the indirect effect.
&quot;a&quot;: Current value of a path.
&quot;b&quot;: Current value of b path.
&quot;cprime&quot;: Current value of c path.
&quot;covab&quot;: Random effect covariance between a and b paths, if both paths have associated random effects.
&quot;indirect.diff&quot;: difference in indirect effect at two values of the moderator (set by <code>modval1</code> and <code>modval2</code>).
&quot;a.diff&quot;: difference in a at two values of the moderator (set by <code>modval1</code> and <code>modval2</code>).
&quot;b.diff&quot;: difference in b at two values of the moderator (set by <code>modval1</code> and <code>modval2</code>).
&quot;cprime.diff&quot;: difference cprime at two values of the moderator (set by <code>modval1</code> and <code>modval2</code>).</p>
</td></tr>
<tr><td><code id="extract.boot.modmed.mlm_+3A_ci.type">ci.type</code></td>
<td>
<p>Character indicating the type of confidence interval to compute.
Currently only percentile confidence intervals are supported with &quot;perc&quot;.</p>
</td></tr>
<tr><td><code id="extract.boot.modmed.mlm_+3A_ci.conf">ci.conf</code></td>
<td>
<p>Numeric value indicating the confidence level for the interval.</p>
</td></tr>
<tr><td><code id="extract.boot.modmed.mlm_+3A_modval1">modval1</code></td>
<td>
<p>If enabled, other quantities such as the indirect effect, a, b, and cprime, will be computed
at this particular value of the moderator. Otherwise, value of these quantities is directly extracted from
the model output (i.e., these would represent values of the effects when the moderator = 0).</p>
</td></tr>
<tr><td><code id="extract.boot.modmed.mlm_+3A_modval2">modval2</code></td>
<td>
<p>Second value of the moderator at which to compute the indirect effect.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is a convenience function that computes point estimates and confidence intervals from multilevel mediation
analysis models where <code><a href="#topic+boot.modmed.mlm">boot.modmed.mlm</a></code> was used along with the <code>boot</code> package, or <code><a href="#topic+bootresid.modmed.mlm">bootresid.modmed.mlm</a></code>
was used. This function generally assumes that type=&quot;all&quot; was used when initially fitting the model, making all necessary
information available for computation of indirect effects, differences between effects, and so on. If type=&quot;all&quot;
was not used, there is no guarantee that confidence intervals for the effects of interest can be extracted.
</p>


<h3>Value</h3>

<p>A list with the following elements:
</p>

<ul>
<li><p><code>CI</code> A vector, typically two elements, that has the lower and upper endpoints requested confidence interval
for the quantity requested by <code>type</code>.
</p>
</li>
<li><p><code>est</code> Point estimate for the quantity requested by <code>type</code>.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
## Mediation for 1-1-1 model
library(boot)

data(BPG06dat)

set.seed(1234)

# Note that R should be be MUCH larger than the value used here (e.g., 1000 or
# larger). A small number is chosen just so examples run relatively fast when
# tested.

# bootstrap all fixed and random effects
boot.result&lt;-boot(BPG06dat, statistic=boot.modmed.mlm, R=5,
   L2ID = "id", X = "x", Y = "y", M = "m",
   random.a=TRUE, random.b=TRUE, random.cprime=TRUE,
   type="all",
   control=list(opt="nlm"))

# Point estimate and 95% CI for indirect effect
extract.boot.modmed.mlm(boot.result, type="indirect", ci.conf=.95)


</code></pre>

<hr>
<h2 id='extract.modmed.mlm'>Post-processing of a model fit with modmed.mlm</h2><span id='topic+extract.modmed.mlm'></span>

<h3>Description</h3>

<p>Post-processing of a model fit with modmed.mlm
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract.modmed.mlm(
  fit,
  type = c("all", "fixef", "recov", "recov.vec", "indirect", "a", "b", "cprime", "covab",
    "indirect.diff", "a.diff", "b.diff", "cprime.diff"),
  modval1 = NULL,
  modval2 = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract.modmed.mlm_+3A_fit">fit</code></td>
<td>
<p>Result of <code><a href="#topic+modmed.mlm">modmed.mlm</a></code>.</p>
</td></tr>
<tr><td><code id="extract.modmed.mlm_+3A_type">type</code></td>
<td>
<p>Character indicating which piece of information to extract from the model
&quot;all&quot;: fixed effects and var-cov matrix of random effects, as a single vector.
&quot;fixef&quot;: just fixed effects.
&quot;recov&quot;: var-cov matrix of random effects, as a matrix.
&quot;recov.vec&quot;: var-cov matrix of random effects, as a stacked vector.
&quot;indirect&quot;: value of the indirect effect.
&quot;a&quot;: Current value of a path.
&quot;b&quot;: Current value of b path.
&quot;cprime&quot;: Current value of c path.
&quot;covab&quot;: Random effect covariance between a and b paths, if both paths have associated random effects.
&quot;indirect.diff&quot;: difference in indirect effect at two values of the moderator (set by <code>modval1</code> and <code>modval2</code>).
&quot;a.diff&quot;: difference in a at two values of the moderator (set by <code>modval1</code> and <code>modval2</code>).
&quot;b.diff&quot;: difference in b at two values of the moderator (set by <code>modval1</code> and <code>modval2</code>).
&quot;cprime.diff&quot;: difference cprime at two values of the moderator (set by <code>modval1</code> and <code>modval2</code>).</p>
</td></tr>
<tr><td><code id="extract.modmed.mlm_+3A_modval1">modval1</code></td>
<td>
<p>If enabled, other quantities such as the indirect effect, a, b, and cprime, will be computed
at this particular value of the moderator. Otherwise, value of these quantities is directly extracted from
the model output (i.e., these would represent values of the effects when the moderator = 0).</p>
</td></tr>
<tr><td><code id="extract.modmed.mlm_+3A_modval2">modval2</code></td>
<td>
<p>Second value of the moderator at which to compute the indirect effect.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function extracts relevant parameter estimates from models estimated using <code><a href="#topic+modmed.mlm">modmed.mlm</a></code>.
For any of the .diff values, these are always the value of the effect at modval1 minus modval2.
</p>


<h3>Value</h3>

<p>A vector or single numeric value corresponding to the parameter estimate(s) of interest is returned.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Example data for 1-1-1 w/o moderation
data(BPG06dat)

# Fit model
fit&lt;-modmed.mlm(BPG06dat,"id", "x", "y", "m",
  random.a=TRUE, random.b=TRUE, random.cprime=TRUE)
extract.modmed.mlm(fit, type="indirect")


</code></pre>

<hr>
<h2 id='extract.modmed.mlm.brms'>Post-processing of results from modmed.mlm.brms</h2><span id='topic+extract.modmed.mlm.brms'></span>

<h3>Description</h3>

<p>Post-processing of results from modmed.mlm.brms
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract.modmed.mlm.brms(
  brms.obj,
  type = c("indirect", "a", "b", "cprime", "covab", "indirect.diff", "a.diff", "b.diff",
    "cprime.diff"),
  ci.type = c("ECI"),
  ci.conf = 0.95,
  modval1 = NULL,
  modval2 = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract.modmed.mlm.brms_+3A_brms.obj">brms.obj</code></td>
<td>
<p>Result of <code>boot.modmed.mlm</code></p>
</td></tr>
<tr><td><code id="extract.modmed.mlm.brms_+3A_type">type</code></td>
<td>
<p>Character indicating which piece of information to extract from the model
&quot;indirect&quot;: value of the indirect effect.
&quot;a&quot;: Current value of a path.
&quot;b&quot;: Current value of b path.
&quot;cprime&quot;: Current value of c path.
&quot;covab&quot;: Random effect covariance between a and b paths, if both paths have associated random effects.
&quot;indirect.diff&quot;: difference in indirect effect at two values of the moderator (set by <code>modval1</code> and <code>modval2</code>).
&quot;a.diff&quot;: difference in a at two values of the moderator (set by <code>modval1</code> and <code>modval2</code>).
&quot;b.diff&quot;: difference in b at two values of the moderator (set by <code>modval1</code> and <code>modval2</code>).
&quot;cprime.diff&quot;: difference cprime at two values of the moderator (set by <code>modval1</code> and <code>modval2</code>).</p>
</td></tr>
<tr><td><code id="extract.modmed.mlm.brms_+3A_ci.type">ci.type</code></td>
<td>
<p>Character indicating the type of confidence interval to compute. For now, just &quot;ECI&quot; is supported,
an equal-tailed credible interval.</p>
</td></tr>
<tr><td><code id="extract.modmed.mlm.brms_+3A_ci.conf">ci.conf</code></td>
<td>
<p>Numeric value indicating the confidence level for the credibility interval.</p>
</td></tr>
<tr><td><code id="extract.modmed.mlm.brms_+3A_modval1">modval1</code></td>
<td>
<p>If enabled, other quantities such as the indirect effect, a, b, and cprime, will be computed
at this particular value of the moderator. Otherwise, value of these quantities is directly extracted from
the model output (i.e., these would represent values of the effects when the moderator = 0).</p>
</td></tr>
<tr><td><code id="extract.modmed.mlm.brms_+3A_modval2">modval2</code></td>
<td>
<p>Second value of the moderator at which to compute the indirect effect.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function generally assumes that type=&quot;all&quot; was used when initially fitting the model, making all necessary
information available for computation of indirect effects, differences between effects, and so on. If type=&quot;all&quot;
was not used, there is no guarantee that credibility intervals for the effects of interest can be extracted.
</p>


<h3>Value</h3>

<p>A list with two elements:
</p>

<ul>
<li><p><code>CI</code> Point estimate (mean and median of posterior), sd, mad, credibility interval (quantiles), and other diagnostic information (rhat, ess_bulk, ess_tail).
</p>
</li>
<li><p><code>draws</code> Contains <code><a href="posterior.html#topic+draws_matrix">draws_matrix</a></code> (from the posterior package) for quantity of interest. i.e., all posterior draws, for which the user may do additional work with.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
data(BPG06dat)

# Note: 2000 iterations is just an example so that run time is not too long.
# Pick something larger (e.g., 5000+) in practice

# Only fixed effects with random intercept
fit&lt;-modmed.mlm.brms(BPG06dat,"id", "x", "y" , "m", cores = 2,
                     iter = 2000, control = list(adapt_delta=0.95),
                     seed = 1234)


res.indirect &lt;- extract.modmed.mlm.brms(fit, "indirect")
res.a &lt;- extract.modmed.mlm.brms(fit, "a")
res.b &lt;- extract.modmed.mlm.brms(fit, "b")
res.cprime &lt;- extract.modmed.mlm.brms(fit, "cprime")

# Summary of results is in CI slot, example.
# Here, 95% credibility interval is denoted by q2.5 and q97.5
res.indirect$CI

# Matrix of draws in another slot:
res.indirect$draws



</code></pre>

<hr>
<h2 id='modmed.mlm'>Model definition and estimation function for two-level (moderated) mediation</h2><span id='topic+modmed.mlm'></span>

<h3>Description</h3>

<p>Model definition and estimation function for two-level (moderated) mediation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>modmed.mlm(
  data,
  L2ID,
  X,
  Y,
  M,
  moderator = NULL,
  mod.a = FALSE,
  mod.b = FALSE,
  mod.cprime = FALSE,
  covars.m = NULL,
  covars.y = NULL,
  random.a = FALSE,
  random.b = FALSE,
  random.cprime = FALSE,
  random.mod.a = FALSE,
  random.mod.b = FALSE,
  random.mod.cprime = FALSE,
  random.mod.m = FALSE,
  random.mod.y = FALSE,
  random.covars.m = NULL,
  random.covars.y = NULL,
  method = "REML",
  control = lmeControl(maxIter = 10000, msMaxIter = 10000, niterEM = 10000, msMaxEval =
    10000, tolerance = 1e-06),
  returndata = FALSE,
  datmfun = NULL,
  data.stacked = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="modmed.mlm_+3A_data">data</code></td>
<td>
<p>Data frame in long format.</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_l2id">L2ID</code></td>
<td>
<p>(Character) Name of column that contains grouping variable in <code>data</code> (e.g., <code>"SubjectID"</code>).</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_x">X</code></td>
<td>
<p>(Character) Name of column that contains the X independent variable in <code>data</code>.</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_y">Y</code></td>
<td>
<p>(Character) Name of column that contains the Y dependent variable in <code>data</code>.</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_m">M</code></td>
<td>
<p>(Character) Name of column that contains the M mediating variable in <code>data</code>.</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_moderator">moderator</code></td>
<td>
<p>Optional Character that contains name of column that contains the moderator variable in <code>data</code></p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_mod.a">mod.a</code></td>
<td>
<p>(Logical) Add moderator to 'a' path (i.e., SmX:W, where W is the moderator)?</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_mod.b">mod.b</code></td>
<td>
<p>(Logical) Add moderator to 'b' path (i.e., SyM:W, where W is the moderator)?</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_mod.cprime">mod.cprime</code></td>
<td>
<p>(Logical) Add moderator to 'c' path (i.e., SyX:W, where W is the moderator)</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_covars.m">covars.m</code></td>
<td>
<p>(Character vector) Optional covariates to include in the model for M.</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_covars.y">covars.y</code></td>
<td>
<p>(Character vector) Optional covariates to include in the model for Y.</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_random.a">random.a</code></td>
<td>
<p>(Logical) Add random slope for 'a' path (i.e,. SmX)?</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_random.b">random.b</code></td>
<td>
<p>(Logical) Add random slope for 'b' path (i.e., SyM)?</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_random.cprime">random.cprime</code></td>
<td>
<p>(Logical) Add random slope for 'cprime' direct effect path (i.e., SyX)?</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_random.mod.a">random.mod.a</code></td>
<td>
<p>(Logical) Add random slope for 'a' path moderator?</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_random.mod.b">random.mod.b</code></td>
<td>
<p>(Logical) Add random slope for 'b' path moderator?</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_random.mod.cprime">random.mod.cprime</code></td>
<td>
<p>(Logical) Add random slope for 'c' path moderator?</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_random.mod.m">random.mod.m</code></td>
<td>
<p>(Logical) Add random slope for effect of moderator on M?</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_random.mod.y">random.mod.y</code></td>
<td>
<p>(Logical) Add random slope for effect of moderator on Y?</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_random.covars.m">random.covars.m</code></td>
<td>
<p>(Logical vector) Add random slopes for covariates on M?</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_random.covars.y">random.covars.y</code></td>
<td>
<p>(Logical vector) Add random slopes for covariates on Y?</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_method">method</code></td>
<td>
<p>Argument passed to <code><a href="nlme.html#topic+lme">lme</a></code> to control estimation method.</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_control">control</code></td>
<td>
<p>Argument passed to <code><a href="nlme.html#topic+lme">lme</a></code> that controls other estimation options.</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_returndata">returndata</code></td>
<td>
<p>(Logical) Whether to save restructured data in its own slot. Note: nlme may do this automatically. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_datmfun">datmfun</code></td>
<td>
<p>(experimental) A function that will do additional data manipulation on the restacked dataset. The function ought to take
the restacked dataset (e.g., done using <code><a href="#topic+stack_bpg">stack_bpg</a></code>) and return a dataset that can be analyzed using <code><a href="#topic+modmed.mlm">modmed.mlm</a></code> Could be used for
some kind of additional centering strategy after data are restacked (and after bootstrapped) or some other missing data handling strategy.
Either suggestion requires further study.#'</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_data.stacked">data.stacked</code></td>
<td>
<p>(experimental) Currently used internally by bootresid.modmed.mlm to feed already stacked data to the function.</p>
</td></tr>
<tr><td><code id="modmed.mlm_+3A_...">...</code></td>
<td>
<p>Pass any additional options down to <code>link[nlme]{lme}</code>. Added to handle missing values. e.g., <code>na.action = na.omit</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Implements custom function to do 1-1-1 multilevel mediation model following Bauer, Preacher, &amp; Gil (2006).
The basic procedure involves restructuring the data (<code><a href="#topic+stack_bpg">stack_bpg</a></code>) and then estimating the model using <code><a href="nlme.html#topic+lme">lme</a></code>.
The model assumes heteroscedasticity  since the mediator and outcome variable may have different error variances.
The function also supports covariates as predictors of the mediator and/or outcome, as well as moderated mediation.
Currently a single moderator variable is supported and it may moderate any/all paths of the model. However, the
the moderator is assumed continuous. While it may be possible to include moderators that are categorical, it is
not currently automated (i.e., the user will need to manually code the categorical variable as numeric).
</p>
<p>For more information for variable labels and how these will correspond to the output coefficients, see the documentation for <code><a href="#topic+stack_bpg">stack_bpg</a></code>,
as those docs contain a description of all of the variables.
</p>


<h3>Value</h3>

<p>A list with the following elements:
</p>

<ul>
<li><p><code>model</code> The fitted model using <code><a href="nlme.html#topic+lme">lme</a></code>. Use as you would a fitted model from that package.
</p>
</li>
<li><p><code>args</code> Arguments used to call the function. Useful for later automating extraction of the indirect
effect or other quantities.
</p>
</li>
<li><p><code>conv</code> Whether estimation appeared to converge.
</p>
</li>
<li><p><code>data</code> If you asked for the restructured dataset to be returned, it shall be here.
</p>
</li></ul>



<h3>References</h3>

<p>Bauer, D. J., Preacher, K. J., &amp; Gil, K. M. (2006). Conceptualizing and testing random indirect effects and moderated mediation in multilevel models: New procedures and recommendations. Psychological Methods, 11(2), 142–163. <a href="https://doi.org/10.1037/1082-989X.11.2.142">doi:10.1037/1082-989X.11.2.142</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

# Example data for 1-1-1 w/o moderation
data(BPG06dat)

# Fit model
fit&lt;-modmed.mlm(BPG06dat,"id", "x", "y", "m",
  random.a=TRUE, random.b=TRUE, random.cprime=TRUE)

extract.modmed.mlm(fit)
extract.modmed.mlm(fit, type="indirect")
extract.modmed.mlm(fit, type="a")
extract.modmed.mlm(fit, type="b")
extract.modmed.mlm(fit, type="covab")

# Vector of parameter estimates, including indirect effect
#fit$pars

# The saved, fitted model following Bauer, Preacher, &amp; Gil (2006)
summary(fit$model)



# Fit model with moderation
data(simdat)

# moderation for a path
fitmoda&lt;-modmed.mlm(simdat,"L2id", "X", "Y", "M",
  random.a=TRUE, random.b=TRUE, random.cprime=TRUE,
  moderator = "mod", mod.a=TRUE)

# moderation for b path
fitmodb&lt;-modmed.mlm(simdat,"L2id", "X", "Y", "M",
  random.a=TRUE, random.b=TRUE, random.cprime=TRUE,
  moderator = "mod", mod.b=TRUE)

# moderation for both a and b paths
fitmodab&lt;-modmed.mlm(simdat,"L2id", "X", "Y", "M",
  random.a=TRUE, random.b=TRUE, random.cprime=TRUE,
  moderator = "mod", mod.a=TRUE, mod.b=TRUE)

# moderation for both a and b paths and random effect for interaction a
fitmodab2&lt;-modmed.mlm(simdat,"L2id", "X", "Y", "M",
  random.a=TRUE, random.b=TRUE, random.cprime=TRUE,
  moderator = "mod", mod.a=TRUE, mod.b=TRUE,
  random.mod.a = TRUE, random.mod.m = TRUE)

# moderation for both a and b paths and random effect for interaction b
fitmodab3&lt;-modmed.mlm(simdat,"L2id", "X", "Y", "M",
  random.a=TRUE, random.b=TRUE, random.cprime=TRUE,
  moderator = "mod", mod.a=TRUE, mod.b=TRUE,
  random.mod.b = TRUE, random.mod.y = TRUE)

# moderation for both a and b paths and random effect for both interactions
fitmodab4&lt;-modmed.mlm(simdat,"L2id", "X", "Y", "M",
  random.a=TRUE, random.b=TRUE, random.cprime=TRUE,
  moderator = "mod", mod.a=TRUE, mod.b=TRUE,
  random.mod.a = TRUE, random.mod.b = TRUE,
  random.mod.m = TRUE, random.mod.y = TRUE)

# compare models?
# Apparently anova() is not supported as it's looking for fixed.formula,
# as it's not in the current environment
# AIC works though
AIC(fitmodab$model)
AIC(fitmodab2$model)
AIC(fitmodab3$model)
AIC(fitmodab4$model) # AIC here is best. Great simulated data we have here

extract.modmed.mlm(fitmodab4, "indirect")
extract.modmed.mlm(fitmodab4, "indirect", modval1=0) # should match above
extract.modmed.mlm(fitmodab4, "indirect", modval1=1)
extract.modmed.mlm(fitmodab4, "indirect.diff", modval1 = 0, modval2=1)
extract.modmed.mlm(fitmodab4, "indirect", modval1=0)-
  extract.modmed.mlm(fitmodab4, "indirect", modval1=1) # should match prev line

extract.modmed.mlm(fitmodab4, "a")
extract.modmed.mlm(fitmodab4, "a", modval1=0) # should match above
extract.modmed.mlm(fitmodab4, "a", modval1=1)
extract.modmed.mlm(fitmodab4, "a.diff", modval1 = 0, modval2=1)
extract.modmed.mlm(fitmodab4, "a", modval1=0)-
  extract.modmed.mlm(fitmodab4, "a", modval1=1)  # should match prev line

extract.modmed.mlm(fitmodab4, "b")
extract.modmed.mlm(fitmodab4, "b", modval1=0) # should match above
extract.modmed.mlm(fitmodab4, "b", modval1=1)
extract.modmed.mlm(fitmodab4, "b.diff", modval1 = 0, modval2=1)
extract.modmed.mlm(fitmodab4, "b", modval1=0)-
  extract.modmed.mlm(fitmodab4, "b", modval1=1)  # should match prev line

extract.modmed.mlm(fitmodab3, "indirect")
extract.modmed.mlm(fitmodab3, "indirect", modval1=0) # should match above
extract.modmed.mlm(fitmodab3, "indirect", modval1=1)
extract.modmed.mlm(fitmodab3, "indirect.diff", modval1 = 0, modval2=1)
extract.modmed.mlm(fitmodab3, "indirect", modval1=0)-
  extract.modmed.mlm(fitmodab3, "indirect", modval1=1) # should match prev line

extract.modmed.mlm(fitmodab3, "a")
extract.modmed.mlm(fitmodab3, "a", modval1=0) # should match above
extract.modmed.mlm(fitmodab3, "a", modval1=1)
extract.modmed.mlm(fitmodab3, "a.diff", modval1 = 0, modval2=1)
extract.modmed.mlm(fitmodab3, "a", modval1=0)-
  extract.modmed.mlm(fitmodab3, "a", modval1=1)  # should match prev line

extract.modmed.mlm(fitmodab3, "b")
extract.modmed.mlm(fitmodab3, "b", modval1=0) # should match above
extract.modmed.mlm(fitmodab3, "b", modval1=1)
extract.modmed.mlm(fitmodab3, "b.diff", modval1 = 0, modval2=1)
extract.modmed.mlm(fitmodab3, "b", modval1=0)-
  extract.modmed.mlm(fitmodab3, "b", modval1=1)  # should match prev line

extract.modmed.mlm(fitmodab2, "indirect")
extract.modmed.mlm(fitmodab2, "indirect", modval1=0) # should match above
extract.modmed.mlm(fitmodab2, "indirect", modval1=1)
extract.modmed.mlm(fitmodab2, "indirect.diff", modval1 = 0, modval2=1)
extract.modmed.mlm(fitmodab2, "indirect", modval1=0)-
  extract.modmed.mlm(fitmodab2, "indirect", modval1=1) # should match prev line

extract.modmed.mlm(fitmodab2, "a")
extract.modmed.mlm(fitmodab2, "a", modval1=0) # should match above
extract.modmed.mlm(fitmodab2, "a", modval1=1)
extract.modmed.mlm(fitmodab2, "a.diff", modval1 = 0, modval2=1)
extract.modmed.mlm(fitmodab2, "a", modval1=0)-
  extract.modmed.mlm(fitmodab2, "a", modval1=1)  # should match prev line

extract.modmed.mlm(fitmodab2, "b")
extract.modmed.mlm(fitmodab2, "b", modval1=0) # should match above
extract.modmed.mlm(fitmodab2, "b", modval1=1)
extract.modmed.mlm(fitmodab2, "b.diff", modval1 = 0, modval2=1)
extract.modmed.mlm(fitmodab2, "b", modval1=0)-
  extract.modmed.mlm(fitmodab2, "b", modval1=1)  # should match prev line

extract.modmed.mlm(fitmodab, "indirect")
extract.modmed.mlm(fitmodab, "indirect", modval1=0) # should match above
extract.modmed.mlm(fitmodab, "indirect", modval1=1)
extract.modmed.mlm(fitmodab, "indirect.diff", modval1 = 0, modval2=1)
extract.modmed.mlm(fitmodab, "indirect", modval1=0)-
  extract.modmed.mlm(fitmodab, "indirect", modval1=1) # should match prev line

extract.modmed.mlm(fitmodab, "a")
extract.modmed.mlm(fitmodab, "a", modval1=0) # should match above
extract.modmed.mlm(fitmodab, "a", modval1=1)
extract.modmed.mlm(fitmodab, "a.diff", modval1 = 0, modval2=1)
extract.modmed.mlm(fitmodab, "a", modval1=0)-
  extract.modmed.mlm(fitmodab, "a", modval1=1)  # should match prev line

extract.modmed.mlm(fitmodab, "b")
extract.modmed.mlm(fitmodab, "b", modval1=0) # should match above
extract.modmed.mlm(fitmodab, "b", modval1=1)
extract.modmed.mlm(fitmodab, "b.diff", modval1 = 0, modval2=1)
extract.modmed.mlm(fitmodab, "b", modval1=0)-
  extract.modmed.mlm(fitmodab, "b", modval1=1)  # should match prev line


# Example to not fail when using missing values
# Missing data handling is not that great as not all info is used, but is typical
# of default missing data handling strategies in MLM. See documentation for
# lme function in the nlme package for more options for na.action
dat.miss &lt;- BPG06dat
dat.miss$m[c(1,2,3,4)]&lt;-NA
dat.miss$y[c(5,6,7,8)]&lt;-NA
fit&lt;-modmed.mlm(dat.miss,"id", "x", "y", "m",
                random.a=TRUE, random.b=TRUE, random.cprime=TRUE,
                na.action = na.omit)

</code></pre>

<hr>
<h2 id='modmed.mlm.brms'>Custom model fitting function for a 1-1-1 (moderated) mediation for the brms code</h2><span id='topic+modmed.mlm.brms'></span>

<h3>Description</h3>

<p>Custom model fitting function for a 1-1-1 (moderated) mediation for the brms code
</p>


<h3>Usage</h3>

<pre><code class='language-R'>modmed.mlm.brms(
  data,
  L2ID,
  X,
  Y,
  M,
  moderator = NULL,
  mod.a = FALSE,
  mod.b = FALSE,
  mod.cprime = FALSE,
  covars.m = NULL,
  covars.y = NULL,
  random.a = FALSE,
  random.b = FALSE,
  random.cprime = FALSE,
  random.mod.a = FALSE,
  random.mod.b = FALSE,
  random.mod.cprime = FALSE,
  random.mod.m = FALSE,
  random.mod.y = FALSE,
  random.covars.m = NULL,
  random.covars.y = NULL,
  returndata = FALSE,
  family = gaussian,
  iter = 7000,
  control = list(adapt_delta = 0.95),
  chains = 4,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="modmed.mlm.brms_+3A_data">data</code></td>
<td>
<p>Data frame in long format.</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_l2id">L2ID</code></td>
<td>
<p>(Character) Name of column that contains grouping variable in <code>data</code> (e.g., <code>"SubjectID"</code>).</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_x">X</code></td>
<td>
<p>(Character) Name of column that contains the X independent variable in <code>data</code>.</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_y">Y</code></td>
<td>
<p>(Character) Name of column that contains the Y dependent variable in <code>data</code>.</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_m">M</code></td>
<td>
<p>(Character) Name of column that contains the M mediating variable in <code>data</code>.</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_moderator">moderator</code></td>
<td>
<p>Optional Character that contains name of column that contains the moderator variable in <code>data</code></p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_mod.a">mod.a</code></td>
<td>
<p>(Logical) Add moderator to 'a' path (i.e., SmX:W, where W is the moderator)?</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_mod.b">mod.b</code></td>
<td>
<p>(Logical) Add moderator to 'b' path (i.e., SyM:W, where W is the moderator)?</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_mod.cprime">mod.cprime</code></td>
<td>
<p>(Logical) Add moderator to 'c' path (i.e., SyX:W, where W is the moderator)</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_covars.m">covars.m</code></td>
<td>
<p>(Character vector) Optional covariates to include in the model for M. (not yet implemented for brms)</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_covars.y">covars.y</code></td>
<td>
<p>(Character vector) Optional covariates to include in the model for Y. (not yet implemented for brms)</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_random.a">random.a</code></td>
<td>
<p>(Logical) Add random slope for 'a' path (i.e,. SmX)?</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_random.b">random.b</code></td>
<td>
<p>(Logical) Add random slope for 'b' path (i.e., SyM)?</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_random.cprime">random.cprime</code></td>
<td>
<p>(Logical) Add random slope for 'cprime' direct effect path (i.e., SyX)?</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_random.mod.a">random.mod.a</code></td>
<td>
<p>(Logical) Add random slope for 'a' path moderator?</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_random.mod.b">random.mod.b</code></td>
<td>
<p>(Logical) Add random slope for 'b' path moderator?</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_random.mod.cprime">random.mod.cprime</code></td>
<td>
<p>(Logical) Add random slope for 'c' path moderator?</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_random.mod.m">random.mod.m</code></td>
<td>
<p>(Logical) Add random slope for effect of moderator on M?</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_random.mod.y">random.mod.y</code></td>
<td>
<p>(Logical) Add random slope for effect of moderator on Y?</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_random.covars.m">random.covars.m</code></td>
<td>
<p>(Logical vector) Add random slopes for covariates on M? (not yet implemented for brms)</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_random.covars.y">random.covars.y</code></td>
<td>
<p>(Logical vector) Add random slopes for covariates on Y? (not yet implemented for brms)</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_returndata">returndata</code></td>
<td>
<p>(Logical) Whether to save restructured data in its own slot. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_family">family</code></td>
<td>
<p>Argument passed to <code><a href="brms.html#topic+brm">brm</a></code> A character string naming the distribution of the response variable to be used in the model.</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_iter">iter</code></td>
<td>
<p>Argument passed to <code><a href="brms.html#topic+brm">brm</a></code> Number of total iterations.</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_control">control</code></td>
<td>
<p>Argument passed to <code><a href="brms.html#topic+brm">brm</a></code> To decrease (or eliminate at best) the number of divergent transitions that cause a bias in the obtained posterior samples.</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_chains">chains</code></td>
<td>
<p>Argument passed to <code><a href="brms.html#topic+brm">brm</a></code> Set the number of chains</p>
</td></tr>
<tr><td><code id="modmed.mlm.brms_+3A_...">...</code></td>
<td>
<p>Additional arguments to pass to <code><a href="brms.html#topic+brm">brm</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Implements custom function to do (moderated) mediation with two-level multilevel models
with Bayesian estimation via the <code><a href="brms.html#topic+brms">brms</a></code> package. Does not handle covariates at the moment.
Bayesian estimation using <code><a href="brms.html#topic+brms">brms</a></code> was studied by Falk, Vogel, Hammami &amp; Miočević (in press). It is
suggested if you use this function that you also do <code>cite("brms")</code> to figure out how to cite that package.
</p>


<h3>Value</h3>

<p>A list with the following elements:
</p>

<ul>
<li><p><code>model</code> The fitted model from <code><a href="brms.html#topic+brm">brm</a></code>. Use as you would a fitted model from that package.
</p>
</li>
<li><p><code>args</code> Arguments used to call the function. Useful for later automating extraction of the indirect
effect or other quantities.
</p>
</li>
<li><p><code>conv</code> Whether <code><a href="brms.html#topic+brm">brm</a></code> finished estimation, not diagnostic of convergence.
</p>
</li></ul>



<h3>References</h3>

<p>Falk, C. F., Vogel, T., Hammami, S., &amp; Miočević, M. (in press). Multilevel mediation analysis in R: A comparison of bootstrap and Bayesian approaches. Behavior Research Methods. <a href="https://doi.org/10.3758/s13428-023-02079-4">doi:10.3758/s13428-023-02079-4</a>  Preprint: <a href="https://doi.org/10.31234/osf.io/ync34">doi:10.31234/osf.io/ync34</a>
</p>
<p>Paul-Christian Bürkner (2017). brms: An R Package for Bayesian Multilevel Models Using Stan. Journal of Statistical Software, 80(1), 1-28. doi:10.18637/jss.v080.i01
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

# Note: 2000 iterations is just an example so that run time is not too long.
# Pick something larger (e.g., 5000+) in practice

# Example data for 1-1-1 w/o moderation
data(BPG06dat)

# random effects for a and b paths (and intercept), no moderation
# (For moderation, note that modmed.mlm syntax is typically the same)
fit&lt;-modmed.mlm.brms(BPG06dat,"id", "x", "y" , "m", cores=2,
                     random.a=TRUE, random.b=TRUE,
                     iter = 2000, control = list(adapt_delta=0.95),
                     seed = 1234)

# Examine model results and some diagnostics
summary(fit$model)

# Potential scale reduction (PSR) or Rhat guidelines vary but the largest
#  should be close to 1 ( &lt; 1.1, &lt; 1.05, &lt; 1.01).
# It is also possible to extract all of them.
max(brms::rhat(fit$model)) # largest rhat

# Fit (loo and WAIC)
brms::loo(fit$model)
brms::waic(fit$model)

# Point and interval estimates, diagnostics, for quantities of interest

# Traceplots: TODO, list conversions for how brms represents parameters with
# How these are colloquially referred to in mediation literature.
plot(fit$model, variable="b_SmX") # this is traceplot for one parameter

# Example of extracting/computing intervals for particular quantities
res.indirect &lt;- extract.modmed.mlm.brms(fit, "indirect")
res.a &lt;- extract.modmed.mlm.brms(fit, "a")
res.b &lt;- extract.modmed.mlm.brms(fit, "b")
res.cprime &lt;- extract.modmed.mlm.brms(fit, "cprime")

# Summary of results is in CI slot, example:
res.indirect$CI

# 99% CI
res.indirect &lt;- extract.modmed.mlm.brms(fit, "indirect", ci.conf = .99)


</code></pre>

<hr>
<h2 id='simdat'>A simulated dataset with moderator</h2><span id='topic+simdat'></span>

<h3>Description</h3>

<p>This simulated dataset contains a hypothetical moderating variable that is dichotomously coded.
The true model dictated that the moderator moderated both a and b paths of the mediational model,
though the strength of moderation may be small.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simdat
</code></pre>


<h3>Format</h3>

<p>A data frame with 800 observations (from 50 subjects) and 5 variables
</p>

<dl>
<dt>L2id</dt><dd><p>Level 2 or subject ID</p>
</dd>
<dt>X</dt><dd><p>Predictor</p>
</dd>
<dt>M</dt><dd><p>Mediator</p>
</dd>
<dt>Y</dt><dd><p>Outcome</p>
</dd>
<dt>mod</dt><dd><p>Moderator</p>
</dd>
</dl>


<hr>
<h2 id='stack_bpg'>Stacks data in the style of Bauer-Preacher-Gil for multilevel mediation</h2><span id='topic+stack_bpg'></span>

<h3>Description</h3>

<p>Stacks data in the style of Bauer-Preacher-Gil for multilevel mediation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stack_bpg(data, L2ID, X, Y, M,
  moderator = NULL,
  covars.m = NULL,
  covars.y = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stack_bpg_+3A_data">data</code></td>
<td>
<p>Data frame in long format.</p>
</td></tr>
<tr><td><code id="stack_bpg_+3A_l2id">L2ID</code></td>
<td>
<p>(String) Name of column that contains grouping variable in <code>data</code> (e.g., <code>"SubjectID"</code>).</p>
</td></tr>
<tr><td><code id="stack_bpg_+3A_x">X</code></td>
<td>
<p>(String) Name of column that contains the X independent variable in <code>data</code>.</p>
</td></tr>
<tr><td><code id="stack_bpg_+3A_y">Y</code></td>
<td>
<p>(String) Name of column that contains the Y dependent variable in <code>data</code>.</p>
</td></tr>
<tr><td><code id="stack_bpg_+3A_m">M</code></td>
<td>
<p>(String) Name of column that contains the M mediating variable in <code>data</code>.</p>
</td></tr>
<tr><td><code id="stack_bpg_+3A_moderator">moderator</code></td>
<td>
<p>Optional Character that contains name of column that contains the moderator variable in <code>data</code></p>
</td></tr>
<tr><td><code id="stack_bpg_+3A_covars.m">covars.m</code></td>
<td>
<p>(Character vector) Optional covariates to include in the model for M.</p>
</td></tr>
<tr><td><code id="stack_bpg_+3A_covars.y">covars.y</code></td>
<td>
<p>(Character vector) Optional covariates to include in the model for Y.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is a convenience function used primarily internally by the package to restructure data in the style of
Bauer, Preacher, and Gil (2006). The point is to allow both Y and M to be outcomes in a single column (&quot;Z&quot;),
so that both mediator and outcome models can be fit at the same time. This is necessary to estimate the covariance
between &quot;a&quot; and &quot;b&quot; paths at the same time when both have random effects. Two selector variables, &quot;Sy&quot; and &quot;Sm&quot; toggle
whether each row corresponds to the outcome or the mediator, respectively.
</p>


<h3>Value</h3>

<p>An object that is a subclass of <code>data.frame</code> is returned. In particular a <code>tbl_df</code> or &quot;tibble.&quot;
</p>
<p>So that coefficients extracted later from <code><a href="#topic+modmed.mlm">modmed.mlm</a></code> hopefully make more sense, the below lists all variables
(i.e., typical column names) for the data frame.
</p>

<ul>
<li><p><code>X</code> Independent variable.
</p>
</li>
<li><p><code>L2id</code> Level 2 ID variable.
</p>
</li>
<li><p><code>Md</code> Value of the mediator (not necessarily used due to restructuring, however).
</p>
</li>
<li><p><code>Outcome</code> Whether the row corresponds to M or Y as the outcome.
</p>
</li>
<li><p><code>Z</code> Value of the outcome variable.
</p>
</li>
<li><p><code>Sy</code> Indicator variable for Y as outcome. 0 if Y is not outcome for this row. 1 if Y is outcome for this row. In model output, this is the intercept for Y.
</p>
</li>
<li><p><code>Sm</code> Indicator variable for M as outcome. 0 if M is not outcome for this row. 1 if M is outcome for this row. In model output, this is the intercept for M.
</p>
</li>
<li><p><code>SmX</code> Value of X when M is the outcome (literally X times Sm); will be 0 when Y is outcome. In model output, this is the &quot;a&quot; path.
</p>
</li>
<li><p><code>SyX</code> Value of X when Y is the outcome (literally X times Sy); will be 0 when M is outcome. In model output, this is the &quot;cprime&quot; path (direct effect).
</p>
</li>
<li><p><code>SyM</code> Calue of M when Y is the outcome (literally M times Sy); will be 0 when M is the outcome. In model output, this is the &quot;a&quot; path.
</p>
</li>
<li><p><code>W</code> Value of any moderating variable. This may show up in output later on as &quot;SmX:W&quot; (interaction with &quot;a&quot; path) or &quot;SyM:W&quot; (interaction with &quot;b&quot; path) or &quot;SyX:W&quot;
(interaction with &quot;cprime&quot; path) depending on which path it moderates.
</p>
</li>
<li><p>If <code>covars.m</code> or <code>covars.y</code> are not null, any additional covariates will also be added to the data frame and their
original names will be retained.
</p>
</li></ul>

<p>When <code><a href="#topic+modmed.mlm">modmed.mlm</a></code> is used, any output with an &quot;re&quot; prefix will correspond to a random effect. Note that estimation with brms
will result in slightly different output than listed here. Coefficients typically have a &quot;b_&quot; prefix, and random effects are parameterized not
such that we end up with covariances, but using correlations and standard deviations for each effect.
</p>


<h3>References</h3>

<p>Bauer, D. J., Preacher, K. J., &amp; Gil, K. M. (2006). Conceptualizing and testing random indirect effects and moderated mediation in multilevel models: new procedures and	recommendations. Psychological Methods, 11(2), 142-163. <a href="https://doi.org/10.1037/1082-989X.11.2.142">doi:10.1037/1082-989X.11.2.142</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

# restructure BPG data
data(BPG06dat)

dat &lt;- stack_bpg(BPG06dat,
  "id", "x", "m", "y"
)

head(dat)

# restructure simulated data w/ moderator
data(simdat)
dat2 &lt;- stack_bpg(simdat,
  "L2id", "X", "M", "Y",
  moderator = "mod"
)

head(dat2)


</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
