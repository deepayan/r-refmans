<!DOCTYPE html><html><head><title>Help for package realTimeloads</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {realTimeloads}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#realTimeloads-package'><p>Tools For Computing Loads From Real-time Estimates of Concentration and Discharge with Code for Processing Acoustic Backscatter</p></a></li>
<li><a href='#acoustic_backscatter_processing'><p>Process acoustic backscatter from hADCP</p></a></li>
<li><a href='#attenuation_of_sound_by_water'><p>Compute attenuation of sound in water given frequency, temperature, and salinity</p></a></li>
<li><a href='#bootstrap_regression'><p>Regression parameters estimated using bootstrap resampling</p></a></li>
<li><a href='#butterworth_tidal_filter'><p>Return non-tidal signal in data after Rulh and Simpson (2005)</p></a></li>
<li><a href='#compute_load'><p>Compute load with uncertainty on concentration estimates</p></a></li>
<li><a href='#ctd2sal'><p>Compute salinity (PSU) from conductivity, water temperature, and depth</p></a></li>
<li><a href='#estimate_timeseries'><p>Compute timeseries with uncertainty from bootstrap regression</p></a></li>
<li><a href='#ExampleCode'><p>Computes sediment load per guideline from ExampleData</p></a></li>
<li><a href='#ExampleCodeSCI'><p>Computes sediment load from optical and acoustic backscatter measurements</p></a></li>
<li><a href='#ExampleData'><p>Example data used to demonstrate computation of real-time sediment loads from horizontal acoustic Doppler current profiler (hADCP)</p></a></li>
<li><a href='#hADCPLoads'><p>Compute sediment load per guideline using acoustic backscatter from processed hADCP data</p></a></li>
<li><a href='#import_data'><p>Load data from comma-delimited .txt files to list to be used in function hADCPLoads()</p></a></li>
<li><a href='#impute_data'><p>Returns x with gaps imputed using ARIMA and Decision Trees, optional uncertainty estimation using Monte Carlo resampling</p></a></li>
<li><a href='#linear_interpolation_with_time_limit'><p>Linearly interpolate timeseries time(x) onto new timesetep ti</p></a></li>
<li><a href='#near_field_correction'><p>Near-field correction of Downing et al (1995)</p></a></li>
<li><a href='#speed_of_sound'><p>Compute speed of sound in water given salinity, temperature, and depth</p></a></li>
<li><a href='#surrogate_to_analyte_interpolation'><p>Interpolate timeseries x(tx) onto y(ty)</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Analyte Flux and Load from Estimates of Concentration and
Discharge</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Flux (mass per unit time) and Load (mass) are computed from timeseries estimates of analyte concentration and discharge. Concentration timeseries are computed from regression between surrogate and user-provided analyte. Uncertainty in calculations is estimated using bootstrap resampling. Code for the processing of acoustic backscatter from horizontally profiling acoustic Doppler current profilers is provided. All methods detailed in Livsey et al (2020) &lt;<a href="https://doi.org/10.1007%2Fs12237-020-00734-z">doi:10.1007/s12237-020-00734-z</a>&gt;, Livsey et al (2023) &lt;<a href="https://doi.org/10.1029%2F2022WR033982">doi:10.1029/2022WR033982</a>&gt;, and references therein.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>Imports:</td>
<td>data.table, graphics, imputeTS, mice, signal, stats,
TideHarmonics, utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-10-17 00:03:34 UTC; livseyd</td>
</tr>
<tr>
<td>Author:</td>
<td>Daniel Livsey <a href="https://orcid.org/0000-0002-2028-6128"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre, cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Daniel Livsey &lt;livsey.daniel@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-10-18 14:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='realTimeloads-package'>Tools For Computing Loads From Real-time Estimates of Concentration and Discharge with Code for Processing Acoustic Backscatter</h2><span id='topic+realTimeloads'></span><span id='topic+realTimeloads-package'></span>

<h3>Description</h3>

<p>Code for computing loads from real-time estimates of concentration and discharge and processing of acoustic backscatter from acoustic Doppler velocimeters (ADVM) and acoustic Doppler current profilers (ADCP) per Livsey (in review)
</p>


<h3>Functions</h3>

<p><code><a href="#topic+acoustic_backscatter_processing">acoustic_backscatter_processing</a></code> Process acoustic backscatter from horizontally profiling ADVM/ADCP
</p>
<p><code><a href="#topic+attenuation_of_sound_by_water">attenuation_of_sound_by_water</a></code> Computes attenuation of sound in water for acoustic backscatter processing
</p>
<p><code><a href="#topic+bootstrap_regression">bootstrap_regression</a></code> Compute regression parameters with uncertainty from analyte(surrogate(s))
</p>
<p><code><a href="#topic+butterworth_tidal_filter">butterworth_tidal_filter</a></code> Estimate non-tidal variabilty using butterworth filter of Rulh and Simpson (2005)
</p>
<p><code><a href="#topic+compute_load">compute_load</a></code> Compute analyte load from surrogate, regression, and discharge data
</p>
<p><code><a href="#topic+ctd2sal">ctd2sal</a></code> Convert conductance to salinity in PSU
</p>
<p><code><a href="#topic+estimate_timeseries">estimate_timeseries</a></code> Estimate timeseries with uncertainty using outputs from bootstrap_regression() and timeseries of surrogate(s)
</p>
<p><code><a href="#topic+ExampleCode">ExampleCode</a></code> Process acoustic backscatter from synthetic data detailed in Livsey et al (in review)
</p>
<p><code><a href="#topic+ExampleCodeSCI">ExampleCodeSCI</a></code> Compute load from synthetic data using &quot;Sediment Composition Index&quot; (SCI) after Livsey et al (2023)
</p>
<p><code><a href="#topic+hADCPLoads">hADCPLoads</a></code> Process acoustic backscatter from user data and compute load using list generated by import_Data()
</p>
<p><code><a href="#topic+import_data">import_data</a></code> Import data from files in user-specified folder for use in hADCPLoads()
</p>
<p><code><a href="#topic+impute_data">impute_data</a></code> impute non-tidal or tidal data using ARIMA and decision tree algorithms
</p>
<p><code><a href="#topic+linear_interpolation_with_time_limit">linear_interpolation_with_time_limit</a></code> Interpolate timeseries onto new timestep, Nan returned when nearest observation exceeds time limit specified
</p>
<p><code><a href="#topic+near_field_correction">near_field_correction</a></code> Compute near-field correction for acoustic backscatter processing
</p>
<p><code><a href="#topic+speed_of_sound">speed_of_sound</a></code> Compute speed of sound in water for acoustic backscatter processing
</p>
<p><code><a href="#topic+surrogate_to_analyte_interpolation">surrogate_to_analyte_interpolation</a></code> Pair surrogate timeseries t(x) to analyte sample times t(y)
</p>


<h3>Author(s)</h3>

<p>Daniel Livsey (2023) ORCID: 0000-0002-2028-6128
</p>


<h3>References</h3>

<p>Livsey, D.N. (in review). National Industry Guidelines for hydrometric monitoring–Part 12: Application of acoustic Doppler velocity meters to measure suspended-sediment load. Bureau of Meteorology. Melbourne, Australia.
</p>

<hr>
<h2 id='acoustic_backscatter_processing'>Process acoustic backscatter from hADCP</h2><span id='topic+acoustic_backscatter_processing'></span>

<h3>Description</h3>

<p>Processes acoustic backscatter from horizontally profiling ADCP (hADCP). Returns attenuation of sound due to water and suspended-sediment. Applies all corrections to acoustic backscatter detailed in the guideline.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>acoustic_backscatter_processing(
  Site,
  ADCP,
  Height,
  Sonde,
  Echo_Intensity_Beam_1,
  Echo_Intensity_Beam_2,
  Instrument_Noise_Level = NULL,
  Include_Rayleigh = FALSE,
  Include_near_field_correction = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="acoustic_backscatter_processing_+3A_site">Site</code></td>
<td>
<p>Data frame with site, local vertical datum, and ADCP elevation information
</p>

<dl>
<dt>Site_name</dt><dd><p>Site name (string)</p>
</dd>
<dt>Site_number</dt><dd><p>Unique site code (string)</p>
</dd>
<dt>ADCP_elevation_above_bed_m</dt><dd><p>Elevation of the ADCP above the bed (m)</p>
</dd>
<dt>ADCP_elevation_above_gauge_datum_m</dt><dd><p>Elevation of the ADCP above local gauge datum (m)</p>
</dd>
<dt>Distance_of_gauge_datum_below_thalweg_m</dt><dd><p>Distance from local gauge datum to lower point in cross-section (m)</p>
</dd>
<dt>Start_date_and_time</dt><dd><p>Installation date of ADCP (time, POSIXct)</p>
</dd>
<dt>End_date_and_time</dt><dd><p>Date if/when ADCP is moved vertically (time, POSIXct)</p>
</dd>
<dt>Comment</dt><dd><p>User comment (string)</p>
</dd>
</dl>
</td></tr>
<tr><td><code id="acoustic_backscatter_processing_+3A_adcp">ADCP</code></td>
<td>
<p>Data frame with various readings from ADCP
</p>

<dl>
<dt>Site_number</dt><dd><p>Unique site code (string)</p>
</dd>
<dt>time</dt><dd><p>Date and time (time, POSIXct)</p>
</dd>
<dt>Ensemble</dt><dd><p>Measurment ensemble number (integer)</p>
</dd>
<dt>Accoustic_Frequency_kHz</dt><dd><p>Acoustic frequency of ADCP (kHz)</p>
</dd>
<dt>Transducer_radius_m</dt><dd><p>Radius of ADCP transducer (m)</p>
</dd>
<dt>Beam_angle_degrees</dt><dd><p>Angle of beam relative to normal (degrees)</p>
</dd>
<dt>Beam_aspect_ratio</dt><dd><p>Ratio of beam radius to beam length (-)</p>
</dd>
<dt>Range_to_bed_of_acoustic_beams_m</dt><dd><p>Normal range to bed, optional (m)</p>
</dd>
<dt>Range_to_water_surface_of_acoustic_beams_m</dt><dd><p>Normal range to water surface, optional (m)</p>
</dd>
<dt>Number_of_Cells</dt><dd><p>Number of measurement cells along beam (integer)</p>
</dd>
<dt>Bin_Size_m</dt><dd><p>Cell width measured normal to ADCP (m)</p>
</dd>
<dt>Blanking_distance_m</dt><dd><p>Blanking distance measured normal to ADCP (m)</p>
</dd>
<dt>Instrument_serial_number</dt><dd><p>Serial number of ADCP instrument (string)</p>
</dd>
<dt>CPU_serial_number</dt><dd><p>Serial number of ADCP CPU (string)</p>
</dd>
<dt>Ambient_Noise_Level_Beam_1_Counts</dt><dd><p>Ambient noise level for beam 1, optional (counts)</p>
</dd>
<dt>Ambient_Noise_Level_Beam_2_Counts</dt><dd><p>Ambient noise level for beam 2, optional (counts)</p>
</dd>
<dt>Distance_to_Bin_1_mid_point_m</dt><dd><p>Reported distance normal to ADCP to midpoint of bin/cell (m)</p>
</dd>
<dt>Distance_to_surface_m</dt><dd><p>Reported depth of ADCP from vertical beam, optional (m)</p>
</dd>
<dt>Speed_of_sound_m_per_s</dt><dd><p>Speed of sound used by ADCP in the field (m/s)</p>
</dd>
<dt>Temperature_degC</dt><dd><p>Temperature recorded by ADCP (degrees C)</p>
</dd>
<dt>Pressure_dbar</dt><dd><p>Pressure recorded by ADCP (dBar)</p>
</dd>
<dt>Salinity_PSU</dt><dd><p>Salinity in PSU recorded or assumed in ADCP data file, optional (PSU)</p>
</dd>
<dt>Distance_to_surface_m</dt><dd><p>Distance to water surface reported by vertical beam of ADCP (m)</p>
</dd>
<dt>Power_supply_voltage</dt><dd><p>Power to ADCP (V)</p>
</dd>
</dl>
</td></tr>
<tr><td><code id="acoustic_backscatter_processing_+3A_height">Height</code></td>
<td>
<p>Data frame with timeseries of river height
</p>

<dl>
<dt>time</dt><dd><p>Date and time (time, POSIXct)</p>
</dd>
<dt>Height_m</dt><dd><p>Water surface elevation above gauge datum (m)</p>
</dd>
<dt>Site_number</dt><dd><p>Unique site code (string)</p>
</dd>
</dl>
</td></tr>
<tr><td><code id="acoustic_backscatter_processing_+3A_sonde">Sonde</code></td>
<td>
<p>Data frame with timeseries of conductivity, temperature, and depth from sonde
</p>

<dl>
<dt>time</dt><dd><p>Date and time (time, POSIXct)</p>
</dd>
<dt>Water_Temperature_degC</dt><dd><p>Temperature (degrees C)</p>
</dd>
<dt>Conductivity_uS_per_cm</dt><dd><p>Conductivity (microS/cm)</p>
</dd>
<dt>Pressure_dbar</dt><dd><p>Pressure (dbar)</p>
</dd>
<dt>Site_number</dt><dd><p>Unique site code (string)</p>
</dd>
</dl>
</td></tr>
<tr><td><code id="acoustic_backscatter_processing_+3A_echo_intensity_beam_1">Echo_Intensity_Beam_1</code></td>
<td>
<p>Data frame of acoustic backscatter measurements from beam 2
</p>

<dl>
<dt>Site_number</dt><dd><p>Unique site code (string)</p>
</dd>
<dt>time</dt><dd><p>Date and time (time, POSIXct)</p>
</dd>
<dt>Echo_Intensity_Counts_cell_n</dt><dd><p>Acoustic backscatter in nth cell (counts)</p>
</dd>
</dl>
</td></tr>
<tr><td><code id="acoustic_backscatter_processing_+3A_echo_intensity_beam_2">Echo_Intensity_Beam_2</code></td>
<td>
<p>Data frame of acoustic backscatter measurements from beam 2
</p>

<dl>
<dt>Site_number</dt><dd><p>Unique site code (string)</p>
</dd>
<dt>time</dt><dd><p>Date and time (time, POSIXct)</p>
</dd>
<dt>Echo_Intensity_Counts_cell_n</dt><dd><p>Acoustic backscatter in nth cell (counts)</p>
</dd>
</dl>
</td></tr>
<tr><td><code id="acoustic_backscatter_processing_+3A_instrument_noise_level">Instrument_Noise_Level</code></td>
<td>
<p>Estimate of noise level, recommended if ambient noise level is not recorded (counts)</p>
</td></tr>
<tr><td><code id="acoustic_backscatter_processing_+3A_include_rayleigh">Include_Rayleigh</code></td>
<td>
<p>Logical to include data within Rayleigh Distance for processing of acoustic backsactter</p>
</td></tr>
<tr><td><code id="acoustic_backscatter_processing_+3A_include_near_field_correction">Include_near_field_correction</code></td>
<td>
<p>Logical to include near-field correction of Downing et al (1995)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List with processed data, all variable names and units are written-out in list items, see Livsey (in review) for details of each variable
</p>


<h3>Author(s)</h3>

<p>Daniel Livsey (2023) ORCID: 0000-0002-2028-6128
</p>


<h3>References</h3>

<p>Livsey, D.N. (in review). National Industry Guidelines for hydrometric monitoring–Part 12: Application of acoustic Doppler velocity meters to measure suspended-sediment load. Bureau of Meteorology. Melbourne, Australia.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>InputData &lt;- realTimeloads::ExampleData
Site &lt;- InputData$Site
ADCP &lt;- InputData$ADCP
Height &lt;- InputData$Height
Sonde &lt;- InputData$Sonde
EIa &lt;- InputData$Echo_Intensity
# example code assumes backscatter is equal across beams
EIb &lt;- InputData$Echo_Intensity
Output &lt;- acoustic_backscatter_processing(Site,ADCP,Height,Sonde,EIa,EIb)
</code></pre>

<hr>
<h2 id='attenuation_of_sound_by_water'>Compute attenuation of sound in water given frequency, temperature, and salinity</h2><span id='topic+attenuation_of_sound_by_water'></span>

<h3>Description</h3>

<p>Computes attenuation of sound in water per Ainslie and McColm (1998)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>attenuation_of_sound_by_water(freq, temp, sal)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="attenuation_of_sound_by_water_+3A_freq">freq</code></td>
<td>
<p>frequency of sound (Hz)</p>
</td></tr>
<tr><td><code id="attenuation_of_sound_by_water_+3A_temp">temp</code></td>
<td>
<p>Water temperature (degrees C)</p>
</td></tr>
<tr><td><code id="attenuation_of_sound_by_water_+3A_sal">sal</code></td>
<td>
<p>Salinity (PSU)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>attenuation of sound in water (dB/m), divide by 20*log10(exp(1)) to convert to Nepers/m
</p>


<h3>Author(s)</h3>

<p>Daniel Livsey (2023) ORCID: 0000-0002-2028-6128
</p>


<h3>References</h3>

<p>Ainslie, M. A., &amp; McColm, J. G. (1998). A simplified formula for viscous and chemical absorption in sea water. The Journal of the Acoustical Society of America, 103(3), 1671-1672.
</p>
<p>Author modified Matlab code from David Schoellhamer
</p>


<h3>Examples</h3>

<pre><code class='language-R'>InputData &lt;- realTimeloads::ExampleData
freq &lt;- InputData$ADCP$Accoustic_Frequency_kHz*1000
cond &lt;-InputData$Sonde$Conductivity_uS_per_cm
temp &lt;- InputData$Sonde$Water_Temperature_degC
dbar &lt;- InputData$Sonde$Pressure_dbar
sal &lt;- ctd2sal(cond,temp,dbar)
aw &lt;- attenuation_of_sound_by_water(freq,temp,sal) # dB/m
awNp &lt;- attenuation_of_sound_by_water(freq,temp,sal)/(20*log10(exp(1))) # Np/m
</code></pre>

<hr>
<h2 id='bootstrap_regression'>Regression parameters estimated using bootstrap resampling</h2><span id='topic+bootstrap_regression'></span>

<h3>Description</h3>

<p>Computes uncertainty in regression parameters of y(x) after Rustomji and Wilkinson (2008)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bootstrap_regression(Calibration, fit_eq, fit_glm = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bootstrap_regression_+3A_calibration">Calibration</code></td>
<td>
<p>data frame with surrogate(s) followed by analyte in last column</p>
</td></tr>
<tr><td><code id="bootstrap_regression_+3A_fit_eq">fit_eq</code></td>
<td>
<p>equation used to fit y(x), string (e.g, &quot;y ~ x + x2&quot;, &quot;y ~ x&quot;, &quot;log10(y)~x')</p>
</td></tr>
<tr><td><code id="bootstrap_regression_+3A_fit_glm">fit_glm</code></td>
<td>
<p>logical to use Generalized Linear Models for models with factor (i.e., categorical) predictors</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list with bootstrap regression parameters and list output from stats::lm()
</p>


<h3>Warning</h3>

<p>User should inspect regression residuals and relevant statistics to ensure model form is reasonable, suggested reading: regression diagnostics in Statistical Methods in Water Resources (https://doi.org/10.3133/tm4a3).
</p>
<p>One can call plot(fit) to view various regression diagnostic plots
</p>


<h3>Note</h3>

<p>Bias Correction Factor (BCF) is only relevant when analyte is transformed to log units, see https://doi.org/10.3133/tm4a3
to convert a model that used log(analyte) back to linear units use: analyte = 10^(f(surrogates)) x BCF
</p>


<h3>Author(s)</h3>

<p>Daniel Livsey (2023) ORCID: 0000-0002-2028-6128
</p>


<h3>References</h3>

<p>Rustomji, P., &amp; Wilkinson, S. N. (2008). Applying bootstrap resampling to quantify uncertainty in fluvial suspended sediment loads estimated using rating curves. Water resources research, 44(9).https://doi.org/10.1029/2007WR006088
</p>
<p>Helsel, D.R., Hirsch, R.M., Ryberg, K.R., Archfield, S.A., and Gilroy, E.J., 2020, #' Statistical methods in water resources: U.S. Geological Survey Techniques and Methods, book 4, chap. A3, 458 p. https://doi.org/10.3133/tm4a3
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# linear model
x &lt;- 1:10
y &lt;- 0.5*x + 10
boot &lt;- bootstrap_regression(data.frame(x,y),"y~x")
# polynomial model, call to I() needed for squaring x in equation string
x &lt;- 1:10
y &lt;- x + x^2
boot &lt;- bootstrap_regression(data.frame(x,y),"y ~ x+I(x^2)")
# power law model
# BCF returned since y is transformed to log units
x &lt;- 1:10
y &lt;- x^0.3
boot &lt;- bootstrap_regression(data.frame(x,y),"log10(y)~log10(x)")
# multivariate model
a &lt;- 1:10
b &lt;- a*2
c &lt;- a^2*b^3
boot &lt;- bootstrap_regression(data.frame(a,b,c),"log10(c)~log10(a)+log10(b)")

</code></pre>

<hr>
<h2 id='butterworth_tidal_filter'>Return non-tidal signal in data after Rulh and Simpson (2005)</h2><span id='topic+butterworth_tidal_filter'></span>

<h3>Description</h3>

<p>Applies a Butterworth filter with a 30-hour stop period and a 40-hour pass period
</p>


<h3>Usage</h3>

<pre><code class='language-R'>butterworth_tidal_filter(time, x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="butterworth_tidal_filter_+3A_time">time</code></td>
<td>
<p>time for x (time, POSIXct)</p>
</td></tr>
<tr><td><code id="butterworth_tidal_filter_+3A_x">x</code></td>
<td>
<p>any quantity, for example discharge (double)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>non-tidal signal in x with data affected by filter ringing removed
</p>


<h3>Author(s)</h3>

<p>Daniel Livsey (2023) ORCID: 0000-0002-2028-6128
</p>


<h3>References</h3>

<p>Ruhl, C. A., &amp; Simpson, M. R. (2005). Computation of discharge using the index-velocity method in tidally affected areas (Vol. 2005). Denver: US Department of the Interior, US Geological Survey. https://pubs.usgs.gov/sir/2005/5004/sir20055004.pdf
</p>


<h3>Examples</h3>

<pre><code class='language-R'>time &lt;- realTimeloads::ExampleData$Height$time
x &lt;- realTimeloads::ExampleData$Height$Height_m
xf &lt;- butterworth_tidal_filter(time,x)
</code></pre>

<hr>
<h2 id='compute_load'>Compute load with uncertainty on concentration estimates</h2><span id='topic+compute_load'></span>

<h3>Description</h3>

<p>Compute load with uncertainty on concentration estimates from bootstrap regression after Rustomji and Wilkinson (2008)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compute_load(Surrogate, Discharge, Regression, period = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="compute_load_+3A_surrogate">Surrogate</code></td>
<td>
<p>data frame with time (PosixCt) and surrogate(s) (x,...)</p>
</td></tr>
<tr><td><code id="compute_load_+3A_discharge">Discharge</code></td>
<td>
<p>data frame with time (PosixCt) and discharge in cubic meters per second</p>
</td></tr>
<tr><td><code id="compute_load_+3A_regression">Regression</code></td>
<td>
<p>data frame from bootstrap_regression() that determines analyte(surrogate)</p>
</td></tr>
<tr><td><code id="compute_load_+3A_period">period</code></td>
<td>
<p>two element vector time (PosixCt) indicating period over which load is computed</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list with data frames of estimated concentration and flux used to compute load (i.e., the sum of flux)
</p>


<h3>Note</h3>

<p>Surrogate and Discharge time series can be on different time steps
</p>
<p>If period is NULL, computes load over time in Surrogate
</p>


<h3>Warning</h3>

<p>Discharge should be in cubic meters per second
</p>
<p>Analyte concentration estimated from surrogate should be in milligrams per second
</p>


<h3>Author(s)</h3>

<p>Daniel Livsey (2023) ORCID: 0000-0002-2028-6128
</p>


<h3>References</h3>

<p>Rustomji, P., &amp; Wilkinson, S. N. (2008). Applying bootstrap resampling to quantify uncertainty in fluvial suspended sediment loads estimated using rating curves. Water resources research, 44(9).https://doi.org/10.1029/2007WR006088
</p>
<p>Helsel, D.R., Hirsch, R.M., Ryberg, K.R., Archfield, S.A., and Gilroy, E.J., 2020, #' Statistical methods in water resources: U.S. Geological Survey Techniques and Methods, book 4, chap. A3, 458 p. https://doi.org/10.3133/tm4a3
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
Turbidity_FNU &lt;- realTimeloads::ExampleData$Sonde$Turbidity
TSS_mg_per_l &lt;- realTimeloads::ExampleData$Sediment_Samples$SSCpt_mg_per_liter
Discharge &lt;- realTimeloads::ExampleData$Discharge
Calibration &lt;- data.frame(Turbidity_FNU,TSS_mg_per_l)
time &lt;- realTimeloads::ExampleData$Sonde$time
Surrogate &lt;- data.frame(time,Turbidity_FNU)
Regression = bootstrap_regression(Calibration,'TSS_mg_per_l~Turbidity_FNU')
period &lt;- c(as.POSIXct("2000-02-16 AEST"),as.POSIXct("2000-03-16 AEST"))
Output &lt;- compute_load(Surrogate,Discharge,Regression,period)

</code></pre>

<hr>
<h2 id='ctd2sal'>Compute salinity (PSU) from conductivity, water temperature, and depth</h2><span id='topic+ctd2sal'></span>

<h3>Description</h3>

<p>Computes salinity from conductivity, water temperature, and depth.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ctd2sal(cond, temp, dbar)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ctd2sal_+3A_cond">cond</code></td>
<td>
<p>Conductance (microS/cm)</p>
</td></tr>
<tr><td><code id="ctd2sal_+3A_temp">temp</code></td>
<td>
<p>Water temperature (degrees C)</p>
</td></tr>
<tr><td><code id="ctd2sal_+3A_dbar">dbar</code></td>
<td>
<p>Pressure (dBar) or water depth (m)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Salinity in PSU
</p>


<h3>Warning</h3>

<p>If specific conductivity is returned from the sonde, the temperature at which specific conductivity is computed should be utilized
</p>


<h3>Author(s)</h3>

<p>Daniel Livsey (2023) ORCID: 0000-0002-2028-6128
</p>


<h3>References</h3>

<p>Fofonoff, N. P., &amp; Millard Jr, R. C. (1983). Algorithms for the computation of fundamental properties of seawater.
</p>
<p>Chen, C. T. A., &amp; Millero, F. J. (1986). Thermodynamic properties for natural waters covering only the limnological range 1. Limnology and Oceanography, 31(3), 657-662.
</p>
<p>Hill, K., Dauphinee, T., &amp; Woods, D. (1986). The extension of the Practical Salinity Scale 1978 to low salinities. IEEE Journal of Oceanic Engineering, 11(1), 109-112.
</p>
<p>Author modified Matlab code from David Schoellhamer
</p>


<h3>Examples</h3>

<pre><code class='language-R'>Sonde &lt;- realTimeloads::ExampleData$Sonde
sal &lt;- ctd2sal(Sonde$Conductivity_uS_per_cm,Sonde$Water_Temperature_degC,Sonde$Pressure_dbar)
</code></pre>

<hr>
<h2 id='estimate_timeseries'>Compute timeseries with uncertainty from bootstrap regression</h2><span id='topic+estimate_timeseries'></span>

<h3>Description</h3>

<p>Compute uncertainty on timeseries from bootstrap regression after Rustomji and Wilkinson (2008)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_timeseries(Surrogate, Regression)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estimate_timeseries_+3A_surrogate">Surrogate</code></td>
<td>
<p>data frame with time (PosixCt) and surrogate(s) (x,...)</p>
</td></tr>
<tr><td><code id="estimate_timeseries_+3A_regression">Regression</code></td>
<td>
<p>data frame from bootstrap_regression() that determines analyte(surrogate)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list with inputs and uncertainty on timeseries estimated from Regression
</p>


<h3>Author(s)</h3>

<p>Daniel Livsey (2023) ORCID: 0000-0002-2028-6128
</p>


<h3>References</h3>

<p>Rustomji, P., &amp; Wilkinson, S. N. (2008). Applying bootstrap resampling to quantify uncertainty in fluvial suspended sediment loads estimated using rating curves. Water resources research, 44(9).https://doi.org/10.1029/2007WR006088
</p>
<p>Helsel, D.R., Hirsch, R.M., Ryberg, K.R., Archfield, S.A., and Gilroy, E.J., 2020, #' Statistical methods in water resources: U.S. Geological Survey Techniques and Methods, book 4, chap. A3, 458 p. https://doi.org/10.3133/tm4a3
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
Turbidity_FNU &lt;- realTimeloads::ExampleData$Sonde$Turbidity
TSS_mg_per_l &lt;- realTimeloads::ExampleData$Sediment_Samples$SSCpt_mg_per_liter
Calibration &lt;- data.frame(Turbidity_FNU,TSS_mg_per_l)
time &lt;- realTimeloads::ExampleData$Sonde$time
Surrogate &lt;- data.frame(time,Turbidity_FNU)
Regression = bootstrap_regression(Calibration,'TSS_mg_per_l~Turbidity_FNU')
Output &lt;- estimate_timeseries(Surrogate,Regression)

</code></pre>

<hr>
<h2 id='ExampleCode'>Computes sediment load per guideline from ExampleData</h2><span id='topic+ExampleCode'></span>

<h3>Description</h3>

<p>Computes sediment load per guideline from ExampleData
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ExampleCode()
</code></pre>


<h3>Value</h3>

<p>list with data frames of estimated concentration and flux along with data used in regression and surrogate timeseries
</p>


<h3>Author(s)</h3>

<p>Daniel Livsey (2023) ORCID: 0000-0002-2028-6128
</p>


<h3>References</h3>

<p>Livsey, D.N. (in review). National Industry Guidelines for hydrometric monitoring–Part 12: Application of acoustic Doppler velocity meters to measure suspended-sediment load. Bureau of Meteorology. Melbourne, Australia.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+realTimeloads">realTimeloads</a></code> Package help file
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
Output &lt;- ExampleCode()

</code></pre>

<hr>
<h2 id='ExampleCodeSCI'>Computes sediment load from optical and acoustic backscatter measurements</h2><span id='topic+ExampleCodeSCI'></span>

<h3>Description</h3>

<p>Computes sediment load per guideline from optical and acoustic backscatter measurements combined to the &quot;Sediment Composition Index&quot; (SCI) per Livsey et al (2023)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ExampleCodeSCI()
</code></pre>


<h3>Value</h3>

<p>total load with uncertainty computed from estimates of concentration from SCI
</p>


<h3>Author(s)</h3>

<p>Daniel Livsey (2023) ORCID: 0000-0002-2028-6128
</p>


<h3>References</h3>

<p>Livsey, D.N. (in review). National Industry Guidelines for hydrometric monitoring–Part 12: Application of acoustic Doppler velocity meters to measure suspended-sediment load. Bureau of Meteorology. Melbourne, Australia.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+realTimeloads">realTimeloads</a></code> Package help file
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
Output &lt;- ExampleCodeSCI()

</code></pre>

<hr>
<h2 id='ExampleData'>Example data used to demonstrate computation of real-time sediment loads from horizontal acoustic Doppler current profiler (hADCP)</h2><span id='topic+ExampleData'></span>

<h3>Description</h3>

<p>Synthetic dataset from modeled sediment transport and acoustic scattering detailed in the Appendices of Livsey (in review) Following dataframes are provided in list
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ExampleData
</code></pre>


<h3>Format</h3>



<h4><code>Site</code> , Site, site datum, and ADCP elevation information</h4>


<dl>
<dt>Site_name</dt><dd><p>Site name (string)</p>
</dd>
<dt>Site_number</dt><dd><p>Unique site code (string)</p>
</dd>
<dt>ADCP_elevation_above_bed_m</dt><dd><p>Elevation of the ADCP above the bed (m)</p>
</dd>
<dt>ADCP_elevation_above_gauge_datum_m</dt><dd><p>Elevation of the ADCP above local gauge datum (m)</p>
</dd>
<dt>Distance_of_gauge_datum_below_thalweg_m</dt><dd><p>Distance from local gauge datum to lower point in cross-section (m)</p>
</dd>
<dt>Start_date_and_time</dt><dd><p>Installation date of ADCP (time, POSIXct)</p>
</dd>
<dt>End_date_and_time</dt><dd><p>Date if/when ADCP is moved vertically (time, POSIXct)</p>
</dd>
<dt>Comment</dt><dd><p>User comment (string)</p>
</dd>
</dl>




<h4><code>ADCP</code> , ADCP readings except acoustic backscatter</h4>


<dl>
<dt>Site_number</dt><dd><p>Unique site code (string)</p>
</dd>
<dt>time</dt><dd><p>Date and time (time, POSIXct)</p>
</dd>
<dt>Ensemble</dt><dd><p>Measurment ensemble number (integer)</p>
</dd>
<dt>Accoustic_Frequency_kHz</dt><dd><p>Acoustic frequency of ADCP (kHz)</p>
</dd>
<dt>Transducer_radius_m</dt><dd><p>Radius of ADCP transducer (m)</p>
</dd>
<dt>Beam_angle_degrees</dt><dd><p>Angle of beam relative to normal (degrees)</p>
</dd>
<dt>Beam_aspect_ratio</dt><dd><p>Ratio of beam radius to beam length (-)</p>
</dd>
<dt>Number_of_Cells</dt><dd><p>Number of measurement cells along beam (integer)</p>
</dd>
<dt>Bin_Size_m</dt><dd><p>Cell width measured normal to ADCP (m)</p>
</dd>
<dt>Blanking_distance_m</dt><dd><p>Blanking distance measured normal to ADCP (m)</p>
</dd>
<dt>Instrument_serial_number</dt><dd><p>Serial number of ADCP instrument (string)</p>
</dd>
<dt>CPU_serial_number</dt><dd><p>Serial number of ADCP CPU (string)</p>
</dd>
<dt>Ambient_Noise_Level_Beam_1_Counts</dt><dd><p>Ambient noise level for beam 1 (counts)</p>
</dd>
<dt>Ambient_Noise_Level_Beam_2_Counts</dt><dd><p>Ambient noise level for beam 2 (counts)</p>
</dd>
<dt>Distance_to_Bin_1_mid_point_m</dt><dd><p>Reported distance normal to ADCP to midpoint of bin/cell (m)</p>
</dd>
<dt>Speed_of_sound_m_per_s</dt><dd><p>Speed of sound used by ADCP in the field (m/s)</p>
</dd>
<dt>Temperature_degC</dt><dd><p>Temperature recorded by ADCP (degrees C)</p>
</dd>
<dt>Pressure_dbar</dt><dd><p>Pressure recorded by ADCP (dBar)</p>
</dd>
<dt>Distance_to_surface_m</dt><dd><p>Distance to water surface reported by vertical beam of ADCP (m)</p>
</dd>
<dt>Power_supply_voltage</dt><dd><p>Power to ADCP (V)</p>
</dd>
</dl>




<h4><code>Echo_Intensity</code> , Acoustic backscatter measurements from ADCP</h4>


<dl>
<dt>Site_number</dt><dd><p>Unique site code (string)</p>
</dd>
<dt>time</dt><dd><p>Date and time (time, POSIXct)</p>
</dd>
<dt>Echo_Intensity_Counts_cell_n</dt><dd><p>Acoustic backscatter in nth cell (counts)</p>
</dd>
</dl>




<h4><code>Sonde</code> , Conductivity, temperature, and depth from sonde</h4>


<dl>
<dt>time</dt><dd><p>Date and time (time, POSIXct)</p>
</dd>
<dt>Water_Temperature_degC</dt><dd><p>Temperature (degrees C)</p>
</dd>
<dt>Conductivity_uS_per_cm</dt><dd><p>Conductivity (microS/cm)</p>
</dd>
<dt>Pressure_dbar</dt><dd><p>Pressure (dbar)</p>
</dd>
<dt>Turbidity_FNU</dt><dd><p>Turbidity (FNU)</p>
</dd>
<dt>Site_number</dt><dd><p>Unique site code (string)</p>
</dd>
</dl>




<h4><code>Height</code> , River height in meters referenced to gauge datum</h4>


<dl>
<dt>time</dt><dd><p>Date and time (time, POSIXct)</p>
</dd>
<dt>Height_m</dt><dd><p>Water surface elevation above gauge datum (m)</p>
</dd>
<dt>Site_number</dt><dd><p>Unique site code (string)</p>
</dd>
</dl>




<h4><code>Discharge</code>, Discharge timeseries in cubic meters per second</h4>


<dl>
<dt>time</dt><dd><p>Date and time (time, POSIXct)</p>
</dd>
<dt>Discharge_m_cubed_per_s</dt><dd><p>Dischage (cubic meters per second)</p>
</dd>
<dt>Site_number</dt><dd><p>Unique site code (string)</p>
</dd>
</dl>




<h4><code>Sediment_Samples</code> , Measured sediment concentration in milligrams per liter (SSC or TSS)</h4>


<dl>
<dt>time</dt><dd><p>Date and time (time, POSIXct)</p>
</dd>
<dt>SSCxs_mg_per_liter</dt><dd><p>Concentration of suspended-sediment in milligrams per liter, depth-averaged and velocity weighted average for cross-section</p>
</dd>
<dt>SSCpt_mg_per_liter</dt><dd><p>Concentration of suspended-sediment in milligrams per liter, measured at-a-point at elevation of hADCP</p>
</dd>
<dt>Site_number</dt><dd><p>Unique site code (string)</p>
</dd>
</dl>




<h3>Examples</h3>

<p>data(ExampleData) # lazy-load ony, unable to inspect contents in Rstudio
</p>
<p>names(ExampleData) # load data for inspection in Rstudio and view names of items in list
</p>


<h3>Author(s)</h3>

<p>Daniel Livsey (2023) ORCID: 0000-0002-2028-6128
</p>


<h3>Source</h3>

<p>Livsey, D.N. (in review). National Industry Guidelines for hydrometric monitoring–Part 12: Application of acoustic Doppler velocity meters to measure suspended-sediment load. Bureau of Meteorology. Melbourne, Australia.
</p>

<hr>
<h2 id='hADCPLoads'>Compute sediment load per guideline using acoustic backscatter from processed hADCP data</h2><span id='topic+hADCPLoads'></span>

<h3>Description</h3>

<p>Computes sediment load per guideline from user data in list &quot;InputData&quot; generated by function import_data()
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hADCPLoads(InputData)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hADCPLoads_+3A_inputdata">InputData</code></td>
<td>
<p>List generated by import_data.R</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list with data frames of estimated concentration and flux along with data used in regression and surrogate timeseries
</p>


<h3>Author(s)</h3>

<p>Daniel Livsey (2023) ORCID: 0000-0002-2028-6128
</p>


<h3>References</h3>

<p>Livsey, D.N. (in review). National Industry Guidelines for hydrometric monitoring–Part 12: Application of acoustic Doppler velocity meters to measure suspended-sediment load. Bureau of Meteorology. Melbourne, Australia.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+import_data">import_data</a></code> Import data from files in user-specified folder
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# loads example data in package folder extdata
InputData &lt;- import_data()
# import_data(path) can be used to import user data
Output &lt;- hADCPLoads(InputData)

</code></pre>

<hr>
<h2 id='import_data'>Load data from comma-delimited .txt files to list to be used in function hADCPLoads()</h2><span id='topic+import_data'></span>

<h3>Description</h3>

<p>Imports csv files to R, file names, variable names (and units) in csv text files must match variable names used in ExampleData.rda
</p>


<h3>Usage</h3>

<pre><code class='language-R'>import_data(data_folder)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="import_data_+3A_data_folder">data_folder</code></td>
<td>
<p>file path to folder containing .txt csv files with format that matches files in extdata package folder</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list with data frames used in package code, see ?ExampleData for list format
</p>


<h3>Warning</h3>

<p>Synthetic data used in ExampleData only has backscatter for one beam (&quot;ADCP_Echo_Intensity.txt&quot;), for user data, one should have backscatter for two beams with following names: &quot;ADCP_Echo_Intensity_Beam_1.txt&quot; and &quot;ADCP_Echo_Intensity_Beam_2.txt&quot;
</p>
<p>Package arguments require variable names and units to match the names and variable units provided (see ?ExampleData, or .txt files in extdata folder)
</p>
<p>Suggest saving all csv files in .txt format to ensure time format is not changed when editing/saving csv in Excel
</p>


<h3>Author(s)</h3>

<p>Daniel Livsey (2023) ORCID: 0000-0002-2028-6128
</p>


<h3>References</h3>

<p>Livsey, D.N. (in review). National Industry Guidelines for hydrometric monitoring–Part 12: Application of acoustic Doppler velocity meters to measure suspended-sediment load. Bureau of Meteorology. Melbourne, Australia.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+hADCPLoads">hADCPLoads</a></code> Process acoustic backscatter from hADCP and compute load using InputData from import_Data()
</p>


<h3>Examples</h3>

<pre><code class='language-R'>InputData &lt;- import_data() # loads text files provided in package folder "extdata"
</code></pre>

<hr>
<h2 id='impute_data'>Returns x with gaps imputed using ARIMA and Decision Trees, optional uncertainty estimation using Monte Carlo resampling</h2><span id='topic+impute_data'></span>

<h3>Description</h3>

<p>Returns x with gaps imputed using ARIMA and Decision Trees with option to use  harmonic model as predictors for x in decision tree algorithm. Uncertainty on imputed data is estimated using using Monte Carlo (MC) resampling adapting methods of Rustomji and Wilkinson (2008)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>impute_data(
  time,
  x,
  Xreg = NULL,
  ti = NULL,
  hfit = NULL,
  harmonic = FALSE,
  only_use_Xreg = FALSE,
  MC = 1,
  ptrain = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="impute_data_+3A_time">time</code></td>
<td>
<p>time for x (time, POSIXct)</p>
</td></tr>
<tr><td><code id="impute_data_+3A_x">x</code></td>
<td>
<p>any quantity (double)</p>
</td></tr>
<tr><td><code id="impute_data_+3A_xreg">Xreg</code></td>
<td>
<p>additional predictors for decision tree, required if harmonic is FALSE (rows = time, or if given, ti)</p>
</td></tr>
<tr><td><code id="impute_data_+3A_ti">ti</code></td>
<td>
<p>time vector for interpolation (time, POSIXct)</p>
</td></tr>
<tr><td><code id="impute_data_+3A_hfit">hfit</code></td>
<td>
<p>model object from TideHarmonics::ftide</p>
</td></tr>
<tr><td><code id="impute_data_+3A_harmonic">harmonic</code></td>
<td>
<p>logical if x exhibits tidal or diurnal variability</p>
</td></tr>
<tr><td><code id="impute_data_+3A_only_use_xreg">only_use_Xreg</code></td>
<td>
<p>logical for using Xreg only in decision tree</p>
</td></tr>
<tr><td><code id="impute_data_+3A_mc">MC</code></td>
<td>
<p>number of Monte Carlo simulations for uncertainty estimation</p>
</td></tr>
<tr><td><code id="impute_data_+3A_ptrain">ptrain</code></td>
<td>
<p>proportion of data used for training and testing model</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list with x imputed at time or ti, if given. Uncertainty estimated from Monte Carlo simulations
</p>


<h3>Note</h3>

<p>If MC == 1, uncertainty is not evaluated. If ptrain == 1, uncertainty and validation accuracy are not computed
</p>


<h3>Author(s)</h3>

<p>Daniel Livsey (2023) ORCID: 0000-0002-2028-6128
</p>


<h3>References</h3>

<p>Rustomji, P., &amp; Wilkinson, S. N. (2008). Applying bootstrap resampling to quantify uncertainty in fluvial suspended sediment loads estimated using rating curves. Water resources research, 44(9).
</p>
<p>van Buuren S, Groothuis-Oudshoorn K (2011). “mice: Multivariate Imputation by Chained Equations in R.” Journal of Statistical Software, 45(3), 1-67. doi:10.18637/jss.v045.i03.
</p>
<p>Stephenson AG (2016). Harmonic Analysis of Tides Using TideHarmonics. https://CRAN.R-project.org/package=TideHarmonics.
</p>
<p>Moritz S, Bartz-Beielstein T (2017). “imputeTS: Time Series Missing Value Imputation in R.” The R Journal, 9(1), 207–218. doi:10.32614/RJ-2017-009.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Impute non-tidal data
time &lt;- realTimeloads::ExampleData$Sediment_Samples$time
xo &lt;- realTimeloads::ExampleData$Sediment_Samples$SSCxs_mg_per_liter
Q &lt;- realTimeloads::ExampleData$Discharge$Discharge_m_cubed_per_s
idata &lt;- sample(1:length(xo),round(length(xo)*0.5),replace=FALSE)
x &lt;- rep(NA,length(xo))
x[idata] &lt;- xo[idata] # simulated samples
flow_concentrtion_ratio &lt;- imputeTS::na_interpolation(Q/x)
Xreg &lt;- cbind(Q,flow_concentrtion_ratio)
Output &lt;- impute_data(time,x,Xreg,MC = 10,ptrain = 0.8)

# Impute tidal data
time &lt;-TideHarmonics::Portland$DateTime[1:(24*90)]
xo &lt;-TideHarmonics::Portland$SeaLevel[1:(24*90)]
idata &lt;- sample(1:length(xo),round(length(xo)*0.5),replace=FALSE)
x &lt;- rep(NA,length(xo))
x[idata] &lt;- xo[idata] # simulated samples
Output &lt;- impute_data(time,x,harmonic = TRUE,MC = 10,ptrain = 0.8)
</code></pre>

<hr>
<h2 id='linear_interpolation_with_time_limit'>Linearly interpolate timeseries time(x) onto new timesetep ti</h2><span id='topic+linear_interpolation_with_time_limit'></span>

<h3>Description</h3>

<p>Linear interpolation limited by time since previous or following reading
</p>


<h3>Usage</h3>

<pre><code class='language-R'>linear_interpolation_with_time_limit(time, x, ti, threshold)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="linear_interpolation_with_time_limit_+3A_time">time</code></td>
<td>
<p>time for x (time, POSIXct)</p>
</td></tr>
<tr><td><code id="linear_interpolation_with_time_limit_+3A_x">x</code></td>
<td>
<p>any quantity, for example discharge (double)</p>
</td></tr>
<tr><td><code id="linear_interpolation_with_time_limit_+3A_ti">ti</code></td>
<td>
<p>time where time(x) will be interpolated to (time, POSIXct)</p>
</td></tr>
<tr><td><code id="linear_interpolation_with_time_limit_+3A_threshold">threshold</code></td>
<td>
<p>maximum duration where interpolation is allowed (hours)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a data frame with time (ti), x interpolated from time(x) onto ti, and logical (ibad) if interpolation exceeded threshold
</p>


<h3>Author(s)</h3>

<p>Daniel Livsey (2023) ORCID: 0000-0002-2028-6128
</p>


<h3>References</h3>

<p>Dowle M, and others (2023). data.table: Extension of 'data.frame'. https://cran.r-project.org/web/packages/data.table
</p>


<h3>Examples</h3>

<pre><code class='language-R'>InputData &lt;- realTimeloads::ExampleData
ADCP &lt;- InputData$ADCP
Height &lt;- InputData$Height
# Interpolate river height to ADCP time
time &lt;- realTimeloads::ExampleData$Height$time
x &lt;- realTimeloads::ExampleData$Height$Height_m
ti &lt;-realTimeloads::ExampleData$ADCP$time
threshold &lt;- 1
Output&lt;- linear_interpolation_with_time_limit(time,x,ti,threshold)
</code></pre>

<hr>
<h2 id='near_field_correction'>Near-field correction of Downing et al (1995)</h2><span id='topic+near_field_correction'></span>

<h3>Description</h3>

<p>Computes dimensionless near-field correction
</p>


<h3>Usage</h3>

<pre><code class='language-R'>near_field_correction(freq, c, r, at)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="near_field_correction_+3A_freq">freq</code></td>
<td>
<p>Frequency of sound (Hz)</p>
</td></tr>
<tr><td><code id="near_field_correction_+3A_c">c</code></td>
<td>
<p>Speed of sound in water (m/s)</p>
</td></tr>
<tr><td><code id="near_field_correction_+3A_r">r</code></td>
<td>
<p>range to cell center measured along-beam (m)</p>
</td></tr>
<tr><td><code id="near_field_correction_+3A_at">at</code></td>
<td>
<p>Radius of ADCP transducer (m)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Near-field correction (dimensionless)
</p>


<h3>Warning</h3>

<p>See various references cautioning use of near-field correction (e.g.,  https://doi.org/10.1002/2016WR019695)
</p>


<h3>Author(s)</h3>

<p>Daniel Livsey (2023) ORCID: 0000-0002-2028-6128
</p>


<h3>References</h3>

<p>Downing, A., Thorne, P. D., &amp; Vincent, C. E. (1995). Backscattering from a suspension in the near field of a piston transducer. The Journal of the Acoustical Society of America, 97(3), 1614-1620.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>InputData &lt;- realTimeloads::ExampleData
Sonde&lt;- InputData$Sonde
freq &lt;- InputData$ADCP$Accoustic_Frequency_kHz[1]*1000
S &lt;- ctd2sal(Sonde$Conductivity_uS_per_cm,Sonde$Water_Temperature_degC,Sonde$Pressure_dbar)
c &lt;- speed_of_sound(S,Sonde$Water_Temperature_degC,Sonde$Pressure_dbar)
at &lt;- InputData$ADCP$Transducer_radius_m
r &lt;- seq(0.1,10,0.1)
psi &lt;- near_field_correction(freq,c[1],r,at[1])
</code></pre>

<hr>
<h2 id='speed_of_sound'>Compute speed of sound in water given salinity, temperature, and depth</h2><span id='topic+speed_of_sound'></span>

<h3>Description</h3>

<p>Computes speed of sound in water per Del grosso (1974)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>speed_of_sound(sal, temp, depth)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="speed_of_sound_+3A_sal">sal</code></td>
<td>
<p>Salinity (PSU)</p>
</td></tr>
<tr><td><code id="speed_of_sound_+3A_temp">temp</code></td>
<td>
<p>Water temperature (degrees C)</p>
</td></tr>
<tr><td><code id="speed_of_sound_+3A_depth">depth</code></td>
<td>
<p>Water depth (m) or pressure (dBar)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Speed of sound in water (m/s)
</p>


<h3>Author(s)</h3>

<p>Daniel Livsey (2023) ORCID: 0000-0002-2028-6128
</p>


<h3>References</h3>

<p>Del Grosso, V. A. (1974). New equation for the speed of sound in natural waters (with comparisons to other equations). The Journal of the Acoustical Society of America, 56(4), 1084-1091.
Author modified matlab code from David Schoellhamer
</p>


<h3>Examples</h3>

<pre><code class='language-R'>InputData &lt;- realTimeloads::ExampleData
Sonde&lt;- InputData$Sonde
sal &lt;- ctd2sal(Sonde$Conductivity_uS_per_cm,Sonde$Water_Temperature_degC,Sonde$Pressure_dbar)
c &lt;- speed_of_sound(sal,Sonde$Water_Temperature_degC,Sonde$Pressure_dbar)
</code></pre>

<hr>
<h2 id='surrogate_to_analyte_interpolation'>Interpolate timeseries x(tx) onto y(ty)</h2><span id='topic+surrogate_to_analyte_interpolation'></span>

<h3>Description</h3>

<p>Interpolate timeseries x(tx) onto y(ty) with temporal threshold on interpolation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>surrogate_to_analyte_interpolation(tx, x, ty, y, threshold)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="surrogate_to_analyte_interpolation_+3A_tx">tx</code></td>
<td>
<p>time for x &quot;surrogate&quot; (time, POSIXct)</p>
</td></tr>
<tr><td><code id="surrogate_to_analyte_interpolation_+3A_x">x</code></td>
<td>
<p>quantity used to estimate y, for example, accoustic backscatter</p>
</td></tr>
<tr><td><code id="surrogate_to_analyte_interpolation_+3A_ty">ty</code></td>
<td>
<p>time for y &quot;analyte&quot; (time, POSIXct)</p>
</td></tr>
<tr><td><code id="surrogate_to_analyte_interpolation_+3A_y">y</code></td>
<td>
<p>measured quantity, for example, an analyte such as suspended-sediment concentration</p>
</td></tr>
<tr><td><code id="surrogate_to_analyte_interpolation_+3A_threshold">threshold</code></td>
<td>
<p>maximum duration where interpolation is allowed (minutes)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a data frame with surrogate (x) interpolated onto timestep of analyte (y), interpolated values exceeding threshold are excluded from the output
</p>


<h3>Author(s)</h3>

<p>Daniel Livsey (2023) ORCID: 0000-0002-2028-6128
</p>


<h3>Examples</h3>

<pre><code class='language-R'>tx &lt;- as.POSIXct(seq(0,24*60^2,60*1), origin = "2000-01-01",tz = "Australia/Brisbane")
x &lt;- sin(1:length(tx))
ty &lt;- as.POSIXct(seq(0,24*60^2,60*15), origin = "2000-01-01",tz = "Australia/Brisbane")
y &lt;- seq(0,24*60^2,60*15)
threshold &lt;- 10
calibration &lt;- surrogate_to_analyte_interpolation(tx,x,ty,y,threshold)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
