<!DOCTYPE html><html lang="en-US"><head><title>Help for package readNSx</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {readNSx}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#get_channel'><p>Get channel data</p></a></li>
<li><a href='#get_event'><p>Get event data packets from 'NEV'</p></a></li>
<li><a href='#get_file_type'><p>Get 'Blackrock' file type</p></a></li>
<li><a href='#get_nev'><p>Load 'NEV' information from path prefix</p></a></li>
<li><a href='#get_nsp'><p>Get a collection list containing 'NEV' and 'NSx' headers</p></a></li>
<li><a href='#get_nsx'><p>Load 'NSx' information from path prefix</p></a></li>
<li><a href='#get_specification'><p>Get '.nev' or 'nsx' specification</p></a></li>
<li><a href='#import_nsp'><p>Import signal data from 'Blackrock-Microsystems' data files</p></a></li>
<li><a href='#read_bci2000'><p>Read <code>'BCI2000'</code> recording data</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Read 'Blackrock-Microsystems' Files ('NEV', 'NSx')</td>
</tr>
<tr>
<td>Version:</td>
<td>0.0.5</td>
</tr>
<tr>
<td>Description:</td>
<td>Loads 'Blackrock' <a href="https://blackrockneurotech.com">https://blackrockneurotech.com</a> neural signal 
    data files into the memory, provides utility tools to extract the data into 
    common formats such as plain-text 'tsv' and 'HDF5'.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.mozilla.org/en-US/MPL/2.0/">MPL-2.0</a> | file LICENSE</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Imports:</td>
<td>data.table, fastmap, hdf5r, jsonlite, R6</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>cpp11</td>
</tr>
<tr>
<td>Suggests:</td>
<td>bit64, tools, testthat (&ge; 3.0.0), knitr, rmarkdown, spelling</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>HDF5 (&gt;= 1.8.13), little-endian platform</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Copyright:</td>
<td>For the readNSx package: Zhengjia Wang.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="http://dipterix.org/readNSx/">http://dipterix.org/readNSx/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/dipterix/readNSx/issues">https://github.com/dipterix/readNSx/issues</a></td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-09-03 21:08:16 UTC; dipterix</td>
</tr>
<tr>
<td>Author:</td>
<td>Zhengjia Wang [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Zhengjia Wang &lt;dipterix.wang@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-09-03 21:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='get_channel'>Get channel data</h2><span id='topic+get_channel'></span>

<h3>Description</h3>

<p>Obtain channel information and data from given prefix and
channel ID.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_channel(x, channel_id)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_channel_+3A_x">x</code></td>
<td>
<p>path <code>prefix</code> specified in <code><a href="#topic+import_nsp">import_nsp</a></code>, or
<code>'nev/nsx'</code> object</p>
</td></tr>
<tr><td><code id="get_channel_+3A_channel_id">channel_id</code></td>
<td>
<p>integer channel number. Please be aware that channel
number, channel ID, electrode ID refer to the same concept in
'Blackrock' 'NEV' specifications. Electrodes are not physical metals, they
refer to channels for historical reasons.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing channel data and meta information, along with
the enclosing 'NSx' information; for invalid channel ID, this function
returns <code>NULL</code>
</p>

<hr>
<h2 id='get_event'>Get event data packets from 'NEV'</h2><span id='topic+get_event'></span>

<h3>Description</h3>

<p>Get event data packets from 'NEV'
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_event(x, event_type, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_event_+3A_x">x</code></td>
<td>
<p>path <code>prefix</code> (see <code><a href="#topic+import_nsp">import_nsp</a></code>), or
<code>'nev/nsx'</code> object</p>
</td></tr>
<tr><td><code id="get_event_+3A_event_type">event_type</code></td>
<td>
<p>event type to load, common event types are
</p>

<dl>
<dt><code>'digital_inputs'</code></dt><dd><p>packet identifier 0</p>
</dd>
<dt><code>'spike'</code></dt><dd><p>packet identifier 1 to 10000 as of version 3.0</p>
</dd>
<dt><code>'recording'</code></dt><dd><p>packet identifier 65529 as of version 3.0, available after version 3.0</p>
</dd>
<dt><code>'configuration'</code></dt><dd><p>packet identifier 65530 as of version 3.0, available after version 3.0</p>
</dd>
<dt><code>'log'</code></dt><dd><p>packet identifier 65531 as of version 3.0, available after version 3.0</p>
</dd>
<dt><code>'button_trigger'</code></dt><dd><p>packet identifier 65532 as of version 3.0, available after version 3.0</p>
</dd>
<dt><code>'tracking'</code></dt><dd><p>packet identifier 65533 as of version 3.0, available after version 3.0</p>
</dd>
<dt><code>'video_sync'</code></dt><dd><p>packet identifier 65534 as of version 3.0, available after version 3.0</p>
</dd>
<dt><code>'comment'</code></dt><dd><p>packet identifier 65535 as of version 3.0, available after version 2.3</p>
</dd>
</dl>
</td></tr>
<tr><td><code id="get_event_+3A_...">...</code></td>
<td>
<p>pass to other methods</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame of corresponding event type, or <code>NULL</code> if event
is not found or invalid
</p>

<hr>
<h2 id='get_file_type'>Get 'Blackrock' file type</h2><span id='topic+get_file_type'></span>

<h3>Description</h3>

<p>Reads the first 10 bytes containing file type and version
information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_file_type(path)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_file_type_+3A_path">path</code></td>
<td>
<p>path to the 'Blackrock' <code>'.nev'</code> or <code>'.nsx'</code> file, or
a binary connection.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing file information, including file type, version
information, and normalized absolute path.
</p>

<hr>
<h2 id='get_nev'>Load 'NEV' information from path prefix</h2><span id='topic+get_nev'></span>

<h3>Description</h3>

<p>Load 'NEV' information from path prefix
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_nev(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_nev_+3A_x">x</code></td>
<td>
<p>path <code>prefix</code> specified in <code><a href="#topic+import_nsp">import_nsp</a></code>, or
<code>'nev/nsx'</code> object</p>
</td></tr>
<tr><td><code id="get_nev_+3A_...">...</code></td>
<td>
<p>reserved for future use</p>
</td></tr>
</table>


<h3>Value</h3>

<p>'NEV' header information if <code>x</code> is valid, otherwise <code>NULL</code>.
See Section &quot;'NEV' Data&quot; in <code><a href="#topic+get_specification">get_specification</a></code>
</p>

<hr>
<h2 id='get_nsp'>Get a collection list containing 'NEV' and 'NSx' headers</h2><span id='topic+get_nsp'></span>

<h3>Description</h3>

<p>Get a collection list containing 'NEV' and 'NSx' headers
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_nsp(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_nsp_+3A_x">x</code></td>
<td>
<p>path <code>prefix</code> specified in <code><a href="#topic+import_nsp">import_nsp</a></code>, or
<code>'nev/nsx'</code> object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing <code>'nev'</code> and imported <code>'nsx'</code> headers,
see <code><a href="#topic+import_nsp">import_nsp</a></code> for details
</p>

<hr>
<h2 id='get_nsx'>Load 'NSx' information from path prefix</h2><span id='topic+get_nsx'></span>

<h3>Description</h3>

<p>Load 'NSx' information from path prefix
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_nsx(x, which, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_nsx_+3A_x">x</code></td>
<td>
<p>path <code>prefix</code> specified in <code><a href="#topic+import_nsp">import_nsp</a></code>, or
<code>'nev/nsx'</code> object</p>
</td></tr>
<tr><td><code id="get_nsx_+3A_which">which</code></td>
<td>
<p>which 'NSx' to load, for example, <code>which=3</code> loads
<code>'ns3'</code> headers</p>
</td></tr>
<tr><td><code id="get_nsx_+3A_...">...</code></td>
<td>
<p>reserved for future use</p>
</td></tr>
</table>


<h3>Value</h3>

<p>'NSx' header information if data is found, otherwise returns
<code>NULL</code>. See Section &quot;'NSx' Data&quot; in <code><a href="#topic+get_specification">get_specification</a></code>
</p>

<hr>
<h2 id='get_specification'>Get '.nev' or 'nsx' specification</h2><span id='topic+get_specification'></span>

<h3>Description</h3>

<p>Get '.nev' or 'nsx' specification
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_specification(version, type = c("nev", "nsx"))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_specification_+3A_version">version</code></td>
<td>
<p>either character string or a vector of two integers; for
example, <code>"2.2"</code>, <code>"2.3"</code>, <code>c(3, 0)</code>. Currently only these
three versions are supported since I was unable to find any other versions.
Please file an issue ticket if others versions are desired.</p>
</td></tr>
<tr><td><code id="get_specification_+3A_type">type</code></td>
<td>
<p>file type; choices are <code>'nev'</code> or <code>'nsx'</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>The file specification as a list. The specification usually contains
three sections: basic header (fixed length), extended header
(dictionary-style), and data packets (data stream). The specification is
used to parse the data files.
</p>


<h3>'NEV' Data</h3>

<p>A 'NEV' object consists of three sections:
</p>
<p>Section 1 contains basic information such as the time-origin of all the
time-stamps, the time-stamp sampling frequency, data packets sizes.
</p>
<p>Section 2 is extended header containing the configurations of channels,
digital signals, etc. For any data packets in section 3, there should
be at least one table in this section describing the settings.
</p>
<p>section 3 is a collection of event packets such as digital signal inputs (
most likely to be used at version 2.2 or by 'Ripple'), spike waveform,
comments (sometimes storing epoch information), etc.
</p>
<p>Please be aware that while most common entries can be found across different
file versions, some entries are version-specific. If you are making your
script general, you need to be very careful handling these differences.
For more information, please search for the data specification manual
from the 'Blackrock-Microsystems' website.
</p>


<h3>'NSx' Data</h3>

<p>A 'NSx' file refers to the data files ending with <code>'ns1'</code> through
<code>'ns9'</code>. Common types are <code>'ns2'</code> (sampling at 1000 Hz),
<code>'ns3'</code> (sampling at 2000 Hz), and <code>'ns5'</code> (sampling at 30,000 Hz).
</p>
<p>A 'NSx' file also consists of three sections. Section 1 contains basic
information such as the time-origin of all the time-stamps, sampling
frequencies, and channel counts within the file. Please be careful that
item <code>time_resolution_timestamp</code> is not the sampling frequency for
signals. This item is the sampling frequency for time-stamp. To obtain the
signal sample rate, divided <code>time_resolution_timestamp</code> by
<code>period</code>. For example, <code>'ns3'</code> usually has time-stamp resolution
<code>30,000</code> and <code>period=15</code>, hence the signal sample rate is
<code>30000/15=2000Hz</code>.
</p>
<p>Section 2 usually contains one and only one channel table of which the
number of rows should coincide with number of channels from section 1. Other
information such as channel labels, physical connectors, pins, units, filter
settings, digital-to-analog conversion are also included. Since
<code>readNSx</code> always attempts to convert signals in 'volts' or 'milli-volts'
to 'micro-volts', the <code>'units'</code> column might be different to what's
actual recorded in the 'NSx' file headers.
</p>
<p>Section 3 contains partitions of continuous recording. When imported/loaded
from <code>readNSx</code>, the digital signals are always converted to analog
signals with 'micro-volts' unit. Please use <code><a href="#topic+get_channel">get_channel</a></code> to
get the channel data.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
get_specification(version = c(2,3), type = "nev")

get_specification(version = "3.0", type = "nsx")

</code></pre>

<hr>
<h2 id='import_nsp'>Import signal data from 'Blackrock-Microsystems' data files</h2><span id='topic+import_nsp'></span>

<h3>Description</h3>

<p>Please use <code>import_nsp</code> to import 'NEV' and 'NSx' files.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>import_nsp(
  path,
  prefix = NULL,
  exclude_events = "spike",
  exclude_nsx = NULL,
  verbose = TRUE,
  partition_prefix = "/part"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="import_nsp_+3A_path">path</code></td>
<td>
<p>path to 'NEV' or 'NSx' files</p>
</td></tr>
<tr><td><code id="import_nsp_+3A_prefix">prefix</code></td>
<td>
<p>path prefix to save data files into</p>
</td></tr>
<tr><td><code id="import_nsp_+3A_exclude_events">exclude_events</code></td>
<td>
<p>exclude one or more 'NEV' data events, choices are
<code>'spike'</code>, <code>'video_sync'</code>, <code>'digital_inputs'</code>,
<code>'tracking'</code>, <code>'button_trigger'</code>, <code>'comment'</code>,
<code>'configuration'</code>; default is <code>'spike'</code> since the spike data takes
very long time to parse, and most users might still use their own offline
spike-sorting algorithms.</p>
</td></tr>
<tr><td><code id="import_nsp_+3A_exclude_nsx">exclude_nsx</code></td>
<td>
<p>excluded 'NSx' types, integer vectors from 1 to 9; for
example, <code>exclude_nsx=c(1,2)</code> will prevent <code>'ns1'</code> and <code>'ns2'</code>
from being imported</p>
</td></tr>
<tr><td><code id="import_nsp_+3A_verbose">verbose</code></td>
<td>
<p>logical or a progress object: when logical, <code>verbose</code>
indicates whether to print the progress as messages;
when <code>verbose</code> is a progress object, this object must have <code>inc</code>
method; examples are <code>Progress</code> in the <code>shiny</code> package,
<code>progress2</code> from <code>dipsaus</code>, or <code>shiny_progress</code> from
<code>shidashi</code></p>
</td></tr>
<tr><td><code id="import_nsp_+3A_partition_prefix">partition_prefix</code></td>
<td>
<p>additional prefix to the data partition; default is
<code>"/part"</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of configurations, see <code><a href="#topic+get_specification">get_specification</a></code> for
what's contained.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Please get your own sample data first. This package does not
# provide sample data for privacy and license concerns :)

if(interactive() &amp;&amp; file.exists("sampledata.nev")) {

library(readNSx)

# ---- Import for the first time --------------------------------
import_nsp(
  path = "sampledata.nev",
  prefix = file.path(
    "~/BIDSRoot/MyDataSet/sub-YAB/ses-008/ieeg/",
    "sub-YAB_ses-008_task-congruency_acq-NSP1_run-01"
  ),
  exclude_events = "spike", partition_prefix = "/part"
)

# ---- Load header information --------------------------------
prefix &lt;- "sub-YAB_ses-008_task-congruency_acq-NSP1_run-01"
nev &lt;- get_nev(prefix)
ns3 &lt;- get_nsx(prefix, which = 3)

# get nev from nsx, or nsx from nev
get_nev(ns3)
get_nsx(nev, which = 5)

# ---- Load channel data
result &lt;- get_channel(prefix, channel_id = 10)
channel_signal &lt;- result$channel_detail$part1$data
channel_signal[]

}


</code></pre>

<hr>
<h2 id='read_bci2000'>Read <code>'BCI2000'</code> recording data</h2><span id='topic+read_bci2000'></span><span id='topic+read_bci2000_header'></span>

<h3>Description</h3>

<p>Read <code>'BCI2000'</code> recording data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_bci2000_header(file)

read_bci2000(file)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="read_bci2000_+3A_file">file</code></td>
<td>
<p>path to the recording data</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Parsed signal data
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Package comes with sample data
file &lt;- system.file("samples", "bci2000_sample.dat", package = "readNSx")
result &lt;- read_bci2000(file)

print(result)

# Notive: v1.0 and v1.1 are different, but all in `Source` section
# sample rate
result$parameters$Source$SamplingRate$value

# Signal data 64 channels x 500 time-points
dim(result$signals)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
