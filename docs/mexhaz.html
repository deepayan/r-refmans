<!DOCTYPE html><html><head><title>Help for package mexhaz</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {mexhaz}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#mexhaz-package'><p>Mixed effect parametric excess hazard models</p></a></li>
<li><a href='#adjsurv'><p>Computation of direct adjusted survival estimates based on a mexhaz</p>
model</a></li>
<li><a href='#fixef'><p>Method for extracting fixed effects</p></a></li>
<li><a href='#fixef.mexhaz'><p>Method for extracting fixed effects from a mexhaz object</p></a></li>
<li><a href='#lines.predMexhaz'><p>Lines method for a predMexhaz object</p></a></li>
<li><a href='#lines.resMexhaz'><p>Lines method for a resMexhaz object</p></a></li>
<li><a href='#mexhaz'><p>mexhaz function</p></a></li>
<li><a href='#plot.predMexhaz'><p>Plot method for a predMexhaz object</p></a></li>
<li><a href='#plot.resMexhaz'><p>Plot method for a resMexhaz object</p></a></li>
<li><a href='#points.predMexhaz'><p>Points method for a predMexhaz object</p></a></li>
<li><a href='#predict.mexhaz'><p>Predictions based on a mexhaz model</p></a></li>
<li><a href='#print.mexhaz'><p>Print method for a mexhaz object</p></a></li>
<li><a href='#print.predMexhaz'><p>Print method for a predMexhaz object</p></a></li>
<li><a href='#print.summary.mexhaz'><p>Printing method for a summary.mexhaz object</p></a></li>
<li><a href='#ranef'><p>Method for extracting random effects</p></a></li>
<li><a href='#ranef.mexhaz'><p>Method for extracting random effects from a mexhaz object</p></a></li>
<li><a href='#riskfunc'><p>Computation of hazard ratio and risk ratio estimates based on a mexhaz</p>
model</a></li>
<li><a href='#simdatn1'><p>Simulated dataset</p></a></li>
<li><a href='#simdatn2'><p>Simulated dataset</p></a></li>
<li><a href='#summary.mexhaz'><p>Summary method for a mexhaz object</p></a></li>
<li><a href='#update.mexhaz'><p>Update of a mexhaz model</p></a></li>
<li><a href='#vcov.mexhaz'><p>Method for extracting the covariance matrix of the fixed effects</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Mixed Effect Excess Hazard Models</td>
</tr>
<tr>
<td>Version:</td>
<td>2.6</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-06-29</td>
</tr>
<tr>
<td>Author:</td>
<td>Hadrien Charvat, Aurelien Belot, Juste Goungounga</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Hadrien Charvat  &lt;h.charvat.ef@juntendo.ac.jp&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Fit flexible (excess) hazard regression models with the possibility of including non-proportional effects of covariables and of adding a random effect at the cluster level (corresponding to a shared frailty). A detailed description of the package functionalities is provided in Charvat and Belot (2021) &lt;<a href="https://doi.org/10.18637%2Fjss.v098.i14">doi:10.18637/jss.v098.i14</a>&gt;.</td>
</tr>
<tr>
<td>Depends:</td>
<td>survival</td>
</tr>
<tr>
<td>Imports:</td>
<td>statmod, MASS, numDeriv, splines, lamW</td>
</tr>
<tr>
<td>Suggests:</td>
<td>utils, rstpm2</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-06-28 15:48:24 UTC; hchar</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-06-28 16:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='mexhaz-package'>Mixed effect parametric excess hazard models</h2><span id='topic+mexhaz-package'></span>

<h3>Description</h3>

<p>Fit an (excess) hazard regression model using different shapes for the
baseline hazard (Weibull, piecewise constant, exponential of a B-spline
of degree 1 to 3, exponential of a restricted cubic spline), with the
possibility to include time-dependent effects of variable(s) and a
random effect defined at the cluster level. Follow-up time can be
entered in the right-censored or counting process input style. The
latter allows the modelling of survival data with delayed entries. The
time-dependent effect of a covariable is modelled by adding interaction
terms between the covariable and a function of time of the same class as
the one used for the baseline hazard (in particular, with the same knots
for piecewise constant hazards; and with the same degree and the same
knots for B-spline or restricted cubic spline functions). The random
effect is assumed to be normally distributed with mean 0 and standard
deviation sigma. The optimisation process uses adaptive Gaussian
quadrature to calculate the cluster-specific marginal likelihoods. The
logarithm of the full marginal likelihood, defined as the sum of the
logarithms of the cluster-specific marginal likelihoods, is then
maximised using an optimisation routine such as <code>nlm</code> (default) or
<code>optim</code>. Functions to compute and plot the predicted (excess)
hazard and (net) survival are provided. In the case of a random
intercept model, three types of predictions can be obtained : marginal
(population-averaged), cluster-specific posterior (cluster-averaged), or
conditional (for a given quantile of the ditribution of the random effect).
</p>


<h3>Author(s)</h3>

<p>Hadrien Charvat, Aurelien Belot
</p>


<h3>References</h3>

<p>Charvat H, Remontet L, Bossard N, Roche L, Dejardin O,
Rachet B, Launoy G, Belot A; CENSUR Working Survival Group. A
multilevel excess hazard model to estimate net survival on
hierarchical data allowing for non-linear and non-proportional effects
of covariates. Stat Med 2016;35(18):3066-3084 (doi: 10.1002/sim.6881)
</p>
<p>Charvat H, Belot A. An R package for fitting flexible hazard-based
regression models for overall and excess mortality with a random
effect. J Stat Softw 2021;98(14):1-36 (doi: 10.18637/jss.v098.i14)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(simdatn1)

## Fit of a mixed-effect excess hazard model, with the baseline hazard
## described by a Weibull distribution (without covariables)

Mod_weib_mix &lt;- mexhaz(formula=Surv(time=timesurv,
event=vstat)~1, data=simdatn1, base="weibull",
expected="popmrate", verbose=0, random="clust")


## Examples of syntax for various models (not run)

## Fit of a fixed-effect excess hazard model, with the baseline hazard
## described by a Weibull distribution and with effects of age (agecr),
## deprivation index (depindex) and sex (IsexH) using the optim
## procedure and the BFGS method (see help of optim).

# Mod_weib &lt;- mexhaz(formula=Surv(time=timesurv,
# event=vstat)~agecr+depindex+IsexH, data=simdatn1, base="weibull",
# expected="popmrate", verbose=1000, fnoptim="optim",
# method="BFGS")


## Fit of a mixed-effect excess hazard model, with the baseline hazard
## described by a cubic B-spline with two knots at 1 and 5 year and with
## effects of age (agecr), deprivation index (depindex) and sex (IsexH)

# Mod_bs3_2mix &lt;- mexhaz(formula=Surv(time=timesurv,
# event=vstat)~agecr+depindex+IsexH, data=simdatn1, base="exp.bs",
# degree=3, knots=c(1,5), expected="popmrate", random="clust",
# verbose=1000)


## Fit of a fixed-effect overall hazard model, with the baseline hazard
## described by a piecewise constant function with the following vector
## of knots (defining the endpoints of the intervals on which the hazard
## is constant): (1,3,5,8), and with effects of age (agecr), deprivation
## index (depindex) and sex (IsexH)

# Mod_pw &lt;- mexhaz(formula=Surv(time=timesurv, event=vstat)~
# agecr+depindex+IsexH, data= simdatn1, base="pw.cst", knots=c(1,3,5,8),
# verbose=1000)


## Fit of a fixed-effect excess hazard model, with the baseline hazard
## described by a cubic B-spline with two knots at 1 and 5 year and with
## effects of age (agecr), deprivation index (depindex) and sex (IsexH)

# Mod_bs3_2 &lt;- mexhaz(formula=Surv(time=timesurv,
# event=vstat)~agecr+depindex+IsexH, data=simdatn1, base="exp.bs",
# degree=3, knots=c(1,5), expected="popmrate", verbose=1000)


## Fit of a mixed-effect excess hazard model, with the baseline hazard
## described by a cubic B-spline with two knots at 1 and 5 year and with
## effects of age (agecr), deprivation index (depindex) and sex (IsexH)

# Mod_bs3_2mix &lt;- mexhaz(formula=Surv(time=timesurv,
# event=vstat)~agecr+depindex+IsexH, data=simdatn1, base="exp.bs",
# degree=3, knots=c(1,5), expected="popmrate", random="clust",
# verbose=1000)


## Fit of a mixed-effect excess hazard model, with the baseline hazard
## described by a cubic B-spline with two knots at 1 and 5 year, with
## effects of age (agecr), deprivation index (depindex) and sex (IsexH)
## and with a time-dependent effect for age (agecr) and sex (IsexH).

# Mod_bs3_2mixnph &lt;- mexhaz(formula=Surv(time=timesurv,
# event=vstat)~agecr+depindex+IsexH + nph(agecr+IsexH), data=simdatn1,
# base="exp.bs", degree=3, knots=c(1,5), expected="popmrate",
# random="clust", verbose=1000)

</code></pre>

<hr>
<h2 id='adjsurv'>Computation of direct adjusted survival estimates based on a mexhaz
model</h2><span id='topic+adjsurv'></span>

<h3>Description</h3>

<p>Function for computing direct adjusted survival estimates
from a model fitted with the <code>mexhaz</code>. It can be used to obtain
direct adjusted survival estimates for one or two populations. In the
latter case, survival difference estimates are also
computed. Corresponding variance estimates are based on the Delta Method
(based on the assumption of multivariate normality of the model
parameter estimates). When the model includes a random effect, three types of
predictions can be made: (i) marginal predictions (obtained by
integration over the random effect distribution), (ii) cluster-specific
posterior predictions for an existing cluster, or (iii) conditional
predictions for a given quantile of the random effect distribution (by
default, for the median value, that is, 0).</p>


<h3>Usage</h3>

<pre><code class='language-R'>adjsurv(object, time.pts, data, data.0 = NULL, weights = NULL,
marginal = TRUE, quant.rdm = 0.5, cluster = NULL, quant.rdm.0 = 0.5,
cluster.0 = NULL, level = 0.95, dataset = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="adjsurv_+3A_object">object</code></td>
<td>
<p>an object of class <code>mexhaz</code>, corresponding to a
hazard-based regression model fitted with the <code>mexhaz</code> function.</p>
</td></tr>
<tr><td><code id="adjsurv_+3A_time.pts">time.pts</code></td>
<td>
<p>a vector of numerical values representing the time
points at which predictions are requested. Time values greater than
the maximum follow-up time on which the model estimation was based
are discarded.</p>
</td></tr>
<tr><td><code id="adjsurv_+3A_data">data</code></td>
<td>
<p>a <code>data.frame</code> containing the values of the
covariates of the population for which direct adjusted estimates
are to be calculated.</p>
</td></tr>
<tr><td><code id="adjsurv_+3A_data.0">data.0</code></td>
<td>
<p>an optional <code>data.frame</code> containing the values of
the covariates of a second population for which direct adjusted
estimates can also be calculated (and compared with those of the
first population). The default value is set to <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="adjsurv_+3A_weights">weights</code></td>
<td>
<p>optional argument specifying the weights to be
associated with each row of <code>data</code> (and <code>data.0</code>). the
default value is set to <code>NULL</code> which corresponds to attributing
to each row of the dataset(s) a weight equal to one over the total
number of rows.</p>
</td></tr>
<tr><td><code id="adjsurv_+3A_marginal">marginal</code></td>
<td>
<p>logical value controlling the type of predictions
returned by the function when the model includes a random
intercept. When <code>TRUE</code>, marginal predictions are computed. The
marginal survival is obtained by integrating the predicted survival over the
distribution of the random effect. The marginal hazard rate is
obtained as the opposite of the marginal time
derivative of the survival divided by the marginal survival. When
<code>FALSE</code> (default value), cluster-specific posterior predictions
or conditional predictions are calculated depending on the
value of the <code>cluster</code> argument.</p>
</td></tr>
<tr><td><code id="adjsurv_+3A_quant.rdm">quant.rdm</code></td>
<td>
<p>numerical value (between 0 and 1) specifying the
quantile of the random effect distribution that should be used when
requesting conditional predictions. The default value is set to 0.5
(corresponding to the median, that is a value of the random effect
of 0). This argument is ignored if the model is a fixed effect
model, when the <code>marginal</code> argument is set to <code>TRUE</code>, or
the <code>cluster</code> argument is not <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="adjsurv_+3A_cluster">cluster</code></td>
<td>
<p>a single value corresponding to the name of the cluster for
which posterior predictions should be calculated. These predictions
are obtained by integrating over the cluster-specific posterior
distribution of the random effect and thus require the original
dataset. The dataset can either be provided as part of the
<code>mexhaz</code> object given as argument or by specifying the name of
the dataset in the <code>dataset</code> argument (see below). The <code>cluster</code> argument is not used if the model is a fixed effect
model. The default value is <code>NULL</code>: this corresponds to
marginal predictions (if <code>marginal</code> is set to <code>TRUE</code>, the preferred
option), or to conditional predictions for a given quantile (by
default, the median) of the distribution of the random
effect (if <code>marginal</code> is set to <code>FALSE</code>).</p>
</td></tr>
<tr><td><code id="adjsurv_+3A_quant.rdm.0">quant.rdm.0</code></td>
<td>
<p>random effect distribution quantile value to be used with <code>data.0</code> (see
argument <code>quant.rdm</code> for details).</p>
</td></tr>
<tr><td><code id="adjsurv_+3A_cluster.0">cluster.0</code></td>
<td>
<p>cluster value to be used with <code>data.0</code> (see
argument <code>cluster</code> for details).</p>
</td></tr>
<tr><td><code id="adjsurv_+3A_level">level</code></td>
<td>
<p>a number in (0,1) specifying the level of confidence for
computing the confidence intervals of the hazard and the
survival. By default, <code>level=0.95</code>.</p>
</td></tr>
<tr><td><code id="adjsurv_+3A_dataset">dataset</code></td>
<td>
<p>original dataset used to fit the <code>mexhaz</code> object
given as argument to the function. This argument is only necessary
if cluster-specific posterior predictions are requested (and if the
dataset is not already provided in the <code>mexhaz</code> object). The
default value is set to <code>NULL</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>resMexhaz</code> that can be used by the function
<code>plot.resMexhaz</code> to produce graphics
of the direct adjusted survival curve. It contains the following
elements:
</p>
<table>
<tr><td><code>results</code></td>
<td>
<p>a <code>data.frame</code> consisting of: the time points at
which the direct adjusted survival values have been calculated; the
direct ajusted survival values with their confidence limits for
population <code>data</code>; the direct ajusted survival values with their
confidence limits for population <code>data.0</code>; the direct adjusted
survival difference estimates with their confidence limits.</p>
</td></tr>
<tr><td><code>type</code></td>
<td>
<p>type of results returned by the function. The value is
used by <code>plot.resMexhaz</code> and <code>lines.resMexhaz</code>, and set to
<code>"as"</code> (adjusted survival).</p>
</td></tr>
<tr><td><code>multiobs</code></td>
<td>
<p>value used by
<code>plot.resMexhaz</code> and <code>lines.resMexhaz</code>, and set to
<code>FALSE</code> (computation of the adjusted survival at several time
points for one vector of covariates).</p>
</td></tr>
<tr><td><code>ci.method</code></td>
<td>
<p>method used to compute confidence limits. Currently set
to <code>"delta"</code> as only the Delta Method is implemented.</p>
</td></tr>
<tr><td><code>level</code></td>
<td>
<p>level of confidence used to compute confidence limits.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Hadrien Charvat, Aurelien Belot
</p>


<h3>References</h3>

<p>Charvat H, Remontet L, Bossard N, Roche L, Dejardin O,
Rachet B, Launoy G, Belot A; CENSUR Working Survival Group. A
multilevel excess hazard model to estimate net survival on
hierarchical data allowing for non-linear and non-proportional effects
of covariates. Stat Med 2016;35:3066-3084 (doi: 10.1002/sim.6881)
</p>
<p>Skrondal A, Rabe-Hesketh S. Prediction in multilevel generalized
linear models. J R Stat Soc A Stat Soc 2009;172(3):659-687 (doi: 10.1111/j.1467-985X.2009.00587.x).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.resMexhaz">plot.resMexhaz</a></code>, <code><a href="#topic+lines.resMexhaz">lines.resMexhaz</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(simdatn1)

## Fit of a fixed-effect hazard model, with the baseline hazard
## described by a linear B-spline with two knots at 1 and 5 year and with
## effects of age (agecr), deprivation index (depindex) and sex (IsexH)

Mod_bs1_2 &lt;- mexhaz(formula=Surv(time=timesurv,
event=vstat)~agecr+depindex+IsexH, data=simdatn1, base="exp.bs",
degree=1, knots=c(1,5), verbose=0)

## Direct adjusted survival for the simdatn1 population
DAS_Modbs1_2 &lt;- adjsurv(Mod_bs1_2, time.pts=seq(1,10),
data=simdatn1)

</code></pre>

<hr>
<h2 id='fixef'>Method for extracting fixed effects</h2><span id='topic+fixef'></span>

<h3>Description</h3>

<p>This is a generic function.</p>


<h3>Usage</h3>

<pre><code class='language-R'>fixef(x, ...)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fixef_+3A_x">x</code></td>
<td>
<p>a fitted object from which fixed effects can be extracted.</p>
</td></tr>
<tr><td><code id="fixef_+3A_...">...</code></td>
<td>
<p>may be required by some methods using this generic function.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>see the documentation for the specific class.</p>


<h3>See Also</h3>

<p><code><a href="#topic+ranef">ranef</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>## See the specific class documentation.
</code></pre>

<hr>
<h2 id='fixef.mexhaz'>Method for extracting fixed effects from a mexhaz object</h2><span id='topic+fixef.mexhaz'></span>

<h3>Description</h3>

<p>Display a vector containing the fixed effects of a mexhaz model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mexhaz'
fixef(x, ...)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fixef.mexhaz_+3A_x">x</code></td>
<td>
<p>an object of class <code>mexhaz</code>.</p>
</td></tr>
<tr><td><code id="fixef.mexhaz_+3A_...">...</code></td>
<td>
<p>not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector containing the fixed effect estimates.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mexhaz">mexhaz</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(simdatn1)

## Fit of a mixed-effect excess hazard model, with the baseline hazard
## described by a Weibull distribution (without covariables)

Mod_weib_mix &lt;- mexhaz(formula=Surv(time=timesurv,
event=vstat)~1, data=simdatn1, base="weibull",
expected="popmrate", verbose=0, random="clust")

fixef(Mod_weib_mix)
</code></pre>

<hr>
<h2 id='lines.predMexhaz'>Lines method for a predMexhaz object</h2><span id='topic+lines.predMexhaz'></span>

<h3>Description</h3>

<p>Function for adding to an already existing graphical window
the predicted (excess) hazard or (net) survival based on a <code>predMexhaz</code> object.</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'predMexhaz'
lines(x, which = c("surv", "hazard"), conf.int =
TRUE, lty.pe = "solid", lty.ci = "dashed", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="lines.predMexhaz_+3A_x">x</code></td>
<td>
<p>an object of class <code>predMexhaz</code>, corresponding to
(excess) hazard and (net) survival predictions based on a  survival
model fitted with the <code>mexhaz</code> function. Predictions can be
obtained for multiple times for one vector of covariables
(<code>"multitime"</code>) or for several vectors of covariables at one
time point (<code>"multiobs"</code>). The <code>lines()</code> function only
applies to the <code>"multitime"</code> type of predictions.
</p>
</td></tr>
<tr><td><code id="lines.predMexhaz_+3A_which">which</code></td>
<td>
<p>type of curve to be plotted. Selection can be made
between <code>"surv"</code> (default value) for the (net) survival curve
and <code>"hazard"</code> for the (excess) hazard.</p>
</td></tr>
<tr><td><code id="lines.predMexhaz_+3A_conf.int">conf.int</code></td>
<td>
<p>logical values allowing the user to decide whether to
plot the confidence limits of the survival (or hazard).</p>
</td></tr>
<tr><td><code id="lines.predMexhaz_+3A_lty.pe">lty.pe</code></td>
<td>
<p>type of line used for drawing the hazard/survival estimate.</p>
</td></tr>
<tr><td><code id="lines.predMexhaz_+3A_lty.ci">lty.ci</code></td>
<td>
<p>type of line used for drawing the confidence limits.</p>
</td></tr>
<tr><td><code id="lines.predMexhaz_+3A_...">...</code></td>
<td>
<p>additional parameters that are directly passed to the
<code>lines</code> function. These parameters, if not already used
internally by the <code>lines.predMexhaz</code> function, will apply simultaneously to
the point estimate and confidence limit curves.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+predict.mexhaz">predict.mexhaz</a></code>, <code><a href="#topic+plot.predMexhaz">plot.predMexhaz</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(simdatn1)

## Fit of a fixed-effect hazard model, with the baseline hazard
## described by a linear B-spline with two knots at 1 and 5 year and with
## effects of age (agecr), deprivation index (depindex) and sex (IsexH)

Mod_bs2_2 &lt;- mexhaz(formula=Surv(time=timesurv,
event=vstat)~agecr+depindex+IsexH, data=simdatn1, base="exp.bs",
degree=2, knots=c(1,5), verbose=0)

## Prediction at several time points for one vector of covariates
Pred_Modbs2_2A &lt;- predict(Mod_bs2_2, time.pts=seq(0,10,by=0.1),
data.val=data.frame(agecr=0,depindex=0.5,IsexH=1))

plot(Pred_Modbs2_2A, which="hazard", col="red")
lines(Pred_Modbs2_2A, which="hazard", conf.int=FALSE)

</code></pre>

<hr>
<h2 id='lines.resMexhaz'>Lines method for a resMexhaz object</h2><span id='topic+lines.resMexhaz'></span>

<h3>Description</h3>

<p>Function for adding to an already existing graphical window
various quantities calculated from a <code>mexhaz</code> model.</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'resMexhaz'
lines(x, conf.int = TRUE, lty.pe = "solid", lty.ci =
"blank", col.ci = "blue", alpha.col.ci = 0.25, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="lines.resMexhaz_+3A_x">x</code></td>
<td>
<p>an object of class <code>resMexhaz</code>, corresponding to
various predictions based on a survival
model fitted with the <code>mexhaz</code> function. Predictions can be
obtained for multiple times for one vector of covariables
(<code>"multitime"</code>) or for several vectors of covariables at one
time point (<code>"multiobs"</code>). The <code>plot()</code> function only
applies to the <code>"multitime"</code> type of predictions.
</p>
</td></tr>
<tr><td><code id="lines.resMexhaz_+3A_conf.int">conf.int</code></td>
<td>
<p>logical value allowing the user to decide whether to
plot the confidence limits of the survival (or hazard).</p>
</td></tr>
<tr><td><code id="lines.resMexhaz_+3A_lty.pe">lty.pe</code></td>
<td>
<p>type of line used for drawing the hazard/survival estimate.</p>
</td></tr>
<tr><td><code id="lines.resMexhaz_+3A_lty.ci">lty.ci</code></td>
<td>
<p>type of line used for drawing the confidence
limits.</p>
</td></tr>
<tr><td><code id="lines.resMexhaz_+3A_col.ci">col.ci</code></td>
<td>
<p>color used to fill in the polygon defined by the
confidence limits.</p>
</td></tr>
<tr><td><code id="lines.resMexhaz_+3A_alpha.col.ci">alpha.col.ci</code></td>
<td>
<p>parameter used internally by the <code>rgb()</code>
function to set the color transparency.</p>
</td></tr>
<tr><td><code id="lines.resMexhaz_+3A_...">...</code></td>
<td>
<p>additional parameters that are directly passed to the
<code>lines</code> function. These parameters will apply simultaneously to
the point estimate and confidence limit curves.</p>
</td></tr>
</table>


<h3>See Also</h3>

 <p><code><a href="#topic+adjsurv">adjsurv</a></code>, <code><a href="#topic+riskfunc">riskfunc</a></code>,
<code><a href="#topic+plot.resMexhaz">plot.resMexhaz</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(simdatn1)

## Fit of a fixed-effect hazard model, with the baseline hazard
## described by a linear B-spline with two knots at 1 and 5 year and with
## effects of age (agecr), deprivation index (depindex) and sex (IsexH)

Mod_bs2 &lt;- mexhaz(formula=Surv(time=timesurv,
event=vstat)~agecr+depindex+IsexH, data=simdatn1, base="exp.bs",
degree=2, knots=c(1,5), verbose=0)

## Relative risk (ratio of cumulative incidence curves) for men versus
## women for two different values of age

RR_Modbs2a &lt;- riskfunc(Mod_bs2, time.pts=seq(0,10, by=0.1),
data=data.frame(agecr=0.1, IsexH=1, depindex=0),
data.0=data.frame(agecr=0.1, IsexH=0, depindex=0), conf.int="delta",
type="rr")

RR_Modbs2b &lt;- riskfunc(Mod_bs2, time.pts=seq(0,10, by=0.1),
data=data.frame(agecr=-0.1, IsexH=1, depindex=0),
data.0=data.frame(agecr=-0.1, IsexH=0, depindex=0), conf.int="delta",
type="rr")


plot(RR_Modbs2a)
lines(RR_Modbs2a, col.ci="green")
abline(h=1, lty="dashed")

</code></pre>

<hr>
<h2 id='mexhaz'>mexhaz function</h2><span id='topic+mexhaz'></span>

<h3>Description</h3>

<p>Fit an (excess) hazard regression model using different shapes for the
baseline hazard (Weibull, piecewise constant, exponential of a B-spline
of degree 1 to 3, exponential of a restricted cubic spline), with the
possibility to include time-dependent effects of variable(s) and a
random effect defined at the cluster level. The function accepts
right-censored and counting process input styles for the follow-up
time. The latter allows the modelling of survival data with delayed
entries. The time-dependent effect of a covariable is modelled by adding
interaction terms between the covariable and a function of time of the
same class as the one used for the baseline hazard (in particular, with
the same knots for piecewise constant hazards; and with the same degree
and the same knots for B-spline or restricted cubic spline
functions). The random effect is assumed to be normally distributed with
mean 0 and standard deviation sigma. The optimisation process uses
adaptive Gaussian quadrature to calculate the cluster-specific marginal
likelihoods. The logarithm of the full marginal likelihood, defined as
the sum of the logarithms of the cluster-specific marginal likelihoods,
is then maximised using an optimisation routine such as <code>nlm</code>
(default) or <code>optim</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mexhaz(formula, data, expected = NULL, base = c("weibull",
"exp.bs", "exp.ns", "pw.cst"), degree = 3, knots = NULL,
bound = NULL, n.gleg = 20, init = NULL, random = NULL,
n.aghq = 10, recurrent = FALSE, fnoptim = c("nlm", "optim"), verbose = 0,
method = "Nelder-Mead", iterlim = 10000, numHess = FALSE,
print.level = 1, exactGradHess = TRUE, gradtol =
ifelse(exactGradHess, 1e-8, 1e-6), testInit = TRUE,
keep.data = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mexhaz_+3A_formula">formula</code></td>
<td>

<p>a formula object, with the response on the left of the <code>~</code>
operator, and the linear predictor on the right. The response must be of
the form <code>Surv(time, event)</code> for right censored data or
<code>Surv(time, time2, event)</code> for counting process style data. The linear predictor accepts a
special instruction <code>nph()</code> for specifying variables for which a
time-dependent effect should be modelled (if several variables are
modelled with time-dependent effects, separate these variables inside the
<code>nph()</code> instruction with a <code>+</code> sign).
</p>
<p>In case <code>time</code> takes the value 0 for some observations when data
are entered in the right censored style, it is
assumed that these observations refer to events (or censoring) that occurred
on the first day of follow-up. Consequently, a value of 1/730.5 (half a
day) is substituted in order to make computations possible. However, it
should be stressed that this is just a convention and that it does not
make much sense if the time scale is not expressed in years. We therefore
advise the analyst to deal with 0 time values during the dataset preparation stage.
</p>
</td></tr>
<tr><td><code id="mexhaz_+3A_data">data</code></td>
<td>

<p>a <code>data.frame</code> containing the variables referred to in the <code>formula</code>,
as well as in the <code>expected</code> and <code>random</code> arguments if these arguments are used.
</p>
</td></tr>
<tr><td><code id="mexhaz_+3A_expected">expected</code></td>
<td>

<p>name of the variable (must be given in quotes) representing the
population (i.e., expected) hazard. By default, <code>expected=NULL</code>, which
means that the function estimates the overall hazard (and not the excess
hazard).
</p>
</td></tr>
<tr><td><code id="mexhaz_+3A_base">base</code></td>
<td>
<p> functional form that should be used to model the baseline
hazard. Selection can be made between the following options:
<code>"weibull"</code> for a Weibull hazard, <code>"exp.bs"</code> for a hazard
described by the exponential of a B-spline (only B-splines of degree 1,
2 or 3 are accepted), <code>"exp.ns"</code> for a hazard described by the
exponential of a restricted cubic spline (also called 'natural
spline'), <code>"pw.cst"</code> for a piecewise constant hazard. By default,
<code>base="weibull"</code>.
</p>
<p>For the Weibull hazard model, the cumulative hazard is given by the
following relationship:
</p>
<p>H(t,x,z) = lambda*exp(x'b)*t^(rho*exp(z'g))
</p>
<p>where lambda and rho are the parameters of the Weibull baseline hazard,
x represent variables with proportional effect (with corresponding
regression coefficients 'b') and z represent variables with
time-dependent effects (with corresponding regression coefficients
'g'). The <code>mexhaz()</code> function does not estimate directly lambda and
rho but their logarithms (in the output of the function, these are named
respectively 'logLambda' and 'logRho').
</p>
<p>For the spline-based hazards, it should be noted that the B-spline
and restricted cubic spline bases created internally in the
<code>mexhaz()</code> function are identical to those obtained by the use of,
respectively, the <code>bs()</code> and <code>ns()</code> functions from the
<code>splines</code> package.</p>
</td></tr>
<tr><td><code id="mexhaz_+3A_degree">degree</code></td>
<td>

<p>if <code>base="exp.bs"</code>, <code>degree</code> represents the
degree of the B-spline used. Only integer values between 1 and 3 are
accepted, and 3 is the default.
</p>
</td></tr>
<tr><td><code id="mexhaz_+3A_knots">knots</code></td>
<td>

<p>if <code>base="exp.bs"</code> or <code>"exp.ns"</code>, <code>knots</code> is the vector of interior knots of
the spline. If <code>base="pw.cst"</code>, <code>knots</code> is the vector
defining the endpoints of the time intervals on which the hazard is
assumed to be constant. By default, <code>knots=NULL</code> (that is, it
produces a B-spline with no interior knots if <code>base="exp.bs"</code>, a
linear B-spline with no interior knots if <code>base="exp.ns"</code>, or a
constant hazard over the whole follow-up period if
<code>base="pw.cst"</code>).
</p>
</td></tr>
<tr><td><code id="mexhaz_+3A_bound">bound</code></td>
<td>

<p>a vector of two numerical values corresponding to the boundary knots
of the spline functions. If <code>base="exp.bs"</code> or
<code>base="exp.ns"</code>, computation of the B-spline basis requires that
boundary knots be given. The <code>bound</code> argument allows the user to
specify these boundary knots. If <code>base="exp.bs"</code>, the interval
defined by the boundary knots must at least include the interval
c(0,max(time)) (otherwise, there could be problems with
ill-conditioned bases). If <code>base="exp.ns"</code>, the boundary knots
correspond to the knots beyond which the spline is contrained to be
linear (in that case, the boundary knots can be values contained in
c(0,max(time))). By default, the
boundary knots are set to c(0,max(time)).
</p>
</td></tr>
<tr><td><code id="mexhaz_+3A_n.gleg">n.gleg</code></td>
<td>

<p>if <code>base="exp.bs"</code> and degree is equal to 2 or 3, or if
<code>base="exp.ns"</code>, the cumulative
hazard is computed via Gauss-Legendre quadrature and <code>n.gleg</code> is the number
of quadrature nodes to be used to compute the cumulative hazard. By
default, <code>n.gleg=20</code>.
</p>
</td></tr>
<tr><td><code id="mexhaz_+3A_init">init</code></td>
<td>
<p>vector of initial values. By default <code>init=NULL</code>
and the initial values are internally set to the following values:
</p>
<p>for the baseline hazard:
</p>
<p>if <code>exactGradHess=TRUE</code> (except for the excess hazard random
effect model for which this argument is ignored), the intercept is
set to 0.5*log(Number of events/Person-years of observation) and all
other parameters set to 0. In case of failed convergence, and if the
<code>testInit</code> argument is set to <code>TRUE</code> (default), several
trials are run with an adaptation of the value of the intercept.
</p>
<p>if <code>exactGradHess=FALSE</code>, the following values are used:
</p>
<p>- if <code>base="weibull"</code>, the logarithm of the scale and shape parameters is set to 0.1;
</p>
<p>- if <code>base="exp.bs"</code>, the parameters of the B-spline are all
set to -1;
</p>
<p>- if <code>base="exp.ns"</code>, the parameters of the restricted cubic spline are all
set to -1;
</p>
<p>- if <code>base="pw.cst"</code>, the logarithm of the piecewise-constant
hazards are set to -1;
</p>
<p>the parameters describing the effects of the covariables are all set
to 0;
</p>
<p>the parameter representing the standard deviation of the random
effect is set to 0.1. In case of failed convergence, if
<code>exactGradHess=TRUE</code> and if <code>testInit=TRUE</code>, several
trials are run with an adaptation of the value of this random effect
parameter.
</p>
</td></tr>
<tr><td><code id="mexhaz_+3A_random">random</code></td>
<td>

<p>name of the variable to be entered as a random effect (must be given
between quotes), representing the cluster membership. By default,
<code>random=NULL</code> which means that the function fits a fixed effects model.
</p>
</td></tr>
<tr><td><code id="mexhaz_+3A_n.aghq">n.aghq</code></td>
<td>

<p>number of quadrature points used for estimating the
cluster-specific marginal likelihoods by adaptive Gauss-Hermite
quadrature. By default, <code>n.aghq=10</code>.
</p>
</td></tr>
<tr><td><code id="mexhaz_+3A_recurrent">recurrent</code></td>
<td>
<p>logical value indicating that the dataset
corresponds to recurrent events expressed in calendar time, in which
case the <code>mexhaz</code> function fits a model for the marginal rate. By default, <code>recurrent=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="mexhaz_+3A_fnoptim">fnoptim</code></td>
<td>

<p>name of the R optimisation procedure used to maximise the
likelihood. Selection can be made between <code>"nlm"</code> (by default)
and <code>"optim"</code>. Note: if <code>exactGradHess=TRUE</code>, this
argument will be ignored (<code>fnoptim</code> will be set automatically to <code>"nlm"</code>).
</p>
</td></tr>
<tr><td><code id="mexhaz_+3A_verbose">verbose</code></td>
<td>

<p>integer parameter representing the frequency at which the current state
of the optimisation process is displayed. Internally, an 'evaluation' is
defined as an estimation of the log-likelihood for a given vector of
parameters. This means that the number of evaluations is increased each
time the optimisation procedure updates the value of any of the
parameters to be estimated. If <code>verbose=n</code> (with <code>n</code> an integer),
the function will display the current values of the parameters, the
log-likelihood and the time elapsed every <code>n</code> evaluations. If
<code>verbose=0</code> (default), nothing is displayed.
</p>
</td></tr>
<tr><td><code id="mexhaz_+3A_method">method</code></td>
<td>

<p>if <code>fnoptim="optim"</code>, <code>method</code> represents the optimisation
method to be used by <code>optim</code>. By
default, <code>method="Nelder-Mead"</code>. This parameter is not used if <code>fnoptim="nlm"</code>.
</p>
</td></tr>
<tr><td><code id="mexhaz_+3A_iterlim">iterlim</code></td>
<td>

<p>if <code>fnoptim="nlm"</code>, <code>iterlim</code> represents the maximum number of
iterations before the <code>nlm</code> optimisation
procedure is terminated. By default, <code>iterlim</code> is set to
10000. This parameter is not used if <code>fnoptim="optim"</code> (in this
case, the maximum number of iterations must be given as part of a
list of control parameters via the <code>control</code> argument: see the
help page of <code>optim</code> for further details).
</p>
</td></tr>
<tr><td><code id="mexhaz_+3A_numhess">numHess</code></td>
<td>

<p>logical value allowing the user to choose between the Hessian returned
by the optimization algorithm (default) or the Hessian estimated by
the <code>hessian</code> function from the <code>numDeriv</code> package. The
latter might be more accurate but its estimation is more
time-consuming. We suggest to use the default Hessian estimation
procedure during model building and estimate the <code>numDeriv</code>-based
Hessian only on the final model. Note: if <code>exactGradHess=TRUE</code>, this argument is ignored.
</p>
</td></tr>
<tr><td><code id="mexhaz_+3A_print.level">print.level</code></td>
<td>

<p>this argument is only used if <code>fnoptim="nlm"</code>. It determines the
level of printing during the optimisation process. The default value
(for the <code>mexhaz</code> function) is set to '1' which means that
details on the initial and final step of the optimisation procedure
are printed (see the help page of <code>nlm</code> for further details).
</p>
</td></tr>
<tr><td><code id="mexhaz_+3A_exactgradhess">exactGradHess</code></td>
<td>
<p> logical value allowing the user to decide
whether maximisation of the likelihood should be based on the
analytic gradient and Hessian computed internally (default,
corresponding to <code>exactGradHess=TRUE</code>).  In that case,
optimisation is performed with the <code>nlm</code> function. Note: even
if set to <code>TRUE</code>, this argument is ignored when the user wants
to fit an excess hazard model including a random effect because in
that case, there is no simple way to obtain the analytic gradient
and Hessian.</p>
</td></tr>
<tr><td><code id="mexhaz_+3A_gradtol">gradtol</code></td>
<td>

<p>this argument is only used if <code>fnoptim="nlm"</code>. It corresponds
to the tolerance at which the scaled gradient is considered close
enough to zero to terminate the algorithm. The default value depends
on the value of the argument <code>exactGradHess</code>. 
</p>
</td></tr>
<tr><td><code id="mexhaz_+3A_testinit">testInit</code></td>
<td>
<p> this argument is used only when
<code>exactGradHess=TRUE</code> and when the model is not an excess hazard
random effect model. It instructs the <code>mexhaz</code> function to try
several vectors of initial values in case optimization was not
successful with the default (or user-defined) initial
values. Because optimization based on the analytical gradient and
Hessian is usually fast, this simple and empirical procedure proves
useful to increase the probability of convergence in cases when it
is difficult to specify appropriate initial values. Only the initial
values for the intercept and for the parameter corresponding to the
random effect are modified.</p>
</td></tr>
<tr><td><code id="mexhaz_+3A_keep.data">keep.data</code></td>
<td>
<p> logical argument determining whether the dataset
should be kept in the object returned by the function: this can be
useful in certain contexts (e.g., to calculate cluster-specific
posterior predictions from a random intercept model) but might create
unnecessarily voluminous objects. The default
value is set to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="mexhaz_+3A_...">...</code></td>
<td>

<p>represents additional parameters directly passed to <code>nlm</code> or
<code>optim</code> to control the optimisation process.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>mexhaz</code> containing the following elements:
</p>
<table>
<tr><td><code>dataset</code></td>
<td>
<p>name of the dataset used to fit the model.</p>
</td></tr>
<tr><td><code>call</code></td>
<td>
<p>function call on which the model is based.</p>
</td></tr>
<tr><td><code>formula</code></td>
<td>
<p>formula part of the call.</p>
</td></tr>
<tr><td><code>expected</code></td>
<td>
<p>name of the variable corresponding to the expected
hazard (takes the value <code>NA</code> for standard, i.e., 'non-excess' hazard models).</p>
</td></tr>
<tr><td><code>xlevels</code></td>
<td>
<p>information concerning the levels of the categorical
variables used in the model (used by <code>predict.mexhaz</code>).</p>
</td></tr>
<tr><td><code>n.obs.tot</code></td>
<td>
<p>total number of observations in the dataset.</p>
</td></tr>
<tr><td><code>n.obs</code></td>
<td>
<p>number of observations used to fit the model (after
exclusion of missing values).</p>
</td></tr>
<tr><td><code>n.events</code></td>
<td>
<p>number of events (after exclusion of missing values).</p>
</td></tr>
<tr><td><code>n.clust</code></td>
<td>
<p>number of clusters.</p>
</td></tr>
<tr><td><code>n.time.0</code></td>
<td>
<p>number of observations for which the observed
follow-up time was equal to 0 (only for right censored type data).</p>
</td></tr>
<tr><td><code>base</code></td>
<td>
<p>function used to model the baseline hazard.</p>
</td></tr>
<tr><td><code>max.time</code></td>
<td>
<p>maximal observed time in the dataset.</p>
</td></tr>
<tr><td><code>boundary.knots</code></td>
<td>
<p>vector of boundary values used to define the B-spline (or
natural spline) bases.</p>
</td></tr>
<tr><td><code>degree</code></td>
<td>
<p>degree of the B-spline used to model the logarithm of
the baseline hazard.</p>
</td></tr>
<tr><td><code>knots</code></td>
<td>
<p>vector of interior knots used to define the B-spline (or
natural spline) bases.</p>
</td></tr>
<tr><td><code>names.ph</code></td>
<td>
<p>names of the covariables with a proportional effect.</p>
</td></tr>
<tr><td><code>random</code></td>
<td>
<p>name of the variable defining cluster membership (set to
<code>NA</code> in the case of a purely fixed effects model).</p>
</td></tr>
<tr><td><code>recurrent</code></td>
<td>
<p>logical value indicating whether the dataset
corresponds to recurrent events.</p>
</td></tr>
<tr><td><code>init</code></td>
<td>
<p>a vector containing the initial values of the parameters.</p>
</td></tr>
<tr><td><code>coefficients</code></td>
<td>
<p>a vector containing the parameter estimates.</p>
</td></tr>
<tr><td><code>std.errors</code></td>
<td>
<p>a vector containing the standard errors of the
parameter estimates.</p>
</td></tr>
<tr><td><code>vcov</code></td>
<td>
<p>the variance-covariance matrix of the estimated parameters.</p>
</td></tr>
<tr><td><code>gradient</code></td>
<td>
<p>the gradient of the log-likelihood function evaluated at the estimated parameters.</p>
</td></tr>
<tr><td><code>hessian</code></td>
<td>
<p>the Hessian of the log-likelihood function evaluated at the estimated parameters.</p>
</td></tr>
<tr><td><code>mu.hat</code></td>
<td>
<p>a <code>data.frame</code> containing the estimated cluster-specific
random effects (shrinkage estimators).</p>
</td></tr>
<tr><td><code>var.mu.hat</code></td>
<td>
<p>the covariance matrix of the
cluster-specific shrinkage estimators.</p>
</td></tr>
<tr><td><code>vcov.fix.mu.hat</code></td>
<td>
<p>a <code>matrix</code> containing the covariances
between the fixed effect and the
cluster-specific shrinkage estimators. More specifically, the i-th line
of the matrix represents the covariances between the shrinkage
estimator of the i-th cluster and the fixed effect estimates. This
matrix is used by the function <code>predict.mexhaz</code> to make
cluster-specific predictions.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>original dataset used to fit the model (if
<code>keep.data</code> was set to <code>TRUE</code>).</p>
</td></tr>
<tr><td><code>n.par</code></td>
<td>
<p>number of estimated parameters.</p>
</td></tr>
<tr><td><code>n.gleg</code></td>
<td>
<p>number of Gauss-Legendre quadrature points used to
calculate the cumulative (excess) hazard (only relevant if a
B-spline of degree 2 or 3 or a cubic restricted spline was used to
model the logarithm of the baseline hazard).</p>
</td></tr>
<tr><td><code>n.aghq</code></td>
<td>
<p>number of adaptive Gauss-Hermite quadrature points used to
calculate the cluster-specific marginal likelihoods (only relevant
if a multi-level model is fitted).</p>
</td></tr>
<tr><td><code>fnoptim</code></td>
<td>
<p>name of the R optimisation procedure used to maximise the likelihood.</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p>optimisation method used by <code>optim</code>.</p>
</td></tr>
<tr><td><code>code</code></td>
<td>
<p>code (integer) indicating the status of the optimisation
process (this code has a different meaning for <code>nlm</code> and for
<code>optim</code>: see their respective help page for details).</p>
</td></tr>
<tr><td><code>loglik</code></td>
<td>
<p>value of the log-likelihood at the end of the
optimisation procedure.</p>
</td></tr>
<tr><td><code>iter</code></td>
<td>
<p>number of iterations used in the
optimisation process.</p>
</td></tr>
<tr><td><code>eval</code></td>
<td>
<p>number of evaluations used in the
optimisation process.</p>
</td></tr>
<tr><td><code>time.elapsed</code></td>
<td>
<p>total time required to reach convergence.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Hadrien Charvat, Aurelien Belot
</p>


<h3>References</h3>

<p>Charvat H, Remontet L, Bossard N, Roche L, Dejardin O,
Rachet B, Launoy G, Belot A; CENSUR Working Survival Group. A
multilevel excess hazard model to estimate net survival on
hierarchical data allowing for non-linear and non-proportional effects
of covariates. Stat Med 2016;35(18):3066-3084 (doi: 10.1002/sim.6881)
</p>
<p>Charvat H, Belot A. An R package for fitting flexible hazard-based
regression models for overall and excess mortality with a random
effect. J Stat Softw 2021;98(14):1-36 (doi: 10.18637/jss.v098.i14)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fixef.mexhaz">fixef.mexhaz</a></code>, <code><a href="#topic+predict.mexhaz">predict.mexhaz</a></code>, <code><a href="#topic+print.mexhaz">print.mexhaz</a></code>,
<code><a href="#topic+ranef.mexhaz">ranef.mexhaz</a></code>, <code><a href="#topic+summary.mexhaz">summary.mexhaz</a></code>, <code><a href="#topic+update.mexhaz">update.mexhaz</a></code>, <code><a href="#topic+vcov.mexhaz">vcov.mexhaz</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(simdatn1)

## Fit of a mixed-effect excess hazard model, with the baseline hazard
## described by a Weibull distribution (without covariables)

Mod_weib_mix &lt;- mexhaz(formula=Surv(time=timesurv,
event=vstat)~1, data=simdatn1, base="weibull",
expected="popmrate", verbose=0, random="clust")


## More complex examples (not run)

## Fit of a mixed-effect excess hazard model, with the baseline hazard
## described by a cubic B-spline with two knots at 1 and 5 year and with
## effects of age (agecr), deprivation index (depindex) and sex (IsexH)

# Mod_bs3_2mix_nph &lt;- mexhaz(formula=Surv(time=timesurv,
# event=vstat)~agecr+depindex+IsexH+nph(agecr), data=simdatn1,
# base="exp.bs", degree=3, knots=c(1,5), expected="popmrate",
# random="clust", verbose=1000)

## Fit of a mixed-effect excess hazard model, with the baseline hazard
## described by a restricted cubic spline with two knots at the
## tertiles of the distribution of follow-up times for individuals who
## presented the event and with effects of age (agecr) and sex (IsexH)

# Mod_ns3_2mix_nph &lt;- mexhaz(formula=Surv(time=timesurv,
# event=vstat)~agecr+nph(agecr), data=simdatn1, base="exp.ns", degree=3,
# knots=quantile(simdatn1[simdatn1$vstat==1,]$timesurv, probs=c(1:2/3)),
# expected="popmrate", random="clust", verbose=1000)

</code></pre>

<hr>
<h2 id='plot.predMexhaz'>Plot method for a predMexhaz object</h2><span id='topic+plot.predMexhaz'></span>

<h3>Description</h3>

<p>Function for plotting the predicted (excess) hazard or
(net) survival based on a <code>predMexhaz</code> object.</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'predMexhaz'
plot(x, which = c("surv", "hazard"), conf.int =
TRUE, lty.pe = "solid", lty.ci = "dashed", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.predMexhaz_+3A_x">x</code></td>
<td>
<p>an object of class <code>predMexhaz</code>, corresponding to
(excess) hazard and (net) survival predictions based on a  survival
model fitted with the <code>mexhaz</code> function. Predictions can be
obtained for multiple times for one vector of covariables
(<code>"multitime"</code>) or for several vectors of covariables at one
time point (<code>"multiobs"</code>). The <code>plot()</code> function only
applies to the <code>"multitime"</code> type of predictions.
</p>
</td></tr>
<tr><td><code id="plot.predMexhaz_+3A_which">which</code></td>
<td>
<p>type of curve to be plotted. Selection can be made
between <code>"surv"</code> (default value) for the (net) survival curve
and <code>"hazard"</code> for the (excess) hazard.</p>
</td></tr>
<tr><td><code id="plot.predMexhaz_+3A_conf.int">conf.int</code></td>
<td>
<p>logical value allowing the user to decide whether to
plot the confidence limits of the survival (or hazard).</p>
</td></tr>
<tr><td><code id="plot.predMexhaz_+3A_lty.pe">lty.pe</code></td>
<td>
<p>type of line used for drawing the hazard/survival estimate.</p>
</td></tr>
<tr><td><code id="plot.predMexhaz_+3A_lty.ci">lty.ci</code></td>
<td>
<p>type of line used for drawing the confidence
limits.</p>
</td></tr>
<tr><td><code id="plot.predMexhaz_+3A_...">...</code></td>
<td>
<p>additional parameters that are directly passed to the
<code>plot</code> function. These parameters will apply simultaneously to
the point estimate and confidence limit curves.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+predict.mexhaz">predict.mexhaz</a></code>, <code><a href="#topic+points.predMexhaz">points.predMexhaz</a></code>, <code><a href="#topic+lines.predMexhaz">lines.predMexhaz</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(simdatn1)

## Fit of a fixed-effect hazard model, with the baseline hazard
## described by a linear B-spline with two knots at 1 and 5 year and with
## effects of age (agecr), deprivation index (depindex) and sex (IsexH)

Mod_bs2_2 &lt;- mexhaz(formula=Surv(time=timesurv,
event=vstat)~agecr+depindex+IsexH, data=simdatn1, base="exp.bs",
degree=2, knots=c(1,5), verbose=0)

## Prediction at several time points for one vector of covariates
Pred_Modbs2_2A &lt;- predict(Mod_bs2_2, time.pts=seq(0,10,by=0.1),
data.val=data.frame(agecr=0,depindex=0.5,IsexH=1))

plot(Pred_Modbs2_2A, which="hazard")

</code></pre>

<hr>
<h2 id='plot.resMexhaz'>Plot method for a resMexhaz object</h2><span id='topic+plot.resMexhaz'></span>

<h3>Description</h3>

<p>Function for plotting various quantities calculated from a
<code>mexhaz</code> model.</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'resMexhaz'
plot(x, conf.int = TRUE, lty.pe = "solid", lty.ci =
"blank", col.ci = "blue", alpha.col.ci = 0.25, ylim = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.resMexhaz_+3A_x">x</code></td>
<td>
<p>an object of class <code>resMexhaz</code>, corresponding to
various predictions based on a survival
model fitted with the <code>mexhaz</code> function. Predictions can be
obtained for multiple times for one vector of covariables
(<code>"multitime"</code>) or for several vectors of covariables at one
time point (<code>"multiobs"</code>). The <code>plot()</code> function only
applies to the <code>"multitime"</code> type of predictions.
</p>
</td></tr>
<tr><td><code id="plot.resMexhaz_+3A_conf.int">conf.int</code></td>
<td>
<p>logical value allowing the user to decide whether to
plot the confidence limits of the survival (or hazard).</p>
</td></tr>
<tr><td><code id="plot.resMexhaz_+3A_lty.pe">lty.pe</code></td>
<td>
<p>type of line used for drawing the hazard/survival estimate.</p>
</td></tr>
<tr><td><code id="plot.resMexhaz_+3A_lty.ci">lty.ci</code></td>
<td>
<p>type of line used for drawing the confidence
limits.</p>
</td></tr>
<tr><td><code id="plot.resMexhaz_+3A_col.ci">col.ci</code></td>
<td>
<p>color used to fill in the polygon defined by the
confidence limits.</p>
</td></tr>
<tr><td><code id="plot.resMexhaz_+3A_alpha.col.ci">alpha.col.ci</code></td>
<td>
<p>parameter used internally by the <code>rgb()</code>
function to set the color transparency.</p>
</td></tr>
<tr><td><code id="plot.resMexhaz_+3A_ylim">ylim</code></td>
<td>
<p>when set to <code>NULL</code> (default value), the range of the
y-axis is based on the range of the confidence limits of the
quantity to be plotted.</p>
</td></tr>
<tr><td><code id="plot.resMexhaz_+3A_...">...</code></td>
<td>
<p>additional parameters that are directly passed to the
<code>plot</code> function. These parameters will apply simultaneously to
the point estimate and confidence limit curves.</p>
</td></tr>
</table>


<h3>See Also</h3>

 <p><code><a href="#topic+adjsurv">adjsurv</a></code>, <code><a href="#topic+riskfunc">riskfunc</a></code>,
<code><a href="#topic+lines.resMexhaz">lines.resMexhaz</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(simdatn1)

## Fit of a fixed-effect hazard model, with the baseline hazard
## described by a linear B-spline with two knots at 1 and 5 year and with
## effects of age (agecr), deprivation index (depindex) and sex (IsexH)

Mod_bs2 &lt;- mexhaz(formula=Surv(time=timesurv,
event=vstat)~agecr+depindex+IsexH, data=simdatn1, base="exp.bs",
degree=2, knots=c(1,5), verbose=0)

## Relative risk (ratio of cumulative incidence curves) for men versus
## women

RR_Modbs2 &lt;- riskfunc(Mod_bs2, time.pts=seq(0,10, by=0.1),
data=data.frame(agecr=0.1, IsexH=1, depindex=0),
data.0=data.frame(agecr=0.1, IsexH=0, depindex=0), conf.int="delta",
type="rr")

plot(RR_Modbs2)
abline(h=1, lty="dashed")

</code></pre>

<hr>
<h2 id='points.predMexhaz'>Points method for a predMexhaz object</h2><span id='topic+points.predMexhaz'></span>

<h3>Description</h3>

<p>Function for adding to an already existing graphical window
the predicted (excess) hazard or (net) survival based on a <code>predMexhaz</code> object.</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'predMexhaz'
points(x, which = c("surv", "hazard"), conf.int =
TRUE, lty.pe = "solid", lty.ci = "dashed", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="points.predMexhaz_+3A_x">x</code></td>
<td>
<p>an object of class <code>predMexhaz</code>, corresponding to
(excess) hazard and (net) survival predictions based on a  survival
model fitted with the <code>mexhaz</code> function. Predictions can be
obtained for multiple times for one vector of covariables
(<code>"multitime"</code>) or for several vectors of covariables at one
time point (<code>"multiobs"</code>). The <code>points()</code> function only
applies to the <code>"multitime"</code> type of predictions.
</p>
</td></tr>
<tr><td><code id="points.predMexhaz_+3A_which">which</code></td>
<td>
<p>type of curve to be plotted. Selection can be made
between <code>"surv"</code> (default value) for the (net) survival curve
and <code>"hazard"</code> for the (excess) hazard.</p>
</td></tr>
<tr><td><code id="points.predMexhaz_+3A_conf.int">conf.int</code></td>
<td>
<p>logical values allowing the user to decide whether to
plot the confidence limits of the survival (or hazard).</p>
</td></tr>
<tr><td><code id="points.predMexhaz_+3A_lty.pe">lty.pe</code></td>
<td>
<p>type of line used for drawing the hazard/survival
estimate (used when 'type=&quot;l&quot;').</p>
</td></tr>
<tr><td><code id="points.predMexhaz_+3A_lty.ci">lty.ci</code></td>
<td>
<p>type of line used for drawing the confidence limits (used when 'type=&quot;l&quot;').</p>
</td></tr>
<tr><td><code id="points.predMexhaz_+3A_...">...</code></td>
<td>
<p>additional parameters that are directly passed to the
<code>points</code> function. These parameters, if not already used
internally by the <code>points.predMexhaz</code> function, will apply simultaneously to
the point estimate and confidence limit curves.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+predict.mexhaz">predict.mexhaz</a></code>, <code><a href="#topic+plot.predMexhaz">plot.predMexhaz</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(simdatn1)

## Fit of a fixed-effect hazard model, with the baseline hazard
## described by a linear B-spline with two knots at 1 and 5 year and with
## effects of age (agecr), deprivation index (depindex) and sex (IsexH)

Mod_bs2_2 &lt;- mexhaz(formula=Surv(time=timesurv,
event=vstat)~agecr+depindex+IsexH, data=simdatn1, base="exp.bs",
degree=2, knots=c(1,5), verbose=0)

## Prediction at several time points for one vector of covariates
Pred_Modbs2_2A &lt;- predict(Mod_bs2_2, time.pts=seq(0,10,by=0.1),
data.val=data.frame(agecr=0,depindex=0.5,IsexH=1))

plot(Pred_Modbs2_2A, which="hazard", col="red")
points(Pred_Modbs2_2A, which="hazard", type="l", conf.int=FALSE)

</code></pre>

<hr>
<h2 id='predict.mexhaz'>Predictions based on a mexhaz model</h2><span id='topic+predict.mexhaz'></span>

<h3>Description</h3>

<p>Function for predicting the (excess) hazard and the
corresponding (net) survival from a model fitted with the <code>mexhaz</code>
function for a particular vector of covariates. If the survival model
was fitted with an expected hazard (excess hazard model), the estimates
obtained are excess hazard and net survival estimates. Corresponding
variance estimates are based on the Delta Method or Monte Carlo
simulation (based on the assumption of multivariate normality of the
model parameter estimates). This function allows the computation of the
hazard and the survival at one time point for several vectors of
covariates or for one vector of covariates at several time
points. When the model includes a random effect, three types of
predictions can be made: (i) marginal predictions (obtained by
integration over the random effect distribution), (ii) cluster-specific
posterior predictions for an existing cluster, or (iii) conditional
predictions for a given quantile of the random effect distribution (by
default, for the median value, that is, 0).</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mexhaz'
predict(object, time.pts, data.val = data.frame(.NotUsed = NA),
marginal = FALSE, quant.rdm = 0.5, cluster = NULL, conf.int = c("delta", "simul", "none"),
level = 0.95, delta.type.h = c("log", "plain"), delta.type.s = c("log-log",
"log", "plain"), nb.sim = 10000, keep.sim = FALSE, include.gradient =
FALSE, dataset = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict.mexhaz_+3A_object">object</code></td>
<td>
<p>an object of class <code>mexhaz</code>, corresponding to a
hazard-based regression model fitted with the <code>mexhaz</code> function.</p>
</td></tr>
<tr><td><code id="predict.mexhaz_+3A_time.pts">time.pts</code></td>
<td>
<p>a vector of numerical values representing the time
points at which predictions are requested. Time values greater than
the maximum follow-up time on which the model estimation was based
are discarded.</p>
</td></tr>
<tr><td><code id="predict.mexhaz_+3A_data.val">data.val</code></td>
<td>
<p>a <code>data.frame</code> containing the values of the
covariates at which predictions should be calculated.</p>
</td></tr>
<tr><td><code id="predict.mexhaz_+3A_marginal">marginal</code></td>
<td>
<p>logical value controlling the type of predictions
returned by the function when the model includes a random
intercept. When <code>TRUE</code>, marginal predictions are computed. The
marginal survival is obtained by integrating the predicted survival over the
distribution of the random effect. The marginal hazard rate is
obtained as the opposite of the marginal time
derivative of the survival divided by the marginal survival. When
<code>FALSE</code> (default value), cluster-specific posterior predictions
or conditional predictions are calculated depending on the
value of the <code>cluster</code> argument.</p>
</td></tr>
<tr><td><code id="predict.mexhaz_+3A_quant.rdm">quant.rdm</code></td>
<td>
<p>numerical value (between 0 and 1) specifying the
quantile of the random effect distribution that should be used when
requesting conditional predictions. The default value is set to 0.5
(corresponding to the median, that is a value of the random effect
of 0). This argument is ignored if the model is a fixed effect
model, when the <code>marginal</code> argument is set to <code>TRUE</code>, or
the <code>cluster</code> argument is not <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="predict.mexhaz_+3A_cluster">cluster</code></td>
<td>
<p>a single value corresponding to the name of the cluster for
which posterior predictions should be calculated. These predictions
are obtained by integrating over the cluster-specific posterior
distribution of the random effect and thus require the original
dataset. The dataset can either be provided as part of the
<code>mexhaz</code> object given as argument or by specifying the name of
the dataset in the <code>dataset</code> argument (see below). The <code>cluster</code> argument is not used if the model is a fixed effect
model. The default value is <code>NULL</code>: this corresponds to
marginal predictions (if <code>marginal</code> is set to <code>TRUE</code>, the preferred
option), or to conditional predictions for a given quantile (by
default, the median) of the distribution of the random
effect (if <code>marginal</code> is set to <code>FALSE</code>).</p>
</td></tr>
<tr><td><code id="predict.mexhaz_+3A_conf.int">conf.int</code></td>
<td>
<p>method to be used to compute confidence
limits. Selection can be made between the following options:
<code>"delta"</code> for the Delta Method (default value);
<code>"simul"</code> for Monte Carlo simulations (can be time-consuming,
especially for models using B-splines for the logarithm of the
baseline hazard);
<code>"none"</code> indicates absence of confidence limits estimation.</p>
</td></tr>
<tr><td><code id="predict.mexhaz_+3A_level">level</code></td>
<td>
<p>a number in (0,1) specifying the level of confidence for
computing the confidence intervals of the hazard and the survival. The
default value is set to <code>0.95</code>.</p>
</td></tr>
<tr><td><code id="predict.mexhaz_+3A_delta.type.h">delta.type.h</code></td>
<td>
<p>type of confidence limits for the hazard when
using the Delta Method. With the default value (<code>"log"</code>), the
confidence limits are based on a Wald-type confidence interval for
the logarithm of the hazard, otherwise they are based directly on
a Wald-type CI for the hazard.</p>
</td></tr>
<tr><td><code id="predict.mexhaz_+3A_delta.type.s">delta.type.s</code></td>
<td>
<p>type of confidence limits for the survival when
using the Delta Method. With the default value (<code>"log-log"</code>),
the confidence limits are based on a Wald-type confidence interval
for the logarithm of the cumulative hazard; when the argument is
set to <code>"log"</code>, they are based on a Wald-type CI for the
cumulative hazard; otherwise they are based directly on a
Wald-type CI for the survival.</p>
</td></tr>
<tr><td><code id="predict.mexhaz_+3A_nb.sim">nb.sim</code></td>
<td>
<p>integer value representing the number of simulations
used to estimate the confidence limits for the (excess) hazard
and the (net) survival. This argument is used only if
<code>conf.int</code> is set to <code>"simul"</code>.</p>
</td></tr>
<tr><td><code id="predict.mexhaz_+3A_keep.sim">keep.sim</code></td>
<td>
<p>logical value determining if the simulated hazard and
survival values should be returned (only used when
<code>conf.int</code> is set to <code>"simul"</code>). These simulated values can be used by the
<code>riskfunc</code> function to compute simulation-based confidence
intervals for hazard ratios / risk ratios. The default value is set
to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="predict.mexhaz_+3A_include.gradient">include.gradient</code></td>
<td>
<p>logical value allowing the function to return
the components of the gradient of the logarithm of the hazard and of
the logarithm of the cumulative hazard for each prediction. This
argument is used only if <code>conf.int</code> is set to <code>"delta"</code>. The
default value is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="predict.mexhaz_+3A_dataset">dataset</code></td>
<td>
<p>original dataset used to fit the <code>mexhaz</code> object
given as argument to the function. This argument is only necessary
if cluster-specific posterior predictions are requested (and if the
dataset is not already provided in the <code>mexhaz</code> object). The
default value is set to <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="predict.mexhaz_+3A_...">...</code></td>
<td>
<p>for potential additional parameters.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>predMexhaz</code> that can be used by
the function <code>plot.predMexhaz</code> to produce graphics of the (excess) hazard and
the (net) survival. It contains the following elements:
</p>
<table>
<tr><td><code>call</code></td>
<td>
<p>the <code>mexhaz</code> function call on which the model is based.</p>
</td></tr>
<tr><td><code>results</code></td>
<td>
<p>a <code>data.frame</code> consisting of: the time
points at which the (excess) hazard and the (net) survival have been
calculated; the values of the covariates used to estimate the
(excess) hazard and the (net) survival; the name of the cluster (when
cluster-specific posterior predictions are requested), or the quantile
and its value (when conditional predictions are requested); the
(excess) hazard values with their confidence limits; and the (net) survival values with their confidence limits.</p>
</td></tr>
<tr><td><code>variances</code></td>
<td>
<p>a <code>data.frame</code> consisting of two columns: the
variance of the logarithm of the (excess) hazard and the variance of
the (excess) cumulative hazard for each time points or each
vector of covariates. The object <code>variances</code> is produced only when
<code>conf.int</code> is set to <code>"delta"</code>.</p>
</td></tr>
<tr><td><code>grad.loghaz</code></td>
<td>
<p>a <code>data.frame</code> consisting of the components of
the gradient of the logarithm of the (excess) hazard for each time points or each
vector of covariates. The number of columns corresponds to the number
of model parameters. This object is produced only when
<code>conf.int</code> is set to <code>"delta"</code> and <code>include.gradient</code>
to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code>grad.logcum</code></td>
<td>
<p>a <code>data.frame</code> consisting of the components of
the gradient of the logarithm of the (excess) cumulative hazard for each time points or each
vector of covariates. The number of columns corresponds to the number
of model parameters. This object is produced only when
<code>conf.int</code> is set to <code>"delta"</code> and <code>include.gradient</code>
to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code>vcov</code></td>
<td>
<p>a matrix corresponding to the covariance matrix used to
compute the confidence intervals.</p>
</td></tr>
<tr><td><code>type</code></td>
<td>
<p>this item can take the value
<code>multitime</code> (computation of the hazard and the survival at
at several time points for one vector of covariates) or
<code>multiobs</code> (computation of the hazard and the survival at
at one time point for several vectors of covariates). It is
used by <code>plot.predMexhaz</code> and <code>points.predMexhaz</code>.</p>
</td></tr>
<tr><td><code>type.me</code></td>
<td>
<p>the type of predictions produced in case of a model
including a random intercept. Can take the values <code>marginal</code>
(marginal predictions), <code>posterior</code> (cluster-specific posterior
predictions), or <code>conditional</code> (conditional prediction for a
given quantile of the distribution of the random intercept).</p>
</td></tr>
<tr><td><code>ci.method</code></td>
<td>
<p>the method used to compute confidence limits.</p>
</td></tr>
<tr><td><code>level</code></td>
<td>
<p>level of confidence used to compute confidence limits.</p>
</td></tr>
<tr><td><code>delta.type</code></td>
<td>
<p>type of confidence limits for the hazard and the
survival when using the Delta Method.</p>
</td></tr>
<tr><td><code>nb.sim</code></td>
<td>
<p>number of simulations used to estimate the confidence
limits when <code>ci.method</code> is set to <code>"simul"</code>.</p>
</td></tr>
<tr><td><code>sim.haz</code></td>
<td>
<p>matrix containing the simulated hazards (each column
representing a simulated vector of values); only returned when
<code>keep.sim</code> is set to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code>sim.surv</code></td>
<td>
<p>matrix containing the simulated survival probabilities (each column
representing a simulated vector of values); only returned when
<code>keep.sim</code> is set to <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Hadrien Charvat, Aurelien Belot
</p>


<h3>References</h3>

<p>Charvat H, Remontet L, Bossard N, Roche L, Dejardin O,
Rachet B, Launoy G, Belot A; CENSUR Working Survival Group. A
multilevel excess hazard model to estimate net survival on
hierarchical data allowing for non-linear and non-proportional effects
of covariates. Stat Med 2016;35:3066-3084 (doi: 10.1002/sim.6881).
</p>
<p>Skrondal A, Rabe-Hesketh S. Prediction in multilevel generalized
linear models. J R Stat Soc A Stat Soc 2009;172(3):659-687 (doi: 10.1111/j.1467-985X.2009.00587.x).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+print.predMexhaz">print.predMexhaz</a></code>, <code><a href="#topic+plot.predMexhaz">plot.predMexhaz</a></code>,
<code><a href="#topic+points.predMexhaz">points.predMexhaz</a></code>, <code><a href="#topic+lines.predMexhaz">lines.predMexhaz</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(simdatn1)

## Fit of a fixed-effect hazard model, with the baseline hazard
## described by a linear B-spline with two knots at 1 and 5 year and
## with effects of age (agecr), deprivation index (depindex) and sex
## (IsexH)

Mod_bs1_2 &lt;- mexhaz(formula=Surv(time=timesurv,
event=vstat)~agecr+depindex+IsexH, data=simdatn1, base="exp.bs",
degree=1, knots=c(1,5), verbose=0)

## Prediction at several time points for one vector of covariates
Pred_Modbs1_2A &lt;- predict(Mod_bs1_2, time.pts=seq(0.1,10,by=0.1),
data.val=data.frame(agecr=0,depindex=0.5,IsexH=1))

## Prediction for several vectors of covariates at one time point
Pred_Modbs1_2B &lt;- predict(Mod_bs1_2, time.pts=10,
data.val=data.frame(agecr=c(-0.2,-0.1,0), depindex=c(0.5,0.5,0.5),
IsexH=c(1,1,1)))

## Prediction for all individuals of the study population
## at one time point

Pred_Modbs1_2C &lt;- predict(Mod_bs1_2, time.pts=10,
data.val=simdatn1)


# Example of cluster-specific posterior prediction (not run)

## Fit of a mixed-effect excess hazard model, with the baseline hazard
## described by a cubic B-spline with two knots at 1 and 5 year

# Mod_bs3_2mix &lt;- mexhaz(formula=Surv(time=timesurv,
# event=vstat)~agecr+IsexH, data=simdatn1, base="exp.bs", degree=3,
# knots=c(1,5), expected="popmrate", random="clust", verbose=1000)

## Posterior predictions at several time points for an individual
## in cluster 15 with a specific vector of covariates
# Pred_Modbs3_2A &lt;- predict(Mod_bs3_2mix,
# time.pts=seq(0.1,10,by=0.1), data.val=data.frame(agecr=0.2, IsexH=1),
# cluster=15, dataset=simdatn1)

</code></pre>

<hr>
<h2 id='print.mexhaz'>Print method for a mexhaz object</h2><span id='topic+print.mexhaz'></span>

<h3>Description</h3>

<p>Display the model call as well as the values of the estimated model parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mexhaz'
print(x, ...)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.mexhaz_+3A_x">x</code></td>
<td>
<p>an object of class <code>mexhaz</code>.
</p>
</td></tr>
<tr><td><code id="print.mexhaz_+3A_...">...</code></td>
<td>

<p>represents additional parameters directly passed to <code>print</code>.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+mexhaz">mexhaz</a></code>, <code><a href="#topic+summary.mexhaz">summary.mexhaz</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(simdatn1)

## Fit of a mixed-effect excess hazard model, with the baseline hazard
## described by a Weibull distribution (without covariables)

Mod_weib_mix &lt;- mexhaz(formula=Surv(time=timesurv,
event=vstat)~1, data=simdatn1, base="weibull",
expected="popmrate", verbose=0, random="clust")

print(Mod_weib_mix)
</code></pre>

<hr>
<h2 id='print.predMexhaz'>Print method for a predMexhaz object</h2><span id='topic+print.predMexhaz'></span>

<h3>Description</h3>

<p>Display the first lines of the <code>data.frame</code> containing the
predictions provided by the <code>predMexhaz</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'predMexhaz'
print(x, ...)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.predMexhaz_+3A_x">x</code></td>
<td>
<p>an object of class <code>predMexhaz</code>.</p>
</td></tr>
<tr><td><code id="print.predMexhaz_+3A_...">...</code></td>
<td>

<p>represents additional parameters directly passed to <code>print</code>.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+predict.mexhaz">predict.mexhaz</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(simdatn1)

## Fit of a fixed-effect hazard model, with the baseline hazard
## described by a linear B-spline with two knots at 1 and 5 year and with
## effects of age (agecr), deprivation index (depindex) and sex (IsexH)

Mod_bs1_2 &lt;- mexhaz(formula=Surv(time=timesurv,
event=vstat)~agecr+depindex+IsexH, data=simdatn1, base="exp.bs",
degree=1, knots=c(1,5), verbose=0)

## Prediction at several time points for one vector of covariates
Pred_Modbs1_2A &lt;- predict(Mod_bs1_2, time.pts=seq(0.1,10,by=0.1),
data.val=data.frame(agecr=0,depindex=0.5,IsexH=1), conf.int="delta")

print(Pred_Modbs1_2A)
</code></pre>

<hr>
<h2 id='print.summary.mexhaz'>Printing method for a summary.mexhaz object</h2><span id='topic+print.summary.mexhaz'></span>

<h3>Description</h3>

<p>Display the model call, the values of the estimated model parameters,
as well as the corresponding hazard ratios (only for proportional effects).</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'summary.mexhaz'
print(x, ...)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.summary.mexhaz_+3A_x">x</code></td>
<td>
<p>an object of class <code>summary.mexhaz</code>.</p>
</td></tr>
<tr><td><code id="print.summary.mexhaz_+3A_...">...</code></td>
<td>

<p>represents additional parameters directly passed to <code>print</code>.
</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+mexhaz">mexhaz</a></code>, <code><a href="#topic+print.mexhaz">print.mexhaz</a></code>, <code><a href="#topic+summary.mexhaz">summary.mexhaz</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(simdatn1)

## Fit of a mixed-effect excess hazard model, with the baseline hazard
## described by a Weibull distribution (without covariables)

Mod_weib &lt;- mexhaz(formula=Surv(time=timesurv,
event=vstat)~1, data=simdatn1, base="weibull", verbose=0)

summary(Mod_weib)
</code></pre>

<hr>
<h2 id='ranef'>Method for extracting random effects</h2><span id='topic+ranef'></span>

<h3>Description</h3>

<p>This is a generic function.</p>


<h3>Usage</h3>

<pre><code class='language-R'>ranef(x, ...)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ranef_+3A_x">x</code></td>
<td>
<p>a fitted object from which random effects can be extracted.</p>
</td></tr>
<tr><td><code id="ranef_+3A_...">...</code></td>
<td>
<p>might be used by some methods using this generic function.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>see the documentation for the specific class.</p>


<h3>See Also</h3>

<p><code><a href="#topic+fixef">fixef</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>## See the specific class documentation.
</code></pre>

<hr>
<h2 id='ranef.mexhaz'>Method for extracting random effects from a mexhaz object</h2><span id='topic+ranef.mexhaz'></span>

<h3>Description</h3>

<p>Display a data frame containing the cluster-specific random effects
with their standard errors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mexhaz'
ranef(x, ...)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ranef.mexhaz_+3A_x">x</code></td>
<td>
<p>an object of class <code>mexhaz</code>.</p>
</td></tr>
<tr><td><code id="ranef.mexhaz_+3A_...">...</code></td>
<td>
<p>not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with three columns containing the cluster names, the random
effect estimates, and their standard errors.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mexhaz">mexhaz</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(simdatn1)

## Fit of a mixed-effect excess hazard model, with the baseline hazard
## described by a Weibull distribution (without covariables)

Mod_weib_mix &lt;- mexhaz(formula=Surv(time=timesurv,
event=vstat)~1, data=simdatn1, base="weibull",
expected="popmrate", verbose=0, random="clust")

ranef(Mod_weib_mix)
</code></pre>

<hr>
<h2 id='riskfunc'>Computation of hazard ratio and risk ratio estimates based on a mexhaz
model</h2><span id='topic+riskfunc'></span>

<h3>Description</h3>

<p>Function for computing hazard ratio and risk ratio (ratio
of cumulative probabilities of failure) estimates from a model fitted
with the <code>mexhaz</code> function. Corresponding confidence intervals
are based on the Delta Method or Monte Carlo simulation (based on the
assumption of multivariate normality of the model parameter
estimates). This function allows the computation of estimates at one
time point for several vectors of covariates or for one vector of
covariates at several time points.  When the model includes a random effect, three types of
predictions can be made: (i) marginal predictions (obtained by
integration over the random effect distribution), (ii) cluster-specific
posterior predictions for an existing cluster, or (iii) conditional
predictions for a given quantile of the random effect distribution (by
default, for the median value, that is, 0).</p>


<h3>Usage</h3>

<pre><code class='language-R'>riskfunc(object, time.pts, data, data.0, marginal = TRUE, quant.rdm = 0.5,
cluster = NULL, quant.rdm.0 = 0.5, cluster.0 = NULL, type = c("hr", "rr"),
conf.int = c("delta", "simul"), level = 0.95, nb.sim = 10000, seed = NULL,
dataset = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="riskfunc_+3A_object">object</code></td>
<td>
<p>an object of class <code>mexhaz</code>, corresponding to a
hazard-based regression model fitted with the <code>mexhaz</code> function.</p>
</td></tr>
<tr><td><code id="riskfunc_+3A_time.pts">time.pts</code></td>
<td>
<p>a vector of numerical values representing the time
points at which predictions are requested. Time values greater than
the maximum follow-up time on which the model estimation was based
are discarded.</p>
</td></tr>
<tr><td><code id="riskfunc_+3A_data">data</code></td>
<td>
<p>a <code>data.frame</code> containing the values of the
covariates of the population for which hazard ratios or risk ratios
are to be calculated.</p>
</td></tr>
<tr><td><code id="riskfunc_+3A_data.0">data.0</code></td>
<td>
<p>a <code>data.frame</code> containing the values of the
covariates of the reference population. Each row of <code>data.0</code> is
used as the reference for the corresponding row of <code>data</code>.</p>
</td></tr>
<tr><td><code id="riskfunc_+3A_marginal">marginal</code></td>
<td>
<p>logical value controlling the type of predictions
returned by the function when the model includes a random
intercept. When <code>TRUE</code>, marginal predictions are computed. The
marginal survival is obtained by integrating the predicted survival
over the distribution of the random effect. When <code>FALSE</code>
(default value), conditional predictions depending on the value of
the <code>cluster</code> argument are calculated.</p>
</td></tr>
<tr><td><code id="riskfunc_+3A_quant.rdm">quant.rdm</code></td>
<td>
<p>numerical value (between 0 and 1) specifying the
quantile of the random effect distribution that should be used when
requesting conditional predictions. The default value is set to 0.5
(corresponding to the median, that is a value of the random effect
of 0). This argument is ignored if the model is a fixed effect
model, when the <code>marginal</code> argument is set to <code>TRUE</code>, or
the <code>cluster</code> argument is not <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="riskfunc_+3A_cluster">cluster</code></td>
<td>
<p>a single value corresponding to the name of the cluster for
which posterior predictions should be calculated. These predictions
are obtained by integrating over the cluster-specific posterior
distribution of the random effect and thus require the original
dataset. The dataset can either be provided as part of the
<code>mexhaz</code> object given as argument or by specifying the name of
the dataset in the <code>dataset</code> argument (see below). The
<code>cluster</code> argument is not used if the model is a fixed effect
model. The default value is <code>NULL</code>: this corresponds to
marginal predictions (if <code>marginal</code> is set to <code>TRUE</code>, the preferred
option), or to conditional predictions for a given quantile (by
default, the median) of the distribution of the random
effect (if <code>marginal</code> is set to <code>FALSE</code>).</p>
</td></tr>
<tr><td><code id="riskfunc_+3A_quant.rdm.0">quant.rdm.0</code></td>
<td>
<p>random effect distribution quantile value to be used with <code>data.0</code> (see
argument <code>quant.rdm</code> for details).</p>
</td></tr>
<tr><td><code id="riskfunc_+3A_cluster.0">cluster.0</code></td>
<td>
<p>cluster value to be used with <code>data.0</code> (see
argument <code>cluster</code> for details).</p>
</td></tr>
<tr><td><code id="riskfunc_+3A_type">type</code></td>
<td>
<p>argument specifying the type of predictions to be
calculated. Selection can be made between <code>"hr"</code> (hazard ratio)
and <code>"rr"</code> (risk ratio, i.e., ratio of cumulative failure
probabilities).</p>
</td></tr>
<tr><td><code id="riskfunc_+3A_conf.int">conf.int</code></td>
<td>
<p>method to be used to compute confidence
limits. Selection can be made between the following options:
<code>"delta"</code> for the Delta Method (default value);
<code>"simul"</code> for Monte Carlo simulations (can be time-consuming,
especially for models using B-splines for the logarithm of the
baseline hazard).</p>
</td></tr>
<tr><td><code id="riskfunc_+3A_level">level</code></td>
<td>
<p>a number in (0,1) specifying the level of confidence for
computing the confidence intervals of the hazard and the
survival. By default, this argument is set to <code>0.95</code>.</p>
</td></tr>
<tr><td><code id="riskfunc_+3A_nb.sim">nb.sim</code></td>
<td>
<p>integer value representing the number of simulations
used to estimate the confidence limits for the (excess) hazard
and the (net) survival. This argument is used only if
<code>conf.int</code> is set to <code>"simul"</code>.</p>
</td></tr>
<tr><td><code id="riskfunc_+3A_seed">seed</code></td>
<td>
<p>argument allowing the user to set a random seed for
simulations (only relevant when <code>conf.int</code> is set to
<code>"simul"</code>). The default value is set to <code>NULL</code> in which case
a random seed is automatically generated inside the function.</p>
</td></tr>
<tr><td><code id="riskfunc_+3A_dataset">dataset</code></td>
<td>
<p>original dataset used to fit the <code>mexhaz</code> object
given as argument to the function. This argument is only necessary
if cluster-specific posterior predictions are requested (and if the
dataset is not already provided in the <code>mexhaz</code> object). The
default value is set to <code>NULL</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>resMexhaz</code> that can be used by the function
<code>plot.resMexhaz</code> to produce graphics
of the hazard ratio or risk ratio curve. It contains the following
elements:
</p>
<table>
<tr><td><code>results</code></td>
<td>
<p>a <code>data.frame</code> consisting of: the time points at
which values have been calculated; the
hazard ratio / risk ratio values with their confidence limits.</p>
</td></tr>
<tr><td><code>type</code></td>
<td>
<p>type of results returned by the function. The value is
used by <code>plot.resMexhaz</code> and <code>lines.resMexhaz</code>, and can take
the values <code>"hr"</code> (hazard ratio) or <code>"rr"</code> (risk ratio).</p>
</td></tr>
<tr><td><code>multiobs</code></td>
<td>
<p>value used by
<code>plot.resMexhaz</code> and <code>lines.resMexhaz</code>, and set to
<code>FALSE</code> when estimates are computed at several time
points for one vector of covariates.</p>
</td></tr>
<tr><td><code>ci.method</code></td>
<td>
<p>method used to compute confidence limits.</p>
</td></tr>
<tr><td><code>level</code></td>
<td>
<p>level of confidence used to compute confidence limits.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Hadrien Charvat, Aurelien Belot
</p>


<h3>References</h3>

<p>Charvat H, Remontet L, Bossard N, Roche L, Dejardin O,
Rachet B, Launoy G, Belot A; CENSUR Working Survival Group. A
multilevel excess hazard model to estimate net survival on
hierarchical data allowing for non-linear and non-proportional effects
of covariates. Stat Med 2016;35:3066-3084 (doi: 10.1002/sim.6881)
</p>
<p>Skrondal A, Rabe-Hesketh S. Prediction in multilevel generalized
linear models. J R Stat Soc A Stat Soc 2009;172(3):659-687 (doi: 10.1111/j.1467-985X.2009.00587.x).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.resMexhaz">plot.resMexhaz</a></code>, <code><a href="#topic+lines.resMexhaz">lines.resMexhaz</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(simdatn1)

## Fit of a fixed-effect hazard model, with the baseline hazard
## described by a linear B-spline with two knots at 1 and 5 year and with
## effects of age (agecr), deprivation index (depindex) and sex (IsexH)

Mod_bs1_2 &lt;- mexhaz(formula=Surv(time=timesurv,
event=vstat)~agecr+depindex+IsexH, data=simdatn1, base="exp.bs",
degree=1, knots=c(1,5), verbose=0)

## Risk ratio along time for agecr=0.2 compared to agecr=0.1

RR_Modbs1_2 &lt;- riskfunc(Mod_bs1_2, time.pts=seq(0,10,le=101),
data=data.frame(agecr=0.2,depindex=0,IsexH=1),
data.0=data.frame(agecr=0.1,depindex=0,IsexH=1),type="rr",
conf.int="delta")

plot(RR_Modbs1_2)

</code></pre>

<hr>
<h2 id='simdatn1'>Simulated dataset</h2><span id='topic+simdatn1'></span>

<h3>Description</h3>

<p>The <code>simdatn1</code> dataset has 4000 rows and 8 columns.
</p>


<h3>Format</h3>

<p>This dataset contains the following columns:
</p>

<dl>
<dt>age</dt><dd><p>Age at diagnosis (continuous).
</p>
</dd>
<dt>agecr</dt><dd><p>Centred and rescaled age variable (age-70)/100.
</p>
</dd>
<dt>depindex</dt><dd><p>Deprivation index (continuous).
</p>
</dd>
<dt>IsexH</dt><dd><p>Sex (0 = Female, 1 = Male).
</p>
</dd>
<dt>clust</dt><dd><p>ID number of the cluster.
</p>
</dd>
<dt>vstat</dt><dd><p>Vital status (0 = Alive, 1 = Dead).</p>
</dd>
<dt>timesurv</dt><dd><p>Follow-up time (years).</p>
</dd>
<dt>popmrate</dt><dd><p>Population (expected) mortality rate at the
time of censoring.</p>
</dd>
</dl>


<hr>
<h2 id='simdatn2'>Simulated dataset</h2><span id='topic+simdatn2'></span>

<h3>Description</h3>

<p>The <code>simdatn2</code> dataset has 4000 rows and 8 columns. The
<code>IsexH</code> variable is simulated with a non-proportional effect.
</p>


<h3>Format</h3>

<p>This dataset contains the following columns:
</p>

<dl>
<dt>age</dt><dd><p>Age at diagnosis (continuous).
</p>
</dd>
<dt>agecr</dt><dd><p>Centred and rescaled age variable (age-70)/100.
</p>
</dd>
<dt>depindex</dt><dd><p>Deprivation index (continuous).
</p>
</dd>
<dt>IsexH</dt><dd><p>Sex (0 = Female, 1 = Male).
</p>
</dd>
<dt>clust</dt><dd><p>ID number of the cluster.
</p>
</dd>
<dt>vstat</dt><dd><p>Vital status (0 = Alive, 1 = Dead).</p>
</dd>
<dt>timesurv</dt><dd><p>Follow-up time (years).</p>
</dd>
<dt>popmrate</dt><dd><p>Population (expected) mortality rate at the
time of censoring.</p>
</dd>
</dl>


<hr>
<h2 id='summary.mexhaz'>Summary method for a mexhaz object</h2><span id='topic+summary.mexhaz'></span>

<h3>Description</h3>

<p>Produces a summary of a mexhaz object.</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mexhaz'
summary(object, ...)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.mexhaz_+3A_object">object</code></td>
<td>
<p>an object of class <code>mexhaz</code>.</p>
</td></tr>
<tr><td><code id="summary.mexhaz_+3A_...">...</code></td>
<td>

<p>represents additional parameters directly passed to <code>summary</code>.
</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+mexhaz">mexhaz</a></code>, <code><a href="#topic+print.mexhaz">print.mexhaz</a></code>, <code><a href="#topic+print.summary.mexhaz">print.summary.mexhaz</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(simdatn1)

## Fit of a mixed-effect excess hazard model, with the baseline hazard
## described by a Weibull distribution (without covariables)

Mod_weib &lt;- mexhaz(formula=Surv(time=timesurv,
event=vstat)~1, data=simdatn1, base="weibull", verbose=0)

summary(Mod_weib)
</code></pre>

<hr>
<h2 id='update.mexhaz'>Update of a mexhaz model</h2><span id='topic+update.mexhaz'></span>

<h3>Description</h3>

<p>Function allowing the user to update an existing mexhaz model. All the
arguments of the model can be updated. If the argument 'init' is not
provided, the function uses the estimated values of the existing model
as starting values for the corresponding parameters of the new model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mexhaz'
update(object, formula, data, expected = NULL, base = NULL, 
degree = 3, knots = NULL, bound = NULL, n.gleg = 20, init = NULL,
random = NULL, n.aghq = 10, fnoptim = c("nlm", "optim"), 
verbose = 0, method = "Nelder-Mead", iterlim = 10000, numHess = FALSE,
print.level = 1, exactGradHess = TRUE, gradtol = 
ifelse(exactGradHess, 1e-8, 1e-6), envir = parent.frame(), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="update.mexhaz_+3A_object">object</code></td>
<td>
<p>an object of class <code>mexhaz</code>, corresponding to a survival model fitted with the <code>mexhaz</code> function.
</p>
</td></tr>
<tr><td><code id="update.mexhaz_+3A_formula">formula</code></td>
<td>

<p>a formula object, with the response on the left of the <code>~</code>
operator, and the linear predictor on the right. The response must be of
the form <code>Surv(time, event)</code> for right censored data or
<code>Surv(time, time2, event)</code> for counting process style data. The linear predictor accepts a
special instruction <code>nph()</code> for specifying variables for which a
time-dependent effect should be modelled (if several variables are
modelled with time-dependent effects, separate these variables inside the
<code>nph()</code> instruction with a <code>+</code> sign).
</p>
<p>In case <code>time</code> takes the value 0 for some observations when data
are entered in the right censored style, it is
assumed that these observations refer to events (or censoring) that occurred
on the first day of follow-up. Consequently, a value of 1/730.5 (half a
day) is substituted in order to make computations possible. However, it
should be stressed that this is just a convention and that it does not
make much sense if the time scale is not expressed in years. We therefore
advise the analyst to deal with 0 time values during the dataset preparation stage.
</p>
<p>See <code><a href="stats.html#topic+update.formula">update.formula</a></code> for more details.</p>
</td></tr>
<tr><td><code id="update.mexhaz_+3A_data">data</code></td>
<td>

<p>a <code>data.frame</code> containing the variables referred to in the <code>formula</code>,
as well as in the <code>expected</code> and <code>random</code> arguments if these arguments are used.
</p>
</td></tr>
<tr><td><code id="update.mexhaz_+3A_expected">expected</code></td>
<td>

<p>name of the variable (must be given in quotes) representing the
population (i.e., expected) hazard. By default, <code>expected=NULL</code>, which
means that the function estimates the overall hazard (and not the excess
hazard).
</p>
</td></tr>
<tr><td><code id="update.mexhaz_+3A_base">base</code></td>
<td>
<p> functional form that should be used to model the baseline
hazard. Selection can be made between the following options:
<code>"weibull"</code> for a Weibull hazard, <code>"exp.bs"</code> for a hazard
described by the exponential of a B-spline (only B-splines of degree 1,
2 or 3 are accepted), <code>"exp.ns"</code> for a hazard described by the
exponential of a restricted cubic B-spline (also called 'natural
spline'), <code>"pw.cst"</code> for a piecewise constant hazard. By default,
<code>base=NULL</code>.  </p>
</td></tr>
<tr><td><code id="update.mexhaz_+3A_degree">degree</code></td>
<td>

<p>if <code>base="exp.bs"</code>, <code>degree</code> represents the
degree of the B-spline used. Only integer values between 1 and 3 are
accepted, and 3 is the default.
</p>
</td></tr>
<tr><td><code id="update.mexhaz_+3A_knots">knots</code></td>
<td>

<p>if <code>base="exp.bs"</code> or <code>"exp.ns"</code>, <code>knots</code> is the vector of interior knots of
the spline. If <code>base="pw.cst"</code>, <code>knots</code> is the vector
defining the endpoints of the time intervals on which the hazard is
assumed to be constant. By default, <code>knots=NULL</code> (that is, it
produces a B-spline with no interior knots if <code>base="exp.bs"</code>, a
linear B-spline with no interior knots if <code>base="exp.ns"</code>, or a
constant hazard over the whole follow-up period if
<code>base="pw.cst"</code>).
</p>
</td></tr>
<tr><td><code id="update.mexhaz_+3A_bound">bound</code></td>
<td>

<p>If <code>base="exp.bs"</code> or <code>base="exp.ns"</code>, computation of the
B-spline basis requires that boundary knots be given. The <code>bound</code>
argument allows the user to specify these boundary knots. If
<code>base="exp.bs"</code>, the interval defined by the boundary knots must
at least include the interval c(0,max(time)) (otherwise, there
could be problems with ill-conditioned bases). If
<code>base="exp.ns"</code>, the boundary knots correspond to the knots
beyond which the spline is contrained to be linear (in that case, the
boundary knots can be values contained in c(0,max(time))). By
default, the boundary knots are set to
c(0,max(time)).
</p>
</td></tr>
<tr><td><code id="update.mexhaz_+3A_n.gleg">n.gleg</code></td>
<td>

<p>if <code>base="exp.bs"</code> and degree is equal to 2 or 3, or if
<code>base="exp.ns"</code>, the cumulative
hazard is computed via Gauss-Legendre quadrature and <code>n.gleg</code> is the number
of quadrature nodes to be used to compute the cumulative hazard. By
default, <code>n.gleg=20</code>.
</p>
</td></tr>
<tr><td><code id="update.mexhaz_+3A_init">init</code></td>
<td>
<p>vector of initial values. By default <code>init=NULL</code>
and the initial values are internally set to the following values:
</p>
<p>for the baseline hazard:
</p>
<p>if <code>exactGradHess=TRUE</code> (except for the excess hazard random
effect model for which this argument is ignored), the intercept is
set to 0.5*log(Number of events/Person-years of observation) and all
other parameters set to 0. In case of failed convergence, several
trials are run with an adaptation of the value of the intercept.
</p>
<p>if <code>exactGradHess=FALSE</code>, the following values are used:
</p>
<p>- if <code>base="weibull"</code>, the scale and shape parameters are set
to 0.1;
</p>
<p>- if <code>base="exp.bs"</code>, the parameters of the B-spline are all
set to -1;
</p>
<p>- if <code>base="exp.ns"</code>, the parameters of the restricted cubic B-spline are all
set to -1;
</p>
<p>- if <code>base="pw.cst"</code>, the logarithm of the piecewise-constant
hazards are set to -1;
</p>
<p>the parameters describing the effects of the covariates are all set
to 0;
</p>
<p>the parameter representing the standard deviation of the random
effect is set to 0.1. (if <code>exactGradHess=TRUE</code>, several trials are run with an adaptation of the value in case of failed convergence).
</p>
</td></tr>
<tr><td><code id="update.mexhaz_+3A_random">random</code></td>
<td>

<p>name of the variable to be entered as a random effect (must be given
between quotes), representing the cluster membership. By default,
<code>random=NULL</code> which means that the function fits a fixed effects model.
</p>
</td></tr>
<tr><td><code id="update.mexhaz_+3A_n.aghq">n.aghq</code></td>
<td>

<p>number of quadrature points used for estimating the
cluster-specific marginal likelihoods by adaptive Gauss-Hermite
quadrature. By default, <code>n.aghq=10</code>.
</p>
</td></tr>
<tr><td><code id="update.mexhaz_+3A_fnoptim">fnoptim</code></td>
<td>

<p>name of the R optimisation procedure used to maximise the
likelihood. Selection can be made between <code>"nlm"</code> (by default) and <code>"optim"</code>. Note: if <code>exactGradHess=TRUE</code>, this
argument will be ignored (<code>fnoptim</code> will be set automatically to <code>"nlm"</code>).
</p>
</td></tr>
<tr><td><code id="update.mexhaz_+3A_verbose">verbose</code></td>
<td>

<p>integer parameter representing the frequency at which the current state
of the optimisation process is displayed. Internally, an 'evaluation' is
defined as an estimation of the log-likelihood for a given vector of
parameters. This means that the number of evaluations is increased each
time the optimisation procedure updates the value of any of the
parameters to be estimated. If <code>verbose=n</code> (with <code>n</code> an integer),
the function will display the current values of the parameters, the
log-likelihood and the time elapsed every <code>n</code> evaluations. If
<code>verbose=0</code>, nothing is displayed.
</p>
</td></tr>
<tr><td><code id="update.mexhaz_+3A_method">method</code></td>
<td>

<p>if <code>fnoptim="optim"</code>, <code>method</code> represents the optimisation
method to be used by <code>optim</code>. By
default, <code>method="Nelder-Mead"</code>. This parameter is not used if <code>fnoptim="nlm"</code>.
</p>
</td></tr>
<tr><td><code id="update.mexhaz_+3A_iterlim">iterlim</code></td>
<td>

<p>if <code>fnoptim="nlm"</code>, <code>iterlim</code> represents the maximum number of
iterations before the <code>nlm</code> optimisation
procedure is terminated. By default, <code>iterlim</code> is set to
10000. This parameter is not used if <code>fnoptim="optim"</code> (in this
case, the maximum number of iterations must be given as part of a
list of control parameters via the <code>control</code> argument: see the
help page of <code>optim</code> for further details).
</p>
</td></tr>
<tr><td><code id="update.mexhaz_+3A_numhess">numHess</code></td>
<td>

<p>logical value allowing the user to choose between the Hessian returned
by the optimization algorithm (default) or the Hessian estimated by
the <code>hessian</code> function from the <code>numDeriv</code> package. The
latter might be more accurate but its estimation is more
time-consuming. We suggest to use the default Hessian estimation
procedure during model building and estimate the <code>numDeriv</code>-based
Hessian only on the final model. Note: if <code>exactGradHess=TRUE</code>, this argument is ignored.
</p>
</td></tr>
<tr><td><code id="update.mexhaz_+3A_print.level">print.level</code></td>
<td>

<p>this argument is only used if <code>fnoptim="nlm"</code>. It determines the
level of printing during the optimisation process. The default value
(for the <code>mexhaz</code> function) is set to '1' which means that
details on the initial and final step of the optimisation procedure
are printed (see the help page of <code>nlm</code> for further details).
</p>
</td></tr>
<tr><td><code id="update.mexhaz_+3A_exactgradhess">exactGradHess</code></td>
<td>
<p> logical value allowing the user to decide
whether maximisation of the likelihood should be based on the
analytic gradient and Hessian computed internally (default,
corresponding to <code>exactGradHess=TRUE</code>).  In that case,
optimisation is performed with the <code>nlm</code> function. Note: even
if set to <code>TRUE</code>, this argument is ignored when the user wants
to fit an excess hazard model including a random effect because in
that case, there is no simple way to obtain the analytic gradient
and Hessian.</p>
</td></tr>
<tr><td><code id="update.mexhaz_+3A_gradtol">gradtol</code></td>
<td>

<p>this argument is only used if <code>fnoptim="nlm"</code>. It corresponds
to the tolerance at which the scaled gradient is considered close
enough to zero to terminate the algorithm. The default value depends
on the value of the argument <code>exactGradHess</code>.</p>
</td></tr>
<tr><td><code id="update.mexhaz_+3A_envir">envir</code></td>
<td>
<p>environment in which the objects' names given as arguments to the updated
model are to be found.</p>
</td></tr>
<tr><td><code id="update.mexhaz_+3A_...">...</code></td>
<td>

<p>represents additional parameters directly passed to <code>nlm</code> or
<code>optim</code> to control the optimisation process.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>mexhaz</code>. See <code><a href="#topic+mexhaz">mexhaz</a></code> for more details.
</p>


<h3>Author(s)</h3>

<p>Hadrien Charvat, Aurelien Belot
</p>


<h3>References</h3>

<p>Charvat H, Remontet L, Bossard N, Roche L, Dejardin O,
Rachet B, Launoy G, Belot A; CENSUR Working Survival Group. A
multilevel excess hazard model to estimate net survival on
hierarchical data allowing for non-linear and non-proportional effects
of covariates. Stat Med 2016;35:3066-3084 (doi: 10.1002/sim.6881)</p>


<h3>See Also</h3>

<p><code><a href="#topic+mexhaz">mexhaz</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(simdatn1)

## Fit of a mixed-effect excess hazard model, with the baseline hazard
## described by a Weibull distribution (without covariables)

Mod_weib &lt;- mexhaz(formula=Surv(time=timesurv,
event=vstat)~1, data=simdatn1, base="weibull", verbose=0)

## Add an effect of gender
Mod_weib_2 &lt;- update(Mod_weib, formula=~.+IsexH)

</code></pre>

<hr>
<h2 id='vcov.mexhaz'>Method for extracting the covariance matrix of the fixed effects</h2><span id='topic+vcov.mexhaz'></span>

<h3>Description</h3>

<p>Display a the covariance matrix of the fixed effects of a mexhaz model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mexhaz'
vcov(object, ...)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vcov.mexhaz_+3A_object">object</code></td>
<td>
<p>an object of class <code>mexhaz</code>.</p>
</td></tr>
<tr><td><code id="vcov.mexhaz_+3A_...">...</code></td>
<td>
<p>not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The estimated covariance matrix of the fixed effects.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mexhaz">mexhaz</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(simdatn1)

## Fit of a mixed-effect excess hazard model, with the baseline hazard
## described by a Weibull distribution (without covariables)

Mod_weib_mix &lt;- mexhaz(formula=Surv(time=timesurv,
event=vstat)~1, data=simdatn1, base="weibull",
expected="popmrate", verbose=0, random="clust")

vcov(Mod_weib_mix)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
