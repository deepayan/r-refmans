<!DOCTYPE html><html lang="en"><head><title>Help for package localIV</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {localIV}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#ace'><p>Estimating Average Causal Effects from a Fitted MTE Model.</p></a></li>
<li><a href='#mte'><p>Fitting a Marginal Treatment Effects (MTE) Model.</p></a></li>
<li><a href='#mte_at'><p>Evaluate Marginal Treatment Effects from a Fitted MTE Model.</p></a></li>
<li><a href='#mte_tilde_at'><p>Evaluate Marginal Treatment Effects Projected onto the Propensity Score</p></a></li>
<li><a href='#toydata'><p>A Hypothetical Dataset for Illustrative Purpose</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Estimation of Marginal Treatment Effects using Local
Instrumental Variables</td>
</tr>
<tr>
<td>Version:</td>
<td>0.3.1</td>
</tr>
<tr>
<td>Description:</td>
<td>In the generalized Roy model, the marginal treatment effect (MTE) can be used as
  a building block for constructing conventional causal parameters such as the average treatment
  effect (ATE) and the average treatment effect on the treated (ATT). Given a treatment selection
  equation and an outcome equation, the function mte() estimates the MTE via the semiparametric
  local instrumental variables method or the normal selection model. The function mte_at() evaluates
  MTE at different values of the latent resistance u with a given X = x, and the function mte_tilde_at()
  evaluates MTE projected onto the estimated propensity score. The function ace() estimates
  population-level average causal effects such as ATE, ATT, or the marginal policy relevant
  treatment effect.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.3.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>KernSmooth (&ge; 2.5.0), mgcv (&ge; 1.8-19), rlang (&ge; 0.4.4),
sampleSelection (&ge; 1.2-0), stats</td>
</tr>
<tr>
<td>Suggests:</td>
<td>dplyr, ggplot2, tidyr</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.0.2</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/xiangzhou09/localIV">https://github.com/xiangzhou09/localIV</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/xiangzhou09/localIV">https://github.com/xiangzhou09/localIV</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-06-26 15:17:35 UTC; Xiang</td>
</tr>
<tr>
<td>Author:</td>
<td>Xiang Zhou [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Xiang Zhou &lt;xiang_zhou@fas.harvard.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-06-26 15:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='ace'>Estimating Average Causal Effects from a Fitted MTE Model.</h2><span id='topic+ace'></span>

<h3>Description</h3>

<p><code>ace</code> estimates Average Causal Effects (ACE) from a fitted MTE model.
The estimand can be average treatment effect (ATE), average treatment effect on the treated (ATT),
average treatment effect on the untreated (ATU), or the Marginal Policy Relevant
Treatment Effect (MPRTE) defined in Zhou and Xie (2019).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ace(model, estimand = c("ate", "att", "atu", "mprte"), policy = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ace_+3A_model">model</code></td>
<td>
<p>A fitted <code>mte</code> model returned by <code><a href="#topic+mte">mte</a></code>.</p>
</td></tr>
<tr><td><code id="ace_+3A_estimand">estimand</code></td>
<td>
<p>Type of estimand: <code>"ate"</code>, <code>"att"</code>, <code>"atu"</code>, or <code>"mprte"</code>.</p>
</td></tr>
<tr><td><code id="ace_+3A_policy">policy</code></td>
<td>
<p>An <code><a href="base.html#topic+expression">expression</a></code> written as a function of <code>p</code>. This is used
only when <code>estimand="mprte"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Estimate of ATE, ATT, ATU, or MPRTE
</p>


<h3>References</h3>

<p>Heckman, James J., Sergio Urzua, and Edward Vytlacil. 2006.
&quot;<a href="https://www.mitpressjournals.org/doi/abs/10.1162/rest.88.3.389">Understanding Instrumental Variables in Models with Essential Heterogeneity.</a>&quot;
The Review of Economics and Statistics 88:389-432.
</p>
<p>Zhou, Xiang and Yu Xie. 2019. &quot;<a href="https://www.journals.uchicago.edu/doi/abs/10.1086/702172">Marginal Treatment Effects from A Propensity Score Perspective.</a>&quot;
Journal of Political Economy, 127(6): 3070-3084.
</p>
<p>Zhou, Xiang and Yu Xie. 2020. &quot;<a href="https://journals.sagepub.com/doi/abs/10.1177/0081175019862593">Heterogeneous Treatment Effects in the Presence of Self-selection:
a Propensity Score Perspective.</a>&quot; Sociological Methodology.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>mod &lt;- mte(selection = d ~ x + z, outcome = y ~ x,
  data = toydata)

ate &lt;- ace(mod, "ate")
att &lt;- ace(mod, "att")
atu &lt;- ace(mod, "atu")
mprte1 &lt;- ace(mod, "mprte")
mprte2 &lt;- ace(mod, "mprte", policy = p)
mprte3 &lt;- ace(mod, "mprte", policy = 1-p)
mprte4 &lt;- ace(mod, "mprte", policy = I(p&lt;0.25))
c(ate, att, atu, mprte1, mprte2, mprte3, mprte4)

</code></pre>

<hr>
<h2 id='mte'>Fitting a Marginal Treatment Effects (MTE) Model.</h2><span id='topic+mte'></span><span id='topic+mte_localIV'></span><span id='topic+mte_normal'></span>

<h3>Description</h3>

<p><code>mte</code> fits a MTE model using either the semiparametric local instrumental
variables (local IV) method or the normal selection model (Heckman, Urzua, Vytlacil 2006).
The user supplies a formula for the treatment selection equation, a formula for the
outcome equations, and a data frame containing all variables. The function returns an
object of class <code>mte</code>. Observations that contain NA (either in <code>selection</code> or
in <code>outcome</code>) are removed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mte(
  selection,
  outcome,
  data = NULL,
  method = c("localIV", "normal"),
  bw = NULL
)

mte_localIV(mf_s, mf_o, bw = NULL)

mte_normal(mf_s, mf_o)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mte_+3A_selection">selection</code></td>
<td>
<p>A formula representing the treatment selection equation.</p>
</td></tr>
<tr><td><code id="mte_+3A_outcome">outcome</code></td>
<td>
<p>A formula representing the outcome equations where the left hand side
is the observed outcome and the right hand side includes predictors of both potential
outcomes.</p>
</td></tr>
<tr><td><code id="mte_+3A_data">data</code></td>
<td>
<p>A data frame, list, or environment containing the variables
in the model.</p>
</td></tr>
<tr><td><code id="mte_+3A_method">method</code></td>
<td>
<p>How to estimate the model: either &quot;<code>localIV</code>&quot; for the semiparametric local IV
method or &quot;<code>normal</code>&quot; for the normal selection model.</p>
</td></tr>
<tr><td><code id="mte_+3A_bw">bw</code></td>
<td>
<p>Bandwidth used for the local polynomial regression in the local IV approach.
Default is 0.25.</p>
</td></tr>
<tr><td><code id="mte_+3A_mf_s">mf_s</code></td>
<td>
<p>A model frame for the treatment selection equations returned by
<code><a href="stats.html#topic+model.frame">model.frame</a></code></p>
</td></tr>
<tr><td><code id="mte_+3A_mf_o">mf_o</code></td>
<td>
<p>A model frame for the outcome equations returned by
<code><a href="stats.html#topic+model.frame">model.frame</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>mte_localIV</code> estimates <code class="reqn">\textup{MTE}(x, u)</code> using the semiparametric local IV method,
and <code>mte_normal</code> estimates <code class="reqn">\textup{MTE}(x, u)</code> using the normal selection model.
</p>


<h3>Value</h3>

<p>An object of class <code>mte</code>.
</p>
<table role = "presentation">
<tr><td><code>coefs</code></td>
<td>
<p>A list of coefficient estimates: <code>gamma</code> for the treatment selection equation,
<code>beta10</code> (intercept) and <code>beta1</code> (slopes) for the baseline outcome
equation, <code>beta20</code> (intercept) and <code>beta2</code> (slopes) for the treated outcome equation,
and <code>theta1</code> and <code>theta2</code> for the error covariances when <code>method = "normal"</code>.</p>
</td></tr>
<tr><td><code>ufun</code></td>
<td>
<p>A function representing the unobserved component of <code class="reqn">\textup{MTE}(x, u)</code>.</p>
</td></tr>
<tr><td><code>ps</code></td>
<td>
<p>Estimated propensity scores.</p>
</td></tr>
<tr><td><code>ps_model</code></td>
<td>
<p>The propensity score model, an object of class <code><a href="stats.html#topic+glm">glm</a></code>
if <code>method = "localIV"</code>, or an object of class <code><a href="sampleSelection.html#topic+selection">selection</a></code>
if <code>method = "normal"</code>.</p>
</td></tr>
<tr><td><code>mf_s</code></td>
<td>
<p>The model frame for the treatment selection equation.</p>
</td></tr>
<tr><td><code>mf_o</code></td>
<td>
<p>The model frame for the outcome equations.</p>
</td></tr>
<tr><td><code>complete_row</code></td>
<td>
<p>A logical vector indicating whether a row is complete (no missing variables) in the
original <code>data</code></p>
</td></tr>
<tr><td><code>call</code></td>
<td>
<p>The matched call.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Heckman, James J., Sergio Urzua, and Edward Vytlacil. 2006.
&quot;<a href="https://www.mitpressjournals.org/doi/abs/10.1162/rest.88.3.389">Understanding Instrumental Variables in Models with Essential Heterogeneity.</a>&quot;
The Review of Economics and Statistics 88:389-432.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mte_at">mte_at</a></code> for evaluating MTE at different values of the latent resistance <code class="reqn">u</code>;
<code><a href="#topic+mte_tilde_at">mte_tilde_at</a></code> for evaluating MTE projected onto the propensity score;
<code><a href="#topic+ace">ace</a></code> for estimating average causal effects from a fitted <code>mte</code> object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>mod &lt;- mte(selection = d ~ x + z, outcome = y ~ x, data = toydata, bw = 0.25)

summary(mod$ps_model)
hist(mod$ps)

mte_vals &lt;- mte_at(u = seq(0.05, 0.95, 0.1), model = mod)
if(require("ggplot2")){
  ggplot(mte_vals, aes(x = u, y = value)) +
  geom_line(size = 1) +
  xlab("Latent Resistance U") +
  ylab("Estimates of MTE at Mean Values of X") +
  theme_minimal(base_size = 14)
}

</code></pre>

<hr>
<h2 id='mte_at'>Evaluate Marginal Treatment Effects from a Fitted MTE Model.</h2><span id='topic+mte_at'></span>

<h3>Description</h3>

<p><code>mte_at</code> evaluates marginal treatment effects at different
values of the latent resistance <code>u</code> with a given <code class="reqn">X=x</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mte_at(x = NULL, u, model)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mte_at_+3A_x">x</code></td>
<td>
<p>Values of the pretreatment covariates at which <code class="reqn">\textup{MTE}(x, u)</code> is evaluated. It
should be a numeric vector whose length is one less than the number
of columns of the design matrix <code class="reqn">X</code> in the outcome model. Default is the sample means.</p>
</td></tr>
<tr><td><code id="mte_at_+3A_u">u</code></td>
<td>
<p>A numeric vector. Values of the latent resistance <code class="reqn">u</code> at which
<code class="reqn">\textup{MTE}(x, u)</code> is evaluated. Note that the estimation involves extrapolation
when the specified u values lie outside of the support of the propensity score.</p>
</td></tr>
<tr><td><code id="mte_at_+3A_model">model</code></td>
<td>
<p>A fitted MTE model returned by <code><a href="#topic+mte">mte</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>mte_at</code> returns a data frame.
</p>
<table role = "presentation">
<tr><td><code>u</code></td>
<td>
<p>input values of <code>u</code>.</p>
</td></tr>
<tr><td><code>x_comp</code></td>
<td>
<p>the x-component of the estimated <code class="reqn">\textup{MTE}(x, u)</code></p>
</td></tr>
<tr><td><code>u_comp</code></td>
<td>
<p>the u-component of the estimated <code class="reqn">\textup{MTE}(x, u)</code></p>
</td></tr>
<tr><td><code>value</code></td>
<td>
<p>estimated values of <code class="reqn">\textup{MTE}(x, u)</code></p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>mod &lt;- mte(selection = d ~ x + z, outcome = y ~ x, data = toydata)

mte_vals &lt;- mte_at(u = seq(0.05, 0.95, 0.1), model = mod)
if(require("ggplot2")){
  ggplot(mte_vals, aes(x = u, y = value)) +
  geom_line(size = 1) +
  xlab("Latent Resistance U") +
  ylab("Estimates of MTE at Mean Values of X") +
  theme_minimal(base_size = 14)
}

</code></pre>

<hr>
<h2 id='mte_tilde_at'>Evaluate Marginal Treatment Effects Projected onto the Propensity Score</h2><span id='topic+mte_tilde_at'></span>

<h3>Description</h3>

<p><code>mte_tilde_at</code> evaluates marginal treatment effects
projected onto the estimated propensity score. The projection
is done via the function <code><a href="mgcv.html#topic+gam">gam</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mte_tilde_at(p, u, model, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mte_tilde_at_+3A_p">p</code></td>
<td>
<p>A numeric vector. Values of the propensity score at which <code class="reqn">\widetilde{\textup{MTE}}(p, u)</code>
is evaluated.</p>
</td></tr>
<tr><td><code id="mte_tilde_at_+3A_u">u</code></td>
<td>
<p>A numeric vector. Values of the latent resistance at which <code class="reqn">\widetilde{\textup{MTE}}(p, u)</code>
is evaluated.</p>
</td></tr>
<tr><td><code id="mte_tilde_at_+3A_model">model</code></td>
<td>
<p>A fitted MTE model returned by <code><a href="#topic+mte">mte</a></code>.</p>
</td></tr>
<tr><td><code id="mte_tilde_at_+3A_...">...</code></td>
<td>
<p>Additional parameters passed to <code><a href="mgcv.html#topic+gam">gam</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>mte_tilde_at</code> returns a list of two elements:
</p>
<table role = "presentation">
<tr><td><code>df</code></td>
<td>
<p>A data frame containing five columns:</p>

<ul>
<li><p><code>p</code> input values of <code>p</code>.
</p>
</li>
<li><p><code>u</code> input values of <code>u</code>.
</p>
</li>
<li><p><code>p_comp</code> the p-component of the estimated <code class="reqn">\widetilde{\textup{MTE}}(p, u)</code>
</p>
</li>
<li><p><code>u_comp</code> the u-component of the estimated <code class="reqn">\widetilde{\textup{MTE}}(p, u)</code>
</p>
</li>
<li><p><code>value</code> estimated values of <code class="reqn">\widetilde{\textup{MTE}}(p, u)</code>
</p>
</li></ul>

</td></tr>
<tr><td><code>proj</code></td>
<td>
<p>Fitted <code><a href="mgcv.html#topic+gam">gam</a></code> model for <code class="reqn">E[\mu_1(X)-\mu_0(X)|P(Z)=p]</code></p>
</td></tr>
</table>


<h3>References</h3>

<p>Zhou, Xiang and Yu Xie. 2019. &quot;<a href="https://www.journals.uchicago.edu/doi/abs/10.1086/702172">Marginal Treatment Effects from A Propensity Score Perspective.</a>&quot;
Journal of Political Economy, 127(6): 3070-3084.
</p>
<p>Zhou, Xiang and Yu Xie. 2020. &quot;<a href="https://journals.sagepub.com/doi/abs/10.1177/0081175019862593">Heterogeneous Treatment Effects in the Presence of Self-selection:
a Propensity Score Perspective.</a>&quot; Sociological Methodology.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>mod &lt;- mte(selection = d ~ x + z, outcome = y ~ x, data = toydata)

u &lt;- p &lt;- seq(0.05, 0.95, 0.1)
mte_tilde &lt;- mte_tilde_at(p, u, model = mod)

# heatmap showing MTE_tilde(p, u)
if(require("ggplot2")){
ggplot(mte_tilde$df, aes(x = u, y = p, fill = value)) +
  geom_tile() +
  scale_fill_gradient(name = expression(widetilde(MTE)(p, u)), low = "yellow", high = "blue") +
  xlab("Latent Resistance U") +
  ylab("Propensity Score p(Z)") +
  theme_minimal(base_size = 14)
}

mprte_tilde_df &lt;- subset(mte_tilde$df, p == u)

# heatmap showing MPRTE_tilde(p)
if(require("ggplot2")){
ggplot(mprte_tilde_df, aes(x = u, y = p, fill = value)) +
  geom_tile() +
  scale_fill_gradient(name = expression(widetilde(MPRTE)(p)), low = "yellow", high = "blue") +
  xlab("Latent Resistance U") +
  ylab("Propensity Score p(Z)") +
  theme_minimal(base_size = 14)
}

# MPRTE_tilde(p) decomposed into the p-component and the u-component
if(require(tidyr) &amp;&amp; require(dplyr) &amp;&amp; require(ggplot2)){
mprte_tilde_df %&gt;%
  pivot_longer(cols = c(u_comp, p_comp, value)) %&gt;%
  mutate(name = recode_factor(name,
         `value` = "MPRTE(p)",
         `p_comp` = "p(Z) component",
         `u_comp` = "U component")) %&gt;%
  ggplot(aes(x = p, y = value)) +
  geom_line(aes(linetype = name), size = 1) +
  scale_linetype(name = "") +
  xlab("Propensity Score p(Z)") +
  ylab("Treatment Effect") +
  theme_minimal(base_size = 14) +
  theme(legend.position = "bottom")
}

</code></pre>

<hr>
<h2 id='toydata'>A Hypothetical Dataset for Illustrative Purpose</h2><span id='topic+toydata'></span>

<h3>Description</h3>

<p>A dataset containing 4 columns: <code>y</code> for a continuous outcome,
<code>d</code> for a binary treatment, <code>x</code> for a pretreatment covariate,
and <code>z</code> for an excluded instrument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>toydata
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 10000 rows and 4 columns.</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
