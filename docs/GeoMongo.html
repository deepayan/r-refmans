<!DOCTYPE html><html lang="en"><head><title>Help for package GeoMongo</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {GeoMongo}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#geomongo'><p>mongodb geospatial methods ( using PyMongo in R )</p></a></li>
<li><a href='#json_schema_validator'><p>simple way to validate a json instance under a given schema</p></a></li>
<li><a href='#mongodb_console'><p>MongoDB (bulk) commands</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Geospatial Queries Using 'PyMongo'</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.3</td>
</tr>
<tr>
<td>Date:</td>
<td>2021-09-11</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/mlampros/GeoMongo/issues">https://github.com/mlampros/GeoMongo/issues</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/mlampros/GeoMongo">https://github.com/mlampros/GeoMongo</a></td>
</tr>
<tr>
<td>Description:</td>
<td>Utilizes methods of the 'PyMongo' 'Python' library to initialize, insert and query 'GeoJson' data (see <a href="https://github.com/mongodb/mongo-python-driver">https://github.com/mongodb/mongo-python-driver</a> for more information on 'PyMongo'). Furthermore, it allows the user to validate 'GeoJson' objects and to use the console for 'MongoDB' (bulk) commands. The 'reticulate' package provides the 'R' interface to 'Python' modules, classes and functions.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License 2.0</a></td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>MongoDB (&gt;= 3.4.0), Python (&gt;= 2.7). Installation
instructions and links can be found in the README file.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R(&ge; 3.2.3)</td>
</tr>
<tr>
<td>Imports:</td>
<td>reticulate, R6, geojsonR, data.table</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat, covr, knitr, rmarkdown</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-09-11 14:47:03 UTC; lampros</td>
</tr>
<tr>
<td>Author:</td>
<td>Lampros Mouselimis
    <a href="https://orcid.org/0000-0002-8024-1546"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Lampros Mouselimis &lt;mouselimislampros@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-09-11 15:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='geomongo'>mongodb geospatial methods ( using PyMongo in R )</h2><span id='topic+geomongo'></span>

<h3>Description</h3>

<p>mongodb geospatial methods ( using PyMongo in R )
</p>
<p>mongodb geospatial methods ( using PyMongo in R )
</p>


<h3>Usage</h3>

<pre><code class='language-R'># init &lt;- geomongo$new(host = 'localhost', port = 27017,

       #                      tz_aware = FALSE, connect = TRUE, ...)
</code></pre>


<h3>Details</h3>

<p>See the reference link for more details on the <em>ellipsis</em> (...) concerning the additional parameters of the MongoClient()
</p>
<p>the <em>geomongo$new</em> method initializes the MongoClient
</p>
<p>the <em>getClient</em> method returns a <em>&quot;pymongo.mongo_client.MongoClient&quot;</em> object
</p>
<p>the <em>read_mongo_bson</em> method allows the user to read a file/string using the <em>bson.json_util</em> module, which loads MongoDB Extended JSON data ( SEE <em>https://stackoverflow.com/questions/42089045/bson-errors-invaliddocument-key-oid-must-not-start-with-trying-to-insert</em> )
</p>
<p>the <em>geoInsert</em> method allows the user to import data to a mongo-db from a <em>folder</em>, <em>file</em> or <em>list</em>
</p>
<p>the <em>geoQuery</em> method allows the user to perform geospatial queries using one of the <em>find</em>, <em>aggregate</em> or <em>command</em> methods
</p>
<p>For spherical query operators to function properly, you must convert distances to radians, and convert from radians to the distances units used by your application.
</p>
<p>To convert distance to radians: divide the distance by the radius of the sphere (e.g. the Earth) in the same units as the distance measurement.
To convert radians to distance: multiply the radian measure by the radius of the sphere (e.g. the Earth) in the units system that you want to convert the distance to.
</p>
<p>The equatorial radius of the Earth is approximately 3,963.2 miles or 6,378.1 kilometers.
</p>
<p>If specifying latitude and longitude coordinates, list the longitude first and then latitude:
</p>
<p>Valid longitude values are between -180 and 180, both inclusive.
Valid latitude values are between -90 and 90 (both inclusive).
</p>


<h3>Methods</h3>


<dl>
<dt><code>geomongo$new(host = 'localhost', port = 27017, tz_aware = FALSE, connect = TRUE, ...)</code></dt><dd></dd>
<dt><code>--------------</code></dt><dd></dd>
<dt><code>getClient()</code></dt><dd></dd>
<dt><code>--------------</code></dt><dd></dd>
<dt><code>read_mongo_bson(FILE = NULL, STR = NULL)</code></dt><dd></dd>
<dt><code>--------------</code></dt><dd></dd>
<dt><code>geoInsert(DATA = NULL, TYPE_DATA = NULL, COLLECTION = NULL, GEOMETRY_NAME = NULL, read_method = "geojsonR")</code></dt><dd></dd>
<dt><code>--------------</code></dt><dd></dd>
<dt><code>geoQuery(QUERY = NULL, METHOD = NULL, COLLECTION = NULL, DATABASE = NULL, GEOMETRY_NAME = NULL, TO_LIST = FALSE)</code></dt><dd></dd>
</dl>



<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-new"><code>geomongo$new()</code></a>
</p>
</li>
<li> <p><a href="#method-getClient"><code>geomongo$getClient()</code></a>
</p>
</li>
<li> <p><a href="#method-read_mongo_bson"><code>geomongo$read_mongo_bson()</code></a>
</p>
</li>
<li> <p><a href="#method-geoInsert"><code>geomongo$geoInsert()</code></a>
</p>
</li>
<li> <p><a href="#method-geoQuery"><code>geomongo$geoQuery()</code></a>
</p>
</li>
<li> <p><a href="#method-clone"><code>geomongo$clone()</code></a>
</p>
</li></ul>


<hr>
<a id="method-new"></a>



<h4>Method <code>new()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>geomongo$new(
  host = "localhost",
  port = 27017,
  tz_aware = FALSE,
  connect = TRUE,
  ...
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>host</code></dt><dd><p>(optional) hostname or IP address or Unix domain socket path of a single mongod or mongos instance to connect to, or a mongodb URI, or a list of hostnames / mongodb URIs. See the reference link for more information.</p>
</dd>
<dt><code>port</code></dt><dd><p>(optional) port number on which to connect</p>
</dd>
<dt><code>tz_aware</code></dt><dd><p>(optional) if TRUE, datetime instances returned as values in a document by this MongoClient will be timezone aware (otherwise they will be naive)</p>
</dd>
<dt><code>connect</code></dt><dd><p>(optional) if TRUE (the default), immediately begin connecting to MongoDB in the background. Otherwise connect on the first operation</p>
</dd>
</dl>

</div>


<hr>
<a id="method-getClient"></a>



<h4>Method <code>getClient()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>geomongo$getClient()</pre></div>


<hr>
<a id="method-read_mongo_bson"></a>



<h4>Method <code>read_mongo_bson()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>geomongo$read_mongo_bson(FILE = NULL, STR = NULL)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>FILE</code></dt><dd><p>a character string specifying a valid path to a file ( applies to <em>read_mongo_bson</em> method )</p>
</dd>
<dt><code>STR</code></dt><dd><p>a character string ( applies to <em>read_mongo_bson</em> method )</p>
</dd>
</dl>

</div>


<hr>
<a id="method-geoInsert"></a>



<h4>Method <code>geoInsert()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>geomongo$geoInsert(
  DATA = NULL,
  TYPE_DATA = NULL,
  COLLECTION = NULL,
  GEOMETRY_NAME = NULL,
  read_method = "geojsonR"
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>DATA</code></dt><dd><p>a valid path to a file/folder or a list ( applies to <em>geoInsert</em> method )</p>
</dd>
<dt><code>TYPE_DATA</code></dt><dd><p>a character string. One of 'folder', 'file', 'dict_one' (takes as input a <em>list</em> or a <em>character string</em>) or 'dict_many' (takes as input a <em>list</em> or a <em>character string vector</em>) ( applies to <em>geoInsert</em> method )</p>
</dd>
<dt><code>COLLECTION</code></dt><dd><p>a <em>pymongo.collection.Collection</em> object ( applies to <em>geoInsert</em> and <em>geoQuery</em> methods )</p>
</dd>
<dt><code>GEOMETRY_NAME</code></dt><dd><p>a character string specifying the name of the geometry object, as it appears in the file/string ( applies to <em>geoInsert</em> and <em>geoQuery</em> methods )</p>
</dd>
<dt><code>read_method</code></dt><dd><p>a character string specifying the method to use to read the data. Either using the <em>&quot;geojsonR&quot;</em> (package) or the <em>&quot;mongo_bson&quot;</em> utility function ( applies to <em>geoInsert</em> method )</p>
</dd>
</dl>

</div>


<hr>
<a id="method-geoQuery"></a>



<h4>Method <code>geoQuery()</code></h4>



<h5>Usage</h5>

<div class="r"><pre>geomongo$geoQuery(
  QUERY = NULL,
  METHOD = NULL,
  COLLECTION = NULL,
  DATABASE = NULL,
  GEOMETRY_NAME = NULL,
  TO_LIST = FALSE
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>QUERY</code></dt><dd><p>a named list specifying the query to use in mongodb ( applies to <em>geoQuery</em> method )</p>
</dd>
<dt><code>METHOD</code></dt><dd><p>a character string specifying the method to use to perform geospatial queries in mongodb. One of &quot;find&quot;, &quot;aggregate&quot; OR &quot;command&quot; ( applies to <em>geoQuery</em> method )</p>
</dd>
<dt><code>COLLECTION</code></dt><dd><p>a <em>pymongo.collection.Collection</em> object ( applies to <em>geoInsert</em> and <em>geoQuery</em> methods )</p>
</dd>
<dt><code>DATABASE</code></dt><dd><p>a <em>&quot;pymongo.database.Database&quot;</em> object ( applies to <em>geoQuery</em> method )</p>
</dd>
<dt><code>GEOMETRY_NAME</code></dt><dd><p>a character string specifying the name of the geometry object, as it appears in the file/string ( applies to <em>geoInsert</em> and <em>geoQuery</em> methods )</p>
</dd>
<dt><code>TO_LIST</code></dt><dd><p>either TRUE or FALSE. If TRUE then the output of the <em>geoQuery</em> method will be a list, otherwise a data.table (matrix) object ( applies to <em>geoQuery</em> method )</p>
</dd>
</dl>

</div>


<hr>
<a id="method-clone"></a>



<h4>Method <code>clone()</code></h4>

<p>The objects of this class are cloneable with this method.
</p>


<h5>Usage</h5>

<div class="r"><pre>geomongo$clone(deep = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>deep</code></dt><dd><p>Whether to make a deep clone.</p>
</dd>
</dl>

</div>




<h3>References</h3>

<p>https://github.com/mongodb/mongo-python-driver, https://docs.mongodb.com/manual/tutorial/calculate-distances-using-spherical-geometry-with-2d-geospatial-indexes/
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 

library(GeoMongo)

init = geomongo$new()

getter_client = init$getClient()

init_db = getter_client$get_database("example_db")

init_col = init_db$get_collection("example_collection")

#--------------------------
# geonear using 'aggregate'
#--------------------------

query_geonear = list('$geoNear' = list(near = list(type = "Point", coordinates = c(-122.5, 37.1)),

                     distanceField = "distance", maxDistance = 900 * 1609.34,

                     distanceMultiplier = 1 / 1609.34, spherical = TRUE))


init$geoQuery(QUERY = query_geonear, METHOD = "aggregate", COLLECTION = init_col,

              DATABASE = init_db, GEOMETRY_NAME = "location", TO_LIST = FALSE)

## End(Not run)
</code></pre>

<hr>
<h2 id='json_schema_validator'>simple way to validate a json instance under a given schema</h2><span id='topic+json_schema_validator'></span>

<h3>Description</h3>

<p>simple way to validate a json instance under a given schema
</p>


<h3>Usage</h3>

<pre><code class='language-R'>json_schema_validator(json_data = NULL, json_schema = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="json_schema_validator_+3A_json_data">json_data</code></td>
<td>
<p>a named list specifying the input data to validate against the json-schema</p>
</td></tr>
<tr><td><code id="json_schema_validator_+3A_json_schema">json_schema</code></td>
<td>
<p>a named list specifying the json-schema</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Define a json-schema that the input data should follow and then validate the input data against the schema. If the input data follows the schema then by running the function
nothing will be returned, otherwise an error with Traceback will be printed in the R-session.
</p>
<p>In case that <em>type</em> is at the same time also a property name in the json data, then do not include <em>&quot;type&quot; = &quot;string&quot;</em> in the json schema ( https://github.com/epoberezkin/ajv/issues/137 )
</p>


<h3>References</h3>

<p>https://pypi.org/project/jsonschema/, https://python-jsonschema.readthedocs.io/en/latest/
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
try({
  if (reticulate::py_available(initialize = FALSE)) {
    if (reticulate::py_module_available("jsonschema")) {

      library(GeoMongo)

      schema_dict = list("type" = "object",

                         "properties" = list(

                           "name" = list("type" = "string"),

                           "location" = list("type" = "object",

                                             "properties" = list(

                                               "type" = list("enum" = c("Point", "Polygon")),

                                               "coordinates" = list("type" = "array")
                                             ))))


      data_dict = list("name" = "example location",

                       "location" = list("type" = "Point", "coordinates" = c(-120.24, 39.21)))


      json_schema_validator(json_data = data_dict, json_schema = schema_dict)
    }
  }
}, silent=TRUE)
</code></pre>

<hr>
<h2 id='mongodb_console'>MongoDB (bulk) commands</h2><span id='topic+mongodb_console'></span>

<h3>Description</h3>

<p>MongoDB (bulk) commands
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mongodb_console(Argument = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mongodb_console_+3A_argument">Argument</code></td>
<td>
<p>a character string specifying the mongodb shell command to run from within an R-session</p>
</td></tr>
<tr><td><code id="mongodb_console_+3A_...">...</code></td>
<td>
<p>the <em>ellipsis</em> (...) parameter allows a unix-user (windows-user) to give additional parameters to the base-R <em>system() (shell())</em> function which is run in background.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>MongoDB shell commands are important for instance if someone has to import/export bulk data to a mongo database. This R function utilizes the <em>system</em> base function to run the mongodb shell command from
within an R-session. See the reference links for more details.
The <em>ellipsis</em> (...) parameter could be used for instance to disallow messages be printed in the console (on unix by using <em>ignore.stdout</em> and <em>ignore.stderr</em>).
</p>


<h3>References</h3>

<p>https://docs.mongodb.com/database-tools/mongoimport/, https://docs.mongodb.com/database-tools/mongoexport/
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 

library(GeoMongo)

ARGs = "mongoimport -d DB -c COLLECTION --type json --file /MY_DATA.json"

mongodb_console(Argument = ARGs)


## End(Not run)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
