<!DOCTYPE html><html lang="en"><head><title>Help for package ciu</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ciu}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#ciu-package'><p>ciu: Contextual Importance and Utility</p></a></li>
<li><a href='#ciu'><p>Create <code>ciu</code> object.</p></a></li>
<li><a href='#ciu.barplot'><p>ciu.barplot</p></a></li>
<li><a href='#ciu.blackbox.new'><p>Create CIU.BlackBox object</p></a></li>
<li><a href='#ciu.explain'><p>Calculate CIU for specific instance</p></a></li>
<li><a href='#ciu.ggplot'><p>ciu.ggplot</p></a></li>
<li><a href='#ciu.ggplot.col'><p>CIU feature importance/utility plot using ggplot.</p></a></li>
<li><a href='#ciu.list.to.frame'><p>ciu.list.to.frame</p></a></li>
<li><a href='#ciu.meta.explain'><p>ciu.meta.explain</p></a></li>
<li><a href='#ciu.meta.result.new'><p>CIU meta-result object</p></a></li>
<li><a href='#ciu.new'><p>Create CIU object</p></a></li>
<li><a href='#ciu.pie'><p>ciu.pie</p></a></li>
<li><a href='#ciu.plot'><p>ciu.plot</p></a></li>
<li><a href='#ciu.plot.3D'><p>ciu.plot.3D</p></a></li>
<li><a href='#ciu.relative'><p>Calculate CIU of a sub-concept/input relative to an intermediate</p>
concept (or output).</a></li>
<li><a href='#ciu.result.new'><p>CIU result object</p></a></li>
<li><a href='#ciu.textual'><p>Give textual CIU explanation</p></a></li>
<li><a href='#ciu.to.CIU'><p>Create <code>CIU</code> object from <code>ciu</code> object.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Contextual Importance and Utility</td>
</tr>
<tr>
<td>Version:</td>
<td>0.6.0</td>
</tr>
<tr>
<td>Author:</td>
<td>Kary Främling</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Kary Främling &lt;Kary.Framling@umu.se&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Implementation of the Contextual Importance and Utility 
    (CIU) concepts for Explainable AI (XAI). A recent description of CIU
    can be found in e.g. Främling (2020) &lt;<a href="https://doi.org/10.48550/arXiv.2009.13996">doi:10.48550/arXiv.2009.13996</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Imports:</td>
<td>graphics, stats, Rcpp, grDevices, crayon, ggplot2</td>
</tr>
<tr>
<td>Suggests:</td>
<td>MASS, caret, gbm</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-11-29 13:51:48 UTC; framling</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-11-29 14:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='ciu-package'>ciu: Contextual Importance and Utility</h2><span id='topic+ciu-package'></span><span id='topic+_PACKAGE'></span>

<h3>Description</h3>

<p>Implementation of the Contextual Importance and Utility (CIU) concepts for Explainable AI (XAI). A recent description of CIU can be found in e.g. Främling (2020) <a href="https://arxiv.org/abs/2009.13996">arXiv:2009.13996</a>.
</p>


<h3>Details</h3>

<p>This package implements the Contextual Importance and Utility (CIU)
concepts for Explainable AI (XAI).
CIU allows explaining output values of any regression or
classification systems, no matter if it is a &quot;black-box&quot; or a &quot;white-box&quot;
AI, or anything between black and white. CIU is entirely
model-agnostic. Contrary to most (all?) other XAI methods, CIU provides
explanations directly based on the observed input-output behavior without
building an intermediate &quot;interpretable&quot; model for doing it.
</p>
<p>CIU was developed by Kary Främling in his PhD thesis, which was presented
in 1996 (in French). CIU was first presented in 1995 at the International
Conference on Artificial Neural Networks (ICANN).
</p>
<p>The ciu package supports models from <code>caret</code> and at least <code>lda</code> natively,
but can easily be made to work with any model.
</p>
<p><strong>Main functions:</strong>
</p>
<p>Use of <code>ciu</code> starts by calling the function <a href="#topic+ciu.new">ciu.new</a> that returns an object
of class <code>CIU</code>. If the <code>CIU</code> object is created by <code>ciu &lt;- ciu.new(...)</code>,
then different methods can be called as <code>ciu$explain()</code>,
<code>ciu$barplot.ciu()</code> etc. for obtaining explanations in different forms.
</p>
<p><code>ciu</code> is implemented using an &quot;old style&quot; (?) R object orientation. However,
it provides object-oriented encapsulation of variables and methods of the
<code>CIU</code> object, which presumably helps to avoid name conflicts with other
packages or user code.
</p>
<p>Since version 0.5.0 it is also possible to use a non-object-oriented approach
by creating an ordinary <a href="base.html#topic+list">list</a> of class <code>ciu</code> by calling the function <a href="#topic+ciu">ciu</a>.
That <code>ciu</code> object is then
passed as the first parameter to the different functions. This parallel
possibility was originally developed mainly for getting support for proper
Roxygen functionality. However, it does also offer some interesting properties,
e.g. a <code>CIU</code> object takes up much more memory than a <code>ciu</code> object because it
creates its own environment. <code>CIU</code> objects can be converted to <code>ciu</code> objects
and vice versa at any time by the <code style="white-space: pre;">&#8288;&lt;CIU&gt;$as.ciu()&#8288;</code> method and the <a href="#topic+ciu.to.CIU">ciu.to.CIU</a>
function.
</p>
<p>It is recommended to use the object-oriented approach in order to
avoid unnecessary conversions back and forth. However, the difference is
presumably not very significant.
</p>


<h3>References</h3>

<p>Främling, K. <em>Explainable AI without Interpretable Model</em>. 2020, <a href="https://arxiv.org/abs/2009.13996">https://arxiv.org/abs/2009.13996</a>.
</p>
<p>Främling, K. <em>Decision Theory Meets Explainable AI</em>. 2020, &lt;doi.org/10.1007/978-3-030-51924-7_4&gt;.
</p>
<p>Främling, K. <em>Modélisation et apprentissage des préférences par réseaux de neurones pour l'aide à la décision multicritère</em>. 1996, <a href="https://tel.archives-ouvertes.fr/tel-00825854/document">https://tel.archives-ouvertes.fr/tel-00825854/document</a> (title translation in English: <em>Learning and Explaining Preferences with Neural Networks for Multiple Criteria Decision Making</em>)
</p>

<hr>
<h2 id='ciu'>Create <code>ciu</code> object.</h2><span id='topic+ciu'></span>

<h3>Description</h3>

<p>Sets up a <code>ciu</code> object with the given parameters. This is not the same as
a <code>CIU</code> object as returned by the function <a href="#topic+ciu.new">ciu.new</a>! a <code>ciu</code> object is a
<a href="base.html#topic+list">list</a> with all the parameter values needed for Contextual Importance and
Utility calculations, whereas a <code>CIU</code> object only exposes a set of methods
that can be called using the <code>$</code> operator. <code>CIU</code> provides the method
<code style="white-space: pre;">&#8288;$as.ciu&#8288;</code> for retrieving a <code>ciu</code> object from a <code>CIU</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ciu(
  model,
  formula = NULL,
  data = NULL,
  in.min.max.limits = NULL,
  abs.min.max = NULL,
  input.names = NULL,
  output.names = NULL,
  predict.function = NULL,
  vocabulary = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ciu_+3A_model">model</code></td>
<td>
<p>Model/&quot;black-box&quot; object (same parameter as <code>bb</code> for function
<a href="#topic+ciu.new">ciu.new</a>).</p>
</td></tr>
<tr><td><code id="ciu_+3A_formula">formula</code></td>
<td>
<p>Formula that describes input versus output values. Only to
be used together with <code>data</code> parameter.</p>
</td></tr>
<tr><td><code id="ciu_+3A_data">data</code></td>
<td>
<p>The training data used for training the model. If this parameter
is provided, a <code>formula</code> MUST be given also.
<code>ciu.new</code> attempts to infer the other parameters from
<code>data</code> and <code>formula</code>. i.e. <code>in.min.max.limits</code>,
<code>abs.min.max</code>, <code>input.names</code>
and <code>output.names</code>. If those parameters are provided, then they
override the inferred ones.</p>
</td></tr>
<tr><td><code id="ciu_+3A_in.min.max.limits">in.min.max.limits</code></td>
<td>
<p>matrix with one row per output and two columns,
where the first column indicates the minimal value and the second column
the maximal value for that input.</p>
</td></tr>
<tr><td><code id="ciu_+3A_abs.min.max">abs.min.max</code></td>
<td>
<p><a href="base.html#topic+data.frame">data.frame</a> or <a href="base.html#topic+matrix">matrix</a> of min-max values of
outputs, one row per output, two columns (min, max).</p>
</td></tr>
<tr><td><code id="ciu_+3A_input.names">input.names</code></td>
<td>
<p>labels of inputs.</p>
</td></tr>
<tr><td><code id="ciu_+3A_output.names">output.names</code></td>
<td>
<p>labels of outputs.</p>
</td></tr>
<tr><td><code id="ciu_+3A_predict.function">predict.function</code></td>
<td>
<p>can be supplied if a model that is not supported by
ciu should be used. As an example, this is the function for lda:</p>
<pre>
o.predict.function &lt;- function(model, inputs) {
    pred &lt;- predict(model,inputs)
        return(pred$posterior)
}</pre></td></tr>
<tr><td><code id="ciu_+3A_vocabulary">vocabulary</code></td>
<td>
<p>list of labels/concepts to be used when producing
explanations and what combination of inputs they correspond to. Example of
two intermediate concepts and a higher-level one that combines them:
<code>list(intermediate.concept1=c(1,2,3), intermediate.concept2=c(4,5), higher.level.concept=c(1,2,3,4,5))</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>ciu</code> object.
</p>


<h3>Author(s)</h3>

<p>Kary Främling
</p>


<h3>See Also</h3>

<p><a href="#topic+ciu.new">ciu.new</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Explaining the classification of an Iris instance with lda model.
# We use a versicolor (instance 100).
library(MASS)
test.ind &lt;- 100
iris_test &lt;- iris[test.ind, 1:4]
iris_train &lt;- iris[-test.ind, 1:4]
iris_lab &lt;- iris[[5]][-test.ind]
model &lt;- lda(iris_train, iris_lab)

# Create CIU object
ciu &lt;- ciu(model, Species~., iris)

# This can be used with explain method for getting CIU values
# of one or several inputs. Here we get CIU for all three outputs
# with input feature "Petal.Length" that happens to be the most important.
ciu.explain(ciu, iris_test, 1)

# It is, however, more convenient to use one of the graphical visualizations.
# Here's one using ggplot.
ciu.ggplot.col(ciu, iris_test)

</code></pre>

<hr>
<h2 id='ciu.barplot'>ciu.barplot</h2><span id='topic+ciu.barplot'></span>

<h3>Description</h3>

<p>Create a barplot showing CI as the length of the bar and CU on color scale from
red to green, via yellow, for the given inputs and the given output.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ciu.barplot(
  ciu,
  instance,
  ind.inputs = NULL,
  ind.output = 1,
  in.min.max.limits = NULL,
  n.samples = 100,
  neutral.CU = 0.5,
  show.input.values = TRUE,
  concepts.to.explain = NULL,
  target.concept = NULL,
  target.ciu = NULL,
  ciu.meta = NULL,
  color.ramp.below.neutral = NULL,
  color.ramp.above.neutral = NULL,
  use.influence = FALSE,
  sort = NULL,
  decreasing = FALSE,
  main = NULL,
  xlab = NULL,
  xlim = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ciu.barplot_+3A_ciu">ciu</code></td>
<td>
<p><code>ciu</code> object as created with <a href="#topic+ciu">ciu</a> function (not to be confused
with <code>CIU</code> object as created by <a href="#topic+ciu.new">ciu.new</a>).</p>
</td></tr>
<tr><td><code id="ciu.barplot_+3A_instance">instance</code></td>
<td>
<p>Input values for the instance to explain. Should be a
<a href="base.html#topic+data.frame">data.frame</a> even though a <code>vector</code> or <code>matrix</code> might work too if input
names and other needed metadata can be deduced from the dataset or other
parameters given to <code><a href="#topic+ciu.new">ciu.new</a></code>.</p>
</td></tr>
<tr><td><code id="ciu.barplot_+3A_ind.inputs">ind.inputs</code></td>
<td>
<p>Vector of indices for the inputs to be
included in the plot. If NULL then all inputs will be included.</p>
</td></tr>
<tr><td><code id="ciu.barplot_+3A_ind.output">ind.output</code></td>
<td>
<p>Index of output to be explained.</p>
</td></tr>
<tr><td><code id="ciu.barplot_+3A_in.min.max.limits">in.min.max.limits</code></td>
<td>
<p><a href="base.html#topic+data.frame">data.frame</a> or <a href="base.html#topic+matrix">matrix</a> with one row per output
and two columns, where the first column indicates the minimal value and the
second column the maximal value for that output. ONLY NEEDED HERE IF not
given as parameter to <a href="#topic+ciu.new">ciu.new</a> or if the limits are different for this
specific instance than the default ones.</p>
</td></tr>
<tr><td><code id="ciu.barplot_+3A_n.samples">n.samples</code></td>
<td>
<p>How many instances to generate for estimating CI and CU.
For inputs of type <a href="base.html#topic+factor">factor</a>, all possible combinations of input values
are generated, so this parameter only influences how many instances are
(at least) generated for continuous-valued inputs.</p>
</td></tr>
<tr><td><code id="ciu.barplot_+3A_neutral.cu">neutral.CU</code></td>
<td>
<p>Indicates when the Contextual Utility is considered
to be &quot;negative&quot;. The default value of 0.5 seems quite logical for most cases.</p>
</td></tr>
<tr><td><code id="ciu.barplot_+3A_show.input.values">show.input.values</code></td>
<td>
<p>Include input values after input labels or not.
Default is TRUE.</p>
</td></tr>
<tr><td><code id="ciu.barplot_+3A_concepts.to.explain">concepts.to.explain</code></td>
<td>
<p>List of concepts to use in the plot, as defined
by vocabulary provided as argument to <a href="#topic+ciu.new">ciu.new</a>. If <code>ind.inputs=NULL</code>,
then use <code>concepts.to.explain</code> instead. If both are <code>NULL</code>, then use all inputs.</p>
</td></tr>
<tr><td><code id="ciu.barplot_+3A_target.concept">target.concept</code></td>
<td>
<p>If provided, then calculate CIU of inputs
<code>ind.inputs.to.explain</code> relative to the given concept rather than
relative to the actual output(s). <code>ind.inputs.to.explain</code> should
normally be a subset (or all) of the inputs that <code>target.concept</code>
consists of, even though that not required by the CIU calculation.
If a <code>target.ciu</code> is provided, then the <code>target.concept</code> doesn't have to
be included in the <code>vocabulary</code> gives as parameter to <a href="#topic+ciu.new">ciu.new</a>
(at least for the moment).</p>
</td></tr>
<tr><td><code id="ciu.barplot_+3A_target.ciu">target.ciu</code></td>
<td>
<p><code>ciu.result</code> object previously calculated for
<code>target.concept</code>. If a <code>target.concept</code> is provided but <code>target.ciu=NULL</code>,
then <code>target.ciu</code> is estimated by a call to <a href="#topic+ciu.explain">ciu.explain</a> with the
<code>n.samples</code> value given as a parameter to this call. It may be useful
to provide <code>target.ciu</code> if it should be estimated using some other
(typically greater) value for <code>n.samples</code> than the default one, or if it
has already been calculated for some reason.</p>
</td></tr>
<tr><td><code id="ciu.barplot_+3A_ciu.meta">ciu.meta</code></td>
<td>
<p>If given, then use existing <code>ciu.meta.result</code> rather
than calling <a href="#topic+ciu.meta.explain">ciu.meta.explain</a>.</p>
</td></tr>
<tr><td><code id="ciu.barplot_+3A_color.ramp.below.neutral">color.ramp.below.neutral</code></td>
<td>
<p>Color ramp function as returned by function
<code>colorRamp()</code>. Default color ramp is from red3 to yellow.</p>
</td></tr>
<tr><td><code id="ciu.barplot_+3A_color.ramp.above.neutral">color.ramp.above.neutral</code></td>
<td>
<p>Color ramp function as returned by function
<code>colorRamp()</code>. Default colorramp is from yellow to darkgreen.</p>
</td></tr>
<tr><td><code id="ciu.barplot_+3A_use.influence">use.influence</code></td>
<td>
<p>Plot using &quot;influence&quot; rather than CIU, i.e. a
LIME-like barplot. Default is FALSE.</p>
</td></tr>
<tr><td><code id="ciu.barplot_+3A_sort">sort</code></td>
<td>
<p>NULL, &quot;CI&quot; or &quot;CU&quot;.</p>
</td></tr>
<tr><td><code id="ciu.barplot_+3A_decreasing">decreasing</code></td>
<td>
<p>Set to TRUE for decreasing sort.</p>
</td></tr>
<tr><td><code id="ciu.barplot_+3A_main">main</code></td>
<td>
<p>Text to use as main title.</p>
</td></tr>
<tr><td><code id="ciu.barplot_+3A_xlab">xlab</code></td>
<td>
<p>Label for x-axis.</p>
</td></tr>
<tr><td><code id="ciu.barplot_+3A_xlim">xlim</code></td>
<td>
<p>Minimal and maximal values for x-axis.</p>
</td></tr>
<tr><td><code id="ciu.barplot_+3A_...">...</code></td>
<td>
<p>See <a href="base.html#topic+plot">base::plot</a>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>&quot;void&quot;, i.e. whatever happens to be result of last instruction.
</p>


<h3>Author(s)</h3>

<p>Kary Främling
</p>


<h3>See Also</h3>

<p><a href="#topic+ciu.new">ciu.new</a>
</p>
<p><a href="#topic+ciu.explain">ciu.explain</a>
</p>

<hr>
<h2 id='ciu.blackbox.new'>Create CIU.BlackBox object</h2><span id='topic+ciu.blackbox.new'></span>

<h3>Description</h3>

<p>This method mainly serves as an &quot;interface specification&quot; for objects of
class <code>CIU.BlackBox</code>, i.e. it defines what method(s) have to be implemented
by any object of class <code>CIU.BlackBox</code>. A <code>CIU.BlackBox</code> object
is actually a <code><a href="base.html#topic+list">list</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ciu.blackbox.new()
</code></pre>


<h3>Details</h3>

<p>An alternative and simpler (but less flexible) way to do the same is to
use the <code>predict.function</code> parameter of <code><a href="#topic+ciu.new">ciu.new</a></code>, where
<code>predict.function &lt;- function(model, inputs) {predict(model,inputs,n.trees=10000)}</code>
would accomplish the same as for the Example below. An example using this
approach is also included in Examples.
</p>
<p>The advantage of using a <code>CIU.BlackBox</code> wrapper
(rather than the simplee <code>predict.function</code> approach) is that it is
possible to keep object variables or maintain whatever state
information might be needed between calls.
</p>
<p>The only things that are actually required from a
<code>CIU.BlackBox</code> object is:
</p>

<ol>
<li><p> That it is a <code><a href="base.html#topic+list">list</a></code> with an element called <code>eval</code>.
</p>
</li>
<li><p> That the value of <code>eval</code> element is a function of the form <code style="white-space: pre;">&#8288;eval = function(inputs)&#8288;</code>
</p>
</li>
<li><p> That it inherits the class <code>CIU.BlackBox</code>.
</p>
</li></ol>



<h3>Value</h3>

<p>Object of class <code>CIU.BlackBox</code>.
</p>


<h3>Author(s)</h3>

<p>Kary Främling
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Create CIU.BlackBox wrapper for Gradient Boosting
library(MASS) # Just in case Boston is not already available
library(gbm)
gbm.ciu.bb &lt;- function(gbm, n.trees=1) {
  o.gbm &lt;- gbm
  o.n.trees &lt;- n.trees
  pub &lt;- list(eval = function(inputs) { predict(o.gbm,inputs,n.trees=o.n.trees) })
  class(pub) &lt;- c("CIU.BlackBox",class(pub))
  return(pub)
}

# Train and explain. We don't care about training/test sets here.
gbm.Boston &lt;- gbm(medv ~ . ,data = Boston, distribution = "gaussian",
n.trees=10000, shrinkage = 0.01, interaction.depth = 4)
gbm.ciu &lt;- gbm.ciu.bb(gbm.Boston, 10000)
ciu &lt;- ciu.new(gbm.ciu, medv~., Boston)
ciu$barplot.ciu(Boston[370,1:13], sort = "CI")

# Same but using `predict.function` parameter in `ciu.new`.
# Using `ggplot.col.ciu` here for a change.
predict.function &lt;- function(model, inputs) {predict(model,inputs,n.trees=10000)}
ciu &lt;- ciu.new(gbm.Boston, medv~., Boston, predict.function=predict.function)
ciu$ggplot.col.ciu(Boston[370,1:13], sort = "CI")

</code></pre>

<hr>
<h2 id='ciu.explain'>Calculate CIU for specific instance</h2><span id='topic+ciu.explain'></span>

<h3>Description</h3>

<p>Calculate Contextual Importance (CI) and Contextual Utility (CU) for an
instance (Context) using the given &quot;black-box&quot; model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ciu.explain(
  ciu,
  instance,
  ind.inputs.to.explain,
  in.min.max.limits = NULL,
  n.samples = 100,
  target.concept = NULL,
  target.ciu = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ciu.explain_+3A_ciu">ciu</code></td>
<td>
<p><code>ciu</code> object as created with <a href="#topic+ciu">ciu</a> function (not to be confused
with <code>CIU</code> object as created by <a href="#topic+ciu.new">ciu.new</a>).</p>
</td></tr>
<tr><td><code id="ciu.explain_+3A_instance">instance</code></td>
<td>
<p>Input values for the instance to explain. Should be a
<a href="base.html#topic+data.frame">data.frame</a> even though a <code>vector</code> or <code>matrix</code> might work too if input
names and other needed metadata can be deduced from the dataset or other
parameters given to <code><a href="#topic+ciu.new">ciu.new</a></code>.</p>
</td></tr>
<tr><td><code id="ciu.explain_+3A_ind.inputs.to.explain">ind.inputs.to.explain</code></td>
<td>
<p><a href="base.html#topic+vector">vector</a> of indices for the inputs to be
explained, i.e. for which CIU should be calculated. If <code>NULL</code>, then all
inputs will be included.</p>
</td></tr>
<tr><td><code id="ciu.explain_+3A_in.min.max.limits">in.min.max.limits</code></td>
<td>
<p><a href="base.html#topic+data.frame">data.frame</a> or <a href="base.html#topic+matrix">matrix</a> with one row per output
and two columns, where the first column indicates the minimal value and the
second column the maximal value for that output. ONLY NEEDED HERE IF not
given as parameter to <a href="#topic+ciu.new">ciu.new</a> or if the limits are different for this
specific instance than the default ones.</p>
</td></tr>
<tr><td><code id="ciu.explain_+3A_n.samples">n.samples</code></td>
<td>
<p>How many instances to generate for estimating CI and CU.
For inputs of type <a href="base.html#topic+factor">factor</a>, all possible combinations of input values
are generated, so this parameter only influences how many instances are
(at least) generated for continuous-valued inputs.</p>
</td></tr>
<tr><td><code id="ciu.explain_+3A_target.concept">target.concept</code></td>
<td>
<p>If provided, then calculate CIU of inputs
<code>ind.inputs.to.explain</code> relative to the given concept rather than
relative to the actual output(s). <code>ind.inputs.to.explain</code> should
normally be a subset (or all) of the inputs that <code>target.concept</code>
consists of, even though that not required by the CIU calculation.
If a <code>target.ciu</code> is provided, then the <code>target.concept</code> doesn't have to
be included in the <code>vocabulary</code> gives as parameter to <a href="#topic+ciu.new">ciu.new</a>
(at least for the moment).</p>
</td></tr>
<tr><td><code id="ciu.explain_+3A_target.ciu">target.ciu</code></td>
<td>
<p><code>ciu.result</code> object previously calculated for
<code>target.concept</code>. If a <code>target.concept</code> is provided but <code>target.ciu=NULL</code>,
then <code>target.ciu</code> is estimated by a call to <a href="#topic+ciu.explain">ciu.explain</a> with the
<code>n.samples</code> value given as a parameter to this call. It may be useful
to provide <code>target.ciu</code> if it should be estimated using some other
(typically greater) value for <code>n.samples</code> than the default one, or if it
has already been calculated for some reason.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>ciu.result</code> object.
</p>


<h3>Author(s)</h3>

<p>Kary Främling
</p>

<hr>
<h2 id='ciu.ggplot'>ciu.ggplot</h2><span id='topic+ciu.ggplot'></span>

<h3>Description</h3>

<p>Function for plotting out the effect of changing values of one input on one output.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ciu.ggplot(
  ciu,
  instance,
  ind.input = 1,
  ind.output = 1,
  in.min.max.limits = NULL,
  n.points = 40,
  main = NULL,
  xlab = NULL,
  ylab = NULL,
  ylim = NULL,
  illustrate.CIU = FALSE,
  neutral.CU = 0.5,
  CIU.illustration.colours = c("red", "orange", "green", "blue")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ciu.ggplot_+3A_ciu">ciu</code></td>
<td>
<p><code>ciu</code> object as created with <a href="#topic+ciu">ciu</a> function (not to be confused
with <code>CIU</code> object as created by <a href="#topic+ciu.new">ciu.new</a>).</p>
</td></tr>
<tr><td><code id="ciu.ggplot_+3A_instance">instance</code></td>
<td>
<p>Input values for the instance to explain. Should be a
<a href="base.html#topic+data.frame">data.frame</a> even though a <code>vector</code> or <code>matrix</code> might work too if input
names and other needed metadata can be deduced from the dataset or other
parameters given to <code><a href="#topic+ciu.new">ciu.new</a></code>.</p>
</td></tr>
<tr><td><code id="ciu.ggplot_+3A_ind.input">ind.input</code></td>
<td>
<p>Index of input feature to plot.</p>
</td></tr>
<tr><td><code id="ciu.ggplot_+3A_ind.output">ind.output</code></td>
<td>
<p>Index of output to plot.</p>
</td></tr>
<tr><td><code id="ciu.ggplot_+3A_in.min.max.limits">in.min.max.limits</code></td>
<td>
<p><a href="base.html#topic+data.frame">data.frame</a> or <a href="base.html#topic+matrix">matrix</a> with one row per output
and two columns, where the first column indicates the minimal value and the
second column the maximal value for that output. ONLY NEEDED HERE IF not
given as parameter to <a href="#topic+ciu.new">ciu.new</a> or if the limits are different for this
specific instance than the default ones.</p>
</td></tr>
<tr><td><code id="ciu.ggplot_+3A_n.points">n.points</code></td>
<td>
<p>How many x,y pairs will be calculated, equally spaced over in.min.max.limits.</p>
</td></tr>
<tr><td><code id="ciu.ggplot_+3A_main">main</code></td>
<td>
<p>Text to use as main title.</p>
</td></tr>
<tr><td><code id="ciu.ggplot_+3A_xlab">xlab</code></td>
<td>
<p>Label for x-axis.</p>
</td></tr>
<tr><td><code id="ciu.ggplot_+3A_ylab">ylab</code></td>
<td>
<p>Label for y-axis.</p>
</td></tr>
<tr><td><code id="ciu.ggplot_+3A_ylim">ylim</code></td>
<td>
<p>Minimal and maximal values for y-axis.</p>
</td></tr>
<tr><td><code id="ciu.ggplot_+3A_illustrate.ciu">illustrate.CIU</code></td>
<td>
<p>Include illustration of CIU Cmin, Cmax, neutral.CU. Default is FALSE</p>
</td></tr>
<tr><td><code id="ciu.ggplot_+3A_neutral.cu">neutral.CU</code></td>
<td>
<p>Value of neutral.CU. Default is 0.5.</p>
</td></tr>
<tr><td><code id="ciu.ggplot_+3A_ciu.illustration.colours">CIU.illustration.colours</code></td>
<td>
<p>Colours to use for illustrating CIU.
Default is red, orange, green.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ggplot object.
</p>


<h3>Author(s)</h3>

<p>Kary Främling
</p>

<hr>
<h2 id='ciu.ggplot.col'>CIU feature importance/utility plot using ggplot.</h2><span id='topic+ciu.ggplot.col'></span>

<h3>Description</h3>

<p>Create a barplot showing CI as the length of the bar and CU on color scale from
red to green, via yellow, for the given inputs and the given output.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ciu.ggplot.col(
  ciu,
  instance = NULL,
  ind.inputs = NULL,
  output.names = NULL,
  in.min.max.limits = NULL,
  n.samples = 100,
  neutral.CU = 0.5,
  show.input.values = TRUE,
  concepts.to.explain = NULL,
  target.concept = NULL,
  target.ciu = NULL,
  ciu.meta = NULL,
  plot.mode = "colour_cu",
  ci.colours = c("aquamarine", "aquamarine3", "0.3"),
  cu.colours = c("darkgreen", "darkgreen", "0.8"),
  low.color = "red",
  mid.color = "yellow",
  high.color = "darkgreen",
  use.influence = FALSE,
  sort = NULL,
  decreasing = FALSE,
  main = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ciu.ggplot.col_+3A_ciu">ciu</code></td>
<td>
<p><code>ciu</code> object as created with <a href="#topic+ciu">ciu</a> function (not to be confused
with <code>CIU</code> object as created by <a href="#topic+ciu.new">ciu.new</a>).</p>
</td></tr>
<tr><td><code id="ciu.ggplot.col_+3A_instance">instance</code></td>
<td>
<p>Input values for the instance to explain. Should be a
<a href="base.html#topic+data.frame">data.frame</a> even though a <code>vector</code> or <code>matrix</code> might work too if input
names and other needed metadata can be deduced from the dataset or other
parameters given to <code><a href="#topic+ciu.new">ciu.new</a></code>.</p>
</td></tr>
<tr><td><code id="ciu.ggplot.col_+3A_ind.inputs">ind.inputs</code></td>
<td>
<p>Indices of input features to explain (the set i in CIU
formulae)</p>
</td></tr>
<tr><td><code id="ciu.ggplot.col_+3A_output.names">output.names</code></td>
<td>
<p>Vector with names of outputs to include.
If NULL (default), then include all.</p>
</td></tr>
<tr><td><code id="ciu.ggplot.col_+3A_in.min.max.limits">in.min.max.limits</code></td>
<td>
<p><a href="base.html#topic+data.frame">data.frame</a> or <a href="base.html#topic+matrix">matrix</a> with one row per output
and two columns, where the first column indicates the minimal value and the
second column the maximal value for that output. ONLY NEEDED HERE IF not
given as parameter to <a href="#topic+ciu.new">ciu.new</a> or if the limits are different for this
specific instance than the default ones.</p>
</td></tr>
<tr><td><code id="ciu.ggplot.col_+3A_n.samples">n.samples</code></td>
<td>
<p>How many instances to generate for estimating CI and CU.
For inputs of type <a href="base.html#topic+factor">factor</a>, all possible combinations of input values
are generated, so this parameter only influences how many instances are
(at least) generated for continuous-valued inputs.</p>
</td></tr>
<tr><td><code id="ciu.ggplot.col_+3A_neutral.cu">neutral.CU</code></td>
<td>
<p>Indicates when the Contextual Utility is considered
to be &quot;negative&quot;. The default value of 0.5 seems quite logical for most cases.</p>
</td></tr>
<tr><td><code id="ciu.ggplot.col_+3A_show.input.values">show.input.values</code></td>
<td>
<p>Include input values after input labels or not.
Default is TRUE.</p>
</td></tr>
<tr><td><code id="ciu.ggplot.col_+3A_concepts.to.explain">concepts.to.explain</code></td>
<td>
<p>List of input feature concepts to explain, as defined
by vocabulary provided as argument to <a href="#topic+ciu.new">ciu.new</a>. If <code>ind.inputs=NULL</code>,
then use <code>concepts.to.explain</code> instead. If both are <code>NULL</code>, then use all inputs.</p>
</td></tr>
<tr><td><code id="ciu.ggplot.col_+3A_target.concept">target.concept</code></td>
<td>
<p>If provided, then calculate CIU of inputs
<code>ind.inputs.to.explain</code> relative to the given concept rather than
relative to the actual output(s). <code>ind.inputs.to.explain</code> should
normally be a subset (or all) of the inputs that <code>target.concept</code>
consists of, even though that not required by the CIU calculation.
If a <code>target.ciu</code> is provided, then the <code>target.concept</code> doesn't have to
be included in the <code>vocabulary</code> gives as parameter to <a href="#topic+ciu.new">ciu.new</a>
(at least for the moment).</p>
</td></tr>
<tr><td><code id="ciu.ggplot.col_+3A_target.ciu">target.ciu</code></td>
<td>
<p><code>ciu.result</code> object previously calculated for
<code>target.concept</code>. If a <code>target.concept</code> is provided but <code>target.ciu=NULL</code>,
then <code>target.ciu</code> is estimated by a call to <a href="#topic+ciu.explain">ciu.explain</a> with the
<code>n.samples</code> value given as a parameter to this call. It may be useful
to provide <code>target.ciu</code> if it should be estimated using some other
(typically greater) value for <code>n.samples</code> than the default one, or if it
has already been calculated for some reason.</p>
</td></tr>
<tr><td><code id="ciu.ggplot.col_+3A_ciu.meta">ciu.meta</code></td>
<td>
<p>If given, then use existing <code>ciu.meta.result</code> rather
than calling <a href="#topic+ciu.meta.explain">ciu.meta.explain</a>.</p>
</td></tr>
<tr><td><code id="ciu.ggplot.col_+3A_plot.mode">plot.mode</code></td>
<td>
<p>&quot;overlap&quot; or &quot;colour_cu&quot;. Default is &quot;colour_cu&quot;.</p>
</td></tr>
<tr><td><code id="ciu.ggplot.col_+3A_ci.colours">ci.colours</code></td>
<td>
<p>Colours to use for CI part in &quot;overlap&quot; mode. Three values
required: fill colour, border colour, alpha. Default is c(&quot;aquamarine&quot;, &quot;aquamarine3&quot;, &quot;0.3&quot;).</p>
</td></tr>
<tr><td><code id="ciu.ggplot.col_+3A_cu.colours">cu.colours</code></td>
<td>
<p>Colours to use for CU part in &quot;overlap&quot; mode. Three values
required: fill colour, border colour, alpha. Default is c(&quot;darkgreen&quot;, &quot;darkgreen&quot;, &quot;0.8&quot;).
If it is set to NULL, then the same colour palette is used as for &quot;colour_cu&quot;.</p>
</td></tr>
<tr><td><code id="ciu.ggplot.col_+3A_low.color">low.color</code></td>
<td>
<p>Colour to use for CU=0</p>
</td></tr>
<tr><td><code id="ciu.ggplot.col_+3A_mid.color">mid.color</code></td>
<td>
<p>Colour to use for CU=Neutral.CU</p>
</td></tr>
<tr><td><code id="ciu.ggplot.col_+3A_high.color">high.color</code></td>
<td>
<p>Colour to use for CU=1</p>
</td></tr>
<tr><td><code id="ciu.ggplot.col_+3A_use.influence">use.influence</code></td>
<td>
<p>Plot using &quot;influence&quot; rather than CIU, i.e. a
LIME-like barplot. Default is FALSE.</p>
</td></tr>
<tr><td><code id="ciu.ggplot.col_+3A_sort">sort</code></td>
<td>
<p>NULL, &quot;CI&quot; or &quot;CU&quot;.</p>
</td></tr>
<tr><td><code id="ciu.ggplot.col_+3A_decreasing">decreasing</code></td>
<td>
<p>Set to TRUE for decreasing sort.</p>
</td></tr>
<tr><td><code id="ciu.ggplot.col_+3A_main">main</code></td>
<td>
<p>Text to use as main title.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ggplot object.
</p>


<h3>Author(s)</h3>

<p>Kary Främling
</p>

<hr>
<h2 id='ciu.list.to.frame'>ciu.list.to.frame</h2><span id='topic+ciu.list.to.frame'></span>

<h3>Description</h3>

<p>Convert <a href="base.html#topic+list">list</a> of ciu.result objects into corresponding <a href="base.html#topic+data.frame">data.frame</a> for
given output.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ciu.list.to.frame(ciu.list, out.ind = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ciu.list.to.frame_+3A_ciu.list">ciu.list</code></td>
<td>
<p><a href="base.html#topic+list">list</a> of ciu.result objects.</p>
</td></tr>
<tr><td><code id="ciu.list.to.frame_+3A_out.ind">out.ind</code></td>
<td>
<p>Index of output to extract.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><a href="base.html#topic+data.frame">data.frame</a> with same columns as ciu.result object but with one row
per input feature.
</p>


<h3>Author(s)</h3>

<p>Kary Främling
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(MASS)
iris_train &lt;- iris[, 1:4]
iris_lab &lt;- iris$Species
iris.lda &lt;- lda(iris_train, iris_lab)
instance &lt;- iris[100,1:4]
ciu &lt;- ciu.new(iris.lda, Species~., iris)
meta &lt;- ciu$meta.explain(instance)
ciu.list.to.frame(meta$ciuvals)
</code></pre>

<hr>
<h2 id='ciu.meta.explain'>ciu.meta.explain</h2><span id='topic+ciu.meta.explain'></span>

<h3>Description</h3>

<p>ciu.meta.explain
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ciu.meta.explain(
  ciu,
  instance,
  ind.inputs = NULL,
  in.min.max.limits = NULL,
  n.samples = 100,
  concepts.to.explain = NULL,
  target.concept = NULL,
  target.ciu = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ciu.meta.explain_+3A_ciu">ciu</code></td>
<td>
<p><code>ciu</code> object as created with <a href="#topic+ciu">ciu</a> function (not to be confused
with <code>CIU</code> object as created by <a href="#topic+ciu.new">ciu.new</a>).</p>
</td></tr>
<tr><td><code id="ciu.meta.explain_+3A_instance">instance</code></td>
<td>
<p>Input values for the instance to explain. Should be a
<a href="base.html#topic+data.frame">data.frame</a> even though a <code>vector</code> or <code>matrix</code> might work too if input
names and other needed metadata can be deduced from the dataset or other
parameters given to <code><a href="#topic+ciu.new">ciu.new</a></code>.</p>
</td></tr>
<tr><td><code id="ciu.meta.explain_+3A_ind.inputs">ind.inputs</code></td>
<td>
<p>Indices of input features to explain (the set i in CIU
formulae)</p>
</td></tr>
<tr><td><code id="ciu.meta.explain_+3A_in.min.max.limits">in.min.max.limits</code></td>
<td>
<p><a href="base.html#topic+data.frame">data.frame</a> or <a href="base.html#topic+matrix">matrix</a> with one row per output
and two columns, where the first column indicates the minimal value and the
second column the maximal value for that output. ONLY NEEDED HERE IF not
given as parameter to <a href="#topic+ciu.new">ciu.new</a> or if the limits are different for this
specific instance than the default ones.</p>
</td></tr>
<tr><td><code id="ciu.meta.explain_+3A_n.samples">n.samples</code></td>
<td>
<p>How many instances to generate for estimating CI and CU.
For inputs of type <a href="base.html#topic+factor">factor</a>, all possible combinations of input values
are generated, so this parameter only influences how many instances are
(at least) generated for continuous-valued inputs.</p>
</td></tr>
<tr><td><code id="ciu.meta.explain_+3A_concepts.to.explain">concepts.to.explain</code></td>
<td>
<p>List of input feature concepts to explain, as defined
by vocabulary provided as argument to <a href="#topic+ciu.new">ciu.new</a>. If <code>ind.inputs=NULL</code>,
then use <code>concepts.to.explain</code> instead. If both are <code>NULL</code>, then use all inputs.</p>
</td></tr>
<tr><td><code id="ciu.meta.explain_+3A_target.concept">target.concept</code></td>
<td>
<p>If provided, then calculate CIU of inputs
<code>ind.inputs.to.explain</code> relative to the given concept rather than
relative to the actual output(s). <code>ind.inputs.to.explain</code> should
normally be a subset (or all) of the inputs that <code>target.concept</code>
consists of, even though that not required by the CIU calculation.
If a <code>target.ciu</code> is provided, then the <code>target.concept</code> doesn't have to
be included in the <code>vocabulary</code> gives as parameter to <a href="#topic+ciu.new">ciu.new</a>
(at least for the moment).</p>
</td></tr>
<tr><td><code id="ciu.meta.explain_+3A_target.ciu">target.ciu</code></td>
<td>
<p><code>ciu.result</code> object previously calculated for
<code>target.concept</code>. If a <code>target.concept</code> is provided but <code>target.ciu=NULL</code>,
then <code>target.ciu</code> is estimated by a call to <a href="#topic+ciu.explain">ciu.explain</a> with the
<code>n.samples</code> value given as a parameter to this call. It may be useful
to provide <code>target.ciu</code> if it should be estimated using some other
(typically greater) value for <code>n.samples</code> than the default one, or if it
has already been calculated for some reason.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>ciu.meta.result</code>.
</p>


<h3>Author(s)</h3>

<p>Kary Främling
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Explaining the classification of an Iris instance with lda model.
# We use a versicolor (instance 100).
library(MASS)
test.ind &lt;- 100
iris_test &lt;- iris[test.ind, 1:4]
iris_train &lt;- iris[-test.ind, 1:4]
iris_lab &lt;- iris[[5]][-test.ind]
model &lt;- lda(iris_train, iris_lab)

# Create CIU object
ciu &lt;- ciu.new(model, Species~., iris)

# Get ciu.meta.result. This can either be 'ciu$meta.explain(...)'
# or 'ciu.meta.explain(ciu, ...)'
ciu.meta &lt;- ciu$meta.explain(iris_test)

# Use same result for different visualisations.
ciu$ggplot.col.ciu(ciu.meta = ciu.meta)
ciu$barplot.ciu(ind.output = 2, ciu.meta = ciu.meta)
ciu$pie.ciu(ind.output = 2, ciu.meta = ciu.meta)

## Not run: 
# Same with Boston Housing data set.
library(caret)
gbm &lt;- train(medv ~ ., Boston, method="gbm", trControl=trainControl(method="cv", number=10))
ciu &lt;- ciu.new(gbm, medv~., Boston)
instance &lt;- Boston[370,1:13]
ciu.meta &lt;- ciu$meta.explain(instance)
ciu$barplot.ciu(ciu.meta = ciu.meta, sort = "CI")
ciu$pie.ciu(ciu.meta = ciu.meta)
ciu$ggplot.col.ciu(ciu.meta = ciu.meta)

## End(Not run)
</code></pre>

<hr>
<h2 id='ciu.meta.result.new'>CIU meta-result object</h2><span id='topic+ciu.meta.result.new'></span>

<h3>Description</h3>

<p>Create object of class <code>ciu.meta.result</code>, which stores results of CIU
calculations together with their &quot;meta-data&quot;.
The <code><a href="#topic+ciu.meta.explain">ciu.meta.explain()</a></code> method returns a <code>ciu.meta.result</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ciu.meta.result.new(
  ciu,
  instance,
  ciuvals,
  ind.inputs = NULL,
  inp.names = NULL,
  in.min.max.limits = NULL,
  n.samples = NULL,
  target.concept = NULL,
  target.ciu = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ciu.meta.result.new_+3A_ciu">ciu</code></td>
<td>
<p><code>ciu</code> object as created with <a href="#topic+ciu">ciu</a> function (not to be confused
with <code>CIU</code> object as created by <a href="#topic+ciu.new">ciu.new</a>).</p>
</td></tr>
<tr><td><code id="ciu.meta.result.new_+3A_instance">instance</code></td>
<td>
<p>Input values for the instance to explain. Should be a
<a href="base.html#topic+data.frame">data.frame</a> even though a <code>vector</code> or <code>matrix</code> might work too if input
names and other needed metadata can be deduced from the dataset or other
parameters given to <code><a href="#topic+ciu.new">ciu.new</a></code>.</p>
</td></tr>
<tr><td><code id="ciu.meta.result.new_+3A_ciuvals">ciuvals</code></td>
<td>
<p>List of <code>ciu.result</code> objects, one per input feature.</p>
</td></tr>
<tr><td><code id="ciu.meta.result.new_+3A_ind.inputs">ind.inputs</code></td>
<td>
<p>Indices of input features to explain (the set i in CIU
formulae)</p>
</td></tr>
<tr><td><code id="ciu.meta.result.new_+3A_inp.names">inp.names</code></td>
<td>
<p>Names of the input features.</p>
</td></tr>
<tr><td><code id="ciu.meta.result.new_+3A_in.min.max.limits">in.min.max.limits</code></td>
<td>
<p><a href="base.html#topic+data.frame">data.frame</a> or <a href="base.html#topic+matrix">matrix</a> with one row per output
and two columns, where the first column indicates the minimal value and the
second column the maximal value for that output. ONLY NEEDED HERE IF not
given as parameter to <a href="#topic+ciu.new">ciu.new</a> or if the limits are different for this
specific instance than the default ones.</p>
</td></tr>
<tr><td><code id="ciu.meta.result.new_+3A_n.samples">n.samples</code></td>
<td>
<p>How many instances to generate for estimating CI and CU.
For inputs of type <a href="base.html#topic+factor">factor</a>, all possible combinations of input values
are generated, so this parameter only influences how many instances are
(at least) generated for continuous-valued inputs.</p>
</td></tr>
<tr><td><code id="ciu.meta.result.new_+3A_target.concept">target.concept</code></td>
<td>
<p>If provided, then calculate CIU of inputs
<code>ind.inputs.to.explain</code> relative to the given concept rather than
relative to the actual output(s). <code>ind.inputs.to.explain</code> should
normally be a subset (or all) of the inputs that <code>target.concept</code>
consists of, even though that not required by the CIU calculation.
If a <code>target.ciu</code> is provided, then the <code>target.concept</code> doesn't have to
be included in the <code>vocabulary</code> gives as parameter to <a href="#topic+ciu.new">ciu.new</a>
(at least for the moment).</p>
</td></tr>
<tr><td><code id="ciu.meta.result.new_+3A_target.ciu">target.ciu</code></td>
<td>
<p><code>ciu.result</code> object previously calculated for
<code>target.concept</code>. If a <code>target.concept</code> is provided but <code>target.ciu=NULL</code>,
then <code>target.ciu</code> is estimated by a call to <a href="#topic+ciu.explain">ciu.explain</a> with the
<code>n.samples</code> value given as a parameter to this call. It may be useful
to provide <code>target.ciu</code> if it should be estimated using some other
(typically greater) value for <code>n.samples</code> than the default one, or if it
has already been calculated for some reason.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class ciu.meta.result, which is a <a href="base.html#topic+list">list</a> with
same elements as the given parameters.
</p>


<h3>Author(s)</h3>

<p>Kary Främling
</p>

<hr>
<h2 id='ciu.new'>Create CIU object</h2><span id='topic+ciu.new'></span>

<h3>Description</h3>

<p>Sets up a CIU object with the given parameters. CIU objects have &quot;public&quot;
and &quot;private&quot; methods. A CIU object is actually a <a href="base.html#topic+list">list</a> whose elements
are the public functions (methods).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ciu.new(
  bb,
  formula = NULL,
  data = NULL,
  in.min.max.limits = NULL,
  abs.min.max = NULL,
  input.names = NULL,
  output.names = NULL,
  predict.function = NULL,
  vocabulary = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ciu.new_+3A_bb">bb</code></td>
<td>
<p>Model/&quot;black-box&quot; object. At least all <code>caret</code> models, the
<code>lda</code> model from MASS, and the <code>lm</code> model are supported.
Otherwise, the prediction
function to be used can be gives as value of the <code>predict.function</code>
parameter.
A more powerful way is to inherit from FunctionApproximator class and
implement an &quot;eval&quot; method.</p>
</td></tr>
<tr><td><code id="ciu.new_+3A_formula">formula</code></td>
<td>
<p>Formula that describes input versus output values. Only to
be used together with <code>data</code> parameter.</p>
</td></tr>
<tr><td><code id="ciu.new_+3A_data">data</code></td>
<td>
<p>The training data used for training the model. If this parameter
is provided, a <code>formula</code> MUST be given also.
<code>ciu.new</code> attempts to infer the other parameters from
<code>data</code> and <code>formula</code>. i.e. <code>in.min.max.limits</code>,
<code>abs.min.max</code>, <code>input.names</code>
and <code>output.names</code>. If those parameters are provided, then they
override the inferred ones.</p>
</td></tr>
<tr><td><code id="ciu.new_+3A_in.min.max.limits">in.min.max.limits</code></td>
<td>
<p>matrix with one row per output and two columns,
where the first column indicates the minimal value and the second column
the maximal value for that input.</p>
</td></tr>
<tr><td><code id="ciu.new_+3A_abs.min.max">abs.min.max</code></td>
<td>
<p><a href="base.html#topic+data.frame">data.frame</a> or <a href="base.html#topic+matrix">matrix</a> of min-max values of
outputs, one row per output, two columns (min, max).</p>
</td></tr>
<tr><td><code id="ciu.new_+3A_input.names">input.names</code></td>
<td>
<p>labels of inputs.</p>
</td></tr>
<tr><td><code id="ciu.new_+3A_output.names">output.names</code></td>
<td>
<p>labels of outputs.</p>
</td></tr>
<tr><td><code id="ciu.new_+3A_predict.function">predict.function</code></td>
<td>
<p>can be supplied if a model that is not supported by
ciu should be used. As an example, this is the function for lda:</p>
<pre>
o.predict.function &lt;- function(model, inputs) {
    pred &lt;- predict(model,inputs)
        return(pred$posterior)
}</pre></td></tr>
<tr><td><code id="ciu.new_+3A_vocabulary">vocabulary</code></td>
<td>
<p>list of labels/concepts to be used when producing
explanations and what combination of inputs they correspond to. Example of
two intermediate concepts and a higher-level one that combines them:
<code>list(intermediate.concept1=c(1,2,3), intermediate.concept2=c(4,5), higher.level.concept=c(1,2,3,4,5))</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>CIU is implemented in an object-oriented manner, where a CIU
object is a <code><a href="base.html#topic+list">list</a></code> whose methods are made visible as
elements of the list. The general way for using <code>CIU</code> objects is to
first get a <code>CIU</code> object by calling <code><a href="#topic+ciu.new">ciu.new</a></code> as e.g.
<code>ciu &lt;- ciu.new(...)</code>, then call <code>ciu.res &lt;- ciu$&lt;method&gt;(...)</code>.
The methods that can be used in <code style="white-space: pre;">&#8288;&lt;method&gt;&#8288;</code> are:
</p>

<ul>
<li> <p><code>explain</code>, see <a href="#topic+ciu.explain">ciu.explain</a> (but omit first parameter <code>ciu</code>)
</p>
</li>
<li> <p><code>meta.explain</code>, see <a href="#topic+ciu.meta.explain">ciu.meta.explain</a> (but omit first parameter <code>ciu</code>).
</p>
</li>
<li> <p><code>barplot.ciu</code>, see <a href="#topic+ciu.barplot">ciu.barplot</a> (but omit first parameter <code>ciu</code>)
</p>
</li>
<li> <p><code>ggplot.col.ciu</code>, see <a href="#topic+ciu.ggplot.col">ciu.ggplot.col</a> (but omit first parameter <code>ciu</code>)
</p>
</li>
<li> <p><code>pie.ciu</code>, see <a href="#topic+ciu.pie">ciu.pie</a> (but omit first parameter <code>ciu</code>)
</p>
</li>
<li> <p><code>plot.ciu</code>, see <a href="#topic+ciu.plot">ciu.plot</a> (but omit first parameter <code>ciu</code>)
</p>
</li>
<li> <p><code>plot.ciu.3D</code>, see <a href="#topic+ciu.plot.3D">ciu.plot.3D</a> (but omit first parameter <code>ciu</code>)
</p>
</li>
<li> <p><code>textual</code>, see <a href="#topic+ciu.textual">ciu.textual</a> (but omit first parameter <code>ciu</code>).
</p>
</li></ul>

<p><em>&quot;Usage&quot; section is here in &quot;Details&quot; section because Roxygen etc.
don't support documentation of functions within functions.</em>
</p>


<h3>Value</h3>

<p>Object of class <code>CIU</code>.
</p>
<p><code>ciu</code> object
</p>


<h3>Author(s)</h3>

<p>Kary Främling
Create <code>ciu</code> object from this <code>CIU</code> object.
</p>


<h3>References</h3>

<p>Främling, K. <em>Contextual Importance and Utility in R: the 'ciu' Package.</em>
In: Proceedings of 1st Workshop on Explainable Agency in Artificial Intelligence,
at 35th AAAI Conference on Artificial Intelligence. Virtual, Online. February 8-9, 2021. pp. 110-114.
</p>
<p>Främling, K. <em>Explainable AI without Interpretable Model</em>. 2020, <a href="https://arxiv.org/abs/2009.13996">https://arxiv.org/abs/2009.13996</a>.
</p>
<p>Främling, K. <em>Decision Theory Meets Explainable AI</em>. 2020, &lt;doi.org/10.1007/978-3-030-51924-7_4&gt;.
</p>
<p>Främling, K. <em>Modélisation et apprentissage des préférences par réseaux de neurones pour l'aide à la décision multicritère</em>. 1996, <a href="https://tel.archives-ouvertes.fr/tel-00825854/document">https://tel.archives-ouvertes.fr/tel-00825854/document</a> (title translation in English: <em>Learning and Explaining Preferences with Neural Networks for Multiple Criteria Decision Making</em>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Explaining the classification of an Iris instance with lda model.
# We use a versicolor (instance 100).
library(MASS)
test.ind &lt;- 100
iris_test &lt;- iris[test.ind, 1:4]
iris_train &lt;- iris[-test.ind, 1:4]
iris_lab &lt;- iris[[5]][-test.ind]
model &lt;- lda(iris_train, iris_lab)

# Create CIU object
ciu &lt;- ciu.new(model, Species~., iris)

# This can be used with explain method for getting CIU values
# of one or several inputs. Here we get CIU for all three outputs
# with input feature "Petal.Length" that happens to be the most important.
ciu$explain(iris_test, 1)

# It is, however, more convenient to use one of the graphical visualisations.
# Here's one using ggplot.
ciu$ggplot.col.ciu(iris_test)

# LDA creates very sharp class limits, which can also be seen in the CIU
# explanation. We can study what the underlying model looks like using
# plot.ciu and plot.ciu.3D methods. Here is a 3D plot for all three classes
# as a function of Petal Length&amp;Width. Iris #100 (shown as the red dot)
# is on the ridge of the "versicolor" class, which is quite narrow for
# Petal Length&amp;Width.
ciu$plot.ciu.3D(iris_test,c(3,4),1,main=levels(iris$Species)[1],)
ciu$plot.ciu.3D(iris_test,c(3,4),2,main=levels(iris$Species)[2])
ciu$plot.ciu.3D(iris_test,c(3,4),3,main=levels(iris$Species)[3])

## Not run: 
# Same thing with a regression task, the Boston Housing data set. Instance
# #370 has the highest valuation (50k$). Model is gbm, which performs
# decently here. Plotting with "standard" bar plot this time.
# Use something like "par(mai=c(0.8,1.2,0.4,0.2))" for seeing Y-axis labels.
library(caret)
gbm &lt;- train(medv ~ ., Boston, method="gbm", trControl=trainControl(method="cv", number=10))
ciu &lt;- ciu.new(gbm, medv~., Boston)
ciu$barplot.ciu(Boston[370,1:13])

# Same but sort by CI.
ciu$barplot.ciu(Boston[370,1:13], sort = "CI")

# The two other possible plots
ciu$ggplot.col(Boston[370,1:13])
ciu$pie.ciu(Boston[370,1:13])

# Method "plot" for studying the black-box behavior and CIU one input at a time.
ciu$plot.ciu(Boston[370,1:13],13)

## End(Not run)

</code></pre>

<hr>
<h2 id='ciu.pie'>ciu.pie</h2><span id='topic+ciu.pie'></span>

<h3>Description</h3>

<p>Create a pie chart showing CI as the area of slice and CU on color scale from
red to green, via yellow, for the given inputs and the given output.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ciu.pie(
  ciu,
  instance,
  ind.inputs = NULL,
  ind.output = 1,
  in.min.max.limits = NULL,
  n.samples = 100,
  neutral.CU = 0.5,
  show.input.values = TRUE,
  concepts.to.explain = NULL,
  target.concept = NULL,
  target.ciu = NULL,
  ciu.meta = NULL,
  color.ramp.below.neutral = NULL,
  color.ramp.above.neutral = NULL,
  sort = NULL,
  decreasing = FALSE,
  main = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ciu.pie_+3A_ciu">ciu</code></td>
<td>
<p><code>ciu</code> object as created with <a href="#topic+ciu">ciu</a> function (not to be confused
with <code>CIU</code> object as created by <a href="#topic+ciu.new">ciu.new</a>).</p>
</td></tr>
<tr><td><code id="ciu.pie_+3A_instance">instance</code></td>
<td>
<p>Input values for the instance to explain. Should be a
<a href="base.html#topic+data.frame">data.frame</a> even though a <code>vector</code> or <code>matrix</code> might work too if input
names and other needed metadata can be deduced from the dataset or other
parameters given to <code><a href="#topic+ciu.new">ciu.new</a></code>.</p>
</td></tr>
<tr><td><code id="ciu.pie_+3A_ind.inputs">ind.inputs</code></td>
<td>
<p>Vector of indices for the inputs to be
included in the plot. If NULL then all inputs will be included.</p>
</td></tr>
<tr><td><code id="ciu.pie_+3A_ind.output">ind.output</code></td>
<td>
<p>Index of output to be explained.</p>
</td></tr>
<tr><td><code id="ciu.pie_+3A_in.min.max.limits">in.min.max.limits</code></td>
<td>
<p><a href="base.html#topic+data.frame">data.frame</a> or <a href="base.html#topic+matrix">matrix</a> with one row per output
and two columns, where the first column indicates the minimal value and the
second column the maximal value for that output. ONLY NEEDED HERE IF not
given as parameter to <a href="#topic+ciu.new">ciu.new</a> or if the limits are different for this
specific instance than the default ones.</p>
</td></tr>
<tr><td><code id="ciu.pie_+3A_n.samples">n.samples</code></td>
<td>
<p>How many instances to generate for estimating CI and CU.
For inputs of type <a href="base.html#topic+factor">factor</a>, all possible combinations of input values
are generated, so this parameter only influences how many instances are
(at least) generated for continuous-valued inputs.</p>
</td></tr>
<tr><td><code id="ciu.pie_+3A_neutral.cu">neutral.CU</code></td>
<td>
<p>Indicates when the Contextual Utility is considered
to be &quot;negative&quot;. The default value of 0.5 seems quite logical for most cases.</p>
</td></tr>
<tr><td><code id="ciu.pie_+3A_show.input.values">show.input.values</code></td>
<td>
<p>Include input values after input labels or not.
Default is TRUE.</p>
</td></tr>
<tr><td><code id="ciu.pie_+3A_concepts.to.explain">concepts.to.explain</code></td>
<td>
<p>List of concepts to use in the plot, as defined
by vocabulary provided as argument to <a href="#topic+ciu.new">ciu.new</a>. If <code>ind.inputs=NULL</code>,
then use <code>concepts.to.explain</code> instead. If both are <code>NULL</code>, then use all inputs.</p>
</td></tr>
<tr><td><code id="ciu.pie_+3A_target.concept">target.concept</code></td>
<td>
<p>If provided, then calculate CIU of inputs
<code>ind.inputs.to.explain</code> relative to the given concept rather than
relative to the actual output(s). <code>ind.inputs.to.explain</code> should
normally be a subset (or all) of the inputs that <code>target.concept</code>
consists of, even though that not required by the CIU calculation.
If a <code>target.ciu</code> is provided, then the <code>target.concept</code> doesn't have to
be included in the <code>vocabulary</code> gives as parameter to <a href="#topic+ciu.new">ciu.new</a>
(at least for the moment).</p>
</td></tr>
<tr><td><code id="ciu.pie_+3A_target.ciu">target.ciu</code></td>
<td>
<p><code>ciu.result</code> object previously calculated for
<code>target.concept</code>. If a <code>target.concept</code> is provided but <code>target.ciu=NULL</code>,
then <code>target.ciu</code> is estimated by a call to <a href="#topic+ciu.explain">ciu.explain</a> with the
<code>n.samples</code> value given as a parameter to this call. It may be useful
to provide <code>target.ciu</code> if it should be estimated using some other
(typically greater) value for <code>n.samples</code> than the default one, or if it
has already been calculated for some reason.</p>
</td></tr>
<tr><td><code id="ciu.pie_+3A_ciu.meta">ciu.meta</code></td>
<td>
<p>If given, then use existing <code>ciu.meta.result</code> rather
than calling <a href="#topic+ciu.meta.explain">ciu.meta.explain</a>.</p>
</td></tr>
<tr><td><code id="ciu.pie_+3A_color.ramp.below.neutral">color.ramp.below.neutral</code></td>
<td>
<p>Color ramp function as returned by function
<code>colorRamp()</code>. Default color ramp is from red3 to yellow.</p>
</td></tr>
<tr><td><code id="ciu.pie_+3A_color.ramp.above.neutral">color.ramp.above.neutral</code></td>
<td>
<p>Color ramp function as returned by function
<code>colorRamp()</code>. Default colorramp is from yellow to darkgreen.</p>
</td></tr>
<tr><td><code id="ciu.pie_+3A_sort">sort</code></td>
<td>
<p>NULL, &quot;CI&quot; or &quot;CU&quot;.</p>
</td></tr>
<tr><td><code id="ciu.pie_+3A_decreasing">decreasing</code></td>
<td>
<p>Set to TRUE for decreasing sort.</p>
</td></tr>
<tr><td><code id="ciu.pie_+3A_main">main</code></td>
<td>
<p>Text to use as main title.</p>
</td></tr>
<tr><td><code id="ciu.pie_+3A_...">...</code></td>
<td>
<p>See <a href="base.html#topic+plot">base::plot</a>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>&quot;void&quot;, i.e. whatever happens to be result of last instruction.
</p>


<h3>Author(s)</h3>

<p>Kary Främling
</p>

<hr>
<h2 id='ciu.plot'>ciu.plot</h2><span id='topic+ciu.plot'></span>

<h3>Description</h3>

<p>Function for plotting out the effect of changing values of one input on one output
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ciu.plot(
  ciu,
  instance,
  ind.input,
  ind.output,
  in.min.max.limits = NULL,
  n.points = 40,
  main = NULL,
  xlab = NULL,
  ylab = NULL,
  ylim = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ciu.plot_+3A_ciu">ciu</code></td>
<td>
<p><code>ciu</code> object as created with <a href="#topic+ciu">ciu</a> function (not to be confused
with <code>CIU</code> object as created by <a href="#topic+ciu.new">ciu.new</a>).</p>
</td></tr>
<tr><td><code id="ciu.plot_+3A_instance">instance</code></td>
<td>
<p>Input values for the instance to explain. Should be a
<a href="base.html#topic+data.frame">data.frame</a> even though a <code>vector</code> or <code>matrix</code> might work too if input
names and other needed metadata can be deduced from the dataset or other
parameters given to <code><a href="#topic+ciu.new">ciu.new</a></code>.</p>
</td></tr>
<tr><td><code id="ciu.plot_+3A_ind.input">ind.input</code></td>
<td>
<p>Index of input feature to plot.</p>
</td></tr>
<tr><td><code id="ciu.plot_+3A_ind.output">ind.output</code></td>
<td>
<p>Index of output to plot.</p>
</td></tr>
<tr><td><code id="ciu.plot_+3A_in.min.max.limits">in.min.max.limits</code></td>
<td>
<p><a href="base.html#topic+data.frame">data.frame</a> or <a href="base.html#topic+matrix">matrix</a> with one row per output
and two columns, where the first column indicates the minimal value and the
second column the maximal value for that output. ONLY NEEDED HERE IF not
given as parameter to <a href="#topic+ciu.new">ciu.new</a> or if the limits are different for this
specific instance than the default ones.</p>
</td></tr>
<tr><td><code id="ciu.plot_+3A_n.points">n.points</code></td>
<td>
<p>How many x,y pairs will be calculated, equally spaced over in.min.max.limits.</p>
</td></tr>
<tr><td><code id="ciu.plot_+3A_main">main</code></td>
<td>
<p>Text to use as main title.</p>
</td></tr>
<tr><td><code id="ciu.plot_+3A_xlab">xlab</code></td>
<td>
<p>Label for x-axis.</p>
</td></tr>
<tr><td><code id="ciu.plot_+3A_ylab">ylab</code></td>
<td>
<p>Label for y-axis.</p>
</td></tr>
<tr><td><code id="ciu.plot_+3A_ylim">ylim</code></td>
<td>
<p>Minimal and maximal values for y-axis.</p>
</td></tr>
<tr><td><code id="ciu.plot_+3A_...">...</code></td>
<td>
<p>See <a href="base.html#topic+plot">base::plot</a>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>&quot;void&quot;, or whatever happens to be result of last instruction.
</p>


<h3>Author(s)</h3>

<p>Kary Främling
</p>


<h3>See Also</h3>

<p><a href="base.html#topic+plot">base::plot</a> for &quot;...&quot; parameters.
</p>

<hr>
<h2 id='ciu.plot.3D'>ciu.plot.3D</h2><span id='topic+ciu.plot.3D'></span>

<h3>Description</h3>

<p>Function for 3D plotting the effect of changing values of two inputs on one output.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ciu.plot.3D(
  ciu,
  instance,
  ind.inputs,
  ind.output,
  in.min.max.limits = NULL,
  n.points = 40,
  main = NULL,
  xlab = NULL,
  ylab = NULL,
  zlab = NULL,
  zlim = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ciu.plot.3D_+3A_ciu">ciu</code></td>
<td>
<p><code>ciu</code> object as created with <a href="#topic+ciu">ciu</a> function (not to be confused
with <code>CIU</code> object as created by <a href="#topic+ciu.new">ciu.new</a>).</p>
</td></tr>
<tr><td><code id="ciu.plot.3D_+3A_instance">instance</code></td>
<td>
<p>Input values for the instance to explain. Should be a
<a href="base.html#topic+data.frame">data.frame</a> even though a <code>vector</code> or <code>matrix</code> might work too if input
names and other needed metadata can be deduced from the dataset or other
parameters given to <code><a href="#topic+ciu.new">ciu.new</a></code>.</p>
</td></tr>
<tr><td><code id="ciu.plot.3D_+3A_ind.inputs">ind.inputs</code></td>
<td>
<p>Indices of input features to plot.</p>
</td></tr>
<tr><td><code id="ciu.plot.3D_+3A_ind.output">ind.output</code></td>
<td>
<p>Index of output to plot.</p>
</td></tr>
<tr><td><code id="ciu.plot.3D_+3A_in.min.max.limits">in.min.max.limits</code></td>
<td>
<p><a href="base.html#topic+data.frame">data.frame</a> or <a href="base.html#topic+matrix">matrix</a> with one row per output
and two columns, where the first column indicates the minimal value and the
second column the maximal value for that output. ONLY NEEDED HERE IF not
given as parameter to <a href="#topic+ciu.new">ciu.new</a> or if the limits are different for this
specific instance than the default ones.</p>
</td></tr>
<tr><td><code id="ciu.plot.3D_+3A_n.points">n.points</code></td>
<td>
<p>Number of x/y-axis points to use.</p>
</td></tr>
<tr><td><code id="ciu.plot.3D_+3A_main">main</code></td>
<td>
<p>a main title for the plot, see also <code><a href="graphics.html#topic+title">title</a></code>.</p>
</td></tr>
<tr><td><code id="ciu.plot.3D_+3A_xlab">xlab</code></td>
<td>
<p>a label for the x axis, defaults to a description of <code>x</code>.</p>
</td></tr>
<tr><td><code id="ciu.plot.3D_+3A_ylab">ylab</code></td>
<td>
<p>a label for the y axis, defaults to a description of <code>y</code>.</p>
</td></tr>
<tr><td><code id="ciu.plot.3D_+3A_zlab">zlab</code></td>
<td>
<p>Label to use for Z-axis. Default: NULL.</p>
</td></tr>
<tr><td><code id="ciu.plot.3D_+3A_zlim">zlim</code></td>
<td>
<p>Limits to use for Z-axis. Default: NULL.</p>
</td></tr>
<tr><td><code id="ciu.plot.3D_+3A_...">...</code></td>
<td>
<p>other <a href="graphics.html#topic+graphical+20parameters">graphical parameters</a> (see <code><a href="graphics.html#topic+par">par</a></code> and
section &lsquo;Details&rsquo; below).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>&quot;void&quot;, or whatever happens to be result of last instruction.
</p>


<h3>Author(s)</h3>

<p>Kary Främling
</p>

<hr>
<h2 id='ciu.relative'>Calculate CIU of a sub-concept/input relative to an intermediate
concept (or output).</h2><span id='topic+ciu.relative'></span>

<h3>Description</h3>

<p>Calculate CIU of a sub-concept/input relative to an intermediate
concept (or output). The parameters must be of class &quot;ciu.result&quot; or a
<a href="base.html#topic+data.frame">data.frame</a> with compatible columns.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ciu.relative(sub.ciu.result, sup.ciu.result)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ciu.relative_+3A_sub.ciu.result">sub.ciu.result</code></td>
<td>
<p>ciu.result object of sub-concept/input.</p>
</td></tr>
<tr><td><code id="ciu.relative_+3A_sup.ciu.result">sup.ciu.result</code></td>
<td>
<p>ciu.result object of intermediate concept/output.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Kary Främling
</p>

<hr>
<h2 id='ciu.result.new'>CIU result object</h2><span id='topic+ciu.result.new'></span>

<h3>Description</h3>

<p>Create object of class <code>ciu.result</code>, which stores results of CIU
calculations. The <code>ciu$explain</code> and <a href="#topic+ciu.explain">ciu.explain</a> methods return a <code>ciu.result</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ciu.result.new(ci, cu, cmin, cmax, outval)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ciu.result.new_+3A_ci">ci</code></td>
<td>
<p>vector of CI values, one per output</p>
</td></tr>
<tr><td><code id="ciu.result.new_+3A_cu">cu</code></td>
<td>
<p>vector of CU values, one per output</p>
</td></tr>
<tr><td><code id="ciu.result.new_+3A_cmin">cmin</code></td>
<td>
<p>vector of cmin values, one per output</p>
</td></tr>
<tr><td><code id="ciu.result.new_+3A_cmax">cmax</code></td>
<td>
<p>vector of cmax values, one per output</p>
</td></tr>
<tr><td><code id="ciu.result.new_+3A_outval">outval</code></td>
<td>
<p>vector of black-box output values, one per output</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class ciu.result, which is a data.frame with
(at least) five columns:
</p>

<ul>
<li> <p><code style="white-space: pre;">&#8288;CI values&#8288;</code>: one row per output of the black-box model
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;CU values&#8288;</code>: one row per output of the black-box model
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;cmin values&#8288;</code>: one row per output of the black-box model
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;cmax values&#8288;</code>: one row per output of the black-box model
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;outval values&#8288;</code>: one row per output of the black-box model
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Kary Främling
</p>

<hr>
<h2 id='ciu.textual'>Give textual CIU explanation</h2><span id='topic+ciu.textual'></span>

<h3>Description</h3>

<p>Provide textual CIU explanations as those used in Kary Främling's
PhD thesis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ciu.textual(
  ciu,
  instance = NULL,
  ind.inputs = NULL,
  ind.output = 1,
  in.min.max.limits = NULL,
  n.samples = 100,
  neutral.CU = 0.5,
  show.input.values = TRUE,
  concepts.to.explain = NULL,
  target.concept = NULL,
  target.ciu = NULL,
  ciu.meta = NULL,
  sort = "CI",
  n.features = NULL,
  use.text.effects = FALSE,
  CI.voc = data.frame(limits = c(0.2, 0.4, 0.6, 0.8, 1), texts = c("not important",
    "slightly important", "important", "very important", "extremely important")),
  CU.voc = data.frame(limits = c(0.2, 0.4, 0.6, 0.8, 1), texts = c("very bad", "bad",
    "average", "good", "very good"))
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ciu.textual_+3A_ciu">ciu</code></td>
<td>
<p><code>ciu</code> object as created with <a href="#topic+ciu">ciu</a> function (not to be confused
with <code>CIU</code> object as created by <a href="#topic+ciu.new">ciu.new</a>).</p>
</td></tr>
<tr><td><code id="ciu.textual_+3A_instance">instance</code></td>
<td>
<p>Input values for the instance to explain. Should be a
<a href="base.html#topic+data.frame">data.frame</a> even though a <code>vector</code> or <code>matrix</code> might work too if input
names and other needed metadata can be deduced from the dataset or other
parameters given to <code><a href="#topic+ciu.new">ciu.new</a></code>.</p>
</td></tr>
<tr><td><code id="ciu.textual_+3A_ind.inputs">ind.inputs</code></td>
<td>
<p>Indices of input features to explain (the set i in CIU
formulae)</p>
</td></tr>
<tr><td><code id="ciu.textual_+3A_ind.output">ind.output</code></td>
<td>
<p>Index of output to be explained.</p>
</td></tr>
<tr><td><code id="ciu.textual_+3A_in.min.max.limits">in.min.max.limits</code></td>
<td>
<p><a href="base.html#topic+data.frame">data.frame</a> or <a href="base.html#topic+matrix">matrix</a> with one row per output
and two columns, where the first column indicates the minimal value and the
second column the maximal value for that output. ONLY NEEDED HERE IF not
given as parameter to <a href="#topic+ciu.new">ciu.new</a> or if the limits are different for this
specific instance than the default ones.</p>
</td></tr>
<tr><td><code id="ciu.textual_+3A_n.samples">n.samples</code></td>
<td>
<p>How many instances to generate for estimating CI and CU.
For inputs of type <a href="base.html#topic+factor">factor</a>, all possible combinations of input values
are generated, so this parameter only influences how many instances are
(at least) generated for continuous-valued inputs.</p>
</td></tr>
<tr><td><code id="ciu.textual_+3A_neutral.cu">neutral.CU</code></td>
<td>
<p>Indicates when the Contextual Utility is considered
to be &quot;negative&quot;. The default value of 0.5 seems quite logical for most cases.</p>
</td></tr>
<tr><td><code id="ciu.textual_+3A_show.input.values">show.input.values</code></td>
<td>
<p>Include input values after input labels or not.
Default is TRUE.</p>
</td></tr>
<tr><td><code id="ciu.textual_+3A_concepts.to.explain">concepts.to.explain</code></td>
<td>
<p>List of input feature concepts to explain, as defined
by vocabulary provided as argument to <a href="#topic+ciu.new">ciu.new</a>. If <code>ind.inputs=NULL</code>,
then use <code>concepts.to.explain</code> instead. If both are <code>NULL</code>, then use all inputs.</p>
</td></tr>
<tr><td><code id="ciu.textual_+3A_target.concept">target.concept</code></td>
<td>
<p>If provided, then calculate CIU of inputs
<code>ind.inputs.to.explain</code> relative to the given concept rather than
relative to the actual output(s). <code>ind.inputs.to.explain</code> should
normally be a subset (or all) of the inputs that <code>target.concept</code>
consists of, even though that not required by the CIU calculation.
If a <code>target.ciu</code> is provided, then the <code>target.concept</code> doesn't have to
be included in the <code>vocabulary</code> gives as parameter to <a href="#topic+ciu.new">ciu.new</a>
(at least for the moment).</p>
</td></tr>
<tr><td><code id="ciu.textual_+3A_target.ciu">target.ciu</code></td>
<td>
<p><code>ciu.result</code> object previously calculated for
<code>target.concept</code>. If a <code>target.concept</code> is provided but <code>target.ciu=NULL</code>,
then <code>target.ciu</code> is estimated by a call to <a href="#topic+ciu.explain">ciu.explain</a> with the
<code>n.samples</code> value given as a parameter to this call. It may be useful
to provide <code>target.ciu</code> if it should be estimated using some other
(typically greater) value for <code>n.samples</code> than the default one, or if it
has already been calculated for some reason.</p>
</td></tr>
<tr><td><code id="ciu.textual_+3A_ciu.meta">ciu.meta</code></td>
<td>
<p>If given, then use existing <code>ciu.meta.result</code> rather
than calling <a href="#topic+ciu.meta.explain">ciu.meta.explain</a>.</p>
</td></tr>
<tr><td><code id="ciu.textual_+3A_sort">sort</code></td>
<td>
<p>NULL, &quot;CI&quot; or &quot;CU&quot;.</p>
</td></tr>
<tr><td><code id="ciu.textual_+3A_n.features">n.features</code></td>
<td>
<p>Maximal number of features to include in explanation.</p>
</td></tr>
<tr><td><code id="ciu.textual_+3A_use.text.effects">use.text.effects</code></td>
<td>
<p>Add bold/italics/colors effects?</p>
</td></tr>
<tr><td><code id="ciu.textual_+3A_ci.voc">CI.voc</code></td>
<td>
<p>Limits and texts to use for CI values.</p>
</td></tr>
<tr><td><code id="ciu.textual_+3A_cu.voc">CU.voc</code></td>
<td>
<p>Limits and texts to use for CU values.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Text string with explanation.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Explaining the classification of an Iris instance with lda model.
# We use a versicolor (instance 100).
library(MASS)
test.ind &lt;- 100
iris_test &lt;- iris[test.ind, 1:4]
iris_train &lt;- iris[-test.ind, 1:4]
iris_lab &lt;- iris[[5]][-test.ind]
model &lt;- lda(iris_train, iris_lab)

# Create CIU object
ciu &lt;- ciu.new(model, Species~., iris)

# Give textual explanation. Use 'cat' for getting newlines to work.
cat(ciu.textual(ciu, iris_test, ind.output = 2))
cat(ciu.textual(ciu, iris_test, ind.output = 2, n.features = 2))

## Not run: 
# Boston housing, GBM model.
library(caret)
kfoldcv &lt;- trainControl(method="cv", number=10)
gbm &lt;- train(medv ~ ., Boston, method="gbm", trControl=kfoldcv)
boston.inst &lt;- Boston[370,1:13]
ciu &lt;- ciu.new(gbm, medv~., Boston)
cat(ciu.textual(ciu, boston.inst,use.text.effects = TRUE))
# Customized limits for CI.
cat(ciu.textual(ciu, boston.inst,use.text.effects = TRUE,
  CI.voc = data.frame(limits=c(0.05,0.1,0.3,0.5,1.0),
texts=c("not important","little important", "important","very important",
  "extremely important"))))

# Intermediate concepts
social&lt;-c(1,11,13); usage_type&lt;-c(2,3); chas&lt;-c(4); air_quality&lt;-c(5)
housing&lt;-c(6,7); transport&lt;-c(8,9); blacks&lt;-c(12); tax&lt;-c(10)
Boston.voc &lt;- list("SOCIAL"=social, "LAND USAGE"=usage_type, "Charles R. dummy"=chas,
"Air quality (Nox)"=air_quality, "HOUSING"=housing, "TRANSPORT"=transport,
"Prop. of black people"=blacks, "Tax"=tax)
ciu &lt;- ciu.new(gbm, medv~., Boston, vocabulary = Boston.voc)

# We use `meta.explain` here to avoid differences due to sampling.
meta.top &lt;- ciu$meta.explain(boston.inst, concepts.to.explain=names(Boston.voc))
cat(ciu.textual(ciu, boston.inst, use.text.effects = TRUE, ciu.meta = meta.top))

# Explain intermediate concept utility, using input features (could also
# be using other intermediate concepts).
cat(ciu.textual(ciu, boston.inst, use.text.effects = TRUE, ind.inputs = Boston.voc$SOCIAL,
  target.concept = "SOCIAL", target.ciu = meta.top$ciuvals[["SOCIAL"]]))
cat(ciu.textual(ciu, boston.inst, use.text.effects = TRUE, ind.inputs = Boston.voc$HOUSING,
  target.concept = "HOUSING", target.ciu = meta.top$ciuvals[["HOUSING"]]))

## End(Not run)
</code></pre>

<hr>
<h2 id='ciu.to.CIU'>Create <code>CIU</code> object from <code>ciu</code> object.</h2><span id='topic+ciu.to.CIU'></span>

<h3>Description</h3>

<p>A <code>CIU</code> object is an &quot;object-oriented programming&quot; object, i.e. it has its
own environment, private variables and methods etc. A <code>CIU</code> object is created
using <a href="#topic+ciu.new">ciu.new</a> like <code>ciu_obj &lt;- ciu.new(...)</code> and the object's methods
are then called as <code>ciu_obj$method(...)</code>. This approach has numerous advantages
but CIU objects consume much more memory than &quot;ordinary&quot; R data structures.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ciu.to.CIU(ciu)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ciu.to.CIU_+3A_ciu">ciu</code></td>
<td>
<p><code>ciu</code> object.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A <code>ciu</code> object is simply a <a href="base.html#topic+list">list</a> that contains all the &quot;object variables&quot; of
a <code>CIU</code> object, which is the reason why CIU &lt;-&gt; ciu conversions can be done at
any time. CIU -&gt; ciu conversion doesn't have any overhead but ciu -&gt; CIU does
require overhead due to the environment setup etc. Therefore, it is advisable
to avoid unnecessary CIU -&gt; ciu conversions.
</p>
<p><code>ciu</code> objects are very memory-efficient because they are ordinary <a href="base.html#topic+list">list</a> objects
(however, make sure that ciu$CIU element's value is NULL). <code>ciu</code> objects also
give direct access to all the object variables that are private in a <code>CIU</code> object.
</p>
<p>However, using <code>ciu</code> objects means that they have to be passed as a parameter
to all functions that use them. The advantages of object oriented programming
are of course lost too.
</p>


<h3>Value</h3>

<p>CIU object
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
