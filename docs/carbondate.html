<!DOCTYPE html><html lang="en"><head><title>Help for package carbondate</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {carbondate}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#alces'><p>Example real-life data - Alces in Yukon and Alaska</p></a></li>
<li><a href='#armit'><p>Example real-life data - Population Decline in Iron Age Ireland</p></a></li>
<li><a href='#bison'><p>Example real-life data - Bison in Yukon and Alaska</p></a></li>
<li><a href='#buchanan'><p>Example real-life data - Palaeo-Indian demography</p></a></li>
<li><a href='#CalibrateSingleDetermination'><p>Calibrate a Single Radiocarbon Determination</p></a></li>
<li><a href='#cervus'><p>Example real-life data - Cervus in Yukon and Alaska</p></a></li>
<li><a href='#equus'><p>Example real-life data - Equus in Yukon and Alaska</p></a></li>
<li><a href='#FindPosteriorMeanRate'><p>Find Posterior Mean Rate of Sample Occurrence for Poisson Process Model</p></a></li>
<li><a href='#FindPredictiveCalendarAgeDensity'><p>Find Predictive Estimate of Shared Calendar Age Density from Bayesian Non-Parametric</p>
DPMM Output</a></li>
<li><a href='#FindSummedProbabilityDistribution'><p>Find the summed probability distribution (SPD) for a set of radiocarbon observations</p></a></li>
<li><a href='#GenerateOxcalCode'><p>Outputs code suitable for running in OxCal from a series of radiocarbon determinations</p></a></li>
<li><a href='#human'><p>Example real-life data - Humans in Yukon and Alaska</p></a></li>
<li><a href='#intcal04'><p>IntCal04 calibration curve</p></a></li>
<li><a href='#intcal09'><p>IntCal09 calibration curve</p></a></li>
<li><a href='#intcal13'><p>IntCal13 calibration curve</p></a></li>
<li><a href='#intcal20'><p>IntCal20 calibration curve</p></a></li>
<li><a href='#intcal98'><p>IntCal98 calibration curve</p></a></li>
<li><a href='#InterpolateCalibrationCurve'><p>Interpolate a calibration curve at a set of calendar ages</p></a></li>
<li><a href='#kerr'><p>Example real-life data - Irish Rath</p></a></li>
<li><a href='#mammuthus'><p>Example real-life data - Mammuthus in Yukon and Alaska</p></a></li>
<li><a href='#PlotCalendarAgeDensityIndividualSample'><p>Plot Posterior Calendar Age Estimate for an Individual Determination after Joint Calibration</p></a></li>
<li><a href='#PlotConvergenceData'><p>Plot KL Divergence of Predictive Density to Assess</p>
Convergence of Bayesian Non-Parametric DPMM Sampler</a></li>
<li><a href='#PlotGelmanRubinDiagnosticMultiChain'><p>Plot Histogram of the Gelman-Rubin Convergence Diagnostic for Multiple Independent</p>
MCMC Chains</a></li>
<li><a href='#PlotGelmanRubinDiagnosticSingleChain'><p>Plot Histogram of the Gelman-Rubin Convergence Diagnostic for a Single MCMC Chain</p></a></li>
<li><a href='#PlotNumberOfClusters'><p>Plot Number of Calendar Age Clusters Estimated</p>
in Bayesian Non-Parametric DPMM Output</a></li>
<li><a href='#PlotNumberOfInternalChanges'><p>Plot Number of Changepoints in Rate of Sample Occurrence for Poisson Process Model</p></a></li>
<li><a href='#PlotPosteriorChangePoints'><p>Plot Calendar Ages of Changes in Rate of Sample Occurrence for Poisson Process Model</p></a></li>
<li><a href='#PlotPosteriorHeights'><p>Plot Heights of Segments in Rate of Sample Occurrence for Poisson Process Model</p></a></li>
<li><a href='#PlotPosteriorMeanRate'><p>Plot Posterior Mean Rate of Sample Occurrence for Poisson Process Model</p></a></li>
<li><a href='#PlotPredictiveCalendarAgeDensity'><p>Plot Predictive Estimate of Shared Calendar Age Density from Bayesian Non-Parametric</p>
DPMM Output</a></li>
<li><a href='#PolyaUrnBivarDirichlet'><p>Calibrate and Summarise Multiple Radiocarbon Samples via</p>
a Bayesian Non-Parametric DPMM (with Polya Urn Updating)</a></li>
<li><a href='#pp_uniform_phase'><p>Example artificial data - Uniform Phase</p></a></li>
<li><a href='#PPcalibrate'><p>Model Occurrence of Multiple Radiocarbon Samples as a</p>
Variable-Rate Poisson Process</a></li>
<li><a href='#shcal04'><p>SHCal04 calibration curve</p></a></li>
<li><a href='#shcal13'><p>SHCal13 calibration curve</p></a></li>
<li><a href='#shcal20'><p>SHCal20 calibration curve</p></a></li>
<li><a href='#two_normals'><p>Example artificial data - Mixture of Normal Phases</p></a></li>
<li><a href='#WalkerBivarDirichlet'><p>Calibrate and Summarise Multiple Radiocarbon Samples via</p>
a Bayesian Non-Parametric DPMM (with Walker Updating)</a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Calibration and Summarisation of Radiocarbon Dates</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.1</td>
</tr>
<tr>
<td>Description:</td>
<td>
  Performs Bayesian non-parametric calibration of multiple related radiocarbon determinations, and summarises the calendar age information to plot their joint calendar age density (see Heaton (2022) &lt;<a href="https://doi.org/10.1111%2Frssc.12599">doi:10.1111/rssc.12599</a>&gt;). 
  Also models the occurrence of radiocarbon samples as a variable-rate (inhomogeneous) Poisson process, plotting the posterior estimate for the occurrence rate of the samples over calendar time, and providing information about potential change points.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>graphics, grDevices, stats, utils</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/TJHeaton/carbondate">https://github.com/TJHeaton/carbondate</a>,
<a href="https://tjheaton.github.io/carbondate/">https://tjheaton.github.io/carbondate/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/TJHeaton/carbondate/issues">https://github.com/TJHeaton/carbondate/issues</a></td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>cpp11</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-01-29 15:40:58 UTC; timjh</td>
</tr>
<tr>
<td>Author:</td>
<td>Timothy J Heaton <a href="https://orcid.org/0000-0002-9994-142X"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre, cph],
  Sara Al-assam <a href="https://orcid.org/0000-0001-7280-6802"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Timothy J Heaton &lt;T.Heaton@leeds.ac.uk&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-01-31 19:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='alces'>Example real-life data - Alces in Yukon and Alaska</h2><span id='topic+alces'></span>

<h3>Description</h3>

<p>58 radiocarbon determinations collated by Dale Guthrie, R. related to
Alces (moose) in Yukon and Alaska. Samples
are restricted to those between 25,000&ndash;6000 <code class="reqn">{}^{14}</code>C yrs BP. <br /> <br />
<strong>Reference:</strong> <br />
Dale Guthrie, R. New carbon dates link climatic change with human colonization
and Pleistocene extinctions. <em>Nature</em> <strong>441</strong>, 207&ndash;209 (2006).
https://doi.org/10.1038/nature04604
</p>


<h3>Usage</h3>

<pre><code class='language-R'>alces
</code></pre>


<h3>Format</h3>



<h4><code>alces</code></h4>

<p>A data frame with 58 rows and 7 columns:
</p>

<dl>
<dt>lab_code</dt><dd><p>The sample code for the <code class="reqn">{}^{14}</code>C laboratory</p>
</dd>
<dt>site_code</dt><dd><p>The site/museum code</p>
</dd>
<dt>location</dt><dd><p>The location of the sample</p>
</dd>
<dt>c14_age</dt><dd><p>The observed <code class="reqn">{}^{14}</code>C ages of the samples (in <code class="reqn">{}^{14}</code>C yr BP)</p>
</dd>
<dt>c14_sig</dt><dd><p>The uncertainty in the observed <code class="reqn">{}^{14}</code>C ages reported by the radiocarbon laboratory</p>
</dd>
<dt>f14c</dt><dd><p>The observed F<code class="reqn">{}^{14}</code>C concentrations</p>
</dd>
<dt>f14c_sig</dt><dd><p>The uncertainty in the observed F<code class="reqn">{}^{14}</code>C concentrations reported by the radiocarbon laboratory</p>
</dd>
</dl>




<h3>Source</h3>

<p>https://doi.org/10.1038/nature04604
</p>

<hr>
<h2 id='armit'>Example real-life data - Population Decline in Iron Age Ireland</h2><span id='topic+armit'></span>

<h3>Description</h3>

<p>2021 radiocarbon determinations collated by Armit et al. from archaeological
groups operating in Ireland, to investigate whether a wetter environment
around 2700 cal yr BP led to a population collapse. <br /> <br />
<strong>Reference:</strong> <br />
Armit, I., Swindles, G.T., Becker, K., Plunkett, G., Blaauw, M., 2014. Rapid
climate change did not cause population collapse at the end of the European
Bronze Age. <em>Proceedings of the National Academy
of Sciences</em> <strong>111</strong>, 17045&ndash;17049.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>armit
</code></pre>


<h3>Format</h3>



<h4><code>armit</code></h4>

<p>A data frame with 2021 rows and 4 columns:
</p>

<dl>
<dt>c14_age</dt><dd><p>The observed <code class="reqn">{}^{14}</code>C ages of the samples (in <code class="reqn">{}^{14}</code>C yr BP)</p>
</dd>
<dt>c14_sig</dt><dd><p>The uncertainty in the observed <code class="reqn">{}^{14}</code>C ages reported by the radiocarbon laboratory</p>
</dd>
<dt>f14c</dt><dd><p>The observed F<code class="reqn">{}^{14}</code>C concentrations</p>
</dd>
<dt>f14c_sig</dt><dd><p>The uncertainty in the observed F<code class="reqn">{}^{14}</code>C concentrations reported by the radiocarbon laboratory</p>
</dd>
</dl>




<h3>Source</h3>

<p>http://doi.org/10.1073/pnas.1408028111
</p>

<hr>
<h2 id='bison'>Example real-life data - Bison in Yukon and Alaska</h2><span id='topic+bison'></span>

<h3>Description</h3>

<p>64 radiocarbon determinations collated by Dale Guthrie, R. related to
Bison in Yukon and Alaska. Samples
are restricted to those between 25,000&ndash;6000 <code class="reqn">{}^{14}</code>C yrs BP.<br /> <br />
<strong>Reference:</strong> <br />
Dale Guthrie, R. New carbon dates link climatic change with human colonization
and Pleistocene extinctions. <em>Nature</em> <strong>441</strong>, 207&ndash;209 (2006).
https://doi.org/10.1038/nature04604
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bison
</code></pre>


<h3>Format</h3>



<h4><code>bison</code></h4>

<p>A data frame with 64 rows and 7 columns:
</p>

<dl>
<dt>lab_code</dt><dd><p>The sample code for the <code class="reqn">{}^{14}</code>C laboratory</p>
</dd>
<dt>site_code</dt><dd><p>The site/museum code</p>
</dd>
<dt>location</dt><dd><p>The location of the sample</p>
</dd>
<dt>c14_age</dt><dd><p>The observed <code class="reqn">{}^{14}</code>C ages of the samples (in <code class="reqn">{}^{14}</code>C yr BP)</p>
</dd>
<dt>c14_sig</dt><dd><p>The uncertainty in the observed <code class="reqn">{}^{14}</code>C ages reported by the radiocarbon laboratory</p>
</dd>
<dt>f14c</dt><dd><p>The observed F<code class="reqn">{}^{14}</code>C concentrations</p>
</dd>
<dt>f14c_sig</dt><dd><p>The uncertainty in the observed F<code class="reqn">{}^{14}</code>C concentrations reported by the radiocarbon laboratory</p>
</dd>
</dl>




<h3>Source</h3>

<p>https://doi.org/10.1038/nature04604
</p>

<hr>
<h2 id='buchanan'>Example real-life data - Palaeo-Indian demography</h2><span id='topic+buchanan'></span>

<h3>Description</h3>

<p>628 radiocarbon determinations collated by Buchanan et al. representing the
ages of distinct archaeological  sites found across Canada and North America
during the time of the palaeoindians. <br /> <br />
<strong>Reference:</strong> <br />
Buchanan, B., Collard, M., Edinborough, K., 2008. Paleoindian demography and
the extraterrestrial impact hypothesis. <em>Proceedings of the National Academy
of Sciences</em> <strong>105</strong>, 11651&ndash;11654.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>buchanan
</code></pre>


<h3>Format</h3>



<h4><code>buchanan</code></h4>

<p>A data frame with 628 rows and 4 columns:
</p>

<dl>
<dt>c14_age</dt><dd><p>The observed <code class="reqn">{}^{14}</code>C ages of the samples (in <code class="reqn">{}^{14}</code>C yr BP)</p>
</dd>
<dt>c14_sig</dt><dd><p>The uncertainty in the observed <code class="reqn">{}^{14}</code>C ages reported by the radiocarbon laboratory</p>
</dd>
<dt>f14c</dt><dd><p>The observed F<code class="reqn">{}^{14}</code>C concentrations</p>
</dd>
<dt>f14c_sig</dt><dd><p>The uncertainty in the observed F<code class="reqn">{}^{14}</code>C concentrations reported by the radiocarbon laboratory</p>
</dd>
</dl>




<h3>Source</h3>

<p>http://doi.org/10.1073/pnas.0803762105
</p>

<hr>
<h2 id='CalibrateSingleDetermination'>Calibrate a Single Radiocarbon Determination</h2><span id='topic+CalibrateSingleDetermination'></span>

<h3>Description</h3>

<p>Uses the supplied calibration curve to calibrate a single radiocarbon
determination and uncertainty (expressed either in terms of radiocarbon age, or
as an F<code class="reqn">{}^{14}</code>C concentration) and obtain its calendar age probability
density estimate.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CalibrateSingleDetermination(
  rc_determination,
  rc_sigma,
  calibration_curve,
  F14C_inputs = FALSE,
  resolution = 1,
  plot_output = FALSE,
  plot_cal_age_scale = "BP",
  interval_width = "2sigma",
  bespoke_probability = NA,
  denscale = 3,
  plot_pretty = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="CalibrateSingleDetermination_+3A_rc_determination">rc_determination</code></td>
<td>
<p>A single observed radiocarbon determination
provided either as the radiocarbon age (in <code class="reqn">{}^{14}</code>C yr BP) or the F<code class="reqn">{}^{14}</code>C concentration.</p>
</td></tr>
<tr><td><code id="CalibrateSingleDetermination_+3A_rc_sigma">rc_sigma</code></td>
<td>
<p>The corresponding measurement uncertainty of the radiocarbon determination
(must be in the same units as above, i.e., reported as <code class="reqn">{}^{14}</code>C age or F<code class="reqn">{}^{14}</code>C)</p>
</td></tr>
<tr><td><code id="CalibrateSingleDetermination_+3A_calibration_curve">calibration_curve</code></td>
<td>
<p>A dataframe which must contain one column <code>calendar_age_BP</code>, and also
columns <code>c14_age</code> and <code>c14_sig</code> or <code>f14c</code> and <code>f14c_sig</code> (or both sets).
This format matches the curves supplied with this package, e.g., <a href="#topic+intcal20">intcal20</a>,
<a href="#topic+intcal13">intcal13</a>, which contain all 5 columns.</p>
</td></tr>
<tr><td><code id="CalibrateSingleDetermination_+3A_f14c_inputs">F14C_inputs</code></td>
<td>
<p><code>TRUE</code> if the provided <code>rc_determination</code> is an F<code class="reqn">{}^{14}</code>C
concentration and <code>FALSE</code> if it is a radiocarbon age. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="CalibrateSingleDetermination_+3A_resolution">resolution</code></td>
<td>
<p>The distance between the calendar ages at which to calculate the calendar age probability.
Default is 1.</p>
</td></tr>
<tr><td><code id="CalibrateSingleDetermination_+3A_plot_output">plot_output</code></td>
<td>
<p><code>TRUE</code> if you wish to plot the determination, the calibration curve,
and the posterior calibrated age estimate on the same plot. Defaults to <code>FALSE</code></p>
</td></tr>
<tr><td><code id="CalibrateSingleDetermination_+3A_plot_cal_age_scale">plot_cal_age_scale</code></td>
<td>
<p>Only for usage when <code>plot_output = TRUE</code>.
The calendar scale to use for the x-axis. Allowed values are &quot;BP&quot;, &quot;AD&quot; and &quot;BC&quot;. The default
is &quot;BP&quot;, corresponding to plotting in cal yr BP.</p>
</td></tr>
<tr><td><code id="CalibrateSingleDetermination_+3A_interval_width">interval_width</code></td>
<td>
<p>Only for usage when <code>plot_output = TRUE</code>. The confidence intervals to show for the
calibration curve and for the highest posterior density ranges.
Choose from one of &quot;1sigma&quot; (68.3%), &quot;2sigma&quot; (95.4%) and &quot;bespoke&quot;. Default is &quot;2sigma&quot;.</p>
</td></tr>
<tr><td><code id="CalibrateSingleDetermination_+3A_bespoke_probability">bespoke_probability</code></td>
<td>
<p>The probability to use for the confidence interval
if &quot;bespoke&quot; is chosen above. E.g. if 0.95 is chosen, then the 95% confidence
interval is calculated. Ignored if &quot;bespoke&quot; is not chosen.</p>
</td></tr>
<tr><td><code id="CalibrateSingleDetermination_+3A_denscale">denscale</code></td>
<td>
<p>Whether to scale the vertical range of the calendar age density plot
relative to the calibration curve plot (optional). Default is 3 which means
that the maximum calendar age density will be at 1/3 of the height of the plot.</p>
</td></tr>
<tr><td><code id="CalibrateSingleDetermination_+3A_plot_pretty">plot_pretty</code></td>
<td>
<p>logical, defaulting to <code>TRUE</code>. If set <code>TRUE</code> then will select pretty plotting
margins (that create sufficient space for axis titles and rotates y-axis labels). If <code>FALSE</code> will
implement current user values.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with one column <code>calendar_age_BP</code> containing the calendar
ages, and the other column <code>probability</code> containing the probability at that
calendar age.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Calibration of a single determination expressed as 14C age BP
calib &lt;- CalibrateSingleDetermination(860, 35, intcal20)
plot(calib, type = "l", xlim = c(1000, 600))

# Incorporating an automated plot to visualise the calibration
CalibrateSingleDetermination(860, 35, intcal20, plot_output = TRUE)

# Calibration of a single (old) determination expressed as 14C age BP
calib &lt;- CalibrateSingleDetermination(31020, 100, intcal20)
plot(calib, type = "l", xlim = c(36500, 34500))

# Calibration of a single (old) determination expressed as F14C concentration
calib &lt;- CalibrateSingleDetermination(
    0.02103493, 0.0002618564, intcal20, F14C_inputs = TRUE)
plot(calib, type = "l", xlim = c(36500, 34500))

# Calibration of a single determination expressed as 14C age BP
# against SHCal20 (and creating an automated plot)
CalibrateSingleDetermination(1413, 25, shcal20, plot_output = TRUE)

# Implementing a bespoke confidence interval level and plot in AD
CalibrateSingleDetermination(
    1413,
    25,
    shcal20,
    plot_output = TRUE,
    plot_cal_age_scale = "AD",
    interval_width = "bespoke",
    bespoke_probability = 0.8)

# Changing denscale (so the calendar age density takes up less space)
CalibrateSingleDetermination(
    1413,
    25,
    shcal20,
    plot_output = TRUE,
    interval_width = "bespoke",
    bespoke_probability = 0.8,
    denscale = 5)
</code></pre>

<hr>
<h2 id='cervus'>Example real-life data - Cervus in Yukon and Alaska</h2><span id='topic+cervus'></span>

<h3>Description</h3>

<p>63 radiocarbon determinations collated by Dale Guthrie, R. related to
Cervus (wapiti) in Yukon and Alaska. Samples
are restricted to those between 25,000&ndash;6000 <code class="reqn">{}^{14}</code>C yrs BP. <br /> <br />
<strong>Reference:</strong> <br />
Dale Guthrie, R. New carbon dates link climatic change with human colonization
and Pleistocene extinctions. <em>Nature</em> <strong>441</strong>, 207&ndash;209 (2006).
https://doi.org/10.1038/nature04604
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cervus
</code></pre>


<h3>Format</h3>



<h4><code>cervus</code></h4>

<p>A data frame with 63 rows and 7 columns:
</p>

<dl>
<dt>lab_code</dt><dd><p>The sample code for the <code class="reqn">{}^{14}</code>C laboratory</p>
</dd>
<dt>site_code</dt><dd><p>The site/museum code</p>
</dd>
<dt>location</dt><dd><p>The location of the sample</p>
</dd>
<dt>c14_age</dt><dd><p>The observed <code class="reqn">{}^{14}</code>C ages of the samples (in <code class="reqn">{}^{14}</code>C yr BP)</p>
</dd>
<dt>c14_sig</dt><dd><p>The uncertainty in the observed <code class="reqn">{}^{14}</code>C ages reported by the radiocarbon laboratory</p>
</dd>
<dt>f14c</dt><dd><p>The observed F<code class="reqn">{}^{14}</code>C concentrations</p>
</dd>
<dt>f14c_sig</dt><dd><p>The uncertainty in the observed F<code class="reqn">{}^{14}</code>C concentrations reported by the radiocarbon laboratory</p>
</dd>
</dl>




<h3>Source</h3>

<p>https://doi.org/10.1038/nature04604
</p>

<hr>
<h2 id='equus'>Example real-life data - Equus in Yukon and Alaska</h2><span id='topic+equus'></span>

<h3>Description</h3>

<p>84 radiocarbon determinations collated by Dale Guthrie, R. related to
Equus (horse) in Yukon and Alaska. Samples
are restricted to those between 25,000&ndash;6000 <code class="reqn">{}^{14}</code>C yrs BP. <br /> <br />
<strong>Reference:</strong> <br />
Dale Guthrie, R. New carbon dates link climatic change with human colonization
and Pleistocene extinctions. <em>Nature</em> <strong>441</strong>, 207&ndash;209 (2006).
https://doi.org/10.1038/nature04604
</p>


<h3>Usage</h3>

<pre><code class='language-R'>equus
</code></pre>


<h3>Format</h3>



<h4><code>equus</code></h4>

<p>A data frame with 84 rows and 7 columns:
</p>

<dl>
<dt>lab_code</dt><dd><p>The sample code for the <code class="reqn">{}^{14}</code>C laboratory</p>
</dd>
<dt>site_code</dt><dd><p>The site/museum code</p>
</dd>
<dt>location</dt><dd><p>The location of the sample</p>
</dd>
<dt>c14_age</dt><dd><p>The observed <code class="reqn">{}^{14}</code>C ages of the samples (in <code class="reqn">{}^{14}</code>C yr BP)</p>
</dd>
<dt>c14_sig</dt><dd><p>The uncertainty in the observed <code class="reqn">{}^{14}</code>C ages reported by the radiocarbon laboratory</p>
</dd>
<dt>f14c</dt><dd><p>The observed F<code class="reqn">{}^{14}</code>C concentrations</p>
</dd>
<dt>f14c_sig</dt><dd><p>The uncertainty in the observed F<code class="reqn">{}^{14}</code>C concentrations reported by the radiocarbon laboratory</p>
</dd>
</dl>




<h3>Source</h3>

<p>https://doi.org/10.1038/nature04604
</p>

<hr>
<h2 id='FindPosteriorMeanRate'>Find Posterior Mean Rate of Sample Occurrence for Poisson Process Model</h2><span id='topic+FindPosteriorMeanRate'></span>

<h3>Description</h3>

<p>Given output from the Poisson process fitting function <a href="#topic+PPcalibrate">PPcalibrate</a> calculate
the posterior mean rate of sample occurrence (i.e., the underlying Poisson process
rate <code class="reqn">\lambda(t)</code>) together with specified probability intervals, on a given calendar age
grid (provided in cal yr BP).
</p>
<p><strong>Note:</strong> If you want to calculate and plot the result, use
<a href="#topic+PlotPosteriorMeanRate">PlotPosteriorMeanRate</a> instead.
</p>
<p>For more information read the vignette: <br />
<code>vignette("Poisson-process-modelling", package = "carbondate")</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>FindPosteriorMeanRate(
  output_data,
  calendar_age_sequence,
  n_posterior_samples = 5000,
  interval_width = "2sigma",
  bespoke_probability = NA,
  n_burn = NA,
  n_end = NA
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="FindPosteriorMeanRate_+3A_output_data">output_data</code></td>
<td>
<p>The return value from the updating function
<a href="#topic+PPcalibrate">PPcalibrate</a>. Optionally, the output data can have an extra list item
named <code>label</code> which is used to set the label on the plot legend.</p>
</td></tr>
<tr><td><code id="FindPosteriorMeanRate_+3A_calendar_age_sequence">calendar_age_sequence</code></td>
<td>
<p>A vector containing the calendar age grid (in cal yr BP) on which to
calculate the posterior mean rate.</p>
</td></tr>
<tr><td><code id="FindPosteriorMeanRate_+3A_n_posterior_samples">n_posterior_samples</code></td>
<td>
<p>Number of samples it will draw, after having removed <code>n_burn</code>,
from the (thinned) MCMC realisations stored in <code>output_data</code> to estimate the
rate <code class="reqn">\lambda(t)</code>. These samples may be repeats if the number of, post burn-in,
realisations is less than <code>n_posterior_samples</code>. If not given, 5000 is used.</p>
</td></tr>
<tr><td><code id="FindPosteriorMeanRate_+3A_interval_width">interval_width</code></td>
<td>
<p>The confidence intervals to show for both the
calibration curve and the predictive density. Choose from one of <code>"1sigma"</code> (68.3%),
<code>"2sigma"</code> (95.4%) and <code>"bespoke"</code>. Default is <code>"2sigma"</code>.</p>
</td></tr>
<tr><td><code id="FindPosteriorMeanRate_+3A_bespoke_probability">bespoke_probability</code></td>
<td>
<p>The probability to use for the confidence interval
if <code>"bespoke"</code> is chosen above. E.g., if 0.95 is chosen, then the 95% confidence
interval is calculated. Ignored if <code>"bespoke"</code> is not chosen.</p>
</td></tr>
<tr><td><code id="FindPosteriorMeanRate_+3A_n_burn">n_burn</code></td>
<td>
<p>The number of MCMC iterations that should be discarded as burn-in (i.e.,
considered to be occurring before the MCMC has converged). This relates to the number
of iterations (<code>n_iter</code>) when running the original update functions (not the thinned <code>output_data</code>).
Any MCMC iterations before this are not used in the calculations. If not given, the first half of the
MCMC chain is discarded. Note: The maximum value that the function
will allow is <code>n_iter - 100 * n_thin</code> (where <code>n_iter</code> and <code>n_thin</code> are the arguments that were given to
<a href="#topic+PPcalibrate">PPcalibrate</a>) which would leave only 100 of the (thinned) values in <code>output_data</code>.</p>
</td></tr>
<tr><td><code id="FindPosteriorMeanRate_+3A_n_end">n_end</code></td>
<td>
<p>The last iteration in the original MCMC chain to use in the calculations. Assumed to be the
total number of iterations performed, i.e. <code>n_iter</code>, if not given.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list, each item containing a data frame of the <code>calendar_age_BP</code>, the <code>rate_mean</code>
and the confidence intervals for the rate - <code>rate_ci_lower</code> and <code>rate_ci_upper</code>.
</p>


<h3>See Also</h3>

<p><a href="#topic+PlotPosteriorMeanRate">PlotPosteriorMeanRate</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># NOTE: All these examples are shown with a small n_iter and n_posterior_samples
# to speed up execution.
# Try n_iter and n_posterior_samples as the function defaults.

pp_output &lt;- PPcalibrate(
    pp_uniform_phase$c14_age,
    pp_uniform_phase$c14_sig,
    intcal20,
    n_iter = 1000,
    show_progress = FALSE)

# Default plot with 2 sigma interval
FindPosteriorMeanRate(pp_output, seq(450, 640, length=10), n_posterior_samples = 100)
</code></pre>

<hr>
<h2 id='FindPredictiveCalendarAgeDensity'>Find Predictive Estimate of Shared Calendar Age Density from Bayesian Non-Parametric
DPMM Output</h2><span id='topic+FindPredictiveCalendarAgeDensity'></span>

<h3>Description</h3>

<p>Given output from one of the Bayesian non-parametric summarisation functions (either
<a href="#topic+PolyaUrnBivarDirichlet">PolyaUrnBivarDirichlet</a> or <a href="#topic+WalkerBivarDirichlet">WalkerBivarDirichlet</a>) calculate the
predictive (summarised/shared) calendar age density and probability intervals
on a given calendar age grid (provided in cal yr BP).
</p>
<p><strong>Note:</strong> If you want to calculate and plot the result, use
<a href="#topic+PlotPredictiveCalendarAgeDensity">PlotPredictiveCalendarAgeDensity</a> instead.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>FindPredictiveCalendarAgeDensity(
  output_data,
  calendar_age_sequence,
  n_posterior_samples = 5000,
  interval_width = "2sigma",
  bespoke_probability = NA,
  n_burn = NA,
  n_end = NA
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="FindPredictiveCalendarAgeDensity_+3A_output_data">output_data</code></td>
<td>
<p>The return value from one of the Bayesian non-parametric DPMM functions, e.g.
<a href="#topic+PolyaUrnBivarDirichlet">PolyaUrnBivarDirichlet</a> or
<a href="#topic+WalkerBivarDirichlet">WalkerBivarDirichlet</a>, or a list, each item containing
one of these return values. Optionally, the output data can have an extra list item
named <code>label</code> which is used to set the label on the plot legend.</p>
</td></tr>
<tr><td><code id="FindPredictiveCalendarAgeDensity_+3A_calendar_age_sequence">calendar_age_sequence</code></td>
<td>
<p>A vector containing the calendar age grid (in cal yr BP) on which to
calculate the predictive (summarised/shared) density.</p>
</td></tr>
<tr><td><code id="FindPredictiveCalendarAgeDensity_+3A_n_posterior_samples">n_posterior_samples</code></td>
<td>
<p>Number of samples it will draw, after having removed <code>n_burn</code>,
from the (thinned) realisations stored in the DPMM outputs to estimate the
predictive calendar age density. These samples may be repeats if the number of, post burn-in,
realisations is less than <code>n_posterior_samples</code>. If not given, 5000 is used.</p>
</td></tr>
<tr><td><code id="FindPredictiveCalendarAgeDensity_+3A_interval_width">interval_width</code></td>
<td>
<p>The confidence intervals to show for both the
calibration curve and the predictive density. Choose from one of <code>"1sigma"</code> (68.3%),
<code>"2sigma"</code> (95.4%) and <code>"bespoke"</code>. Default is <code>"2sigma"</code>.</p>
</td></tr>
<tr><td><code id="FindPredictiveCalendarAgeDensity_+3A_bespoke_probability">bespoke_probability</code></td>
<td>
<p>The probability to use for the confidence interval
if <code>"bespoke"</code> is chosen above. E.g., if 0.95 is chosen, then the 95% confidence
interval is calculated. Ignored if <code>"bespoke"</code> is not chosen.</p>
</td></tr>
<tr><td><code id="FindPredictiveCalendarAgeDensity_+3A_n_burn">n_burn</code></td>
<td>
<p>The number of MCMC iterations that should be discarded as burn-in (i.e.,
considered to be occurring before the MCMC has converged). This relates to the number
of iterations (<code>n_iter</code>) when running the original update functions (not the thinned <code>output_data</code>).
Any MCMC iterations before this are not used in the calculations. If not given, the first half of
the MCMC chain is discarded. Note: The maximum value that the function will allow is
<code>n_iter - 100 * n_thin</code> (where <code>n_iter</code> and <code>n_thin</code> are the arguments given to
<a href="#topic+PolyaUrnBivarDirichlet">PolyaUrnBivarDirichlet</a> or <a href="#topic+WalkerBivarDirichlet">WalkerBivarDirichlet</a>)
which would leave only 100 of the (thinned) values in <code>output_data</code>.</p>
</td></tr>
<tr><td><code id="FindPredictiveCalendarAgeDensity_+3A_n_end">n_end</code></td>
<td>
<p>The last iteration in the original MCMC chain to use in the calculations. Assumed to be the
total number of iterations performed, i.e. <code>n_iter</code>, if not given.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame of the <code>calendar_age_BP</code>, the
<code>density_mean</code> and the confidence intervals for the density
<code>density_ci_lower</code> and <code>density_ci_upper</code>.
</p>


<h3>See Also</h3>

<p><a href="#topic+PlotPredictiveCalendarAgeDensity">PlotPredictiveCalendarAgeDensity</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># NOTE: All these examples are shown with a small n_iter and n_posterior_samples
# to speed up execution.
# Try n_iter and n_posterior_samples as the function defaults.

# First generate output data
polya_urn_output &lt;- PolyaUrnBivarDirichlet(
    two_normals$c14_age,
    two_normals$c14_sig,
    intcal20,
    n_iter = 100,
    show_progress = FALSE)

# Find results for example output, 2-sigma confidence interval (default)
FindPredictiveCalendarAgeDensity(
    polya_urn_output, seq(3600, 4700, length=12), n_posterior_samples = 500)
</code></pre>

<hr>
<h2 id='FindSummedProbabilityDistribution'>Find the summed probability distribution (SPD) for a set of radiocarbon observations</h2><span id='topic+FindSummedProbabilityDistribution'></span>

<h3>Description</h3>

<p>Takes a set of radiocarbon determinations and uncertainties, independently
calibrates each one, and then averages the resultant calendar age estimates
to give the SPD estimate. <br /> <br />
<strong>Important:</strong> This function should not be used for inference as SPDs are not statistically rigorous.
Instead use either of:
</p>

<ul>
<li><p> the Bayesian non-parametric summarisation approaches <a href="#topic+PolyaUrnBivarDirichlet">PolyaUrnBivarDirichlet</a>
or <a href="#topic+WalkerBivarDirichlet">WalkerBivarDirichlet</a>;
</p>
</li>
<li><p> or the Poisson process rate approach <a href="#topic+PPcalibrate">PPcalibrate</a>
</p>
</li></ul>

<p>The SPD function provided here is only intended for comparison. We provide a inbuilt plotting option to show the SPD alongside the
determinations and the calibration curve. <br /> <br />
</p>


<h3>Usage</h3>

<pre><code class='language-R'>FindSummedProbabilityDistribution(
  calendar_age_range_BP,
  rc_determinations,
  rc_sigmas,
  calibration_curve,
  F14C_inputs = FALSE,
  resolution = 1,
  plot_output = FALSE,
  plot_cal_age_scale = "BP",
  interval_width = "2sigma",
  bespoke_probability = NA,
  denscale = 3,
  plot_pretty = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="FindSummedProbabilityDistribution_+3A_calendar_age_range_bp">calendar_age_range_BP</code></td>
<td>
<p>A vector of length 2 with the start and end
calendar age BP to calculate the SPD over. These two values must be in order
with start value less than end value, e.g., (600, 1700) cal yr BP.
The code will extend this range (by 400 cal yrs each side) for conservativeness</p>
</td></tr>
<tr><td><code id="FindSummedProbabilityDistribution_+3A_rc_determinations">rc_determinations</code></td>
<td>
<p>A vector of observed radiocarbon determinations. Can be provided either as
<code class="reqn">{}^{14}</code>C ages (in <code class="reqn">{}^{14}</code>C yr BP) or as F<code class="reqn">{}^{14}</code>C concentrations.</p>
</td></tr>
<tr><td><code id="FindSummedProbabilityDistribution_+3A_rc_sigmas">rc_sigmas</code></td>
<td>
<p>A vector of the (1-sigma) measurement uncertainties for the
radiocarbon determinations. Must be the same length as <code>rc_determinations</code> and
given in the same units.</p>
</td></tr>
<tr><td><code id="FindSummedProbabilityDistribution_+3A_calibration_curve">calibration_curve</code></td>
<td>
<p>A dataframe which must contain one column <code>calendar_age_BP</code>, and also
columns <code>c14_age</code> and <code>c14_sig</code> or <code>f14c</code> and <code>f14c_sig</code> (or both sets).
This format matches the curves supplied with this package, e.g., <a href="#topic+intcal20">intcal20</a>,
<a href="#topic+intcal13">intcal13</a>, which contain all 5 columns.</p>
</td></tr>
<tr><td><code id="FindSummedProbabilityDistribution_+3A_f14c_inputs">F14C_inputs</code></td>
<td>
<p><code>TRUE</code> if the provided <code>rc_determinations</code> are F<code class="reqn">{}^{14}</code>C
concentrations and <code>FALSE</code> if they are radiocarbon ages. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="FindSummedProbabilityDistribution_+3A_resolution">resolution</code></td>
<td>
<p>The distance between the calendar ages at which to calculate the calendar age probability.
Default is 1.</p>
</td></tr>
<tr><td><code id="FindSummedProbabilityDistribution_+3A_plot_output">plot_output</code></td>
<td>
<p><code>TRUE</code> if you wish to plot the determinations, the calibration curve,
and the SPD on the same plot. Defaults to <code>FALSE</code></p>
</td></tr>
<tr><td><code id="FindSummedProbabilityDistribution_+3A_plot_cal_age_scale">plot_cal_age_scale</code></td>
<td>
<p>Only for usage when <code>plot_output = TRUE</code>.
The calendar scale to use for the x-axis. Allowed values are &quot;BP&quot;, &quot;AD&quot; and &quot;BC&quot;. The default
is &quot;BP&quot;, corresponding to plotting in cal yr BP.</p>
</td></tr>
<tr><td><code id="FindSummedProbabilityDistribution_+3A_interval_width">interval_width</code></td>
<td>
<p>Only for usage when <code>plot_output = TRUE</code>. The confidence intervals to show for the
calibration curve. Choose from one of &quot;1sigma&quot; (68.3%), &quot;2sigma&quot; (95.4%) and &quot;bespoke&quot;. Default is &quot;2sigma&quot;.</p>
</td></tr>
<tr><td><code id="FindSummedProbabilityDistribution_+3A_bespoke_probability">bespoke_probability</code></td>
<td>
<p>The probability to use for the confidence interval
if &quot;bespoke&quot; is chosen above. E.g. if 0.95 is chosen, then the 95% confidence
interval is calculated. Ignored if &quot;bespoke&quot; is not chosen.</p>
</td></tr>
<tr><td><code id="FindSummedProbabilityDistribution_+3A_denscale">denscale</code></td>
<td>
<p>Whether to scale the vertical range of the calendar age density plot
relative to the calibration curve plot (optional). Default is 3 which means
that the maximum SPD will be at 1/3 of the height of the plot.</p>
</td></tr>
<tr><td><code id="FindSummedProbabilityDistribution_+3A_plot_pretty">plot_pretty</code></td>
<td>
<p>logical, defaulting to <code>TRUE</code>. If set <code>TRUE</code> then will select pretty plotting
margins (that create sufficient space for axis titles and rotates y-axis labels). If <code>FALSE</code> will
implement current user values.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with one column <code>calendar_age_BP</code> containing the calendar
ages, and the other column <code>probability</code> containing the probability at that
calendar age
</p>


<h3>See Also</h3>

<p><a href="#topic+PolyaUrnBivarDirichlet">PolyaUrnBivarDirichlet</a>,
<a href="#topic+WalkerBivarDirichlet">WalkerBivarDirichlet</a> for rigorous non-parametric Bayesian alternatives; and
<a href="#topic+PPcalibrate">PPcalibrate</a> for a rigorous variable-rate Poisson process alternative.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># An example using 14C age BP and the IntCal 20 curve
SPD &lt;- FindSummedProbabilityDistribution(
   calendar_age_range_BP=c(400, 1700),
   rc_determinations=c(602, 805, 1554),
   rc_sigmas=c(35, 34, 45),
   calibration_curve=intcal20)
plot(SPD, type = "l",
   xlim = rev(range(SPD$calendar_age_BP)),
   xlab = "Calendar Age (cal yr BP)")

# Using the inbuilt plotting features
SPD &lt;- FindSummedProbabilityDistribution(
   calendar_age_range_BP=c(400, 1700),
   rc_determinations=c(602, 805, 1554),
   rc_sigmas=c(35, 34, 45),
   calibration_curve=intcal20,
   plot_output = TRUE,
   interval_width = "bespoke",
   bespoke_probability = 0.8)

# An different example using F14C concentrations and the IntCal 13 curve
SPD &lt;- FindSummedProbabilityDistribution(
   calendar_age_range_BP=c(400, 2100),
   rc_determinations=c(0.8, 0.85, 0.9),
   rc_sigmas=c(0.01, 0.015, 0.012),
   F14C_inputs=TRUE,
   calibration_curve=intcal13)
plot(SPD, type = "l",
   xlim = rev(range(SPD$calendar_age_BP)),
   xlab = "Calendar Age (cal yr BP)")
</code></pre>

<hr>
<h2 id='GenerateOxcalCode'>Outputs code suitable for running in OxCal from a series of radiocarbon determinations</h2><span id='topic+GenerateOxcalCode'></span>

<h3>Description</h3>

<p>Outputs code suitable for running in OxCal from a series of radiocarbon determinations
that can be given as either <code class="reqn">{}^{14}</code>C age or F<code class="reqn">{}^{14}</code>C.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GenerateOxcalCode(
  model_name,
  rc_determinations,
  rc_sigmas,
  rc_names = NULL,
  F14C_inputs = FALSE,
  outfile_path = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="GenerateOxcalCode_+3A_model_name">model_name</code></td>
<td>
<p>The name given to the model in the OxCal code.</p>
</td></tr>
<tr><td><code id="GenerateOxcalCode_+3A_rc_determinations">rc_determinations</code></td>
<td>
<p>A vector of observed radiocarbon determinations. Can be provided either as
<code class="reqn">{}^{14}</code>C ages (in <code class="reqn">{}^{14}</code>C yr BP) or as F<code class="reqn">{}^{14}</code>C concentrations.</p>
</td></tr>
<tr><td><code id="GenerateOxcalCode_+3A_rc_sigmas">rc_sigmas</code></td>
<td>
<p>A vector of the (1-sigma) measurement uncertainties for the
radiocarbon determinations. Must be the same length as <code>rc_determinations</code> and
given in the same units.</p>
</td></tr>
<tr><td><code id="GenerateOxcalCode_+3A_rc_names">rc_names</code></td>
<td>
<p>Optional. The name of each data point - if given it must be the same length of rc_determinations.</p>
</td></tr>
<tr><td><code id="GenerateOxcalCode_+3A_f14c_inputs">F14C_inputs</code></td>
<td>
<p><code>TRUE</code> if the provided <code>rc_determinations</code> are F<code class="reqn">{}^{14}</code>C
concentrations and <code>FALSE</code> if they are radiocarbon ages. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="GenerateOxcalCode_+3A_outfile_path">outfile_path</code></td>
<td>
<p>Optional. If given the OxCal code will be output to the file at the path given, otherwise it
will be output to the terminal.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>None
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Generate names automatically and outputs to the screen for 14C ages
GenerateOxcalCode("My_data", c(1123, 1128, 1135), c(32, 24, 25))

# Provide name automatically and outputs to the screen for F14C concentrations
GenerateOxcalCode(
  "My_data",
  c(0.832, 0.850, 0.846),
  c(0.004, 0.003, 0.009),
  c("P-1", "P-2", "P-3"),
  F14C_inputs=TRUE)

</code></pre>

<hr>
<h2 id='human'>Example real-life data - Humans in Yukon and Alaska</h2><span id='topic+human'></span>

<h3>Description</h3>

<p>46 radiocarbon determinations collated by Dale Guthrie, R. related to
archaeological sites (i.e., evidence of human existence) in Alaska. Samples
are restricted to those between 25,000&ndash;6000 <code class="reqn">{}^{14}</code>C yrs BP. <br /> <br />
<strong>Reference:</strong> <br />
Dale Guthrie, R. New carbon dates link climatic change with human colonization
and Pleistocene extinctions. <em>Nature</em> <strong>441</strong>, 207&ndash;209 (2006).
https://doi.org/10.1038/nature04604
</p>


<h3>Usage</h3>

<pre><code class='language-R'>human
</code></pre>


<h3>Format</h3>



<h4><code>human</code></h4>

<p>A data frame with 46 rows and 7 columns:
</p>

<dl>
<dt>lab_code</dt><dd><p>The sample code for the <code class="reqn">{}^{14}</code>C laboratory</p>
</dd>
<dt>site_code</dt><dd><p>The site/museum code</p>
</dd>
<dt>location</dt><dd><p>The location of the sample</p>
</dd>
<dt>c14_age</dt><dd><p>The observed <code class="reqn">{}^{14}</code>C ages of the samples (in <code class="reqn">{}^{14}</code>C yr BP)</p>
</dd>
<dt>c14_sig</dt><dd><p>The uncertainty in the observed <code class="reqn">{}^{14}</code>C ages reported by the radiocarbon laboratory</p>
</dd>
<dt>f14c</dt><dd><p>The observed F<code class="reqn">{}^{14}</code>C concentrations</p>
</dd>
<dt>f14c_sig</dt><dd><p>The uncertainty in the observed F<code class="reqn">{}^{14}</code>C concentrations reported by the radiocarbon laboratory</p>
</dd>
</dl>




<h3>Source</h3>

<p>https://doi.org/10.1038/nature04604
</p>

<hr>
<h2 id='intcal04'>IntCal04 calibration curve</h2><span id='topic+intcal04'></span>

<h3>Description</h3>

<p>The IntCal04 Northern Hemisphere radiocarbon age calibration curve
on a calendar grid spanning from 26,000&ndash;0 cal yr BP
(Before Present, 0 cal yr BP corresponds to 1950 CE). <br /> <br />
<em>Note:</em> This dataset provides <code class="reqn">{}^{14}</code>C ages and F<code class="reqn">{}^{14}</code>C values
on a calendar age grid. This is different from the <code class="reqn">{}^{14}</code>C ages
and <code class="reqn">{\Delta}^{14}</code>C values provided in oxcal .14c files.<br /> <br />
<strong>Reference:</strong> <br /> PJ Reimer, MGL Baillie, E Bard, A Bayliss, JW Beck, C Bertrand, PG Blackwell,
CE Buck, G Burr, KB Cutler, PE Damon, RL Edwards, RG Fairbanks, M Friedrich,
TP Guilderson, KA Hughen, B Kromer, FG McCormac, S Manning, C Bronk Ramsey,
RW Reimer, S Remmele, JR Southon, M Stuiver, S Talamo, FW Taylor,
J van der Plicht, and CE Weyhenmeyer. 2004.
Intcal04 Terrestrial Radiocarbon Age Calibration, 0&ndash;26 Cal Kyr BP.
<em>Radiocarbon</em> <strong>46</strong>(3):1029-1058 https://doi.org/10.1017/S0033822200032999. <br /> <br />
</p>


<h3>Usage</h3>

<pre><code class='language-R'>intcal04
</code></pre>


<h3>Format</h3>



<h4><code>intcal04</code></h4>

<p>A data frame with 3,301 rows and 5 columns providing the IntCal04 radiocarbon age
calibration curve on a calendar grid spanning from 26,000&ndash;0 cal yr BP:
</p>

<dl>
<dt>calendar_age</dt><dd><p>The calendar age (in cal yr BP)</p>
</dd>
<dt>c14_age</dt><dd><p>The <code class="reqn">{}^{14}</code>C age (in <code class="reqn">{}^{14}</code>C yr BP)</p>
</dd>
<dt>c14_sig</dt><dd><p>The (1-<code class="reqn">\sigma</code>) uncertainty in the <code class="reqn">{}^{14}</code>C age</p>
</dd>
<dt>f14c</dt><dd><p>The <code class="reqn">{}^{14}</code>C age expressed as F<code class="reqn">{}^{14}</code>C concentration</p>
</dd>
<dt>f14c_sig</dt><dd><p>The (1-<code class="reqn">\sigma</code>) uncertainty in the F<code class="reqn">{}^{14}</code>C concentration</p>
</dd>
</dl>




<h3>Source</h3>

<p>https://doi.org/10.1017/S0033822200032999
</p>

<hr>
<h2 id='intcal09'>IntCal09 calibration curve</h2><span id='topic+intcal09'></span>

<h3>Description</h3>

<p>The IntCal09 Northern Hemisphere radiocarbon age calibration curve
on a calendar grid spanning from 50,000&ndash;0 cal yr BP
(Before Present, 0 cal yr BP corresponds to 1950 CE). <br /> <br />
<em>Note:</em> This dataset provides <code class="reqn">{}^{14}</code>C ages and F<code class="reqn">{}^{14}</code>C values
on a calendar age grid. This is different from the <code class="reqn">{}^{14}</code>C ages
and <code class="reqn">{\Delta}^{14}</code>C values provided in oxcal .14c files.<br /> <br />
<strong>Reference:</strong> <br /> PJ Reimer, MGL Baillie, E Bard, A Bayliss, JW Beck, PG Blackwell,
C Bronk Ramsey, CE Buck, GS Burr, RL Edwards, M Friedrich, PM Grootes,
TP Guilderson, I Hajdas, TJ Heaton, AG Hogg, KA Hughen, KF Kaiser, B Kromer,
FG McCormac, SW Manning, RW Reimer, DA Richards, JR Southon, S Talamo,
CSM Turney, J van der Plicht, CE Weyhenmeyer. 2009.
IntCal09 and Marine09 Radiocarbon Age Calibration Curves, 0&ndash;50,000 Years cal BP
<em>Radiocarbon</em> <strong>51</strong>(4):1111-1150 https://doi.org/10.1017/S0033822200034202. <br /> <br />
</p>


<h3>Usage</h3>

<pre><code class='language-R'>intcal09
</code></pre>


<h3>Format</h3>



<h4><code>intcal09</code></h4>

<p>A data frame with 3,521 rows and 5 columns providing the IntCal09 radiocarbon age
calibration curve on a calendar grid spanning from 50,000&ndash;0 cal yr BP:
</p>

<dl>
<dt>calendar_age</dt><dd><p>The calendar age (in cal yr BP)</p>
</dd>
<dt>c14_age</dt><dd><p>The <code class="reqn">{}^{14}</code>C age (in <code class="reqn">{}^{14}</code>C yr BP)</p>
</dd>
<dt>c14_sig</dt><dd><p>The (1-<code class="reqn">\sigma</code>) uncertainty in the <code class="reqn">{}^{14}</code>C age</p>
</dd>
<dt>f14c</dt><dd><p>The <code class="reqn">{}^{14}</code>C age expressed as F<code class="reqn">{}^{14}</code>C concentration</p>
</dd>
<dt>f14c_sig</dt><dd><p>The (1-<code class="reqn">\sigma</code>) uncertainty in the F<code class="reqn">{}^{14}</code>C concentration</p>
</dd>
</dl>




<h3>Source</h3>

<p>http://doi.org/10.1017/S0033822200034202
</p>

<hr>
<h2 id='intcal13'>IntCal13 calibration curve</h2><span id='topic+intcal13'></span>

<h3>Description</h3>

<p>The IntCal13 Northern Hemisphere radiocarbon age calibration curve
on a calendar grid spanning from 50,000&ndash;0 cal yr BP
(Before Present, 0 cal yr BP corresponds to 1950 CE). <br /> <br />
<em>Note:</em> This dataset provides <code class="reqn">{}^{14}</code>C ages and F<code class="reqn">{}^{14}</code>C values
on a calendar age grid. This is different from the <code class="reqn">{}^{14}</code>C ages
and <code class="reqn">{\Delta}^{14}</code>C values provided in oxcal .14c files.<br /> <br />
<strong>Reference:</strong> <br /> Reimer PJ, Bard E, Bayliss A, Beck JW, Blackwell PG, Bronk Ramsey C, Buck CE,
Cheng H, Edwards RL, Friedrich M, Grootes PM, Guilderson TP, Haflidason H,
Hajdas I, Hatt? C, Heaton TJ, Hogg AG, Hughen KA, Kaiser KF, Kromer B,
Manning SW, Niu M, Reimer RW, Richards DA, Scott EM, Southon JR, Turney CSM,
van der Plicht J. 2013.
IntCal13 and Marine13 radiocarbon age calibration curves 0&ndash;50000 years calBP.
<em>Radiocarbon</em> <strong>55</strong>(4) https://doi.org/10.2458/azu_js_rc.55.16947. <br /> <br />
</p>


<h3>Usage</h3>

<pre><code class='language-R'>intcal13
</code></pre>


<h3>Format</h3>



<h4><code>intcal13</code></h4>

<p>A data frame with 5,141 rows and 5 columns providing the IntCal13 radiocarbon age
calibration curve on a calendar grid spanning from 50,000&ndash;0 cal yr BP:
</p>

<dl>
<dt>calendar_age</dt><dd><p>The calendar age (in cal yr BP)</p>
</dd>
<dt>c14_age</dt><dd><p>The <code class="reqn">{}^{14}</code>C age (in <code class="reqn">{}^{14}</code>C yr BP)</p>
</dd>
<dt>c14_sig</dt><dd><p>The (1-<code class="reqn">\sigma</code>) uncertainty in the <code class="reqn">{}^{14}</code>C age</p>
</dd>
<dt>f14c</dt><dd><p>The <code class="reqn">{}^{14}</code>C age expressed as F<code class="reqn">{}^{14}</code>C concentration</p>
</dd>
<dt>f14c_sig</dt><dd><p>The (1-<code class="reqn">\sigma</code>) uncertainty in the F<code class="reqn">{}^{14}</code>C concentration</p>
</dd>
</dl>




<h3>Source</h3>

<p>http://doi.org/10.2458/azu_js_rc.55.16947
</p>

<hr>
<h2 id='intcal20'>IntCal20 calibration curve</h2><span id='topic+intcal20'></span>

<h3>Description</h3>

<p>The IntCal20 Northern Hemisphere radiocarbon age calibration curve
on a calendar grid spanning from 55,000&ndash;0 cal yr BP
(Before Present, 0 cal yr BP corresponds to 1950 CE). <br /> <br />
<em>Note:</em> This dataset provides <code class="reqn">{}^{14}</code>C ages and F<code class="reqn">{}^{14}</code>C values
on a calendar age grid. This is different from the <code class="reqn">{}^{14}</code>C ages
and <code class="reqn">{\Delta}^{14}</code>C values provided in oxcal .14c files.<br /> <br />
<strong>Reference:</strong> <br /> Reimer PJ, Austin WEN, Bard E, Bayliss A, Blackwell PG, Bronk Ramsey C,
Butzin M, Cheng H, Edwards RL, Friedrich M, Grootes PM, Guilderson TP,
Hajdas I, Heaton TJ, Hogg AG, Hughen KA, Kromer B, Manning SW, Muscheler R,
Palmer JG, Pearson C, van der Plicht J, Reimer RW, Richards DA, Scott EM,
Southon JR, Turney CSM, Wacker L, Adolphi F, Bntgen U, Capano M, Fahrni S,
Fogtmann-Schulz A, Friedrich R, Khler P, Kudsk S, Miyake F, Olsen J,
Reinig F, Sakamoto M, Sookdeo A, Talamo S. 2020.
The IntCal20 Northern Hemisphere radiocarbon age calibration curve
(0-55 cal kBP). <em>Radiocarbon</em> <strong>62</strong> https://doi.org/10.1017/RDC.2020.41.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>intcal20
</code></pre>


<h3>Format</h3>



<h4><code>intcal20</code></h4>

<p>A data frame with 9,501 rows and 5 columns providing the IntCal20 radiocarbon age
calibration curve on a calendar grid spanning from 55,000&ndash;0 cal yr BP:
</p>

<dl>
<dt>calendar_age</dt><dd><p>The calendar age (in cal yr BP)</p>
</dd>
<dt>c14_age</dt><dd><p>The <code class="reqn">{}^{14}</code>C age (in <code class="reqn">{}^{14}</code>C yr BP)</p>
</dd>
<dt>c14_sig</dt><dd><p>The (1-<code class="reqn">\sigma</code>) uncertainty in the <code class="reqn">{}^{14}</code>C age</p>
</dd>
<dt>f14c</dt><dd><p>The <code class="reqn">{}^{14}</code>C age expressed as F<code class="reqn">{}^{14}</code>C concentration</p>
</dd>
<dt>f14c_sig</dt><dd><p>The (1-<code class="reqn">\sigma</code>) uncertainty in the F<code class="reqn">{}^{14}</code>C concentration</p>
</dd>
</dl>




<h3>Source</h3>

<p>http://doi.org/10.1017/RDC.2020.41
</p>

<hr>
<h2 id='intcal98'>IntCal98 calibration curve</h2><span id='topic+intcal98'></span>

<h3>Description</h3>

<p>The IntCal98 Northern Hemisphere radiocarbon age calibration curve
on a calendar grid spanning from 24,000&ndash;0 cal yr BP
(Before Present, 0 cal yr BP corresponds to 1950 CE). <br /> <br />
<em>Note:</em> This dataset provides <code class="reqn">{}^{14}</code>C ages and F<code class="reqn">{}^{14}</code>C values
on a calendar age grid. This is different from the <code class="reqn">{}^{14}</code>C ages
and <code class="reqn">{\Delta}^{14}</code>C values provided in oxcal .14c files.<br /> <br />
<strong>Reference:</strong> <br /> M. Stuiver, P. J. Reimer, E. Bard, J. W. Beck, G. S. Burr, K. A. Hughen,
B. Kromer, F. G. McCormac, J. v. d. Plicht and M. Spurk. 1998.
INTCAL98 Radiocarbon Age Calibration, 24,000&ndash;0 cal BP.
<em>Radiocarbon</em> <strong>40</strong>(3):1041-1083 https://doi.org/10.1017/S0033822200019123. <br /> <br />
</p>


<h3>Usage</h3>

<pre><code class='language-R'>intcal98
</code></pre>


<h3>Format</h3>



<h4><code>intcal98</code></h4>

<p>A data frame with 1,538 rows and 5 columns providing the IntCal98 radiocarbon age
calibration curve on a calendar grid spanning from 24,000&ndash;0 cal yr BP:
</p>

<dl>
<dt>calendar_age</dt><dd><p>The calendar age (in cal yr BP)</p>
</dd>
<dt>c14_age</dt><dd><p>The <code class="reqn">{}^{14}</code>C age (in <code class="reqn">{}^{14}</code>C yr BP)</p>
</dd>
<dt>c14_sig</dt><dd><p>The (1-<code class="reqn">\sigma</code>) uncertainty in the <code class="reqn">{}^{14}</code>C age</p>
</dd>
<dt>f14c</dt><dd><p>The <code class="reqn">{}^{14}</code>C age expressed as F<code class="reqn">{}^{14}</code>C concentration</p>
</dd>
<dt>f14c_sig</dt><dd><p>The (1-<code class="reqn">\sigma</code>) uncertainty in the F<code class="reqn">{}^{14}</code>C concentration</p>
</dd>
</dl>




<h3>Source</h3>

<p>https://doi.org/10.1017/S0033822200019123
</p>

<hr>
<h2 id='InterpolateCalibrationCurve'>Interpolate a calibration curve at a set of calendar ages</h2><span id='topic+InterpolateCalibrationCurve'></span>

<h3>Description</h3>

<p>Interpolate a calibration curve at a set of calendar ages
</p>


<h3>Usage</h3>

<pre><code class='language-R'>InterpolateCalibrationCurve(
  new_calendar_ages_BP,
  calibration_curve,
  F14C_outputs = NA
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="InterpolateCalibrationCurve_+3A_new_calendar_ages_bp">new_calendar_ages_BP</code></td>
<td>
<p>A scalar or vector containing calendar ages (in cal yr BP) at
which to interpolate the values (both the means and uncertainties) of the given calibration curve.
If not provided (and <code>NA</code> is given), will use the range from the minimum calendar age to the maximum calendar age
of the original calibration curve spaced by 1.</p>
</td></tr>
<tr><td><code id="InterpolateCalibrationCurve_+3A_calibration_curve">calibration_curve</code></td>
<td>
<p>A dataframe which must contain one column <code>calendar_age_BP</code>, and also
columns <code>c14_age</code> and <code>c14_sig</code> or <code>f14c</code> and <code>f14c_sig</code> (or both sets).
This format matches the curves supplied with this package, e.g., <a href="#topic+intcal20">intcal20</a>,
<a href="#topic+intcal13">intcal13</a>, which contain all 5 columns.</p>
</td></tr>
<tr><td><code id="InterpolateCalibrationCurve_+3A_f14c_outputs">F14C_outputs</code></td>
<td>
<p><code>TRUE</code> if only F<code class="reqn">{}^{14}</code>C concentrations are required, <code>FALSE</code>
if only the radiocarbon ages (in <code class="reqn">{}^{14}</code>C yrs BP) are required and <code>NA</code> if both are required for the new curve.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A new dataframe with entries for the interpolated <code>c14_age</code>, and
<code>c14_sig</code>, <code>f14c</code> and <code>f14c_sig</code> values at the <code>calendar_age_BP</code> values that were
given in <code>new_calendar_ages_BP</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Interpolate intcal20 at a single calendar age. Generates both 14C ages and F14C scales.
InterpolateCalibrationCurve(51020, intcal20)

# Interpolate intcal20 at two calendar ages. Generates F14C estimates only.
InterpolateCalibrationCurve(c(51017, 51021), intcal20, TRUE)

# Interpolate intcal20 at two calendar ages. Generate 14C age estimates (cal yr BP) only.
InterpolateCalibrationCurve(c(51017, 51021), intcal20, FALSE)

# Interpolate intcal20 at every integer calendar age within the range of dates
# (for intcal20 this is 0 to 55000 cal yr BP), and create estimates for both radiocarbon scales.
cal_curve &lt;- InterpolateCalibrationCurve(NA, intcal20)
</code></pre>

<hr>
<h2 id='kerr'>Example real-life data - Irish Rath</h2><span id='topic+kerr'></span>

<h3>Description</h3>

<p>255 radiocarbon determinations collated by Kerr and McCormick related to the
building and use of raths in Ireland in the early-medieval period. <br /> <br />
<strong>Reference:</strong> <br />
Kerr, T., McCormick, F., 2014. Statistics, sunspots and settlement:
influences on sum of probability curves.
<em>Journal of Archaeological Science</em> <strong>41</strong>, 493&ndash;501.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>kerr
</code></pre>


<h3>Format</h3>



<h4><code>kerr</code></h4>

<p>A data frame with 255 rows and 4 columns:
</p>

<dl>
<dt>c14_age</dt><dd><p>The observed <code class="reqn">{}^{14}</code>C ages of the samples (in <code class="reqn">{}^{14}</code>C yr BP)</p>
</dd>
<dt>c14_sig</dt><dd><p>The uncertainty in the observed <code class="reqn">{}^{14}</code>C ages reported by the radiocarbon laboratory</p>
</dd>
<dt>f14c</dt><dd><p>The observed F<code class="reqn">{}^{14}</code>C concentrations</p>
</dd>
<dt>f14c_sig</dt><dd><p>The uncertainty in the observed F<code class="reqn">{}^{14}</code>C concentrations reported by the radiocarbon laboratory</p>
</dd>
</dl>




<h3>Source</h3>

<p>http://doi.org/10.1016/j.jas.2013.09.002
</p>

<hr>
<h2 id='mammuthus'>Example real-life data - Mammuthus in Yukon and Alaska</h2><span id='topic+mammuthus'></span>

<h3>Description</h3>

<p>117 radiocarbon determinations collated by Dale Guthrie, R. related to
Mammuthus (mammoth) in Yukon and Alaska. Samples
are restricted to those between 25,000&ndash;6000 <code class="reqn">{}^{14}</code>C yrs BP. <br /> <br />
<strong>Reference:</strong> <br />
Dale Guthrie, R. New carbon dates link climatic change with human colonization
and Pleistocene extinctions. <em>Nature</em> <strong>441</strong>, 207&ndash;209 (2006).
https://doi.org/10.1038/nature04604
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mammuthus
</code></pre>


<h3>Format</h3>



<h4><code>mammuthus</code></h4>

<p>A data frame with 117 rows and 7 columns:
</p>

<dl>
<dt>lab_code</dt><dd><p>The sample code for the <code class="reqn">{}^{14}</code>C laboratory</p>
</dd>
<dt>site_code</dt><dd><p>The site/museum code</p>
</dd>
<dt>location</dt><dd><p>The location of the sample</p>
</dd>
<dt>c14_age</dt><dd><p>The observed <code class="reqn">{}^{14}</code>C ages of the samples (in <code class="reqn">{}^{14}</code>C yr BP)</p>
</dd>
<dt>c14_sig</dt><dd><p>The uncertainty in the observed <code class="reqn">{}^{14}</code>C ages reported by the radiocarbon laboratory</p>
</dd>
<dt>f14c</dt><dd><p>The observed F<code class="reqn">{}^{14}</code>C concentrations</p>
</dd>
<dt>f14c_sig</dt><dd><p>The uncertainty in the observed F<code class="reqn">{}^{14}</code>C concentrations reported by the radiocarbon laboratory</p>
</dd>
</dl>




<h3>Source</h3>

<p>https://doi.org/10.1038/nature04604
</p>

<hr>
<h2 id='PlotCalendarAgeDensityIndividualSample'>Plot Posterior Calendar Age Estimate for an Individual Determination after Joint Calibration</h2><span id='topic+PlotCalendarAgeDensityIndividualSample'></span>

<h3>Description</h3>

<p>Once a joint calibration function (any of <a href="#topic+PolyaUrnBivarDirichlet">PolyaUrnBivarDirichlet</a>, <a href="#topic+WalkerBivarDirichlet">WalkerBivarDirichlet</a>
or <a href="#topic+PPcalibrate">PPcalibrate</a>) has been run to calibrate a set of related radiocarbon
determinations, this function plots the posterior calendar age estimate for a given single
determination. Shown are a (direct) histogram of the posterior calendar ages generated by the MCMC
chain and also a (smoothed) kernel density estimate obtained using a Gaussian kernel. The highest
posterior density (HPD) interval is also shown for the interval width specified (default 2<code class="reqn">\sigma</code>).
</p>
<p>For more information read the vignettes: <br />
<code>vignette("Non-parametric-summed-density", package = "carbondate")</code> <br />
<code>vignette("Poisson-process-modelling", package = "carbondate")</code>
</p>
<p><strong>Note:</strong> The output of this function will provide different results from independent calibration
of the determination. By jointly, and simultaneously, calibrating all the related <code class="reqn">{}^{14}</code>C determinations
using the library functions we are able to share the available calendar information between the samples. This should result in improved
individual calibration.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PlotCalendarAgeDensityIndividualSample(
  ident,
  output_data,
  calibration_curve = NULL,
  plot_14C_age = TRUE,
  plot_cal_age_scale = "BP",
  hist_resolution = 5,
  density_resolution = 1,
  interval_width = "2sigma",
  bespoke_probability = NA,
  n_burn = NA,
  n_end = NA,
  show_hpd_ranges = FALSE,
  show_unmodelled_density = FALSE,
  plot_pretty = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PlotCalendarAgeDensityIndividualSample_+3A_ident">ident</code></td>
<td>
<p>The individual determination for which you want to plot the posterior
density estimate of the calendar age.</p>
</td></tr>
<tr><td><code id="PlotCalendarAgeDensityIndividualSample_+3A_output_data">output_data</code></td>
<td>
<p>The return value either from one of the Bayesian non-parametric DPMM
functions (<a href="#topic+PolyaUrnBivarDirichlet">PolyaUrnBivarDirichlet</a> or <a href="#topic+WalkerBivarDirichlet">WalkerBivarDirichlet</a>); or
from the Poisson process modelling function (<a href="#topic+PPcalibrate">PPcalibrate</a>).</p>
</td></tr>
<tr><td><code id="PlotCalendarAgeDensityIndividualSample_+3A_calibration_curve">calibration_curve</code></td>
<td>
<p>This is usually not required since the name of the
calibration curve variable is saved in the output data. However, if the
variable with this name is no longer in your environment then you should pass
the calibration curve here. If provided, this should be a dataframe which
should contain at least 3 columns entitled <code>calendar_age</code>, <code>c14_age</code> and <code>c14_sig</code>.
This format matches <a href="#topic+intcal20">intcal20</a>.</p>
</td></tr>
<tr><td><code id="PlotCalendarAgeDensityIndividualSample_+3A_plot_14c_age">plot_14C_age</code></td>
<td>
<p>Whether to use the radiocarbon age (<code class="reqn">{}^{14}</code>C yr BP) as
the units of the y-axis in the plot. Defaults to <code>TRUE</code>. If <code>FALSE</code> uses
F<code class="reqn">{}^{14}</code>C concentration instead.</p>
</td></tr>
<tr><td><code id="PlotCalendarAgeDensityIndividualSample_+3A_plot_cal_age_scale">plot_cal_age_scale</code></td>
<td>
<p>The calendar scale to use for the x-axis. Allowed values are
&quot;BP&quot;, &quot;AD&quot; and &quot;BC&quot;. The default is &quot;BP&quot; corresponding to plotting in cal yr BP.</p>
</td></tr>
<tr><td><code id="PlotCalendarAgeDensityIndividualSample_+3A_hist_resolution">hist_resolution</code></td>
<td>
<p>The distance between histogram breaks when plotting the individual
posterior calendar age density. Default is 5.</p>
</td></tr>
<tr><td><code id="PlotCalendarAgeDensityIndividualSample_+3A_density_resolution">density_resolution</code></td>
<td>
<p>The distance between calendar ages for the returned smoothed calendar age
probability. Default is 1.</p>
</td></tr>
<tr><td><code id="PlotCalendarAgeDensityIndividualSample_+3A_interval_width">interval_width</code></td>
<td>
<p>The confidence intervals to show for the calibration curve and
for the highest posterior density ranges.
Choose from one of &quot;1sigma&quot; (68.3%), &quot;2sigma&quot; (95.4%) and &quot;bespoke&quot;. Default is &quot;2sigma&quot;.</p>
</td></tr>
<tr><td><code id="PlotCalendarAgeDensityIndividualSample_+3A_bespoke_probability">bespoke_probability</code></td>
<td>
<p>The probability to use for the confidence interval
if <code>"bespoke"</code> is chosen above. E.g., if 0.95 is chosen, then the 95% confidence
interval is calculated. Ignored if <code>"bespoke"</code> is not chosen.</p>
</td></tr>
<tr><td><code id="PlotCalendarAgeDensityIndividualSample_+3A_n_burn">n_burn</code></td>
<td>
<p>The number of MCMC iterations that should be discarded as burn-in (i.e.,
considered to be occurring before the MCMC has converged). This relates to the number
of iterations (<code>n_iter</code>) when running the original update functions (not the thinned <code>output_data</code>).
Any MCMC iterations before this are not used in the calculations. If not given, the first half of
the MCMC chain is discarded. Note: The maximum value that the function will allow is
<code>n_iter - 100 * n_thin</code> (where <code>n_iter</code> and <code>n_thin</code> are the arguments given to
<a href="#topic+PolyaUrnBivarDirichlet">PolyaUrnBivarDirichlet</a> or <a href="#topic+WalkerBivarDirichlet">WalkerBivarDirichlet</a>)
which would leave only 100 of the (thinned) values in <code>output_data</code>.</p>
</td></tr>
<tr><td><code id="PlotCalendarAgeDensityIndividualSample_+3A_n_end">n_end</code></td>
<td>
<p>The iteration number of the last sample in <code>output_data</code> to use in the calculations.
Assumed to be the total number of (thinned) realisations stored if not given.</p>
</td></tr>
<tr><td><code id="PlotCalendarAgeDensityIndividualSample_+3A_show_hpd_ranges">show_hpd_ranges</code></td>
<td>
<p>Set to <code>TRUE</code> to also show the highest posterior density (HPD) range
on the plot.</p>
</td></tr>
<tr><td><code id="PlotCalendarAgeDensityIndividualSample_+3A_show_unmodelled_density">show_unmodelled_density</code></td>
<td>
<p>Set to <code>TRUE</code> to also show the unmodelled density (i.e., the
result of independent calibration using <a href="#topic+CalibrateSingleDetermination">CalibrateSingleDetermination</a>) on the plot.
Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="PlotCalendarAgeDensityIndividualSample_+3A_plot_pretty">plot_pretty</code></td>
<td>
<p>logical, defaulting to <code>TRUE</code>. If set <code>TRUE</code> then will select pretty plotting
margins (that create sufficient space for axis titles and rotates y-axis labels). If <code>FALSE</code> will
implement current user values.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with one column <code>calendar_age_BP</code> containing the calendar ages, and the other
column <code>probability</code> containing the (smoothed) kernel density estimate of the probability at that
calendar age.
</p>


<h3>See Also</h3>

<p><a href="#topic+CalibrateSingleDetermination">CalibrateSingleDetermination</a> for independent calibration of a sample against
a calibration curve.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># NOTE 1: These examples are shown with a small n_iter to speed up execution.
# When you run ensure n_iter gives convergence (try function default).

# NOTE 2: The examples only show application to  PolyaUrnBivarDirichlet output.
# The function can also be used with WalkerBivarDirichlet and PPcalibrate output.

polya_urn_output &lt;- PolyaUrnBivarDirichlet(
    two_normals$c14_age,
    two_normals$c14_sig,
    intcal20,
    n_iter = 500,
    n_thin = 2,
    show_progress = FALSE)

# Result for 15th determination
PlotCalendarAgeDensityIndividualSample(15, polya_urn_output)

# Now change to show 1 sigma interval for HPD range and calibration curve
# and plot in yr AD
PlotCalendarAgeDensityIndividualSample(
    15,
    polya_urn_output,
    plot_cal_age_scale = "AD",
    interval_width = "1sigma",
    show_hpd_ranges = TRUE,
    show_unmodelled_density = TRUE)

# Plot and then assign the returned probability
posterior_dens &lt;- PlotCalendarAgeDensityIndividualSample(15, polya_urn_output)
# Use this to find the mean posterior calendar age
weighted.mean(posterior_dens$calendar_age_BP, posterior_dens$probability)
</code></pre>

<hr>
<h2 id='PlotConvergenceData'>Plot KL Divergence of Predictive Density to Assess
Convergence of Bayesian Non-Parametric DPMM Sampler</h2><span id='topic+PlotConvergenceData'></span>

<h3>Description</h3>

<p>This plots the Kullback-Leibler (KL) divergence between a fixed (initial/baseline)
predictive density and the predictive density calculated from later individual realisations
in the MCMC run of one of the Bayesian non-parametric summarisation approach. The divergence
from the initial predictive density is plotted as a function of the realisation/iteration
number.
</p>
<p>This aims to identify when the divergence, from the initial estimate of the shared <code class="reqn">f(\theta)</code>
to the current estimate, has begun to stabilise. Hence, to (informally) assess when the MCMC chain
has converged to equilibrium for the shared, underlying, predictive <code class="reqn">f(\theta)</code>.
</p>
<p>For more information read the vignette: <br />
<code>vignette("determining-convergence", package = "carbondate")</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PlotConvergenceData(output_data, n_initial = NA)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PlotConvergenceData_+3A_output_data">output_data</code></td>
<td>
<p>The return value from one of the Bayesian non-parametric
DPMM summarisation functions, i.e.,
<a href="#topic+PolyaUrnBivarDirichlet">PolyaUrnBivarDirichlet</a> or
<a href="#topic+WalkerBivarDirichlet">WalkerBivarDirichlet</a>.</p>
</td></tr>
<tr><td><code id="PlotConvergenceData_+3A_n_initial">n_initial</code></td>
<td>
<p>The number of (thinned) realisations to use for the 'initial' predictive shared density.
This predictive density is then compared with the predictive obtained at each subsequent
realisation in the (thinned) DPMM output. If not specified, then the minimum of 1000
realisations, or 1 / 10 of the total number of realisations, will be used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>None
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Plot results for the example two_normal data
# NOTE: This does not show meaningful results as n_iter
# is too small. Try increasing n_iter to 1e5.
polya_urn_output &lt;- PolyaUrnBivarDirichlet(
    two_normals$c14_age,
    two_normals$c14_sig,
    intcal20,
    n_iter = 500,
    show_progress = FALSE)
PlotConvergenceData(polya_urn_output)
</code></pre>

<hr>
<h2 id='PlotGelmanRubinDiagnosticMultiChain'>Plot Histogram of the Gelman-Rubin Convergence Diagnostic for Multiple Independent
MCMC Chains</h2><span id='topic+PlotGelmanRubinDiagnosticMultiChain'></span>

<h3>Description</h3>

<p>This plots a histogram of the potential scale reduction factors (PSRF) for each of the individual
posterior calendar age estimates for multiple independent MCMC chains. Achieved by comparing the
<em>within-chain</em> variance with the <em>between-chains</em> variance after <code>n_burn</code> iterations.
The PSRF of each sample's posterior calendar age is calculated.
If the chain have converged to the target posterior distribution, then PSRF should
be close to 1 for all of the samples (a stringent condition is that all values are less than 1.1).
</p>
<p>For more information read the vignette: <br />
<code>vignette("determining-convergence", package = "carbondate")</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PlotGelmanRubinDiagnosticMultiChain(output_data_list, n_burn = NA)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PlotGelmanRubinDiagnosticMultiChain_+3A_output_data_list">output_data_list</code></td>
<td>
<p>A list, each item containing the return value from one of the updating
functions e.g. <a href="#topic+PolyaUrnBivarDirichlet">PolyaUrnBivarDirichlet</a>, <a href="#topic+WalkerBivarDirichlet">WalkerBivarDirichlet</a> or
<a href="#topic+PPcalibrate">PPcalibrate</a>. The minimum number of elements in the list is 2.</p>
</td></tr>
<tr><td><code id="PlotGelmanRubinDiagnosticMultiChain_+3A_n_burn">n_burn</code></td>
<td>
<p>The number of MCMC iterations that should be discarded for burn-in. This relates to
the total number of iterations <code>n_iter</code> when running the original update functions (not the
thinned <code>output_data</code>). Any MCMC iterations before this are not used in the calculations of the PSRF.
If not given, the first half of the MCMC chain is discarded. Note: The maximum value that the function
will allow is <code>n_iter - 100 * n_thin</code> (where <code>n_iter</code> and <code>n_thin</code> are the arguments that were given to
<a href="#topic+PPcalibrate">PPcalibrate</a>) which would leave only 100 of the (thinned) values in <code>output_data</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>None
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Plot results for the example data - n_iter is too small for convergence
# Try increasing n_iter to see the values of the PSRF decrease
po &lt;- list()
for (i in 1:3) {
    set.seed(i)
    po[[i]] &lt;- PolyaUrnBivarDirichlet(
        two_normals$c14_age,
        two_normals$c14_sig,
        intcal20,
        n_iter=400,
        show_progress = FALSE)
}
PlotGelmanRubinDiagnosticMultiChain(po)
</code></pre>

<hr>
<h2 id='PlotGelmanRubinDiagnosticSingleChain'>Plot Histogram of the Gelman-Rubin Convergence Diagnostic for a Single MCMC Chain</h2><span id='topic+PlotGelmanRubinDiagnosticSingleChain'></span>

<h3>Description</h3>

<p>This plots a histogram of the potential scale reduction factors (PSRF) for each of the individual posterior
calendar age estimates within a single MCMC chain. Achieved by splitting the chain into segments
after <code>n_burn</code> and comparing the <em>within-chain</em> variance with the <em>between-chains</em>
variance of the segments. The PSRF of each sample's posterior calendar age is calculated.
If the chain have converged to the target posterior distribution, then PSRF should be close to 1
for all of the samples (a stringent condition is that all values are less than 1.1).
</p>
<p>For more information read the vignette: <br />
<code>vignette("determining-convergence", package = "carbondate")</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PlotGelmanRubinDiagnosticSingleChain(output_data, n_burn = NA, n_segments = 3)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PlotGelmanRubinDiagnosticSingleChain_+3A_output_data">output_data</code></td>
<td>
<p>The return value from one of the updating functions, e.g.,
<a href="#topic+PolyaUrnBivarDirichlet">PolyaUrnBivarDirichlet</a>, <a href="#topic+WalkerBivarDirichlet">WalkerBivarDirichlet</a> or <a href="#topic+PPcalibrate">PPcalibrate</a>.</p>
</td></tr>
<tr><td><code id="PlotGelmanRubinDiagnosticSingleChain_+3A_n_burn">n_burn</code></td>
<td>
<p>The number of MCMC iterations that should be discarded for burn-in. This relates to
the total number of iterations <code>n_iter</code> when running the original update functions (not the
thinned <code>output_data</code>). Any MCMC iterations before this are not used in the calculations of the PSRF.
If not given, the first half of the MCMC chain is discarded. Note: The maximum value that the function
will allow is <code>n_iter - 100 * n_thin</code> (where <code>n_iter</code> and <code>n_thin</code> are the arguments that were given to
<a href="#topic+PPcalibrate">PPcalibrate</a>) which would leave only 100 of the (thinned) values in <code>output_data</code>.</p>
</td></tr>
<tr><td><code id="PlotGelmanRubinDiagnosticSingleChain_+3A_n_segments">n_segments</code></td>
<td>
<p>The number of segments to split the chain into. Default is 3, must be a
number between 2 and 10.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>None
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Plot results for the example data - n_iter is too small for convergence
# Try increasing n_iter to see the values of the PSRF decrease
polya_urn_output &lt;- PolyaUrnBivarDirichlet(
    two_normals$c14_age,
    two_normals$c14_sig,
    intcal20,
    n_iter = 500,
    show_progress = FALSE)
PlotGelmanRubinDiagnosticSingleChain(polya_urn_output)
</code></pre>

<hr>
<h2 id='PlotNumberOfClusters'>Plot Number of Calendar Age Clusters Estimated
in Bayesian Non-Parametric DPMM Output</h2><span id='topic+PlotNumberOfClusters'></span>

<h3>Description</h3>

<p>Given output from one of the Bayesian non-parametric summarisation functions (either
<a href="#topic+PolyaUrnBivarDirichlet">PolyaUrnBivarDirichlet</a> or <a href="#topic+WalkerBivarDirichlet">WalkerBivarDirichlet</a>) plot the
estimated number of calendar age clusters represented by the <code class="reqn">{}^{14}</code>C samples.
</p>
<p>For more information read the vignette: <br />
<code>vignette("Non-parametric-summed-density", package = "carbondate")</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PlotNumberOfClusters(output_data, n_burn = NA, n_end = NA)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PlotNumberOfClusters_+3A_output_data">output_data</code></td>
<td>
<p>The return value from one of the Bayesian non-parametric DPMM functions, e.g.
<a href="#topic+PolyaUrnBivarDirichlet">PolyaUrnBivarDirichlet</a> or
<a href="#topic+WalkerBivarDirichlet">WalkerBivarDirichlet</a>, or a list, each item containing
one of these return values. Optionally, the output data can have an extra list item
named <code>label</code> which is used to set the label on the plot legend.</p>
</td></tr>
<tr><td><code id="PlotNumberOfClusters_+3A_n_burn">n_burn</code></td>
<td>
<p>The number of MCMC iterations that should be discarded as burn-in (i.e.,
considered to be occurring before the MCMC has converged). This relates to the number
of iterations (<code>n_iter</code>) when running the original update functions (not the thinned <code>output_data</code>).
Any MCMC iterations before this are not used in the calculations. If not given, the first half of
the MCMC chain is discarded. Note: The maximum value that the function will allow is
<code>n_iter - 100 * n_thin</code> (where <code>n_iter</code> and <code>n_thin</code> are the arguments given to
<a href="#topic+PolyaUrnBivarDirichlet">PolyaUrnBivarDirichlet</a> or <a href="#topic+WalkerBivarDirichlet">WalkerBivarDirichlet</a>)
which would leave only 100 of the (thinned) values in <code>output_data</code>.</p>
</td></tr>
<tr><td><code id="PlotNumberOfClusters_+3A_n_end">n_end</code></td>
<td>
<p>The last iteration in the original MCMC chain to use in the calculations. Assumed to be the
total number of iterations performed, i.e. <code>n_iter</code>, if not given.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>None
</p>


<h3>See Also</h3>

<p><a href="#topic+PlotPredictiveCalendarAgeDensity">PlotPredictiveCalendarAgeDensity</a> and
<a href="#topic+PlotCalendarAgeDensityIndividualSample">PlotCalendarAgeDensityIndividualSample</a> for more plotting functions using DPMM output.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># NOTE: these examples are shown with a small n_iter to speed up execution.
# When you run ensure n_iter gives convergence (try function default).

polya_urn_output &lt;- PolyaUrnBivarDirichlet(
    two_normals$c14_age,
    two_normals$c14_sig,
    intcal20,
    n_iter = 500,
    n_thin = 2,
    show_progress = FALSE)

PlotNumberOfClusters(polya_urn_output)
</code></pre>

<hr>
<h2 id='PlotNumberOfInternalChanges'>Plot Number of Changepoints in Rate of Sample Occurrence for Poisson Process Model</h2><span id='topic+PlotNumberOfInternalChanges'></span>

<h3>Description</h3>

<p>Given output from the Poisson process fitting function <a href="#topic+PPcalibrate">PPcalibrate</a>, plot
the posterior distribution for the number of internal changepoints in the underlying rate of
sample occurrence (i.e., in <code class="reqn">\lambda(t)</code>) over the period under study.
</p>
<p>For more information read the vignette: <br />
<code>vignette("Poisson-process-modelling", package = "carbondate")</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PlotNumberOfInternalChanges(output_data, n_burn = NA, n_end = NA)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PlotNumberOfInternalChanges_+3A_output_data">output_data</code></td>
<td>
<p>The return value from the updating function
<a href="#topic+PPcalibrate">PPcalibrate</a>. Optionally, the output data can have an extra list item
named <code>label</code> which is used to set the label on the plot legend.</p>
</td></tr>
<tr><td><code id="PlotNumberOfInternalChanges_+3A_n_burn">n_burn</code></td>
<td>
<p>The number of MCMC iterations that should be discarded as burn-in (i.e.,
considered to be occurring before the MCMC has converged). This relates to the number
of iterations (<code>n_iter</code>) when running the original update functions (not the thinned <code>output_data</code>).
Any MCMC iterations before this are not used in the calculations. If not given, the first half of the
MCMC chain is discarded. Note: The maximum value that the function
will allow is <code>n_iter - 100 * n_thin</code> (where <code>n_iter</code> and <code>n_thin</code> are the arguments that were given to
<a href="#topic+PPcalibrate">PPcalibrate</a>) which would leave only 100 of the (thinned) values in <code>output_data</code>.</p>
</td></tr>
<tr><td><code id="PlotNumberOfInternalChanges_+3A_n_end">n_end</code></td>
<td>
<p>The last iteration in the original MCMC chain to use in the calculations. Assumed to be the
total number of iterations performed, i.e. <code>n_iter</code>, if not given.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>None
</p>


<h3>Examples</h3>

<pre><code class='language-R'># NOTE: This example is shown with a small n_iter to speed up execution.
# Try n_iter and n_posterior_samples as the function defaults.

pp_output &lt;- PPcalibrate(
    pp_uniform_phase$c14_age,
    pp_uniform_phase$c14_sig,
    intcal20,
    n_iter = 1000,
    show_progress = FALSE)

PlotNumberOfInternalChanges(pp_output)
</code></pre>

<hr>
<h2 id='PlotPosteriorChangePoints'>Plot Calendar Ages of Changes in Rate of Sample Occurrence for Poisson Process Model</h2><span id='topic+PlotPosteriorChangePoints'></span>

<h3>Description</h3>

<p>Given output from the Poisson process fitting function <a href="#topic+PPcalibrate">PPcalibrate</a>, plot the
posterior density estimates for the calendar ages at which there are internal changepoints in the rate
of sample occurrence <code class="reqn">\lambda(t)</code>. These density estimates are calculated <strong>conditional</strong>
upon the number of internal changepoints within the period under study (which is specified as an input
to the function).
</p>
<p>Having conditioned on the number of changes, <code>n_change</code>, the code will extract all realisations
from the the posterior of the MCMC sampler which have that number of internal changepoints in the
estimate of <code class="reqn">\lambda(t)</code>. It will then provide density estimates for the (ordered) calendar ages
of those internal changepoints. These density estimates are obtained using a Gaussian kernel.
</p>
<p><strong>Note: These graphs will become harder to interpret as the specified number of changepoints
increases</strong>
</p>
<p>For more information read the vignette: <br />
<code>vignette("Poisson-process-modelling", package = "carbondate")</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PlotPosteriorChangePoints(
  output_data,
  n_changes = c(1, 2, 3),
  plot_cal_age_scale = "BP",
  n_burn = NA,
  n_end = NA,
  kernel_bandwidth = NA
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PlotPosteriorChangePoints_+3A_output_data">output_data</code></td>
<td>
<p>The return value from the updating function
<a href="#topic+PPcalibrate">PPcalibrate</a>. Optionally, the output data can have an extra list item
named <code>label</code> which is used to set the label on the plot legend.</p>
</td></tr>
<tr><td><code id="PlotPosteriorChangePoints_+3A_n_changes">n_changes</code></td>
<td>
<p>Number of internal changepoints to condition on, and plot for. A vector
which can contain at most 4 elements, with values in the range 1 to 6. If not given, then
<code>c(1, 2, 3)</code> will be used.</p>
</td></tr>
<tr><td><code id="PlotPosteriorChangePoints_+3A_plot_cal_age_scale">plot_cal_age_scale</code></td>
<td>
<p>(Optional) The calendar scale to use for the x-axis. Allowed values are
&quot;BP&quot;, &quot;AD&quot; and &quot;BC&quot;. The default is &quot;BP&quot; corresponding to plotting in cal yr BP.</p>
</td></tr>
<tr><td><code id="PlotPosteriorChangePoints_+3A_n_burn">n_burn</code></td>
<td>
<p>The number of MCMC iterations that should be discarded as burn-in (i.e.,
considered to be occurring before the MCMC has converged). This relates to the number
of iterations (<code>n_iter</code>) when running the original update functions (not the thinned <code>output_data</code>).
Any MCMC iterations before this are not used in the calculations. If not given, the first half of the
MCMC chain is discarded. Note: The maximum value that the function
will allow is <code>n_iter - 100 * n_thin</code> (where <code>n_iter</code> and <code>n_thin</code> are the arguments that were given to
<a href="#topic+PPcalibrate">PPcalibrate</a>) which would leave only 100 of the (thinned) values in <code>output_data</code>.</p>
</td></tr>
<tr><td><code id="PlotPosteriorChangePoints_+3A_n_end">n_end</code></td>
<td>
<p>The last iteration in the original MCMC chain to use in the calculations. Assumed to be the
total number of iterations performed, i.e. <code>n_iter</code>, if not given.</p>
</td></tr>
<tr><td><code id="PlotPosteriorChangePoints_+3A_kernel_bandwidth">kernel_bandwidth</code></td>
<td>
<p>(Optional) The bandwidth used for the (Gaussian) kernel smoothing of
the calendar age densities. If not given, then 1/50th of the overall calendar age range will be used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>None
</p>


<h3>Examples</h3>

<pre><code class='language-R'># NOTE: This example is shown with a small n_iter to speed up execution.
# Try n_iter and n_posterior_samples as the function defaults.

pp_output &lt;- PPcalibrate(
    pp_uniform_phase$c14_age,
    pp_uniform_phase$c14_sig,
    intcal20,
    n_iter = 1000,
    show_progress = FALSE)

# Plot the posterior change points for only 2 or 3 internal changes
PlotPosteriorChangePoints(pp_output, n_changes = c(2, 3))

# Changing the calendar age plotting scale to cal AD
PlotPosteriorChangePoints(pp_output, n_changes = c(2, 3),
    plot_cal_age_scale = "AD")
</code></pre>

<hr>
<h2 id='PlotPosteriorHeights'>Plot Heights of Segments in Rate of Sample Occurrence for Poisson Process Model</h2><span id='topic+PlotPosteriorHeights'></span>

<h3>Description</h3>

<p>Given output from the Poisson process fitting function <a href="#topic+PPcalibrate">PPcalibrate</a>, plot the
posterior density estimates for the heights (i.e., values) of the piecewise-constant rate
<code class="reqn">\lambda(t)</code> used to model sample occurrence. These density estimates are calculated
<strong>conditional</strong> upon the number of internal changepoints within the period under study
(which is specified as an input to the function).
</p>
<p>Having conditioned on the number of changes, <code>n_change</code>, the code will extract all realisations
from the the posterior of the MCMC sampler which have that number of internal changepoints in the
estimate of <code class="reqn">\lambda(t)</code>. It will then provide density estimates for the heights (i.e., the value)
of the rate function between each of the determined (ordered) changepoints. These density estimates
are obtained using a Gaussian kernel.
</p>
<p><strong>Note: These graphs will become harder to interpret as the specified number of changepoints
increases</strong>
</p>
<p>For more information read the vignette: <br />
<code>vignette("Poisson-process-modelling", package = "carbondate")</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PlotPosteriorHeights(
  output_data,
  n_changes = c(1, 2, 3),
  n_burn = NA,
  n_end = NA,
  kernel_bandwidth = NA
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PlotPosteriorHeights_+3A_output_data">output_data</code></td>
<td>
<p>The return value from the updating function
<a href="#topic+PPcalibrate">PPcalibrate</a>. Optionally, the output data can have an extra list item
named <code>label</code> which is used to set the label on the plot legend.</p>
</td></tr>
<tr><td><code id="PlotPosteriorHeights_+3A_n_changes">n_changes</code></td>
<td>
<p>Number of internal changepoints to condition on, and plot for. A vector
which can contain at most 4 elements, with values in the range 1 to 6. If not given, then
<code>c(1, 2, 3)</code> will be used.</p>
</td></tr>
<tr><td><code id="PlotPosteriorHeights_+3A_n_burn">n_burn</code></td>
<td>
<p>The number of MCMC iterations that should be discarded as burn-in (i.e.,
considered to be occurring before the MCMC has converged). This relates to the number
of iterations (<code>n_iter</code>) when running the original update functions (not the thinned <code>output_data</code>).
Any MCMC iterations before this are not used in the calculations. If not given, the first half of the
MCMC chain is discarded. Note: The maximum value that the function
will allow is <code>n_iter - 100 * n_thin</code> (where <code>n_iter</code> and <code>n_thin</code> are the arguments that were given to
<a href="#topic+PPcalibrate">PPcalibrate</a>) which would leave only 100 of the (thinned) values in <code>output_data</code>.</p>
</td></tr>
<tr><td><code id="PlotPosteriorHeights_+3A_n_end">n_end</code></td>
<td>
<p>The last iteration in the original MCMC chain to use in the calculations. Assumed to be the
total number of iterations performed, i.e. <code>n_iter</code>, if not given.</p>
</td></tr>
<tr><td><code id="PlotPosteriorHeights_+3A_kernel_bandwidth">kernel_bandwidth</code></td>
<td>
<p>(Optional) The bandwidth used for the (Gaussian) kernel smoothing of
the calendar age densities. If not given, 1/50th of the maximum height will be used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>None
</p>


<h3>Examples</h3>

<pre><code class='language-R'># NOTE: This example is shown with a small n_iter to speed up execution.
# Try n_iter and n_posterior_samples as the function defaults.

pp_output &lt;- PPcalibrate(
    pp_uniform_phase$c14_age,
    pp_uniform_phase$c14_sig,
    intcal20,
    n_iter = 1000,
    show_progress = FALSE)

# Plot the posterior heights for only 2 or 3 internal changes
PlotPosteriorHeights(pp_output, n_changes = c(2, 3))
</code></pre>

<hr>
<h2 id='PlotPosteriorMeanRate'>Plot Posterior Mean Rate of Sample Occurrence for Poisson Process Model</h2><span id='topic+PlotPosteriorMeanRate'></span>

<h3>Description</h3>

<p>Given output from the Poisson process fitting function <a href="#topic+PPcalibrate">PPcalibrate</a> calculate
and plot the posterior mean rate of sample occurrence (i.e., the underlying Poisson process
rate <code class="reqn">\lambda(t)</code>) together with specified probability intervals, on a given calendar age grid
(provided in cal yr BP).
</p>
<p>Will show the original set of radiocarbon determinations (those you are modelling/summarising),
the chosen calibration curve, and the estimated posterior rate of occurrence <code class="reqn">\lambda(t)</code> on the same plot.
Can also optionally show the posterior mean of each individual sample's calendar age estimate.
</p>
<p><strong>Note:</strong> If all you are interested in is the value of the posterior mean rate
on a grid, without an accompanying plot, you can use
<a href="#topic+FindPosteriorMeanRate">FindPosteriorMeanRate</a> instead.
</p>
<p>For more information read the vignette: <br />
<code>vignette("Poisson-process-modelling", package = "carbondate")</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PlotPosteriorMeanRate(
  output_data,
  n_posterior_samples = 5000,
  calibration_curve = NULL,
  plot_14C_age = TRUE,
  plot_cal_age_scale = "BP",
  show_individual_means = TRUE,
  show_confidence_intervals = TRUE,
  interval_width = "2sigma",
  bespoke_probability = NA,
  denscale = 3,
  resolution = 1,
  n_burn = NA,
  n_end = NA,
  plot_pretty = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PlotPosteriorMeanRate_+3A_output_data">output_data</code></td>
<td>
<p>The return value from the updating function
<a href="#topic+PPcalibrate">PPcalibrate</a>. Optionally, the output data can have an extra list item
named <code>label</code> which is used to set the label on the plot legend.</p>
</td></tr>
<tr><td><code id="PlotPosteriorMeanRate_+3A_n_posterior_samples">n_posterior_samples</code></td>
<td>
<p>Number of samples it will draw, after having removed <code>n_burn</code>,
from the (thinned) MCMC realisations stored in <code>output_data</code> to estimate the
rate <code class="reqn">\lambda(t)</code>. These samples may be repeats if the number of, post burn-in,
realisations is less than <code>n_posterior_samples</code>. If not given, 5000 is used.</p>
</td></tr>
<tr><td><code id="PlotPosteriorMeanRate_+3A_calibration_curve">calibration_curve</code></td>
<td>
<p>This is usually not required since the name of the
calibration curve variable is saved in the output data. However, if the
variable with this name is no longer in your environment then you should pass
the calibration curve here. If provided, this should be a dataframe which
should contain at least 3 columns entitled <code>calendar_age</code>, <code>c14_age</code> and <code>c14_sig</code>.
This format matches <a href="#topic+intcal20">intcal20</a>.</p>
</td></tr>
<tr><td><code id="PlotPosteriorMeanRate_+3A_plot_14c_age">plot_14C_age</code></td>
<td>
<p>Whether to use the radiocarbon age (<code class="reqn">{}^{14}</code>C yr BP) as
the units of the y-axis in the plot. Defaults to <code>TRUE</code>. If <code>FALSE</code> uses
F<code class="reqn">{}^{14}</code>C concentration instead.</p>
</td></tr>
<tr><td><code id="PlotPosteriorMeanRate_+3A_plot_cal_age_scale">plot_cal_age_scale</code></td>
<td>
<p>(Optional) The calendar scale to use for the x-axis. Allowed values are
&quot;BP&quot;, &quot;AD&quot; and &quot;BC&quot;. The default is &quot;BP&quot; corresponding to plotting in cal yr BP.</p>
</td></tr>
<tr><td><code id="PlotPosteriorMeanRate_+3A_show_individual_means">show_individual_means</code></td>
<td>
<p>(Optional) Whether to calculate and show the mean posterior
calendar age estimated for each individual <code class="reqn">{}^{14}</code>C sample on the plot as a rug on
the x-axis. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="PlotPosteriorMeanRate_+3A_show_confidence_intervals">show_confidence_intervals</code></td>
<td>
<p>Whether to show the pointwise confidence intervals
(at chosen probability level) on the plot. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="PlotPosteriorMeanRate_+3A_interval_width">interval_width</code></td>
<td>
<p>The confidence intervals to show for both the
calibration curve and the predictive density. Choose from one of <code>"1sigma"</code> (68.3%),
<code>"2sigma"</code> (95.4%) and <code>"bespoke"</code>. Default is <code>"2sigma"</code>.</p>
</td></tr>
<tr><td><code id="PlotPosteriorMeanRate_+3A_bespoke_probability">bespoke_probability</code></td>
<td>
<p>The probability to use for the confidence interval
if <code>"bespoke"</code> is chosen above. E.g., if 0.95 is chosen, then the 95% confidence
interval is calculated. Ignored if <code>"bespoke"</code> is not chosen.</p>
</td></tr>
<tr><td><code id="PlotPosteriorMeanRate_+3A_denscale">denscale</code></td>
<td>
<p>(Optional) Whether to scale the vertical range of the Poisson process mean rate plot
relative to the calibration curve plot. Default is 3 which means
that the maximum of the mean rate will be at 1/3 of the height of the plot.</p>
</td></tr>
<tr><td><code id="PlotPosteriorMeanRate_+3A_resolution">resolution</code></td>
<td>
<p>The distance between calendar ages at which to calculate the value of the rate
<code class="reqn">\lambda(t)</code>. These ages will be created on a regular grid that automatically covers
the calendar period specified in <code>output_data</code>. Default is 1.</p>
</td></tr>
<tr><td><code id="PlotPosteriorMeanRate_+3A_n_burn">n_burn</code></td>
<td>
<p>The number of MCMC iterations that should be discarded as burn-in (i.e.,
considered to be occurring before the MCMC has converged). This relates to the number
of iterations (<code>n_iter</code>) when running the original update functions (not the thinned <code>output_data</code>).
Any MCMC iterations before this are not used in the calculations. If not given, the first half of the
MCMC chain is discarded. Note: The maximum value that the function
will allow is <code>n_iter - 100 * n_thin</code> (where <code>n_iter</code> and <code>n_thin</code> are the arguments that were given to
<a href="#topic+PPcalibrate">PPcalibrate</a>) which would leave only 100 of the (thinned) values in <code>output_data</code>.</p>
</td></tr>
<tr><td><code id="PlotPosteriorMeanRate_+3A_n_end">n_end</code></td>
<td>
<p>The last iteration in the original MCMC chain to use in the calculations. Assumed to be the
total number of iterations performed, i.e. <code>n_iter</code>, if not given.</p>
</td></tr>
<tr><td><code id="PlotPosteriorMeanRate_+3A_plot_pretty">plot_pretty</code></td>
<td>
<p>logical, defaulting to <code>TRUE</code>. If set <code>TRUE</code> then will select pretty plotting
margins (that create sufficient space for axis titles and rotates y-axis labels). If <code>FALSE</code> will
implement current user values.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list, each item containing a data frame of the <code>calendar_age_BP</code>, the <code>rate_mean</code>
and the confidence intervals for the rate - <code>rate_ci_lower</code> and <code>rate_ci_upper</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># NOTE: All these examples are shown with a small n_iter and n_posterior_samples
# to speed up execution.
# Try n_iter and n_posterior_samples as the function defaults.

pp_output &lt;- PPcalibrate(
    pp_uniform_phase$c14_age,
    pp_uniform_phase$c14_sig,
    intcal20,
    n_iter = 1000,
    show_progress = FALSE)

# Default plot with 2 sigma interval
PlotPosteriorMeanRate(pp_output, n_posterior_samples = 100)

# Specify an 80% confidence interval
PlotPosteriorMeanRate(
    pp_output,
    interval_width = "bespoke",
    bespoke_probability = 0.8,
    n_posterior_samples = 100)
</code></pre>

<hr>
<h2 id='PlotPredictiveCalendarAgeDensity'>Plot Predictive Estimate of Shared Calendar Age Density from Bayesian Non-Parametric
DPMM Output</h2><span id='topic+PlotPredictiveCalendarAgeDensity'></span>

<h3>Description</h3>

<p>Given output from one of the Bayesian non-parametric summarisation functions (either
<a href="#topic+PolyaUrnBivarDirichlet">PolyaUrnBivarDirichlet</a> or <a href="#topic+WalkerBivarDirichlet">WalkerBivarDirichlet</a>) calculate
and plot the predictive (summarised/shared) calendar age density and probability intervals
on a given calendar age grid (provided in cal yr BP).
</p>
<p>Will show the original set of radiocarbon determinations (those you are summarising),
the chosen calibration curve, and the summarised predictive calendar age density on the
same plot. Can also optionally show the SPD estimate.
</p>
<p><strong>Note:</strong> If all you are interested in is the estimated value of the predictive density
on a grid, without an accompanying plot, you can use
<a href="#topic+FindPredictiveCalendarAgeDensity">FindPredictiveCalendarAgeDensity</a> instead.
</p>
<p>For more information read the vignette: <br />
<code>vignette("Non-parametric-summed-density", package = "carbondate")</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PlotPredictiveCalendarAgeDensity(
  output_data,
  n_posterior_samples = 5000,
  calibration_curve = NULL,
  plot_14C_age = TRUE,
  plot_cal_age_scale = "BP",
  show_SPD = FALSE,
  show_confidence_intervals = TRUE,
  interval_width = "2sigma",
  bespoke_probability = NA,
  denscale = 3,
  resolution = 1,
  n_burn = NA,
  n_end = NA,
  plot_pretty = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PlotPredictiveCalendarAgeDensity_+3A_output_data">output_data</code></td>
<td>
<p>The return value from one of the Bayesian non-parametric DPMM functions, e.g.
<a href="#topic+PolyaUrnBivarDirichlet">PolyaUrnBivarDirichlet</a> or
<a href="#topic+WalkerBivarDirichlet">WalkerBivarDirichlet</a>, or a list, each item containing
one of these return values. Optionally, the output data can have an extra list item
named <code>label</code> which is used to set the label on the plot legend.</p>
</td></tr>
<tr><td><code id="PlotPredictiveCalendarAgeDensity_+3A_n_posterior_samples">n_posterior_samples</code></td>
<td>
<p>Number of samples it will draw, after having removed <code>n_burn</code>,
from the (thinned) realisations stored in the DPMM outputs to estimate the
predictive calendar age density. These samples may be repeats if the number of, post burn-in,
realisations is less than <code>n_posterior_samples</code>. If not given, 5000 is used.</p>
</td></tr>
<tr><td><code id="PlotPredictiveCalendarAgeDensity_+3A_calibration_curve">calibration_curve</code></td>
<td>
<p>This is usually not required since the name of the
calibration curve variable is saved in the output data. However, if the
variable with this name is no longer in your environment then you should pass
the calibration curve here. If provided, this should be a dataframe which
should contain at least 3 columns entitled <code>calendar_age</code>, <code>c14_age</code> and <code>c14_sig</code>.
This format matches <a href="#topic+intcal20">intcal20</a>.</p>
</td></tr>
<tr><td><code id="PlotPredictiveCalendarAgeDensity_+3A_plot_14c_age">plot_14C_age</code></td>
<td>
<p>Whether to use the radiocarbon age (<code class="reqn">{}^{14}</code>C yr BP) as
the units of the y-axis in the plot. Defaults to <code>TRUE</code>. If <code>FALSE</code> uses
F<code class="reqn">{}^{14}</code>C concentration instead.</p>
</td></tr>
<tr><td><code id="PlotPredictiveCalendarAgeDensity_+3A_plot_cal_age_scale">plot_cal_age_scale</code></td>
<td>
<p>The calendar scale to use for the x-axis. Allowed values are
&quot;BP&quot;, &quot;AD&quot; and &quot;BC&quot;. The default is &quot;BP&quot; corresponding to plotting in cal yr BP.</p>
</td></tr>
<tr><td><code id="PlotPredictiveCalendarAgeDensity_+3A_show_spd">show_SPD</code></td>
<td>
<p>Whether to calculate and show the summed probability
distribution on the plot (optional). Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="PlotPredictiveCalendarAgeDensity_+3A_show_confidence_intervals">show_confidence_intervals</code></td>
<td>
<p>Whether to show the pointwise confidence intervals
(at the chosen probability level) on the plot. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="PlotPredictiveCalendarAgeDensity_+3A_interval_width">interval_width</code></td>
<td>
<p>The confidence intervals to show for both the
calibration curve and the predictive density. Choose from one of <code>"1sigma"</code> (68.3%),
<code>"2sigma"</code> (95.4%) and <code>"bespoke"</code>. Default is <code>"2sigma"</code>.</p>
</td></tr>
<tr><td><code id="PlotPredictiveCalendarAgeDensity_+3A_bespoke_probability">bespoke_probability</code></td>
<td>
<p>The probability to use for the confidence interval
if <code>"bespoke"</code> is chosen above. E.g., if 0.95 is chosen, then the 95% confidence
interval is calculated. Ignored if <code>"bespoke"</code> is not chosen.</p>
</td></tr>
<tr><td><code id="PlotPredictiveCalendarAgeDensity_+3A_denscale">denscale</code></td>
<td>
<p>Whether to scale the vertical range of the summarised calendar age density plot
relative to the calibration curve plot (optional). Default is 3 which means
that the maximum predictive density will be at 1/3 of the height of the plot.</p>
</td></tr>
<tr><td><code id="PlotPredictiveCalendarAgeDensity_+3A_resolution">resolution</code></td>
<td>
<p>The distance between calendar ages at which to calculate the predictive shared
density. These ages will be created on a regular grid that automatically covers the
calendar period of the given set of <code class="reqn">{}^{14}</code>C samples. Default is 1.</p>
</td></tr>
<tr><td><code id="PlotPredictiveCalendarAgeDensity_+3A_n_burn">n_burn</code></td>
<td>
<p>The number of MCMC iterations that should be discarded as burn-in (i.e.,
considered to be occurring before the MCMC has converged). This relates to the number
of iterations (<code>n_iter</code>) when running the original update functions (not the thinned <code>output_data</code>).
Any MCMC iterations before this are not used in the calculations. If not given, the first half of
the MCMC chain is discarded. Note: The maximum value that the function will allow is
<code>n_iter - 100 * n_thin</code> (where <code>n_iter</code> and <code>n_thin</code> are the arguments given to
<a href="#topic+PolyaUrnBivarDirichlet">PolyaUrnBivarDirichlet</a> or <a href="#topic+WalkerBivarDirichlet">WalkerBivarDirichlet</a>)
which would leave only 100 of the (thinned) values in <code>output_data</code>.</p>
</td></tr>
<tr><td><code id="PlotPredictiveCalendarAgeDensity_+3A_n_end">n_end</code></td>
<td>
<p>The last iteration in the original MCMC chain to use in the calculations. Assumed to be the
total number of iterations performed, i.e. <code>n_iter</code>, if not given.</p>
</td></tr>
<tr><td><code id="PlotPredictiveCalendarAgeDensity_+3A_plot_pretty">plot_pretty</code></td>
<td>
<p>logical, defaulting to <code>TRUE</code>. If set <code>TRUE</code> then will select pretty plotting
margins (that create sufficient space for axis titles and rotates y-axis labels). If <code>FALSE</code> will
implement current user values.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list, each item containing a data frame of the <code>calendar_age_BP</code>, the
<code>density_mean</code> and the confidence intervals for the density
<code>density_ci_lower</code> and <code>density_ci_upper</code> for each set of output data.
</p>


<h3>See Also</h3>

<p><a href="#topic+FindPredictiveCalendarAgeDensity">FindPredictiveCalendarAgeDensity</a> if only interested in the estimated value of
the predictive density on a grid; <a href="#topic+PlotNumberOfClusters">PlotNumberOfClusters</a> and
<a href="#topic+PlotCalendarAgeDensityIndividualSample">PlotCalendarAgeDensityIndividualSample</a> for more plotting functions using DPMM output.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># NOTE: All these examples are shown with a small n_iter and n_posterior_samples
# to speed up execution.
# Try n_iter and n_posterior_samples as the function defaults.

polya_urn_output &lt;- PolyaUrnBivarDirichlet(
    two_normals$c14_age,
    two_normals$c14_sig,
    intcal20,
    n_iter = 500,
    show_progress = FALSE)
walker_output &lt;- WalkerBivarDirichlet(
    two_normals$c14_age,
    two_normals$c14_sig,
    intcal20,
    n_iter = 500,
    show_progress = FALSE)

# Plot results for a single calibration
PlotPredictiveCalendarAgeDensity(polya_urn_output, n_posterior_samples = 50)

# Plot results from two calibrations on the same plot
PlotPredictiveCalendarAgeDensity(
    list(walker_output, polya_urn_output), n_posterior_samples = 50)

# Plot and show the 80% confidence interval, show the SPD, add a custom label
polya_urn_output$label = "My plot"
PlotPredictiveCalendarAgeDensity(
    polya_urn_output,
    n_posterior_samples = 50,
    interval_width = "bespoke",
    bespoke_probability = 0.8,
    show_SPD = TRUE)
</code></pre>

<hr>
<h2 id='PolyaUrnBivarDirichlet'>Calibrate and Summarise Multiple Radiocarbon Samples via
a Bayesian Non-Parametric DPMM (with Polya Urn Updating)</h2><span id='topic+PolyaUrnBivarDirichlet'></span>

<h3>Description</h3>

<p>This function calibrates sets of multiple radiocarbon (<code class="reqn">{}^{14}</code>C)
determinations, and simultaneously summarises the resultant calendar age information.
This is achieved using Bayesian non-parametric density estimation,
providing a statistically-rigorous alternative to summed probability
distributions (SPDs).
</p>
<p>It takes as an input a set of <code class="reqn">{}^{14}</code>C determinations and associated <code class="reqn">1\sigma</code>
uncertainties, as well as the radiocarbon age calibration curve to be used. The samples
are assumed to arise from an (unknown) shared calendar age distribution <code class="reqn">f(\theta)</code> that
we would like to estimate, alongside performing calibration of each sample.
</p>
<p>The function models the underlying distribution <code class="reqn">f(\theta)</code> as a Dirichlet process
mixture model (DPMM), whereby the samples are considered to arise from an unknown number of
distinct clusters. Fitting is achieved via MCMC.
</p>
<p>It returns estimates for the calendar age of each individual radiocarbon sample; and broader
output (including the means and variances of the underpinning calendar age clusters)
that can be used by other library functions to provide a predictive estimate of the
shared calendar age density <code class="reqn">f(\theta)</code>.
</p>
<p>For more information read the vignette: <br />
<code>vignette("Non-parametric-summed-density", package = "carbondate")</code>
</p>
<p><strong>Note:</strong> The library provides two slightly-different update schemes for the MCMC. In this
particular function, updating of the DPMM is achieved by a Polya Urn approach (Neal 2000)
This is our recommended updating approach based on testing. The alternative, slice-sampled, approach
can be found at <a href="#topic+WalkerBivarDirichlet">WalkerBivarDirichlet</a>
</p>
<p><strong>References:</strong> <br />
Heaton, TJ. 2022. Non-parametric Calibration of Multiple Related Radiocarbon
Determinations and their Calendar Age Summarisation. <em>Journal of the Royal Statistical
Society Series C: Applied Statistics</em> <strong>71</strong> (5):1918-56. https://doi.org/10.1111/rssc.12599. <br />
Neal, RM. 2000. Markov Chain Sampling Methods for Dirichlet Process Mixture Models.
<em>Journal of Computational and Graphical Statistics</em> <strong>9</strong> (2):249 https://doi.org/10.2307/1390653.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PolyaUrnBivarDirichlet(
  rc_determinations,
  rc_sigmas,
  calibration_curve,
  F14C_inputs = FALSE,
  n_iter = 1e+05,
  n_thin = 10,
  use_F14C_space = TRUE,
  slice_width = NA,
  slice_multiplier = 10,
  n_clust = min(10, length(rc_determinations)),
  show_progress = TRUE,
  sensible_initialisation = TRUE,
  lambda = NA,
  nu1 = NA,
  nu2 = NA,
  A = NA,
  B = NA,
  alpha_shape = NA,
  alpha_rate = NA,
  mu_phi = NA,
  calendar_ages = NA
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PolyaUrnBivarDirichlet_+3A_rc_determinations">rc_determinations</code></td>
<td>
<p>A vector of observed radiocarbon determinations. Can be provided either as
<code class="reqn">{}^{14}</code>C ages (in <code class="reqn">{}^{14}</code>C yr BP) or as F<code class="reqn">{}^{14}</code>C concentrations.</p>
</td></tr>
<tr><td><code id="PolyaUrnBivarDirichlet_+3A_rc_sigmas">rc_sigmas</code></td>
<td>
<p>A vector of the (1-sigma) measurement uncertainties for the
radiocarbon determinations. Must be the same length as <code>rc_determinations</code> and
given in the same units.</p>
</td></tr>
<tr><td><code id="PolyaUrnBivarDirichlet_+3A_calibration_curve">calibration_curve</code></td>
<td>
<p>A dataframe which must contain one column <code>calendar_age_BP</code>, and also
columns <code>c14_age</code> and <code>c14_sig</code> or <code>f14c</code> and <code>f14c_sig</code> (or both sets).
This format matches the curves supplied with this package, e.g., <a href="#topic+intcal20">intcal20</a>,
<a href="#topic+intcal13">intcal13</a>, which contain all 5 columns.</p>
</td></tr>
<tr><td><code id="PolyaUrnBivarDirichlet_+3A_f14c_inputs">F14C_inputs</code></td>
<td>
<p><code>TRUE</code> if the provided <code>rc_determinations</code> are F<code class="reqn">{}^{14}</code>C
concentrations and <code>FALSE</code> if they are radiocarbon ages. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="PolyaUrnBivarDirichlet_+3A_n_iter">n_iter</code></td>
<td>
<p>The number of MCMC iterations (optional). Default is 100,000.</p>
</td></tr>
<tr><td><code id="PolyaUrnBivarDirichlet_+3A_n_thin">n_thin</code></td>
<td>
<p>How much to thin the MCMC output (optional). Will store every
<code>n_thin</code><code class="reqn">{}^\textrm{th}</code> iteration. 1 is no thinning, while a larger number will result
in more thinning. Default is 10. Must choose an integer greater than 1. Overall
number of MCMC realisations stored will be <code class="reqn">n_{\textrm{out}} =
\textrm{floor}( n_{\textrm{iter}}/n_{\textrm{thin}}) + 1</code> so do not choose
<code>n_thin</code> too large to ensure there are enough samples from the posterior to
use for later inference.</p>
</td></tr>
<tr><td><code id="PolyaUrnBivarDirichlet_+3A_use_f14c_space">use_F14C_space</code></td>
<td>
<p>If <code>TRUE</code> (default) the calculations within the function are carried
out in F<code class="reqn">{}^{14}</code>C space. If <code>FALSE</code> they are carried out in <code class="reqn">{}^{14}</code>C
age space. We recommend selecting <code>TRUE</code> as, for very old samples, calibrating in
F<code class="reqn">{}^{14}</code>C space removes the potential affect of asymmetry in the radiocarbon age
uncertainty.
<em>Note:</em> This flag can be set independently of the format/scale on which
<code>rc_determinations</code> were originally provided.</p>
</td></tr>
<tr><td><code id="PolyaUrnBivarDirichlet_+3A_slice_width">slice_width</code></td>
<td>
<p>Parameter for slice sampling (optional). If not given a value
is chosen intelligently based on the spread of the initial calendar ages.
Must be given if <code>sensible_initialisation</code> is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="PolyaUrnBivarDirichlet_+3A_slice_multiplier">slice_multiplier</code></td>
<td>
<p>Integer parameter for slice sampling (optional).
Default is 10. Limits the slice size to <code>slice_multiplier * slice_width</code>.</p>
</td></tr>
<tr><td><code id="PolyaUrnBivarDirichlet_+3A_n_clust">n_clust</code></td>
<td>
<p>The number of clusters with which to initialise the sampler (optional). Must
be less than the length of <code>rc_determinations</code>. Default is 10 or the length
of <code>rc_determinations</code> if that is less than 10.</p>
</td></tr>
<tr><td><code id="PolyaUrnBivarDirichlet_+3A_show_progress">show_progress</code></td>
<td>
<p>Whether to show a progress bar in the console during
execution. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="PolyaUrnBivarDirichlet_+3A_sensible_initialisation">sensible_initialisation</code></td>
<td>
<p>Whether to use sensible values to initialise the sampler
and an automated (adaptive) prior on <code class="reqn">\mu_{\phi}</code> and (A, B) that is informed
by the observed <code>rc_determinations</code>. If this is <code>TRUE</code> (the recommended default), then
all the remaining arguments below are ignored.</p>
</td></tr>
<tr><td><code id="PolyaUrnBivarDirichlet_+3A_lambda">lambda</code>, <code id="PolyaUrnBivarDirichlet_+3A_nu1">nu1</code>, <code id="PolyaUrnBivarDirichlet_+3A_nu2">nu2</code></td>
<td>
<p>Hyperparameters for the prior on the mean
<code class="reqn">\phi_j</code> and precision <code class="reqn">\tau_j</code> of each individual calendar age
cluster <code class="reqn">j</code>:
</p>
<p style="text-align: center;"><code class="reqn">(\phi_j, \tau_j)|\mu_{\phi} \sim
\textrm{NormalGamma}(\mu_{\phi}, \lambda, \nu_1, \nu_2)</code>
</p>
<p> where
<code class="reqn">\mu_{\phi}</code> is the overall cluster centering. Required if
<code>sensible_initialisation</code> is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="PolyaUrnBivarDirichlet_+3A_a">A</code>, <code id="PolyaUrnBivarDirichlet_+3A_b">B</code></td>
<td>
<p>Prior on <code class="reqn">\mu_{\phi}</code> giving the mean and precision of the
overall centering <code class="reqn">\mu_{\phi} \sim N(A, B^{-1})</code>. Required if <code>sensible_initialisation</code> is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="PolyaUrnBivarDirichlet_+3A_alpha_shape">alpha_shape</code>, <code id="PolyaUrnBivarDirichlet_+3A_alpha_rate">alpha_rate</code></td>
<td>
<p>Shape and rate hyperparameters that specify
the prior for the Dirichlet Process (DP) concentration, <code class="reqn">\alpha</code>. This
concentration <code class="reqn">\alpha</code> determines the number of clusters we
expect to observe among our <code class="reqn">n</code> sampled objects. The model
places a prior on
<code class="reqn">\alpha \sim \Gamma(\eta_1, \eta_2)</code>, where <code class="reqn">\eta_1, \eta_2</code> are
the <code>alpha_shape</code> and <code>alpha_rate</code>. A small <code class="reqn">\alpha</code> means the DPMM is
more concentrated (i.e. we expect fewer calendar age clusters) while a large alpha means it is less
less concentrated (i.e. many clusters). Required if <code>sensible_initialisation</code> is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="PolyaUrnBivarDirichlet_+3A_mu_phi">mu_phi</code></td>
<td>
<p>Initial value of the overall cluster centering <code class="reqn">\mu_{\phi}</code>.
Required if <code>sensible_initialisation</code> is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="PolyaUrnBivarDirichlet_+3A_calendar_ages">calendar_ages</code></td>
<td>
<p>The initial estimate for the underlying calendar ages
(optional). If supplied, it must be a vector with the same length as
<code>rc_determinations</code>.  Required if <code>sensible_initialisation</code> is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with 10 items. The first 8 items contain output of the model, each of
which has one dimension of size <code class="reqn">n_{\textrm{out}} =
\textrm{floor}( n_{\textrm{iter}}/n_{\textrm{thin}}) + 1</code>. The rows in these items store
the state of the MCMC from every <code class="reqn">n_{\textrm{thin}}</code><code class="reqn">{}^\textrm{th}</code> iteration:
</p>

<dl>
<dt><code>cluster_identifiers</code></dt><dd><p>A list of length <code class="reqn">n_{\textrm{out}}</code> each entry
gives the cluster allocation (an integer between 1 and <code>n_clust</code>)
for each observation on the relevant MCMC iteration. Information on the state of
these calendar age clusters (means and precisions) can be found in the other output items.</p>
</dd>
<dt><code>alpha</code></dt><dd><p>A double vector of length <code class="reqn">n_{\textrm{out}}</code> giving the Dirichlet Process
concentration parameter <code class="reqn">\alpha</code>.</p>
</dd>
<dt><code>n_clust</code></dt><dd><p>An integer vector of length <code class="reqn">n_{\textrm{out}}</code> giving
the current number of clusters in the model.</p>
</dd>
<dt><code>phi</code></dt><dd><p>A list of length <code class="reqn">n_{\textrm{out}}</code> each entry giving
a vector of length <code>n_clust</code> of the means of the current calendar age clusters
<code class="reqn">\phi_j</code>.</p>
</dd>
<dt><code>tau</code></dt><dd><p>A list of length <code class="reqn">n_{\textrm{out}}</code> each entry giving
a vector of length <code>n_clust</code> of the precisions of the current calenadar age cluster
<code class="reqn">\tau_j</code>.</p>
</dd>
<dt><code>observations_per_cluster</code></dt><dd><p>A list of length <code class="reqn">n_{\textrm{out}}</code> each entry giving
a vector of length <code>n_clust</code> of the number of observations for that cluster.</p>
</dd>
<dt><code>calendar_ages</code></dt><dd><p>An <code class="reqn">n_{\textrm{out}}</code> by <code class="reqn">n_{\textrm{obs}}</code>
integer matrix. Gives the current estimate for the calendar age of each individual
observation.</p>
</dd>
<dt><code>mu_phi</code></dt><dd><p>A vector of length <code class="reqn">n_{\textrm{out}}</code> giving the overall
centering <code class="reqn">\mu_{\phi}</code> of the calendar age clusters.</p>
</dd>
</dl>

<p>where <code class="reqn">n_{\textrm{obs}}</code> is the number of radiocarbon observations i.e.
the length of <code>rc_determinations</code>.
</p>
<p>The remaining items give information about the input data, input parameters (or
those calculated using <code>sensible_initialisation</code>) and the update_type
</p>

<dl>
<dt><code>update_type</code></dt><dd><p>A string that always has the value &quot;Polya Urn&quot;.</p>
</dd>
<dt><code>input_data</code></dt><dd><p>A list containing the <code class="reqn">{}^{14}</code>C data used, and the name of
the calibration curve used.</p>
</dd>
<dt><code>input_parameters</code></dt><dd><p>A list containing the values of the fixed
hyperparameters <code>lambda</code>, <code>nu1</code>, <code>nu2</code>, <code>A</code>, <code>B</code>, <code>alpha_shape</code>,
<code>alpha_rate</code> and <code>mu_phi</code>, and the slice parameters <code>slice_width</code> and
<code>slice_multiplier</code>.</p>
</dd>
</dl>



<h3>See Also</h3>

<p><a href="#topic+WalkerBivarDirichlet">WalkerBivarDirichlet</a> for our less-preferred MCMC method to update the Bayesian DPMM
(otherwise an identical model); and <a href="#topic+PlotCalendarAgeDensityIndividualSample">PlotCalendarAgeDensityIndividualSample</a>,
<a href="#topic+PlotPredictiveCalendarAgeDensity">PlotPredictiveCalendarAgeDensity</a> and <a href="#topic+PlotNumberOfClusters">PlotNumberOfClusters</a>
to access the model output and estimate the calendar age information. <br /> <br />
See also <a href="#topic+PPcalibrate">PPcalibrate</a> for an an alternative (similarly rigorous) approach to
calibration and summarisation of related radiocarbon determinations using a variable-rate Poisson process
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Note these examples are shown with a small n_iter to speed up execution.
# When you run ensure n_iter gives convergence (try function default).

# Basic usage making use of sensible initialisation to set most values and
# using a saved example data set and the IntCal20 curve.
polya_urn_output &lt;- PolyaUrnBivarDirichlet(
    two_normals$c14_age,
    two_normals$c14_sig,
    intcal20,
    n_iter = 100,
    show_progress = FALSE)

# The radiocarbon determinations can be given as F14C concentrations
polya_urn_output &lt;- PolyaUrnBivarDirichlet(
    two_normals$f14c,
    two_normals$f14c_sig,
    intcal20,
    F14C_inputs = TRUE,
    n_iter = 100,
    show_progress = FALSE)
</code></pre>

<hr>
<h2 id='pp_uniform_phase'>Example artificial data - Uniform Phase</h2><span id='topic+pp_uniform_phase'></span>

<h3>Description</h3>

<p>40 simulated radiocarbon determinations for which the underlying calendar ages are
drawn (uniformly at random) from the period  550&ndash;500 cal yr BP.
</p>
<p style="text-align: center;"><code class="reqn">f(\theta) = U[550, 500]</code>
</p>

<p>The observational uncertainty of each determination is set to be 15 <code class="reqn">{}^{14}</code>C yrs. <br /> <br />
The corresponding <code class="reqn">{}^{14}</code>C ages are then simulated based upon the IntCal20 calibration curve
(convolved with the 15 <code class="reqn">{}^{14}</code>C yr measurement uncertainty):
</p>
<p style="text-align: center;"><code class="reqn">X_i | \theta_i \sim N(m(\theta_i), \rho(\theta_i)^2 + 15^2),</code>
</p>

<p>where <code class="reqn">m(\theta_i)</code> and <code class="reqn">\rho(\theta_i)</code> are the IntCal20 pointwise
means and uncertainties. <br /> <br />
This dataset matches that used in the package vignette to illustrate the Poisson process modelling.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pp_uniform_phase
</code></pre>


<h3>Format</h3>



<h4><code>pp_uniform_phase</code></h4>

<p>A data frame with 40 rows and 4 columns:
</p>

<dl>
<dt>c14_age</dt><dd><p>The simulated <code class="reqn">{}^{14}</code>C age (in <code class="reqn">{}^{14}</code>C yr BP)</p>
</dd>
<dt>c14_sig</dt><dd><p>The (fixed) <code class="reqn">{}^{14}</code>C age measurement uncertainty used in the simulation (set at 15 <code class="reqn">{}^{14}</code>C yrs)</p>
</dd>
<dt>f14c</dt><dd><p>The corresponding simulated values of F<code class="reqn">{}^{14}</code>C concentration</p>
</dd>
<dt>f14c_sig</dt><dd><p>The (fixed) corresponding F<code class="reqn">{}^{14}</code>C measurement uncertainty used in the simulation</p>
</dd>
</dl>



<hr>
<h2 id='PPcalibrate'>Model Occurrence of Multiple Radiocarbon Samples as a
Variable-Rate Poisson Process</h2><span id='topic+PPcalibrate'></span>

<h3>Description</h3>

<p>This function calibrates a set of radiocarbon (<code class="reqn">{}^{14}</code>C) samples, and provides an estimate
of how the underlying rate at which the samples occurred varies over calendar time (including any
specific changepoints in the rate). The method can be used as an alternative approach to summarise
calendar age information contained in a set of related <code class="reqn">{}^{14}</code>C samples, enabling inference
on the latent <em>activity</em> rate which led to their creation.
</p>
<p>It takes as an input a set of <code class="reqn">{}^{14}</code>C determinations and associated <code class="reqn">1\sigma</code>
uncertainties, as well as the radiocarbon age calibration curve to be used. The (calendar age)
occurrence of these radiocarbon (<code class="reqn">{}^{14}</code>C) samples is modelled as a Poisson process. The
underlying rate of this Poisson process <code class="reqn">\lambda(t)</code>, which represents the rate at which the
samples occurred, is considered unknown and assumed to vary over calendar time.
</p>
<p>Specifically, the sample occurrence rate <code class="reqn">\lambda(t)</code> is modelled as piecewise constant, but with
an unknown number of changepoints, which can occur at unknown times. The value of <code class="reqn">\lambda(t)</code>
between any set of changepoints is also unknown. The function jointly calibrates the given <code class="reqn">{}^{14}</code>C
samples under this model, and simultaneously provides an estimate of <code class="reqn">\lambda(t)</code>. Fitting is performed
using reversible-jump MCMC within Gibbs.
</p>
<p>It returns estimates for the calendar age of each individual radiocarbon sample in the input set;
and broader output on the estimated value of <code class="reqn">\lambda(t)</code> which can be used by other library functions.
Analysis of the estimated changepoints in the piecewise <code class="reqn">\lambda(t)</code> permits wider inference on whether
the occurrence rate of samples changed significantly at any particular calendar time and, if so, when and
by how much.
</p>
<p>For more information read the vignette: <br />
<code>vignette("Poisson-process-modelling", package = "carbondate")</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PPcalibrate(
  rc_determinations,
  rc_sigmas,
  calibration_curve,
  F14C_inputs = FALSE,
  n_iter = 1e+05,
  n_thin = 10,
  use_F14C_space = TRUE,
  show_progress = TRUE,
  calendar_age_range = NA,
  calendar_grid_resolution = 1,
  prior_h_shape = NA,
  prior_h_rate = NA,
  prior_n_internal_changepoints_lambda = 3,
  k_max_internal_changepoints = 30,
  rescale_factor_rev_jump = 0.9,
  bounding_range_prob_cutoff = 0.001,
  initial_n_internal_changepoints = 10,
  grid_extension_factor = 0.1,
  use_fast = TRUE,
  fast_approx_prob_cutoff = 0.001
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PPcalibrate_+3A_rc_determinations">rc_determinations</code></td>
<td>
<p>A vector of observed radiocarbon determinations. Can be provided either as
<code class="reqn">{}^{14}</code>C ages (in <code class="reqn">{}^{14}</code>C yr BP) or as F<code class="reqn">{}^{14}</code>C concentrations.</p>
</td></tr>
<tr><td><code id="PPcalibrate_+3A_rc_sigmas">rc_sigmas</code></td>
<td>
<p>A vector of the (1-sigma) measurement uncertainties for the
radiocarbon determinations. Must be the same length as <code>rc_determinations</code> and
given in the same units.</p>
</td></tr>
<tr><td><code id="PPcalibrate_+3A_calibration_curve">calibration_curve</code></td>
<td>
<p>A dataframe which must contain one column <code>calendar_age_BP</code>, and also
columns <code>c14_age</code> and <code>c14_sig</code> or <code>f14c</code> and <code>f14c_sig</code> (or both sets).
This format matches the curves supplied with this package, e.g., <a href="#topic+intcal20">intcal20</a>,
<a href="#topic+intcal13">intcal13</a>, which contain all 5 columns.</p>
</td></tr>
<tr><td><code id="PPcalibrate_+3A_f14c_inputs">F14C_inputs</code></td>
<td>
<p><code>TRUE</code> if the provided <code>rc_determinations</code> are F<code class="reqn">{}^{14}</code>C
concentrations and <code>FALSE</code> if they are radiocarbon ages. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="PPcalibrate_+3A_n_iter">n_iter</code></td>
<td>
<p>The number of MCMC iterations (optional). Default is 100,000.</p>
</td></tr>
<tr><td><code id="PPcalibrate_+3A_n_thin">n_thin</code></td>
<td>
<p>How much to thin the MCMC output (optional). Will store every
<code>n_thin</code><code class="reqn">{}^\textrm{th}</code> iteration. 1 is no thinning, while a larger number will result
in more thinning. Default is 10. Must choose an integer greater than 1. Overall
number of MCMC realisations stored will be <code class="reqn">n_{\textrm{out}} =
\textrm{floor}( n_{\textrm{iter}}/n_{\textrm{thin}}) + 1</code> so do not choose
<code>n_thin</code> too large to ensure there are enough samples from the posterior to
use for later inference.</p>
</td></tr>
<tr><td><code id="PPcalibrate_+3A_use_f14c_space">use_F14C_space</code></td>
<td>
<p>If <code>TRUE</code> (default) the calculations within the function are carried
out in F<code class="reqn">{}^{14}</code>C space. If <code>FALSE</code> they are carried out in <code class="reqn">{}^{14}</code>C
age space. We recommend selecting <code>TRUE</code> as, for very old samples, calibrating in
F<code class="reqn">{}^{14}</code>C space removes the potential affect of asymmetry in the radiocarbon age
uncertainty.
<em>Note:</em> This flag can be set independently of the format/scale on which
<code>rc_determinations</code> were originally provided.</p>
</td></tr>
<tr><td><code id="PPcalibrate_+3A_show_progress">show_progress</code></td>
<td>
<p>Whether to show a progress bar in the console during
execution. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="PPcalibrate_+3A_calendar_age_range">calendar_age_range</code></td>
<td>
<p>(Optional) Overall minimum and maximum calendar ages (in cal yr BP) permitted
for the set of radiocarbon samples, i.e., <code>calendar_age_range[1]</code> &lt; <code class="reqn">\theta_1, \ldots, \theta_n</code> &lt;
<code>calendar_age_range[1]</code>. This is used to bound the start and end of the Poisson process (so no events
will be permitted to occur outside this interval). If not selected then automated selection will be
made based on given <code>rc_determinations</code> and value of <code>bounding_range_prob_cutoff</code></p>
</td></tr>
<tr><td><code id="PPcalibrate_+3A_calendar_grid_resolution">calendar_grid_resolution</code></td>
<td>
<p>The spacing of the calendar age grid on which to restrict
the potential calendar ages of the samples, e.g., calendar ages of samples are limited to being one of
<code style="white-space: pre;">&#8288;t, t + resolution, t + 2 * resolution, ...&#8288;</code> Default is 1 (i.e., all calendar years in the overall
calendar range are considered). Primarily used to speed-up code if have large range, when may select
larger resolution.</p>
</td></tr>
<tr><td><code id="PPcalibrate_+3A_prior_h_shape">prior_h_shape</code>, <code id="PPcalibrate_+3A_prior_h_rate">prior_h_rate</code></td>
<td>
<p>(Optional) Prior for the value of the Poisson Process rate (the height <code>rate_h</code>)
in any specific interval:
</p>
<p style="text-align: center;"><code class="reqn">\textrm{rate}\_\textrm{h} \sim \textrm{Gamma}(
\textrm{shape} = \textrm{prior}\_\textrm{h}\_\textrm{shape},
\textrm{rate} = \textrm{prior}\_\textrm{h}\_\textrm{rate}).</code>
</p>

<p>If they are both <code>NA</code> then <code>prior_h_shape</code> is selected to be 1 (so <code>rate_h</code> follows an Exponential
distribution) and <code>prior_h_rate</code> chosen adaptively (internally) to match <code>n_observations</code>.</p>
</td></tr>
<tr><td><code id="PPcalibrate_+3A_prior_n_internal_changepoints_lambda">prior_n_internal_changepoints_lambda</code></td>
<td>
<p>Prior mean for the number of internal changepoints
in the rate <code class="reqn">\lambda(t)</code>.
</p>
<p style="text-align: center;"><code class="reqn">\textrm{n}\_\textrm{internal}\_\textrm{changepoints} \sim
\textrm{Po}(\textrm{prior}\_\textrm{n}\_\textrm{internal}\_\textrm{changepoints}\_\textrm{lambda})</code>
</p>
</td></tr>
<tr><td><code id="PPcalibrate_+3A_k_max_internal_changepoints">k_max_internal_changepoints</code></td>
<td>
<p>Maximum permitted number of internal changepoints</p>
</td></tr>
<tr><td><code id="PPcalibrate_+3A_rescale_factor_rev_jump">rescale_factor_rev_jump</code></td>
<td>
<p>Factor weighting probability of dimension change
in the reversible jump update step for Poisson process <code>rate_h</code> and <code>rate_s</code></p>
</td></tr>
<tr><td><code id="PPcalibrate_+3A_bounding_range_prob_cutoff">bounding_range_prob_cutoff</code></td>
<td>
<p>Probability cut-off for choosing the bounds for the
potential calendar ages for the observations</p>
</td></tr>
<tr><td><code id="PPcalibrate_+3A_initial_n_internal_changepoints">initial_n_internal_changepoints</code></td>
<td>
<p>Number of internal changepoints to initialise MCMC sampler with.
The default is 10 (so initialise with diffuse state). Will place these initial changepoints uniformly at random
within overall calendar age range.</p>
</td></tr>
<tr><td><code id="PPcalibrate_+3A_grid_extension_factor">grid_extension_factor</code></td>
<td>
<p>If you adaptively select the <code>calendar_age_range</code> from <code>rc_determinations</code>, how
far you wish to extend the grid beyond this adaptive minimum and maximum. The final range will be extended
(equally on both sides) to cover <code>(1 + grid_extension_factor) * (calendar_age_range)</code></p>
</td></tr>
<tr><td><code id="PPcalibrate_+3A_use_fast">use_fast</code>, <code id="PPcalibrate_+3A_fast_approx_prob_cutoff">fast_approx_prob_cutoff</code></td>
<td>
<p>A flag to allow trimming the calendar age likelihood (i.e., reducing the
range of calendar ages) for each individual sample to speed up the sampler. If <code>TRUE</code> (default), for each
individual sample, those tail calendar ages (in the overall <code>calendar_age_grid</code>) with very small likelihoods will
be trimmed (speeding up the updating of the calendar ages). If <code>TRUE</code> the probability cut-off to remove the tails
is <code>fast_approx_prob_cutoff</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with 7 items. The first 4 items contain output of the model, each of
which has one dimension of size <code class="reqn">n_{\textrm{out}} =
\textrm{floor}( n_{\textrm{iter}}/n_{\textrm{thin}}) + 1</code>. The rows in these items store
the state of the MCMC from every <code class="reqn">n_{\textrm{thin}}</code><code class="reqn">{}^\textrm{th}</code> iteration:
</p>

<dl>
<dt><code>rate_s</code></dt><dd><p>A list of length <code class="reqn">n_{\textrm{out}}</code> each entry giving the current set of
(calendar age) changepoint locations in the piecewise-constant rate <code class="reqn">\lambda(t)</code>.</p>
</dd>
<dt><code>rate_h</code></dt><dd><p>A list of length <code class="reqn">n_{\textrm{out}}</code> each entry giving the current set of
heights (values for the rate) in each piecewise-constant section of <code class="reqn">\lambda(t)</code>.</p>
</dd>
<dt><code>calendar_ages</code></dt><dd><p>An <code class="reqn">n_{\textrm{out}}</code> by <code class="reqn">n_{\textrm{obs}}</code>
matrix. Gives the current estimate for the calendar age of each individual
observation.</p>
</dd>
<dt><code>n_internal_changes</code></dt><dd><p>A vector of length <code class="reqn">n_{\textrm{out}}</code> giving the current number of
internal changes in the value of <code class="reqn">\lambda(t)</code>.</p>
</dd>
</dl>

<p>where <code class="reqn">n_{\textrm{obs}}</code> is the number of radiocarbon observations, i.e.,
the length of <code>rc_determinations</code>.
</p>
<p>The remaining items give information about input data, input parameters (or
those calculated) and update_type
</p>

<dl>
<dt><code>update_type</code></dt><dd><p>A string that always has the value &quot;RJPP&quot;.</p>
</dd>
<dt><code>input_data</code></dt><dd><p>A list containing the <code class="reqn">{}^{14}</code>C data used, and the name of
the calibration curve used.</p>
</dd>
<dt><code>input_parameters</code></dt><dd><p>A list containing the values of the fixed
parameters <code>pp_cal_age_range</code>, <code>prior_n_internal_changepoints_lambda</code>,
<code>k_max_internal_changepoints</code>, <code>prior_h_shape</code>, <code>prior_h_rate</code>, <code>rescale_factor_rev_jump</code>,
<code>calendar_age_grid</code>, <code>calendar_grid_resolution</code>, <code>n_iter</code> and <code>n_thin</code>.</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'># NOTE: This example is shown with a small n_iter to speed up execution.
# When you run ensure n_iter gives convergence (try function default).

pp_output &lt;- PPcalibrate(
    pp_uniform_phase$c14_age,
    pp_uniform_phase$c14_sig,
    intcal20,
    n_iter = 100,
    show_progress = FALSE)
</code></pre>

<hr>
<h2 id='shcal04'>SHCal04 calibration curve</h2><span id='topic+shcal04'></span>

<h3>Description</h3>

<p>The SHCal04 Southern Hemisphere radiocarbon age calibration curve
on a calendar grid spanning from 11,000&ndash;0 cal yr BP
(Before Present, 0 cal yr BP corresponds to 1950 CE). <br /> <br />
<em>Note:</em> This dataset provides <code class="reqn">{}^{14}</code>C ages and F<code class="reqn">{}^{14}</code>C values
on a calendar age grid. This is different from the <code class="reqn">{}^{14}</code>C ages
and <code class="reqn">{\Delta}^{14}</code>C values provided in oxcal .14c files.<br /> <br />
<strong>Reference:</strong> <br /> FG McCormac, AG Hogg, PG Blackwell, CE Buck, TFG Higham, and PJ Reimer
2004.
SHCal04 Southern Hemisphere Calibration 0&ndash;11.0 cal kyr BP.
<em>Radiocarbon</em> <strong>46</strong>(3):1087&ndash;1092 https://doi.org/10.1017/S0033822200033014. <br /> <br />
</p>


<h3>Usage</h3>

<pre><code class='language-R'>shcal04
</code></pre>


<h3>Format</h3>



<h4><code>shcal04</code></h4>

<p>A data frame with 2,202 rows and 5 columns providing the SHCal04 radiocarbon age
calibration curve on a calendar grid spanning from 11,000&ndash;0 cal yr BP:
</p>

<dl>
<dt>calendar_age</dt><dd><p>The calendar age (in cal yr BP)</p>
</dd>
<dt>c14_age</dt><dd><p>The <code class="reqn">{}^{14}</code>C age (in <code class="reqn">{}^{14}</code>C yr BP)</p>
</dd>
<dt>c14_sig</dt><dd><p>The (1-<code class="reqn">\sigma</code>) uncertainty in the <code class="reqn">{}^{14}</code>C age</p>
</dd>
<dt>f14c</dt><dd><p>The <code class="reqn">{}^{14}</code>C age expressed as F<code class="reqn">{}^{14}</code>C concentration</p>
</dd>
<dt>f14c_sig</dt><dd><p>The (1-<code class="reqn">\sigma</code>) uncertainty in the F<code class="reqn">{}^{14}</code>C concentration</p>
</dd>
</dl>




<h3>Source</h3>

<p>http://doi.org/10.1017/S0033822200033014
</p>

<hr>
<h2 id='shcal13'>SHCal13 calibration curve</h2><span id='topic+shcal13'></span>

<h3>Description</h3>

<p>The SHCal13 Southern Hemisphere radiocarbon age calibration curve
on a calendar grid spanning from 50,000&ndash;0 cal yr BP
(Before Present, 0 cal yr BP corresponds to 1950 CE). <br /> <br />
<em>Note:</em> This dataset provides <code class="reqn">{}^{14}</code>C ages and F<code class="reqn">{}^{14}</code>C values
on a calendar age grid. This is different from the <code class="reqn">{}^{14}</code>C ages
and <code class="reqn">{\Delta}^{14}</code>C values provided in oxcal .14c files.<br /> <br />
<strong>Reference:</strong> <br /> Alan G Hogg, Quan Hua, Paul G Blackwell, Caitlin E Buck, Thomas P Guilderson,
Timothy J  Heaton, Mu Niu, Jonathan G Palmer, Paula J Reimer, Ron W Reimer,
Christian S M Turney, Susan R H Zimmerman. 2013.
SHCal13 Southern Hemisphere Calibration, 0-50,000 Years cal BP.
<em>Radiocarbon</em> <strong>55</strong>(4):1889&ndash;1903 https://doi.org/10.2458/azu_js_rc.55.16783. <br /> <br />
</p>


<h3>Usage</h3>

<pre><code class='language-R'>shcal13
</code></pre>


<h3>Format</h3>



<h4><code>shcal13</code></h4>

<p>A data frame with 5,141 rows and 5 columns providing the SHCal13 radiocarbon age
calibration curve on a calendar grid spanning from 50,000&ndash;0 cal yr BP:
</p>

<dl>
<dt>calendar_age</dt><dd><p>The calendar age (in cal yr BP)</p>
</dd>
<dt>c14_age</dt><dd><p>The <code class="reqn">{}^{14}</code>C age (in <code class="reqn">{}^{14}</code>C yr BP)</p>
</dd>
<dt>c14_sig</dt><dd><p>The (1-<code class="reqn">\sigma</code>) uncertainty in the <code class="reqn">{}^{14}</code>C age</p>
</dd>
<dt>f14c</dt><dd><p>The <code class="reqn">{}^{14}</code>C age expressed as F<code class="reqn">{}^{14}</code>C concentration</p>
</dd>
<dt>f14c_sig</dt><dd><p>The (1-<code class="reqn">\sigma</code>) uncertainty in the F<code class="reqn">{}^{14}</code>C concentration</p>
</dd>
</dl>




<h3>Source</h3>

<p>http://doi.org/10.2458/azu_js_rc.55.16783
</p>

<hr>
<h2 id='shcal20'>SHCal20 calibration curve</h2><span id='topic+shcal20'></span>

<h3>Description</h3>

<p>The SHCal20 Southern Hemisphere radiocarbon age calibration curve
on a calendar grid spanning from 55,000&ndash;0 cal yr BP
(Before Present, 0 cal yr BP corresponds to 1950 CE). <br /> <br />
<em>Note:</em> This dataset provides <code class="reqn">{}^{14}</code>C ages and F<code class="reqn">{}^{14}</code>C values
on a calendar age grid. This is different from the <code class="reqn">{}^{14}</code>C ages
and <code class="reqn">{\Delta}^{14}</code>C values provided in oxcal .14c files.<br /> <br />
<strong>Reference:</strong> <br /> Hogg AG, Heaton TJ, Hua Q, Palmer JG, Turney CSM, Southon J, Bayliss A, Blackwell PG,
Boswijk G, Bronk Ramsey C, Pearson C, Petchey F, Reimer P, Reimer R, Wacker L.
2020.
SHCal20 Southern Hemisphere calibration, 0&ndash;55,000 years cal BP.
<em>Radiocarbon</em> <strong>62</strong> https://doi.org/10.1017/RDC.2020.59. <br /> <br />
</p>


<h3>Usage</h3>

<pre><code class='language-R'>shcal20
</code></pre>


<h3>Format</h3>



<h4><code>shcal20</code></h4>

<p>A data frame with 9,501 rows and 5 columns providing the SHCal20 radiocarbon age
calibration curve on a calendar grid spanning from 55,000&ndash;0 cal yr BP:
</p>

<dl>
<dt>calendar_age</dt><dd><p>The calendar age (in cal yr BP)</p>
</dd>
<dt>c14_age</dt><dd><p>The <code class="reqn">{}^{14}</code>C age (in <code class="reqn">{}^{14}</code>C yr BP)</p>
</dd>
<dt>c14_sig</dt><dd><p>The (1-<code class="reqn">\sigma</code>) uncertainty in the <code class="reqn">{}^{14}</code>C age</p>
</dd>
<dt>f14c</dt><dd><p>The <code class="reqn">{}^{14}</code>C age expressed as F<code class="reqn">{}^{14}</code>C concentration</p>
</dd>
<dt>f14c_sig</dt><dd><p>The (1-<code class="reqn">\sigma</code>) uncertainty in the F<code class="reqn">{}^{14}</code>C concentration</p>
</dd>
</dl>




<h3>Source</h3>

<p>http://doi.org/10.1017/RDC.2020.59
</p>

<hr>
<h2 id='two_normals'>Example artificial data - Mixture of Normal Phases</h2><span id='topic+two_normals'></span>

<h3>Description</h3>

<p>50 simulated radiocarbon determinations for which the underlying calendar ages are
drawn from a mixture of two normals:
</p>
<p style="text-align: center;"><code class="reqn">f(\theta) = 0.45 N(3500, 200^2) + 0.55 N(5000, 100^2) </code>
</p>

<p>i.e., a mixture of a normal centred around 3500 cal yr BP; and another
(slightly more concentrated/narrower) normal centred around 5000 cal yr BP. <br /> <br />
The corresponding 50 radiocarbon ages were then simulated using the IntCal20 calibration curve
incorporating both the uncertainty in the calibration curve and a hypothetical measurement
uncertainty:
</p>
<p style="text-align: center;"><code class="reqn">X_i | \theta_i \sim N(m(\theta_i), \rho(\theta_i)^2 + \sigma_{i,\textrm{lab}}^2),</code>
</p>

<p>where <code class="reqn">m(\theta_i)</code> and <code class="reqn">\rho(\theta_i)</code> are the IntCal20 pointwise
means and uncertainties; and <code class="reqn">\sigma_{i,\textrm{lab}}</code>, the simulated
laboratory measurement uncertainty, was fixed at a common value of 25 <code class="reqn">{}^{14}</code>C yrs. <br /> <br />
This dataset is included simply to give some quick-to-run examples.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>two_normals
</code></pre>


<h3>Format</h3>



<h4><code>two_normals</code></h4>

<p>A data frame with 50 rows and 4 columns:
</p>

<dl>
<dt>c14_age</dt><dd><p>The simulated <code class="reqn">{}^{14}</code>C age (in <code class="reqn">{}^{14}</code>C yr BP)</p>
</dd>
<dt>c14_sig</dt><dd><p>The (fixed) <code class="reqn">{}^{14}</code>C age measurement uncertainty used in the simulation (set at 25 <code class="reqn">{}^{14}</code>C yrs)</p>
</dd>
<dt>f14c</dt><dd><p>The corresponding simulated values of F<code class="reqn">{}^{14}</code>C concentration</p>
</dd>
<dt>f14c_sig</dt><dd><p>The (fixed) corresponding F<code class="reqn">{}^{14}</code>C measurement uncertainty used in the simulation</p>
</dd>
</dl>




<h3>Examples</h3>

<pre><code class='language-R'># Plotting calendar age density underlying two_normals
# Useful for comparisons against estimation techniques
weights_true &lt;- c(0.45, 0.55)
cluster_means_true_calBP &lt;- c(3500, 5000)
cluster_precisions_true &lt;- 1 / c(200, 100)^2

# Create mixture density
truedens &lt;- function(t, w, truemean, trueprec) {
  dens &lt;- 0
  for(i in 1:length(w)) {
    dens &lt;- dens + w[i] * dnorm(t, mean = truemean[i], sd = 1/sqrt(trueprec[i]))
  }
  dens
}

# Visualise mixture
curve(truedens(
  x,
  w = weights_true,
  truemean = cluster_means_true_calBP,
  trueprec = cluster_precisions_true),
  from = 2500, to = 7000, n = 401,
  xlim = c(7000, 2500),
  xlab = "Calendar Age (cal yr BP)",
  ylab = "Density",
  col = "red"
)

</code></pre>

<hr>
<h2 id='WalkerBivarDirichlet'>Calibrate and Summarise Multiple Radiocarbon Samples via
a Bayesian Non-Parametric DPMM (with Walker Updating)</h2><span id='topic+WalkerBivarDirichlet'></span>

<h3>Description</h3>

<p>This function calibrates sets of multiple radiocarbon (<code class="reqn">{}^{14}</code>C)
determinations, and simultaneously summarises the resultant calendar age information.
This is achieved using Bayesian non-parametric density estimation,
providing a statistically-rigorous alternative to summed probability
distributions (SPDs).
</p>
<p>It takes as an input a set of <code class="reqn">{}^{14}</code>C determinations and associated <code class="reqn">1\sigma</code>
uncertainties, as well as the radiocarbon age calibration curve to be used. The samples
are assumed to arise from an (unknown) shared calendar age distribution <code class="reqn">f(\theta)</code> that
we would like to estimate, alongside performing calibration of each sample.
</p>
<p>The function models the underlying distribution <code class="reqn">f(\theta)</code> as a Dirichlet process
mixture model (DPMM), whereby the samples are considered to arise from an unknown number of
distinct clusters. Fitting is achieved via MCMC.
</p>
<p>It returns estimates for the calendar age of each individual radiocarbon sample; and broader
output (the weights, means and variances of the underpinning calendar age clusters)
that can be used by other library functions to provide a predictive estimate of the
shared calendar age density <code class="reqn">f(\theta)</code>.
</p>
<p>For more information read the vignette: <br />
<code>vignette("Non-parametric-summed-density", package = "carbondate")</code>
</p>
<p><strong>Note:</strong> The library provides two slightly-different update schemes for the MCMC. In this particular function, updating of the DPMM is achieved by slice sampling
(Walker 2007). We recommend use of the alternative to this, implemented at <a href="#topic+PolyaUrnBivarDirichlet">PolyaUrnBivarDirichlet</a>
</p>
<p><strong>Reference:</strong> <br />
Heaton, TJ. 2022. Non-parametric Calibration of Multiple Related Radiocarbon
Determinations and their Calendar Age Summarisation. <em>Journal of the Royal Statistical
Society Series C: Applied Statistics</em> <strong>71</strong> (5):1918-56. https://doi.org/10.1111/rssc.12599. <br />
Walker, SG. 2007. Sampling the Dirichlet Mixture Model with Slices. <em>Communications in
Statistics - Simulation and Computation</em> <strong>36</strong> (1):45-54. https://doi.org/10.1080/03610910601096262.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>WalkerBivarDirichlet(
  rc_determinations,
  rc_sigmas,
  calibration_curve,
  F14C_inputs = FALSE,
  n_iter = 1e+05,
  n_thin = 10,
  use_F14C_space = TRUE,
  slice_width = NA,
  slice_multiplier = 10,
  show_progress = TRUE,
  sensible_initialisation = TRUE,
  lambda = NA,
  nu1 = NA,
  nu2 = NA,
  A = NA,
  B = NA,
  alpha_shape = NA,
  alpha_rate = NA,
  mu_phi = NA,
  calendar_ages = NA,
  n_clust = min(10, length(rc_determinations))
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="WalkerBivarDirichlet_+3A_rc_determinations">rc_determinations</code></td>
<td>
<p>A vector of observed radiocarbon determinations. Can be provided either as
<code class="reqn">{}^{14}</code>C ages (in <code class="reqn">{}^{14}</code>C yr BP) or as F<code class="reqn">{}^{14}</code>C concentrations.</p>
</td></tr>
<tr><td><code id="WalkerBivarDirichlet_+3A_rc_sigmas">rc_sigmas</code></td>
<td>
<p>A vector of the (1-sigma) measurement uncertainties for the
radiocarbon determinations. Must be the same length as <code>rc_determinations</code> and
given in the same units.</p>
</td></tr>
<tr><td><code id="WalkerBivarDirichlet_+3A_calibration_curve">calibration_curve</code></td>
<td>
<p>A dataframe which must contain one column <code>calendar_age_BP</code>, and also
columns <code>c14_age</code> and <code>c14_sig</code> or <code>f14c</code> and <code>f14c_sig</code> (or both sets).
This format matches the curves supplied with this package, e.g., <a href="#topic+intcal20">intcal20</a>,
<a href="#topic+intcal13">intcal13</a>, which contain all 5 columns.</p>
</td></tr>
<tr><td><code id="WalkerBivarDirichlet_+3A_f14c_inputs">F14C_inputs</code></td>
<td>
<p><code>TRUE</code> if the provided <code>rc_determinations</code> are F<code class="reqn">{}^{14}</code>C
concentrations and <code>FALSE</code> if they are radiocarbon ages. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="WalkerBivarDirichlet_+3A_n_iter">n_iter</code></td>
<td>
<p>The number of MCMC iterations (optional). Default is 100,000.</p>
</td></tr>
<tr><td><code id="WalkerBivarDirichlet_+3A_n_thin">n_thin</code></td>
<td>
<p>How much to thin the MCMC output (optional). Will store every
<code>n_thin</code><code class="reqn">{}^\textrm{th}</code> iteration. 1 is no thinning, while a larger number will result
in more thinning. Default is 10. Must choose an integer greater than 1. Overall
number of MCMC realisations stored will be <code class="reqn">n_{\textrm{out}} =
\textrm{floor}( n_{\textrm{iter}}/n_{\textrm{thin}}) + 1</code> so do not choose
<code>n_thin</code> too large to ensure there are enough samples from the posterior to
use for later inference.</p>
</td></tr>
<tr><td><code id="WalkerBivarDirichlet_+3A_use_f14c_space">use_F14C_space</code></td>
<td>
<p>If <code>TRUE</code> (default) the calculations within the function are carried
out in F<code class="reqn">{}^{14}</code>C space. If <code>FALSE</code> they are carried out in <code class="reqn">{}^{14}</code>C
age space. We recommend selecting <code>TRUE</code> as, for very old samples, calibrating in
F<code class="reqn">{}^{14}</code>C space removes the potential affect of asymmetry in the radiocarbon age
uncertainty.
<em>Note:</em> This flag can be set independently of the format/scale on which
<code>rc_determinations</code> were originally provided.</p>
</td></tr>
<tr><td><code id="WalkerBivarDirichlet_+3A_slice_width">slice_width</code></td>
<td>
<p>Parameter for slice sampling (optional). If not given a value
is chosen intelligently based on the spread of the initial calendar ages.
Must be given if <code>sensible_initialisation</code> is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="WalkerBivarDirichlet_+3A_slice_multiplier">slice_multiplier</code></td>
<td>
<p>Integer parameter for slice sampling (optional).
Default is 10. Limits the slice size to <code>slice_multiplier * slice_width</code>.</p>
</td></tr>
<tr><td><code id="WalkerBivarDirichlet_+3A_show_progress">show_progress</code></td>
<td>
<p>Whether to show a progress bar in the console during
execution. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="WalkerBivarDirichlet_+3A_sensible_initialisation">sensible_initialisation</code></td>
<td>
<p>Whether to use sensible values to initialise the sampler
and an automated (adaptive) prior on <code class="reqn">\mu_{\phi}</code> and (A, B) that is informed
by the observed <code>rc_determinations</code>. If this is <code>TRUE</code> (the recommended default), then
all the remaining arguments below are ignored.</p>
</td></tr>
<tr><td><code id="WalkerBivarDirichlet_+3A_lambda">lambda</code>, <code id="WalkerBivarDirichlet_+3A_nu1">nu1</code>, <code id="WalkerBivarDirichlet_+3A_nu2">nu2</code></td>
<td>
<p>Hyperparameters for the prior on the mean
<code class="reqn">\phi_j</code> and precision <code class="reqn">\tau_j</code> of each individual calendar age
cluster <code class="reqn">j</code>:
</p>
<p style="text-align: center;"><code class="reqn">(\phi_j, \tau_j)|\mu_{\phi} \sim
\textrm{NormalGamma}(\mu_{\phi}, \lambda, \nu_1, \nu_2)</code>
</p>
<p> where
<code class="reqn">\mu_{\phi}</code> is the overall cluster centering. Required if
<code>sensible_initialisation</code> is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="WalkerBivarDirichlet_+3A_a">A</code>, <code id="WalkerBivarDirichlet_+3A_b">B</code></td>
<td>
<p>Prior on <code class="reqn">\mu_{\phi}</code> giving the mean and precision of the
overall centering <code class="reqn">\mu_{\phi} \sim N(A, B^{-1})</code>. Required if <code>sensible_initialisation</code> is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="WalkerBivarDirichlet_+3A_alpha_shape">alpha_shape</code>, <code id="WalkerBivarDirichlet_+3A_alpha_rate">alpha_rate</code></td>
<td>
<p>Shape and rate hyperparameters that specify
the prior for the Dirichlet Process (DP) concentration, <code class="reqn">\alpha</code>. This
concentration <code class="reqn">\alpha</code> determines the number of clusters we
expect to observe among our <code class="reqn">n</code> sampled objects. The model
places a prior on
<code class="reqn">\alpha \sim \Gamma(\eta_1, \eta_2)</code>, where <code class="reqn">\eta_1, \eta_2</code> are
the <code>alpha_shape</code> and <code>alpha_rate</code>. A small <code class="reqn">\alpha</code> means the DPMM is
more concentrated (i.e. we expect fewer calendar age clusters) while a large alpha means it is less
less concentrated (i.e. many clusters). Required if <code>sensible_initialisation</code> is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="WalkerBivarDirichlet_+3A_mu_phi">mu_phi</code></td>
<td>
<p>Initial value of the overall cluster centering <code class="reqn">\mu_{\phi}</code>.
Required if <code>sensible_initialisation</code> is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="WalkerBivarDirichlet_+3A_calendar_ages">calendar_ages</code></td>
<td>
<p>The initial estimate for the underlying calendar ages
(optional). If supplied, it must be a vector with the same length as
<code>rc_determinations</code>.  Required if <code>sensible_initialisation</code> is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="WalkerBivarDirichlet_+3A_n_clust">n_clust</code></td>
<td>
<p>The number of clusters with which to initialise the sampler (optional). Must
be less than the length of <code>rc_determinations</code>. Default is 10 or the length
of <code>rc_determinations</code> if that is less than 10.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with 11 items. The first 8 items contain output of the model, each of
which has one dimension of size <code class="reqn">n_{\textrm{out}} =
\textrm{floor}( n_{\textrm{iter}}/n_{\textrm{thin}}) + 1</code>. The rows in these items store
the state of the MCMC from every <code class="reqn">n_{\textrm{thin}}</code><code class="reqn">{}^\textrm{th}</code> iteration:
</p>

<dl>
<dt><code>cluster_identifiers</code></dt><dd><p>An <code class="reqn">n_{\textrm{out}}</code> by
<code class="reqn">n_{\textrm{obs}}</code> integer matrix. Provides the cluster allocation
(an integer between 1 and <code>n_clust</code>) for each observation on the relevant MCMC iteration.
Information on the state of these calendar age clusters (means, precisions, and weights)
can be found in the other output items.</p>
</dd>
<dt><code>alpha</code></dt><dd><p>A double vector of length <code class="reqn">n_{\textrm{out}}</code> giving the Dirichlet Process
concentration parameter <code class="reqn">\alpha</code>.</p>
</dd>
<dt><code>n_clust</code></dt><dd><p>An integer vector of length <code class="reqn">n_{\textrm{out}}</code> giving
the current number of clusters in the model.</p>
</dd>
<dt><code>phi</code></dt><dd><p>A list of length <code class="reqn">n_{\textrm{out}}</code> each entry giving
a vector of the means of the current calendar age clusters <code class="reqn">\phi_j</code>.</p>
</dd>
<dt><code>tau</code></dt><dd><p>A list of length <code class="reqn">n_{\textrm{out}}</code> each entry giving
a vector of the precisions of the current calendar age clusters <code class="reqn">\tau_j</code>.</p>
</dd>
<dt><code>weight</code></dt><dd><p>A list of length <code class="reqn">n_{\textrm{out}}</code> each entry giving
the mixing weights of each calendar age cluster.</p>
</dd>
<dt><code>calendar_ages</code></dt><dd><p>An <code class="reqn">n_{\textrm{out}}</code> by <code class="reqn">n_{\textrm{obs}}</code>
integer matrix. Gives the current estimate for the calendar age of each individual
observation.</p>
</dd>
<dt><code>mu_phi</code></dt><dd><p>A vector of length <code class="reqn">n_{\textrm{out}}</code> giving the overall
centering <code class="reqn">\mu_{\phi}</code> of the calendar age clusters.</p>
</dd>
</dl>

<p>where <code class="reqn">n_{\textrm{obs}}</code> is the number of radiocarbon observations, i.e.,
the length of <code>rc_determinations</code>.
</p>
<p>The remaining items give information about the input data, input parameters (or
those calculated using <code>sensible_initialisation</code>) and the update_type
</p>

<dl>
<dt><code>update_type</code></dt><dd><p>A string that always has the value &quot;Walker&quot;.</p>
</dd>
<dt><code>input_data</code></dt><dd><p>A list containing the <code class="reqn">{}^{14}</code>C data used, and the name of
the calibration curve used.</p>
</dd>
<dt><code>input_parameters</code></dt><dd><p>A list containing the values of the fixed
hyperparameters <code>lambda</code>, <code>nu1</code>, <code>nu2</code>, <code>A</code>, <code>B</code>, <code>alpha_shape</code>, and
<code>alpha_rate</code>, and the slice parameters <code>slice_width</code> and
<code>slice_multiplier</code>.</p>
</dd>
</dl>



<h3>See Also</h3>

<p><a href="#topic+PolyaUrnBivarDirichlet">PolyaUrnBivarDirichlet</a> for our preferred MCMC method to update the Bayesian DPMM
(otherwise an identical model); and <a href="#topic+PlotCalendarAgeDensityIndividualSample">PlotCalendarAgeDensityIndividualSample</a>,
<a href="#topic+PlotPredictiveCalendarAgeDensity">PlotPredictiveCalendarAgeDensity</a> and <a href="#topic+PlotNumberOfClusters">PlotNumberOfClusters</a>
to access the model output and estimate the calendar age information. <br /> <br />
See also <a href="#topic+PPcalibrate">PPcalibrate</a> for an an alternative (similarly rigorous) approach to
calibration and summarisation of related radiocarbon determinations using a variable-rate Poisson process
</p>


<h3>Examples</h3>

<pre><code class='language-R'># NOTE: These examples are shown with a small n_iter to speed up execution.
# When you run ensure n_iter gives convergence (try function default).

walker_output &lt;- WalkerBivarDirichlet(
    two_normals$c14_age,
    two_normals$c14_sig,
    intcal20,
    n_iter = 100,
    show_progress = FALSE)

# The radiocarbon determinations can be given as F14C concentrations
walker_output &lt;- WalkerBivarDirichlet(
    two_normals$f14c,
    two_normals$f14c_sig,
    intcal20,
    F14C_inputs = TRUE,
    n_iter = 100,
    show_progress = FALSE)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
