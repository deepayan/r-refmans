<!DOCTYPE html><html><head><title>Help for package efdm</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {efdm}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#define_activity'><p>Define an activity</p></a></li>
<li><a href='#estimatetransprobs'><p>Estimate Transition Probabilities from Pairdata</p></a></li>
<li><a href='#example'><p>Example dataset.</p></a></li>
<li><a href='#MetsaKasvVyoh'><p>Finnish bio-geographical regions</p></a></li>
<li><a href='#prior_ff'><p>Priors for <code>estimatetransprobs</code></p></a></li>
<li><a href='#runEFDM'><p>Run European Forestry Dynamics Model</p></a></li>
<li><a href='#transprobs+26lt+3B-'><p>Transition probabilities of an activity</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Simulate Forest Resources with the European Forestry Dynamics
Model</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.1</td>
</tr>
<tr>
<td>Description:</td>
<td>An implementation of European Forestry Dynamics Model (EFDM) and
    an estimation algorithm for the transition probabilities.
    The EFDM is a large-scale forest model that simulates the development of
    the forest and estimates volume of wood harvested for any given forested
    area. This estimate can be broken down by, for example, species, site
    quality, management regime and ownership category.
    See Packalen et al. (2015) &lt;<a href="https://doi.org/10.2788%2F153990">doi:10.2788/153990</a>&gt;.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/mikkoku/efdm">https://github.com/mikkoku/efdm</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/mikkoku/efdm/issues">https://github.com/mikkoku/efdm/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats, utils, data.table</td>
</tr>
<tr>
<td>Suggests:</td>
<td>dplyr, ggplot2, gridExtra, knitr, rmarkdown, sf, testthat</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-08-15 11:15:17 UTC; 03052156</td>
</tr>
<tr>
<td>Author:</td>
<td>Mikko Kuronen <a href="https://orcid.org/0000-0002-8089-7895"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Minna RÃ¤ty <a href="https://orcid.org/0000-0001-9898-8712"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Mikko Kuronen &lt;mikko.kuronen@luke.fi&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-08-17 08:52:33 UTC</td>
</tr>
</table>
<hr>
<h2 id='define_activity'>Define an activity</h2><span id='topic+define_activity'></span>

<h3>Description</h3>

<p>Define an activity
</p>


<h3>Usage</h3>

<pre><code class='language-R'>define_activity(name, dynamicvariables, transprobs = NULL, probname = name)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="define_activity_+3A_name">name</code></td>
<td>
<p>Name of activity used in reporting</p>
</td></tr>
<tr><td><code id="define_activity_+3A_dynamicvariables">dynamicvariables</code></td>
<td>
<p>Names of variables where changes happen</p>
</td></tr>
<tr><td><code id="define_activity_+3A_transprobs">transprobs</code></td>
<td>
<p>Transition probabilities (<code>data.frame</code>)</p>
</td></tr>
<tr><td><code id="define_activity_+3A_probname">probname</code></td>
<td>
<p>(optional) Name of activity in activity probabilities data</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The set of activities in EFDM defines all possible alternatives for a forest
stratum to develop during a scenario run step. Therefore activities are not only
limited to forest treatments and management actions such as thinnings and final fellings
but should also include 'no management' i.e. growth, if applicable. An activity may
also be something else affecting the development, for example, a forest hazard:
snow, wind, drought, pest damage etc.
</p>
<p><code>name</code> is used as the name of the activity in the result of <code><a href="#topic+runEFDM">runEFDM</a></code>
and it is used to identify the activity probability.
If multiple activities should be reported under a common name, <code>actprobname</code> can
be used to specify the activity name in activity probability data.
</p>
<p><code>dynamicvariables</code> are those (state space) variables which change as
a result of the activity
Typically an activity affects on the age, volume or stem count of the
forest, but an activity may also, for example, change land-use and then
a variable related to land-use categories is essential.
</p>
<p>The <code>transprobs</code> should be a <code>data.frame</code> with columns:
</p>

<ul>
<li><p> pairs of dynamic variables. For example, if the dynamic variables are
<code>vol</code> and <code>age</code>, then transprobs should have columns
<code>age0</code>, <code>age1</code>, <code>vol0</code>, <code>vol1</code>.
</p>
</li>
<li><p> the probability of transition <code>prob</code>
</p>
</li>
<li><p> and possibly other variables affecting the transition probabilities.
For example <code>soiltype</code>, <code>treespecies</code>, etc.
</p>
</li></ul>

<p><code><a href="#topic+estimatetransprobs">estimatetransprobs</a></code> can be used to estimate transition probabilities
from a similar set of pair data of observations.
</p>


<h3>Value</h3>

<p>An activity definition
</p>


<h3>Examples</h3>

<pre><code class='language-R'>define_activity("nomanagement", c("vol", "age"))
</code></pre>

<hr>
<h2 id='estimatetransprobs'>Estimate Transition Probabilities from Pairdata</h2><span id='topic+estimatetransprobs'></span>

<h3>Description</h3>

<p>Estimate Transition Probabilities from Pairdata
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimatetransprobs(
  dynamicvariables,
  pairdata,
  statespace,
  factors = character(),
  by = character(),
  prior = "nochange"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estimatetransprobs_+3A_dynamicvariables">dynamicvariables</code></td>
<td>
<p>The names of the dynamic variables, <code>character</code> vector</p>
</td></tr>
<tr><td><code id="estimatetransprobs_+3A_pairdata">pairdata</code></td>
<td>
<p><code>data.frame</code> Observed transitions</p>
</td></tr>
<tr><td><code id="estimatetransprobs_+3A_statespace">statespace</code></td>
<td>
<p><code>data.frame</code> or a <code>list</code> of two <code>data.frame</code>s if the state space changes as a result of the activity</p>
</td></tr>
<tr><td><code id="estimatetransprobs_+3A_factors">factors</code></td>
<td>
<p><code>character</code> Variables used by the activity</p>
</td></tr>
<tr><td><code id="estimatetransprobs_+3A_by">by</code></td>
<td>
<p><code>character</code> Variables that split the state space</p>
</td></tr>
<tr><td><code id="estimatetransprobs_+3A_prior">prior</code></td>
<td>
<p>function or character</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Transition probabilities 'move' the forest areas allocated in the cells of state matrix
from the initial states in the beginning of a EFDM run step to the end position. This end
position will be the initial state of the next EFDM step. Length of a step (=time)
in the EFDM run is typically determined by the pairdata. It is the time difference of
tree observations. Note that the pairdata can be also constructed from single observation,
if the other (pair) observation is estimated or modelled.
</p>
<p>Each activity needs to have a transition probability. If no pairdata is available,
transition probability matrices can be based entirely on a prior defined with
expert knowledge.
</p>
<p>The estimation uses an iterative Bayesian algorithm that is explained in
<a href="https://github.com/ec-jrc/efdm/blob/master/documents/EFDMinstructions/Seija_Mathematics_behind_EFDM.pdf">https://github.com/ec-jrc/efdm/blob/master/documents/EFDMinstructions/Seija_Mathematics_behind_EFDM.pdf</a>.
The transition probability estimate is the proportion of observed transitions
divided by the number of all transitions from the same starting state.
<code>prior</code> gives the number of prior transitions. For each <code>factor</code>
variable the transitions are counted in classes of all factors before the
current factor. The &quot;most important&quot; observations (having all classes right)
is counted <code>length(factors)</code> times, the second most important observations
are counted <code>length(factors)-1</code> times and so on.
</p>
<p>If pairdata is NULL prior is used by itself.
</p>
<p>Observations should have 'factor' and 'by' variables and statepairs with 0 and 1
suffixes to indicate before and after observations.
</p>
<p>The estimation algorithm uses information across 'factor' variables, but not
across 'by' variables.
</p>
<p><code>prior</code> can either <code>character</code> or <code>function</code>.
</p>

<ul>
<li><p> &quot;nochange&quot; implies that there is one observation where state doesn't change
</p>
</li>
<li><p> &quot;uninformative&quot; when no observations are given all states are as likely
</p>
</li>
<li> <p><code>function(A, dynvar1, dynvar0)</code> where A is an array of zeros with
dimnames(A) &lt;- c(dynvar1, dynvar0). The function should fill A with the number of
prior transitions and return it.
</p>
</li></ul>

<p>The statespace is used to fill in the transitions where there are no observations.
In special cases the statespace may change as a result of the activity.
For example changing the tree species might lead to change in the volume classification used.
</p>
<p>This function assumes that the dynamic variables are coded as integers starting with 1.
Other variables are not restricted.
</p>


<h3>Value</h3>

<p>Transition probabilities as a <code>data.frame</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Estimation can use observed transitions with different levels of factors.
statespace &lt;- expand.grid(a=1:2, b=1:2, vol=1:5)
pairdata &lt;- data.frame(a=c(1,1,2,2), b=c(1,2,1,2), vol0=c(1,1,1,1), vol1=c(2,3,4,5))
state0 &lt;- statespace
actprob &lt;- statespace
actprob$test &lt;- 1
state0$area &lt;- 0
state0$area[1] &lt;- 1

# With by=c("a", "b") there are two observations: one from prior and the other
# from the exact combination of class levels.
probs &lt;- estimatetransprobs("vol", pairdata, statespace, by=c("a", "b"), prior="nochange")
act1 &lt;- define_activity("test", c("vol"), probs)
runEFDM(state0, actprob, list(act1), 1)

probs &lt;- estimatetransprobs("vol", pairdata, statespace, factors="a", by="b", prior="nochange")
act2 &lt;- define_activity("test", c("vol"), probs)
runEFDM(state0, actprob, list(act2), 1)

probs &lt;- estimatetransprobs("vol", pairdata, statespace, factors="b", by="a", prior="nochange")
act3 &lt;- define_activity("test", c("vol"), probs)
runEFDM(state0, actprob, list(act3), 1)

# The order of variables in factors argument specifies the order of importance.
# Observation that differ in the first variable are counted more times.
probs &lt;- estimatetransprobs("vol", pairdata, statespace, factors=c("a", "b"), prior="nochange")
act4 &lt;- define_activity("test", c("vol"), probs)
runEFDM(state0, actprob, list(act4), 1)

probs &lt;- estimatetransprobs("vol", pairdata, statespace, factors=c("b", "a"), prior="nochange")
act5 &lt;- define_activity("test", c("vol"), probs)
runEFDM(state0, actprob, list(act5), 1)


</code></pre>

<hr>
<h2 id='example'>Example dataset.</h2><span id='topic+example'></span>

<h3>Description</h3>

<p>A list containing the necessary datasets for EFDM forest scenario example.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>example
</code></pre>


<h3>Format</h3>

<p>A list of data frames:
</p>

<dl>
<dt>actprob</dt><dd><p>Activity probabilities</p>
</dd>
<dt>noman_pairs</dt><dd><p>Pair data for growth without management activities</p>
</dd>
<dt>thin_pairs</dt><dd><p>Pair data for thinning</p>
</dd>
<dt>initial_state</dt><dd><p>Initial forest state</p>
</dd>
<dt>drain_coef</dt><dd><p>Coefficient to transform harvested areas into harvest accumulation by timber assortments</p>
</dd>
<dt>vol_coef</dt><dd><p>Coefficients to transform volume classes into volumes m3/ha</p>
</dd>
<dt>income_coef</dt><dd><p>Coefficients to transform harvest accumulation into income</p>
</dd>
</dl>


<hr>
<h2 id='MetsaKasvVyoh'>Finnish bio-geographical regions</h2><span id='topic+MetsaKasvVyoh'></span>

<h3>Description</h3>

<p>A low resolution copy of the finnish bio-geographical regions.
The original shapefile was provided by Finnish Environment Institute.
See <a href="https://ckan.ymparisto.fi/fi/dataset/metsakasvillisuusvyohykkeet">https://ckan.ymparisto.fi/fi/dataset/metsakasvillisuusvyohykkeet</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MetsaKasvVyoh
</code></pre>


<h3>Format</h3>

<p>An sf-object:
</p>

<dl>
<dt>region</dt><dd><p>Factor with three levels: North, Middle, South</p>
</dd>
<dt>geometry</dt><dd><p>Polygon, each region is composed of multiple polygons</p>
</dd>
</dl>


<hr>
<h2 id='prior_ff'>Priors for <code><a href="#topic+estimatetransprobs">estimatetransprobs</a></code></h2><span id='topic+prior_ff'></span><span id='topic+prior_grow'></span>

<h3>Description</h3>

<p>Priors for <code><a href="#topic+estimatetransprobs">estimatetransprobs</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prior_ff()

prior_grow(variable, howmuch = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="prior_ff_+3A_variable">variable</code></td>
<td>
<p>Name of the variable to grow</p>
</td></tr>
<tr><td><code id="prior_ff_+3A_howmuch">howmuch</code></td>
<td>
<p>Amount of growth</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>prior_ff</code> moves the forest area to the smallest classes of the given
dynamic variables of the forest stratum.
</p>
<p><code>prior_grow</code> moves the forest to another class given by increasing
<code>variable</code> by <code>howmuch</code>.
</p>


<h3>Value</h3>

<p>Return value is used by <code><a href="#topic+estimatetransprobs">estimatetransprobs</a></code> to provide
prior information on the transition probabilities.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>statespace &lt;- expand.grid(a=1:2, b=1:2, vol=1:15, age=1:15)
act &lt;- define_activity("test", c("vol", "age"))
act1 &lt;- estimatetransprobs(c("vol", "age"), NULL, statespace, by=c("a", "b"),
  prior=prior_ff())
act2 &lt;- estimatetransprobs(c("vol", "age"), NULL, statespace, by=c("a", "b"),
  prior=prior_grow("age"))
</code></pre>

<hr>
<h2 id='runEFDM'>Run European Forestry Dynamics Model</h2><span id='topic+runEFDM'></span>

<h3>Description</h3>

<p>Run European Forestry Dynamics Model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>runEFDM(state0, actprob, activities, n, check = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="runEFDM_+3A_state0">state0</code></td>
<td>
<p><code>data.frame</code> Initial state</p>
</td></tr>
<tr><td><code id="runEFDM_+3A_actprob">actprob</code></td>
<td>
<p><code>data.frame</code> Activity probabilities</p>
</td></tr>
<tr><td><code id="runEFDM_+3A_activities">activities</code></td>
<td>
<p><code>list</code> A list of activities</p>
</td></tr>
<tr><td><code id="runEFDM_+3A_n">n</code></td>
<td>
<p><code>integer</code> Number of time steps required</p>
</td></tr>
<tr><td><code id="runEFDM_+3A_check">check</code></td>
<td>
<p>Check input arguments for consistency.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is the actual scenario running function, which projects the initial
forest state n time steps to the future.
</p>
<p>Activities are defined using <code><a href="#topic+define_activity">define_activity</a></code>.
</p>


<h3>Value</h3>

<p><code>data.frame</code> State of each time step divided by activities
</p>

<hr>
<h2 id='transprobs+26lt+3B-'>Transition probabilities of an activity</h2><span id='topic+transprobs+3C-'></span><span id='topic+transprobs'></span>

<h3>Description</h3>

<p>Functions to get or set the transition probabilities of an activity
</p>


<h3>Usage</h3>

<pre><code class='language-R'>transprobs(act) &lt;- value

transprobs(act)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="transprobs+2B26lt+2B3B-_+3A_act">act</code></td>
<td>
<p>Activity definition</p>
</td></tr>
<tr><td><code id="transprobs+2B26lt+2B3B-_+3A_value">value</code></td>
<td>
<p><code>data.frame</code> of transition probabilities</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>value</code> should be a <code>data.frame</code> defining the transition probabilities
between dynamic variables of the activity. See <code><a href="#topic+define_activity">define_activity</a></code>
for details
</p>


<h3>Value</h3>

<p><code>data.frame</code> where prob is the transition probability from current
state (with suffix 0) to next state (with suffix 1).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>act1 &lt;- define_activity("test", c("vol"))
transprobs(act1) &lt;- data.frame(vol0 = 1:5, vol1=c(2:5, 5), prob=1)
transprobs(act1)

if(require("ggplot2")) {
  ggplot(transprobs(act1)) + geom_raster(aes(x=vol0, y=vol1, fill=prob))
}
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
