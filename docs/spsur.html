<!DOCTYPE html><html><head><title>Help for package spsur</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {spsur}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#dgp_spsur'><p>Generation of a random dataset with a spatial SUR structure.</p></a></li>
<li><a href='#impactspsur'><p>Direct, indirect and total effects estimated for a spatial SUR model</p></a></li>
<li><a href='#lmtestspsur'><p>Testing for the presence of spatial effects in Seemingly</p>
Unrelated Regressions</a></li>
<li><a href='#lr_betas'><p>Likelihood ratio for testing homogeneity constraints on beta coefficients of the SUR equations.</p></a></li>
<li><a href='#methods_spsur'><p>Methods for class spsur</p></a></li>
<li><a href='#NCOVR.sf'><p>Homicides in U.S. counties</p></a></li>
<li><a href='#print.summary.spsur'><p>Print method for objects of class summary.spsur.</p></a></li>
<li><a href='#spain.covid'><p>Within/Exit mobility index and incidence COVID-19 at Spain provinces</p></a></li>
<li><a href='#spain.covid.sf'><p>Spain geometry</p></a></li>
<li><a href='#spc'><p>A classical Spatial Phillips-Curve</p></a></li>
<li><a href='#spsur-package'><p>Spatial Seemingly Unrelated Regression Models.</p></a></li>
<li><a href='#spsur3sls'><p>Three Stages Least Squares estimation,3sls, of spatial SUR models.</p></a></li>
<li><a href='#spsurgs3sls'><p>General Spatial 3SLS for systems of spatial equations.</p></a></li>
<li><a href='#spsurml'><p>Maximum likelihood estimation of spatial SUR model.</p></a></li>
<li><a href='#spsurtime'><p>Estimation of SUR models for simple spatial panels (G=1).</p></a></li>
<li><a href='#summary.spsur'><p>Summary of estimated objects of class <em>spsur</em>.</p></a></li>
<li><a href='#wald_betas'><p>Wald tests on the <em>beta</em> coefficients</p></a></li>
<li><a href='#wald_deltas'><p>Wald tests for spatial parameters coefficients.</p></a></li>
<li><a href='#Wspc'><p>Spatial weight matrix for South-West Ohio Counties to estimate</p>
Spatial Phillips-Curve</a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Spatial Seemingly Unrelated Regression Models</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.2.5</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-10-29</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Roman Minguez &lt;roman.minguez@uclm.es&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>A collection of functions to test and estimate Seemingly 
    Unrelated Regression (usually called SUR) models, with spatial structure, by maximum 
    likelihood and three-stage least squares. The package estimates the 
    most common spatial specifications, that is, SUR with Spatial Lag of 
    X regressors (called SUR-SLX), SUR with Spatial Lag Model (called SUR-SLM), 
    SUR with Spatial Error Model (called SUR-SEM), SUR with Spatial Durbin Model (called SUR-SDM), 
    SUR with Spatial Durbin Error Model (called SUR-SDEM), 
    SUR with Spatial Autoregressive terms and Spatial Autoregressive 
    Disturbances (called SUR-SARAR), SUR-SARAR with Spatial Lag of X 
    regressors (called SUR-GNM) and SUR with Spatially Independent Model (called SUR-SIM).
    The methodology of these models can be found in next references 
    Minguez, R., Lopez, F.A., and Mur, J. (2022) &lt;<a href="https://doi.org/10.18637%2Fjss.v104.i11">doi:10.18637/jss.v104.i11</a>&gt;
    Mur, J., Lopez, F.A., and Herrera, M. (2010) &lt;<a href="https://doi.org/10.1080%2F17421772.2010.516443">doi:10.1080/17421772.2010.516443</a>&gt; 
    Lopez, F.A., Mur, J., and Angulo, A. (2014) &lt;<a href="https://doi.org/10.1007%2Fs00168-014-0624-2">doi:10.1007/s00168-014-0624-2</a>&gt;.</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.1), methods (&ge; 4.1), stats (&ge; 4.1)</td>
</tr>
<tr>
<td>Imports:</td>
<td>Formula (&ge; 1.2-4), ggplot2 (&ge; 3.3.6), gmodels (&ge; 2.18.1),
gridExtra (&ge; 2.3), MASS (&ge; 7.3-56), Matrix (&ge; 1.4-1), minqa
(&ge; 1.2.4), numDeriv (&ge; 2016.8-1.1), Rdpack (&ge; 2.4), rlang
(&ge; 1.0.4), sparseMVN (&ge; 0.2.2), spatialreg (&ge; 1.2-5), spdep
(&ge; 1.2-5), sphet(&ge; 2.0)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>dplyr (&ge; 1.0.9), knitr (&ge; 1.39), sf (&ge; 1.0-8)</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.1</td>
</tr>
<tr>
<td>RdMacros:</td>
<td>Rdpack</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://CRAN.R-project.org/package=spsur">https://CRAN.R-project.org/package=spsur</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/rominsal/spsur/issues">https://github.com/rominsal/spsur/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-10-29 14:05:12 UTC; Roman.Minguez</td>
</tr>
<tr>
<td>Author:</td>
<td>Ana Angulo [aut],
  Fernando A Lopez [aut],
  Roman Minguez [aut, cre],
  Jesus Mur [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-10-29 21:52:23 UTC</td>
</tr>
</table>
<hr>
<h2 id='dgp_spsur'>Generation of a random dataset with a spatial SUR structure.</h2><span id='topic+dgp_spsur'></span>

<h3>Description</h3>

<p>The purpose of the function <code>dgp_spsur</code> is to generate a random 
dataset with the dimensions and spatial structure decided by the user. 
This function may be useful in pure simulation experiments or with the 
aim of showing specific properties and characteristics
of a spatial SUR dataset and inferential procedures related to them.
</p>
<p>The user of <code>dgp_spsur</code> should think in terms of a Monte Carlo 
experiment. The arguments of the function specify the dimensions of the 
dataset to be generated, the spatial mechanism underlying the data, the 
intensity of the SUR structure among the equations and the values of the 
parameters to be used to obtain the simulated data, which includes the 
error terms, the regressors and the explained variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dgp_spsur(Sigma, Tm = 1, G, N, Betas, Thetas = NULL, 
                 rho = NULL, lambda = NULL, p = NULL, listw = NULL, 
                 X = NULL, type = "matrix", pdfU = "nvrnorm", 
                 pdfX = "nvrnorm")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dgp_spsur_+3A_sigma">Sigma</code></td>
<td>
<p>Covariance matrix between the <em>G</em> equations of the 
SUR model. This matrix should be definite positive and the user must 
check for that.</p>
</td></tr>
<tr><td><code id="dgp_spsur_+3A_tm">Tm</code></td>
<td>
<p>Number of time periods. Default = <code>1</code></p>
</td></tr>
<tr><td><code id="dgp_spsur_+3A_g">G</code></td>
<td>
<p>Number of equations.</p>
</td></tr>
<tr><td><code id="dgp_spsur_+3A_n">N</code></td>
<td>
<p>Number of cross-section or spatial units</p>
</td></tr>
<tr><td><code id="dgp_spsur_+3A_betas">Betas</code></td>
<td>
<p>A row vector of order <code class="reqn">(1xP)</code> showing the values for 
the <em>beta</em> coefficients.
The first <code class="reqn">P_{1}</code> terms correspond to the first equation (where 
the first element is the intercept), the second <code class="reqn">P_{2}</code> terms to 
the coefficients of the second equation and so on.</p>
</td></tr>
<tr><td><code id="dgp_spsur_+3A_thetas">Thetas</code></td>
<td>
<p>Values for the <code class="reqn">\theta</code> coefficients in the 
<em>G</em> equations of the model, when the type of spatial SUR model to 
be simulated is a &quot;slx&quot;, &quot;sdm&quot;  or &quot;sdem&quot;. <em>Thetas</em> is a 
row vector of order <em><code class="reqn">1xPTheta</code></em>, where 
<em><code class="reqn">PThetas=p-G</code></em>; let us note that the intercept cannot 
appear among the spatial lags of the regressors. The first 
<em><code class="reqn">1xKTheta_{1}</code></em> terms correspond to the first equation, 
the second <em><code class="reqn">1xPTheta_{2}</code></em> terms correspond to the
second equation, and so on. Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="dgp_spsur_+3A_rho">rho</code></td>
<td>
<p>Values of the coefficients <code class="reqn">\rho_{g}; g=1,2,..., G</code> 
related to the spatial lag of the explained variable of the g-th equation. 
If <code class="reqn">rho</code> is an scalar and there are <em>G</em> equations in the 
model, the same value will be used for all the equations. If <code class="reqn">rho</code> 
is a row vector, of order <em>(1xG)</em>, the function <code>dgp_spsur</code> 
will use these values, one for each equation. Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="dgp_spsur_+3A_lambda">lambda</code></td>
<td>
<p>Values of the coefficients <code class="reqn">\lambda_{g}; g=1,2,..., G</code> 
related to the spatial lag of the errors in the <em>G</em> equations. 
If <code class="reqn">lambda</code> is an scalar and there are <em>G</em> equations
in the model, the same value will be used for all the equations. 
If <code class="reqn">lambda</code> is a row vector, of order <em>(1xG)</em>, the function 
<code>dgp_spsur</code> will use these values, one for each equation of the 
spatial errors. Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="dgp_spsur_+3A_p">p</code></td>
<td>
<p>Number of regressors by equation, including the intercept. 
<em>p</em> can be a row vector of order <em>(1xG)</em>, if the number of 
regressors is not the same for all the equations, or a scalar, if the 
<em>G</em> equations have the same number of regressors.</p>
</td></tr>
<tr><td><code id="dgp_spsur_+3A_listw">listw</code></td>
<td>
<p>A <code>listw</code> object created for example by 
<code><a href="spdep.html#topic+nb2listw">nb2listw</a></code> from <span class="pkg">spatialreg</span> package; if 
<code><a href="spdep.html#topic+nb2listw">nb2listw</a></code> not given, set to 
the same spatial weights as the <code>listw</code> argument. It can
also be a spatial weighting matrix of order <em>(NxN)</em> instead of
a <code>listw</code> object. Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="dgp_spsur_+3A_x">X</code></td>
<td>
<p>This argument tells the function <code>dgp_spsur</code> which <em>X</em> 
matrix should be used to generate the SUR dataset. If <em>X</em> is 
different from <code>NULL</code>, <code>{dgp_spsur}</code> will upload the <em>X</em> 
matrix selected in this argument. Note that the <em>X</em> must be consistent
with the dimensions of the model. If <em>X</em> is <code>NULL</code>, 
<code>dgp_spsur</code> will generate the desired matrix of regressors from a 
multivariate Normal distribution with mean value zero and identity 
<code class="reqn">(PxP)</code> covariance matrix. As an alternative, the user may change 
this probability distribution function to the uniform case, <code class="reqn">U(0,1)</code>, 
through the argument <em>pdfX</em>. Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="dgp_spsur_+3A_type">type</code></td>
<td>
<p>Selection of the type of output. The alternatives are 
<code>matrix</code>, <code>df</code>, <code>panel</code>, <code>all</code>. Default <code>matrix</code></p>
</td></tr>
<tr><td><code id="dgp_spsur_+3A_pdfu">pdfU</code></td>
<td>
<p>Multivariate probability distribution function, Mpdf, from 
which the values of the error terms will be drawn. The covariance matrix 
is the <code class="reqn">\Sigma</code> matrix specified by the user in the argument. Two alternatives
<code>"lognvrnorm"</code>, <code>"nvrnorm"</code>. Default <code>"nvrnorm"</code>.   
</p>
<p><em>Sigma</em>.
The function <code>dgp_spsur</code> provides two Mpdf, the multivariate Normal, 
which is the default, and the log-Normal distribution function which 
means just exponenciate the sampling drawn form a <code class="reqn">N(0,\Sigma)</code>
distribution. Default = <code>"nvrnorm"</code>.</p>
</td></tr>
<tr><td><code id="dgp_spsur_+3A_pdfx">pdfX</code></td>
<td>
<p>Multivariate probability distribution function (Mpdf), from 
which the values of the regressors will be drawn. The regressors are 
assumed to be independent. <code>dgp_spsur</code> provides two Mpdf, 
the multivariate Normal, which is the default, and the uniform in the 
interval <code class="reqn">U[0,1]</code>, using the dunif function.
<code><a href="stats.html#topic+dunif">dunif</a></code>, from the <span class="pkg">stats</span> package. Two alternatives
<code>"nvrunif"</code>, <code>"nvrnorm"</code>. Default <code>"nvrnorm"</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The purpose of the function <code>dgp_spsur</code> is to generate random 
datasets, of a SUR nature, with the spatial structure decided by the user. 
The function requires certain information to be supplied externally 
because, in fact, <code>dgp_spsur</code> constitutes a Data Generation
Process, DGP. The following aspects should be addressed:
</p>

<ul>
<li><p> The user must define the dimensions of the dataset, that is, 
number of equations, <em>G</em>, number of time periods, <em>Tm</em>, and number of 
cross-sectional units, <em>N</em>.
</p>
</li>
<li><p> The user must choose the type of spatial structure desired 
for the model from among the list of candidates of &quot;sim&quot;, &quot;slx&quot;, 
&quot;slm&quot;, &quot;sem&quot;, &quot;sdm&quot;, &quot;sdem&quot; or  &quot;sarar&quot;. The default is the &quot;sim&quot; 
specification which does not have spatial structure. The decision is 
made implicitly, just omitting the specification of the spatial 
parameters which are not involved in the model (i.e., in a &quot;slm&quot;
there are no <code class="reqn">\lambda</code> parameters but appear <code class="reqn">\rho</code> 
parameters; in a &quot;sdem&quot; model there are <code class="reqn">\lambda</code> and <code class="reqn">\theta</code> 
parameters but no <code class="reqn">\rho</code> coefficients). 
</p>
</li>
<li><p> If the user needs a model with spatial structure, a <em>(NxN)</em>  weighting 
matrix, <em>W</em>, should be chosen.
</p>
</li>
<li><p> The next step builds the equations of the SUR model. In this 
case, the user must specify the number of regressors that intervene 
in each equation and the coefficients, <code class="reqn">\beta</code> parameters,
associated with each regressor. The <em>first</em> question is solved 
through the argument <em>p</em> which, if a scalar, indicates that 
the same number of regressors should appear in all the equations
of the model; if the user seeks for a model with different number 
of regressors in the <em>G</em> equations, the argument <em>p</em> must 
be a <em>(1xG)</em> row vector with the required information. It must 
be remembered that <code>dgp_spsur</code> assumes that an
intercept appears in all equations of the model.
</p>
<p>The <em>second</em> part of the problem posited above is solved through 
the argument <em>Betas</em>, which is a row vector of order <em>(1xp)</em> 
with the information required for this set of coefficients.
</p>
</li>
<li><p> The user must specify, also, the values of the spatial parameters 
corresponding to the chosen specification; we are referring to the 
<code class="reqn">\rho_{g}</code>, <code class="reqn">\lambda_{g}</code> and  <code class="reqn">\theta_{g}</code>,
for <code class="reqn">g=1, ..., G and k=1,..., K_{g}</code> parameters. This is done 
thought the arguments <em>rho</em>, <em>lambda</em> and <em>theta</em>. 
The firs two, <em>rho</em> and <em>lambda</em>, work as <em>K</em>: if 
they are scalar, the same value will be used in the <em>G</em> 
equations of the SUR model; if they are <em>(1xG)</em> row vectors, 
a different value will be assigned for each equation.
</p>
<p>Moreover, <em>Theta</em> works like the argument <em>Betas</em>. The user 
must define a row vector of order <code class="reqn">1xPTheta</code> showing these values. 
It is worth to remember that in no case the intercept will appear 
among the lagged regressors.
</p>
</li>
<li><p> With the argument <code>type</code> the user take the decision of the 
output format. See Value section.
</p>
</li>
<li><p> Finally, the user must decide which values of the regressors and 
of the error terms are to be used in the simulation. The regressors 
can be uploaded from an external matrix generated previously by the
user. This is the argument <em>X</em>. It is the responsibility of the 
user to check that the dimensions of the external matrix are consistent 
with the dataset required for the SUR model. A second possibility
implies  the regressors to be generated randomly by the function 
<code><a href="#topic+dgp_spsur">dgp_spsur</a></code>.
In this case, the user must select the probability distribution 
function from which the corresponding data (of the regressors and 
the error terms) are to be drawn.<br />
</p>
</li></ul>

<p><code>dgp_spsur</code> provides two multivariate distribution functions, 
namely, the Normal and the log-Normal for the errors (the second 
should be taken as a clear departure from the standard assumption of
normality). In both cases, random matrices of order <em>(TmNxG)</em> 
are obtained from a multivariate normal distribution, with a mean 
value of zero and the covariance matrix specified in the argument
<em>Sigma</em>; then, this matrix is exponentiated for the log-Normal 
case. Roughly, the same procedure applies for drawing the values of 
the regressor. There are two distribution functions available, the
normal and the uniform in the interval <code class="reqn">U[0,1]</code>; the regressors 
are always independent.
</p>


<h3>Value</h3>

<p>The default output (&quot;matrix&quot;) is a list with a vector <code class="reqn">Y</code> of order 
<em>(TmNGx1)</em> with the values 
generated for the explained variable in the G equations of the SUR and 
a matrix <code class="reqn">XX</code> of order (<em>(TmNGxsum(p))</em>, with the values
generated for the regressors of the SUR, including an intercept for 
each equation.
</p>
<p>In case of Tm = 1 or G = 1 several alternatives 
output can be select:
</p>

<ul>
<li><p> If the user select <code>type = "df"</code> the output is a data frame where each
column is a variable.
</p>
</li>
<li><p> If the user select <code>type = "panel"</code> the output is a data frame in 
panel format including two factors. The first factor point out the observation 
of the individual and the second the equation for different Tm or G.
</p>
</li>
<li><p> Finally, if <code>type = "all"</code> is select the output is a list including all 
alternatives format.
</p>
</li></ul>



<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
  Fernando Lopez  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Jesus Mur  </td><td style="text-align: left;"> <a href="mailto:jmur@unizar.es">jmur@unizar.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Lopez, F. A., Minguez, R., Mur, J. (2020). ML versus IV estimates 
of spatial SUR models: evidence from the case of Airbnb in Madrid urban 
area. <em>The Annals of Regional Science</em>, 64(2), 313-347.
&lt;doi:10.1007/s00168-019-00914-1&gt;
</p>
</li>
<li><p> Minguez, R., Lopez, F.A. and Mur, J.  (2022).
spsur: An R Package for Dealing with Spatial 
Seemingly Unrelated Regression Models. 
<em>Journal of Statistical Software</em>, 
104(11), 1&ndash;43. &lt;doi:10.18637/jss.v104.i11&gt;
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+spsurml">spsurml</a></code>, <code><a href="#topic+spsur3sls">spsur3sls</a></code>, <code><a href="#topic+spsurtime">spsurtime</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## VIP: The output of the whole set of the examples can be examined 
## by executing demo(demo_dgp_spsur, package="spsur")

################################################
### PANEL DATA (Tm = 1 or G = 1)              ##
################################################

################################################
#### Example 1: DGP SLM model. G equations
################################################
rm(list = ls()) # Clean memory
Tm &lt;- 1 # Number of time periods
G &lt;- 3 # Number of equations
N &lt;- 200 # Number of spatial elements
p &lt;- 3 # Number of independent variables
Sigma &lt;- matrix(0.3, ncol = G, nrow = G)
diag(Sigma) &lt;- 1
Betas &lt;- c(1, 2, 3, 1, -1, 0.5, 1, -0.5, 2)
rho &lt;- 0.5 # level of spatial dependence
lambda &lt;- 0.0 # spatial autocorrelation error term = 0
##  random coordinates
co &lt;- cbind(runif(N,0,1),runif(N,0,1))
lw &lt;- spdep::nb2listw(spdep::knn2nb(spdep::knearneigh(co, k = 5,
                                                   longlat = FALSE)))
DGP &lt;- dgp_spsur(Sigma = Sigma, Betas = Betas,
                 rho = rho, lambda = lambda, Tm = Tm,
                 G = G, N = N, p = p, listw = lw)

SLM &lt;- spsurml(X = DGP$X, Y = DGP$Y, Tm = Tm, N = N, G = G, 
               p = c(3, 3, 3), listw = lw, type = "slm") 
summary(SLM)

################################################
### MULTI-DIMENSIONAL PANEL DATA G&gt;1 and Tm&gt;1 ##
################################################

rm(list = ls()) # Clean memory
Tm &lt;- 10 # Number of time periods
G &lt;- 3 # Number of equations
N &lt;- 100 # Number of spatial elements
p &lt;- 3 # Number of independent variables
Sigma &lt;- matrix(0.5, ncol = G, nrow = G)
diag(Sigma) &lt;- 1
Betas &lt;- rep(1:3, G)
rho &lt;- c(0.5, 0.1, 0.8)
lambda &lt;- 0.0 # spatial autocorrelation error term = 0
## random coordinates
co &lt;- cbind(runif(N,0,1),runif(N,0,1))
lw &lt;- spdep::nb2listw(spdep::knn2nb(spdep::knearneigh(co, k = 5,
                                                   longlat = FALSE)))
DGP4 &lt;- dgp_spsur(Sigma = Sigma, Betas = Betas, rho = rho, 
                  lambda = lambda, Tm = Tm, G = G, N = N, p = p, 
                  listw = lw)
SLM4  &lt;- spsurml(Y = DGP4$Y, X = DGP4$X, G = G, N = N, Tm = Tm,
                 p = p, listw = lw, type = "slm")
summary(SLM4)

</code></pre>

<hr>
<h2 id='impactspsur'>Direct, indirect and total effects estimated for a spatial SUR model</h2><span id='topic+impactspsur'></span>

<h3>Description</h3>

<p>This function is a wrapper for <code><a href="spatialreg.html#topic+impacts">impacts</a></code> method
used in <span class="pkg">spatialreg</span> package. Nevertheless, in this case the same 
method is used for both <code><a href="spatialreg.html#topic+lagsarlm">lagsarlm</a></code> and 
<code><a href="spatialreg.html#topic+lmSLX">lmSLX</a></code> objects. For details of implementation, 
see the documentation of <code><a href="spatialreg.html#topic+impacts">impacts</a></code> function in 
<span class="pkg">spatialreg</span> package. <br />
The function obtains the multiplier effects, on the explained variable, 
of a change in a regressor for the model that has been estimated. 
For reasons given below, this function only applies to models with an 
autoregressive structure (&quot;slm&quot;, &quot;sdm&quot;, &quot;sarar&quot; and &quot;gnm&quot;) or with spatial lags 
of the regressors (&quot;slx&quot;, &quot;sdem&quot;). <br />
The measurement of the multiplier effects is a bit more complicated than 
in a pure time series context because, due to the spatial structure of 
the model, part of the impacts spills over non uniformly over the space. 
Using the notation introduced by LeSage and Pace (2009) we distinguish 
between:
</p>

<ul>
<li> <p><strong>Average Direct effects</strong>: The average over the <em>N</em> 
spatial units and <em>Tm</em> time periods of the effect of a unitary 
change in the value of a explanatory variable on the contemporaneous 
value of the corresponding explained variable, located in the same 
point of the intervened regressor. This calculus is solved for all the 
regressors that appear in the <em>G</em> equations of the model.
</p>
</li>
<li> <p><strong>Average Indirect effects</strong>: The average over the <em>N</em> 
spatial units and <em>Tm</em> time periods of the effects of a unitary 
change in the value of a explanatory variable on the contemporaneous 
value of the corresponding explained variable, located in a different 
spatial unit that that of the intervened regressor. This calculus is 
solved for all the regressors that appear in the <em>G</em> equations of 
the model.
</p>
</li>
<li> <p><strong>Average total effects</strong>: The sum of Direct and 
Indirect effects.
</p>
</li></ul>

<p>The information on the three estimated effects is supplement with an 
indirect measure of statistical significance obtained from the 
randomization approach introduced in LeSage and Pace (2009).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>impactspsur (obj, ..., tr = NULL, R = NULL, listw = NULL, 
                      evalues = NULL,tol = 1e-06, 
                      empirical = FALSE, Q = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="impactspsur_+3A_obj">obj</code></td>
<td>
<p>An <code>spsur</code> object created by <code><a href="#topic+spsurml">spsurml</a></code>,
<code><a href="#topic+spsur3sls">spsur3sls</a></code> or <code><a href="#topic+spsurtime">spsurtime</a></code>.</p>
</td></tr>
<tr><td><code id="impactspsur_+3A_...">...</code></td>
<td>
<p>Arguments passed through to methods in the <span class="pkg">coda</span> package</p>
</td></tr>
<tr><td><code id="impactspsur_+3A_tr">tr</code></td>
<td>
<p>A vector of traces of powers of the spatial weights matrix created using <code>trW</code>, for approximate impact measures; if not given, <code>listw</code> must be given for exact measures (for small to moderate spatial weights matrices); the traces must be for the same spatial weights as were used in fitting the spatial regression, and must be row-standardised</p>
</td></tr>
<tr><td><code id="impactspsur_+3A_r">R</code></td>
<td>
<p>If given, simulations are used to compute distributions for the impact measures, returned as <code>mcmc</code> objects; the objects are used for convenience but are not output by an MCMC process</p>
</td></tr>
<tr><td><code id="impactspsur_+3A_listw">listw</code></td>
<td>
<p>If <code>tr</code> is not given, a spatial weights object as created by <code>nb2listw</code>; they must be the same spatial weights as were used in fitting the spatial regression, but do not have to be row-standardised</p>
</td></tr>
<tr><td><code id="impactspsur_+3A_evalues">evalues</code></td>
<td>
<p>vector of eigenvalues of spatial weights matrix for impacts calculations</p>
</td></tr>
<tr><td><code id="impactspsur_+3A_tol">tol</code></td>
<td>
<p>Argument passed to <code>mvrnorm</code>: tolerance (relative to largest variance) for numerical lack of positive-definiteness in the coefficient covariance matrix</p>
</td></tr>
<tr><td><code id="impactspsur_+3A_empirical">empirical</code></td>
<td>
<p>Argument passed to <code>mvrnorm</code> (default FALSE): if true, the coefficients and their covariance matrix specify the empirical not population mean and covariance matrix</p>
</td></tr>
<tr><td><code id="impactspsur_+3A_q">Q</code></td>
<td>
<p>default NULL, else an integer number of cumulative power series impacts to calculate if <code>tr</code> is given</p>
</td></tr>
</table>


<h3>Details</h3>

<p>LeSage and Pace (2009) adapt the classical notion of 
<em>'economic multiplier'</em> to the problem of measuring the impact that 
a unitary change in the value of a regressor, produced in a certain point 
in space, has on the explained variable. The question is interesting 
because, due to the spatial structure of the model, the impacts of such 
change spill non uniformly over the space. In fact, the reaction of the 
explained variable depends on its relative location in relation to the 
point of intervention. <br />
To simplify matters, LeSage and Pace (2009) propose to obtain aggregated 
multipliers for each regressor, just averaging the <code class="reqn">N^{2}</code> impacts 
that results from intervening the value of each regressor on each of the
N points in Space, on the explained variable, measured also in each of 
the <code class="reqn">N</code> points in space. This aggregated average is the so-called 
<em>Total effect</em>. <br />
Part of this impact will be absorved by the explained variable located in 
the same point of the regressor whose value has been changed (for example, 
the k-th regresor in the g-th equation, in the n-th spatial unit) or,
in other words, we expect that <code class="reqn">[d y_{tgn}]/[d x_{ktgn}] ne 0</code>. The 
aggregated average for the <em>N</em> points in space (n=1,2,...,N) and 
<em>Tm</em> time periods is the so-called <em>Direct effect</em>.
The difference between the <em>Total effect</em> and the <em>Direct effect</em> 
measures the portion of the impact on the explained variable that leakes 
to other points in space, <code class="reqn">[d y_{tgn}]/[d x_{ktgm}] for n ne m</code>;
this is the <em>Indirect effect</em>.
</p>
<p><code>impacts</code> obtains the three multipliers together with an 
indirect measure of statistical significance, according to the 
randomization approach described in Lesage and Pace (2009). Briefly, they 
suggest to obtain a sequence of <em>nsim</em> random matrices of order 
<em>(NTmxG)</em> from a multivariate normal distribution 
N(0; <em>Sigma</em>), being <em>Sigma</em> the estimated covariance matrix 
of the <em>G</em> equations in the SUR model. These random matrices, 
combined with the observed values of the regressors and the estimated 
values of the parameters of the corresponding spatial SUR model, are used 
to obtain simulated values of the explained variables. Then, for each one 
of the <em>nsim</em> experiments, the SUR model is estimated, and the effects
are evaluated. The function <code>impacts</code> obtains the standard 
deviations of the <em>nsim</em> estimated effects in the randomization 
procedure, which are used to test the significance of the estimated 
effects for the original data.
</p>
<p>Finally, let us note that this is a SUR model where the <em>G</em> equations 
are connected only through the error terms. This means that if we 
intervene a regressor in equation <em>g</em>, in any point is space, only 
the explained variable of the same equation <em>g</em> should react. The 
impacts do not spill over equations. Moreover, the impact of a regressor, 
intervened in the spatial unit <em>n</em>, will cross the borders of this 
spatial unit only if in the right hand side of the equation there are 
spatial lags of the explained variables or of the regressors. In other 
words, the <em>Indirect effect</em> is zero for the &quot;sim&quot; and &quot;sem&quot; models. 
<code>impacts</code> produces no output for these two models.
Lastly, it is clear that all the impacts are contemporaneous because the 
equations in the SUR model have no time dynamics.
</p>


<h3>Value</h3>

<p>A list of <em>G</em> objects either of class <code>lagImpact</code> 
or <code>WXImpact</code>.
</p>
<p>For each of the G objects of the list, if no simulation is carried out 
the object returned is a list with:
</p>

<table>
<tr>
 <td style="text-align: left;">
  <code>direct</code> </td><td style="text-align: left;"> numeric vector </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code>indirect</code> </td><td style="text-align: left;"> numeric vector </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code>total</code> </td><td style="text-align: left;"> numeric vector </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>
 
<p>and a matching <code>Qres</code> list attribute if Q was given.
</p>
<p>On the other hand, for each of the G objects of the list, if 
simulation is carried out the object returned is a list with:
</p>

<table>
<tr>
 <td style="text-align: left;">  
  <code>res</code> </td><td style="text-align: left;">	a list with three components as for the non-simulation 
  case, with a matching <code>Qres</code> list attribute if <code>Q</code> was given. </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code>sres</code> </td><td style="text-align: left;"> a list with three <code>mcmc</code> matrices, for the direct, 
  indirect and total impacts with a matching <code>Qmcmc</code>list attribute 
  if <code>Q</code> was given. </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
  Fernando Lopez  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Jesus Mur  </td><td style="text-align: left;"> <a href="mailto:jmur@unizar.es">jmur@unizar.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Bivand, R.S. and  Piras G. (2015). Comparing Implementations of 
Estimation Methods for Spatial Econometrics. <em>Journal of 
Statistical Software</em>, 63(18), 1-36. 
&lt;doi:	10.18637/jss.v063.i18&gt;
</p>
</li>
<li><p> LeSage, J., and Pace, R. K. (2009). <em>Introduction to spatial
econometrics</em>. Chapman and Hall/CRC.
</p>
</li>
<li><p> Lopez, F.A., Mur, J., and Angulo, A. (2014). Spatial model
selection strategies in a SUR framework. The case of regional
productivity in EU. <em>Annals of Regional Science</em>, 53(1), 197-220.
&lt;doi:10.1007/s00168-014-0624-2&gt;
</p>
</li>
<li><p> Minguez, R., Lopez, F.A. and Mur, J.  (2022).
spsur: An R Package for Dealing with Spatial 
Seemingly Unrelated Regression Models. 
<em>Journal of Statistical Software</em>, 
104(11), 1&ndash;43. &lt;doi:10.18637/jss.v104.i11&gt;
</p>
</li>
<li><p> Mur, J., Lopez, F., and Herrera, M. (2010). Testing for spatial
effects in seemingly unrelated regressions.
<em>Spatial Economic Analysis</em>, 5(4), 399-440.
&lt;doi:10.1080/17421772.2010.516443&gt;
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="spatialreg.html#topic+impacts">impacts</a></code>, <code><a href="#topic+spsurml">spsurml</a></code>, 
<code><a href="#topic+spsur3sls">spsur3sls</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## VIP: The output of the whole set of the examples can be examined 
## by executing demo(demo_impactspsur, package="spsur")


###############################################
### PURE CROSS SECTIONAL DATA(G&gt;1; Tm=1) ######
###############################################

#### Example 1: Spatial Phillips-Curve. Anselin (1988, p. 203)
 rm(list = ls()) # Clean memory
 data(spc)
 lwspc &lt;- spdep::mat2listw(Wspc, style = "W")
 Tformula &lt;- WAGE83 | WAGE81 ~ UN83 + NMR83 + SMSA | UN80 + NMR80 + SMSA
## For SLM, SDM and SARAR models the output is a list of "lagImpact" objects
## See spatialreg::impacts for details.
 spcsur_slm &lt;-spsurml(formula = Tformula, data = spc, 
                      type = "slm", listw = lwspc)
 summary(spcsur_slm)
 impacts_slm &lt;- impactspsur(spcsur_slm, listw = lwspc, R = 1000)
## Impacts equation 1
 summary(impacts_slm[[1]], zstats = TRUE, short = TRUE)
## Impacts equation 2
 summary(impacts_slm[[2]], zstats = TRUE, short = TRUE)
## For SLX and SDEM models the output is a list of "WXImpact" objects
## See spatialreg::impacts for details.
## A SUR-SLX model
 spcsur_slx &lt;-spsurml(formula = Tformula, data = spc, 
                      type = "slx", listw = lwspc)
 summary(spcsur_slx)
 impacts_slx &lt;- impactspsur(spcsur_slx, listw = lwspc)
 summary(impacts_slx[[1]], zstats = TRUE, short = TRUE)
 summary(impacts_slx[[2]], zstats = TRUE, short = TRUE)

## A SUR-SDM model
 spcsur_sdm &lt;-spsurml(formula = Tformula, data = spc, 
                      type = "sdm", listw = lwspc)
 impacts_sdm &lt;- impactspsur(spcsur_sdm, listw = lwspc, R = 1000)
 summary(impacts_sdm[[1]], zstats = TRUE, short = TRUE)
 summary(impacts_sdm[[2]], zstats = TRUE, short = TRUE)
## A SUR-SDM model with different spatial lags in each equation
 TformulaD &lt;- ~ UN83 + NMR83 + SMSA | UN80
 spcsur_sdm2 &lt;-spsurml(formula = Tformula, data = spc, type = "sdm", 
                       listw = lwspc, Durbin = TformulaD)
 summary(spcsur_sdm2)                       
 impacts_sdm2 &lt;- impactspsur(spcsur_sdm2, listw = lwspc, R = 1000)
 summary(impacts_sdm2[[1]], zstats = TRUE, short = TRUE)
 summary(impacts_sdm2[[2]], zstats = TRUE, short = TRUE)
 ## A SUR-SLX model with different spatial lags in each equation
 spcsur_slx2 &lt;-spsurml(formula = Tformula, data = spc, 
                      type = "slx", listw = lwspc, Durbin = TformulaD)
 summary(spcsur_slx2)
 impacts_slx2 &lt;- impactspsur(spcsur_slx2, listw = lwspc)
 summary(impacts_slx2[[1]], zstats = TRUE, short = TRUE)
 summary(impacts_slx2[[2]], zstats = TRUE, short = TRUE)
 
# ####################################
# ######## G=1; Tm&gt;1               ###
# ####################################
#
 rm(list = ls()) # Clean memory
 data(NCOVR, package="spsur")
 nbncovr &lt;- spdep::poly2nb(NCOVR.sf, queen = TRUE)
### Some regions with no links...
 lwncovr &lt;- spdep::nb2listw(nbncovr, style = "W", zero.policy = TRUE)
 Tformula &lt;- HR80  | HR90 ~ PS80 + UE80 | PS90 + UE90
### A SUR-SLM model
 NCOVRSUR_slm &lt;-spsurml(formula = Tformula, data = NCOVR.sf, 
                        type = "slm", listw = lwncovr, 
                        method = "Matrix", zero.policy = TRUE, 
                        control = list(fdHess = TRUE))
 summary(NCOVRSUR_slm)
### Use of trW to compute.
 Wncovr &lt;- Matrix::Matrix(spdep::listw2mat(lwncovr))
 trwncovr &lt;- spatialreg::trW(Wncovr, type = "MC")
 impacts_NCOVRSUR_slm &lt;- impactspsur(NCOVRSUR_slm, tr = trwncovr,
                                 R = 1000)
 summary(impacts_NCOVRSUR_slm[[1]], zstats = TRUE, short = TRUE)
 summary(impacts_NCOVRSUR_slm[[2]], zstats = TRUE, short = TRUE)


</code></pre>

<hr>
<h2 id='lmtestspsur'>Testing for the presence of spatial effects in Seemingly 
Unrelated Regressions</h2><span id='topic+lmtestspsur'></span><span id='topic+lmtestspsur.formula'></span><span id='topic+lmtestspsur.default'></span>

<h3>Description</h3>

<p>The function <code><a href="#topic+spsurml">spsurml</a></code>  reports a collection of 
Lagrange Multipliers designed to test  for the presence of different 
forms of spatial dependence in a <em>SUR</em> model of the &quot;sim&quot; type. 
That is, the approach of this function is from 
<em>'specific to general'</em>. As said, the model of the null hypothesis 
is the &quot;sim&quot; model whereas the model of the alternative depends on 
the effect whose omission we want to test.
</p>
<p>The collection of Lagrange Multipliers obtained by <code>lmtestspsur</code> 
are standard in the literature and take into account the multivariate 
nature of the <em>SUR</em> model. As a limitation, note that each 
Multiplier tests for the omission of the same spatial effects in all 
the cross-sections of the <em>G</em> equations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lmtestspsur(...)

## S3 method for class 'formula'
lmtestspsur(
  formula,
  data,
  listw,
  na.action,
  time = NULL,
  Tm = 1,
  zero.policy = NULL,
  R = NULL,
  b = NULL,
  ...
)

## Default S3 method:
lmtestspsur(Y, X, G, N, Tm = 1, listw, p, R = NULL, b = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="lmtestspsur_+3A_...">...</code></td>
<td>
<p>further arguments passed to the method.</p>
</td></tr>
<tr><td><code id="lmtestspsur_+3A_formula">formula</code></td>
<td>
<p>An object type <code><a href="Formula.html#topic+Formula">Formula</a></code> 
similar to objects created with the package <span class="pkg">Formula</span> 
describing the equations to be estimated in the model. 
This model may contain several responses (explained 
variables) and a varying number of regressors in each equation.</p>
</td></tr>
<tr><td><code id="lmtestspsur_+3A_data">data</code></td>
<td>
<p>An object of class data.frame or a matrix.</p>
</td></tr>
<tr><td><code id="lmtestspsur_+3A_listw">listw</code></td>
<td>
<p>A <code>listw</code> object created for example by 
<code><a href="spdep.html#topic+nb2listw">nb2listw</a></code> from <span class="pkg">spatialreg</span> package; if 
<code><a href="spdep.html#topic+nb2listw">nb2listw</a></code> not given, set to 
the same spatial weights as the <code>listw</code> argument. It can
also be a spatial weighting matrix of order <em>(NxN)</em> instead of
a <code>listw</code> object. Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="lmtestspsur_+3A_na.action">na.action</code></td>
<td>
<p>A function (default <code>options("na.action")</code>),
can also be <code>na.omit</code> or <code>na.exclude</code> with consequences 
for residuals and fitted values. It may be necessary to set 
<code>zero.policy</code> to <code>TRUE</code> because this subsetting may 
create no-neighbour observations.</p>
</td></tr>
<tr><td><code id="lmtestspsur_+3A_time">time</code></td>
<td>
<p>time index for the spatial panel SUR data.</p>
</td></tr>
<tr><td><code id="lmtestspsur_+3A_tm">Tm</code></td>
<td>
<p>Number of time periods.</p>
</td></tr>
<tr><td><code id="lmtestspsur_+3A_zero.policy">zero.policy</code></td>
<td>
<p>Similar to the corresponding parameter of 
<code><a href="spatialreg.html#topic+lagsarlm">lagsarlm</a></code> function in <span class="pkg">spatialreg</span> package. 
If <code>TRUE</code> assign zero to the lagged value of zones without 
neighbours, if <code>FALSE</code> assign <code>NA</code> - causing 
<code>spsurml()</code> to terminate with an error. Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="lmtestspsur_+3A_r">R</code></td>
<td>
<p>A row vector of order <em>(1xpr)</em> with  the set of 
<em>r</em> linear constraints on the <em>beta</em> parameters. The 
<em>first</em> restriction appears in the first <em>p</em> terms,
the second restriction in the next <em>p</em> terms and so on. 
Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="lmtestspsur_+3A_b">b</code></td>
<td>
<p>A column vector of order <em>(rx1)</em> with the values of 
the linear restrictions on the <em>beta</em> parameters. 
Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="lmtestspsur_+3A_y">Y</code></td>
<td>
<p>A column vector of order <em>(NTmGx1)</em>, with the 
observations of the explained variables. The ordering of the data 
must be (first) equation, (second) time dimension and (third) 
cross-sectional/spatial units. The specification of <em>Y</em> is 
only necessary if not available a <code><a href="Formula.html#topic+Formula">Formula</a></code>
and a data frame. Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="lmtestspsur_+3A_x">X</code></td>
<td>
<p>A data matrix of order <em>(NTmGxp)</em> with the observations
of the regressors. The number of covariates in the SUR model is 
<em>p</em> = <code class="reqn">sum(p_{g})</code> where <em><code class="reqn">p_{g}</code></em> is the number 
of regressors (including the intercept) in the g-th equation, 
<em>g = 1,...,G</em>). The specification of &quot;X&quot; is only 
necessary if not available a <code><a href="Formula.html#topic+Formula">Formula</a></code> and a 
data frame. Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="lmtestspsur_+3A_g">G</code></td>
<td>
<p>Number of equations.</p>
</td></tr>
<tr><td><code id="lmtestspsur_+3A_n">N</code></td>
<td>
<p>Number of cross-section or spatial units</p>
</td></tr>
<tr><td><code id="lmtestspsur_+3A_p">p</code></td>
<td>
<p>Number of regressors by equation, including the intercept. 
<em>p</em> can be a row vector of order <em>(1xG)</em>, if the number 
of regressors is not the same for all the equations, or a scalar, 
if the <em>G</em> equations have the same number of regressors. The 
specification of <em>p</em> is only necessary if not available a 
<code><a href="Formula.html#topic+Formula">Formula</a></code> and a data frame.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code><a href="#topic+lmtestspsur">lmtestspsur</a></code> tests for the omission of spatial 
effects in the &quot;sim&quot; version of the <em>SUR</em> model: <br />
</p>
<p style="text-align: center;"><code class="reqn">y_{tg} = X_{tg} \beta_{g} + u_{tg}</code>
</p>

<p style="text-align: center;"><code class="reqn">E[u_{tg}u_{th}']= \sigma_{gh}I_{N}  \quad E[u_{tg}u_{sh}']= 0 
          \mbox{ if } t ne s</code>
</p>

<p>where <code class="reqn">y_{tg}</code> and <code class="reqn">u_{tg}</code> are <em>(Nx1)</em> vectors, 
corresponding to the g-th equation and time period t;
<code class="reqn">X_{tg}</code> is the matrix of exogenous variables, of order 
<em><code class="reqn">(Nxp_{g})</code></em>. Moreover, <code class="reqn">\beta_{g}</code> is an unknown
<em><code class="reqn">(p_{g}x1)</code></em> vector of coefficients and <code class="reqn">\sigma_{gh}I_{N}</code> 
the covariance between equations <em>g</em> and <em>h</em>,
being <code class="reqn">\sigma_{gh}</code> and scalar and <code class="reqn">I_{N}</code> the identity 
matrix of orden N.
</p>
<p>The Lagrange Multipliers reported by this function are the followings:
</p>

<ul>
<li> <p><strong>LM-SUR-LAG</strong>: Tests for the omission of a spatial lag of 
the explained variable in the right hand side of the &quot;sim&quot; equation. 
The model of the alternative is: <br />
</p>
<p><code class="reqn">y_{tg} = \rho_{g}Wy_{tg} + X_{tg} \beta_{g} + u_{tg}</code>
</p>
<p>The null and alternative hypotheses are:
</p>
<p><code class="reqn">H_{0}: \rho_{g}=0 (forall g)</code> vs  
<code class="reqn">H_{A}: \rho_{g} ne 0 (exist g)</code>
</p>
</li>
<li> <p><strong>LM-SUR-ERR</strong>: Tests for the omission of spatial 
dependence in the equation of the errors of the &quot;sim&quot; model. The 
model of the alternative is:
</p>
<p><code class="reqn">y_{tg} = X_{tg} \beta_{g} + u_{tg}</code>; 
<code class="reqn">u_{tg}= \lambda_{g}Wu_{tg}+\epsilon_{tg}</code>
</p>
<p>The null and alternative hypotheses are:
</p>
<p><code class="reqn">H_{0}: \lambda_{g}=0 (forall g)</code> vs  
<code class="reqn">H_{A}: \lambda_{g}  ne 0 (exist g)</code>
</p>
</li>
<li> <p><strong>LM-SUR-SARAR</strong>: Tests for the simultaneous omission of 
a spatial lag of the explained variable in the right hand side of 
the &quot;sim&quot; equation and spatial dependence in the equation of the 
errors. The model of the alternative is:
</p>
<p><code class="reqn">y_{tg} = \rho_{g}Wy_{tg}+X_{tg} \beta_{g} + u_{tg}</code>; 
<code class="reqn">u_{tg}= \lambda_{g}Wu_{tg}+\epsilon_{tg}</code>
</p>
<p>The null and alternative hypotheses are:
</p>
<p><code class="reqn">H_{0}: \rho_{g}=\lambda_{g}=0 (forall g)</code> vs  
<code class="reqn">H_{A}: \rho_{g} ne 0 or \lambda_{g} ne 0 (exist g)</code>
</p>
</li>
<li>
<p><strong>LM*-SUR-SLM</strong> and <strong>LM*-SUR-SEM</strong>: These two test are 
the robustifyed version of the original, raw Multipliers, 
<strong>LM-SUR-SLM</strong> and <strong>LM-SUR-SEM</strong>, which can be severely 
oversized if the respective alternative hypothesis is misspeficied 
(this would be the case if, for example, we are testing for omitted 
lags of the explained variable whereas the problem is that there is 
spatial dependence in the errors, or viceversa). The null and 
alternative hypotheses of both test are totally analogous to their
twin non robust Multipliers.
</p>
</li></ul>



<h3>Value</h3>

<p>A list of <code>htest</code> objects each one including the Wald
statistic, the corresponding p-value and the degrees of
freedom.
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
  Fernando Lopez  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Jesus Mur  </td><td style="text-align: left;"> <a href="mailto:jmur@unizar.es">jmur@unizar.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Mur, J., Lopez, F., and Herrera, M. (2010). Testing for spatial
effects in seemingly unrelated regressions.
<em>Spatial Economic Analysis</em>, 5(4), 399-440.
&lt;doi:10.1080/17421772.2010.516443&gt;
</p>
</li>
<li><p> Lopez, F.A., Mur, J., and Angulo, A. (2014). Spatial model
selection strategies in a SUR framework. The case of regional
productivity in EU. <em>Annals of Regional Science</em>, 53(1),
197-220.
&lt;doi:10.1007/s00168-014-0624-2&gt;
</p>
</li>
<li><p> Minguez, R., Lopez, F.A. and Mur, J.  (2022).
spsur: An R Package for Dealing with Spatial 
Seemingly Unrelated Regression Models. 
<em>Journal of Statistical Software</em>, 
104(11), 1&ndash;43. &lt;doi:10.18637/jss.v104.i11&gt;#'        
</p>
</li>
<li><p> Anselin, L. (1988) A test for spatial autocorrelation in seemingly unrelated 
regressions <em>Economics Letters</em> 28(4), 335-341.
&lt;doi:10.1016/0165-1765(88)90009-2&gt; 
</p>
</li>
<li><p> Anselin, L. (1988) <em>Spatial econometrics: methods and models</em> 
Chap. 9 Dordrecht
</p>
</li>
<li><p> Anselin, L. (2016) Estimation and Testing in the Spatial Seemingly 
Unrelated Regression (SUR). <em>Geoda Center for Geospatial Analysis 
and Computation, Arizona State University</em>. Working Paper 2016-01.
&lt;doi:10.13140/RG.2.2.15925.40163&gt;
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+spsurml">spsurml</a></code>, <code><a href="#topic+anova">anova</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#################################################
######## CROSS SECTION DATA (G&gt;1; Tm=1) # #######
#################################################

#### Example 1: Spatial Phillips-Curve. Anselin (1988, p. 203)
rm(list = ls()) # Clean memory
data("spc")
Tformula &lt;- WAGE83 | WAGE81 ~ UN83 + NMR83 + SMSA | UN80 + NMR80 + SMSA
lwspc &lt;- spdep::mat2listw(Wspc, style = "W")
lmtestspsur(formula = Tformula, data = spc, listw = lwspc)

## VIP: The output of the whole set of the examples can be examined 
## by executing demo(demo_lmtestspsur, package="spsur")


#################################################
######## PANEL DATA (G&gt;1; Tm&gt;1)          ########
#################################################

#### Example 2: Homicides &amp; Socio-Economics (1960-90)
# Homicides and selected socio-economic characteristics for
# continental U.S. counties.
# Data for four decennial census years: 1960, 1970, 1980 and 1990.
# https://geodacenter.github.io/data-and-lab/ncovr/
data(NCOVR, package="spsur")
nbncovr &lt;- spdep::poly2nb(NCOVR.sf, queen = TRUE)
### Some regions with no links...
lwncovr &lt;- spdep::nb2listw(nbncovr, style = "W", zero.policy = TRUE)
### With different number of exogenous variables in each equation
Tformula &lt;- HR70 | HR80  | HR90 ~ PS70 + UE70 | PS80 + UE80 +RD80 |
            PS90 + UE90 + RD90 + PO90
lmtestspsur(formula = Tformula, data = NCOVR.sf, 
            listw = lwncovr)

#################################################################
######### PANEL DATA: TEMPORAL CORRELATIONS (G=1; Tm&gt;1) ########
#################################################################

##### Example 3: NCOVR in panel data form
Year &lt;- as.numeric(kronecker(c(1960,1970,1980,1990), 
                   matrix(1,nrow = dim(NCOVR.sf)[1])))
HR &lt;- c(NCOVR.sf$HR60,NCOVR.sf$HR70,NCOVR.sf$HR80,NCOVR.sf$HR90)
PS &lt;- c(NCOVR.sf$PS60,NCOVR.sf$PS70,NCOVR.sf$PS80,NCOVR.sf$PS90)
UE &lt;- c(NCOVR.sf$UE60,NCOVR.sf$UE70,NCOVR.sf$UE80,NCOVR.sf$UE90)
NCOVRpanel &lt;- as.data.frame(cbind(Year,HR,PS,UE))
Tformula &lt;- HR ~ PS + UE
lmtestspsur(formula = Tformula, data = NCOVRpanel, time = Year, 
listw = lwncovr)


</code></pre>

<hr>
<h2 id='lr_betas'>Likelihood ratio for testing homogeneity constraints on beta coefficients of the SUR equations.</h2><span id='topic+lr_betas'></span>

<h3>Description</h3>

<p>Function <code><a href="#topic+lr_betas">lr_betas</a></code> obtains a Likelihood Ratio test, LR in what follows,
with the purpose of testing if some of the <code class="reqn">\beta</code> coefficients in the <em>G</em> equations of the
<em>SUR</em> model are equal. This function has a straightforward application, especially when <code class="reqn">G=1</code>,
to the case of testing for the existence of structural breaks in the <code class="reqn">\beta</code> parameters.
</p>
<p>The function can test for the homogeneity of only one coefficient, of a few of them
or even the homogeneity of all the slope terms. The testing procedure implies, <em>first</em>,
the estimation of both a constrained and a unconstrained model and, <em>second</em>, the comparison
of the log-likelihoods to compute the LR statistics.
</p>
<p>@usage lr_betas (obj, R, b)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lr_betas(obj, R, b)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="lr_betas_+3A_obj">obj</code></td>
<td>
<p>An <code>spsur</code> object created by <code><a href="#topic+spsurml">spsurml</a></code>,
<code><a href="#topic+spsur3sls">spsur3sls</a></code> or <code><a href="#topic+spsurtime">spsurtime</a></code>.</p>
</td></tr>
<tr><td><code id="lr_betas_+3A_r">R</code></td>
<td>
<p>A row vector of order <code class="reqn">(1xPr)</code> showing  the set
of <em>r</em> linear constraints on the <code class="reqn">\beta</code> parameters. 
The <em>first</em> restriction appears in the first <em>K</em> terms 
in <em>R</em>, the <em>second</em> restriction in the next <em>K</em> terms 
and so on.</p>
</td></tr>
<tr><td><code id="lr_betas_+3A_b">b</code></td>
<td>
<p>A column vector of order <em>(rx1)</em> with the values of the 
linear restrictions on the <code class="reqn">\beta</code> parameters.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Object of <code>htest</code> including the LR
statistic, the corresponding p-value, the degrees of
freedom and the values of the sample estimates.
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
  Fernando Lopez  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Jesus Mur  </td><td style="text-align: left;"> <a href="mailto:jmur@unizar.es">jmur@unizar.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Mur, J., Lopez, F., and Herrera, M. (2010). Testing for spatial
effects in seemingly unrelated regressions.
<em>Spatial Economic Analysis</em>, 5(4), 399-440.
&lt;doi:10.1080/17421772.2010.516443&gt;
</p>
</li>
<li><p> Minguez, R., Lopez, F.A. and Mur, J.  (2022).
spsur: An R Package for Dealing with Spatial 
Seemingly Unrelated Regression Models. 
<em>Journal of Statistical Software</em>, 
104(11), 1&ndash;43. &lt;doi:10.18637/jss.v104.i11&gt;
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+spsurml">spsurml</a></code>, <code><a href="#topic+spsurtime">spsurtime</a></code>, <code><a href="#topic+wald_betas">wald_betas</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## VIP: The output of the whole set of the examples can be examined 
## by executing demo(demo_lr_betas, package="spsur")


#' #################################################
######## CROSS SECTION DATA (G&gt;1; Tm=1)  ########
#################################################

#### Example 1: Spatial Phillips-Curve. Anselin (1988, p. 203)
rm(list = ls()) # Clean memory
data(spc)
lwspc &lt;- spdep::mat2listw(Wspc, style = "W")
Tformula &lt;- WAGE83 | WAGE81 ~ UN83 + NMR83 + SMSA | UN80 + NMR80 + SMSA
### H0: equal beta for SMSA in both equations.
R &lt;- matrix(c(0,0,0,1,0,0,0,-1), nrow=1)
b &lt;- matrix(0, ncol=1)
spcsur.slm &lt;- spsurml(formula = Tformula, data = spc, 
                      type = "slm", listw = lwspc)
summary(spcsur.slm)
lr_betas(spcsur.slm, R = R, b = b)

### Estimate restricted SUR-SLM model
spcsur.slmr &lt;- spsurml(formula = Tformula, data = spc, 
                      type = "slm", listw = lwspc,
                      R = R, b = b)
summary(spcsur.slmr)

</code></pre>

<hr>
<h2 id='methods_spsur'>Methods for class spsur</h2><span id='topic+methods_spsur'></span><span id='topic+anova'></span><span id='topic+anova.spsur'></span><span id='topic+coef'></span><span id='topic+coef.spsur'></span><span id='topic+fitted'></span><span id='topic+fitted.spsur'></span><span id='topic+logLik'></span><span id='topic+logLik.spsur'></span><span id='topic+residuals'></span><span id='topic+residuals.spsur'></span><span id='topic+vcov'></span><span id='topic+vcov.spsur'></span><span id='topic+print'></span><span id='topic+print.spsur'></span><span id='topic+plot'></span><span id='topic+plot.spsur'></span>

<h3>Description</h3>

<p>The <code>anova()</code> function provides tables of fitted 
spsur models including information criteria (AIC and BIC), 
log-likelihood and degrees of freedom of each fitted model. The 
argument <code>lrtest</code> allows to perform LR tests between nested models.
The <code>plot()</code> function allows the user to plot both beta and spatial
coefficients for all equations of the spsur model. The argument 
<code>viewplot</code> is used to choose between interactive or non-interactive
plots. The <code>print()</code> function is used to print short tables including the values of beta and
spatial coefficients as well as p-values of significance test for each 
coefficient. This can be used as an alternative to 
<code><a href="#topic+summary.spsur">summary.spsur</a></code> when a brief output is needed. 
The rest of methods works in the usual way.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'spsur'
anova(object, ..., lrtest = TRUE)

## S3 method for class 'spsur'
coef(object, ...)

## S3 method for class 'spsur'
fitted(object, ...)

## S3 method for class 'spsur'
logLik(object, ...)

## S3 method for class 'spsur'
residuals(object, ...)

## S3 method for class 'spsur'
vcov(object, ...)

## S3 method for class 'spsur'
print(x, digits = max(3L, getOption("digits") - 3L), ...)

## S3 method for class 'spsur'
plot(x, ci = 0.95, viewplot = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="methods_spsur_+3A_object">object</code></td>
<td>
<p>a <code>spsur</code> object created by <code><a href="#topic+spsurml">spsurml</a></code>,
<code><a href="#topic+spsur3sls">spsur3sls</a></code> or <code><a href="#topic+spsurtime">spsurtime</a></code>.</p>
</td></tr>
<tr><td><code id="methods_spsur_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
<tr><td><code id="methods_spsur_+3A_lrtest">lrtest</code></td>
<td>
<p>logical value to compute likelihood ratio
test for nested models in 'anova' method. Default = <code>TRUE</code></p>
</td></tr>
<tr><td><code id="methods_spsur_+3A_x">x</code></td>
<td>
<p>similar to <code>object</code> argument for <code>print()</code> 
and <code>plot</code> functions.</p>
</td></tr>
<tr><td><code id="methods_spsur_+3A_digits">digits</code></td>
<td>
<p>number of digits to show in printed tables.
Default: max(3L, getOption(&quot;digits&quot;) - 3L).</p>
</td></tr>
<tr><td><code id="methods_spsur_+3A_ci">ci</code></td>
<td>
<p>confidence level for the intervals in 'plot' method. 
Default <code>ci = 0.95</code></p>
</td></tr>
<tr><td><code id="methods_spsur_+3A_viewplot">viewplot</code></td>
<td>
<p>logical value to show interactively the plots. 
Default = <code>TRUE</code></p>
</td></tr>
</table>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
  Fernando Lopez  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Jesus Mur  </td><td style="text-align: left;"> <a href="mailto:jmur@unizar.es">jmur@unizar.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>Examples</h3>

<pre><code class='language-R'>rm(list = ls()) # Clean memory
data(spc)
Tformula &lt;- WAGE83 | WAGE81 ~ UN83 + NMR83 + SMSA | UN80 + NMR80 + SMSA
spcsur.sim &lt;-spsurml(formula = Tformula, data = spc, type = "sim")
## Print Table       
print(spcsur.sim)

spcsur.slm &lt;-spsurml(formula = Tformula, data = spc, type = "slm", 
                     listw = Wspc)
# ANOVA table and LR test for nested models:
anova(spcsur.sim, spcsur.slm)
## Plot spatial and beta coefficients
# Interactive plot
plot(spcsur.slm)
# Non-interactive plot
if (require(gridExtra)) {
  pl &lt;- plot(spcsur.slm, viewplot = FALSE) 
  grid.arrange(pl$lplbetas[[1]], pl$lplbetas[[2]], 
               pl$pldeltas, nrow = 3)
}

</code></pre>

<hr>
<h2 id='NCOVR.sf'>Homicides in U.S. counties</h2><span id='topic+NCOVR.sf'></span>

<h3>Description</h3>

<p>Homicides and selected socio-economic characteristics for continental
U.S. counties. Data for four decennial census years: 1960, 1970, 1980
and 1990.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NCOVR.sf
</code></pre>


<h3>Format</h3>

<p>An spatial feature (sf) object with 3085 rows and 41 variables:
</p>

<dl>
<dt>NAME</dt><dd><p>County coded as a name (factor)</p>
</dd>
<dt>STATE_NAME</dt><dd><p>state fips code (factor)</p>
</dd>
<dt>FIPS</dt><dd><p>state fips code (factor)</p>
</dd>
<dt>SOUTH</dt><dd><p>dummy variable for Southern counties (South = 1)</p>
</dd>
<dt>HR60, HR70, HR80, HR90</dt><dd><p>homicide rate per 100,000 (1960, 1970,
1980, 1990)</p>
</dd>
<dt>HC60, HC70, HC80, HC90</dt><dd><p>homicide count, three year average centered
on 1960, 1970, 1980, 1990</p>
</dd>
<dt>PO60, PO70, PO80, PO90</dt><dd><p>county population, 1960, 1970, 1980, 1990</p>
</dd>
<dt>RD60, RD70, RD80, RD90</dt><dd><p>resource deprivation 1960, 1970, 1980,
1990 (principal component, see Codebook for details)</p>
</dd>
<dt>PS60, PS70, PS80, PS90</dt><dd><p>population structure 1960, 1970, 1980,
1990 (principal component, see Codebook for details)</p>
</dd>
<dt>UE60, UE70, UE80, UE90</dt><dd><p>unemployment rate 1960, 1970, 1980, 1990</p>
</dd>
<dt>DV60, DV70, DV80, DV90</dt><dd><p>divorce rate 1960, 1970, 1980, 1990
(% males over 14 divorced)</p>
</dd>
<dt>MA60, MA70, MA80, MA90</dt><dd><p>median age 1960, 1970, 1980, 1990</p>
</dd>
<dt>FP59, FP69, FP79, FP89</dt><dd><p>% families below poverty 1960, 1970, 1980,
1990 (see Codebook for details)</p>
</dd>
<dt>geometry</dt><dd><p>Multipolygon geometry of the spatial feature object</p>
</dd>   
</dl>



<h3>Source</h3>

<p>S. Messner, L. Anselin, D. Hawkins, G. Deane, S. Tolnay, R. Baller
(2000). An Atlas of the Spatial Patterning of County-Level
Homicide, 1960-1990. Pittsburgh, PA, National Consortium on
Violence Research (NCOVR)
<a href="https://geodacenter.github.io/data-and-lab/ncovr/">https://geodacenter.github.io/data-and-lab/ncovr/</a>
</p>


<h3>References</h3>


<ul>
<li><p> Baller, R., L. Anselin, S. Messner, G. Deane and D. Hawkins
(2001). Structural covariates of US county homicide rates:
incorporating spatial effects. <em>Criminology</em> 39, 561-590.
</p>
</li></ul>


<hr>
<h2 id='print.summary.spsur'>Print method for objects of class summary.spsur.</h2><span id='topic+print.summary.spsur'></span>

<h3>Description</h3>

<p>Print method for objects of class summary.spsur.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'summary.spsur'
print(x, digits = max(3L, getOption("digits") - 3L), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.summary.spsur_+3A_x">x</code></td>
<td>
<p>object of class <em>summary.spsur</em>.</p>
</td></tr>
<tr><td><code id="print.summary.spsur_+3A_digits">digits</code></td>
<td>
<p>number of digits to show in printed tables.
Default: max(3L, getOption(&quot;digits&quot;) - 3L).</p>
</td></tr>
<tr><td><code id="print.summary.spsur_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
  Fernando Lopez  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Jesus Mur  </td><td style="text-align: left;"> <a href="mailto:jmur@unizar.es">jmur@unizar.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>See Also</h3>

<p><code><a href="#topic+summary.spsur">summary.spsur</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'> # See examples for \code{\link{spsurml}} or
 # \code{\link{spsur3sls}} functions.
</code></pre>

<hr>
<h2 id='spain.covid'>Within/Exit mobility index and incidence COVID-19 at Spain provinces</h2><span id='topic+spain.covid'></span>

<h3>Description</h3>

<p>Weekly within/exit mobility indices and COVID-19 incidence in Spain at provincial level. A total of 17 weeks from February 21 to 
May 21. Every week starts on a Friday and ends on the following Thursday. All travels 
are expressed with respect to the pre-COVID week of February 14th-20th, 2020 (week0). A value lower than 1
indicate a reduction of the mobility. Upper values than 1 indicate an increase in the mobility with respect
to the reference week (week0).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spain.covid
</code></pre>


<h3>Format</h3>

<p>A data frame with 850 rows and 11 variables:
</p>

<dl>
<dt>province</dt><dd><p>Province name coded as a factor</p>
</dd>
<dt>indiv</dt><dd><p>Province coded as a number</p>
</dd>
<dt>time</dt><dd><p>Number of week afther pre-COVID (week0: February 14th-20th, 2020). 
time=1 (week1, February 21th-27th); time=2 (week2,February 28th-March 5th);....</p>
</dd>
<dt>Within</dt><dd><p>Mobility index within of the province. See details for a formal definition</p>
</dd> 
<dt>Exits</dt><dd><p>Mobility index of exits of the province. See details for a formal definition</p>
</dd>
<dt>Emergence</dt><dd><p>Dummy variable. 1 if the Emergence State (&quot;Estado de Alarma&quot;) is active in the week &quot;time&quot; but economic
activity of essential services are allowed. 0 in anoter case.
The Emergence State was active in Spain from February 14th, 2020 to May 21th, 2020</p>
</dd>
<dt>EmergenceTotal</dt><dd><p>Dummy variable. 1 if the Emergence State (&quot;Estado de Alarma&quot;) is active in the week &quot;time&quot; and economic 
activity of essential services are not allowed. 0 in anoter case</p>
</dd>
<dt>Old65</dt><dd><p>Percentage of population aged 65 and older in the province</p>
</dd>
<dt>Density</dt><dd><p>Inhabitants (in thousands) per km^2 in the province</p>
</dd>
<dt>Essential</dt><dd><p>Percentage of firms in the province &quot;indiv&quot; with essential activities (food, health) over the total of firms in the province &quot;indiv&quot; 
in the province (e.g., food, heath and some economic subsectors of industry and construction)</p>
</dd>
<dt>Incidence</dt><dd><p>Weekly incidence in the week &quot;time-1&quot; in logs</p>
</dd>
</dl>



<h3>Details</h3>


<ul>
<li><p> Mobility
<br />
<br />
The mobility indices Within and Exits has been obtain as ratio of the total number of weekly travels
in reference to the total number of travels in the week of reference (week0). <br />
In particular, 
<br /> 
<br /> 
<code class="reqn">
 Within = \frac{\textnormal{Number of travels within the province 
 'indiv' in the week 'time'}} 
  {\textnormal{Number of travels within the province 'indiv' in the 
  reference week (week0)}} </code>
<br /> 
<br /> 
<code class="reqn">
  Exits = \frac{ \textnormal{Number of travels 
             with origin in the province 'indiv' 
             and arrival to another 
             province in the week 'time'} } 
         { \textnormal{Number of travels with origin 
              in the province 'indiv' and arrival to 
              another province in the reference 
              week (week0)} } </code>
<br /> 
<br />
A ‘travel’ is a displacement from an origin to a destination of at least 500m. A travel can have several stages.
These stages of the same travel are calculated based on the duration of the intermediate stop. For example
, if I move from origin A to destination B with a stop at a point C of long duration, it
is considered two travels, but if the stop is short, it is considered a single travel. For example,
I can go by train from Madrid to Alicante, and there takes a bus to Benidorm. The travel will be one
(Madrid-Benidorm). If I do the same but the stop in Alicante is long (or an overnight stay, for example),
two travels will be considered (Madrid-Alicante, and Alicante-Benidorm). Similarly, if I go by car from
Madrid to Alicante and stop for 15 minutes to take a coffee, it is also considered only one travel and not two.
The travels considered in this study are always from 500m, due to the limitation of source data that is based
on mobile telephony and its antennas. But one travel can be 600 meters or 600km.
<br />
<br />
</p>
</li>
<li><p> Incidence
<br />
<br />
<code class="reqn">
  Incidence = \log \left( 
    \frac{ 
      \textnormal{total diagnostic cases of 
                  COVID-19, PCR test in the 
                  week 'time' at the province 
                  'indiv'} } 
    {\textnormal{total population in the 
    province 'indiv'}}
  \right) </code>
<br />
<br />
</p>
</li>
<li><p> Essential activities
<br />
<br />
Essential activities. Economic activities whose activities are essential for the population. By example, essential activities are
healthcare, food supply, State security, media and communication, refuse collection, management and public transport, etc.
Non essential activities are by example, restaurants, hotels, hairdressers, etc. A full list in the Spanish official bulletin
</p>
</li></ul>



<h3>Source</h3>

<p>The National Statistics Institute 
<br />
<a href="https://www.ine.es/en/index.htm">https://www.ine.es/en/index.htm</a>
<br />
Instituto de Salud Carlos III
<br />
<a href="https://cnecovid.isciii.es/covid19/">https://cnecovid.isciii.es/covid19/</a>
</p>

<hr>
<h2 id='spain.covid.sf'>Spain geometry</h2><span id='topic+spain.covid.sf'></span>

<h3>Description</h3>

<p>A sf object with the Spanish geometry
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spain.covid.sf
</code></pre>


<h3>Format</h3>

<p>A sf object with the Spanish geometry
</p>

<dl>
<dt>PROVINCIA</dt><dd><p>province name coded as a factor</p>
</dd>
<dt>ID_INE</dt><dd><p>province coded as a number</p>
</dd>
</dl>


<hr>
<h2 id='spc'>A classical Spatial Phillips-Curve</h2><span id='topic+spc'></span>

<h3>Description</h3>

<p>A data set from Anselin (1988, p. 203-2011) used to estimate a Spatial
Phillips-Curve for 25 counties in South-West Ohio for two time
periods (1981 and 1983).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spc
</code></pre>


<h3>Format</h3>

<p>A data frame with 25 rows and 10 variables:
</p>

<dl>
<dt>COUNTY</dt><dd><p>County coded as a name.</p>
</dd>
<dt>WAGE83</dt><dd><p>Changes in wage rates for 1983.</p>
</dd>
<dt>UN83</dt><dd><p>Inverse unemployment rate in 1983.</p>
</dd>
<dt>NMR83</dt><dd><p>Net migration rate 1983.</p>
</dd>
<dt>SMSA</dt><dd><p>Dummy variable to identify counties defined as
Standard Metropolitan Statistical Areas (SMSA = 1).</p>
</dd>
<dt>WAGE82</dt><dd><p>Changes in wage rates for 1982.</p>
</dd>
<dt>WAGE81</dt><dd><p>Changes in wage rates for 1981.</p>
</dd>
<dt>UN80</dt><dd><p>Inverse unemployment rate in 1980.</p>
</dd>
<dt>NMR80</dt><dd><p>Net migration rate 1983.</p>
</dd>
<dt>WAGE80</dt><dd><p>changes in wage rates.</p>
</dd>
<dt>geometry</dt><dd><p>geometry of sf object.</p>
</dd>
</dl>



<h3>Source</h3>

<p>Anselin (1988, p. 203-211)
</p>


<h3>References</h3>


<ul>
<li><p> Anselin, L. (1988). <em>Spatial Econometrics:
Methods and Models</em>. Springer Science &amp; Business Media.
</p>
</li></ul>


<hr>
<h2 id='spsur-package'>Spatial Seemingly Unrelated Regression Models.</h2><span id='topic+spsur-package'></span>

<h3>Description</h3>

<p><span class="pkg">spsur</span> offers the user a collection of functions to estimate Spatial 
Seemingly Unrelated Regression (SUR) models by maximum likelihood or 
three-stage least squares, using spatial instrumental variables. 
Moreover, <span class="pkg">spsur</span> obtains a collection of misspecification
tests for omitted or wrongly specified spatial structure. The user will 
find spatial models more popular in applied research such as the SUR-SLX, 
SUR-SLM, SUR-SEM, SUR-SDM, SUR-SDEM SUR-SARAR and SUR-GNM 
plus the spatially independent SUR, or SUR-SIM.
</p>


<h3>Details</h3>

<p>Some functionalities that have been included in <span class="pkg">spsur</span> package are:
</p>


<h3>1. Testing for spatial effects</h3>

<p>The function <code><a href="#topic+lmtestspsur">lmtestspsur</a></code> provides a collection of 
Lagrange Multipliers, LM, for testing different forms of spatial 
dependence in SUR models. They are extended versions of
the well-known LM tests for omitted lags of the explained variable in 
the right hand side of the equation, LM-SLM, the LM tests for omitted 
spatial errors, LM-SEM, the join test of omitted spatial lags and 
spatial errors, LM-SARAR, and the robust version of the firt
two Lagrange Multipliers, LM*-SLM  and LM*-SEM. <br />
These tests can be applied to models always with a SUR nature. Roughly, 
we may distinguish two situations:
</p>

<ul>
<li><p> Datasets with a single equation <em>G=1</em>, for different time 
periods <em>Tm&gt;1</em> and a certain number of spatial units in the 
cross-sectional dimension, <em>N</em>. This is what we call
<em>spatial panel datasets</em>. In this case, the SUR structure appears 
in form of (intra) serial dependence in the errors of each spatial unit.
</p>
</li>
<li><p> Datasets with a several equations <em>G&gt;1</em>, different time 
periods <em>Tm&gt;1</em> and a certain number of spatial units, <em>N</em>. 
The SUR structure appears, as usual, because the errors
of the spatial units for different equations are contemporaneously 
correlated.
</p>
</li></ul>



<h3>2. Estimation of the Spatial SUR models</h3>

<p>As indicated above, <span class="pkg">spsur</span> package may work with a list of 
different spatial specifications.
They are the following:
</p>

<ul>
<li> <p><em>SUR-SIM</em>: SUR model without spatial effects
</p>
<p style="text-align: center;"><code class="reqn"> y_{tg} =  X_{tg} \beta_{g} + \epsilon_{tg} </code>
</p>

</li>
<li> <p><em>SUR-SLX</em>: SUR model with spatial lags of the regresors
</p>
<p style="text-align: center;"><code class="reqn"> y_{tg} = X_{tg} \beta_{g} + 
                           WX_{tg} \theta_{g} + \epsilon_{tg} </code>
</p>

</li>
<li> <p><em>SUR-SLM</em>: SUR model with spatial lags of the endogenous
</p>
<p style="text-align: center;"><code class="reqn">y_{tg} = \rho_{g} Wy_{tg} + X_{tg} \beta_{g} + 
                          \epsilon_{tg} </code>
</p>

</li>
<li> <p><em>SUR-SEM</em>: SUR model with spatial errors
</p>
<p style="text-align: center;"><code class="reqn"> y_{tg} = X_{tg} \beta_{g} + u_{tg} </code>
</p>

<p style="text-align: center;"><code class="reqn"> u_{tg} = \lambda_{g} Wu_{tg} + \epsilon_{tg} </code>
</p>

</li>
<li> <p><em>SUR-SDM</em>: SUR model with spatial lags of the endogenous 
variable and of the regressors or Spatial Durbin model
</p>
<p style="text-align: center;"><code class="reqn"> y_{tg} = \rho_{g} Wy_{tg} + X_{tg} \beta_{g} + 
                            WX_{tg} \theta_{g} + \epsilon_{tg} </code>
</p>

</li>
<li> <p><em>SUR-SDEM</em>: SUR model with spatial errors and spatial 
lags of the endogenous variable and of the regressors
</p>
<p style="text-align: center;"><code class="reqn"> y_{tg} = X_{tg} \beta_{g} + WX_{tg} \theta_{g} + u_{tg} </code>
</p>

<p style="text-align: center;"><code class="reqn"> u_{tg} = \lambda_{g} W u_{tg} + \epsilon_{tg} </code>
</p>

</li>
<li> <p><em>SUR-SARAR</em>: Spatial lag model with spatial errors
</p>
<p style="text-align: center;"><code class="reqn"> y_{tg} = \rho_{g} Wy_{tg} + X_{tg} \beta_{g} + 
                             u_{tg} </code>
</p>

<p style="text-align: center;"><code class="reqn"> u_{tg} = \lambda_{g} W u_{tg} + \epsilon_{tg} </code>
</p>

</li>
<li> <p><em>SUR-GNM</em>: SUR model with spatial lags of the explained 
variables, regressors and spatial errors
</p>
<p style="text-align: center;"><code class="reqn"> y_{tg} = \rho_{g} Wy_{tg} + X_{tg} \beta_{g} + 
                        WX_{tg} \theta_{g} + u_{tg} </code>
</p>

<p style="text-align: center;"><code class="reqn"> u_{tg} = \lambda_{g} W u_{tg} + \epsilon_{tg} </code>
</p>

</li></ul>

<p>where <code class="reqn">y_{tg}</code>, <code class="reqn">u_{tg}</code> and <code class="reqn">\epsilon_{tg}</code> are 
<em>(Nx1)</em> vectors; <code class="reqn">X_{tg}</code> is a matrix of regressors of 
order <em>(NxP)</em>; <code class="reqn">\rho_{g}</code> and <code class="reqn">\lambda_{g}</code> are 
parameters of spatial dependence and <em>W</em> is the
<em>(NxN)</em> spatial weighting matrix.
</p>
<p>These specifications can be estimated by maximum-likelihood 
methods, using the function <code><a href="#topic+spsurml">spsurml</a></code>. Moroever, 
the models that include spatial lags of the explained
variables in the right hand side of the equations, and the 
errors are assumed to be spatially incorrelated (namely, the 
SUR-SLM and the SUR-SDM), can also be estimated using
three-stage least-squares, <code><a href="#topic+spsur3sls">spsur3sls</a></code>, 
using spatial instrumental variable to correct for the problem of
endogeneity present in these cases.
</p>


<h3>3. Diagnostic tests</h3>

<p>Testing for inconsistencies or misspecifications in the results of an 
estimated (SUR) model should be a primary task for the user. <span class="pkg">spsur</span> 
focuses, especifically, on two main question such as omitted
or wrongly specified spatial structure and the existence of structural 
breaks or relevant restrictions
in the parameters of the model. In this sense, the user will find:
</p>

<ol>
<li> <p><em>Marginal tests</em> <br />
The Marginal Multipliers test for omitted or wrongly specified spatial 
structure in the equations. They are routinely part of the output of 
the maximum-likelihood estimation, shown by <code><a href="#topic+spsurml">spsurml</a></code>. 
In particular, the LM(<code class="reqn">\rho</code>|<code class="reqn">\lambda</code>) tests for omitted 
spatial lags in a model specified with spatial errors (SUR-SEM; 
SUR-SDEM). The LM(<code class="reqn">\lambda</code>|<code class="reqn">\rho</code>) tests for omitted 
spatial error in a model specified with spatial lags
of the explained variable (SUR-SLM; SUR-SDM).
</p>
</li>
<li> <p><em>Coefficients stability tests</em> <br />
<span class="pkg">spsur</span> includes two functions designed to test for linear 
restrictions on the <code class="reqn">\beta</code> coefficients of the models and on 
the spatial coefficients (<code class="reqn">\rho</code>s and <code class="reqn">\lambda</code>s terms). 
The function for the first case is <code><a href="#topic+wald_betas">wald_betas</a></code> and
<code><a href="#topic+wald_deltas">wald_deltas</a></code> that of the second case. The user has 
ample flexibility to define different forms of linear restrictions, 
so that it is possible, for example,
to test for their time constancy to identify structural breaks.
</p>
</li></ol>



<h3>4. Marginal effects</h3>

<p>In recent years, since the publication of LeSage and Pace (2009), 
it has become popular in
spatial econometrics to evaluate the multiplier effects that a change in 
the value of a regressor, in a point in the space, has on the explained 
variable. <span class="pkg">spsur</span> includes a function, <code>impacts</code>, 
that computes these effects. Specifically, <code>impacts</code> obtains
the average, over the <em>N</em> spatial units and <em>Tm</em> time periods, 
of such a change on the contemporaneous value of the explained variable 
located in the same point as the modified variable. This is the 
so-called <em>Average Direct effect</em>. The <em>Average Indirect 
effect</em> measure the proportion of the impact that spills-over to other 
locations. The sum of the two effects is the <em>Average Total effect</em>. 
<br />
These estimates are complemented with a measure of statistical 
significance, following the randomization approach suggested by 
LeSage and Pace (2009).
</p>


<h3>5. Additional functionalities</h3>

<p>A particular feature of <span class="pkg">spsur</span> is that the package allows to 
obtain simulated datasets with a SUR nature and the spatial structure 
decided by the user. This is the purpose of the function 
<code><a href="#topic+dgp_spsur">dgp_spsur</a></code>. The function can be inserted into a more 
general code to solve, for example, Monte Carlo studies related to 
these type of models or, simply, to show some of the stylized 
characteristics of a SUR model with certain spatial structure.
</p>


<h3>Datasets</h3>

<p><span class="pkg">spsur</span> includes three different datasets: spc, NCOVR and spain.covid. These 
sets are used to 
illustrate the capabilities of different functions. Briefly, their 
main characteristics are the following <br />
</p>

<ul>
<li><p> The <em>spc</em> dataset (Spatial Phillips-Curve) is a 
classical dataset taken from Anselin (1988, p. 203), of small 
dimensions.
</p>
</li>
<li><p> The <em>NCOVR</em> dataset comprises Homicides and a list of 
selected socio-economic variables for continental U.S. counties 
in four decennial census years: 1960, 1970, 1980 and 1990. 
It is freely available from
<a href="https://geodacenter.github.io/data-and-lab/ncovr/">https://geodacenter.github.io/data-and-lab/ncovr/</a>. 
<em>NCOVR</em> is a typical spatial panel dataset <em>(G=1)</em>.
</p>
</li>
<li><p> The <em>spain.covid</em> dataset comprises Within and Exit mobility index 
together with the weeklly incidence COVID-19 at Spain provinces from 
February 21 to May 21 2020. 
<a href="https://www.mitma.gob.es/ministerio/covid-19/evolucion-movilidad-big-data">https://www.mitma.gob.es/ministerio/covid-19/evolucion-movilidad-big-data</a>
</p>
</li></ul>



<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
  Fernando Lopez  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Jesus Mur  </td><td style="text-align: left;"> <a href="mailto:jmur@unizar.es">jmur@unizar.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Breusch T, Pagan A (1980). The Lagrange multiplier test
and its applications to model specification in econometrics.
<em>Review of Economic Studies</em> 47: 239-254.
</p>
</li>
<li><p> LeSage, J., and Pace, R. K. (2009). <em>Introduction to
spatial econometrics</em>. Chapman and Hall/CRC.
</p>
</li>
<li><p> Lopez, F.A., Mur, J., and Angulo, A. (2014). Spatial model
selection strategies in a SUR framework. The case of regional
productivity in EU. <em>Annals of Regional Science</em>,
53(1), 197-220.
&lt;doi:10.1007/s00168-014-0624-2&gt;
</p>
</li>
<li><p> Lopez, F.A., Martinez-Ortiz, P.J., and Cegarra-Navarro, J.G.
(2017). Spatial spillovers in public expenditure on a municipal
level in Spain. <em>Annals of Regional Science</em>, 58(1), 39-65.
&lt;doi:10.1007/s00168-016-0780-7&gt;
</p>
</li>
<li><p> Minguez, R., Lopez, F.A. and Mur, J.  (2022).
spsur: An R Package for Dealing with Spatial 
Seemingly Unrelated Regression Models. 
<em>Journal of Statistical Software</em>, 
104(11), 1&ndash;43.
&lt;doi:10.18637/jss.v104.i11&gt;
</p>
</li>
<li><p> Mur, J., Lopez, F., and Herrera, M. (2010). Testing for spatial
effects in seemingly unrelated regressions. <em>Spatial Economic
Analysis</em>, 5(4), 399-440.
&lt;doi:10.1080/17421772.2010.516443&gt;
</p>
</li></ul>


<hr>
<h2 id='spsur3sls'>Three Stages Least Squares estimation,3sls, of spatial SUR models.</h2><span id='topic+spsur3sls'></span>

<h3>Description</h3>

<p>The function estimates spatial SUR models using three stages
least squares, where the instruments are obtained from the spatial lags
of the <em>X</em> variables, assumed to be exogenous. The number of 
equations, time periods and spatial units is not restricted. The user can 
choose between a Spatial Durbin Model or a Spatial Lag Model, as described 
below. The estimation procedure allows for the introduction of linear 
restrictions on the <code class="reqn">\beta</code> parameters associated to the regressors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spsur3sls (formula = NULL, data = NULL, na.action,
                  R = NULL, b = NULL, listw = NULL, 
                  zero.policy = NULL, X= NULL, Y = NULL, G = NULL, 
                  N = NULL, Tm = NULL, p = NULL,  
                  type = "slm", Durbin = NULL, maxlagW = NULL,
                  trace = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="spsur3sls_+3A_formula">formula</code></td>
<td>
<p>An object type <code><a href="Formula.html#topic+Formula">Formula</a></code> 
similar to objects created with the package <span class="pkg">Formula</span> 
describing the equations to be estimated in the model. 
This model may contain several responses (explained 
variables) and a varying number of regressors in each equation.</p>
</td></tr>
<tr><td><code id="spsur3sls_+3A_data">data</code></td>
<td>
<p>An object of class data.frame or a matrix.</p>
</td></tr>
<tr><td><code id="spsur3sls_+3A_na.action">na.action</code></td>
<td>
<p>A function (default <code>options("na.action")</code>),
can also be <code>na.omit</code> or <code>na.exclude</code> with consequences 
for residuals and fitted values. It may be necessary to set 
<code>zero.policy</code> to <code>TRUE</code> because this subsetting may 
create no-neighbour observations.</p>
</td></tr>
<tr><td><code id="spsur3sls_+3A_r">R</code></td>
<td>
<p>A row vector of order <em>(1xpr)</em> with  the set of 
<em>r</em> linear constraints on the <em>beta</em> parameters. The 
<em>first</em> restriction appears in the first <em>p</em> terms,
the second restriction in the next <em>p</em> terms and so on. 
Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="spsur3sls_+3A_b">b</code></td>
<td>
<p>A column vector of order <em>(rx1)</em> with the values of 
the linear restrictions on the <em>beta</em> parameters. 
Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="spsur3sls_+3A_listw">listw</code></td>
<td>
<p>A <code>listw</code> object created for example by 
<code><a href="spdep.html#topic+nb2listw">nb2listw</a></code> from <span class="pkg">spatialreg</span> package; if 
<code><a href="spdep.html#topic+nb2listw">nb2listw</a></code> not given, set to 
the same spatial weights as the <code>listw</code> argument. It can
also be a spatial weighting matrix of order <em>(NxN)</em> instead of
a <code>listw</code> object. Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="spsur3sls_+3A_zero.policy">zero.policy</code></td>
<td>
<p>Similar to the corresponding parameter of 
<code><a href="spatialreg.html#topic+lagsarlm">lagsarlm</a></code> function in <span class="pkg">spatialreg</span> package. 
If <code>TRUE</code> assign zero to the lagged value of zones without 
neighbours, if <code>FALSE</code> assign <code>NA</code> - causing 
<code>spsurml()</code> to terminate with an error. Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="spsur3sls_+3A_x">X</code></td>
<td>
<p>A data matrix of order <em>(NTmGxp)</em> with the observations
of the regressors. The number of covariates in the SUR model is 
<em>p</em> = <code class="reqn">sum(p_{g})</code> where <em><code class="reqn">p_{g}</code></em> is the number 
of regressors (including the intercept) in the g-th equation, 
<em>g = 1,...,G</em>). The specification of &quot;X&quot; is only 
necessary if not available a <code><a href="Formula.html#topic+Formula">Formula</a></code> and a 
data frame. Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="spsur3sls_+3A_y">Y</code></td>
<td>
<p>A column vector of order <em>(NTmGx1)</em>, with the 
observations of the explained variables. The ordering of the data 
must be (first) equation, (second) time dimension and (third) 
cross-sectional/spatial units. The specification of <em>Y</em> is 
only necessary if not available a <code><a href="Formula.html#topic+Formula">Formula</a></code>
and a data frame. Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="spsur3sls_+3A_g">G</code></td>
<td>
<p>Number of equations.</p>
</td></tr>
<tr><td><code id="spsur3sls_+3A_n">N</code></td>
<td>
<p>Number of cross-section or spatial units</p>
</td></tr>
<tr><td><code id="spsur3sls_+3A_tm">Tm</code></td>
<td>
<p>Number of time periods.</p>
</td></tr>
<tr><td><code id="spsur3sls_+3A_p">p</code></td>
<td>
<p>Number of regressors by equation, including the intercept. 
<em>p</em> can be a row vector of order <em>(1xG)</em>, if the number 
of regressors is not the same for all the equations, or a scalar, 
if the <em>G</em> equations have the same number of regressors. The 
specification of <em>p</em> is only necessary if not available a 
<code><a href="Formula.html#topic+Formula">Formula</a></code> and a data frame.</p>
</td></tr>
<tr><td><code id="spsur3sls_+3A_type">type</code></td>
<td>
<p>Type of spatial model, restricted to cases where lags of the 
explained variable appear in the rigth hand side of the equations. There 
are two possibilities: &quot;slm&quot; or &quot;sdm&quot;. Default = &quot;slm&quot;.</p>
</td></tr>
<tr><td><code id="spsur3sls_+3A_durbin">Durbin</code></td>
<td>
<p>If a formula object and model is type &quot;sdm&quot; the subset 
of explanatory variables to lag for each equation.</p>
</td></tr>
<tr><td><code id="spsur3sls_+3A_maxlagw">maxlagW</code></td>
<td>
<p>Maximum spatial lag order of the regressors employed to 
produce spatial instruments for the spatial lags of the explained variables. 
Default = 2. Note that in case of <code>type</code>=&quot;sdm&quot;, the default value for 
<code>maxlagW</code> is set to 3 because the first lag of the regressors, 
<code class="reqn">WX_{tg}</code>, can not be used as spatial instruments.</p>
</td></tr>
<tr><td><code id="spsur3sls_+3A_trace">trace</code></td>
<td>
<p>A logical value to show intermediate results during 
the estimation process. Default = <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><em>spsur3sls</em> can be used to estimate two groups of spatial models:
</p>

<ul>
<li><p> &quot;slm&quot;: SUR model with spatial lags of the endogenous in 
the right hand side of the equations
</p>
<p style="text-align: center;"><code class="reqn">y_{tg} = \rho_{g} Wy_{tg} + X_{tg} \beta_{g} + \epsilon_{tg} </code>
</p>

</li>
<li><p> &quot;sdm&quot;: SUR model of the Spatial Durbin type
</p>
<p style="text-align: center;"><code class="reqn"> y_{tg} = \rho_{g} Wy_{tg} + X_{tg} \beta_{g} +
             WX_{tg} \theta_{g} + \epsilon_{tg} </code>
</p>

</li></ul>

<p>where <code class="reqn">y_{tg}</code> and <code class="reqn">\epsilon_{tg}</code> are <em>(Nx1)</em> vectors,
corresponding to the g-th equation and time period t; <code class="reqn">X_{tg}</code> is 
the matrix of regressors, of order <em>(Nxp_g)</em>. Moreover, 
<code class="reqn">\rho_{g}</code> is a spatial coefficient and <em>W</em> is a 
<em>(NxN)</em> spatial weighting matrix.
</p>
<p>By default, the input of this function is an object created with 
<code><a href="Formula.html#topic+Formula">Formula</a></code> and a data frame. However, 
<em>spsur3sls</em> also allows for the direct specification of vector
<em>Y</em> and matrix <em>X</em>, with the explained variables and  regressors 
respectively, as inputs (these terms may be the result, for example, 
of <code><a href="#topic+dgp_spsur">dgp_spsur</a></code>). <br />
</p>
<p><code>spsur3sls</code> is a Least-Squares procedure in three-stages designed 
to circumvent the endogeneity problems due to the presence of spatial 
lags of the explained variable in the right hand side of the equations 
do the SUR. The instruments are produced internally by <code>spsur3sls</code> 
using a sequence of spatial lags of the <em>X</em> variables, which are 
assumed to be exogenous. The user must define the number of (spatial) 
instruments to be used in the procedure, through the argument 
<code>maxlagW</code> (i.e. maxlagW = 3). Then, the collection of instruments 
generated is <code class="reqn">[WX_{tg}; W*WX_{tg}; W*W*WX_{tg}]</code>. In the case of 
a <em>SDM</em>, the first lag of the <em>X</em> matrix already is in the 
equation and cannot be used as instrument. In the example above, the 
list of instruments for a <em>SDM</em> model would be 
<code class="reqn">[W^{2}X_{tg}; W^{3}X_{tg}]</code>.
</p>
<p>The <em>first</em> stage of the procedure consists in the least squares 
of the <em>Y</em> variables on the set of instruments. From this 
estimation, the procedure retains the estimates of <em>Y</em>
in the so-called <em>Yls</em> variables. In the <em>second</em> stage, 
the <em>Y</em> variables that appear in the right hand side of the equation 
are substituted by <em>Yls</em> and the SUR model
is estimated by Least Squares. The <em>third</em> stage improves the 
estimates of the second stage through a Feasible Generalized Least Squares 
estimation of the parameters of the model,
using the residuals of the <em>second</em> stage to estimate the 
<em>Sigma</em> matrix.
</p>
<p>The arguments <em>R</em> and <em>b</em> allows to introduce linear 
restrictions on the <em>beta</em> coefficients of the <em>G</em> equations. 
<code><a href="#topic+spsur3sls">spsur3sls</a></code>, first, introduces the linear restrictions in 
the SUR model and builds, internally, the corresponding constrained
SUR model. Then, the function estimates the restricted model which is 
shown in the output. The function does not compute the unconstrained 
model nor test for the linear restrictions. The user may ask for the 
unconstrained estimation using another <code><a href="#topic+spsurml">spsurml</a></code>
estimation. Moreover, the function <code><a href="#topic+wald_betas">wald_betas</a></code> obtains 
the Wald test of a set of linear restrictions for an object created 
previously by <code><a href="#topic+spsurml">spsurml</a></code> or <code><a href="#topic+spsur3sls">spsur3sls</a></code>.
</p>


<h3>Value</h3>

<p>Object of <code>spsur</code> class with the output of the  three-stages 
least-squares estimation of the specified spatial model.
A list with:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <code>call</code> </td><td style="text-align: left;"> Matched call. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>type</code> </td><td style="text-align: left;">  Type of model specified. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>Durbin</code> </td><td style="text-align: left;"> Value of <code>Durbin</code> argument. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>coefficients</code> </td><td style="text-align: left;"> Estimated coefficients for the regressors. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>deltas</code> </td><td style="text-align: left;"> Estimated spatial coefficients. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>rest.se</code> </td><td style="text-align: left;"> Estimated standard errors for the estimates of 
      <em><code class="reqn">\beta</code></em> coefficients. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>deltas.se</code> </td><td style="text-align: left;"> Estimated standard errors for the estimates of 
      the spatial coefficients. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>resvar</code> </td><td style="text-align: left;"> Estimated covariance matrix for the estimates of 
      <em>beta's</em> and spatial coefficients.</td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>R2</code> </td><td style="text-align: left;"> Coefficient of determination for each equation, 
      obtained as the squared of the correlation coefficient between the 
      corresponding explained variable and fitted values. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>R2 pooled</code> </td><td style="text-align: left;"> <em>Global</em> coefficient of determination 
      obtained for the set of the <em>G</em> equations. 
      It is computed in the same way than uniequational <code>R2</code> but 
      joining the dependent variable and fitted values in single vectors 
      instead of one vector for each equation. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>Sigma</code> </td><td style="text-align: left;"> Estimated covariance matrix for the residuals of the 
      <em>G</em> equations. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>residuals</code> </td><td style="text-align: left;"> Residuals of the model. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>df.residuals</code> </td><td style="text-align: left;"> Degrees of freedom for the residuals. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>fitted.values</code> </td><td style="text-align: left;"> Estimated values for the dependent variables. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>G</code> </td><td style="text-align: left;"> Number of equations. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>N</code> </td><td style="text-align: left;"> Number of cross-sections or spatial units. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>Tm</code> </td><td style="text-align: left;"> Number of time periods. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>p</code> </td><td style="text-align: left;"> Number of regressors by equation (including intercepts). </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>Y</code> </td><td style="text-align: left;"> If <em>data</em> is <em>NULL</em>, vector <em>Y</em> of the explained variables of the SUR model. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>X</code> </td><td style="text-align: left;"> If <em>data</em> is <em>NULL</em>, matrix <em>X</em> of the regressors of the SUR model. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>W</code> </td><td style="text-align: left;"> Spatial weighting matrix. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>zero.policy</code> </td><td style="text-align: left;"> Logical value of <code>zero.policy</code> . </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>listw_style</code> </td><td style="text-align: left;">	Style of neighborhood matrix <code>W</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
 </td>
</tr>

</table>



<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
  Fernando Lopez  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Jesus Mur  </td><td style="text-align: left;"> <a href="mailto:jmur@unizar.es">jmur@unizar.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Anselin, L. (2016) Estimation and Testing in the Spatial Seemingly 
Unrelated Regression (SUR). <em>Geoda Center for Geospatial Analysis 
and Computation, Arizona State University</em>. Working Paper 2016-01.
&lt;doi:10.13140/RG.2.2.15925.40163&gt;
</p>
</li>
<li><p>, Anselin, L. (1988). <em>Spatial Econometrics: Methods and Models</em>. 
Kluwer Academic Publishers, Dordrecht, The Netherlands (p. 146).
</p>
</li>
<li><p> Anselin, L., Le Gallo, J., Hubert J. (2008) Spatial Panel Econometrics. 
In <em>The econometrics of panel data. 
Fundamentals and recent developments in theory and practice</em>. (Chap 19, p. 653)
</p>
</li>
<li><p> Minguez, R., Lopez, F.A. and Mur, J.  (2022).
spsur: An R Package for Dealing with Spatial 
Seemingly Unrelated Regression Models. 
<em>Journal of Statistical Software</em>, 
104(11), 1&ndash;43.
&lt;doi:10.18637/jss.v104.i11&gt;
</p>
</li>
<li><p> Lopez, F. A., Minguez, R., Mur, J. (2020). ML versus IV estimates 
of spatial SUR models: evidence from the case of Airbnb in Madrid urban 
area. <em>The Annals of Regional Science</em>, 64(2), 313-347.
&lt;doi:10.1007/s00168-019-00914-1&gt;
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+spsurml">spsurml</a></code>, <code><a href="spatialreg.html#topic+stsls">stsls</a></code>, 
<code><a href="#topic+wald_betas">wald_betas</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#################################################
######## CLASSIC PANEL DATA (G=1; Tm&gt;1)  ########
#################################################

#### Example 1: Spatial Phillips-Curve. Anselin (1988, p. 203)
## A SUR model without spatial effects
rm(list = ls()) # Clean memory
data(spc)
lwspc &lt;- spdep::mat2listw(Wspc, style = "W")
Tformula &lt;- WAGE83 | WAGE81 ~ UN83 + NMR83 + SMSA | UN80 + NMR80 + SMSA

## A SUR-SLM model (3SLS Estimation)
spcsur_slm_3sls &lt;-spsur3sls(formula = Tformula, data = spc,
                            type = "slm", listw = lwspc)
summary(spcsur_slm_3sls)
print(spcsur_slm_3sls)

if (require(gridExtra)) {
  pl &lt;- plot(spcsur_slm_3sls, viewplot = FALSE) 
  grid.arrange(pl$lplbetas[[1]], pl$lplbetas[[2]], 
               pl$pldeltas, nrow = 3)
}

## VIP: The output of the whole set of the examples can be examined 
## by executing demo(demo_spsur3sls, package="spsur")


## A SUR-SDM model (3SLS Estimation)
spcsur_sdm_3sls &lt;- spsur3sls(formula = Tformula, data = spc,
                             type = "sdm", listw = lwspc)
summary(spcsur_sdm_3sls)
if (require(gridExtra)) {
  pl &lt;- plot(spcsur_sdm_3sls, viewplot = FALSE) 
  grid.arrange(pl$lplbetas[[1]], pl$lplbetas[[2]], 
               pl$pldeltas, nrow = 3)
}
rm(spcsur_sdm_3sls)

## A SUR-SDM model with different spatial lags in each equation
 TformulaD &lt;-  ~ UN83 + NMR83 + SMSA | UN80 + NMR80  
 spcsur_sdm2_3sls &lt;-spsur3sls(formula = Tformula, data = spc,
                             type = "sdm", listw = lwspc,
                             Durbin = TformulaD)
 summary(spcsur_sdm2_3sls)
if (require(gridExtra)) {
  pl &lt;- plot(spcsur_sdm2_3sls, viewplot = FALSE) 
  grid.arrange(pl$lplbetas[[1]], pl$lplbetas[[2]], 
               pl$pldeltas, nrow = 3)
}
rm(spcsur_sdm2_3sls)


#################################################
###  MULTI-DIMENSIONAL PANEL DATA (G&gt;1; Tm&gt;1) ###
#################################################

#### Example 3: Homicides + Socio-Economics (1960-90)
# Homicides and selected socio-economic characteristics for continental
# U.S. counties.
# Data for four decennial census years: 1960, 1970, 1980 and 1990.
# https://geodacenter.github.io/data-and-lab/ncovr/


rm(list = ls()) # Clean memory
data(NCOVR, package = "spsur")
nbncovr &lt;- spdep::poly2nb(NCOVR.sf, queen = TRUE)
## Some regions with no links...
lwncovr &lt;- spdep::nb2listw(nbncovr, style = "W", zero.policy = TRUE)
Tformula &lt;- HR80  | HR90 ~ PS80 + UE80 | PS90 + UE90
## A SUR-SLM model
NCOVRSUR_slm_3sls &lt;- spsur3sls(formula = Tformula, data = NCOVR.sf, 
                               type = "slm", zero.policy = TRUE,
                               listw = lwncovr, trace = FALSE)
summary(NCOVRSUR_slm_3sls)
if (require(gridExtra)) {
  pl &lt;- plot(NCOVRSUR_slm_3sls, viewplot = FALSE) 
  grid.arrange(pl$lplbetas[[1]], pl$lplbetas[[2]], 
               pl$pldeltas, nrow = 3)
}
rm(NCOVRSUR_slm_3sls)

</code></pre>

<hr>
<h2 id='spsurgs3sls'>General Spatial 3SLS for systems of spatial equations.</h2><span id='topic+spsurgs3sls'></span>

<h3>Description</h3>

<p>The function estimates spatial SUR models using 
general spatial three stages least squares. This is a 
system instrumental variable procedure which also include 
GMM estimation when there is spatial correlations in the errors.
The procedure allows for additional endogenous regressors in
addition to spatial lags of the dependent variable. It could 
be applied to &quot;slm&quot;, &quot;sdm&quot;, &quot;sem&quot; and &quot;sarar&quot; spatial models. 
Furthermore, for non-spatial models including endogenous 
regressors (&quot;iv&quot;), it could be used to estimate using 
instrumental variables and Feasible Generalized Least Squares.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spsurgs3sls(formula = NULL, data = NULL, na.action,
                  listw = NULL, zero.policy = NULL, 
                  type = "slm", Durbin = FALSE,
                  endog = NULL, instruments = NULL,
                  lag.instr = FALSE, initial.value = 0.2, 
                  het = FALSE, trace = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="spsurgs3sls_+3A_formula">formula</code></td>
<td>
<p>An object type <code><a href="Formula.html#topic+Formula">Formula</a></code> 
similar to objects created with the package <span class="pkg">Formula</span> 
describing the equations to be estimated in the model. 
This model may contain several responses (explained 
variables) and a varying number of regressors in each equation.</p>
</td></tr>
<tr><td><code id="spsurgs3sls_+3A_data">data</code></td>
<td>
<p>An object of class data.frame or a matrix.</p>
</td></tr>
<tr><td><code id="spsurgs3sls_+3A_na.action">na.action</code></td>
<td>
<p>A function (default <code>options("na.action")</code>),
can also be <code>na.omit</code> or <code>na.exclude</code> with consequences 
for residuals and fitted values. It may be necessary to set 
<code>zero.policy</code> to <code>TRUE</code> because this subsetting may 
create no-neighbour observations.</p>
</td></tr>
<tr><td><code id="spsurgs3sls_+3A_listw">listw</code></td>
<td>
<p>A <code>listw</code> object created for example by 
<code><a href="spdep.html#topic+nb2listw">nb2listw</a></code> from <span class="pkg">spatialreg</span> package; if 
<code><a href="spdep.html#topic+nb2listw">nb2listw</a></code> not given, set to 
the same spatial weights as the <code>listw</code> argument. It can
also be a spatial weighting matrix of order <em>(NxN)</em> instead of
a <code>listw</code> object. Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="spsurgs3sls_+3A_zero.policy">zero.policy</code></td>
<td>
<p>Similar to the corresponding parameter of 
<code><a href="spatialreg.html#topic+lagsarlm">lagsarlm</a></code> function in <span class="pkg">spatialreg</span> package. 
(NxN) instead of a listw object. Default = NULL.</p>
</td></tr>
<tr><td><code id="spsurgs3sls_+3A_type">type</code></td>
<td>
<p>Type of spatial model specification: &quot;sim&quot;, &quot;iv&quot;,
&quot;slm&quot;, &quot;sem&quot;, &quot;sdm&quot; or &quot;sarar&quot; . Default = &quot;slm&quot;.</p>
</td></tr>
<tr><td><code id="spsurgs3sls_+3A_durbin">Durbin</code></td>
<td>
<p>If a formula object and model is type &quot;sdm&quot;
the subset of explanatory variables to lag for each equation.</p>
</td></tr>
<tr><td><code id="spsurgs3sls_+3A_endog">endog</code></td>
<td>
<p>Additional endogenous variables. Default <em>NULL</em>. 
If not <em>NULL</em> should be specified as a 
<code><a href="Formula.html#topic+Formula">Formula</a></code> with no dependent variable. 
Examples: ~ x1 | x2 (x1 endogeous regressor for the first 
equation and x2 endogeneous regressor for the second equation) 
or ~ x1 | . (x1 endogenous regressor for the first equation and 
none endogenous regressors for the second equation)</p>
</td></tr>
<tr><td><code id="spsurgs3sls_+3A_instruments">instruments</code></td>
<td>
<p>external instruments. Default <em>NULL</em>. If not 
<em>NULL</em> should be specified as a formula with no 
dependent variable in the same way than 
previous <em>endog</em> argument.</p>
</td></tr>
<tr><td><code id="spsurgs3sls_+3A_lag.instr">lag.instr</code></td>
<td>
<p>should the external instruments be spatially lagged?</p>
</td></tr>
<tr><td><code id="spsurgs3sls_+3A_initial.value">initial.value</code></td>
<td>
<p>he initial value for rho. It can be either numeric
(default is 0.2) or set to 'SAR', in which case the optimization 
will start from the estimated coefficient of a regression of 
the 2SLS residuals over their spatial lag (i.e. a spatial 
AR model)</p>
</td></tr>
<tr><td><code id="spsurgs3sls_+3A_het">het</code></td>
<td>
<p>default FALSE: if TRUE uses the methods 
developed for heteroskedasticity for each equation. 
Wrapper using <code><a href="sphet.html#topic+spreg">spreg</a></code> function.</p>
</td></tr>
<tr><td><code id="spsurgs3sls_+3A_trace">trace</code></td>
<td>
<p>A logical value to show intermediate results during 
the estimation process. Default = <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><em>spsurg3sls</em> generalize the <code><a href="sphet.html#topic+spreg">spreg</a></code> function
to multiequational spatial SUR models. The methodology to estimate
spatial SUR models by Generalized 3SLS follows the steps outlined in
Kelejian and Piras (pp. 304-305). The summary of the algorithm is
the next one:
</p>
 
<ul>
<li><p> Estimate each equation by 2SLS and obtain the estimated 
residuals <code class="reqn">\hat{u}_j</code> for each equation. 
</p>
</li>
<li><p> If the model includes a spatial lag for the errors. 
(that is, it is a SEM/SARAR model), apply GMM to obtain 
the spatial parameters <code class="reqn">\hat{\lambda}_j</code> for the residuals
in each equation. In this case the <code><a href="sphet.html#topic+spreg">spreg</a></code> 
function is used as a wrapper for the GMM estimation. If the
model does not include a spatial lag for the errors (that is, 
it is a &quot;sim&quot;, &quot;iv&quot;, &quot;slm&quot; or &quot;sdm&quot; model), then <code class="reqn">\hat{\lambda}_j = 0</code>
</p>
</li>
<li><p> Compute 
</p>
<p style="text-align: center;"><code class="reqn">\hat{v}_j = \hat{u}_j-\hat{\lambda}_j W \hat{u}_j</code>
</p>
 
<p>and the covariances 
</p>
<p style="text-align: center;"><code class="reqn">\hat{\sigma}_{i,j} = N^{-1}\hat{v}_i\hat{v}_j</code>
</p>
<p>. 
Build <code class="reqn">\hat{Sigma}=\lbrace \hat{\sigma_{i,j}} \rbrace</code>
</p>
</li>
<li><p> Compute 
</p>
<p style="text-align: center;"><code class="reqn">y_j^* = y_j - \hat{\lambda}_j W y_j</code>
</p>

<p>and
</p>
<p style="text-align: center;"><code class="reqn">X_j^* = X_j- \hat{\lambda}_j W X_j</code>
</p>

<p>Compute 
</p>
<p style="text-align: center;"><code class="reqn"> \hat{X}_j^* = H_j(H_j^T H_j)^{-1} H_j^T X_j^*</code>
</p>
      
<p>where <code class="reqn">H_j</code> is the matrix including all the instruments and
the exogenous regressors for each equation. That is,
<code class="reqn">\hat{X}_j^*</code> 
is the projection of <code class="reqn">X_j^*</code> using
the instruments matrix <code class="reqn">H_j</code>. 
</p>
</li>
<li><p> Compute, in a multiequational way, 
the Feasible Generalized Least Squares estimation using the 
new variables <code class="reqn">\hat{y}_j^*</code>, <code class="reqn">\hat{X}_j^*</code> and 
<code class="reqn">\hat{Sigma}</code>. This is the 3sls step.
</p>
</li></ul>



<h3>Value</h3>

<p>Object of <code>spsur</code> class with the output of the  three-stages 
least-squares estimation of the specified spatial model.
A list with:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <code>call</code> </td><td style="text-align: left;"> Matched call. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>type</code> </td><td style="text-align: left;">  Type of model specified. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>Durbin</code> </td><td style="text-align: left;"> Value of <code>Durbin</code> argument. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>coefficients</code> </td><td style="text-align: left;"> Estimated coefficients for the regressors. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>deltas</code> </td><td style="text-align: left;"> Estimated spatial coefficients. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>rest.se</code> </td><td style="text-align: left;"> Estimated standard errors for the estimates of 
      <em><code class="reqn">\beta</code></em> coefficients. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>deltas.se</code> </td><td style="text-align: left;"> Estimated standard errors for the estimates of 
      the spatial coefficients. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>resvar</code> </td><td style="text-align: left;"> Estimated covariance matrix for the estimates of 
      <em>beta's</em> and spatial coefficients.</td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>R2</code> </td><td style="text-align: left;"> Coefficient of determination for each equation, 
      obtained as the squared of the correlation coefficient between 
      the corresponding explained variable and its estimates. 
      <em>spsur3sls</em> also shows a <em>global</em> coefficient of
       determination obtained, in the same manner, for the set of 
       <em>G</em> equations. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>Sigma</code> </td><td style="text-align: left;"> Estimated covariance matrix for the residuals of the 
      <em>G</em> equations. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>residuals</code> </td><td style="text-align: left;"> Residuals of the model. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>df.residuals</code> </td><td style="text-align: left;"> Degrees of freedom for the residuals. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>fitted.values</code> </td><td style="text-align: left;"> Estimated values for the dependent variables. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>G</code> </td><td style="text-align: left;"> Number of equations. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>N</code> </td><td style="text-align: left;"> Number of cross-sections or spatial units. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>Tm</code> </td><td style="text-align: left;"> Number of time periods. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>p</code> </td><td style="text-align: left;"> Number of regressors by equation (including intercepts). </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>Y</code> </td><td style="text-align: left;"> If <em>data</em> is <em>NULL</em>, vector <em>Y</em> of the explained variables of the SUR model. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>X</code> </td><td style="text-align: left;"> If <em>data</em> is <em>NULL</em>, matrix <em>X</em> of the regressors of the SUR model. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>W</code> </td><td style="text-align: left;"> Spatial weighting matrix. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>zero.policy</code> </td><td style="text-align: left;"> Logical value of <code>zero.policy</code> . </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>listw_style</code> </td><td style="text-align: left;">	Style of neighborhood matrix <code>W</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
 </td>
</tr>

</table>



<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
  Fernando López  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Román Mínguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Jesús Mur  </td><td style="text-align: left;"> <a href="mailto:jmur@unizar.es">jmur@unizar.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Kelejian, H. H. and Piras, G. (2017). 
<em> Spatial Econometrics</em>. Academic Press.
</p>
</li>
<li><p> Kelejian, H.H. and Prucha, I.R. (2010).
Specification and Estimation of Spatial 
Autoregressive Models with Autoregressive 
and Heteroskedastic Disturbances. 
<em>Journal of Econometrics</em>, 157, 
pp. 53-67.
</p>
</li>
<li><p> Kelejian, H.H. and Prucha, I.R. (1999). 
A Generalized Moments Estimator for the 
Autoregressive Parameter in a Spatial 
Model. <em>International Economic Review</em>,
40, pp. 509-533.
</p>
</li>
<li><p> Kelejian, H.H. and Prucha, I.R. (1998).
A Generalized Spatial Two Stage Least 
Square Procedure for Estimating a Spatial 
Autoregressive Model with Autoregressive 
Disturbances. <em>Journal of Real 
Estate Finance and Economics</em>, 17, 
pp. 99–121.
</p>
</li>
<li><p> Minguez, R., Lopez, F.A. and Mur, J.  (2022).
spsur: An R Package for Dealing with Spatial 
Seemingly Unrelated Regression Models. 
<em>Journal of Statistical Software</em>, 
104(11), 1&ndash;43.
&lt;doi:10.18637/jss.v104.i11&gt;
</p>
</li>
<li><p> Piras, G. (2010). sphet: Spatial
Models with Heteroskedastic Innovations 
in R. <em>Journal of Statistical 
Software</em>, 35(1), pp. 1-21. 
<a href="https://www.jstatsoft.org/v35/i01/">https://www.jstatsoft.org/v35/i01/</a>. -          
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="sphet.html#topic+spreg">spreg</a></code>,
<code><a href="#topic+spsur3sls">spsur3sls</a></code>,
<code><a href="spatialreg.html#topic+stsls">stsls</a></code>,
<code><a href="#topic+spsurml">spsurml</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#### Example 1: Spatial Phillips-Curve. Anselin (1988, p. 203)
rm(list = ls()) # Clean memory
data(spc)
lwspc &lt;- spdep::mat2listw(Wspc, style = "W")
## No endogenous regressors  
Tformula &lt;- WAGE83 | WAGE81 ~ UN83 + NMR83 + SMSA | UN80 + NMR80 + SMSA
## Endogenous regressors and Instruments
Tformula2 &lt;- WAGE83 | WAGE81 ~  NMR83 | NMR80 
## Endogenous regressors: UN83 , UN80
## Instrumental variable: SMSA

## A IV model with endogenous regressors only in first equation
spciv &lt;- spsurgs3sls(formula = Tformula2, data = spc,
                      type = "iv", listw = lwspc,
                      endog = ~ UN83 | ., 
                      instruments = ~ SMSA | .)
summary(spciv)
print(spciv)
#########################################################################
## A SLM model with endogenous regressors 
spcslm &lt;- spsurgs3sls(formula = Tformula2, data = spc,
                              endog = ~ UN83 | ., 
                              instruments = ~ SMSA |.,
                              type = "slm", 
                              listw = lwspc)
summary(spcslm)
print(spcslm)                           
impacts_spcslm &lt;- impactspsur(spcslm, listw = lwspc, R = 1000)
summary(impacts_spcslm[[1]], zstats = TRUE, short = TRUE)
summary(impacts_spcslm[[2]], zstats = TRUE, short = TRUE)
#########################################################################
## A SDM model with endogenous regressors 
spcsdm &lt;- spsurgs3sls(formula = Tformula2, data = spc,
                   endog = ~ UN83 | UN80, 
                   instruments = ~ SMSA | SMSA,
                   type = "sdm", listw = lwspc,
                   Durbin =  ~  NMR83 | NMR80)
summary(spcsdm)
## Durbin only in one equation
spcsdm2 &lt;- spsurgs3sls(formula = Tformula2, data = spc,
                    endog = ~ UN83 | UN80, 
                    instruments = ~ SMSA | SMSA,
                    type = "sdm", listw = lwspc,
                    Durbin =  ~  NMR83 | .)
summary(spcsdm2)
#########################################################################
## A SEM model with endogenous regressors 
spcsem &lt;- spsurgs3sls(formula = Tformula2, data = spc,
                      endog = ~ UN83 | UN80, 
                      instruments = ~ SMSA | SMSA,
                      type = "sem", listw = lwspc)
summary(spcsem)
print(spcsem)                           
#########################################################################
## A SARAR model with endogenous regressors 
spcsarar &lt;- spsurgs3sls(formula = Tformula2, data = spc,
                        endog = ~ UN83 | UN80, 
                        instruments = ~ SMSA | SMSA,
                        type = "sarar", listw = lwspc)
summary(spcsarar)
print(spcsarar)                           
impacts_spcsarar &lt;- impactspsur(spcsarar, listw = lwspc, R = 1000)
summary(impacts_spcsarar[[1]], zstats = TRUE, short = TRUE)
summary(impacts_spcsarar[[2]], zstats = TRUE, short = TRUE)
</code></pre>

<hr>
<h2 id='spsurml'>Maximum likelihood estimation of spatial SUR model.</h2><span id='topic+spsurml'></span>

<h3>Description</h3>

<p>This function estimates spatial SUR models using 
maximum-likelihood methods.The number of equations, time periods 
and cross-sectional units is not restricted.The user can choose 
between different spatial specifications as described below.
The estimation procedure allows for the introduction of linear 
restrictions on the <code class="reqn">\beta</code> parameters associated to the 
regressors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spsurml(formula = NULL, data = NULL, na.action,
               listw = NULL, type = "sim", Durbin = NULL,
               method = "eigen", zero.policy = NULL, interval = NULL,
               trs = NULL, R = NULL, b = NULL, X = NULL, Y = NULL, 
               G = NULL, N = NULL, Tm = NULL,p = NULL, 
               control = list() )
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="spsurml_+3A_formula">formula</code></td>
<td>
<p>An object type <code><a href="Formula.html#topic+Formula">Formula</a></code> 
similar to objects created with the package <span class="pkg">Formula</span> 
describing the equations to be estimated in the model. 
This model may contain several responses (explained 
variables) and a varying number of regressors in each equation.</p>
</td></tr>
<tr><td><code id="spsurml_+3A_data">data</code></td>
<td>
<p>An object of class data.frame or a matrix.</p>
</td></tr>
<tr><td><code id="spsurml_+3A_na.action">na.action</code></td>
<td>
<p>A function (default <code>options("na.action")</code>),
can also be <code>na.omit</code> or <code>na.exclude</code> with consequences 
for residuals and fitted values. It may be necessary to set 
<code>zero.policy</code> to <code>TRUE</code> because this subsetting may 
create no-neighbour observations.</p>
</td></tr>
<tr><td><code id="spsurml_+3A_listw">listw</code></td>
<td>
<p>A <code>listw</code> object created for example by 
<code><a href="spdep.html#topic+nb2listw">nb2listw</a></code> from <span class="pkg">spatialreg</span> package; if 
<code><a href="spdep.html#topic+nb2listw">nb2listw</a></code> not given, set to 
the same spatial weights as the <code>listw</code> argument. It can
also be a spatial weighting matrix of order <em>(NxN)</em> instead of
a <code>listw</code> object. Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="spsurml_+3A_type">type</code></td>
<td>
<p>Type of spatial model specification: &quot;sim&quot;,
&quot;slx&quot;, &quot;slm&quot;, &quot;sem&quot;, &quot;sdm&quot;, 
&quot;sdem&quot;, &quot;sarar&quot; or &quot;gnm&quot;. Default = &quot;sim&quot;.</p>
</td></tr>
<tr><td><code id="spsurml_+3A_durbin">Durbin</code></td>
<td>
<p>If a formula object and model is type &quot;sdm&quot;, &quot;sdem&quot; 
or &quot;slx&quot; the subset of explanatory variables to lag for each equation.</p>
</td></tr>
<tr><td><code id="spsurml_+3A_method">method</code></td>
<td>
<p>Similar to the corresponding parameter of 
<code><a href="spatialreg.html#topic+lagsarlm">lagsarlm</a></code> function in <span class="pkg">spatialreg</span> package. 
&quot;eigen&quot; (default) - the Jacobian is computed as the product of 
(1 - rho*eigenvalue) using <code><a href="spatialreg.html#topic+eigenw">eigenw</a></code>, and 
&quot;spam&quot; or &quot;Matrix_J&quot; for strictly symmetric weights lists of 
styles &quot;B&quot; and &quot;C&quot;, or made symmetric by similarity 
(Ord, 1975, Appendix C) if possible for styles &quot;W&quot; and &quot;S&quot;, 
using code from the spam or Matrix packages to calculate the 
determinant; &quot;Matrix&quot; and &quot;spam_update&quot; provide updating Cholesky 
decomposition methods; &quot;LU&quot; provides an alternative sparse matrix 
decomposition approach. In addition, there are &quot;Chebyshev&quot; and 
Monte Carlo &quot;MC&quot; approximate log-determinant methods; 
the Smirnov/Anselin (2009) trace approximation is available 
as &quot;moments&quot;. Three methods: &quot;SE_classic&quot;, &quot;SE_whichMin&quot;, 
and &quot;SE_interp&quot; are provided experimentally, the first to 
attempt to emulate the behaviour of Spatial Econometrics 
toolbox ML fitting functions. All use grids of log determinant 
values, and the latter two attempt to ameliorate some features 
of &quot;SE_classic&quot;.</p>
</td></tr>
<tr><td><code id="spsurml_+3A_zero.policy">zero.policy</code></td>
<td>
<p>Similar to the corresponding parameter of 
<code><a href="spatialreg.html#topic+lagsarlm">lagsarlm</a></code> function in <span class="pkg">spatialreg</span> package. 
If <code>TRUE</code> assign zero to the lagged value of zones without 
neighbours, if <code>FALSE</code> assign <code>NA</code> - causing 
<code>spsurml()</code> to terminate with an error. Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="spsurml_+3A_interval">interval</code></td>
<td>
<p>Search interval for autoregressive parameter.
Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="spsurml_+3A_trs">trs</code></td>
<td>
<p>Similar to the corresponding parameter of 
<code><a href="spatialreg.html#topic+lagsarlm">lagsarlm</a></code> function in <span class="pkg">spatialreg</span> package.
Default <code>NULL</code>, if given, a vector of powered spatial weights 
matrix traces output by <code><a href="spdep.html#topic+trW">trW</a></code>.</p>
</td></tr>
<tr><td><code id="spsurml_+3A_r">R</code></td>
<td>
<p>A row vector of order <em>(1xpr)</em> with  the set of 
<em>r</em> linear constraints on the <em>beta</em> parameters. The 
<em>first</em> restriction appears in the first <em>p</em> terms,
the second restriction in the next <em>p</em> terms and so on. 
Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="spsurml_+3A_b">b</code></td>
<td>
<p>A column vector of order <em>(rx1)</em> with the values of 
the linear restrictions on the <em>beta</em> parameters. 
Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="spsurml_+3A_x">X</code></td>
<td>
<p>A data matrix of order <em>(NTmGxp)</em> with the observations
of the regressors. The number of covariates in the SUR model is 
<em>p</em> = <code class="reqn">sum(p_{g})</code> where <em><code class="reqn">p_{g}</code></em> is the number 
of regressors (including the intercept) in the g-th equation, 
<em>g = 1,...,G</em>). The specification of &quot;X&quot; is only 
necessary if not available a <code><a href="Formula.html#topic+Formula">Formula</a></code> and a 
data frame. Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="spsurml_+3A_y">Y</code></td>
<td>
<p>A column vector of order <em>(NTmGx1)</em>, with the 
observations of the explained variables. The ordering of the data 
must be (first) equation, (second) time dimension and (third) 
cross-sectional/spatial units. The specification of <em>Y</em> is 
only necessary if not available a <code><a href="Formula.html#topic+Formula">Formula</a></code>
and a data frame. Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="spsurml_+3A_g">G</code></td>
<td>
<p>Number of equations.</p>
</td></tr>
<tr><td><code id="spsurml_+3A_n">N</code></td>
<td>
<p>Number of cross-section or spatial units</p>
</td></tr>
<tr><td><code id="spsurml_+3A_tm">Tm</code></td>
<td>
<p>Number of time periods.</p>
</td></tr>
<tr><td><code id="spsurml_+3A_p">p</code></td>
<td>
<p>Number of regressors by equation, including the intercept. 
<em>p</em> can be a row vector of order <em>(1xG)</em>, if the number 
of regressors is not the same for all the equations, or a scalar, 
if the <em>G</em> equations have the same number of regressors. The 
specification of <em>p</em> is only necessary if not available a 
<code><a href="Formula.html#topic+Formula">Formula</a></code> and a data frame.</p>
</td></tr>
<tr><td><code id="spsurml_+3A_control">control</code></td>
<td>
<p>list of additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The list of (spatial) models that can be estimated with the <em>spsurml</em> function are:
</p>

<ul>
<li><p> &quot;sim&quot;: SUR model with no spatial effects
</p>
<p style="text-align: center;"><code class="reqn"> y_{tg} = X_{tg} \beta_{g} + \epsilon_{tg} </code>
</p>

</li>
<li><p> &quot;slx&quot;: SUR model with spatial lags of the regressors
</p>
<p style="text-align: center;"><code class="reqn"> y_{tg} = X_{tg} \beta_{g} + WX_{tg} \theta_{g} + \epsilon_{tg} </code>
</p>

</li>
<li><p> &quot;slm&quot;: SUR model with spatial lags of the explained variables
</p>
<p style="text-align: center;"><code class="reqn">y_{tg} = \rho_{g} Wy_{tg} + X_{tg} \beta_{g} + \epsilon_{tg} </code>
</p>

</li>
<li><p> &quot;sem&quot;: SUR model with spatial errors
</p>
<p style="text-align: center;"><code class="reqn"> y_{tg} = X_{tg} \beta_{g} + u_{tg} </code>
</p>

<p style="text-align: center;"><code class="reqn"> u_{tg} = \lambda_{g} Wu_{tg} + \epsilon_{tg} </code>
</p>

</li>
<li><p> &quot;sdm&quot;: SUR model of the Spatial Durbin type
</p>
<p style="text-align: center;"><code class="reqn"> y_{tg} = \rho_{g} Wy_{tg} + X_{tt} \beta_{g} + WX_{tg} \theta_{g} + \epsilon_{tg} </code>
</p>

</li>
<li><p> &quot;sdem&quot;: SUR model with spatial lags of the regressors and spatial errors
</p>
<p style="text-align: center;"><code class="reqn"> y_{tg} = X_{tg} \beta_{g} + WX_{tg} \theta_{g} + u_{tg} </code>
</p>

<p style="text-align: center;"><code class="reqn"> u_{tg} = \lambda_{g} W u_{tg} + \epsilon_{tg} </code>
</p>

</li>
<li><p> &quot;sarar&quot;: SUR model with spatial lags of the explained variables and spatial
errors
</p>
<p style="text-align: center;"><code class="reqn"> y_{tg} = \rho_{g} Wy_{tg} + X_{tg} \beta_{g} + u_{tg} </code>
</p>

<p style="text-align: center;"><code class="reqn"> u_{tg} = \lambda_{g} W u_{tg} + \epsilon_{tg} </code>
</p>

</li>
<li><p> &quot;gnm&quot;: SUR model with spatial lags of the explained variables, 
regressors and spatial errors
</p>
<p style="text-align: center;"><code class="reqn"> y_{tg} = \rho_{g} Wy_{tg} + X_{tg} \beta_{g} + 
                        WX_{tg} \theta_{g} + u_{tg} </code>
</p>

<p style="text-align: center;"><code class="reqn"> u_{tg} = \lambda_{g} W u_{tg} + \epsilon_{tg} </code>
</p>

</li></ul>



<h3>Value</h3>

<p>Object of <code>spsur</code> class with the output of the  
maximum-likelihood estimation of the specified spatial SUR model. 
A list with:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <code>call</code> </td><td style="text-align: left;"> Matched call. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>type</code> </td><td style="text-align: left;">  Type of model specified. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>method</code> </td><td style="text-align: left;"> Value of <code>method</code> argument to compute the 
      Jacobian </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>Durbin</code> </td><td style="text-align: left;"> Value of <code>Durbin</code> argument. </td>
</tr>
<tr>
 <td style="text-align: left;">     
    <code>coefficients</code> </td><td style="text-align: left;"> Estimated coefficients for the regressors. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>deltas</code> </td><td style="text-align: left;"> Estimated spatial coefficients. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>rest.se</code> </td><td style="text-align: left;"> Estimated standard errors for the 
      estimates of <em>beta</em>. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>deltas.se</code> </td><td style="text-align: left;"> Estimated standard errors for the estimates of 
      the spatial coefficients (<code>deltas</code>). </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>resvar</code> </td><td style="text-align: left;"> Estimated covariance matrix for the estimates of 
      <em>beta's</em> and spatial coefficients (<code>deltas</code>).</td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>LL</code> </td><td style="text-align: left;"> Value of the likelihood function at the 
      maximum-likelihood estimates. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>R2</code> </td><td style="text-align: left;"> Coefficient of determination for each equation, 
      obtained as the squared of the correlation coefficient between the 
      corresponding explained variable and fitted values. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>R2 pooled</code> </td><td style="text-align: left;"> <em>Global</em> coefficient of determination 
      obtained for the set of the <em>G</em> equations. 
      It is computed in the same way than uniequational <code>R2</code> but 
      joining the dependent variable and fitted values in single vectors 
      instead of one vector for each equation. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>Sigma</code> </td><td style="text-align: left;"> Estimated covariance matrix for the residuals of 
      the <em>G</em> equations. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>fdHess</code> </td><td style="text-align: left;"> Logical value of <code>fdHess</code> argument when 
      computing numerical covariances.  </td>
</tr>
<tr>
 <td style="text-align: left;">  
    <code>residuals</code> </td><td style="text-align: left;"> Residuals of the model. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>df.residuals</code> </td><td style="text-align: left;"> Degrees of freedom for the residuals. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>fitted.values</code> </td><td style="text-align: left;"> Estimated values for the dependent 
      variables. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>BP</code> </td><td style="text-align: left;"> Value of the Breusch-Pagan statistic to test the 
      null hypothesis of diagonality among the errors of the <em>G</em> 
      equations. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>LMM</code> </td><td style="text-align: left;"> Marginal Lagrange Multipliers, 
      LM(<code class="reqn">\rho</code>|<code class="reqn">\lambda</code>) and
      LM(<code class="reqn">\lambda</code>|<code class="reqn">\rho</code>), to test for omitted spatial effects 
      in the specification. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>G</code> </td><td style="text-align: left;"> Number of equations. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>N</code> </td><td style="text-align: left;"> Number of cross-sections or spatial units. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>Tm</code> </td><td style="text-align: left;"> Number of time periods. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>p</code> </td><td style="text-align: left;"> Number of regressors by equation (including intercepts). </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>Y</code> </td><td style="text-align: left;"> If <em>data</em> is <em>NULL</em>, vector <em>Y</em> of the explained variables of the 
      SUR model. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>X</code> </td><td style="text-align: left;"> If <em>data</em> is <em>NULL</em>, matrix <em>X</em> of the regressors of the SUR model. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>W</code> </td><td style="text-align: left;"> Spatial weighting matrix. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>zero.policy</code> </td><td style="text-align: left;"> Logical value of <code>zero.policy</code> . </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>interval</code> </td><td style="text-align: left;">	Search interval for spatial parameter. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>listw_style</code> </td><td style="text-align: left;">	Style of neighborhood matrix <code>W</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>trs</code> </td><td style="text-align: left;"> Either <code>NULL</code> or vector of powered spatial weights 
      matrix traces output by <code>trW</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>insert</code> </td><td style="text-align: left;"> Logical value to check if <code>is.null(trs)</code>. </td>
</tr>
<tr>
 <td style="text-align: left;"> 
 </td>
</tr>

</table>



<h3>Control arguments</h3>


<table>
<tr>
 <td style="text-align: left;">
    <code>tol</code> </td><td style="text-align: left;"> Numerical value for the tolerance for the estimation 
      algorithm until convergence. Default = 1e-3. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>maxit</code> </td><td style="text-align: left;"> Maximum number of iterations until convergence; 
      it must be an integer value. Default = 200. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>trace</code> </td><td style="text-align: left;"> A logical value to show intermediate results during 
      the estimation process. Default = <code>TRUE</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>fdHess</code> </td><td style="text-align: left;"> Compute variance-covariance matrix using the numerical 
      hessian. Suited for large samples. Default = <code>FALSE</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>Imult</code> </td><td style="text-align: left;"> default 2; used for preparing the Cholesky 
      decompositions for updating in the Jacobian function </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>super</code> </td><td style="text-align: left;">  if <code>NULL</code> (default), set to <code>FALSE</code> to use 
      a simplicial decomposition for the sparse Cholesky decomposition and 
      method "Matrix_J", set to as.logical(NA) for method "Matrix", if 
      <code>TRUE</code>, use a supernodal decomposition </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>cheb_q</code> </td><td style="text-align: left;"> default 5; highest power of the approximating 
      polynomial for the Chebyshev approximation </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>MC_p</code> </td><td style="text-align: left;"> default 16; number of random variates </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>MC_m</code> </td><td style="text-align: left;"> default 30; number of products of random variates 
      matrix and spatial weights matrix </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>spamPivot</code> </td><td style="text-align: left;">  default "MMD", alternative "RCM" </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>in_coef</code> </td><td style="text-align: left;"> default 0.1, coefficient value for initial Cholesky 
      decomposition in "spam_update" </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>type</code> </td><td style="text-align: left;"> default "MC", used with method "moments"; alternatives 
      "mult" and "moments", for use if trs is missing </td>
</tr>
<tr>
 <td style="text-align: left;"> 
    <code>correct</code> </td><td style="text-align: left;"> default <code>TRUE</code>, used with method "moments" to 
      compute the Smirnov/Anselin correction term </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>trunc</code> </td><td style="text-align: left;"> default <code>TRUE</code>, used with method "moments" to 
      truncate the Smirnov/Anselin correction term </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>SE_method</code> </td><td style="text-align: left;"> default "LU", may be "MC" </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>nrho</code> </td><td style="text-align: left;"> default 200, as in SE toolbox; the size of the first 
      stage lndet grid; it may be reduced to for example 40 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>interpn</code> </td><td style="text-align: left;"> default 2000, as in SE toolbox; the size of the 
      second stage lndet grid </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>SElndet</code> </td><td style="text-align: left;"> default <code>NULL</code>, may be used to pass a 
      pre-computed SE toolbox style matrix of coefficients and their lndet 
      values to the "SE_classic" and "SE_whichMin" methods </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>LU_order</code> </td><td style="text-align: left;"> default <code>FALSE</code>; used in "LU_prepermutate", 
      note warnings given for lu method </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>pre_eig</code> </td><td style="text-align: left;"> default <code>NULL</code>; may be used to pass a 
      pre-computed vector of eigenvalues </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
  Fernando Lopez  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Jesus Mur  </td><td style="text-align: left;"> <a href="mailto:jmur@unizar.es">jmur@unizar.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>References</h3>

   
<ul>
<li><p> Anselin, L. (1988). <em>Spatial econometrics: methods and models.</em> 
Dordrecht: Kluwer
</p>
</li>
<li><p> Bivand, R.S. and  Piras G. (2015). Comparing Implementations of 
Estimation Methods for Spatial Econometrics. <em>Journal of 
Statistical Software</em>, 63(18), 1-36. 
&lt;doi:	10.18637/jss.v063.i18&gt;
</p>
</li>
<li><p> Bivand, R. S., Hauke, J., and Kossowski, T. (2013). 
Computing the Jacobian in Gaussian spatial autoregressive models: An 
illustrated comparison of available methods. <em> Geographical 
Analysis</em>, 45(2), 150-179. &lt;doi:10.1111/gean.12008&gt;
</p>
</li>
<li><p> Breusch T., Pagan A. (1980). The Lagrange multiplier test and its
applications to model specification in econometrics. 
<em>Rev Econ Stud</em> 47: 239-254
</p>
</li>
<li><p> Cliff, A.D. and Ord, J.K. (1981). <em>Spatial processes: Models 
and applications</em>, Pion. 
</p>
</li>
<li><p> LeSage J and Pace, R.K. (2009). <em>Introduction to Spatial 
Econometrics.</em> CRC Press, Boca Raton.
</p>
</li>
<li><p> Lopez, F.A., Mur, J., and Angulo, A. (2014). Spatial model
selection strategies in a SUR framework. The case of regional
productivity in EU. <em>Annals of Regional Science</em>, 53(1), 197-220.
&lt;doi:10.1007/s00168-014-0624-2&gt;
</p>
</li>
<li><p> Minguez, R., Lopez, F.A. and Mur, J.  (2022).
spsur: An R Package for Dealing with Spatial 
Seemingly Unrelated Regression Models. 
<em>Journal of Statistical Software</em>, 
104(11), 1&ndash;43.
&lt;doi:10.18637/jss.v104.i11&gt;
</p>
</li>
<li><p> Mur, J., Lopez, F., and Herrera, M. (2010). Testing for spatial
effects in seemingly unrelated regressions.
<em>Spatial Economic Analysis</em>, 5(4), 399-440.
&lt;doi:10.1080/17421772.2010.516443&gt;
</p>
</li>
<li><p> Ord, J.K. (1975). Estimation methods for models of spatial 
interaction, <em>Journal of the American Statistical Association</em>, 
70, 120-126. 
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+spsur3sls">spsur3sls</a></code>, <code><a href="spatialreg.html#topic+lagsarlm">lagsarlm</a></code>, 
<code><a href="#topic+lmtestspsur">lmtestspsur</a></code>, <code><a href="#topic+wald_betas">wald_betas</a></code>, 
<code><a href="#topic+lr_betas">lr_betas</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#################################################
######## CROSS SECTION DATA (G&gt;1; Tm=1) ########
#################################################

#### Example 1: Spatial Phillips-Curve. Anselin (1988, p. 203)
rm(list = ls()) # Clean memory
data(spc)
Tformula &lt;- WAGE83 | WAGE81 ~ UN83 + NMR83 + SMSA | UN80 + NMR80 + SMSA
spcsur.sim &lt;- spsurml(formula = Tformula, data = spc, type = "sim")
summary(spcsur.sim)
# All the coefficients in a single table.
print(spcsur.sim)
# Plot of the coefficients of each equation in different graphs
plot(spcsur.sim) 

## A SUR-SLX model 
## (listw argument can be either a matrix or a listw object )
spcsur.slx &lt;- spsurml(formula = Tformula, data = spc, type = "slx", 
  listw = Wspc, Durbin = TRUE)
summary(spcsur.slx)
# All the coefficients in a single table.
print(spcsur.slx)
# Plot of the coefficients in a single graph
if (require(gridExtra)) {
  pl &lt;- plot(spcsur.slx, viewplot = FALSE)
  grid.arrange(pl$lplbetas[[1]], pl$lplbetas[[2]], 
                        nrow = 2)
} 

## VIP: The output of the whole set of the examples can be examined 
## by executing demo(demo_spsurml, package="spsur")
  

### A SUR-SLM model
spcsur.slm &lt;- spsurml(formula = Tformula, data = spc, type = "slm", 
                     listw = Wspc)
summary(spcsur.slm)
if (require(gridExtra)) {
  pl &lt;- plot(spcsur.slm, viewplot = FALSE) 
  grid.arrange(pl$lplbetas[[1]], pl$lplbetas[[2]], 
               pl$pldeltas, nrow = 3)
}


### A SUR-SDM model
spcsur.sdm &lt;- spsurml(formula = Tformula, data = spc, type = "sdm", 
                     listw = Wspc)
summary(spcsur.sdm)
print(spcsur.sdm)
if (require(gridExtra)) {
  pl &lt;- plot(spcsur.sdm, viewplot = FALSE) 
  grid.arrange(pl$lplbetas[[1]], pl$lplbetas[[2]], 
               pl$pldeltas, nrow = 3)
}

## A SUR-SDM model with different spatial lags in each equation
TformulaD &lt;- ~ UN83 + NMR83 + SMSA | UN80
spcsur.sdm2 &lt;- spsurml(formula = Tformula, data = spc, type = "sdm", 
                      listw = Wspc, Durbin = TformulaD)
summary(spcsur.sdm2)
if (require(gridExtra)) {
  pl &lt;- plot(spcsur.sdm2, viewplot = FALSE) 
  grid.arrange(pl$lplbetas[[1]], pl$lplbetas[[2]], 
               pl$pldeltas, nrow = 3)
}


##################################################
#########  CLASSIC PANEL DATA G=1; Tm&gt;1   ########
##################################################
#
##### Example 2: Homicides + Socio-Economics (1960-90)
## Homicides and selected socio-economic characteristics for continental
## U.S. counties.
## Data for four decennial census years: 1960, 1970, 1980 and 1990.
## \url{https://geodacenter.github.io/data-and-lab/ncovr/}


### It usually requires 1-2 minutes maximum...
rm(list = ls()) # Clean memory
### Read NCOVR.sf object
data(NCOVR, package = "spsur")
nbncovr &lt;- spdep::poly2nb(NCOVR.sf, queen = TRUE)
### Some regions with no links...
lwncovr &lt;- spdep::nb2listw(nbncovr, style = "W", zero.policy = TRUE)
Tformula &lt;- HR80  | HR90 ~ PS80 + UE80 | PS90 + UE90
### A SUR-SIM model
NCOVRSUR.sim &lt;- spsurml(formula = Tformula, data = NCOVR.sf, type = "sim")
summary(NCOVRSUR.sim)
if (require(gridExtra)) {
  pl &lt;- plot(NCOVRSUR.sim, viewplot = FALSE) 
  grid.arrange(pl$lplbetas[[1]], pl$lplbetas[[2]], nrow = 3)
}
### A SUR-SLX model
NCOVRSUR.slx &lt;- spsurml(formula = Tformula, data = NCOVR.sf, type = "slx", 
                       listw = lwncovr, zero.policy = TRUE)
print(NCOVRSUR.slx)
if (require(gridExtra)) {
  pl &lt;- plot(NCOVRSUR.slx, viewplot = FALSE) 
  grid.arrange(pl$lplbetas[[1]], pl$lplbetas[[2]], nrow = 2)
}

### A SUR-SLM model
### method = "Matrix" (Cholesky) instead of "eigen"
### (fdHess = TRUE to compute numerical covariances )
NCOVRSUR.slm &lt;- spsurml(formula = Tformula, data = NCOVR.sf, 
                       type = "slm", listw = lwncovr, method = "Matrix", 
                       zero.policy = TRUE, control = list(fdHess = TRUE))
summary(NCOVRSUR.slm)

if (require(gridExtra)) {
  pl &lt;- plot(NCOVRSUR.slm, viewplot = FALSE) 
  grid.arrange(pl$lplbetas[[1]], pl$lplbetas[[2]], 
               pl$pldeltas, nrow = 3)
}
# LR test for nested models
anova(NCOVRSUR.sim, NCOVRSUR.slm)

</code></pre>

<hr>
<h2 id='spsurtime'>Estimation of SUR models for simple spatial panels (G=1).</h2><span id='topic+spsurtime'></span>

<h3>Description</h3>

<p>This function estimates SUR models for simple spatial 
panel datasets.
<code><a href="#topic+spsurtime">spsurtime</a></code> is restricted, specifically, to cases where 
there is only one equation, <em>G=1</em>, and a varying number of spatial 
units, <em>N</em>, and time periods, <em>Tm</em>. The SUR structure appears
in form of serial dependence among the error terms corresponding to the 
same spatial unit.
Note that it is assumed that all spatial units share a common pattern 
of serial dependence.
</p>
<p>The user can choose between different types of spatial specifications, 
as described below, and the estimation algorithms allow for the 
introduction of linear restrictions on the <code class="reqn">\beta</code> parameters
associated to the regressors. The spatial panels with SUR structure 
can be estimated by maximum-likelihood methods or three-stages least 
squares procedures, using spatial instrumental variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spsurtime (formula, data, time, na.action,
                  listw = NULL, type = "sim", Durbin = NULL, 
                  method = "eigen", fit_method = "ml", maxlagW = NULL,
                  zero.policy = NULL, interval = NULL, trs = NULL,
                  R = NULL, b = NULL, demean = FALSE, control = list() )
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="spsurtime_+3A_formula">formula</code></td>
<td>
<p>An object type <code><a href="Formula.html#topic+Formula">Formula</a></code> 
similar to objects created with the package <span class="pkg">Formula</span> 
describing the equations to be estimated in the model. 
This model may contain several responses (explained 
variables) and a varying number of regressors in each equation.</p>
</td></tr>
<tr><td><code id="spsurtime_+3A_data">data</code></td>
<td>
<p>An object of class data.frame or a matrix.</p>
</td></tr>
<tr><td><code id="spsurtime_+3A_time">time</code></td>
<td>
<p>Time variable.</p>
</td></tr>
<tr><td><code id="spsurtime_+3A_na.action">na.action</code></td>
<td>
<p>A function (default <code>options("na.action")</code>),
can also be <code>na.omit</code> or <code>na.exclude</code> with consequences 
for residuals and fitted values. It may be necessary to set 
<code>zero.policy</code> to <code>TRUE</code> because this subsetting may 
create no-neighbour observations.</p>
</td></tr>
<tr><td><code id="spsurtime_+3A_listw">listw</code></td>
<td>
<p>A <code>listw</code> object created for example by 
<code><a href="spdep.html#topic+nb2listw">nb2listw</a></code> from <span class="pkg">spatialreg</span> package; if 
<code><a href="spdep.html#topic+nb2listw">nb2listw</a></code> not given, set to 
the same spatial weights as the <code>listw</code> argument. It can
also be a spatial weighting matrix of order <em>(NxN)</em> instead of
a <code>listw</code> object. Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="spsurtime_+3A_type">type</code></td>
<td>
<p>Type of spatial model specification: &quot;sim&quot;,
&quot;slx&quot;, &quot;slm&quot;, &quot;sem&quot;, &quot;sdm&quot;, 
&quot;sdem&quot;, &quot;sarar&quot; or &quot;gnm&quot;. Default = &quot;sim&quot;.</p>
</td></tr>
<tr><td><code id="spsurtime_+3A_durbin">Durbin</code></td>
<td>
<p>If a formula object and model is type &quot;sdm&quot;, &quot;sdem&quot; 
or &quot;slx&quot; the subset of explanatory variables to lag for each equation.</p>
</td></tr>
<tr><td><code id="spsurtime_+3A_method">method</code></td>
<td>
<p>Similar to the corresponding parameter of 
<code><a href="spatialreg.html#topic+lagsarlm">lagsarlm</a></code> function in <span class="pkg">spatialreg</span> package. 
&quot;eigen&quot; (default) - the Jacobian is computed as the product of 
(1 - rho*eigenvalue) using <code><a href="spatialreg.html#topic+eigenw">eigenw</a></code>, and 
&quot;spam&quot; or &quot;Matrix_J&quot; for strictly symmetric weights lists of 
styles &quot;B&quot; and &quot;C&quot;, or made symmetric by similarity 
(Ord, 1975, Appendix C) if possible for styles &quot;W&quot; and &quot;S&quot;, 
using code from the spam or Matrix packages to calculate the 
determinant; &quot;Matrix&quot; and &quot;spam_update&quot; provide updating Cholesky 
decomposition methods; &quot;LU&quot; provides an alternative sparse matrix 
decomposition approach. In addition, there are &quot;Chebyshev&quot; and 
Monte Carlo &quot;MC&quot; approximate log-determinant methods; 
the Smirnov/Anselin (2009) trace approximation is available 
as &quot;moments&quot;. Three methods: &quot;SE_classic&quot;, &quot;SE_whichMin&quot;, 
and &quot;SE_interp&quot; are provided experimentally, the first to 
attempt to emulate the behaviour of Spatial Econometrics 
toolbox ML fitting functions. All use grids of log determinant 
values, and the latter two attempt to ameliorate some features 
of &quot;SE_classic&quot;.</p>
</td></tr>
<tr><td><code id="spsurtime_+3A_fit_method">fit_method</code></td>
<td>
<p>Method of estimation for the spatial panel SUR model, 
either <em>ml</em> or <em>3sls</em>. Default = <em>ml</em>.</p>
</td></tr>
<tr><td><code id="spsurtime_+3A_maxlagw">maxlagW</code></td>
<td>
<p>Maximum spatial lag order of the regressors employed to 
produce spatial instruments for the spatial lags of the explained 
variables. Default = 2. Note that in case of <code>type</code> = &quot;sdm&quot;, the 
default value for <code>maxlagW</code> is set to 3 because the first lag of 
the regressors, <code class="reqn">WX_{tg}</code>, can not be used as spatial instruments.</p>
</td></tr>
<tr><td><code id="spsurtime_+3A_zero.policy">zero.policy</code></td>
<td>
<p>Similar to the corresponding parameter of 
<code><a href="spatialreg.html#topic+lagsarlm">lagsarlm</a></code> function in <span class="pkg">spatialreg</span> package. 
If <code>TRUE</code> assign zero to the lagged value of zones without 
neighbours, if <code>FALSE</code> assign <code>NA</code> - causing 
<code>spsurml()</code> to terminate with an error. Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="spsurtime_+3A_interval">interval</code></td>
<td>
<p>Search interval for autoregressive parameter.
Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="spsurtime_+3A_trs">trs</code></td>
<td>
<p>Either <code>NULL</code> or vector of powered spatial weights 
matrix traces output by <code>trW</code>. Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="spsurtime_+3A_r">R</code></td>
<td>
<p>A row vector of order <em>(1xpr)</em> with  the set of 
<em>r</em> linear constraints on the <em>beta</em> parameters. The 
<em>first</em> restriction appears in the first <em>p</em> terms,
the second restriction in the next <em>p</em> terms and so on. 
Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="spsurtime_+3A_b">b</code></td>
<td>
<p>A column vector of order <em>(rx1)</em> with the values of 
the linear restrictions on the <em>beta</em> parameters. 
Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="spsurtime_+3A_demean">demean</code></td>
<td>
<p>Logical value to allow for the demeaning of panel data. In this case,
<code><a href="#topic+spsurml">spsurml</a></code> subtracts the individual mean to each spatial 
or cross-sectional unit. Default = <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="spsurtime_+3A_control">control</code></td>
<td>
<p>list of additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function <code><a href="#topic+spsurtime">spsurtime</a></code> only admits a formula, created with 
<code><a href="Formula.html#topic+Formula">Formula</a></code> and a dataset of class <code>data.frame</code> 
or <code>matrix</code>. That is, the data cannot be uploaded using data 
matrices <code class="reqn">Y</code> and <code class="reqn">X</code> provided for other functions in 
this package. <br />
The argument <code>time</code> selects the variable, in the <code>data.frame</code>, 
associated to the time dimension in the panel dataset. Then 
<code><a href="#topic+spsurtime">spsurtime</a></code> operates as in Anselin (1988), that is,
each cross-section is treated as if it were an equation in a SUR model, 
which now has <em>Tm</em> 'equations' and <em>N</em> individuals. <br />
The SUR structure appears because there is serial dependence in the errors 
of each individual in the panel. The serial dependence in the errors is 
not parameterized, but estimated non-parametrically in the <code class="reqn">Sigma</code> 
covariance matrix returned by the function. An important constraint to 
mention is that the serial dependence assumed to be the same for all 
individuals in the sample. Serial dependence among individuals is 
excluded from Anselin approach.
</p>


<h3>Value</h3>

<p>An <code>spsur</code> object with the output of the maximum-likelihood or 
three-stages least-squares estimation of the spatial panel SUR model.
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
  Fernando Lopez  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Jesus Mur  </td><td style="text-align: left;"> <a href="mailto:jmur@unizar.es">jmur@unizar.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Anselin, L. (1988). Spatial econometrics: methods and models. Dordrecht,
Kluwer Academic Publishers.
</p>
</li>
<li><p> Lopez, F.A., Mur, J., and Angulo, A. (2014). Spatial model
selection strategies in a SUR framework. The case of regional
productivity in EU. <em>Annals of Regional Science</em>, 53(1), 197-220.
&lt;doi:10.1007/s00168-014-0624-2&gt;
</p>
</li>
<li><p> Lopez, F.A., Martinez-Ortiz, P.J., and Cegarra-Navarro, J.G. (2017).
Spatial spillovers in public expenditure on a municipal level in
Spain. <em>Annals of Regional Science</em>, 58(1), 39-65.
&lt;doi:10.1007/s00168-016-0780-7&gt;
</p>
</li>
<li><p> Minguez, R., Lopez, F.A. and Mur, J.  (2022).
spsur: An R Package for Dealing with Spatial 
Seemingly Unrelated Regression Models. 
<em>Journal of Statistical Software</em>, 
104(11), 1&ndash;43. &lt;doi:10.18637/jss.v104.i11&gt;
</p>
</li>
<li><p> Mur, J., Lopez, F., and Herrera, M. (2010). Testing for spatial
effects in seemingly unrelated regressions. <em>Spatial Economic Analysis</em>, 
5(4), 399-440. &lt;doi:10.1080/17421772.2010.516443&gt;
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+spsurml">spsurml</a></code>, <code><a href="#topic+spsur3sls">spsur3sls</a></code>, 
<code><a href="#topic+wald_betas">wald_betas</a></code>,  <code><a href="#topic+wald_deltas">wald_deltas</a></code>,
<code><a href="#topic+lmtestspsur">lmtestspsur</a></code>, <code><a href="#topic+lr_betas">lr_betas</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
####################################
######## PANEL DATA (G=1; Tm&gt;1) ###
####################################

## Example 1:
rm(list = ls()) # Clean memory
data(spc)
lwspc &lt;- spdep::mat2listw(Wspc, style = "W")
N &lt;- nrow(spc)
Tm &lt;- 2
index_time &lt;- rep(1:Tm, each = N)
index_indiv &lt;- rep(1:N, Tm)
WAGE &lt;- c(spc$WAGE83, spc$WAGE81)
UN &lt;- c(spc$UN83, spc$UN80)
NMR &lt;- c(spc$NMR83, spc$NMR80)
SMSA &lt;- c(spc$SMSA, spc$SMSA)
pspc &lt;- data.frame(index_indiv, index_time, WAGE, UN,
                    NMR, SMSA)
form_pspc &lt;- WAGE ~ UN + NMR + SMSA
form2_pspc &lt;- WAGE | NMR ~ UN  | UN + SMSA

# SLM 
pspc_slm &lt;- spsurtime(formula = form_pspc, data = pspc, 
                      listw = lwspc,
                      time = pspc$index_time, 
                      type = "slm", fit_method = "ml")
summary(pspc_slm)
 
pspc_slm2 &lt;- spsurtime(formula = form2_pspc, data = pspc, 
                      listw = lwspc,
                      time = pspc$index_time, 
                      type = "slm", fit_method = "ml")
summary(pspc_slm2)


## VIP: The output of the whole set of the examples can be examined 
## by executing demo(demo_spsurtime, package="spsur")

 
### Example 2:
rm(list = ls()) # Clean memory
### Read NCOVR.sf object
data(NCOVR, package="spsur")
nbncovr &lt;- spdep::poly2nb(NCOVR.sf, queen = TRUE)
### Some regions with no links...
lwncovr &lt;- spdep::nb2listw(nbncovr, style = "W", zero.policy = TRUE)
N &lt;- nrow(NCOVR.sf)
Tm &lt;- 4
index_time &lt;- rep(1:Tm, each = N)
index_indiv &lt;- rep(1:N, Tm)
pHR &lt;- c(NCOVR.sf$HR60, NCOVR.sf$HR70, NCOVR.sf$HR80, NCOVR.sf$HR90)
pPS &lt;- c(NCOVR.sf$PS60, NCOVR.sf$PS70, NCOVR.sf$PS80, NCOVR.sf$PS90)
pUE &lt;- c(NCOVR.sf$UE60, NCOVR.sf$UE70, NCOVR.sf$UE80, NCOVR.sf$UE90)
pNCOVR &lt;- data.frame(indiv = index_indiv, time = index_time,
                     HR = pHR, PS = pPS, UE = pUE)
form_pHR &lt;- HR ~ PS + UE

## SIM

pHR_sim &lt;- spsurtime(formula = form_pHR, data = pNCOVR, 
                    time = pNCOVR$time, type = "sim", fit_method = "ml")
summary(pHR_sim)

## SLM by 3SLS. 

pHR_slm &lt;- spsurtime(formula = form_pHR, data = pNCOVR, listw = lwncovr,
                     time = pNCOVR$time, type = "slm", 
                     fit_method = "3sls")
summary(pHR_slm)

############################# Wald tests about betas in spatio-temporal models
### H0: equal betas for PS in equations 1, 3 and 4.
R &lt;- matrix(0, nrow = 2, ncol = 12) 
## nrow = number of restrictions 
## ncol = number of beta parameters
R[1, 2] &lt;- 1; R[1, 8] &lt;- -1 # PS beta coefficient in equations 1 equal to 3
R[2, 2] &lt;- 1; R[2, 11] &lt;- -1 # PS beta coefficient in equations 1 equal to 4
b &lt;- matrix(0, nrow=2, ncol=1)
wald_betas(pHR_sim , R = R , b = b) # SIM model
wald_betas(pHR_slm , R = R , b = b) # SLM model
############################# Wald tests about spatial-parameters in
############################# spatio-temporal models
### H0: equal rhos in slm model for equations 1 and 2.
R2 &lt;- matrix(0, nrow = 1, ncol = 4)
R2[1, 1] &lt;- 1; R2[1, 2] &lt;- -1
b2 &lt;- matrix(0, nrow = 1, ncol = 1)
wald_deltas(pHR_slm, R = R2, b = b2)

</code></pre>

<hr>
<h2 id='summary.spsur'>Summary of estimated objects of class <em>spsur</em>.</h2><span id='topic+summary.spsur'></span>

<h3>Description</h3>

<p>This function summarizes estimated <em>spsur</em> objects. The tables in the output
include basic information for each equation. The report also shows other complementary results
corresponding to the SUR model like the <em>(GxG)</em> covariance matrix of the residuals of the
equations of the SUR, the estimated log-likelihood, the Breusch-Pagan diagonality test or the Marginal
Lagrange Multiplier, LMM, tests of spatial dependence.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'spsur'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.spsur_+3A_object">object</code></td>
<td>
<p>An <em>spsur</em> object estimated using <code><a href="#topic+spsurml">spsurml</a></code>,
<code><a href="#topic+spsur3sls">spsur3sls</a></code> or <code><a href="#topic+spsurtime">spsurtime</a></code> functions.</p>
</td></tr>
<tr><td><code id="summary.spsur_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <em>summary.spsur</em>
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
  Fernando Lopez  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Jesus Mur  </td><td style="text-align: left;"> <a href="mailto:jmur@unizar.es">jmur@unizar.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>See Also</h3>

<p><code><a href="#topic+print.summary.spsur">print.summary.spsur</a></code>; <code><a href="#topic+spsurml">spsurml</a></code>; <code><a href="#topic+spsur3sls">spsur3sls</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'> # See examples for \code{\link{spsurml}} or
 # \code{\link{spsur3sls}} functions.

</code></pre>

<hr>
<h2 id='wald_betas'>Wald tests on the <em>beta</em> coefficients</h2><span id='topic+wald_betas'></span>

<h3>Description</h3>

<p>The function <code><a href="#topic+wald_betas">wald_betas</a></code> can be seen as a complement 
to the restricted estimation procedures included in the functions 
<code><a href="#topic+spsurml">spsurml</a></code> and <code><a href="#topic+spsur3sls">spsur3sls</a></code>. 
<code><a href="#topic+wald_betas">wald_betas</a></code> obtains Wald tests for sets of linear 
restrictions on the coefficients <code class="reqn">\beta</code> of the SUR model.
The restrictions may involve coefficients of the same equation or 
coefficients from different equations. The function has great flexibility 
in this respect. Note that <code><a href="#topic+wald_betas">wald_betas</a></code> is more general than 
<code><a href="#topic+lr_betas">lr_betas</a></code> in the sense that the last function
only allows to test for restrictions of homogeneity of subsets of 
<code class="reqn">\beta</code> coefficients among the different equations in the SUR model, 
and in a maximum-likelihood framework.
</p>
<p>In order to work with <code><a href="#topic+wald_betas">wald_betas</a></code>, the model on which the 
linear restrictions are to be tested needs to exists as an <em>spsur</em> 
object.  Using the information contained in the object, 
<code><a href="#topic+wald_betas">wald_betas</a></code> obtains the corresponding Wald estatistic 
for the null hypotheses specified by the user through the <em>R</em> row 
vector and <em>b</em> column vector, used also in <code><a href="#topic+spsurml">spsurml</a></code> 
and <code><a href="#topic+spsur3sls">spsur3sls</a></code>. The function shows the value of the Wald test
statistics and its associated p-values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wald_betas (obj , R , b)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="wald_betas_+3A_obj">obj</code></td>
<td>
<p>An <code>spsur</code> object created by <code><a href="#topic+spsurml">spsurml</a></code>,
<code><a href="#topic+spsur3sls">spsur3sls</a></code> or <code><a href="#topic+spsurtime">spsurtime</a></code>.</p>
</td></tr>
<tr><td><code id="wald_betas_+3A_r">R</code></td>
<td>
<p>A row vector of order <code class="reqn">(1xPr)</code> showing  the set
of <em>r</em> linear constraints on the <code class="reqn">\beta</code> parameters. 
The <em>first</em> restriction appears in the first <em>K</em> terms 
in <em>R</em>, the <em>second</em> restriction in the next <em>K</em> terms 
and so on.</p>
</td></tr>
<tr><td><code id="wald_betas_+3A_b">b</code></td>
<td>
<p>A column vector of order <em>(rx1)</em> with the values of the 
linear restrictions on the <code class="reqn">\beta</code> parameters.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Object of <code>htest</code> class including the Wald
statistic, the corresponding p-value, the degrees of
freedom and the values of the sample estimates.
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
  Fernando Lopez  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Jesus Mur  </td><td style="text-align: left;"> <a href="mailto:jmur@unizar.es">jmur@unizar.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>References</h3>


<ul>
<li><p> Lopez, F.A., Mur, J., and Angulo, A. (2014). Spatial model
selection strategies in a SUR framework. The case of regional
productivity in EU. <em>Annals of Regional Science</em>, 53(1), 197-220.
&lt;doi:10.1007/s00168-014-0624-2&gt;
</p>
</li>
<li><p> Mur, J., Lopez, F., and Herrera, M. (2010). Testing for spatial
effects in seemingly unrelated regressions. <em>Spatial Economic 
Analysis</em>, 5(4), 399-440. 
&lt;doi:10.1080/17421772.2010.516443&gt;
</p>
</li>
<li><p> Anselin, L. (2016) Estimation and Testing in the Spatial Seemingly 
Unrelated Regression (SUR). <em>Geoda Center for Geospatial Analysis 
and Computation, Arizona State University</em>. Working Paper 2016-01.
&lt;doi:10.13140/RG.2.2.15925.40163&gt;
</p>
</li>
<li><p> Minguez, R., Lopez, F.A. and Mur, J.  (2022).
spsur: An R Package for Dealing with Spatial 
Seemingly Unrelated Regression Models. 
<em>Journal of Statistical Software</em>, 
104(11), 1&ndash;43. &lt;doi:10.18637/jss.v104.i11&gt;
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+spsurml">spsurml</a></code>, <code><a href="#topic+spsur3sls">spsur3sls</a></code>, <code><a href="#topic+lr_betas">lr_betas</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## VIP: The output of the whole set of the examples can be examined 
## by executing demo(demo_wald_betas, package="spsur")

#################################################
######## CROSS SECTION DATA (G=1; Tm&gt;1) ########
#################################################

##### Example 1: Spatial Phillips-Curve. Anselin (1988, p. 203)
rm(list = ls()) # Clean memory
data(spc)
lwspc &lt;- spdep::mat2listw(Wspc, style = "W")
Tformula &lt;- WAGE83 | WAGE81 ~ UN83 + NMR83 + SMSA | UN80 + NMR80 + SMSA
### Estimate SUR-SLM model
spcsur.slm &lt;- spsurml(formula = Tformula, data = spc, 
                      type = "slm", listw = lwspc)
summary(spcsur.slm)
### H_0: equality between SMSA coefficients in both equations.
R1 &lt;- matrix(c(0,0,0,1,0,0,0,-1), nrow=1)
b1 &lt;- matrix(0, ncol=1)

wald_betas(spcsur.slm, R = R1, b = b1)
</code></pre>

<hr>
<h2 id='wald_deltas'>Wald tests for spatial parameters coefficients.</h2><span id='topic+wald_deltas'></span>

<h3>Description</h3>

<p>Function <code><a href="#topic+wald_deltas">wald_deltas</a></code> obtains Wald tests for linear 
restrictions on the spatial coefficients of a SUR model that has been 
estimated previously through the function <code><a href="#topic+spsurml">spsurml</a></code>. The 
restrictions can affect to coefficients of the same equation
(i.e., <code class="reqn">\lambda_{g}=\rho_{g} forall g</code>) or can involve coefficients 
from different equations (i.e., <code class="reqn">\lambda_{g}=\lambda_{h}</code>). The 
function has great flexibility in this respect. Note that 
<code><a href="#topic+wald_deltas">wald_deltas</a></code> only works in a maximum-likelihood framework.
</p>
<p>In order to work with <code><a href="#topic+wald_betas">wald_betas</a></code>, the model on which the 
linear restrictions are to be tested needs to exists as an <em>spsur</em> 
object. Using the information contained in the object, 
<code><a href="#topic+wald_deltas">wald_deltas</a></code> obtains the corresponding Wald statistic for 
the null hypotheses specified by the user through the <em>R</em> row vector 
and <em>b</em> column vector discussed, used also in <code><a href="#topic+spsurml">spsurml</a></code>. 
The function shows the  resulting Wald test statistics and their 
corresponding p-values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wald_deltas (obj , R , b)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="wald_deltas_+3A_obj">obj</code></td>
<td>
<p>An <code>spsur</code> object created by <code><a href="#topic+spsurml">spsurml</a></code>,
<code><a href="#topic+spsur3sls">spsur3sls</a></code> or <code><a href="#topic+spsurtime">spsurtime</a></code>.</p>
</td></tr>
<tr><td><code id="wald_deltas_+3A_r">R</code></td>
<td>
<p>A row vector of order <em>(1xGr)</em> or <em>(1x2Gr)</em> showing 
the set of <em>r</em> linear constraints on the  spatial parameters. The 
last case is reserved to &quot;sarar&quot; models where there appear
<em>G</em> parameters <code class="reqn">\lambda_{g}</code> and <em>G</em> parameters 
<code class="reqn">\rho_{g}</code>, <em>2G</em> spatial in total. The <em>first</em> 
restriction appears in the first <em>G</em> terms in <em>R</em> 
(<em>2G</em> for the &quot;sarar&quot; case),   the second restriction 
in the next <em>G</em> terms (<em>2G</em> for the
&quot;sarar&quot; case) and so on.</p>
</td></tr>
<tr><td><code id="wald_deltas_+3A_b">b</code></td>
<td>
<p>A column vector of order <em>(rx1)</em> with the values 
of the linear restrictions on the <code class="reqn">\beta</code> parameters.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Object of <code>htest</code> including the Wald
statistic, the corresponding p-value, the degrees of
freedom and the values of the sample estimates.
</p>


<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
  Fernando Lopez  </td><td style="text-align: left;"> <a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Roman Minguez  </td><td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  Jesus Mur  </td><td style="text-align: left;"> <a href="mailto:jmur@unizar.es">jmur@unizar.es</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>See Also</h3>

<p><code><a href="#topic+spsurml">spsurml</a></code>, <code><a href="#topic+spsur3sls">spsur3sls</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#################################################
######## CROSS SECTION DATA (G&gt;1; Tm=1) ########
#################################################
rm(list = ls()) # Clean memory
data(spc, package = "spsur")
lwspc &lt;- spdep::mat2listw(Wspc, style = "W")
Tformula &lt;- WAGE83 | WAGE81 ~ UN83 + NMR83 + SMSA | UN80 + NMR80 + SMSA

#################################
## Estimate SUR-SLM model
spcsur.slm &lt;-spsurml(formula = Tformula, data = spc, 
                       type = "slm", listw = lwspc)
summary(spcsur.slm)
## H_0: equality of the lambda parameters of both equations.
R1 &lt;- matrix(c(1,-1), nrow=1)
b1 &lt;- matrix(0, ncol=1)
wald_deltas(spcsur.slm, R = R1, b = b1)
</code></pre>

<hr>
<h2 id='Wspc'>Spatial weight matrix for South-West Ohio Counties to estimate
Spatial Phillips-Curve</h2><span id='topic+Wspc'></span>

<h3>Description</h3>

<p>A spatial weight matrix row-standardized based on first order
contiguity criterium.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Wspc
</code></pre>


<h3>Format</h3>

<p>A row-standardized squared matrix with 25 rows and columns.
The rows and columns follow the same order than provinces included in
<em>spc</em> data frame.
</p>


<h3>Source</h3>

<p>Anselin (1988, p. 207)
</p>


<h3>References</h3>


<ul>
<li><p> Anselin, L. (1988). <em>Spatial Econometrics:
Methods and Models</em>. Springer Science &amp; Business Media.
</p>
</li></ul>


</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
