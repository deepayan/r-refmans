<!DOCTYPE html><html lang="en"><head><title>Help for package UpDown</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {UpDown}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#PigDisturbance'>
<p>Non-observable information about the disturbances occuring in the <code>PigFarming</code> dataset</p></a></li>
<li><a href='#PigFarming'>
<p>Simulated longitudinal phenotypes that mimics a pig-farming dataset subsected to disturbances</p></a></li>
<li><a href='#UpDown'><p>Unsupervised hierarchical classification for elastic or plastic response to a disturbance using mixture of Gaussian  distributions</p></a></li>
<li><a href='#UpDownApp'><p>Shiny app to vizualise the longitudinal intra-group observations and the detected disturbances</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Detecting Group Disturbances from Longitudinal Observations</td>
</tr>
<tr>
<td>Version:</td>
<td>1.2.1</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides an algorithm to detect and characterize disturbances (start, end dates, intensity) that can occur at different hierarchical levels by studying the dynamics of longitudinal observations at the unit level and group level based on Nadaraya-Watson's smoothing curves, but also a shiny app which allows to visualize the observations and the detected disturbances. Finally the package provides a dataframe mimicking a pig farming system subsected to disturbances simulated according to Le et al.(2022) &lt;<a href="https://doi.org/10.1016%2Fj.animal.2022.100496">doi:10.1016/j.animal.2022.100496</a>&gt;. </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyDataCompression:</td>
<td>xz</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats, mixtools, mclust, dplyr, ggplot2, reshape2, shiny</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.0.0)</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Author:</td>
<td>Tom Rohmer [aut, cre],
  Vincent Le [aut],
  Ingrid David [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Tom Rohmer &lt;tom.rohmer@inrae.fr&gt;</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-07-20 17:29:20 UTC; torohmer</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-07-20 18:50:13 UTC</td>
</tr>
</table>
<hr>
<h2 id='PigDisturbance'>
Non-observable information about the disturbances occuring in the <code>PigFarming</code> dataset
</h2><span id='topic+PigDisturbance'></span>

<h3>Description</h3>

<p>Information about the disturbances relative to the dataset <code>PigFarming</code>: start, and intensity. An intensity of 0 stands for no disturbance for the considered hierarchical level. Not observable in practice. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("PigDisturbance")</code></pre>


<h3>Format</h3>

<p>A dataframe with 6000 records on the following 12 variables:
</p>

<dl>
<dt><code>id</code></dt><dd><p>the identifier of the animal</p>
</dd>
<dt><code>batch</code></dt><dd><p>the numero of the batch of the animal</p>
</dd>
<dt><code>pen</code></dt><dd><p>the numero of the batch of the animal</p>
</dd>
<dt><code>int_batch</code></dt><dd><p>the intensity of the disturbance at the batch level</p>
</dd>
<dt><code>start_batch</code></dt><dd><p>the starting time of the disturbance at the batch level</p>
</dd>
<dt><code>end_batch</code></dt><dd><p>the endding time of the disturbance at the batch level</p>
</dd>
<dt><code>int_pen</code></dt><dd><p>the intensity of the disturbance at the pen level</p>
</dd>
<dt><code>start_pen</code></dt><dd><p>the starting time of the disturbance at the pen level</p>
</dd>
<dt><code>end_pen</code></dt><dd><p>the endding time of the disturbance at the pen level</p>
</dd>
<dt><code>int_ind</code></dt><dd><p>the intensity of the disturbance  at the individual level</p>
</dd>
<dt><code>start_ind</code></dt><dd><p>the starting time of the disturbance at the individual level</p>
</dd>
<dt><code>end_ind</code></dt><dd><p>the endding time of the disturbance at the individual level</p>
</dd>
</dl>



<h3>References</h3>

<p>Le, Vincent, Tom Rohmer, and Ingrid David. 2022. “Impact of Environmental Disturbances on Estimated Genetic Parameters and Breeding Values for Growth Traits in Pigs.” Animal 16 (4): 100496.
https://doi.org/10.1016/j.animal.2022.100496
</p>


<h3>Examples</h3>

<pre><code class='language-R'>theo_dat=get(data(PigDisturbance))
str(theo_dat)
theo_dat[c(1,6,5405),]
</code></pre>

<hr>
<h2 id='PigFarming'>
Simulated longitudinal phenotypes that mimics a pig-farming dataset subsected to disturbances
</h2><span id='topic+PigFarming'></span>

<h3>Description</h3>

<p>Example of a dataset on which UpDown can be applied. It consists in simulated hierarchical data mimicking a pig farming-system dataset subsected to disturbances. The animals (id) were raised in 40 batches and in 15 pens within each batch leading to 15 animals per pen. Hence three hierarchical level are considered: id, pen and batch levels.  Data were simulated following Le et al. 2022. &lt;doi.org/10.1016/j.animal.2022.100496&gt;
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("PigFarming")</code></pre>


<h3>Format</h3>

<p>A data frame with 578847 individual observations on the following 6 variables:
</p>

<dl>
<dt><code>id</code></dt><dd><p>the identifier of the animal</p>
</dd>
<dt><code>batch</code></dt><dd><p>the numero of the batch</p>
</dd>
<dt><code>pen</code></dt><dd><p>the numero of the pen</p>
</dd>
<dt><code>age</code></dt><dd><p>the age (in day) of the animal</p>
</dd>
<dt><code>time</code></dt><dd><p>the observation times</p>
</dd>
<dt><code>weight</code></dt><dd><p>the weight (in kg) of the animal</p>
</dd>
</dl>



<h3>References</h3>

<p>Le Vincent, Tom Rohmer, and Ingrid David. 2022. “Impact of Environmental Disturbances on Estimated Genetic Parameters and Breeding Values for Growth Traits in Pigs.” Animal 16 (4): 100496.
https://doi.org/10.1016/j.animal.2022.100496
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data=get(data(PigFarming))
str(data)
plot(subset(data,id==6)$weight)
</code></pre>

<hr>
<h2 id='UpDown'>Unsupervised hierarchical classification for elastic or plastic response to a disturbance using mixture of Gaussian  distributions</h2><span id='topic+UpDown'></span>

<h3>Description</h3>

<p>Detection and characterisation of disturbances from longitudinal data, organized in hierarchical groups
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  UpDown(data,levels,obs, vtime, h.int=NULL,
  mixplot=FALSE, correction=NULL, 
  kappa=NULL,thr_va=0.5,
  options=list())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="UpDown_+3A_data">data</code></td>
<td>
<p>a dataframe containing at minima observations,  a time variable and hierarchical levels (one column per level). The dataframe can also contain other variables. One row per unit and observed time is needed.
</p>
</td></tr>
<tr><td><code id="UpDown_+3A_levels">levels</code></td>
<td>
<p>a vector of character strings specifing the column names corresponding to the considered hierarchical levels appearing in the dataframe <code>data</code>, ordered from the highest  hierarchical level to the lowest hierarchical level (i.e., the unit level)
</p>
</td></tr>
<tr><td><code id="UpDown_+3A_obs">obs</code></td>
<td>
<p>character string specifing the column names of the considered numeric observations appearing in the data frame <code>data</code>.
</p>
</td></tr>
<tr><td><code id="UpDown_+3A_vtime">vtime</code></td>
<td>
<p>character string specifing the column names of the considered time variable appearing in the data frame <code>data</code>.
</p>
</td></tr>
<tr><td><code id="UpDown_+3A_h.int">h.int</code></td>
<td>
<p>a real parameter specifying the smoothing bandwidth in Nadaraya-Watson's smoothing curves <em>see ?ksmooth</em>. The default value is <code class="reqn">\sqrt {n}</code>, where <code class="reqn">n</code> is the largest length of observations per unit.
</p>
</td></tr>
<tr><td><code id="UpDown_+3A_mixplot">mixplot</code></td>
<td>
<p>logical. If TRUE, the mixture curves for each hierarchical levels are plotted. (default value FALSE)
</p>
</td></tr>
<tr><td><code id="UpDown_+3A_correction">correction</code></td>
<td>
<p>an optional character string specifing the column name of a considered time-dependent discrete variable appearing in the dataframe <code>data</code> for which a correction of the observation <code>obs</code> is needed. The correction consists in subtracting the median relative to the modalities of the variable. 


</p>
</td></tr>
<tr><td><code id="UpDown_+3A_kappa">kappa</code></td>
<td>
<p>an integer in [0,1) used to eliminate a redundancy disturbance between two distinct levels, based on the estimated starting and end points. It evaluates the overlapping between two considered disturbances. The disturbance is removed in the lowest of the two hierarchical levels. When kappa is not specified (null default value) no redounding disturbances are eliminated. When kappa is equal to 1, only the disturbances with the same rounded starting and ending points are removed. An excessively small values for kappa can lead to wrongly remove disturbances. The suggested value for kappa is 0.75.
</p>
</td></tr>
<tr><td><code id="UpDown_+3A_thr_va">thr_va</code></td>
<td>
<p>an integer in [0,1) used to validate in the down step the group disturbances. <code>thr_va</code> control the percentage of starting-times of the underlying elements in a close interval to validate the disturbance. A value of 0 indicate that all the disturbances are validated that is to say no validation is done. The default value is 0.5, i.e., at least 50% of the elements constituting the group should have a disturbance in a close time to validate the group disturbance.
</p>
</td></tr>
<tr><td><code id="UpDown_+3A_options">options</code></td>
<td>
<p>A list of options. See the documentation <em>see ?normalmixEM</em> for possible options of the mixture model
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note that unique identifiers are mandatory for the hierarchical levels. Moreover note that UpDown considers that all perturbations have a negative effect on the longitudinal observations. For a positive effect, consider the opposite sign of the observations before using UpDown. Units with less than 20 observations are removed. That can be modified using the option <code>minobs</code> in <code>options</code>.
</p>


<h3>Value</h3>

<p>A list containing the following components:
</p>
<table role = "presentation">
<tr><td><code>data</code></td>
<td>
<p>the initial dataframe with the supplementary columns (if <code>correction</code> is not null); <em>medobs</em>, the median of observations grouped into the modalities of the qualitative variable used in <code>correction</code>; and <em>cobs</em> the corrected observations. Units with less than <code>minobs</code> observations are removed.
</p>
</td></tr>
<tr><td><code>levels</code></td>
<td>
<p>the specified hierarchical levels.
</p>
</td></tr>
<tr><td><code>med_lev</code></td>
<td>
<p>a list of matrices. The last matrix contains the medians of the unit observations per observed time. The previous one contains the medians of these medians per observed time and so on up to the highest hierarchical level. If there are less than 50% observations per considered time, the median will not be evaluated (NA).
</p>
</td></tr>
<tr><td><code>mixmdl_lev</code></td>
<td>
<p>a list of outputs of the mixture models of the hierarchical levels. The first output concerns the lowest hierarchical levels (i.e., unit) and the last output concerns the highest hierarchical levels.
</p>
</td></tr>
<tr><td><code>names_lev</code></td>
<td>
<p>a list of names of each elements of the hierarchical levels. The first matrix concerns the lowest hierarchical levels (i.e., unit) and the last matrix concerns the highest hierarchical levels.
</p>
</td></tr>
<tr><td><code>sc.x_lev</code></td>
<td>
<p>a list of matrices giving the time points considered by the smoothing, per identifier and for each hierarchical level. The first matrix concerns the lowest hierarchical levels (i.e., unit) and the last matrix concerns the highest hierarchical levels. 
</p>
</td></tr>
<tr><td><code>sc.y_lev</code></td>
<td>
<p>a list of matrices of fitted values corresponding to <code>sc.x_lev</code>. The first matrix concerns the lowest hierarchical levels (i.e., unit) and the last matrix concerns the highest hierarchical levels.
</p>
</td></tr>
<tr><td><code>sc.dx_lev</code></td>
<td>
<p>a list of matrices giving the time points considered by the derivative smoothing curve, per identifier and for each hierarchical level.  The first matrix concerns the lowest hierarchical levels (i.e., unit) and the last matrix concerns the highest hierarchical levels.
</p>
</td></tr>
<tr><td><code>sc.dy_lev</code></td>
<td>
<p>a list of matrices of fitted values corresponding to <code>sc.dx_lev</code>. The first matrix concerns the lowest hierarchical levels (i.e., unit) and the last matrix concerns the highest hierarchical levels.
</p>
</td></tr>
<tr><td><code>Up</code></td>
<td>
<p>a dataframe that describes for each ids, the type of detected disturbance at the end of the Up-step. '0' stands for no disturbance.
</p>
</td></tr>
<tr><td><code>Down</code></td>
<td>
<p>a list of matrices that gives the detected disturbances for each hierarchical level and their characteristics.
</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Tom Rohmer, Vincent Le, Ingrid David
</p>


<h3>References</h3>

<p>Benaglia, T., Chauveau, D., Hunter, D. R., and Young, D. mixtools: An R package for analyzing finite mixture models. Journal of Statistical Software, 32(6):1-29, 2009.
</p>
<p>Le, V. 2022. “Nouvelle mesure de la robustesse des animaux d’élevage par utilisation des données de phénotypage haut-débit.” Thesis, INPT Toulouse. https://hal.inrae.fr/tel-03967884.
</p>
<p>Nadaraya, E. A. On estimating regression. Theory of Probability &amp; Its Applications, 9(1):141–142, 1964
</p>
<p>Scrucca L., Fop M., Murphy T. B. and Raftery A. E. (2016) mclust 5: clustering, classification and density estimation using Gaussian finite mixture models, The R Journal, 8/1, pp. 289-317.
</p>
<p>Watson, G. S. Smooth regression analysis. Sankhya: The Indian Journal of Statistics, Series A, pages
359–372, 1964
</p>


<h3>See Also</h3>

<p><code><a href="mixtools.html#topic+normalmixEM">normalmixEM()</a></code>, <code><a href="mclust.html#topic+mclust">mclust()</a></code>, <code><a href="stats.html#topic+ksmooth">ksmooth()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# load data
data.ex=get(data(PigFarming))

# optional arguments
options&lt;-list(maxit=100) 

# considered hierarchical levels
levels=c("batch","pen","id")

UpDown.out&lt;- UpDown(data.ex, levels=levels, vtime="time", obs="weight",
kappa=0.75, thr_va=0.5, h.int=10, mixplot=FALSE, correction="age", options=options)

UpDown.out$Down$batch

</code></pre>

<hr>
<h2 id='UpDownApp'>Shiny app to vizualise the longitudinal intra-group observations and the detected disturbances</h2><span id='topic+UpDownApp'></span>

<h3>Description</h3>

<p>The function starts a shiny app which visualizes the data organized by the hierarchical levels, and the estimated start and end point of the detected disturbances
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  UpDownApp(updown.out,obs=NULL,width=1000,height=1000)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="UpDownApp_+3A_updown.out">updown.out</code></td>
<td>
<p>Global output of the <code>UpDown</code> function </p>
</td></tr>
<tr><td><code id="UpDownApp_+3A_obs">obs</code></td>
<td>
<p>(optional) vector of character string specifing the names of the considered longitudinal observations appearing in the dataframe <code>data</code>.
</p>
</td></tr>
<tr><td><code id="UpDownApp_+3A_width">width</code>, <code id="UpDownApp_+3A_height">height</code></td>
<td>
<p>(optional) interger specifing the width and the height of the plot in the Rshiny.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, run the application</p>


<h3>See Also</h3>

<p><code><a href="shiny.html#topic+shiny">shiny()</a></code>, <code><a href="ggplot2.html#topic+ggplot2">ggplot2()</a></code>, <code><a href="#topic+UpDown">UpDown()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# load data
data=get(data(PigFarming))

levels=c("batch","pen","id")
updown.out&lt;- UpDown(data,levels=levels, vtime="time", obs="weight",
kappa=0.75, thr_va=0.5, correction="age")


if(interactive()){UpDownApp(updown.out)}

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
