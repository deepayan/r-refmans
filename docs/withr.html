<!DOCTYPE html><html><head><title>Help for package withr</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {withr}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#defer'><p>Defer Evaluation of an Expression</p></a></li>
<li><a href='#devices'><p>Graphics devices</p></a></li>
<li><a href='#global_defer'><p>Defer expression globally</p></a></li>
<li><a href='#local_'><p>Create a new &quot;with&quot; or &quot;local&quot; function</p></a></li>
<li><a href='#makevars_user'><p>Shim for tools::makevars_user()</p></a></li>
<li><a href='#set_makevars'><p>Create a new <code>Makevars</code> file, by adding new variables</p></a></li>
<li><a href='#with_collate'><p>Collation Order</p></a></li>
<li><a href='#with_connection'><p>Connections which close themselves</p></a></li>
<li><a href='#with_db_connection'><p>DBMS Connections which disconnect themselves.</p></a></li>
<li><a href='#with_dir'><p>Working directory</p></a></li>
<li><a href='#with_envvar'><p>Environment variables</p></a></li>
<li><a href='#with_file'><p>Files which delete themselves</p></a></li>
<li><a href='#with_gctorture2'><p>Torture Garbage Collector</p></a></li>
<li><a href='#with_language'><p>Language</p></a></li>
<li><a href='#with_libpaths'><p>Library paths</p></a></li>
<li><a href='#with_locale'><p>Locale settings</p></a></li>
<li><a href='#with_makevars'><p>Makevars variables</p></a></li>
<li><a href='#with_options'><p>Options</p></a></li>
<li><a href='#with_package'><p>Execute code with a modified search path</p></a></li>
<li><a href='#with_par'><p>Graphics parameters</p></a></li>
<li><a href='#with_path'><p>PATH environment variable</p></a></li>
<li><a href='#with_rng_version'><p>RNG version</p></a></li>
<li><a href='#with_seed'><p>Random seed</p></a></li>
<li><a href='#with_sink'><p>Output redirection</p></a></li>
<li><a href='#with_temp_libpaths'><p>Library paths</p></a></li>
<li><a href='#with_tempfile'><p>Temporary files and directories</p></a></li>
<li><a href='#with_timezone'><p>Time zone</p></a></li>
<li><a href='#withr'><p>Execute code in temporarily altered environment</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Run Code 'With' Temporarily Modified Global State</td>
</tr>
<tr>
<td>Version:</td>
<td>3.0.0</td>
</tr>
<tr>
<td>Description:</td>
<td>A set of functions to run code 'with' safely and
    temporarily modified global state. Many of these functions were
    originally a part of the 'devtools' package, this provides a simple
    package with limited dependencies to provide access to these
    functions.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://withr.r-lib.org">https://withr.r-lib.org</a>, <a href="https://github.com/r-lib/withr#readme">https://github.com/r-lib/withr#readme</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/r-lib/withr/issues">https://github.com/r-lib/withr/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>graphics, grDevices,</td>
</tr>
<tr>
<td>Suggests:</td>
<td>callr, covr, DBI, knitr, lattice, methods, rlang, rmarkdown
(&ge; 2.12), RSQLite, testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.0.9000</td>
</tr>
<tr>
<td>Collate:</td>
<td>'aaa.R' 'collate.R' 'connection.R' 'db.R' 'defer-exit.R'
'standalone-defer.R' 'defer.R' 'wrap.R' 'local_.R' 'with_.R'
'devices.R' 'dir.R' 'env.R' 'file.R' 'language.R' 'libpaths.R'
'locale.R' 'makevars.R' 'namespace.R' 'options.R' 'par.R'
'path.R' 'rng.R' 'seed.R' 'sink.R' 'tempfile.R' 'timezone.R'
'torture.R' 'utils.R' 'with.R'</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Config/Needs/website:</td>
<td>tidyverse/tidytemplate</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-01-16 10:22:29 UTC; lionel</td>
</tr>
<tr>
<td>Author:</td>
<td>Jim Hester [aut],
  Lionel Henry [aut, cre],
  Kirill MÃ¼ller [aut],
  Kevin Ushey [aut],
  Hadley Wickham [aut],
  Winston Chang [aut],
  Jennifer Bryan [ctb],
  Richard Cotton [ctb],
  Posit Software, PBC [cph, fnd]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Lionel Henry &lt;lionel@posit.co&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-01-16 14:20:02 UTC</td>
</tr>
<tr>
<td>Built:</td>
<td>R 4.4.0; ; 2024-02-12 05:22:34 UTC; unix</td>
</tr>
</table>
<hr>
<h2 id='defer'>Defer Evaluation of an Expression</h2><span id='topic+defer'></span><span id='topic+defer_parent'></span><span id='topic+deferred_run'></span><span id='topic+deferred_clear'></span>

<h3>Description</h3>

<p>Similar to <code><a href="base.html#topic+on.exit">on.exit()</a></code>, but allows one to attach
an expression to be evaluated when exiting any frame currently
on the stack. This provides a nice mechanism for scoping side
effects for the duration of a function's execution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>defer(expr, envir = parent.frame(), priority = c("first", "last"))

defer_parent(expr, priority = c("first", "last"))

deferred_run(envir = parent.frame())

deferred_clear(envir = parent.frame())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="defer_+3A_expr">expr</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[expression]&#8288;</code><br /> An expression to be evaluated.</p>
</td></tr>
<tr><td><code id="defer_+3A_envir">envir</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[environment]&#8288;</code><br /> Attach exit handlers to this environment.
Typically, this should be either the current environment or
a parent frame (accessed through <code><a href="base.html#topic+parent.frame">parent.frame()</a></code>).</p>
</td></tr>
<tr><td><code id="defer_+3A_priority">priority</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[character(1)]&#8288;</code><br /> Specify whether this handler should
be executed <code>"first"</code> or <code>"last"</code>, relative to any other
registered handlers on this environment.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>defer()</code> works by attaching handlers to the requested environment (as an
attribute called <code>"handlers"</code>), and registering an exit handler that
executes the registered handler when the function associated with the
requested environment finishes execution.
</p>
<p>Deferred events can be set on the global environment, primarily to facilitate
the interactive development of code that is intended to be executed inside a
function or test. A message alerts the user to the fact that an explicit
<code>deferred_run()</code> is the only way to trigger these deferred events. Use
<code>deferred_clear()</code> to clear them without evaluation. The global environment
scenario is the main motivation for these functions.
</p>


<h3>Running handlers within <code>source()</code></h3>

<p>withr handlers run within <code>source()</code> are run when <code>source()</code> exits
rather than line by line.
</p>
<p>This is only the case when the script is sourced in <code>globalenv()</code>.
For a local environment, the caller needs to set
<code>options(withr.hook_source = TRUE)</code>. This is to avoid paying the
penalty of detecting <code>source()</code> in the normal usage of <code>defer()</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># define a 'local' function that creates a file, and
# removes it when the parent function has finished executing
local_file &lt;- function(path) {
  file.create(path)
  defer_parent(unlink(path))
}

# create tempfile path
path &lt;- tempfile()

# use 'local_file' in a function
local({
  local_file(path)
  stopifnot(file.exists(path))
})

# file is deleted as we leave 'local' local
stopifnot(!file.exists(path))

# investigate how 'defer' modifies the
# executing function's environment
local({
  local_file(path)
  print(attributes(environment()))
})

# Note that examples lack function scoping so deferred calls are
# generally executed immediately
defer(print("one"))
defer(print("two"))
</code></pre>

<hr>
<h2 id='devices'>Graphics devices</h2><span id='topic+devices'></span><span id='topic+with_dev'></span><span id='topic+with_device'></span><span id='topic+with_bmp'></span><span id='topic+local_bmp'></span><span id='topic+with_cairo_pdf'></span><span id='topic+local_cairo_pdf'></span><span id='topic+with_cairo_ps'></span><span id='topic+local_cairo_ps'></span><span id='topic+with_pdf'></span><span id='topic+local_pdf'></span><span id='topic+with_postscript'></span><span id='topic+local_postscript'></span><span id='topic+with_svg'></span><span id='topic+local_svg'></span><span id='topic+with_tiff'></span><span id='topic+local_tiff'></span><span id='topic+with_xfig'></span><span id='topic+local_xfig'></span><span id='topic+with_png'></span><span id='topic+local_png'></span><span id='topic+with_jpeg'></span><span id='topic+local_jpeg'></span>

<h3>Description</h3>

<p>Temporarily use a graphics device.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_bmp(new, code, ...)

local_bmp(new = list(), ..., .local_envir = parent.frame())

with_cairo_pdf(new, code, ...)

local_cairo_pdf(new = list(), ..., .local_envir = parent.frame())

with_cairo_ps(new, code, ...)

local_cairo_ps(new = list(), ..., .local_envir = parent.frame())

with_pdf(
  new,
  code,
  width,
  height,
  onefile,
  family,
  title,
  fonts,
  version,
  paper,
  encoding,
  bg,
  fg,
  pointsize,
  pagecentre,
  colormodel,
  useDingbats,
  useKerning,
  fillOddEven,
  compress
)

local_pdf(
  new = list(),
  width,
  height,
  onefile,
  family,
  title,
  fonts,
  version,
  paper,
  encoding,
  bg,
  fg,
  pointsize,
  pagecentre,
  colormodel,
  useDingbats,
  useKerning,
  fillOddEven,
  compress,
  .local_envir = parent.frame()
)

with_postscript(
  new,
  code,
  onefile,
  family,
  title,
  fonts,
  encoding,
  bg,
  fg,
  width,
  height,
  horizontal,
  pointsize,
  paper,
  pagecentre,
  print.it,
  command,
  colormodel,
  useKerning,
  fillOddEven
)

local_postscript(
  new = list(),
  onefile,
  family,
  title,
  fonts,
  encoding,
  bg,
  fg,
  width,
  height,
  horizontal,
  pointsize,
  paper,
  pagecentre,
  print.it,
  command,
  colormodel,
  useKerning,
  fillOddEven,
  .local_envir = parent.frame()
)

with_svg(
  new,
  code,
  width = 7,
  height = 7,
  pointsize = 12,
  onefile = FALSE,
  family = "sans",
  bg = "white",
  antialias = c("default", "none", "gray", "subpixel"),
  ...
)

local_svg(
  new = list(),
  width = 7,
  height = 7,
  pointsize = 12,
  onefile = FALSE,
  family = "sans",
  bg = "white",
  antialias = c("default", "none", "gray", "subpixel"),
  ...,
  .local_envir = parent.frame()
)

with_tiff(new, code, ...)

local_tiff(new = list(), ..., .local_envir = parent.frame())

with_xfig(
  new,
  code,
  onefile = FALSE,
  encoding = "none",
  paper = "default",
  horizontal = TRUE,
  width = 0,
  height = 0,
  family = "Helvetica",
  pointsize = 12,
  bg = "transparent",
  fg = "black",
  pagecentre = TRUE,
  defaultfont = FALSE,
  textspecial = FALSE
)

local_xfig(
  new = list(),
  onefile = FALSE,
  encoding = "none",
  paper = "default",
  horizontal = TRUE,
  width = 0,
  height = 0,
  family = "Helvetica",
  pointsize = 12,
  bg = "transparent",
  fg = "black",
  pagecentre = TRUE,
  defaultfont = FALSE,
  textspecial = FALSE,
  .local_envir = parent.frame()
)

with_png(new, code, ...)

local_png(new = list(), ..., .local_envir = parent.frame())

with_jpeg(new, code, ...)

local_jpeg(new = list(), ..., .local_envir = parent.frame())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="devices_+3A_new">new</code></td>
<td>
<p><code>[named character]</code><br /> New graphics device</p>
</td></tr>
<tr><td><code id="devices_+3A_code">code</code></td>
<td>
<p><code>[any]</code><br /> Code to execute in the temporary environment</p>
</td></tr>
<tr><td><code id="devices_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to the graphics device.</p>
</td></tr>
<tr><td><code id="devices_+3A_.local_envir">.local_envir</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[environment]&#8288;</code><br /> The environment to use for scoping.</p>
</td></tr>
<tr><td><code id="devices_+3A_width">width</code></td>
<td>
<p>the width of the device in inches.</p>
</td></tr>
<tr><td><code id="devices_+3A_height">height</code></td>
<td>
<p>the height of the device in inches.</p>
</td></tr>
<tr><td><code id="devices_+3A_onefile">onefile</code></td>
<td>
<p>should all plots appear in one file or in separate files?</p>
</td></tr>
<tr><td><code id="devices_+3A_family">family</code></td>
<td>
<p>one of the device-independent font families,
<code>"sans"</code>, <code>"serif"</code> and <code>"mono"</code>, or a character
string specify a font family to be searched for in a
system-dependent way.
</p>
<p>On unix-alikes (incl.\ Mac), see
the &lsquo;Cairo fonts&rsquo; section in the help for <code><a href="grDevices.html#topic+X11">X11</a></code>.
</p>
</td></tr>
<tr><td><code id="devices_+3A_title">title</code></td>
<td>
<p>title string to embed as the &lsquo;<span class="samp">&#8288;/Title&#8288;</span>&rsquo; field in the
file.  Defaults to <code>"R Graphics Output"</code>.</p>
</td></tr>
<tr><td><code id="devices_+3A_fonts">fonts</code></td>
<td>
<p>a character vector specifying <span class="rlang"><b>R</b></span> graphics font family
names for additional fonts which will be included in the PDF file.
Defaults to <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="devices_+3A_version">version</code></td>
<td>
<p>a string describing the PDF version that will be
required to view the output.  This is a minimum, and will be
increased (with a warning) if necessary.  Defaults to <code>"1.4"</code>,
but see &lsquo;Details&rsquo;.</p>
</td></tr>
<tr><td><code id="devices_+3A_paper">paper</code></td>
<td>
<p>the target paper size.  The choices are
<code>"a4"</code>, <code>"letter"</code>, <code>"legal"</code> (or <code>"us"</code>) and
<code>"executive"</code> (and these can be capitalized), or <code>"a4r"</code>
and <code>"USr"</code> for rotated (&lsquo;landscape&rsquo;).
The default is <code>"special"</code>, which means that the <code>width</code>
and <code>height</code> specify the paper size.  A further choice is
<code>"default"</code>; if this is selected, the
papersize is taken from the option <code>"papersize"</code>
if that is set and as <code>"a4"</code> if it is unset or empty.
Defaults to <code>"special"</code>.
</p>
</td></tr>
<tr><td><code id="devices_+3A_encoding">encoding</code></td>
<td>
<p>the name of an encoding file.  See
<code><a href="grDevices.html#topic+postscript">postscript</a></code> for details.  Defaults to <code>"default"</code>.</p>
</td></tr>
<tr><td><code id="devices_+3A_bg">bg</code></td>
<td>
<p>the initial background colour: can be overridden by setting
par(&quot;bg&quot;).</p>
</td></tr>
<tr><td><code id="devices_+3A_fg">fg</code></td>
<td>
<p>the initial foreground color to be used.  Defaults to
<code>"black"</code>.</p>
</td></tr>
<tr><td><code id="devices_+3A_pointsize">pointsize</code></td>
<td>
<p>the default pointsize of plotted text (in big points).</p>
</td></tr>
<tr><td><code id="devices_+3A_pagecentre">pagecentre</code></td>
<td>
<p>logical: should the device region be centred on the
page? &ndash; is only relevant for <code>paper != "special"</code>.
Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="devices_+3A_colormodel">colormodel</code></td>
<td>
<p>a character string describing the color model:
currently allowed values are <code>"srgb"</code>, <code>"gray"</code> (or
<code>"grey"</code>) and <code>"cmyk"</code>.  Defaults to <code>"srgb"</code>.  See section
&lsquo;Color models&rsquo;.</p>
</td></tr>
<tr><td><code id="devices_+3A_usedingbats">useDingbats</code></td>
<td>
<p>logical.  Should small circles be rendered
<em>via</em> the Dingbats font?  Defaults to <code>FALSE</code>.
If <code>TRUE</code>, this can produce smaller and better output, but
there can font display problems in broken PDF viewers: although this
font is one of the 14 guaranteed to be available in all PDF viewers,
that guarantee is not always honoured.
</p>
<p>For Unix-alikes (including macOS) see the &lsquo;Note&rsquo; for a
possible fix for some viewers.</p>
</td></tr>
<tr><td><code id="devices_+3A_usekerning">useKerning</code></td>
<td>
<p>logical.  Should kerning corrections be included in
setting text and calculating string widths?  Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="devices_+3A_filloddeven">fillOddEven</code></td>
<td>
<p>logical controlling the polygon fill mode:  see
<code><a href="graphics.html#topic+polygon">polygon</a></code> for details.  Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="devices_+3A_compress">compress</code></td>
<td>
<p>logical.  Should PDF streams be generated with Flate
compression?  Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="devices_+3A_horizontal">horizontal</code></td>
<td>
<p>the orientation of the printed image, a logical.
Defaults to true, that is landscape orientation on paper sizes
with width less than height.</p>
</td></tr>
<tr><td><code id="devices_+3A_print.it">print.it</code></td>
<td>
<p>logical: should the file be printed when the device is
closed?  (This only applies if <code>file</code> is a real file name.)
Defaults to false.</p>
</td></tr>
<tr><td><code id="devices_+3A_command">command</code></td>
<td>
<p>the command to be used for &lsquo;printing&rsquo;. Defaults
to <code>"default"</code>, the value of option <code>"printcmd"</code>. The
length limit is <code>2*PATH_MAX</code>, typically 8096 bytes on unix systems and
520 bytes on windows.</p>
</td></tr>
<tr><td><code id="devices_+3A_antialias">antialias</code></td>
<td>
<p>string, the type of anti-aliasing (if any) to be used;
defaults to <code>"default"</code>.</p>
</td></tr>
<tr><td><code id="devices_+3A_defaultfont">defaultfont</code></td>
<td>
<p>logical: should the device use xfig's default
font?</p>
</td></tr>
<tr><td><code id="devices_+3A_textspecial">textspecial</code></td>
<td>
<p>logical: should the device set the textspecial flag
for all text elements. This is useful when generating pstex from xfig
figures.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>[any]</code><br /> The results of the evaluation of the <code>code</code>
argument.
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>with_bmp()</code>: BMP device
</p>
</li>
<li> <p><code>with_cairo_pdf()</code>: CAIRO_PDF device
</p>
</li>
<li> <p><code>with_cairo_ps()</code>: CAIRO_PS device
</p>
</li>
<li> <p><code>with_pdf()</code>: PDF device
</p>
</li>
<li> <p><code>with_postscript()</code>: POSTSCRIPT device
</p>
</li>
<li> <p><code>with_svg()</code>: SVG device
</p>
</li>
<li> <p><code>with_tiff()</code>: TIFF device
</p>
</li>
<li> <p><code>with_xfig()</code>: XFIG device
</p>
</li>
<li> <p><code>with_png()</code>: PNG device
</p>
</li>
<li> <p><code>with_jpeg()</code>: JPEG device
</p>
</li></ul>


<h3>See Also</h3>

<p><code><a href="withr.html#topic+withr">withr</a></code> for examples
</p>
<p><code><a href="grDevices.html#topic+Devices">Devices</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># dimensions are in inches
with_pdf(file.path(tempdir(), "test.pdf"), width = 7, height = 5,
  plot(runif(5))
)

# dimensions are in pixels
with_png(file.path(tempdir(), "test.png"), width = 800, height = 600,
  plot(runif(5))
)
</code></pre>

<hr>
<h2 id='global_defer'>Defer expression globally</h2><span id='topic+global_defer'></span>

<h3>Description</h3>

<p>This function is mostly internal. It is exported to be called in
standalone <code>defer()</code> implementations to defer expressions from the
global environment.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>global_defer(expr, priority = c("first", "last"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="global_defer_+3A_expr">expr</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[expression]&#8288;</code><br /> An expression to be evaluated.</p>
</td></tr>
<tr><td><code id="global_defer_+3A_priority">priority</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[character(1)]&#8288;</code><br /> Specify whether this handler should
be executed <code>"first"</code> or <code>"last"</code>, relative to any other
registered handlers on this environment.</p>
</td></tr>
</table>

<hr>
<h2 id='local_'>Create a new &quot;with&quot; or &quot;local&quot; function</h2><span id='topic+local_'></span><span id='topic+with_'></span>

<h3>Description</h3>

<p>These are constructors for <code>with_...</code> or <code>local_...</code> functions.
They are only needed if you want to alter some global state which is not
covered by the existing <code>with_...</code> functions, see <a href="withr.html#topic+withr">withr</a>
for an overview.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>local_(
  set,
  reset = set,
  get = NULL,
  ...,
  envir = parent.frame(),
  new = TRUE,
  dots = FALSE
)

with_(set, reset = set, get = NULL, ..., envir = parent.frame(), new = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="local__+3A_set">set</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[function(...)]&#8288;</code><br /> Function used to set the state.
The return value from this function should be the old state, which will
then be passed back into the <code>reset()</code> function to clean up the state.
The function can have arbitrarily many arguments, they will be replicated
in the formals of the returned function.</p>
</td></tr>
<tr><td><code id="local__+3A_reset">reset</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[function(x)]&#8288;</code><br /> Function used to reset the state.
The first argument can be named arbitrarily, further arguments with default
values, or a &quot;dots&quot; argument, are supported but not used: The function will
be called as <code>reset(old)</code>.</p>
</td></tr>
<tr><td><code id="local__+3A_get">get</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[function(...)]&#8288;</code><br /> Optionally, a getter function. If
supplied, the <code>on.exit()</code> restoration is set up <em>before</em> calling
<code>set</code>. This is more robust in edge cases.
</p>
<p>For technical reasons, this getter function must have the same
interface as <code>set</code>, which means it is passed the new values as
well. These can be safely ignored.</p>
</td></tr>
<tr><td><code id="local__+3A_...">...</code></td>
<td>
<p>These dots are for future extensions and must be empty.</p>
</td></tr>
<tr><td><code id="local__+3A_envir">envir</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[environment]&#8288;</code><br /> Environment of the returned function.</p>
</td></tr>
<tr><td><code id="local__+3A_new">new</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[logical(1)]&#8288;</code><br /> Replace the first argument of the <code>set</code> function
by <code>new</code>? Set to <code>FALSE</code> if the <code>set</code> function only has optional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>with_...</code> functions reset the state immediately after the
<code>code</code> argument has been evaluated. The <code>local_...</code> functions
reset their arguments after they go out of scope, usually at the end of the
function body.
</p>


<h3>Value</h3>

<p><code style="white-space: pre;">&#8288;[function(new, code, ...)]&#8288;</code> A function with at least two arguments,
</p>

<ul>
<li> <p><code>new</code>: New state to use
</p>
</li>
<li> <p><code>code</code>: Code to run in that state.
</p>
</li></ul>

<p>If there are more arguments to the function passed in <code>set</code> they are
added to the returned function.  If <code>set</code> does not have arguments,
or <code>new</code> is <code>FALSE</code>, the returned function does not have a <code>code</code> argument.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>with_(setwd)

global_stack &lt;- list()
set_global_state &lt;- function(state, msg = "Changing global state.") {
  global_stack &lt;- c(list(state), global_stack)
  message(msg)
  state
}
reset_global_state &lt;- function(state) {
  old_state &lt;- global_stack[[1]]
  global_stack &lt;- global_stack[-1]
  stopifnot(identical(state, old_state))
}
with_(set_global_state, reset_global_state)
</code></pre>

<hr>
<h2 id='makevars_user'>Shim for tools::makevars_user()</h2><span id='topic+makevars_user'></span>

<h3>Description</h3>

<p>Shim for tools::makevars_user()
</p>


<h3>Usage</h3>

<pre><code class='language-R'>makevars_user()
</code></pre>

<hr>
<h2 id='set_makevars'>Create a new <code>Makevars</code> file, by adding new variables</h2><span id='topic+set_makevars'></span>

<h3>Description</h3>

<p>You probably want <code><a href="withr.html#topic+with_makevars">with_makevars()</a></code> instead of this function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_makevars(
  variables,
  old_path = makevars_user(),
  new_path = tempfile(),
  assignment = c("=", ":=", "?=", "+=")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_makevars_+3A_variables">variables</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[named character]&#8288;</code><br /> new variables and their values</p>
</td></tr>
<tr><td><code id="set_makevars_+3A_old_path">old_path</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[character(1)]&#8288;</code><br /> location of existing <code>Makevars</code>
file to modify.</p>
</td></tr>
<tr><td><code id="set_makevars_+3A_new_path">new_path</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[character(1)]&#8288;</code><br /> location of the new <code>Makevars</code> file</p>
</td></tr>
<tr><td><code id="set_makevars_+3A_assignment">assignment</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[character(1)]&#8288;</code><br /> assignment type to use.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Unlike <code><a href="withr.html#topic+with_makevars">with_makevars()</a></code>, it does not activate the new <code>Makevars</code>
file, i.e. it does not set the <code>R_MAKEVARS_USER</code> environment variable.
</p>

<hr>
<h2 id='with_collate'>Collation Order</h2><span id='topic+with_collate'></span><span id='topic+local_collate'></span>

<h3>Description</h3>

<p>Temporarily change collation order by changing the value of the
<code>LC_COLLATE</code> locale.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_collate(new, code)

local_collate(new = list(), .local_envir = parent.frame())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="with_collate_+3A_new">new</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[character(1)]&#8288;</code><br /> New collation order</p>
</td></tr>
<tr><td><code id="with_collate_+3A_code">code</code></td>
<td>
<p><code>[any]</code><br /> Code to execute in the temporary environment</p>
</td></tr>
<tr><td><code id="with_collate_+3A_.local_envir">.local_envir</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[environment]&#8288;</code><br /> The environment to use for scoping.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>[any]</code><br /> The results of the evaluation of the <code>code</code>
argument.
</p>


<h3>See Also</h3>

<p><code><a href="withr.html#topic+withr">withr</a></code> for examples
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Modify collation order:
x &lt;- c("bernard", "bÃ©rÃ©nice", "bÃ©atrice", "boris")
with_collate("fr_FR", sort(x))
with_collate("C", sort(x))

</code></pre>

<hr>
<h2 id='with_connection'>Connections which close themselves</h2><span id='topic+with_connection'></span><span id='topic+local_connection'></span>

<h3>Description</h3>

<p>R file connections which are automatically closed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_connection(con, code)

local_connection(con, .local_envir = parent.frame())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="with_connection_+3A_con">con</code></td>
<td>
<p>For <code>with_connection()</code> a named list with the connection(s) to
create. For <code>local_connection()</code> the code to create a single connection,
which is then returned.</p>
</td></tr>
<tr><td><code id="with_connection_+3A_code">code</code></td>
<td>
<p><code>[any]</code><br /> Code to execute in the temporary environment</p>
</td></tr>
<tr><td><code id="with_connection_+3A_.local_envir">.local_envir</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[environment]&#8288;</code><br /> The environment to use for scoping.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>[any]</code><br /> The results of the evaluation of the <code>code</code>
argument.
</p>


<h3>See Also</h3>

<p><code><a href="withr.html#topic+withr">withr</a></code> for examples
</p>


<h3>Examples</h3>

<pre><code class='language-R'>with_connection(list(con = file("foo", "w")), {
  writeLines(c("foo", "bar"), con)
})

read_foo &lt;- function() {
  readLines(local_connection(file("foo", "r")))
}
read_foo()

unlink("foo")
</code></pre>

<hr>
<h2 id='with_db_connection'>DBMS Connections which disconnect themselves.</h2><span id='topic+with_db_connection'></span><span id='topic+local_db_connection'></span>

<h3>Description</h3>

<p>Connections to Database Management Systems which automatically disconnect. In
particular connections which are created with <code>DBI::dbConnect()</code> and closed
with <code>DBI::dbDisconnect()</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_db_connection(con, code)

local_db_connection(con, .local_envir = parent.frame())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="with_db_connection_+3A_con">con</code></td>
<td>
<p>For <code>with_db_connection()</code> a named list with the connection(s) to
create. For <code>local_db_connection()</code> the code to create a single connection,
which is then returned.</p>
</td></tr>
<tr><td><code id="with_db_connection_+3A_code">code</code></td>
<td>
<p><code>[any]</code><br /> Code to execute in the temporary environment</p>
</td></tr>
<tr><td><code id="with_db_connection_+3A_.local_envir">.local_envir</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[environment]&#8288;</code><br /> The environment to use for scoping.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>[any]</code><br /> The results of the evaluation of the <code>code</code>
argument.
</p>


<h3>See Also</h3>

<p><code><a href="withr.html#topic+withr">withr</a></code> for examples
</p>


<h3>Examples</h3>

<pre><code class='language-R'>db &lt;- tempfile()
with_db_connection(
  list(con = DBI::dbConnect(RSQLite::SQLite(), db)), {
    DBI::dbWriteTable(con, "mtcars", mtcars)
})

head_db_table &lt;- function(...) {
  con &lt;- local_db_connection(DBI::dbConnect(RSQLite::SQLite(), db))
  head(DBI::dbReadTable(con, "mtcars"), ...)
}
head_db_table()
unlink(db)
</code></pre>

<hr>
<h2 id='with_dir'>Working directory</h2><span id='topic+with_dir'></span><span id='topic+local_dir'></span>

<h3>Description</h3>

<p>Temporarily change the current working directory.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_dir(new, code)

local_dir(new = list(), .local_envir = parent.frame())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="with_dir_+3A_new">new</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[character(1)]&#8288;</code><br /> New working directory</p>
</td></tr>
<tr><td><code id="with_dir_+3A_code">code</code></td>
<td>
<p><code>[any]</code><br /> Code to execute in the temporary environment</p>
</td></tr>
<tr><td><code id="with_dir_+3A_.local_envir">.local_envir</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[environment]&#8288;</code><br /> The environment to use for scoping.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>[any]</code><br /> The results of the evaluation of the <code>code</code>
argument.
</p>


<h3>See Also</h3>

<p><code><a href="withr.html#topic+withr">withr</a></code> for examples
</p>
<p><code><a href="base.html#topic+setwd">setwd()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>getwd()

with_dir(tempdir(), getwd())
</code></pre>

<hr>
<h2 id='with_envvar'>Environment variables</h2><span id='topic+with_envvar'></span><span id='topic+local_envvar'></span>

<h3>Description</h3>

<p>Temporarily change system environment variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_envvar(new, code, action = "replace")

local_envvar(
  .new = list(),
  ...,
  action = "replace",
  .local_envir = parent.frame()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="with_envvar_+3A_new">new</code>, <code id="with_envvar_+3A_.new">.new</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[named character]&#8288;</code><br /> New environment variables</p>
</td></tr>
<tr><td><code id="with_envvar_+3A_code">code</code></td>
<td>
<p><code>[any]</code><br /> Code to execute in the temporary environment</p>
</td></tr>
<tr><td><code id="with_envvar_+3A_action">action</code></td>
<td>
<p>should new values <code>"replace"</code>, <code>"prefix"</code> or
<code>"suffix"</code> existing variables with the same name.</p>
</td></tr>
<tr><td><code id="with_envvar_+3A_...">...</code></td>
<td>
<p>Named arguments with new environment variables.</p>
</td></tr>
<tr><td><code id="with_envvar_+3A_.local_envir">.local_envir</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[environment]&#8288;</code><br /> The environment to use for scoping.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>if <code>NA</code> is used those environment variables will be unset.
If there are any duplicated variable names only the last one is used.
</p>


<h3>Value</h3>

<p><code>[any]</code><br /> The results of the evaluation of the <code>code</code>
argument.
</p>


<h3>See Also</h3>

<p><code><a href="withr.html#topic+withr">withr</a></code> for examples
</p>
<p><code><a href="base.html#topic+Sys.setenv">Sys.setenv()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>with_envvar(new = c("GITHUB_PAT" = "abcdef"), Sys.getenv("GITHUB_PAT"))

# with_envvar unsets variables after usage
Sys.getenv("TEMP_SECRET")
with_envvar(new = c("TEMP_SECRET" = "secret"), Sys.getenv("TEMP_SECRET"))
Sys.getenv("TEMP_SECRET")
</code></pre>

<hr>
<h2 id='with_file'>Files which delete themselves</h2><span id='topic+with_file'></span><span id='topic+local_file'></span>

<h3>Description</h3>

<p>Create files, which are then automatically removed afterwards.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_file(file, code)

local_file(.file, ..., .local_envir = parent.frame())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="with_file_+3A_file">file</code>, <code id="with_file_+3A_.file">.file</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[named list]&#8288;</code><br /> Files to create.</p>
</td></tr>
<tr><td><code id="with_file_+3A_code">code</code></td>
<td>
<p><code>[any]</code><br /> Code to execute in the temporary environment</p>
</td></tr>
<tr><td><code id="with_file_+3A_...">...</code></td>
<td>
<p>Additional (possibly named) arguments of files to create.</p>
</td></tr>
<tr><td><code id="with_file_+3A_.local_envir">.local_envir</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[environment]&#8288;</code><br /> The environment to use for scoping.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>[any]</code><br /> The results of the evaluation of the <code>code</code>
argument.
</p>


<h3>See Also</h3>

<p><code><a href="withr.html#topic+withr">withr</a></code> for examples
</p>


<h3>Examples</h3>

<pre><code class='language-R'>with_file("file1", {
  writeLines("foo", "file1")
  readLines("file1")
})

with_file(list("file1" = writeLines("foo", "file1")), {
  readLines("file1")
})
</code></pre>

<hr>
<h2 id='with_gctorture2'>Torture Garbage Collector</h2><span id='topic+with_gctorture2'></span>

<h3>Description</h3>

<p>Temporarily turn gctorture2 on.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_gctorture2(new, code, wait = new, inhibit_release = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="with_gctorture2_+3A_new">new</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[integer]&#8288;</code><br /> run GC every 'step' allocations.</p>
</td></tr>
<tr><td><code id="with_gctorture2_+3A_code">code</code></td>
<td>
<p><code>[any]</code><br /> Code to execute in the temporary environment</p>
</td></tr>
<tr><td><code id="with_gctorture2_+3A_wait">wait</code></td>
<td>
<p>integer; number of allocations to wait before starting
GC torture.</p>
</td></tr>
<tr><td><code id="with_gctorture2_+3A_inhibit_release">inhibit_release</code></td>
<td>
<p>logical; do not release free objects for
re-use: use with caution.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>[any]</code><br /> The results of the evaluation of the <code>code</code>
argument.
</p>


<h3>See Also</h3>

<p><code><a href="withr.html#topic+withr">withr</a></code> for examples
</p>

<hr>
<h2 id='with_language'>Language</h2><span id='topic+with_language'></span><span id='topic+local_language'></span>

<h3>Description</h3>

<p>Temporarily change the language used for translations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_language(lang, code)

local_language(lang, .local_envir = parent.frame())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="with_language_+3A_lang">lang</code></td>
<td>
<p>A BCP47 language code like &quot;en&quot; (English), &quot;fr&quot; (French),
&quot;fr_CA&quot; (French Canadian). Formally, this is a lower case two letter
<a href="https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes">ISO 639 country code</a>,
optionally followed by &quot;_&quot; or &quot;-&quot; and an upper case two letter
<a href="https://en.wikipedia.org/wiki/ISO_3166-2">ISO 3166 region code</a>.</p>
</td></tr>
<tr><td><code id="with_language_+3A_code">code</code></td>
<td>
<p><code>[any]</code><br /> Code to execute in the temporary environment</p>
</td></tr>
<tr><td><code id="with_language_+3A_.local_envir">.local_envir</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[environment]&#8288;</code><br /> The environment to use for scoping.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>with_language("en", try(mean[[1]]))
with_language("fr", try(mean[[1]]))
with_language("es", try(mean[[1]]))
</code></pre>

<hr>
<h2 id='with_libpaths'>Library paths</h2><span id='topic+with_libpaths'></span><span id='topic+local_libpaths'></span>

<h3>Description</h3>

<p>Temporarily change library paths.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_libpaths(new, code, action = "replace")

local_libpaths(new = list(), action = "replace", .local_envir = parent.frame())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="with_libpaths_+3A_new">new</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[character]&#8288;</code><br /> New library paths</p>
</td></tr>
<tr><td><code id="with_libpaths_+3A_code">code</code></td>
<td>
<p><code>[any]</code><br /> Code to execute in the temporary environment</p>
</td></tr>
<tr><td><code id="with_libpaths_+3A_action">action</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[character(1)]&#8288;</code><br /> should new values <code>"replace"</code>, <code>"prefix"</code> or
<code>"suffix"</code> existing paths.</p>
</td></tr>
<tr><td><code id="with_libpaths_+3A_.local_envir">.local_envir</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[environment]&#8288;</code><br /> The environment to use for scoping.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>[any]</code><br /> The results of the evaluation of the <code>code</code>
argument.
</p>


<h3>See Also</h3>

<p><code><a href="withr.html#topic+withr">withr</a></code> for examples
</p>
<p><code><a href="base.html#topic+.libPaths">.libPaths()</a></code>
</p>
<p>Other libpaths: 
<code><a href="withr.html#topic+with_temp_libpaths">with_temp_libpaths</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>.libPaths()
new_lib &lt;- tempfile()
dir.create(new_lib)
with_libpaths(new_lib, print(.libPaths()))
unlink(new_lib, recursive = TRUE)
</code></pre>

<hr>
<h2 id='with_locale'>Locale settings</h2><span id='topic+with_locale'></span><span id='topic+local_locale'></span>

<h3>Description</h3>

<p>Temporarily change locale settings.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_locale(new, code)

local_locale(.new = list(), ..., .local_envir = parent.frame())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="with_locale_+3A_new">new</code>, <code id="with_locale_+3A_.new">.new</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[named character]&#8288;</code><br /> New locale settings</p>
</td></tr>
<tr><td><code id="with_locale_+3A_code">code</code></td>
<td>
<p><code>[any]</code><br /> Code to execute in the temporary environment</p>
</td></tr>
<tr><td><code id="with_locale_+3A_...">...</code></td>
<td>
<p>Additional arguments with locale settings.</p>
</td></tr>
<tr><td><code id="with_locale_+3A_.local_envir">.local_envir</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[environment]&#8288;</code><br /> The environment to use for scoping.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Setting the <code>LC_ALL</code> category is currently not implemented.
</p>


<h3>Value</h3>

<p><code>[any]</code><br /> The results of the evaluation of the <code>code</code>
argument.
</p>


<h3>See Also</h3>

<p><code><a href="withr.html#topic+withr">withr</a></code> for examples
</p>
<p><code><a href="base.html#topic+Sys.setlocale">Sys.setlocale()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Change locale for time:
df &lt;- data.frame(
  stringsAsFactors = FALSE,
  date = as.Date(c("2019-01-01", "2019-02-01")),
  value = c(1, 2)
)
with_locale(new = c("LC_TIME" = "es_ES"), code = plot(df$date, df$value))
## Compare with:
#  plot(df$date, df$value)

## Month names:
with_locale(new = c("LC_TIME" = "en_GB"), format(ISOdate(2000, 1:12, 1), "%B"))
with_locale(new = c("LC_TIME" = "es_ES"), format(ISOdate(2000, 1:12, 1), "%B"))

## Change locale for currencies:
with_locale(new = c("LC_MONETARY" = "it_IT"), Sys.localeconv())
with_locale(new = c("LC_MONETARY" = "en_US"), Sys.localeconv())

## Ordering:
x &lt;- c("bernard", "bÃ©rÃ©nice", "bÃ©atrice", "boris")
with_locale(c(LC_COLLATE = "fr_FR"), sort(x))
with_locale(c(LC_COLLATE = "C"), sort(x))

</code></pre>

<hr>
<h2 id='with_makevars'>Makevars variables</h2><span id='topic+with_makevars'></span><span id='topic+local_makevars'></span>

<h3>Description</h3>

<p>Temporarily change contents of an existing <code>Makevars</code> file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_makevars(
  new,
  code,
  path = makevars_user(),
  assignment = c("=", ":=", "?=", "+=")
)

local_makevars(
  .new = list(),
  ...,
  .path = makevars_user(),
  .assignment = c("=", ":=", "?=", "+="),
  .local_envir = parent.frame()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="with_makevars_+3A_new">new</code>, <code id="with_makevars_+3A_.new">.new</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[named character]&#8288;</code><br /> New variables and their values</p>
</td></tr>
<tr><td><code id="with_makevars_+3A_code">code</code></td>
<td>
<p><code>[any]</code><br /> Code to execute in the temporary environment</p>
</td></tr>
<tr><td><code id="with_makevars_+3A_path">path</code>, <code id="with_makevars_+3A_.path">.path</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[character(1)]&#8288;</code><br /> location of existing <code>Makevars</code> file to modify.</p>
</td></tr>
<tr><td><code id="with_makevars_+3A_assignment">assignment</code>, <code id="with_makevars_+3A_.assignment">.assignment</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[character(1)]&#8288;</code><br /> assignment type to use.</p>
</td></tr>
<tr><td><code id="with_makevars_+3A_...">...</code></td>
<td>
<p>Additional new variables and their values.</p>
</td></tr>
<tr><td><code id="with_makevars_+3A_.local_envir">.local_envir</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[environment]&#8288;</code><br /> The environment to use for scoping.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If no <code>Makevars</code> file exists or the fields in <code>new</code> do
not exist in the existing <code>Makevars</code> file then the fields are added to
the new file.  Existing fields which are not included in <code>new</code> are
appended unchanged.  Fields which exist in <code>Makevars</code> and in <code>new</code>
are modified to use the value in <code>new</code>.
</p>


<h3>Value</h3>

<p><code>[any]</code><br /> The results of the evaluation of the <code>code</code>
argument.
</p>


<h3>See Also</h3>

<p><code><a href="withr.html#topic+withr">withr</a></code> for examples
</p>


<h3>Examples</h3>

<pre><code class='language-R'>writeLines("void foo(int* bar) { *bar = 1; }\n", "foo.c")
system("R CMD SHLIB --preclean -c foo.c")
with_makevars(c(CFLAGS = "-O3"), system("R CMD SHLIB --preclean -c foo.c"))
unlink(c("foo.c", "foo.so"))
</code></pre>

<hr>
<h2 id='with_options'>Options</h2><span id='topic+with_options'></span><span id='topic+local_options'></span>

<h3>Description</h3>

<p>Temporarily change global options.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_options(new, code)

local_options(.new = list(), ..., .local_envir = parent.frame())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="with_options_+3A_new">new</code>, <code id="with_options_+3A_.new">.new</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[named list]&#8288;</code><br /> New options and their values</p>
</td></tr>
<tr><td><code id="with_options_+3A_code">code</code></td>
<td>
<p><code>[any]</code><br /> Code to execute in the temporary environment</p>
</td></tr>
<tr><td><code id="with_options_+3A_...">...</code></td>
<td>
<p>Additional options and their values</p>
</td></tr>
<tr><td><code id="with_options_+3A_.local_envir">.local_envir</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[environment]&#8288;</code><br /> The environment to use for scoping.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>[any]</code><br /> The results of the evaluation of the <code>code</code>
argument.
</p>


<h3>See Also</h3>

<p><code><a href="withr.html#topic+withr">withr</a></code> for examples
</p>
<p><code><a href="base.html#topic+options">options()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># number of significant digits to print
getOption("digits")
# modify temporarily the number of significant digits to print
with_options(list(digits = 3), getOption("digits"))
with_options(list(digits = 3), print(pi))

# modify temporarily the character to be used as the decimal point
getOption("digits")
with_options(list(OutDec = ","), print(pi))

# modify temporarily multiple options
with_options(list(OutDec = ",", digits = 3), print(pi))

# modify, within the scope of the function, the number of
# significant digits to print
print_3_digits &lt;- function(x) {
  # assign 3 to the option "digits" for the rest of this function
  # after the function exits, the option will return to its previous
  # value
  local_options(list(digits = 3))
  print(x)
}

print_3_digits(pi)  # returns 3.14
print(pi)           # returns 3.141593
</code></pre>

<hr>
<h2 id='with_package'>Execute code with a modified search path</h2><span id='topic+with_package'></span><span id='topic+local_package'></span><span id='topic+with_namespace'></span><span id='topic+local_namespace'></span><span id='topic+with_environment'></span><span id='topic+local_environment'></span>

<h3>Description</h3>

<p><code>with_package()</code> attaches a package to the search path, executes the code, then
removes the package from the search path. The package namespace is <em>not</em>
unloaded however. <code>with_namespace()</code> does the same thing, but attaches the
package namespace to the search path, so all objects (even unexported ones) are also
available on the search path.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_package(
  package,
  code,
  pos = 2,
  lib.loc = NULL,
  character.only = TRUE,
  logical.return = FALSE,
  warn.conflicts = FALSE,
  quietly = TRUE,
  verbose = getOption("verbose")
)

local_package(
  package,
  pos = 2,
  lib.loc = NULL,
  character.only = TRUE,
  logical.return = FALSE,
  warn.conflicts = FALSE,
  quietly = TRUE,
  verbose = getOption("verbose"),
  .local_envir = parent.frame()
)

with_namespace(package, code, warn.conflicts = FALSE)

local_namespace(package, .local_envir = parent.frame(), warn.conflicts = FALSE)

with_environment(
  env,
  code,
  pos = 2L,
  name = format(env),
  warn.conflicts = FALSE
)

local_environment(
  env,
  pos = 2L,
  name = format(env),
  warn.conflicts = FALSE,
  .local_envir = parent.frame()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="with_package_+3A_package">package</code></td>
<td>
<p><code>[character(1)]</code><br /> package name to load.</p>
</td></tr>
<tr><td><code id="with_package_+3A_code">code</code></td>
<td>
<p><code>[any]</code><br /> Code to execute in the temporary environment</p>
</td></tr>
<tr><td><code id="with_package_+3A_pos">pos</code></td>
<td>
<p>the position on the search list at which to attach the
loaded namespace.  Can also be the name of a position on the current
search list as given by <code><a href="base.html#topic+search">search</a>()</code>.</p>
</td></tr>
<tr><td><code id="with_package_+3A_lib.loc">lib.loc</code></td>
<td>
<p>a character vector describing the location of <span class="rlang"><b>R</b></span>
library trees to search through, or <code>NULL</code>.  The default value
of <code>NULL</code> corresponds to all libraries currently known to
<code><a href="base.html#topic+.libPaths">.libPaths</a>()</code>.
Non-existent library trees are silently ignored.</p>
</td></tr>
<tr><td><code id="with_package_+3A_character.only">character.only</code></td>
<td>
<p>a logical indicating whether <code>package</code> or
<code>help</code> can be assumed to be character strings.</p>
</td></tr>
<tr><td><code id="with_package_+3A_logical.return">logical.return</code></td>
<td>
<p>logical.  If it is <code>TRUE</code>,  <code>FALSE</code> or
<code>TRUE</code> is returned to indicate success.</p>
</td></tr>
<tr><td><code id="with_package_+3A_warn.conflicts">warn.conflicts</code></td>
<td>
<p>logical.  If <code>TRUE</code>, warnings are
printed about <code><a href="base.html#topic+conflicts">conflicts</a></code> from attaching the new
package.  A conflict is a function masking a function,
or a non-function masking a non-function. The default is <code>TRUE</code>
unless specified as <code>FALSE</code> in the <code>conflicts.policy</code> option.
</p>
</td></tr>
<tr><td><code id="with_package_+3A_quietly">quietly</code></td>
<td>
<p>a logical.  If <code>TRUE</code>, no message confirming
package attaching is printed, and most often, no errors/warnings are
printed if package attaching fails.</p>
</td></tr>
<tr><td><code id="with_package_+3A_verbose">verbose</code></td>
<td>
<p>a logical.  If <code>TRUE</code>, additional diagnostics are
printed.</p>
</td></tr>
<tr><td><code id="with_package_+3A_.local_envir">.local_envir</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[environment]&#8288;</code><br /> The environment to use for scoping.</p>
</td></tr>
<tr><td><code id="with_package_+3A_env">env</code></td>
<td>
<p><code>[environment()]</code><br /> Environment to attach.</p>
</td></tr>
<tr><td><code id="with_package_+3A_name">name</code></td>
<td>
<p>name to use for the attached database. Names starting with
<code>package:</code> are reserved for <code><a href="base.html#topic+library">library</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>[any]</code><br /> The results of the evaluation of the <code>code</code>
argument.
</p>


<h3>See Also</h3>

<p><code><a href="withr.html#topic+withr">withr</a></code> for examples
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
with_package("ggplot2", {
  ggplot(mtcars) + geom_point(aes(wt, hp))
})

## End(Not run)
</code></pre>

<hr>
<h2 id='with_par'>Graphics parameters</h2><span id='topic+with_par'></span><span id='topic+local_par'></span>

<h3>Description</h3>

<p>Temporarily change graphics parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_par(new, code, no.readonly = FALSE)

local_par(
  .new = list(),
  ...,
  no.readonly = FALSE,
  .local_envir = parent.frame()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="with_par_+3A_new">new</code>, <code id="with_par_+3A_.new">.new</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[named list]&#8288;</code><br /> New graphics parameters and their values</p>
</td></tr>
<tr><td><code id="with_par_+3A_code">code</code></td>
<td>
<p><code>[any]</code><br /> Code to execute in the temporary environment</p>
</td></tr>
<tr><td><code id="with_par_+3A_no.readonly">no.readonly</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[logical(1)]&#8288;</code><br /> see <code><a href="graphics.html#topic+par">par()</a></code> documentation.</p>
</td></tr>
<tr><td><code id="with_par_+3A_...">...</code></td>
<td>
<p>Additional graphics parameters and their values.</p>
</td></tr>
<tr><td><code id="with_par_+3A_.local_envir">.local_envir</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[environment]&#8288;</code><br /> The environment to use for scoping.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>[any]</code><br /> The results of the evaluation of the <code>code</code>
argument.
</p>


<h3>See Also</h3>

<p><code><a href="withr.html#topic+withr">withr</a></code> for examples
</p>
<p><code><a href="graphics.html#topic+par">par()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>old &lt;- par("col" = "black")

# This will be in red
with_par(list(col = "red", pch = 19),
  plot(mtcars$hp, mtcars$wt)
)

# This will still be in black
plot(mtcars$hp, mtcars$wt)

par(old)
</code></pre>

<hr>
<h2 id='with_path'>PATH environment variable</h2><span id='topic+with_path'></span><span id='topic+local_path'></span>

<h3>Description</h3>

<p>Temporarily change the system search path.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_path(new, code, action = c("prefix", "suffix", "replace"))

local_path(
  new = list(),
  action = c("prefix", "suffix", "replace"),
  .local_envir = parent.frame()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="with_path_+3A_new">new</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[character]&#8288;</code><br /> New <code>PATH</code> entries</p>
</td></tr>
<tr><td><code id="with_path_+3A_code">code</code></td>
<td>
<p><code>[any]</code><br /> Code to execute in the temporary environment</p>
</td></tr>
<tr><td><code id="with_path_+3A_action">action</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[character(1)]&#8288;</code><br /> Should new values <code>"replace"</code>, <code>"prefix"</code>
(the default) or <code>"suffix"</code> existing paths</p>
</td></tr>
<tr><td><code id="with_path_+3A_.local_envir">.local_envir</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[environment]&#8288;</code><br /> The environment to use for scoping.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>[any]</code><br /> The results of the evaluation of the <code>code</code>
argument.
</p>


<h3>See Also</h3>

<p><code><a href="withr.html#topic+withr">withr</a></code> for examples
</p>
<p><code><a href="base.html#topic+Sys.setenv">Sys.setenv()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># temporarily modify the system PATH, *prefixing* the current path
with_path(getwd(), Sys.getenv("PATH"))
# temporarily modify the system PATH, *appending* to the current path
with_path(getwd(), Sys.getenv("PATH"), "suffix")
</code></pre>

<hr>
<h2 id='with_rng_version'>RNG version</h2><span id='topic+with_rng_version'></span><span id='topic+local_rng_version'></span>

<h3>Description</h3>

<p>Change the RNG version and restore it afterwards.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_rng_version(version, code)

local_rng_version(version, .local_envir = parent.frame())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="with_rng_version_+3A_version">version</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[character(1)]&#8288;</code> an R version number, e.g.
<code>"3.5.0"</code>, to switch to the RNG this version of R uses.
See <code><a href="base.html#topic+RNGversion">RNGversion()</a></code>.</p>
</td></tr>
<tr><td><code id="with_rng_version_+3A_code">code</code></td>
<td>
<p><code>[any]</code><br /> Code to execute in the temporary environment</p>
</td></tr>
<tr><td><code id="with_rng_version_+3A_.local_envir">.local_envir</code></td>
<td>
<p>The environment to apply the change to.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>with_rng_version()</code> runs the code with the specified RNG version and
resets it afterwards.
</p>
<p><code>local_rng_version()</code> changes the RNG version for the caller
execution environment.
</p>


<h3>Value</h3>

<p><code>[any]</code><br /> The results of the evaluation of the <code>code</code>
argument.
</p>


<h3>See Also</h3>

<p><code><a href="withr.html#topic+withr">withr</a></code> for examples
</p>
<p><code><a href="base.html#topic+RNGversion">RNGversion()</a></code>, <code><a href="base.html#topic+RNGkind">RNGkind()</a></code>, <code><a href="withr.html#topic+with_seed">with_seed()</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>RNGkind()
with_rng_version("3.0.0", RNGkind())
with_rng_version("1.6.0", RNGkind())

with_rng_version("3.0.0",
  with_seed(42, sample(1:100, 3)))

with_rng_version("1.6.0",
  with_seed(42, sample(1:100, 3)))

RNGkind()

fun1 &lt;- function() {
  local_rng_version("3.0.0")
  with_seed(42, sample(1:100, 3))
}

fun2 &lt;- function() {
  local_rng_version("1.6.0")
  with_seed(42, sample(1:100, 3))
}

RNGkind()
fun1()
fun2()
RNGkind()
</code></pre>

<hr>
<h2 id='with_seed'>Random seed</h2><span id='topic+with_seed'></span><span id='topic+local_seed'></span><span id='topic+with_preserve_seed'></span><span id='topic+local_preserve_seed'></span>

<h3>Description</h3>

<p><code>with_seed()</code> runs code with a specific random seed and resets it afterwards.
</p>
<p><code>with_preserve_seed()</code> runs code with the current random seed and resets it
afterwards.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_seed(
  seed,
  code,
  .rng_kind = NULL,
  .rng_normal_kind = NULL,
  .rng_sample_kind = NULL
)

local_seed(
  seed,
  .local_envir = parent.frame(),
  .rng_kind = NULL,
  .rng_normal_kind = NULL,
  .rng_sample_kind = NULL
)

with_preserve_seed(code)

local_preserve_seed(.local_envir = parent.frame())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="with_seed_+3A_seed">seed</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[integer(1)]&#8288;</code><br /> The random seed to use to evaluate the code.</p>
</td></tr>
<tr><td><code id="with_seed_+3A_code">code</code></td>
<td>
<p><code>[any]</code><br /> Code to execute in the temporary environment</p>
</td></tr>
<tr><td><code id="with_seed_+3A_.rng_kind">.rng_kind</code>, <code id="with_seed_+3A_.rng_normal_kind">.rng_normal_kind</code>, <code id="with_seed_+3A_.rng_sample_kind">.rng_sample_kind</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[character(1)]&#8288;</code><br /> Kind of RNG to use. Passed as the <code>kind</code>,
<code>normal.kind</code>, and <code>sample.kind</code> arguments of <code><a href="base.html#topic+RNGkind">RNGkind()</a></code>.</p>
</td></tr>
<tr><td><code id="with_seed_+3A_.local_envir">.local_envir</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[environment]&#8288;</code><br /> The environment to use for scoping.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>[any]</code><br /> The results of the evaluation of the <code>code</code>
argument.
</p>


<h3>See Also</h3>

<p><code><a href="withr.html#topic+withr">withr</a></code> for examples
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Same random values:
with_preserve_seed(runif(5))
with_preserve_seed(runif(5))

# Use a pseudorandom value as seed to advance the RNG and pick a different
# value for the next call:
with_seed(seed &lt;- sample.int(.Machine$integer.max, 1L), runif(5))
with_seed(seed, runif(5))
with_seed(seed &lt;- sample.int(.Machine$integer.max, 1L), runif(5))
</code></pre>

<hr>
<h2 id='with_sink'>Output redirection</h2><span id='topic+with_sink'></span><span id='topic+with_output_sink'></span><span id='topic+local_output_sink'></span><span id='topic+with_message_sink'></span><span id='topic+local_message_sink'></span>

<h3>Description</h3>

<p>Temporarily divert output to a file via <code><a href="base.html#topic+sink">sink()</a></code>.  For
sinks of type <code>message</code>, an error is raised if such a sink is already
active.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_output_sink(new, code, append = FALSE, split = FALSE)

local_output_sink(
  new = list(),
  append = FALSE,
  split = FALSE,
  .local_envir = parent.frame()
)

with_message_sink(new, code, append = FALSE)

local_message_sink(new = list(), append = FALSE, .local_envir = parent.frame())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="with_sink_+3A_new">new</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[character(1)|connection]&#8288;</code><br />
A writable <a href="base.html#topic+connection">connection</a> or a character string naming the file to write
to. Passing <code>NULL</code> will throw an error.</p>
</td></tr>
<tr><td><code id="with_sink_+3A_code">code</code></td>
<td>
<p><code>[any]</code><br /> Code to execute in the temporary environment</p>
</td></tr>
<tr><td><code id="with_sink_+3A_append">append</code></td>
<td>
<p>logical.  If <code>TRUE</code>, output will be appended to
<code>file</code>; otherwise, it will overwrite the contents of
<code>file</code>.</p>
</td></tr>
<tr><td><code id="with_sink_+3A_split">split</code></td>
<td>
<p>logical: if <code>TRUE</code>, output will be sent to the new
sink and to the current output stream, like the Unix program <code>tee</code>.</p>
</td></tr>
<tr><td><code id="with_sink_+3A_.local_envir">.local_envir</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[environment]&#8288;</code><br /> The environment to use for scoping.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>[any]</code><br /> The results of the evaluation of the <code>code</code>
argument.
</p>


<h3>See Also</h3>

<p><code><a href="withr.html#topic+withr">withr</a></code> for examples
</p>
<p><code><a href="base.html#topic+sink">sink()</a></code>
</p>

<hr>
<h2 id='with_temp_libpaths'>Library paths</h2><span id='topic+with_temp_libpaths'></span><span id='topic+local_temp_libpaths'></span>

<h3>Description</h3>

<p>Temporarily prepend a new temporary directory to the library paths.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_temp_libpaths(code, action = "prefix")

local_temp_libpaths(action = "prefix", .local_envir = parent.frame())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="with_temp_libpaths_+3A_code">code</code></td>
<td>
<p><code>[any]</code><br /> Code to execute in the temporary environment</p>
</td></tr>
<tr><td><code id="with_temp_libpaths_+3A_action">action</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[character(1)]&#8288;</code><br /> should new values <code>"replace"</code>, <code>"prefix"</code> or
<code>"suffix"</code> existing paths.</p>
</td></tr>
<tr><td><code id="with_temp_libpaths_+3A_.local_envir">.local_envir</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[environment]&#8288;</code><br /> The environment to use for scoping.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>[any]</code><br /> The results of the evaluation of the <code>code</code>
argument.
</p>


<h3>See Also</h3>

<p><code><a href="withr.html#topic+withr">withr</a></code> for examples
</p>
<p><code><a href="base.html#topic+.libPaths">.libPaths()</a></code>
</p>
<p>Other libpaths: 
<code><a href="withr.html#topic+with_libpaths">with_libpaths</a>()</code>
</p>

<hr>
<h2 id='with_tempfile'>Temporary files and directories</h2><span id='topic+with_tempfile'></span><span id='topic+local_tempfile'></span><span id='topic+with_tempdir'></span><span id='topic+local_tempdir'></span>

<h3>Description</h3>

<p>Temporarily create a file or directory, which will automatically deleted
once you're finished with it.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_tempfile(
  new,
  code,
  envir = parent.frame(),
  .local_envir = parent.frame(),
  pattern = "file",
  tmpdir = tempdir(),
  fileext = ""
)

local_tempfile(
  new = NULL,
  lines = NULL,
  envir = parent.frame(),
  .local_envir = parent.frame(),
  pattern = "file",
  tmpdir = tempdir(),
  fileext = ""
)

with_tempdir(
  code,
  clean = TRUE,
  pattern = "file",
  tmpdir = tempdir(),
  fileext = ""
)

local_tempdir(
  pattern = "file",
  tmpdir = tempdir(),
  fileext = "",
  .local_envir = parent.frame(),
  clean = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="with_tempfile_+3A_new">new</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[character vector]&#8288;</code><br /> (Deprecated for <code>local_tempfile()</code>) Names of temporary file handles to create.</p>
</td></tr>
<tr><td><code id="with_tempfile_+3A_code">code</code></td>
<td>
<p><code>[any]</code><br /> Code to execute in the temporary environment</p>
</td></tr>
<tr><td><code id="with_tempfile_+3A_envir">envir</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[environment]&#8288;</code><br /> Deprecated in favor of <code>.local_envir</code>.</p>
</td></tr>
<tr><td><code id="with_tempfile_+3A_.local_envir">.local_envir</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[environment]&#8288;</code><br /> The environment to use for scoping.</p>
</td></tr>
<tr><td><code id="with_tempfile_+3A_pattern">pattern</code></td>
<td>
<p>a non-empty character vector giving the initial part
of the name.</p>
</td></tr>
<tr><td><code id="with_tempfile_+3A_tmpdir">tmpdir</code></td>
<td>
<p>a non-empty character vector giving the directory name</p>
</td></tr>
<tr><td><code id="with_tempfile_+3A_fileext">fileext</code></td>
<td>
<p>a non-empty character vector giving the file extension</p>
</td></tr>
<tr><td><code id="with_tempfile_+3A_lines">lines</code></td>
<td>
<p>Optionally, supply a character vector of lines to be written to
<code>path</code>. This is useful if you want to seed the file with some default
content.</p>
</td></tr>
<tr><td><code id="with_tempfile_+3A_clean">clean</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[logical(1)]&#8288;</code><br /> A logical indicating if the temporary
directory should be deleted after use (<code>TRUE</code>, default) or left alone (<code>FALSE</code>).</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>[any]</code><br /> The results of the evaluation of the <code>code</code>
argument.
</p>


<h3>See Also</h3>

<p><code><a href="withr.html#topic+withr">withr</a></code> for examples
</p>


<h3>Examples</h3>

<pre><code class='language-R'># local_tempfile() is the easiest to use because it returns a path
local({
  path1 &lt;&lt;- local_tempfile(lines = c("x,y", "1,2"))
  readLines(path1)
})
# the file is deleted automatically
file.exists(path1)

# with_tempfile() is a bit trickier; the first argument gives the name
# of a variable that will contain the path:
with_tempfile("path2", {
  print(path2)
  write.csv(iris, path2)
  file.size(path2)
})

# Note that this variable is only available in the scope of with_tempfile
try(path2)
</code></pre>

<hr>
<h2 id='with_timezone'>Time zone</h2><span id='topic+with_timezone'></span><span id='topic+local_timezone'></span>

<h3>Description</h3>

<p>Change the time zone, and restore it afterwards.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_timezone(tz, code)

local_timezone(tz, .local_envir = parent.frame())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="with_timezone_+3A_tz">tz</code></td>
<td>
<p><code style="white-space: pre;">&#8288;[character(1)]&#8288;</code> a valid time zone specification, note that
time zone names might be platform dependent.</p>
</td></tr>
<tr><td><code id="with_timezone_+3A_code">code</code></td>
<td>
<p><code>[any]</code><br /> Code to execute in the temporary environment</p>
</td></tr>
<tr><td><code id="with_timezone_+3A_.local_envir">.local_envir</code></td>
<td>
<p>The environment to apply the change to.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>with_timezone()</code> runs the code with the specified time zone and
resets it afterwards.
</p>
<p><code>local_timezone()</code> changes the time zone for the caller
execution environment.
</p>


<h3>Value</h3>

<p><code>[any]</code><br /> The results of the evaluation of the <code>code</code>
argument.
</p>


<h3>See Also</h3>

<p><code><a href="withr.html#topic+withr">withr</a></code> for examples
</p>
<p><code><a href="base.html#topic+Sys.timezone">Sys.timezone()</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>Sys.time()
with_timezone("Europe/Paris", print(Sys.time()))
with_timezone("America/Los_Angeles", print(Sys.time()))

fun1 &lt;- function() {
  local_timezone("CET")
  print(Sys.time())
}

fun2 &lt;- function() {
  local_timezone("America/Los_Angeles")
  print(Sys.time())
}
Sys.time()
fun1()
fun2()
Sys.time()
</code></pre>

<hr>
<h2 id='withr'>Execute code in temporarily altered environment</h2><span id='topic+withr-package'></span><span id='topic+withr'></span>

<h3>Description</h3>

<p>All functions prefixed by <code>with_</code> work as follows. First, a particular
aspect of the global environment is modified (see below for a list).
Then, custom code (passed via the <code>code</code> argument) is executed.
Upon completion or error, the global environment is restored to the previous
state. Each <code>with_</code> function has a <code>local_</code> variant, which instead resets
the state when the current evaluation context ends (such as the end of a
function).
</p>


<h3>Arguments pattern</h3>


<table>
<tr>
 <td style="text-align: left;">
<code>new</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288;[various]&#8288;</code> </td><td style="text-align: left;"> Values for setting </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>code</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288;[any]&#8288;</code> </td><td style="text-align: left;"> Code to execute in the temporary environment </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>...</code> </td><td style="text-align: left;"> </td><td style="text-align: left;"> Further arguments </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Usage pattern</h3>

<p><code>with_...(new, code, ...)</code>
</p>


<h3>withr functions</h3>


<ul>
<li> <p><code><a href="withr.html#topic+with_collate">with_collate()</a></code>: collation order
</p>
</li>
<li> <p><code><a href="withr.html#topic+with_dir">with_dir()</a></code>: working directory
</p>
</li>
<li> <p><code><a href="withr.html#topic+with_envvar">with_envvar()</a></code>: environment variables
</p>
</li>
<li> <p><code><a href="withr.html#topic+with_libpaths">with_libpaths()</a></code>: library paths, replacing current libpaths
</p>
</li>
<li> <p><code><a href="withr.html#topic+with_locale">with_locale()</a></code>: any locale setting
</p>
</li>
<li> <p><code><a href="withr.html#topic+with_makevars">with_makevars()</a></code>: Makevars variables
</p>
</li>
<li> <p><code><a href="rlang.html#topic+with_options">with_options()</a></code>: options
</p>
</li>
<li> <p><code><a href="withr.html#topic+with_par">with_par()</a></code>: graphics parameters
</p>
</li>
<li> <p><code><a href="withr.html#topic+with_path">with_path()</a></code>: <code>PATH</code> environment variable
</p>
</li>
<li> <p><code><a href="withr.html#topic+with_sink">with_sink()</a></code>: output redirection
</p>
</li></ul>



<h3>Creating new &quot;with&quot; functions</h3>

<p>All <code>with_</code> functions are created by a helper function,
<code><a href="withr.html#topic+with_">with_()</a></code>.  This functions accepts two arguments:
a setter function and an optional resetter function.  The setter function is
expected to change the global state and return an &quot;undo instruction&quot;.
This undo instruction is then passed to the resetter function, which changes
back the global state. In many cases, the setter function can be used
naturally as resetter.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Lionel Henry <a href="mailto:lionel@posit.co">lionel@posit.co</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> Jim Hester
</p>
</li>
<li><p> Kirill MÃ¼ller <a href="mailto:krlmlr+r@mailbox.org">krlmlr+r@mailbox.org</a>
</p>
</li>
<li><p> Kevin Ushey <a href="mailto:kevinushey@gmail.com">kevinushey@gmail.com</a>
</p>
</li>
<li><p> Hadley Wickham <a href="mailto:hadley@posit.co">hadley@posit.co</a>
</p>
</li>
<li><p> Winston Chang
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> Jennifer Bryan [contributor]
</p>
</li>
<li><p> Richard Cotton [contributor]
</p>
</li>
<li><p> Posit Software, PBC [copyright holder, funder]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://withr.r-lib.org">https://withr.r-lib.org</a>
</p>
</li>
<li> <p><a href="https://github.com/r-lib/withr#readme">https://github.com/r-lib/withr#readme</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/r-lib/withr/issues">https://github.com/r-lib/withr/issues</a>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>getwd()
with_dir(tempdir(), getwd())
getwd()

Sys.getenv("WITHR")
with_envvar(c("WITHR" = 2), Sys.getenv("WITHR"))
Sys.getenv("WITHR")

with_envvar(c("A" = 1),
  with_envvar(c("A" = 2), action = "suffix", Sys.getenv("A"))
)

# local variants are best used within other functions
f &lt;- function(x) {
  local_envvar(c("WITHR" = 2))
  Sys.getenv("WITHR")
}
Sys.getenv("WITHR")
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
