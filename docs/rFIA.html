<!DOCTYPE html><html lang="en"><head><title>Help for package rFIA</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {rFIA}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#area'><p>Estimate forest land area from FIADB</p></a></li>
<li><a href='#areaChange'><p>Estimate land area change from the FIADB</p></a></li>
<li><a href='#biomass'><p>Estimate tree biomass and carbon stocks from the FIADB</p></a></li>
<li><a href='#carbon'><p>Estimate carbon stocks by IPCC forest carbon pools from the FIADB</p></a></li>
<li><a href='#clipFIA'><p>Spatial and temporal queries for FIADB</p></a></li>
<li><a href='#countiesRI'><p>County boundaries of Rhode Island</p></a></li>
<li><a href='#customPSE'><p>Post-stratified estimator for custom variables in FIA Data</p></a></li>
<li><a href='#diversity'><p>Estimate diversity from FIADB</p></a></li>
<li><a href='#dwm'><p>Estimate volume, biomass, and carbon stocks of down woody material (fuels) from FIADB</p></a></li>
<li><a href='#fiaRI'><p>FIADB for Rhode Island 2013 - 2018</p></a></li>
<li><a href='#findEVALID'><p>Find EVALIDs used in the FIADB</p></a></li>
<li><a href='#fsi'><p>Estimate the Forest Stability Index from the FIADB</p></a></li>
<li><a href='#getDesignInfo'><p>Extract design features for FIA inventories</p></a></li>
<li><a href='#getFIA'><p>Download FIA Data and Load into R</p></a></li>
<li><a href='#growMort'><p>Estimate growth, recruitment, mortality, and harvest rates from FIADB</p></a></li>
<li><a href='#intersectFIA'><p>Intersect FIA data with spatial polygons</p></a></li>
<li><a href='#invasive'><p>Estimate invasive species coverage from FIADB</p></a></li>
<li><a href='#makeClasses'><p>Convert numeric variables to class intervals (factor)</p></a></li>
<li><a href='#plotFIA'><p>Static and animated plots of FIA summaries</p></a></li>
<li><a href='#readFIA'><p>Load FIA database into R environment from local directory</p></a></li>
<li><a href='#seedling'><p>Estimate seedling abundance per acre from FIADB</p></a></li>
<li><a href='#standStruct'><p>Estimate forest structural stage distribution from FIADB</p></a></li>
<li><a href='#tpa'><p>Estimate trees per acre and basal area per acre from FIADB</p></a></li>
<li><a href='#vegStruct'><p>Estimate vegation cover by canopy layer from FIADB</p></a></li>
<li><a href='#vitalRates'><p>Estimate tree growth rates from FIADB</p></a></li>
<li><a href='#volume'><p>Estimate merchantable tree volume from the FIADB</p></a></li>
<li><a href='#writeFIA'><p>Write FIA tables to local directory</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Estimation of Forest Variables using the FIA Database</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1.1</td>
</tr>
<tr>
<td>Author:</td>
<td>Jeffrey Doser [aut, cre],
  Hunter Stanke [aut],
  Andrew Finley [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jeffrey Doser &lt;jwdoser@ncsu.edu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>The goal of 'rFIA' is to increase the accessibility and use of the United States Forest Services (USFS) Forest Inventory and Analysis (FIA) Database by providing a user-friendly, open source toolkit to easily query and analyze FIA Data. Designed to accommodate a wide range of potential user objectives, 'rFIA' simplifies the estimation of forest variables from the FIA Database and allows all R users (experts and newcomers alike) to unlock the flexibility inherent to the Enhanced FIA design. Specifically, 'rFIA' improves accessibility to the spatial-temporal estimation capacity of the FIA Database by producing space-time indexed summaries of forest variables within user-defined population boundaries. Direct integration with other popular R packages (e.g., 'dplyr', 'tidyr', and 'sf') facilitates efficient space-time query and data summary, and supports common data representations and API design. The package implements design-based estimation procedures outlined by Bechtold &amp; Patterson (2005) &lt;<a href="https://doi.org/10.2737%2FSRS-GTR-80">doi:10.2737/SRS-GTR-80</a>&gt;, and has been validated against estimates and sampling errors produced by FIA 'EVALIDator'. Current development is focused on the implementation of spatially-enabled model-assisted and model-based estimators to improve population, change, and ratio estimates.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.1.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr (&ge; 1.0.0), dtplyr (&ge; 1.0.0), tidyr (&ge; 1.0.0),
stringr, sf, parallel, methods, data.table, bit64, tidyselect
(&ge; 1.0.0), rlang, ggplot2</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, gganimate, R2jags, coda, testthat</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.2</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/doserjef/rFIA">https://github.com/doserjef/rFIA</a>,
<a href="https://www.doserlab.com/files/rFIA">https://www.doserlab.com/files/rFIA</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/doserjef/rFIA/issues">https://github.com/doserjef/rFIA/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-03-07 20:00:17 UTC; jeff</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-03-10 15:20:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='area'>Estimate forest land area from FIADB</h2><span id='topic+area'></span>

<h3>Description</h3>

<p>Produces estimates of total forest area (acreage) from FIA data. Estimates can be produced for regions defined within the FIA Database (e.g. counties), at the plot level, or within user-defined areal units. Options to group estimates by variables defined in the FIADB. If multiple reporting years (EVALIDs) are included in the data, estimates will be output as a time series. If multiple states are represented by the data, estimates will be output for the full region (all area combined), unless specified otherwise (e.g. grpBy = STATECD). </p>


<h3>Usage</h3>

<pre><code class='language-R'>area(db, grpBy = NULL, polys = NULL, returnSpatial = FALSE,
     byLandType = FALSE, landType = 'forest',  method = 'TI',
     lambda = 0.5, treeDomain = NULL, areaDomain = NULL,
     totals = TRUE, variance = FALSE, byPlot = FALSE,
     condList = FALSE, nCores = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="area_+3A_db">db</code></td>
<td>
<p><code>FIA.Database</code> or <code>Remote.FIA.Database</code> object produced from <code>readFIA()</code> or <code>getFIA()</code>. If a <code>Remote.FIA.Database</code>, data will be read in and processed state-by-state to conserve RAM (see details for an example).</p>
</td></tr>
<tr><td><code id="area_+3A_grpby">grpBy</code></td>
<td>
<p>variables from PLOT, COND, or TREE tables to group estimates by (NOT quoted). Multiple grouping variables should be combined with <code>c()</code>, and grouping will occur heirarchically. For example, to produce seperate estimates for each ownership group within methods of stand regeneration, specify <code>c(STDORGCD, OWNGRPCD)</code>.</p>
</td></tr>
<tr><td><code id="area_+3A_polys">polys</code></td>
<td>
<p><code>sp</code> or <code>sf</code> Polygon/MultiPolgyon object; Areal units to bin data for estimation. Separate estimates will be produced for regions encompassed by each areal unit. FIA plot locations will be reprojected to match projection of <code>polys</code> object.</p>
</td></tr>
<tr><td><code id="area_+3A_returnspatial">returnSpatial</code></td>
<td>
<p>logical; if TRUE, merge population estimates with <code>polys</code> and return as <code>sf</code> multipolygon object. When <code>byPlot = TRUE</code>, return plot-level estimates as <code>sf</code> spatial points.</p>
</td></tr>
<tr><td><code id="area_+3A_bylandtype">byLandType</code></td>
<td>
<p>logical; if TRUE, return estimates grouped by individual land type classes (&quot;timberland&quot;, &quot;non-timberland forest&quot;, &quot;non-forest&quot;, and &quot;water&quot;).</p>
</td></tr>
<tr><td><code id="area_+3A_landtype">landType</code></td>
<td>
<p>character, one of: &quot;forest&quot;, &quot;timber&quot;, &quot;non-forest&quot;, &quot;water&quot;, or &quot;all&quot;; Type of land that estimates will be produced for. Timberland is a subset of forestland (default) which has high site potential and non-reserve status (see details).</p>
</td></tr>
<tr><td><code id="area_+3A_method">method</code></td>
<td>
<p>character; design-based estimator to use. One of:  &quot;TI&quot; (temporally indifferent, default), &quot;annual&quot; (annual), &quot;SMA&quot; (simple moving average), &quot;LMA&quot; (linear moving average), or &quot;EMA&quot; (exponential moving average). See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators.</p>
</td></tr>
<tr><td><code id="area_+3A_lambda">lambda</code></td>
<td>
<p>numeric (0,1); if <code>method = 'EMA'</code>, the decay parameter used to define weighting scheme for annual panels. Low values place higher weight on more recent panels, and vice versa. Specify a vector of values to compute estimates using mulitple wieghting schemes, and use <code>plotFIA</code> with <code>grp</code> set to <code>lambda</code> to produce moving average ribbon plots. See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for examples.</p>
</td></tr>
<tr><td><code id="area_+3A_treedomain">treeDomain</code></td>
<td>
<p>logical predicates defined in terms of the variables in PLOT, TREE, and/or COND tables. Used to define the type of trees for which estimates will be produced (e.g. DBH greater than 20 inches: <code>DIA &gt; 20</code>, Dominant/Co-dominant crowns only: <code>CCLCD %in% 2:3</code>. Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only plots with at least one tree where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="area_+3A_areadomain">areaDomain</code></td>
<td>
<p>logical predicates defined in terms of the variables in PLOT and/or COND tables. Used to define the area for which estimates will be produced (e.g. within 1 mile of improved road: <code>RDDISTCD %in% 1:6</code>, Hard maple/basswood forest type: <code>FORTYPCD == 805</code>. Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only plots within areas where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="area_+3A_totals">totals</code></td>
<td>
<p>logical; if TRUE, return total population estimates (e.g. total area) along with ratio estimates (e.g. mean trees per acre).</p>
</td></tr>
<tr><td><code id="area_+3A_variance">variance</code></td>
<td>
<p>logical; if TRUE, return estimated variance (<code>VAR</code>) and sample size (<code>N</code>). If FALSE, return 'sampling error' (<code>SE</code>) as returned by EVALIDator. Note: sampling error cannot be used to construct confidence intervals.</p>
</td></tr>
<tr><td><code id="area_+3A_byplot">byPlot</code></td>
<td>
<p>logical; if TRUE, returns estimates for individual plot locations instead of population estimates.</p>
</td></tr>
<tr><td><code id="area_+3A_condlist">condList</code></td>
<td>
<p>logical; if TRUE, returns condition-level summaries intended for subsequent use with <code>customPSE()</code>.</p>
</td></tr>
<tr><td><code id="area_+3A_ncores">nCores</code></td>
<td>
<p>numeric; number of cores to use for parallel implementation. Check available cores using <code><a href="parallel.html#topic+detectCores">detectCores</a></code>. Default = 1, serial processing.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Estimation Details</strong>
</p>
<p>Estimation of forest variables follows the procedures documented in Bechtold and Patterson (2005) and <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a>. Area percentages in the domain of interest are represented as the total number of forest plots containing trees of a particular type (live, white pine) / total number of forest plots within the region and area domain. The total populations (e.g., the denominator of the ratio estimate) used to compute these percentages will not change by changing treeDomain. Instead, specifying treeDomain will change the specific plots used to determine the total area (e.g., the numerator of the ratio estimate) that meets the given tree requirements. The total population will change if the user specifies an areaDomain or if changing landType.  
</p>
<p>Note that when using <code>grpBy</code> with a tree-level parameter (e.g., SPCD), the total area across all groups will NOT be equal to the total area of the given land type. This is because the groups are not mutually exclusive (e.g., a plot can contain more than one species and thus be counted in the area calculations for multiple SPCDs). If specifying <code>grpBy</code> with a PLOT or COND level variable (e.g., forest type [FORTYPCD]), the groups are mutually exclusive and the area across all groups will sum to the total area of the given land type. When specifying <code>grpBy</code> or <code>treeDomain</code>, percentages are calculated relative to the total amount of land area specified by <code>landType</code>. For example, if setting <code>treeDomain = SPCD == 121</code> and <code>landType = 'forest'</code>, the area percentage returned will represent the estimated percentage of forest land that contains at least one longleaf pine (<code>SPCD == 121</code>) tree.   
</p>
<p>Users may specify alternatives to the 'Temporally Indifferent' estimator using the <code>method</code> argument. Alternative design-based estimators include the annual estimator (&quot;ANNUAL&quot;; annual panels, or estimates from plots measured in the same year), simple moving average (&quot;SMA&quot;; combines annual panels with equal weight), linear moving average (&quot;LMA&quot;; combine annual panels with weights that decay <em>linearly</em> with time since measurement), and exponential moving average (&quot;EMA&quot;; combine annual panels with weights that decay <em>exponentially</em> with time since measurement). The &quot;best&quot; estimator depends entirely on user-objectives, see <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators and tradeoffs between precision and temporal specificity.
</p>
<p>When <code>byPlot = FALSE</code> (i.e., population estimates are returned), the &quot;YEAR&quot; column in the resulting dataframe indicates the final year of the inventory cycle that estimates are produced for. For example, an estimate of current forest area (e.g., 2018) may draw on data collected from 2008-2018, and &quot;YEAR&quot; will be listed as 2018 (consistent with EVALIDator). However, when <code>byPlot = TRUE</code> (i.e., plot-level estimates returned), the &quot;YEAR&quot; column denotes the year that each plot was measured (MEASYEAR), which may differ slightly from its associated inventory year (INVYR).
</p>
<p>Stratified random sampling techniques are most often employed to compute estimates in recent inventories, although double sampling and simple random sampling may be employed for early inventories. Estimates are adjusted for non-response bias by assuming attributes of non-response plot locations to be equal to the mean of other plots included within thier respective stratum or population.
</p>
<p><strong>Working with &quot;Big Data&quot;</strong>
</p>
<p>If FIA data are too large to hold in memory (e.g., R throws the &quot;cannot allocate vector of size ...&quot; errors), use larger-than-RAM options. See documentation of <code>readFIA()</code> for examples of how to set up a <code>Remote.FIA.Database</code>. As a reference, we have used rFIA's larger-than-RAM methods to estimate forest variables using the entire FIA Database (~50GB) on a standard desktop computer with 16GB of RAM. Check out <a href="https://doserlab.com/files/rfia/">our website</a> for more details and examples.
</p>
<p>Easy, efficient parallelization is implemented with the <code><a href="parallel.html#topic+parallel">parallel</a></code> package. Users must only specify the <code>nCores</code> argument with a value greater than 1 in order to implement parallel processing on their machines. Parallel implementation is achieved using a snow type cluster on any Windows OS, and with multicore forking on any Unix OS (Linux, Mac). Implementing parallel processing may substantially decrease free memory during processing, particularly on Windows OS. Thus, users should be cautious when running in parallel, and consider implementing serial processing for this task if computational resources are limited (<code>nCores = 1</code>).
</p>
<p><strong>Definition of forestland</strong>
</p>
<p>Forest land must have at least 10-percent canopy cover by live tally trees of any size, including land that formerly had such tree cover and that will be naturally or artificially regenerated. Forest land includes transition zones, such as areas between heavily forest and non-forested lands that meet the mimium tree canopy cover and forest areas adjacent to urban and built-up lands. The minimum area for classification of forest land is 1 acre in size and 120 feet wide measured stem-to-stem from the outer-most edge. Roadside, streamside, and shelterbelt strips of trees must have a width of at least 120 feet and continuous length of at least 363 feet to qualify as forest land. Tree-covered areas in agricultural production settings, such as fruit orchards, or tree-covered areas in urban settings, such as city parks, are not considered forest land.
</p>
<p>Timber land is a subset of forest land that is producing or is capable of producing crops of industrial wood and not withdrawn from timber utilization by statute or administrative regulation. (Note: Areas qualifying as timberland are capable of producing at least 20 cubic feet per acre per year of industrial wood in natural stands. Currently inaccessible and inoperable areas are NOT included).
</p>


<h3>Value</h3>

<p>Dataframe or sf object (if <code>returnSpatial = TRUE</code>). If <code>byPlot = TRUE</code>, values are returned for each plot (proportion of plot in domain of interest; <code>PLOT_STATUS_CD = 1</code> when forest exists at the plot location). All variables with names ending in <code>SE</code>, represent the estimate of sampling error (%) of the variable. When <code>variance = TRUE</code>, variables ending in <code>VAR</code> denote the variance of the variable and <code>N</code> is the total sample size (i.e., including non-zero plots).
</p>

<ul>
<li><p><strong>YEAR</strong>: reporting year associated with estimates
</p>
</li>
<li><p><strong>PERC_AREA</strong>: percent of area within the domain of interest
</p>
</li>
<li><p><strong>AREA_TOTAL</strong>: estimate of total area within domain of interest (acres)
</p>
</li>
<li><p><strong>nPlots_AREA_NUM</strong>: number of non-zero plots used to compute land area estimates within the domain of interest
</p>
</li>
<li><p><strong>nPlots_AREA_DEN</strong>: number of non-zero plots used to compute land area estimates
</p>
</li></ul>



<h3>Note</h3>

<p>All sampling error estimates (SE) are returned as the &quot;percent coefficient of variation&quot; (standard deviation / mean * 100) for consistency with EVALIDator. IMPORTANT: sampling error cannot be used to construct confidence intervals. Please use <code>variance = TRUE</code> for that (i.e., return variance and sample size instead of sampling error).</p>


<h3>Author(s)</h3>

<p>Hunter Stanke, Andrew Finley, Jeffrey W. Doser
</p>


<h3>References</h3>

<p>rFIA website: <a href="https://doserlab.com/files/rfia/">https://doserlab.com/files/rfia/</a>
</p>
<p>FIA Database User Guide: <a href="https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi">https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi</a>
</p>
<p>Bechtold, W.A.; Patterson, P.L., eds. 2005. The Enhanced Forest Inventory and Analysis Program - National Sampling Design and Estimation Procedures. Gen. Tech. Rep. SRS - 80. Asheville, NC: U.S. Department of Agriculture, Forest Service, Southern Research Station. 85 p. <a href="https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf">https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf</a>
</p>
<p>Stanke, H., Finley, A. O., Weed, A. S., Walters, B. F., &amp; Domke, G. M. (2020). rFIA: An R package for estimation of forest attributes with the US Forest Inventory and Analysis database. Environmental Modelling &amp; Software, 127, 104664.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load data from the rFIA package
data(fiaRI)
data(countiesRI)

# Most recents subset
fiaRI_mr &lt;- clipFIA(fiaRI)

# Most recent estimates of forested area in RI
area(db = fiaRI_mr)


# Same as above grouped by land class
area(db = fiaRI_mr, byLandType = TRUE)

# Estimates for area where stems greater than 20 in DBH occur for
# available inventories (time-series)
area(db = fiaRI,
     landType = 'forest',
     treeDomain = DIA &gt; 20)

# Same as above, but implemented in parallel (much quicker)
# parallel::detectCores(logical = FALSE)
# area(db = fiaRI,
#      landType = 'forest',
#      treeDomain = DIA &gt; 20,
#      nCores =2)

# Return estimates at the plot-level
area(db = fiaRI,
     byPlot = TRUE)
  

</code></pre>

<hr>
<h2 id='areaChange'>Estimate land area change from the FIADB</h2><span id='topic+areaChange'></span>

<h3>Description</h3>

<p>Produces estimates of annual net and component change in land area (acreage) from FIA data. Estimates can be produced for regions defined within the FIA Database (e.g. counties), at the plot level, or within user-defined areal units. Options to group estimates by land type and other variables defined in the FIADB. If multiple reporting years (EVALIDs) are included in the data, estimates will be output as a time series. If multiple states are represented by the data, estimates will be output for the full region (all area combined), unless specified otherwise (e.g. grpBy = STATECD). </p>


<h3>Usage</h3>

<pre><code class='language-R'>areaChange(db, grpBy = NULL, polys = NULL, returnSpatial = FALSE,
           byLandType = FALSE, landType = "forest", method = "TI",
           lambda = 0.5, treeDomain = NULL, areaDomain = NULL,
           variance = FALSE, byPlot = FALSE,
           condList = FALSE, chngType = 'net', nCores = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="areaChange_+3A_db">db</code></td>
<td>
<p><code>FIA.Database</code> or <code>Remote.FIA.Database</code> object produced from <code>readFIA()</code> or <code>getFIA()</code>. If a <code>Remote.FIA.Database</code>, data will be read in and processed state-by-state to conserve RAM (see details for an example).</p>
</td></tr>
<tr><td><code id="areaChange_+3A_grpby">grpBy</code></td>
<td>
<p>variables from PLOT or COND tables to group estimates by (NOT quoted). Multiple grouping variables should be combined with <code>c()</code>, and grouping will occur hierarchically. For example, to produce separate estimates for each ownership group within methods of stand regeneration, specify <code>c(STDORGCD, OWNGRPCD)</code>.</p>
</td></tr>
<tr><td><code id="areaChange_+3A_polys">polys</code></td>
<td>
<p><code>sp</code> or <code>sf</code> Polygon/MultiPolgyon object; Areal units to bin data for estimation. Separate estimates will be produces for region encompassed by each areal unit. FIA plot locations will be reprojected to match projection of <code>polys</code> object.</p>
</td></tr>
<tr><td><code id="areaChange_+3A_returnspatial">returnSpatial</code></td>
<td>
<p>logical; if TRUE, merge population estimates with <code>polys</code> and return as <code>sf</code> multipolygon object. When <code>byPlot = TRUE</code>, return plot-level estimates as <code>sf</code> spatial points.</p>
</td></tr>
<tr><td><code id="areaChange_+3A_bylandtype">byLandType</code></td>
<td>
<p>logical; if TRUE, return estimates grouped by individual land type classes (&quot;timberland&quot;, &quot;non-timberland forest&quot;, &quot;non-forest&quot;, and &quot;water&quot;).</p>
</td></tr>
<tr><td><code id="areaChange_+3A_landtype">landType</code></td>
<td>
<p>character, one of: &quot;forest&quot;, &quot;non-forest&quot;, &quot;water&quot;, or &quot;all&quot;; Type of land that estimates will be produced for. Timberland is a subset of forestland (default) which has high site potential and non-reserve status (see details).</p>
</td></tr>
<tr><td><code id="areaChange_+3A_method">method</code></td>
<td>
<p>character; design-based estimator to use. One of:  &quot;TI&quot; (temporally indifferent, default), &quot;annual&quot; (annual), &quot;SMA&quot; (simple moving average), &quot;LMA&quot; (linear moving average), or &quot;EMA&quot; (exponential moving average). See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators.</p>
</td></tr>
<tr><td><code id="areaChange_+3A_lambda">lambda</code></td>
<td>
<p>numeric (0,1); if <code>method = 'EMA'</code>, the decay parameter used to define weighting scheme for annual panels. Low values place higher weight on more recent panels, and vice versa. Specify a vector of values to compute estimates using mulitple weighting schemes, and use <code>plotFIA()</code> with <code>grp</code> set to <code>lambda</code> to produce moving average ribbon plots. See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for examples.</p>
</td></tr>
<tr><td><code id="areaChange_+3A_treedomain">treeDomain</code></td>
<td>
<p>logical predicates defined in terms of the variables in PLOT, TREE, and/or COND tables. Used to define the type of trees for which estimates will be produced (e.g. DBH greater than 20 inches: <code>DIA &gt; 20</code>, Dominant/Co-dominant crowns only: <code>CCLCD %in% 2:3</code>. Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only trees where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="areaChange_+3A_areadomain">areaDomain</code></td>
<td>
<p>logical predicates defined in terms of the variables in PLOT and/or COND tables. Used to define the area for which estimates will be produced (e.g. within 1 mile of improved road: <code>RDDISTCD %in% 1:6</code>, Hard maple/basswood forest type: <code>FORTYPCD == 805</code>. Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only plots within areas where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="areaChange_+3A_variance">variance</code></td>
<td>
<p>logical; if TRUE, return estimated variance (<code>VAR</code>) and sample size (<code>N</code>). If FALSE, return 'sampling error' (<code>SE</code>) as returned by EVALIDator. Note: sampling error cannot be used to construct confidence intervals.</p>
</td></tr>
<tr><td><code id="areaChange_+3A_byplot">byPlot</code></td>
<td>
<p>logical; if TRUE, returns estimates for individual plot locations instead of population estimates.</p>
</td></tr>
<tr><td><code id="areaChange_+3A_condlist">condList</code></td>
<td>
<p>logical; if TRUE, returns condition-level summaries intended for subsequent use with <code>customPSE()</code>.</p>
</td></tr>
<tr><td><code id="areaChange_+3A_chngtype">chngType</code></td>
<td>
<p>character, one of &quot;net&quot; or &quot;component&quot;; if &quot;net&quot;, produce estimates of net change in land area, and if &quot;component&quot;, produce estimates of component change in land area (i.e., showing all shifts across classified attributes).</p>
</td></tr>
<tr><td><code id="areaChange_+3A_ncores">nCores</code></td>
<td>
<p>numeric; number of cores to use for parallel implementation. Check available cores using <code>detectCores()</code>. Default = 1, serial processing.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Estimation Details</strong>
</p>
<p>Estimation of forest variables follows the procedures documented in Bechtold and Patterson (2005) and <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a>.
</p>
<p>Estimates are returned in terms of <em>net</em> annual change in land area by default, however users may choose to estimate components of land area change by setting <code>chngType = 'component'</code>. For example, imagine we are interested in estimating the change in forestland area across a region. During our sampling period, 4000 acres of forestland was <em>diverted</em> to non-forest and an additional 6000 acres of non-forest <em>reverted</em> to forestland. rFIA considers these shifts in land classifications change <em>components</em>, and hence these point estimates would be returned when <code>chngType = 'component'</code>. However, we are often interested in <em>net</em> change in land area, rather than individual components. Here net change in forestland area is +2000 acres (6000-4000) and represents the net result of diversion and reversion processes in the region over our study period.
</p>
<p>Users may specify alternatives to the 'Temporally Indifferent' estimator using the <code>method</code> argument. Alternative design-based estimators include the annual estimator (&quot;ANNUAL&quot;; annual panels, or estimates from plots measured in the same year), simple moving average (&quot;SMA&quot;; combines annual panels with equal weight), linear moving average (&quot;LMA&quot;; combine annual panels with weights that decay <em>linearly</em> with time since measurement), and exponential moving average (&quot;EMA&quot;; combine annual panels with weights that decay <em>exponentially</em> with time since measurement). The &quot;best&quot; estimator depends entirely on user-objectives, see <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators and tradeoffs between precision and temporal specificity.
</p>
<p>When <code>byPlot = FALSE</code> (i.e., population estimates are returned), the &quot;YEAR&quot; column in the resulting dataframe indicates the final year of the inventory cycle that estimates are produced for. For example, an estimate of current forest area (e.g., 2018) may draw on data collected from 2008-2018, and &quot;YEAR&quot; will be listed as 2018 (consistent with EVALIDator). However, when <code>byPlot = TRUE</code> (i.e., plot-level estimates returned), the &quot;YEAR&quot; column denotes the year that each plot was measured (MEASYEAR), which may differ slightly from its associated inventory year (INVYR).
</p>
<p>Stratified random sampling techniques are most often employed to compute estimates in recent inventories, although double sampling and simple random sampling may be employed for early inventories. Estimates are adjusted for non-response bias by assuming attributes of non-response plot locations to be equal to the mean of other plots included within thier respective stratum or population.
</p>
<p><strong>Working with &quot;Big Data&quot;</strong>
</p>
<p>If FIA data are too large to hold in memory (e.g., R throws the &quot;cannot allocate vector of size ...&quot; errors), use larger-than-RAM options. See documentation of <code>readFIA()</code> for examples of how to set up a <code>Remote.FIA.Database</code>. As a reference, we have used rFIA's larger-than-RAM methods to estimate forest variables using the entire FIA Database (~50GB) on a standard desktop computer with 16GB of RAM. Check out <a href="https://doserlab.com/files/rfia/">our website</a> for more details and examples.
</p>
<p>Easy, efficient parallelization is implemented with the <code><a href="parallel.html#topic+parallel">parallel</a></code> package. Users must only specify the <code>nCores</code> argument with a value greater than 1 in order to implement parallel processing on their machines. Parallel implementation is achieved using a snow type cluster on any Windows OS, and with multicore forking on any Unix OS (Linux, Mac). Implementing parallel processing may substantially decrease free memory during processing, particularly on Windows OS. Thus, users should be cautious when running in parallel, and consider implementing serial processing for this task if computational resources are limited (<code>nCores = 1</code>).
</p>
<p><strong>Definition of forestland</strong>
</p>
<p>Forest land must have at least 10-percent canopy cover by live tally trees of any size, including land that formerly had such tree cover and that will be naturally or artificially regenerated. Forest land includes transition zones, such as areas between heavily forest and non-forested lands that meet the mimium tree canopy cover and forest areas adjacent to urban and built-up lands. The minimum area for classification of forest land is 1 acre in size and 120 feet wide measured stem-to-stem from the outer-most edge. Roadside, streamside, and shelterbelt strips of trees must have a width of at least 120 feet and continuous length of at least 363 feet to qualify as forest land. Tree-covered areas in agricultural production settings, such as fruit orchards, or tree-covered areas in urban settings, such as city parks, are not considered forest land.
</p>
<p>Timber land is a subset of forest land that is producing or is capable of producing crops of industrial wood and not withdrawn from timber utilization by statute or administrative regulation. (Note: Areas qualifying as timberland are capable of producing at least 20 cubic feet per acre per year of industrial wood in natural stands. Currently inaccessible and inoperable areas are NOT included).
</p>


<h3>Value</h3>

<p>Dataframe or sf object (if <code>returnSpatial = TRUE</code>). If <code>byPlot = TRUE</code>, values are returned for each plot (proportion of plot in domain of interest; <code>PLOT_STATUS_CD = 1</code> when forest exists at the plot location). All variables with names ending in <code>SE</code>, represent the estimate of sampling error (%) of the variable. When <code>variance = TRUE</code>, variables ending in <code>VAR</code> denote the variance of the variable and <code>N</code> is the total sample size (i.e., including non-zero plots).
</p>

<ul>
<li><p><strong>YEAR</strong>: reporting year associated with estimates
</p>
</li>
<li><p><strong>PERC_CHNG</strong>: estimate of annual percent change in land area within domain of interest (% of previous)
</p>
</li>
<li><p><strong>AREA_CHNG</strong>: estimate of annual change in land area within domain of interest (acres)
</p>
</li>
<li><p><strong>PREV_AREA</strong>: estimate of total land area within domain of interest at first measurement (acres)
</p>
</li>
<li><p><strong>nPlots</strong>: number of non-zero plots used to compute area change estimates
</p>
</li></ul>

<p>Importantly, when <code>chngType = 'component'</code>, individual change components will be returned. If no grouping variables are specified in <code>grpBy</code>, results will be grouped by variables named <strong>STATUS1</strong> and <strong>STATUS2</strong>, indicating the land classification at first and second measurements, respectively. Otherwise, if <code>grpBy</code> is specified, change components will be estimated for all shifts in land area across classified attributes represented by the variables (first and second measurements again denoted by the suffix 1 and 2). This is also the case for when additional criteria are specified to the tree, condition, or area domains using <code>treeDomain</code> and/or <code>areaDomain</code>.
</p>


<h3>Note</h3>

<p>All sampling error estimates (SE) are returned as the &quot;percent coefficient of variation&quot; (standard deviation / mean * 100) for consistency with EVALIDator. IMPORTANT: sampling error cannot be used to construct confidence intervals. Please use <code>variance = TRUE</code> for that (i.e., return variance and sample size instead of sampling error).</p>


<h3>Author(s)</h3>

<p>Hunter Stanke, Andrew Finley, Jeffrey W. Doser
</p>


<h3>References</h3>

<p>rFIA website: <a href="https://doserlab.com/files/rfia/">https://doserlab.com/files/rfia/</a>
</p>
<p>FIA Database User Guide: <a href="https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi">https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi</a>
</p>
<p>Bechtold, W.A.; Patterson, P.L., eds. 2005. The Enhanced Forest Inventory and Analysis Program - National Sampling Design and Estimation Procedures. Gen. Tech. Rep. SRS - 80. Asheville, NC: U.S. Department of Agriculture, Forest Service, Southern Research Station. 85 p. <a href="https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf">https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf</a>
</p>
<p>Stanke, H., Finley, A. O., Weed, A. S., Walters, B. F., &amp; Domke, G. M. (2020). rFIA: An R package for estimation of forest attributes with the US Forest Inventory and Analysis database. Environmental Modelling &amp; Software, 127, 104664.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load data from the rFIA package
data(fiaRI)
data(countiesRI)

# Most recents subset
fiaRI_mr &lt;- clipFIA(fiaRI)

# Most recent estimates of change in forested area in RI
areaChange(db = fiaRI_mr)


# Same as above grouped by land class
areaChange(db = fiaRI_mr, byLandType = TRUE)

# Estimates for change in forest area where stems greater than 20 in DBH
# occur for all available inventories (time-series)
areaChange(db = fiaRI,
           landType = 'forest',
           treeDomain = DIA &gt; 20)

# Return estimates at the plot-level
areaChange(db = fiaRI,
           byPlot = TRUE)
  

</code></pre>

<hr>
<h2 id='biomass'>Estimate tree biomass and carbon stocks from the FIADB</h2><span id='topic+biomass'></span>

<h3>Description</h3>

<p>Produces estimates of tree biomass and carbon on a per acre basis from FIA data, along with population estimates for each variable. Estimates can be produced for regions defined within the FIA Database (e.g. counties), at the plot level, or within user-defined areal units. Options to group estimates by species, size class, and other variables defined in the FIADB. If multiple reporting years (EVALIDs) are included in the data, estimates will be output as a time series. If multiple states are represented by the data, estimates will be output for the full region (all area combined), unless specified otherwise (e.g. <code>grpBy = STATECD</code>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>biomass(db, grpBy = NULL, polys = NULL, returnSpatial = FALSE,
        bySpecies = FALSE, bySizeClass = FALSE, byComponent = FALSE,
        landType = "forest", treeType = "live", method = "TI",
        lambda = 0.5, treeDomain = NULL, areaDomain = NULL,
        totals = FALSE, variance = FALSE, byPlot = FALSE,
        treeList = FALSE, component = "AG",
        bioMethod = "NSVB", nCores = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="biomass_+3A_db">db</code></td>
<td>
<p><code>FIA.Database</code> or <code>Remote.FIA.Database</code> object produced from <code>readFIA()</code> or <code>getFIA()</code>. If a <code>Remote.FIA.Database</code>, data will be read in and processed state-by-state to conserve RAM (see details for an example).</p>
</td></tr>
<tr><td><code id="biomass_+3A_grpby">grpBy</code></td>
<td>
<p>variables from PLOT, COND, or TREE tables to group estimates by (NOT quoted). Multiple grouping variables should be combined with <code>c()</code>, and grouping will occur heirarchically. For example, to produce seperate estimates for each ownership group within methods of stand regeneration, specify <code>c(STDORGCD, OWNGRPCD)</code>.</p>
</td></tr>
<tr><td><code id="biomass_+3A_polys">polys</code></td>
<td>
<p><code>sp</code> or <code>sf</code> Polygon/MultiPolgyon object; Areal units to bin data for estimation. Separate estimates will be produced for region encompassed by each areal unit. FIA plot locations will be reprojected to match projection of <code>polys</code> object.</p>
</td></tr>
<tr><td><code id="biomass_+3A_returnspatial">returnSpatial</code></td>
<td>
<p>logical; if TRUE, merge population estimates with <code>polys</code> and return as <code>sf</code> multipolygon object. When <code>byPlot = TRUE</code>, return plot-level estimates as <code>sf</code> spatial points.</p>
</td></tr>
<tr><td><code id="biomass_+3A_byspecies">bySpecies</code></td>
<td>
<p>logical; if TRUE, returns estimates grouped by species.</p>
</td></tr>
<tr><td><code id="biomass_+3A_bysizeclass">bySizeClass</code></td>
<td>
<p>logical; if TRUE, returns estimates grouped by size class (2-inch intervals, see <code>makeClasses()</code> to compute different size class intervals).</p>
</td></tr>
<tr><td><code id="biomass_+3A_bycomponent">byComponent</code></td>
<td>
<p>logical; if TRUE, returns estimates grouped by the following biomass components: stem, stem bark, branches, foliage, stump, stump bark, merchantable bole, merchantable bole bark, sawlog, sawlog bark, and belowground roots.</p>
</td></tr>
<tr><td><code id="biomass_+3A_landtype">landType</code></td>
<td>
<p>character (&quot;forest&quot; or &quot;timber&quot;); Type of land that estimates will be produced for. Timberland is a subset of forestland (default) which has high site potential and non-reserve status (see details).</p>
</td></tr>
<tr><td><code id="biomass_+3A_treetype">treeType</code></td>
<td>
<p>character (&quot;all&quot;, &quot;live&quot;, &quot;dead&quot;, or &quot;gs&quot;); Type of tree which estimates will be produced for. All includes all stems, live and dead, greater than 1 in. DBH. Live/Dead includes all stems greater than 1 in. DBH which are live (default) or dead (leaning less than 45 degrees), respectively. GS (growing-stock) includes live stems greater than 5 in. DBH which contain at least one 8 ft merchantable log.</p>
</td></tr>
<tr><td><code id="biomass_+3A_method">method</code></td>
<td>
<p>character; design-based estimator to use. One of:  &quot;TI&quot; (temporally indifferent, default), &quot;annual&quot; (annual), &quot;SMA&quot; (simple moving average), &quot;LMA&quot; (linear moving average), or &quot;EMA&quot; (exponential moving average). See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators.</p>
</td></tr>
<tr><td><code id="biomass_+3A_lambda">lambda</code></td>
<td>
<p>numeric (0,1); if <code>method = 'EMA'</code>, the decay parameter used to define weighting scheme for annual panels. Low values place higher weight on more recent panels, and vice versa. Specify a vector of values to compute estimates using mulitple wieghting schemes, and use <code>plotFIA()</code> with <code>grp</code> set to <code>lambda</code> to produce moving average ribbon plots. See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for examples.</p>
</td></tr>
<tr><td><code id="biomass_+3A_treedomain">treeDomain</code></td>
<td>
<p>logical predicates defined in terms of the variables in PLOT, TREE, and/or COND tables. Used to define the type of trees for which estimates will be produced (e.g. DBH greater than 20 inches: <code>DIA &gt; 20</code>, Dominant/Co-dominant crowns only: <code>CCLCD %in% c(2,3)</code>. Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only trees where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="biomass_+3A_areadomain">areaDomain</code></td>
<td>
<p>logical predicates defined in terms of the variables in PLOT and/or COND tables. Used to define the area for which estimates will be produced (e.g. within 1 mile of improved road: <code>RDDISTCD %in% c(1:6)</code>, Hard maple/basswood forest type: <code>FORTYPCD == 805</code>. Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only plots within areas where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="biomass_+3A_totals">totals</code></td>
<td>
<p>logical; if TRUE, return total population estimates (e.g. total area) along with ratio estimates (e.g. mean trees per acre).</p>
</td></tr>
<tr><td><code id="biomass_+3A_variance">variance</code></td>
<td>
<p>logical; if TRUE, return estimated variance (<code>VAR</code>) and sample size (<code>N</code>). If FALSE, return 'sampling error' (<code>SE</code>) as returned by EVALIDator. Note: sampling error cannot be used to construct confidence intervals.</p>
</td></tr>
<tr><td><code id="biomass_+3A_byplot">byPlot</code></td>
<td>
<p>logical; if TRUE, returns estimates for individual plot locations instead of population estimates.</p>
</td></tr>
<tr><td><code id="biomass_+3A_treelist">treeList</code></td>
<td>
<p>logical; if TRUE, returns tree-level summaries intended for subsequent use with <code>customPSE()</code>.</p>
</td></tr>
<tr><td><code id="biomass_+3A_component">component</code></td>
<td>
<p>character, combination of: &quot;TOTAL&quot; (sum of all components), &quot;AG&quot; (aboveground components excluding foliage), &quot;STEM&quot; (total stem of timber species from ground line to the tree tip), &quot;STEM_BARK&quot;, &quot;BRANCH&quot;, (branch/limbs of timber species), &quot;FOLIAGE&quot; (foliage for live trees at least 1.0 inches dbh/drc), &quot;STUMP&quot;, &quot;STUMP_BARK&quot;, &quot;BOLE&quot; (merchantable bole), &quot;BOLE_BARK&quot;, &quot;SAWLOG&quot;, &quot;SAWLOG_BARK&quot;, &quot;ROOT&quot; (beloground portion of tree including coarse roots with a root diameter at elast 0.1 inch); biomass component to use in estimation. Note that &quot;TOTAL&quot; includes foliage for biomass estimates but does not include foliage for carbon estimates. See Details below for more detailed descriptions of the components.</p>
</td></tr>
<tr><td><code id="biomass_+3A_biomethod">bioMethod</code></td>
<td>
<p>character; tree-level biomass estimation procedures to use. As of <code>rFIA v1.1.0</code>, the only biomass estimation procedure supported is the National Scale Volume and Biomass (&quot;NSVB&quot;) models. See Estimation Details for references.</p>
</td></tr>
<tr><td><code id="biomass_+3A_ncores">nCores</code></td>
<td>
<p>numeric; number of cores to use for parallel implementation. Check available cores using <code>detectCores()</code>. Default = 1, serial processing.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Estimation Details</strong>
</p>
<p>Estimation of forest variables follows the procedures documented in Bechtold and Patterson (2005) and <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a>. Specifically, tree biomass and carbon per acre are computed using a sample-based ratio-of-means estimator of total biomass / total land area within the domain of interest.
</p>
<p>A sum of aboveground biomass components, excluding foliage, is estimated by default (<code>component = 'AG'</code>). However, users may specify unique combinations of biomass components if they wish to do so. For example, to estimate aboveground biomass, including foliage, specify <code>component = c('AG', 'FOLIAGE')</code> in the call to <code>biomass</code>. To estimate all biomass components simultaneously (i.e., grouped by copmonent), specify <code>byComponent = TRUE</code>. All biomass components are computed using the National Scale Volume and Biomass (NSVB) approach adopted by FIA in September 2023. See <a href="https://research.fs.usda.gov/treesearch/66998">Westfall et al. 2024</a> for more detailed information on NSVB procedures. The following biomass components can be estimated using <code>biomass()</code> (note the components are not mutually exclusive):  
</p>

<ul>
<li> <p><em>TOTAL</em>: total biomass, which is equivalent to the sum of the following components: &quot;ROOT&quot;, &quot;STEM&quot;, &quot;STEM_BARK&quot;, &quot;BRANCH&quot;, and &quot;FOLIAGE&quot;. <em>NOTE</em>: total carbon estimates do not include estimates of carbon in foliage.   
</p>
</li>
<li> <p><em>AG</em>: aboveground biomass/carbon, not including foliage. This is equivalent to the sum of the following components: &quot;STEM&quot;, &quot;STEM_BARK&quot;, and &quot;BRANCH&quot;.  
</p>
</li>
<li> <p><em>STEM</em>: oven-dry biomass/carbon of wood in the total stem of timber species (trees where diameter is measured at breast height) with dbh at least 1.0 inches, from ground line to the tree tip. Calculated for live and standing dead trees.
</p>
</li>
<li> <p><em>STEM_BARK</em>: oven-dry biomass/carbon of bark in the total stem of timber species with dbh at least 1.0 inches, from ground line to the tree tip. Calculated for live and standing dead trees. 
</p>
</li>
<li> <p><em>BRANCH</em>: oven-dry biomass/carbon of wood and bark in the branches/limbs of timber species with at least 1.0 inches. This only includes branches; it does not include any portion of the total stem. Calculated for live and standing dead trees. For live trees, this value is reduced for broken tops. For standing dead trees, this value is reduced for broken tops as well as decay. 
</p>
</li>
<li> <p><em>FOLIAGE</em>: oven-dry biomass of foliage for live trees with dbh/drc at least 1.0 inches. <em>NOTE</em>: foliar carbon is not calculated and is instead set to 0.
</p>
</li>
<li> <p><em>STUMP</em>: oven-dry biomass/carbon of wood in the stump of timber species with dbh at least 5.0 inches. The stump is that portion of the tree from the ground line to the bottom of the merchantable bole (i.e., below 1 foot). Calculated for live and standing dead trees. 
</p>
</li>
<li> <p><em>STUMP_BARK</em>:oven-dry biomass/carbon of bark in the stump of timber species with dbh at least 5.0 inches. The stump is that portion of the tree from the ground line to the bottom of the merchantable bole (i.e., below 1 foot). Calculated for live and standing dead trees.  
</p>
</li>
<li> <p><em>BOLE</em>: oven-dry biomass/carbon of wood in the merchantable bole of timber species with dbh at least 5.0 inches, from a 1-foot stump to a minimum 4-inch top diameter. Calculated for live and standing dead trees. 
</p>
</li>
<li> <p><em>BOLE_BARK</em>: oven-dry biomass/carbon of bark in the merchantable bole of timber species with dbh at least 5.0 inches, from a 1-foot stump to a minimum 4-inch top diameter. Calculated for live and standing dead trees.  
</p>
</li>
<li> <p><em>SAWLOG</em>: the oven-dry biomass/carbon of wood in the sawlog portion of timber species of sawtimber size from a 1-foot stump to a minimum top diameter or to where the central stem breaks into limbs, all of which are less than the minimum top diamter. Minimum dbh is 9.0 inches for softwoods and 11.0 inches for hardwoods. The minimum top diameter is 7.0 inches for softwoods and 9.0 inches for hardwoods. 
</p>
</li>
<li> <p><em>SAWLOG_BARK</em>: the oven-dry biomass/carbon of bark in the sawlog portion of timber species of sawtimber size from a 1-foot stump to a minimum top diameter or to where the central stem breaks into limbs, all of which are less than the minimum top diamter. Minimum dbh is 9.0 inches for softwoods and 11.0 inches for hardwoods. The minimum top diameter is 7.0 inches for softwoods and 9.0 inches for hardwoods. 
</p>
</li>
<li> <p><em>ROOT</em>: oven-dry biomass of the below ground portion of a tree, including coarse roots with a root diameter of at least 0.1 inches. This is a modeled estimate, calculated for live and standing dead trees with dbh/drc at least 1.0 inches. This component, unlike all other compoments, is estimated using the Component Ratio Method (CRM).   
</p>
</li></ul>

<p>Users may specify alternatives to the 'Temporally Indifferent' estimator using the <code>method</code> argument. Alternative design-based estimators include the annual estimator (&quot;ANNUAL&quot;; annual panels, or estimates from plots measured in the same year), simple moving average (&quot;SMA&quot;; combines annual panels with equal weight), linear moving average (&quot;LMA&quot;; combine annual panels with weights that decay <em>linearly</em> with time since measurement), and exponential moving average (&quot;EMA&quot;; combine annual panels with weights that decay <em>exponentially</em> with time since measurement). The &quot;best&quot; estimator depends entirely on user-objectives, see <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators and tradeoffs between precision and temporal specificity.
</p>
<p>When <code>byPlot = FALSE</code> (i.e., population estimates are returned), the &quot;YEAR&quot; column in the resulting dataframe indicates the final year of the inventory cycle that estimates are produced for. For example, an estimate of current forest area (e.g., 2018) may draw on data collected from 2008-2018, and &quot;YEAR&quot; will be listed as 2018 (consistent with EVALIDator). However, when <code>byPlot = TRUE</code> (i.e., plot-level estimates returned), the &quot;YEAR&quot; column denotes the year that each plot was measured (MEASYEAR), which may differ slightly from its associated inventory year (INVYR).
</p>
<p>Stratified random sampling techniques are most often employed to compute estimates in recent inventories, although double sampling and simple random sampling may be employed for early inventories. Estimates are adjusted for non-response bias by assuming attributes of non-response plot locations to be equal to the mean of other plots included within thier respective stratum or population.
</p>
<p><strong>Working with &quot;Big Data&quot;</strong>
</p>
<p>If FIA data are too large to hold in memory (e.g., R throws the &quot;cannot allocate vector of size ...&quot; errors), use larger-than-RAM options. See documentation of <code>readFIA()</code> for examples of how to set up a <code>Remote.FIA.Database</code>. As a reference, we have used rFIA's larger-than-RAM methods to estimate forest variables using the entire FIA Database (~50GB) on a standard desktop computer with 16GB of RAM. Check out <a href="https://doserlab.com/files/rfia/">our website</a> for more details and examples.
</p>
<p>Easy, efficient parallelization is implemented with the <code><a href="parallel.html#topic+parallel">parallel</a></code> package. Users must only specify the <code>nCores</code> argument with a value greater than 1 in order to implement parallel processing on their machines. Parallel implementation is achieved using a snow type cluster on any Windows OS, and with multicore forking on any Unix OS (Linux, Mac). Implementing parallel processing may substantially decrease free memory during processing, particularly on Windows OS. Thus, users should be cautious when running in parallel, and consider implementing serial processing for this task if computational resources are limited (<code>nCores = 1</code>).
</p>
<p><strong>Definition of forestland</strong>
</p>
<p>Forest land must have at least 10-percent canopy cover by live tally trees of any size, including land that formerly had such tree cover and that will be naturally or artificially regenerated. Forest land includes transition zones, such as areas between heavily forest and non-forested lands that meet the mimium tree canopy cover and forest areas adjacent to urban and built-up lands. The minimum area for classification of forest land is 1 acre in size and 120 feet wide measured stem-to-stem from the outer-most edge. Roadside, streamside, and shelterbelt strips of trees must have a width of at least 120 feet and continuous length of at least 363 feet to qualify as forest land. Tree-covered areas in agricultural production settings, such as fruit orchards, or tree-covered areas in urban settings, such as city parks, are not considered forest land.
</p>
<p>Timber land is a subset of forest land that is producing or is capable of producing crops of industrial wood and not withdrawn from timber utilization by statute or administrative regulation. (Note: Areas qualifying as timberland are capable of producing at least 20 cubic feet per acre per year of industrial wood in natural stands. Currently inaccessible and inoperable areas are NOT included).
</p>


<h3>Value</h3>

<p>Dataframe or sf object (if <code>returnSpatial = TRUE</code>). If <code>byPlot = TRUE</code>, values are returned for each plot (<code>PLOT_STATUS_CD = 1</code> when forest exists at the plot location). All variables with names ending in <code>SE</code>, represent the estimate of sampling error (%) of the variable. When <code>variance = TRUE</code>, variables ending in <code>VAR</code> denote the variance of the variable and <code>N</code> is the total sample size (i.e., including non-zero plots).
</p>

<ul>
<li><p><strong>YEAR</strong>: reporting year associated with estimates
</p>
</li>
<li><p><strong>BIO_ACRE</strong>: estimate of mean tree biomass per acre (short tons/acre)
</p>
</li>
<li><p><strong>CARB_ACRE</strong>: estimate of mean tree carbon per acre (short tons/acre)
</p>
</li>
<li><p><strong>nPlots_TREE</strong>: number of non-zero plots used to compute biomass and carbon estimates
</p>
</li>
<li><p><strong>nPlots_AREA</strong>: number of non-zero plots used to compute land area estimates
</p>
</li></ul>



<h3>Note</h3>

<p>All sampling error estimates (SE) are returned as the &quot;percent coefficient of variation&quot; (standard deviation / mean * 100) for consistency with EVALIDator. IMPORTANT: sampling error cannot be used to construct confidence intervals. Please use <code>variance = TRUE</code> for that (i.e., return variance and sample size instead of sampling error).</p>


<h3>Author(s)</h3>

<p>Hunter Stanke, Andrew Finley, Jeffrey W. Doser
</p>


<h3>References</h3>

<p>rFIA website: <a href="https://doserlab.com/files/rfia/">https://doserlab.com/files/rfia/</a>
</p>
<p>FIA Database User Guide: <a href="https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi">https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi</a>
</p>
<p>Bechtold, W.A.; Patterson, P.L., eds. 2005. The Enhanced Forest Inventory and Analysis Program - National Sampling Design and Estimation Procedures. Gen. Tech. Rep. SRS - 80. Asheville, NC: U.S. Department of Agriculture, Forest Service, Southern Research Station. 85 p. <a href="https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf">https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf</a>
</p>
<p>Stanke, H., Finley, A. O., Weed, A. S., Walters, B. F., &amp; Domke, G. M. (2020). rFIA: An R package for estimation of forest attributes with the US Forest Inventory and Analysis database. Environmental Modelling &amp; Software, 127, 104664.
</p>
<p>Westfall, James A., Coulston, John W., Gray, Andrew N., Shaw, John D., Radtke, Philip J., Walker, David M., Weiskittel, Aaron R., MacFarlane, David W., Affleck, David L.R., Zhao, Dehai, Temesgen, Hailemariam, Poudel, Krishna P., Frank, Jereme M., Prisley, Stephen P., Wang, Yingfang, Snchez Meador, Andrew J., Auty, David, Domke, Grant M. 2024. A national-scale tree volume, biomass, and carbon modeling system for the United States. Gen. Tech. Rep. WO-104. Washington, DC: U.S. Department of Agriculture, Forest Service. 37 p. <a href="https://research.fs.usda.gov/treesearch/66998">https://research.fs.usda.gov/treesearch/66998</a>. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load data from the rFIA package
data(fiaRI)
data(countiesRI)

# Most recents subset
fiaRI_mr &lt;- clipFIA(fiaRI)


# Most recent estimates of aboveground biomass (excluding foliage)
# for growing-stock trees on timber land
biomass(db = fiaRI_mr,
        landType = 'timber',
        treeType = 'gs')

# Same as above but include foliage
biomass(db = fiaRI_mr,
        landType = 'timber',
        treeType = 'gs',
        component = c('AG', 'FOLIAGE'))


# Same as above, but at the plot-level
biomass(db = fiaRI_mr,
        landType = 'timber',
        treeType = 'gs',
        component = c('AG', 'FOLIAGE'),
        byPlot = TRUE)

# Belowground (i.e., coarse roots) and stump biomass only
biomass(db = fiaRI_mr,
        component = c('ROOT', 'STUMP'))

# Estimate all biomass components simultaneosly
biomass(db = fiaRI_mr,
        byComponent = TRUE)

# Estimates for live white pine ( &gt; 12" DBH) on forested mesic sites (all available inventories)
biomass(fiaRI_mr,
        treeType = 'live',
        treeDomain = SPCD == 129 &amp; DIA &gt; 12, # Species code for white pine
        areaDomain = PHYSCLCD %in% 21:29) # Mesic Physiographic classes

# Most recent estimates grouped by stand age on forest land
# Make a categorical variable which represents stand age (grouped by 10 yr intervals)
fiaRI_mr$COND$STAND_AGE &lt;- makeClasses(fiaRI_mr$COND$STDAGE, interval = 10)
biomass(db = fiaRI_mr,
        grpBy = STAND_AGE)

# Estimates for snags greater than 20 in DBH on forestland for all
#  available inventories (time-series)
biomass(db = fiaRI,
        landType = 'forest',
        treeType = 'dead',
        treeDomain = DIA &gt; 20)

# Most recent estimates for live stems on forest land by species
biomass(db = fiaRI_mr,
        landType = 'forest',
        treeType = 'live',
        bySpecies = TRUE)

# Same as above, but implemented in parallel (much quicker)
# parallel::detectCores(logical = FALSE) # 4 cores available, we will take 2
# biomass(db = fiaRI_mr,
#         landType = 'forest',
#         treeType = 'live',
#         bySpecies = TRUE,
#         nCores = 2)


# Most recent estimates for all stems on forest land grouped by user-defined areal units
ctSF &lt;- biomass(fiaRI_mr,
                polys = countiesRI,
                returnSpatial = TRUE)
plot(ctSF) # Plot multiple variables simultaneously
plotFIA(ctSF, BIO_ACRE) # Plot of aboveground biomass per acre


</code></pre>

<hr>
<h2 id='carbon'>Estimate carbon stocks by IPCC forest carbon pools from the FIADB</h2><span id='topic+carbon'></span>

<h3>Description</h3>

<p>Produces estimates of carbon (<em>metric tonnes</em>) on a per acre basis from FIA data, along with population estimates for each variable. Estimates are consistent with those used in the EPA's Greenhouse Gas Inventory Estimates. Can be produced for regions defined within the FIA Database (e.g. counties), at the plot level, or within user-defined areal units. Options to group estimates by IPCC forest carbon pools, IPCC forest carbon components, and other variables defined in the FIADB. If multiple reporting years (EVALIDs) are included in the data, estimates will be output as a time series. If multiple states are represented by the data, estimates will be output for the full region (all area combined), unless specified otherwise (e.g. <code>grpBy = STATECD</code>).</p>


<h3>Usage</h3>

<pre><code class='language-R'>carbon(db, grpBy = NULL, polys = NULL, returnSpatial = FALSE,
       byPool = TRUE, byComponent = FALSE, landType = "forest", 
       method = "TI", lambda = 0.5, areaDomain = NULL, 
       totals = FALSE, variance = FALSE, byPlot = FALSE, 
       condList = FALSE, nCores = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="carbon_+3A_db">db</code></td>
<td>
<p><code>FIA.Database</code> or <code>Remote.FIA.Database</code> object produced from <code>readFIA()</code> or <code>getFIA()</code>. If a <code>Remote.FIA.Database</code>, data will be read in and processed state-by-state to conserve RAM (see details for an example).</p>
</td></tr>
<tr><td><code id="carbon_+3A_grpby">grpBy</code></td>
<td>
<p>variables from PLOT or COND tables to group estimates by (NOT quoted). Multiple grouping variables should be combined with <code>c()</code>, and grouping will occur heirarchically. For example, to produce seperate estimates for each ownership group within methods of stand regeneration, specify <code>c(STDORGCD, OWNGRPCD)</code>.</p>
</td></tr>
<tr><td><code id="carbon_+3A_polys">polys</code></td>
<td>
<p><code>sp</code> or <code>sf</code> Polygon/MultiPolgyon object; Areal units to bin data for estimation. Separate estimates will be produced for region encompassed by each areal unit. FIA plot locations will be reprojected to match projection of <code>polys</code> object.</p>
</td></tr>
<tr><td><code id="carbon_+3A_returnspatial">returnSpatial</code></td>
<td>
<p>logical; if TRUE, merge population estimates with <code>polys</code> and return as <code>sf</code> multipolygon object. When <code>byPlot = TRUE</code>, return plot-level estimates as <code>sf</code> spatial points.</p>
</td></tr>
<tr><td><code id="carbon_+3A_bypool">byPool</code></td>
<td>
<p>logical; if TRUE, return estimates grouped by IPCC forest carbon pools (i.e., aboveground live, belowground live, dead wood, litter, and soil organic).</p>
</td></tr>
<tr><td><code id="carbon_+3A_bycomponent">byComponent</code></td>
<td>
<p>logical; if TRUE, return estimates grouped by IPCC forest carbon components (i.e., aboveground live overstory, aboveground live understory, belowground live overstory, belowground live understory, standing dead wood, down dead wood, litter, and soil organic).</p>
</td></tr>
<tr><td><code id="carbon_+3A_landtype">landType</code></td>
<td>
<p>character (&quot;forest&quot;, &quot;timber&quot;, or &quot;all&quot;); Type of land that estimates will be produced for. Timberland is a subset of forestland (default) which has high site potential and non-reserve status (see details). When &quot;forest&quot; or &quot;timber&quot;, ratios represent average forest carbon density <em>on forest or timberland</em>, i.e., non-forested conditions are excluded. When &quot;all&quot;, ratios represent average forest carbon density across all land uses, including non-forest.</p>
</td></tr>
<tr><td><code id="carbon_+3A_method">method</code></td>
<td>
<p>character; design-based estimator to use. One of:  &quot;TI&quot; (temporally indifferent, default), &quot;annual&quot; (annual), &quot;SMA&quot; (simple moving average), &quot;LMA&quot; (linear moving average), or &quot;EMA&quot; (exponential moving average). See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators.</p>
</td></tr>
<tr><td><code id="carbon_+3A_lambda">lambda</code></td>
<td>
<p>numeric (0,1); if <code>method = 'EMA'</code>, the decay parameter used to define weighting scheme for annual panels. Low values place higher weight on more recent panels, and vice versa. Specify a vector of values to compute estimates using mulitple weighting schemes, and use <code>plotFIA</code> with <code>grp</code> set to <code>lambda</code> to produce moving average ribbon plots. See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for examples.</p>
</td></tr>
<tr><td><code id="carbon_+3A_areadomain">areaDomain</code></td>
<td>
<p>logical predicates defined in terms of the variables in PLOT and/or COND tables. Used to define the area for which estimates will be produced (e.g. within 1 mile of improved road: <code>RDDISTCD %in% c(1:6)</code>, Hard maple/basswood forest type: <code>FORTYPCD == 805</code>. Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only plots within areas where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="carbon_+3A_totals">totals</code></td>
<td>
<p>logical; if TRUE, return total population estimates (e.g. total area) along with ratio estimates (e.g. mean trees per acre).</p>
</td></tr>
<tr><td><code id="carbon_+3A_variance">variance</code></td>
<td>
<p>logical; if TRUE, return estimated variance (<code>VAR</code>) and sample size (<code>N</code>). If FALSE, return 'sampling error' (<code>SE</code>) as returned by EVALIDator. Note: sampling error cannot be used to construct confidence intervals.</p>
</td></tr>
<tr><td><code id="carbon_+3A_byplot">byPlot</code></td>
<td>
<p>logical; if TRUE, returns estimates for individual plot locations instead of population estimates.</p>
</td></tr>
<tr><td><code id="carbon_+3A_condlist">condList</code></td>
<td>
<p>logical; if TRUE, returns condition-level summaries intended for subsequent use with <code>customPSE()</code>.</p>
</td></tr>
<tr><td><code id="carbon_+3A_ncores">nCores</code></td>
<td>
<p>numeric; number of cores to use for parallel implementation. Check available cores using <code>detectCores()</code>. Default = 1, serial processing.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Estimation Details</strong>
</p>
<p>Estimation of forest variables follows the procedures documented in Bechtold and Patterson (2005) and <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a>. Specifically, carbon mass per acre is computed using a sample-based ratio-of-means estimator of total volume / total land area within the domain of interest.
</p>
<p>Estimation of carbon stocks draws on measured (e.g., tree carbon) and modeled attributes (e.g., soil organic carbon). This function is intended to produce estimates consistent with those in the EPA's Greenhouse Gas Inventory Estimates. Importantly, estimates are reported in <em>metric tonnes</em> - this is a key distinction relative to other <code>rFIA</code> functions, which report estimates in Imperial units. See the following for more info: http://www.epa.gov/climatechange/ghgemissions/usinventoryreport/archive.html
</p>
<p>IPCC forest carbon pools are aboveground live biomass, belowground live biomass, dead wood, litter, and soil organic carbon. Aboveground live biomass, belowground live biomass, and dead wood consist of both actual tree measurements and modeled attributes, while litter and soil organic carbon are based completely on modeled attributes. IPCC forest carbon components are defined as follows: 
</p>

<ul>
<li> <p><em>AG_OVER_LIVE</em>: measured attribute. Carbon in the aboveground portion of live trees with at least 1.0 inch dbh/drc. Calculated from the FIADB TREE.CARBON_AG attribute for live trees.  
</p>
</li>
<li> <p><em>AG_UNDER_LIVE</em>: modeled attribute. Carbon in the aboveground portion of seedlings and woody shrubs. Not a direct sum of P2 or P3 measurements. Calculated from FIADB COND.CARBON_UNDERSTORY_AG attribute.  
</p>
</li>
<li> <p><em>BG_OVER_LIVE</em>: measured attribute. Carbon in the belowground portion of a tree, including coarse roots with a root diameter of at least 0.1 inch, for live trees with 1.0 inch dbh/drc. Calculated from the FIADB TREE.CARBON_BG attribute for live trees. 
</p>
</li>
<li> <p><em>BG_UNDER_LIVE</em>: modeled attribute. Carbon in the belowground portion of seedlings and woody shrubs. Not a direct sum of P2 or P3 measurements. Calculated from COND.CARBON_UNDERSTORY_BG attribute.
</p>
</li>
<li> <p><em>DOWN_DEAD</em>: modeled attribute. Carbon of woody material greater than 3 inches in diameter on the ground, and stumps and their roots greater than 3 inches in diameter. Not a direct sum of P2 or P3 measurements. Calculated from FIADB COND.CARBON_DOWN_DEAD attribute.  
</p>
</li>
<li> <p><em>STAND_DEAD</em>: measured attribute. Carbon in the aboveground and belowground portion of standing dead trees with at least 1.0 inch dbh/drc. Belowground measurements include coarse roots with a root diameter of at least 0.1 inch. Calculated from the FIADB TREE.CARBON_AG and TREE.CARBON_BG columns for dead trees. <em>NOTE</em>: prior to rFIA v0.1.0, the argument <code>modelSnag</code> allowed users to specify whether this was calculated based on modeled attributes or actual tree measurements. This argument has been removed and we no longer provide the option for generating carbon in snags from modeled attributes and instead the estimates come directly from tree measurements in FIADB.  
</p>
</li>
<li> <p><em>LITTER</em>: modeled attribute. Carbon of organic material on the floor of the forest, including fine woody debris, humus, and fine roots in the organic forest floor layer above mineral soi. This is based on litter carbon observations on FIA plots, but it is not a direct sum of P2 or P3 measurements. Calculated from FIADB COND.CARBON_LITTER attribute.
</p>
</li>
<li> <p><em>SOIL_ORG</em>: modeled attribute. Carbon in fine organic material below the soil surface to a depth of 1 meter. Does not include roots.  This is based on soil organic carbon observations on FIA plots, but it is not a direct sum of P2 or P3 measurements. Calculated from FIADB COND.CARBON_SOIL_ORG attribute. 
</p>
</li></ul>

<p>Users may specify alternatives to the 'Temporally Indifferent' estimator using the <code>method</code> argument. Alternative design-based estimators include the annual estimator (&quot;ANNUAL&quot;; annual panels, or estimates from plots measured in the same year), simple moving average (&quot;SMA&quot;; combines annual panels with equal weight), linear moving average (&quot;LMA&quot;; combine annual panels with weights that decay <em>linearly</em> with time since measurement), and exponential moving average (&quot;EMA&quot;; combine annual panels with weights that decay <em>exponentially</em> with time since measurement). The &quot;best&quot; estimator depends entirely on user-objectives, see <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators and tradeoffs between precision and temporal specificity.
</p>
<p>When <code>byPlot = FALSE</code> (i.e., population estimates are returned), the &quot;YEAR&quot; column in the resulting dataframe indicates the final year of the inventory cycle that estimates are produced for. For example, an estimate of current forest area (e.g., 2018) may draw on data collected from 2008-2018, and &quot;YEAR&quot; will be listed as 2018 (consistent with EVALIDator). However, when <code>byPlot = TRUE</code> (i.e., plot-level estimates returned), the &quot;YEAR&quot; column denotes the year that each plot was measured (MEASYEAR), which may differ slightly from its associated inventory year (INVYR).
</p>
<p>Stratified random sampling techniques are most often employed to compute estimates in recent inventories, although double sampling and simple random sampling may be employed for early inventories. Estimates are adjusted for non-response bias by assuming attributes of non-response plot locations to be equal to the mean of other plots included within their respective stratum or population.
</p>
<p><strong>Working with &quot;Big Data&quot;</strong>
</p>
<p>If FIA data are too large to hold in memory (e.g., R throws the &quot;cannot allocate vector of size ...&quot; errors), use larger-than-RAM options. See documentation of <code>readFIA()</code> for examples of how to set up a <code>Remote.FIA.Database</code>. As a reference, we have used rFIA's larger-than-RAM methods to estimate forest variables using the entire FIA Database (~50GB) on a standard desktop computer with 16GB of RAM. Check out <a href="https://doserlab.com/files/rfia/">our website</a> for more details and examples.
</p>
<p>Easy, efficient parallelization is implemented with the <code><a href="parallel.html#topic+parallel">parallel</a></code> package. Users must only specify the <code>nCores</code> argument with a value greater than 1 in order to implement parallel processing on their machines. Parallel implementation is achieved using a snow type cluster on any Windows OS, and with multicore forking on any Unix OS (Linux, Mac). Implementing parallel processing may substantially decrease free memory during processing, particularly on Windows OS. Thus, users should be cautious when running in parallel, and consider implementing serial processing for this task if computational resources are limited (<code>nCores = 1</code>).
</p>
<p><strong>Definition of forestland</strong>
</p>
<p>Forest land must have at least 10-percent canopy cover by live tally trees of any size, including land that formerly had such tree cover and that will be naturally or artificially regenerated. Forest land includes transition zones, such as areas between heavily forest and non-forested lands that meet the mimium tree canopy cover and forest areas adjacent to urban and built-up lands. The minimum area for classification of forest land is 1 acre in size and 120 feet wide measured stem-to-stem from the outer-most edge. Roadside, streamside, and shelterbelt strips of trees must have a width of at least 120 feet and continuous length of at least 363 feet to qualify as forest land. Tree-covered areas in agricultural production settings, such as fruit orchards, or tree-covered areas in urban settings, such as city parks, are not considered forest land.
</p>
<p>Timber land is a subset of forest land that is producing or is capable of producing crops of industrial wood and not withdrawn from timber utilization by statute or administrative regulation. (Note: Areas qualifying as timberland are capable of producing at least 20 cubic feet per acre per year of industrial wood in natural stands. Currently inaccessible and inoperable areas are NOT included).
</p>


<h3>Value</h3>

<p>Dataframe or sf object (if <code>returnSpatial = TRUE</code>). If <code>byPlot = TRUE</code>, values are returned for each plot (<code>PLOT_STATUS_CD = 1</code> when forest exists at the plot location). All variables with names ending in <code>SE</code>, represent the estimate of sampling error (%) of the variable. When <code>variance = TRUE</code>, variables ending in <code>VAR</code> denote the variance of the variable and <code>N</code> is the total sample size (i.e., including non-zero plots).
</p>

<ul>
<li><p><strong>YEAR</strong>: reporting year associated with estimates
</p>
</li>
<li><p><strong>CARB_ACRE</strong>: estimate of mean total carbon per acre ( metric tonnes/acre)
</p>
</li>
<li><p><strong>nPlots_TREE</strong>: number of non-zero plots used to compute carbon estimates
</p>
</li>
<li><p><strong>nPlots_AREA</strong>: number of non-zero plots used to compute land area estimates
</p>
</li></ul>



<h3>Note</h3>

<p>All sampling error estimates (SE) are returned as the &quot;percent coefficient of variation&quot; (standard deviation / mean * 100) for consistency with EVALIDator. IMPORTANT: sampling error cannot be used to construct confidence intervals. Please use <code>variance = TRUE</code> for that (i.e., return variance and sample size instead of sampling error).</p>


<h3>Author(s)</h3>

<p>Hunter Stanke and Andrew Finley
</p>


<h3>References</h3>

<p>rFIA website: <a href="https://doserlab.com/files/rfia/">https://doserlab.com/files/rfia/</a>
</p>
<p>FIA Database User Guide: <a href="https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi">https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi</a>
</p>
<p>Bechtold, W.A.; Patterson, P.L., eds. 2005. The Enhanced Forest Inventory and Analysis Program - National Sampling Design and Estimation Procedures. Gen. Tech. Rep. SRS - 80. Asheville, NC: U.S. Department of Agriculture, Forest Service, Southern Research Station. 85 p. <a href="https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf">https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf</a>
</p>
<p>Stanke, H., Finley, A. O., Weed, A. S., Walters, B. F., &amp; Domke, G. M. (2020). rFIA: An R package for estimation of forest attributes with the US Forest Inventory and Analysis database. Environmental Modelling &amp; Software, 127, 104664.
</p>
<p>Westfall, James A., Coulston, John W., Gray, Andrew N., Shaw, John D., Radtke, Philip J., Walker, David M., Weiskittel, Aaron R., MacFarlane, David W., Affleck, David L.R., Zhao, Dehai, Temesgen, Hailemariam, Poudel, Krishna P., Frank, Jereme M., Prisley, Stephen P., Wang, Yingfang, Snchez Meador, Andrew J., Auty, David, Domke, Grant M. 2024. A national-scale tree volume, biomass, and carbon modeling system for the United States. Gen. Tech. Rep. WO-104. Washington, DC: U.S. Department of Agriculture, Forest Service. 37 p. <a href="https://research.fs.usda.gov/treesearch/66998">https://research.fs.usda.gov/treesearch/66998</a>. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load data from the rFIA package
data(fiaRI)
data(countiesRI)

# Most recents subset
fiaRI_mr &lt;- clipFIA(fiaRI)


# Most recent estimates of carbon by IPCC pool
carbon(db = fiaRI_mr)


# Same as above, at the plot-level
carbon(db = fiaRI_mr,
       byPlot = TRUE)

# Most recent estimates of carbon by IPCC component
carbon(db = fiaRI_mr, byComponent = TRUE)

# Most recent estimates of total carbon (i.e., all pools)
carbon(db = fiaRI_mr, byPool = FALSE)

# Most recent estimates grouped by stand age on forest land
# Make a categorical variable which represents stand age (grouped by 10 yr intervals)
fiaRI_mr$COND$STAND_AGE &lt;- makeClasses(fiaRI_mr$COND$STDAGE, interval = 10)
carbon(db = fiaRI_mr,
       grpBy = STAND_AGE)


# Same as above, but implemented in parallel (much quicker)
# parallel::detectCores(logical = FALSE) # 4 cores available, we will take 2
# carbon(db = fiaRI_mr,
#        grpBy = STAND_AGE,
#        nCores = 2)


# Most recent estimates for all stems on forest land grouped by user-defined areal units
ctSF &lt;- carbon(fiaRI_mr,
               byPool = FALSE,
               polys = countiesRI,
               totals = TRUE,
               returnSpatial = TRUE)
plot(ctSF) # Plot multiple variables simultaneously
plotFIA(ctSF, CARB_TOTAL) # Plot of aboveground biomass per acre


</code></pre>

<hr>
<h2 id='clipFIA'>Spatial and temporal queries for FIADB
</h2><span id='topic+clipFIA'></span>

<h3>Description</h3>

<p>Performs space-time queries on Forest Inventory and Analysis Database (FIADB). Subset database to include only data associated with particular inventory years (i.e., most recent), and/or only data within a user-defined region. </p>


<h3>Usage</h3>

<pre><code class='language-R'>clipFIA(db, mostRecent = TRUE, mask = NULL, matchEval = FALSE,
        evalid = NULL, designCD = NULL, nCores = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="clipFIA_+3A_db">db</code></td>
<td>
<p><code>FIA.Database</code> or <code>Remote.FIA.Database</code> object produced from <code><a href="#topic+readFIA">readFIA</a></code> or <code><a href="#topic+getFIA">getFIA</a></code>. If a <code>Remote.FIA.Database</code>, data will be read in and processed state-by-state to conserve RAM (see details for an example).</p>
</td></tr>
<tr><td><code id="clipFIA_+3A_mostrecent">mostRecent</code></td>
<td>
<p>logical; if TRUE, returns only data for most recent inventory.</p>
</td></tr>
<tr><td><code id="clipFIA_+3A_mask">mask</code></td>
<td>
<p>sp or sf Polygon/MultiPolgyon object; defines the boundaries of spatial intersection with FIA tables.</p>
</td></tr>
<tr><td><code id="clipFIA_+3A_matcheval">matchEval</code></td>
<td>
<p>logical; if TRUE, returns subset of data for which there are matching reporting years across states. Only useful if db contains mulitple state subsets of the FIA database.</p>
</td></tr>
<tr><td><code id="clipFIA_+3A_evalid">evalid</code></td>
<td>
<p>character; unique value which identifies an inventory year and inventory type for a state. If you would like to subset data for an inventory year other than the most recent, use <code><a href="#topic+findEVALID">findEVALID</a></code> to look locate this value (see Examples below).</p>
</td></tr>
<tr><td><code id="clipFIA_+3A_designcd">designCD</code></td>
<td>
<p>character vector; plot designs to include. Default includes standard national plot design with other similar sampling designs. See FIA Database User Guide Appendix 1 for descriptions of plot designs (see References).</p>
</td></tr>
<tr><td><code id="clipFIA_+3A_ncores">nCores</code></td>
<td>
<p>numeric; number of cores to use for parallel implementation. Check available cores using <code><a href="parallel.html#topic+detectCores">detectCores</a></code>. Default = 1, serial processing.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Not required to run other <span class="pkg">rFIA</span> functions, but may help conserve free memory and reduce processing time if user is interested in producing estimates for a specific inventory year or within a region not explicitly described in the database (w/in user defined polygons).
</p>
<p>Spatial intersections do not adhere strictly to absolute plot locations, all plots which fall within an estimation unit (often a county) which intersects with a user defined region will be returned. The plots which fall slightly outside of the region do NOT bias estimates (removed from computations), but as FIA often employs stratified random sampling estimators, all plots within intersecting estimation units must be present to proudce unbiased variance estimates.
</p>
<p>If specifying spatio-temporal intersections on a <code>"Remote.FIA.Database"</code>, evaluation will occur state-by-state once called by an estimator function.
</p>


<h3>Value</h3>

<p>List object containing spatially intersected FIADB tables.
</p>


<h3>Author(s)</h3>

<p>Hunter Stanke and Andrew Finley
</p>


<h3>References</h3>

<p>FIA Database User Guide: <a href="https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi">https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+findEVALID">findEVALID</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Load data from rFIA package
data(fiaRI)

## Most recent inventory
clipFIA(fiaRI, mostRecent = TRUE)


## Only plots w/in estimation units w/in a user defined polygon
clipFIA(fiaRI, mask = countiesRI[1,], mostRecent = FALSE)


</code></pre>

<hr>
<h2 id='countiesRI'>County boundaries of Rhode Island</h2><span id='topic+countiesRI'></span>

<h3>Description</h3>

<p><code>sf</code> data frame representing county boundaries in the state of Rhode Island. Specify <code>countiesRI</code> as the <code>polys</code> argument with <code>fiaRI</code> as the <code>db</code> argument in any <code>rFIA</code> function to produce estimates summarized by these areal units within the state of Rhode Island. NOTE: the <code>countiesRI</code> object was updated in v1.1.0 to be of class <code>sf</code>. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("countiesRI")</code></pre>


<h3>Format</h3>

<p>Formal class sf 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(countiesRI)
</code></pre>

<hr>
<h2 id='customPSE'>Post-stratified estimator for custom variables in FIA Data</h2><span id='topic+customPSE'></span>

<h3>Description</h3>

<p>Produces estimates of population totals, ratios, and associated variances for custom variables using FIA's post-stratified inventories. Accepts tree- and condition-level summaries from rFIA estimator functions as input, with potential modifications to associated variables (e.g., custom allometrics can be applied to estimate tree biomass/carbon). See our website for example use cases.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>customPSE(db, x, xVars, xGrpBy = NULL, xTransform = NULL, y = NULL,
          yVars = NULL, yGrpBy = NULL, yTransform = NULL, method = "TI",
          lambda = 0.5, totals = TRUE, variance = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="customPSE_+3A_db">db</code></td>
<td>
<p><code>FIA.Database</code> or <code>Remote.FIA.Database</code> object produced from <code>readFIA()</code> or <code>getFIA()</code>. If a <code>Remote.FIA.Database</code>, data will be read in and processed state-by-state to conserve RAM (see details for an example).</p>
</td></tr>
<tr><td><code id="customPSE_+3A_x">x</code></td>
<td>
<p>data.frame; tree- or condition-list containing numerator variable(s). See details for more info on producing acceptable tree- and condition-lists using <code>rFIA</code> estimator functions.</p>
</td></tr>
<tr><td><code id="customPSE_+3A_xvars">xVars</code></td>
<td>
<p>name of variable(s) in <code>x</code> to be treated as numerator variables, unquoted. Multiple variables should be combined with <code>c()</code>, e.g., <code>xVars = c(TPA, BAA)</code>.</p>
</td></tr>
<tr><td><code id="customPSE_+3A_xgrpby">xGrpBy</code></td>
<td>
<p>names of variables in <code>x</code> to be treated as grouping variables for the numerator, unquoted. Multiple variables should be combined with <code>c()</code>, e.g., <code>xVars = c(SPCD, OWNGRPCD)</code>.</p>
</td></tr>
<tr><td><code id="customPSE_+3A_xtransform">xTransform</code></td>
<td>
<p>function to be applied to plot-level summaries of numerator variables, e.g., <code>sqrt</code> or <code>function(x){log(x + 0.001)}</code>.</p>
</td></tr>
<tr><td><code id="customPSE_+3A_y">y</code></td>
<td>
<p>data.frame; tree- or condition-list containing denominator variable. See details for more info on producing acceptable tree- and condition-lists using <code>rFIA</code> estimator functions.</p>
</td></tr>
<tr><td><code id="customPSE_+3A_yvars">yVars</code></td>
<td>
<p>name of variable in <code>y</code> to be treated as denominator variables, unquoted. Maximum one denominator variable allowed at this time.</p>
</td></tr>
<tr><td><code id="customPSE_+3A_ygrpby">yGrpBy</code></td>
<td>
<p>names of variables in <code>y</code> to be treated as grouping variables for the numerator, unquoted. Multiple variables should be combined with <code>c()</code>, e.g., <code>xVars = c(SPCD, OWNGRPCD)</code>.</p>
</td></tr>
<tr><td><code id="customPSE_+3A_ytransform">yTransform</code></td>
<td>
<p>function to be applied to plot-level summaries of denominator variable, e.g., <code>sqrt</code> or <code>function(x){log(x + 0.001)}</code>.</p>
</td></tr>
<tr><td><code id="customPSE_+3A_method">method</code></td>
<td>
<p>character; design-based estimator to use. One of:  &quot;TI&quot; (temporally indifferent, default), &quot;annual&quot; (annual), &quot;SMA&quot; (simple moving average), &quot;LMA&quot; (linear moving average), or &quot;EMA&quot; (exponential moving average). See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators.</p>
</td></tr>
<tr><td><code id="customPSE_+3A_lambda">lambda</code></td>
<td>
<p>numeric (0,1); if <code>method = 'EMA'</code>, the decay parameter used to define weighting scheme for annual panels. Low values place higher weight on more recent panels, and vice versa. Specify a vector of values to compute estimates using mulitple wieghting schemes, and use <code>plotFIA</code> with <code>grp</code> set to <code>lambda</code> to produce moving average ribbon plots. See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for examples.</p>
</td></tr>
<tr><td><code id="customPSE_+3A_totals">totals</code></td>
<td>
<p>logical; if TRUE, return total population estimates (e.g. total area) along with ratio estimates (e.g. mean trees per acre).</p>
</td></tr>
<tr><td><code id="customPSE_+3A_variance">variance</code></td>
<td>
<p>logical; if TRUE, return estimated variance (<code>VAR</code>) and sample size (<code>N</code>). If FALSE, return 'sampling error' (<code>SE</code>) as returned by EVALIDator. Note: sampling error cannot be used to construct confidence intervals.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Workflow and intended use cases</strong>
</p>
<p><code>customPSE</code> is intended to be used in combination with standard rFIA estimator functions, like <code>tpa()</code>, <code>area()</code>, and <code>volume()</code>, among others. Standard rFIA estimator functions generate tree- and or condition-lists for standard variables of interest (see <code>treeList</code> and <code>condList</code> arguments in estimator functions). Users may make modifications to these standard variables, for example a variable representing tree crown area may be added to a tree-list produced by <code>tpa()</code> (via some suite of allometrics). Users may then hand their modified tree-list to <code>customPSE</code> to estimate the total and proportion of forested land area in their domain of interest that is covered by tree crowns.
</p>
<p><code>customPSE</code> may be used to estimate population totals for multiple variables simultaneously (total number of trees in a region), and given a denominator variable, the associated population ratios (trees per forested acre, where forested land area is the denominator). Estimation follows the procedures documented in Bechtold and Patterson (2005) and <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a>.
</p>
<p>Three general forms of ratio estimates may be produced: tree-tree, tree-area, and area-area ratios. For example, if tree height is specified as the numerator variable (adjusted for sampling area by multiplying by TPA), and TPA is specified as the denominator variable, a tree-tree ratio will be produced that represents the height of the average tree within a region of interest. Similarly, if stand age is specified as the numerator (adjusted for sampling area by proportionate area of the forested condition on the plot, i.e., <code>PROP_FOREST</code>), and the proportion area of the plot that is forested is specified as the denominator, an area-area ratio will be produced that represents average stand age within the region of interest. Tree-area ratios are more familiar, such as trees per acre, tree biomass per acre, etc, where a tree variable is specified as the numerator, and proportion of plot area occupied by forestland is the denominator. See our website for detailed examples of each of these ratio estimates.
</p>
<p><strong>Input requirements</strong>
</p>
<p>Estimation of tree variables require the following columns be present in <code>x</code> and/or <code>y</code>: PLT_CN, EVAL_TYP, SUBP, TREE, and TREE_BASIS. Similarly, estimation of area variables require the following columns be present in <code>x</code> and/or <code>y</code>: PLT_CN, EVAL_TYP, CONDID, and AREA_BASIS. Each of these required variables will be returned in tree- and condition-lists generated by standard rFIA estimator functions.
</p>
<p>IMPORTANT: Only one of TREE_BASIS or AREA_BASIS may be present <code>x</code> or <code>y</code>, as the presence of these columns are used to determine if variables to be estimated are tree variables or area variables. Some standard rFIA estimator functions will produce tree-lists with both TREE_BASIS and AREA_BASIS listed in output, as the tree-list will contain tree variables (e.g., TPA, BAA) as well as area variables (e.g., PROP_FOREST, proportion of plot represented by the forested condition where each tree is growing)). To produce a tree-area ratio with such an output, AREA_BASIS must be removed from the data.frame specified in <code>x</code>, and TREE_BASIS must be removed from that specified in <code>y</code>.
</p>


<h3>Value</h3>


<ul>
<li><p><strong>YEAR</strong>: reporting year associated with estimates
</p>
</li>
<li><p><strong>*_RATIO</strong>: population ratio estimate, where * will be replaced with the name of each numerator variable
</p>
</li>
<li><p><strong>*_TOTAL</strong>: population total estimate, where * will be replaced with the name of each numerator/ denominator variable
</p>
</li>
<li><p><strong>*_RATIO_VAR</strong>: estimated variance of the population ratio
</p>
</li>
<li><p><strong>*_TOTAL_VAR</strong>: estimated variance of the population total
</p>
</li>
<li><p><strong>nPlots_x</strong>: number of non-zero plots used to compute numerator estimates
</p>
</li>
<li><p><strong>nPlots_y</strong>: number of non-zero plots used to compute denominator estimates
</p>
</li>
<li><p><strong>N</strong>: total number of plots (including zeros) associated with each inventory
</p>
</li></ul>



<h3>Note</h3>

<p>All sampling error estimates (SE) are returned as the &quot;percent coefficient of variation&quot; (standard deviation / mean * 100) for consistency with EVALIDator. IMPORTANT: sampling error cannot be used to construct confidence intervals. Please use <code>variance = TRUE</code> for that (i.e., return variance and sample size instead of sampling error).</p>


<h3>Author(s)</h3>

<p>Hunter Stanke and Andrew Finley
</p>


<h3>References</h3>

<p>rFIA website: <a href="https://doserlab.com/files/rfia/">https://doserlab.com/files/rfia/</a>
</p>
<p>FIA Database User Guide: <a href="https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi">https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi</a>
</p>
<p>Bechtold, W.A.; Patterson, P.L., eds. 2005. The Enhanced Forest Inventory and Analysis Program - National Sampling Design and Estimation Procedures. Gen. Tech. Rep. SRS - 80. Asheville, NC: U.S. Department of Agriculture, Forest Service, Southern Research Station. 85 p. <a href="https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf">https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf</a>
</p>
<p>Stanke, H., Finley, A. O., Weed, A. S., Walters, B. F., &amp; Domke, G. M. (2020). rFIA: An R package for estimation of forest attributes with the US Forest Inventory and Analysis database. Environmental Modelling &amp; Software, 127, 104664.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# See our website for a more thorough suite of examples
data(fiaRI)

# Get tree-list from tpa
tree.list &lt;- tpa(fiaRI,
                 treeList = TRUE)

# Estimate trees per acre and basal area per acre
customPSE(db = fiaRI,
          # Numerator variables
          x = dplyr::select(tree.list, -c(AREA_BASIS)),
          xVars = c(TPA, BAA),
          # Denominator variables
          y = dplyr::select(tree.list, -c(TREE_BASIS)),
          yVars = PROP_FOREST)

# Same as above, but rename variables for a clean output
# customPSE(db = fiaRI,
#           x = dplyr::select(tree.list, -c(AREA_BASIS)),
#           # Variables can be renamed using c()
#           xVars = c(NUM = TPA,
#                     BA = BAA),
#           y = dplyr::select(tree.list, -c(TREE_BASIS)),
#           # Variables can be renamed using c()
#           yVars = c(FOREST_AREA = PROP_FOREST))
# 
# # Ensure the above matches expected output
# tpa(fiaRI,
#     totals = TRUE,
#     variance = TRUE)

</code></pre>

<hr>
<h2 id='diversity'>Estimate diversity from FIADB</h2><span id='topic+diversity'></span>

<h3>Description</h3>

<p>Produces estimates of diversity from FIA data. Returns Shannon's index, Shannon's equitability, and richness for alpha (mean/SE of stands), beta, and gamma diversity. Default behavior estimates species diversity, using <code>TPA_UNADJ</code> (trees per acre) as a state variable and <code>SPCD</code> (species) to groups of individuals. Estimates can be produced for regions defined within the FIA Database (e.g. counties), at the plot level, or within user-defined areal units. Options to group estimates by size class and other variables defined in the FIADB. If multiple reporting years (EVALIDs) are included in the data, estimates will be output as a time series. If multiple states are represented by the data, estimates will be output for the full region (all area combined), unless specified otherwise (e.g. <code>grpBy = STATECD</code>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>diversity(db, grpBy = NULL, polys = NULL, returnSpatial = FALSE, bySizeClass = FALSE,
          landType = 'forest', treeType = 'live', method = 'TI', lambda = 0.5,
          stateVar = TPA_UNADJ, grpVar = SPCD, treeDomain = NULL,
          areaDomain = NULL, byPlot = FALSE, condList = FALSE, totals = FALSE,
          variance = FALSE, nCores = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="diversity_+3A_db">db</code></td>
<td>
<p><code>FIA.Database</code> or <code>Remote.FIA.Database</code> object produced from <code><a href="#topic+readFIA">readFIA</a></code> or <code><a href="#topic+getFIA">getFIA</a></code>. If a <code>Remote.FIA.Database</code>, data will be read in and processed state-by-state to conserve RAM (see details for an example).</p>
</td></tr>
<tr><td><code id="diversity_+3A_grpby">grpBy</code></td>
<td>
<p>variables from PLOT, COND, or TREE tables to group estimates by (NOT quoted). Multiple grouping variables should be combined with <code>c()</code>, and grouping will occur heirarchically. For example, to produce seperate estimates for each ownership group within methods of stand regeneration, specify <code>c(STDORGCD, OWNGRPCD)</code>.</p>
</td></tr>
<tr><td><code id="diversity_+3A_polys">polys</code></td>
<td>
<p><code>sp</code> or <code>sf</code> Polygon/MultiPolgyon object; Areal units to bin data for estimation. Seperate estimates will be produced for region encompassed by each areal unit. FIA plot locations will be reprojected to match projection of <code>polys</code> object.</p>
</td></tr>
<tr><td><code id="diversity_+3A_returnspatial">returnSpatial</code></td>
<td>
<p>logical; if TRUE, merge population estimates with <code>polys</code> and return as <code>sf</code> multipolygon object. When <code>byPlot = TRUE</code>, return plot-level estimates as <code>sf</code> spatial points.</p>
</td></tr>
<tr><td><code id="diversity_+3A_bysizeclass">bySizeClass</code></td>
<td>
<p>logical; if TRUE, returns estimates grouped by size class (default 2-inch intervals, see <code><a href="#topic+makeClasses">makeClasses</a></code> to compute other size class intervals).</p>
</td></tr>
<tr><td><code id="diversity_+3A_landtype">landType</code></td>
<td>
<p>character ('forest' or 'timber'); Type of land which estimates will be produced for. Timberland is a subset of forestland (default) which has high site potential and non-reserve status (see details).</p>
</td></tr>
<tr><td><code id="diversity_+3A_treetype">treeType</code></td>
<td>
<p>character (&quot;all&quot;, &quot;live&quot;, &quot;dead&quot;, or &quot;gs&quot;); Type of tree which estimates will be produced for. All includes all stems, live and dead, greater than 1 in. DBH. Live/Dead includes all stems greater than 1 in. DBH which are live (default) or dead (leaning less than 45 degrees), respectively. GS (growing-stock) includes live stems greater than 5 in. DBH which contain at least one 8 ft merchantable log.</p>
</td></tr>
<tr><td><code id="diversity_+3A_method">method</code></td>
<td>
<p>character; design-based estimator to use. One of:  &quot;TI&quot; (temporally indifferent, default), &quot;annual&quot; (annual), &quot;SMA&quot; (simple moving average), &quot;LMA&quot; (linear moving average), or &quot;EMA&quot; (exponential moving average). See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators.</p>
</td></tr>
<tr><td><code id="diversity_+3A_lambda">lambda</code></td>
<td>
<p>numeric (0,1); if <code>method = 'EMA'</code>, the decay parameter used to define weighting scheme for annual panels. Low values place higher weight on more recent panels, and vice versa. Specify a vector of values to compute estimates using mulitple wieghting schemes, and use <code>plotFIA</code> with <code>grp</code> set to <code>lambda</code> to produce moving average ribbon plots. See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for examples.</p>
</td></tr>
<tr><td><code id="diversity_+3A_statevar">stateVar</code></td>
<td>
<p>variable from TREE table to use as state variable (NOT quoted). Default, <code>TPA_UNADJ</code>. Try, <code>DRYBIO_AG</code> for aboveground biomass, <code>pi*(DIA/2)^2</code> for basal area, or others.</p>
</td></tr>
<tr><td><code id="diversity_+3A_grpvar">grpVar</code></td>
<td>
<p>factor, variable from TREE table to define individual groups (NOT quoted). Default, <code>SPCD</code>. Try, <code>SPGRPCD</code> for species group, <code>makeClasses(db$TREE$DIA, interval = 2)</code> for diameter class, or others.</p>
</td></tr>
<tr><td><code id="diversity_+3A_treedomain">treeDomain</code></td>
<td>
<p>logical predicates defined in terms of the variables in PLOT, TREE, and/or COND tables. Used to define the type of trees for which estimates will be produced (e.g. DBH greater than 20 inches: <code>DIA &gt; 20</code>, Dominant/Co-dominant crowns only: <code>CCLCD %in% c(2,3)</code>. Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only trees where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="diversity_+3A_areadomain">areaDomain</code></td>
<td>
<p>logical predicates defined in terms of the variables in PLOT and/or COND tables. Used to define the area for which estimates will be produced (e.g. within 1 mile of improved road: <code>RDDISTCD %in% c(1:6)</code>, Hard maple/basswood forest type: <code>FORTYPCD == 805</code>. Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only plots within areas where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="diversity_+3A_totals">totals</code></td>
<td>
<p>logical; if TRUE, return total population estimates (e.g. total area) along with ratio estimates (e.g. mean trees per acre).</p>
</td></tr>
<tr><td><code id="diversity_+3A_variance">variance</code></td>
<td>
<p>logical; if TRUE, return estimated variance (<code>VAR</code>) and sample size (<code>N</code>). If FALSE, return 'sampling error' (<code>SE</code>) as returned by EVALIDator. Note: sampling error cannot be used to construct confidence intervals.</p>
</td></tr>
<tr><td><code id="diversity_+3A_byplot">byPlot</code></td>
<td>
<p>logical; if TRUE, returns estimates for individual plot locations instead of population estimates.</p>
</td></tr>
<tr><td><code id="diversity_+3A_condlist">condList</code></td>
<td>
<p>logical; if TRUE, returns condition-level summaries intended for subsequent use with <code>customPSE</code>.</p>
</td></tr>
<tr><td><code id="diversity_+3A_ncores">nCores</code></td>
<td>
<p>numeric; number of cores to use for parallel implementation. Check available cores using <code><a href="parallel.html#topic+detectCores">detectCores</a></code>. Default = 1, serial processing.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Estimation Details</strong>
</p>
<p>Estimation of forest variables follows the procedures documented in Bechtold and Patterson (2005) and <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a>. Procedures for computing diversity indices are outlined in Hill (1973) and Shannon (1948).
</p>
<p>Alpha-level indices are computed as the mean diversity of a stand. Specifically, alpha diversity is estimated using a sample-based ratio-of-means estimator of stand diversity (e.g. Richness) * land area of stand / total land area within the domain of interest. Thus estimates of alpha diversity within a stand are weighted by the area that stand represents. Gamma-level diversity is computed as a regional index, pooling all plot data together. Beta diversity is computed as gamma diversity - alpha diversity, and thus represents the excess of regional diversity with respect to local diversity.
</p>
<p>Users may specify alternatives to the 'Temporally Indifferent' estimator using the <code>method</code> argument. Alternative design-based estimators include the annual estimator (&quot;ANNUAL&quot;; annual panels, or estimates from plots measured in the same year), simple moving average (&quot;SMA&quot;; combines annual panels with equal weight), linear moving average (&quot;LMA&quot;; combine annual panels with weights that decay <em>linearly</em> with time since measurement), and exponential moving average (&quot;EMA&quot;; combine annual panels with weights that decay <em>exponentially</em> with time since measurement). The &quot;best&quot; estimator depends entirely on user-objectives, see <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators and tradeoffs between precision and temporal specificity.
</p>
<p>When <code>byPlot = FALSE</code> (i.e., population estimates are returned), the &quot;YEAR&quot; column in the resulting dataframe indicates the final year of the inventory cycle that estimates are produced for. For example, an estimate of current forest area (e.g., 2018) may draw on data collected from 2008-2018, and &quot;YEAR&quot; will be listed as 2018 (consistent with EVALIDator). However, when <code>byPlot = TRUE</code> (i.e., plot-level estimates returned), the &quot;YEAR&quot; column denotes the year that each plot was measured (MEASYEAR), which may differ slightly from its associated inventory year (INVYR).
</p>
<p>Stratified random sampling techniques are most often employed to compute estimates in recent inventories, although double sampling and simple random sampling may be employed for early inventories. Estimates are adjusted for non-response bias by assuming attributes of non-response plot locations to be equal to the mean of other plots included within thier respective stratum or population.
</p>
<p><strong>Working with &quot;Big Data&quot;</strong>
</p>
<p>If FIA data are too large to hold in memory (e.g., R throws the &quot;cannot allocate vector of size ...&quot; error), use larger-than-RAM options. See documentation of <code>link{readFIA}</code> for examples of how to set up a <code>Remote.FIA.Database</code>. As a reference, we have used rFIA's larger-than-RAM methods to estimate forest variables using the entire FIA Database (~50GB) on a standard desktop computer with 16GB of RAM. Check out <a href="https://doserlab.com/files/rfia/">our website</a> for more details and examples.
</p>
<p>Easy, efficient parallelization is implemented with the <code><a href="parallel.html#topic+parallel">parallel</a></code> package. Users must only specify the <code>nCores</code> argument with a value greater than 1 in order to implement parallel processing on their machines. Parallel implementation is achieved using a snow type cluster on any Windows OS, and with multicore forking on any Unix OS (Linux, Mac). Implementing parallel processing may substantially decrease free memory during processing, particularly on Windows OS. Thus, users should be cautious when running in parallel, and consider implementing serial processing for this task if computational resources are limited (<code>nCores = 1</code>).
</p>
<p><strong>Definition of forestland</strong>
</p>
<p>Forest land must have at least 10-percent canopy cover by live tally trees of any size, including land that formerly had such tree cover and that will be naturally or artificially regenerated. Forest land includes transition zones, such as areas between heavily forest and non-forested lands that meet the mimium tree canopy cover and forest areas adjacent to urban and built-up lands. The minimum area for classification of forest land is 1 acre in size and 120 feet wide measured stem-to-stem from the outer-most edge. Roadside, streamside, and shelterbelt strips of trees must have a width of at least 120 feet and continuous length of at least 363 feet to qualify as forest land. Tree-covered areas in agricultural production settings, such as fruit orchards, or tree-covered areas in urban settings, such as city parks, are not considered forest land.
</p>
<p>Timber land is a subset of forest land that is producing or is capable of producing crops of industrial wood and not withdrawn from timber utilization by statute or administrative regulation. (Note: Areas qualifying as timberland are capable of producing at least 20 cubic feet per acre per year of industrial wood in natural stands. Currently inaccessible and inoperable areas are NOT included).
</p>


<h3>Value</h3>

<p>Dataframe or sf object (if <code>returnSpatial = TRUE</code>). If <code>byPlot = TRUE</code>, values are returned for each plot (<code>PLOT_STATUS_CD = 1</code> when forest exists at the plot location). All variables with names ending in <code>SE</code>, represent the estimate of sampling error (%) of the variable. When <code>variance = TRUE</code>, variables ending in <code>VAR</code> denote the variance of the variable and <code>N</code> is the total sample size (i.e., including non-zero plots).
</p>

<ul>
<li><p><strong>H_a</strong>: mean Shannon's Diversity Index, alpha (stand) level
</p>
</li>
<li><p><strong>H_b</strong>: Shannon's Diversity Index, beta (landscape) level
</p>
</li>
<li><p><strong>H_g</strong>: Shannon's Diversity Index, gamma (regional) level
</p>
</li>
<li><p><strong>Eh_a</strong>: mean Shannon's Equitability Index, alpha (stand) level
</p>
</li>
<li><p><strong>Eh_b</strong>: Shannon's Equitability Index, beta (landscape) level
</p>
</li>
<li><p><strong>Eh_g</strong>: Shannon's Equitability Index, gamma (regional) level
</p>
</li>
<li><p><strong>S_a</strong>: mean Species Richness, alpha (stand) level
</p>
</li>
<li><p><strong>S_b</strong>: Species Richness, beta (landscape) level
</p>
</li>
<li><p><strong>S_g</strong>: Species Richness, gamma (regional) level
</p>
</li>
<li><p><strong>nStands</strong>: number of stands with non-zero plots used to compute alpha diversity estimates
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Hunter Stanke and Andrew Finley
</p>


<h3>References</h3>

<p>rFIA website: <a href="https://doserlab.com/files/rfia/">https://doserlab.com/files/rfia/</a>
</p>
<p>FIA Database User Guide: <a href="https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi">https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi</a>
</p>
<p>Bechtold, W.A.; Patterson, P.L., eds. 2005. The Enhanced Forest Inventory and Analysis Program - National Sampling Design and Estimation Procedures. Gen. Tech. Rep. SRS - 80. Asheville, NC: U.S. Department of Agriculture, Forest Service, Southern Research Station. 85 p. <a href="https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf">https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf</a>
</p>
<p>Stanke, H., Finley, A. O., Weed, A. S., Walters, B. F., &amp; Domke, G. M. (2020). rFIA: An R package for estimation of forest attributes with the US Forest Inventory and Analysis database. Environmental Modelling &amp; Software, 127, 104664.
</p>
<p>Analysis of ecological communities. (2002). United States: M G M SOFTWARE DESIGN (OR).
</p>
<p>Hill, M. O. (1973). Diversity and Evenness: A Unifying Notation and Its Consequences. Ecology, 54(2), 427-432. doi:10.2307/1934352.
</p>
<p>Shannon, C. E. (1948). A Mathematical Theory of Communication. Bell System Technical Journal, 27(3), 379-423. doi:10.1002/j.1538-7305.1948.tb01338.x.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load data from rFIA package
data(fiaRI)
data(countiesRI)

# Make a most recent subset
fiaRI_mr &lt;- clipFIA(fiaRI)

# Most recent estimates for live stems on forest land
diversity(db = fiaRI_mr,
          landType = 'forest',
          treeType = 'live')


# Same as above at the plot-level
diversity(db = fiaRI_mr,
          landType = 'forest',
          treeType = 'live',
          byPlot = TRUE)

# Most recent estimates grouped by stand age on forest land
# Make a categorical variable which represents stand age (grouped by 10 yr intervals)
fiaRI_mr$COND$STAND_AGE &lt;- makeClasses(fiaRI_mr$COND$STDAGE, interval = 10)
diversity(db = fiaRI_mr,
          grpBy = STAND_AGE)

# Estimates for live white pine ( &gt; 12" DBH) on forested mesic sites (all available inventories)
diversity(fiaRI,
          treeType = 'live',
          treeDomain = DIA &gt; 12,
          areaDomain = PHYSCLCD %in% 21:29) # Mesic Physiographic classes

# Most recent estimates for growing-stock on timber land by size class
diversity(db = fiaRI_mr,
          landType = 'timber',
          treeType = 'gs',
          bySizeClass = TRUE)

# Same as above, implemented in parallel
# parallel::detectCores(logical = FALSE) # 4 cores available, we will take 2
# diversity(db = fiaRI_mr,
#           landType = 'timber',
#           treeType = 'gs',
#           bySizeClass = TRUE,
#           nCores = 2)

# Most recent estimates for live stems on forest land grouped by user-defined areal units
ctSF &lt;- diversity(clipFIA(fiaRI, mostRecent = TRUE),
                  polys = countiesRI,
                  returnSpatial = TRUE)
plot(ctSF) # Plot multiple variables simultaneously
plotFIA(ctSF, H_a) # Plot of mean Shannons Index of stands


</code></pre>

<hr>
<h2 id='dwm'>Estimate volume, biomass, and carbon stocks of down woody material (fuels) from FIADB
</h2><span id='topic+dwm'></span>

<h3>Description</h3>

<p>Produces estimates of down woody material stocks on a per acre basis from the Forest Inventory and Analysis Database (FIADB), along with population totals for each variable. Estimates can be returned by fuel class (duff, litter, 1HR, 10HR, 100HR, 1000HR, piles) for application in fuels management. Estimates can be produced for regions defined within the FIA Database (e.g. counties), at the plot level, or within user-defined areal units. If multiple reporting years (EVALIDs) are included in the data, estimates will be output as a time series. If multiple states are represented by the data, estimates will be output for the full region (all area combined), unless specified otherwise (e.g. <code>grpBy = STATECD</code>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dwm(db, grpBy = NULL, polys = NULL, returnSpatial = FALSE, landType = 'forest',
    method = 'TI', lambda = 0.5, areaDomain = NULL, totals = FALSE,
    variance = FALSE, byPlot = FALSE, condList = FALSE,
    byFuelType = TRUE, nCores = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dwm_+3A_db">db</code></td>
<td>
<p><code>FIA.Database</code> or <code>Remote.FIA.Database</code> object produced from <code><a href="#topic+readFIA">readFIA</a></code> or <code><a href="#topic+getFIA">getFIA</a></code>. If a <code>Remote.FIA.Database</code>, data will be read in and processed state-by-state to conserve RAM (see details for an example).</p>
</td></tr>
<tr><td><code id="dwm_+3A_grpby">grpBy</code></td>
<td>
<p>variables from PLOT or COND tables to group estimates by (NOT quoted). Multiple grouping variables should be combined with <code>c()</code>, and grouping will occur heirarchically. For example, to produce seperate estimates for each ownership group within methods of stand regeneration, specify <code>c(STDORGCD, OWNGRPCD)</code>.</p>
</td></tr>
<tr><td><code id="dwm_+3A_polys">polys</code></td>
<td>
<p><code>sp</code> or <code>sf</code> Polygon/MultiPolgyon object; Areal units to bin data for estimation. Separate estimates will be produced for region encompassed by each areal unit. FIA plot locations will be reprojected to match projection of <code>polys</code> object.</p>
</td></tr>
<tr><td><code id="dwm_+3A_returnspatial">returnSpatial</code></td>
<td>
<p>logical; if TRUE, merge population estimates with <code>polys</code> and return as <code>sf</code> multipolygon object. When <code>byPlot = TRUE</code>, return plot-level estimates as <code>sf</code> spatial points.</p>
</td></tr>
<tr><td><code id="dwm_+3A_landtype">landType</code></td>
<td>
<p>character (&quot;forest&quot; or &quot;timber&quot;); Type of land that estimates will be produced for. Timberland is a subset of forestland (default) which has high site potential and non-reserve status (see details).</p>
</td></tr>
<tr><td><code id="dwm_+3A_method">method</code></td>
<td>
<p>character; design-based estimator to use. One of:  &quot;TI&quot; (temporally indifferent, default), &quot;annual&quot; (annual), &quot;SMA&quot; (simple moving average), &quot;LMA&quot; (linear moving average), or &quot;EMA&quot; (exponential moving average). See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators.</p>
</td></tr>
<tr><td><code id="dwm_+3A_lambda">lambda</code></td>
<td>
<p>numeric (0,1); if <code>method = 'EMA'</code>, the decay parameter used to define weighting scheme for annual panels. Low values place higher weight on more recent panels, and vice versa. Specify a vector of values to compute estimates using mulitple wieghting schemes, and use <code>plotFIA</code> with <code>grp</code> set to <code>lambda</code> to produce moving average ribbon plots. See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for examples.</p>
</td></tr>
<tr><td><code id="dwm_+3A_areadomain">areaDomain</code></td>
<td>
<p>Logical predicates defined in terms of the variables in PLOT and/or COND tables. Used to define the area for which estimates will be produced (e.g. within 1 mile of improved road: <code>RDDISTCD %in% c(1:6)</code>, Hard maple/basswood forest type: <code>FORTYPCD == 805</code>. Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only plots within areas where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="dwm_+3A_totals">totals</code></td>
<td>
<p>logical; if TRUE, return total population estimates (e.g. total area) along with ratio estimates (e.g. mean trees per acre).</p>
</td></tr>
<tr><td><code id="dwm_+3A_variance">variance</code></td>
<td>
<p>logical; if TRUE, return estimated variance (<code>VAR</code>) and sample size (<code>N</code>). If FALSE, return 'sampling error' (<code>SE</code>) as returned by EVALIDator. Note: sampling error cannot be used to construct confidence intervals.</p>
</td></tr>
<tr><td><code id="dwm_+3A_byplot">byPlot</code></td>
<td>
<p>logical; if TRUE, returns estimates for individual plot locations instead of population estimates.</p>
</td></tr>
<tr><td><code id="dwm_+3A_condlist">condList</code></td>
<td>
<p>logical; if TRUE, returns condition-level summaries intended for subsequent use with <code>customPSE</code>.</p>
</td></tr>
<tr><td><code id="dwm_+3A_byfueltype">byFuelType</code></td>
<td>
<p>logical; if TRUE, returns estimates grouped by fuel type (e.g., 1HR, 10HR, 100HR, 1000HR fuels). </p>
</td></tr>
<tr><td><code id="dwm_+3A_ncores">nCores</code></td>
<td>
<p>numeric; number of cores to use for parallel implementation. Check available cores using <code><a href="parallel.html#topic+detectCores">detectCores</a></code>. Default = 1, serial processing.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Estimation Details</strong>
</p>
<p>Estimation of forest variables follows the procedures documented in Bechtold and Patterson (2005) and <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a>. Specifically, per acre estimates are computed using a sample-based ratio-of-means estimator of total volume (biomass or carbon) / total land area within the domain of interest.
</p>
<p>As defined by FIA, down woody material includes dead organic materials (resulting from plant mortality and leaf turnover) and fuel complexes of live shrubs and herbs. To maintain relevance for forest fuels management, we by default report estimates grouped by fuel lag-time classes. Specifically, we report estimates for 1HR fuels (small, fine woody debris), 10HR fuels (medium, fine woody debris), 100HR fuels (large, fine woody debris), 1000HR fuels (coarse woody debris), and slash piles, in addition to duff (O horizon; all unidentifiable organic material above mineral soil, beneath litter) and litter (identifiable plant material which is downed and smaller than 10HR fuel class (1HR class includes standing herbaceous material). See Woodall and Monleon (2007) for definitions of fuel lag-time classes and for details on sampling and estimation procedures.
</p>
<p>Users may specify alternatives to the 'Temporally Indifferent' estimator using the <code>method</code> argument. Alternative design-based estimators include the annual estimator (&quot;ANNUAL&quot;; annual panels, or estimates from plots measured in the same year), simple moving average (&quot;SMA&quot;; combines annual panels with equal weight), linear moving average (&quot;LMA&quot;; combine annual panels with weights that decay <em>linearly</em> with time since measurement), and exponential moving average (&quot;EMA&quot;; combine annual panels with weights that decay <em>exponentially</em> with time since measurement). The &quot;best&quot; estimator depends entirely on user-objectives, see <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators and tradeoffs between precision and temporal specificity.
</p>
<p>When <code>byPlot = FALSE</code> (i.e., population estimates are returned), the &quot;YEAR&quot; column in the resulting dataframe indicates the final year of the inventory cycle that estimates are produced for. For example, an estimate of current forest area (e.g., 2018) may draw on data collected from 2008-2018, and &quot;YEAR&quot; will be listed as 2018 (consistent with EVALIDator). However, when <code>byPlot = TRUE</code> (i.e., plot-level estimates returned), the &quot;YEAR&quot; column denotes the year that each plot was measured (MEASYEAR), which may differ slightly from its associated inventory year (INVYR).
</p>
<p>Stratified random sampling techniques are most often employed to compute estimates in recent inventories, although double sampling and simple random sampling may be employed for early inventories. Estimates are adjusted for non-response bias by assuming attributes of non-response plot locations to be equal to the mean of other plots included within thier respective stratum or population.
</p>
<p><strong>Working with &quot;Big Data&quot;</strong>
</p>
<p>If FIA data are too large to hold in memory (e.g., R throws the &quot;cannot allocate vector of size ...&quot; errors), use larger-than-RAM options. See documentation of <code>link{readFIA}</code> for examples of how to set up a <code>Remote.FIA.Database</code>. As a reference, we have used rFIA's larger-than-RAM methods to estimate forest variables using the entire FIA Database (~50GB) on a standard desktop computer with 16GB of RAM. Check out <a href="https://doserlab.com/files/rfia/">our website</a> for more details and examples.
</p>
<p>Easy, efficient parallelization is implemented with the <code><a href="parallel.html#topic+parallel">parallel</a></code> package. Users must only specify the <code>nCores</code> argument with a value greater than 1 in order to implement parallel processing on their machines. Parallel implementation is achieved using a snow type cluster on any Windows OS, and with multicore forking on any Unix OS (Linux, Mac). Implementing parallel processing may substantially decrease free memory during processing, particularly on Windows OS. Thus, users should be cautious when running in parallel, and consider implementing serial processing for this task if computational resources are limited (<code>nCores = 1</code>).
</p>
<p><strong>Definition of forestland</strong>
</p>
<p>Forest land must have at least 10-percent canopy cover by live tally trees of any size, including land that formerly had such tree cover and that will be naturally or artificially regenerated. Forest land includes transition zones, such as areas between heavily forest and non-forested lands that meet the mimium tree canopy cover and forest areas adjacent to urban and built-up lands. The minimum area for classification of forest land is 1 acre in size and 120 feet wide measured stem-to-stem from the outer-most edge. Roadside, streamside, and shelterbelt strips of trees must have a width of at least 120 feet and continuous length of at least 363 feet to qualify as forest land. Tree-covered areas in agricultural production settings, such as fruit orchards, or tree-covered areas in urban settings, such as city parks, are not considered forest land.
</p>
<p>Timber land is a subset of forest land that is producing or is capable of producing crops of industrial wood and not withdrawn from timber utilization by statute or administrative regulation. (Note: Areas qualifying as timberland are capable of producing at least 20 cubic feet per acre per year of industrial wood in natural stands. Currently inaccessible and inoperable areas are NOT included).
</p>


<h3>Value</h3>

<p>Dataframe or sf object (if <code>returnSpatial = TRUE</code>). If <code>byPlot = TRUE</code>, values are returned for each plot (<code>PLOT_STATUS_CD = 1</code> when forest exists at the plot location). All variables with names ending in <code>SE</code>, represent the estimate of sampling error (%) of the variable. When <code>variance = TRUE</code>, variables ending in <code>VAR</code> denote the variance of the variable and <code>N</code> is the total sample size (i.e., including non-zero plots).
</p>

<ul>
<li><p><strong>YEAR</strong>: reporting year associated with estimates
</p>
</li>
<li><p><strong>FUEL_TYPE</strong>: fuel type associated with each row
</p>
</li>
<li><p><strong>VOL_ACRE</strong>: estimate of mean volume per acre of dwm (cu.ft/acre)
</p>
</li>
<li><p><strong>BIO_ACRE</strong>: estimate of mean biomass per acre of dwm (short tons/acre)
</p>
</li>
<li><p><strong>CARB_ACRE</strong>: estimate of mean carbon mass per acre of dwm (short tons/acre)
</p>
</li>
<li><p><strong>nPlots</strong>: number of non-zero plots used to compute estimates
</p>
</li></ul>



<h3>Note</h3>

<p>All sampling error estimates (SE) are returned as the &quot;percent coefficient of variation&quot; (standard deviation / mean * 100) for consistency with EVALIDator. IMPORTANT: sampling error cannot be used to construct confidence intervals. Please use <code>variance = TRUE</code> for that (i.e., return variance and sample size instead of sampling error).</p>


<h3>Author(s)</h3>

<p>Hunter Stanke and Andrew Finley
</p>


<h3>References</h3>

<p>rFIA website: <a href="https://doserlab.com/files/rfia/">https://doserlab.com/files/rfia/</a>
</p>
<p>FIA Database User Guide: <a href="https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi">https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi</a>
</p>
<p>Bechtold, W.A.; Patterson, P.L., eds. 2005. The Enhanced Forest Inventory and Analysis Program - National Sampling Design and Estimation Procedures. Gen. Tech. Rep. SRS - 80. Asheville, NC: U.S. Department of Agriculture, Forest Service, Southern Research Station. 85 p. <a href="https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf">https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf</a>
</p>
<p>Stanke, H., Finley, A. O., Weed, A. S., Walters, B. F., &amp; Domke, G. M. (2020). rFIA: An R package for estimation of forest attributes with the US Forest Inventory and Analysis database. Environmental Modelling &amp; Software, 127, 104664.
</p>
<p>Woodall, C.; Monleon, V.J., eds. 2007. Sampling Protocol, Estimation, and Analysis Procedures for the Down Woody Materials Indicator of the FIA Program. Gen. Tech. Rep. NRS - 22. ewtown Square, PA: U.S. Department of Agriculture, Forest Service, Northern Research Station. <a href="https://research.fs.usda.gov/treesearch/13615">https://research.fs.usda.gov/treesearch/13615</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load data from rFIA package
data(fiaRI)
data(countiesRI)

# Most recents subset
fiaRI_mr &lt;- clipFIA(fiaRI)

# Most recent estimates
dwm(fiaRI_mr)


# Same as above at the plot-level
# Most recent estimates
dwm(fiaRI_mr, byPlot = TRUE)

# Estimates of all forestland, over time
dwm(fiaRI)

# Estimates of all forestland on mesic sites (most recent)
dwm(fiaRI_mr,
    areaDomain = PHYSCLCD %in% 21:29)

# Estimates of all forestland by owner group (most recent subset)
dwm(fiaRI_mr,
    grpBy = OWNGRPCD)

# Estimates of all forestland by county and return
# return spatial object
dwmSF &lt;- dwm(fiaRI_mr,
             polys = countiesRI,
             returnSpatial = TRUE)
plot(dwmSF)
plotFIA(dwmSF, BIO_ACRE) # TOTAL BIOMASS / ACRE (tons)


</code></pre>

<hr>
<h2 id='fiaRI'>FIADB for Rhode Island 2013 - 2018</h2><span id='topic+fiaRI'></span>

<h3>Description</h3>

<p>Subset of the Forest Inventory and Analysis Database for the state of Rhode Island. Reporting years range from 2013 - 2018. Specify <code>fiaRI</code> as the <code>db</code> argument in any <code>rFIA</code> function to produce estimates for the state of Rhode Island. NOTE: the fiaRI object was updated in v1.1.0 to reflect changes in the FIA Database that took place since creation of the original object. 
</p>
<p>Download other subsets of the FIA Database from the FIA Datamart: <a href="https://apps.fs.usda.gov/fia/datamart/datamart.html">https://apps.fs.usda.gov/fia/datamart/datamart.html</a>. Once downloaded, unzip the directory, and read into R using <code><a href="#topic+readFIA">readFIA</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("fiaRI")</code></pre>


<h3>Format</h3>

<p>&mdash;- FIA Database Object &mdash;&ndash;
Reporting Years:  2013 2014 2015 2016 2017 2018
States:           RHODE ISLAND
Total Plots:      769
Memory Used:      20.1 Mb
Tables:           COND_DWM_CALC COND INVASIVE_SUBPLOT_SPP P2VEG_SUBP_STRUCTURE PLOT POP_ESTN_UNIT POP_EVAL_GRP POP_EVAL_TYP POP_EVAL POP_PLOT_STRATUM_ASSGN POP_STRATUM SEEDLING SUBP_COND_CHNG_MTRX SUBP_COND SUBPLOT SURVEY TREE_GRM_BEGIN TREE_GRM_COMPONENT TREE_GRM_MIDPT TREE
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(fiaRI)
summary(fiaRI)
print(fiaRI)
</code></pre>

<hr>
<h2 id='findEVALID'>Find EVALIDs used in the FIADB</h2><span id='topic+findEVALID'></span>

<h3>Description</h3>

<p>Lookup Evaluation IDs (EVALIDs) associated with reporting years and evaluation types used in the Forest Inventory and Analysis Database. NOT required to run other <span class="pkg">rFIA</span> functions. Only use if you are interested in subsetting an <code>FIA.Database</code> object for a specific reporting year or evaluation type using <code><a href="#topic+clipFIA">clipFIA</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>findEVALID(db, mostRecent = FALSE, state = NULL, year = NULL, type = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="findEVALID_+3A_db">db</code></td>
<td>
<p>FIA Database object produced from <code>readFIA()</code>.</p>
</td></tr>
<tr><td><code id="findEVALID_+3A_mostrecent">mostRecent</code></td>
<td>
<p>logical; if TRUE, returns EVALIDs associated with most recent inventory.</p>
</td></tr>
<tr><td><code id="findEVALID_+3A_state">state</code></td>
<td>
<p>character vector containing full names of states of interest (e.g. <code>c('Michigan', 'Minnesota', 'Wisconsin')</code>)</p>
</td></tr>
<tr><td><code id="findEVALID_+3A_year">year</code></td>
<td>
<p>numeric vector containing years of interest (e.g. <code>c(2015, 2016, 2017)</code>)</p>
</td></tr>
<tr><td><code id="findEVALID_+3A_type">type</code></td>
<td>
<p>character ('ALL', 'CURR', 'VOL', 'GROW', 'MORT', 'REMV', 'CHANGE', 'DWM', 'REGEN'). See Reference Population Evaluation Type Description Table (REF_POP_EVAL_TYP_DESCR) in FIADB P2 User Guide (link in references) for descriptions of evaluation types.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>EVALIDs in the FIA Database are used to reference data points associated with particular inventory years and evaluation types within a state (e.g. 2017 Current Volume in Michigan). They are often extraordinarily confusing for those not familiar for the FIA Database. With this in mind, <span class="pkg">rFIA</span> has been designed to eliminate users dependence on identifying and specifying appropriate EVALIDs to produce desired estimates, and we therefore do not recommend users attempt to identify EVALIDs independently.
</p>
<p>Any <code>state</code> or <code>year</code> specified must be present in <code>db</code> to return associated EVALIDS.
</p>


<h3>Value</h3>

<p> A numeric vector containing the EVALIDs associated with states, years, or evaluation types specified.
</p>


<h3>Author(s)</h3>

<p>Hunter Stanke and Andrew Finley
</p>


<h3>References</h3>

<p>FIA Database User Guide: <a href="https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi">https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+clipFIA">clipFIA</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Lookup all EVALIDs in an FIA.Database object
findEVALID(fiaRI)

## Find the most recent EVALIDs
findEVALID(fiaRI, mostRecent = FALSE)

</code></pre>

<hr>
<h2 id='fsi'>Estimate the Forest Stability Index from the FIADB</h2><span id='topic+fsi'></span>

<h3>Description</h3>

<p>Estimate annual change in relative live tree density from the FIADB using the Forest Stability Index (FSI). See Stanke et al. 2021 (doi: 10.1038/s41467-020-20678-z) for a complete description of the the Forest Stability Index.   </p>


<h3>Usage</h3>

<pre><code class='language-R'>fsi(db, grpBy = NULL, polys = NULL, returnSpatial = FALSE,
    bySpecies = FALSE, bySizeClass = FALSE,
    landType = "forest", treeType = "live", method = "TI",
    lambda = 0.5, treeDomain = NULL, areaDomain = NULL,
    totals = TRUE, variance = TRUE, byPlot = FALSE,
    useSeries = FALSE, mostRecent = FALSE, scaleBy = NULL,
    betas = NULL, returnBetas = FALSE, nCores = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fsi_+3A_db">db</code></td>
<td>
<p><code>FIA.Database</code> or <code>Remote.FIA.Database</code> object produced from <code>readFIA()</code> or <code>getFIA()</code>. If a <code>Remote.FIA.Database</code>, data will be read in and processed state-by-state to conserve RAM (see details for an example).</p>
</td></tr>
<tr><td><code id="fsi_+3A_grpby">grpBy</code></td>
<td>
<p>variables from PLOT, COND, or TREE tables to group estimates by (NOT quoted). Multiple grouping variables should be combined with <code>c()</code>, and grouping will occur heirarchically. For example, to produce separate estimates for each ownership group within methods of stand regeneration, specify <code>c(STDORGCD, OWNGRPCD)</code>.</p>
</td></tr>
<tr><td><code id="fsi_+3A_polys">polys</code></td>
<td>
<p><code>sp</code> or <code>sf</code> Polygon/MultiPolgyon object; Areal units to bin data for estimation. Separate estimates will be produced for region encompassed by each areal unit. FIA plot locations will be reprojected to match projection of <code>polys</code> object.</p>
</td></tr>
<tr><td><code id="fsi_+3A_returnspatial">returnSpatial</code></td>
<td>
<p>logical; if TRUE, merge population estimates with <code>polys</code> and return as <code>sf</code> multipolygon object. When <code>byPlot = TRUE</code>, return plot-level estimates as <code>sf</code> spatial points.</p>
</td></tr>
<tr><td><code id="fsi_+3A_byspecies">bySpecies</code></td>
<td>
<p>logical; if TRUE, returns estimates grouped by species.</p>
</td></tr>
<tr><td><code id="fsi_+3A_bysizeclass">bySizeClass</code></td>
<td>
<p>logical; if TRUE, returns estimates grouped by size class (2-inch intervals, see <code><a href="#topic+makeClasses">makeClasses</a></code> to compute different size class intervals).</p>
</td></tr>
<tr><td><code id="fsi_+3A_landtype">landType</code></td>
<td>
<p>character ('forest' or 'timber'); Type of land which estimates will be produced for. Timberland is a subset of forestland (default) which has high site potential and non-reserve status (see details).</p>
</td></tr>
<tr><td><code id="fsi_+3A_treetype">treeType</code></td>
<td>
<p>character ('live' or 'gs'); Type of tree which estimates will be produced for. Live includes all stems greater than 1 in. DBH which are live (leaning less than 45 degrees). GS (growing-stock) includes live stems greater than 5 in. DBH which contain at least one 8 ft merchantable log. </p>
</td></tr>
<tr><td><code id="fsi_+3A_method">method</code></td>
<td>
<p>character; design-based estimator to use. One of:  &quot;TI&quot; (temporally indifferent, default), &quot;annual&quot; (annual), &quot;SMA&quot; (simple moving average), &quot;LMA&quot; (linear moving average), or &quot;EMA&quot; (exponential moving average). See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators.</p>
</td></tr>
<tr><td><code id="fsi_+3A_lambda">lambda</code></td>
<td>
<p>numeric (0,1); if <code>method = 'EMA'</code>, the decay parameter used to define weighting scheme for annual panels. Low values place higher weight on more recent panels, and vice versa. Specify a vector of values to compute estimates using mulitple weighting schemes, and use <code>plotFIA()</code> with <code>grp</code> set to <code>lambda</code> to produce moving average ribbon plots. See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for examples.</p>
</td></tr>
<tr><td><code id="fsi_+3A_treedomain">treeDomain</code></td>
<td>
<p>logical predicates defined in terms of the variables in PLOT, TREE, and/or COND tables. Used to define the type of trees for which estimates will be produced (e.g. DBH greater than 20 inches: <code>DIA &gt; 20</code>, Dominant/Co-dominant crowns only: <code>CCLCD %in% c(2,3)</code>). Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only trees where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="fsi_+3A_areadomain">areaDomain</code></td>
<td>
<p>logical predicates defined in terms of the variables in PLOT and/or COND tables. Used to define the area for which estimates will be produced (e.g. within 1 mile of improved road: <code>RDDISTCD %in% c(1:6)</code>, Hard maple/basswood forest type: <code>FORTYPCD == 805)</code>. Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only plots within areas where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="fsi_+3A_totals">totals</code></td>
<td>
<p>logical; if TRUE, return total population estimates (e.g. total area) along with ratio estimates (e.g. mean trees per acre).</p>
</td></tr>
<tr><td><code id="fsi_+3A_variance">variance</code></td>
<td>
<p>logical; if TRUE, return estimated variance (<code>VAR</code>) and sample size (<code>N</code>). If FALSE, return 'sampling error' (<code>SE</code>) as returned by EVALIDator. Note: sampling error cannot be used to construct confidence intervals.</p>
</td></tr>
<tr><td><code id="fsi_+3A_byplot">byPlot</code></td>
<td>
<p>logical; if TRUE, returns estimates for individual plot locations instead of population estimates.</p>
</td></tr>
<tr><td><code id="fsi_+3A_useseries">useSeries</code></td>
<td>
<p>logical; If TRUE, use multiple remeasurements to estimate annual change in relative density on each plot, when available.</p>
</td></tr>
<tr><td><code id="fsi_+3A_mostrecent">mostRecent</code></td>
<td>
<p>logical; If TRUE, only return results for the most recent inventory in each state. Only useful when <code>useSeries=TRUE</code>, as in this case, using <code>clipFIA</code> to select the most recent inventory will drop all but the most recent remeasurement.</p>
</td></tr>
<tr><td><code id="fsi_+3A_scaleby">scaleBy</code></td>
<td>
<p>variables from PLOT or COND tables to use as 'random effects' in model of size-density relationships. Multiple variables should be combined with <code>c()</code>.</p>
</td></tr>
<tr><td><code id="fsi_+3A_betas">betas</code></td>
<td>
<p>data.frame; coefficients of maximum size-density models returned in a previous call to <code>fsi</code> when <code>returnBetas = TRUE</code>. See examples.</p>
</td></tr>
<tr><td><code id="fsi_+3A_returnbetas">returnBetas</code></td>
<td>
<p>logical; If true, returns estimated coefficients of maximum size-density models along with results. These coefficients can then be handed to the <code>beta</code> argument (see above) in subsequent runs. This speeds up processing and ensures the same coefficients are used to model maximum-size density curves between function calls. See Value below for more details. </p>
</td></tr>
<tr><td><code id="fsi_+3A_ncores">nCores</code></td>
<td>
<p>numeric; number of cores to use for parallel implementation. Check available cores using <code><a href="parallel.html#topic+detectCores">detectCores</a></code>. Default = 1, serial processing.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Estimation Details</strong>
</p>
<p>Estimation of forest variables follows the procedures documented in Bechtold and Patterson (2005) and <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a>.
</p>
<p>Please see Stanke et al. 2021 (doi: 10.1038/s41467-020-20678-z) for a complete description of the Forest Stability Index (FSI). In short, the FSI is a direct measure of temporal change in the relative density of live trees, where relative density is defined as the ratio of observed tree density to maximum potential tree density. Maximum potential tree density is modeled as a power function of average tree size - in the current implementation average tree basal area is used. Users may allow both the &quot;slopes&quot; and intercepts of this power function to vary by classified groups, like forest community type using the <code>scaleBy</code> argument. Users may return the estimated parameters of maximum size-density models by specifying <code>returnBetas = TRUE</code>.
</p>
<p>Users may specify alternatives to the 'Temporally Indifferent' estimator using the <code>method</code> argument. Alternative design-based estimators include the annual estimator (&quot;ANNUAL&quot;; annual panels, or estimates from plots measured in the same year), simple moving average (&quot;SMA&quot;; combines annual panels with equal weight), linear moving average (&quot;LMA&quot;; combine annual panels with weights that decay <em>linearly</em> with time since measurement), and exponential moving average (&quot;EMA&quot;; combine annual panels with weights that decay <em>exponentially</em> with time since measurement). The &quot;best&quot; estimator depends entirely on user-objectives, see <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators and tradeoffs between precision and temporal specificity.
</p>
<p>When <code>byPlot = FALSE</code> (i.e., population estimates are returned), the &quot;YEAR&quot; column in the resulting dataframe indicates the final year of the inventory cycle that estimates are produced for. For example, an estimate of current forest area (e.g., 2018) may draw on data collected from 2008-2018, and &quot;YEAR&quot; will be listed as 2018 (consistent with EVALIDator). However, when <code>byPlot = TRUE</code> (i.e., plot-level estimates returned), the &quot;YEAR&quot; column denotes the year that each plot was measured (MEASYEAR), which may differ slightly from its associated inventory year (INVYR).
</p>
<p>Stratified random sampling techniques are most often employed to compute estimates in recent inventories, although double sampling and simple random sampling may be employed for early inventories. Estimates are adjusted for non-response bias by assuming attributes of non-response plot locations to be equal to the mean of other plots included within their respective stratum or population.
</p>
<p><strong>Working with &quot;Big Data&quot;</strong>
</p>
<p>If FIA data are too large to hold in memory (e.g., R throws the &quot;cannot allocate vector of size ...&quot; errors), use larger-than-RAM options. See documentation of <code>link{readFIA}</code> for examples of how to set up a <code>Remote.FIA.Database</code>. As a reference, we have used rFIA's larger-than-RAM methods to estimate forest variables using the entire FIA Database (~50GB) on a standard desktop computer with 16GB of RAM. Check out <a href="https://doserlab.com/files/rfia/">our website</a> for more details and examples.
</p>
<p>Easy, efficient parallelization is implemented with the <code><a href="parallel.html#topic+parallel">parallel</a></code> package. Users must only specify the <code>nCores</code> argument with a value greater than 1 in order to implement parallel processing on their machines. Parallel implementation is achieved using a snow type cluster on any Windows OS, and with multicore forking on any Unix OS (Linux, Mac). Implementing parallel processing may substantially decrease free memory during processing, particularly on Windows OS. Thus, users should be cautious when running in parallel, and consider implementing serial processing for this task if computational resources are limited (<code>nCores = 1</code>).
</p>
<p><strong>Definition of forestland</strong>
</p>
<p>Forest land must have at least 10-percent canopy cover by live tally trees of any size, including land that formerly had such tree cover and that will be naturally or artificially regenerated. Forest land includes transition zones, such as areas between heavily forest and non-forested lands that meet the mimium tree canopy cover and forest areas adjacent to urban and built-up lands. The minimum area for classification of forest land is 1 acre in size and 120 feet wide measured stem-to-stem from the outer-most edge. Roadside, streamside, and shelterbelt strips of trees must have a width of at least 120 feet and continuous length of at least 363 feet to qualify as forest land. Tree-covered areas in agricultural production settings, such as fruit orchards, or tree-covered areas in urban settings, such as city parks, are not considered forest land.
</p>
<p>Timber land is a subset of forest land that is producing or is capable of producing crops of industrial wood and not withdrawn from timber utilization by statute or administrative regulation. (Note: Areas qualifying as timberland are capable of producing at least 20 cubic feet per acre per year of industrial wood in natural stands. Currently inaccessible and inoperable areas are NOT included).
</p>


<h3>Value</h3>

<p>When <code>returnBetas = TRUE</code>, a list will be returned. This list will contain a dataframe named &quot;results&quot;, containing estimates of the FSI, and another named &quot;betas&quot;, containing estimated parameters of the maximum size-density model. When <code>returnBetas = FALSE</code>, a data.frame corresponding with &quot;results&quot; will be returned.
</p>
<p><strong>Results</strong> Dataframe or sf object (if <code>returnSpatial = TRUE</code>). If <code>byPlot = TRUE</code>, values are returned for each plot (<code>PLOT_STATUS_CD = 1</code> when forest exists at the plot location). All variables with names ending in <code>SE</code>, represent the estimate of sampling error (%) of the variable. When <code>variance = TRUE</code>, variables ending in <code>VAR</code> denote the variance of the variable and <code>N</code> is the total sample size (i.e., including non-zero plots).
</p>

<ul>
<li><p><strong>YEAR</strong>: reporting year associated with estimates
</p>
</li>
<li><p><strong>FSI</strong>: estimate of forest stability index (i.e., annual change in relative live tree density)
</p>
</li>
<li><p><strong>PERC_FSI</strong>: estimate of % forest stability index (i.e., % annual change in relative live tree density)
</p>
</li>
<li><p><strong>FSI_STATUS</strong>: indication of the forest stability index (i.e., decline, stable, or expand)
</p>
</li>
<li><p><strong>FSI_INT</strong>: width of 95% confidence interval of mean FSI
</p>
</li>
<li><p><strong>PREV_RD</strong>: estimate of relative live tree density at initial measurement of all plots (i.e., observed density / maximum potential density)
</p>
</li>
<li><p><strong>PREV_RD</strong>: estimate of relative live tree density at final measurement of all plots (i.e., observed density / maximum potential density)
</p>
</li>
<li><p><strong>TPA_RATE</strong>: standardized estimate of annual change in TPA (proportionate change)
</p>
</li>
<li><p><strong>BA_RATE</strong>: standardized estimate of annual change in BA (proportionate change)
</p>
</li></ul>

<p><strong>Betas</strong> Within betas, all variable names ending in &quot;upper&quot; or &quot;lower&quot; represent the upper and lower bounds of the 95% Bayesian credible interval of their respective variables. All variable names beginning with &quot;fixed&quot; represent the fixed effects in random slope/intercept models (i.e., the global average).
</p>

<ul>
<li><p><strong>grps</strong>: unique identifier associated with the group (i.e., unique combination of variables listed in <code>scaleBy</code>).
</p>
</li>
<li><p><strong>alpha</strong>: posterior median of scaling factor that describes the maximum tree density at average tree basal area of one sq. ft.
</p>
</li>
<li><p><strong>rate</strong>: posterior median of negative exponent controlling the decay in maximum tree density with increasing average tree size.
</p>
</li>
<li><p><strong>n</strong>: number of observations with the group with an approximately normal diameter distribution and no evidence of recent disturbance.
</p>
</li></ul>



<h3>Note</h3>

<p>All sampling error estimates (SE) are returned as the &quot;percent coefficient of variation&quot; (standard deviation / mean * 100) for consistency with EVALIDator. IMPORTANT: sampling error cannot be used to construct confidence intervals. Please use <code>variance = TRUE</code> for that (i.e., return variance and sample size instead of sampling error).</p>


<h3>Author(s)</h3>

<p>Hunter Stanke and Andrew Finley
</p>


<h3>References</h3>

<p>Stanke, H., Finley, A. O., Domke, G. M., Weed, A. S., &amp; MacFarlane, D. W. (2021). Over half of western United States' most abundant tree species in decline. Nature Communications, 12(1), 451. doi: 10.1038/s41467-020-20678-z
</p>
<p>FIA Database User Guide: <a href="https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi">https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi</a>
</p>
<p>Bechtold, W.A.; Patterson, P.L., eds. 2005. The Enhanced Forest Inventory and Analysis Program - National Sampling Design and Estimation Procedures. Gen. Tech. Rep. SRS - 80. Asheville, NC: U.S. Department of Agriculture, Forest Service, Southern Research Station. 85 p. <a href="https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf">https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf</a>
</p>
<p>Stanke, H., Finley, A. O., Weed, A. S., Walters, B. F., &amp; Domke, G. M. (2020). rFIA: An R package for estimation of forest attributes with the US Forest Inventory and Analysis database. Environmental Modelling &amp; Software, 127, 104664.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load data from the rFIA package
data(fiaRI)
data(countiesRI)

# Most recents subset
fiaRI_mr &lt;- clipFIA(fiaRI)


## Most recent estimates for all live trees in RI
## Allowing maximum size-density relationship to
## vary by forest community type
# fsi(db = fiaRI_mr,
#     scaleBy = FORTYPCD)
# 
# ## Same as above at the plot-level
# fsi(db = fiaRI_mr,
#     scaleBy = FORTYPCD,
#     byPlot = TRUE)
# 
# 
# ## Same as above, but return the estimated coefficients of the
# ## maximum size-density model
# results &lt;- fsi(db = fiaRI_mr,
#                scaleBy = FORTYPCD,
#                returnBetas = TRUE)
# ## Our results are stored in a list, where "results" gives us the
# ## estimates of the FSI, and "betas" gives us the estimated
# ## model coefficients
# results$results # FSI estimates
# results$betas # model coefficients
# 
# 
# ## Estimates for live white pine ( &gt; 12" DBH) on
# ## forested mesic sites (all available inventories)
# ## Here we instead allow maximum size-density relationships
# ## to vary by site productivity class
# fsi(fiaRI_mr,
#     scaleBy = SITECLCD,
#     treeType = 'live',
#     treeDomain = SPCD == 129 &amp; DIA &gt; 12, # Species code for white pine
#     areaDomain = PHYSCLCD %in% 21:29) # Mesic Physiographic classes



</code></pre>

<hr>
<h2 id='getDesignInfo'>Extract design features for FIA inventories</h2><span id='topic+getDesignInfo'></span>

<h3>Description</h3>

<p>Extracts design information for post-stratified FIA inventories, intended to aid the development of alternative model-based estimators of forest variables. Design information is currently limited to estimation unit land area (AREA_USED) and strata weights (proportion of estimation unit represented by each stratum). This is sufficient to acknowledge design features in an aspatial model, however, inclusion probabilities and strata boundaries will be necessary to incorporate spatial predictors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getDesignInfo(db,
              type = c("ALL", "CURR", "VOL", "GROW", "MORT",
                       "REMV", "CHNG", "DWM", "REGEN"),
              mostRecent = TRUE,
              evalid = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="getDesignInfo_+3A_db">db</code></td>
<td>
<p><code>FIA.Database</code> or <code>Remote.FIA.Database</code> object produced from <code>readFIA()</code> or <code>getFIA()</code>. If a <code>Remote.FIA.Database</code>, data will be read in and processed state-by-state to conserve RAM.</p>
</td></tr>
<tr><td><code id="getDesignInfo_+3A_type">type</code></td>
<td>
<p>character ('ALL', 'CURR', 'VOL', 'GROW', 'MORT', 'REMV', 'CHNG', 'DWM', 'REGEN'). See Reference Population Evaluation Type Description Table (REF_POP_EVAL_TYP_DESCR) in FIADB P2 User Guide (link in references) for descriptions of evaluation types.</p>
</td></tr>
<tr><td><code id="getDesignInfo_+3A_mostrecent">mostRecent</code></td>
<td>
<p>logical; if TRUE, returns EVALIDs associated with most recent inventory.</p>
</td></tr>
<tr><td><code id="getDesignInfo_+3A_evalid">evalid</code></td>
<td>
<p>character; unique value which identifies an inventory year and inventory type for a state. If you would like to subset data for an inventory year other than the most recent, use <code><a href="#topic+findEVALID">findEVALID</a></code> to locate this value.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The FIA database is not limited for use with standard design-based estimators. A plethora of recent work has highlighted the improvements that model-assisted and model-based estimators can provide relative to the standard post-stratified estimators implemented in <code>rFIA</code>. However, when implementing alternative model-assisted or model-based estimators it is important to accommodate the design information for post-stratified FIA inventories. <code>getDesignInfo()</code> allows you to quickly extract design-based information for use when implementing alternative estimators with FIA data. See the Stanke et al. 2021 reference below for a paper describing use of <code>rFIA</code> for implementing model-based estimators to improve small area estimation of forest parameters. 
</p>


<h3>Value</h3>

<p>Generates a data frame with the columns described below, containing the design information associated with one or multiple FIA inventories.
</p>
<p>For reference, there are often multiple non-overlapping estimation units within a state, and multiple, non-overlapping, and exhaustive strata within each estimation unit. Estimation unit and strata boundaries vary with inventories (i.e., by reporting year and by inventory type), though multiple inventories may draw from data collected at a single plot visit. Hence, ESTN_UNIT_CN and STRATUM_CN are specific to EVALIDs (or alternatively, the combination of STATE, YEAR, and EVAL_TYP, for all states except Texas). However, a single PLT_CN may be associated with multiple ESTN_UNIT_CNs and STRATUM_CNs.
</p>

<ul>
<li><p><strong>STATECD</strong>: unique identifier for states.
</p>
</li>
<li><p><strong>YEAR</strong>: reporting year associated with estimates (END_INVYR from POP_EVAL).
</p>
</li>
<li><p><strong>EVAL_TYP</strong>: an identifier describing the type of evaluation. For example, &quot;EXPDWM&quot; represents sampled plots used for down woody material estimates.
</p>
</li>
<li><p><strong>EVALID</strong>: unique identifier that represents the population used to produce a type of estimate.
</p>
</li>
<li><p><strong>ESTN_UNIT_CN</strong>: unique identifier for estimation unit.
</p>
</li>
<li><p><strong>AREA_USED</strong>: area of estimation unit used for population estimation.
</p>
</li>
<li><p><strong>STRATUM_CN</strong>: unique identifier for strata.
</p>
</li>
<li><p><strong>STRATUM_WGT</strong>: proportion of estimation unit area (AREA_USED) that is occupied by a particular stratum. Defined on the range (0,1].
</p>
</li>
<li><p><strong>pltID</strong>: unique identifier for plot <em>location</em>.
</p>
</li>
<li><p><strong>PLT_CN</strong>: unique identifier for plot <em>visit</em>.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Hunter Stanke and Andrew Finley
</p>


<h3>References</h3>

<p>FIA Database User Guide: <a href="https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi">https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi</a>
</p>


<h3>See Also</h3>

<p><code>findEVALID</code></p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load the Rhode Island subset included w/ rFIA
data(fiaRI)

# Extract the design information associated with the most recent current
# volume inventory in the state (2018 for this subset)
wgts &lt;- getDesignInfo(db = fiaRI, mostRecent = TRUE, type = 'VOL')

</code></pre>

<hr>
<h2 id='getFIA'>Download FIA Data and Load into R</h2><span id='topic+getFIA'></span>

<h3>Description</h3>

<p>Downloads FIA Data from the FIA Datamart, loads the data into R environment, and optionally saves all downloaded tables as .csv files to local directory. Requires an internet connection to access and download tables from the FIA Datamart. <strong>R stops downloads after 60 seconds by default. To prevent this (allow download for 1 hour), run <code>options(timeout=3600)</code>.</strong></p>


<h3>Usage</h3>

<pre><code class='language-R'>getFIA(states, dir = NULL, common = TRUE, tables = NULL,
       load = TRUE, nCores = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="getFIA_+3A_states">states</code></td>
<td>
<p>character; state/ US territory abbreviations (e.g. 'AL', 'MI', etc.) indicating which state subsets to download. Choose to download multiple states by passing character vector of state abbreviations (e.g. <code>states = c('RI', 'CT', 'MA')</code>). If multiple states specified, tables will be saved as individual state subsets (for future use with <code>readFIA()</code>, although loaded in R as a merged, regional database.</p>
</td></tr>
<tr><td><code id="getFIA_+3A_dir">dir</code></td>
<td>
<p>character (optional); directory where FIA tables will be saved after download. If NULL, tables will not be saved on disk and only loaded into R environment.</p>
</td></tr>
<tr><td><code id="getFIA_+3A_common">common</code></td>
<td>
<p>logical; if TRUE, only import most commonly used tables, including all required for <code>rFIA</code> functions (see Details for list of tables).</p>
</td></tr>
<tr><td><code id="getFIA_+3A_tables">tables</code></td>
<td>
<p>character vector (optional); names of specific tables to be downloaded for each state specified (e.g. 'PLOT', 'TREE', 'COND', 'TREE_GRM_COMPONENT').</p>
</td></tr>
<tr><td><code id="getFIA_+3A_load">load</code></td>
<td>
<p>logical; should downloaded data be loaded into R immediately? If all data is too large to fit in memory, use <code>load = FALSE</code> and load the data as a <code>"Remote.FIA.Database"</code> with <code>readFIA()</code>.</p>
</td></tr>
<tr><td><code id="getFIA_+3A_ncores">nCores</code></td>
<td>
<p>numeric; number of cores to use for parallel implementation. Check available cores using <code><a href="parallel.html#topic+detectCores">detectCores</a></code>. Default = 1, serial processing.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>common = TRUE</code>, the following tables will be loaded: COND, COND_DWM_CALC, INVASIVE_SUBPLOT_SPP, PLOT, POP_ESTN_UNIT, POP_EVAL, POP_EVAL_GRP, POP_EVAL_TYP, POP_PLOT_STRATUM_ASSGN, POP_STRATUM, SUBPLOT, TREE, TREE_GRM_COMPONENT, TREE_GRM_MIDPT, TREE_GRM_BEGIN, SUBP_COND_CHNG_MTRX, SEEDLING, SURVEY, SUBP_COND, P2VEG_SUBP_STRUCTURE. These tables currently support all functionality with <code>rFIA</code>, and it is recommended that only these tables be imported to conserve RAM and reduce processing time.
</p>
<p>If you wish to merge multiple state downloads of FIA data (e.g. Michigan and Indiana state downloads), simply specify multiple state abbreviations to the <code>states</code> argument. Upon import, corresponding tables (e.g. MI_PLOT and IN_PLOT) will be merged, and analysis can be completed for the entire region or within spatial units which transcend state boundaries (e.g. Ecoregion subsections).
</p>
<p>If you choose to save downloaded tables to a local directory after download (simply specify <code>dir</code>), these tables can be easily reloaded into R using <code>readFIA()</code> (do not need to redownload files).
</p>
<p>Easy, efficient parallelization is implemented with the <code><a href="parallel.html#topic+parallel">parallel</a></code> package. Users must only specify the <code>nCores</code> argument with a value greater than 1 in order to implement parallel processing on their machines. Parallel implementation is achieved using a snow type cluster on any Windows OS, and with multicore forking on any Unix OS (Linux, Mac). Implementing parallel processing may substantially decrease decrease free memory during processing, particularly on Windows OS. Thus, users should be cautious when running in parallel, and consider implementing serial processing for this task if computational resources are limited (<code>nCores = 1</code>).</p>


<h3>Value</h3>

<p>List object containing FIA Datatables. List elements represent individual FIA Datatables stored as <code>data.frame</code> objects.
</p>
<p>If multiple subsets of the FIA database are downloaded (e.g. <code>states = c('MI', 'IN')</code>), corresponding tables will be merged (e.g. PLOT table returned contains plots in both Michigan and Indiana).
</p>


<h3>Author(s)</h3>

<p>Hunter Stanke and Andrew Finley
</p>


<h3>References</h3>

<p>FIA DataMart: <a href="https://apps.fs.usda.gov/fia/datamart/datamart.html">https://apps.fs.usda.gov/fia/datamart/datamart.html</a>
</p>
<p>FIA Website Questions: <a href="https://research.fs.usda.gov/programs/fia#data-and-tools">https://research.fs.usda.gov/programs/fia#data-and-tools</a>
Direct email: SM.FS.fia@usda.gov
E.g., Problems accessing the state CSV files.
</p>
<p>FIA Database User Guide: <a href="https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi">https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+readFIA">readFIA</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Allow downloads that take up to 1 hour (defaults to 60 seconds)
options(timeout=3600)

# Download the common tables for Rhode Island, load into R, and save to local directory
# Replace tempDir() with the path to your directory (where data will be saved)
db &lt;- getFIA(states = 'RI', dir = tempdir())

</code></pre>

<hr>
<h2 id='growMort'>Estimate growth, recruitment, mortality, and harvest rates from FIADB</h2><span id='topic+growMort'></span>

<h3>Description</h3>

<p>Produces estimates of annual growth, recruitment, natural mortality, and harvest rates from the Forest Inventory and Analysis Database (FIADB), along with population estimates for each variable. Estimates can be produced for regions defined within the FIA Database (e.g. counties), at the plot level, or within user-defined areal units. Options to group estimates by species, size class, and other variables defined in the FIADB. If multiple reporting years (EVALIDs) are included in the data, estimates will be output as a time series. If multiple states are represented by the data, estimates will be output for the full region (all area combined), unless specified otherwise (e.g. <code>grpBy = STATECD</code>). </p>


<h3>Usage</h3>

<pre><code class='language-R'>growMort(db, grpBy = NULL, polys = NULL, returnSpatial = FALSE, bySpecies = FALSE,
         bySizeClass = FALSE, landType = 'forest', treeType = 'all',
         method = 'TI', lambda = 0.5, stateVar = 'TPA', treeDomain = NULL,
         areaDomain = NULL, totals = FALSE, variance = FALSE,
         byPlot = FALSE, treeList = FALSE, nCores = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="growMort_+3A_db">db</code></td>
<td>
<p><code>FIA.Database</code> or <code>Remote.FIA.Database</code> object produced from <code>readFIA()</code> or <code>getFIA()</code>. If a <code>Remote.FIA.Database</code>, data will be read in and processed state-by-state to conserve RAM (see details for an example).</p>
</td></tr>
<tr><td><code id="growMort_+3A_grpby">grpBy</code></td>
<td>
<p>variables from PLOT, COND, or TREE tables to group estimates by (NOT quoted). Multiple grouping variables should be combined with <code>c()</code>, and grouping will occur heirarchically. For example, to produce seperate estimates for each ownership group within methods of stand regeneration, specify <code>c(STDORGCD, OWNGRPCD)</code>.</p>
</td></tr>
<tr><td><code id="growMort_+3A_polys">polys</code></td>
<td>
<p><code>sp</code> or <code>sf</code> Polygon/MultiPolgyon object; Areal units to bin data for estimation. Separate estimates will be produced for region encompassed by each areal unit. FIA plot locations will be reprojected to match projection of <code>polys</code> object.</p>
</td></tr>
<tr><td><code id="growMort_+3A_returnspatial">returnSpatial</code></td>
<td>
<p>logical; if TRUE, merge population estimates with <code>polys</code> and return as <code>sf</code> multipolygon object. When <code>byPlot = TRUE</code>, return plot-level estimates as <code>sf</code> spatial points.</p>
</td></tr>
<tr><td><code id="growMort_+3A_byspecies">bySpecies</code></td>
<td>
<p>logical; if TRUE, returns estimates grouped by species.</p>
</td></tr>
<tr><td><code id="growMort_+3A_bysizeclass">bySizeClass</code></td>
<td>
<p>logical; if TRUE, returns estimates grouped by size class (2-inch intervals, see <code>makeClasses()</code> to compute different size class intervals).</p>
</td></tr>
<tr><td><code id="growMort_+3A_landtype">landType</code></td>
<td>
<p>character (&quot;forest&quot; or &quot;timber&quot;); Type of land that estimates will be produced for. Timberland is a subset of forestland (default) which has high site potential and non-reserve status (see details).</p>
</td></tr>
<tr><td><code id="growMort_+3A_treetype">treeType</code></td>
<td>
<p>character (&quot;all&quot; or &quot;gs&quot;); Type of tree that estimates will be produced for. All (default) includes all stems, live and dead, greater than 5 in. DBH (or those that grow to 5in by the end of time period 2). GS (growing-stock) includes live stems greater than 5 in. DBH which contain at least one 8 ft merchantable log.</p>
</td></tr>
<tr><td><code id="growMort_+3A_method">method</code></td>
<td>
<p>character; design-based estimator to use. One of:  &quot;TI&quot; (temporally indifferent, default), &quot;annual&quot; (annual), &quot;SMA&quot; (simple moving average), &quot;LMA&quot; (linear moving average), or &quot;EMA&quot; (exponential moving average). See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators.</p>
</td></tr>
<tr><td><code id="growMort_+3A_lambda">lambda</code></td>
<td>
<p>numeric (0,1); if <code>method = 'EMA'</code>, the decay parameter used to define weighting scheme for annual panels. Low values place higher weight on more recent panels, and vice versa. Specify a vector of values to compute estimates using mulitple wieghting schemes, and use <code>plotFIA()</code> with <code>grp</code> set to <code>lambda</code> to produce moving average ribbon plots. See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for examples.</p>
</td></tr>
<tr><td><code id="growMort_+3A_statevar">stateVar</code></td>
<td>
<p>character; State variable for reporting GRM estimates. One of: TPA, BAA, BIO_AG, BIO_BG, BIO, CARB_AG, CARB_BG, CARB, NETVOL, SNDVOL, SAWVOL, SAWVOL_BF (board feet).</p>
</td></tr>
<tr><td><code id="growMort_+3A_treedomain">treeDomain</code></td>
<td>
<p>logical predicates defined in terms of the variables in PLOT, TREE, and/or COND tables. Used to define the type of trees for which estimates will be produced (e.g. DBH greater than 20 inches: <code>DIA &gt; 20</code>, Dominant/Co-dominant crowns only: <code>CCLCD %in% c(2,3)</code>. Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only trees where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="growMort_+3A_areadomain">areaDomain</code></td>
<td>
<p>logical predicates defined in terms of the variables in PLOT and/or COND tables. Used to define the area for which estimates will be produced (e.g. within 1 mile of improved road: <code>RDDISTCD %in% c(1:6)</code>, Hard maple/basswood forest type: <code>FORTYPCD == 805</code>. Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only plots within areas where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="growMort_+3A_totals">totals</code></td>
<td>
<p>logical; if TRUE, return population estimates (e.g. total area, total mortality) along with ratio estimates (e.g. mean mortality trees per acre).</p>
</td></tr>
<tr><td><code id="growMort_+3A_variance">variance</code></td>
<td>
<p>logical; if TRUE, return estimated variance (<code>VAR</code>) and sample size (<code>N</code>). If FALSE, return 'sampling error' (<code>SE</code>) as returned by EVALIDator. Note: sampling error cannot be used to construct confidence intervals.</p>
</td></tr>
<tr><td><code id="growMort_+3A_byplot">byPlot</code></td>
<td>
<p>logical; if TRUE, returns estimates for individual plot locations instead of population estimates.</p>
</td></tr>
<tr><td><code id="growMort_+3A_treelist">treeList</code></td>
<td>
<p>logical; if TRUE, returns tree-level summaries intended for subsequent use with <code>customPSE()</code>.</p>
</td></tr>
<tr><td><code id="growMort_+3A_ncores">nCores</code></td>
<td>
<p>numeric; number of cores to use for parallel implementation. Check available cores using <code>detectCores()</code>. Default = 1, serial processing.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Estimation Details</strong>
</p>
<p>Estimation of forest variables follows the procedures documented in Bechtold and Patterson (2005) and <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a>.
</p>
<p>Average annual rates are computed using a sample-based ratio of means estimator of total trees subject to an event (e.g. recruitment, mortality) annually / total area. Similarly, the proportion of individuals subject to each event annually is computed as the total trees subject to the event between time 1 and time 2 / total live trees at time 1. All estimates are returned as average annual rates. Only conditions which were forested in time 1 and in time 2 are included in estimates (excluding converted stands).
</p>
<p>Recruitment events are defined as when a live stem that is less than 5 inches DBH at time 1, grows to or beyond 5 inches DBH by time 2. This does NOT include stems that grow beyond the 5-inch diameter criteria and are then subject to mortality (both natural and harvest) prior to remeasurement. Natural mortality is defined as when a live stem is subject to non-harvest mortality between successive measurement periods. Finally, harvest is defined as when a live stem is cut and removed between successive measurements.
</p>
<p>Users may specify alternatives to the 'Temporally Indifferent' estimator using the <code>method</code> argument. Alternative design-based estimators include the annual estimator (&quot;ANNUAL&quot;; annual panels, or estimates from plots measured in the same year), simple moving average (&quot;SMA&quot;; combines annual panels with equal weight), linear moving average (&quot;LMA&quot;; combine annual panels with weights that decay <em>linearly</em> with time since measurement), and exponential moving average (&quot;EMA&quot;; combine annual panels with weights that decay <em>exponentially</em> with time since measurement). The &quot;best&quot; estimator depends entirely on user-objectives, see <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators and tradeoffs between precision and temporal specificity.
</p>
<p>When <code>byPlot = FALSE</code> (i.e., population estimates are returned), the &quot;YEAR&quot; column in the resulting dataframe indicates the final year of the inventory cycle that estimates are produced for. For example, an estimate of current forest area (e.g., 2018) may draw on data collected from 2008-2018, and &quot;YEAR&quot; will be listed as 2018 (consistent with EVALIDator). However, when <code>byPlot = TRUE</code> (i.e., plot-level estimates returned), the &quot;YEAR&quot; column denotes the year that each plot was measured (MEASYEAR), which may differ slightly from its associated inventory year (INVYR).
</p>
<p>Stratified random sampling techniques are most often employed to compute estimates in recent inventories, although double sampling and simple random sampling may be employed for early inventories. Estimates are adjusted for non-response bias by assuming attributes of non-response plot locations to be equal to the mean of other plots included within thier respective stratum or population.
</p>
<p><strong>Working with &quot;Big Data&quot;</strong>
</p>
<p>If FIA data are too large to hold in memory (e.g., R throws the &quot;cannot allocate vector of size ...&quot; errors), use larger-than-RAM options. See documentation of <code>link{readFIA}</code> for examples of how to set up a <code>Remote.FIA.Database</code>. As a reference, we have used rFIA's larger-than-RAM methods to estimate forest variables using the entire FIA Database (~50GB) on a standard desktop computer with 16GB of RAM. Check out <a href="https://doserlab.com/files/rfia/">our website</a> for more details and examples.
</p>
<p>Easy, efficient parallelization is implemented with the <code><a href="parallel.html#topic+parallel">parallel</a></code> package. Users must only specify the <code>nCores</code> argument with a value greater than 1 in order to implement parallel processing on their machines. Parallel implementation is achieved using a snow type cluster on any Windows OS, and with multicore forking on any Unix OS (Linux, Mac). Implementing parallel processing may substantially decrease free memory during processing, particularly on Windows OS. Thus, users should be cautious when running in parallel, and consider implementing serial processing for this task if computational resources are limited (<code>nCores = 1</code>).
</p>
<p><strong>Definition of forestland</strong>
</p>
<p>Forest land must have at least 10-percent canopy cover by live tally trees of any size, including land that formerly had such tree cover and that will be naturally or artificially regenerated. Forest land includes transition zones, such as areas between heavily forest and non-forested lands that meet the mimium tree canopy cover and forest areas adjacent to urban and built-up lands. The minimum area for classification of forest land is 1 acre in size and 120 feet wide measured stem-to-stem from the outer-most edge. Roadside, streamside, and shelterbelt strips of trees must have a width of at least 120 feet and continuous length of at least 363 feet to qualify as forest land. Tree-covered areas in agricultural production settings, such as fruit orchards, or tree-covered areas in urban settings, such as city parks, are not considered forest land.
</p>
<p>Timber land is a subset of forest land that is producing or is capable of producing crops of industrial wood and not withdrawn from timber utilization by statute or administrative regulation. (Note: Areas qualifying as timberland are capable of producing at least 20 cubic feet per acre per year of industrial wood in natural stands. Currently inaccessible and inoperable areas are NOT included).
</p>


<h3>Value</h3>

<p>Dataframe or sf object (if <code>returnSpatial = TRUE</code>). If <code>byPlot = TRUE</code>, values are returned for each plot (<code>PLOT_STATUS_CD = 1</code> when forest exists at the plot location). All variables with names ending in <code>SE</code>, represent the estimate of sampling error (%) of the variable. When <code>variance = TRUE</code>, variables ending in <code>VAR</code> denote the variance of the variable and <code>N</code> is the total sample size (i.e., including non-zero plots).
</p>

<ul>
<li><p><strong>YEAR</strong>: reporting year associated with estimates
</p>
</li>
<li><p><strong>RECR_*</strong>: estimate of mean annual recruitment
</p>
</li>
<li><p><strong>MORT_*</strong>: estimate of mean annual mortality
</p>
</li>
<li><p><strong>REMV_*</strong>: estimate of mean annual removals (harvest)
</p>
</li>
<li><p><strong>GROW_*</strong>: estimate of mean annual growth on survivors
</p>
</li>
<li><p><strong>CHNG_*</strong>: estimate of mean annual net change (i.e., growth + recruitment - mortality - removals)
</p>
</li>
<li><p><strong>RECR_PERC</strong>: estimate of mean percent of individuals subject to recruitment annually (recruitment / previous total)
</p>
</li>
<li><p><strong>MORT_PERC</strong>: estimate of mean percent of individuals subject to mortality annually (mortality / previous total)
</p>
</li>
<li><p><strong>REMV_PERC</strong>: estimate of mean percent of individuals subject to removal (harvest) annually (removals / previous total)
</p>
</li>
<li><p><strong>GROW_PERC</strong>: estimate of mean annual growth on survivors (%) (growth / previous total)
</p>
</li>
<li><p><strong>CHNG_PERC</strong>: estimate of mean annual net change (%) (net change / previous total)
</p>
</li>
<li><p><strong>nPlots_TREE</strong>: number of non-zero plots used to compute total tree estimates
</p>
</li>
<li><p><strong>nPlots_RECR</strong>: number of non-zero plots used to compute recruitment estimates
</p>
</li>
<li><p><strong>nPlots_MORT</strong>: number of non-zero plots used to compute mortality estimates
</p>
</li>
<li><p><strong>nPlots_REMV</strong>: number of non-zero plots used to compute removal estimates
</p>
</li>
<li><p><strong>nPlots_AREA</strong>: number of non-zero plots used to compute land area estimates
</p>
</li></ul>



<h3>Note</h3>

<p>All sampling error estimates (SE) are returned as the &quot;percent coefficient of variation&quot; (standard deviation / mean * 100) for consistency with EVALIDator. IMPORTANT: sampling error cannot be used to construct confidence intervals. Please use <code>variance = TRUE</code> for that (i.e., return variance and sample size instead of sampling error).</p>


<h3>Author(s)</h3>

<p>Hunter Stanke and Andrew Finley
</p>


<h3>References</h3>

<p>rFIA website: <a href="https://doserlab.com/files/rfia/">https://doserlab.com/files/rfia/</a>
</p>
<p>FIA Database User Guide: <a href="https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi">https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi</a>
</p>
<p>Bechtold, W.A.; Patterson, P.L., eds. 2005. The Enhanced Forest Inventory and Analysis Program - National Sampling Design and Estimation Procedures. Gen. Tech. Rep. SRS - 80. Asheville, NC: U.S. Department of Agriculture, Forest Service, Southern Research Station. 85 p. <a href="https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf">https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf</a>
</p>
<p>Stanke, H., Finley, A. O., Weed, A. S., Walters, B. F., &amp; Domke, G. M. (2020). rFIA: An R package for estimation of forest attributes with the US Forest Inventory and Analysis database. Environmental Modelling &amp; Software, 127, 104664.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load data from the rFIA package
data(fiaRI)
data(countiesRI)

# Most recents subset
fiaRI_mr &lt;- clipFIA(fiaRI)


# Most recent estimates for growing-stock on timber land by species
growMort(db = fiaRI_mr,
         landType = 'timber',
         treeType = 'gs')

# Same as above at the plot-level
growMort(db = fiaRI_mr,
         landType = 'timber',
         treeType = 'gs',
         byPlot = TRUE)

# Estimates for white pine ( &gt; 12" DBH) on forested mesic sites
growMort(fiaRI_mr,
         treeType = 'all',
         treeDomain = SPCD == 129 &amp; DIA &gt; 12, # Species code for white pine
         areaDomain = PHYSCLCD %in% 21:29) # Mesic Physiographic classes

# Most recent estimates grouped by stand age on forest land
# Make a categorical variable which represents stand age (grouped by 10 yr intervals)
fiaRI_mr$COND$STAND_AGE &lt;- makeClasses(fiaRI_mr$COND$STDAGE, interval = 10)
growMort(db = fiaRI_mr,
         grpBy = STAND_AGE)

# Most recent estimates for stems on forest land by species
growMort(db = fiaRI_mr,
         landType = 'forest',
         bySpecies = TRUE)

# Same as above, but implemented in parallel (much quicker)
# parallel::detectCores(logical = FALSE) # 4 cores available, we will take 2
# growMort(db = fiaRI_mr,
#          landType = 'forest',
#          bySpecies = TRUE,
#          nCores = 2)

# Most recent estimates for all stems on forest land grouped by user-defined areal units
ctSF &lt;- growMort(fiaRI_mr,
                 polys = countiesRI,
                 returnSpatial = TRUE)
plot(ctSF) # Plot multiple variables simultaneously
plotFIA(ctSF, MORT_TPA) # Plot of Mortality TPA with color scale


</code></pre>

<hr>
<h2 id='intersectFIA'>Intersect FIA data with spatial polygons</h2><span id='topic+intersectFIA'></span>

<h3>Description</h3>

<p>Performs spatial intersection between FIA data and user-supplied spatial polygons (sp or sf). Polygon attributes appended to PLOT table, and hence can be used as grouping variables in subsequent calls to rFIA estimator functions. Alternative to the <code>polys</code> argument in rFIA estimator functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>intersectFIA(db, polys, nCores = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="intersectFIA_+3A_db">db</code></td>
<td>
<p><code>FIA.Database</code> or <code>Remote.FIA.Database</code> object produced from <code>readFIA()</code> or <code>getFIA()</code>. If a <code>Remote.FIA.Database</code>, data will be read in and processed state-by-state to conserve RAM (see details for an example).</p>
</td></tr>
<tr><td><code id="intersectFIA_+3A_polys">polys</code></td>
<td>
<p><code>sp</code> or <code>sf</code> Polygon/MultiPolgyon object; Areal units to bin data for estimation. Separate estimates will be produced for region encompassed by each areal unit. FIA plot locations will be reprojected to match projection of <code>polys</code> object.</p>
</td></tr>
<tr><td><code id="intersectFIA_+3A_ncores">nCores</code></td>
<td>
<p>numeric; number of cores to use for parallel implementation. Check available cores using <code><a href="parallel.html#topic+detectCores">detectCores</a></code>. Default = 1, serial processing.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>All polygon attributes will be joined onto the PLOT table.
</p>
<p>Primarily useful if you intend to make multiple calls to rFIA estimator functions, e.g., you need to call both <code>tpa</code> and <code>biomass</code> and group by spatial polygons in both cases. If using the <code>polys</code> argument in each function call, spatial intersection will occur mulitple times, and hence be slower than performing the intersection a single time upfront.
</p>


<h3>Value</h3>

<p>FIA.Database or Remote.FIA.Database, depending on specification of <code>db</code>.
</p>


<h3>Author(s)</h3>

<p>Hunter Stanke and Andrew Finley
</p>


<h3>References</h3>

<p>rFIA website: <a href="https://doserlab.com/files/rfia/">https://doserlab.com/files/rfia/</a>
</p>
<p>FIA Database User Guide: <a href="https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi">https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi</a>
</p>
<p>Bechtold, W.A.; Patterson, P.L., eds. 2005. The Enhanced Forest Inventory and Analysis Program - National Sampling Design and Estimation Procedures. Gen. Tech. Rep. SRS - 80. Asheville, NC: U.S. Department of Agriculture, Forest Service, Southern Research Station. 85 p. <a href="https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf">https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf</a>
</p>
<p>Stanke, H., Finley, A. O., Weed, A. S., Walters, B. F., &amp; Domke, G. M. (2020). rFIA: An R package for estimation of forest attributes with the US Forest Inventory and Analysis database. Environmental Modelling &amp; Software, 127, 104664.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+clipFIA">clipFIA</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(fiaRI)
data(countiesRI)

# Perform spatial intersection
db &lt;- intersectFIA(fiaRI,
                   countiesRI)

# Group estimates by variable defined
# in `countiesRI`
tpa(db,
    grpBy = COUNTY)

</code></pre>

<hr>
<h2 id='invasive'>Estimate invasive species coverage from FIADB</h2><span id='topic+invasive'></span>

<h3>Description</h3>

<p>Produces estimates of areal coverage of invasive species from the Forest Inventory and Analysis Database. Estimates can be produced for regions defined within the FIA Database (e.g. counties), at the plot level, or within user-defined areal units. All estimates are returned by species although can be grouped by other variables defined in the FIADB. If multiple reporting years (EVALIDs) are included in the data, estimates will be output as a time series. If multiple states are represented by the data, estimates will be output for the full region (all area combined), unless specified otherwise (e.g. <code>grpBy = STATECD</code>).</p>


<h3>Usage</h3>

<pre><code class='language-R'>invasive(db, grpBy = NULL, polys = NULL, returnSpatial = FALSE, landType = "forest",
         method = 'TI', lambda = 0.5, areaDomain = NULL, totals = FALSE,
         variance = FALSE, byPlot = FALSE, nCores = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="invasive_+3A_db">db</code></td>
<td>
<p><code>FIA.Database</code> or <code>Remote.FIA.Database</code> object produced from <code><a href="#topic+readFIA">readFIA</a></code> or <code><a href="#topic+getFIA">getFIA</a></code>. If a <code>Remote.FIA.Database</code>, data will be read in and processed state-by-state to conserve RAM (see details for an example).</p>
</td></tr>
<tr><td><code id="invasive_+3A_grpby">grpBy</code></td>
<td>
<p>variables from PLOT or COND tables to group estimates by (NOT quoted). Multiple grouping variables should be combined with <code>c()</code>, and grouping will occur heirarchically. For example, to produce seperate estimates for each ownership group within methods of stand regeneration, specify <code>c(STDORGCD, OWNGRPCD)</code>.</p>
</td></tr>
<tr><td><code id="invasive_+3A_polys">polys</code></td>
<td>
<p><code>sp</code> or <code>sf</code> Polygon/MultiPolgyon object; Areal units to bin data for estimation. Separate estimates will be produced for region encompassed by each areal unit. FIA plot locations will be reprojected to match projection of <code>polys</code> object.</p>
</td></tr>
<tr><td><code id="invasive_+3A_returnspatial">returnSpatial</code></td>
<td>
<p>logical; if TRUE, merge population estimates with <code>polys</code> and return as <code>sf</code> multipolygon object. When <code>byPlot = TRUE</code>, return plot-level estimates as <code>sf</code> spatial points.</p>
</td></tr>
<tr><td><code id="invasive_+3A_landtype">landType</code></td>
<td>
<p>character (&quot;forest&quot; or &quot;timber&quot;); Type of land that estimates will be produced for. Timberland is a subset of forestland (default) which has high site potential and non-reserve status (see details).</p>
</td></tr>
<tr><td><code id="invasive_+3A_method">method</code></td>
<td>
<p>character; design-based estimator to use. One of:  &quot;TI&quot; (temporally indifferent, default), &quot;annual&quot; (annual), &quot;SMA&quot; (simple moving average), &quot;LMA&quot; (linear moving average), or &quot;EMA&quot; (exponential moving average). See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators.</p>
</td></tr>
<tr><td><code id="invasive_+3A_lambda">lambda</code></td>
<td>
<p>numeric (0,1); if <code>method = 'EMA'</code>, the decay parameter used to define weighting scheme for annual panels. Low values place higher weight on more recent panels, and vice versa. Specify a vector of values to compute estimates using mulitple wieghting schemes, and use <code>plotFIA</code> with <code>grp</code> set to <code>lambda</code> to produce moving average ribbon plots. See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for examples.</p>
</td></tr>
<tr><td><code id="invasive_+3A_areadomain">areaDomain</code></td>
<td>
<p>logical predicates defined in terms of the variables in PLOT and/or COND tables. Used to define the area for which estimates will be produced (e.g. within 1 mile of improved road: <code>RDDISTCD %in% c(1:6)</code>, Hard maple/basswood forest type: <code>FORTYPCD == 805</code>. Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only plots within areas where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="invasive_+3A_totals">totals</code></td>
<td>
<p>logical; if TRUE, return total population estimates (e.g. total area) along with ratio estimates (e.g. mean trees per acre).</p>
</td></tr>
<tr><td><code id="invasive_+3A_variance">variance</code></td>
<td>
<p>logical; if TRUE, return estimated variance (<code>VAR</code>) and sample size (<code>N</code>). If FALSE, return 'sampling error' (<code>SE</code>) as returned by EVALIDator. Note: sampling error cannot be used to construct confidence intervals.</p>
</td></tr>
<tr><td><code id="invasive_+3A_byplot">byPlot</code></td>
<td>
<p>logical; if TRUE, returns estimates for individual plot locations instead of population estimates.</p>
</td></tr>
<tr><td><code id="invasive_+3A_ncores">nCores</code></td>
<td>
<p>numeric; number of cores to use for parallel implementation. Check available cores using <code><a href="parallel.html#topic+detectCores">detectCores</a></code>. Default = 1, serial processing.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Estimation Details</strong>
</p>
<p>Estimation of forest variables follows the procedures documented in Bechtold and Patterson (2005) and <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a>.
</p>
<p>Specifically, percent areal coverage is computed using a sample-based ratio-of-means estimator of total invasive coverage area / total land area within the domain of interest. Estimates of areal coverage of individual invasive species should NOT be summed to produce estimates of areal coverage by ALL invasive species, as areal coverage by species is not mutually exclusive (multiple species may occur in the same area). Current FIA data collection protocols do not allow for the unbiased estimation of areal coverage by all invasive species.
</p>
<p>Users may specify alternatives to the 'Temporally Indifferent' estimator using the <code>method</code> argument. Alternative design-based estimators include the annual estimator (&quot;ANNUAL&quot;; annual panels, or estimates from plots measured in the same year), simple moving average (&quot;SMA&quot;; combines annual panels with equal weight), linear moving average (&quot;LMA&quot;; combine annual panels with weights that decay <em>linearly</em> with time since measurement), and exponential moving average (&quot;EMA&quot;; combine annual panels with weights that decay <em>exponentially</em> with time since measurement). The &quot;best&quot; estimator depends entirely on user-objectives, see <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators and tradeoffs between precision and temporal specificity.
</p>
<p>When <code>byPlot = FALSE</code> (i.e., population estimates are returned), the &quot;YEAR&quot; column in the resulting dataframe indicates the final year of the inventory cycle that estimates are produced for. For example, an estimate of current forest area (e.g., 2018) may draw on data collected from 2008-2018, and &quot;YEAR&quot; will be listed as 2018 (consistent with EVALIDator). However, when <code>byPlot = TRUE</code> (i.e., plot-level estimates returned), the &quot;YEAR&quot; column denotes the year that each plot was measured (MEASYEAR), which may differ slightly from its associated inventory year (INVYR).
</p>
<p>Stratified random sampling techniques are most often employed to compute estimates in recent inventories, although double sampling and simple random sampling may be employed for early inventories. Estimates are adjusted for non-response bias by assuming attributes of non-response plot locations to be equal to the mean of other plots included within thier respective stratum or population.
</p>
<p><strong>Working with &quot;Big Data&quot;</strong>
</p>
<p>If FIA data are too large to hold in memory (e.g., R throws the &quot;cannot allocate vector of size ...&quot; errors), use larger-than-RAM options. See documentation of <code>link{readFIA}</code> for examples of how to set up a <code>Remote.FIA.Database</code>. As a reference, we have used rFIA's larger-than-RAM methods to estimate forest variables using the entire FIA Database (~50GB) on a standard desktop computer with 16GB of RAM. Check out <a href="https://doserlab.com/files/rfia/">our website</a> for more details and examples.
</p>
<p>Easy, efficient parallelization is implemented with the <code><a href="parallel.html#topic+parallel">parallel</a></code> package. Users must only specify the <code>nCores</code> argument with a value greater than 1 in order to implement parallel processing on their machines. Parallel implementation is achieved using a snow type cluster on any Windows OS, and with multicore forking on any Unix OS (Linux, Mac). Implementing parallel processing may substantially decrease free memory during processing, particularly on Windows OS. Thus, users should be cautious when running in parallel, and consider implementing serial processing for this task if computational resources are limited (<code>nCores = 1</code>).
</p>
<p><strong>Definition of forestland</strong>
</p>
<p>Forest land must have at least 10-percent canopy cover by live tally trees of any size, including land that formerly had such tree cover and that will be naturally or artificially regenerated. Forest land includes transition zones, such as areas between heavily forest and non-forested lands that meet the mimium tree canopy cover and forest areas adjacent to urban and built-up lands. The minimum area for classification of forest land is 1 acre in size and 120 feet wide measured stem-to-stem from the outer-most edge. Roadside, streamside, and shelterbelt strips of trees must have a width of at least 120 feet and continuous length of at least 363 feet to qualify as forest land. Tree-covered areas in agricultural production settings, such as fruit orchards, or tree-covered areas in urban settings, such as city parks, are not considered forest land.
</p>
<p>Timber land is a subset of forest land that is producing or is capable of producing crops of industrial wood and not withdrawn from timber utilization by statute or administrative regulation. (Note: Areas qualifying as timberland are capable of producing at least 20 cubic feet per acre per year of industrial wood in natural stands. Currently inaccessible and inoperable areas are NOT included).
</p>


<h3>Value</h3>

<p>Dataframe or sf object (if <code>returnSpatial = TRUE</code>). If <code>byPlot = TRUE</code>, values are returned for each plot (proportion of plot in domain of interest; <code>PLOT_STATUS_CD = 1</code> when forest exists at the plot location). All variables with names ending in <code>SE</code>, represent the estimate of sampling error (%) of the variable. When <code>variance = TRUE</code>, variables ending in <code>VAR</code> denote the variance of the variable and <code>N</code> is the total sample size (i.e., including non-zero plots).
</p>

<ul>
<li><p><strong>YEAR</strong>: reporting year associated with estimates
</p>
</li>
<li><p><strong>SYMBOL</strong>: unique species ID from NRCS Plant Reference Guide
</p>
</li>
<li><p><strong>SCIENTIFIC_NAME</strong>: scientific name of the species
</p>
</li>
<li><p><strong>COMMON_NAME</strong>: common name of the species
</p>
</li>
<li><p><strong>COVER_PCT</strong>: estimate of percent areal coverage of the species 
</p>
</li>
<li><p><strong>COVER_AREA</strong>: estimate of areal coverage of the species (acres) 
</p>
</li>
<li><p><strong>AREA</strong>: estimate of total land area (acres) 
</p>
</li>
<li><p><strong>nPlots_INV</strong>: number of non-zero plots used to compute invasive coverage estimates
</p>
</li>
<li><p><strong>nPlots_AREA</strong>: number of non-zero plots used to compute land area estimates
</p>
</li></ul>



<h3>Note</h3>

<p>All sampling error estimates (SE) are returned as the &quot;percent coefficient of variation&quot; (standard deviation / mean * 100) for consistency with EVALIDator. IMPORTANT: sampling error cannot be used to construct confidence intervals. Please use <code>variance = TRUE</code> for that (i.e., return variance and sample size instead of sampling error).</p>


<h3>Author(s)</h3>

<p>Hunter Stanke and Andrew Finley
</p>


<h3>References</h3>

<p>rFIA website: <a href="https://doserlab.com/files/rfia/">https://doserlab.com/files/rfia/</a>
</p>
<p>FIA Database User Guide: <a href="https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi">https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi</a>
</p>
<p>Bechtold, W.A.; Patterson, P.L., eds. 2005. The Enhanced Forest Inventory and Analysis Program - National Sampling Design and Estimation Procedures. Gen. Tech. Rep. SRS - 80. Asheville, NC: U.S. Department of Agriculture, Forest Service, Southern Research Station. 85 p. <a href="https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf">https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf</a>
</p>
<p>Stanke, H., Finley, A. O., Weed, A. S., Walters, B. F., &amp; Domke, G. M. (2020). rFIA: An R package for estimation of forest attributes with the US Forest Inventory and Analysis database. Environmental Modelling &amp; Software, 127, 104664.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Load data from the rFIA package
data(fiaRI)
data(countiesRI)

## Most recents subset
fiaRI_mr &lt;- clipFIA(fiaRI)


## Most recent estimates on forest land
invasive(db = fiaRI_mr,
         landType = 'forest')

## Most recent estimates on forest land
invasive(db = fiaRI_mr,
         landType = 'forest',
         byPlot = TRUE)

## Same as above, but implemented in parallel (much quicker)
# parallel::detectCores(logical = FALSE) # 4 cores available, we will take 2
# invasive(db = fiaRI_mr,
#          landType = 'forest',
#          nCores = 2)

## Most recent estimates grouped by stand age on forest land
# Make a categorical variable which represents stand age (grouped by 10 yr intervals)
fiaRI_mr$COND$STAND_AGE &lt;- makeClasses(fiaRI_mr$COND$STDAGE, interval = 10)
invasive(db = fiaRI_mr,
         grpBy = STAND_AGE)

## Estimates on forested mesic sites (all available inventories)
invasive(fiaRI,
         areaDomain = PHYSCLCD %in% 21:29) # Mesic Physiographic classes


</code></pre>

<hr>
<h2 id='makeClasses'>Convert numeric variables to class intervals (factor)</h2><span id='topic+makeClasses'></span>

<h3>Description</h3>

<p>Convert continuous numeric variables to class intervals with output as factor or numeric classes. Simplified implementation of <code><a href="base.html#topic+cut">cut</a></code>. Example uses include computing diameter or height classes for summarization with <span class="pkg">rFIA</span> functions (e.g. <code><a href="#topic+tpa">tpa</a></code>, <code>biomass</code>).</p>


<h3>Usage</h3>

<pre><code class='language-R'>makeClasses(x, interval = NULL, lower = NULL, upper = NULL,
            brks = NULL, numLabs = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="makeClasses_+3A_x">x</code></td>
<td>
<p>numeric vector to be converted to factor (class intervals).</p>
</td></tr>
<tr><td><code id="makeClasses_+3A_interval">interval</code></td>
<td>
<p>numeric; interval of desired output classes. e.g. specify <code>x = DIA</code> and <code>interval = 2</code> for 2-inch diameter class intervals.</p>
</td></tr>
<tr><td><code id="makeClasses_+3A_lower">lower</code></td>
<td>
<p>lower bound of output classes, included in lowest class. e.g. [<code>lower</code>, ...).</p>
</td></tr>
<tr><td><code id="makeClasses_+3A_upper">upper</code></td>
<td>
<p>upper bound of output classes, NOT included in highest class. e.g. [..., <code>upper</code>).</p>
</td></tr>
<tr><td><code id="makeClasses_+3A_brks">brks</code></td>
<td>
<p>numeric vector of desired breakpoints (bounds) of class intervals.</p>
</td></tr>
<tr><td><code id="makeClasses_+3A_numlabs">numLabs</code></td>
<td>
<p>logical; if TRUE, return class intervals as numeric vector with values representing the lower bounds of each interval. If FALSE, return factor with labels of form <code>'[b1, b2)'</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Factor or integer vector. Factor values represent class intervals with <code>[b1, b2)</code> notation, values of integer vectors represent the lower bounds of class intervals (e.g. <code>b1</code>).
</p>


<h3>Author(s)</h3>

<p>Hunter Stanke and Andrew Finley
</p>


<h3>See Also</h3>

<p><code><a href="#topic+clipFIA">clipFIA</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Load data from the rFIA package
data(fiaRI)

## Compute Diameter Classes on 1-inch intervals for each tree in TREE table ----
# Factor w/ interval labels
makeClasses(fiaRI$TREE$DIA, interval = 1)
# Numeric w/ lower bound of each class as returned value
makeClasses(fiaRI$TREE$DIA, interval = 1, numLabs = TRUE)

## Compute Stand Age Classes on 20 year intervals for each
## condition in COND table ----
# NOTE: Unrecorded stand age recorded as -999, replace negative values with NA
fiaRI$COND$STDAGE[fiaRI$COND$STDAGE &lt; 0] &lt;- NA
makeClasses(fiaRI$COND$STDAGE, interval = 25)

## Compute Stand Stocking Classes (10%) for all live (ALSTK),
## and growing stock (GSSTK) in COND table ----
makeClasses(fiaRI$COND$ALSTK, interval = 10) # All Live
makeClasses(fiaRI$COND$GSSTK, interval = 10) # Growing Stock

## Compute % Slope Classes (20%) for each condition in COND table ----
makeClasses(fiaRI$COND$SLOPE, interval = 20)

</code></pre>

<hr>
<h2 id='plotFIA'>Static and animated plots of FIA summaries</h2><span id='topic+plotFIA'></span>

<h3>Description</h3>

<p>Default behavior for non-spatial summaries produces time-series plots, and for spatial summaries (class <code>sf</code>) produces choropleth maps. For non-spatial summaries, the user may specify the <code>grp</code> parameter to produce plots with multiple lines, colored by a grouping variable. Additionally, users may specify an x-axis to produce plots other than time series (e.g. BAA (<code>y</code>) by size class (<code>x</code>) colored by species (<code>grp</code>)).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotFIA(data, y = NULL, grp = NULL, x = NULL, animate = FALSE, facet = FALSE,
        se = FALSE,n.max = NULL, plot.title = NULL, y.lab = NULL, x.lab = NULL,
        legend.title = NULL, legend.labs = waiver(), limits = c(NA, NA),
        color.option = 'viridis', line.color = "gray30", line.width =1,
        min.year = 2005, direction = 1, alpha = .9, transform = "identity",
        text.size = 1, text.font = '', lab.width = 1, legend.height = 1,
        legend.width = 1, device = "png", savePath = NULL, fileName = NULL)
           </code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plotFIA_+3A_data">data</code></td>
<td>
<p>dataframe, <code>sf</code> object, or <code>FIA.Database</code> object; FIA summary produced from other <code>rFIA</code> functions (e.g. <code>tpa</code>, <code>biomass</code>, etc.). Also accepts <code>FIA.Database</code>, will return map of plot locations.</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_y">y</code></td>
<td>
<p>variable contained in <code>data</code> which will be used as y-axis or to fill polygons (spatial). NOT quoted.</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_grp">grp</code></td>
<td>
<p>variable contained in <code>data</code> which will be used as a grouping variable. Not meaningful for spatial summaries. NOT quoted.</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_x">x</code></td>
<td>
<p>variable contained in <code>data</code> which will be used as a x-axis in place of time. If NULL, time-series plot will be produced. Not meaningful for spatial summaries. NOT quoted.</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_animate">animate</code></td>
<td>
<p>logical; if TRUE, produces temporally animated plots.</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_facet">facet</code></td>
<td>
<p>logical; if TRUE, produces temporally grouped plots (stationary).</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_se">se</code></td>
<td>
<p>logical; if TRUE, plots error bars along with estimates. All error bars represent 95% confidence.</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_n.max">n.max</code></td>
<td>
<p>numeric; maximum number of groups to plot. If positive, will plot the top <code>n</code> groups with respect to <code>y</code>, and if negative, will plot the bottom <code>n</code>. Not meaningful for spatial summaries.</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_plot.title">plot.title</code></td>
<td>
<p>character; plot title.</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_y.lab">y.lab</code></td>
<td>
<p>character; y-axis label. Not meaningful for spatial summaries.</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_x.lab">x.lab</code></td>
<td>
<p>character; x-axis label. Not meaningful for spatial summaries.</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_legend.title">legend.title</code></td>
<td>
<p>character; title for legend.</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_legend.labs">legend.labs</code></td>
<td>
<p>character; labels for legend values.</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_limits">limits</code></td>
<td>
<p>numeric vector of length 2; minumum and maximum of continuous scale for legend.</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_color.option">color.option</code></td>
<td>
<p>character; one of: &quot;viridis&quot; (default), &quot;magma&quot;, &quot;inferno&quot;, &quot;plasma&quot;, or &quot;cividis&quot;.</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_line.color">line.color</code></td>
<td>
<p>character; color of plotted line (non-spatial) or polygon outline color (spatial).</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_line.width">line.width</code></td>
<td>
<p>numeric; scalar for plotted line width (non-spatial) polygon outline width (spatial). Specify <code>lineWidth = 0</code> for no outline.</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_min.year">min.year</code></td>
<td>
<p>numeric; earliest year to be included in animation. FIA data is sparse in years prior to 2005 and estimates are unlikely to be available.</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_direction">direction</code></td>
<td>
<p>numeric; sets the order of colors in the scale. If 1, the default, colors are ordered from darkest to lightest. If -1, the order of colors is reversed.</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_alpha">alpha</code></td>
<td>
<p>numeric; alpha transparency, a number in [0,1], see argument alpha in <code>hsv</code>.</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_transform">transform</code></td>
<td>
<p>character; transformations to apply to plotted variable <code>y</code>. Options include: &quot;asn&quot;, &quot;atanh&quot;, &quot;boxcox&quot;, &quot;exp&quot;, &quot;identity&quot;, &quot;log&quot;, &quot;log10&quot;, &quot;log1p&quot;, &quot;log2&quot;, &quot;logit&quot;, &quot;reciprocal&quot;, &quot;reverse&quot;, &quot;sqrt&quot;.</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_text.size">text.size</code></td>
<td>
<p>numeric; scalar for text size (e.g. text.size = 2 would be twice the default size).</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_text.font">text.font</code></td>
<td>
<p>character; font family. Choose from: 'Short', 'Canonical', 'mono', 'Courier', 'sans', 'Helvetica', 'serif', 'Times', 'AvantGarde', 'Bookman', 'Helvetica-Narrow', 'NewCenturySchoolbook', 'Palatino', 'URWGothic',  'URWBookman', 'NimbusMon', 'URWHelvetica', 'NimbusSan', 'NimbusSanCond', 'CenturySch', 'URWPalladio', 'URWTimes', or 'NimbusRom'.</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_lab.width">lab.width</code></td>
<td>
<p>numeric; scalar for legend title width. This value controls text wrapping in title.</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_legend.height">legend.height</code></td>
<td>
<p>numeric; scalar for legend height.</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_legend.width">legend.width</code></td>
<td>
<p>numeric; scalar for legend width.</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_device">device</code></td>
<td>
<p>character; device to use for image save. Can either be a device function (e.g. png()), or one of &quot;eps&quot;, &quot;ps&quot;, &quot;tex&quot; (pictex), &quot;pdf&quot;, &quot;jpeg&quot;, &quot;tiff&quot;, &quot;png&quot;, &quot;bmp&quot;, &quot;svg&quot; or &quot;wmf&quot; (windows only).</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_savepath">savePath</code></td>
<td>
<p>character; path to save plot to (combined with fileName).</p>
</td></tr>
<tr><td><code id="plotFIA_+3A_filename">fileName</code></td>
<td>
<p>character; file name to create on disk.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>To produce spatial plots, summaries must be returned as spatial objects (e.g. specify <code>returnSpatial = TRUE</code> when computing summaries using <code><a href="#topic+tpa">tpa</a></code>). For animated plots, also requires that multiple reporting years be present in the summary data (animations iterate through time). For a map of plot locations contained in your <code>FIA.Database</code>, specify the object as the <code>data</code> argument.
</p>
<p>For objects produced with <code>byPlot = TRUE</code> and <code>returnSpatial = TRUE</code> (spatial point patterns), a categorical grouping variable can be specified to <code>grp</code>. Point radii will reflect magnitude of <code>y</code> and color will reflect categorical groups (<code>grp</code>).
</p>
<p>If <code>animate = FALSE</code> and multiple reporting years are present in the summary, produces plots of the most recent subset.
</p>
<p>Specify <code>savePath</code> and <code>fileName</code> to save plots (animations saved as .gif files).
</p>


<h3>Value</h3>

<p>A <code>ggplot</code> object containing the resulting plot. 
</p>


<h3>Author(s)</h3>

<p>Hunter Stanke and Andrew Finley
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Load data from the rFIA package
data(fiaRI)
data(countiesRI)



################### SPATIAL PLOTTING #############################
## Compute abundance estimates for live stems in Rhode Island
## for all available inventory years, summarized by counties and
## return a spatial object
tpaRI &lt;- tpa(fiaRI, polys = countiesRI, returnSpatial = TRUE)

## Produce animated plot
if(interactive()) {
  plotFIA(tpaRI, y = TPA, animate = TRUE, legend.title = 'Abundance (TPA)')
}
## With a square root transform
if(interactive()) {
  plotFIA(tpaRI, y = TPA, animate = TRUE, legend.title = 'Abundance (TPA)', transform = 'sqrt')
}

## Same as above, but for static plots (most recent subset from RI)
tpaMR &lt;- tpa(clipFIA(fiaRI), polys = countiesRI, returnSpatial = TRUE)
## Produce animated plot
plotFIA(tpaMR, y = TPA, animate = FALSE, plot.title = 'Abundance (TPA)')


################# NON-SPATIAL PLOTTING #########################
## Same as above, but return a non-spatial object (no spatial grouping)
tpaRI &lt;- tpa(fiaRI)

## Plot TPA over time
plotFIA(tpaRI, TPA)

## BAA over time, grouped by ownership group
tpaRI_own &lt;- tpa(fiaRI, grpBy = OWNGRPCD)
plotFIA(tpaRI_own, y = BAA, grp = OWNGRPCD)

## BAA by size class (not a time series) grouped by species
tpaRI_sc &lt;- tpa(clipFIA(fiaRI), bySpecies = TRUE, bySizeClass = TRUE)
plotFIA(tpaRI_sc, y = BAA, grp = COMMON_NAME, x = sizeClass, n.max = 4)# Only the top 4


</code></pre>

<hr>
<h2 id='readFIA'>Load FIA database into R environment from local directory</h2><span id='topic+readFIA'></span>

<h3>Description</h3>

<p>Loads FIA Datatables into R from .csv files stored in a local directory (common, easy), or from a database connection (uncommon, difficult). If you have not previously downloaded FIA Data from the FIA Datamart, use <code>getFIA()</code> to download data for your region of interest and load it into R.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>readFIA(dir = NULL, con = NULL, schema = NULL, common = TRUE, tables = NULL,
        states = NULL, inMemory = TRUE, nCores = 1, ...)
        </code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="readFIA_+3A_dir">dir</code></td>
<td>
<p>directory where .csv files of FIA tables are stored.</p>
</td></tr>
<tr><td><code id="readFIA_+3A_con">con</code></td>
<td>
<p>database connection (e.g., produced with <code>DBI::dbConnect()</code>. Only required when reading tables from a database connection. Most users will want to specify <code>dir</code> instead, reading FIA tables from .csv files.)</p>
</td></tr>
<tr><td><code id="readFIA_+3A_schema">schema</code></td>
<td>
<p>SQL Schema that contains FIA tables. Only required when reading tables from a database connection, which most users should avoid.</p>
</td></tr>
<tr><td><code id="readFIA_+3A_common">common</code></td>
<td>
<p>logical; if TRUE, only import most commonly used tables, including all required for <code>rFIA</code> functions (see Details for list of tables).</p>
</td></tr>
<tr><td><code id="readFIA_+3A_tables">tables</code></td>
<td>
<p>character vector; names of specific tables to be imported (e.g. 'PLOT', 'TREE', 'COND', 'TREE_GRM_COMPONENT').</p>
</td></tr>
<tr><td><code id="readFIA_+3A_states">states</code></td>
<td>
<p>character; state/ US territory abbreviations (e.g. 'AL', 'MI', etc.) indicating which state subsets to read. Data for each state must be in <code>dir</code>. Choose to read multiple states by passing character vector of state abbreviations (e.g. <code>states = c('RI', 'CT', 'MA')</code>). If <code>states = NULL</code>, data for all states within <code>dir</code> will be read in and merged into a regional database.</p>
</td></tr>
<tr><td><code id="readFIA_+3A_inmemory">inMemory</code></td>
<td>
<p>logical; should data be stored in-memory? If FALSE, data will be read in state-by-state when an estimator function is called (e.g., <code>tpa()</code>). This conserves RAM and allows the user to to produce estimates using very large databases that does not all fit in memory at once.</p>
</td></tr>
<tr><td><code id="readFIA_+3A_ncores">nCores</code></td>
<td>
<p>numeric; number of cores to use for parallel implementation. Check available cores using <code>detectCores()</code>. Default = 1, serial processing.</p>
</td></tr>
<tr><td><code id="readFIA_+3A_...">...</code></td>
<td>
<p>other arguments to pass to <code>data.table::fread()</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Download subsets of the FIA Database using <code>getFIA()</code> (recommended), or manually from the FIA Datamart: <a href="https://apps.fs.usda.gov/fia/datamart/datamart.html">https://apps.fs.usda.gov/fia/datamart/datamart.html</a>. Once downloaded, unzip the directory (if downloaded manually), and read into R using <code>readFIA()</code>.
</p>
<p>If <code>common = TRUE</code>, the following tables will be imported: COND, COND_DWM_CALC, INVASIVE_SUBPLOT_SPP, PLOT, POP_ESTN_UNIT, POP_EVAL, POP_EVAL_GRP, POP_EVAL_TYP, POP_PLOT_STRATUM_ASSGN, POP_STRATUM, SUBPLOT, TREE, TREE_GRM_COMPONENT, TREE_GRM_MIDPT, TREE_GRM_BEGIN, SUBP_COND_CHNG_MTRX, SEEDLING, SURVEY, SUBP_COND, P2VEG_SUBP_STRUCTURE. These tables currently support all functionality with <code>rFIA</code>, and it is recommended that only these tables be imported to conserve RAM and reduce processing time.
</p>
<p>If you wish to merge multiple state downloads of FIA data (e.g. North Carolina and Virginia state downloads), simply place both sets of datatables in the same directory (done for you when using <code>getFIA()</code>) and import with <code>readFIA</code>. Upon import, corresponding tables (e.g. NC_PLOT and VA_PLOT) will be merged, and analysis can be completed for the entire region or within spatial units which transcend state boundaries (e.g. Ecoregion subsections).
</p>
<p>Easy, efficient parallelization is implemented with the <code><a href="parallel.html#topic+parallel">parallel</a></code> package. Users must only specify the <code>nCores</code> argument with a value greater than 1 in order to implement parallel processing on their machines. Parallel implementation is achieved using a snow type cluster on any Windows OS, and with multicore forking on any Unix OS (Linux, Mac). Implementing parallel processing may substantially decrease decrease free memory during processing, particularly on Windows OS. Thus, users should be cautious when running in parallel, and consider implementing serial processing for this task if computational resources are limited (<code>nCores = 1</code>).
</p>


<h3>Value</h3>

<p>List object containing FIA tables. List elements represent individual FIA tables stored as <code>data.frame</code> objects. Names of list elements reflect names of files from which they were read into R environment (File names should not be changed after download from FIA Datamart).
</p>
<p>If multiple subsets of the FIA database are held in the same directory (e.g. North Carolina and Virginia state downloads), corresponding tables will be merged (e.g. PLOT table returned contains plots in both North Carolina and Virginia).
</p>


<h3>Note</h3>

<p>To download subsets of the FIA Database manually, go online to the FIA Datamart (<a href="https://apps.fs.usda.gov/fia/datamart/datamart.html">https://apps.fs.usda.gov/fia/datamart/datamart.html</a>) and choose to download .csv files. Here you can choose to download subsets of the full database for individual states, or select to download individual tables. For use with the <code>rFIA</code> package, we recommend downloading of subsets of the full database representing individual states of interest. Files must be unzipped in order to be imported.
</p>
<p>Alternatively, use <code>getFIA()</code> to automate the download, reading, and saving process for you (recommended).
</p>


<h3>Author(s)</h3>

<p>Hunter Stanke and Andrew Finley
</p>


<h3>References</h3>

<p>FIA DataMart: <a href="https://apps.fs.usda.gov/fia/datamart/datamart.html">https://apps.fs.usda.gov/fia/datamart/datamart.html</a>
</p>
<p>FIA Database User Guide: <a href="https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi">https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+clipFIA">clipFIA</a></code>, <code><a href="#topic+getFIA">getFIA</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# The following examples shows how you
# can take an existing in-memory FIA.Database,
# save it, and read it back in!


# First download the common tables for Rhode Island,
# load into R, but don't save it anywhere yet
db &lt;- getFIA(states = 'RI')



# Now we write it all out
# Replace tempdir() with the path to your
# directory (where data will be saved)
writeFIA(db, dir = tempdir())


</code></pre>

<hr>
<h2 id='seedling'>Estimate seedling abundance per acre from FIADB</h2><span id='topic+seedling'></span>

<h3>Description</h3>

<p>Produces seedling (&lt; 1 inch DBH) tree per acre (TPA) estimates from FIA data, along with population totals. Estimates can be produced for regions defined within the FIA Database (e.g. counties), at the plot level, or within user-defined areal units. Options to group estimates by species and other variables defined in the FIADB. If multiple reporting years (EVALIDs) are included in the data, estimates will be output as a time series. If multiple states are represented by the data, estimates will be output for the full region (all area combined), unless specified otherwise (e.g. <code>grpBy = STATECD</code>). Easy options to implement parallel processing.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>seedling(db, grpBy = NULL, polys = NULL, returnSpatial = FALSE,
         bySpecies = FALSE, landType = "forest", method = 'TI',
         lambda = 0.5, treeDomain = NULL, areaDomain = NULL,
         totals = FALSE, variance = FALSE, byPlot = FALSE,
         treeList = FALSE, nCores = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="seedling_+3A_db">db</code></td>
<td>
<p><code>FIA.Database</code> or <code>Remote.FIA.Database</code> object produced from <code><a href="#topic+readFIA">readFIA</a></code> or <code><a href="#topic+getFIA">getFIA</a></code>. If a <code>Remote.FIA.Database</code>, data will be read in and processed state-by-state to conserve RAM (see details for an example).</p>
</td></tr>
<tr><td><code id="seedling_+3A_grpby">grpBy</code></td>
<td>
<p>variables from PLOT, COND, or SEEDLING tables to group estimates by (NOT quoted). Multiple grouping variables should be combined with <code>c()</code>, and grouping will occur heirarchically. For example, to produce seperate estimates for each ownership group within methods of stand regeneration, specify <code>c(STDORGCD, OWNGRPCD)</code>.</p>
</td></tr>
<tr><td><code id="seedling_+3A_polys">polys</code></td>
<td>
<p><code>sp</code> or <code>sf</code> Polygon/MultiPolgyon object; Areal units to bin data for estimation. Seperate estimates will be produced for region encompassed by each areal unit. FIA plot locations will be reprojected to match projection of <code>polys</code> object.</p>
</td></tr>
<tr><td><code id="seedling_+3A_returnspatial">returnSpatial</code></td>
<td>
<p>logical; if TRUE, merge population estimates with <code>polys</code> and return as <code>sf</code> multipolygon object. When <code>byPlot = TRUE</code>, return plot-level estimates as <code>sf</code> spatial points.</p>
</td></tr>
<tr><td><code id="seedling_+3A_byspecies">bySpecies</code></td>
<td>
<p>logical; if TRUE, returns estimates grouped by species.</p>
</td></tr>
<tr><td><code id="seedling_+3A_landtype">landType</code></td>
<td>
<p>character (&quot;forest&quot; or &quot;timber&quot;); Type of land that estimates will be produced for. Timberland is a subset of forestland (default) which has high site potential and non-reserve status (see details).</p>
</td></tr>
<tr><td><code id="seedling_+3A_method">method</code></td>
<td>
<p>character; design-based estimator to use. One of:  &quot;TI&quot; (temporally indifferent, default), &quot;annual&quot; (annual), &quot;SMA&quot; (simple moving average), &quot;LMA&quot; (linear moving average), or &quot;EMA&quot; (exponential moving average). See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators.</p>
</td></tr>
<tr><td><code id="seedling_+3A_lambda">lambda</code></td>
<td>
<p>numeric (0,1); if <code>method = 'EMA'</code>, the decay parameter used to define weighting scheme for annual panels. Low values place higher weight on more recent panels, and vice versa. Specify a vector of values to compute estimates using mulitple weighting schemes, and use <code>plotFIA</code> with <code>grp</code> set to <code>lambda</code> to produce moving average ribbon plots. See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for examples.</p>
</td></tr>
<tr><td><code id="seedling_+3A_treedomain">treeDomain</code></td>
<td>
<p>logical predicates defined in terms of the variables in PLOT, SEEDLING, and/or COND tables. Used to define the type of trees for which estimates will be produced (e.g. white pine: <code>SPCD == 129</code>). Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only trees where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="seedling_+3A_areadomain">areaDomain</code></td>
<td>
<p>logical predicates defined in terms of the variables in PLOT and/or COND tables. Used to define the area for which estimates will be produced (e.g. within 1 mile of improved road: <code>RDDISTCD %in% c(1:6)</code>, Hard maple/basswood forest type: <code>FORTYPCD == 805</code>. Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only plots within areas where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="seedling_+3A_totals">totals</code></td>
<td>
<p>logical; if TRUE, return total population estimates (e.g. total area) along with ratio estimates (e.g. mean trees per acre).</p>
</td></tr>
<tr><td><code id="seedling_+3A_variance">variance</code></td>
<td>
<p>logical; if TRUE, return estimated variance (<code>VAR</code>) and sample size (<code>N</code>). If FALSE, return 'sampling error' (<code>SE</code>) as returned by EVALIDator. Note: sampling error cannot be used to construct confidence intervals.</p>
</td></tr>
<tr><td><code id="seedling_+3A_byplot">byPlot</code></td>
<td>
<p>logical; if TRUE, returns estimates for individual plot locations instead of population estimates.</p>
</td></tr>
<tr><td><code id="seedling_+3A_treelist">treeList</code></td>
<td>
<p>logical; if TRUE, returns tree-level summaries intended for subsequent use with <code>customPSE</code>.</p>
</td></tr>
<tr><td><code id="seedling_+3A_ncores">nCores</code></td>
<td>
<p>numeric; number of cores to use for parallel implementation. Check available cores using <code><a href="parallel.html#topic+detectCores">detectCores</a></code>. Default = 1, serial processing.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Estimation Details</strong>
</p>
<p>Estimation of forest variables follows the procedures documented in Bechtold and Patterson (2005) and <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a>.
</p>
<p>Specifically, TPA is computed using a sample-based ratio-of-means estimator of total seedlings / total land area within the domain of interest. Percentages of live TPA in the domain of interest are represented as the total number of trees of a particular type (e.g., white pine) / total number of trees (live, all species) within the region. The total populations used to compute these percentages will vary if the user specifies an areaDomain or treeDomain.
</p>
<p>Users may specify alternatives to the 'Temporally Indifferent' estimator using the <code>method</code> argument. Alternative design-based estimators include the annual estimator (&quot;ANNUAL&quot;; annual panels, or estimates from plots measured in the same year), simple moving average (&quot;SMA&quot;; combines annual panels with equal weight), linear moving average (&quot;LMA&quot;; combine annual panels with weights that decay <em>linearly</em> with time since measurement), and exponential moving average (&quot;EMA&quot;; combine annual panels with weights that decay <em>exponentially</em> with time since measurement). The &quot;best&quot; estimator depends entirely on user-objectives, see <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators and tradeoffs between precision and temporal specificity.
</p>
<p>When <code>byPlot = FALSE</code> (i.e., population estimates are returned), the &quot;YEAR&quot; column in the resulting dataframe indicates the final year of the inventory cycle that estimates are produced for. For example, an estimate of current forest area (e.g., 2018) may draw on data collected from 2008-2018, and &quot;YEAR&quot; will be listed as 2018 (consistent with EVALIDator). However, when <code>byPlot = TRUE</code> (i.e., plot-level estimates returned), the &quot;YEAR&quot; column denotes the year that each plot was measured (MEASYEAR), which may differ slightly from its associated inventory year (INVYR).
</p>
<p>Stratified random sampling techniques are most often employed to compute estimates in recent inventories, although double sampling and simple random sampling may be employed for early inventories. Estimates are adjusted for non-response bias by assuming attributes of non-response plot locations to be equal to the mean of other plots included within thier respective stratum or population.
</p>
<p><strong>Working with &quot;Big Data&quot;</strong>
</p>
<p>If FIA data are too large to hold in memory (e.g., R throws the &quot;cannot allocate vector of size ...&quot; errors), use larger-than-RAM options. See documentation of <code>link{readFIA}</code> for examples of how to set up a <code>Remote.FIA.Database</code>. As a reference, we have used rFIA's larger-than-RAM methods to estimate forest variables using the entire FIA Database (~50GB) on a standard desktop computer with 16GB of RAM. Check out <a href="https://doserlab.com/files/rfia/">our website</a> for more details and examples.
</p>
<p>Easy, efficient parallelization is implemented with the <code><a href="parallel.html#topic+parallel">parallel</a></code> package. Users must only specify the <code>nCores</code> argument with a value greater than 1 in order to implement parallel processing on their machines. Parallel implementation is achieved using a snow type cluster on any Windows OS, and with multicore forking on any Unix OS (Linux, Mac). Implementing parallel processing may substantially decrease free memory during processing, particularly on Windows OS. Thus, users should be cautious when running in parallel, and consider implementing serial processing for this task if computational resources are limited (<code>nCores = 1</code>).
</p>
<p><strong>Definition of forestland</strong>
</p>
<p>Forest land must have at least 10-percent canopy cover by live tally trees of any size, including land that formerly had such tree cover and that will be naturally or artificially regenerated. Forest land includes transition zones, such as areas between heavily forest and non-forested lands that meet the mimium tree canopy cover and forest areas adjacent to urban and built-up lands. The minimum area for classification of forest land is 1 acre in size and 120 feet wide measured stem-to-stem from the outer-most edge. Roadside, streamside, and shelterbelt strips of trees must have a width of at least 120 feet and continuous length of at least 363 feet to qualify as forest land. Tree-covered areas in agricultural production settings, such as fruit orchards, or tree-covered areas in urban settings, such as city parks, are not considered forest land.
</p>
<p>Timber land is a subset of forest land that is producing or is capable of producing crops of industrial wood and not withdrawn from timber utilization by statute or administrative regulation. (Note: Areas qualifying as timberland are capable of producing at least 20 cubic feet per acre per year of industrial wood in natural stands. Currently inaccessible and inoperable areas are NOT included).
</p>


<h3>Value</h3>

<p>Dataframe or sf object (if <code>returnSpatial = TRUE</code>). If <code>byPlot = TRUE</code>, values are returned for each plot (<code>PLOT_STATUS_CD = 1</code> when forest exists at the plot location). All variables with names ending in <code>SE</code>, represent the estimate of sampling error (%) of the variable. When <code>variance = TRUE</code>, variables ending in <code>VAR</code> denote the variance of the variable and <code>N</code> is the total sample size (i.e., including non-zero plots).
</p>

<ul>
<li><p><strong>YEAR</strong>: reporting year associated with estimates
</p>
</li>
<li><p><strong>TPA</strong>: estimate of mean trees per acre
</p>
</li>
<li><p><strong>TPA_PERC</strong>: estimate of mean proportion of live trees falling within the domain of interest, with respect to trees per acre
</p>
</li>
<li><p><strong>nPlots_SEEDLING</strong>: number of non-zero plots used to compute tpa estimates
</p>
</li>
<li><p><strong>nPlots_AREA</strong>: number of non-zero plots used to compute land area estimates
</p>
</li></ul>



<h3>Note</h3>

<p>All sampling error estimates (SE) are returned as the &quot;percent coefficient of variation&quot; (standard deviation / mean * 100) for consistency with EVALIDator. IMPORTANT: sampling error cannot be used to construct confidence intervals. Please use <code>variance = TRUE</code> for that (i.e., return variance and sample size instead of sampling error).</p>


<h3>Author(s)</h3>

<p>Hunter Stanke and Andrew Finley
</p>


<h3>References</h3>

<p>rFIA website: <a href="https://doserlab.com/files/rfia/">https://doserlab.com/files/rfia/</a>
</p>
<p>FIA Database User Guide: <a href="https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi">https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi</a>
</p>
<p>Bechtold, W.A.; Patterson, P.L., eds. 2005. The Enhanced Forest Inventory and Analysis Program - National Sampling Design and Estimation Procedures. Gen. Tech. Rep. SRS - 80. Asheville, NC: U.S. Department of Agriculture, Forest Service, Southern Research Station. 85 p. <a href="https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf">https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf</a>
</p>
<p>Stanke, H., Finley, A. O., Weed, A. S., Walters, B. F., &amp; Domke, G. M. (2020). rFIA: An R package for estimation of forest attributes with the US Forest Inventory and Analysis database. Environmental Modelling &amp; Software, 127, 104664.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Load data from the rFIA package
data(fiaRI)
data(countiesRI)

## Most recents subset
fiaRI_mr &lt;- clipFIA(fiaRI)


## Most recent estimates on timber land by species
seedling(db = fiaRI_mr,
    landType = 'timber')


## Same as above at the plot-level
seedling(db = fiaRI_mr,
         landType = 'timber',
         byPlot = TRUE)

## Estimates for white pine on forested mesic sites (all available inventories)
seedling(fiaRI_mr,
    treeDomain = SPCD == 129, # Species code for white pine
    areaDomain = PHYSCLCD %in% 21:29) # Mesic Physiographic classes

## Most recent estimates grouped by stand age on forest land
# Make a categorical variable which represents stand age (grouped by 10 yr intervals)
fiaRI_mr$COND$STAND_AGE &lt;- makeClasses(fiaRI_mr$COND$STDAGE, interval = 10)
seedling(db = fiaRI_mr,
    grpBy = STAND_AGE)

## Most recent estimates for live stems on forest land by species
seedling(db = fiaRI_mr,
    landType = 'forest',
    bySpecies = TRUE)

## Same as above, but implemented in parallel (much quicker)
# parallel::detectCores(logical = FALSE) # 4 cores available, we will take 2
# seedling(db = fiaRI_mr,
#     landType = 'forest',
#     bySpecies = TRUE,
#     nCores = 2)


## Most recent estimates for all stems on forest land grouped by user-defined areal units
ctSF &lt;- seedling(fiaRI_mr,
            polys = countiesRI,
            returnSpatial = TRUE)
plot(ctSF) # Plot multiple variables simultaneously
plotFIA(ctSF, TPA) # Plot of TPA with color scale


</code></pre>

<hr>
<h2 id='standStruct'>Estimate forest structural stage distribution from FIADB
</h2><span id='topic+standStruct'></span>

<h3>Description</h3>

<p>Estimates the stand structural stage distribution of an area of forest/ timberland from FIA data. Estimates can be produced for regions defined within the FIA Database (e.g. counties), at the plot level, or within user-defined areal units. If multiple reporting years (EVALIDs) are included in the data, estimates will be output as a time series. Easy options to implement parallel processing. Stand structural stage is classified for each stand (condition) using a method similar to that of Frelich and Lorimer (1991) but substitute basal area for exposed crown area (see Details, References). If multiple states are represented by the data, estimates will be output for the full region (all area combined), unless specified otherwise (e.g. <code>grpBy = STATECD</code>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>standStruct(db, grpBy = NULL, polys = NULL, returnSpatial = FALSE,
            landType = 'forest', method = 'TI', lambda = 0.5,
            areaDomain = NULL, totals = FALSE, variance = FALSE,
            byPlot = FALSE, nCores = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="standStruct_+3A_db">db</code></td>
<td>
<p><code>FIA.Database</code> or <code>Remote.FIA.Database</code> object produced from <code><a href="#topic+readFIA">readFIA</a></code> or <code><a href="#topic+getFIA">getFIA</a></code>. If a <code>Remote.FIA.Database</code>, data will be read in and processed state-by-state to conserve RAM (see details for an example).</p>
</td></tr>
<tr><td><code id="standStruct_+3A_grpby">grpBy</code></td>
<td>
<p>variables from PLOT or COND tables to group estimates by (NOT quoted). Multiple grouping variables should be combined with <code>c()</code>, and grouping will occur heirarchically. For example, to produce seperate estimates for each ownership group within methods of stand regeneration, specify <code>c(STDORGCD, OWNGRPCD)</code>.</p>
</td></tr>
<tr><td><code id="standStruct_+3A_polys">polys</code></td>
<td>
<p><code>sp</code> or <code>sf</code> Polygon/MultiPolgyon object; Areal units to bin data for estimation. Separate estimates will be produced for region encompassed by each areal unit. FIA plot locations will be reprojected to match projection of <code>polys</code> object.</p>
</td></tr>
<tr><td><code id="standStruct_+3A_returnspatial">returnSpatial</code></td>
<td>
<p>logical; if TRUE, merge population estimates with <code>polys</code> and return as <code>sf</code> multipolygon object. When <code>byPlot = TRUE</code>, return plot-level estimates as <code>sf</code> spatial points.</p>
</td></tr>
<tr><td><code id="standStruct_+3A_landtype">landType</code></td>
<td>
<p>character (&quot;forest&quot; or &quot;timber&quot;); Type of land which estimates will be produced for. Timberland is a subset of forestland (default) which has high site potential and non-reserve status (see details).</p>
</td></tr>
<tr><td><code id="standStruct_+3A_method">method</code></td>
<td>
<p>character; design-based estimator to use. One of:  &quot;TI&quot; (temporally indifferent, default), &quot;annual&quot; (annual), &quot;SMA&quot; (simple moving average), &quot;LMA&quot; (linear moving average), or &quot;EMA&quot; (exponential moving average). See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators.</p>
</td></tr>
<tr><td><code id="standStruct_+3A_lambda">lambda</code></td>
<td>
<p>numeric (0,1); if <code>method = 'EMA'</code>, the decay parameter used to define weighting scheme for annual panels. Low values place higher weight on more recent panels, and vice versa. Specify a vector of values to compute estimates using mulitple wieghting schemes, and use <code>plotFIA</code> with <code>grp</code> set to <code>lambda</code> to produce moving average ribbon plots. See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for examples.</p>
</td></tr>
<tr><td><code id="standStruct_+3A_areadomain">areaDomain</code></td>
<td>
<p>logical predicates defined in terms of the variables in PLOT and/or COND tables. Used to define the area for which estimates will be produced (e.g. within 1 mile of improved road: <code>RDDISTCD %in% c(1:6)</code>, Hard maple/basswood forest type: <code>FORTYPCD == 805</code>. Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only plots within areas where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="standStruct_+3A_totals">totals</code></td>
<td>
<p>logical; if TRUE, return total population estimates (e.g. total area) along with ratio estimates (e.g. mean trees per acre).</p>
</td></tr>
<tr><td><code id="standStruct_+3A_variance">variance</code></td>
<td>
<p>logical; if TRUE, return estimated variance (<code>VAR</code>) and sample size (<code>N</code>). If FALSE, return 'sampling error' (<code>SE</code>) as returned by EVALIDator. Note: sampling error cannot be used to construct confidence intervals.</p>
</td></tr>
<tr><td><code id="standStruct_+3A_byplot">byPlot</code></td>
<td>
<p>logical; if TRUE, returns estimates for individual plot locations instead of population estimates.</p>
</td></tr>
<tr><td><code id="standStruct_+3A_ncores">nCores</code></td>
<td>
<p>numeric; number of cores to use for parallel implementation. Check available cores using <code><a href="parallel.html#topic+detectCores">detectCores</a></code>. Default = 1, serial processing.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Estimation Details</strong>
</p>
<p>Estimation of forest variables follows the procedures documented in Bechtold and Patterson (2005) and <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a>.
</p>
<p>Specifically, the percent land area occupied by forest in each stand structural stage are computed using a sample-based ratio-of-means estimator of total area in structural stage / total land area within the domain of interest. Stand structural stage is classified based on the relative basal area of canopy stems in various size classes (defined below). Only stems which are identified on-site as dominant, subdominant, or intermdediate crown-classes are used to classify stand structural stage.
</p>
<p><strong>Diameter Classes</strong>
</p>

<ul>
<li> <p><em>Pole</em>: 12.7 - 25.9 cm
</p>
</li>
<li> <p><em>Mature</em>: 26 - 45.9 cm
</p>
</li>
<li> <p><em>Large</em>: 46+ cm
</p>
</li></ul>

<p><strong>Structural Stage Classification</strong>
</p>

<ul>
<li> <p><em>Pole Stage</em>: &gt; 67% BA in pole and mature classes, with more BA in pole than mature.
</p>
</li>
<li> <p><em>Mature Stage</em>: &gt; 67% BA in pole and mature classes, with more BA in mature than pole OR &gt; 67% BA in mature and large classes, with more BA in mature.
</p>
</li>
<li> <p><em>Late-Successional Stage</em>: &gt; 67% BA in mature and large classes, with more in large
</p>
</li>
<li> <p><em>Mosiac</em>: Any plot not meeting above criteria.
</p>
</li></ul>

<p>Users may specify alternatives to the 'Temporally Indifferent' estimator using the <code>method</code> argument. Alternative design-based estimators include the annual estimator (&quot;ANNUAL&quot;; annual panels, or estimates from plots measured in the same year), simple moving average (&quot;SMA&quot;; combines annual panels with equal weight), linear moving average (&quot;LMA&quot;; combine annual panels with weights that decay <em>linearly</em> with time since measurement), and exponential moving average (&quot;EMA&quot;; combine annual panels with weights that decay <em>exponentially</em> with time since measurement). The &quot;best&quot; estimator depends entirely on user-objectives, see <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators and tradeoffs between precision and temporal specificity.
</p>
<p>When <code>byPlot = FALSE</code> (i.e., population estimates are returned), the &quot;YEAR&quot; column in the resulting dataframe indicates the final year of the inventory cycle that estimates are produced for. For example, an estimate of current forest area (e.g., 2018) may draw on data collected from 2008-2018, and &quot;YEAR&quot; will be listed as 2018 (consistent with EVALIDator). However, when <code>byPlot = TRUE</code> (i.e., plot-level estimates returned), the &quot;YEAR&quot; column denotes the year that each plot was measured (MEASYEAR), which may differ slightly from its associated inventory year (INVYR).
</p>
<p>Stratified random sampling techniques are most often employed to compute estimates in recent inventories, although double sampling and simple random sampling may be employed for early inventories. Estimates are adjusted for non-response bias by assuming attributes of non-response plot locations to be equal to the mean of other plots included within thier respective stratum or population.
</p>
<p><strong>Working with &quot;Big Data&quot;</strong>
</p>
<p>If FIA data are too large to hold in memory (e.g., R throws the &quot;cannot allocate vector of size ...&quot; errors), use larger-than-RAM options. See documentation of <code>link{readFIA}</code> for examples of how to set up a <code>Remote.FIA.Database</code>. As a reference, we have used rFIA's larger-than-RAM methods to estimate forest variables using the entire FIA Database (~50GB) on a standard desktop computer with 16GB of RAM. Check out <a href="https://doserlab.com/files/rfia/">our website</a> for more details and examples.
</p>
<p>Easy, efficient parallelization is implemented with the <code><a href="parallel.html#topic+parallel">parallel</a></code> package. Users must only specify the <code>nCores</code> argument with a value greater than 1 in order to implement parallel processing on their machines. Parallel implementation is achieved using a snow type cluster on any Windows OS, and with multicore forking on any Unix OS (Linux, Mac). Implementing parallel processing may substantially decrease free memory during processing, particularly on Windows OS. Thus, users should be cautious when running in parallel, and consider implementing serial processing for this task if computational resources are limited (<code>nCores = 1</code>).
</p>
<p><strong>Definition of forestland</strong>
</p>
<p>Forest land must have at least 10-percent canopy cover by live tally trees of any size, including land that formerly had such tree cover and that will be naturally or artificially regenerated. Forest land includes transition zones, such as areas between heavily forest and non-forested lands that meet the mimium tree canopy cover and forest areas adjacent to urban and built-up lands. The minimum area for classification of forest land is 1 acre in size and 120 feet wide measured stem-to-stem from the outer-most edge. Roadside, streamside, and shelterbelt strips of trees must have a width of at least 120 feet and continuous length of at least 363 feet to qualify as forest land. Tree-covered areas in agricultural production settings, such as fruit orchards, or tree-covered areas in urban settings, such as city parks, are not considered forest land.
</p>
<p>Timber land is a subset of forest land that is producing or is capable of producing crops of industrial wood and not withdrawn from timber utilization by statute or administrative regulation. (Note: Areas qualifying as timberland are capable of producing at least 20 cubic feet per acre per year of industrial wood in natural stands. Currently inaccessible and inoperable areas are NOT included).
</p>


<h3>Value</h3>

<p>Dataframe or sf object (if <code>returnSpatial = TRUE</code>). If <code>byPlot = TRUE</code>, values are returned for each plot (structural stage of dominant stand type; <code>PLOT_STATUS_CD = 1</code> when forest exists at the plot location). All variables with names ending in <code>SE</code>, represent the estimate of sampling error (%) of the variable. When <code>variance = TRUE</code>, variables ending in <code>VAR</code> denote the variance of the variable and <code>N</code> is the total sample size (i.e., including non-zero plots).
</p>

<ul>
<li><p><strong>STAGE</strong>: Stand structural stage.
</p>
</li>
<li><p><strong>PERC</strong>: % land area in each structural stage.
</p>
</li></ul>



<h3>Note</h3>

<p>All sampling error estimates (SE) are returned as the &quot;percent coefficient of variation&quot; (standard deviation / mean * 100) for consistency with EVALIDator. IMPORTANT: sampling error cannot be used to construct confidence intervals. Please use <code>variance = TRUE</code> for that (i.e., return variance and sample size instead of sampling error).</p>


<h3>Author(s)</h3>

<p>Hunter Stanke and Andrew Finley
</p>


<h3>References</h3>

<p>rFIA website: <a href="https://doserlab.com/files/rfia/">https://doserlab.com/files/rfia/</a>
</p>
<p>FIA Database User Guide: <a href="https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi">https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi</a>
</p>
<p>Bechtold, W.A.; Patterson, P.L., eds. 2005. The Enhanced Forest Inventory and Analysis Program - National Sampling Design and Estimation Procedures. Gen. Tech. Rep. SRS - 80. Asheville, NC: U.S. Department of Agriculture, Forest Service, Southern Research Station. 85 p. <a href="https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf">https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf</a>
</p>
<p>Stanke, H., Finley, A. O., Weed, A. S., Walters, B. F., &amp; Domke, G. M. (2020). rFIA: An R package for estimation of forest attributes with the US Forest Inventory and Analysis database. Environmental Modelling &amp; Software, 127, 104664.
</p>
<p>Frelich, L. E., and Lorimer, C. G. (1991). Natural Disturbance Regimes in Hemlock-Hardwood Forests of the Upper Great Lakes Region. Ecological Monographs, 61(2), 145-164. doi:10.2307/1943005
</p>
<p>Goodell, L., and Faber-Langendoen, D. (2007). Development of stand structural stage indices to characterize forest condition in Upstate New York. Forest Ecology and Management, 249(3), 158-170. doi:10.1016/j.foreco.2007.04.052
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Load data from rFIA package
data(fiaRI)
data(countiesRI)

## Most recents subset
fiaRI_mr &lt;- clipFIA(fiaRI)

## Calculate structural stage distribution of all forestland
standStruct(fiaRI_mr)


## Same as above at plot-level (classify stands)
standStruct(fiaRI_mr,
            byPlot = TRUE)

## Calculate structural stage distribution of all forestland by owner group, over time
standStruct(fiaRI_mr,
            grpBy = OWNGRPCD)

## Calculate structural stage distribution of all forestland on xeric sites, over time
standStruct(fiaRI_mr,
            areaDomain = PHYSCLCD %in% c(11:19))

## Calculate structural stage distribution of all forestland, over time
standStruct(fiaRI)



</code></pre>

<hr>
<h2 id='tpa'>Estimate trees per acre and basal area per acre from FIADB</h2><span id='topic+tpa'></span>

<h3>Description</h3>

<p>Produces tree per acre (TPA) and basal area per acre (BAA) estimates from FIA data, along with population totals for each variable. Estimates can be produced for regions defined within the FIA Database (e.g. counties), at the plot level, or within user-defined areal units. Options to group estimates by species, size class, and other variables defined in the FIADB. If multiple reporting years (EVALIDs) are included in the data, estimates will be output as a time series. If multiple states are represented by the data, estimates will be output for the full region (all area combined), unless specified otherwise (e.g. <code>grpBy = STATECD</code>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tpa(db, grpBy = NULL, polys = NULL, returnSpatial = FALSE, bySpecies = FALSE,
    bySizeClass = FALSE, landType = 'forest', treeType = 'live',
     method = 'TI', lambda = .5, treeDomain = NULL, areaDomain = NULL,
     totals = FALSE, variance = FALSE, byPlot = FALSE, treeList = FALSE,
     nCores = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tpa_+3A_db">db</code></td>
<td>
<p><code>FIA.Database</code> or <code>Remote.FIA.Database</code> object produced from <code><a href="#topic+readFIA">readFIA</a></code> or <code><a href="#topic+getFIA">getFIA</a></code>. If a <code>Remote.FIA.Database</code>, data will be read in and processed state-by-state to conserve RAM (see details for an example).</p>
</td></tr>
<tr><td><code id="tpa_+3A_grpby">grpBy</code></td>
<td>
<p>variables from PLOT, COND, or TREE tables to group estimates by (NOT quoted). Multiple grouping variables should be combined with <code>c()</code>, and grouping will occur heirarchically. For example, to produce seperate estimates for each ownership group within methods of stand regeneration, specify <code>c(STDORGCD, OWNGRPCD)</code>.</p>
</td></tr>
<tr><td><code id="tpa_+3A_polys">polys</code></td>
<td>
<p><code>sp</code> or <code>sf</code> Polygon/MultiPolgyon object; Areal units to bin data for estimation. Seperate estimates will be produced for region encompassed by each areal unit. FIA plot locations will be reprojected to match projection of <code>polys</code> object.</p>
</td></tr>
<tr><td><code id="tpa_+3A_returnspatial">returnSpatial</code></td>
<td>
<p>logical; if TRUE, merge population estimates with <code>polys</code> and return as <code>sf</code> multipolygon object. When <code>byPlot = TRUE</code>, return plot-level estimates as <code>sf</code> spatial points.</p>
</td></tr>
<tr><td><code id="tpa_+3A_byspecies">bySpecies</code></td>
<td>
<p>logical; if TRUE, returns estimates grouped by species.</p>
</td></tr>
<tr><td><code id="tpa_+3A_bysizeclass">bySizeClass</code></td>
<td>
<p>logical; if TRUE, returns estimates grouped by size class (2-inch intervals, see <code><a href="#topic+makeClasses">makeClasses</a></code> to compute different size class intervals).</p>
</td></tr>
<tr><td><code id="tpa_+3A_landtype">landType</code></td>
<td>
<p>character (&quot;forest&quot; or &quot;timber&quot;); Type of land which estimates will be produced for. Timberland is a subset of forestland (default) which has high site potential and non-reserve status (see details).</p>
</td></tr>
<tr><td><code id="tpa_+3A_treetype">treeType</code></td>
<td>
<p>character (&quot;all&quot;, &quot;live&quot;, &quot;dead&quot;, or &quot;gs&quot;); Type of tree which estimates will be produced for. All includes all stems, live and dead, greater than 1 in. DBH. Live/Dead includes all stems greater than 1 in. DBH which are live (default) or dead (leaning less than 45 degrees), respectively. GS (growing-stock) includes live stems greater than 5 in. DBH which contain at least one 8 ft merchantable log.</p>
</td></tr>
<tr><td><code id="tpa_+3A_method">method</code></td>
<td>
<p>character; design-based estimator to use. One of:  &quot;TI&quot; (temporally indifferent, default), &quot;annual&quot; (annual), &quot;SMA&quot; (simple moving average), &quot;LMA&quot; (linear moving average), or &quot;EMA&quot; (exponential moving average). See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators.</p>
</td></tr>
<tr><td><code id="tpa_+3A_lambda">lambda</code></td>
<td>
<p>numeric (0,1); if <code>method = 'EMA'</code>, the decay parameter used to define weighting scheme for annual panels. Low values place higher weight on more recent panels, and vice versa. Specify a vector of values to compute estimates using mulitple wieghting schemes, and use <code>plotFIA</code> with <code>grp</code> set to <code>lambda</code> to produce moving average ribbon plots. See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for examples.</p>
</td></tr>
<tr><td><code id="tpa_+3A_treedomain">treeDomain</code></td>
<td>
<p>logical predicates defined in terms of the variables in PLOT, TREE, and/or COND tables. Used to define the type of trees for which estimates will be produced (e.g. DBH greater than 20 inches: <code>DIA &gt; 20</code>, Dominant/Co-dominant crowns only: <code>CCLCD %in% c(2,3))</code>. Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only trees where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="tpa_+3A_areadomain">areaDomain</code></td>
<td>
<p>logical predicates defined in terms of the variables in PLOT and/or COND tables. Used to define the area for which estimates will be produced (e.g. within 1 mile of improved road: <code>RDDISTCD %in% c(1:6)</code>, Hard maple/basswood forest type: <code>FORTYPCD == 805)</code>. Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only plots within areas where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="tpa_+3A_totals">totals</code></td>
<td>
<p>logical; if TRUE, return total population estimates (e.g. total area) along with ratio estimates (e.g. mean trees per acre).</p>
</td></tr>
<tr><td><code id="tpa_+3A_variance">variance</code></td>
<td>
<p>logical; if TRUE, return estimated variance (<code>VAR</code>) and sample size (<code>N</code>). If FALSE, return 'sampling error' (<code>SE</code>) as returned by EVALIDator. Note: sampling error cannot be used to construct confidence intervals.</p>
</td></tr>
<tr><td><code id="tpa_+3A_byplot">byPlot</code></td>
<td>
<p>logical; if TRUE, returns estimates for individual plot locations instead of population estimates.</p>
</td></tr>
<tr><td><code id="tpa_+3A_treelist">treeList</code></td>
<td>
<p>logical; if TRUE, returns tree-level summaries intended for subsequent use with <code>customPSE</code>.</p>
</td></tr>
<tr><td><code id="tpa_+3A_ncores">nCores</code></td>
<td>
<p>numeric; number of cores to use for parallel implementation. Check available cores using <code><a href="parallel.html#topic+detectCores">detectCores</a></code>. Default = 1, serial processing.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Estimation Details</strong>
</p>
<p>Estimation of forest variables follows the procedures documented in Bechtold and Patterson (2005) and <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a>.
</p>
<p>Specifically, TPA and BAA are computed using a sample-based ratio-of-means estimator of total trees (BA) / total land area within the domain of interest. Percentages of TPA and BAA in the domain of interest are represented as the total number of trees of a particular type (live, white pine) / total number of trees (live and dead, all species) within the region. The total populations used to compute these percentages will not change by changing treeType, but will vary if the user specifies an areaDomain or treeDomain.
</p>
<p>Users may specify alternatives to the 'Temporally Indifferent' estimator using the <code>method</code> argument. Alternative design-based estimators include the annual estimator (&quot;ANNUAL&quot;; annual panels, or estimates from plots measured in the same year), simple moving average (&quot;SMA&quot;; combines annual panels with equal weight), linear moving average (&quot;LMA&quot;; combine annual panels with weights that decay <em>linearly</em> with time since measurement), and exponential moving average (&quot;EMA&quot;; combine annual panels with weights that decay <em>exponentially</em> with time since measurement). The &quot;best&quot; estimator depends entirely on user-objectives, see <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators and tradeoffs between precision and temporal specificity.
</p>
<p>When <code>byPlot = FALSE</code> (i.e., population estimates are returned), the &quot;YEAR&quot; column in the resulting dataframe indicates the final year of the inventory cycle that estimates are produced for. For example, an estimate of current forest area (e.g., 2018) may draw on data collected from 2008-2018, and &quot;YEAR&quot; will be listed as 2018 (consistent with EVALIDator). However, when <code>byPlot = TRUE</code> (i.e., plot-level estimates returned), the &quot;YEAR&quot; column denotes the year that each plot was measured (MEASYEAR), which may differ slightly from its associated inventory year (INVYR).
</p>
<p>Stratified random sampling techniques are most often employed to compute estimates in recent inventories, although double sampling and simple random sampling may be employed for early inventories. Estimates are adjusted for non-response bias by assuming attributes of non-response plot locations to be equal to the mean of other plots included within thier respective stratum or population.
</p>
<p><strong>Working with &quot;Big Data&quot;</strong>
</p>
<p>If FIA data are too large to hold in memory (e.g., R throws the &quot;cannot allocate vector of size ...&quot; errors), use larger-than-RAM options. See documentation of <code>link{readFIA}</code> for examples of how to set up a <code>Remote.FIA.Database</code>. As a reference, we have used rFIA's larger-than-RAM methods to estimate forest variables using the entire FIA Database (~50GB) on a standard desktop computer with 16GB of RAM. Check out <a href="https://doserlab.com/files/rfia/">our website</a> for more details and examples.
</p>
<p>Easy, efficient parallelization is implemented with the <code><a href="parallel.html#topic+parallel">parallel</a></code> package. Users must only specify the <code>nCores</code> argument with a value greater than 1 in order to implement parallel processing on their machines. Parallel implementation is achieved using a snow type cluster on any Windows OS, and with multicore forking on any Unix OS (Linux, Mac). Implementing parallel processing may substantially decrease free memory during processing, particularly on Windows OS. Thus, users should be cautious when running in parallel, and consider implementing serial processing for this task if computational resources are limited (<code>nCores = 1</code>).
</p>
<p><strong>Definition of forestland</strong>
</p>
<p>Forest land must have at least 10-percent canopy cover by live tally trees of any size, including land that formerly had such tree cover and that will be naturally or artificially regenerated. Forest land includes transition zones, such as areas between heavily forest and non-forested lands that meet the mimium tree canopy cover and forest areas adjacent to urban and built-up lands. The minimum area for classification of forest land is 1 acre in size and 120 feet wide measured stem-to-stem from the outer-most edge. Roadside, streamside, and shelterbelt strips of trees must have a width of at least 120 feet and continuous length of at least 363 feet to qualify as forest land. Tree-covered areas in agricultural production settings, such as fruit orchards, or tree-covered areas in urban settings, such as city parks, are not considered forest land.
</p>
<p>Timber land is a subset of forest land that is producing or is capable of producing crops of industrial wood and not withdrawn from timber utilization by statute or administrative regulation. (Note: Areas qualifying as timberland are capable of producing at least 20 cubic feet per acre per year of industrial wood in natural stands. Currently inaccessible and inoperable areas are NOT included).
</p>


<h3>Value</h3>

<p>Dataframe or sf object (if <code>returnSpatial = TRUE</code>). If <code>byPlot = TRUE</code>, values are returned for each plot (<code>PLOT_STATUS_CD = 1</code> when forest exists at the plot location). All variables with names ending in <code>SE</code>, represent the estimate of sampling error (%) of the variable. When <code>variance = TRUE</code>, variables ending in <code>VAR</code> denote the variance of the variable and <code>N</code> is the total sample size (i.e., including non-zero plots).
</p>

<ul>
<li><p><strong>YEAR</strong>: reporting year associated with estimates
</p>
</li>
<li><p><strong>TPA</strong>: estimate of mean trees per acre
</p>
</li>
<li><p><strong>BAA</strong>: estimate of mean basal area (sq. ft.) per acre 
</p>
</li>
<li><p><strong>TPA_PERC</strong>: estimate of mean proportion of trees falling within the domain of interest, with respect to trees per acre
</p>
</li>
<li><p><strong>BAA_PERC</strong>: estimate of mean proportion of trees falling within the domain of interest, with respect to basal area per acre
</p>
</li>
<li><p><strong>nPlots_TREE</strong>: number of non-zero plots used to compute tree and basal area estimates
</p>
</li>
<li><p><strong>nPlots_AREA</strong>: number of non-zero plots used to compute land area estimates
</p>
</li></ul>



<h3>Note</h3>

<p>All sampling error estimates (SE) are returned as the &quot;percent coefficient of variation&quot; (standard deviation / mean * 100) for consistency with EVALIDator. IMPORTANT: sampling error cannot be used to construct confidence intervals. Please use <code>variance = TRUE</code> for that (i.e., return variance and sample size instead of sampling error).</p>


<h3>Author(s)</h3>

<p>Hunter Stanke and Andrew Finley
</p>


<h3>References</h3>

<p>rFIA website: <a href="https://doserlab.com/files/rfia/">https://doserlab.com/files/rfia/</a>
</p>
<p>FIA Database User Guide: <a href="https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi">https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi</a>
</p>
<p>Bechtold, W.A.; Patterson, P.L., eds. 2005. The Enhanced Forest Inventory and Analysis Program - National Sampling Design and Estimation Procedures. Gen. Tech. Rep. SRS - 80. Asheville, NC: U.S. Department of Agriculture, Forest Service, Southern Research Station. 85 p. <a href="https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf">https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf</a>
</p>
<p>Stanke, H., Finley, A. O., Weed, A. S., Walters, B. F., &amp; Domke, G. M. (2020). rFIA: An R package for estimation of forest attributes with the US Forest Inventory and Analysis database. Environmental Modelling &amp; Software, 127, 104664.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load data from the rFIA package
data(fiaRI)
data(countiesRI)

# Most recents subset
fiaRI_mr &lt;- clipFIA(fiaRI)


# Most recent estimates for growing-stock on timber land by species
tpa(db = fiaRI_mr,
    landType = 'timber',
    treeType = 'gs')

# Same as above at the plot-level
tpa(db = fiaRI_mr,
    landType = 'timber',
    treeType = 'gs',
    byPlot = TRUE)

# Estimates for live white pine ( &gt; 12" DBH) on forested mesic sites (all available inventories)
tpa(fiaRI_mr,
    treeType = 'live',
    treeDomain = SPCD == 129 &amp; DIA &gt; 12, # Species code for white pine
    areaDomain = PHYSCLCD %in% 21:29) # Mesic Physiographic classes

# Most recent estimates grouped by stand age on forest land
# Make a categorical variable which represents stand age (grouped by 10 yr intervals)
fiaRI_mr$COND$STAND_AGE &lt;- makeClasses(fiaRI_mr$COND$STDAGE, interval = 10)
tpa(db = fiaRI_mr,
    grpBy = STAND_AGE)

# Estimates for snags greater than 20 in DBH on forestland for all
#  available inventories (time-series)
tpa(db = fiaRI,
    landType = 'forest',
    treeType = 'dead',
    treeDomain = DIA &gt; 20)

# Most recent estimates for live stems on forest land by species
tpa(db = fiaRI_mr,
    landType = 'forest',
    treeType = 'live',
    bySpecies = TRUE)

# Same as above, but implemented in parallel (much quicker)
# parallel::detectCores(logical = FALSE) # 4 cores available, we will take 2
# tpa(db = fiaRI_mr,
#     landType = 'forest',
#     treeType = 'live',
#     bySpecies = TRUE,
#     nCores = 2)


# Most recent estimates for all stems on forest land grouped by user-defined areal units
ctSF &lt;- tpa(fiaRI_mr,
            polys = countiesRI,
            returnSpatial = TRUE)
plot(ctSF) # Plot multiple variables simultaneously
plotFIA(ctSF, TPA) # Plot of TPA with color scale


</code></pre>

<hr>
<h2 id='vegStruct'>Estimate vegation cover by canopy layer from FIADB</h2><span id='topic+vegStruct'></span>

<h3>Description</h3>

<p>Produces estimates of vegetation cover by canopy layer and species growth form from the Forest Inventory and Analysis Database. Estimates can be produced for regions defined within the FIA Database (e.g. counties), at the plot level, or within user-defined areal units. If multiple reporting years (EVALIDs) are included in the data, estimates will be output as a time series. If multiple states are represented by the data, estimates will be output for the full region (all area combined), unless specified otherwise (e.g. <code>grpBy = STATECD</code>). Easy options to implement parallel processing.</p>


<h3>Usage</h3>

<pre><code class='language-R'>vegStruct(db, grpBy = NULL, polys = NULL,
          returnSpatial = FALSE, landType = "forest",
          method = "TI", lambda = 0.5,
          areaDomain = NULL, totals = FALSE,
          variance = FALSE, byPlot = FALSE,
          nCores = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vegStruct_+3A_db">db</code></td>
<td>
<p><code>FIA.Database</code> or <code>Remote.FIA.Database</code> object produced from <code><a href="#topic+readFIA">readFIA</a></code> or <code><a href="#topic+getFIA">getFIA</a></code>. If a <code>Remote.FIA.Database</code>, data will be read in and processed state-by-state to conserve RAM (see details for an example).</p>
</td></tr>
<tr><td><code id="vegStruct_+3A_grpby">grpBy</code></td>
<td>
<p>variables from PLOT or COND tables to group estimates by (NOT quoted). Multiple grouping variables should be combined with <code>c()</code>, and grouping will occur heirarchically. For example, to produce seperate estimates for each ownership group within methods of stand regeneration, specify <code>c(STDORGCD, OWNGRPCD)</code>.</p>
</td></tr>
<tr><td><code id="vegStruct_+3A_polys">polys</code></td>
<td>
<p><code>sp</code> or <code>sf</code> Polygon/MultiPolgyon object; Areal units to bin data for estimation. Separate estimates will be produced for regions encompassed by each areal unit. FIA plot locations will be reprojected to match projection of <code>polys</code> object.</p>
</td></tr>
<tr><td><code id="vegStruct_+3A_returnspatial">returnSpatial</code></td>
<td>
<p>logical; if TRUE, merge population estimates with <code>polys</code> and return as <code>sf</code> multipolygon object. When <code>byPlot = TRUE</code>, return plot-level estimates as <code>sf</code> spatial points.</p>
</td></tr>
<tr><td><code id="vegStruct_+3A_landtype">landType</code></td>
<td>
<p>character (&quot;forest&quot; or &quot;timber&quot;); Type of land which estimates will be produced for. Timberland is a subset of forestland (default) which has high site potential and non-reserve status (see details).</p>
</td></tr>
<tr><td><code id="vegStruct_+3A_method">method</code></td>
<td>
<p>character; design-based estimator to use. One of:  &quot;TI&quot; (temporally indifferent, default), &quot;annual&quot; (annual), &quot;SMA&quot; (simple moving average), &quot;LMA&quot; (linear moving average), or &quot;EMA&quot; (exponential moving average). See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators.</p>
</td></tr>
<tr><td><code id="vegStruct_+3A_lambda">lambda</code></td>
<td>
<p>numeric (0,1); if <code>method = 'EMA'</code>, the decay parameter used to define weighting scheme for annual panels. Low values place higher weight on more recent panels, and vice versa. Specify a vector of values to compute estimates using mulitple weighting schemes, and use <code>plotFIA</code> with <code>grp</code> set to <code>lambda</code> to produce moving average ribbon plots. See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for examples.</p>
</td></tr>
<tr><td><code id="vegStruct_+3A_areadomain">areaDomain</code></td>
<td>
<p>logical predicates defined in terms of the variables in PLOT and/or COND tables. Used to define the area for which estimates will be produced (e.g. within 1 mile of improved road: <code>RDDISTCD %in% c(1:6)</code>, Hard maple/basswood forest type: <code>FORTYPCD == 805</code>. Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only plots within areas where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="vegStruct_+3A_totals">totals</code></td>
<td>
<p>logical; if TRUE, return total population estimates (e.g. total area) along with ratio estimates (e.g. mean trees per acre).</p>
</td></tr>
<tr><td><code id="vegStruct_+3A_variance">variance</code></td>
<td>
<p>logical; if TRUE, return estimated variance (<code>VAR</code>) and sample size (<code>N</code>). If FALSE, return 'sampling error' (<code>SE</code>) as returned by EVALIDator. Note: sampling error cannot be used to construct confidence intervals.</p>
</td></tr>
<tr><td><code id="vegStruct_+3A_byplot">byPlot</code></td>
<td>
<p>logical; if TRUE, returns estimates for individual plot locations instead of population estimates.</p>
</td></tr>
<tr><td><code id="vegStruct_+3A_ncores">nCores</code></td>
<td>
<p>numeric; number of cores to use for parallel implementation. Check available cores using <code><a href="parallel.html#topic+detectCores">detectCores</a></code>. Default = 1, serial processing.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Estimation Details</strong>
</p>
<p>Estimation of forest variables follows the procedures documented in Bechtold and Patterson (2005) and <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a>. 
</p>
<p>Specifically, percent areal coverage is computed using a sample-based ratio-of-means estimator of total coverage area / total land area within the domain of interest. Percent coverage estimates are returned separately by canopy layer and growth habit (the general appearance of the plant, including size, shape, growth form, and orientation). Canopy layers 
</p>
<p><strong>Canopy layers</strong>
</p>

<ul>
<li><p> 0 - 2.0 feet 
</p>
</li>
<li><p> 2.1 - 6.0 feet 
</p>
</li>
<li><p> 6.1 - 16.0 feet
</p>
</li>
<li><p> Greater than 16 feet
</p>
</li>
<li><p> Aerial: Canopy cover for all layers
</p>
</li></ul>

<p><strong>Growth habit</strong>
</p>

<ul>
<li> <p><em>Forbs</em>: herbaceous, broad-leaved plants; includes non-woody-vines and ferns (does not include mosses and cryptobiotic crusts). 
</p>
</li>
<li> <p><em>Graminoids</em>: grasses and grass-like plants (includes rushes and sedges).
</p>
</li>
<li> <p><em>Non-tally tree</em>: tree species not on a particular FIA work unit's tree tally list that are woody plants with a single well-defined, dominant main stem, not supported by other vegetation or structures (not vines), and which are, or expected to become, greater than 13 feet in height. Seedlings, saplings, and mature plants are included. 
</p>
</li>
<li> <p><em>Shrubs/vines</em>: woody, multiple-stemmed plants of any size, subshrubs (low-growing shrubs under 1.5 feet tall at maturity), and woody vines. Most cacti are included in this category. 
</p>
</li>
<li> <p><em>Tally tree</em>: all core tree species and any core optional tree species selected by a particular FIA work unit. Only tree species on the FIA Master Tree Species List (or those listed as hybrid, variety, or subspecies) are included. Any plant of that species is included, regardless of its shape and regardless of whether it was tallied on the subplot or microplot during the tree tally. Seedlings, saplings, and mature plants are included. 
</p>
</li></ul>

<p>Users may specify alternatives to the 'Temporally Indifferent' estimator using the <code>method</code> argument. Alternative design-based estimators include the annual estimator (&quot;ANNUAL&quot;; annual panels, or estimates from plots measured in the same year), simple moving average (&quot;SMA&quot;; combines annual panels with equal weight), linear moving average (&quot;LMA&quot;; combine annual panels with weights that decay <em>linearly</em> with time since measurement), and exponential moving average (&quot;EMA&quot;; combine annual panels with weights that decay <em>exponentially</em> with time since measurement). The &quot;best&quot; estimator depends entirely on user-objectives, see <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators and tradeoffs between precision and temporal specificity.
</p>
<p>When <code>byPlot = FALSE</code> (i.e., population estimates are returned), the &quot;YEAR&quot; column in the resulting dataframe indicates the final year of the inventory cycle that estimates are produced for. For example, an estimate of current forest area (e.g., 2018) may draw on data collected from 2008-2018, and &quot;YEAR&quot; will be listed as 2018 (consistent with EVALIDator). However, when <code>byPlot = TRUE</code> (i.e., plot-level estimates returned), the &quot;YEAR&quot; column denotes the year that each plot was measured (MEASYEAR), which may differ slightly from its associated inventory year (INVYR).
</p>
<p>Stratified random sampling techniques are most often employed to compute estimates in recent inventories, although double sampling and simple random sampling may be employed for early inventories. Estimates are adjusted for non-response bias by assuming attributes of non-response plot locations to be equal to the mean of other plots included within thier respective stratum or population.
</p>
<p><strong>Working with &quot;Big Data&quot;</strong>
</p>
<p>If FIA data are too large to hold in memory (e.g., R throws the &quot;cannot allocate vector of size ...&quot; errors), use larger-than-RAM options. See documentation of <code>link{readFIA}</code> for examples of how to set up a <code>Remote.FIA.Database</code>. As a reference, we have used rFIA's larger-than-RAM methods to estimate forest variables using the entire FIA Database (~50GB) on a standard desktop computer with 16GB of RAM. Check out <a href="https://doserlab.com/files/rfia/">our website</a> for more details and examples.
</p>
<p>Easy, efficient parallelization is implemented with the <code><a href="parallel.html#topic+parallel">parallel</a></code> package. Users must only specify the <code>nCores</code> argument with a value greater than 1 in order to implement parallel processing on their machines. Parallel implementation is achieved using a snow type cluster on any Windows OS, and with multicore forking on any Unix OS (Linux, Mac). Implementing parallel processing may substantially decrease free memory during processing, particularly on Windows OS. Thus, users should be cautious when running in parallel, and consider implementing serial processing for this task if computational resources are limited (<code>nCores = 1</code>).
</p>
<p>Forest land must have at least 10-percent canopy cover by live tally trees of any size, including land that formerly had such tree cover and that will be naturally or artificially regenerated. Forest land includes transition zones, such as areas between heavily forest and non-forested lands that meet the mimium tree canopy cover and forest areas adjacent to urban and built-up lands. The minimum area for classification of forest land is 1 acre in size and 120 feet wide measured stem-to-stem from the outer-most edge. Roadside, streamside, and shelterbelt strips of trees must have a width of at least 120 feet and continuous length of at least 363 feet to qualify as forest land. Tree-covered areas in agricultural production settings, such as fruit orchards, or tree-covered areas in urban settings, such as city parks, are not considered forest land.
</p>
<p>Timber land is a subset of forest land that is producing or is capable of producing crops of industrial wood and not withdrawn from timber utilization by statute or administrative regulation. (Note: Areas qualifying as timberland are capable of producing at least 20 cubic feet per acre per year of industrial wood in natural stands. Currently inaccessible and inoperable areas are NOT included).
</p>


<h3>Value</h3>

<p>Dataframe or sf object (if <code>returnSpatial = TRUE</code>). If <code>byPlot = TRUE</code>, values are returned for each plot (proportion of plot in domain of interest; <code>PLOT_STATUS_CD = 1</code> when forest exists at the plot location). All variables with names ending in <code>SE</code>, represent the estimate of sampling error (%) of the variable. When <code>variance = TRUE</code>, variables ending in <code>VAR</code> denote the variance of the variable and <code>N</code> is the total sample size (i.e., including non-zero plots).
</p>

<ul>
<li><p><strong>YEAR</strong>: reporting year associated with estimates
</p>
</li>
<li><p><strong>LAYER</strong>: canopy layer
</p>
</li>
<li><p><strong>GROWTH_HABIT</strong>: species growth habit
</p>
</li>
<li><p><strong>COVER_PCT</strong>: estimate of percent areal coverage of the growth habit within the canopy layer
</p>
</li>
<li><p><strong>COVER_AREA_TOTAL</strong>: estimate of areal coverage of the growth habit within the canopy layer (acres) 
</p>
</li>
<li><p><strong>AREA_TOTAL</strong>: estimate of total land area (acres) 
</p>
</li>
<li><p><strong>nPlots_VEG</strong>: number of non-zero plots used to compute areal coverage estimates
</p>
</li>
<li><p><strong>nPlots_AREA</strong>: number of non-zero plots used to compute land area estimates
</p>
</li></ul>



<h3>Note</h3>

<p>All sampling error estimates (SE) are returned as the &quot;percent coefficient of variation&quot; (standard deviation / mean * 100) for consistency with EVALIDator. IMPORTANT: sampling error cannot be used to construct confidence intervals. Please use <code>variance = TRUE</code> for that (i.e., return variance and sample size instead of sampling error).</p>


<h3>Author(s)</h3>

<p>Hunter Stanke and Andrew Finley
</p>


<h3>References</h3>

<p>rFIA website: <a href="https://doserlab.com/files/rfia/">https://doserlab.com/files/rfia/</a>
</p>
<p>FIA Database User Guide: <a href="https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi">https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi</a>
</p>
<p>Bechtold, W.A.; Patterson, P.L., eds. 2005. The Enhanced Forest Inventory and Analysis Program - National Sampling Design and Estimation Procedures. Gen. Tech. Rep. SRS - 80. Asheville, NC: U.S. Department of Agriculture, Forest Service, Southern Research Station. 85 p. <a href="https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf">https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf</a>
</p>
<p>Stanke, H., Finley, A. O., Weed, A. S., Walters, B. F., &amp; Domke, G. M. (2020). rFIA: An R package for estimation of forest attributes with the US Forest Inventory and Analysis database. Environmental Modelling &amp; Software, 127, 104664.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load data from the rFIA package
data(fiaRI)
data(countiesRI)

# Most recents subset
fiaRI_mr &lt;- clipFIA(fiaRI)


# Estimates across RI for the most recent inventory year
vegStruct(db = fiaRI_mr)


# Return estimates at the plot-level
vegStruct(db = fiaRI,
          byPlot = TRUE)
  

</code></pre>

<hr>
<h2 id='vitalRates'>Estimate tree growth rates from FIADB</h2><span id='topic+vitalRates'></span>

<h3>Description</h3>

<p>Computes estimates of average annual DBH, basal area, height, and net volume growth rates for individual stems, along with average annual basal area and net volume growth per acre. Only stems 5 inches DBH or greater are included in estimates. Estimates can be produced for regions defined within the FIA Database (e.g. counties), at the plot level, or within user-defined areal units. Options to group estimates by species, size class, and other variables defined in the FIADB. If multiple reporting years (EVALIDs) are included in the data, estimates will be output as a time series. If multiple states are represented by the data, estimates will be output for the full region (all area combined), unless specified otherwise (e.g. <code>grpBy = STATECD</code>).</p>


<h3>Usage</h3>

<pre><code class='language-R'>vitalRates(db, grpBy = NULL, polys = NULL, returnSpatial = FALSE, bySpecies = FALSE,
           bySizeClass = FALSE, landType = 'forest', treeType = 'all',
           method = 'TI', lambda = .5, treeDomain = NULL,
           areaDomain = NULL, totals = FALSE, variance = FALSE,
           byPlot = FALSE, treeList = FALSE, nCores = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vitalRates_+3A_db">db</code></td>
<td>
<p><code>FIA.Database</code> or <code>Remote.FIA.Database</code> object produced from <code>readFIA()</code> or <code>getFIA()</code>. If a <code>Remote.FIA.Database</code>, data will be read in and processed state-by-state to conserve RAM (see details for an example).</p>
</td></tr>
<tr><td><code id="vitalRates_+3A_grpby">grpBy</code></td>
<td>
<p>variables from PLOT, COND, or TREE tables to group estimates by (NOT quoted). Multiple grouping variables should be combined with <code>c()</code>, and grouping will occur heirarchically. For example, to produce seperate estimates for each ownership group within methods of stand regeneration, specify <code>c(STDORGCD, OWNGRPCD)</code>.</p>
</td></tr>
<tr><td><code id="vitalRates_+3A_polys">polys</code></td>
<td>
<p><code>sp</code> or <code>sf</code> Polygon/MultiPolgyon object; Areal units to bin data for estimation. Separate estimates will be produced for region encompassed by each areal unit. FIA plot locations will be reprojected to match projection of <code>polys</code> object.</p>
</td></tr>
<tr><td><code id="vitalRates_+3A_returnspatial">returnSpatial</code></td>
<td>
<p>logical; if TRUE, merge population estimates with <code>polys</code> and return as <code>sf</code> multipolygon object. When <code>byPlot = TRUE</code>, return plot-level estimates as <code>sf</code> spatial points.</p>
</td></tr>
<tr><td><code id="vitalRates_+3A_byspecies">bySpecies</code></td>
<td>
<p>logical; if TRUE, returns estimates grouped by species.</p>
</td></tr>
<tr><td><code id="vitalRates_+3A_bysizeclass">bySizeClass</code></td>
<td>
<p>logical; if TRUE, returns estimates grouped by size class (2-inch intervals, see <code>makeClasses()</code> to compute different size class intervals).</p>
</td></tr>
<tr><td><code id="vitalRates_+3A_landtype">landType</code></td>
<td>
<p>character (&quot;forest&quot; or &quot;timber&quot;); Type of land which estimates will be produced for. Timberland is a subset of forestland (default) which has high site potential and non-reserve status (see details).</p>
</td></tr>
<tr><td><code id="vitalRates_+3A_treetype">treeType</code></td>
<td>
<p>character (&quot;all&quot;, &quot;live&quot;, or &quot;gs&quot;); Type of tree which estimates will be produced for. See details for more info.</p>
</td></tr>
<tr><td><code id="vitalRates_+3A_method">method</code></td>
<td>
<p>character; design-based estimator to use. One of:  &quot;TI&quot; (temporally indifferent, default), &quot;annual&quot; (annual), &quot;SMA&quot; (simple moving average), &quot;LMA&quot; (linear moving average), or &quot;EMA&quot; (exponential moving average). See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators.</p>
</td></tr>
<tr><td><code id="vitalRates_+3A_lambda">lambda</code></td>
<td>
<p>numeric (0,1); if <code>method = 'EMA'</code>, the decay parameter used to define weighting scheme for annual panels. Low values place higher weight on more recent panels, and vice versa. Specify a vector of values to compute estimates using mulitple weighting schemes, and use <code>plotFIA()</code> with <code>grp</code> set to <code>lambda</code> to produce moving average ribbon plots. See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for examples.</p>
</td></tr>
<tr><td><code id="vitalRates_+3A_treedomain">treeDomain</code></td>
<td>
<p>logical predicates defined in terms of the variables in PLOT, TREE, and/or COND tables. Used to define the type of trees for which estimates will be produced (e.g. DBH greater than 20 inches: <code>DIA &gt; 20</code>, Dominant/Co-dominant crowns only: <code>CCLCD %in% c(2,3)</code>. Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only trees where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="vitalRates_+3A_areadomain">areaDomain</code></td>
<td>
<p>logical predicates defined in terms of the variables in PLOT and/or COND tables. Used to define the area for which estimates will be produced (e.g. within 1 mile of improved road: <code>RDDISTCD %in% c(1:6)</code>, Hard maple/basswood forest type: <code>FORTYPCD == 805</code>. Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only plots within areas where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="vitalRates_+3A_totals">totals</code></td>
<td>
<p>logical; if TRUE, return total population estimates (e.g. total area) along with ratio estimates (e.g. mean trees per acre).</p>
</td></tr>
<tr><td><code id="vitalRates_+3A_variance">variance</code></td>
<td>
<p>logical; if TRUE, return estimated variance (<code>VAR</code>) and sample size (<code>N</code>). If FALSE, return 'sampling error' (<code>SE</code>) as returned by EVALIDator. Note: sampling error cannot be used to construct confidence intervals.</p>
</td></tr>
<tr><td><code id="vitalRates_+3A_byplot">byPlot</code></td>
<td>
<p>logical; if TRUE, returns estimates for individual plot locations instead of population estimates.</p>
</td></tr>
<tr><td><code id="vitalRates_+3A_treelist">treeList</code></td>
<td>
<p>logical; if TRUE, returns tree-level summaries intended for subsequent use with <code>customPSE()</code></p>
</td></tr></table>
<p>.
</p>
<table role = "presentation">
<tr><td><code id="vitalRates_+3A_ncores">nCores</code></td>
<td>
<p>numeric; number of cores to use for parallel implementation. Check available cores using <code><a href="parallel.html#topic+detectCores">detectCores</a></code>. Default = 1, serial processing.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Estimation Details</strong>
</p>
<p>Estimation of forest variables follows the procedures documented in Bechtold and Patterson (2005) and <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a>.
</p>
<p>Average annual diameter, basal area, height, and net volume growth of a stem is computed using a sample-based ratio of means estimator of total diameter (basal area, height, net volume) growth / total trees, and average annual basal area and net volume growth per acre is computed as total basal area (net volume) growth / total area. All estimates are returned as average annual rates. Only conditions which were forest in time 1 and in time 2 are included in estimates (excluding converted stands). Only stems 5 inches DBH or greater are included in estimates.
</p>
<p>When <code>treeType = 'all'</code> (default), estimates are of <em>net</em> growth rates (including recruitment and mortality), and hence they may attain a negative value. Negative growth estimates most likely indicate a substantial change in an attribute of the tree or area between time 1 and time 2, which caused the attribute to decrease. Implementation of the growth accounting method allows us to more accurately represent shifts in forest attributes (biomass) between classified groups (size classes) over time. Alternatively, when <code>treeType = 'live'</code>, growth rates are calculated using only trees that were alive at both plot visits and give a more realistic representation of individual tree growth.
</p>
<p>Users may specify alternatives to the 'Temporally Indifferent' estimator using the <code>method</code> argument. Alternative design-based estimators include the annual estimator (&quot;ANNUAL&quot;; annual panels, or estimates from plots measured in the same year), simple moving average (&quot;SMA&quot;; combines annual panels with equal weight), linear moving average (&quot;LMA&quot;; combine annual panels with weights that decay <em>linearly</em> with time since measurement), and exponential moving average (&quot;EMA&quot;; combine annual panels with weights that decay <em>exponentially</em> with time since measurement). The &quot;best&quot; estimator depends entirely on user-objectives, see <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators and tradeoffs between precision and temporal specificity.
</p>
<p>When <code>byPlot = FALSE</code> (i.e., population estimates are returned), the &quot;YEAR&quot; column in the resulting dataframe indicates the final year of the inventory cycle that estimates are produced for. For example, an estimate of current forest area (e.g., 2018) may draw on data collected from 2008-2018, and &quot;YEAR&quot; will be listed as 2018 (consistent with EVALIDator). However, when <code>byPlot = TRUE</code> (i.e., plot-level estimates returned), the &quot;YEAR&quot; column denotes the year that each plot was measured (MEASYEAR), which may differ slightly from its associated inventory year (INVYR).
</p>
<p>Stratified random sampling techniques are most often employed to compute estimates in recent inventories, although double sampling and simple random sampling may be employed for early inventories. Estimates are adjusted for non-response bias by assuming attributes of non-response plot locations to be equal to the mean of other plots included within thier respective stratum or population.
</p>
<p><strong>Working with &quot;Big Data&quot;</strong>
</p>
<p>If FIA data are too large to hold in memory (e.g., R throws the &quot;cannot allocate vector of size ...&quot; errors), use larger-than-RAM options. See documentation of <code>link{readFIA}</code> for examples of how to set up a <code>Remote.FIA.Database</code>. As a reference, we have used rFIA's larger-than-RAM methods to estimate forest variables using the entire FIA Database (~50GB) on a standard desktop computer with 16GB of RAM. Check out <a href="https://doserlab.com/files/rfia/">our website</a> for more details and examples.
</p>
<p>Easy, efficient parallelization is implemented with the <code><a href="parallel.html#topic+parallel">parallel</a></code> package. Users must only specify the <code>nCores</code> argument with a value greater than 1 in order to implement parallel processing on their machines. Parallel implementation is achieved using a snow type cluster on any Windows OS, and with multicore forking on any Unix OS (Linux, Mac). Implementing parallel processing may substantially decrease free memory during processing, particularly on Windows OS. Thus, users should be cautious when running in parallel, and consider implementing serial processing for this task if computational resources are limited (<code>nCores = 1</code>).
</p>
<p><strong>Definition of forestland</strong>
</p>
<p>Forest land must have at least 10-percent canopy cover by live tally trees of any size, including land that formerly had such tree cover and that will be naturally or artificially regenerated. Forest land includes transition zones, such as areas between heavily forest and non-forested lands that meet the mimium tree canopy cover and forest areas adjacent to urban and built-up lands. The minimum area for classification of forest land is 1 acre in size and 120 feet wide measured stem-to-stem from the outer-most edge. Roadside, streamside, and shelterbelt strips of trees must have a width of at least 120 feet and continuous length of at least 363 feet to qualify as forest land. Tree-covered areas in agricultural production settings, such as fruit orchards, or tree-covered areas in urban settings, such as city parks, are not considered forest land.
</p>
<p>Timber land is a subset of forest land that is producing or is capable of producing crops of industrial wood and not withdrawn from timber utilization by statute or administrative regulation. (Note: Areas qualifying as timberland are capable of producing at least 20 cubic feet per acre per year of industrial wood in natural stands. Currently inaccessible and inoperable areas are NOT included).
</p>


<h3>Value</h3>

<p>Dataframe or sf object (if <code>returnSpatial = TRUE</code>). If <code>byPlot = TRUE</code>, values are returned for each plot (<code>PLOT_STATUS_CD = 1</code> when forest exists at the plot location). All variables with names ending in <code>SE</code>, represent the estimate of sampling error (%) of the variable. When <code>variance = TRUE</code>, variables ending in <code>VAR</code> denote the variance of the variable and <code>N</code> is the total sample size (i.e., including non-zero plots).
</p>

<ul>
<li><p><strong>YEAR</strong>: reporting year associated with estimates
</p>
</li>
<li><p><strong>DIA_GROW</strong>: estimate of mean annual diameter growth of a stem (inches/ yr)
</p>
</li>
<li><p><strong>BA_GROW</strong>: estimate of mean annual basal area growth of a stem (sq. ft./ yr)
</p>
</li>
<li><p><strong>BAA_GROW</strong>: estimate of mean annual basal area growth per acre (sq. ft./ acre/ yr)
</p>
</li>
<li><p><strong>NETVOL_GROW</strong>: estimate of mean annual net volume growth of a stem (cu. ft./ yr)
</p>
</li>
<li><p><strong>NETVOL_GROW_AC</strong>: estimate of mean annual net volume growth per acre (cu. ft./ acre/ yr)
</p>
</li>
<li><p><strong>SAWVOL_GROW</strong>: estimate of mean annual net sawlog volume growth of a stem (MBF / yr)
</p>
</li>
<li><p><strong>SAWVOL_GROW_AC</strong>: estimate of mean annual net sawlog volume growth per acre  (MBF/ acre/ yr)
</p>
</li>
<li><p><strong>BIO_GROW</strong>: estimate of mean annual aboveground biomass growth of a stem (short tons/ yr)
</p>
</li>
<li><p><strong>BIO_GROW_AC</strong>: estimate of mean annual aboveground biomass growth per acre (short tons/ acre/ yr)
</p>
</li>
<li><p><strong>nPlots_TREE</strong>: number of non-zero plots used to compute tree and basal area estimates
</p>
</li>
<li><p><strong>nPlots_AREA</strong>: number of non-zero plots used to compute land area estimates
</p>
</li></ul>



<h3>Note</h3>

<p>All sampling error estimates (SE) are returned as the &quot;percent coefficient of variation&quot; (standard deviation / mean * 100) for consistency with EVALIDator. IMPORTANT: sampling error cannot be used to construct confidence intervals. Please use <code>variance = TRUE</code> for that (i.e., return variance and sample size instead of sampling error).</p>


<h3>Author(s)</h3>

<p>Hunter Stanke and Andrew Finley
</p>


<h3>References</h3>

<p>rFIA website: <a href="https://doserlab.com/files/rfia/">https://doserlab.com/files/rfia/</a>
</p>
<p>FIA Database User Guide: <a href="https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi">https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi</a>
</p>
<p>Bechtold, W.A.; Patterson, P.L., eds. 2005. The Enhanced Forest Inventory and Analysis Program - National Sampling Design and Estimation Procedures. Gen. Tech. Rep. SRS - 80. Asheville, NC: U.S. Department of Agriculture, Forest Service, Southern Research Station. 85 p. <a href="https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf">https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf</a>
</p>
<p>Stanke, H., Finley, A. O., Weed, A. S., Walters, B. F., &amp; Domke, G. M. (2020). rFIA: An R package for estimation of forest attributes with the US Forest Inventory and Analysis database. Environmental Modelling &amp; Software, 127, 104664.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load data from the rFIA package
data(fiaRI)
data(countiesRI)

# Most recents subset
fiaRI_mr &lt;- clipFIA(fiaRI)


# Most recent estimates for growing-stock on timber land
vitalRates(db = fiaRI_mr,
           landType = 'timber',
           treeType = 'gs')


# Same as above but at the plot-level
vitalRates(db = fiaRI_mr,
           landType = 'timber',
           treeType = 'gs',
           byPlot = TRUE)

# Estimates for white pine ( &gt; 12" DBH) on forested mesic sites
vitalRates(fiaRI_mr,
           treeType = 'live',
           treeDomain = SPCD == 129 &amp; DIA &gt; 12, # Species code for white pine
           areaDomain = PHYSCLCD %in% 21:29) # Mesic Physiographic classes

# Most recent estimates grouped by stand age on forest land
# Make a categorical variable which represents stand age (grouped by 10 yr intervals)
fiaRI_mr$COND$STAND_AGE &lt;- makeClasses(fiaRI_mr$COND$STDAGE, interval = 10)
vitalRates(db = fiaRI_mr,
           grpBy = STAND_AGE)

# Most recent estimates for live stems on forest land by species
vitalRates(db = fiaRI_mr,
           landType = 'forest',
           bySpecies = TRUE)

# Same as above, but implemented in parallel (much quicker)
# parallel::detectCores(logical = FALSE) # 4 cores available, we will take 2
# vitalRates(db = fiaRI_mr,
#            landType = 'forest',
#            bySpecies = TRUE,
#            nCores = 2)


# Most recent estimates for all stems on forest land grouped by user-defined areal units
ctSF &lt;- vitalRates(fiaRI_mr,
                   polys = countiesRI,
                   returnSpatial = TRUE)
plot(ctSF) # Plot multiple variables simultaneously
plotFIA(ctSF, BIO_GROW) # Plot of individual tree biomass growth rates


</code></pre>

<hr>
<h2 id='volume'>Estimate merchantable tree volume from the FIADB</h2><span id='topic+volume'></span>

<h3>Description</h3>

<p>Produces estimates of merchantable tree volume (i.e., merchantable bole volume and sawlog volume) on a per acre basis from FIA data, along with population estimates for each variable. Estimates can be produced for regions defined within the FIA Database (e.g. counties), at the plot level, or within user-defined areal units. Options to group estimates by species, size class, and other variables defined in the FIADB. If multiple reporting years (EVALIDs) are included in the data, estimates will be output as a time series. If multiple states are represented by the data, estimates will be output for the full region (all area combined), unless specified otherwise (e.g. <code>grpBy = STATECD</code>).</p>


<h3>Usage</h3>

<pre><code class='language-R'>volume(db, grpBy = NULL, polys = NULL, returnSpatial = FALSE,
       bySpecies = FALSE, bySizeClass = FALSE, landType = "forest",
       treeType = "live", volType = "NET", method = "TI",
       lambda = 0.5, treeDomain = NULL, areaDomain = NULL,
       totals = FALSE, variance = FALSE, byPlot = FALSE,
       treeList = FALSE, nCores = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="volume_+3A_db">db</code></td>
<td>
<p><code>FIA.Database</code> or <code>Remote.FIA.Database</code> object produced from <code><a href="#topic+readFIA">readFIA</a></code> or <code><a href="#topic+getFIA">getFIA</a></code>. If a <code>Remote.FIA.Database</code>, data will be read in and processed state-by-state to conserve RAM (see details for an example).</p>
</td></tr>
<tr><td><code id="volume_+3A_grpby">grpBy</code></td>
<td>
<p>variables from PLOT, COND, or TREE tables to group estimates by (NOT quoted). Multiple grouping variables should be combined with <code>c()</code>, and grouping will occur heirarchically. For example, to produce seperate estimates for each ownership group within methods of stand regeneration, specify <code>c(STDORGCD, OWNGRPCD)</code>.</p>
</td></tr>
<tr><td><code id="volume_+3A_polys">polys</code></td>
<td>
<p><code>sp</code> or <code>sf</code> Polygon/MultiPolgyon object; Areal units to bin data for estimation. Seperate estimates will be produced for region encompassed by each areal unit. FIA plot locations will be reprojected to match projection of <code>polys</code> object.</p>
</td></tr>
<tr><td><code id="volume_+3A_returnspatial">returnSpatial</code></td>
<td>
<p>logical; if TRUE, merge population estimates with <code>polys</code> and return as <code>sf</code> multipolygon object. When <code>byPlot = TRUE</code>, return plot-level estimates as <code>sf</code> spatial points.</p>
</td></tr>
<tr><td><code id="volume_+3A_byspecies">bySpecies</code></td>
<td>
<p>logical; if TRUE, returns estimates grouped by species.</p>
</td></tr>
<tr><td><code id="volume_+3A_bysizeclass">bySizeClass</code></td>
<td>
<p>logical; if TRUE, returns estimates grouped by size class (2-inch intervals, see <code><a href="#topic+makeClasses">makeClasses</a></code> to compute different size class intervals).</p>
</td></tr>
<tr><td><code id="volume_+3A_landtype">landType</code></td>
<td>
<p>character (&quot;forest&quot; or &quot;timber&quot;); Type of land that estimates will be produced for. Timberland is a subset of forestland (default) which has high site potential and non-reserve status (see details).</p>
</td></tr>
<tr><td><code id="volume_+3A_treetype">treeType</code></td>
<td>
<p>character (&quot;all&quot;, &quot;live&quot;, &quot;dead&quot;, or &quot;gs&quot;); Type of tree which estimates will be produced for. All includes all stems, live and dead, greater than 1 in. DBH. Live/Dead includes all stems greater than 1 in. DBH which are live (default) or dead (leaning less than 45 degrees), respectively. GS (growing-stock) includes live stems greater than 5 in. DBH which contain at least one 8 ft merchantable log.</p>
</td></tr>
<tr><td><code id="volume_+3A_voltype">volType</code></td>
<td>
<p>character, one of: &quot;NET&quot;, &quot;SOUND&quot;, or &quot;GROSS&quot;; merchantable volume definition to use in estimation. See details for more info.</p>
</td></tr>
<tr><td><code id="volume_+3A_method">method</code></td>
<td>
<p>character; design-based estimator to use. One of:  &quot;TI&quot; (temporally indifferent, default), &quot;annual&quot; (annual), &quot;SMA&quot; (simple moving average), &quot;LMA&quot; (linear moving average), or &quot;EMA&quot; (exponential moving average). See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators.</p>
</td></tr>
<tr><td><code id="volume_+3A_lambda">lambda</code></td>
<td>
<p>numeric (0,1); if <code>method = 'EMA'</code>, the decay parameter used to define weighting scheme for annual panels. Low values place higher weight on more recent panels, and vice versa. Specify a vector of values to compute estimates using mulitple wieghting schemes, and use <code>plotFIA</code> with <code>grp</code> set to <code>lambda</code> to produce moving average ribbon plots. See <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for examples.</p>
</td></tr>
<tr><td><code id="volume_+3A_treedomain">treeDomain</code></td>
<td>
<p>logical predicates defined in terms of the variables in PLOT, TREE, and/or COND tables. Used to define the type of trees for which estimates will be produced (e.g. DBH greater than 20 inches: <code>DIA &gt; 20</code>, Dominant/Co-dominant crowns only: <code>CCLCD %in% c(2,3)</code>. Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only trees where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="volume_+3A_areadomain">areaDomain</code></td>
<td>
<p>logical predicates defined in terms of the variables in PLOT and/or COND tables. Used to define the area for which estimates will be produced (e.g. within 1 mile of improved road: <code>RDDISTCD %in% c(1:6)</code>, Hard maple/basswood forest type: <code>FORTYPCD == 805</code>. Multiple conditions are combined with <code>&amp;</code> (and) or <code>|</code> (or). Only plots within areas where the condition evaluates to TRUE are used in producing estimates. Should NOT be quoted.</p>
</td></tr>
<tr><td><code id="volume_+3A_totals">totals</code></td>
<td>
<p>logical; if TRUE, return total population estimates (e.g. total area) along with ratio estimates (e.g. mean trees per acre).</p>
</td></tr>
<tr><td><code id="volume_+3A_variance">variance</code></td>
<td>
<p>logical; if TRUE, return estimated variance (<code>VAR</code>) and sample size (<code>N</code>). If FALSE, return 'sampling error' (<code>SE</code>) as returned by EVALIDator. Note: sampling error cannot be used to construct confidence intervals.</p>
</td></tr>
<tr><td><code id="volume_+3A_byplot">byPlot</code></td>
<td>
<p>logical; if TRUE, returns estimates for individual plot locations instead of population estimates.</p>
</td></tr>
<tr><td><code id="volume_+3A_treelist">treeList</code></td>
<td>
<p>logical; if TRUE, returns tree-level summaries intended for subsequent use with <code>customPSE</code></p>
</td></tr></table>
<p>.
</p>
<table role = "presentation">
<tr><td><code id="volume_+3A_ncores">nCores</code></td>
<td>
<p>numeric; number of cores to use for parallel implementation. Check available cores using <code><a href="parallel.html#topic+detectCores">detectCores</a></code>. Default = 1, serial processing.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Estimation Details</strong>
</p>
<p>Estimation of forest variables follows the procedures documented in Bechtold and Patterson (2005) and <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a>. Specifically, tree volume per acre is computed using a sample-based ratio-of-means estimator of total volume / total land area within the domain of interest.
</p>
<p>Estimates of total merchantable volume are in units of cubic feet (CF), and estimates of sawlog volume in terms of cubic feet and thousand board feet (MBF; International 1/4 inch rule). FIA's net volume definition is used by default (<code>volType = "NET"</code>): &quot;net volume of wood in the central stem of a sample tree 5.0 inches d.b.h., from a 1-foot stump to a minimum 4-inch top diameter, or to where the central stem breaks into limbs all of which are &lt;4.0 inches in diameter... Does not include rotten, missing, and form cull (volume loss due to rotten, missing, and form cull defect has been deducted)&quot;. Users opt to use two alternative definitions: sound volume (<code>volType = "SOUND"</code>) or gross volume (<code>volType = "GROSS"</code>). Sound volume is identical to net volume except that sound includes volume from portions of the stem that can be considered &quot;form cull&quot; under the net volume definition (e.g., sweep). In contrast, gross volume is identical to the net volume definition except that gross includes volume from portions of the stem that are rotten, missing, and considered form cull.
</p>
<p>Users may specify alternatives to the 'Temporally Indifferent' estimator using the <code>method</code> argument. Alternative design-based estimators include the annual estimator (&quot;ANNUAL&quot;; annual panels, or estimates from plots measured in the same year), simple moving average (&quot;SMA&quot;; combines annual panels with equal weight), linear moving average (&quot;LMA&quot;; combine annual panels with weights that decay <em>linearly</em> with time since measurement), and exponential moving average (&quot;EMA&quot;; combine annual panels with weights that decay <em>exponentially</em> with time since measurement). The &quot;best&quot; estimator depends entirely on user-objectives, see <a href="https://research.fs.usda.gov/treesearch/59521">Stanke et al 2020</a> for a complete description of these estimators and tradeoffs between precision and temporal specificity.
</p>
<p>When <code>byPlot = FALSE</code> (i.e., population estimates are returned), the &quot;YEAR&quot; column in the resulting dataframe indicates the final year of the inventory cycle that estimates are produced for. For example, an estimate of current forest area (e.g., 2018) may draw on data collected from 2008-2018, and &quot;YEAR&quot; will be listed as 2018 (consistent with EVALIDator). However, when <code>byPlot = TRUE</code> (i.e., plot-level estimates returned), the &quot;YEAR&quot; column denotes the year that each plot was measured (MEASYEAR), which may differ slightly from its associated inventory year (INVYR).
</p>
<p>Stratified random sampling techniques are most often employed to compute estimates in recent inventories, although double sampling and simple random sampling may be employed for early inventories. Estimates are adjusted for non-response bias by assuming attributes of non-response plot locations to be equal to the mean of other plots included within thier respective stratum or population.
</p>
<p><strong>Working with &quot;Big Data&quot;</strong>
</p>
<p>If FIA data are too large to hold in memory (e.g., R throws the &quot;cannot allocate vector of size ...&quot; errors), use larger-than-RAM options. See documentation of <code>link{readFIA}</code> for examples of how to set up a <code>Remote.FIA.Database</code>. As a reference, we have used rFIA's larger-than-RAM methods to estimate forest variables using the entire FIA Database (~50GB) on a standard desktop computer with 16GB of RAM. Check out <a href="https://doserlab.com/files/rfia/">our website</a> for more details and examples.
</p>
<p>Easy, efficient parallelization is implemented with the <code><a href="parallel.html#topic+parallel">parallel</a></code> package. Users must only specify the <code>nCores</code> argument with a value greater than 1 in order to implement parallel processing on their machines. Parallel implementation is achieved using a snow type cluster on any Windows OS, and with multicore forking on any Unix OS (Linux, Mac). Implementing parallel processing may substantially decrease free memory during processing, particularly on Windows OS. Thus, users should be cautious when running in parallel, and consider implementing serial processing for this task if computational resources are limited (<code>nCores = 1</code>).
</p>
<p><strong>Definition of forestland</strong>
</p>
<p>Forest land must have at least 10-percent canopy cover by live tally trees of any size, including land that formerly had such tree cover and that will be naturally or artificially regenerated. Forest land includes transition zones, such as areas between heavily forest and non-forested lands that meet the mimium tree canopy cover and forest areas adjacent to urban and built-up lands. The minimum area for classification of forest land is 1 acre in size and 120 feet wide measured stem-to-stem from the outer-most edge. Roadside, streamside, and shelterbelt strips of trees must have a width of at least 120 feet and continuous length of at least 363 feet to qualify as forest land. Tree-covered areas in agricultural production settings, such as fruit orchards, or tree-covered areas in urban settings, such as city parks, are not considered forest land.
</p>
<p>Timber land is a subset of forest land that is producing or is capable of producing crops of industrial wood and not withdrawn from timber utilization by statute or administrative regulation. (Note: Areas qualifying as timberland are capable of producing at least 20 cubic feet per acre per year of industrial wood in natural stands. Currently inaccessible and inoperable areas are NOT included).
</p>


<h3>Value</h3>

<p>Dataframe or sf object (if <code>returnSpatial = TRUE</code>). If <code>byPlot = TRUE</code>, values are returned for each plot (<code>PLOT_STATUS_CD = 1</code> when forest exists at the plot location). All variables with names ending in <code>SE</code>, represent the estimate of sampling error (%) of the variable. When <code>variance = TRUE</code>, variables ending in <code>VAR</code> denote the variance of the variable and <code>N</code> is the total sample size (i.e., including non-zero plots).
</p>

<ul>
<li><p><strong>YEAR</strong>: reporting year associated with estimates
</p>
</li>
<li><p><strong>BOLE_CF_ACRE</strong>: estimate of mean merchantable bole volume per acre (cu.ft./acre)
</p>
</li>
<li><p><strong>SAW_CF_ACRE</strong>: estimate of mean merchantable sawtimber volume per acre (cu.ft./acre)
</p>
</li>
<li><p><strong>SAW_MBF_ACRE</strong>: estimate of mean merchantable sawtimber volume per acre (thousand board feet/acre; International 1/4 inch rule)
</p>
</li>
<li><p><strong>nPlots_TREE</strong>: number of non-zero plots used to compute volume estimates
</p>
</li>
<li><p><strong>nPlots_AREA</strong>: number of non-zero plots used to compute land area estimates
</p>
</li></ul>



<h3>Note</h3>

<p>All sampling error estimates (SE) are returned as the &quot;percent coefficient of variation&quot; (standard deviation / mean * 100) for consistency with EVALIDator. IMPORTANT: sampling error cannot be used to construct confidence intervals. Please use <code>variance = TRUE</code> for that (i.e., return variance and sample size instead of sampling error).</p>


<h3>Author(s)</h3>

<p>Hunter Stanke and Andrew Finley
</p>


<h3>References</h3>

<p>rFIA website: <a href="https://doserlab.com/files/rfia/">https://doserlab.com/files/rfia/</a>
</p>
<p>FIA Database User Guide: <a href="https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi">https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi</a>
</p>
<p>Bechtold, W.A.; Patterson, P.L., eds. 2005. The Enhanced Forest Inventory and Analysis Program - National Sampling Design and Estimation Procedures. Gen. Tech. Rep. SRS - 80. Asheville, NC: U.S. Department of Agriculture, Forest Service, Southern Research Station. 85 p. <a href="https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf">https://www.srs.fs.usda.gov/pubs/gtr/gtr_srs080/gtr_srs080.pdf</a>
</p>
<p>Stanke, H., Finley, A. O., Weed, A. S., Walters, B. F., &amp; Domke, G. M. (2020). rFIA: An R package for estimation of forest attributes with the US Forest Inventory and Analysis database. Environmental Modelling &amp; Software, 127, 104664.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load data from the rFIA package
data(fiaRI)
data(countiesRI)

# Most recents subset
fiaRI_mr &lt;- clipFIA(fiaRI)


# Most recent estimates for growing-stock trees on timber land
volume(db = fiaRI_mr,
       landType = 'timber',
       treeType = 'gs')


# Same as above, but using the gross volume definition
volume(db = fiaRI_mr,
       landType = 'timber',
       treeType = 'gs',
       volType = 'gross')

# Same as above, but at the plot-level
volume(db = fiaRI_mr,
       landType = 'timber',
       treeType = 'gs',
       volType = 'gross',
       byPlot = TRUE)

# Estimates for live white pine ( &gt; 12" DBH) on forested mesic sites (all available inventories)
volume(fiaRI_mr,
       treeType = 'live',
       treeDomain = SPCD == 129 &amp; DIA &gt; 12, # Species code for white pine
       areaDomain = PHYSCLCD %in% 21:29) # Mesic Physiographic classes

# Most recent estimates grouped by stand age on forest land
# Make a categorical variable which represents stand age (grouped by 10 yr intervals)
fiaRI_mr$COND$STAND_AGE &lt;- makeClasses(fiaRI_mr$COND$STDAGE, interval = 10)
volume(db = fiaRI_mr,
       grpBy = STAND_AGE)

# Estimates for snags greater than 20 in DBH on forestland for all
#  available inventories (time-series)
volume(db = fiaRI,
       landType = 'forest',
       treeType = 'dead',
       treeDomain = DIA &gt; 20)

# Most recent estimates for live stems on forest land by species
volume(db = fiaRI_mr,
       landType = 'forest',
       treeType = 'live',
       bySpecies = TRUE)

# Same as above, but implemented in parallel (much quicker)
# parallel::detectCores(logical = FALSE) # 4 cores available, we will take 2
# volume(db = fiaRI_mr,
#        landType = 'forest',
#        treeType = 'live',
#        bySpecies = TRUE,
#        nCores = 2)


# Most recent estimates for all stems on forest land grouped by user-defined areal units
ctSF &lt;- volume(fiaRI_mr,
               polys = countiesRI,
               returnSpatial = TRUE)
plot(ctSF) # Plot multiple variables simultaneously
plotFIA(ctSF, SAW_MBF_ACRE) # Plot of saw volume, in board feet


</code></pre>

<hr>
<h2 id='writeFIA'>Write FIA tables to local directory</h2><span id='topic+writeFIA'></span>

<h3>Description</h3>

<p>Write <code>FIA.Database</code> object to local directory as a series of .csv files representing each table. Most useful for writing merged states and temporal/spatial subsets of the database. Once written as .csv, files can be reloaded into R with <code>readFIA()</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>writeFIA(db, dir, byState = FALSE, nCores = 1, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="writeFIA_+3A_db">db</code></td>
<td>
<p><code>FIA.Database</code> object produced from <code>readFIA()</code> or <code>getFIA()</code>.</p>
</td></tr>
<tr><td><code id="writeFIA_+3A_dir">dir</code></td>
<td>
<p>directory where FIA Datatables will be stored.</p>
</td></tr>
<tr><td><code id="writeFIA_+3A_ncores">nCores</code></td>
<td>
<p>numeric; number of cores to use for parallel implementation. Check available cores using <code><a href="parallel.html#topic+detectCores">detectCores</a></code>. Default = 1, serial processing.</p>
</td></tr>
<tr><td><code id="writeFIA_+3A_bystate">byState</code></td>
<td>
<p>logical; should tables be written out by state? Must be TRUE if planning to load data as an out-of-memory database in the future (see <code>readFIA()</code>).</p>
</td></tr>
<tr><td><code id="writeFIA_+3A_...">...</code></td>
<td>
<p>other arguments to pass to <code>data.table::fwrite()</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Easy, efficient parallelization is implemented with the <code><a href="parallel.html#topic+parallel">parallel</a></code> package. Users must only specify the <code>nCores</code> argument with a value greater than 1 in order to implement parallel processing on their machines. Parallel implementation is achieved using a snow type cluster on any Windows OS, and with multicore forking on any Unix OS (Linux, Mac). Implementing parallel processing may substantially decrease decrease free memory during processing, particularly on Windows OS. Thus, users should be cautious when running in parallel, and consider implementing serial processing for this task if computational resources are limited (<code>nCores = 1</code>).
</p>


<h3>Value</h3>

<p>No return value, called to export <code>FIA.Database</code> object to a local directory.
</p>


<h3>Author(s)</h3>

<p>Hunter Stanke and Andrew Finley
</p>


<h3>See Also</h3>

<p><code><a href="#topic+readFIA">readFIA</a></code>, <code><a href="#topic+getFIA">getFIA</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Write the 'fiaRI' object to a temporary directory
# Replace temp_dir with the path to your directory (where data will be saved)
temp_dir = tempdir()
writeFIA(fiaRI, dir = temp_dir)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
