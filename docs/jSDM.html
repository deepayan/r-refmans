<!DOCTYPE html><html><head><title>Help for package jSDM</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {jSDM}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#aravo'><p>Distribution of Alpine plants in Aravo (Valloire, France)</p></a></li>
<li><a href='#birds'><p>birds dataset</p></a></li>
<li><a href='#eucalypts'><p>eucalypts dataset</p></a></li>
<li><a href='#frogs'><p>frogs dataset</p></a></li>
<li><a href='#fungi'><p>fungi dataset</p></a></li>
<li><a href='#get_enviro_cor'><p>Extract covariances and correlations due to shared environmental responses</p></a></li>
<li><a href='#get_residual_cor'><p>Calculate the residual correlation matrix from a latent variable model (LVM)</p></a></li>
<li><a href='#inv_logit'><p>Generalized inverse logit function</p></a></li>
<li><a href='#jSDM_binomial_logit'><p>Binomial logistic regression</p></a></li>
<li><a href='#jSDM_binomial_probit'><p>Binomial probit regression</p></a></li>
<li><a href='#jSDM_binomial_probit_long_format'><p>Binomial probit regression on long format data</p></a></li>
<li><a href='#jSDM_binomial_probit_sp_constrained'><p>Binomial probit regression with selected constrained species</p></a></li>
<li><a href='#jSDM_gaussian'><p>Binomial probit regression</p></a></li>
<li><a href='#jSDM_poisson_log'><p>Poisson regression with log link function</p></a></li>
<li><a href='#jSDM-package'><p>joint species distribution models</p></a></li>
<li><a href='#logit'><p>Generalized logit function</p></a></li>
<li><a href='#madagascar'><p>Madagascar's forest inventory</p></a></li>
<li><a href='#mites'><p>mites dataset</p></a></li>
<li><a href='#mosquitos'><p>mosquitos dataset</p></a></li>
<li><a href='#plot_associations'><p>plot_associations</p>
plot species-species associations</a></li>
<li><a href='#plot_residual_cor'><p>Plot the residual correlation matrix from a latent variable model (LVM).</p></a></li>
<li><a href='#predict.jSDM'><p>Predict method for models fitted with jSDM</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Joint Species Distribution Models</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.6</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-07-12</td>
</tr>
<tr>
<td>Imports:</td>
<td>Rcpp (&ge; 1.0.0), graphics, stats, coda, corrplot, stringi,
MASS, parallel, doParallel, foreach, methods</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo, RcppGSL</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>GNU GSL</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, kableExtra, terra, dplyr, rmarkdown, bookdown,
testthat (&ge; 3.0.0), boral, Hmsc, BayesComm, snow, snowfall,
ggplot2, covr, ape, gstat</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jeanne Clément &lt;jeanne.clement16@laposte.net&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Fits joint species distribution models ('jSDM')
    in a hierarchical Bayesian framework (Warton and al. 2015
    &lt;<a href="https://doi.org/10.1016%2Fj.tree.2015.09.007">doi:10.1016/j.tree.2015.09.007</a>&gt;). The Gibbs sampler is written
    in 'C++'. It uses 'Rcpp', 'Armadillo' and 'GSL' to maximize computation
    efficiency.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://ecology.ghislainv.fr/jSDM/">https://ecology.ghislainv.fr/jSDM/</a>,
<a href="https://github.com/ghislainv/jSDM">https://github.com/ghislainv/jSDM</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/ghislainv/jSDM/issues">https://github.com/ghislainv/jSDM/issues</a></td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-07-17 15:21:44 UTC; clement</td>
</tr>
<tr>
<td>Author:</td>
<td>Jeanne Clément <a href="https://orcid.org/0000-0002-5228-5015"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Ghislain Vieilledent
    <a href="https://orcid.org/0000-0002-1685-4997"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Frédéric Gosselin <a href="https://orcid.org/0000-0003-3737-106X"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  CIRAD [cph, fnd]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-07-22 10:30:09 UTC</td>
</tr>
</table>
<hr>
<h2 id='aravo'>Distribution of Alpine plants in Aravo (Valloire, France)</h2><span id='topic+aravo'></span>

<h3>Description</h3>

<p>This dataset describe the distribution of 82 species of Alpine plants in 75 sites. Species traits and environmental variables are also measured.</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("aravo")</code></pre>


<h3>Format</h3>

<p>aravo is a list containing the following objects :
</p>

<dl>
<dt><code>spe</code></dt><dd><p>is a data.frame with the abundance values of 82 species (columns) in 75 sites (rows).</p>
</dd>
<dt><code>env</code></dt><dd><p>is a data.frame with the measurements of 6 environmental variables for the sites.</p>
</dd>
<dt><code>traits</code></dt><dd><p>is data.frame with the measurements of 8 traits for the species.</p>
</dd>
<dt><code>spe.names</code></dt><dd><p>is a vector with full species names.</p>
</dd>
</dl>



<h3>Details</h3>


<p>The environmental variables are : 
</p>

<table>
<tr>
 <td style="text-align: left;">
 <code>Aspect</code> </td><td style="text-align: left;"> Relative south aspect (opposite of the sine of aspect with flat coded 0) </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>Slope</code> </td><td style="text-align: left;"> Slope inclination (degrees) </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>Form</code> </td><td style="text-align: left;"> Microtopographic landform index: 1 (convexity); 2 (convex slope); 3 (right slope); </td>
</tr>
<tr>
 <td style="text-align: left;">
    </td><td style="text-align: left;"> 4 (concave slope); 5 (concavity) </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>Snow</code> </td><td style="text-align: left;"> Mean snowmelt date (Julian day) averaged over 1997-1999 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>PhysD</code> </td><td style="text-align: left;"> Physical disturbance, i.e., percentage of unvegetated soil due to physical processes </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>ZoogD</code> </td><td style="text-align: left;"> Zoogenic disturbance, i.e., quantity of unvegetated soil due to marmot activity: no; some; high </td>
</tr>
<tr>
 <td style="text-align: left;"> </td>
</tr>

</table>

<p>The species traits for the plants are:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <code>Height</code> </td><td style="text-align: left;"> Vegetative height (cm) </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>Spread</code> </td><td style="text-align: left;"> Maximum lateral spread of clonal plants (cm) </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>Angle</code> </td><td style="text-align: left;"> Leaf elevation angle estimated at the middle of the lamina </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>Area</code> </td><td style="text-align: left;"> Area of a single leaf </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>Thick</code> </td><td style="text-align: left;"> Maximum thickness of a leaf cross section (avoiding the midrib) </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>SLA</code> </td><td style="text-align: left;"> Specific leaf area </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>Nmass</code> </td><td style="text-align: left;"> Mass-based leaf nitrogen content </td>
</tr>
<tr>
 <td style="text-align: left;">
    <code>Seed</code> </td><td style="text-align: left;"> Seed mass </td>
</tr>
<tr>
 <td style="text-align: left;"> </td>
</tr>

</table>
 


<h3>Source</h3>

<p>Choler, P. (2005) Consistent shifts in Alpine plant traits along a mesotopographical gradient. Arctic, Antarctic, and Alpine Research 37,444-453.
</p>
<p>Dray S, Dufour A (2007). The ade4 Package: Implementing the Duality Diagram for Ecologists. <em>Journal of Statistical Software</em>, 22(4), 1-20. <a href="https://doi.org/10.18637/jss.v022.i04">doi:10.18637/jss.v022.i04</a>. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(aravo, package="jSDM")
summary(aravo)
</code></pre>

<hr>
<h2 id='birds'>birds dataset</h2><span id='topic+birds'></span>

<h3>Description</h3>

<p>The Swiss breeding bird survey (&quot;Monitoring Häufige Brutvögel&quot; MHB) has monitored the populations of 158 common species since 1999.   
</p>
<p>The MHB sample from <code>data(MHB2014, package="AHMbook")</code> consists of 267 1-km squares that are laid out as a grid across Switzerland. Fieldwork is conducted by about 200 skilled birdwatchers, most of them volunteers. Avian populations are monitored using a simplified territory mapping protocol, where each square is surveyed up to three times during the breeding season (only twice above the tree line).  
</p>
<p>Surveys are conducted along a transect that does not change over the years. The <code>birds</code> dataset has the data for 2014, except one quadrat not surveyed in 2014. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("birds")</code></pre>


<h3>Format</h3>

<p> A data frame with 266 observations on the following 166 variables.
</p>
<p><b>158 bird species</b> named in latin and whose occurrences are indicated as the number of visits to each site during which the species was observed, including 13 species not recorded in the year 2014 and <b>5 covariates</b> collected on the 266 1x1 km quadrat as well as their identifiers and coordinates : 
</p>

<table>
<tr>
 <td style="text-align: left;">
    <b><code>siteID</code></b> </td><td style="text-align: left;"> an alphanumeric site identifier </td>
</tr>
<tr>
 <td style="text-align: left;">
    </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
    <b><code>coordx</code></b> </td><td style="text-align: left;"> a numeric vector indicating the x coordinate of the centre of the quadrat.</td>
</tr>
<tr>
 <td style="text-align: left;"> 
    </td><td style="text-align: left;"> The coordinate reference system is not specified intentionally. </td>
</tr>
<tr>
 <td style="text-align: left;">
    </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
    <b><code>coordy</code></b> </td><td style="text-align: left;"> a numeric vector indicating the y coordinate of the centre of the quadrat.</td>
</tr>
<tr>
 <td style="text-align: left;">
        </td><td style="text-align: left;">  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <b><code>elev</code></b> </td><td style="text-align: left;"> a numeric vector indicating the mean elevation of the quadrat (m).</td>
</tr>
<tr>
 <td style="text-align: left;">
        </td><td style="text-align: left;">  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <b><code>rlength</code></b> </td><td style="text-align: left;">  the length of the route walked in the quadrat (km).</td>
</tr>
<tr>
 <td style="text-align: left;">
    </td><td style="text-align: left;">  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <b><code>nsurvey</code></b> </td><td style="text-align: left;"> a numeric vector indicating the number of replicate surveys planned in the quadrat; </td>
</tr>
<tr>
 <td style="text-align: left;">
    </td><td style="text-align: left;"> above the tree-line 2, otherwise 3. </td>
</tr>
<tr>
 <td style="text-align: left;"> 
            </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
    <b><code>forest</code></b> </td><td style="text-align: left;"> a numeric vector indicating the percentage of forest cover in the quadrat.</td>
</tr>
<tr>
 <td style="text-align: left;"> 
    </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;"> 
    <b><code>obs14</code></b> </td><td style="text-align: left;"> a categorical vector indicating the identifying number of the observer.</td>
</tr>
<tr>
 <td style="text-align: left;"> 
</td>
</tr>

</table>



<h3>Details</h3>

<p>Only the Latin names of bird species are given in this dataset but you can find the corresponding English names in the original dataset : <code>data(MHB2014, package="AHMbook")</code>. 
</p>


<h3>Source</h3>

<p>Swiss Ornithological Institute</p>


<h3>References</h3>

<p>Kéry and Royle (2016) Applied Hierarachical Modeling in Ecology Section 11.3 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(birds, package="jSDM")
head(birds)
# find species not recorded in 2014
which(colSums(birds[,1:158])==0)
</code></pre>

<hr>
<h2 id='eucalypts'>eucalypts dataset</h2><span id='topic+eucalypts'></span>

<h3>Description</h3>

<p>The Eucalyptus data set includes 12 taxa recorded in 458 plots spanning elevation gradients in the Grampians National Park, Victoria, which is known for high species diversity and endemism. The park has three mountain ranges interspersed with alluvial valleys and sand sheet and has a semi-Mediterranean climate with warm, dry summers and cool, wet winters.
</p>
<p>This dataset records presence or absence at 458 sites of 12 eucalypts species, 7 covariates collected at these sites as well as their longitude and latitude.</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("eucalypts")</code></pre>


<h3>Format</h3>

<p>A data frame with 458 observations on the following 21 variables.
</p>

<p><b>12 eucalypts species</b> which presence on sites is indicated by a 1 and absence by a 0 : 
</p>
<dl>
<dt><code>ALA</code></dt><dd><p>a binary vector indicating the occurrence of the species E. alaticaulis</p>
</dd>
<dt><code>ARE</code></dt><dd><p>a binary vector indicating the occurrence of the species E. arenacea</p>
</dd>
<dt><code>BAX</code></dt><dd><p>a binary vector indicating the occurrence of the species E. baxteri</p>
</dd>
<dt><code>CAM</code></dt><dd><p>a binary vector indicating the occurrence of the species E. camaldulensis</p>
</dd>
<dt><code>GON</code></dt><dd><p>a binary vector indicating the occurrence of the species E. goniocalyx</p>
</dd>
<dt><code>MEL</code></dt><dd><p>a binary vector indicating the occurrence of the species E. melliodora</p>
</dd>
<dt><code>OBL</code></dt><dd><p>a binary vector indicating the occurrence of the species E. oblique</p>
</dd>
<dt><code>OVA</code></dt><dd><p>a binary vector indicating the occurrence of the species E. ovata</p>
</dd>
<dt><code>WIL</code></dt><dd><p>a binary vector indicating the occurrence of the species E. willisii subsp. Falciformis</p>
</dd>
<dt><code>ALP</code></dt><dd><p>a binary vector indicating the occurrence of the species E. serraensis, E. verrucata and E. victoriana</p>
</dd>
<dt><code>VIM</code></dt><dd><p>a binary vector indicating the occurrence of the species E. viminalis subsp. Viminalis and Cygnetensis</p>
</dd>
<dt><code>ARO.SAB</code></dt><dd><p>a binary vector indicating the occurrence of the species E. aromaphloia and E. sabulosa</p>
</dd>  
</dl>
<p><b>7 covariates</b> collected on the 458 sites and their coordinates : 
</p>
<dl>
<dt><code>Rockiness</code></dt><dd><p>a numeric vector taking values from 0 to 95 corresponding to the rock cover of the site in percent estimated in 5 % increments in field plots</p>
</dd>
<dt><code>Sandiness</code></dt><dd><p>a binary vector indicating if soil texture categorie is sandiness based on soil texture classes from field plots and according to relative amounts of sand, silt, and clay particles</p>
</dd>
<dt><code>VallyBotFlat</code></dt><dd><p>a numeric vector taking values from 0 to 6 corresponding to the valley bottom flatness GIS-derived variable defining flat areas relative to surroundings likely to accumulate sediment (units correspond to the percentage of slope e.g. 0.5 = 16 %slope, 4.5 = 1 %slope, 5.5 = 0.5 %slope)</p>
</dd>
<dt><code>PPTann</code></dt><dd><p>a numeric vector taking values from 555 to 1348 corresponding to annual precipitation in millimeters measured as the sum of monthly precipitation estimated using BIOCLIM based on 20m grid cell Digital Elevation Model</p>
</dd>
<dt><code>Loaminess</code></dt><dd><p>a binary vector indicating if soil texture categorie is loaminess based on soil texture classes from field plots and according to relative amounts of sand, silt, and clay particles</p>
</dd>
<dt><code>cvTemp</code></dt><dd><p>a numeric vector taking values from 136 to 158 corresponding to coefficient of variation of temperature seasonality in percent measured as the standard deviation of weekly mean temperatures as a percentage of the annual mean temperature from BIOCLIM</p>
</dd>
<dt><code>T0</code></dt><dd><p>a numeric vector corresponding to solar radiation in <code class="reqn">WH/m^2</code> measured as the amount of incident solar energy based on the visible sky and the sun's position. Derived from Digital Elevation Model in ArcGIS 9.2 Spatial Analyst for the summer solstice (December 22)</p>
</dd>
<dt><code>latitude</code></dt><dd><p>a numeric vector indicating the latitude of the studied site</p>
</dd>
<dt><code>longitude</code></dt><dd><p>a numeric vector indicating the longitude of the studied site</p>
</dd>
</dl>



<h3>Source</h3>

<p>Wilkinson, D. P.; Golding, N.; Guillera-Arroita, G.; Tingley, R. and McCarthy, M. A. (2018) A comparison of joint species distribution models for presence-absence data. <em>Methods in Ecology and Evolution</em>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(eucalypts, package="jSDM")
head(eucalypts)
</code></pre>

<hr>
<h2 id='frogs'>frogs dataset</h2><span id='topic+frogs'></span>

<h3>Description</h3>

<p>Presence or absence of 9 species of frogs at 104 sites, 3 covariates collected  at these sites and their coordinates.
</p>


<h3>Format</h3>

<p><code>frogs</code> is a data frame with 104 observations on the following 14 variables.
</p>

<dl>
<dt><code>Species_</code></dt><dd><p>1 to 9 indicate by a 0 the absence of the species on one site and by a 1 its presence</p>
</dd> 
<dt><code>Covariates_</code></dt><dd><p>1 and 3 continuous variables</p>
</dd>
<dt><code>Covariates_</code></dt><dd><p>2 discrete variables</p>
</dd>
<dt><code>x</code></dt><dd><p>a numeric vector of first coordinates corresponding to each site</p>
</dd>
<dt><code>y</code></dt><dd><p>a numeric vector of second coordinates corresponding to each site</p>
</dd>
</dl>



<h3>Source</h3>

<p>Wilkinson, D. P.; Golding, N.; Guillera-Arroita, G.; Tingley, R. and McCarthy, M. A. (2018) A comparison of joint species distribution models for presence-absence data. <em>Methods in Ecology and Evolution</em>.</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(frogs, package="jSDM")
head(frogs)
</code></pre>

<hr>
<h2 id='fungi'>fungi dataset</h2><span id='topic+fungi'></span>

<h3>Description</h3>

<p>Presence or absence of 11 species of fungi on dead-wood objects at 800 sites and 12 covariates collected at these sites.</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("fungi")</code></pre>


<h3>Format</h3>

<p>A data frame with 800 observations on the following 23 variables :
</p>

<p><b>11 fungi species</b> which presence on sites is indicated by a 1 and absence by a 0 :    
</p>
<dl>
<dt><code>antser</code></dt><dd><p>a binary vector</p>
</dd>
<dt><code>antsin</code></dt><dd><p>a binary vector</p>
</dd>
<dt><code>astfer</code></dt><dd><p>a binary vector</p>
</dd>
<dt><code>fompin</code></dt><dd><p>a binary vector</p>
</dd>
<dt><code>hetpar</code></dt><dd><p>a binary vector</p>
</dd>
<dt><code>junlut</code></dt><dd><p>a binary vector</p>
</dd>
<dt><code>phefer</code></dt><dd><p>a binary vector</p>
</dd>
<dt><code>phenig</code></dt><dd><p>a binary vector</p>
</dd>
<dt><code>phevit</code></dt><dd><p>a binary vector</p>
</dd>
<dt><code>poscae</code></dt><dd><p>a binary vector</p>
</dd>
<dt><code>triabi</code></dt><dd><p>a binary vector</p>
</dd> 
</dl>
<p><b>12 covariates</b> collected on the 800 sites :  
</p>
<dl>
<dt><code>diam</code></dt><dd><p>a numeric vector indicating the diameter of dead-wood object</p>
</dd>
<dt><code>dc1</code></dt><dd><p>a binary vector indicating if the decay class is 1 measured in the scale 1, 2, 3, 4, 5  (from freshly  decayed to almost completely decayed)</p>
</dd>
<dt><code>dc2</code></dt><dd><p>a binary vector indicating if the decay class is 2</p>
</dd>
<dt><code>dc3</code></dt><dd><p>a binary vector indicating if the decay class is 3</p>
</dd>
<dt><code>dc4</code></dt><dd><p>a binary vector indicating if the decay class is 4</p>
</dd>
<dt><code>dc5</code></dt><dd><p>a binary vector indicating if the decay class is 5</p>
</dd>
<dt><code>quality3</code></dt><dd><p>a binary vector indicating if the quality is level 3</p>
</dd>
<dt><code>quality4</code></dt><dd><p>a binary vector indicating if the quality is level 4</p>
</dd>
<dt><code>ground3</code></dt><dd><p>a binary vector indicating if the ground contact is level 3 as 2 = no ground contact,  3 = less than half of the log in ground contact and 4 = more than half of the log in ground contact</p>
</dd>
<dt><code>ground4</code></dt><dd><p>a binary vector a binary vector indicating if the ground contact is level 4</p>
</dd>
<dt><code>epi</code></dt><dd><p>a numeric vector indicating the epiphyte cover</p>
</dd>
<dt><code>bark</code></dt><dd><p>a numeric vector indicating the bark cover</p>
</dd>
</dl>



<h3>Source</h3>

<p>Wilkinson, D. P.; Golding, N.; Guillera-Arroita, G.; Tingley, R. and McCarthy, M. A. (2018) A comparison of joint species distribution models for presence-absence data. <em>Methods in Ecology and Evolution</em>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(fungi, package="jSDM")
head(fungi)
</code></pre>

<hr>
<h2 id='get_enviro_cor'>Extract covariances and correlations due to shared environmental responses</h2><span id='topic+get_enviro_cor'></span>

<h3>Description</h3>

<p>Calculates the correlation between columns of the response matrix,
due to similarities in the response to explanatory variables i.e., shared environmental response.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_enviro_cor(mod, type = "mean", prob = 0.95)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_enviro_cor_+3A_mod">mod</code></td>
<td>
<p>An object of class <code>"jSDM"</code></p>
</td></tr>
<tr><td><code id="get_enviro_cor_+3A_type">type</code></td>
<td>
<p>A choice of either the posterior median (<code>type = "median"</code>) or posterior mean (<code>type = "mean"</code>), which are then treated as estimates and the fitted values are calculated from.
Default is posterior mean.</p>
</td></tr>
<tr><td><code id="get_enviro_cor_+3A_prob">prob</code></td>
<td>
<p>A numeric scalar in the interval <code class="reqn">(0,1)</code> giving the target probability coverage of the intervals, by which to determine whether the correlations are &quot;significant&quot;.
Defaults to 0.95.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In both independent response and correlated response models, where each of the columns of the response matrix <code class="reqn">Y</code> are fitted to a set of explanatory variables given by <code class="reqn">X</code>,
the covariance between two columns <code class="reqn">j</code> and <code class="reqn">j'</code>, due to similarities in their response to the model matrix, is thus calculated based on the linear predictors <code class="reqn">X \beta_j</code> and <code class="reqn">X \beta_j'</code>, where <code class="reqn">\beta_j</code> are species effects relating to the explanatory variables.
Such correlation matrices are discussed and found in Ovaskainen et al., (2010), Pollock et al., (2014).
</p>


<h3>Value</h3>

<p>results, a list including : 
</p>
<table>
<tr><td><code>cor</code>, <code>cor.lower</code>, <code>cor.upper</code></td>
<td>
<p>A set of <code class="reqn">np \times np</code> correlation matrices, containing either the posterior median or mean estimate  over the MCMC samples plus lower and upper limits of the corresponding 95 % highest posterior interval.</p>
</td></tr> 
<tr><td><code>cor.sig</code></td>
<td>
<p>A <code class="reqn">np \times np</code> correlation matrix containing only the “significant&quot; correlations whose 95 % highest posterior density (HPD) interval does not contain zero. All non-significant correlations are set to zero.</p>
</td></tr>
<tr><td><code>cov</code></td>
<td>
<p>Average over the MCMC samples of the <code class="reqn">np \times np</code> covariance matrix.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent &lt;ghislain.vieilledent@cirad.fr&gt;
</p>
<p>Jeanne Clément &lt;jeanne.clement16@laposte.net&gt;
</p>


<h3>References</h3>

<p>Hui FKC (2016). “boral: Bayesian Ordination and Regression Analysis of Multivariate Abundance Data in R.” <em>Methods in Ecology and Evolution</em>, 7, 744–750.  
</p>
<p>Ovaskainen et al. (2010). Modeling species co-occurrence by multivariate logistic regression generates new hypotheses on fungal interactions. <em>Ecology</em>, 91, 2514-2521. 
</p>
<p>Pollock et al. (2014). Understanding co-occurrence by modelling species simultaneously with a Joint Species Distribution Model (JSDM). <em>Methods in Ecology and Evolution</em>, 5, 397-406.
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+cov2cor">cov2cor</a></code> <code><a href="#topic+get_residual_cor">get_residual_cor</a></code> <code><a href="#topic+jSDM-package">jSDM-package</a></code> <code><a href="#topic+jSDM_binomial_probit">jSDM_binomial_probit</a></code> <br />
<code><a href="#topic+jSDM_binomial_logit">jSDM_binomial_logit</a></code> <code><a href="#topic+jSDM_poisson_log">jSDM_poisson_log</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(jSDM)
# frogs data
 data(frogs, package="jSDM")
 # Arranging data
 PA_frogs &lt;- frogs[,4:12]
 # Normalized continuous variables
 Env_frogs &lt;- cbind(scale(frogs[,1]),frogs[,2], 
                    scale(frogs[,3]))
 colnames(Env_frogs) &lt;- colnames(frogs[,1:3])
 Env_frogs &lt;- as.data.frame(Env_frogs)
 # Parameter inference
# Increase the number of iterations to reach MCMC convergence
mod &lt;- jSDM_binomial_probit(# Response variable
                             presence_data=PA_frogs,
                             # Explanatory variables
                             site_formula = ~.,
                             site_data = Env_frogs,
                             n_latent=0,
                             site_effect="random",
                             # Chains
                             burnin=100,
                             mcmc=100,
                             thin=1,
                             # Starting values
                             alpha_start=0,
                             beta_start=0,
                             V_alpha=1,
                             # Priors
                             shape=0.5, rate=0.0005,
                             mu_beta=0, V_beta=10,
                             # Various
                             seed=1234, verbose=1)
# Calcul of residual correlation between species 
 enviro.cors &lt;- get_enviro_cor(mod)
</code></pre>

<hr>
<h2 id='get_residual_cor'>Calculate the residual correlation matrix from a latent variable model (LVM)</h2><span id='topic+get_residual_cor'></span>

<h3>Description</h3>

<p>This function use coefficients <code class="reqn">(\lambda_{jl}</code> with <code class="reqn">j=1,\dots,n_{species}</code> and <code class="reqn">l=1,\dots,n_{latent})</code>, corresponding to latent variables fitted using <code>jSDM</code> package, to calculate the variance-covariance matrix which controls correlation between species.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_residual_cor(mod, prob = 0.95, type = "mean")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_residual_cor_+3A_mod">mod</code></td>
<td>
<p>An object of class <code>"jSDM"</code></p>
</td></tr>
<tr><td><code id="get_residual_cor_+3A_prob">prob</code></td>
<td>
<p>A numeric scalar in the interval <code class="reqn">(0,1)</code> giving the target probability coverage of the highest posterior density (HPD) intervals, by which to determine whether the correlations are &quot;significant&quot;. Defaults to 0.95.</p>
</td></tr>
<tr><td><code id="get_residual_cor_+3A_type">type</code></td>
<td>
<p>A choice of either the posterior median (<code>type = "median"</code>) or posterior mean (<code>type = "mean"</code>), which are then treated as estimates and the fitted values are calculated from.
Default is posterior mean.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>After fitting the jSDM with latent variables, the <b>fullspecies residual correlation matrix</b> : <code class="reqn">R=(R_{ij})</code> with <code class="reqn">i=1,\ldots, n_{species}</code> and <code class="reqn">j=1,\ldots, n_{species}</code> can be derived from the covariance in the latent variables such as : 
<code class="reqn">\Sigma_{ij}=\lambda_i' .\lambda_j</code>, in the case of a regression with probit, logit or poisson link function and 
</p>

<table>
<tr>
 <td style="text-align: left;">
<code class="reqn">\Sigma_{ij}</code> </td><td style="text-align: left;"> <code class="reqn">= \lambda_i' .\lambda_j + V</code> </td><td style="text-align: left;"> if i=j </td>
</tr>
<tr>
 <td style="text-align: left;">
         </td><td style="text-align: left;"> <code class="reqn">= \lambda_i' .\lambda_j</code> </td><td style="text-align: left;"> else, </td>
</tr>

</table>
<p>, in the case of a linear regression with a response variable such as </p>
<p style="text-align: center;"><code class="reqn">y_{ij} \sim \mathcal{N}(\theta_{ij}, V)</code>
</p>
<p>.
Then we compute correlations from covariances :
</p>
<p style="text-align: center;"><code class="reqn">R_{ij} = \frac{\Sigma_{ij}}{\sqrt{\Sigma_ii\Sigma _jj}}</code>
</p>
<p>.
</p>


<h3>Value</h3>

<p>results A list including : 
</p>
<table>
<tr><td><code>cov.mean</code></td>
<td>
<p>Average over the MCMC samples of the variance-covariance matrix, if <code>type = "mean"</code>.</p>
</td></tr> 
<tr><td><code>cov.median</code></td>
<td>
<p>Median over the MCMC samples of the variance-covariance matrix, if <code>type = "median"</code>.</p>
</td></tr>
<tr><td><code>cov.lower</code></td>
<td>
<p>A <code class="reqn">n_{species} \times n_{species}</code> matrix containing the lower limits of the  (<code class="reqn">100 \times prob \%</code>) HPD interval of variance-covariance matrices over the MCMC samples.</p>
</td></tr>
<tr><td><code>cov.upper</code></td>
<td>
<p>A <code class="reqn">n_{species} \times n_{species}</code> matrix containing the upper limits of the  (<code class="reqn">100 \times prob \%</code>) HPD interval of variance-covariance matrices over the MCMC samples.</p>
</td></tr>
<tr><td><code>cov.sig</code></td>
<td>
<p>A <code class="reqn">n_{species} \times n_{species}</code> matrix containing the value 1 corresponding to the “significant&quot; co-variances and the value 0 corresponding to &quot;non-significant&quot; co-variances, whose (<code class="reqn">100 \times prob \%</code>) HPD interval over the MCMC samples contain zero.</p>
</td></tr>
<tr><td><code>cor.mean</code></td>
<td>
<p>Average over the MCMC samples of the residual correlation matrix, if <code>type = "mean"</code>.</p>
</td></tr>
<tr><td><code>cor.median</code></td>
<td>
<p>Median over the MCMC samples of the residual correlation matrix, if <code>type = "median"</code>.</p>
</td></tr>
<tr><td><code>cor.lower</code></td>
<td>
<p>A <code class="reqn">n_{species} \times n_{species}</code> matrix containing the lower limits of the  (<code class="reqn">100 \times prob \%</code>) HPD interval of correlation matrices over the MCMC samples.</p>
</td></tr>
<tr><td><code>cor.upper</code></td>
<td>
<p>A <code class="reqn">n_{species} \times n_{species}</code> matrix containing the upper limits of the  (<code class="reqn">100 \times prob \%</code>) HPD interval of correlation matrices over the MCMC samples.</p>
</td></tr>
<tr><td><code>cor.sig</code></td>
<td>
<p>A <code class="reqn">n_{species} \times n_{species}</code> matrix containing the value <code class="reqn">1</code> corresponding to the “significant&quot; correlations and the value <code class="reqn">0</code> corresponding to &quot;non-significant&quot; correlations,
whose (<code class="reqn">100 \times prob \%</code>) HPD interval over the MCMC samples contain zero.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent &lt;ghislain.vieilledent@cirad.fr&gt;
</p>
<p>Jeanne Clément &lt;jeanne.clement16@laposte.net&gt;
</p>


<h3>References</h3>

<p>Hui FKC (2016). boral: Bayesian Ordination and Regression Analysis of Multivariate Abundance Data in R. <em>Methods in Ecology and Evolution</em>, 7, 744–750. <br />
</p>
<p>Ovaskainen and al. (2016). Using latent variable models to identify large networks of species-to-species associations at different spatial scales. <em>Methods in Ecology and Evolution</em>, 7, 549-555. <br />
</p>
<p>Pollock and al. (2014). Understanding co-occurrence by modelling species simultaneously with a Joint Species Distribution Model (JSDM). <em>Methods in Ecology and Evolution</em>, 5, 397-406. <br />
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_enviro_cor">get_enviro_cor</a></code> <code><a href="stats.html#topic+cov2cor">cov2cor</a></code> <code><a href="#topic+jSDM-package">jSDM-package</a></code> <code><a href="#topic+jSDM_binomial_probit">jSDM_binomial_probit</a></code> <br /> 
<code><a href="#topic+jSDM_binomial_logit">jSDM_binomial_logit</a></code>  <code><a href="#topic+jSDM_poisson_log">jSDM_poisson_log</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(jSDM)
# frogs data
 data(frogs, package="jSDM")
 # Arranging data
 PA_frogs &lt;- frogs[,4:12]
 # Normalized continuous variables
 Env_frogs &lt;- cbind(scale(frogs[,1]),frogs[,2],scale(frogs[,3]))
 colnames(Env_frogs) &lt;- colnames(frogs[,1:3])
 Env_frogs &lt;- as.data.frame(Env_frogs)
 # Parameter inference
# Increase the number of iterations to reach MCMC convergence
 mod &lt;- jSDM_binomial_probit(# Response variable
                             presence_data=PA_frogs,
                             # Explanatory variables
                             site_formula = ~.,
                             site_data = Env_frogs,
                             n_latent=2,
                             site_effect="random",
                             # Chains
                             burnin=100,
                             mcmc=100,
                             thin=1,
                             # Starting values
                             alpha_start=0,
                             beta_start=0,
                             lambda_start=0,
                             W_start=0,
                             V_alpha=1,
                             # Priors
                             shape=0.5, rate=0.0005,
                             mu_beta=0, V_beta=10,
                             mu_lambda=0, V_lambda=10,
                             # Various
                             seed=1234, verbose=1)
# Calcul of residual correlation between species 
result &lt;- get_residual_cor(mod, prob=0.95, type="mean")
# Residual variance-covariance matrix
result$cov.mean
## All non-significant co-variances are set to zero.
result$cov.mean * result$cov.sig
# Residual correlation matrix
result$cor.mean
## All non-significant correlations are set to zero.
result$cor.mean * result$cor.sig
</code></pre>

<hr>
<h2 id='inv_logit'>Generalized inverse logit function</h2><span id='topic+inv_logit'></span>

<h3>Description</h3>

<p>Compute generalized inverse logit function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>inv_logit(x, min = 0, max = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="inv_logit_+3A_x">x</code></td>
<td>
<p>value(s) to be transformed</p>
</td></tr>
<tr><td><code id="inv_logit_+3A_min">min</code></td>
<td>
<p>Lower end of logit interval</p>
</td></tr>
<tr><td><code id="inv_logit_+3A_max">max</code></td>
<td>
<p>Upper end of logit interval</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The generalized inverse logit function takes values on [-Inf,Inf] and transforms them to span [min, max] :
</p>
<p style="text-align: center;"><code class="reqn">y = p' (max-min) + min</code>
</p>
 
<p style="text-align: center;"><code class="reqn">where</code>
</p>

<p style="text-align: center;"><code class="reqn">p =\frac{exp(x)}{(1+exp(x))}</code>
</p>



<h3>Value</h3>

<p>y Transformed value(s).
</p>


<h3>Author(s)</h3>

<p>Gregory R. Warnes &lt;greg@warnes.net&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- seq(0,10, by=0.25)
xt &lt;- jSDM::logit(x, min=0, max=10)
cbind(x,xt)
y &lt;- jSDM::inv_logit(xt, min=0, max=10)
cbind(x,xt,y)  
</code></pre>

<hr>
<h2 id='jSDM_binomial_logit'>Binomial logistic regression</h2><span id='topic+jSDM_binomial_logit'></span>

<h3>Description</h3>

<p>The <code>jSDM_binomial_logit</code> function performs a Binomial logistic regression in a Bayesian framework. The function calls a Gibbs sampler written in 'C++' code which uses an adaptive Metropolis algorithm to estimate the conditional posterior distribution of model's parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>jSDM_binomial_logit(
  burnin = 5000,
  mcmc = 10000,
  thin = 10,
  presence_data,
  site_formula,
  trait_data = NULL,
  trait_formula = NULL,
  site_data,
  trials = NULL,
  n_latent = 0,
  site_effect = "none",
  beta_start = 0,
  gamma_start = 0,
  lambda_start = 0,
  W_start = 0,
  alpha_start = 0,
  V_alpha = 1,
  shape_Valpha = 0.5,
  rate_Valpha = 5e-04,
  mu_beta = 0,
  V_beta = 10,
  mu_gamma = 0,
  V_gamma = 10,
  mu_lambda = 0,
  V_lambda = 10,
  ropt = 0.44,
  seed = 1234,
  verbose = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="jSDM_binomial_logit_+3A_burnin">burnin</code></td>
<td>
<p>The number of burnin iterations for the sampler.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_mcmc">mcmc</code></td>
<td>
<p>The number of Gibbs iterations for the sampler. Total number of Gibbs iterations is equal to <code>burnin+mcmc</code>. <code>burnin+mcmc</code> must be divisible by 10 and superior or equal to 100 so that the progress bar can be displayed.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_thin">thin</code></td>
<td>
<p>The thinning interval used in the simulation. The number of mcmc iterations must be divisible by this value.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_presence_data">presence_data</code></td>
<td>
<p>A matrix <code class="reqn">n_{site} \times n_{species}</code> indicating the number of successes (or presences) and the absence by a zero for each species at the studied sites.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_site_formula">site_formula</code></td>
<td>
<p>A one-sided formula of the form '~x1+...+xp' specifying the explanatory variables for the suitability process of the model,
used to form the design matrix <code class="reqn">X</code> of size <code class="reqn">n_{site} \times np</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_trait_data">trait_data</code></td>
<td>
<p>A data frame containing the species traits which can be included as part of the model. Default to <code>NULL</code> to fit a model without species traits.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_trait_formula">trait_formula</code></td>
<td>
<p>A one-sided formula of the form '~ t1 + ... + tk + x1:t1 + ... + xp:tk' specifying the interactions between the environmental variables and the species traits to be considered in the model,
used to form the trait design matrix <code class="reqn">Tr</code> of size <code class="reqn">n_{species} \times nt</code> and to set to <code class="reqn">0</code> the <code class="reqn">\gamma</code> parameters corresponding to interactions not taken into account according to the formula. 
Default to <code>NULL</code> to fit a model with all possible interactions between species traits found in <code>trait_data</code> and environmental variables defined by <code>site_formula</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_site_data">site_data</code></td>
<td>
<p>A data frame containing the model's explanatory variables by site.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_trials">trials</code></td>
<td>
<p>A vector indicating the number of trials for each site. <code class="reqn">n_i</code> should be superior or equal to <code class="reqn">y_{ij}</code>, the number of successes for observation <code class="reqn">n</code>.
If <code class="reqn">n_i=0</code>, then <code class="reqn">y_{ij}=0</code>. The default is one visit by site.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_n_latent">n_latent</code></td>
<td>
<p>An integer which specifies the number of latent variables to generate. Defaults to <code class="reqn">0</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_site_effect">site_effect</code></td>
<td>
<p>A string indicating whether row effects are included as fixed effects (<code>"fixed"</code>), as random effects (<code>"random"</code>), or not included (<code>"none"</code>) in the model. 
If fixed effects, then for parameter identifiability the first row effect is set to zero, which analogous to acting as a reference level when dummy variables are used.
If random effects, they are drawn from a normal distribution with mean zero and unknown variance, analogous to a random intercept in mixed models. Defaults to <code>"none"</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_beta_start">beta_start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters of the suitability process for each species must be either a scalar or a <code class="reqn">np \times n_{species}</code> matrix. 
If <code>beta_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">\beta</code> parameters.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_gamma_start">gamma_start</code></td>
<td>
<p>Starting values for <code class="reqn">\gamma</code> parameters that represent the influence of species-specific traits on species' responses <code class="reqn">\beta</code>,
<code>gamma_start</code> must be either a scalar, a vector of length <code class="reqn">nt</code>, <code class="reqn">np</code> or <code class="reqn">nt.np</code> or a <code class="reqn">nt \times np</code> matrix.
If <code>gamma_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">\gamma</code> parameters.
If <code>gamma_start</code> is a vector of length <code class="reqn">nt</code> or <code class="reqn">nt.np</code> the resulting <code class="reqn">nt \times np</code> matrix is filled by column with specified values,
if a <code class="reqn">np</code>-length vector is given, the matrix is filled by row.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_lambda_start">lambda_start</code></td>
<td>
<p>Starting values for <code class="reqn">\lambda</code> parameters corresponding to the latent variables for each species must be either a scalar
or a <code class="reqn">n_{latent} \times n_{species}</code> upper triangular matrix with strictly positive values on the diagonal,
ignored if <code>n_latent=0</code>.
If <code>lambda_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">\lambda</code> parameters except those concerned by the constraints explained above.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_w_start">W_start</code></td>
<td>
<p>Starting values for latent variables must be either a scalar or a <code class="reqn">nsite \times n_latent</code> matrix, ignored if <code>n_latent=0</code>.
If <code>W_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">W_{il}</code> with <code class="reqn">i=1,\ldots,n_{site}</code> and <code class="reqn">l=1,\ldots,n_{latent}</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_alpha_start">alpha_start</code></td>
<td>
<p>Starting values for random site effect parameters must be either a scalar or a <code class="reqn">n_{site}</code>-length vector, ignored if <code>site_effect="none"</code>.
If <code>alpha_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">\alpha</code> parameters.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_v_alpha">V_alpha</code></td>
<td>
<p>Starting value for variance of random site effect if <code>site_effect="random"</code> or constant variance of the Gaussian prior distribution for the fixed site effect if 
<code>site_effect="fixed"</code>. Must be a strictly positive scalar, ignored if <code>site_effect="none"</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_shape_valpha">shape_Valpha</code></td>
<td>
<p>Shape parameter of the Inverse-Gamma prior for the random site effect variance <code>V_alpha</code>, ignored if <code>site_effect="none"</code> or <code>site_effect="fixed"</code>. 
Must be a strictly positive scalar. Default to 0.5 for weak informative prior.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_rate_valpha">rate_Valpha</code></td>
<td>
<p>Rate parameter of the Inverse-Gamma prior for the random site effect variance <code>V_alpha</code>, ignored if <code>site_effect="none"</code> or <code>site_effect="fixed"</code>
Must be a strictly positive scalar. Default to 0.0005 for weak informative prior.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_mu_beta">mu_beta</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\beta</code> parameters of the suitability process. <code>mu_beta</code> must be either a scalar or a <code class="reqn">np</code>-length vector.
If <code>mu_beta</code> takes a scalar value, then that value will serve as the prior mean for all of the <code class="reqn">\beta</code> parameters.
The default value is set to 0 for an uninformative prior, ignored if <code>trait_data</code> is specified.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_v_beta">V_beta</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\beta</code> parameters of the suitability process.
<code>V_beta</code> must be either a scalar or a <code class="reqn">np \times np</code> symmetric positive semi-definite square matrix.
If <code>V_beta</code> takes a scalar value, then that value will serve as the prior variance for all of the <code class="reqn">\beta</code> parameters,
so the variance covariance matrix used in this case is diagonal with the specified value on the diagonal. 
The default variance is large and set to 10 for an uninformative flat prior.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_mu_gamma">mu_gamma</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\gamma</code> parameters.
<code>mu_gamma</code> must be either a scalar, a vector of length <code class="reqn">nt</code>, <code class="reqn">np</code> or <code class="reqn">nt.np</code> or a <code class="reqn">nt \times np</code> matrix.
If <code>mu_gamma</code> takes a scalar value, then that value will serve as the prior mean for all of the <code class="reqn">\gamma</code> parameters.
If <code>mu_gamma</code> is a vector of length <code class="reqn">nt</code> or <code class="reqn">nt.np</code> the resulting <code class="reqn">nt \times np</code> matrix is filled by column with specified values,
if a <code class="reqn">np</code>-length vector is given, the matrix is filled by row. 
The default value is set to 0 for an uninformative prior, ignored if <code>trait_data=NULL</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_v_gamma">V_gamma</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\gamma</code> parameters.
<code>V_gamma</code> must be either a scalar, a vector of length <code class="reqn">nt</code>, <code class="reqn">np</code> or <code class="reqn">nt.np</code> or a <code class="reqn">nt \times np</code> positive matrix.
If <code>V_gamma</code> takes a scalar value, then that value will serve as the prior variance for all of the <code class="reqn">\gamma</code> parameters.
If <code>V_gamma</code> is a vector of length <code class="reqn">nt</code> or <code class="reqn">nt.np</code> the resulting <code class="reqn">nt \times np</code> matrix is filled by column with specified values,
if a <code class="reqn">np</code>-length vector is given, the matrix is filled by row. 
The default variance is large and set to 10 for an uninformative flat prior, ignored if <code>trait_data=NULL</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_mu_lambda">mu_lambda</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\lambda</code> parameters corresponding to the latent variables. 
<code>mu_lambda</code> must be either a scalar or a <code class="reqn">n_{latent}</code>-length vector. 
If <code>mu_lambda</code> takes a scalar value, then that value will serve as the prior mean for all of the <code class="reqn">\lambda</code> parameters.
The default value is set to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_v_lambda">V_lambda</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\lambda</code> parameters corresponding to the latent variables.
<code>V_lambda</code> must be either a scalar or a <code class="reqn">n_{latent} \times n_{latent}</code> symmetric positive semi-definite square matrix.
If <code>V_lambda</code> takes a scalar value, then that value will serve as the prior variance for all of <code class="reqn">\lambda</code> parameters,
so the variance covariance matrix used in this case is diagonal with the specified value on the diagonal.
The default variance is large and set to 10 for an uninformative flat prior.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_ropt">ropt</code></td>
<td>
<p>Target acceptance rate for the adaptive Metropolis algorithm. Default to 0.44.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_seed">seed</code></td>
<td>
<p>The seed for the random number generator. Default to 1234.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_logit_+3A_verbose">verbose</code></td>
<td>
<p>A switch (0,1) which determines whether or not the progress of the sampler is printed to the screen. Default is 1: a progress bar is printed, indicating the step (in %) reached by the Gibbs sampler.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We model an ecological process where the presence or absence of species <code class="reqn">j</code> on site <code class="reqn">i</code> is explained by habitat suitability.
</p>
<p><b>Ecological process : </b>
</p>
<p style="text-align: center;"><code class="reqn">y_{ij} \sim \mathcal{B}inomial(\theta_{ij},n_i)</code>
</p>

<p>where </p>

<table>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="none"</code> </td><td style="text-align: left;"> logit<code class="reqn">(\theta_{ij}) =  X_i \beta_j</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="none"</code> </td><td style="text-align: left;"> logit<code class="reqn">(\theta_{ij}) =  X_i \beta_j + W_i \lambda_j</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="fixed"</code> </td><td style="text-align: left;"> logit<code class="reqn">(\theta_{ij}) =  X_i \beta_j  + \alpha_i</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="fixed"</code> </td><td style="text-align: left;"> logit<code class="reqn">(\theta_{ij}) =  X_i \beta_j + W_i \lambda_j + \alpha_i</code>  </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="random"</code> </td><td style="text-align: left;"> logit<code class="reqn">(\theta_{ij}) =  X_i \beta_j  + \alpha_i</code> and <code class="reqn">\alpha_i \sim \mathcal{N}(0,V_\alpha)</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="random"</code> </td><td style="text-align: left;"> logit<code class="reqn">(\theta_{ij}) =  X_i \beta_j + W_i \lambda_j + \alpha_i</code> and <code class="reqn">\alpha_i \sim \mathcal{N}(0,V_\alpha)</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>In the absence of data on species traits (<code>trait_data=NULL</code>), the effect of species <code class="reqn">j</code>: <code class="reqn">\beta_j</code>;
follows the same <em>a priori</em> Gaussian distribution such that <code class="reqn">\beta_j \sim \mathcal{N}_{np}(\mu_{\beta},V_{\beta})</code>,
for each species. 
</p>
<p>If species traits data are provided, the effect of species <code class="reqn">j</code>: <code class="reqn">\beta_j</code>;
follows an <em>a priori</em> Gaussian distribution such that <code class="reqn">\beta_j \sim \mathcal{N}_{np}(\mu_{\beta_j},V_{\beta})</code>,
where <code class="reqn">\mu_{\beta_jp} = \sum_{k=1}^{nt} t_{jk}.\gamma_{kp}</code>, takes different values for each species.
</p>
<p>We assume that <code class="reqn">\gamma_{kp} \sim \mathcal{N}(\mu_{\gamma_{kp}},V_{\gamma_{kp}})</code> as prior distribution.   
</p>
<p>We define the matrix <code class="reqn">\gamma=(\gamma_{kp})_{k=1,...,nt}^{p=1,...,np}</code> such as : 
</p>

<table>
<tr>
 <td style="text-align: right;">
</td><td style="text-align: center;"> <strong><code class="reqn">x_0</code></strong> </td><td style="text-align: center;"> <strong><code class="reqn">x_1</code></strong> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <strong><code class="reqn">x_p</code></strong> </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> <strong><code class="reqn">x_{np}</code></strong> </td><td style="text-align: left;">  </td>
</tr>
<tr>
 <td style="text-align: right;"> 
</td><td style="text-align: center;">__________</td><td style="text-align: center;">________</td><td style="text-align: center;">________</td><td style="text-align: center;">________</td><td style="text-align: center;">________</td><td style="text-align: center;">________</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
<strong><code class="reqn">t_0</code></strong> | </td><td style="text-align: center;">  <strong><code class="reqn">\gamma_{0,0}</code></strong> </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{0,1}</code></em> </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{0,p}</code></em> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{0,np}</code></em> </td><td style="text-align: left;"> { <em>effect of </em> </td>
</tr>
<tr>
 <td style="text-align: right;">
  | </td><td style="text-align: center;"> <strong>intercept</strong> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: left;"> <em>environmental</em> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
  | </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: left;"> <em>   variables</em> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
  <strong><code class="reqn">t_1</code></strong> | </td><td style="text-align: center;">  <code class="reqn">\gamma_{1,0}</code> </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{1,1}</code></em> </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{1,p}</code></em> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{1,np}</code></em> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;">
  ... | </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
  <strong><code class="reqn">t_k</code></strong> | </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{k,0}</code></em> </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{k,1}</code></em> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <code class="reqn">\gamma_{k,p}</code> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <code class="reqn">\gamma_{k,np}</code> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;">
  ... | </td><td style="text-align: center;"> ... </td><td style="text-align: center;">  ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
  <strong><code class="reqn">t_{nt}</code></strong> | </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{nt,0}</code></em> </td><td style="text-align: center;"> <code class="reqn">\gamma_{nt,1}</code></td><td style="text-align: center;"> ... </td><td style="text-align: center;"> <code class="reqn">\gamma_{nt,p}</code> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <code class="reqn">\gamma_{nt,np}</code> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;">
  </td><td style="text-align: center;"> <em>average</em> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
  </td><td style="text-align: center;"> <em>trait effect</em> </td><td style="text-align: center;"> </td><td style="text-align: center;"> interaction </td><td style="text-align: center;"> traits </td><td style="text-align: center;"> environment </td><td style="text-align: center;"> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
</td>
</tr>

</table>



<h3>Value</h3>

<p>An object of class <code>"jSDM"</code> acting like a list including :
</p>
<table>
<tr><td><code>mcmc.alpha</code></td>
<td>
<p>An mcmc object that contains the posterior samples for site effects <code class="reqn">\alpha_i</code>, not returned if <code>site_effect="none"</code>.</p>
</td></tr>
<tr><td><code>mcmc.V_alpha</code></td>
<td>
<p>An mcmc object that contains the posterior samples for variance of random site effect, not returned if <code>site_effect="none"</code> or  <code>site_effect="fixed"</code>.</p>
</td></tr>
<tr><td><code>mcmc.latent</code></td>
<td>
<p>A list by latent variable of mcmc objects that contains the posterior samples for latent variables <code class="reqn">W_l</code> with <code class="reqn">l=1,\ldots,n_{latent}</code>, not returned if <code>n_latent=0</code>.</p>
</td></tr>
<tr><td><code>mcmc.sp</code></td>
<td>
<p>A list by species of mcmc objects that contains the posterior samples for species effects <code class="reqn">\beta_j</code> and <code class="reqn">\lambda_j</code> if <code>n_latent&gt;0</code>.</p>
</td></tr>
<tr><td><code>mcmc.gamma</code></td>
<td>
<p>A list by covariates of mcmc objects that contains the posterior samples for <code class="reqn">\gamma_p</code> parameters with <code class="reqn">p=1,\ldots,np</code> if <code>trait_data</code> is specified.</p>
</td></tr>
<tr><td><code>mcmc.Deviance</code></td>
<td>
<p>The posterior sample of the deviance (<code class="reqn">D</code>) is also provided, with <code class="reqn">D</code> defined as : <code class="reqn">D=-2\log(\prod_{ij} P(y_{ij}|\beta_j,\lambda_j, \alpha_i, W_i))</code>.</p>
</td></tr> 
<tr><td><code>logit_theta_latent</code></td>
<td>
<p>Predictive posterior mean of the probability to each species to be present on each site, transformed by logit link function.</p>
</td></tr>
<tr><td><code>theta_latent</code></td>
<td>
<p>Predictive posterior mean of the probability associated to the suitability process for each observation.</p>
</td></tr>
<tr><td><code>model_spec</code></td>
<td>
<p>Various attributes of the model fitted, including the response and model matrix used, distributional assumptions as link function, family and number of latent variables, hyperparameters used in the Bayesian estimation and mcmc, burnin and thin.</p>
</td></tr>
</table>
<p>The <code>mcmc.</code> objects can be summarized by functions provided by the <code>coda</code> package.
</p>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent &lt;ghislain.vieilledent@cirad.fr&gt;
</p>
<p>Jeanne Clément &lt;jeanne.clement16@laposte.net&gt;
</p>


<h3>References</h3>

<p>Gelfand, A. E.; Schmidt, A. M.; Wu, S.; Silander, J. A.; Latimer, A. and Rebelo, A. G. (2005) Modelling species diversity through species level hierarchical modelling. <em>Applied Statistics</em>, 54, 1-20.
</p>
<p>Latimer, A. M.; Wu, S. S.; Gelfand, A. E. and Silander, J. A. (2006) Building statistical models to analyze species distributions. <em>Ecological Applications</em>, 16, 33-50.
</p>
<p>Ovaskainen, O., Tikhonov, G., Norberg, A., Blanchet, F. G., Duan, L., Dunson, D., Roslin, T. and Abrego, N. (2017) How to make more out of community data? A conceptual framework and its implementation as models and software. <em>Ecology Letters</em>, 20, 561-576.
</p>


<h3>See Also</h3>

<p><code><a href="coda.html#topic+plot.mcmc">plot.mcmc</a></code>, <code><a href="coda.html#topic+summary.mcmc">summary.mcmc</a></code> <code><a href="#topic+jSDM_binomial_probit">jSDM_binomial_probit</a></code>  <code><a href="#topic+jSDM_poisson_log">jSDM_poisson_log</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#==============================================
# jSDM_binomial_logit()
# Example with simulated data
#==============================================

#=================
#== Load libraries
library(jSDM)

#==================
#== Data simulation

#= Number of sites
nsite &lt;- 50
#= Number of species
nsp &lt;- 10
#= Set seed for repeatability
seed &lt;- 1234

#= Number of visits associated to each site
set.seed(seed)
visits &lt;- rpois(nsite,3)
visits[visits==0] &lt;- 1

#= Ecological process (suitability)
x1 &lt;- rnorm(nsite,0,1)
set.seed(2*seed)
x2 &lt;- rnorm(nsite,0,1)
X &lt;- cbind(rep(1,nsite),x1,x2)
np &lt;- ncol(X)
set.seed(3*seed)
W &lt;- cbind(rnorm(nsite,0,1),rnorm(nsite,0,1))
n_latent &lt;- ncol(W)
l.zero &lt;- 0
l.diag &lt;- runif(2,0,2)
l.other &lt;- runif(nsp*2-3,-2,2)
lambda.target &lt;- matrix(c(l.diag[1],l.zero,l.other[1],
                          l.diag[2],l.other[-1]),
                        byrow=TRUE, nrow=nsp)
beta.target &lt;- matrix(runif(nsp*np,-2,2), byrow=TRUE, nrow=nsp)
V_alpha.target &lt;- 0.5
alpha.target &lt;- rnorm(nsite,0,sqrt(V_alpha.target))
logit.theta &lt;- X %*% t(beta.target) + W %*% t(lambda.target) + alpha.target
theta &lt;- inv_logit(logit.theta)
set.seed(seed)
Y &lt;- apply(theta, 2, rbinom, n=nsite, size=visits)

#= Site-occupancy model
# Increase number of iterations (burnin and mcmc) to get convergence
mod &lt;- jSDM_binomial_logit(# Chains
  burnin=150,
  mcmc=150,
  thin=1,
  # Response variable
  presence_data=Y,
  trials=visits,
  # Explanatory variables
  site_formula=~x1+x2,
  site_data=X,
  n_latent=n_latent,
  site_effect="random",
  # Starting values
  beta_start=0,
  lambda_start=0,
  W_start=0,
  alpha_start=0,
  V_alpha=1,
  # Priors
  shape_Valpha=0.5,
  rate_Valpha=0.0005,
  mu_beta=0,
  V_beta=10,
  mu_lambda=0,
  V_lambda=10,
  # Various
  seed=1234,
  ropt=0.44,
  verbose=1)
#==========
#== Outputs

#= Parameter estimates
oldpar &lt;- par(no.readonly = TRUE)
## beta_j
# summary(mod$mcmc.sp$sp_1[,1:ncol(X)])
mean_beta &lt;- matrix(0,nsp,np)
pdf(file=file.path(tempdir(), "Posteriors_beta_jSDM_logit.pdf"))
par(mfrow=c(ncol(X),2))
for (j in 1:nsp) {
  mean_beta[j,] &lt;- apply(mod$mcmc.sp[[j]][,1:ncol(X)],
                         2, mean)
  for (p in 1:ncol(X)) {
    coda::traceplot(mod$mcmc.sp[[j]][,p])
    coda::densplot(mod$mcmc.sp[[j]][,p],
      main = paste(colnames(
        mod$mcmc.sp[[j]])[p],
        ", species : ",j))
    abline(v=beta.target[j,p],col='red')
  }
}
dev.off()

## lambda_j
mean_lambda &lt;- matrix(0,nsp,n_latent)
pdf(file=file.path(tempdir(), "Posteriors_lambda_jSDM_logit.pdf"))
par(mfrow=c(n_latent*2,2))
for (j in 1:nsp) {
  mean_lambda[j,] &lt;- apply(mod$mcmc.sp[[j]]
                           [,(ncol(X)+1):(ncol(X)+n_latent)], 2, mean)
  for (l in 1:n_latent) {
    coda::traceplot(mod$mcmc.sp[[j]][,ncol(X)+l])
    coda::densplot(mod$mcmc.sp[[j]][,ncol(X)+l],
                   main=paste(colnames(mod$mcmc.sp[[j]])
                              [ncol(X)+l],", species : ",j))
    abline(v=lambda.target[j,l],col='red')
  }
}
dev.off()

# Species effects beta and factor loadings lambda
par(mfrow=c(1,2))
plot(beta.target, mean_beta,
     main="species effect beta",
     xlab ="obs", ylab ="fitted")
abline(a=0,b=1,col='red')
plot(lambda.target, mean_lambda,
     main="factor loadings lambda",
     xlab ="obs", ylab ="fitted")
abline(a=0,b=1,col='red')

## W latent variables
par(mfrow=c(1,2))
for (l in 1:n_latent) {
  plot(W[,l],
       summary(mod$mcmc.latent[[paste0("lv_",l)]])[[1]][,"Mean"],
       main = paste0("Latent variable W_", l),
       xlab ="obs", ylab ="fitted")
  abline(a=0,b=1,col='red')
}

## alpha
par(mfrow=c(1,3))
plot(alpha.target, summary(mod$mcmc.alpha)[[1]][,"Mean"],
     xlab ="obs", ylab ="fitted", main="site effect alpha")
abline(a=0,b=1,col='red')
## Valpha
coda::traceplot(mod$mcmc.V_alpha)
coda::densplot(mod$mcmc.V_alpha)
abline(v=V_alpha.target,col='red')

## Deviance
summary(mod$mcmc.Deviance)
plot(mod$mcmc.Deviance)

#= Predictions
par(mfrow=c(1,2))
plot(logit.theta, mod$logit_theta_latent,
     main="logit(theta)",
     xlab="obs", ylab="fitted")
abline(a=0 ,b=1, col="red")
plot(theta, mod$theta_latent,
     main="Probabilities of occurence theta",
     xlab="obs", ylab="fitted")
abline(a=0 ,b=1, col="red")
par(oldpar)
</code></pre>

<hr>
<h2 id='jSDM_binomial_probit'>Binomial probit regression</h2><span id='topic+jSDM_binomial_probit'></span>

<h3>Description</h3>

<p>The <code>jSDM_binomial_probit</code> function performs a Binomial probit regression in a Bayesian framework. 
The function calls a Gibbs sampler written in 'C++' code which uses conjugate priors to estimate the conditional posterior distribution of model's parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>jSDM_binomial_probit(
  burnin = 5000,
  mcmc = 10000,
  thin = 10,
  presence_data,
  site_formula,
  trait_data = NULL,
  trait_formula = NULL,
  site_data,
  n_latent = 0,
  site_effect = "none",
  lambda_start = 0,
  W_start = 0,
  beta_start = 0,
  alpha_start = 0,
  gamma_start = 0,
  V_alpha = 1,
  mu_beta = 0,
  V_beta = 10,
  mu_lambda = 0,
  V_lambda = 10,
  mu_gamma = 0,
  V_gamma = 10,
  shape_Valpha = 0.5,
  rate_Valpha = 5e-04,
  seed = 1234,
  verbose = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="jSDM_binomial_probit_+3A_burnin">burnin</code></td>
<td>
<p>The number of burnin iterations for the sampler.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_mcmc">mcmc</code></td>
<td>
<p>The number of Gibbs iterations for the sampler. Total number of Gibbs iterations is equal to <code>burnin+mcmc</code>.
<code>burnin+mcmc</code> must be divisible by 10 and superior or equal to 100 so that the progress bar can be displayed.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_thin">thin</code></td>
<td>
<p>The thinning interval used in the simulation. The number of mcmc iterations must be divisible by this value.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_presence_data">presence_data</code></td>
<td>
<p>A matrix <code class="reqn">n_{site} \times n_{species}</code> indicating the presence by a 1 (or the absence by a 0) of each species on each site.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_site_formula">site_formula</code></td>
<td>
<p>A one-sided formula of the form '~x1+...+xp' specifying the explanatory variables for the suitability process of the model,
used to form the design matrix <code class="reqn">X</code> of size <code class="reqn">n_{site} \times np</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_trait_data">trait_data</code></td>
<td>
<p>A data frame containing the species traits which can be included as part of the model. Default to <code>NULL</code> to fit a model without species traits.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_trait_formula">trait_formula</code></td>
<td>
<p>A one-sided formula of the form '~ t1 + ... + tk + x1:t1 + ... + xp:tk' specifying the interactions between the environmental variables and the species traits to be considered in the model,
used to form the trait design matrix <code class="reqn">Tr</code> of size <code class="reqn">n_{species} \times nt</code> and to set to <code class="reqn">0</code> the <code class="reqn">\gamma</code> parameters corresponding to interactions not taken into account according to the formula. 
Default to <code>NULL</code> to fit a model with all possible interactions between species traits found in <code>trait_data</code> and environmental variables defined by <code>site_formula</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_site_data">site_data</code></td>
<td>
<p>A data frame containing the model's explanatory variables by site.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_n_latent">n_latent</code></td>
<td>
<p>An integer which specifies the number of latent variables to generate. Defaults to <code class="reqn">0</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_site_effect">site_effect</code></td>
<td>
<p>A string indicating whether row effects are included as fixed effects (<code>"fixed"</code>), as random effects (<code>"random"</code>), or not included (<code>"none"</code>) in the model. 
If fixed effects, then for parameter identifiability the first row effect is set to zero, which analogous to acting as a reference level when dummy variables are used.
If random effects, they are drawn from a normal distribution with mean zero and unknown variance, analogous to a random intercept in mixed models. Defaults to <code>"none"</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_lambda_start">lambda_start</code></td>
<td>
<p>Starting values for <code class="reqn">\lambda</code> parameters corresponding to the latent variables for each species must be either a scalar
or a <code class="reqn">n_{latent} \times n_{species}</code> upper triangular matrix with strictly positive values on the diagonal,
ignored if <code>n_latent=0</code>.
If <code>lambda_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">\lambda</code> parameters except those concerned by the constraints explained above.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_w_start">W_start</code></td>
<td>
<p>Starting values for latent variables must be either a scalar or a <code class="reqn">nsite \times n_latent</code> matrix, ignored if <code>n_latent=0</code>.
If <code>W_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">W_{il}</code> with <code class="reqn">i=1,\ldots,n_{site}</code> and <code class="reqn">l=1,\ldots,n_{latent}</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_beta_start">beta_start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters of the suitability process for each species must be either a scalar or a <code class="reqn">np \times n_{species}</code> matrix.
If <code>beta_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">\beta</code> parameters.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_alpha_start">alpha_start</code></td>
<td>
<p>Starting values for random site effect parameters must be either a scalar or a <code class="reqn">n_{site}</code>-length vector, ignored if <code>site_effect="none"</code>.
If <code>alpha_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">\alpha</code> parameters.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_gamma_start">gamma_start</code></td>
<td>
<p>Starting values for <code class="reqn">\gamma</code> parameters that represent the influence of species-specific traits on species' responses <code class="reqn">\beta</code>,
<code>gamma_start</code> must be either a scalar, a vector of length <code class="reqn">nt</code>, <code class="reqn">np</code> or <code class="reqn">nt.np</code> or a <code class="reqn">nt \times np</code> matrix.
If <code>gamma_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">\gamma</code> parameters.
If <code>gamma_start</code> is a vector of length <code class="reqn">nt</code> or <code class="reqn">nt.np</code> the resulting <code class="reqn">nt \times np</code> matrix is filled by column with specified values,
if a <code class="reqn">np</code>-length vector is given, the matrix is filled by row.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_v_alpha">V_alpha</code></td>
<td>
<p>Starting value for variance of random site effect if <code>site_effect="random"</code> or constant variance of the Gaussian prior distribution for the fixed site effect if 
<code>site_effect="fixed"</code>. Must be a strictly positive scalar, ignored if <code>site_effect="none"</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_mu_beta">mu_beta</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\beta</code> parameters of the suitability process. <code>mu_beta</code> must be either a scalar or a <code class="reqn">np</code>-length vector.
If <code>mu_beta</code> takes a scalar value, then that value will serve as the prior mean for all of the <code class="reqn">\beta</code> parameters.
The default value is set to 0 for an uninformative prior, ignored if <code>trait_data</code> is specified.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_v_beta">V_beta</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\beta</code> parameters of the suitability process.
<code>V_beta</code> must be either a scalar or a <code class="reqn">np \times np</code> symmetric positive semi-definite square matrix.
If <code>V_beta</code> takes a scalar value, then that value will serve as the prior variance for all of the <code class="reqn">\beta</code> parameters,
so the variance covariance matrix used in this case is diagonal with the specified value on the diagonal. 
The default variance is large and set to 10 for an uninformative flat prior.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_mu_lambda">mu_lambda</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\lambda</code> parameters corresponding to the latent variables. 
<code>mu_lambda</code> must be either a scalar or a <code class="reqn">n_{latent}</code>-length vector. 
If <code>mu_lambda</code> takes a scalar value, then that value will serve as the prior mean for all of the <code class="reqn">\lambda</code> parameters.
The default value is set to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_v_lambda">V_lambda</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\lambda</code> parameters corresponding to the latent variables.
<code>V_lambda</code> must be either a scalar or a <code class="reqn">n_{latent} \times n_{latent}</code> symmetric positive semi-definite square matrix.
If <code>V_lambda</code> takes a scalar value, then that value will serve as the prior variance for all of <code class="reqn">\lambda</code> parameters,
so the variance covariance matrix used in this case is diagonal with the specified value on the diagonal.
The default variance is large and set to 10 for an uninformative flat prior.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_mu_gamma">mu_gamma</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\gamma</code> parameters.
<code>mu_gamma</code> must be either a scalar, a vector of length <code class="reqn">nt</code>, <code class="reqn">np</code> or <code class="reqn">nt.np</code> or a <code class="reqn">nt \times np</code> matrix.
If <code>mu_gamma</code> takes a scalar value, then that value will serve as the prior mean for all of the <code class="reqn">\gamma</code> parameters.
If <code>mu_gamma</code> is a vector of length <code class="reqn">nt</code> or <code class="reqn">nt.np</code> the resulting <code class="reqn">nt \times np</code> matrix is filled by column with specified values,
if a <code class="reqn">np</code>-length vector is given, the matrix is filled by row. 
The default value is set to 0 for an uninformative prior, ignored if <code>trait_data=NULL</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_v_gamma">V_gamma</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\gamma</code> parameters.
<code>V_gamma</code> must be either a scalar, a vector of length <code class="reqn">nt</code>, <code class="reqn">np</code> or <code class="reqn">nt.np</code> or a <code class="reqn">nt \times np</code> positive matrix.
If <code>V_gamma</code> takes a scalar value, then that value will serve as the prior variance for all of the <code class="reqn">\gamma</code> parameters.
If <code>V_gamma</code> is a vector of length <code class="reqn">nt</code> or <code class="reqn">nt.np</code> the resulting <code class="reqn">nt \times np</code> matrix is filled by column with specified values,
if a <code class="reqn">np</code>-length vector is given, the matrix is filled by row. 
The default variance is large and set to 10 for an uninformative flat prior, ignored if <code>trait_data=NULL</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_shape_valpha">shape_Valpha</code></td>
<td>
<p>Shape parameter of the Inverse-Gamma prior for the random site effect variance <code>V_alpha</code>, ignored if <code>site_effect="none"</code> or <code>site_effect="fixed"</code>. 
Must be a strictly positive scalar. Default to 0.5 for weak informative prior.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_rate_valpha">rate_Valpha</code></td>
<td>
<p>Rate parameter of the Inverse-Gamma prior for the random site effect variance <code>V_alpha</code>, ignored if <code>site_effect="none"</code> or <code>site_effect="fixed"</code>
Must be a strictly positive scalar. Default to 0.0005 for weak informative prior.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_seed">seed</code></td>
<td>
<p>The seed for the random number generator. Default to 1234.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_+3A_verbose">verbose</code></td>
<td>
<p>A switch (0,1) which determines whether or not the progress of the sampler is printed to the screen.
Default is 1: a progress bar is printed, indicating the step (in %) reached by the Gibbs sampler.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We model an ecological process where the presence or absence of species <code class="reqn">j</code> on site <code class="reqn">i</code> is explained by habitat suitability.
</p>
<p><b>Ecological process:</b>
</p>
<p style="text-align: center;"><code class="reqn">y_{ij} \sim \mathcal{B}ernoulli(\theta_{ij})</code>
</p>

<p>where </p>

<table>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="none"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_{ij}) =  X_i \beta_j</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="none"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_{ij}) =  X_i \beta_j + W_i \lambda_j</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="random"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_{ij}) =  X_i \beta_j  + \alpha_i</code>  and <code class="reqn">\alpha_i \sim \mathcal{N}(0,V_\alpha)</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="fixed"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_{ij}) =  X_i \beta_j + W_i \lambda_j + \alpha_i</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="fixed"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_{ij}) =  X_i \beta_j  + \alpha_i</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="random"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_{ij}) =  X_i \beta_j + W_i \lambda_j + \alpha_i</code> and <code class="reqn">\alpha_i \sim \mathcal{N}(0,V_\alpha)</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>In the absence of data on species traits (<code>trait_data=NULL</code>), the effect of species <code class="reqn">j</code>: <code class="reqn">\beta_j</code>;
follows the same <em>a priori</em> Gaussian distribution such that <code class="reqn">\beta_j \sim \mathcal{N}_{np}(\mu_{\beta},V_{\beta})</code>,
for each species. 
</p>
<p>If species traits data are provided, the effect of species <code class="reqn">j</code>: <code class="reqn">\beta_j</code>;
follows an <em>a priori</em> Gaussian distribution such that <code class="reqn">\beta_j \sim \mathcal{N}_{np}(\mu_{\beta_j},V_{\beta})</code>,
where <code class="reqn">\mu_{\beta_jp} = \sum_{k=1}^{nt} t_{jk}.\gamma_{kp}</code>, takes different values for each species.
</p>
<p>We assume that <code class="reqn">\gamma_{kp} \sim \mathcal{N}(\mu_{\gamma_{kp}},V_{\gamma_{kp}})</code> as prior distribution.   
</p>
<p>We define the matrix <code class="reqn">\gamma=(\gamma_{kp})_{k=1,...,nt}^{p=1,...,np}</code> such as : 
</p>

<table>
<tr>
 <td style="text-align: right;">
</td><td style="text-align: center;"> <strong><code class="reqn">x_0</code></strong> </td><td style="text-align: center;"> <strong><code class="reqn">x_1</code></strong> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <strong><code class="reqn">x_p</code></strong> </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> <strong><code class="reqn">x_{np}</code></strong> </td><td style="text-align: left;">  </td>
</tr>
<tr>
 <td style="text-align: right;"> 
</td><td style="text-align: center;">__________</td><td style="text-align: center;">________</td><td style="text-align: center;">________</td><td style="text-align: center;">________</td><td style="text-align: center;">________</td><td style="text-align: center;">________</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
<strong><code class="reqn">t_0</code></strong> | </td><td style="text-align: center;">  <strong><code class="reqn">\gamma_{0,0}</code></strong> </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{0,1}</code></em> </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{0,p}</code></em> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{0,np}</code></em> </td><td style="text-align: left;"> { <em>effect of </em> </td>
</tr>
<tr>
 <td style="text-align: right;">
  | </td><td style="text-align: center;"> <strong>intercept</strong> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: left;"> <em>environmental</em> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
  | </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: left;"> <em>variables</em> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
  <strong><code class="reqn">t_1</code></strong> | </td><td style="text-align: center;">  <code class="reqn">\gamma_{1,0}</code> </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{1,1}</code></em> </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{1,p}</code></em> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{1,np}</code></em> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;">
  ... | </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
  <strong><code class="reqn">t_k</code></strong> | </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{k,0}</code></em> </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{k,1}</code></em> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <code class="reqn">\gamma_{k,p}</code> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <code class="reqn">\gamma_{k,np}</code> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;">
  ... | </td><td style="text-align: center;"> ... </td><td style="text-align: center;">  ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
  <strong><code class="reqn">t_{nt}</code></strong> | </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{nt,0}</code></em> </td><td style="text-align: center;"> <code class="reqn">\gamma_{nt,1}</code></td><td style="text-align: center;"> ... </td><td style="text-align: center;"> <code class="reqn">\gamma_{nt,p}</code> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <code class="reqn">\gamma_{nt,np}</code> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;">
  </td><td style="text-align: center;"> <em>average</em> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
  </td><td style="text-align: center;"> <em>trait effect</em> </td><td style="text-align: center;"> </td><td style="text-align: center;"> interaction </td><td style="text-align: center;"> traits </td><td style="text-align: center;"> environment </td><td style="text-align: center;"> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
</td>
</tr>

</table>



<h3>Value</h3>

<p>An object of class <code>"jSDM"</code> acting like a list including : 
</p>
<table>
<tr><td><code>mcmc.alpha</code></td>
<td>
<p>An mcmc object that contains the posterior samples for site effects <code class="reqn">\alpha</code>, not returned if <code>site_effect="none"</code>.</p>
</td></tr>
<tr><td><code>mcmc.V_alpha</code></td>
<td>
<p>An mcmc object that contains the posterior samples for variance of random site effect, not returned if <code>site_effect="none"</code> or <code>site_effect="fixed"</code>.</p>
</td></tr>
<tr><td><code>mcmc.latent</code></td>
<td>
<p>A list by latent variable of mcmc objects that contains the posterior samples for latent variables <code class="reqn">W_l</code> with <code class="reqn">l=1,\ldots,n_{latent}</code>, not returned if <code>n_latent=0</code>.</p>
</td></tr>
<tr><td><code>mcmc.sp</code></td>
<td>
<p>A list by species of mcmc objects that contains the posterior samples for species effects <code class="reqn">\beta_j</code> and <code class="reqn">\lambda_j</code> if <code>n_latent&gt;0</code> with <code class="reqn">j=1,\ldots,n_{species}</code>.</p>
</td></tr>
<tr><td><code>mcmc.gamma</code></td>
<td>
<p>A list by covariates of mcmc objects that contains the posterior samples for <code class="reqn">\gamma_p</code> parameters with <code class="reqn">p=1,\ldots,np</code> if <code>trait_data</code> is specified.</p>
</td></tr>
<tr><td><code>mcmc.Deviance</code></td>
<td>
<p>The posterior sample of the deviance (<code class="reqn">D</code>) is also provided, with <code class="reqn">D</code> defined as : <code class="reqn">D=-2\log(\prod_{ij} P(y_{ij}|\beta_j,\lambda_j, \alpha_i, W_i))</code>.</p>
</td></tr> 
<tr><td><code>Z_latent</code></td>
<td>
<p>Predictive posterior mean of the latent variable Z. </p>
</td></tr>
<tr><td><code>probit_theta_latent</code></td>
<td>
<p>Predictive posterior mean of the probability to each species to be present on each site, transformed by probit link function.</p>
</td></tr>
<tr><td><code>theta_latent</code></td>
<td>
<p>Predictive posterior mean of the probability to each species to be present on each site.</p>
</td></tr>
<tr><td><code>model_spec</code></td>
<td>
<p>Various attributes of the model fitted, including the response and model matrix used, distributional assumptions as link function, family and number of latent variables, hyperparameters used in the Bayesian estimation and mcmc, burnin and thin.</p>
</td></tr>
</table>
<p>The <code>mcmc.</code> objects can be summarized by functions provided by the <code>coda</code> package.
</p>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent &lt;ghislain.vieilledent@cirad.fr&gt; 
</p>
<p>Jeanne Clément &lt;jeanne.clement16@laposte.net&gt;
</p>


<h3>References</h3>

<p>Chib, S. and Greenberg, E. (1998) Analysis of multivariate probit models. <em>Biometrika</em>, 85, 347-361. 
</p>
<p>Warton, D. I.; Blanchet, F. G.; O'Hara, R. B.; O'Hara, R. B.; Ovaskainen, O.; Taskinen, S.; Walker, S. C. and Hui, F. K. C. (2015) So Many Variables: Joint Modeling in Community Ecology. <em>Trends in Ecology &amp; Evolution</em>, 30, 766-779.
</p>
<p>Ovaskainen, O., Tikhonov, G., Norberg, A., Blanchet, F. G., Duan, L., Dunson, D., Roslin, T. and Abrego, N. (2017) How to make more out of community data? A conceptual framework and its implementation as models and software. <em>Ecology Letters</em>, 20, 561-576.
</p>


<h3>See Also</h3>

<p><code><a href="coda.html#topic+plot.mcmc">plot.mcmc</a></code>, <code><a href="coda.html#topic+summary.mcmc">summary.mcmc</a></code> <code><a href="#topic+jSDM_binomial_logit">jSDM_binomial_logit</a></code> <code><a href="#topic+jSDM_poisson_log">jSDM_poisson_log</a></code> 
<code><a href="#topic+jSDM_binomial_probit_sp_constrained">jSDM_binomial_probit_sp_constrained</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#======================================
# jSDM_binomial_probit()
# Example with simulated data
#====================================

#=================
#== Load libraries
library(jSDM)

#==================
#' #== Data simulation

#= Number of sites
nsite &lt;- 150

#= Set seed for repeatability
seed &lt;- 1234
set.seed(seed)

#= Number of species
nsp&lt;- 20

#= Number of latent variables
n_latent &lt;- 2

#= Ecological process (suitability)
x1 &lt;- rnorm(nsite,0,1)
x2 &lt;- rnorm(nsite,0,1)
X &lt;- cbind(rep(1,nsite),x1,x2)
np &lt;- ncol(X)
#= Latent variables W
W &lt;- matrix(rnorm(nsite*n_latent,0,1), nsite, n_latent)
#= Fixed species effect beta 
beta.target &lt;- t(matrix(runif(nsp*np,-2,2),
                        byrow=TRUE, nrow=nsp))
#= Factor loading lambda  
lambda.target &lt;- matrix(0, n_latent, nsp)
mat &lt;- t(matrix(runif(nsp*n_latent, -2, 2), byrow=TRUE, nrow=nsp))
lambda.target[upper.tri(mat, diag=TRUE)] &lt;- mat[upper.tri(mat, diag=TRUE)]
diag(lambda.target) &lt;- runif(n_latent, 0, 2)
#= Variance of random site effect 
V_alpha.target &lt;- 0.5
#= Random site effect alpha
alpha.target &lt;- rnorm(nsite,0 , sqrt(V_alpha.target))
# Simulation of response data with probit link
probit_theta &lt;- X%*%beta.target + W%*%lambda.target + alpha.target
theta &lt;- pnorm(probit_theta)
e &lt;- matrix(rnorm(nsp*nsite,0,1),nsite,nsp)
# Latent variable Z 
Z_true &lt;- probit_theta + e
# Presence-absence matrix Y
Y &lt;- matrix (NA, nsite,nsp)
for (i in 1:nsite){
  for (j in 1:nsp){
    if ( Z_true[i,j] &gt; 0) {Y[i,j] &lt;- 1}
    else {Y[i,j] &lt;- 0}
  }
}

#==================================
#== Site-occupancy model

# Increase number of iterations (burnin and mcmc) to get convergence
mod&lt;-jSDM_binomial_probit(# Iteration
                           burnin=200,
                           mcmc=200,
                           thin=1,
                           # Response variable
                           presence_data=Y,
                           # Explanatory variables
                           site_formula=~x1+x2,
                           site_data = X,
                           n_latent=2,
                           site_effect="random",
                           # Starting values
                           alpha_start=0,
                           beta_start=0,
                           lambda_start=0,
                           W_start=0,
                           V_alpha=1,
                           # Priors
                           shape_Valpha=0.5,
                           rate_Valpha=0.0005,
                           mu_beta=0, V_beta=1,
                           mu_lambda=0, V_lambda=1,
                           seed=1234, verbose=1)
# ===================================================
# Result analysis
# ===================================================

#==========
#== Outputs

oldpar &lt;- par(no.readonly = TRUE) 

#= Parameter estimates

## beta_j
mean_beta &lt;- matrix(0,nsp,ncol(X))
pdf(file=file.path(tempdir(), "Posteriors_beta_jSDM_probit.pdf"))
par(mfrow=c(ncol(X),2))
for (j in 1:nsp) {
  mean_beta[j,] &lt;- apply(mod$mcmc.sp[[j]]
                         [,1:ncol(X)], 2, mean)  
  for (p in 1:ncol(X)){
    coda::traceplot(mod$mcmc.sp[[j]][,p])
    coda::densplot(mod$mcmc.sp[[j]][,p],
      main = paste(colnames(mod$mcmc.sp[[j]])[p],", species : ",j))
    abline(v=beta.target[p,j],col='red')
  }
}
dev.off()

## lambda_j
mean_lambda &lt;- matrix(0,nsp,n_latent)
pdf(file=file.path(tempdir(), "Posteriors_lambda_jSDM_probit.pdf"))
par(mfrow=c(n_latent*2,2))
for (j in 1:nsp) {
  mean_lambda[j,] &lt;- apply(mod$mcmc.sp[[j]]
                           [,(ncol(X)+1):(ncol(X)+n_latent)], 2, mean)  
  for (l in 1:n_latent) {
    coda::traceplot(mod$mcmc.sp[[j]][,ncol(X)+l])
    coda::densplot(mod$mcmc.sp[[j]][,ncol(X)+l],
                   main=paste(colnames(mod$mcmc.sp[[j]])
                              [ncol(X)+l],", species : ",j))
    abline(v=lambda.target[l,j],col='red')
  }
}
dev.off()

# Species effects beta and factor loadings lambda
par(mfrow=c(1,2))
plot(t(beta.target), mean_beta,
     main="species effect beta",
     xlab ="obs", ylab ="fitted")
abline(a=0,b=1,col='red')
plot(t(lambda.target), mean_lambda,
     main="factor loadings lambda",
     xlab ="obs", ylab ="fitted")
abline(a=0,b=1,col='red')

## W latent variables
par(mfrow=c(1,2))
for (l in 1:n_latent) {
  plot(W[,l],
       summary(mod$mcmc.latent[[paste0("lv_",l)]])[[1]][,"Mean"],
       main = paste0("Latent variable W_", l),
       xlab ="obs", ylab ="fitted")
  abline(a=0,b=1,col='red')
}

## alpha
par(mfrow=c(1,3))
plot(alpha.target, summary(mod$mcmc.alpha)[[1]][,"Mean"],
     xlab ="obs", ylab ="fitted", main="site effect alpha")
abline(a=0,b=1,col='red')
## Valpha
coda::traceplot(mod$mcmc.V_alpha)
coda::densplot(mod$mcmc.V_alpha)
abline(v=V_alpha.target,col='red')

## Deviance
summary(mod$mcmc.Deviance)
plot(mod$mcmc.Deviance)

#= Predictions

## Z
par(mfrow=c(1,2))
plot(Z_true,mod$Z_latent,
     main="Z_latent", xlab="obs", ylab="fitted")
abline(a=0,b=1,col='red')

## probit_theta
plot(probit_theta,mod$probit_theta_latent,
     main="probit(theta)",xlab="obs",ylab="fitted")
abline(a=0,b=1,col='red')

## probabilities theta
par(mfrow=c(1,1))
plot(theta,mod$theta_latent,
     main="theta",xlab="obs",ylab="fitted")
abline(a=0,b=1,col='red')

par(oldpar)

</code></pre>

<hr>
<h2 id='jSDM_binomial_probit_long_format'>Binomial probit regression on long format data</h2><span id='topic+jSDM_binomial_probit_long_format'></span>

<h3>Description</h3>

<p>The <code>jSDM_binomial_probit_long_format</code> function performs a Binomial probit regression in a Bayesian framework. 
The function calls a Gibbs sampler written in 'C++' code which uses conjugate priors to estimate the conditional posterior distribution of model's parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>jSDM_binomial_probit_long_format(
  burnin = 5000,
  mcmc = 10000,
  thin = 10,
  data,
  site_formula,
  n_latent = 0,
  site_effect = "none",
  alpha_start = 0,
  gamma_start = 0,
  beta_start = 0,
  lambda_start = 0,
  W_start = 0,
  V_alpha = 1,
  shape_Valpha = 0.5,
  rate_Valpha = 5e-04,
  mu_gamma = 0,
  V_gamma = 10,
  mu_beta = 0,
  V_beta = 10,
  mu_lambda = 0,
  V_lambda = 10,
  seed = 1234,
  verbose = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="jSDM_binomial_probit_long_format_+3A_burnin">burnin</code></td>
<td>
<p>The number of burnin iterations for the sampler.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_long_format_+3A_mcmc">mcmc</code></td>
<td>
<p>The number of Gibbs iterations for the sampler. Total number of Gibbs iterations is equal to <code>burnin+mcmc</code>.<code>burnin+mcmc</code> must be divisible by 10 and superior or equal to 100 so that the progress bar can be displayed.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_long_format_+3A_thin">thin</code></td>
<td>
<p>The thinning interval used in the simulation. The number of mcmc iterations must be divisible by this value.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_long_format_+3A_data">data</code></td>
<td>
<p>A <code>data.frame</code> with at least the following columns : </p>

<table>
<tr>
 <td style="text-align: left;">
<code>Y</code> </td><td style="text-align: left;"> <code class="reqn">n_{obs}</code>-length vector indicating the presence by a 1 (or absence by a 0), </td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> of the species observed during each visit of the sites.</td>
</tr>
<tr>
 <td style="text-align: left;"> 
<code>site</code> </td><td style="text-align: left;"> numeric or character <code class="reqn">n_{obs}</code>-length vector indicating the visited site, </td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;">  (sites can be visited several times).</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>species</code> </td><td style="text-align: left;"> numeric or character eqnn_obsn_obs-length vector indicating the species observed, </td>
</tr>
<tr>
 <td style="text-align: left;"> 
</td><td style="text-align: left;"> (species may not have been recorded at all sites).</td>
</tr>
<tr>
 <td style="text-align: left;"> 
<code>x1,...,xp</code> </td><td style="text-align: left;"> columns of explanatory variables for the suitability process of the model.</td>
</tr>

</table>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_long_format_+3A_site_formula">site_formula</code></td>
<td>
<p>A one-sided formula, as the formulas used by the <code><a href="stats.html#topic+lm">lm</a></code> function, of the form: '~ x1 + ... + xd + species:x1 + ... + species:xp' with <code class="reqn">p</code> terms related to species effects <code class="reqn">\beta</code>,
specifying the explanatory variables for the suitability process of the model, including the intercept, different from the <code class="reqn">d</code> terms related to <code class="reqn">\gamma</code> parameters.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_long_format_+3A_n_latent">n_latent</code></td>
<td>
<p>An integer which specifies the number of latent variables to generate. Defaults to <code class="reqn">0</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_long_format_+3A_site_effect">site_effect</code></td>
<td>
<p>A string indicating whether row effects are included as fixed effects (<code>"fixed"</code>), as random effects (<code>"random"</code>), or not included (<code>"none"</code>) in the model. 
If fixed effects, then for parameter identifiability the first row effect is set to zero, which analogous to acting as a reference level when dummy variables are used.
If random effects, they are drawn from a normal distribution with mean zero and unknown variance, analogous to a random intercept in mixed models. Defaults to <code>"none"</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_long_format_+3A_alpha_start">alpha_start</code></td>
<td>
<p>Starting values for random site effect parameters must be either a scalar or a <code class="reqn">n_{site}</code>-length vector, ignored if <code>site_effect="none"</code>.
If <code>alpha_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">\alpha</code> parameters.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_long_format_+3A_gamma_start">gamma_start</code></td>
<td>
<p>Starting values for gamma parameters of the suitability process must be either a scalar or a <code class="reqn">d</code>-length vector. If <code>gamma_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">\gamma</code> parameters.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_long_format_+3A_beta_start">beta_start</code></td>
<td>
<p>Starting values for beta parameters of the suitability process for each species must be either a scalar or a <code class="reqn">p \times n_{species}</code> matrix. If <code>beta_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">\beta</code> parameters.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_long_format_+3A_lambda_start">lambda_start</code></td>
<td>
<p>Starting values for lambda parameters corresponding to the latent variables for each species must be either a scalar or a <code class="reqn">n_{latent} \times n_{species}</code> upper triangular matrix with strictly positive values on the diagonal, ignored if <code>n_latent=0</code>.
If <code>lambda_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">\lambda</code> parameters except those concerned by the constraints explained above.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_long_format_+3A_w_start">W_start</code></td>
<td>
<p>Starting values for latent variables must be either a scalar or a <code class="reqn">nsite \times n_latent</code> matrix, ignored if <code>n_latent=0</code>.
If <code>W_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">W_{il}</code> with <code class="reqn">i=1,\ldots,n_{site}</code> and <code class="reqn">l=1,\ldots,n_{latent}</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_long_format_+3A_v_alpha">V_alpha</code></td>
<td>
<p>Starting value for variance of random site effect if <code>site_effect="random"</code>  or constant variance of the Gaussian prior distribution for the fixed site effect if
<code>site_effect="fixed"</code>. Must be a strictly positive scalar, ignored if <code>site_effect="none"</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_long_format_+3A_shape_valpha">shape_Valpha</code></td>
<td>
<p>Shape parameter of the Inverse-Gamma prior for the random site effect variance <code>V_alpha</code>, ignored if <code>site_effect="none"</code> or <code>site_effect="fixed"</code>. 
Must be a strictly positive scalar. Default to 0.5 for weak informative prior.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_long_format_+3A_rate_valpha">rate_Valpha</code></td>
<td>
<p>Rate parameter of the Inverse-Gamma prior for the random site effect variance <code>V_alpha</code>, ignored if <code>site_effect="none"</code> or <code>site_effect="fixed"</code>
Must be a strictly positive scalar. Default to 0.0005 for weak informative prior.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_long_format_+3A_mu_gamma">mu_gamma</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\gamma</code> parameters of the suitability process. <code>mu_gamma</code> must be either a scalar or a <code class="reqn">d</code>-length vector.
If <code>mu_gamma</code> takes a scalar value, then that value will serve as the prior mean for all of the <code class="reqn">\gamma</code> parameters. The default value is set to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_long_format_+3A_v_gamma">V_gamma</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\gamma</code> parameters of the suitability process. <code>V_gamma</code> must be either a scalar or a <code class="reqn">d \times d</code> symmetric positive semi-definite square matrix.
If <code>V_gamma</code> takes a scalar value, then that value will serve as the prior variance for all of the <code class="reqn">\gamma</code> parameters, so the variance covariance matrix used in this case is diagonal with the specified value on the diagonal. 
The default variance is large and set to <code>1e+06</code> for an uninformative flat prior.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_long_format_+3A_mu_beta">mu_beta</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\beta</code> parameters of the suitability process. <code>mu_beta</code> must be either a scalar or a <code class="reqn">p</code>-length vector.
If <code>mu_beta</code> takes a scalar value, then that value will serve as the prior mean for all of the <code class="reqn">\beta</code> parameters. The default value is set to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_long_format_+3A_v_beta">V_beta</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\beta</code> parameters of the suitability process. <code>V_beta</code> must be either a scalar or a <code class="reqn">p \times p</code> symmetric positive semi-definite square matrix.
If <code>V_beta</code> takes a scalar value, then that value will serve as the prior variance for all of the <code class="reqn">\beta</code> parameters, so the variance covariance matrix used in this case is diagonal with the specified value on the diagonal. 
The default variance is large and set to <code>1e+06</code> for an uninformative flat prior.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_long_format_+3A_mu_lambda">mu_lambda</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\lambda</code> parameters corresponding to the latent variables. 
<code>mu_lambda</code> must be either a scalar or a <code class="reqn">n_{latent}</code>-length vector. 
If <code>mu_lambda</code> takes a scalar value, then that value will serve as the prior mean for all of the <code class="reqn">\lambda</code> parameters. The default value is set to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_long_format_+3A_v_lambda">V_lambda</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\lambda</code> parameters corresponding to the latent variables. <code>V_lambda</code> must be either a scalar or a <code class="reqn">n_{latent} \times n_{latent}</code> symmetric positive semi-definite square matrix.
If <code>V_lambda</code> takes a scalar value, then that value will serve as the prior variance for all of <code class="reqn">\lambda</code> parameters, so the variance covariance matrix used in this case is diagonal with the specified value on the diagonal.
The default variance is large and set to 10 for an uninformative flat prior.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_long_format_+3A_seed">seed</code></td>
<td>
<p>The seed for the random number generator. Default to 1234.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_long_format_+3A_verbose">verbose</code></td>
<td>
<p>A switch (0,1) which determines whether or not the progress of the sampler is printed to the screen. Default is 1: a progress bar is printed, indicating the step (in %) reached by the Gibbs sampler.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We model an ecological process where the presence or absence of species <code class="reqn">j</code> on site <code class="reqn">i</code> is explained by habitat suitability.
</p>
<p><b>Ecological process:</b>
</p>
<p style="text-align: center;"><code class="reqn">y_n \sim \mathcal{B}ernoulli(\theta_n)</code>
</p>
<p> such as <code class="reqn">species_n=j</code> and <code class="reqn">site_n=i</code>,
where :
</p>

<table>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="none"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_n) = D_n \gamma + X_n \beta_j</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="none"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_n) = D_n \gamma+ X_n \beta_j + W_i \lambda_j</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="fixed"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_n) = D_n \gamma + X_n \beta_j  + \alpha_i</code>  and <code class="reqn">\alpha_i \sim \mathcal{N}(0,V_\alpha)</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="fixed"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_n) = D_n \gamma + X_n \beta_j + W_i \lambda_j + \alpha_i</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="random"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_n) = D_n \gamma  + X_n \beta_j  + \alpha_i</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="random"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_n) = D_n \gamma + X_n \beta_j + W_i \lambda_j + \alpha_i</code> and <code class="reqn">\alpha_i \sim \mathcal{N}(0,V_\alpha)</code> 
</td>
</tr>

</table>



<h3>Value</h3>

<p>An object of class <code>"jSDM"</code> acting like a list including :
</p>
<table>
<tr><td><code>mcmc.alpha</code></td>
<td>
<p>An mcmc object that contains the posterior samples for site effects <code class="reqn">\alpha_i</code>, not returned if <code>site_effect="none"</code>.</p>
</td></tr>
<tr><td><code>mcmc.V_alpha</code></td>
<td>
<p>An mcmc object that contains the posterior samples for variance of random site effect, not returned if <code>site_effect="none"</code> or <code>site_effect="fixed"</code>.</p>
</td></tr>
<tr><td><code>mcmc.latent</code></td>
<td>
<p>A list by latent variable of mcmc objects that contains the posterior samples for latent variables  <code class="reqn">W_l</code> with <code class="reqn">l=1,\ldots,n_{latent}</code>, not returned if <code>n_latent=0</code>.</p>
</td></tr>
<tr><td><code>mcmc.sp</code></td>
<td>
<p>A list by species of mcmc objects that contains the posterior samples for species effects <code class="reqn">\beta</code> and the loading factors <code class="reqn">\lambda</code> if <code>n_latent&gt;0</code>.</p>
</td></tr>
<tr><td><code>mcmc.gamma</code></td>
<td>
<p>An mcmc objects that contains the posterior samples for parameters <code class="reqn">\gamma</code> not returned if <code>d=0</code>.</p>
</td></tr>
<tr><td><code>mcmc.Deviance</code></td>
<td>
<p>The posterior sample of the deviance <code class="reqn">D</code> is also provided, with <code class="reqn">D</code> defined as:<code class="reqn">D=-2\log(\prod_{n} P(y_{n}|\beta_j,\lambda_j, \alpha_i, W_i))</code>.</p>
</td></tr> 
<tr><td><code>Z_latent</code></td>
<td>
<p>Predictive posterior mean of the latent variable Z. </p>
</td></tr>
<tr><td><code>probit_theta_latent</code></td>
<td>
<p>Predictive posterior mean of the probability to each species to be present on each site, transformed by probit link function.</p>
</td></tr>
<tr><td><code>theta_latent</code></td>
<td>
<p>Predictive posterior mean of the probability to each species to be present on each site.</p>
</td></tr>
<tr><td><code>model_spec</code></td>
<td>
<p>Various attributes of the model fitted, including the response and model matrix used, distributional assumptions as link function, family and number of latent variables, hyperparameters used in the Bayesian estimation and mcmc, burnin and thin.</p>
</td></tr>
</table>
<p>The <code>mcmc.</code> objects can be summarized by functions provided by the <code>coda</code> package.
</p>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent &lt;ghislain.vieilledent@cirad.fr&gt; 
</p>
<p>Jeanne Clément &lt;jeanne.clement16@laposte.net&gt;
</p>


<h3>References</h3>

<p>Chib, S. and Greenberg, E. (1998) Analysis of multivariate probit models. <em>Biometrika</em>, 85, 347-361. 
</p>
<p>Warton, D. I.; Blanchet, F. G.; O'Hara, R. B.; O'Hara, R. B.; Ovaskainen, O.; Taskinen, S.; Walker, S. C. and Hui, F. K. C. (2015) So Many Variables: Joint Modeling in Community Ecology. <em>Trends in Ecology &amp; Evolution</em>, 30, 766-779.
</p>


<h3>See Also</h3>

<p><code><a href="coda.html#topic+plot.mcmc">plot.mcmc</a></code>, <code><a href="coda.html#topic+summary.mcmc">summary.mcmc</a></code> <code><a href="#topic+jSDM_binomial_probit">jSDM_binomial_probit</a></code>
<code><a href="#topic+jSDM_binomial_logit">jSDM_binomial_logit</a></code> <code><a href="#topic+jSDM_poisson_log">jSDM_poisson_log</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#==============================================
# jSDM_binomial_probit_long_format()
# Example with simulated data
#==============================================

#=================
#== Load libraries
library(jSDM)

#==================
#== Data simulation

#= Number of sites
nsite &lt;- 50

#= Set seed for repeatability
seed &lt;- 1234
set.seed(seed)

#' #= Number of species
nsp &lt;- 25

#= Number of latent variables
n_latent &lt;- 2
#'
# Ecological process (suitability)
## X
x1 &lt;- rnorm(nsite,0,1)
x1.2 &lt;- scale(x1^2)
X &lt;- cbind(rep(1,nsite),x1,x1.2)
colnames(X) &lt;- c("Int","x1","x1.2")
np &lt;- ncol(X)
## W
W &lt;- matrix(rnorm(nsite*n_latent,0,1),nrow=nsite,byrow=TRUE)
## D
SLA &lt;- runif(nsp,-1,1)
D &lt;- data.frame(x1.SLA= scale(c(x1 %*% t(SLA))))
nd &lt;- ncol(D)
## parameters
beta.target &lt;- t(matrix(runif(nsp*np,-2,2), byrow=TRUE, nrow=nsp))
mat &lt;- t(matrix(runif(nsp*n_latent,-2,2), byrow=TRUE, nrow=nsp))
diag(mat) &lt;- runif(n_latent,0,2)
lambda.target &lt;- matrix(0,n_latent,nsp)
gamma.target &lt;-runif(nd,-1,1)
lambda.target[upper.tri(mat,diag=TRUE)] &lt;- mat[upper.tri(mat,
                                                         diag=TRUE)]
#= Variance of random site effect 
V_alpha.target &lt;- 0.5
#= Random site effect 
alpha.target &lt;- rnorm(nsite,0,sqrt(V_alpha.target))
## probit_theta
probit_theta &lt;- c(X %*% beta.target) + c(W %*% lambda.target) +
                as.matrix(D) %*% gamma.target + rep(alpha.target, nsp)
# Supplementary observation (each site have been visited twice)
# Environmental variables at the time of the second visit
x1_supObs &lt;- rnorm(nsite,0,1)
x1.2_supObs &lt;- scale(x1^2)
X_supObs &lt;- cbind(rep(1,nsite),x1_supObs,x1.2_supObs)
D_supObs &lt;- data.frame(x1.SLA=scale(c(x1_supObs %*% t(SLA))))
probit_theta_supObs &lt;- c(X_supObs%*%beta.target) + c(W%*%lambda.target) + 
                       as.matrix(D_supObs) %*% gamma.target + alpha.target
probit_theta &lt;- c(probit_theta, probit_theta_supObs)
nobs &lt;- length(probit_theta)
e &lt;- rnorm(nobs,0,1)
Z_true &lt;- probit_theta + e
Y&lt;-rep(0,nobs)
for (n in 1:nobs){
  if ( Z_true[n] &gt; 0) {Y[n] &lt;- 1}
}
Id_site &lt;- rep(1:nsite,nsp)
Id_sp &lt;- rep(1:nsp,each=nsite)
data &lt;- data.frame(site=rep(Id_site,2), species=rep(Id_sp,2), Y=Y,
                   x1=c(rep(x1,nsp),rep(x1_supObs,nsp)),
                   x1.2=c(rep(x1.2,nsp),rep(x1.2_supObs,nsp)),
                   x1.SLA=c(D$x1.SLA,D_supObs$x1.SLA))
# missing observation
data &lt;- data[-1,]

#==================================
#== Site-occupancy model

# Increase number of iterations (burnin and mcmc) to get convergence
mod&lt;-jSDM_binomial_probit_long_format( # Iteration
  burnin=500,
  mcmc=500,
  thin=1,
  # Response variable
  data=data,
  # Explanatory variables
  site_formula=~ (x1 + x1.2):species + x1.SLA,
  n_latent=2,
  site_effect="random",
  # Starting values
  alpha_start=0,
  gamma_start=0,
  beta_start=0,
  lambda_start=0,
  W_start=0,
  V_alpha=1,
  # Priors
  shape_Valpha=0.5, rate_Valpha=0.0005,
  mu_gamma=0, V_gamma=10,
  mu_beta=0, V_beta=10,
  mu_lambda=0, V_lambda=10,
  seed=1234, verbose=1)

#= Parameter estimates
oldpar &lt;- par(no.readonly = TRUE) 
# gamma 
par(mfrow=c(2,2))
for(d in 1:nd){
 coda::traceplot(mod$mcmc.gamma[,d])
 coda::densplot(mod$mcmc.gamma[,d],
                main = colnames(mod$mcmc.gamma)[d])
 abline(v=gamma.target[d],col='red')
}
## beta_j
mean_beta &lt;- matrix(0,nsp,ncol(X))
pdf(file=file.path(tempdir(), "Posteriors_beta_jSDM_probit.pdf"))
par(mfrow=c(ncol(X),2))
for (j in 1:nsp) {
  mean_beta[j,] &lt;- apply(mod$mcmc.sp[[j]]
                         [,1:ncol(X)], 2, mean)
  for (p in 1:ncol(X)){
    coda::traceplot(mod$mcmc.sp[[j]][,p])
    coda::densplot(mod$mcmc.sp[[j]][,p],
      main = paste0(colnames(mod$mcmc.sp[[j]])[p],"_sp",j))
    abline(v=beta.target[p,j],col='red')
  }
}
dev.off()

## lambda_j
mean_lambda &lt;- matrix(0,nsp,n_latent)
pdf(file=file.path(tempdir(), "Posteriors_lambda_jSDM_probit.pdf"))
par(mfrow=c(n_latent*2,2))
for (j in 1:nsp) {
  mean_lambda[j,] &lt;- apply(mod$mcmc.sp[[j]]
                           [,(ncol(X)+1):(ncol(X)+n_latent)], 2, mean)
  for (l in 1:n_latent) {
    coda::traceplot(mod$mcmc.sp[[j]][,ncol(X)+l])
    coda::densplot(mod$mcmc.sp[[j]][,ncol(X)+l],
                   main=paste0(colnames(mod$mcmc.sp[[j]])[ncol(X)+l], "_sp",j))
    abline(v=lambda.target[l,j],col='red')
  }
}
dev.off()

# Species effects beta and factor loadings lambda
par(mfrow=c(1,2))
plot(t(beta.target), mean_beta,
     main="species effect beta",
     xlab ="obs", ylab ="fitted")
abline(a=0,b=1,col='red')
plot(t(lambda.target), mean_lambda,
     main="factor loadings lambda",
     xlab ="obs", ylab ="fitted")
abline(a=0,b=1,col='red')

## W latent variables
par(mfrow=c(1,2))
for (l in 1:n_latent) {
  plot(W[,l],
       summary(mod$mcmc.latent[[paste0("lv_",l)]])[[1]][,"Mean"],
       main = paste0("Latent variable W_", l),
       xlab ="obs", ylab ="fitted")
  abline(a=0,b=1,col='red')
}

## alpha
par(mfrow=c(1,3))
plot(alpha.target, summary(mod$mcmc.alpha)[[1]][,"Mean"],
     xlab ="obs", ylab ="fitted", main="site effect alpha")
abline(a=0,b=1,col='red')
## Valpha
coda::traceplot(mod$mcmc.V_alpha, main="Trace V_alpha")
coda::densplot(mod$mcmc.V_alpha,main="Density V_alpha")
abline(v=V_alpha.target,col='red')

## Deviance
summary(mod$mcmc.Deviance)
plot(mod$mcmc.Deviance)

#= Predictions

## probit_theta
par(mfrow=c(1,2))
plot(probit_theta[-1],mod$probit_theta_latent,
     main="probit(theta)",xlab="obs",ylab="fitted")
abline(a=0,b=1,col='red')

## Z
plot(Z_true[-1],mod$Z_latent,
     main="Z_latent", xlab="obs", ylab="fitted")
abline(a=0,b=1,col='red')

## theta
par(mfrow=c(1,1))
plot(pnorm(probit_theta[-1]),mod$theta_latent,
     main="theta",xlab="obs",ylab="fitted")
abline(a=0,b=1,col='red')
par(oldpar)

</code></pre>

<hr>
<h2 id='jSDM_binomial_probit_sp_constrained'>Binomial probit regression with selected constrained species</h2><span id='topic+jSDM_binomial_probit_sp_constrained'></span>

<h3>Description</h3>

<p>The <code>jSDM_binomial_probit_sp_constrained</code> function performs in parallel Binomial probit regressions in a Bayesian framework. The function calls a Gibbs sampler written in 'C++' code which uses conjugate priors to estimate the conditional posterior distribution of model's parameters. Then the function evaluates the convergence of MCMC <code class="reqn">\lambda</code> chains using the Gelman-Rubin convergence diagnostic (<code class="reqn">\hat{R}</code>). <code class="reqn">\hat{R}</code> is computed using the <code><a href="coda.html#topic+gelman.diag">gelman.diag</a></code> function. We identify the species (<code class="reqn">\hat{j}_l</code>) having the higher <code class="reqn">\hat{R}</code> for <code class="reqn">\lambda_{\hat{j}_l}</code>. These species drive the structure of the latent axis <code class="reqn">l</code>. The <code class="reqn">\lambda</code> corresponding to this species are constrained to be positive and placed on the diagonal of the <code class="reqn">\Lambda</code> matrix for fitting a second model. This usually improves the convergence of the latent variables and factor loadings. The function returns the parameter posterior distributions for this second model.
</p>


<h3>Arguments</h3>

<table>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_burnin">burnin</code></td>
<td>
<p>The number of burn-in iterations for the sampler.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_mcmc">mcmc</code></td>
<td>
<p>The number of Gibbs iterations for the sampler. Total number of Gibbs iterations is equal to <code>burnin+mcmc</code> for each chain.
<code>burnin+mcmc</code> must be divisible by 10 and superior or equal to 100 so that the progress bar can be displayed.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_thin">thin</code></td>
<td>
<p>The thinning interval used in the simulation. The number of MCMC iterations must be divisible by this value.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_nchains">nchains</code></td>
<td>
<p>The number of Monte Carlo Markov Chains (MCMCs) simulated in parallel. If not specified, the number of chains is set to 2.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_ncores">ncores</code></td>
<td>
<p>The number of cores to use for parallel execution. If not specified, the number of cores is set to 2.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_presence_data">presence_data</code></td>
<td>
<p>A matrix <code class="reqn">n_{site} \times n_{species}</code> indicating the presence by a 1 (or the absence by a 0) of each species on each site.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_site_formula">site_formula</code></td>
<td>
<p>A one-sided formula of the form '~x1+...+xp' specifying the explanatory variables for the suitability process of the model,
used to form the design matrix <code class="reqn">X</code> of size <code class="reqn">n_{site} \times np</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_site_data">site_data</code></td>
<td>
<p>A data frame containing the model's explanatory variables by site.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_trait_data">trait_data</code></td>
<td>
<p>A data frame containing the species traits which can be included as part of the model. Default to <code>NULL</code> to fit a model without species traits.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_trait_formula">trait_formula</code></td>
<td>
<p>A one-sided formula of the form '~ t1 + ... + tk + x1:t1 + ... + xp:tk' specifying the interactions between the environmental variables and the species traits to be considered in the model,
used to form the trait design matrix <code class="reqn">Tr</code> of size <code class="reqn">n_{species} \times nt</code> and to set to <code class="reqn">0</code> the <code class="reqn">\gamma</code> parameters corresponding to interactions not taken into account according to the formula. 
Default to <code>NULL</code> to fit a model with all possible interactions between species traits found in <code>trait_data</code> and environmental variables defined by <code>site_formula</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_n_latent">n_latent</code></td>
<td>
<p>An integer which specifies the number of latent variables to generate. Defaults to <code class="reqn">0</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_site_effect">site_effect</code></td>
<td>
<p>A string indicating whether row effects are included as fixed effects (<code>"fixed"</code>), as random effects (<code>"random"</code>), or not included (<code>"none"</code>) in the model. 
If fixed effects, then for parameter identifiability the first row effect is set to zero, which analogous to acting as a reference level when dummy variables are used.
If random effects, they are drawn from a normal distribution with mean zero and unknown variance, analogous to a random intercept in mixed models. Defaults to <code>"none"</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_beta_start">beta_start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters of the suitability process for each species must be either a scalar or a <code class="reqn">np \times n_{species}</code> matrix.
If <code>beta_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">\beta</code> parameters. 
Different starting values for each chain can be specified by a list or a vector of length <code>nchains</code>, by default the same starting values are considered for all chains.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_gamma_start">gamma_start</code></td>
<td>
<p>Starting values for <code class="reqn">\gamma</code> parameters that represent the influence of species-specific traits on species' responses <code class="reqn">\beta</code>,
<code>gamma_start</code> must be either a scalar, a vector of length <code class="reqn">nt</code>, <code class="reqn">np</code> or <code class="reqn">nt.np</code> or a <code class="reqn">nt \times np</code> matrix.
If <code>gamma_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">\gamma</code> parameters.
If <code>gamma_start</code> is a vector of length <code class="reqn">nt</code> or <code class="reqn">nt.np</code> the resulting <code class="reqn">nt \times np</code> matrix is filled by column with specified values,
if a <code class="reqn">np</code>-length vector is given, the matrix is filled by row. 
Different starting values for each chain can be specified by a list or a vector of length <code>nchains</code>, by default the same starting values are considered for all chains.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_lambda_start">lambda_start</code></td>
<td>
<p>Starting values for <code class="reqn">\lambda</code> parameters corresponding to the latent variables for each species must be either a scalar
or a <code class="reqn">n_{latent} \times n_{species}</code> upper triangular matrix with strictly positive values on the diagonal,
ignored if <code>n_latent=0</code>.
If <code>lambda_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">\lambda</code> parameters except those concerned by the constraints explained above.
Different starting values for each chain can be specified by a list or a vector of length <code>nchains</code>, by default the same starting values are considered for all chains.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_w_start">W_start</code></td>
<td>
<p>Starting values for latent variables must be either a scalar or a <code class="reqn">nsite \times n_latent</code> matrix, ignored if <code>n_latent=0</code>.
If <code>W_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">W_{il}</code> with <code class="reqn">i=1,\ldots,n_{site}</code> and <code class="reqn">l=1,\ldots,n_{latent}</code>.
Different starting values for each chain can be specified by a list or a vector of length <code>nchains</code>, by default the same starting values are considered for all chains.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_alpha_start">alpha_start</code></td>
<td>
<p>Starting values for random site effect parameters must be either a scalar or a <code class="reqn">n_{site}</code>-length vector, ignored if <code>site_effect="none"</code>.
If <code>alpha_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">\alpha</code> parameters.
Different starting values for each chain can be specified by a list or a vector of length <code>nchains</code>, by default the same starting values are considered for all chains.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_v_alpha">V_alpha</code></td>
<td>
<p>Starting value for variance of random site effect if <code>site_effect="random"</code> or constant variance of the Gaussian prior distribution for the fixed site effect if 
<code>site_effect="fixed"</code>. Must be a strictly positive scalar, ignored if <code>site_effect="none"</code>.
Different starting values for each chain can be specified by a list or a vector of length <code>nchains</code>, by default the same starting values are considered for all chains.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_shape_valpha">shape_Valpha</code></td>
<td>
<p>Shape parameter of the Inverse-Gamma prior for the random site effect variance <code>V_alpha</code>, ignored if <code>site_effect="none"</code> or <code>site_effect="fixed"</code>. 
Must be a strictly positive scalar. Default to 0.5 for weak informative prior.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_rate_valpha">rate_Valpha</code></td>
<td>
<p>Rate parameter of the Inverse-Gamma prior for the random site effect variance <code>V_alpha</code>, ignored if <code>site_effect="none"</code> or <code>site_effect="fixed"</code>
Must be a strictly positive scalar. Default to 0.0005 for weak informative prior.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_mu_beta">mu_beta</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\beta</code> parameters of the suitability process. <code>mu_beta</code> must be either a scalar or a <code class="reqn">np</code>-length vector.
If <code>mu_beta</code> takes a scalar value, then that value will serve as the prior mean for all of the <code class="reqn">\beta</code> parameters.
The default value is set to 0 for an uninformative prior, ignored if <code>trait_data</code> is specified.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_v_beta">V_beta</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\beta</code> parameters of the suitability process.
<code>V_beta</code> must be either a scalar or a <code class="reqn">np \times np</code> symmetric positive semi-definite square matrix.
If <code>V_beta</code> takes a scalar value, then that value will serve as the prior variance for all of the <code class="reqn">\beta</code> parameters,
so the variance covariance matrix used in this case is diagonal with the specified value on the diagonal. 
The default variance is large and set to 10 for an uninformative flat prior.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_mu_gamma">mu_gamma</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\gamma</code> parameters.
<code>mu_gamma</code> must be either a scalar, a vector of length <code class="reqn">nt</code>, <code class="reqn">np</code> or <code class="reqn">nt.np</code> or a <code class="reqn">nt \times np</code> matrix.
If <code>mu_gamma</code> takes a scalar value, then that value will serve as the prior mean for all of the <code class="reqn">\gamma</code> parameters.
If <code>mu_gamma</code> is a vector of length <code class="reqn">nt</code> or <code class="reqn">nt.np</code> the resulting <code class="reqn">nt \times np</code> matrix is filled by column with specified values,
if a <code class="reqn">np</code>-length vector is given, the matrix is filled by row. 
The default value is set to 0 for an uninformative prior, ignored if <code>trait_data=NULL</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_v_gamma">V_gamma</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\gamma</code> parameters.
<code>V_gamma</code> must be either a scalar, a vector of length <code class="reqn">nt</code>, <code class="reqn">np</code> or <code class="reqn">nt.np</code> or a <code class="reqn">nt \times np</code> positive matrix.
If <code>V_gamma</code> takes a scalar value, then that value will serve as the prior variance for all of the <code class="reqn">\gamma</code> parameters.
If <code>V_gamma</code> is a vector of length <code class="reqn">nt</code> or <code class="reqn">nt.np</code> the resulting <code class="reqn">nt \times np</code> matrix is filled by column with specified values,
if a <code class="reqn">np</code>-length vector is given, the matrix is filled by row. 
The default variance is large and set to 10 for an uninformative flat prior, ignored if <code>trait_data=NULL</code>.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_mu_lambda">mu_lambda</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\lambda</code> parameters corresponding to the latent variables. 
<code>mu_lambda</code> must be either a scalar or a <code class="reqn">n_{latent}</code>-length vector. 
If <code>mu_lambda</code> takes a scalar value, then that value will serve as the prior mean for all of the <code class="reqn">\lambda</code> parameters.
The default value is set to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_v_lambda">V_lambda</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\lambda</code> parameters corresponding to the latent variables.
<code>V_lambda</code> must be either a scalar or a <code class="reqn">n_{latent} \times n_{latent}</code> symmetric positive semi-definite square matrix.
If <code>V_lambda</code> takes a scalar value, then that value will serve as the prior variance for all of <code class="reqn">\lambda</code> parameters,
so the variance covariance matrix used in this case is diagonal with the specified value on the diagonal.
The default variance is large and set to 10 for an uninformative flat prior.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_seed">seed</code></td>
<td>
<p>The seed for the random number generator. Default to <code>c(123, 1234)</code> for two chains and for more chains different seeds are generated for each chain.</p>
</td></tr>
<tr><td><code id="jSDM_binomial_probit_sp_constrained_+3A_verbose">verbose</code></td>
<td>
<p>A switch (0,1) which determines whether or not the progress of the sampler is printed to the screen.
Default is 1: a progress bar is printed, indicating the step (in %) reached by the Gibbs sampler.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We model an ecological process where the presence or absence of species <code class="reqn">j</code> on site <code class="reqn">i</code> is explained by habitat suitability.
</p>
<p><b>Ecological process:</b>
</p>
<p style="text-align: center;"><code class="reqn">y_{ij} \sim \mathcal{B}ernoulli(\theta_{ij})</code>
</p>

<p>where </p>

<table>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="none"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_{ij}) =  X_i \beta_j</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="none"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_{ij}) =  X_i \beta_j + W_i \lambda_j</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="random"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_{ij}) =  X_i \beta_j  + \alpha_i</code>  and <code class="reqn">\alpha_i \sim \mathcal{N}(0,V_\alpha)</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="fixed"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_{ij}) =  X_i \beta_j + W_i \lambda_j + \alpha_i</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="fixed"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_{ij}) =  X_i \beta_j  + \alpha_i</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="random"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_{ij}) =  X_i \beta_j + W_i \lambda_j + \alpha_i</code> and <code class="reqn">\alpha_i \sim \mathcal{N}(0,V_\alpha)</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>In the absence of data on species traits (<code>trait_data=NULL</code>), the effect of species <code class="reqn">j</code>: <code class="reqn">\beta_j</code>;
follows the same <em>a priori</em> Gaussian distribution such that <code class="reqn">\beta_j \sim \mathcal{N}_{np}(\mu_{\beta},V_{\beta})</code>,
for each species. 
</p>
<p>If species traits data are provided, the effect of species <code class="reqn">j</code>: <code class="reqn">\beta_j</code>;
follows an <em>a priori</em> Gaussian distribution such that <code class="reqn">\beta_j \sim \mathcal{N}_{np}(\mu_{\beta_j},V_{\beta})</code>,
where <code class="reqn">\mu_{\beta_jp} = \sum_{k=1}^{nt} t_{jk}.\gamma_{kp}</code>, takes different values for each species.
</p>
<p>We assume that <code class="reqn">\gamma_{kp} \sim \mathcal{N}(\mu_{\gamma_{kp}},V_{\gamma_{kp}})</code> as prior distribution.   
</p>
<p>We define the matrix <code class="reqn">\gamma=(\gamma_{kp})_{k=1,...,nt}^{p=1,...,np}</code> such as : 
</p>

<table>
<tr>
 <td style="text-align: right;">
</td><td style="text-align: center;"> <strong><code class="reqn">x_0</code></strong> </td><td style="text-align: center;"> <strong><code class="reqn">x_1</code></strong> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <strong><code class="reqn">x_p</code></strong> </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> <strong><code class="reqn">x_{np}</code></strong> </td><td style="text-align: left;">  </td>
</tr>
<tr>
 <td style="text-align: right;"> 
</td><td style="text-align: center;">__________</td><td style="text-align: center;">________</td><td style="text-align: center;">________</td><td style="text-align: center;">________</td><td style="text-align: center;">________</td><td style="text-align: center;">________</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
<strong><code class="reqn">t_0</code></strong> | </td><td style="text-align: center;">  <strong><code class="reqn">\gamma_{0,0}</code></strong> </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{0,1}</code></em> </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{0,p}</code></em> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{0,np}</code></em> </td><td style="text-align: left;"> { <em>effect of </em> </td>
</tr>
<tr>
 <td style="text-align: right;">
  | </td><td style="text-align: center;"> <strong>intercept</strong> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: left;"> <em>environmental</em> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
  | </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: left;"> <em>   variables</em> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
  <strong><code class="reqn">t_1</code></strong> | </td><td style="text-align: center;">  <code class="reqn">\gamma_{1,0}</code> </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{1,1}</code></em> </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{1,p}</code></em> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{1,np}</code></em> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;">
  ... | </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
  <strong><code class="reqn">t_k</code></strong> | </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{k,0}</code></em> </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{k,1}</code></em> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <code class="reqn">\gamma_{k,p}</code> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <code class="reqn">\gamma_{k,np}</code> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;">
  ... | </td><td style="text-align: center;"> ... </td><td style="text-align: center;">  ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
  <strong><code class="reqn">t_{nt}</code></strong> | </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{nt,0}</code></em> </td><td style="text-align: center;"> <code class="reqn">\gamma_{nt,1}</code></td><td style="text-align: center;"> ... </td><td style="text-align: center;"> <code class="reqn">\gamma_{nt,p}</code> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <code class="reqn">\gamma_{nt,np}</code> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;">
  </td><td style="text-align: center;"> <em>average</em> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
  </td><td style="text-align: center;"> <em>trait effect</em> </td><td style="text-align: center;"> </td><td style="text-align: center;"> interaction </td><td style="text-align: center;"> traits </td><td style="text-align: center;"> environment </td><td style="text-align: center;"> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
</td>
</tr>

</table>



<h3>Value</h3>

<p>A list of length <code>nchains</code> where each element is an object of class <code>"jSDM"</code> acting like a list including : 
</p>
<table>
<tr><td><code>mcmc.alpha</code></td>
<td>
<p>An mcmc object that contains the posterior samples for site effects <code class="reqn">\alpha</code>, not returned if <code>site_effect="none"</code>.</p>
</td></tr>
<tr><td><code>mcmc.V_alpha</code></td>
<td>
<p>An mcmc object that contains the posterior samples for variance of random site effect, not returned if <code>site_effect="none"</code> or <code>site_effect="fixed"</code>.</p>
</td></tr>
<tr><td><code>mcmc.latent</code></td>
<td>
<p>A list by latent variable of mcmc objects that contains the posterior samples for latent variables <code class="reqn">W_l</code> with <code class="reqn">l=1,\ldots,n_{latent}</code>, not returned if <code>n_latent=0</code>.</p>
</td></tr>
<tr><td><code>mcmc.sp</code></td>
<td>
<p>A list by species of mcmc objects that contains the posterior samples for species effects <code class="reqn">\beta_j</code> and <code class="reqn">\lambda_j</code> if <code>n_latent&gt;0</code> with <code class="reqn">j=1,\ldots,n_{species}</code>.</p>
</td></tr>
<tr><td><code>mcmc.gamma</code></td>
<td>
<p>A list by covariates of mcmc objects that contains the posterior samples for <code class="reqn">\gamma_p</code> parameters with <code class="reqn">p=1,\ldots,np</code> if <code>trait_data</code> is specified.</p>
</td></tr>
<tr><td><code>mcmc.Deviance</code></td>
<td>
<p>The posterior sample of the deviance (<code class="reqn">D</code>) is also provided, with <code class="reqn">D</code> defined as : <code class="reqn">D=-2\log(\prod_{ij} P(y_{ij}|\beta_j,\lambda_j, \alpha_i, W_i))</code>.</p>
</td></tr> 
<tr><td><code>Z_latent</code></td>
<td>
<p>Predictive posterior mean of the latent variable Z. </p>
</td></tr>
<tr><td><code>probit_theta_latent</code></td>
<td>
<p>Predictive posterior mean of the probability to each species to be present on each site, transformed by probit link function.</p>
</td></tr>
<tr><td><code>theta_latent</code></td>
<td>
<p>Predictive posterior mean of the probability to each species to be present on each site.</p>
</td></tr>
<tr><td><code>model_spec</code></td>
<td>
<p>Various attributes of the model fitted, including the response and model matrix used, distributional assumptions as link function, family and number of latent variables, hyperparameters used in the Bayesian estimation and mcmc, burnin and thin.</p>
</td></tr>
<tr><td><code>sp_constrained</code></td>
<td>
<p>Indicates the reference species (<code class="reqn">\hat{j}_l</code>) considered that structures itself most clearly on each latent axis <code class="reqn">l</code>, chosen such as <code class="reqn">\lambda_{\hat{j}_l}</code> maximize the <code class="reqn">\hat{R}</code> computed on all chains. The <code class="reqn">lambda</code> corresponding to this species are constrained to be positive by being placed on the diagonal of the <code class="reqn">\Lambda</code> matrix.</p>
</td></tr>
</table>
<p>The <code>mcmc.</code> objects can be summarized by functions provided by the <code>coda</code> package.
</p>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent &lt;ghislain.vieilledent@cirad.fr&gt;
</p>
<p>Jeanne Clément &lt;jeanne.clement16@laposte.net&gt;
</p>


<h3>References</h3>

<p>Chib, S. and Greenberg, E. (1998) Analysis of multivariate probit models. <em>Biometrika</em>, 85, 347-361.
</p>
<p>Warton, D. I.; Blanchet, F. G.; O'Hara, R. B.; O'Hara, R. B.; Ovaskainen, O.; Taskinen, S.; Walker, S. C. and Hui, F. K. C. (2015) So Many Variables: Joint Modeling in Community Ecology. <em>Trends in Ecology &amp; Evolution</em>, 30, 766-779.
</p>
<p>Ovaskainen, O., Tikhonov, G., Norberg, A., Blanchet, F. G., Duan, L., Dunson, D., Roslin, T. and Abrego, N. (2017) How to make more out of community data? A conceptual framework and its implementation as models and software. <em>Ecology Letters</em>, 20, 561-576.
</p>


<h3>See Also</h3>

<p><code><a href="coda.html#topic+plot.mcmc">plot.mcmc</a></code>, <code><a href="coda.html#topic+summary.mcmc">summary.mcmc</a></code> <code><a href="coda.html#topic+mcmc.list">mcmc.list</a></code> <br />
<code><a href="coda.html#topic+mcmc">mcmc</a></code>  <code><a href="coda.html#topic+gelman.diag">gelman.diag</a></code> <code><a href="#topic+jSDM_binomial_probit">jSDM_binomial_probit</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#======================================
# jSDM_binomial_probit_sp_constrained()
# Example with simulated data
#====================================

#=================
#== Load libraries
library(jSDM)

#==================
#== Data simulation

#= Number of sites
nsite &lt;- 30

#= Set seed for repeatability
seed &lt;- 1234
set.seed(seed)

#= Number of species
nsp &lt;- 10

#= Number of latent variables
n_latent &lt;- 2

#= Ecological process (suitability)
x1 &lt;- rnorm(nsite,0,1)
x2 &lt;- rnorm(nsite,0,1)
X &lt;- cbind(rep(1,nsite),x1,x2)
np &lt;- ncol(X)
#= Latent variables W
W &lt;- matrix(rnorm(nsite*n_latent,0,1), nsite, n_latent)
#= Fixed species effect beta 
beta.target &lt;- t(matrix(runif(nsp*np,-2,2),
                        byrow=TRUE, nrow=nsp))
#= Factor loading lambda  
lambda.target &lt;- matrix(0, n_latent, nsp)
mat &lt;- t(matrix(runif(nsp*n_latent, -2, 2), byrow=TRUE, nrow=nsp))
lambda.target[upper.tri(mat, diag=TRUE)] &lt;- mat[upper.tri(mat, diag=TRUE)]
diag(lambda.target) &lt;- runif(n_latent, 0, 2)
#= Variance of random site effect 
V_alpha.target &lt;- 0.5
#= Random site effect alpha
alpha.target &lt;- rnorm(nsite,0 , sqrt(V_alpha.target))
# Simulation of response data with probit link
probit_theta &lt;- X%*%beta.target + W%*%lambda.target + alpha.target
theta &lt;- pnorm(probit_theta)
e &lt;- matrix(rnorm(nsp*nsite,0,1),nsite,nsp)
# Latent variable Z 
Z_true &lt;- probit_theta + e
# Presence-absence matrix Y
Y &lt;- matrix (NA, nsite,nsp)
for (i in 1:nsite){
  for (j in 1:nsp){
    if ( Z_true[i,j] &gt; 0) {Y[i,j] &lt;- 1}
    else {Y[i,j] &lt;- 0}
  }
}

#==================================
#== Site-occupancy model

# Increase number of iterations (burnin and mcmc) to get convergence
mod &lt;- jSDM_binomial_probit_sp_constrained(# Iteration
                                           burnin=100,
                                           mcmc=100,
                                           thin=1,
                                           # parallel MCMCs
                                           nchains=2, ncores=2,
                                           # Response variable
                                           presence_data=Y,
                                           # Explanatory variables
                                           site_formula=~x1+x2,
                                           site_data = X,
                                           n_latent=2,
                                           site_effect="random",
                                           # Starting values
                                           alpha_start=0,
                                           beta_start=0,
                                           lambda_start=0,
                                           W_start=0,
                                           V_alpha=1,
                                           # Priors
                                           shape_Valpha=0.5,
                                           rate_Valpha=0.0005,
                                           mu_beta=0, V_beta=1,
                                           mu_lambda=0, V_lambda=1,
                                           seed=c(123,1234), verbose=1)

# ===================================================
# Result analysis
# ===================================================

#==========
#== Outputs
oldpar &lt;- par(no.readonly = TRUE) 
burnin &lt;- mod[[1]]$model_spec$burnin
ngibbs &lt;- burnin + mod[[1]]$model_spec$mcmc
thin &lt;-  mod[[1]]$model_spec$thin
require(coda)
arr2mcmc &lt;- function(x) {
  return(mcmc(as.data.frame(x),
              start=burnin+1 , end=ngibbs, thin=thin))
}
mcmc_list_Deviance &lt;- mcmc.list(lapply(lapply(mod,"[[","mcmc.Deviance"), arr2mcmc))
mcmc_list_alpha &lt;- mcmc.list(lapply(lapply(mod,"[[","mcmc.alpha"), arr2mcmc))
mcmc_list_V_alpha &lt;- mcmc.list(lapply(lapply(mod,"[[","mcmc.V_alpha"), arr2mcmc))
mcmc_list_param &lt;- mcmc.list(lapply(lapply(mod,"[[","mcmc.sp"), arr2mcmc))
mcmc_list_lv &lt;- mcmc.list(lapply(lapply(mod,"[[","mcmc.latent"), arr2mcmc))
mcmc_list_beta &lt;- mcmc_list_param[,grep("beta",colnames(mcmc_list_param[[1]]))]
mcmc_list_beta0 &lt;- mcmc_list_beta[,grep("Intercept", colnames(mcmc_list_beta[[1]]))]
mcmc_list_lambda &lt;- mcmc.list(
  lapply(mcmc_list_param[, grep("lambda", colnames(mcmc_list_param[[1]]))],
         arr2mcmc))
# Compute Rhat
psrf_alpha &lt;- mean(gelman.diag(mcmc_list_alpha, multivariate=FALSE)$psrf[,2])
psrf_V_alpha &lt;- gelman.diag(mcmc_list_V_alpha)$psrf[,2]
psrf_beta0 &lt;- mean(gelman.diag(mcmc_list_beta0)$psrf[,2])
psrf_beta &lt;- mean(gelman.diag(mcmc_list_beta[,grep("Intercept",
                                                   colnames(mcmc_list_beta[[1]]),
                                                   invert=TRUE)])$psrf[,2])
psrf_lambda &lt;- mean(gelman.diag(mcmc_list_lambda,
                                multivariate=FALSE)$psrf[,2],
                    na.rm=TRUE)
psrf_lv &lt;- mean(gelman.diag(mcmc_list_lv, multivariate=FALSE)$psrf[,2])
Rhat &lt;- data.frame(Rhat=c(psrf_alpha, psrf_V_alpha, psrf_beta0, psrf_beta,
                          psrf_lambda, psrf_lv),
                   Variable=c("alpha", "Valpha", "beta0", "beta",
                              "lambda", "W"))
# Barplot
library(ggplot2)
ggplot2::ggplot(Rhat, aes(x=Variable, y=Rhat)) + 
  ggtitle("Averages of Rhat obtained with jSDM for each type of parameter") +
  theme(plot.title = element_text(hjust = 0.5, size=15)) +
  geom_bar(fill="skyblue", stat = "identity") +
  geom_text(aes(label=round(Rhat,2)), vjust=0, hjust=-0.1) +
  geom_hline(yintercept=1, color='red') +
  coord_flip()

#= Parameter estimates
nchains &lt;- length(mod)
## beta_j
pdf(file=file.path(tempdir(), "Posteriors_species_effect_jSDM_probit.pdf"))
plot(mcmc_list_param)
dev.off()

## Latent variables 
pdf(file=file.path(tempdir(), "Posteriors_latent_variables_jSDM_probit.pdf"))
plot(mcmc_list_lv)
dev.off()

## Random site effect and its variance
pdf(file=file.path(tempdir(), "Posteriors_site_effect_jSDM_probit.pdf"))
plot(mcmc_list_V_alpha)
plot(mcmc_list_alpha)
dev.off()

## Predictive posterior mean for each observation
# Species effects beta and factor loadings lambda
param &lt;- list()
for (i in 1:nchains){
param[[i]] &lt;- matrix(unlist(lapply(mod[[i]]$mcmc.sp,colMeans)),
                     nrow=nsp, byrow=TRUE)
}
par(mfrow=c(1,1))
for (i in 1:nchains){
  if(i==1){
    plot(t(beta.target), param[[i]][,1:np],
         main="species effect beta",
         xlab ="obs", ylab ="fitted")
    abline(a=0,b=1, col='red')
  }
  else{
    points(t(beta.target), param[[i]][,1:np], col=i)
  }
}
par(mfrow=c(1,2))
for(l in 1:n_latent){
  for (i in 1:nchains){
    if (i==1){
      plot(t(lambda.target)[,l],
           param[[i]][,np+l],
           main=paste0("factor loadings lambda_", l),
           xlab ="obs", ylab ="fitted")
      abline(a=0,b=1, col='red')
    } else {
      points(t(lambda.target)[,l],
             param[[i]][,np+l],
             col=i)
    }
  }
}
## W latent variables
mean_W &lt;- list()
for (i in 1:nchains){
  mean_W[[i]] &lt;- sapply(mod[[i]]$mcmc.latent,colMeans)
}
par(mfrow=c(1,2))
for (l in 1:n_latent) {
  for (i in 1:nchains){
    if (i==1){
      plot(W[,l], mean_W[[i]][,l],
           main = paste0("Latent variable W_", l),
           xlab ="obs", ylab ="fitted")
      abline(a=0,b=1, col='red')
    }
    else{
      points(W[,l], mean_W[[i]][,l], col=i)
    }
  }
}

#= W.lambda
par(mfrow=c(1,2))
for (i in 1:nchains){
  if (i==1){
    plot(W%*%lambda.target, 
         mean_W[[i]]%*%t(param[[i]][,(np+1):(np+n_latent)]),
         main = "W.lambda",
         xlab ="obs", ylab ="fitted")
    abline(a=0,b=1, col='red')
  }
  else{
    points(W%*%lambda.target, 
           mean_W[[i]]%*%t(param[[i]][,(np+1):(np+n_latent)]),
           col=i)
  }
}

# Site effect alpha et V_alpha
plot(alpha.target,colMeans(mod[[1]]$mcmc.alpha),
     xlab="obs", ylab="fitted",
     main="Random site effect alpha")
abline(a=0,b=1, col='red')
points(V_alpha.target, mean(mod[[1]]$mcmc.V_alpha),
       pch=18, cex=2)
legend("bottomright", legend=c("V_alpha"), pch =18, pt.cex=1.5)
for (i in 2:nchains){
  points(alpha.target, colMeans(mod[[i]]$mcmc.alpha), col=i)
  points(V_alpha.target, mean(mod[[i]]$mcmc.V_alpha),
         pch=18, col=i, cex=2)
}

#= Predictions 
## Occurence probabilities 
plot(pnorm(probit_theta), mod[[1]]$theta_latent,
     main="theta",xlab="obs",ylab="fitted")
for (i in 2:nchains){
  points(pnorm(probit_theta), mod[[i]]$theta_latent, col=i)
}
abline(a=0,b=1, col='red')

## probit(theta)
plot(probit_theta, mod[[1]]$probit_theta_latent,
     main="probit(theta)",xlab="obs",ylab="fitted")
for (i in 2:nchains){
  points(probit_theta, mod[[i]]$probit_theta_latent, col=i)
}
abline(a=0,b=1, col='red')

## Deviance
plot(mcmc_list_Deviance)

par(oldpar)

</code></pre>

<hr>
<h2 id='jSDM_gaussian'>Binomial probit regression</h2><span id='topic+jSDM_gaussian'></span>

<h3>Description</h3>

<p>The <code>jSDM_gaussian</code> function performs a linear regression in a Bayesian framework. 
The function calls a Gibbs sampler written in 'C++' code which uses conjugate priors to estimate the conditional posterior distribution of model's parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>jSDM_gaussian(
  burnin = 5000,
  mcmc = 10000,
  thin = 10,
  response_data,
  site_formula,
  trait_data = NULL,
  trait_formula = NULL,
  site_data,
  n_latent = 0,
  site_effect = "none",
  lambda_start = 0,
  W_start = 0,
  beta_start = 0,
  alpha_start = 0,
  gamma_start = 0,
  V_alpha = 1,
  V_start = 1,
  mu_beta = 0,
  V_beta = 10,
  mu_lambda = 0,
  V_lambda = 10,
  mu_gamma = 0,
  V_gamma = 10,
  shape_Valpha = 0.5,
  rate_Valpha = 5e-04,
  shape_V = 0.5,
  rate_V = 5e-04,
  seed = 1234,
  verbose = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="jSDM_gaussian_+3A_burnin">burnin</code></td>
<td>
<p>The number of burnin iterations for the sampler.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_mcmc">mcmc</code></td>
<td>
<p>The number of Gibbs iterations for the sampler. Total number of Gibbs iterations is equal to <code>burnin+mcmc</code>.
<code>burnin+mcmc</code> must be divisible by 10 and superior or equal to 100 so that the progress bar can be displayed.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_thin">thin</code></td>
<td>
<p>The thinning interval used in the simulation. The number of mcmc iterations must be divisible by this value.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_response_data">response_data</code></td>
<td>
<p>A matrix <code class="reqn">n_{site} \times n_{species}</code> indicating the presence by a 1 (or the absence by a 0) of each species on each site.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_site_formula">site_formula</code></td>
<td>
<p>A one-sided formula of the form '~x1+...+xp' specifying the explanatory variables for the suitability process of the model,
used to form the design matrix <code class="reqn">X</code> of size <code class="reqn">n_{site} \times np</code>.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_trait_data">trait_data</code></td>
<td>
<p>A data frame containing the species traits which can be included as part of the model. Default to <code>NULL</code> to fit a model without species traits.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_trait_formula">trait_formula</code></td>
<td>
<p>A one-sided formula of the form '~ t1 + ... + tk + x1:t1 + ... + xp:tk' specifying the interactions between the environmental variables and the species traits to be considered in the model,
used to form the trait design matrix <code class="reqn">Tr</code> of size <code class="reqn">n_{species} \times nt</code> and to set to <code class="reqn">0</code> the <code class="reqn">\gamma</code> parameters corresponding to interactions not taken into account according to the formula. 
Default to <code>NULL</code> to fit a model with all possible interactions between species traits found in <code>trait_data</code> and environmental variables defined by <code>site_formula</code>.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_site_data">site_data</code></td>
<td>
<p>A data frame containing the model's explanatory variables by site.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_n_latent">n_latent</code></td>
<td>
<p>An integer which specifies the number of latent variables to generate. Defaults to <code class="reqn">0</code>.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_site_effect">site_effect</code></td>
<td>
<p>A string indicating whether row effects are included as fixed effects (<code>"fixed"</code>), as random effects (<code>"random"</code>), or not included (<code>"none"</code>) in the model. 
If fixed effects, then for parameter identifiability the first row effect is set to zero, which analogous to acting as a reference level when dummy variables are used.
If random effects, they are drawn from a normal distribution with mean zero and unknown variance, analogous to a random intercept in mixed models. Defaults to <code>"none"</code>.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_lambda_start">lambda_start</code></td>
<td>
<p>Starting values for <code class="reqn">\lambda</code> parameters corresponding to the latent variables for each species must be either a scalar
or a <code class="reqn">n_{latent} \times n_{species}</code> upper triangular matrix with strictly positive values on the diagonal,
ignored if <code>n_latent=0</code>.
If <code>lambda_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">\lambda</code> parameters except those concerned by the constraints explained above.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_w_start">W_start</code></td>
<td>
<p>Starting values for latent variables must be either a scalar or a <code class="reqn">nsite \times n_latent</code> matrix, ignored if <code>n_latent=0</code>.
If <code>W_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">W_{il}</code> with <code class="reqn">i=1,\ldots,n_{site}</code> and <code class="reqn">l=1,\ldots,n_{latent}</code>.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_beta_start">beta_start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters of the suitability process for each species must be either a scalar or a <code class="reqn">np \times n_{species}</code> matrix.
If <code>beta_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">\beta</code> parameters.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_alpha_start">alpha_start</code></td>
<td>
<p>Starting values for random site effect parameters must be either a scalar or a <code class="reqn">n_{site}</code>-length vector, ignored if <code>site_effect="none"</code>.
If <code>alpha_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">\alpha</code> parameters.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_gamma_start">gamma_start</code></td>
<td>
<p>Starting values for <code class="reqn">\gamma</code> parameters that represent the influence of species-specific traits on species' responses <code class="reqn">\beta</code>,
<code>gamma_start</code> must be either a scalar, a vector of length <code class="reqn">nt</code>, <code class="reqn">np</code> or <code class="reqn">nt.np</code> or a <code class="reqn">nt \times np</code> matrix.
If <code>gamma_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">\gamma</code> parameters.
If <code>gamma_start</code> is a vector of length <code class="reqn">nt</code> or <code class="reqn">nt.np</code> the resulting <code class="reqn">nt \times np</code> matrix is filled by column with specified values,
if a <code class="reqn">np</code>-length vector is given, the matrix is filled by row.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_v_alpha">V_alpha</code></td>
<td>
<p>Starting value for variance of random site effect if <code>site_effect="random"</code> or constant variance of the Gaussian prior distribution for the fixed site effect if 
<code>site_effect="fixed"</code>. Must be a strictly positive scalar, ignored if <code>site_effect="none"</code>.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_v_start">V_start</code></td>
<td>
<p>Starting value for the variance of residuals or over dispersion term. Must be a strictly positive scalar.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_mu_beta">mu_beta</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\beta</code> parameters of the suitability process. <code>mu_beta</code> must be either a scalar or a <code class="reqn">np</code>-length vector.
If <code>mu_beta</code> takes a scalar value, then that value will serve as the prior mean for all of the <code class="reqn">\beta</code> parameters.
The default value is set to 0 for an uninformative prior, ignored if <code>trait_data</code> is specified.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_v_beta">V_beta</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\beta</code> parameters of the suitability process.
<code>V_beta</code> must be either a scalar or a <code class="reqn">np \times np</code> symmetric positive semi-definite square matrix.
If <code>V_beta</code> takes a scalar value, then that value will serve as the prior variance for all of the <code class="reqn">\beta</code> parameters,
so the variance covariance matrix used in this case is diagonal with the specified value on the diagonal. 
The default variance is large and set to 10 for an uninformative flat prior.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_mu_lambda">mu_lambda</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\lambda</code> parameters corresponding to the latent variables. 
<code>mu_lambda</code> must be either a scalar or a <code class="reqn">n_{latent}</code>-length vector. 
If <code>mu_lambda</code> takes a scalar value, then that value will serve as the prior mean for all of the <code class="reqn">\lambda</code> parameters.
The default value is set to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_v_lambda">V_lambda</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\lambda</code> parameters corresponding to the latent variables.
<code>V_lambda</code> must be either a scalar or a <code class="reqn">n_{latent} \times n_{latent}</code> symmetric positive semi-definite square matrix.
If <code>V_lambda</code> takes a scalar value, then that value will serve as the prior variance for all of <code class="reqn">\lambda</code> parameters,
so the variance covariance matrix used in this case is diagonal with the specified value on the diagonal.
The default variance is large and set to 10 for an uninformative flat prior.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_mu_gamma">mu_gamma</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\gamma</code> parameters.
<code>mu_gamma</code> must be either a scalar, a vector of length <code class="reqn">nt</code>, <code class="reqn">np</code> or <code class="reqn">nt.np</code> or a <code class="reqn">nt \times np</code> matrix.
If <code>mu_gamma</code> takes a scalar value, then that value will serve as the prior mean for all of the <code class="reqn">\gamma</code> parameters.
If <code>mu_gamma</code> is a vector of length <code class="reqn">nt</code> or <code class="reqn">nt.np</code> the resulting <code class="reqn">nt \times np</code> matrix is filled by column with specified values,
if a <code class="reqn">np</code>-length vector is given, the matrix is filled by row. 
The default value is set to 0 for an uninformative prior, ignored if <code>trait_data=NULL</code>.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_v_gamma">V_gamma</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\gamma</code> parameters.
<code>V_gamma</code> must be either a scalar, a vector of length <code class="reqn">nt</code>, <code class="reqn">np</code> or <code class="reqn">nt.np</code> or a <code class="reqn">nt \times np</code> positive matrix.
If <code>V_gamma</code> takes a scalar value, then that value will serve as the prior variance for all of the <code class="reqn">\gamma</code> parameters.
If <code>V_gamma</code> is a vector of length <code class="reqn">nt</code> or <code class="reqn">nt.np</code> the resulting <code class="reqn">nt \times np</code> matrix is filled by column with specified values,
if a <code class="reqn">np</code>-length vector is given, the matrix is filled by row. 
The default variance is large and set to 10 for an uninformative flat prior, ignored if <code>trait_data=NULL</code>.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_shape_valpha">shape_Valpha</code></td>
<td>
<p>Shape parameter of the Inverse-Gamma prior for the random site effect variance <code>V_alpha</code>, ignored if <code>site_effect="none"</code> or <code>site_effect="fixed"</code>. 
Must be a strictly positive scalar. Default to 0.5 for weak informative prior.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_rate_valpha">rate_Valpha</code></td>
<td>
<p>Rate parameter of the Inverse-Gamma prior for the random site effect variance <code>V_alpha</code>, ignored if <code>site_effect="none"</code> or <code>site_effect="fixed"</code>
Must be a strictly positive scalar. Default to 0.0005 for weak informative prior.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_shape_v">shape_V</code></td>
<td>
<p>Shape parameter of the Inverse-Gamma prior for the variance of residuals <code>V</code>. 
Must be a strictly positive scalar. Default to 0.5 for weak informative prior.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_rate_v">rate_V</code></td>
<td>
<p>Rate parameter of the Inverse-Gamma prior for the variance of residuals <code>V</code>.
Must be a strictly positive scalar. Default to 0.0005 for weak informative prior.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_seed">seed</code></td>
<td>
<p>The seed for the random number generator. Default to 1234.</p>
</td></tr>
<tr><td><code id="jSDM_gaussian_+3A_verbose">verbose</code></td>
<td>
<p>A switch (0,1) which determines whether or not the progress of the sampler is printed to the screen.
Default is 1: a progress bar is printed, indicating the step (in %) reached by the Gibbs sampler.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We model an ecological process where the continuous data <code class="reqn">y_ij</code> about the species <code class="reqn">j</code> and the site <code class="reqn">i</code> is explained by habitat suitability.
</p>
<p><b>Ecological process:</b>
</p>
<p style="text-align: center;"><code class="reqn">y_{ij} \sim \mathcal{N}(\theta_{ij}, V)</code>
</p>

<p>where </p>

<table>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="none"</code> </td><td style="text-align: left;"> <code class="reqn">\theta_{ij} =  X_i \beta_j</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="none"</code> </td><td style="text-align: left;"> <code class="reqn">\theta_{ij} =  X_i \beta_j + W_i \lambda_j</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="random"</code> </td><td style="text-align: left;"> <code class="reqn">\theta_{ij} =  X_i \beta_j  + \alpha_i</code>  and <code class="reqn">\alpha_i \sim \mathcal{N}(0,V_\alpha)</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="fixed"</code> </td><td style="text-align: left;"> <code class="reqn">\theta_{ij} =  X_i \beta_j + W_i \lambda_j + \alpha_i</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="fixed"</code> </td><td style="text-align: left;"> <code class="reqn">\theta_{ij} =  X_i \beta_j  + \alpha_i</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="random"</code> </td><td style="text-align: left;"> <code class="reqn">\theta_{ij} =  X_i \beta_j + W_i \lambda_j + \alpha_i</code> and <code class="reqn">\alpha_i \sim \mathcal{N}(0,V_\alpha)</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>In the absence of data on species traits (<code>trait_data=NULL</code>), the effect of species <code class="reqn">j</code>: <code class="reqn">\beta_j</code>;
follows the same <em>a priori</em> Gaussian distribution such that <code class="reqn">\beta_j \sim \mathcal{N}_{np}(\mu_{\beta},V_{\beta})</code>,
for each species. 
</p>
<p>If species traits data are provided, the effect of species <code class="reqn">j</code>: <code class="reqn">\beta_j</code>;
follows an <em>a priori</em> Gaussian distribution such that <code class="reqn">\beta_j \sim \mathcal{N}_{np}(\mu_{\beta_j},V_{\beta})</code>,
where <code class="reqn">\mu_{\beta_jp} = \sum_{k=1}^{nt} t_{jk}.\gamma_{kp}</code>, takes different values for each species.
</p>
<p>We assume that <code class="reqn">\gamma_{kp} \sim \mathcal{N}(\mu_{\gamma_{kp}},V_{\gamma_{kp}})</code> as prior distribution.   
</p>
<p>We define the matrix <code class="reqn">\gamma=(\gamma_{kp})_{k=1,...,nt}^{p=1,...,np}</code> such as : 
</p>

<table>
<tr>
 <td style="text-align: right;">
</td><td style="text-align: center;"> <strong><code class="reqn">x_0</code></strong> </td><td style="text-align: center;"> <strong><code class="reqn">x_1</code></strong> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <strong><code class="reqn">x_p</code></strong> </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> <strong><code class="reqn">x_{np}</code></strong> </td><td style="text-align: left;">  </td>
</tr>
<tr>
 <td style="text-align: right;"> 
</td><td style="text-align: center;">__________</td><td style="text-align: center;">________</td><td style="text-align: center;">________</td><td style="text-align: center;">________</td><td style="text-align: center;">________</td><td style="text-align: center;">________</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
<strong><code class="reqn">t_0</code></strong> | </td><td style="text-align: center;">  <strong><code class="reqn">\gamma_{0,0}</code></strong> </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{0,1}</code></em> </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{0,p}</code></em> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{0,np}</code></em> </td><td style="text-align: left;"> { <em>effect of </em> </td>
</tr>
<tr>
 <td style="text-align: right;">
   </td><td style="text-align: center;"> intercept </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: left;"> <em>environmental</em> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
   </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: left;"> <em>variables</em> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
  <strong><code class="reqn">t_1</code></strong> | </td><td style="text-align: center;">  <code class="reqn">\gamma_{1,0}</code> </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{1,1}</code></em> </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{1,p}</code></em> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{1,np}</code></em> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;">
  ... | </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
  <strong><code class="reqn">t_k</code></strong> | </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{k,0}</code></em> </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{k,1}</code></em> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <code class="reqn">\gamma_{k,p}</code> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <code class="reqn">\gamma_{k,np}</code> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;">
  ... | </td><td style="text-align: center;"> ... </td><td style="text-align: center;">  ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
  <strong><code class="reqn">t_{nt}</code></strong> | </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{nt,0}</code></em> </td><td style="text-align: center;"> <code class="reqn">\gamma_{nt,1}</code></td><td style="text-align: center;"> ... </td><td style="text-align: center;"> <code class="reqn">\gamma_{nt,p}</code> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <code class="reqn">\gamma_{nt,np}</code> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;">
  </td><td style="text-align: center;"> <em>average</em> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
  </td><td style="text-align: center;"> <em>trait effect</em> </td><td style="text-align: center;"> </td><td style="text-align: center;"> interaction </td><td style="text-align: center;"> traits </td><td style="text-align: center;"> environment </td><td style="text-align: center;"> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
</td>
</tr>

</table>



<h3>Value</h3>

<p>An object of class <code>"jSDM"</code> acting like a list including : 
</p>
<table>
<tr><td><code>mcmc.alpha</code></td>
<td>
<p>An mcmc object that contains the posterior samples for site effects <code class="reqn">\alpha</code>, not returned if <code>site_effect="none"</code>.</p>
</td></tr>
<tr><td><code>mcmc.V_alpha</code></td>
<td>
<p>An mcmc object that contains the posterior samples for variance of random site effect, not returned if <code>site_effect="none"</code> or <code>site_effect="fixed"</code>.</p>
</td></tr>
<tr><td><code>mcmc.V</code></td>
<td>
<p>An mcmc object that contains the posterior samples for variance of residuals.</p>
</td></tr>
<tr><td><code>mcmc.latent</code></td>
<td>
<p>A list by latent variable of mcmc objects that contains the posterior samples for latent variables <code class="reqn">W_l</code> with <code class="reqn">l=1,\ldots,n_{latent}</code>, not returned if <code>n_latent=0</code>.</p>
</td></tr>
<tr><td><code>mcmc.sp</code></td>
<td>
<p>A list by species of mcmc objects that contains the posterior samples for species effects <code class="reqn">\beta_j</code> and <code class="reqn">\lambda_j</code> if <code>n_latent&gt;0</code> with <code class="reqn">j=1,\ldots,n_{species}</code>.</p>
</td></tr>
<tr><td><code>mcmc.gamma</code></td>
<td>
<p>A list by covariates of mcmc objects that contains the posterior samples for <code class="reqn">\gamma_p</code> parameters with <code class="reqn">p=1,\ldots,np</code> if <code>trait_data</code> is specified.</p>
</td></tr>
<tr><td><code>mcmc.Deviance</code></td>
<td>
<p>The posterior sample of the deviance (<code class="reqn">D</code>) is also provided, with <code class="reqn">D</code> defined as : <code class="reqn">D=-2\log(\prod_{ij} P(y_{ij}|\beta_j,\lambda_j, \alpha_i, W_i))</code>.</p>
</td></tr> 
<tr><td><code>Z_latent</code></td>
<td>
<p>Predictive posterior mean of the latent variable Z. </p>
</td></tr>
<tr><td><code>probit_theta_latent</code></td>
<td>
<p>Predictive posterior mean of the probability to each species to be present on each site, transformed by probit link function.</p>
</td></tr>
<tr><td><code>theta_latent</code></td>
<td>
<p>Predictive posterior mean of the probability to each species to be present on each site.</p>
</td></tr>
<tr><td><code>model_spec</code></td>
<td>
<p>Various attributes of the model fitted, including the response and model matrix used, distributional assumptions as link function, family and number of latent variables, hyperparameters used in the Bayesian estimation and mcmc, burnin and thin.</p>
</td></tr>
</table>
<p>The <code>mcmc.</code> objects can be summarized by functions provided by the <code>coda</code> package.
</p>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent &lt;ghislain.vieilledent@cirad.fr&gt; 
</p>
<p>Jeanne Clément &lt;jeanne.clement16@laposte.net&gt;
</p>


<h3>References</h3>

<p>Chib, S. and Greenberg, E. (1998) Analysis of multivariate probit models. <em>Biometrika</em>, 85, 347-361. 
</p>
<p>Warton, D. I.; Blanchet, F. G.; O'Hara, R. B.; O'Hara, R. B.; Ovaskainen, O.; Taskinen, S.; Walker, S. C. and Hui, F. K. C. (2015) So Many Variables: Joint Modeling in Community Ecology. <em>Trends in Ecology &amp; Evolution</em>, 30, 766-779.
</p>
<p>Ovaskainen, O., Tikhonov, G., Norberg, A., Blanchet, F. G., Duan, L., Dunson, D., Roslin, T. and Abrego, N. (2017) How to make more out of community data? A conceptual framework and its implementation as models and software. <em>Ecology Letters</em>, 20, 561-576.
</p>


<h3>See Also</h3>

<p><code><a href="coda.html#topic+plot.mcmc">plot.mcmc</a></code>, <code><a href="coda.html#topic+summary.mcmc">summary.mcmc</a></code> <code><a href="#topic+jSDM_binomial_logit">jSDM_binomial_logit</a></code> <code><a href="#topic+jSDM_poisson_log">jSDM_poisson_log</a></code> 
<code><a href="#topic+jSDM_binomial_probit_sp_constrained">jSDM_binomial_probit_sp_constrained</a></code> <code><a href="#topic+jSDM_binomial_probit">jSDM_binomial_probit</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#======================================
# jSDM_gaussian()
# Example with simulated data
#====================================

#=================
#== Load libraries
library(jSDM)

#==================
#== Data simulation

#= Number of sites
nsite &lt;- 100

#= Set seed for repeatability
seed &lt;- 1234
set.seed(seed)

#= Number of species
nsp &lt;- 20

#= Number of latent variables
n_latent &lt;- 2

#= Ecological process (suitability)
x1 &lt;- rnorm(nsite,0,1)
x2 &lt;- rnorm(nsite,0,1)
X &lt;- cbind(rep(1,nsite),x1,x2)
np &lt;- ncol(X)

#= Latent variables W
W &lt;- matrix(rnorm(nsite*n_latent,0,1), nsite, n_latent)

#= Fixed species effect beta 
beta.target &lt;- t(matrix(runif(nsp*np,-1,1),
                        byrow=TRUE, nrow=nsp))
                        
#= Factor loading lambda  
lambda.target &lt;- matrix(0, n_latent, nsp)
mat &lt;- t(matrix(runif(nsp*n_latent, -1, 1), byrow=TRUE, nrow=nsp))
lambda.target[upper.tri(mat, diag=TRUE)] &lt;- mat[upper.tri(mat, diag=TRUE)]
diag(lambda.target) &lt;- runif(n_latent, 0, 2)

#= Variance of random site effect 
V_alpha.target &lt;- 0.2

#= Random site effect alpha
alpha.target &lt;- rnorm(nsite,0 , sqrt(V_alpha.target))

# Simulation of response data 
theta.target &lt;- X%*%beta.target + W%*%lambda.target + alpha.target
V.target &lt;- 0.2
Y &lt;- matrix(rnorm(nsite*nsp, theta.target, sqrt(V.target)), nrow=nsite)

#==================================
#== Site-occupancy model

# Increase number of iterations (burnin and mcmc) to get convergence
 mod &lt;- jSDM_gaussian(# Iteration
                     burnin=200,
                     mcmc=200,
                     thin=1,
                     # Response variable
                     response_data=Y,
                     # Explanatory variables
                     site_formula=~x1+x2,
                     site_data = X,
                     n_latent=2,
                     site_effect="random",
                     # Starting values
                     alpha_start=0,
                     beta_start=0,
                     lambda_start=0,
                     W_start=0,
                     V_alpha=1,
                     V_start=1 ,
                     # Priors
                     shape_Valpha=0.5, rate_Valpha=0.0005,
                     shape_V=0.5, rate_V=0.0005,
                     mu_beta=0, V_beta=1,
                     mu_lambda=0, V_lambda=1,
                     seed=1234, verbose=1)
# ===================================================
# Result analysis
# ===================================================

#==========
#== Outputs

#= Parameter estimates
oldpar &lt;- par(no.readonly = TRUE)
## beta_j
mean_beta &lt;- matrix(0,nsp,ncol(X))
pdf(file=file.path(tempdir(), "Posteriors_beta_jSDM_probit.pdf"))
par(mfrow=c(ncol(X),2))
for (j in 1:nsp) {
  mean_beta[j,] &lt;- apply(mod$mcmc.sp[[j]]
                         [,1:ncol(X)], 2, mean)  
  for (p in 1:ncol(X)){
    coda::traceplot(mod$mcmc.sp[[j]][,p])
    coda::densplot(mod$mcmc.sp[[j]][,p],
      main = paste(colnames(mod$mcmc.sp[[j]])[p],", species : ",j))
    abline(v=beta.target[p,j],col='red')
  }
}
dev.off()

## lambda_j
mean_lambda &lt;- matrix(0,nsp,n_latent)
pdf(file=file.path(tempdir(), "Posteriors_lambda_jSDM_probit.pdf"))
par(mfrow=c(n_latent*2,2))
for (j in 1:nsp) {
  mean_lambda[j,] &lt;- apply(mod$mcmc.sp[[j]]
                           [,(ncol(X)+1):(ncol(X)+n_latent)], 2, mean)  
  for (l in 1:n_latent) {
    coda::traceplot(mod$mcmc.sp[[j]][,ncol(X)+l])
    coda::densplot(mod$mcmc.sp[[j]][,ncol(X)+l],
                   main=paste(colnames(mod$mcmc.sp[[j]])
                              [ncol(X)+l],", species : ",j))
    abline(v=lambda.target[l,j],col='red')
  }
}
dev.off()

# Species effects beta and factor loadings lambda
par(mfrow=c(1,2))
plot(t(beta.target), mean_beta,
     main="species effect beta",
     xlab ="obs", ylab ="fitted")
abline(a=0,b=1,col='red')
plot(t(lambda.target), mean_lambda,
     main="factor loadings lambda",
     xlab ="obs", ylab ="fitted")
abline(a=0,b=1,col='red')

## W latent variables
par(mfrow=c(1,2))
for (l in 1:n_latent) {
  plot(W[,l],
       summary(mod$mcmc.latent[[paste0("lv_",l)]])[[1]][,"Mean"],
       main = paste0("Latent variable W_", l),
       xlab ="obs", ylab ="fitted")
  abline(a=0,b=1,col='red')
}

## alpha
par(mfrow=c(1,3))
plot(alpha.target, summary(mod$mcmc.alpha)[[1]][,"Mean"],
     xlab ="obs", ylab ="fitted", main="site effect alpha")
abline(a=0,b=1,col='red')

## Valpha
coda::traceplot(mod$mcmc.V_alpha)
coda::densplot(mod$mcmc.V_alpha)
abline(v=V_alpha.target,col='red')

## Variance of residuals
par(mfrow=c(1,2))
coda::traceplot(mod$mcmc.V)
coda::densplot(mod$mcmc.V,
              main="Variance of residuals")
abline(v=V.target, col='red')

## Deviance
summary(mod$mcmc.Deviance)
plot(mod$mcmc.Deviance)

#= Predictions
par(mfrow=c(1,1))
plot(Y, mod$Y_pred,
     main="Response variable",xlab="obs",ylab="fitted")
abline(a=0,b=1,col='red')
par(oldpar)

</code></pre>

<hr>
<h2 id='jSDM_poisson_log'>Poisson regression with log link function</h2><span id='topic+jSDM_poisson_log'></span>

<h3>Description</h3>

<p>The <code>jSDM_poisson_log</code> function performs a Poisson regression with log link function in a Bayesian framework. 
The function calls a Gibbs sampler written in 'C++' code which uses an adaptive Metropolis algorithm to estimate the conditional posterior distribution of model's parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>jSDM_poisson_log(
  burnin = 5000,
  mcmc = 10000,
  thin = 10,
  count_data,
  site_data,
  site_formula,
  trait_data = NULL,
  trait_formula = NULL,
  n_latent = 0,
  site_effect = "none",
  beta_start = 0,
  gamma_start = 0,
  lambda_start = 0,
  W_start = 0,
  alpha_start = 0,
  V_alpha = 1,
  shape_Valpha = 0.5,
  rate_Valpha = 5e-04,
  mu_beta = 0,
  V_beta = 10,
  mu_gamma = 0,
  V_gamma = 10,
  mu_lambda = 0,
  V_lambda = 10,
  ropt = 0.44,
  seed = 1234,
  verbose = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="jSDM_poisson_log_+3A_burnin">burnin</code></td>
<td>
<p>The number of burnin iterations for the sampler.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_mcmc">mcmc</code></td>
<td>
<p>The number of Gibbs iterations for the sampler. Total number of Gibbs iterations is equal to <code>burnin+mcmc</code>.<br />
<code>burnin+mcmc</code> must be divisible by 10 and superior or equal to 100 so that the progress bar can be displayed.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_thin">thin</code></td>
<td>
<p>The thinning interval used in the simulation. The number of mcmc iterations must be divisible by this value.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_count_data">count_data</code></td>
<td>
<p>A matrix <code class="reqn">n_{site} \times n_{species}</code> indicating the abundance of each species on each site.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_site_data">site_data</code></td>
<td>
<p>A data frame containing the model's explanatory variables by site.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_site_formula">site_formula</code></td>
<td>
<p>A one-sided formula of the form '~x1+...+xp' specifying the explanatory variables for the suitability process of the model,<br />
used to form the design matrix <code class="reqn">X</code> of size <code class="reqn">n_{site} \times np</code>.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_trait_data">trait_data</code></td>
<td>
<p>A data frame containing the species traits which can be included as part of the model.<br />
Default to <code>NULL</code> to fit a model without species traits.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_trait_formula">trait_formula</code></td>
<td>
<p>A one-sided formula of the form '~ t1 + ... + tk + x1:t1 + ... + xp:tk' specifying the interactions between the environmental variables and the species traits to be considered in the model,<br />
used to form the trait design matrix <code class="reqn">Tr</code> of size <code class="reqn">n_{species} \times nt</code> <br /> 
and to set to <code class="reqn">0</code> the <code class="reqn">\gamma</code> parameters corresponding to interactions not taken into account according to the formula. 
Default to <code>NULL</code> to fit a model with all possible interactions between species traits found in <code>trait_data</code> and environmental variables defined by <code>site_formula</code>.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_n_latent">n_latent</code></td>
<td>
<p>An integer which specifies the number of latent variables to generate. Defaults to <code class="reqn">0</code>.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_site_effect">site_effect</code></td>
<td>
<p>A string indicating whether row effects are included as fixed effects (<code>"fixed"</code>), as random effects (<code>"random"</code>),<br />
or not included (<code>"none"</code>) in the model. 
If fixed effects, then for parameter identifiability the first row effect is set to zero, which analogous to acting as a reference level when dummy variables are used.
If random effects, they are drawn from a normal distribution with mean zero and unknown variance, analogous to a random intercept in mixed models. Defaults to <code>"none"</code>.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_beta_start">beta_start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters of the suitability process for each species must be either a scalar or a <code class="reqn">np \times n_{species}</code> matrix. 
If <code>beta_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">\beta</code> parameters.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_gamma_start">gamma_start</code></td>
<td>
<p>Starting values for <code class="reqn">\gamma</code> parameters that represent the influence of species-specific traits on species' responses <code class="reqn">\beta</code>,
<code>gamma_start</code> must be either a scalar, a vector of length <code class="reqn">nt</code>, <code class="reqn">np</code> or <code class="reqn">nt.np</code> or a <code class="reqn">nt \times np</code> matrix.
If <code>gamma_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">\gamma</code> parameters.
If <code>gamma_start</code> is a vector of length <code class="reqn">nt</code> or <code class="reqn">nt.np</code> the resulting <code class="reqn">nt \times np</code> matrix is filled by column with specified values,
if a <code class="reqn">np</code>-length vector is given, the matrix is filled by row.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_lambda_start">lambda_start</code></td>
<td>
<p>Starting values for <code class="reqn">\lambda</code> parameters corresponding to the latent variables for each species must be either a scalar
or a <code class="reqn">n_{latent} \times n_{species}</code> upper triangular matrix with strictly positive values on the diagonal,
ignored if <code>n_latent=0</code>.
If <code>lambda_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">\lambda</code> parameters except those concerned by the constraints explained above.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_w_start">W_start</code></td>
<td>
<p>Starting values for latent variables must be either a scalar or a <code class="reqn">nsite \times n_latent</code> matrix, ignored if <code>n_latent=0</code>.
If <code>W_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">W_{il}</code> with <code class="reqn">i=1,\ldots,n_{site}</code> and <code class="reqn">l=1,\ldots,n_{latent}</code>.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_alpha_start">alpha_start</code></td>
<td>
<p>Starting values for random site effect parameters must be either a scalar or a <code class="reqn">n_{site}</code>-length vector, ignored if <code>site_effect="none"</code>.
If <code>alpha_start</code> takes a scalar value, then that value will serve for all of the <code class="reqn">\alpha</code> parameters.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_v_alpha">V_alpha</code></td>
<td>
<p>Starting value for variance of random site effect if <code>site_effect="random"</code> or constant variance of the Gaussian prior distribution for the fixed site effect if 
<code>site_effect="fixed"</code>. Must be a strictly positive scalar, ignored if <code>site_effect="none"</code>.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_shape_valpha">shape_Valpha</code></td>
<td>
<p>Shape parameter of the Inverse-Gamma prior for the random site effect variance <code>V_alpha</code>, ignored if <code>site_effect="none"</code> or <code>site_effect="fixed"</code>. 
Must be a strictly positive scalar. Default to 0.5 for weak informative prior.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_rate_valpha">rate_Valpha</code></td>
<td>
<p>Rate parameter of the Inverse-Gamma prior for the random site effect variance <code>V_alpha</code>, ignored if <code>site_effect="none"</code> or <code>site_effect="fixed"</code>
Must be a strictly positive scalar. Default to 0.0005 for weak informative prior.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_mu_beta">mu_beta</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\beta</code> parameters of the suitability process. <code>mu_beta</code> must be either a scalar or a <code class="reqn">np</code>-length vector.
If <code>mu_beta</code> takes a scalar value, then that value will serve as the prior mean for all of the <code class="reqn">\beta</code> parameters.
The default value is set to 0 for an uninformative prior, ignored if <code>trait_data</code> is specified.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_v_beta">V_beta</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\beta</code> parameters of the suitability process.
<code>V_beta</code> must be either a scalar or a <code class="reqn">np \times np</code> symmetric positive semi-definite square matrix.
If <code>V_beta</code> takes a scalar value, then that value will serve as the prior variance for all of the <code class="reqn">\beta</code> parameters,
so the variance covariance matrix used in this case is diagonal with the specified value on the diagonal. 
The default variance is large and set to 10 for an uninformative flat prior.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_mu_gamma">mu_gamma</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\gamma</code> parameters.
<code>mu_gamma</code> must be either a scalar, a vector of length <code class="reqn">nt</code>, <code class="reqn">np</code> or <code class="reqn">nt.np</code> or a <code class="reqn">nt \times np</code> matrix.
If <code>mu_gamma</code> takes a scalar value, then that value will serve as the prior mean for all of the <code class="reqn">\gamma</code> parameters.
If <code>mu_gamma</code> is a vector of length <code class="reqn">nt</code> or <code class="reqn">nt.np</code> the resulting <code class="reqn">nt \times np</code> matrix is filled by column with specified values,
if a <code class="reqn">np</code>-length vector is given, the matrix is filled by row. 
The default value is set to 0 for an uninformative prior, ignored if <code>trait_data=NULL</code>.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_v_gamma">V_gamma</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\gamma</code> parameters.
<code>V_gamma</code> must be either a scalar, a vector of length <code class="reqn">nt</code>, <code class="reqn">np</code> or <code class="reqn">nt.np</code> or a <code class="reqn">nt \times np</code> positive matrix.
If <code>V_gamma</code> takes a scalar value, then that value will serve as the prior variance for all of the <code class="reqn">\gamma</code> parameters.
If <code>V_gamma</code> is a vector of length <code class="reqn">nt</code> or <code class="reqn">nt.np</code> the resulting <code class="reqn">nt \times np</code> matrix is filled by column with specified values,
if a <code class="reqn">np</code>-length vector is given, the matrix is filled by row. 
The default variance is large and set to 10 for an uninformative flat prior, ignored if <code>trait_data=NULL</code>.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_mu_lambda">mu_lambda</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\lambda</code> parameters corresponding to the latent variables. 
<code>mu_lambda</code> must be either a scalar or a <code class="reqn">n_{latent}</code>-length vector. 
If <code>mu_lambda</code> takes a scalar value, then that value will serve as the prior mean for all of the <code class="reqn">\lambda</code> parameters.
The default value is set to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_v_lambda">V_lambda</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\lambda</code> parameters corresponding to the latent variables.
<code>V_lambda</code> must be either a scalar or a <code class="reqn">n_{latent} \times n_{latent}</code> symmetric positive semi-definite square matrix.
If <code>V_lambda</code> takes a scalar value, then that value will serve as the prior variance for all of <code class="reqn">\lambda</code> parameters,
so the variance covariance matrix used in this case is diagonal with the specified value on the diagonal.
The default variance is large and set to 10 for an uninformative flat prior.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_ropt">ropt</code></td>
<td>
<p>Target acceptance rate for the adaptive Metropolis algorithm. Default to 0.44.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_seed">seed</code></td>
<td>
<p>The seed for the random number generator. Default to 1234.</p>
</td></tr>
<tr><td><code id="jSDM_poisson_log_+3A_verbose">verbose</code></td>
<td>
<p>A switch (0,1) which determines whether or not the progress of the sampler is printed to the screen. Default is 1: a progress bar is printed, indicating the step (in %) reached by the Gibbs sampler.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We model an ecological process where the presence or absence of species <code class="reqn">j</code> on site <code class="reqn">i</code> is explained by habitat suitability.
</p>
<p><b>Ecological process : </b>
</p>
<p style="text-align: center;"><code class="reqn">y_{ij} \sim \mathcal{P}oisson(\theta_{ij})</code>
</p>

<p>where </p>

<table>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="none"</code> </td><td style="text-align: left;"> log<code class="reqn">(\theta_{ij}) =  X_i \beta_j</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="none"</code> </td><td style="text-align: left;"> log<code class="reqn">(\theta_{ij}) =  X_i \beta_j + W_i \lambda_j</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="fixed"</code> </td><td style="text-align: left;"> log<code class="reqn">(\theta_{ij}) = X_i \beta_j  + \alpha_i</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="fixed"</code> </td><td style="text-align: left;"> log<code class="reqn">(\theta_{ij}) = X_i \beta_j + W_i \lambda_j + \alpha_i</code>  </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="random"</code> </td><td style="text-align: left;"> log<code class="reqn">(\theta_{ij}) = X_i \beta_j  + \alpha_i</code> and <code class="reqn">\alpha_i \sim \mathcal{N}(0,V_\alpha)</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="random"</code> </td><td style="text-align: left;"> log<code class="reqn">(\theta_{ij}) = X_i \beta_j + W_i \lambda_j + \alpha_i</code> and <code class="reqn">\alpha_i \sim \mathcal{N}(0,V_\alpha)</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>In the absence of data on species traits (<code>trait_data=NULL</code>), the effect of species <code class="reqn">j</code>: <code class="reqn">\beta_j</code>;
follows the same <em>a priori</em> Gaussian distribution such that <code class="reqn">\beta_j \sim \mathcal{N}_{np}(\mu_{\beta},V_{\beta})</code>,
for each species. 
</p>
<p>If species traits data are provided, the effect of species <code class="reqn">j</code>: <code class="reqn">\beta_j</code>;
follows an <em>a priori</em> Gaussian distribution such that <code class="reqn">\beta_j \sim \mathcal{N}_{np}(\mu_{\beta_j},V_{\beta})</code>,
where <code class="reqn">\mu_{\beta_jp} = \sum_{k=1}^{nt} t_{jk}.\gamma_{kp}</code>, takes different values for each species.
</p>
<p>We assume that <code class="reqn">\gamma_{kp} \sim \mathcal{N}(\mu_{\gamma_{kp}},V_{\gamma_{kp}})</code> as prior distribution.   
</p>
<p>We define the matrix <code class="reqn">\gamma=(\gamma_{kp})_{k=1,...,nt}^{p=1,...,np}</code> such as : 
</p>

<table>
<tr>
 <td style="text-align: right;">
</td><td style="text-align: center;"> <strong><code class="reqn">x_0</code></strong> </td><td style="text-align: center;"> <strong><code class="reqn">x_1</code></strong> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <strong><code class="reqn">x_p</code></strong> </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> <strong><code class="reqn">x_{np}</code></strong> </td><td style="text-align: left;">  </td>
</tr>
<tr>
 <td style="text-align: right;"> 
</td><td style="text-align: center;">__________</td><td style="text-align: center;">________</td><td style="text-align: center;">________</td><td style="text-align: center;">________</td><td style="text-align: center;">________</td><td style="text-align: center;">________</td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
<strong><code class="reqn">t_0</code></strong> | </td><td style="text-align: center;">  <strong><code class="reqn">\gamma_{0,0}</code></strong> </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{0,1}</code></em> </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{0,p}</code></em> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{0,np}</code></em> </td><td style="text-align: left;"> { <em>effect of </em> </td>
</tr>
<tr>
 <td style="text-align: right;">
  | </td><td style="text-align: center;"> <strong>intercept</strong> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: left;"> <em>environmental</em> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
  | </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: left;"> <em>   variables</em> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
  <strong><code class="reqn">t_1</code></strong> | </td><td style="text-align: center;">  <code class="reqn">\gamma_{1,0}</code> </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{1,1}</code></em> </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{1,p}</code></em> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{1,np}</code></em> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;">
  ... | </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
  <strong><code class="reqn">t_k</code></strong> | </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{k,0}</code></em> </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{k,1}</code></em> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <code class="reqn">\gamma_{k,p}</code> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <code class="reqn">\gamma_{k,np}</code> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;">
  ... | </td><td style="text-align: center;"> ... </td><td style="text-align: center;">  ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: center;"> ... </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
  <strong><code class="reqn">t_{nt}</code></strong> | </td><td style="text-align: center;"> <em><code class="reqn">\gamma_{nt,0}</code></em> </td><td style="text-align: center;"> <code class="reqn">\gamma_{nt,1}</code></td><td style="text-align: center;"> ... </td><td style="text-align: center;"> <code class="reqn">\gamma_{nt,p}</code> </td><td style="text-align: center;">... </td><td style="text-align: center;"> <code class="reqn">\gamma_{nt,np}</code> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;">
  </td><td style="text-align: center;"> <em>average</em> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: center;"> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
  </td><td style="text-align: center;"> <em>trait effect</em> </td><td style="text-align: center;"> </td><td style="text-align: center;"> interaction </td><td style="text-align: center;"> traits </td><td style="text-align: center;"> environment </td><td style="text-align: center;"> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: right;"> 
</td>
</tr>

</table>



<h3>Value</h3>

<p>An object of class <code>"jSDM"</code> acting like a list including : 
</p>
<table>
<tr><td><code>mcmc.alpha</code></td>
<td>
<p>An mcmc object that contains the posterior samples for site effects <code class="reqn">\alpha_i</code>, not returned if <code>site_effect="none"</code>.</p>
</td></tr>
<tr><td><code>mcmc.V_alpha</code></td>
<td>
<p>An mcmc object that contains the posterior samples for variance of random site effect, not returned if <code>site_effect="none"</code> or  <code>site_effect="fixed"</code>.</p>
</td></tr>
<tr><td><code>mcmc.latent</code></td>
<td>
<p>A list by latent variable of mcmc objects that contains the posterior samples for latent variables <code class="reqn">W_l</code> with <code class="reqn">l=1,\ldots,n_{latent}</code>, not returned if <code>n_latent=0</code>.</p>
</td></tr>
<tr><td><code>mcmc.sp</code></td>
<td>
<p>A list by species of mcmc objects that contains the posterior samples for species effects <code class="reqn">\beta_j</code> and <code class="reqn">\lambda_j</code> if <code>n_latent&gt;0</code>.</p>
</td></tr>
<tr><td><code>mcmc.gamma</code></td>
<td>
<p>A list by covariates of mcmc objects that contains the posterior samples for <code class="reqn">\gamma_p</code> parameters with <code class="reqn">p=1,\ldots,np</code> if <code>trait_data</code> is specified.</p>
</td></tr>
<tr><td><code>mcmc.Deviance</code></td>
<td>
<p>The posterior sample of the deviance (<code class="reqn">D</code>) is also provided, with <code class="reqn">D</code> defined as : <code class="reqn">D=-2\log(\prod_{ij} P(y_{ij}|\beta_j,\lambda_j, \alpha_i, W_i))</code>.</p>
</td></tr> 
<tr><td><code>log_theta_latent</code></td>
<td>
<p>Predictive posterior mean of the probability to each species to be present on each site, transformed by log link function.</p>
</td></tr>
<tr><td><code>theta_latent</code></td>
<td>
<p>Predictive posterior mean of the probability to each species to be present on each site.</p>
</td></tr>
<tr><td><code>model_spec</code></td>
<td>
<p>Various attributes of the model fitted, including the response and model matrix used, distributional assumptions as link function, family and number of latent variables, hyperparameters used in the Bayesian estimation and mcmc, burnin and thin.</p>
</td></tr>
</table>
<p>The <code>mcmc.</code> objects can be summarized by functions provided by the <code>coda</code> package.
</p>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent &lt;ghislain.vieilledent@cirad.fr&gt;
</p>
<p>Jeanne Clément &lt;jeanne.clement16@laposte.net&gt;
</p>


<h3>References</h3>

<p>Gelfand, A. E.; Schmidt, A. M.; Wu, S.; Silander, J. A.; Latimer, A. and Rebelo, A. G. (2005) Modelling species diversity through species level hierarchical modelling. <em>Applied Statistics</em>, 54, 1-20.
</p>
<p>Latimer, A. M.; Wu, S. S.; Gelfand, A. E. and Silander, J. A. (2006) Building statistical models to analyze species distributions. <em>Ecological Applications</em>, 16, 33-50.
</p>
<p>Ovaskainen, O., Tikhonov, G., Norberg, A., Blanchet, F. G., Duan, L., Dunson, D., Roslin, T. and Abrego, N. (2017) How to make more out of community data? A conceptual framework and its implementation as models and software. <em>Ecology Letters</em>, 20, 561-576.
</p>


<h3>See Also</h3>

<p><code><a href="coda.html#topic+plot.mcmc">plot.mcmc</a></code>, <code><a href="coda.html#topic+summary.mcmc">summary.mcmc</a></code> <code><a href="#topic+jSDM_binomial_probit">jSDM_binomial_probit</a></code>  <code><a href="#topic+jSDM_binomial_logit">jSDM_binomial_logit</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#==============================================
# jSDM_poisson_log()
# Example with simulated data
#==============================================

#=================
#== Load libraries
library(jSDM)

#==================
#== Data simulation

#= Number of sites
nsite &lt;- 50
#= Number of species
nsp &lt;- 10
#= Set seed for repeatability
seed &lt;- 1234

#= Ecological process (suitability)
set.seed(seed)
x1 &lt;- rnorm(nsite,0,1)
set.seed(2*seed)
x2 &lt;- rnorm(nsite,0,1)
X &lt;- cbind(rep(1,nsite),x1,x2)
np &lt;- ncol(X)
set.seed(3*seed)
W &lt;- cbind(rnorm(nsite,0,1),rnorm(nsite,0,1))
n_latent &lt;- ncol(W)
l.zero &lt;- 0
l.diag &lt;- runif(2,0,1)
l.other &lt;- runif(nsp*2-3,-1,1)
lambda.target &lt;- matrix(c(l.diag[1],l.zero,l.other[1],
                          l.diag[2],l.other[-1]),
                        byrow=TRUE, nrow=nsp)
beta.target &lt;- matrix(runif(nsp*np,-1,1), byrow=TRUE, nrow=nsp)
V_alpha.target &lt;- 0.5
alpha.target &lt;- rnorm(nsite,0,sqrt(V_alpha.target))
log.theta &lt;- X %*% t(beta.target) + W %*% t(lambda.target) + alpha.target
theta &lt;- exp(log.theta)
Y &lt;- apply(theta, 2, rpois, n=nsite)

#= Site-occupancy model
# Increase number of iterations (burnin and mcmc) to get convergence
mod &lt;- jSDM_poisson_log(# Chains
                        burnin=200,
                        mcmc=200,
                        thin=1,
                        # Response variable
                        count_data=Y,
                        # Explanatory variables
                        site_formula=~x1+x2,
                        site_data=X,
                        n_latent=n_latent,
                        site_effect="random",
                        # Starting values
                        beta_start=0,
                        lambda_start=0,
                        W_start=0,
                        alpha_start=0,
                        V_alpha=1,
                        # Priors
                        shape_Valpha=0.5,
                        rate_Valpha=0.0005,
                        mu_beta=0,
                        V_beta=10,
                        mu_lambda=0,
                        V_lambda=10,
                        # Various
                        seed=1234,
                        ropt=0.44,
                        verbose=1)
#==========
#== Outputs

oldpar &lt;- par(no.readonly = TRUE)

#= Parameter estimates

## beta_j
mean_beta &lt;- matrix(0,nsp,np)
pdf(file=file.path(tempdir(), "Posteriors_beta_jSDM_log.pdf"))
par(mfrow=c(ncol(X),2))
for (j in 1:nsp) {
  mean_beta[j,] &lt;- apply(mod$mcmc.sp[[j]][,1:ncol(X)],
                         2, mean)
  for (p in 1:ncol(X)) {
    coda::traceplot(mod$mcmc.sp[[j]][,p])
    coda::densplot(mod$mcmc.sp[[j]][,p],
      main = paste(colnames(
        mod$mcmc.sp[[j]])[p],
        ", species : ",j))
    abline(v=beta.target[j,p],col='red')
  }
}
dev.off()

## lambda_j
mean_lambda &lt;- matrix(0,nsp,n_latent)
pdf(file=file.path(tempdir(), "Posteriors_lambda_jSDM_log.pdf"))
par(mfrow=c(n_latent*2,2))
for (j in 1:nsp) {
  mean_lambda[j,] &lt;- apply(mod$mcmc.sp[[j]]
                           [,(ncol(X)+1):(ncol(X)+n_latent)], 2, mean)
  for (l in 1:n_latent) {
    coda::traceplot(mod$mcmc.sp[[j]][,ncol(X)+l])
    coda::densplot(mod$mcmc.sp[[j]][,ncol(X)+l],
                   main=paste(colnames(mod$mcmc.sp[[j]])
                              [ncol(X)+l],", species : ",j))
    abline(v=lambda.target[j,l],col='red')
  }
}
dev.off()

# Species effects beta and factor loadings lambda
par(mfrow=c(1,2))
plot(beta.target, mean_beta,
     main="species effect beta",
     xlab ="obs", ylab ="fitted")
abline(a=0,b=1,col='red')
plot(lambda.target, mean_lambda,
     main="factor loadings lambda",
     xlab ="obs", ylab ="fitted")
abline(a=0,b=1,col='red')

## W latent variables
par(mfrow=c(1,2))
for (l in 1:n_latent) {
  plot(W[,l],
       summary(mod$mcmc.latent[[paste0("lv_",l)]])[[1]][,"Mean"],
       main = paste0("Latent variable W_", l),
       xlab ="obs", ylab ="fitted")
  abline(a=0,b=1,col='red')
}

## alpha
par(mfrow=c(1,3))
plot(alpha.target, summary(mod$mcmc.alpha)[[1]][,"Mean"],
     xlab ="obs", ylab ="fitted", main="site effect alpha")
abline(a=0,b=1,col='red')
## Valpha
coda::traceplot(mod$mcmc.V_alpha)
coda::densplot(mod$mcmc.V_alpha)
abline(v=V_alpha.target,col='red')

## Deviance
summary(mod$mcmc.Deviance)
plot(mod$mcmc.Deviance)

#= Predictions
par(mfrow=c(1,2))
plot(log.theta, mod$log_theta_latent,
     main="log(theta)",
     xlab="obs", ylab="fitted")
abline(a=0 ,b=1, col="red")
plot(theta, mod$theta_latent,
     main="Expected abundance theta",
     xlab="obs", ylab="fitted")
abline(a=0 ,b=1, col="red")
par(oldpar)

</code></pre>

<hr>
<h2 id='jSDM-package'>joint species distribution models</h2><span id='topic+jSDM-package'></span>

<h3>Description</h3>

<p><code>jSDM</code> is an R package for fitting joint species distribution models (JSDM) in a hierarchical Bayesian framework.
</p>
<p>The Gibbs sampler is written in 'C++'. It uses 'Rcpp', 'Armadillo' and 'GSL' to maximize computation efficiency.
</p>

<table>
<tr>
 <td style="text-align: left;">
   Package: </td><td style="text-align: left;"> jSDM</td>
</tr>
<tr>
 <td style="text-align: left;">
   Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
   Version: </td><td style="text-align: left;"> 0.2.1</td>
</tr>
<tr>
 <td style="text-align: left;">
   Date: </td><td style="text-align: left;"> 2019-01-11</td>
</tr>
<tr>
 <td style="text-align: left;">
   License: </td><td style="text-align: left;"> GPL-3 </td>
</tr>
<tr>
 <td style="text-align: left;">
   LazyLoad: </td><td style="text-align: left;"> yes</td>
</tr>
<tr>
 <td style="text-align: left;"> </td>
</tr>

</table>



<h3>Details</h3>

<p>The package includes the following functions to fit various species distribution models :
</p>

<table>
<tr>
 <td style="text-align: left;">
   function </td><td style="text-align: left;"> data-type </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+jSDM_binomial_logit">jSDM_binomial_logit</a></code> </td><td style="text-align: left;"> presence-absence </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+jSDM_binomial_probit">jSDM_binomial_probit</a></code> </td><td style="text-align: left;"> presence-absence </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+jSDM_binomial_probit_sp_constrained">jSDM_binomial_probit_sp_constrained</a></code>  </td><td style="text-align: left;"> presence-absence </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+jSDM_binomial_probit_long_format">jSDM_binomial_probit_long_format</a></code> </td><td style="text-align: left;"> presence-absence </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+jSDM_poisson_log">jSDM_poisson_log</a></code> </td><td style="text-align: left;"> abundance </td>
</tr>
<tr>
 <td style="text-align: left;"> </td>
</tr>

</table>


<ul>
<li> <p><code><a href="#topic+jSDM_binomial_probit">jSDM_binomial_probit</a></code> : <br />
<br />
<b>Ecological process:</b>
</p>
<p style="text-align: center;"><code class="reqn">y_{ij} \sim \mathcal{B}ernoulli(\theta_{ij})</code>
</p>

<p>where </p>

<table>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="none"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_{ij}) = X_i \beta_j</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="none"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_{ij}) =  X_i \beta_j + W_i \lambda_j</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="fixed"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_{ij}) =  X_i \beta_j  + \alpha_i</code>  and <code class="reqn">\alpha_i \sim \mathcal{N}(0,V_\alpha)</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="fixed"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_{ij}) =  X_i \beta_j + W_i \lambda_j + \alpha_i</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="random"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_{ij}) =  X_i \beta_j  + \alpha_i</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="random"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_{ij}) =  X_i \beta_j + W_i \lambda_j + \alpha_i</code> and <code class="reqn">\alpha_i \sim \mathcal{N}(0,V_\alpha)</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

</li>
<li> <p><code><a href="#topic+jSDM_binomial_probit_sp_constrained">jSDM_binomial_probit_sp_constrained</a></code> : <br />
<br />
This function allows to fit the same models than the function <code><a href="#topic+jSDM_binomial_probit">jSDM_binomial_probit</a></code> except for models not including latent variables, indeed <code>n_latent</code> must be greater than zero in this function. 
At first, the function fit a JSDM with the constrained species arbitrarily chosen as the first ones in the presence-absence data-set.
Then, the function evaluates the convergence of MCMC <code class="reqn">\lambda</code> chains using the Gelman-Rubin convergence diagnostic (<code class="reqn">\hat{R}</code>).
It identifies the species (<code class="reqn">\hat{j}_l</code>) having the higher <code class="reqn">\hat{R}</code> for <code class="reqn">\lambda_{\hat{j}_l}</code>.
These species drive the structure of the latent axis <code class="reqn">l</code>.
The <code class="reqn">\lambda</code> corresponding to this species are constrained to be positive and placed on the diagonal of the <code class="reqn">\Lambda</code> matrix for fitting a second model.
This usually improves the convergence of the latent variables and factor loadings. The function returns the parameter posterior distributions for this second model.

</p>
</li>
<li> <p><code><a href="#topic+jSDM_binomial_logit">jSDM_binomial_logit</a></code> : <br />
<br />
<b>Ecological process : </b>
</p>
<p style="text-align: center;"><code class="reqn">y_{ij} \sim \mathcal{B}inomial(\theta_{ij},t_i)</code>
</p>

<p>where </p>

<table>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="none"</code> </td><td style="text-align: left;"> logit<code class="reqn">(\theta_{ij}) =  X_i \beta_j</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="none"</code> </td><td style="text-align: left;"> logit<code class="reqn">(\theta_{ij}) =  X_i \beta_j + W_i \lambda_j</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="fixed"</code> </td><td style="text-align: left;"> logit<code class="reqn">(\theta_{ij}) =  X_i \beta_j  + \alpha_i</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="fixed"</code> </td><td style="text-align: left;"> logit<code class="reqn">(\theta_{ij}) =  X_i \beta_j + W_i \lambda_j + \alpha_i</code>  </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="random"</code> </td><td style="text-align: left;"> logit<code class="reqn">(\theta_{ij}) =  X_i \beta_j  + \alpha_i</code> and <code class="reqn">\alpha_i \sim \mathcal{N}(0,V_\alpha)</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="random"</code> </td><td style="text-align: left;"> logit<code class="reqn">(\theta_{ij}) =  X_i \beta_j + W_i \lambda_j + \alpha_i</code> and <code class="reqn">\alpha_i \sim \mathcal{N}(0,V_\alpha)</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

</li>
<li> <p><code><a href="#topic+jSDM_poisson_log">jSDM_poisson_log</a></code> : <br />
<br />
<b>Ecological process : </b>
</p>
<p style="text-align: center;"><code class="reqn">y_{ij} \sim \mathcal{P}oisson(\theta_{ij})</code>
</p>

<p>where </p>

<table>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="none"</code> </td><td style="text-align: left;"> log<code class="reqn">(\theta_{ij}) =  X_i \beta_j</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="none"</code> </td><td style="text-align: left;"> log<code class="reqn">(\theta_{ij}) =  X_i \beta_j + W_i \lambda_j</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="fixed"</code> </td><td style="text-align: left;"> log<code class="reqn">(\theta_{ij}) =  X_i \beta_j  + \alpha_i</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="fixed"</code> </td><td style="text-align: left;"> log<code class="reqn">(\theta_{ij}) =  X_i \beta_j + W_i \lambda_j + \alpha_i</code>  </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="random"</code> </td><td style="text-align: left;"> log<code class="reqn">(\theta_{ij}) =  X_i \beta_j  + \alpha_i</code> and <code class="reqn">\alpha_i \sim \mathcal{N}(0,V_\alpha)</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="random"</code> </td><td style="text-align: left;"> log<code class="reqn">(\theta_{ij}) =  X_i \beta_j + W_i \lambda_j + \alpha_i</code> and <code class="reqn">\alpha_i \sim \mathcal{N}(0,V_\alpha)</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

</li>
<li> <p><code><a href="#topic+jSDM_binomial_probit_long_format">jSDM_binomial_probit_long_format</a></code> : <br />
<br />
<b>Ecological process:</b>
</p>
<p style="text-align: center;"><code class="reqn">y_n \sim \mathcal{B}ernoulli(\theta_n)</code>
</p>
<p> such as <code class="reqn">species_n=j</code> and <code class="reqn">site_n=i</code>,
where </p>

<table>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="none"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_n) = D_n \gamma + X_n \beta_j</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="none"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_n) = D_n \gamma + X_n \beta_j +  W_i \lambda_j</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="fixed"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_n) = D_n \gamma + X_n \beta_j + \alpha_i</code>  and <code class="reqn">\alpha_i \sim \mathcal{N}(0,V_\alpha)</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="fixed"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_n) = D_n \gamma + X_n  \beta_j +  W_i \lambda_j + \alpha_i</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent=0</code> and <code>site_effect="random"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_n) = D_n \gamma + X_n \beta_j + \alpha_i</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 if <code>n_latent&gt;0</code> and <code>site_effect="random"</code> </td><td style="text-align: left;"> probit<code class="reqn">(\theta_n) = D_n \gamma + X_n  \beta_j +  W_i \lambda_j + \alpha_i</code> and <code class="reqn">\alpha_i \sim \mathcal{N}(0,V_\alpha)</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

</li></ul>



<h3>Author(s)</h3>

<p>Ghislain Vieilledent &lt;ghislain.vieilledent@cirad.fr&gt;
</p>
<p>Jeanne Clément &lt;jeanne.clement16@laposte.net&gt;
</p>
<p>Frédéric Gosselin &lt;frederic.gosselin@inrae.fr&gt;
</p>


<h3>References</h3>

<p>Chib, S. and Greenberg, E. (1998) Analysis of multivariate probit models. <em>Biometrika</em>, 85, 347-361. 
</p>
<p>Warton, D. I.; Blanchet, F. G.; O'Hara, R. B.; O'Hara, R. B.; Ovaskainen, O.; Taskinen, S.; Walker, S. C. and Hui, F. K. C. (2015) So Many Variables: Joint Modeling in Community Ecology. <em>Trends in Ecology &amp; Evolution</em>, 30, 766-779.
</p>
<p>Ovaskainen, O., Tikhonov, G., Norberg, A., Blanchet, F. G., Duan, L., Dunson, D., Roslin, T. and Abrego, N. (2017) How to make more out of community data? A conceptual framework and its implementation as models and software. <em>Ecology Letters</em>, 20, 561-576.
</p>

<hr>
<h2 id='logit'>Generalized logit function</h2><span id='topic+logit'></span>

<h3>Description</h3>

<p>Compute generalized logit function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>logit(x, min = 0, max = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="logit_+3A_x">x</code></td>
<td>
<p>value(s) to be transformed</p>
</td></tr>
<tr><td><code id="logit_+3A_min">min</code></td>
<td>
<p>Lower end of logit interval</p>
</td></tr>
<tr><td><code id="logit_+3A_max">max</code></td>
<td>
<p>Upper end of logit interval</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The generalized logit function takes values on <code class="reqn">[min, max]</code> and transforms them to span <code class="reqn">[ -\infty, +\infty ]</code> it is defined as:
</p>
<p style="text-align: center;"><code class="reqn">y = log(\frac{p}{(1-p)})</code>
</p>
 
<p style="text-align: center;"><code class="reqn">where</code>
</p>

<p style="text-align: center;"><code class="reqn">p=\frac{(x-min)}{(max-min)}</code>
</p>



<h3>Value</h3>

<p>y Transformed value(s).
</p>


<h3>Author(s)</h3>

<p>Gregory R. Warnes &lt;greg@warnes.net&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- seq(0,10, by=0.25)
xt &lt;- jSDM::logit(x, min=0, max=10)
cbind(x,xt)
y &lt;- jSDM::inv_logit(xt, min=0, max=10)
cbind(x,xt,y)  
</code></pre>

<hr>
<h2 id='madagascar'>Madagascar's forest inventory</h2><span id='topic+madagascar'></span>

<h3>Description</h3>

<p>Dataset compiled from the national forest inventories carried out on 753 sites on the island of Madagascar, listing the presence or absence of 555 plant species on each of these sites between 1994 and 1996.
We use these forest inventories to calculate a matrix indicating the presence by a 1 and the absence by a 0 of the species at each site by removing observations for which the species is not identified. This presence-absence matrix therefore records the occurrences of 483 species at 751 sites.
</p>


<h3>Format</h3>

<p><code>madagascar</code> is a data frame with 751 rows corresponding to the inventory sites and 483 columns corresponding to the species whose presence or absence has been recorded on the sites.
</p>

<dl>
<dt><code>sp_</code></dt><dd><p>1 to 483 indicate by a 0 the absence of the species on one site and by a 1 its presence</p>
</dd> 
<dt><code>site</code></dt><dd><p>&quot;1&quot; to &quot;753&quot; inventory sites identifiers.</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>data(madagascar, package="jSDM")
head(madagascar)
</code></pre>

<hr>
<h2 id='mites'>mites dataset</h2><span id='topic+mites'></span>

<h3>Description</h3>

<p>This example data set is composed of 70 cores of mostly Sphagnum mosses collected on the territory of the Station de biologie des Laurentides of University of  Montreal, Quebec, Canada in June 1989.   
</p>
<p>The whole sampling area was 2.5 m x 10 m in size and thirty-five taxa were recognized as species, though many were not given a species name, owing to the incomplete stage of systematic knowledge of the North American Oribatid fauna.
</p>
<p>The data set comprises the abundances of 35 morphospecies, 5 substrate and micritopographic variables, and the x-y Cartesian coordinates of the 70 sampling sites. 
</p>
<p>See Borcard et al. (1992, 1994) for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("mites")</code></pre>


<h3>Format</h3>

<p> A data frame with 70 observations on the following 42 variables.
</p>

<p>Abundance of <b>35 Oribatid mites morphospecies</b> named : 
</p>
<dl>
<dt><code>Brachy</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>PHTH</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>HPAV</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>RARD</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>SSTR</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>Protopl</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>MEGR</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>MPRO</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>TVIE</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>HMIN</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>HMIN2</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>NPRA</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>TVEL</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>ONOV</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>SUCT</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>LCIL</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>Oribatul1</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>Ceratoz1</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>PWIL</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>Galumna1</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>Steganacarus2</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>HRUF</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>Trhypochth1</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>PPEL</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>NCOR</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>SLAT</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>FSET</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>Lepidozetes</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>Eupelops</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>Minigalumna</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>LRUG</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>PLAG2</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>Ceratoz3</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>Oppia.minus</code></dt><dd><p>a vector of integers</p>
</dd>
<dt><code>Trimalaco2</code></dt><dd><p>a vector of integers</p>
</dd>  
</dl>
<p><b>5 covariates</b> collected on the 70 sites and their coordinates :  
</p>
<dl>
<dt><code>substrate</code></dt><dd><p>a categorical vector indicating substrate type using a 7-level unordered factor :  <code>sph1</code>, <code>sph2</code>, <code>sph3</code>, <code>sph4</code>, <code>litter</code>, <code>peat</code> and <code>inter</code> for interface.</p>
</dd>
<dt><code>shrubs</code></dt><dd><p>a categorical vector indicating shrub density using a 3-level ordered factor : <code>None</code>, <code>Few</code> and <code>Many</code></p>
</dd>
<dt><code>topo</code></dt><dd><p>a categorical vector indicating microtopography using a 2-level factor: <code>blanket</code> or <code>hummock</code></p>
</dd>
<dt><code>density</code></dt><dd><p>a numeric vector indicating the substrate density (g/L)</p>
</dd>
<dt><code>water</code></dt><dd><p>a numeric vector indicating the water content of the substrate (g/L)</p>
</dd>
<dt><code>x</code></dt><dd><p>a numeric vector indicating first coordinates of sampling sites</p>
</dd>
<dt><code>y</code></dt><dd><p>a numeric vector indicating second coordinates of sampling sites</p>
</dd>
</dl>



<h3>Details</h3>

 
<p>Oribatid mites (Acari: Oribatida) are a very diversified group of small (0.2-1.2 mm) soil-dwelling, mostly microphytophagous and detritivorous arthropods. A well aerated soil or a complex substrate like Sphagnum mosses present in bogs and wet forests can harbour up to several hundred thousand individuals per square metre.   
</p>
<p>Local assemblages are sometimes composed of over a hundred species, including many rare ones. This diversity makes oribatid mites an interesting target group to study community-environment relationships at very local scales.
</p>


<h3>Source</h3>

<p> Pierre Legendre  </p>


<h3>References</h3>

<p>Borcard, D.; Legendre, P. and Drapeau, P. (1992) Partialling out the spatial component of ecological variation. <em>Ecology</em> 73: 1045-1055.
</p>
<p>Borcard, D. and Legendre, P. (1994) Environmental control and spatial structure in ecological communities: an example using Oribatid mites (Acari, Oribatei). <em>Environmental and Ecological Statistics</em> 1: 37-61. 
</p>
<p>Borcard, D. and Legendre, P. (2002) All-scale spatial analysis of ecological data by means of principal coordinates of neighbour matrices. <em>Ecological Modelling</em> 153: 51-68.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mites, package="jSDM")
head(mites)
</code></pre>

<hr>
<h2 id='mosquitos'>mosquitos dataset</h2><span id='topic+mosquitos'></span>

<h3>Description</h3>

<p>Presence or absence at 167 sites of 16 species that constitute the aquatic faunal community studied, 13 covariates collected at these sites and their coordinates.</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("mosquitos")</code></pre>


<h3>Format</h3>

<p>A data frame with 167 observations on the following 31 variables : 
</p>

<p><b>16 aquatic species</b> including larvae of four mosquito species (all potential vectors of human disease), which presence on sites is indicated by a 1 and absence by a 0 : 
</p>
<dl>
<dt><code>Culex_pipiens_sl</code></dt><dd><p>a binary vector (mosquito species)</p>
</dd>
<dt><code>Culex_modestus</code></dt><dd><p>a binary vector (mosquito species)</p>
</dd>
<dt><code>Culiseta_annulata</code></dt><dd><p>a binary vector (mosquito species)</p>
</dd>
<dt><code>Anopheles_maculipennis_sl</code></dt><dd><p>a binary vector (mosquito species)</p>
</dd>
<dt><code>waterboatmen__Corixidae</code></dt><dd><p>a binary vector</p>
</dd>
<dt><code>diving_beetles__Dysticidae</code></dt><dd><p>a binary vector</p>
</dd>
<dt><code>damselflies__Zygoptera</code></dt><dd><p>a binary vector</p>
</dd>
<dt><code>swimming_beetles__Haliplidae</code></dt><dd><p>a binary vector</p>
</dd>
<dt><code>opossum_shrimps__Mysidae</code></dt><dd><p>a binary vector</p>
</dd>
<dt><code>ditch_shrimp__Gammarus</code></dt><dd><p>a binary vector</p>
</dd>
<dt><code>beetle_larvae__Coleoptera</code></dt><dd><p>a binary vector</p>
</dd>
<dt><code>dragonflies__Anisoptera</code></dt><dd><p>a binary vector</p>
</dd>
<dt><code>mayflies__Ephemeroptera</code></dt><dd><p>a binary vector</p>
</dd>
<dt><code>newts__Pleurodelinae</code></dt><dd><p>a binary vector</p>
</dd>
<dt><code>fish</code></dt><dd><p>a binary vector</p>
</dd>
<dt><code>saucer_bugs__Ilyocoris</code></dt><dd><p>a binary vector</p>
</dd>  
</dl>
<p><b>13 covariates</b> collected on the 167 sites and their coordinates : 
</p>
<dl>
<dt><code>depth__cm</code></dt><dd><p>a numeric vector corresponding to the water depth in cm recorded as the mean of the depth at the edge and the centre of each dip site</p>
</dd>
<dt><code>temperature__C</code></dt><dd><p>a numeric vector corresponding to the temperature in °C</p>
</dd>
<dt><code>oxidation_reduction_potential__Mv</code></dt><dd><p>a numeric vector corresponding to the redox potential of the water in millivolts (mV)</p>
</dd>
<dt><code>salinity__ppt</code></dt><dd><p>a numeric vector corresponding to the salinity of the water in parts per thousand (ppt)</p>
</dd> 
</dl>
<p>High-resolution digital photographs were taken of vegetation at the edge and centre dip points and the presence or absence of different vegetation types at each dipsite was determined from these photographs using field guides :  
</p>
<dl>
<dt><code>water_crowfoot__Ranunculus</code></dt><dd><p>a binary vector indicating presence on sites by a 1 and absence by a 0 of the plant species Ranunculus aquatilis which common name is water-crowfoot</p>
</dd>
<dt><code>rushes__Juncus_or_Scirpus</code></dt><dd><p>a binary vector indicating presence on sites by a 1 and absence by a 0 of rushes from the Juncus or Scirpus genus</p>
</dd>
<dt><code>filamentous_algae</code></dt><dd><p>a binary vector indicating presence on sites by a 1 and absence by a 0 of filamentous algae</p>
</dd>
<dt><code>emergent_grass</code></dt><dd><p>a binary vector indicating presence on sites by a 1 and absence by a 0 of emergent grass</p>
</dd>
<dt><code>ivy_leafed_duckweed__Lemna_trisulca</code></dt><dd><p>a binary vector indicating presence on sites by a 1 and absence by a 0 of ivy leafed duckweed of species Lemna trisulca</p>
</dd>
<dt><code>bulrushes__Typha</code></dt><dd><p>a binary vector indicating presence on sites by a 1 and absence by a 0 of bulrushes from the Typha genus</p>
</dd>
<dt><code>reeds_Phragmites</code></dt><dd><p>a binary vector indicating presence on sites by a 1 and absence by a 0 of reeds from the Phragmites genus</p>
</dd>
<dt><code>marestail__Hippuris</code></dt><dd><p>a binary vector indicating presence on sites by a 1 and absence by a 0 of plants from the Hippuris genus known as mare's-tail</p>
</dd>
<dt><code>common_duckweed__Lemna_minor</code></dt><dd><p>a binary vector indicating presence on sites by a 1 and absence by a 0 of common duckweed of species Lemna minor</p>
</dd>
<dt><code>x</code></dt><dd><p>a numeric vector of first coordinates corresponding to each site</p>
</dd>
<dt><code>y</code></dt><dd><p>a numeric vector of second coordinates corresponding to each site</p>
</dd>
</dl>



<h3>Source</h3>

<p>Wilkinson, D. P.; Golding, N.; Guillera-Arroita, G.; Tingley, R. and McCarthy, M. A. (2018) A comparison of joint species distribution models for presence-absence data. <em>Methods in Ecology and Evolution</em>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mosquitos, package="jSDM")
head(mosquitos)
</code></pre>

<hr>
<h2 id='plot_associations'>plot_associations
plot species-species associations</h2><span id='topic+plot_associations'></span>

<h3>Description</h3>

<p>plot_associations
plot species-species associations
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_associations(
  R,
  radius = 5,
  main = NULL,
  cex.main = NULL,
  circleBreak = FALSE,
  top = 10L,
  occ = NULL,
  env_effect = NULL,
  cols_association = c("#FF0000", "#BF003F", "#7F007F", "#3F00BF", "#0000FF"),
  cols_occurrence = c("#BEBEBE", "#8E8E8E", "#5F5F5F", "#2F2F2F", "#000000"),
  cols_env_effect = c("#1B9E77", "#D95F02", "#7570B3", "#E7298A", "#66A61E", "#E6AB02",
    "#A6761D", "#666666"),
  lwd_occurrence = 1,
  species_order = "abundance",
  species_indices = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_associations_+3A_r">R</code></td>
<td>
<p>matrix of correlation <code class="reqn">R</code></p>
</td></tr>
<tr><td><code id="plot_associations_+3A_radius">radius</code></td>
<td>
<p>circle's radius</p>
</td></tr>
<tr><td><code id="plot_associations_+3A_main">main</code></td>
<td>
<p>title</p>
</td></tr>
<tr><td><code id="plot_associations_+3A_cex.main">cex.main</code></td>
<td>
<p>title's character size. NULL and NA are equivalent to 1.0.</p>
</td></tr>
<tr><td><code id="plot_associations_+3A_circlebreak">circleBreak</code></td>
<td>
<p>circle break or not</p>
</td></tr>
<tr><td><code id="plot_associations_+3A_top">top</code></td>
<td>
<p>number of top negative and positive associations to consider</p>
</td></tr>
<tr><td><code id="plot_associations_+3A_occ">occ</code></td>
<td>
<p>species occurence data</p>
</td></tr>
<tr><td><code id="plot_associations_+3A_env_effect">env_effect</code></td>
<td>
<p>environmental species effects <code class="reqn">\beta</code></p>
</td></tr>
<tr><td><code id="plot_associations_+3A_cols_association">cols_association</code></td>
<td>
<p>color gradient for association lines</p>
</td></tr>
<tr><td><code id="plot_associations_+3A_cols_occurrence">cols_occurrence</code></td>
<td>
<p>color gradient for species</p>
</td></tr>
<tr><td><code id="plot_associations_+3A_cols_env_effect">cols_env_effect</code></td>
<td>
<p>color gradient for environmental effect</p>
</td></tr>
<tr><td><code id="plot_associations_+3A_lwd_occurrence">lwd_occurrence</code></td>
<td>
<p>lwd for occurrence lines</p>
</td></tr>
<tr><td><code id="plot_associations_+3A_species_order">species_order</code></td>
<td>
<p>order species according to : </p>

<table>
<tr>
 <td style="text-align: left;">
<code>"abundance"</code> </td><td style="text-align: left;"> their mean abundance at sites by default) </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>"frequency"</code> </td><td style="text-align: left;"> the number of sites where they occur </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>"main environmental effect"</code> </td><td style="text-align: left;"> their most important environmental coefficients </td>
</tr>

</table>
</td></tr>
<tr><td><code id="plot_associations_+3A_species_indices">species_indices</code></td>
<td>
<p>indices for sorting species</p>
</td></tr>
</table>


<h3>Details</h3>

<p>After fitting the jSDM with latent variables, the <b>fullspecies residual correlation matrix</b> : <code class="reqn">R=(R_{ij})</code> with <code class="reqn">i=1,\ldots, n_{species}</code> and <code class="reqn">j=1,\ldots, n_{species}</code> can be derived from the covariance in the latent variables such as : 
can be derived from the covariance in the latent variables such as : 
<code class="reqn">\Sigma_{ij}=\lambda_i' .\lambda_j</code>, in the case of a regression with probit, logit or poisson link function and 
</p>

<table>
<tr>
 <td style="text-align: left;">
<code class="reqn">\Sigma_{ij}</code> </td><td style="text-align: left;"> <code class="reqn">= \lambda_i' .\lambda_j + V</code> </td><td style="text-align: left;"> if i=j </td>
</tr>
<tr>
 <td style="text-align: left;">
         </td><td style="text-align: left;"> <code class="reqn">= \lambda_i' .\lambda_j</code> </td><td style="text-align: left;"> else, </td>
</tr>

</table>

<p>this function represents the correlations computed from covariances :
</p>
<p style="text-align: center;"><code class="reqn">R_{ij} = \frac{\Sigma_{ij}}{\sqrt{\Sigma_ii\Sigma _jj}}</code>
</p>
<p>.
</p>


<h3>Value</h3>

<p>No return value. Displays species-species associations.
</p>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent &lt;ghislain.vieilledent@cirad.fr&gt;
</p>
<p>Jeanne Clément &lt;jeanne.clement16@laposte.net&gt;
</p>


<h3>References</h3>

<p>Pichler M. and Hartig F. (2021) A new method for faster and more accurate inference of species associations from big community data. <br />
<em>Methods in Ecology and Evolution</em>, 12, 2159-2173 <a href="https://doi.org/10.1111/2041-210X.13687">doi:10.1111/2041-210X.13687</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+jSDM-package">jSDM-package</a></code> <code><a href="#topic+get_residual_cor">get_residual_cor</a></code> <br />
<code><a href="#topic+jSDM_binomial_probit">jSDM_binomial_probit</a></code> <code><a href="#topic+jSDM_binomial_probit_long_format">jSDM_binomial_probit_long_format</a></code> <br />
<code><a href="#topic+jSDM_binomial_probit_sp_constrained">jSDM_binomial_probit_sp_constrained</a></code> <code><a href="#topic+jSDM_binomial_logit">jSDM_binomial_logit</a></code>  <code><a href="#topic+jSDM_poisson_log">jSDM_poisson_log</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(jSDM)
# frogs data
data(mites, package="jSDM")
# Arranging data
PA_mites &lt;- mites[,1:35]
# Normalized continuous variables
Env_mites &lt;- cbind(mites[,36:38], scale(mites[,39:40]))
colnames(Env_mites) &lt;- colnames(mites[,36:40])
Env_mites &lt;- as.data.frame(Env_mites)
# Parameter inference
# Increase the number of iterations to reach MCMC convergence
mod &lt;- jSDM_poisson_log(# Response variable
                        count_data=PA_mites,
                        # Explanatory variables
                        site_formula = ~  water + topo + density,
                        site_data = Env_mites,
                        n_latent=2,
                        site_effect="random",
                        # Chains
                        burnin=100,
                        mcmc=100,
                        thin=1,
                        # Starting values
                        alpha_start=0,
                        beta_start=0,
                        lambda_start=0,
                        W_start=0,
                        V_alpha=1,
                        # Priors
                        shape=0.5, rate=0.0005,
                        mu_beta=0, V_beta=10,
                        mu_lambda=0, V_lambda=10,
                        # Various
                        seed=1234, verbose=1)
# Calcul of residual correlation between species
R &lt;- get_residual_cor(mod)$cor.mean
plot_associations(R, circleBreak = TRUE, occ = PA_mites, species_order="abundance")
# Average of MCMC samples of species enrironmental effect beta except the intercept
env_effect &lt;- t(sapply(mod$mcmc.sp,
                       colMeans)[grep("beta_", colnames(mod$mcmc.sp[[1]]))[-1],])
colnames(env_effect) &lt;-  gsub("beta_", "", colnames(env_effect))
plot_associations(R, env_effect = env_effect, species_order="main env_effect")
</code></pre>

<hr>
<h2 id='plot_residual_cor'>Plot the residual correlation matrix from a latent variable model (LVM).</h2><span id='topic+plot_residual_cor'></span>

<h3>Description</h3>

<p>Plot the posterior mean estimator of residual correlation matrix reordered by first principal component using <code><a href="corrplot.html#topic+corrplot">corrplot</a></code> function from the package of the same name.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_residual_cor(
  mod,
  prob = NULL,
  main = "Residual Correlation Matrix from LVM",
  cex.main = 1.5,
  diag = FALSE,
  type = "lower",
  method = "color",
  mar = c(1, 1, 3, 1),
  tl.srt = 45,
  tl.cex = 0.5,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_residual_cor_+3A_mod">mod</code></td>
<td>
<p>An object of class <code>"jSDM"</code>.</p>
</td></tr>
<tr><td><code id="plot_residual_cor_+3A_prob">prob</code></td>
<td>
<p>A numeric scalar in the interval <code class="reqn">(0,1)</code> giving the target probability coverage of the intervals, by which to determine whether the correlations are &quot;significant&quot;.
If <code>prob=0.95</code> is specified only significant correlations, whose <code class="reqn">95\%</code> HPD interval does not contain zero, are represented. 
Defaults to <code>prob=NULL</code> to represent all correlations significant or not.</p>
</td></tr>
<tr><td><code id="plot_residual_cor_+3A_main">main</code></td>
<td>
<p>Character, title of the graph.</p>
</td></tr>
<tr><td><code id="plot_residual_cor_+3A_cex.main">cex.main</code></td>
<td>
<p>Numeric, title's size.</p>
</td></tr>
<tr><td><code id="plot_residual_cor_+3A_diag">diag</code></td>
<td>
<p>Logical, whether display the correlation coefficients on the principal diagonal.</p>
</td></tr>
<tr><td><code id="plot_residual_cor_+3A_type">type</code></td>
<td>
<p>Character, &quot;full&quot; (default), &quot;upper&quot; or &quot;lower&quot;, display full matrix, lower triangular or upper triangular matrix.</p>
</td></tr>
<tr><td><code id="plot_residual_cor_+3A_method">method</code></td>
<td>
<p>Character, the visualization method of correlation matrix to be used. Currently, it supports seven methods, named &quot;circle&quot; (default), &quot;square&quot;, &quot;ellipse&quot;, &quot;number&quot;, &quot;pie&quot;, &quot;shade&quot; and &quot;color&quot;.</p>
</td></tr>
<tr><td><code id="plot_residual_cor_+3A_mar">mar</code></td>
<td>
<p>See <code><a href="graphics.html#topic+par">par</a></code></p>
</td></tr>
<tr><td><code id="plot_residual_cor_+3A_tl.srt">tl.srt</code></td>
<td>
<p>Numeric, for text label string rotation in degrees, see <code><a href="graphics.html#topic+text">text</a></code>.</p>
</td></tr>
<tr><td><code id="plot_residual_cor_+3A_tl.cex">tl.cex</code></td>
<td>
<p>Numeric, for the size of text label (variable names).</p>
</td></tr>
<tr><td><code id="plot_residual_cor_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code><a href="corrplot.html#topic+corrplot">corrplot</a></code> function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value. Displays a reordered correlation matrix.
</p>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent &lt;ghislain.vieilledent@cirad.fr&gt;
</p>
<p>Jeanne Clément &lt;jeanne.clement16@laposte.net&gt;
</p>


<h3>References</h3>

<p>Taiyun Wei and Viliam Simko (2017). R package &quot;corrplot&quot;: Visualization of a Correlation Matrix (Version 0.84)   
</p>
<p>Warton, D. I.; Blanchet, F. G.; O'Hara, R. B.; O'Hara, R. B.; Ovaskainen, O.; Taskinen, S.; Walker, S. C. and Hui, F. K. C. (2015) So Many Variables: Joint Modeling in Community Ecology. <em>Trends in Ecology &amp; Evolution</em>, 30, 766-779.
</p>


<h3>See Also</h3>

<p><code><a href="corrplot.html#topic+corrplot">corrplot</a></code> <code><a href="#topic+jSDM-package">jSDM-package</a></code> <code><a href="#topic+jSDM_binomial_probit">jSDM_binomial_probit</a></code> <br />
<code><a href="#topic+jSDM_binomial_logit">jSDM_binomial_logit</a></code> <code><a href="#topic+jSDM_poisson_log">jSDM_poisson_log</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(jSDM)
# frogs data
data(frogs, package="jSDM")
# Arranging data
PA_frogs &lt;- frogs[,4:12]
# Normalized continuous variables
 Env_frogs &lt;- cbind(scale(frogs[,1]),frogs[,2],scale(frogs[,3]))
 colnames(Env_frogs) &lt;- colnames(frogs[,1:3])
# Parameter inference
# Increase the number of iterations to reach MCMC convergence
mod&lt;-jSDM_binomial_probit(# Response variable
                           presence_data = PA_frogs,
                           # Explanatory variables
                           site_formula = ~.,
                           site_data = Env_frogs,
                           n_latent=2,
                           site_effect="random",
                           # Chains
                           burnin=100,
                           mcmc=100,
                           thin=1,
                           # Starting values
                           alpha_start=0,
                           beta_start=0,
                           lambda_start=0,
                           W_start=0,
                           V_alpha=1,
                           # Priors
                           shape=0.1, rate=0.1,
                           mu_beta=0, V_beta=1,
                           mu_lambda=0, V_lambda=1,
                           # Various
                           seed=1234, verbose=1)
# Representation of residual correlation between species
plot_residual_cor(mod)
plot_residual_cor(mod, prob=0.95)
</code></pre>

<hr>
<h2 id='predict.jSDM'>Predict method for models fitted with jSDM</h2><span id='topic+predict.jSDM'></span>

<h3>Description</h3>

<p>Prediction of species probabilities of occurrence from models fitted using the jSDM package
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'jSDM'
predict(
  object,
  newdata = NULL,
  Id_species,
  Id_sites,
  type = "mean",
  probs = c(0.025, 0.975),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict.jSDM_+3A_object">object</code></td>
<td>
<p>An object of class <code>"jSDM"</code>.</p>
</td></tr>
<tr><td><code id="predict.jSDM_+3A_newdata">newdata</code></td>
<td>
<p>An optional data frame in which explanatory variables can be searched for prediction. If omitted, the adjusted values are used.</p>
</td></tr>
<tr><td><code id="predict.jSDM_+3A_id_species">Id_species</code></td>
<td>
<p>An vector of character or integer indicating for which species the probabilities of presence on chosen sites will be predicted.</p>
</td></tr>
<tr><td><code id="predict.jSDM_+3A_id_sites">Id_sites</code></td>
<td>
<p>An vector of integer indicating for which sites the probabilities of presence of specified species will be predicted.</p>
</td></tr>
<tr><td><code id="predict.jSDM_+3A_type">type</code></td>
<td>
<p>Type of prediction. Can be :
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>"mean"</code> </td><td style="text-align: left;"> for predictive posterior mean. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>"quantile"</code> </td><td style="text-align: left;"> for producing sample quantiles from the predictive posterior, </td>
</tr>
<tr>
 <td style="text-align: left;">
</td><td style="text-align: left;"> corresponding to the given probabilities (see <code>probs</code> argument). </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>"posterior"</code> </td><td style="text-align: left;"> for the full predictive posterior for each prediction. </td>
</tr>
<tr>
 <td style="text-align: left;"> </td>
</tr>

</table>

<p>Using <code>"quantile"</code> or <code>"posterior"</code> might lead to memory problem depending on the number of predictions and the number of samples for the jSDM model's parameters.</p>
</td></tr>
<tr><td><code id="predict.jSDM_+3A_probs">probs</code></td>
<td>
<p>Numeric vector of probabilities with values in [0,1], <br />
used when <code>type="quantile"</code>.</p>
</td></tr>
<tr><td><code id="predict.jSDM_+3A_...">...</code></td>
<td>
<p>Further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Return a vector for the predictive posterior mean when <code>type="mean"</code>, a data-frame with the mean and quantiles when <code>type="quantile"</code> or an <code>mcmc</code> object (see <code>coda</code> package) with posterior distribution for each prediction when <code>type="posterior"</code>.
</p>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent &lt;ghislain.vieilledent@cirad.fr&gt;
</p>
<p>Jeanne Clément &lt;jeanne.clement16@laposte.net&gt;
</p>


<h3>See Also</h3>

<p><code><a href="#topic+jSDM-package">jSDM-package</a></code> <code><a href="#topic+jSDM_gaussian">jSDM_gaussian</a></code> <code><a href="#topic+jSDM_binomial_logit">jSDM_binomial_logit</a></code>  <code><a href="#topic+jSDM_binomial_probit">jSDM_binomial_probit</a></code> <code><a href="#topic+jSDM_poisson_log">jSDM_poisson_log</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(jSDM)
# frogs data
data(frogs, package="jSDM")
# Arranging data
PA_frogs &lt;- frogs[,4:12]
# Normalized continuous variables
Env_frogs &lt;- cbind(scale(frogs[,1]),frogs[,2],scale(frogs[,3]))
colnames(Env_frogs) &lt;- colnames(frogs[,1:3])
# Parameter inference
# Increase the number of iterations to reach MCMC convergence
mod&lt;-jSDM_binomial_probit(# Response variable
                          presence_data=PA_frogs,
                          # Explanatory variables
                          site_formula = ~.,
                          site_data = Env_frogs,
                          n_latent=2,
                          site_effect="random",
                          # Chains
                          burnin=100,
                          mcmc=100,
                          thin=1,
                          # Starting values
                          alpha_start=0,
                          beta_start=0,
                          lambda_start=0,
                          W_start=0,
                          V_alpha=1,
                          # Priors
                          shape=0.5, rate=0.0005,
                          mu_beta=0, V_beta=10,
                          mu_lambda=0, V_lambda=10,
                          # Various
                          seed=1234, verbose=1)

# Select site and species for predictions
## 30 sites
Id_sites &lt;- sample.int(nrow(PA_frogs), 30)
## 5 species
Id_species &lt;- sample(colnames(PA_frogs), 5)

# Predictions 
theta_pred &lt;- predict(mod,
                     Id_species=Id_species,
                     Id_sites=Id_sites,
                     type="mean")
hist(theta_pred, main="Predicted theta with simulated covariates")
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
