<!DOCTYPE html><html><head><title>Help for package NHSRplotthedots</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {NHSRplotthedots}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#ptd_create_ggplot'><p>Create ggplot2</p></a></li>
<li><a href='#ptd_rebase'><p>Rebase</p></a></li>
<li><a href='#ptd_spc'><p>SPC Plotting Function</p></a></li>
<li><a href='#ptd_spc_colours'><p>SPC Colours</p></a></li>
<li><a href='#ptd_target'><p>Target</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Draw XmR Charts for NHSE/I 'Making Data Count' Programme</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Christopher Reading &lt;christopher.reading1@nhs.net&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides tools for drawing Statistical Process Control (SPC) charts. This package supports the NHSE/I
  programme 'Making Data Count', and allows users to draw XmR charts, use change points and apply rules with summary
  indicators for when rules are breached.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://nhs-r-community.github.io/NHSRplotthedots/">https://nhs-r-community.github.io/NHSRplotthedots/</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.2</td>
</tr>
<tr>
<td>Imports:</td>
<td>ggplot2, scales, dplyr, rlang, crayon, utils, NHSRdatasets,
assertthat, grid</td>
</tr>
<tr>
<td>Suggests:</td>
<td>covr, lintr, testthat (&ge; 3.0.0), rmarkdown, knitr, mockery,
withr, spelling</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-11-02 18:47:02 UTC; Giselle</td>
</tr>
<tr>
<td>Author:</td>
<td>Christopher Reading [cre, aut],
  Simon Wellesley-Miller [aut],
  ZoÃ« Turner <a href="https://orcid.org/0000-0003-1033-9158"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Tom Jemmett <a href="https://orcid.org/0000-0002-6943-2990"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Tom Smith [aut],
  Chris Mainey <a href="https://orcid.org/0000-0002-3018-6171"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  John MacKintosh [aut],
  NHS-R community [cph]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-11-03 20:20:10 UTC</td>
</tr>
</table>
<hr>
<h2 id='ptd_create_ggplot'>Create ggplot2</h2><span id='topic+ptd_create_ggplot'></span>

<h3>Description</h3>

<p>Creates a ggplot2 object using the parameters passed in.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ptd_create_ggplot(
  x,
  point_size = 4,
  percentage_y_axis = FALSE,
  main_title,
  x_axis_label,
  y_axis_label,
  fixed_x_axis_multiple = TRUE,
  fixed_y_axis_multiple = TRUE,
  x_axis_date_format = "%d/%m/%y",
  x_axis_breaks = NULL,
  y_axis_breaks = NULL,
  icons_size = 8L,
  icons_position = c("top right", "bottom right", "bottom left", "top left", "none"),
  colours = ptd_spc_colours(),
  theme_override = NULL,
  break_lines = c("both", "limits", "process", "none"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ptd_create_ggplot_+3A_x">x</code></td>
<td>
<p>an object created by <code><a href="#topic+ptd_spc">ptd_spc()</a></code></p>
</td></tr>
<tr><td><code id="ptd_create_ggplot_+3A_point_size">point_size</code></td>
<td>
<p>Specify the plotting point size for the ggplot output. Default is 2.5.</p>
</td></tr>
<tr><td><code id="ptd_create_ggplot_+3A_percentage_y_axis">percentage_y_axis</code></td>
<td>
<p>Specify whether the y axis values are percentages. Accepted values are TRUE for percentage y
axis, FALSE for integer y axis. Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="ptd_create_ggplot_+3A_main_title">main_title</code></td>
<td>
<p>Specify a character string value for the ggplot title.</p>
</td></tr>
<tr><td><code id="ptd_create_ggplot_+3A_x_axis_label">x_axis_label</code></td>
<td>
<p>Specify a character string value for the x axis title.</p>
</td></tr>
<tr><td><code id="ptd_create_ggplot_+3A_y_axis_label">y_axis_label</code></td>
<td>
<p>Specify a character string value for the y axis title.</p>
</td></tr>
<tr><td><code id="ptd_create_ggplot_+3A_fixed_x_axis_multiple">fixed_x_axis_multiple</code></td>
<td>
<p>Specify whether, if producing a faceted spc, x axis should be fixed for all facet plots.
Accepted values are TRUE for fixed x axes or FALSE for individual x axes.</p>
</td></tr>
<tr><td><code id="ptd_create_ggplot_+3A_fixed_y_axis_multiple">fixed_y_axis_multiple</code></td>
<td>
<p>Specify whether, if producing a faceted spc, y axis should be fixed for all facet plots.
Accepted values are TRUE for fixed y axes or FALSE for individual y axes.</p>
</td></tr>
<tr><td><code id="ptd_create_ggplot_+3A_x_axis_date_format">x_axis_date_format</code></td>
<td>
<p>Specify how dates on the x axis should be displayed. Format should be provided
as a character string using 'd m Y' etc syntax.</p>
</td></tr>
<tr><td><code id="ptd_create_ggplot_+3A_x_axis_breaks">x_axis_breaks</code></td>
<td>
<p>Specify an interval value for breaks on the x axis. Value should be a character string
expressing interval length and type, e.g. &quot;3 months&quot;, &quot;7 days&quot;.</p>
</td></tr>
<tr><td><code id="ptd_create_ggplot_+3A_y_axis_breaks">y_axis_breaks</code></td>
<td>
<p>Specify an interval value for breaks on the y axis. Value should be a numeric vector of length
1, either an integer for integer scales or a decimal value for percentage scales. This option is ignored if
faceting is in use.</p>
</td></tr>
<tr><td><code id="ptd_create_ggplot_+3A_icons_size">icons_size</code></td>
<td>
<p>The size of the icons, defined in terms of font size. Defaults to 8.</p>
</td></tr>
<tr><td><code id="ptd_create_ggplot_+3A_icons_position">icons_position</code></td>
<td>
<p>Where to show the icons, either &quot;top right&quot; (default), &quot;bottom right&quot;, &quot;bottom left&quot;,
&quot;top left&quot;, or &quot;none&quot;.</p>
</td></tr>
<tr><td><code id="ptd_create_ggplot_+3A_colours">colours</code></td>
<td>
<p>Specify the colours to use in the plot, use the <code><a href="#topic+ptd_spc_colours">ptd_spc_colours()</a></code> function to change defaults.</p>
</td></tr>
<tr><td><code id="ptd_create_ggplot_+3A_theme_override">theme_override</code></td>
<td>
<p>Specify a list containing ggplot theme elements which can be used to override the default
appearance of the plot.</p>
</td></tr>
<tr><td><code id="ptd_create_ggplot_+3A_break_lines">break_lines</code></td>
<td>
<p>whether to break lines when a rebase happens. Defaults to &quot;both&quot;, but can break just &quot;limits&quot;
lines, &quot;process&quot; lines, or &quot;none&quot;.</p>
</td></tr>
<tr><td><code id="ptd_create_ggplot_+3A_...">...</code></td>
<td>
<p>currently ignored</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The ggplot2 object
</p>

<hr>
<h2 id='ptd_rebase'>Rebase</h2><span id='topic+ptd_rebase'></span>

<h3>Description</h3>

<p>Produces an object that can be used for rebasing an SPC chart. This method provides two different ways to rebase:
</p>

<ol>
<li><p> You can either provide a single vector of dates, which will rebase every facet of an SPC with the same dates
</p>
</li>
<li><p> You can provide named vectors of dates, where the names correspond to the names of the facets, in order to
rebase a facetted chart
</p>
</li></ol>



<h3>Usage</h3>

<pre><code class='language-R'>ptd_rebase(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ptd_rebase_+3A_...">...</code></td>
<td>
<p>either a single vector of dates, or, named vectors of dates. See examples.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list
</p>


<h3>Examples</h3>

<pre><code class='language-R'># if you aren't using a facetted chart, or you want to rebase each facet at the same dates, then
# you can simply call this method with a vector of dates. For example, to rebase on the 1^st^
# January 2020 and 22^nd^ March 2020:

ptd_rebase(as.Date(c("2020-01-01", "2020-03-22")))

# if you are using a facetted chart, and wish to rebase each facet with different dates, then
# you can call this method, naming each vector of dates with the name of the facet. If there are
# facet's that you don't need to rebase you can simply ignore them. For example, if you had a
# chart with facets "a", "b", and "c", and you wanted to rebase "a" on the 1^st^ January 2020,
# and "b" on the 22^nd^ March 2020:

ptd_rebase(
  "a" = as.Date("2020-01-01"),
  "b" = as.Date("2020-03-22")
)
</code></pre>

<hr>
<h2 id='ptd_spc'>SPC Plotting Function</h2><span id='topic+ptd_spc'></span>

<h3>Description</h3>

<p><code>ptd_spc</code> returns a plot object or data table with SPC values using NHSI 'plot the dots' logic.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ptd_spc(
  .data,
  value_field,
  date_field,
  facet_field,
  rebase = ptd_rebase(),
  fix_after_n_points = NULL,
  improvement_direction = "increase",
  target = ptd_target(),
  trajectory,
  screen_outliers = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ptd_spc_+3A_.data">.data</code></td>
<td>
<p>A data frame containing a value field, a date field,
and a category field (if for faceting). There should be no gaps in the time series
for each category.</p>
</td></tr>
<tr><td><code id="ptd_spc_+3A_value_field">value_field</code></td>
<td>
<p>Specify the field name which contains the value data, to be plotted on y axis.
Field name can be specified using non-standard evaluation (i.e. no quotation marks).</p>
</td></tr>
<tr><td><code id="ptd_spc_+3A_date_field">date_field</code></td>
<td>
<p>Specify the field name which contains the date data, to be plotted on x axis.
Field name can be specified using non-standard evaluation (i.e. no quotation marks).</p>
</td></tr>
<tr><td><code id="ptd_spc_+3A_facet_field">facet_field</code></td>
<td>
<p>Optional: Specify field name which contains a grouping/faceting variable. SPC logic will be
applied to each group separately, with outputs combined. Currently accepts 1 variable only.
Field name can be specified using non-standard evaluation (i.e. no quotation marks).</p>
</td></tr>
<tr><td><code id="ptd_spc_+3A_rebase">rebase</code></td>
<td>
<p>Specify a date vector of dates when to rebase, or, if facet_field is set, a named list of date vectors
of when to rebase. Each item in the list should be named after the facet you wish to rebase. See <code><a href="#topic+ptd_rebase">ptd_rebase()</a></code>.</p>
</td></tr>
<tr><td><code id="ptd_spc_+3A_fix_after_n_points">fix_after_n_points</code></td>
<td>
<p>Specify a number points after which to fix SPC calculations.</p>
</td></tr>
<tr><td><code id="ptd_spc_+3A_improvement_direction">improvement_direction</code></td>
<td>
<p>Specify whether process improvement is represented by an increase or decrease in
measured variable, or is neutral.  Accepted values are 'increase' for increase as improvement, 'decrease' for
decrease as improvement, and 'neutral' where neither direction represents an improvement. Defaults to 'increase'.</p>
</td></tr>
<tr><td><code id="ptd_spc_+3A_target">target</code></td>
<td>
<p>Specify a single value, which will apply the same target to every facet of an SPC chart,
or named values of targets, where the names correspond to the names of the facets, in order to
have different targets for each facet. See <code><a href="#topic+ptd_target">ptd_target()</a></code>.</p>
</td></tr>
<tr><td><code id="ptd_spc_+3A_trajectory">trajectory</code></td>
<td>
<p>Specify a field name which contains a trajectory value.
Field name can be specified using non-standard evaluation (i.e. no quotation marks).</p>
</td></tr>
<tr><td><code id="ptd_spc_+3A_screen_outliers">screen_outliers</code></td>
<td>
<p>Whether we should screen for outliers or not when calculating the control limits. Defaults to
<code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is designed to produce consistent SPC charts
across Information Department reporting, according to the 'plot the dots'
logic produced by NHSI. The function can return either a plot or data frame.
</p>


<h3>Value</h3>

<p>A ggplot2 object of the spc charts.  This will automatically print the plot, but can also be saved as an
object if you want to manipulate it further.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(NHSRdatasets)
library(dplyr)
data("ae_attendances")

# Pick a trust at random to look at their data for two years
trust1 &lt;- subset(ae_attendances, org_code == "RJZ" &amp; type == 1)

# Basic chart with improvement direction decreasing
ptd_spc(trust1,
  value_field = breaches, date_field = period,
  improvement_direction = "decrease"
)

# Pick a few trust, and plot individually using facet
# Also set the x-axis scale to vary for each and date groups to 3 months
orgs &lt;- c("RAS", "RJZ", "RR1", "RJC", "RQ1")
trusts4 &lt;- filter(ae_attendances, org_code %in% orgs, type == 1)

s &lt;- ptd_spc(trusts4,
  value_field = breaches, date_field = period, facet_field = org_code,
  improvement_direction = "decrease"
)
plot(s, fixed_y_axis_multiple = FALSE, x_axis_breaks = "3 months")

# Save the first chart as an object this time then alter the ggplot theme
my_spc &lt;- ptd_spc(trust1,
  value_field = "breaches", date_field = "period",
  improvement_direction = "decrease"
)

plot(my_spc) + ggplot2::theme_classic()
</code></pre>

<hr>
<h2 id='ptd_spc_colours'>SPC Colours</h2><span id='topic+ptd_spc_colours'></span>

<h3>Description</h3>

<p>Produces a list of colours that controls the geoms in the plot
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ptd_spc_colours(
  common_cause = "#7B7D7D",
  special_cause_improvement = "#289de0",
  special_cause_neutral = "#361475",
  special_cause_concern = "#fab428",
  value_line = "#7B7D7D",
  mean_line = "#000000",
  lpl = "#7B7D7D",
  upl = "#7B7D7D",
  target = "#de1b1b",
  trajectory = "#361475"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ptd_spc_colours_+3A_common_cause">common_cause</code>, <code id="ptd_spc_colours_+3A_special_cause_improvement">special_cause_improvement</code>, <code id="ptd_spc_colours_+3A_special_cause_neutral">special_cause_neutral</code>, <code id="ptd_spc_colours_+3A_special_cause_concern">special_cause_concern</code></td>
<td>
<p>the colour of the points</p>
</td></tr>
<tr><td><code id="ptd_spc_colours_+3A_value_line">value_line</code></td>
<td>
<p>the colour of the line joining the points</p>
</td></tr>
<tr><td><code id="ptd_spc_colours_+3A_mean_line">mean_line</code></td>
<td>
<p>the colour of the &quot;mean&quot; (average) line</p>
</td></tr>
<tr><td><code id="ptd_spc_colours_+3A_lpl">lpl</code>, <code id="ptd_spc_colours_+3A_upl">upl</code></td>
<td>
<p>the colour the the lower and upper process limit lines</p>
</td></tr>
<tr><td><code id="ptd_spc_colours_+3A_target">target</code></td>
<td>
<p>the colour of the target line</p>
</td></tr>
<tr><td><code id="ptd_spc_colours_+3A_trajectory">trajectory</code></td>
<td>
<p>the colour of the trajectory line</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list of colours
</p>

<hr>
<h2 id='ptd_target'>Target</h2><span id='topic+ptd_target'></span>

<h3>Description</h3>

<p>Produces an object that can be used for adding Targets to an SPC chart. This method provides two different ways to
add a target:
</p>

<ol>
<li><p> You can either provide a single value, which will apply the same target to every facet of an SPC
</p>
</li>
<li><p> You can provide named values of targets, where the names correspond to the names of the facets, in order to
have different targets for each facet
</p>
</li></ol>



<h3>Usage</h3>

<pre><code class='language-R'>ptd_target(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ptd_target_+3A_...">...</code></td>
<td>
<p>either a single values, or, named values of targets. See examples.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is a helper to provide data in the correct format for use with <code>ptd_spc()</code>. See <strong>Value</strong>
section for details of return type. If you are trying to do something like <code>ptd_spc(list_of_values)</code> then you can
skip using the function and just use <code>list_of_values</code>, so long as the list meets the requirements as listed above.
</p>


<h3>Value</h3>

<p>returns either:
</p>

<ul>
<li><p> a single numeric value, in this case all facets in the plot will use this target value
</p>
</li>
<li><p> a named list of single numeric values, where each item is named as for one of the facet's in the plot. If a facet
isn't specified then it will not have a target
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># if you aren't using a facetted chart, or you want to use the same target for each facet, you
# can simply call this method with a single value. For example, to use a target of 90%:

ptd_target(0.9)

# if you are using a facetted chart, and wish to use a different target for each facet, then you
# can call this method, naming each value with the name of the facet. Any facet that isn't listed
# will not have a target applied to it.

# For example, to apply a target of 25 to the "a" facet and 10 to the "b" facet:

ptd_target(
  "a" = 25,
  "b" = 10
)

# If you already have your data in a list, you do not need to use ptd_target(). But, if you
# wanted to check that your values are valid, you could call it like so:

my_targets &lt;- list("a" = 25, "b" = 10)
do.call(ptd_target, my_targets)

# or, if your targets are in a numeric vector
my_targets &lt;- c("a" = 25, "b" = 10)
do.call(ptd_target, as.list(my_targets))
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
