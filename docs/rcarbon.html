<!DOCTYPE html><html lang="en-GB"><head><title>Help for package rcarbon</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {rcarbon}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#rcarbon'><p>rcarbon:Calibration and analysis of radiocarbon dates</p></a></li>
<li><a href='#as.CalDates'><p>Convert to a CalDates object</p></a></li>
<li><a href='#as.CalGrid'><p>Convert data to class CalGrid.</p></a></li>
<li><a href='#as.UncalGrid'><p>Convert data to class UncalGrid.</p></a></li>
<li><a href='#barCodes'><p>Plot the median values of calibrated radiocarbon dates or bins</p></a></li>
<li><a href='#BCADtoBP'><p>Convert BC/AD dates to BP format</p></a></li>
<li><a href='#binMed'><p>Computes the median date of each bin</p></a></li>
<li><a href='#binPrep'><p>Binning function of radiocarbon dates.</p></a></li>
<li><a href='#binsense'><p>Bin sensitivity Plot</p></a></li>
<li><a href='#BPtoBCAD'><p>Convert BP dates to BC/AD format</p></a></li>
<li><a href='#calibrate'><p>Calibrate radiocarbon dates</p></a></li>
<li><a href='#ckde'><p>Composite Kernel Density Estimates of Radiocarbon Dates</p></a></li>
<li><a href='#combine'><p>Combine multiple CalDates Class Objects into one.</p></a></li>
<li><a href='#emedyd'><p>Radiocarbon dates for the Eastern Mediterranean around the Younger Dryas</p></a></li>
<li><a href='#euroevol'><p>Radiocarbon dates from the EUROEVOL database</p></a></li>
<li><a href='#ewdates'><p>Subset of EUROEVOL radiocarbon dates from Great Britain</p></a></li>
<li><a href='#ewowin'><p>Polygonal window of England and Wales</p></a></li>
<li><a href='#gaussW'><p>Gaussian weighting of dates relative to</p></a></li>
<li><a href='#hpdi'><p>Computes the highest posterior density interval (HPDI) for calibrated dates</p></a></li>
<li><a href='#medCal'><p>Computes the median date of calibrated dates</p></a></li>
<li><a href='#mixCurves'><p>Creates mixed calibration curves.</p></a></li>
<li><a href='#modelTest'><p>Monte-Carlo simulation test for SPDs</p></a></li>
<li><a href='#multiplot'><p>Plot multiple dates</p></a></li>
<li><a href='#p2pTest'><p>Point to point test of SPD</p></a></li>
<li><a href='#permTest'><p>Random mark permutation test for SPDs</p></a></li>
<li><a href='#plot.CalDates'><p>Plot calibrated dates</p></a></li>
<li><a href='#plot.CalGrid'><p>Plot a summed probability distribution (from a CalGrid object)</p></a></li>
<li><a href='#plot.CalSPD'><p>Plot a summed probability distribution</p></a></li>
<li><a href='#plot.compositeKDE'><p>Plots a Composite Kernel Density Estimate of sampled radiocarbon dates.</p></a></li>
<li><a href='#plot.spatialTest'><p>Plot results of the local spatial permutation test of summed probability distributions.</p></a></li>
<li><a href='#plot.SpdModelTest'><p>Plot result of Monte-Carlo simulation of observed versus modelled SPDs</p></a></li>
<li><a href='#plot.SpdPermTest'><p>Plot result of mark permutation test of SPDs</p></a></li>
<li><a href='#plot.spdRC'><p>Plot <code>spdRC</code> class objects</p></a></li>
<li><a href='#plot.stackCalSPD'><p>Plot a stack of SPDs</p></a></li>
<li><a href='#plot.stKde'><p>Plot map(s) of the spatio-temporal intensity of radiocarbon dates.</p></a></li>
<li><a href='#poolDates'><p>Combine radiocarbon ages from the same event.</p></a></li>
<li><a href='#qCal'><p>Computes the quantile date of calibrated dates</p></a></li>
<li><a href='#rcarbon-deprecated'><p>Deprecated functions.</p></a></li>
<li><a href='#reScale'><p>Rescale a numeric vector to a specified minimum and maximum</p></a></li>
<li><a href='#runMean'><p>Calculate a running mean from a numeric vector.</p></a></li>
<li><a href='#sampleDates'><p>Sample random calendar dates</p></a></li>
<li><a href='#smoothGauss'><p>Smooth a numeric vector using a Gaussian window</p></a></li>
<li><a href='#spd'><p>Summed probability distributions (SPD) of radiocarbon dates.</p></a></li>
<li><a href='#spd2rc'><p>Computes rates of change from SPDs</p></a></li>
<li><a href='#spkde'><p>Map the spatial intensity of a set of radiocarbon dates for a given focal year.</p></a></li>
<li><a href='#sptest'><p>Spatial Permutation Test of summed probability distributions.</p></a></li>
<li><a href='#stackspd'><p>Stacked Summed Probability Distribution</p></a></li>
<li><a href='#stkde'><p>Map the spatio-temporal intensity of a set of radiocarbon dates</p></a></li>
<li><a href='#subset.CalDates'><p>Subsetting calibrated dates</p></a></li>
<li><a href='#summary.CalDates'><p>Summarise a <code>CalDates</code> class object</p></a></li>
<li><a href='#summary.SpdModelTest'><p>Summarise a <code>SpdModelTest</code> class object</p></a></li>
<li><a href='#summary.SpdPermTest'><p>Summarise a <code>SpdPermTest</code> class object</p></a></li>
<li><a href='#thinDates'><p>Sampling function to select a maximum number of dates per site, bin or phase.</p></a></li>
<li><a href='#transformSPD'><p>Apply taphonomic corrections or other transformations to an SPD.</p></a></li>
<li><a href='#uncalibrate'><p>Uncalibrate (back-calibrate) a calibrated radiocarbon date (or summed probability distribution).</p></a></li>
<li><a href='#which.CalDates'><p>Which indices for calibrated dates</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Calibration and Analysis of Radiocarbon Dates</td>
</tr>
<tr>
<td>Version:</td>
<td>1.5.1</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/ahb108/rcarbon/">https://github.com/ahb108/rcarbon/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/ahb108/rcarbon/issues">https://github.com/ahb108/rcarbon/issues</a></td>
</tr>
<tr>
<td>Description:</td>
<td>Enables the calibration and analysis of radiocarbon dates, often but not exclusively for the purposes of archaeological research. It includes functions not only for basic calibration, uncalibration, and plotting of one or more dates, but also a statistical framework for building demographic and related longitudinal inferences from aggregate radiocarbon date lists, including: Monte-Carlo simulation test (Timpson et al 2014 &lt;<a href="https://doi.org/10.1016%2Fj.jas.2014.08.011">doi:10.1016/j.jas.2014.08.011</a>&gt;), random mark permutation test (Crema et al 2016 &lt;<a href="https://doi.org/10.1371%2Fjournal.pone.0154809">doi:10.1371/journal.pone.0154809</a>&gt;) and spatial permutation tests (Crema, Bevan, and Shennan 2017 &lt;<a href="https://doi.org/10.1016%2Fj.jas.2017.09.007">doi:10.1016/j.jas.2017.09.007</a>&gt;).  </td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.3.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>sf,stats,spatstat.geom, spatstat.model,spatstat.explore,
spatstat.linnet, spatstat (&ge;
2.0-0),graphics,grDevices,utils,snow,doSNOW,foreach,iterators,knitr</td>
</tr>
<tr>
<td>Suggests:</td>
<td>rmarkdown, testthat (&ge; 2.1.0)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Language:</td>
<td>en-GB</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-08-24 09:14:28 UTC; erc62</td>
</tr>
<tr>
<td>Author:</td>
<td>Andrew Bevan <a href="https://orcid.org/0000-0001-7967-3117"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Enrico Crema <a href="https://orcid.org/0000-0001-6727-5138"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  R. Kyle Bocinsky [ctb],
  Martin Hinz [ctb],
  Philip Riris [ctb],
  Fabio Silva [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Enrico Crema &lt;enrico.crema@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-08-24 11:20:10 UTC</td>
</tr>
</table>
<hr>
<h2 id='rcarbon'>rcarbon:Calibration and analysis of radiocarbon dates</h2><span id='topic+rcarbon'></span><span id='topic+rcarbon-package'></span>

<h3>Description</h3>

<p>The <span class="pkg">rcarbon</span> package handles the calibration and analysis of radiocarbon, often but not exclusively for the purposes of archaeological research. It includes functions not only for basic calibration, uncalibration and plotting of one or more dates, but also a statistical framework for building demographic and related longitudinal inferences from aggregate radiocarbon date lists.
</p>


<h3>Details</h3>

<p>Core functions in the <span class="pkg">rcarbon</span> package can be grouped as follows:
</p>

<dl>
<dt><strong>Calibration Functions</strong></dt><dd><p><code><a href="#topic+calibrate">calibrate</a></code> and <code><a href="#topic+uncalibrate">uncalibrate</a></code> enable the calibration and back-calibration for a variety of curves.</p>
</dd>
<dt><strong>Aggregation Functions</strong></dt><dd><p><code><a href="#topic+spd">spd</a></code> generates a summed probability distribution (SPD) of radiocarbon dates; <code><a href="#topic+binPrep">binPrep</a></code> can be used to define clusters of radiocarbon dates associated with the same context/phase</p>
</dd>
<dt><strong>Statistical Test Functions</strong></dt><dd><p><code><a href="#topic+modelTest">modelTest</a></code> compares the observed SPD against a variety of theoretical models (most typically an exponential curve) using the Monte-Carlo approach; <code><a href="#topic+p2pTest">p2pTest</a></code> compares observed differences in SPD between two user-specified points in time against differences expected from a theoretical model; <code><a href="#topic+permTest">permTest</a></code> compares two or more SPDs and test for the null hypothesis that all sets are derived from the same population; <code><a href="#topic+sptest">sptest</a></code> identifies, for defined intervals, locations with significantly higher or lower growth rate in the SPD compared to the pan-regional trend in the data</p>
</dd>
</dl>



<h3>Note</h3>

<p>Up-to-date development version, bug-reports, and further information concerning  the <span class="pkg">rcarbon</span> package can be found on GitHub (<a href="https://github.com/ahb108/rcarbon">https://github.com/ahb108/rcarbon</a>).
To see the preferred citation for the package, type citation(&quot;rcarbon&quot;).
</p>


<h3>Author(s)</h3>

<p>The <span class="pkg">rcarbon</span> is developed and maintained by Andrew Bevan and Enrico Crema
</p>


<h3>References</h3>

<p>See individual functions for references.
</p>

<hr>
<h2 id='as.CalDates'>Convert to a CalDates object</h2><span id='topic+as.CalDates'></span>

<h3>Description</h3>

<p>Convert other calibrated date formats to an rcarbon CalDates object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as.CalDates(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as.CalDates_+3A_x">x</code></td>
<td>
<p>One or more calibrated dated to convert (currently only BchronCalibratedDates and oxcAARCalibratedDatesList objects are supported)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A CalDates object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run:  
library(Bchron)
library(oxcAAR)
quickSetupOxcal()
dates &lt;- data.frame(CRA=c(3200,2100,1900), Error=c(35,40,50))
bcaldates &lt;- BchronCalibrate(ages=dates$CRA, ageSds=dates$Error, 
calCurves=rep("intcal13", nrow(dates)))
rcaldates &lt;- rcarbon::calibrate(dates$CRA, dates$Error, calCurves=rep("intcal13"))
ocaldates &lt;- oxcalCalibrate(c(3200,2100,1900),c(35,40,50),c("a","b","c"))
## Convert to rcarbon format
caldates.b &lt;- as.CalDates(bcaldates)
caldates.o &lt;- as.CalDates(ocaldates)
## Comparison plot
plot(rcaldates$grids[[2]]$calBP,rcaldates$grids[[2]]$PrDens, 
type="l", col="green", xlim=c(2300,1900))
lines(caldates.b$grids[[2]]$calBP,caldates.b$grids[[2]]$PrDens, col="red")
lines(caldates.o$grids[[2]]$calBP,caldates.o$grids[[2]]$PrDens, col="blue")
legend("topright", legend=c("rcarbon","Bchron","OxCal"), col=c("green","red","blue"), lwd=2)

## End(Not run)
</code></pre>

<hr>
<h2 id='as.CalGrid'>Convert data to class CalGrid.</h2><span id='topic+as.CalGrid'></span>

<h3>Description</h3>

<p>Tries to coerce any two-column matrix or data.frame to a calibrated probability distribution (an object of class &quot;CalGrid&quot;) for use by the rcarbon package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as.CalGrid(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as.CalGrid_+3A_x">x</code></td>
<td>
<p>A two-column <code>matrix</code> or <code>data.frame</code> class object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A CalGrid class object of probabilities or summed probabilities per calendar year BP.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>df &lt;- data.frame(calBP=5000:2000,PrDens=runif(length(5000:2000)))
mycalgrid &lt;- as.CalGrid(df)
plot(mycalgrid)
</code></pre>

<hr>
<h2 id='as.UncalGrid'>Convert data to class UncalGrid.</h2><span id='topic+as.UncalGrid'></span>

<h3>Description</h3>

<p>Tries to coerce any two-column matrix or data.frame to a uncalibrated probability distribution (an object of class &quot;UncalGrid&quot;) for use by the rcarbon package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as.UncalGrid(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as.UncalGrid_+3A_x">x</code></td>
<td>
<p>A two-column <code>matrix</code> or <code>data.frame</code> class object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A CalGrid class object of probabilities or summed probabilities per CRA.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>df &lt;- data.frame(CRA=5000:2000,PrDens=runif(length(5000:2000)))
mycalgrid &lt;- as.UncalGrid(df)
</code></pre>

<hr>
<h2 id='barCodes'>Plot the median values of calibrated radiocarbon dates or bins</h2><span id='topic+barCodes'></span>

<h3>Description</h3>

<p>Plot the median values of multiple calibrated radiocarbon dates or bins in a barcode-like strip.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>barCodes(
  x,
  yrng = c(0, 0.03),
  width = 20,
  col = rgb(0, 0, 0, 25, maxColorValue = 255),
  border = NA,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="barCodes_+3A_x">x</code></td>
<td>
<p>A vector containing median values obtained from <code><a href="#topic+medCal">medCal</a></code> or <code><a href="#topic+binMed">binMed</a></code></p>
</td></tr>
<tr><td><code id="barCodes_+3A_yrng">yrng</code></td>
<td>
<p>y-axis range of the bars.</p>
</td></tr>
<tr><td><code id="barCodes_+3A_width">width</code></td>
<td>
<p>width of the bars (optional)</p>
</td></tr>
<tr><td><code id="barCodes_+3A_col">col</code></td>
<td>
<p>color of the bars</p>
</td></tr>
<tr><td><code id="barCodes_+3A_border">border</code></td>
<td>
<p>the color to draw the border. Use border = NA to omit borders.</p>
</td></tr>
<tr><td><code id="barCodes_+3A_...">...</code></td>
<td>
<p>Additional arguments affecting the plot</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+medCal">medCal</a></code>; <code><a href="#topic+binMed">binMed</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
#Load EUROEVOL Data
data(euroevol)

#Subset Danish Dates
denmark &lt;- subset(euroevol,Country=="Denmark")

#Calibrate and Bin
denmarkDates &lt;- calibrate(x=denmark$C14Age,errors=denmark$C14SD) 
denmarkBins &lt;- binPrep(sites=denmark$SiteID,ages=denmark$C14Age,h=200) #200 years bin size

#Compute median date for each bin
bm &lt;- binMed(x=denmarkDates,bins=denmarkBins)

#Compute median date for each date
dm &lt;- medCal(denmarkDates)

#Compute SPD 
denmarkSPD &lt;- spd(x=denmarkDates,bins=denmarkBins,timeRange=c(10000,4000))

#Plot SPD and barCodes of median dates
plot(denmarkSPD,runm=200)
barCodes(dm,yrng=c(0,0.01)) 

#Plot SPD and barCodes of median bins in BC/AD
plot(denmarkSPD,runm=200,calendar="BCAD")
barCodes(BPtoBCAD(bm),yrng=c(0,0.01)) 

## End(Not run)
</code></pre>

<hr>
<h2 id='BCADtoBP'>Convert BC/AD dates to BP format</h2><span id='topic+BCADtoBP'></span>

<h3>Description</h3>

<p>Converts BC/AD dates to BP format while handling the absence of 'year 0'
</p>


<h3>Usage</h3>

<pre><code class='language-R'>BCADtoBP(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="BCADtoBP_+3A_x">x</code></td>
<td>
<p>A numerical vector (currently only basic checks that these numbers are in a sensible range).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector with BP dates.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>BCADtoBP(-1268)
</code></pre>

<hr>
<h2 id='binMed'>Computes the median date of each bin</h2><span id='topic+binMed'></span>

<h3>Description</h3>

<p>Function for generating a vector of median calibrated dates for each each bin.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>binMed(x, bins, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="binMed_+3A_x">x</code></td>
<td>
<p>A <code>CalDates</code> class object.</p>
</td></tr>
<tr><td><code id="binMed_+3A_bins">bins</code></td>
<td>
<p>vector containing the bin names associated with each radiocarbon date. Can be generated using <code><a href="#topic+binPrep">binPrep</a></code>.</p>
</td></tr>
<tr><td><code id="binMed_+3A_verbose">verbose</code></td>
<td>
<p>A logical variable indicating whether extra information on progress should be reported. Default is TRUE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector of median dates in cal BP
</p>


<h3>See Also</h3>

<p><code><a href="#topic+binPrep">binPrep</a></code>,<code><a href="#topic+barCodes">barCodes</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
#Load EUROEVOL Data
data(euroevol)
#Subset Danish Dates
denmark &lt;- subset(euroevol,Country=="Denmark")
#Calibrate and Bin
denmarkDates &lt;- calibrate(x=denmark$C14Age,errors=denmark$C14SD) 
denmarkBins &lt;- binPrep(sites=denmark$SiteID,ages=denmark$C14Age,h=200) #200 years bin size
#Compute median date for each bin
binMed(x=denmarkDates,bins=denmarkBins)

## End(Not run)
</code></pre>

<hr>
<h2 id='binPrep'>Binning function of radiocarbon dates.</h2><span id='topic+binPrep'></span>

<h3>Description</h3>

<p>Prepare a set of bins for controlling the aggregation of radiocarbon dates
known to be from the same phase of same archaeological site (for use with <code><a href="#topic+spd">spd</a></code>). Used in cases where there is a concern that unusually high levels of sampling for radiocarbon at a given site or in a given site phase will impede comparison between sites or phases.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>binPrep(sites, ages, h, method = "complete")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="binPrep_+3A_sites">sites</code></td>
<td>
<p>a vector of character strings (or number to coerce to character) of all sites or site phases. If character strings are used these should not contain underscores (see also below)</p>
</td></tr>
<tr><td><code id="binPrep_+3A_ages">ages</code></td>
<td>
<p>a vector of uncalibrated conventional radiocarbon ages or a <code>CalDates</code> class object obtained using the <code><a href="#topic+calibrate">calibrate</a></code> function.</p>
</td></tr>
<tr><td><code id="binPrep_+3A_h">h</code></td>
<td>
<p>a single numeric value passed to <code><a href="stats.html#topic+cutree">cutree</a></code> control degree of grouping of similar ages in a phase site.</p>
</td></tr>
<tr><td><code id="binPrep_+3A_method">method</code></td>
<td>
<p>the agglomeration method to be used, passed on to <code><a href="stats.html#topic+hclust">hclust</a></code>. Defaults to &quot;complete&quot; as in <code><a href="stats.html#topic+hclust">hclust</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>ages</code> is a <code>CalDates</code> class object, median dates are used for the clustering.
</p>


<h3>Value</h3>

<p>A vector of character strings with the same length of the object supplied for the argument <code>ages</code> identifying intra-site or intra-phase grouping, for use with <code><a href="#topic+spd">spd</a></code>.The character strings effectively provide a &quot;name&quot; for each &quot;phase&quot; within a &quot;site&quot;, using sequential integers after an underscore. For example if a site named &quot;S001&quot; had four dates grouped into two bins with two dates each, the resulting vector would be &quot;S001_1&quot;, &quot;S001_1&quot;, &quot;S001_2&quot;, and &quot;S001_2&quot;.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spd">spd</a></code> for generating SPD; <code><a href="#topic+binsense">binsense</a></code> for sensitivity analysis pertaining the choice of the parameter <code>h</code>.
</p>

<hr>
<h2 id='binsense'>Bin sensitivity Plot</h2><span id='topic+binsense'></span>

<h3>Description</h3>

<p>Visually explores how choosing different values for <code>h</code> in the <code><a href="#topic+binPrep">binPrep</a></code> function affects the shape of the SPD.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>binsense(
  x,
  y,
  h,
  timeRange,
  calendar = "BP",
  binning = "CRA",
  raw = F,
  verbose = T,
  legend = T,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="binsense_+3A_x">x</code></td>
<td>
<p>A <code>CalDates</code> class object containing calibrated radiocarbon dates.</p>
</td></tr>
<tr><td><code id="binsense_+3A_y">y</code></td>
<td>
<p>A vector containing the locations ID (e.g. site ID) of each calibrated date to be used for the binning process.</p>
</td></tr>
<tr><td><code id="binsense_+3A_h">h</code></td>
<td>
<p>A vector of numbers containing values for the <code>h</code> parameter to be used in the <code><a href="#topic+binPrep">binPrep</a></code> function.</p>
</td></tr>
<tr><td><code id="binsense_+3A_timerange">timeRange</code></td>
<td>
<p>A vector of length 2 indicating the start and end date of the analysis in cal BP.</p>
</td></tr>
<tr><td><code id="binsense_+3A_calendar">calendar</code></td>
<td>
<p>Either <code>'BP'</code> or <code>'BCAD'</code>. Indicate whether the calibrated date should be displayed in BP or BC/AD. Default is  <code>'BP'</code>.</p>
</td></tr>
<tr><td><code id="binsense_+3A_binning">binning</code></td>
<td>
<p>Either <code>'CRA'</code> or <code>'calibrated'</code>. Indicate whether the binning should be carried using the 14C age or using the median calibrated date. Default is <code>'CRA'</code>.</p>
</td></tr>
<tr><td><code id="binsense_+3A_raw">raw</code></td>
<td>
<p>A logical variable indicating whether all  SPDs should be returned or not. Default is FALSE.</p>
</td></tr>
<tr><td><code id="binsense_+3A_verbose">verbose</code></td>
<td>
<p>A logical variable indicating whether extra information on progress should be reported. Default is TRUE.</p>
</td></tr>
<tr><td><code id="binsense_+3A_legend">legend</code></td>
<td>
<p>A logical variable indicating whether the legend should be displayed. Default is TRUE</p>
</td></tr>
<tr><td><code id="binsense_+3A_...">...</code></td>
<td>
<p>Additional arguments to be passed to the <code><a href="#topic+spd">spd</a></code> function.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+binPrep">binPrep</a></code>; <code><a href="#topic+spd">spd</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data(euroevol)
#subset Danish dates
denmark=subset(euroevol,Country=="Denmark")
denmarkDates=calibrate(x=denmark$C14Age,errors=denmark$C14SD)
binsense(x=denmarkDates,y=denmark$SiteID,h=seq(0,200,20),timeRange=c(10000,4000),runm=200)

## End(Not run)
</code></pre>

<hr>
<h2 id='BPtoBCAD'>Convert BP dates to BC/AD format</h2><span id='topic+BPtoBCAD'></span>

<h3>Description</h3>

<p>Converts calibrated BP dates to BC/AD dates, omitting &lsquo;year 0&rsquo;
</p>


<h3>Usage</h3>

<pre><code class='language-R'>BPtoBCAD(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="BPtoBCAD_+3A_x">x</code></td>
<td>
<p>A numerical vector (currently only basic checks that these numbers are in a sensible range).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector with BC/BCE dates expressed as negative numbers and AD/CE dates as positive ones.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>BPtoBCAD(4200)
</code></pre>

<hr>
<h2 id='calibrate'>Calibrate radiocarbon dates</h2><span id='topic+calibrate'></span><span id='topic+calibrate.default'></span><span id='topic+calibrate.UncalGrid'></span>

<h3>Description</h3>

<p>Function for calibrating radiocarbon dates or uncalibrated SPDs.
</p>
<p>Function for calibrating a SPD generated by summing uncalibrated dates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calibrate(x, ...)

## Default S3 method:
calibrate(
  x,
  errors,
  ids = NA,
  dateDetails = NA,
  calCurves = "intcal20",
  resOffsets = 0,
  resErrors = 0,
  timeRange = c(55000, 0),
  normalised = TRUE,
  F14C = FALSE,
  calMatrix = FALSE,
  eps = 1e-05,
  ncores = 1,
  verbose = TRUE,
  ...
)

## S3 method for class 'UncalGrid'
calibrate(
  x,
  errors = 0,
  calCurves = "intcal20",
  timeRange = c(55000, 0),
  eps = 1e-05,
  type = "fast",
  datenormalised = FALSE,
  spdnormalised = FALSE,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calibrate_+3A_x">x</code></td>
<td>
<p>A vector of uncalibrated radiocarbon ages or a UncalGrid class object.</p>
</td></tr>
<tr><td><code id="calibrate_+3A_...">...</code></td>
<td>
<p>ignored</p>
</td></tr>
<tr><td><code id="calibrate_+3A_errors">errors</code></td>
<td>
<p>A vector of standard deviations corresponding to each estimated radiocarbon age.</p>
</td></tr>
<tr><td><code id="calibrate_+3A_ids">ids</code></td>
<td>
<p>An optional vector of IDs for each date.</p>
</td></tr>
<tr><td><code id="calibrate_+3A_datedetails">dateDetails</code></td>
<td>
<p>An optional vector of details for each date which will be returned in the output metadata.</p>
</td></tr>
<tr><td><code id="calibrate_+3A_calcurves">calCurves</code></td>
<td>
<p>Either a character string naming a calibration curve already provided with the rcarbon package (currently 'intcal20','intcal13','intcal13nhpine16','shcal20','shcal13','shcal13shkauri16',&rdquo;marine13','marine20' and 'normal'(i.e. no calibration) are possible; default is 'intcal20') or a custom calibration curve as three-column matrix or data.frame (calibrated year BP, uncalibrated age bp, standard deviation). Different existing curves can be specified per dated sample, but only one custom curve can be provided for all dates.</p>
</td></tr>
<tr><td><code id="calibrate_+3A_resoffsets">resOffsets</code></td>
<td>
<p>A vector of offset values for any marine reservoir effect (default is no offset).</p>
</td></tr>
<tr><td><code id="calibrate_+3A_reserrors">resErrors</code></td>
<td>
<p>A vector of offset value errors for any marine reservoir effect (default is no offset).</p>
</td></tr>
<tr><td><code id="calibrate_+3A_timerange">timeRange</code></td>
<td>
<p>Earliest and latest data to calibrate for, in calendar years. Posterior probabilities beyond this range will be excluded (the default is sensible in most cases).</p>
</td></tr>
<tr><td><code id="calibrate_+3A_normalised">normalised</code></td>
<td>
<p>A logical variable indicating whether the calibration should be normalised or not. Default is TRUE.</p>
</td></tr>
<tr><td><code id="calibrate_+3A_f14c">F14C</code></td>
<td>
<p>A logical variable indicating whether calibration should be carried out in F14C space or not. Default is FALSE.</p>
</td></tr>
<tr><td><code id="calibrate_+3A_calmatrix">calMatrix</code></td>
<td>
<p>a logical variable indicating whether the age grid should be limited to probabilities higher than <code>eps</code></p>
</td></tr>
<tr><td><code id="calibrate_+3A_eps">eps</code></td>
<td>
<p>Cut-off value for density calculation. Default is 1e-5.</p>
</td></tr>
<tr><td><code id="calibrate_+3A_ncores">ncores</code></td>
<td>
<p>Number of cores/workers used for parallel execution. Default is 1 (&gt;1 requires doSnow package).</p>
</td></tr>
<tr><td><code id="calibrate_+3A_verbose">verbose</code></td>
<td>
<p>A logical variable indicating whether extra information on progress should be reported. Default is TRUE.</p>
</td></tr>
<tr><td><code id="calibrate_+3A_type">type</code></td>
<td>
<p>Currently, two options are available. With &quot;fast&quot;, a look-up is conducted for each calendar year that picks up the amplitude of the nearest CRA age. With &quot;full&quot;, each CRA is calibrated individually and then summed (much slower).</p>
</td></tr>
<tr><td><code id="calibrate_+3A_datenormalised">datenormalised</code></td>
<td>
<p>Controls for calibrated dates with probability mass outside the timerange of analysis. If set to TRUE the total probability mass within the time-span of analysis is normalised to sum to unity. Should be set to FALSE when the parameter <code>normalised</code> in <code><a href="#topic+calibrate">calibrate</a></code> is set to FALSE. Default is FALSE.</p>
</td></tr>
<tr><td><code id="calibrate_+3A_spdnormalised">spdnormalised</code></td>
<td>
<p>A logical variable indicating whether the total probability mass of the SPD is normalised to sum to unity.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function computes one or more calibrated radiocarbon ages using the method described in Bronk Ramsey 2008 (see also  Parnell 2017). It is possible to specify different calibration curves or reservoir offsets individually for each date, and control whether the resulting calibrated distribution is normalised to 1 under-the-curve or not. Calculations can also be executed in parallel to reduce computing time. The function was modified from the <code>BchronCalibrate</code> function in the <code>Bchron</code> package developed by A.Parnell (see references below).
</p>


<h3>Value</h3>

<p>An object of class CalDates with the following elements:
</p>

<ul>
<li><p><code>metadata</code> A data.frame containing relevant information regarding each radiocarbon date and the parameter used in the calibration process.
</p>
</li>
<li><p><code>grids</code> A list of calGrid class objects, containing the posterior probabilities for each calendar year. The most memory-efficient way to store calibrated dates, as only years with non-zero probability are stored, but aggregation methods such as <code>spd()</code> may then take longer to extract and combine multiple dates. NA when the parameter calMatrix is set to TRUE. 
</p>
</li>
<li><p><code>calMatrix</code> A matrix of probability values, one row per calendar year in timeRange and one column per date. By storing all possible years, not just those with non-zero probability, this approach takes more memory, but speeds up spd() and is suggested whenever the latter is to be used. NA when the parameter calMatrix is set to FALSE.  
</p>
</li></ul>



<h3>References</h3>

<p>Bronk Ramsey, C. 2008. Radiocarbon dating: revolutions in understanding, <em>Archaeometry</em> 50.2: 249-75. DOI: https://doi.org/10.1111/j.1475-4754.2008.00394.x <br />
Parnell, A. 2017. Bchron: Radiocarbon Dating, Age-Depth Modelling, Relative Sea Level Rate Estimation, and Non-Parametric Phase Modelling, R package: https://CRAN.R-project.org/package=Bchron
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x1 &lt;- calibrate(x=4000, errors=30)
plot(x1)
summary(x1)
# Example with a Marine Date, using a DeltaR of 300 and a DeltaR error of 30
x2 &lt;- calibrate(x=4000, errors=30, calCurves='marine20', resOffsets=300, resErrors=30)
plot(x2)
</code></pre>

<hr>
<h2 id='ckde'>Composite Kernel Density Estimates of Radiocarbon Dates</h2><span id='topic+ckde'></span>

<h3>Description</h3>

<p>Computes a Composite Kernel Density Estimate (CKDE) from multiple sets of randomly sampled calendar dates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ckde(x, timeRange, bw, normalised = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ckde_+3A_x">x</code></td>
<td>
<p>A <code>simdates</code> class object, generated using <code><a href="#topic+sampleDates">sampleDates</a></code>.</p>
</td></tr>
<tr><td><code id="ckde_+3A_timerange">timeRange</code></td>
<td>
<p>A vector of length 2 indicating the start and end date of the analysis in cal BP.</p>
</td></tr>
<tr><td><code id="ckde_+3A_bw">bw</code></td>
<td>
<p>Kernel bandwidth to be used.</p>
</td></tr>
<tr><td><code id="ckde_+3A_normalised">normalised</code></td>
<td>
<p>A logical variable indicating whether the contribution of individual dates should be equal (TRUE), or weighted based on the area under the curve of non-normalised calibration (FALSE). Default is TRUE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function computes Kernel Density Estimates using randomly sampled calendar dates contained in a <code>simdates</code> class object (generated using the <code>sampledates()</code> function). The output contains <code>nsim</code> KDEs, where <code>nsim</code> is the argument used in <code>simulate.dates()</code>. The resulting object can be plotted to visualise a CKDE (cf Brown 2017), and if <code>boot</code> was set to <code>TRUE</code> in <code>sampleDates</code> its bootstrapped variant (cf McLaughlin 2018 for a similar analysis). The shape of the CKDE is comparable to an SPD generated from non-normalised dates when the argument <code>normalised</code> is set to FALSE.
</p>


<h3>Value</h3>

<p>An object of class <code>ckdeSPD</code> with the following elements
</p>

<ul>
<li><p><code>timeRange</code> The <code>timeRange</code> setting used.
</p>
</li>
<li><p><code>res.matrix</code> A matrix containing the KDE values with rows representing calendar dates.
</p>
</li></ul>



<h3>References</h3>

<p>Brown, W. A. 2017. The past and future of growth rate estimation in demographic temporal frequency analysis: Biodemographic interpretability and the ascendance of dynamic growth models. <em>Journal of Archaeological Science</em>, 80: 96–108. DOI: https://doi.org/10.1016/j.jas.2017.02.003 <br />
McLaughlin, T. R. 2018. On Applications of Space–Time Modelling with Open-Source 14C Age Calibration. <em>Journal of Archaeological Method and Theory</em>. DOI https://doi.org/10.1007/s10816-018-9381-3
</p>


<h3>See Also</h3>

<p><code><a href="#topic+sampleDates">sampleDates</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data(emedyd)
x = calibrate(x=emedyd$CRA, errors=emedyd$Error,normalised=FALSE)
bins = binPrep(sites=emedyd$SiteName, ages=emedyd$CRA,h=50)
s = sampleDates(x,bins=bins,nsim=100,boot=FALSE)
ckdeNorm = ckde(s,timeRange=c(16000,9000),bw=100,normalised=TRUE)
plot(ckdeNorm,type='multiline',calendar='BCAD')

## End(Not run)

</code></pre>

<hr>
<h2 id='combine'>Combine multiple CalDates Class Objects into one.</h2><span id='topic+combine'></span>

<h3>Description</h3>

<p>Combine multiple CalDates Class Objects into one.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>combine(..., fixIDs = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="combine_+3A_...">...</code></td>
<td>
<p><code>CalDates</code> class objects to be concatenated.</p>
</td></tr>
<tr><td><code id="combine_+3A_fixids">fixIDs</code></td>
<td>
<p>logical. If set to TRUE, each date is given a new ID based on sequential integer. Default is FALSE</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class CalDates
</p>


<h3>See Also</h3>

<p><code><a href="#topic+calibrate">calibrate</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'> 
x1 = calibrate(c(2000,3400),c(20,20),ids=1:2)
x2 = calibrate(c(4000,3000),c(30,30),calCurves=c('intcal20','marine20'),
resOffsets=c(0,30),resErrors=c(0,20),ids=3:4)
mcurve &lt;- mixCurves('intcal20','marine20',p=0.7,resOffsets=300,resErrors=20)
x3 = calibrate(5300,20,calCurves=mcurve,ids=5)
x = combine(x1,x2,x3)
## x$metadata
</code></pre>

<hr>
<h2 id='emedyd'>Radiocarbon dates for the Eastern Mediterranean around the Younger Dryas</h2><span id='topic+emedyd'></span>

<h3>Description</h3>

<p>Radiocarbon dates (n=1915) and site coordinates (n=201) from a paper considering the relationship between human activity in the eastern Mediterranean/Middle East and early Holocene climate change, including the Younger Dryas.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>emedyd
</code></pre>


<h3>Format</h3>

<p>A data.frame with the following variables:
</p>

<dl>
<dt><code>LabID</code></dt><dd><p>Laboratory ID assigned to each radiocarbon date (where known)</p>
</dd>
<dt><code>CRA</code></dt><dd><p>Radiocarbon age in 14C years BP</p>
</dd>
<dt><code>Error</code></dt><dd><p>Radiocarbon age error</p>
</dd>
<dt><code>Material</code></dt><dd><p>Material of the dated sample</p>
</dd>
<dt><code>Species</code></dt><dd><p>Species of the dated sample (where identified)</p>
</dd>
<dt><code>SiteName</code></dt><dd><p>Name of the site from which the sample has been recovered</p>
</dd>
<dt><code>Country</code></dt><dd><p>Country where the sampling site is located</p>
</dd>
<dt><code>Longitude</code></dt><dd><p>Longitude of the sampling site in decimal degrees</p>
</dd>
<dt><code>Latitude</code></dt><dd><p>Latitude of the sampling site in decimal degrees</p>
</dd>
<dt><code>Region</code></dt><dd><p>One of three analytical regions (1=southern Levant, 2=Northern Levant, 3= South-central Anatolia</p>
</dd>
</dl>



<h3>Source</h3>

<p>Palmisano, A., Bevan, A. and S. Shennan 2017. Data and code for demographic trends in the paper &quot;Human responses and non-responses to climatic variations during the Last Glacial-Interglacial transition in the eastern Mediterranean&quot;, UCL Discovery Archive 1570274. doi:10.14324/000.ds.1570274.
</p>


<h3>References</h3>

<p>Roberts, N., Woodbridge, J., Bevan, A., Palmisano, A., Shennan, S. and E. Asouti 2017. Human responses and non-responses to climatic variations during the Last Glacial-Interglacial transition in the eastern Mediterranean. Quaternary Science Reviews, 184, 47-67. doi:10.1016/j.quascirev.2017.09.011.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data(emedyd)
northernlevant &lt;- emedyd[emedyd$Region=="2",]
bins &lt;- binPrep(northernlevant$SiteName, northernlevant$CRA, h=50)
x &lt;- calibrate(northernlevant$CRA, northernlevant$Error, normalised=FALSE)
spd.northernlevant &lt;- spd(x, bins=bins, runm=50, timeRange=c(17000,8000))
plot(spd.northernlevant)

## End(Not run)
</code></pre>

<hr>
<h2 id='euroevol'>Radiocarbon dates from the EUROEVOL database</h2><span id='topic+euroevol'></span>

<h3>Description</h3>

<p>Radiocarbon dates (n=14,053) and site coordinates (n=4,213) from the EUROEVOL project database. Sites without radiocarbon dates (n=544), phase-codes, and other data have been omitted.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>euroevol
</code></pre>


<h3>Format</h3>

<p>A data.frame with the following variables:
</p>

<dl>
<dt><code>C14ID</code></dt><dd><p>ID of each radiocarbon date</p>
</dd>
<dt><code>C14Age</code></dt><dd><p>Radiocarbon age in 14C years BP</p>
</dd>
<dt><code>C14SD</code></dt><dd><p>Radiocarbon age error</p>
</dd>
<dt><code>LabCode</code></dt><dd><p>Labcode of the radiocarbon date</p>
</dd>
<dt><code>Material</code></dt><dd><p>Material of the dated sample</p>
</dd>
<dt><code>SiteID</code></dt><dd><p>ID of the site from which the sample has been recovered</p>
</dd>
<dt><code>Latitude</code></dt><dd><p>Latitude of the sampling site in decimal degrees</p>
</dd>
<dt><code>Longitude</code></dt><dd><p>Longitude of the sampling site in decimal degrees</p>
</dd>
<dt><code>Country</code></dt><dd><p>Country where the sampling site is located</p>
</dd>
</dl>



<h3>Source</h3>

<p>Manning, K., Colledge, S., Crema, E., Shennan, S., Timpson, A., 2016. The Cultural Evolution of Neolithic Europe. EUROEVOL Dataset 1: Sites, Phases and Radiocarbon Data. Journal of Open Archaeology Data 5. doi:10.5334/joad.40
</p>


<h3>References</h3>

<p>Shennan, S., Downey, S.S., Timpson, A., Edinborough, K., Colledge, S., Kerig, T., Manning, K., Thomas, M.G., 2013. Regional population collapse followed initial agriculture booms in mid-Holocene Europe. Nature Communications 4, ncomms3486. doi:10.1038/ncomms3486
</p>
<p>Timpson, A., Colledge, S., Crema, E., Edinborough, K., Kerig, T., Manning, K., Thomas, M.G., Shennan, S., 2014. Reconstructing regional population fluctuations in the European Neolithic using radiocarbon dates: a new case-study using an improved method. Journal of Archaeological Science 52, 549-557. doi:10.1016/j.jas.2014.08.011
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data(euroevol)
Ireland &lt;- subset(euroevol,Country=="Ireland")
bins &lt;- binPrep(Ireland$SiteID,Ireland$C14Age,h=200)
x &lt;- calibrate(Ireland$C14Age,Ireland$C14SD)
spd.ireland &lt;- spd(x,bins=bins,runm=200,timeRange=c(8000,4000))
plot(spd.ireland)

## End(Not run)
</code></pre>

<hr>
<h2 id='ewdates'>Subset of EUROEVOL radiocarbon dates from Great Britain</h2><span id='topic+ewdates'></span>

<h3>Description</h3>

<p>Radiocarbon dates (n=2,324) and site coordinates (n=652) from England and Wales collected from the EUROEVOL project database. See <cite><a href="#topic+euroevol">euroevol</a></cite> for more details regarding the source data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ewdates
</code></pre>


<h3>Format</h3>

<p>A data.frame with the following variables:
</p>

<dl>
<dt><code>C14ID</code></dt><dd><p>ID of each radiocarbon date</p>
</dd>
<dt><code>C14Age</code></dt><dd><p>Radiocarbon age in 14C years BP</p>
</dd>
<dt><code>C14SD</code></dt><dd><p>Radiocarbon age error</p>
</dd>
<dt><code>LabCode</code></dt><dd><p>Labcode of the radiocarbon date</p>
</dd>
<dt><code>Material</code></dt><dd><p>Material of the dated sample</p>
</dd>
<dt><code>SiteID</code></dt><dd><p>ID of the site from which the sample has been recovered</p>
</dd>
<dt><code>Eastings</code></dt><dd><p>Easting coordinates of the sampling site in meters (OSGB 1936 epsg:27700) </p>
</dd>
<dt><code>Northings</code></dt><dd><p>Northing coordinates of the sampling site in meters (OSGB 1936 epsg:27700)</p>
</dd>
</dl>



<h3>Source</h3>

<p>Manning, K., Colledge, S., Crema, E., Shennan, S., Timpson, A., 2016. The Cultural Evolution of Neolithic Europe. EUROEVOL Dataset 1: Sites, Phases and Radiocarbon Data. Journal of Open Archaeology Data 5. doi:10.5334/joad.40
</p>

<hr>
<h2 id='ewowin'>Polygonal window of England and Wales</h2><span id='topic+ewowin'></span>

<h3>Description</h3>

<p>An <code><a href="spatstat.geom.html#topic+owin">owin</a></code> class polygonal window of England and Wales.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ewowin
</code></pre>


<h3>Format</h3>

<p>An <code>owin</code> class object.
</p>


<h3>Source</h3>

<p>South,A.2011.rworldmap: A New R package for Mapping Global Data. The R Journal Vol. 3/1 : 35-43.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data(ewowin)
# Obtained from rworldmap:
library(maptools)
library(rgeos)
library(rworldmap)
bng &lt;- CRS("+init=epsg:27700")
sbrit &lt;- getMap(resolution="high")
sbrit &lt;- spTransform(sbrit[sbrit$GEOUNIT =="United Kingdom",], bng)
tmp &lt;- SpatialPolygons(list(Polygons(list(Polygon(cbind(c(130000,130000,310000,
425000,700000,700000,130000), c(0,300000,560000,598000,300000,0,0)))), 
"1")), 1:1, proj4string=bng)
sbrit &lt;- gIntersection(sbrit,tmp) 
ewowin &lt;- as.owin(sbrit)

## End(Not run)
</code></pre>

<hr>
<h2 id='gaussW'>Gaussian weighting of dates relative to</h2><span id='topic+gaussW'></span>

<h3>Description</h3>

<p>Rescale a numeric vector to a specified minimum and maximum.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gaussW(x, mean, sd, type = "weights")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gaussW_+3A_x">x</code></td>
<td>
<p>A numeric vector or an object of class CalDates.</p>
</td></tr>
<tr><td><code id="gaussW_+3A_mean">mean</code></td>
<td>
<p>A single numeric value indicating the value to centre the Gaussian kernel on.</p>
</td></tr>
<tr><td><code id="gaussW_+3A_sd">sd</code></td>
<td>
<p>A single numeric value indicating the standard deviation of the Gaussian kernel to be used.</p>
</td></tr>
<tr><td><code id="gaussW_+3A_type">type</code></td>
<td>
<p>The type of output to produce: currently either &quot;weighted&quot; (for a simple total weight value for each date) or &quot;raw&quot; (a list of reweighted calibrated radiocarbon probabilities for each calibrated date).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector of weights (or optionally a list of reweighted calibrated radiocarbon probabilities).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Example weighting fo a set of dates versus a focal date of 5950 calBP
years &lt;- seq(6500, 5500, -10)
plot(cbind(years, gaussW(years, 5950, 50)))
## Example weighting of three calibrated dates  versus a focal date of 5950 calBP
dates &lt;- calibrate(c(5280, 5180, 5080), c(30,30,30), normalised=FALSE)
gaussW(dates, 5950, 50)
## Or the same with raw output
dateswt &lt;- gaussW(dates, 5950, 50, type="raw")
head(dateswt[[1]])
</code></pre>

<hr>
<h2 id='hpdi'>Computes the highest posterior density interval (HPDI) for calibrated dates</h2><span id='topic+hpdi'></span>

<h3>Description</h3>

<p>Computes the highest posterior density interval (HPDI) for calibrated dates
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hpdi(
  x,
  credMass = 0.95,
  asList = TRUE,
  calendar = "BP",
  sep = "|",
  pdigits = 3
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hpdi_+3A_x">x</code></td>
<td>
<p>A <code>CalDates</code> class object.</p>
</td></tr>
<tr><td><code id="hpdi_+3A_credmass">credMass</code></td>
<td>
<p>Interval probability mass</p>
</td></tr>
<tr><td><code id="hpdi_+3A_aslist">asList</code></td>
<td>
<p>Logical variable determining whether the output should be a list (TRUE)  or a character vector (FALSE). Default is TRUE</p>
</td></tr>
<tr><td><code id="hpdi_+3A_calendar">calendar</code></td>
<td>
<p>Whether daes should be reported in cal BP (<code>"BP"</code>) or in BCAD (<code>"BCAD"</code>). Default is 'BP'. Ignored when <code>"asList=TRUE"</code>.</p>
</td></tr>
<tr><td><code id="hpdi_+3A_sep">sep</code></td>
<td>
<p>character string to separate date ranges. Default is '|'. Ignored when <code>"asList==TRUE"</code>.</p>
</td></tr>
<tr><td><code id="hpdi_+3A_pdigits">pdigits</code></td>
<td>
<p>indicate the number of decimal places for reporting probabilities. Default is 3. Ignored when <code>"asList==TRUE"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of matrices with HPDI ranges and associated probabilities in cal BP. Note that the sum of the probability mass will be only approximately equal to the argument <code>credMass</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+calibrate">calibrate</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- calibrate(c(2000,3050,2950),c(35,20,20))
hpdi(x)
hpdi(x,asList=FALSE,calendar='BCAD')
</code></pre>

<hr>
<h2 id='medCal'>Computes the median date of calibrated dates</h2><span id='topic+medCal'></span>

<h3>Description</h3>

<p>Function for generating a vector median calibrated dates from a <code>CalDates</code> class object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>medCal(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="medCal_+3A_x">x</code></td>
<td>
<p>A <code>CalDates</code> class object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector of median dates in cal BP
</p>


<h3>See Also</h3>

<p><code><a href="#topic+calibrate">calibrate</a></code>, <code><a href="#topic+barCodes">barCodes</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- calibrate(c(3050,2950),c(20,20))
medCal(x)
</code></pre>

<hr>
<h2 id='mixCurves'>Creates mixed calibration curves.</h2><span id='topic+mixCurves'></span>

<h3>Description</h3>

<p>Function for generating mixed calibration curves (e.g. intcal20/marine20, intcal20/shcal20)  with user-defined proportions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mixCurves(
  calCurve1 = "intcal20",
  calCurve2 = "marine20",
  p = 0.5,
  resOffsets = 0,
  resErrors = 0
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mixCurves_+3A_calcurve1">calCurve1</code></td>
<td>
<p>Name of the first curve, chosen from 'intcal20','intcal13','intcal13nhpine16','shcal20','shcal13','shcal13shkauri16',&rdquo;marine13','marine20'. Default is 'intcal20'.</p>
</td></tr>
<tr><td><code id="mixCurves_+3A_calcurve2">calCurve2</code></td>
<td>
<p>Name of the second curve, from the same list. Default is 'marine20'.</p>
</td></tr>
<tr><td><code id="mixCurves_+3A_p">p</code></td>
<td>
<p>The proportion of contribution of the first curve. Default is 1.</p>
</td></tr>
<tr><td><code id="mixCurves_+3A_resoffsets">resOffsets</code></td>
<td>
<p>Offset value for the marine reservoir effect to be applied to calCurve2. Default is 0.</p>
</td></tr>
<tr><td><code id="mixCurves_+3A_reserrors">resErrors</code></td>
<td>
<p>Error of the marine reservoir effect offset to be applied to calCurve2. Default is 0.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function is based on the <code>mix.calibrationcurves</code> function of the <code>clam</code> package.
</p>


<h3>Value</h3>

<p>A three-column matrix containing calibrated year BP, uncalibrated age bp, and standard deviation. To be used as custom calibration curve for the <code><a href="#topic+calibrate">calibrate</a></code> function.
</p>


<h3>References</h3>

<p>Blaauw, M. and Christen, J.A.. 2011. Flexible paleoclimate age-depth models using an autoregressive gamma process. <em>Bayesian Analysis</em>, 6, 457-474.
Blaauw, M. 2018. clam: Classical Age-Depth Modelling of Cores from Deposits. R package version 2.3.1. https://CRAN.R-project.org/packacge=clam
Marsh, E.J., Bruno, M.C., Fritz, S.C., Baker, P., Capriles, J.M. and Hastorf, C.A., 2018. IntCal, SHCal, or a Mixed Curve? Choosing a 14 C Calibration Curve for Archaeological and Paleoenvironmental Records from Tropical South America. Radiocarbon, 60(3), pp.925-940.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+calibrate">calibrate</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>myCurve &lt;- mixCurves('intcal20','marine20',p=0.7,resOffsets=300,resErrors=20)
x &lt;- calibrate(4000,30,calCurves=myCurve)
</code></pre>

<hr>
<h2 id='modelTest'>Monte-Carlo simulation test for SPDs</h2><span id='topic+modelTest'></span>

<h3>Description</h3>

<p>Comparison of an observed summed radiocarbon date distribution (aka SPD) with simulated outcomes from a theoretical model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>modelTest(
  x,
  errors,
  nsim,
  bins = NA,
  runm = NA,
  timeRange = NA,
  backsight = 50,
  changexpr = expression((t1/t0)^(1/d) - 1),
  gridclip = TRUE,
  raw = FALSE,
  model = c("exponential"),
  method = c("uncalsample"),
  predgrid = NA,
  normalised = NA,
  datenormalised = NA,
  spdnormalised = FALSE,
  ncores = 1,
  fitonly = FALSE,
  a = 0,
  b = 0,
  edgeSize = 500,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="modelTest_+3A_x">x</code></td>
<td>
<p>A <code>CalDates</code> object containing calibrated radiocarbon ages</p>
</td></tr>
<tr><td><code id="modelTest_+3A_errors">errors</code></td>
<td>
<p>A vector of errors corresponding to each radiocarbon age</p>
</td></tr>
<tr><td><code id="modelTest_+3A_nsim">nsim</code></td>
<td>
<p>Number of simulations</p>
</td></tr>
<tr><td><code id="modelTest_+3A_bins">bins</code></td>
<td>
<p>A vector indicating which bin each radiocarbon date is assigned to.</p>
</td></tr>
<tr><td><code id="modelTest_+3A_runm">runm</code></td>
<td>
<p>A number indicating the window size of the moving average to smooth both observed and simulated SPDs. If set to <code>NA</code> no moving average is applied.Default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="modelTest_+3A_timerange">timeRange</code></td>
<td>
<p>A vector of length 2 indicating the start and end date of the analysis in cal BP. The fitting process is applied considering the SPD within the interval defined by this parameter. If no values are supplied the earliest and latest median calibrated dates of the observed data will be used.</p>
</td></tr>
<tr><td><code id="modelTest_+3A_backsight">backsight</code></td>
<td>
<p>A single numeric value defining the distance in time between the focal year and the backsight year for computing the rate of change. Default is 10.</p>
</td></tr>
<tr><td><code id="modelTest_+3A_changexpr">changexpr</code></td>
<td>
<p>An expression for calculating the rate of change in SPD between the focal year and a backsight year. Available input options are t1 (the SPD for the focal year), t0 (the SPD for the backsight year), d (the distance between t0 and t1), and any other standard constants and mathematical operators. A sensible default is provided.</p>
</td></tr>
<tr><td><code id="modelTest_+3A_gridclip">gridclip</code></td>
<td>
<p>Whether the sampling of random dates is constrained to the observed range (TRUE) or not (FALSE). Default is TRUE.</p>
</td></tr>
<tr><td><code id="modelTest_+3A_raw">raw</code></td>
<td>
<p>A logical variable indicating whether all permuted SPDs should be returned or not. Default is FALSE.</p>
</td></tr>
<tr><td><code id="modelTest_+3A_model">model</code></td>
<td>
<p>A vector indicating the model to be fitted. Currently the acceptable options are <code>'uniform'</code>, <code>'linear'</code>, <code>'exponential'</code> and <code>'custom'</code>. Default is <code>'exponential'</code>.</p>
</td></tr>
<tr><td><code id="modelTest_+3A_method">method</code></td>
<td>
<p>Method for the creation of random dates from the fitted model. Either <code>'uncalsample'</code> or <code>'calsample'</code>. Default is <code>'uncalsample'</code>. See below for details.</p>
</td></tr>
<tr><td><code id="modelTest_+3A_predgrid">predgrid</code></td>
<td>
<p>A data.frame containing calendar years (column <code>calBP</code>) and associated summed probabilities (column <code>PrDens</code>). Required when <code>model</code> is set to <code>'custom'</code>.</p>
</td></tr>
<tr><td><code id="modelTest_+3A_normalised">normalised</code></td>
<td>
<p>Whether the simulated dates should be normalised or not. Default based on whether x is normalised or not.</p>
</td></tr>
<tr><td><code id="modelTest_+3A_datenormalised">datenormalised</code></td>
<td>
<p>Argument kept for backward compatibility with previous versions.</p>
</td></tr>
<tr><td><code id="modelTest_+3A_spdnormalised">spdnormalised</code></td>
<td>
<p>A logical variable indicating whether the total probability mass of the SPD is normalised to sum to unity for both observed and simulated data.</p>
</td></tr>
<tr><td><code id="modelTest_+3A_ncores">ncores</code></td>
<td>
<p>Number of cores used for for parallel execution. Default is 1.</p>
</td></tr>
<tr><td><code id="modelTest_+3A_fitonly">fitonly</code></td>
<td>
<p>A logical variable. If set to TRUE, only the the model fitting is executed and returned. Default is FALSE.</p>
</td></tr>
<tr><td><code id="modelTest_+3A_a">a</code></td>
<td>
<p>Starter value for the exponential fit with the <code><a href="stats.html#topic+nls">nls</a></code> function using the formula <code>y ~ exp(a + b * x)</code> where <code>y</code> is the summed probability and <code>x</code> is the date. Default is 0.</p>
</td></tr>
<tr><td><code id="modelTest_+3A_b">b</code></td>
<td>
<p>Starter value for the exponential fit with the <code><a href="stats.html#topic+nls">nls</a></code> function using the formula <code>y ~ exp(a + b * x)</code> where <code>y</code> is the summed probability and <code>x</code> is the date. Default is 0.</p>
</td></tr>
<tr><td><code id="modelTest_+3A_edgesize">edgeSize</code></td>
<td>
<p>Controls edge effect by expanding the fitted model beyond the range defined by <code>timeRange</code>.</p>
</td></tr>
<tr><td><code id="modelTest_+3A_verbose">verbose</code></td>
<td>
<p>A logical variable indicating whether extra information on progress should be reported. Default is TRUE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function implements a Monte-Carlo test for comparing a theoretical or fitted statistical model to an observed summed radiocarbon date distribution (aka SPD) and associated rates of changes. A variety of theoretical expectations can be compared to the observed distribution by setting the <code>model</code> argument, for example to fit basic <code>'uniform'</code> (the mean of the SPD), <code>'linear'</code> (fitted using the <code><a href="stats.html#topic+lm">lm</a></code> function) or <code>model='exponential'</code> models (fitted using the <code><a href="stats.html#topic+nls">nls</a></code> function). Models are fitted to the period spanned by <code>timeRange</code> although <code>x</code> can contain dates outside this range to mitigate possible edge effects (see also <code>bracket</code>). Notice that estimating growth model parameters directly from SPD can be biased, resulting into a null hypothesis that is not necessarily representative (see Crema 2022). It is also possible for the user to provide a model of their own by setting <code>model='custom'</code> and then supplying a two-column data.frame to <code>predgrid</code>. The function generates <code>nsim</code> theoretical SPDs from the fitted model via Monte-Carlo simulation, this is then used to define a 95% critical envelope for each calendar year. The observed SPD is then compared against the simulation envelope; local departures from the model are defined as instances where the observed SPD is outside such an envelope, while an estimate of the global significance of the observed SPD is also computed by comparing the total areas of observed and simulated SPDs that fall outside the simulation envelope. The theoretical SPDs can be generated using two different sampling approaches defined by the parameter <code>method</code>. If <code>method</code> is set to <code>'uncalsample'</code> each date is drawn after the fitted model is backcalibrated as a whole and adjusted for a baseline expectation; if it is set to  <code>'calsample'</code> samples are drawn from the fitted model in calendar year then individually back calibrated and recalibrated (the approach of Timpson et al. 2014). For each simulation, both approaches produces <code class="reqn">n</code> samples, with <code class="reqn">n</code> equal to the number of bins or number of dates (when bins are not defined). Differences between these two approaches are particularly evident at dates coincident with steeper portions of the calibration curve. If more than one type of calibration curve is associated with the observed dates, at each Monte-Carlo iteration, the function randomly assigns each bin to one of the calibration curves with probability based on the proportion of dates within the bin associated to the specific curves. For example, if a bin is composed of four dates and three are calibrated with 'intcal20' the probability of that particular bin being assigned to 'intcal20' is 0.75.
</p>


<h3>Value</h3>

<p>An object of class <code>SpdModelTest</code> with the following elements
</p>

<ul>
<li><p><code>result</code> A four column data.frame containing the observed probability density (column <em>PrDens</em>) and the lower and the upper values of the simulation envelope (columns <em>lo</em> and <em>hi</em>) for each calendar year column <em>calBP</em>
</p>
</li>
<li><p><code>result.roc</code> A four column data.frame containing the observed rates of change (column <em>roc</em>) and the lower and the upper values of the simulation envelope (columns <em>lo.roc</em> and <em>hi.roc</em>) for the mid point between two chronological blocks <em>calBP</em>
</p>
</li>
<li><p><code>sim</code> A matrix containing the simulation results of the summed probabilities. Available only when <code>raw</code> is set to TRUE 
</p>
</li>
<li><p><code>sim.roc</code> A matrix containing the simulation results of the rate of change of summed probabilities. Available only when <code>raw</code> is set to TRUE 
</p>
</li>
<li><p><code>pval</code> A numeric vector containing the p-value of the global significance test for the summed probabilities  
</p>
</li>
<li><p><code>pval.roc</code> A numeric vector containing the p-value of the global significance test for the rates of change  
</p>
</li>
<li><p><code>fit</code> A data.frame containing the probability densities of the fitted model for each calendar year within the time range of analysis  
</p>
</li>
<li><p><code>fitobject</code> Fitted model. Not available when <code>model</code> is <code>'custom'</code>  
</p>
</li>
<li><p><code>n</code> Number of radiocarbon dates.
</p>
</li>
<li><p><code>nbins</code>Number of bins.
</p>
</li>
<li><p><code>nsim</code>Number of Monte-Carlo simulations.
</p>
</li>
<li><p><code>backsight</code>Backsight size. 
</p>
</li></ul>



<h3>Note</h3>


<ul>
<li> <p>Windows users might receive a memory allocation error with larger time span of analysis (defined by the parameter <code>timeRange</code>). This can be avoided by increasing the memory limit with the <code><a href="utils.html#topic+memory.limit">memory.limit</a></code> function.
</p>
</li>
<li> <p>Users experiencing a <code>Error: cannot allocate vector of size ...</code> error message can increase the memory size using the <code>Sys.setenv()</code>, for example: <code>Sys.setenv("R_MAX_VSIZE" = 16e9)</code>. 
</p>
</li>
<li> <p>The function currently supports only dates calibrated with 'intcal20',intcal13','intcal13nhpine16','shcal20','shcal13','shcal13shkauri16', 'marine20', and 'marine13'.
</p>
</li></ul>



<h3>References</h3>

<p>Crema, E.R. (2022). Statistical inference of prehistoric demography from frequency distributions of radiocarbon dates: a review and a guide for the perplexed. Journal of Archaeological Method and Theory. doi:10.1007/s10816-022-09559-5
</p>
<p>Timpson, A., Colledge, S., Crema, E., Edinborough, K., Kerig, T., Manning, K., Thomas, M.G., Shennan, S., (2014). Reconstructing regional population fluctuations in the European Neolithic using radiocarbon dates: a new case-study using an improved method. Journal of Archaeological Science, 52, 549-557. doi:10.1016/j.jas.2014.08.011
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Example with Younger Dryas period Near East, including site bins
## Not run: 
data(emedyd)
caldates &lt;- calibrate(x=emedyd$CRA, errors=emedyd$Error, normalised=FALSE)
bins &lt;- binPrep(sites=emedyd$SiteName, ages=emedyd$CRA, h=50)
nsim=5 #toy example
expnull &lt;- modelTest(caldates, errors=emedyd$Error, bins=bins, nsim=nsim, runm=50,
timeRange=c(16000,9000), model="exponential", datenormalised=FALSE)
plot(expnull, xlim=c(16000,9000))
round(expnull$pval,4) #p-value
summary(expnull)

## End(Not run)
</code></pre>

<hr>
<h2 id='multiplot'>Plot multiple dates</h2><span id='topic+multiplot'></span>

<h3>Description</h3>

<p>Plot multiple radiocarbon dates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>multiplot(
  x,
  type = "d",
  calendar = "BP",
  HPD = FALSE,
  credMass = 0.95,
  decreasing = NULL,
  label = TRUE,
  label.pos = 0.5,
  label.offset = 0,
  xlim = NULL,
  xlab = NA,
  ylab = NA,
  col.fill = "grey50",
  col.fill2 = "grey82",
  col.line = "black",
  lwd = 1,
  cex.id = 1,
  cex.lab = 1,
  cex.axis = 1,
  ydisp = FALSE,
  gapFactor = 0.2,
  rescale = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="multiplot_+3A_x">x</code></td>
<td>
<p>A CalDates class object with length &gt; 1.</p>
</td></tr>
<tr><td><code id="multiplot_+3A_type">type</code></td>
<td>
<p>Whether the calibrated dates are displayed as distributions (<code>'d'</code>) or as horizontal bars (<code>'b'</code>) spanning the HPD interval. Default is <code>'d'</code>.</p>
</td></tr>
<tr><td><code id="multiplot_+3A_calendar">calendar</code></td>
<td>
<p>Either <code>'BP'</code> or <code>'BCAD'</code>. Indicate whether the calibrated date should be displayed in BP or BC/AD. Default is  <code>'BP'</code>.</p>
</td></tr>
<tr><td><code id="multiplot_+3A_hpd">HPD</code></td>
<td>
<p>Logical value indicating whether intervals of higher posterior density should be displayed. Default is FALSE.</p>
</td></tr>
<tr><td><code id="multiplot_+3A_credmass">credMass</code></td>
<td>
<p>A numerical value indicating the size of the higher posterior density interval. Default is 0.95.</p>
</td></tr>
<tr><td><code id="multiplot_+3A_decreasing">decreasing</code></td>
<td>
<p>Whether dates should be plotted with decreasing order of median calibrated date (i.e. old to new; TRUE) or increasing order (i.e. new to old; FALSE). If set to NULL the dates plotted in the supplied order. Default is NULL</p>
</td></tr>
<tr><td><code id="multiplot_+3A_label">label</code></td>
<td>
<p>Whether the ID of each date should be displayed. Default is TRUE.</p>
</td></tr>
<tr><td><code id="multiplot_+3A_label.pos">label.pos</code></td>
<td>
<p>Relative position of the label in relation to the calibrated distribution expressed in quantiles. Default is 0.5 (median).</p>
</td></tr>
<tr><td><code id="multiplot_+3A_label.offset">label.offset</code></td>
<td>
<p>Horrizontal offset of label position in number of years. Default is 0.</p>
</td></tr>
<tr><td><code id="multiplot_+3A_xlim">xlim</code></td>
<td>
<p>the x limits of the plot. In BP or in BC/AD depending on the choice of the parameter <code>calender</code>. Notice that if BC/AD is selected BC ages should have a minus sign (e.g. <code>c(-5000,200)</code> for 5000 BC to 200 AD).</p>
</td></tr>
<tr><td><code id="multiplot_+3A_xlab">xlab</code></td>
<td>
<p>(optional) Label for the x axis. If unspecified the default setting will be applied (&quot;Year BP&quot; or &quot;Year BC/AD&quot;).</p>
</td></tr>
<tr><td><code id="multiplot_+3A_ylab">ylab</code></td>
<td>
<p>(optional) Label for the y axis.</p>
</td></tr>
<tr><td><code id="multiplot_+3A_col.fill">col.fill</code></td>
<td>
<p>A vector of primary fill color for the calibrated date distribution. Default is 'grey50'.</p>
</td></tr>
<tr><td><code id="multiplot_+3A_col.fill2">col.fill2</code></td>
<td>
<p>A vector of secondary secondary colour fill color for the calibrated date distribution, used for regions outside the higher posterior interval. Ignored when <code>HPD=FALSE</code>. Default is 'grey82'.</p>
</td></tr>
<tr><td><code id="multiplot_+3A_col.line">col.line</code></td>
<td>
<p>A vector of line color (ignored when <code>type</code> is set to <code>'d'</code>. Default is 1.</p>
</td></tr>
<tr><td><code id="multiplot_+3A_lwd">lwd</code></td>
<td>
<p>Line width (ignored when <code>type</code> is set to <code>'d'</code>). Default is 1.</p>
</td></tr>
<tr><td><code id="multiplot_+3A_cex.id">cex.id</code></td>
<td>
<p>The magnification to be used the date labels relative to the current setting of cex. Default is adjusted to 1.</p>
</td></tr>
<tr><td><code id="multiplot_+3A_cex.lab">cex.lab</code></td>
<td>
<p>The magnification to be used for x and y  labels relative to the current setting of cex. Default is adjusted to 1.</p>
</td></tr>
<tr><td><code id="multiplot_+3A_cex.axis">cex.axis</code></td>
<td>
<p>The magnification to be used for axis annotation relative to the current setting of cex. Default is adjusted to 1.</p>
</td></tr>
<tr><td><code id="multiplot_+3A_ydisp">ydisp</code></td>
<td>
<p>Whether the y axis should be displayed. Ignored when <code>type</code> is set to <code>'b'</code>. Default is FALSE</p>
</td></tr>
<tr><td><code id="multiplot_+3A_gapfactor">gapFactor</code></td>
<td>
<p>Defines spacing between calibrated dates (when <code>type</code> is set to <code>'d'</code>) or the distance between the lines and the labels (when <code>type</code> is set to <code>'b'</code>) as proportion of individual y-axis ranges. Default is 0.2.</p>
</td></tr>
<tr><td><code id="multiplot_+3A_rescale">rescale</code></td>
<td>
<p>Whether probability distributions should be rescaled (applicable only when <code>type</code> is set to <code>'d'</code>, default is FALSE).</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+calibrate">calibrate</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("emedyd")
tellaswad = subset(emedyd,SiteName=='Tell Aswad')
x = calibrate(tellaswad$CRA,tellaswad$Error,ids=tellaswad$LabID)
multiplot(x,HPD=TRUE,decreasing=TRUE,label=FALSE,gapFactor = 0.1)
multiplot(x,type='b',calendar='BCAD',cex.id = 0.5,lwd=2,gapFactor = 0.5)
</code></pre>

<hr>
<h2 id='p2pTest'>Point to point test of SPD</h2><span id='topic+p2pTest'></span>

<h3>Description</h3>

<p>Test for evaluating the difference in the summed probability values associated with two points in time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>p2pTest(x, p1 = NA, p2 = NA, interactive = TRUE, plot = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="p2pTest_+3A_x">x</code></td>
<td>
<p>result of <code><a href="#topic+modelTest">modelTest</a></code> with raw=TRUE.</p>
</td></tr>
<tr><td><code id="p2pTest_+3A_p1">p1</code></td>
<td>
<p>calendar year (in BP) of start point.</p>
</td></tr>
<tr><td><code id="p2pTest_+3A_p2">p2</code></td>
<td>
<p>calendar year (in BP) of end point.</p>
</td></tr>
<tr><td><code id="p2pTest_+3A_interactive">interactive</code></td>
<td>
<p>if set to TRUE enables an interactive selection of p1 and p2 from a graphical display of the SPD. Disabled when <code>p1</code> and <code>p2</code> are defined.</p>
</td></tr>
<tr><td><code id="p2pTest_+3A_plot">plot</code></td>
<td>
<p>if set to TRUE the function plots the location of p1 and p2 on the SPD. Default is FALSE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function compares observed differences in the summed probability values associated with two points in time against a distribution of expected values under the null hypothesis defined with the <code><a href="#topic+modelTest">modelTest</a></code> function. The two points can be specified manually (assigning BP dates to the arguments <code>p1</code> and <code>p2</code>) or interactively (clicking on a SPD plot). Note that <code><a href="#topic+modelTest">modelTest</a></code> should be executed setting the argument <code>raw</code> to <code>TRUE</code> (default is <code>FALSE</code>).
</p>


<h3>Value</h3>

<p>A list with: the BP dates for the two points and the p-value obtained from a two-sided test.
</p>


<h3>References</h3>

<p>Edinborough, K., Porcic, M., Martindale, A., Brown, T.J., Supernant, K., Ames, K.M., (2017). Radiocarbon test for demographic events in written and oral history. PNAS 201713012. doi:10.1073/pnas.1713012114
</p>


<h3>See Also</h3>

<p><code><a href="#topic+modelTest">modelTest</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Example with Younger Dryas period Near East, including site bins
## Not run: 
data(emedyd)
caldates &lt;- calibrate(x=emedyd$CRA, errors=emedyd$Error, normalised=FALSE)
bins &lt;- binPrep(sites=emedyd$SiteName, ages=emedyd$CRA, h=50)
nsim=10 #toy example
expnull &lt;- modelTest(caldates, errors=emedyd$Error, bins=bins, nsim=nsim, runm=50,
timeRange=c(16000,9000), model="exponential", datenormalised=FALSE, raw=TRUE)
p2pTest(x=expnull,p1=13000,p2=12500) #non-interactive mode
p2pTest(x=expnull) #interactive mode

## End(Not run)
</code></pre>

<hr>
<h2 id='permTest'>Random mark permutation test for SPDs</h2><span id='topic+permTest'></span>

<h3>Description</h3>

<p>Global and local significance test for comparing shapes of multiple SPDs using random permutations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>permTest(
  x,
  marks,
  timeRange,
  backsight = 10,
  changexpr = expression((t1/t0)^(1/d) - 1),
  nsim,
  bins = NA,
  runm = NA,
  datenormalised = FALSE,
  spdnormalised = FALSE,
  raw = FALSE,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="permTest_+3A_x">x</code></td>
<td>
<p>A <code>CalDates</code> class object containing the calibrated radiocarbon dates.</p>
</td></tr>
<tr><td><code id="permTest_+3A_marks">marks</code></td>
<td>
<p>A numerical or character vector containing the marks associated to each radiocarbon date.</p>
</td></tr>
<tr><td><code id="permTest_+3A_timerange">timeRange</code></td>
<td>
<p>A vector of length 2 indicating the start and end date of the analysis in cal BP.</p>
</td></tr>
<tr><td><code id="permTest_+3A_backsight">backsight</code></td>
<td>
<p>A single numeric value defining the distance in time between the focal year and the backsight year for computing the rate of change. Default is 10.</p>
</td></tr>
<tr><td><code id="permTest_+3A_changexpr">changexpr</code></td>
<td>
<p>An expression for calculating the rate of change in SPD between the focal year and a backsight year. Available input options are t1 (the SPD for the focal year), t0 (the SPD for the backsight year), d (the distance between t0 and t1), and any other standard constants and mathematical operators. A sensible default is provided.</p>
</td></tr>
<tr><td><code id="permTest_+3A_nsim">nsim</code></td>
<td>
<p>Number of random permutations</p>
</td></tr>
<tr><td><code id="permTest_+3A_bins">bins</code></td>
<td>
<p>A vector indicating which bin each radiocarbon date is assigned to.</p>
</td></tr>
<tr><td><code id="permTest_+3A_runm">runm</code></td>
<td>
<p>A number indicating the window size of the moving average to smooth the SPD. If set to <code>NA</code> no moving average is applied.Default is NA.</p>
</td></tr>
<tr><td><code id="permTest_+3A_datenormalised">datenormalised</code></td>
<td>
<p>If set to TRUE the total probability mass of each calibrated date will be made to sum to unity (the default in most radiocarbon calibration software). This argument will only have an effect if the dates in <code>x</code> were calibrated without normalisation (via normalised=FALSE in the <code><a href="#topic+calibrate">calibrate</a></code> function), in which case setting <code>datenormalised=TRUE</code> here will rescale each dates probability mass to sum to unity before aggregating the dates, while setting <code>datenormalised=FALSE</code> will ensure unnormalised dates are used for both observed and simulated SPDs. Default is FALSE.</p>
</td></tr>
<tr><td><code id="permTest_+3A_spdnormalised">spdnormalised</code></td>
<td>
<p>A logical variable indicating whether the total probability mass of the SPD is normalised to sum to unity.</p>
</td></tr>
<tr><td><code id="permTest_+3A_raw">raw</code></td>
<td>
<p>A logical variable indicating whether all permuted SPDs should be returned or not. Default is FALSE.</p>
</td></tr>
<tr><td><code id="permTest_+3A_verbose">verbose</code></td>
<td>
<p>A logical variable indicating whether extra information on progress should be reported. Default is TRUE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function generates a distribution of expected SPDs by randomly shuffling the marks assigned to each <em>bin</em> (see <code><a href="#topic+spd">spd</a></code> for details on binning). The resulting distribution of probabilities for each <em>mark</em> (i.e. group of dates) for each calendar year is z-transformed, and a 95% simulation envelope is computed. Local significant departures are defined as instances where the observed SPD (which is also z-transformed) is outside such envelope. A global significance is also computed by comparing the total &quot;area&quot; outside the simulation envelope in the observed and simulated data.
</p>


<h3>Value</h3>

<p>An object of class <code>SpdPermTest</code> with the following elements
</p>

<ul>
<li><p><code>observed</code> A list containing data.frames with the summed probability (column <em>PrDens</em> for each calendar year (column <em>calBP</em> for each mark/group
</p>
</li>
<li><p><code>envelope</code> A list containing matrices with the lower and upper bound values of the simulation envelope for each mark/group 
</p>
</li>
<li><p><code>pValueList</code> A list of p-value associated with each mark/group  
</p>
</li></ul>



<h3>References</h3>

<p>Crema, E.R., Habu, J., Kobayashi, K., Madella, M., (2016). Summed Probability Distribution of 14 C Dates Suggests Regional Divergences in the Population Dynamics of the Jomon Period in Eastern Japan. PLOS ONE 11, e0154809. doi:10.1371/journal.pone.0154809
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## compare demographic trajectories in Netherlands and Denmark  
## Not run:  
data(euroevol)
nld.dnk = subset(euroevol,Country=="Netherlands"|Country=="Denmark")
bins = binPrep(nld.dnk$SiteID,nld.dnk$C14Age,h=200)
dates = calibrate(nld.dnk$C14Age,nld.dnk$C14SD,normalised=FALSE)
res = permTest(dates,marks=as.character(nld.dnk$Country),nsim=1000,
bins=bins,runm=200,timeRange=c(10000,4000))
round(res$pValueList,4) #extract p-values
summary(res)
par(mfrow=c(2,1))
plot(res,focalm="Netherlands",main="Netherlands")
plot(res,focalm="Denmark",main="Denmark")

## End(Not run)
</code></pre>

<hr>
<h2 id='plot.CalDates'>Plot calibrated dates</h2><span id='topic+plot.CalDates'></span>

<h3>Description</h3>

<p>Plot calibrated radiocarbon dates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'CalDates'
plot(
  x,
  ind = 1,
  label = NA,
  calendar = "BP",
  type = "standard",
  xlab = NA,
  ylab = NA,
  axis4 = TRUE,
  HPD = FALSE,
  credMass = 0.95,
  customCalCurve = NA,
  add = FALSE,
  col = "grey50",
  col2 = "grey82",
  cex.axis = 0.75,
  cex.xylab = 0.75,
  cex.label = 0.75,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.CalDates_+3A_x">x</code></td>
<td>
<p><code>CalDates</code> class object containing calibrated radiocarbon dates.</p>
</td></tr>
<tr><td><code id="plot.CalDates_+3A_ind">ind</code></td>
<td>
<p>Number indicating the index value of the calibrated radiocarbon date to be displayed. Default is 1.</p>
</td></tr>
<tr><td><code id="plot.CalDates_+3A_label">label</code></td>
<td>
<p>(optional) Character vector to be shown on the top-right corner of the display window.</p>
</td></tr>
<tr><td><code id="plot.CalDates_+3A_calendar">calendar</code></td>
<td>
<p>Either <code>'BP'</code> or <code>'BCAD'</code>. Indicate whether the calibrated date should be displayed in BP or BC/AD. Default is  <code>'BP'</code>.</p>
</td></tr>
<tr><td><code id="plot.CalDates_+3A_type">type</code></td>
<td>
<p>Either <code>'standard'</code> or <code>'auc'</code>. If set to <code>'auc'</code>, displays both the normalised (dashed line) and unnormalised curves. Default is <code>'standard'</code>.</p>
</td></tr>
<tr><td><code id="plot.CalDates_+3A_xlab">xlab</code></td>
<td>
<p>(optional) Label for the x axis. If unspecified the default setting will be applied (&quot;Year BP&quot; or &quot;Year BC/AD&quot;).</p>
</td></tr>
<tr><td><code id="plot.CalDates_+3A_ylab">ylab</code></td>
<td>
<p>(optional) Label for the y axis. If unspecified the default setting will be applied (&quot;Radiocarbon Age&quot;).</p>
</td></tr>
<tr><td><code id="plot.CalDates_+3A_axis4">axis4</code></td>
<td>
<p>Logical value indicating whether an axis of probabilities values should be displayed. Default is TRUE.</p>
</td></tr>
<tr><td><code id="plot.CalDates_+3A_hpd">HPD</code></td>
<td>
<p>Logical value indicating whether intervals of higher posterior density should be displayed. Default is FALSE.</p>
</td></tr>
<tr><td><code id="plot.CalDates_+3A_credmass">credMass</code></td>
<td>
<p>A numerical value indicating the size of the higher posterior density interval. Default is 0.95.</p>
</td></tr>
<tr><td><code id="plot.CalDates_+3A_customcalcurve">customCalCurve</code></td>
<td>
<p>A three column data.frame or matrix that allows you to pass and plot a custom calibration curve if you used one during calibration. You can currently only provide one such custom curve which is used for all dates.</p>
</td></tr>
<tr><td><code id="plot.CalDates_+3A_add">add</code></td>
<td>
<p>if set to <code>TRUE</code> the calibrated date is displayed over the existing plot. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="plot.CalDates_+3A_col">col</code></td>
<td>
<p>The primary fill color for the calibrated date distribution.</p>
</td></tr>
<tr><td><code id="plot.CalDates_+3A_col2">col2</code></td>
<td>
<p>The secondary colour fill color for the calibrated date distribution, used for regions outside the higher posterior interval. Ignored when <code>HPD=FALSE</code>.</p>
</td></tr>
<tr><td><code id="plot.CalDates_+3A_cex.axis">cex.axis</code></td>
<td>
<p>The magnification to be used for axis annotation relative to the current setting of cex. Default is adjusted to 0.75.</p>
</td></tr>
<tr><td><code id="plot.CalDates_+3A_cex.xylab">cex.xylab</code></td>
<td>
<p>The magnification to be used for x and y labels relative to the current setting of cex. Default is adjusted to 0.75.</p>
</td></tr>
<tr><td><code id="plot.CalDates_+3A_cex.label">cex.label</code></td>
<td>
<p>The magnification to be used for the label on the top right corner defined by the argument <code>label</code>. Default is adjusted to 0.75.</p>
</td></tr>
<tr><td><code id="plot.CalDates_+3A_...">...</code></td>
<td>
<p>Additional arguments affecting the plot.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+calibrate">calibrate</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- calibrate(x=c(3402,3490,4042),errors=c(20,20,30))
plot(x) #display the first date
plot(x,2) #displays the second date
plot(x,3, calendar="BCAD", HPD=TRUE) #display in BC/AD with higher posterior density interval
</code></pre>

<hr>
<h2 id='plot.CalGrid'>Plot a summed probability distribution (from a CalGrid object)</h2><span id='topic+plot.CalGrid'></span>

<h3>Description</h3>

<p>Plot a summed radiocarbon probability distribution. This is a basic function for plotting SPDs that have been constructed manually or by calibrating a summed or otherwise irregular CRA grid. In most instances, it is sensible to use <code>plot.CalSPD</code> instead.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'CalGrid'
plot(
  x,
  runm = NA,
  calendar = "BP",
  fill.p = "grey50",
  border.p = NA,
  xlim = NA,
  ylim = NA,
  cex.lab = 0.75,
  cex.axis = cex.lab,
  mar = c(4, 4, 1, 3),
  add = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.CalGrid_+3A_x">x</code></td>
<td>
<p>A &quot;CalGrid&quot; class object of summed probabilities per calendar year BP.</p>
</td></tr>
<tr><td><code id="plot.CalGrid_+3A_runm">runm</code></td>
<td>
<p>A number indicating the window size of the moving average to smooth the SPD. If set to <code>NA</code> no moving average is applied. Default is NA</p>
</td></tr>
<tr><td><code id="plot.CalGrid_+3A_calendar">calendar</code></td>
<td>
<p>Either <code>'BP'</code> or <code>'BCAD'</code>. Indicate whether the calibrated date should be displayed in BP or BC/AD. Default is  <code>'BP'</code>.</p>
</td></tr>
<tr><td><code id="plot.CalGrid_+3A_fill.p">fill.p</code></td>
<td>
<p>Fill colour of the polygon depicting the summed probability distribution.</p>
</td></tr>
<tr><td><code id="plot.CalGrid_+3A_border.p">border.p</code></td>
<td>
<p>Border colour of the polygon depicting the summed probability distribution.</p>
</td></tr>
<tr><td><code id="plot.CalGrid_+3A_xlim">xlim</code></td>
<td>
<p>the x limits of the plot. In BP or in BC/AD depending on the choice of the parameter <code>calender</code>. Notice that if BC/AD is selected BC ages should have a minus sign (e.g. <code>c(-5000,200)</code> for 5000 BC to 200 AD).</p>
</td></tr>
<tr><td><code id="plot.CalGrid_+3A_ylim">ylim</code></td>
<td>
<p>Adjust y axis limits (otherwise sensible default).</p>
</td></tr>
<tr><td><code id="plot.CalGrid_+3A_cex.lab">cex.lab</code></td>
<td>
<p>Size of label text.</p>
</td></tr>
<tr><td><code id="plot.CalGrid_+3A_cex.axis">cex.axis</code></td>
<td>
<p>Size of axis text.</p>
</td></tr>
<tr><td><code id="plot.CalGrid_+3A_mar">mar</code></td>
<td>
<p>Adjust margins around plot.</p>
</td></tr>
<tr><td><code id="plot.CalGrid_+3A_add">add</code></td>
<td>
<p>Whether or not the new graphic should be added to an existing plot.</p>
</td></tr>
<tr><td><code id="plot.CalGrid_+3A_...">...</code></td>
<td>
<p>Additional arguments affecting the plot</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+spd">spd</a></code>; <code><a href="#topic+plot.CalSPD">plot.CalSPD</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(euroevol)
mycaldates &lt;- calibrate(euroevol[1:10,"C14Age"], euroevol[1:10,"C14SD"], normalised=FALSE)
myspd &lt;- spd(mycaldates, timeRange=c(8000,2000))
plot(myspd) #ordinary plot using \code{plot.CalSPD}
plot(myspd$grid) #working plot using the internal CalGrid object
</code></pre>

<hr>
<h2 id='plot.CalSPD'>Plot a summed probability distribution</h2><span id='topic+plot.CalSPD'></span>

<h3>Description</h3>

<p>Plot a summed probability distribution (SPD) of radiocarbon dates
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'CalSPD'
plot(
  x,
  runm = NA,
  calendar = "BP",
  type = "standard",
  xlim = NA,
  ylim = NA,
  ylab = "Summed Probability",
  spdnormalised = FALSE,
  rescale = FALSE,
  fill.p = "grey75",
  border.p = NA,
  xaxt = "s",
  yaxt = "s",
  add = FALSE,
  cex.axis = 1,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.CalSPD_+3A_x">x</code></td>
<td>
<p>A <code>CalSPD</code> class object.</p>
</td></tr>
<tr><td><code id="plot.CalSPD_+3A_runm">runm</code></td>
<td>
<p>A number indicating the window size of the moving average to smooth the SPD. If set to <code>NA</code> no moving average is applied. Default is NA</p>
</td></tr>
<tr><td><code id="plot.CalSPD_+3A_calendar">calendar</code></td>
<td>
<p>Either <code>'BP'</code> or <code>'BCAD'</code>. Indicate whether the calibrated date should be displayed in BP or BC/AD. Default is  <code>'BP'</code>.</p>
</td></tr>
<tr><td><code id="plot.CalSPD_+3A_type">type</code></td>
<td>
<p>Either <code>'standard'</code> or <code>'simple'</code>. The former visualise the SPD as an area graph, while the latter as line chart.</p>
</td></tr>
<tr><td><code id="plot.CalSPD_+3A_xlim">xlim</code></td>
<td>
<p>the x limits of the plot. In BP or in BC/AD depending on the choice of the parameter <code>calender</code>. Notice that if BC/AD is selected BC ages should have a minus sign (e.g. <code>c(-5000,200)</code> for 5000 BC to 200 AD).</p>
</td></tr>
<tr><td><code id="plot.CalSPD_+3A_ylim">ylim</code></td>
<td>
<p>the y limits of the plot.</p>
</td></tr>
<tr><td><code id="plot.CalSPD_+3A_ylab">ylab</code></td>
<td>
<p>(optional) Label for the y axis. If unspecified the default setting will be applied (&quot;Summed Probability&quot;)</p>
</td></tr>
<tr><td><code id="plot.CalSPD_+3A_spdnormalised">spdnormalised</code></td>
<td>
<p>A logical variable indicating whether the total probability mass of the SPD is normalised to sum to unity.</p>
</td></tr>
<tr><td><code id="plot.CalSPD_+3A_rescale">rescale</code></td>
<td>
<p>A logical variable indicating whether the SPD should be rescaled to range 0 to 1.</p>
</td></tr>
<tr><td><code id="plot.CalSPD_+3A_fill.p">fill.p</code></td>
<td>
<p>Fill colour for the SPD</p>
</td></tr>
<tr><td><code id="plot.CalSPD_+3A_border.p">border.p</code></td>
<td>
<p>Border colour for the SPD</p>
</td></tr>
<tr><td><code id="plot.CalSPD_+3A_xaxt">xaxt</code></td>
<td>
<p>Whether the x-axis tick marks should be displayed (<code>xaxt='s'</code>, default) or not (<code>xaxt='n'</code>).</p>
</td></tr>
<tr><td><code id="plot.CalSPD_+3A_yaxt">yaxt</code></td>
<td>
<p>Whether the y-axis tick marks should be displayed (<code>xaxt='s'</code>, default) or not (<code>xaxt='n'</code>).</p>
</td></tr>
<tr><td><code id="plot.CalSPD_+3A_add">add</code></td>
<td>
<p>Whether or not the new graphic should be added to an existing plot.</p>
</td></tr>
<tr><td><code id="plot.CalSPD_+3A_cex.axis">cex.axis</code></td>
<td>
<p>The magnification to be used for axis annotation relative to the current setting of cex. Default is 1.</p>
</td></tr>
<tr><td><code id="plot.CalSPD_+3A_...">...</code></td>
<td>
<p>Additional arguments affecting the plot</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+spd">spd</a></code>; <code><a href="#topic+plot.CalGrid">plot.CalGrid</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data(emedyd)
levant &lt;- emedyd[emedyd$Region=="1"|emedyd$Region=="2",]
bins &lt;- binPrep(levant$SiteName, levant$CRA, h=50)
x &lt;- calibrate(levant$CRA, levant$Error, normalised=FALSE)
spd.levant &lt;- spd(x, bins=bins, timeRange=c(17000,8000))
spd.northernlevant &lt;- spd(x[levant$Region=="2"], bins=bins[levant$Region=="2"],
timeRange=c(17000,8000))
plot(spd.levant, runm=50, xlim=c(16000,9000))
plot(spd.northernlevant, runm=50, add=TRUE, fill.p="black")
legend("topleft", legend=c("All Levant dates","Northern Levant only"), 
fill=c("grey75","black"), border=NA)
plot(spd.levant, runm=50, xlim=c(16000,9000), type="simple")
plot(spd.northernlevant, runm=50, col="red", type="simple", add=TRUE)

## End(Not run)
</code></pre>

<hr>
<h2 id='plot.compositeKDE'>Plots a Composite Kernel Density Estimate of sampled radiocarbon dates.</h2><span id='topic+plot.compositeKDE'></span>

<h3>Description</h3>

<p>Plots a Composite Kernel Density Estimate of sampled radiocarbon dates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'compositeKDE'
plot(
  x,
  calendar = "BP",
  type = "envelope",
  ylim = NA,
  xlim = NA,
  fill.col = "lightgrey",
  interval = 0.95,
  line.col = "black",
  line.type = 2,
  multiline.alpha = NA,
  multiline.col = "black",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.compositeKDE_+3A_x">x</code></td>
<td>
<p>A <code>compositeKDE</code> class object generated using the <code><a href="#topic+ckde">ckde</a></code> function.</p>
</td></tr>
<tr><td><code id="plot.compositeKDE_+3A_calendar">calendar</code></td>
<td>
<p>Either <code>'BP'</code> or <code>'BCAD'</code>. Indicate whether the calibrated date should be displayed in BP or BC/AD. Default is  <code>'BP'</code>.</p>
</td></tr>
<tr><td><code id="plot.compositeKDE_+3A_type">type</code></td>
<td>
<p>Either <code>envelope</code> or <code>multiline</code>. Default is <code>envelope</code>.</p>
</td></tr>
<tr><td><code id="plot.compositeKDE_+3A_ylim">ylim</code></td>
<td>
<p>the y limits of the plot.</p>
</td></tr>
<tr><td><code id="plot.compositeKDE_+3A_xlim">xlim</code></td>
<td>
<p>the x limits of the plot. In BP or in BC/AD depending on the choice of the parameter <code>calender</code>. Notice that if BC/AD is selected BC ages should have a minus sign (e.g. <code>c(-5000,200)</code> for 5000 BC to 200 AD).</p>
</td></tr>
<tr><td><code id="plot.compositeKDE_+3A_fill.col">fill.col</code></td>
<td>
<p>Envelope color when <code>type='envelope'</code>. Default is 'lightgrey'.</p>
</td></tr>
<tr><td><code id="plot.compositeKDE_+3A_interval">interval</code></td>
<td>
<p>Quantile interval for the envelope. Default is 0.95.</p>
</td></tr>
<tr><td><code id="plot.compositeKDE_+3A_line.col">line.col</code></td>
<td>
<p>Line color when <code>type='envelope'</code>. Default is 'black.</p>
</td></tr>
<tr><td><code id="plot.compositeKDE_+3A_line.type">line.type</code></td>
<td>
<p>Line type when <code>type='envelope'</code>. Default is 2.</p>
</td></tr>
<tr><td><code id="plot.compositeKDE_+3A_multiline.alpha">multiline.alpha</code></td>
<td>
<p>Alpha level for line transparency when <code>type='multiline'</code>. Default is 10/<code>nsim</code>, where <code>nsim</code> is the number of simulations. If <code>nsim</code> is smaller than 10, <code>multiline.alpha</code> will be set to 1.</p>
</td></tr>
<tr><td><code id="plot.compositeKDE_+3A_multiline.col">multiline.col</code></td>
<td>
<p>Line color when <code>type='multiline'</code>. Default is 'black'.</p>
</td></tr>
<tr><td><code id="plot.compositeKDE_+3A_...">...</code></td>
<td>
<p>Additional arguments affecting the plot</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Visualise a <code>compositeKDE</code> class object. If <code>type</code> is set <code>'envelope'</code> an envelope of the percentile interval defined by the parameter <code>interval</code> is shown along with the mean KDE. If <code>type</code> is set <code>'multiline'</code> all KDEs are shown.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ckde">ckde</a></code>;
</p>

<hr>
<h2 id='plot.spatialTest'>Plot results of the local spatial permutation test of summed probability distributions.</h2><span id='topic+plot.spatialTest'></span>

<h3>Description</h3>

<p>Displays local growth rates, p-values, and q-values retrieved from a <code>spatialTest</code> class object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'spatialTest'
plot(
  x,
  index = 1,
  option,
  breakRange,
  breakLength = 7,
  rd = 5,
  baseSize = 0.5,
  plim = 0.05,
  qlim = 0.05,
  legend = FALSE,
  legSize = 1,
  location = "bottomright",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.spatialTest_+3A_x">x</code></td>
<td>
<p>A <code>spatialTest</code> class object</p>
</td></tr>
<tr><td><code id="plot.spatialTest_+3A_index">index</code></td>
<td>
<p>A numerical value indicating which transition to display. Ignored when <code>option="rawlegend"</code> or  <code>option="testlegend"</code>. Default is 1.</p>
</td></tr>
<tr><td><code id="plot.spatialTest_+3A_option">option</code></td>
<td>
<p>Either &quot;<code>raw</code>&quot; to display local growth rates, &quot;<code>test</code>&quot; to display the test results (i.e. q and p values), or &quot;<code>return</code>&quot; to return a <code>sf</code> class object containing all relevant information for the given <code>index</code> value.</p>
</td></tr>
<tr><td><code id="plot.spatialTest_+3A_breakrange">breakRange</code></td>
<td>
<p>A vector of length 2 defining the minimum and maximum values of growth rate to be displayed in the legend. If set to NA its computed from data range (default).</p>
</td></tr>
<tr><td><code id="plot.spatialTest_+3A_breaklength">breakLength</code></td>
<td>
<p>A numerical vector defining the number of breaks for growth rates to be displayed in the legend.</p>
</td></tr>
<tr><td><code id="plot.spatialTest_+3A_rd">rd</code></td>
<td>
<p>Number of decimal places of the growth rate to be displayed in the Legend</p>
</td></tr>
<tr><td><code id="plot.spatialTest_+3A_basesize">baseSize</code></td>
<td>
<p>Numerical value giving the amount by which points should be magnified relative to the default settings in R. Default is 0.5</p>
</td></tr>
<tr><td><code id="plot.spatialTest_+3A_plim">plim</code></td>
<td>
<p>Threshold value for the p-values. Default is 0.05.</p>
</td></tr>
<tr><td><code id="plot.spatialTest_+3A_qlim">qlim</code></td>
<td>
<p>Threshold value for the q-values. Default is 0.05.</p>
</td></tr>
<tr><td><code id="plot.spatialTest_+3A_legend">legend</code></td>
<td>
<p>Logical values specifying whether the legend should be displayed or not. Default is FALSE.</p>
</td></tr>
<tr><td><code id="plot.spatialTest_+3A_legsize">legSize</code></td>
<td>
<p>Numerical value giving the amount by which points should be magnified relative to the default settings in R for the Legend. Default is 1.</p>
</td></tr>
<tr><td><code id="plot.spatialTest_+3A_location">location</code></td>
<td>
<p>A single keyword from the list &quot;bottomright&quot;, &quot;bottom&quot;, &quot;bottomleft&quot;, &quot;left&quot;, &quot;topleft&quot;, &quot;top&quot;, &quot;topright&quot;, &quot;right&quot; and &quot;center&quot; to specify the location of the Legend. Default is &quot;bottomright&quot;.</p>
</td></tr>
<tr><td><code id="plot.spatialTest_+3A_...">...</code></td>
<td>
<p>Graphical parameters to be passed to methods.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function displays a distribution map of local growth rates (when <code>option="raw"</code>), q- and p-values (when <code>option="test"</code>), and the associated legends (when <code>option="rawlegend"</code> or  <code>option="testlegend"</code>).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+sptest">sptest</a></code>
</p>

<hr>
<h2 id='plot.SpdModelTest'>Plot result of Monte-Carlo simulation of observed versus modelled SPDs</h2><span id='topic+plot.SpdModelTest'></span>

<h3>Description</h3>

<p>The function visualises the observed summed probability distribution of radiocarbon dates along with a simulation envelope for the null model and regions of positive and negative deviation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'SpdModelTest'
plot(
  x,
  calendar = "BP",
  type = "spd",
  ylim = NA,
  xlim = NA,
  col.obs = "black",
  lwd.obs = 0.5,
  xaxs = "i",
  yaxs = "i",
  bbty = "f",
  bbtyRet = TRUE,
  drawaxes = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.SpdModelTest_+3A_x">x</code></td>
<td>
<p>A <code>SpdModelTest</code> class object generated using the <code><a href="#topic+modelTest">modelTest</a></code> function.</p>
</td></tr>
<tr><td><code id="plot.SpdModelTest_+3A_calendar">calendar</code></td>
<td>
<p>Either <code>'BP'</code> or <code>'BCAD'</code>. Indicate whether the calibrated date should be displayed in BP or BC/AD. Default is  <code>'BP'</code>.</p>
</td></tr>
<tr><td><code id="plot.SpdModelTest_+3A_type">type</code></td>
<td>
<p>Whether to display SPDs ('spd') or rates of change ('roc'). Default is 'spd'.</p>
</td></tr>
<tr><td><code id="plot.SpdModelTest_+3A_ylim">ylim</code></td>
<td>
<p>the y limits of the plot.</p>
</td></tr>
<tr><td><code id="plot.SpdModelTest_+3A_xlim">xlim</code></td>
<td>
<p>the x limits of the plot. In BP or in BC/AD depending on the choice of the parameter <code>calender</code>. Notice that if BC/AD is selected BC ages should have a minus sign (e.g. <code>c(-5000,200)</code> for 5000 BC to 200 AD).</p>
</td></tr>
<tr><td><code id="plot.SpdModelTest_+3A_col.obs">col.obs</code></td>
<td>
<p>Line colour for the observed SPD.</p>
</td></tr>
<tr><td><code id="plot.SpdModelTest_+3A_lwd.obs">lwd.obs</code></td>
<td>
<p>Line width for the observed SPD.</p>
</td></tr>
<tr><td><code id="plot.SpdModelTest_+3A_xaxs">xaxs</code></td>
<td>
<p>The style of x-axis interval calculation (see <code><a href="graphics.html#topic+par">par</a></code>)</p>
</td></tr>
<tr><td><code id="plot.SpdModelTest_+3A_yaxs">yaxs</code></td>
<td>
<p>The style of y-axis interval calculation (see <code><a href="graphics.html#topic+par">par</a></code>)</p>
</td></tr>
<tr><td><code id="plot.SpdModelTest_+3A_bbty">bbty</code></td>
<td>
<p>Display options; one between <code>'b'</code>,<code>'n'</code>,and <code>'f'</code>. See details below.</p>
</td></tr>
<tr><td><code id="plot.SpdModelTest_+3A_bbtyret">bbtyRet</code></td>
<td>
<p>Whether details on the intervals of positive and negative deviations are returned. Default is TRUE.</p>
</td></tr>
<tr><td><code id="plot.SpdModelTest_+3A_drawaxes">drawaxes</code></td>
<td>
<p>A logical value determining whether the axes should be displayed or not. Default is TRUE.</p>
</td></tr>
<tr><td><code id="plot.SpdModelTest_+3A_...">...</code></td>
<td>
<p>Additional arguments affecting the plot</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The argument <code>bbty</code> controls the display options of the Monte-Carlo Test. Default settings (<code>bbty='f'</code>) displays the observed SPD (solid black line), the simulation envelope of the fitted model (shaded grey polygon) and regions of significance positive (red semi-transparent rectangle) and negative (blue semi-transparent rectangle) deviation. The option <code>bbty='b'</code> removes the regions of positive/negative deviations, whilst the option <code>bbty='n'</code> displays the simulation envelope on existing plot.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+modelTest">modelTest</a></code>
</p>

<hr>
<h2 id='plot.SpdPermTest'>Plot result of mark permutation test of SPDs</h2><span id='topic+plot.SpdPermTest'></span>

<h3>Description</h3>

<p>Visualises the observed SPD along with the simulation envelope generated from <code><a href="#topic+permTest">permTest</a></code>, with regions of positive and negative deviations highlighted in red and blue.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'SpdPermTest'
plot(
  x,
  focalm = 1,
  type = "spd",
  calendar = "BP",
  xlim = NA,
  ylim = NA,
  col.obs = "black",
  col.env = rgb(0, 0, 0, 0.2),
  lwd.obs = 0.5,
  xaxs = "i",
  yaxs = "i",
  bbty = "f",
  drawaxes = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.SpdPermTest_+3A_x">x</code></td>
<td>
<p>A <code>SpdPermTest</code> class object. Result of random mark permutation test (see <code><a href="#topic+permTest">permTest</a></code>)</p>
</td></tr>
<tr><td><code id="plot.SpdPermTest_+3A_focalm">focalm</code></td>
<td>
<p>Value specifying the name of the focal mark (group) to be plotted.</p>
</td></tr>
<tr><td><code id="plot.SpdPermTest_+3A_type">type</code></td>
<td>
<p>Whether to display SPDs ('spd') or rates of change ('roc'). Default is 'spd'.</p>
</td></tr>
<tr><td><code id="plot.SpdPermTest_+3A_calendar">calendar</code></td>
<td>
<p>Either <code>'BP'</code> or <code>'BCAD'</code>. Indicate whether the calibrated date should be displayed in BP or BC/AD. Default is  <code>'BP'</code>.</p>
</td></tr>
<tr><td><code id="plot.SpdPermTest_+3A_xlim">xlim</code></td>
<td>
<p>the x limits of the plot. In BP or in BC/AD depending on the choice of the parameter <code>calender</code>. Notice that if BC/AD is selected BC ages should have a minus sign (e.g. <code>c(-5000,200)</code> for 5000 BC to 200 AD).</p>
</td></tr>
<tr><td><code id="plot.SpdPermTest_+3A_ylim">ylim</code></td>
<td>
<p>the y limits of the plot.</p>
</td></tr>
<tr><td><code id="plot.SpdPermTest_+3A_col.obs">col.obs</code></td>
<td>
<p>Line colour for the observed SPD</p>
</td></tr>
<tr><td><code id="plot.SpdPermTest_+3A_col.env">col.env</code></td>
<td>
<p>Colour for the simulation envelope</p>
</td></tr>
<tr><td><code id="plot.SpdPermTest_+3A_lwd.obs">lwd.obs</code></td>
<td>
<p>Line width for the observed SPD</p>
</td></tr>
<tr><td><code id="plot.SpdPermTest_+3A_xaxs">xaxs</code></td>
<td>
<p>The style of x-axis interval calculation (see <code><a href="graphics.html#topic+par">par</a></code>)</p>
</td></tr>
<tr><td><code id="plot.SpdPermTest_+3A_yaxs">yaxs</code></td>
<td>
<p>The style of y-axis interval calculation (see <code><a href="graphics.html#topic+par">par</a></code>)</p>
</td></tr>
<tr><td><code id="plot.SpdPermTest_+3A_bbty">bbty</code></td>
<td>
<p>Display options; one between <code>'b'</code>,<code>'n'</code>,and <code>'f'</code>. See details in <code><a href="#topic+plot.SpdModelTest">plot.SpdModelTest</a></code>.</p>
</td></tr>
<tr><td><code id="plot.SpdPermTest_+3A_drawaxes">drawaxes</code></td>
<td>
<p>A logical value determining whether the axes should be displayed or not. Default is TRUE.</p>
</td></tr>
<tr><td><code id="plot.SpdPermTest_+3A_...">...</code></td>
<td>
<p>Additional arguments affecting the plot</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+permTest">permTest</a></code>; <code><a href="#topic+plot.SpdModelTest">plot.SpdModelTest</a></code>;
</p>

<hr>
<h2 id='plot.spdRC'>Plot <code>spdRC</code> class objects</h2><span id='topic+plot.spdRC'></span>

<h3>Description</h3>

<p>Plot rates of change between time-blocks
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'spdRC'
plot(
  x,
  calendar = "BP",
  col.obs = "black",
  lwd.obs = 0.5,
  xaxs = "i",
  yaxs = "i",
  xlim = NA,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.spdRC_+3A_x">x</code></td>
<td>
<p><code>spdRC</code> class object containing geometric growth rates.</p>
</td></tr>
<tr><td><code id="plot.spdRC_+3A_calendar">calendar</code></td>
<td>
<p>Either <code>'BP'</code> or <code>'BCAD'</code>. Indicate whether the calibrated date should be displayed in BP or BC/AD. Default is  <code>'BP'</code>.</p>
</td></tr>
<tr><td><code id="plot.spdRC_+3A_col.obs">col.obs</code></td>
<td>
<p>Line colour for the observed SPD</p>
</td></tr>
<tr><td><code id="plot.spdRC_+3A_lwd.obs">lwd.obs</code></td>
<td>
<p>Line width for the observed SPD</p>
</td></tr>
<tr><td><code id="plot.spdRC_+3A_xaxs">xaxs</code></td>
<td>
<p>The style of x-axis interval calculation (see <code><a href="graphics.html#topic+par">par</a></code>)</p>
</td></tr>
<tr><td><code id="plot.spdRC_+3A_yaxs">yaxs</code></td>
<td>
<p>The style of y-axis interval calculation (see <code><a href="graphics.html#topic+par">par</a></code>)</p>
</td></tr>
<tr><td><code id="plot.spdRC_+3A_xlim">xlim</code></td>
<td>
<p>Limits for the x axis.</p>
</td></tr>
<tr><td><code id="plot.spdRC_+3A_...">...</code></td>
<td>
<p>Additional arguments affecting the plot.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+spd2rc">spd2rc</a></code>
</p>

<hr>
<h2 id='plot.stackCalSPD'>Plot a stack of SPDs</h2><span id='topic+plot.stackCalSPD'></span>

<h3>Description</h3>

<p>Visualises multiple SPDs grouped as a <code>stackCalSPD</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'stackCalSPD'
plot(
  x,
  type = "stacked",
  calendar = "BP",
  spdnormalised = FALSE,
  rescale = FALSE,
  runm = NA,
  xlim = NA,
  ylim = NA,
  xaxt = "s",
  yaxt = "s",
  gapFactor = 0.2,
  col.fill = NA,
  col.line = NA,
  lwd.obs = 1,
  lty.obs = 1,
  cex.lab = 1,
  cex.axis = cex.lab,
  legend = TRUE,
  legend.arg = NULL,
  ylab = NA,
  ymargin = 1.1,
  rnd = 2,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.stackCalSPD_+3A_x">x</code></td>
<td>
<p>A <code>stackCalSPD</code> class object. Result of <code><a href="#topic+stackspd">stackspd</a></code> function.</p>
</td></tr>
<tr><td><code id="plot.stackCalSPD_+3A_type">type</code></td>
<td>
<p>How to display the SPDs.Current options are <code>'stacked'</code>,<code>'lines'</code>, '<code>'proportion'</code>. and <code>'multipanel'</code>. Default is <code>'stacked'</code>.</p>
</td></tr>
<tr><td><code id="plot.stackCalSPD_+3A_calendar">calendar</code></td>
<td>
<p>Either <code>'BP'</code> or <code>'BCAD'</code>. Indicate whether the calibrated date should be displayed in BP or BC/AD. Default is  <code>'BP'</code>.</p>
</td></tr>
<tr><td><code id="plot.stackCalSPD_+3A_spdnormalised">spdnormalised</code></td>
<td>
<p>A logical variable indicating whether the total probability mass of the SPDs are normalised to sum to unity. Default is FALSE.</p>
</td></tr>
<tr><td><code id="plot.stackCalSPD_+3A_rescale">rescale</code></td>
<td>
<p>A logical variable indicating whether the summed probabilities values should be rescaled to range 0 to 1. Default is FALSE.Notice that this is different from setting <code>spdnormalised</code> to TRUE.</p>
</td></tr>
<tr><td><code id="plot.stackCalSPD_+3A_runm">runm</code></td>
<td>
<p>A number indicating the window size of the moving average to smooth the SPD. If set to <code>NA</code> no moving average is applied. Default is NA</p>
</td></tr>
<tr><td><code id="plot.stackCalSPD_+3A_xlim">xlim</code></td>
<td>
<p>the x limits of the plot. In BP or in BC/AD depending on the choice of the parameter <code>calender</code>. Notice that if BC/AD is selected BC ages should have a minus sign (e.g. <code>c(-5000,200)</code> for 5000 BC to 200 AD).</p>
</td></tr>
<tr><td><code id="plot.stackCalSPD_+3A_ylim">ylim</code></td>
<td>
<p>the y limits of the plot.</p>
</td></tr>
<tr><td><code id="plot.stackCalSPD_+3A_xaxt">xaxt</code></td>
<td>
<p>Whether the x-axis tick marks should be displayed (<code>xaxt='s'</code>, default) or not (<code>xaxt='n'</code>).</p>
</td></tr>
<tr><td><code id="plot.stackCalSPD_+3A_yaxt">yaxt</code></td>
<td>
<p>Whether the y-axis tick marks should be displayed (<code>xaxt='s'</code>, default) or not (<code>xaxt='n'</code>).</p>
</td></tr>
<tr><td><code id="plot.stackCalSPD_+3A_gapfactor">gapFactor</code></td>
<td>
<p>Defines spacing between SPDs as proportion of the y-axis range for multipanel plots. Default is 0.2.</p>
</td></tr>
<tr><td><code id="plot.stackCalSPD_+3A_col.fill">col.fill</code></td>
<td>
<p>Vector of fill color for the observed SPDs. The default color scheme is based on the Dark2 pallette of RColorBrewer package.</p>
</td></tr>
<tr><td><code id="plot.stackCalSPD_+3A_col.line">col.line</code></td>
<td>
<p>Line colour for the observed SPDs.The default color scheme is based on the Dark2 palette of RColorBrewer package.</p>
</td></tr>
<tr><td><code id="plot.stackCalSPD_+3A_lwd.obs">lwd.obs</code></td>
<td>
<p>Line width for the observed SPDs. Default is 1.</p>
</td></tr>
<tr><td><code id="plot.stackCalSPD_+3A_lty.obs">lty.obs</code></td>
<td>
<p>Line type for the observed SPDs. Default is 1.</p>
</td></tr>
<tr><td><code id="plot.stackCalSPD_+3A_cex.lab">cex.lab</code></td>
<td>
<p>The magnification to be used for x and y  labels relative to the current setting of cex. Default is adjusted to 1.</p>
</td></tr>
<tr><td><code id="plot.stackCalSPD_+3A_cex.axis">cex.axis</code></td>
<td>
<p>The magnification to be used for axis annotation relative to the current setting of cex. Default is adjusted to 1.</p>
</td></tr>
<tr><td><code id="plot.stackCalSPD_+3A_legend">legend</code></td>
<td>
<p>Whether legend needs to be displayed. Item names will be retrieved from the values supplied in the argument <code>group</code> in <code><a href="#topic+stackspd">stackspd</a></code>. Default is TRUE.</p>
</td></tr>
<tr><td><code id="plot.stackCalSPD_+3A_legend.arg">legend.arg</code></td>
<td>
<p>list of additional arguments to pass to <code><a href="graphics.html#topic+legend">legend</a></code>; names of the list are used as argument names. Only used if <code>legend</code> is set to TRUE. If supplied legend position must be given (e.g. <code>legend.arg=list(x='bottomright')</code>.</p>
</td></tr>
<tr><td><code id="plot.stackCalSPD_+3A_ylab">ylab</code></td>
<td>
<p>a title for the y axis</p>
</td></tr>
<tr><td><code id="plot.stackCalSPD_+3A_ymargin">ymargin</code></td>
<td>
<p>multiplier for the maximum value on ylim range. Default is 1.1.</p>
</td></tr>
<tr><td><code id="plot.stackCalSPD_+3A_rnd">rnd</code></td>
<td>
<p>integer indicating the number of decimal places to be displayed in the y-axis for when <code>type</code> is set &quot;multitype&quot;.</p>
</td></tr>
<tr><td><code id="plot.stackCalSPD_+3A_...">...</code></td>
<td>
<p>Additional arguments affecting the plot.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The display order of the SPDs is given by the factor levels of the user-supplied <code>group</code> argument in the <code>stackspd()</code> function.
</p>


<h3>References</h3>

<p>Erich Neuwirth (2014). RColorBrewer: ColorBrewer Palettes. R package version 1.1-2. <a href="https://CRAN.R-project.org/package=RColorBrewer">https://CRAN.R-project.org/package=RColorBrewer</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data(emedyd)
x = calibrate(x=emedyd$CRA, errors=emedyd$Error,normalised=FALSE)
bins = binPrep(sites=emedyd$SiteName, ages=emedyd$CRA,h=100)
res = stackspd(x=x,timeRange=c(16000,8000),bins=bins,group=emedyd$Region)
plot(res,type='stacked')
plot(res,type='lines')
plot(res,type='proportion')
plot(res,type='multipanel')

## End(Not run)
</code></pre>

<hr>
<h2 id='plot.stKde'>Plot map(s) of the spatio-temporal intensity of radiocarbon dates.</h2><span id='topic+plot.stKde'></span>

<h3>Description</h3>

<p>Plotting function for single or multiple maps of the spatio-temporal intensity of radiocarbon dates at given focal years.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'stKde'
plot(
  x,
  focalyears = NULL,
  type = "focal",
  plotdir = NULL,
  imnames = "byyear",
  zlim = NULL,
  box = FALSE,
  main = "auto",
  col.mask = "grey75",
  ncolours = 256,
  ramptype = "raw",
  imdim = c(10, 10),
  mars = c(0.5, 0.5, 2.5, 2),
  ribbon = TRUE,
  ribargs = list(),
  cex.ribbon = 0.5,
  withpts = "n",
  cex.main = 0.8,
  pch.pts = 19,
  col.pts = "grey50",
  cex.pts = 0.1,
  tidydevs = TRUE,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.stKde_+3A_x">x</code></td>
<td>
<p>An object of class stKde.</p>
</td></tr>
<tr><td><code id="plot.stKde_+3A_focalyears">focalyears</code></td>
<td>
<p>A vector of numeric values for focal years, in calBP, that will be timesteps at which date intensity maps will be plotted.</p>
</td></tr>
<tr><td><code id="plot.stKde_+3A_type">type</code></td>
<td>
<p>A single character string stipulating which type of plot to create. Current options are &quot;nonfocal&quot;, &quot;mask&quot;, &quot;focal&quot;, &quot;proportion&quot;, &quot;change&quot; and &quot;all&quot;.</p>
</td></tr>
<tr><td><code id="plot.stKde_+3A_plotdir">plotdir</code></td>
<td>
<p>Optional output directory for plots. If NULL, then only a single plot is made to the current device. If a valid output direcotry is provided then one or more timeslices maps are saved as png files (e.g. as source images for an animation).</p>
</td></tr>
<tr><td><code id="plot.stKde_+3A_imnames">imnames</code></td>
<td>
<p>The format of the output files if output is as png files to a directory. The current two options are &quot;basic&quot; (labelling the images in basic sequence as preferred by animation software such as ffmpeg) or &quot;byyear&quot; (labelling the images by calBP year).</p>
</td></tr>
<tr><td><code id="plot.stKde_+3A_zlim">zlim</code></td>
<td>
<p>Numeric vector of length=2 which controlls the maximum or minimum of the colour ramp.</p>
</td></tr>
<tr><td><code id="plot.stKde_+3A_box">box</code></td>
<td>
<p>Logical. Plot a border around the map or not.</p>
</td></tr>
<tr><td><code id="plot.stKde_+3A_main">main</code></td>
<td>
<p>Single character string specifying a main title. &quot;auto&quot; implies internal default titles are used.</p>
</td></tr>
<tr><td><code id="plot.stKde_+3A_col.mask">col.mask</code></td>
<td>
<p>The colour used to depict any areas that are being masked out.</p>
</td></tr>
<tr><td><code id="plot.stKde_+3A_ncolours">ncolours</code></td>
<td>
<p>The maximum number of colours to use in the colour ramp.</p>
</td></tr>
<tr><td><code id="plot.stKde_+3A_ramptype">ramptype</code></td>
<td>
<p>What kind of treatment for the colour ramp. Current options are &quot;raw&quot; (do not try to standardise the ramps across timeslices),&quot;std&quot; (standardise each plot, typically by capturing the first 3sd in the main colour ramp and then outliers beyond that with the extreme colours of the ramp),&quot;unl&quot; (do not standardise but plot generalised high/low ramp labels) and &quot;mmx&quot; (scale to the minimum and maximum values across all timeslices).</p>
</td></tr>
<tr><td><code id="plot.stKde_+3A_imdim">imdim</code></td>
<td>
<p>Height and width of the plot to png in cm.</p>
</td></tr>
<tr><td><code id="plot.stKde_+3A_mars">mars</code></td>
<td>
<p>Margins of the plot to png.</p>
</td></tr>
<tr><td><code id="plot.stKde_+3A_ribbon">ribbon</code></td>
<td>
<p>Whether to plot the colour ramp legend or not.</p>
</td></tr>
<tr><td><code id="plot.stKde_+3A_ribargs">ribargs</code></td>
<td>
<p>Whether to plot the colour ramp legend or not.</p>
</td></tr>
<tr><td><code id="plot.stKde_+3A_cex.ribbon">cex.ribbon</code></td>
<td>
<p>The size of the ribbon font.</p>
</td></tr>
<tr><td><code id="plot.stKde_+3A_withpts">withpts</code></td>
<td>
<p>Plot with the original sample locations shown (current options are &quot;y&quot; and &quot;n&quot;).</p>
</td></tr>
<tr><td><code id="plot.stKde_+3A_cex.main">cex.main</code></td>
<td>
<p>The size of the title font.</p>
</td></tr>
<tr><td><code id="plot.stKde_+3A_pch.pts">pch.pts</code></td>
<td>
<p>The symbols used for the plotted points.</p>
</td></tr>
<tr><td><code id="plot.stKde_+3A_col.pts">col.pts</code></td>
<td>
<p>The colours used for the plotted points.</p>
</td></tr>
<tr><td><code id="plot.stKde_+3A_cex.pts">cex.pts</code></td>
<td>
<p>The size used for the plotted points.</p>
</td></tr>
<tr><td><code id="plot.stKde_+3A_tidydevs">tidydevs</code></td>
<td>
<p>Logical for whether to clean up any open grpahics devices or not (default is TRUE).</p>
</td></tr>
<tr><td><code id="plot.stKde_+3A_verbose">verbose</code></td>
<td>
<p>A logical variable indicating whether extra information on progress should be reported. Default is TRUE.</p>
</td></tr>
<tr><td><code id="plot.stKde_+3A_...">...</code></td>
<td>
<p>Additional arguments affecting the plot.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function plots to a screen device if a single focal year is stipulated and no output directory. Or if an output directory is stipulated, it plots one or more focal years to png files, with some basic formatting options and optional cross-year standardisation of the colour ramps (with a view to them being stills-for-video). For even more control of plotting, call this function one year at a time in a loop.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
## Example with a subset of English and Welsh dates from the Euroevol dataset
data(ewdates)
data(ewowin)
dir.create(file.path("im"), showWarnings=FALSE)
x &lt;- calibrate(x=ewdates$C14Age, errors=ewdates$C14SD, normalised=FALSE)
bins1 &lt;- binPrep(sites=ewdates$SiteID, ages=ewdates$C14Age, h=50)
stkde1 &lt;- stkde(x=x, coords=ewdates[,c("Eastings", "Northings")], 
win=ewowin, sbw=40000, cellres=2000, focalyears=seq(6500, 5000, -100),
tbw=50, bins=bins1, backsight=200, outdir="im")

## Plot just the proportion surface for just 5900 calBP
plot(stkde1, 5900, type="proportion")

## Plot an example of all four basic outputs for just 5900 calBP
dev.new(height=2.5, width=8)
par(mar=c(0.5, 0.5, 2.5, 2))
plot(stkde1, 5900, type="all")

## Plot standardised change surfaces to a sub-directory called 
## /png for all timeslices and save to file.
dir.create(file.path("png"), showWarnings=FALSE)
plot(stkde1, seq(6500,5000,-100), type="change", ramptype="std", withpts=TRUE, plotdir="png")

## Plot all four summary surfaces in one image, saving them to a sub-directory call 'pngall',
## and with the output of the change map standardised to a common ramp 
## (but leaving the focal and proportion maps unstandardised with simple ramp labelling)
dir.create(file.path("pngall"), showWarnings=FALSE)
plot(stkde1, seq(6500,5000,-100), type="all", ramptype=c("unl","unl","std"), imdim=cm(c(2.5,8)),
withpts=TRUE, plotdir="pngall")

## End(Not run)

</code></pre>

<hr>
<h2 id='poolDates'>Combine radiocarbon ages from the same event.</h2><span id='topic+poolDates'></span>

<h3>Description</h3>

<p>Computes a combined weighted mean and error and carries out a statistical test for internal consistency.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>poolDates(x, errors, id = NULL, F14C = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="poolDates_+3A_x">x</code></td>
<td>
<p>A vector of uncalibrated radiocarbon ages</p>
</td></tr>
<tr><td><code id="poolDates_+3A_errors">errors</code></td>
<td>
<p>A vector of standard deviations corresponding to each estimated radiocarbon age</p>
</td></tr>
<tr><td><code id="poolDates_+3A_id">id</code></td>
<td>
<p>A vector of event/object identifiers to be matched with radiocarbon ages. If not supplied all radiocarbon ages are assumed to be from the same event/object.</p>
</td></tr>
<tr><td><code id="poolDates_+3A_f14c">F14C</code></td>
<td>
<p>Whether calculations are carried out in F14C space or not. Default is TRUE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function calculates combined weighted error mean and standard error for each set of radiocarbon ages associated with the same event or object and computes a significance test for evaluating internal consistency following Ward and Wilson's method (1978). This is equivalent to OxCal's R_Combine routine.
</p>


<h3>Value</h3>

<p>A data.frame containing the weighted radiocarbon ages and errors for each event and the associated T-values and P-values.
</p>


<h3>References</h3>

<p>Ward, G. K., &amp; Wilson, S. R. (1978). Procedures for Comparing and Combining Radiocarbon Age Determinations: A Critique. Archaeometry, 20(1), 19–31. https://doi.org/10.1111/j.1475-4754.1978.tb00208.x
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x = c(4300,4330,5600,5603,5620)
errors = c(20,30,30,30,45)
id = c(1,1,2,2,2)
poolDates(x,errors,id)
</code></pre>

<hr>
<h2 id='qCal'>Computes the quantile date of calibrated dates</h2><span id='topic+qCal'></span>

<h3>Description</h3>

<p>Function for generating a vector quantile calibrated dates from a <code>CalDates</code> class object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>qCal(x, p = 0.5)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="qCal_+3A_x">x</code></td>
<td>
<p>A <code>CalDates</code> class object.</p>
</td></tr>
<tr><td><code id="qCal_+3A_p">p</code></td>
<td>
<p>A numeric value of probability. Default is 0.5 (median).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector of quantile dates in cal BP
</p>


<h3>See Also</h3>

<p><code><a href="#topic+calibrate">calibrate</a></code>, <code><a href="#topic+barCodes">barCodes</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- calibrate(c(3050,2950),c(20,20))
qCal(x,p=0.2)
</code></pre>

<hr>
<h2 id='rcarbon-deprecated'>Deprecated functions.</h2><span id='topic+rcarbon-deprecated'></span>

<h3>Description</h3>

<p>The functions listed below are deprecated and will be defunct in
the near future. When possible, alternative functions with similar
functionality are also mentioned. Help pages for deprecated functions are
available at <code>help("-deprecated")</code>.
</p>

<hr>
<h2 id='reScale'>Rescale a numeric vector to a specified minimum and maximum</h2><span id='topic+reScale'></span>

<h3>Description</h3>

<p>Rescale a numeric vector to a specified minimum and maximum.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>reScale(x, type = "simple", to = c(0, 1), na.rm = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="reScale_+3A_x">x</code></td>
<td>
<p>numeric vector to smooth.</p>
</td></tr>
<tr><td><code id="reScale_+3A_type">type</code></td>
<td>
<p>what kind of rescaling to perform. Current options are 'simple' (default) and 'normal' which produces a z-score and 'custom' for which the 'to' argument must be specified.</p>
</td></tr>
<tr><td><code id="reScale_+3A_to">to</code></td>
<td>
<p>numeric vector of length 2 specifying the minimum and maximum value to perform a linear rescale between (default is 0 and 1)</p>
</td></tr>
<tr><td><code id="reScale_+3A_na.rm">na.rm</code></td>
<td>
<p>Set to TRUE,this removes NAs before rescaling.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector of rescaled values.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>reScale(15:200)
</code></pre>

<hr>
<h2 id='runMean'>Calculate a running mean from a numeric vector.</h2><span id='topic+runMean'></span>

<h3>Description</h3>

<p>Calculate a running mean from a numeric vector.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>runMean(x, n, edge = "NA")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="runMean_+3A_x">x</code></td>
<td>
<p>numeric vector to smooth.</p>
</td></tr>
<tr><td><code id="runMean_+3A_n">n</code></td>
<td>
<p>the size of the window in which to smooth.</p>
</td></tr>
<tr><td><code id="runMean_+3A_edge">edge</code></td>
<td>
<p>How to treat edge cases where a full window is unavailable. Current options are 'NA' to fill with NAs or 'fill' to fill with original values</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector of smoothed values.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- rnorm(1000)
y &lt;- c(1:1000)
plot(y,x, type="l")
lines(runMean(x,50), col="red")
</code></pre>

<hr>
<h2 id='sampleDates'>Sample random calendar dates</h2><span id='topic+sampleDates'></span>

<h3>Description</h3>

<p>Randomly samples calendar dates from each calibrated date or bin.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sampleDates(x, bins = NA, nsim, boot = FALSE, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sampleDates_+3A_x">x</code></td>
<td>
<p>A 'CalDates' class object.</p>
</td></tr>
<tr><td><code id="sampleDates_+3A_bins">bins</code></td>
<td>
<p>A vector containing the bin names associated with each radiocarbon date. If set to NA, binning is not carried out.</p>
</td></tr>
<tr><td><code id="sampleDates_+3A_nsim">nsim</code></td>
<td>
<p>Number of sampling repetitions.</p>
</td></tr>
<tr><td><code id="sampleDates_+3A_boot">boot</code></td>
<td>
<p>A logical value indicating whether bootstrapping is carried out (see details below). Default is FALSE.</p>
</td></tr>
<tr><td><code id="sampleDates_+3A_verbose">verbose</code></td>
<td>
<p>A logical variable indicating whether extra information on progress should be reported. Default is TRUE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function randomly samples calendar dates based from calibrated probability distributions. When the <code>bins</code> argument is supplied a single calendar date is sampled from each bin. When <code>boot=TRUE</code>, dates (or bins) are randomly sampled with replacement before calendar dates are sampled.
</p>


<h3>Value</h3>

<p>An object of class <code>simdates</code> with the following elements
</p>

<ul>
<li><p><code>sdates</code> A matrix containing the randomly sampled calendar dates, with rows containing each of the <code>nsim</code> repetitions.
</p>
</li>
<li><p><code>weight</code> A vector (or matrix in when <code>boot=TRUE</code>) containing the total area under the curve of each date, normalised to sum to unity. Notice this will be identical for all dates if the calibration is carried out with the argument <code>normalised</code> set to TRUE.
</p>
</li></ul>


<hr>
<h2 id='smoothGauss'>Smooth a numeric vector using a Gaussian window</h2><span id='topic+smoothGauss'></span>

<h3>Description</h3>

<p>Smooth a numeric vector using a Gaussian window
</p>


<h3>Usage</h3>

<pre><code class='language-R'>smoothGauss(x, alpha, window = 0.1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="smoothGauss_+3A_x">x</code></td>
<td>
<p>numeric vector of values to smooth.</p>
</td></tr>
<tr><td><code id="smoothGauss_+3A_alpha">alpha</code></td>
<td>
<p>numeric value controlling the size of the gaussian smoothing window. Proportional to the standard deviation of the Gaussian smoothing kernel where sd=(N-1)/(2*alpha) with N being the length of the input vector.</p>
</td></tr>
<tr><td><code id="smoothGauss_+3A_window">window</code></td>
<td>
<p>a fraction between 0 and 1 representing the proportion of the input vector to include in the moving window.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Adapted from <code>smth.gaussian</code> in the <code>smoother</code> package.
</p>


<h3>References</h3>

<p>Hamilton, N. (2015). smoother: Functions Relating to the Smoothing of Numerical Data, R package version 1.1, https://CRAN.R-project.org/package=smoother
</p>


<h3>Examples</h3>

<pre><code class='language-R'>smoothGauss(runif(200),alpha=5)
</code></pre>

<hr>
<h2 id='spd'>Summed probability distributions (SPD) of radiocarbon dates.</h2><span id='topic+spd'></span>

<h3>Description</h3>

<p>The function generates Summed probability distributions (SPD) of radiocarbon dates, with optional binning routine for controlling inter-site or inter-phase variation in sampling intensity.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spd(
  x,
  timeRange,
  bins = NA,
  datenormalised = FALSE,
  spdnormalised = FALSE,
  runm = NA,
  verbose = TRUE,
  edgeSize = 500
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="spd_+3A_x">x</code></td>
<td>
<p>A <code>CalDates</code> class object containing the calibrated radiocarbon dates.</p>
</td></tr>
<tr><td><code id="spd_+3A_timerange">timeRange</code></td>
<td>
<p>A vector of length 2 indicating the start and end date of the analysis in cal BP.</p>
</td></tr>
<tr><td><code id="spd_+3A_bins">bins</code></td>
<td>
<p>A vector containing the bin names associated with each radiocarbon date. If set to NA, binning is not carried out.</p>
</td></tr>
<tr><td><code id="spd_+3A_datenormalised">datenormalised</code></td>
<td>
<p>Controls for calibrated dates with probability mass outside the timerange of analysis. If set to TRUE the total probability mass within the time-span of analysis is normalised to sum to unity. Should be set to FALSE when the parameter <code>normalised</code> in <code><a href="#topic+calibrate">calibrate</a></code> is set to FALSE. Default is FALSE.</p>
</td></tr>
<tr><td><code id="spd_+3A_spdnormalised">spdnormalised</code></td>
<td>
<p>A logical variable indicating whether the total probability mass of the SPD is normalised to sum to unity.</p>
</td></tr>
<tr><td><code id="spd_+3A_runm">runm</code></td>
<td>
<p>A number indicating the window size of the moving average to smooth the SPD. If set to <code>NA</code> no moving average is applied. Default is NA</p>
</td></tr>
<tr><td><code id="spd_+3A_verbose">verbose</code></td>
<td>
<p>A logical variable indicating whether extra information on progress should be reported. Default is TRUE.</p>
</td></tr>
<tr><td><code id="spd_+3A_edgesize">edgeSize</code></td>
<td>
<p>Extra margin in C14 Age time to handle edge effect when <code>datenormalise</code> is set to TRUE. Default is 500.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The binning routine consists of computing summed probability distribution of all dates associated to a given bin, divided by the number of contributing dates. This controls for any striking differences in sampling intensity, and ensures that each site phase is equally contributing to the final SPD (see Timpson et al 2014 for details). Bins can be generated using the <code><a href="#topic+binPrep">binPrep</a></code>, whilst the sensitivity to parameter choice can be explored with the <code><a href="#topic+binsense">binsense</a></code> function.
</p>


<h3>Value</h3>

<p>An object of class <code>CalSPD</code> with the following elements
</p>

<ul>
<li><p><code>metadata</code> A data.frame containing relevant information regarding the parameters used to create the SPD as well as sample size and number of bins
</p>
</li>
<li><p><code>grid</code> A <code>CalGrid</code> class object containing the summed probability associated to each calendar year between <code>timeRange[1]</code> and <code>timeRange[2]</code>
</p>
</li></ul>



<h3>References</h3>

<p>Timpson, A., et al, (2014). Reconstructing regional population fluctuations in the European Neolithic using radiocarbon dates: a new case-study using an improved method. Journal of Archaeological Science 52: 549-557. DOI:10.1016/j.jas.2014.08.011
</p>


<h3>See Also</h3>

<p><code><a href="#topic+calibrate">calibrate</a></code> for calibrating radiocarbon dates; <code><a href="#topic+binPrep">binPrep</a></code> for preparing bins.
</p>

<hr>
<h2 id='spd2rc'>Computes rates of change from SPDs</h2><span id='topic+spd2rc'></span>

<h3>Description</h3>

<p>Function for computing rates of change between abutting user-defined time-blocks.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spd2rc(
  spd,
  breaks = NULL,
  backsight = NULL,
  changexpr = expression((t1/t0)^(1/d) - 1)
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="spd2rc_+3A_spd">spd</code></td>
<td>
<p>Summed Probability Distribution obtained using the <code><a href="#topic+spd">spd</a></code> function.</p>
</td></tr>
<tr><td><code id="spd2rc_+3A_breaks">breaks</code></td>
<td>
<p>A vector giving the breakpoints between the time-blocks.</p>
</td></tr>
<tr><td><code id="spd2rc_+3A_backsight">backsight</code></td>
<td>
<p>A single numeric value defining the distance in time between the focal year and the backsight year for computing the rate of change.</p>
</td></tr>
<tr><td><code id="spd2rc_+3A_changexpr">changexpr</code></td>
<td>
<p>An expression defining how the rate of change is calculated, where <code>t1</code> is the summed probability for a focal block or year, <code>t0</code> is the summed probability for previous block or backsight year, and <code>d</code> is the duration of the block or the length of the backsight. Default is a geometric growth rate (i.e <code>expression((t1/t0)^(1/d)-1)</code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When the argument <code>breaks</code> is supplied the function aggregates the summed probability within each time-block and compared them across abutting blocks using the expression defined by <code>changexpr</code>. When the argument <code>backsight</code> is provided he expression is based on the comparison between the summed probability of each year and the associated backsight year.
</p>


<h3>Value</h3>

<p>An object of class <code>spdRC</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data(emedyd)
caldates &lt;- calibrate(x=emedyd$CRA, errors=emedyd$Error, normalised=FALSE, calMatrix=TRUE)
bins &lt;- binPrep(sites=emedyd$SiteName, ages=emedyd$CRA, h=50)
emedyd.spd &lt;- spd(caldates,bins,timeRange=c(16000,9000),runm=100)
emedyd.gg &lt;- spd2rc(emedyd.spd,breaks=seq(16000,9000,-1000))
emedyd.gg2 &lt;- spd2rc(emedyd.spd,backsight=10)
plot(emedyd.gg)
plot(emedyd.gg2)

## End(Not run)
</code></pre>

<hr>
<h2 id='spkde'>Map the spatial intensity of a set of radiocarbon dates for a given focal year.</h2><span id='topic+spkde'></span>

<h3>Description</h3>

<p>Function for mapping the spatial intensity of radiocarbon dates for a given geographical region and focal year.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spkde(
  x,
  coords,
  sbw,
  focalyear,
  tbw,
  win,
  cellres,
  bins = NA,
  backsight = NA,
  nsim = NULL,
  maskthresh = 0,
  changexpr = expression((t1 - t0)/tk),
  raw = FALSE,
  spjitter = TRUE,
  amount = NULL,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="spkde_+3A_x">x</code></td>
<td>
<p>An object of class CalDates with calibrated radiocarbon ages.</p>
</td></tr>
<tr><td><code id="spkde_+3A_coords">coords</code></td>
<td>
<p>A two column matrix of geographical coordinates from a a projected coordinate system (no checks are made for this) and with the same number of rows as length(x).</p>
</td></tr>
<tr><td><code id="spkde_+3A_sbw">sbw</code></td>
<td>
<p>A single numeric value for the spatial bandwidth to be applied around each raster cell, expressed as the standard deviation of a continuous Gaussian kernel (passed as the sigma argument to density.ppp()).</p>
</td></tr>
<tr><td><code id="spkde_+3A_focalyear">focalyear</code></td>
<td>
<p>A single numeric value for the focal year for the intensity map.</p>
</td></tr>
<tr><td><code id="spkde_+3A_tbw">tbw</code></td>
<td>
<p>A single numeric value for the temporal bandwidth to be applied around each focal year, expressed as the standard deviation of a continuous Gaussian kernel.</p>
</td></tr>
<tr><td><code id="spkde_+3A_win">win</code></td>
<td>
<p>The bounding polygon for the mapping (must be an object of class 'owin', see the spatstat package)</p>
</td></tr>
<tr><td><code id="spkde_+3A_cellres">cellres</code></td>
<td>
<p>The cell or pixel resolution of the output raster maps.</p>
</td></tr>
<tr><td><code id="spkde_+3A_bins">bins</code></td>
<td>
<p>A vector of labels corresponding to site names, ids, bins or phases (same length as x)</p>
</td></tr>
<tr><td><code id="spkde_+3A_backsight">backsight</code></td>
<td>
<p>A single numeric value (which will be coerced to be positive) that specifies a comparison timestep in the past for a mapping of temporal change.</p>
</td></tr>
<tr><td><code id="spkde_+3A_nsim">nsim</code></td>
<td>
<p>How many bootstrap simulations to run (default is none).</p>
</td></tr>
<tr><td><code id="spkde_+3A_maskthresh">maskthresh</code></td>
<td>
<p>A single numeric value for a lower-bound cut-off for all maps, based on a minimum required spatial intensity of all dates in x.</p>
</td></tr>
<tr><td><code id="spkde_+3A_changexpr">changexpr</code></td>
<td>
<p>An expression for calculating the change in spatial intensity between the focal year and a backsight year (as defined via the backsight argument). Available input options are t1 (the spatial intensity for the focal year), t0 (the spatial intensity for the backsight year) and tk (the overall spatial intensity for all dates irrespective of year), plus any other standard constants and mathematical operators. A sensible default is provided.</p>
</td></tr>
<tr><td><code id="spkde_+3A_raw">raw</code></td>
<td>
<p>Whether to output the raw simulations (if nsim is set) or just the summaries (the latter is default).</p>
</td></tr>
<tr><td><code id="spkde_+3A_spjitter">spjitter</code></td>
<td>
<p>Whether noise is applied to the spatial coordinates or not. Default is TRUE.</p>
</td></tr>
<tr><td><code id="spkde_+3A_amount">amount</code></td>
<td>
<p>Amount of jitter applied to the spatial coordinates when <code>spjitter=TRUE</code>. Default is d/5, where d is difference between the closest coordinates.</p>
</td></tr>
<tr><td><code id="spkde_+3A_verbose">verbose</code></td>
<td>
<p>A logical variable indicating whether extra information on progress should be reported. Default is TRUE.</p>
</td></tr>
<tr><td><code id="spkde_+3A_...">...</code></td>
<td>
<p>ignored or passed to internal functions.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is not really intended for general use, but rather as an internal function for stkde(). Most applications should use the latter, but spkde has been exported and made externally available, both because this function retains the result in memory (in contrast to stkde) and with a view to possible addition of bootstrap methods in the future. Some function arguments therefore remain experimental. The function computes timeslice maps of the spatio-temporal kernel intensity of radiocarbon dates across a geographic region for a specific focal year. The user specifies the arbitrary size of both the spatial and the temporal Gaussian kernels that will be used to summarise radiocarbon date intensity per grid cell.
</p>


<h3>Value</h3>

<p>A list object of class spKde with the following elements:
</p>

<ul>
<li> <p>A series of list items storing some of the input parameters such as the focal year, sbw, tbw, backsight, maskthresh. 
</p>
</li>
<li><p><code>nonfocal</code> An im object mapping the basic spatial intensity of all dates, without reference to a focal year. 
</p>
</li>
<li><p><code>focal</code> An im object mapping the spatial intensity of dates for the focal year (i.e. weighted by how much each dates probability distribution overlaps with a Gaussian kernel centred on the focal year with a standard deviation of tbw).
</p>
</li>
<li><p><code>proportion</code> An im object mapping the proportional intensity of dates for the focal year (i.e. the focal surface divided by the nonfocal surface).
</p>
</li>
<li><p><code>change</code> An im object mapping the amount of change between the intensity of dates for the focal year and a chosen backsight year (i.e. as defined by changexpr).
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
## Example for the focal year 5600 calBP (also with site binning), 
## using a subset of English and Welsh dates from the Euroevol dataset
data(ewdates)
data(ewowin)
x &lt;- calibrate(x=ewdates$C14Age, errors=ewdates$C14SD, normalised=FALSE)
bins1 &lt;- binPrep(sites=ewdates$SiteID, ages=ewdates$C14Age, h=50)
spkde1 &lt;- spkde(x=x, coords=ewdates[,c("Eastings", "Northings")], win=ewowin, 
sbw=40000, cellres=2000, focalyear=5600, tbw=50, bins=bins1, backsight=200,amount=1)
plot(spkde1$focal)
plot(spkde1$proportion)

## End(Not run)

</code></pre>

<hr>
<h2 id='sptest'>Spatial Permutation Test of summed probability distributions.</h2><span id='topic+sptest'></span>

<h3>Description</h3>

<p>This function carries out local spatial permutation tests of summed radiocarbon probability distributions in order to detect local deviations in growth rates (Crema et al 2017).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sptest(
  calDates,
  timeRange,
  bins,
  locations,
  locations.id.col = NULL,
  breaks,
  h,
  kernel = "gaussian",
  rate = expression((t2/t1)^(1/d) - 1),
  nsim = 1000,
  runm = NA,
  permute = "locations",
  ncores = 1,
  datenormalised = FALSE,
  verbose = TRUE,
  raw = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sptest_+3A_caldates">calDates</code></td>
<td>
<p>A <code>CalDates</code> class object.</p>
</td></tr>
<tr><td><code id="sptest_+3A_timerange">timeRange</code></td>
<td>
<p>A vector of length 2 indicating the start and end date of the analysis in cal BP</p>
</td></tr>
<tr><td><code id="sptest_+3A_bins">bins</code></td>
<td>
<p>A vector indicating which bin each radiocarbon date is assigned to. Must have the same length as the number of radiocarbon dates. Can be created using the  <code><a href="#topic+binPrep">binPrep</a></code>) function. Bin names should follow the format &quot;x_y&quot;, where x refers to a unique location (e.g. a site) and y is a integer value (e.g. &quot;S023_1&quot;, &quot;S023_2&quot;,&quot;S034_1&quot;, etc.).</p>
</td></tr>
<tr><td><code id="sptest_+3A_locations">locations</code></td>
<td>
<p>A <code>sf</code> class object of the site locations.</p>
</td></tr>
<tr><td><code id="sptest_+3A_locations.id.col">locations.id.col</code></td>
<td>
<p>Column name containing the first part of the supplied bin names. If missing rownames are used.</p>
</td></tr>
<tr><td><code id="sptest_+3A_breaks">breaks</code></td>
<td>
<p>A vector of break points for defining the temporal slices.</p>
</td></tr>
<tr><td><code id="sptest_+3A_h">h</code></td>
<td>
<p>distance parameter for calculating spatial weights.</p>
</td></tr>
<tr><td><code id="sptest_+3A_kernel">kernel</code></td>
<td>
<p>indicates the type of weighting function, either 'fixed' or 'gaussian'. When set to &quot;fixed&quot; weight is equal to 1 within a radius of <code>h</code> km from each focal sie, and 0 outside this range. When set &quot;gaussian&quot; the weight declines with an exponential rate equal to exp(-d^2/h^2), where the d is the distance to the focal site. Default is &quot;gaussian&quot;.</p>
</td></tr>
<tr><td><code id="sptest_+3A_rate">rate</code></td>
<td>
<p>An expression defining how the rate of change is calculated, where <code>t1</code> is the summed probability for a focal block, <code>t2</code> is the summed probability for next block, and <code>d</code> is the duration of the blocks. Default is a geometric growth rate (i.e <code>expression((t2/t1)^(1/d)-1)</code>).</p>
</td></tr>
<tr><td><code id="sptest_+3A_nsim">nsim</code></td>
<td>
<p>The total number of simulations. Default is 1000.</p>
</td></tr>
<tr><td><code id="sptest_+3A_runm">runm</code></td>
<td>
<p>The window size of the moving window average. Must be set to <code>NA</code> if the rates of change are calculated from the raw SPDs.</p>
</td></tr>
<tr><td><code id="sptest_+3A_permute">permute</code></td>
<td>
<p>Indicates whether the permutations should be based on the <code>"bins"</code> or the <code>"locations"</code>. Default is <code>"locations"</code>.</p>
</td></tr>
<tr><td><code id="sptest_+3A_ncores">ncores</code></td>
<td>
<p>Number of cores used for for parallel execution. Default is 1.</p>
</td></tr>
<tr><td><code id="sptest_+3A_datenormalised">datenormalised</code></td>
<td>
<p>A logical variable indicating whether the probability mass of each date within <code>timeRange</code> is equal to 1. Default is FALSE.</p>
</td></tr>
<tr><td><code id="sptest_+3A_verbose">verbose</code></td>
<td>
<p>A logical variable indicating whether extra information on progress should be reported. Default is TRUE.</p>
</td></tr>
<tr><td><code id="sptest_+3A_raw">raw</code></td>
<td>
<p>A logical variable indicating whether permuted sets of geometric growth rates for each location should be returned. Default is FALSE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function consists of the following seven steps: 1) generate a weight matrix based on inter-site distance; 2) for each location (e.g. a site) generate a local SPD of radiocarbon dates, weighting the contribution of dates from neighbouring sites using a weight scheme computed in step 1; 3) define temporal slices (using <code>breaks</code> as break values), then compute the total probability mass within each slice; 4) compute the rate of change between abutting temporal slices by using the formula: <code class="reqn">(SPD_{t}/SPD_{t+1}^{1/\Delta t}-1)</code>; 5) randomise the location of individual bins or the entire sequence of bins associated with a given location and carry out steps 2 to 4; 6) repeat step 5 <code>nsim</code> times and generate, for each location, a distribution of growth rates under the null hypothesis (i.e. spatial independence); 7) compare, for each location, the observed growth rate with the distribution under the null hypothesis and compute the p-values; and 8) compute the false-discovery rate for each location.
</p>


<h3>Value</h3>

<p>A <code>spatialTest</code> class object
</p>


<h3>References</h3>

<p>Crema, E.R., Bevan, A., Shennan, S. (2017). Spatio-temporal approaches to archaeological radiocarbon dates. Journal of Archaeological Science, 87, 1-9.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+permTest">permTest</a></code> for a non-spatial permutation test; <code><a href="#topic+plot.spatialTest">plot.spatialTest</a></code> for plotting; <code><a href="#topic+spd2rc">spd2rc</a></code> for computing geometric growth rates.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Reproduce Crema et al 2017 ##
## Not run: 
data(euroevol) #load data

## Subset only for ca 8000 to 5000 Cal BP (7500-4000 14C Age)
euroevol2=subset(euroevol,C14Age&lt;=7500&amp;C14Age&gt;=4000)

## define chronological breaks
breaks=seq(8000,5000,-500)

## Create a sf class object 
library(sf)
sites.df = unique(data.frame(SiteID=euroevol2$SiteID,
Longitude=euroevol2$Longitude,Latitude=euroevol2$Latitude))
sites.sf = st_as_sf(sites.df,coords=c('Longitude','Latitude'),crs=4326) 

## Calibration and binning
bins=binPrep(sites=euroevol2$SiteID,ages=euroevol2$C14Age,h=200)  
calDates=calibrate(x=euroevol2$C14Age,errors=euroevol2$C14SD,normalised=FALSE)

## Main Analysis (over 2 cores; requires doSnow package) 
## NOTE: the number of simulations should be ideally larger 
## to ensure more accurate and precise estimates of the p/q-values.
res.locations=sptest(calDates,timeRange=c(8000,5000),bins=bins,
locations=sites.sf,locations.id.col="SiteID",h=100,breaks=breaks,ncores=2,nsim=100,
permute="locations",datenormalised=FALSE)

## Plot results
library(rnaturalearth)
win  &lt;- ne_countries(continent = 'europe',scale=10,returnclass='sf')
#retrieve coordinate limits
xrange &lt;- st_bbox(sites.sf)[c(1,3)]
yrange &lt;- st_bbox(sites.sf)[c(2,4)]

par(mfrow=c(1,2))  
par(mar=c(0.1,0.1,0,0.5))
plot(sf::st_geometry(win),col="antiquewhite3",border="antiquewhite3",xlim=xrange,ylim=yrange)
plot(res.locations,index=4,add=TRUE,legend=TRUE,option="raw",breakRange=c(-0.005,0.005)) 
plot(sf::st_geometry(win),col="antiquewhite3",border="antiquewhite3",xlim=xrange,ylim=yrange) 
plot(res.locations,index=4,add=TRUE,legend=TRUE,option="test")  

## End(Not run)
</code></pre>

<hr>
<h2 id='stackspd'>Stacked Summed Probability Distribution</h2><span id='topic+stackspd'></span>

<h3>Description</h3>

<p>Generates and combines multiple SPDs based on a user defined grouping.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stackspd(
  x,
  timeRange,
  bins = NA,
  group = NULL,
  datenormalised = FALSE,
  runm = NA,
  verbose = TRUE,
  edgeSize = 500
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="stackspd_+3A_x">x</code></td>
<td>
<p>A <code>CalDates</code> class object containing the calibrated radiocarbon dates.</p>
</td></tr>
<tr><td><code id="stackspd_+3A_timerange">timeRange</code></td>
<td>
<p>A vector of length 2 indicating the start and end date of the analysis in cal BP.</p>
</td></tr>
<tr><td><code id="stackspd_+3A_bins">bins</code></td>
<td>
<p>A vector containing the bin names associated with each radiocarbon date. If set to NA, binning is not carried out.</p>
</td></tr>
<tr><td><code id="stackspd_+3A_group">group</code></td>
<td>
<p>A character or factor vector containing the grouping variable.</p>
</td></tr>
<tr><td><code id="stackspd_+3A_datenormalised">datenormalised</code></td>
<td>
<p>Controls for calibrated dates with probability mass outside the timerange of analysis. If set to TRUE the total probability mass within the time-span of analysis is normalised to sum to unity. Should be set to FALSE when the parameter <code>normalised</code> in <code><a href="#topic+calibrate">calibrate</a></code> is set to FALSE. Default is FALSE.</p>
</td></tr>
<tr><td><code id="stackspd_+3A_runm">runm</code></td>
<td>
<p>A number indicating the window size of the moving average to smooth the SPD. If set to <code>NA</code> no moving average is applied. Default is NA</p>
</td></tr>
<tr><td><code id="stackspd_+3A_verbose">verbose</code></td>
<td>
<p>A logical variable indicating whether extra information on progress should be reported. Default is TRUE.</p>
</td></tr>
<tr><td><code id="stackspd_+3A_edgesize">edgeSize</code></td>
<td>
<p>Controls edge effect by expanding the fitted model beyond the range defined by <code>timeRange</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>stackCalSPD</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data(emedyd)
x = calibrate(x=emedyd$CRA, errors=emedyd$Error,normalised=FALSE)
bins = binPrep(sites=emedyd$SiteName, ages=emedyd$CRA,h=50)
res = stackspd(x=x,timeRange=c(16000,8000),bins=bins,group=emedyd$Region)

## End(Not run)
</code></pre>

<hr>
<h2 id='stkde'>Map the spatio-temporal intensity of a set of radiocarbon dates</h2><span id='topic+stkde'></span>

<h3>Description</h3>

<p>Function for mapping the spatio-temporal intensity of radiocarbon dates for a given geographical region in one or more tim.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stkde(
  x,
  coords,
  sbw,
  focalyears,
  tbw,
  win,
  cellres,
  outdir = ".",
  bins = NA,
  backsight = NA,
  maskthresh = 0,
  changexpr = expression((t1 - t0)/tk),
  spjitter = TRUE,
  amount = NULL,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="stkde_+3A_x">x</code></td>
<td>
<p>An object of class CalDates with calibrated radiocarbon ages.</p>
</td></tr>
<tr><td><code id="stkde_+3A_coords">coords</code></td>
<td>
<p>A two column matrix of geographical coordinates from a a projected coordinate system (no checks are made for this) and with the same number of rows as length(x).</p>
</td></tr>
<tr><td><code id="stkde_+3A_sbw">sbw</code></td>
<td>
<p>A single numeric value for the spatial bandwidth to be applied around each raster cell, expressed as the standard deviation of a continuous Gaussian kernel (passed as the sigma argument to density.ppp()).</p>
</td></tr>
<tr><td><code id="stkde_+3A_focalyears">focalyears</code></td>
<td>
<p>A vector of numeric values for focal years, in calBP, that will be timesteps at which date intensity maps will be produced.</p>
</td></tr>
<tr><td><code id="stkde_+3A_tbw">tbw</code></td>
<td>
<p>A single numeric value for the temporal bandwidth to be applied around each focal year, expressed as the standard deviation of a continuous Gaussian kernel.</p>
</td></tr>
<tr><td><code id="stkde_+3A_win">win</code></td>
<td>
<p>The bounding polygon for the mapping (must be an object of class 'owin', see the spatstat package)</p>
</td></tr>
<tr><td><code id="stkde_+3A_cellres">cellres</code></td>
<td>
<p>The cell or pixel resolution of the output raster maps.</p>
</td></tr>
<tr><td><code id="stkde_+3A_outdir">outdir</code></td>
<td>
<p>The output directory for timeslice maps and data that are saved to file.</p>
</td></tr>
<tr><td><code id="stkde_+3A_bins">bins</code></td>
<td>
<p>A vector of labels corresponding to site names, ids, bins or phases (same length as x)</p>
</td></tr>
<tr><td><code id="stkde_+3A_backsight">backsight</code></td>
<td>
<p>A single numeric value (which will be coerced to be positive) that specifies a comparison timestep in the past for a mapping of temporal change.</p>
</td></tr>
<tr><td><code id="stkde_+3A_maskthresh">maskthresh</code></td>
<td>
<p>A single numeric value for a lower-bound cut-off for all maps, based on a minimum required spatial intensity of all dates in x.</p>
</td></tr>
<tr><td><code id="stkde_+3A_changexpr">changexpr</code></td>
<td>
<p>An expression for calculating the change in spatial intensity between the focal year and a backsight year (as defined via the backsight argument). Available input options are t1 (the spatial intensity for the focal year), t0 (the spatial intensity for the backsight year) and tk (the overall spatial intensity for all dates irrespective of year), plus any other standard constants and mathematical operators. A sensible default is provided.</p>
</td></tr>
<tr><td><code id="stkde_+3A_spjitter">spjitter</code></td>
<td>
<p>Whether noise is applied to the spatial coordinates or not. Default is TRUE.</p>
</td></tr>
<tr><td><code id="stkde_+3A_amount">amount</code></td>
<td>
<p>Amount of jitter applied to the spatial coordinates when <code>spjitter=TRUE</code>. Default is d/5, where d is difference between the closest coordinates.</p>
</td></tr>
<tr><td><code id="stkde_+3A_verbose">verbose</code></td>
<td>
<p>A logical variable indicating whether extra information on progress should be reported. Default is TRUE.</p>
</td></tr>
<tr><td><code id="stkde_+3A_...">...</code></td>
<td>
<p>ignored or passed to internal functions.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function computes one or more timeslice maps of the spatio-temporal kernel intensity of radiocarbon dates across a geographic region and for a specific focal year. The user specifies the arbitrary sizes of both the spatial and the temporal Gaussian kernels that will be used to summarise radiocarbon date intensity per grid cell per timestep. The results allow standardisation of colour ramps, etc. across timesteps and are amenable to plotting individually via plot.stKde and/or for output to png for animation.
</p>


<h3>Value</h3>

<p>A list object of class stKde with the following elements:
</p>

<ul>
<li> <p>A series of list items storing some of the input parameters such as the focalyears, sbw, tbw, backsight, maskthresh 
</p>
</li>
<li><p><code>nonfocal</code> An im object mapping the basic spatial intensity of all dates, without reference to a focal year. 
</p>
</li>
<li><p><code>impaths</code> A character vector of the paths to the individual timeslices stored on file. Maps are not stored in memory (see spkde() for further details of what is stored).
</p>
</li>
<li><p><code>stats</code> A list of data.frames offering summary statistics on each of the different types of output surface across all timeslices. Used primarily to allow consistent colour ramps across time-slices.
</p>
</li>
<li><p><code>ppp</code> The ppp object for all dates and the observation window.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
## Example with a subset of English and Welsh dates from the Euroevol dataset
data(ewdates)
data(ewowin)
x &lt;- calibrate(x=ewdates$C14Age, errors=ewdates$C14SD, normalised=FALSE)
## Create centennial timeslices (also with site binning)
bins1 &lt;- binPrep(sites=ewdates$SiteID, ages=ewdates$C14Age, h=50)
stkde1 &lt;- stkde(x=x, coords=ewdates[,c("Eastings", "Northings")], win=ewowin, 
sbw=40000, cellres=2000, focalyears=seq(6500, 5000, -100), tbw=50, bins=bins1, 
backsight=200, outdir="im",amount=1)
## Plot an example of all four basic outputs for 5900 calBP
dev.new(height=2.5, width=8)
par(mar=c(0.5, 0.5, 2.5, 2))
plot(stkde1, 5900, type="all")

## End(Not run)

</code></pre>

<hr>
<h2 id='subset.CalDates'>Subsetting calibrated dates</h2><span id='topic+subset.CalDates'></span>

<h3>Description</h3>

<p>Subsets calibrated dates (<code>CalDates</code> class object) based on Logical expressions of time intervals.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'CalDates'
subset(x, s, p, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="subset.CalDates_+3A_x">x</code></td>
<td>
<p>A CalDates class object</p>
</td></tr>
<tr><td><code id="subset.CalDates_+3A_s">s</code></td>
<td>
<p>Logical expression indicating dates to keep. The expression should include the term <code>BP</code> which refers to specific dates.</p>
</td></tr>
<tr><td><code id="subset.CalDates_+3A_p">p</code></td>
<td>
<p>Probability mass meeting the condition defined by <code>ss</code>.</p>
</td></tr>
<tr><td><code id="subset.CalDates_+3A_...">...</code></td>
<td>
<p>Further arguments to be passed to or from other methods (ignored).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function subsets <code>CalDates</code> class objects by identifying all dates that have a probability mass larger than <code>p</code> for a user defined logical expression of temporal interval containing the term <code>BP</code>, where <code>BP</code> refers to radiocarbon date. See examples for further detailes
</p>


<h3>Value</h3>

<p>A CalDates class object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Generate some calibrated dates
x = calibrate(c(12100,5410,5320,3320),errors=c(20,20,30,30))
## Subsets all dates that have a probability mass above 0.8 before 10000 BP
x2 = subset(x,BP&gt;10000,p=0.8)
## Subsets all dates that have a probability mass above 0.5 between 6000 and 6300 BP
x3 = subset(x,BP&gt;6000&amp;BP&lt;6300,p=0.5)
</code></pre>

<hr>
<h2 id='summary.CalDates'>Summarise a <code>CalDates</code> class object</h2><span id='topic+summary.CalDates'></span>

<h3>Description</h3>

<p>Returns summary statistics of calibrated dates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'CalDates'
summary(object, prob = NA, calendar = "BP", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.CalDates_+3A_object">object</code></td>
<td>
<p>A <code>CalDates</code> class object.</p>
</td></tr>
<tr><td><code id="summary.CalDates_+3A_prob">prob</code></td>
<td>
<p>A vector containing probabilities for the higher posterior density interval. Default is <code>c(0.683,0.954)</code>, i.e. 1 and 2-Sigma range.</p>
</td></tr>
<tr><td><code id="summary.CalDates_+3A_calendar">calendar</code></td>
<td>
<p>Whether the summary statistics should be computed in cal BP (<code>"BP"</code>) or in BCAD (<code>"BCAD"</code>).</p>
</td></tr>
<tr><td><code id="summary.CalDates_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>data.frame</code> class object containing the ID of each date, along with the median date and one and two sigma (or a user specified probability) higher posterior density ranges.
</p>

<hr>
<h2 id='summary.SpdModelTest'>Summarise a <code>SpdModelTest</code> class object</h2><span id='topic+summary.SpdModelTest'></span>

<h3>Description</h3>

<p><code>summary</code> method for class &quot;<code>SpdModelTest</code>&quot;
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'SpdModelTest'
summary(object, type = "spd", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.SpdModelTest_+3A_object">object</code></td>
<td>
<p>A <code>SpdModelTest</code> class object produced using the <code>link{modelTest}</code> function.</p>
</td></tr>
<tr><td><code id="summary.SpdModelTest_+3A_type">type</code></td>
<td>
<p>Specifies whether the summary should be based on SPD ('spd') or associated rates of change ('roc'). Default is 'spd'.</p>
</td></tr>
<tr><td><code id="summary.SpdModelTest_+3A_...">...</code></td>
<td>
<p>Ignored</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The summary function returns metadata (number of radiocarbon dates, bins, and simulations), the p-value of the global significance test, and the chronological interval of local positive and negative deviations from the simulation envelope.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+modelTest">modelTest</a></code>.
</p>

<hr>
<h2 id='summary.SpdPermTest'>Summarise a <code>SpdPermTest</code> class object</h2><span id='topic+summary.SpdPermTest'></span>

<h3>Description</h3>

<p><code>summary</code> method for class &quot;<code>SpdPermTest</code>&quot;
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'SpdPermTest'
summary(object, type = "spd", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.SpdPermTest_+3A_object">object</code></td>
<td>
<p>A <code>SpdPermTest</code> class object produced using the <code>link{permTest}</code> function.</p>
</td></tr>
<tr><td><code id="summary.SpdPermTest_+3A_type">type</code></td>
<td>
<p>Specifies whether the summary should be based on SPD ('spd') or associated rates of change ('roc'). Default is 'spd'.</p>
</td></tr>
<tr><td><code id="summary.SpdPermTest_+3A_...">...</code></td>
<td>
<p>Ignored</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The summary function returns metadata (number of radiocarbon dates, bins, and simulations), the p-value of the global significance test, and the chronological interval of local positive and negative deviations from the simulation envelope for each set.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+permTest">permTest</a></code>.
</p>

<hr>
<h2 id='thinDates'>Sampling function to select a maximum number of dates per site, bin or phase.</h2><span id='topic+thinDates'></span>

<h3>Description</h3>

<p>Function to select a subset of uncalibrated radiocarbon dates up to a maximum sample size per site, bin or phase.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>thinDates(ages, errors, bins, size, thresh = 0.5, method = "random", seed = NA)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="thinDates_+3A_ages">ages</code></td>
<td>
<p>A vector of uncalibrated radiocarbon ages</p>
</td></tr>
<tr><td><code id="thinDates_+3A_errors">errors</code></td>
<td>
<p>A vector of uncalibrated radiocarbon errors (same length as ages)</p>
</td></tr>
<tr><td><code id="thinDates_+3A_bins">bins</code></td>
<td>
<p>A vector of labels corresponding to site names, ids, bins or phases (same length as ages)</p>
</td></tr>
<tr><td><code id="thinDates_+3A_size">size</code></td>
<td>
<p>A single integer specifying the maximum number of desired dates for each label stated bin.</p>
</td></tr>
<tr><td><code id="thinDates_+3A_thresh">thresh</code></td>
<td>
<p>A single numeric value between 0 and 1 specifying the approximate proportion (after rounding) of the resulting sample that will be chosen according to lowest date errors. At the extremes, O produces a simple random sample whereas 1 selects the sample dates with the lowest errors. Ignored if method=&quot;random&quot;.</p>
</td></tr>
<tr><td><code id="thinDates_+3A_method">method</code></td>
<td>
<p>The method to be applied where &quot;random&quot; simple selects a random sample, whereas &quot;splitsample&quot;, picks some proportion (see thresh) of the sample to minimise errors, and randomly samples the rest. At present, these are the only two options.</p>
</td></tr>
<tr><td><code id="thinDates_+3A_seed">seed</code></td>
<td>
<p>Allows setting of a random seed to ensure reproducibility.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector of the row indices corresponding to those of the input data.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+binPrep">binPrep</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(euroevol)
foursites &lt;- euroevol[euroevol$SiteID %in% c("S2072","S4380","S6139","S9222"),]
table(as.character(foursites$SiteID))
## Thin so each site has 10 dates each max, with random selection
thinInds&lt;- thinDates(ages=foursites$C14Age, errors=foursites$C14SD, 
bins=foursites$SiteID, size=10, method="random", seed=123)
tdates &lt;- foursites[thinInds,]
tdates
## Same but choose the first 60% (i.e. 6 dates) from the lowest errors 
## and then fill in the rest randomly.
thinInds&lt;- thinDates(ages=foursites$C14Age, errors=foursites$C14SD, 
bins=foursites$SiteID, size=10, method="splitsample", thresh=0.6, seed=123)
tdates1 &lt;- foursites[thinInds,]
tdates1
</code></pre>

<hr>
<h2 id='transformSPD'>Apply taphonomic corrections or other transformations to an SPD.</h2><span id='topic+transformSPD'></span>

<h3>Description</h3>

<p>Apply taphonomic corrections or other transformations to an SPD.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>transformSPD(
  x,
  correction = expression(PrDens/(5.726442 * 10^6 * (CalBP + 2176.4)^-1.3925309))
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="transformSPD_+3A_x">x</code></td>
<td>
<p>An object of class <code>CalSPD</code>, <code>compositeKDE</code> or <code>stackCalSPD</code>.</p>
</td></tr>
<tr><td><code id="transformSPD_+3A_correction">correction</code></td>
<td>
<p>An expression for transforming the SPD. Available input terms include: CalBP, the vector of <code>calBP</code> year within the time range; and <code>PrDens</code>, a matching vector of summed probability. The default expression is the taphonomic correction formula proposed by Surovell et al 2009.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of the same class as x
</p>


<h3>References</h3>

<p>Surovell, T.A., Finley, J.B., Smith, G.M., Brantingham, P.J., Kelly, R., 2009. Correcting temporal frequency distributions for taphonomic bias. Journal of Archaeological Science 36, 1715–1724.
</p>


<h3>Examples</h3>

<pre><code class='language-R'> 
## Not run: 
data(emedyd)
region1 = subset(emedyd,Region==1)
x = calibrate(x=region1$CRA, errors=region1$Error,normalised=FALSE)
bins = binPrep(sites=region1$SiteName, ages=region1$CRA,h=50)
region1.spd = spd(x=x,bins=bins,timeRange=c(16000,8000))
region1.spd.corrected = transformSPD(region1.spd)

## End(Not run)
</code></pre>

<hr>
<h2 id='uncalibrate'>Uncalibrate (back-calibrate) a calibrated radiocarbon date (or summed probability distribution).</h2><span id='topic+uncalibrate'></span><span id='topic+uncalibrate.default'></span><span id='topic+uncalibrate.CalGrid'></span>

<h3>Description</h3>

<p>Function for uncalibrating one or more radiocarbon dates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>uncalibrate(x, ...)

## Default S3 method:
uncalibrate(x, CRAerrors = 0, roundyear = TRUE, calCurves = "intcal20", ...)

## S3 method for class 'CalGrid'
uncalibrate(
  x,
  calCurves = "intcal20",
  eps = 1e-05,
  compact = TRUE,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="uncalibrate_+3A_x">x</code></td>
<td>
<p>Either a vector of calibrated radiocarbon ages or an object of class CalGrid.</p>
</td></tr>
<tr><td><code id="uncalibrate_+3A_...">...</code></td>
<td>
<p>ignored</p>
</td></tr>
<tr><td><code id="uncalibrate_+3A_craerrors">CRAerrors</code></td>
<td>
<p>A vector of standard deviations corresponding to each estimated radiocarbon age (ignored if x is a CalGrid object).</p>
</td></tr>
<tr><td><code id="uncalibrate_+3A_roundyear">roundyear</code></td>
<td>
<p>Whether the randomised estimate is rounded or not. Default is TRUE.</p>
</td></tr>
<tr><td><code id="uncalibrate_+3A_calcurves">calCurves</code></td>
<td>
<p>A string naming a calibration curve already provided with the rcarbon package (currently 'intcal20','intcal13','intcal13nhpine16','shcal20','shcal13','shcal13shkauri16',&rdquo;marine13','marine20' and 'normal') or a custom curve provided as matrix/data.frame in three columns (&quot;CALBP&quot;,&quot;C14BP&quot;,&quot;Error&quot;). The default is the 'intcal20' curve and only one curve can currently be specified for all dates.</p>
</td></tr>
<tr><td><code id="uncalibrate_+3A_eps">eps</code></td>
<td>
<p>Cut-off value for density calculation (for CalGrid objects only).</p>
</td></tr>
<tr><td><code id="uncalibrate_+3A_compact">compact</code></td>
<td>
<p>A logical variable indicating whether only uncalibrated ages with non-zero probabilities should be returned (for CalGrid objects only).</p>
</td></tr>
<tr><td><code id="uncalibrate_+3A_verbose">verbose</code></td>
<td>
<p>A logical variable indicating whether extra information on progress should be reported (for CalGrid objects only).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function takes one or more calibrated calendars and looks-up the corresponding uncalibrated age, error of the stated calibration curve at that point. It also provides a randomised estimate of the uncalibrate age based on the curve error (and optionally also a hypothetical measurement error.
</p>


<h3>Value</h3>

<p>A data.frame with specifying the original data, the uncalibrated age without the calibration curve error (ccCRA), the calibration curve error at this point in the curve (ccError), a randomised uncalibrated age (rCRA) given both the stated ccError and any further hypothesised instrumental error provided by the CRAerrors argument (rError).
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Uncalibrate two calendar dates
uncalibrate(c(3050,2950))
</code></pre>

<hr>
<h2 id='which.CalDates'>Which indices for calibrated dates</h2><span id='topic+which.CalDates'></span>

<h3>Description</h3>

<p>Gives the TRUE indices of calibrated dates (<code>CalDates</code> class object) based on Logical expressions of time intervals.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>which.CalDates(x, s, p)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="which.CalDates_+3A_x">x</code></td>
<td>
<p>A CalDates class object</p>
</td></tr>
<tr><td><code id="which.CalDates_+3A_s">s</code></td>
<td>
<p>Logical expression indicating dates to keep. The expression should include the term <code>BP</code> which refers to specific dates.</p>
</td></tr>
<tr><td><code id="which.CalDates_+3A_p">p</code></td>
<td>
<p>Probability mass meeting the condition defined by <code>ss</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function subsets <code>CalDates</code> class objects by identifying all dates that have a probability mass larger than <code>p</code> for a user defined logical expression of temporal interval containing the term <code>BP</code>, where <code>BP</code> refers to radiocarbon date. See examples for further detailes
</p>


<h3>Value</h3>

<p>A CalDates class object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Generate some calibrated dates
x = calibrate(c(12100,5410,5320,3320),errors=c(20,20,30,30))
## Subsets all dates that have a probability mass above 0.8 before 10000 BP
x2 = which.CalDates(x,BP&gt;10000,p=0.8)
## Subsets all dates that have a probability mass above 0.5 between 6000 and 6300 BP
x3 = which.CalDates(x,BP&gt;6000&amp;BP&lt;6300,p=0.5)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
