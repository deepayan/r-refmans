<!DOCTYPE html><html><head><title>Help for package TapeR</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {TapeR}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#BSplines'><p>builds B-Splines Matrix with appropriate knots for taper fitting</p></a></li>
<li><a href='#CdN_DHxHt.f'><p>percentile for estimated taper curve diameter</p></a></li>
<li><a href='#dN.f'><p>evaluate Normal distribution</p></a></li>
<li><a href='#DxHx.df'>

<p>Example dataset of 10 trees with 10 diameter and height measurements</p>
for each tree.</a></li>
<li><a href='#E_DHx_HmDm_HT_CIdHt.f'><p>Estimate diameter and exact confidence and prediction intervals</p></a></li>
<li><a href='#E_DHx_HmDm_HT.f'><p>Estimate diameter and approximate confidence and prediction intervals</p></a></li>
<li><a href='#E_HDx_HmDm_HT.f'><p>Estimate height of given diameter</p></a></li>
<li><a href='#E_VOL_AB_HmDm_HT.f'><p>Estimate volume for stem and sections</p></a></li>
<li><a href='#EYx_ssp.f'><p>estimate cubic smoothing spline with linear extrapolation</p></a></li>
<li><a href='#HT.par'>

<p>Height tariff parameters for estimating tree heights of unmeasured</p>
trees in the BWI3.</a></li>
<li><a href='#Hx_root.f'><p>find root (height) given diameter, measurements and fitted model</p></a></li>
<li><a href='#Int_CdN_DHx_dHt.f'><p>Int_CdN_DHx_dHt.f</p></a></li>
<li><a href='#Int_E_VOL_AB_HmDm_HT_dHt.f'><p>Int_E_VOL_AB_HmDm_HT_dHt.f</p></a></li>
<li><a href='#qD.rout.f'><p>qD.rout.f</p></a></li>
<li><a href='#resVar'><p>Functions to put different size of uncertainty on given measurements</p></a></li>
<li><a href='#SK_EBLUP_LME.f'><p>Evaluate fitted taper curve</p></a></li>
<li><a href='#SK_VOLab_EBLUP_LME.f'><p>taper volume estimation</p></a></li>
<li><a href='#SK.par.lme'>

<p>Taper model parameters for spruce in Germany based on BWI3 data.</p></a></li>
<li><a href='#TapeR_FIT_LME.f'><p>Fits a taper curve model to the specified diameter-height data</p></a></li>
<li><a href='#TapeR-package'>
<p>Flexible tree taper curves based on Semiparametric Mixed Models.</p></a></li>
<li><a href='#TransKnots'><p>transform knot vector</p></a></li>
<li><a href='#updateKOV'><p>update variance-covariance matrix</p></a></li>
<li><a href='#xy0_root.f'><p>xy0_root.f</p></a></li>
<li><a href='#xy0_SK_EBLUP_LME.f'><p>find relative height of given diameter</p></a></li>
<li><a href='#XZ_BSPLINE.f'><p>construct B-Splines design matrices</p></a></li>
<li><a href='#y2x_isp.f'><p>squared diameter using interpolating splines</p></a></li>
<li><a href='#y2x_ssp.f'><p>squared diameter using smoothing splines</p></a></li>
<li><a href='#yx_isp.f'><p>diameter using interpolating splines</p></a></li>
<li><a href='#yx_ssp.f'><p>diameter using smoothing splines</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Flexible Tree Taper Curves Based on Semiparametric Mixed Models</td>
</tr>
<tr>
<td>Version:</td>
<td>0.5.3</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-08-09</td>
</tr>
<tr>
<td>Description:</td>
<td>Implementation of functions for fitting taper curves (a semiparametric 
  linear mixed effects taper model) to diameter measurements along stems. Further 
  functions are provided to estimate the uncertainty around the predicted curves, 
  to calculate timber volume (also by sections) and marginal (e.g., upper) diameters. 
  For cases where tree heights are not measured, methods for estimating
  additional variance in volume predictions resulting from uncertainties in
  tree height models (tariffs) are provided.  The example data include the taper 
  curve parameters for Norway spruce used in the 3rd German NFI fitted to 380 trees 
  and a subset of section-wise diameter measurements of these trees. The functions 
  implemented here are detailed in Kublin, E., Breidenbach, J., Kaendler, G. (2013)
  &lt;<a href="https://doi.org/10.1007%2Fs10342-013-0715-0">doi:10.1007/s10342-013-0715-0</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>Depends:</td>
<td>nlme, splines, pracma</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-08-09 14:03:49 UTC; Christian.Vonderach</td>
</tr>
<tr>
<td>Author:</td>
<td>Edgar Kublin [aut],
  Johannes Breidenbach [ctb],
  Christian Vonderach [ctb, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Christian Vonderach &lt;christian.vonderach@forst.bwl.de&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-08-16 07:22:33 UTC</td>
</tr>
</table>
<hr>
<h2 id='BSplines'>builds B-Splines Matrix with appropriate knots for taper fitting</h2><span id='topic+BSplines'></span>

<h3>Description</h3>

<p>Internal function not usually called by users
</p>


<h3>Usage</h3>

<pre><code class='language-R'>BSplines(knots = c(seq(0, 1, 0.1)), ord = 4, der = 0, x = c(seq(0, 1, 0.01)), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="BSplines_+3A_knots">knots</code></td>
<td>
<p>knot positions for spline function</p>
</td></tr>
<tr><td><code id="BSplines_+3A_ord">ord</code></td>
<td>
<p>order of the spline function</p>
</td></tr>
<tr><td><code id="BSplines_+3A_der">der</code></td>
<td>
<p>derivatives</p>
</td></tr>
<tr><td><code id="BSplines_+3A_x">x</code></td>
<td>
<p>height measurements</p>
</td></tr>
<tr><td><code id="BSplines_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Details</h3>

<p>internally <code><a href="splines.html#topic+splineDesign">splineDesign</a></code> is called
</p>


<h3>Value</h3>

<p>B-Splines matrix build using <code><a href="splines.html#topic+splineDesign">splineDesign</a></code>
</p>


<h3>Author(s)</h3>

<p>Edgar Kublin
</p>

<hr>
<h2 id='CdN_DHxHt.f'>percentile for estimated taper curve diameter</h2><span id='topic+CdN_DHxHt.f'></span>

<h3>Description</h3>

<p>Internal function not usually called by users
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CdN_DHxHt.f(Ht, Hx, qD, Hm, Dm, par.lme, Rfn, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CdN_DHxHt.f_+3A_ht">Ht</code></td>
<td>
<p>tree height</p>
</td></tr>
<tr><td><code id="CdN_DHxHt.f_+3A_hx">Hx</code></td>
<td>
<p>Numeric vector of stem heights (m) along which to return the expected diameter.</p>
</td></tr>
<tr><td><code id="CdN_DHxHt.f_+3A_qd">qD</code></td>
<td>
<p>vector of quantiles, passed to <code>pnorm</code></p>
</td></tr>
<tr><td><code id="CdN_DHxHt.f_+3A_hm">Hm</code></td>
<td>
<p>measured height of respective diameters <code>Dm</code></p>
</td></tr>
<tr><td><code id="CdN_DHxHt.f_+3A_dm">Dm</code></td>
<td>
<p>measured diameter</p>
</td></tr>
<tr><td><code id="CdN_DHxHt.f_+3A_par.lme">par.lme</code></td>
<td>
<p>List of taper model parameters obtained by <code><a href="#topic+TapeR_FIT_LME.f">TapeR_FIT_LME.f</a></code>.</p>
</td></tr>
<tr><td><code id="CdN_DHxHt.f_+3A_rfn">Rfn</code></td>
<td>
<p>list with function name to provide estimated or assumed residual 
variances for the given measurements, optionally parameters for such functions</p>
</td></tr>
<tr><td><code id="CdN_DHxHt.f_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>percentile for estimated taper curve diameter at position <code>Hx</code>
given <code>Ht</code>, <code>Hm</code> and <code>Dm</code>
</p>


<h3>Author(s)</h3>

<p>Edgar Kublin
</p>

<hr>
<h2 id='dN.f'>evaluate Normal distribution</h2><span id='topic+dN.f'></span>

<h3>Description</h3>

<p>Internal function not usually called by users
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dN.f(x, mw, sd, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dN.f_+3A_x">x</code></td>
<td>
<p>vector of quantiles</p>
</td></tr>
<tr><td><code id="dN.f_+3A_mw">mw</code></td>
<td>
<p>vector of means</p>
</td></tr>
<tr><td><code id="dN.f_+3A_sd">sd</code></td>
<td>
<p>vector of standard deviations</p>
</td></tr>
<tr><td><code id="dN.f_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>numeric density of normal distribution
</p>


<h3>Author(s)</h3>

<p>Edgar Kublin
</p>

<hr>
<h2 id='DxHx.df'>

Example dataset of 10 trees with 10 diameter and height measurements
for each tree.
</h2><span id='topic+DxHx.df'></span>

<h3>Description</h3>


<p>Example dataset of 10 trees with 10 diameter and height measurements
for each tree.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(DxHx.df)</code></pre>


<h3>Format</h3>

<p>A data frame with 172 observations on the following 4 variables.
</p>

<dl>
<dt><code>Id</code></dt><dd><p>Numeric vector of tree IDs.</p>
</dd>
<dt><code>Dx</code></dt><dd><p>Numeric vector of diameter measurements.</p>
</dd>
<dt><code>Hx</code></dt><dd><p>Numeric vector of height measurements.</p>
</dd>
<dt><code>Ht</code></dt><dd><p>Numeric vector of tree height (repeated for each
measurement in each tree).</p>
</dd>
</dl>



<h3>Details</h3>


<p>Measured for BWI3.
</p>


<h3>References</h3>

<p>Kublin, E., Breidenbach, J., Kaendler, G. (2013) A flexible stem taper
and volume prediction method based on mixed-effects B-spline
regression, Eur J For Res, 132:983-997.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(DxHx.df)
head(DxHx.df)
</code></pre>

<hr>
<h2 id='E_DHx_HmDm_HT_CIdHt.f'>Estimate diameter and exact confidence and prediction intervals</h2><span id='topic+E_DHx_HmDm_HT_CIdHt.f'></span>

<h3>Description</h3>

<p>Calibrates a taper curve based on at least one diameter
measurement and returns the expected diameters and exact variances
</p>


<h3>Usage</h3>

<pre><code class='language-R'>E_DHx_HmDm_HT_CIdHt.f(
  Hx,
  Hm,
  Dm,
  mHt,
  sHt,
  par.lme,
  Rfn = list(fn = "sig2"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="E_DHx_HmDm_HT_CIdHt.f_+3A_hx">Hx</code></td>
<td>
<p>Numeric vector of stem heights (m) along which to return the
expected diameter.</p>
</td></tr>
<tr><td><code id="E_DHx_HmDm_HT_CIdHt.f_+3A_hm">Hm</code></td>
<td>
<p>Numeric vector of stem heights (m) along which diameter
measurements were taken for calibration. Can be of length 1. Must be of same
length as <code>Dm</code>.</p>
</td></tr>
<tr><td><code id="E_DHx_HmDm_HT_CIdHt.f_+3A_dm">Dm</code></td>
<td>
<p>Numeric vector of diameter measurements (cm) taken for calibration.
Can be of length 1. Must be of same length as <code>Hm</code>.</p>
</td></tr>
<tr><td><code id="E_DHx_HmDm_HT_CIdHt.f_+3A_mht">mHt</code></td>
<td>
<p>Scalar. Tree height (m).</p>
</td></tr>
<tr><td><code id="E_DHx_HmDm_HT_CIdHt.f_+3A_sht">sHt</code></td>
<td>
<p>Scalar. Standard deviation of stem height. Can be 0 if height was
measured without error.</p>
</td></tr>
<tr><td><code id="E_DHx_HmDm_HT_CIdHt.f_+3A_par.lme">par.lme</code></td>
<td>
<p>List of taper model parameters obtained by
<code><a href="#topic+TapeR_FIT_LME.f">TapeR_FIT_LME.f</a></code>.</p>
</td></tr>
<tr><td><code id="E_DHx_HmDm_HT_CIdHt.f_+3A_rfn">Rfn</code></td>
<td>
<p>list with function name to provide estimated or assumed residual
variances for the given measurements, optionally parameters for such functions</p>
</td></tr>
<tr><td><code id="E_DHx_HmDm_HT_CIdHt.f_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Details</h3>

<p>calibrates the tree specific taper curve and calculates 'exact'
confidence intervals, which can be useful for plotting.
Attention: this function is somewhat time-consuming.
</p>


<h3>Value</h3>

<p>a matrix with six columns:
</p>

<ul>
<li><p>Hx: Numeric vector of heights (m) along which to return the expected
diameter.
</p>
</li>
<li><p>q_DHx_u: Lower confidence interval (cm). (95% CI except for estimates
close to the stem tip.)
</p>
</li>
<li><p>DHx: Diameter estimate (cm).
</p>
</li>
<li><p>q_DHx_o: Upper CI (cm).
</p>
</li>
<li><p>cP_DHx_u: Probability of observations &lt;<code>q_DHx_u</code>.
</p>
</li>
<li><p>cP_DHx_o: Probability of observations &lt;<code>q_DHx_o</code>.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Edgar Kublin
</p>


<h3>References</h3>

<p>Kublin, E., Breidenbach, J., Kaendler, G. (2013) A flexible stem
taper and volume prediction method based on mixed-effects B-spline
regression, Eur J For Res, 132:983-997.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+TapeR_FIT_LME.f">TapeR_FIT_LME.f</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># example data
data(DxHx.df)
# taper curve parameters based on all measured trees
data(SK.par.lme)

#select data of first tree
Idi &lt;- (DxHx.df[,"Id"] == unique(DxHx.df$Id)[1])
(tree1 &lt;- DxHx.df[Idi,])

## Predict the taper curve based on the diameter measurement in 2 m
## height and known height
tc.tree1 &lt;- E_DHx_HmDm_HT.f(Hx=1:tree1$Ht[1],
                            Hm=tree1$Hx[3],
                            Dm=tree1$Dx[3],
                            mHt = tree1$Ht[1],
                            sHt = 0,
                            par.lme = SK.par.lme)
#plot the predicted taper curve
plot(tc.tree1$Hx, tc.tree1$DHx, type="l", las=1)
#lower CI
lines(tc.tree1$Hx, tc.tree1$CI_Mean[,1], lty=2)
#upper CI
lines(tc.tree1$Hx, tc.tree1$CI_Mean[,3], lty=2)
#lower prediction interval
lines(tc.tree1$Hx, tc.tree1$CI_Pred[,1], lty=3)
#upper prediction interval
lines(tc.tree1$Hx, tc.tree1$CI_Pred[,3], lty=3)
#add measured diameter used for calibration
points(tree1$Hx[3], tree1$Dx[3], pch=3, col=2)
#add the observations
points(tree1$Hx, tree1$Dx)

## Calculate "exact" CIs. Careful: This takes a while!
#library(pracma)# for numerical integration with gaussLegendre()

tc.tree1.exact &lt;- E_DHx_HmDm_HT_CIdHt.f(Hx=1:tree1$Ht[1],
                                        Hm=tree1$Hx[3],
                                        Dm=tree1$Dx[3],
                                        mHt=tree1$Ht[1],
                                        sHt=1,
                                        par.lme=SK.par.lme)
#add exact confidence intervals to approximate intervals above - fits
#quite well
lines(tc.tree1.exact[,1], tc.tree1.exact[,2], lty=2,col=2)
lines(tc.tree1.exact[,1], tc.tree1.exact[,4], lty=2,col=2)

</code></pre>

<hr>
<h2 id='E_DHx_HmDm_HT.f'>Estimate diameter and approximate confidence and prediction intervals</h2><span id='topic+E_DHx_HmDm_HT.f'></span>

<h3>Description</h3>

<p>Calibrates a taper curve based on at least one diameter 
measurement and returns the expected diameters and approximate variances
</p>


<h3>Usage</h3>

<pre><code class='language-R'>E_DHx_HmDm_HT.f(
  Hx,
  Hm,
  Dm,
  mHt,
  sHt = 0,
  par.lme,
  Rfn = list(fn = "sig2"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="E_DHx_HmDm_HT.f_+3A_hx">Hx</code></td>
<td>
<p>Numeric vector of stem heights (m) along which to return the 
expected diameter.</p>
</td></tr>
<tr><td><code id="E_DHx_HmDm_HT.f_+3A_hm">Hm</code></td>
<td>
<p>Numeric vector of stem heights (m) along which diameter 
measurements were taken for calibration. Can be of length 1. Must be of same 
length as <code>Dm</code>.</p>
</td></tr>
<tr><td><code id="E_DHx_HmDm_HT.f_+3A_dm">Dm</code></td>
<td>
<p>Numeric vector of diameter measurements (cm) taken for calibration.
Can be of length 1. Must be of same length as <code>Hm</code>.</p>
</td></tr>
<tr><td><code id="E_DHx_HmDm_HT.f_+3A_mht">mHt</code></td>
<td>
<p>Scalar. Tree height (m).</p>
</td></tr>
<tr><td><code id="E_DHx_HmDm_HT.f_+3A_sht">sHt</code></td>
<td>
<p>Scalar. Standard deviation of stem height. Can be 0 if height was 
measured without error.</p>
</td></tr>
<tr><td><code id="E_DHx_HmDm_HT.f_+3A_par.lme">par.lme</code></td>
<td>
<p>List of taper model parameters obtained by 
<code><a href="#topic+TapeR_FIT_LME.f">TapeR_FIT_LME.f</a></code>.</p>
</td></tr>
<tr><td><code id="E_DHx_HmDm_HT.f_+3A_rfn">Rfn</code></td>
<td>
<p>list with function name to provide estimated or assumed residual 
variances for the given measurements, optionally parameters for such functions</p>
</td></tr>
<tr><td><code id="E_DHx_HmDm_HT.f_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Details</h3>

<p>calibrates the tree specific taper curve and calculates approximate
confidence intervals, which can be useful for plotting. Uncertainty resulting
from tariff height estimates if tree height was not measured is incorporated.
Using <code>Rfn</code> the taper curve can be forced through the measured 
diameters, c.f. <code><a href="#topic+resVar">resVar</a></code>.
</p>


<h3>Value</h3>

<p>a list holding nine elements:
</p>

<ul>
<li><p>DHx: Numeric vector of diameters (cm) (expected value) along the 
heights given by <code>Hx</code>.
</p>
</li>
<li><p>Hx: Numeric vector of heights (m) along which to return the expected
diameter.
</p>
</li>
<li><p>MSE_Mean: Mean squared error for the expected value of the diameter.
</p>
</li>
<li><p>CI_Mean: Confidence interval. Matrix of the 95% conf. int. for the 
expected value of the diameter (cm). First column: lower limit, second 
column: mean, third column: upper limit.
</p>
</li>
<li><p>KOV_Mean: Variance-Covariance matrix for the expected value of the 
diameter.
</p>
</li>
<li><p>MSE_Pred: Mean squared error for the prediction of the diameter.
</p>
</li>
<li><p>CI_Pred: Prediction interval. Matrix of the 95% conf. int. for the 
prediction of the diameter (cm). First column: lower limit, second column: 
mean, third column: upper limit.
</p>
</li>
<li><p>KOV_Pred: Variance-Covariance matrix for the prediction of the 
diameter.
</p>
</li>
<li><p>Rfn: Function applied for estimated or assumed residual variance.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Edgar Kublin and Christian Vonderach
</p>


<h3>References</h3>

<p>Kublin, E., Breidenbach, J., Kaendler, G. (2013) A flexible stem 
taper and volume prediction method based on mixed-effects B-spline 
regression, Eur J For Res, 132:983-997.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+TapeR_FIT_LME.f">TapeR_FIT_LME.f</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># example data
data(DxHx.df)
# taper curve parameters based on all measured trees
data(SK.par.lme)

#select data of first tree
Idi &lt;- (DxHx.df[,"Id"] == unique(DxHx.df$Id)[1])
(tree1 &lt;- DxHx.df[Idi,])

## Predict the taper curve based on the diameter measurement in 2 m
## height and known height 
tc.tree1 &lt;- E_DHx_HmDm_HT.f(Hx=1:tree1$Ht[1], 
                            Hm=tree1$Hx[3],
                            Dm=tree1$Dx[3], 
                            mHt = tree1$Ht[1], 
                            sHt = 0, 
                            par.lme = SK.par.lme)
#plot the predicted taper curve
plot(tc.tree1$Hx, tc.tree1$DHx, type="l", las=1)
#lower CI
lines(tc.tree1$Hx, tc.tree1$CI_Mean[,1], lty=2)
#upper CI
lines(tc.tree1$Hx, tc.tree1$CI_Mean[,3], lty=2)
#lower prediction interval
lines(tc.tree1$Hx, tc.tree1$CI_Pred[,1], lty=3)
#upper prediction interval
lines(tc.tree1$Hx, tc.tree1$CI_Pred[,3], lty=3)
#add measured diameter used for calibration
points(tree1$Hx[3], tree1$Dx[3], pch=3, col=2)
#add the observations
points(tree1$Hx, tree1$Dx)

## feature of forcing taper curve through measured diameters
i &lt;- c(3, 6)
tc.tree1 &lt;- E_DHx_HmDm_HT.f(Hx=seq(0, tree1$Ht[1], 0.1), 
                            Hm=tree1$Hx[i],
                            Dm=tree1$Dx[i], 
                            mHt = tree1$Ht[1], 
                            sHt = 0, 
                            par.lme = SK.par.lme,
                            Rfn=list(fn="sig2"))
tc.tree2 &lt;- E_DHx_HmDm_HT.f(Hx=seq(0, tree1$Ht[1], 0.1), 
                            Hm=tree1$Hx[i],
                            Dm=tree1$Dx[i], 
                            mHt = tree1$Ht[1], 
                            sHt = 0, 
                            par.lme = SK.par.lme,
                            Rfn=list(fn="zero"))
# plot the predicted taper curve
plot(tc.tree1$Hx, tc.tree1$DHx, type="l", las=1)
# added taper curve through measurement
points(x=tc.tree2$Hx, y=tc.tree2$DHx, type="l", lty=2)
# closer window
plot(tc.tree1$Hx, tc.tree1$DHx, type="l", las=1, xlim=c(0, 8), ylim=c(24, 30))
# added taper curve through measurement
points(x=tc.tree2$Hx, y=tc.tree2$DHx, type="l", lty=2)
# add measured diameter used for calibration
points(tree1$Hx[i], tree1$Dx[i], pch=3, col=2)
# add the observations
points(tree1$Hx, tree1$Dx)

## apply yet another residual variance function
i &lt;- c(1, 2, 3) # calibrating with 0.5, 1m and 2m, assuming no error in 0.5m
zrv &lt;- tree1$Hx[1] / tree1$Ht[1] # assumed zero resiudal variance
# assumed residual variance per measurement
TapeR:::resVar(relH = tree1$Hx[i] / tree1$Ht[1], fn = "dlnorm", 
               sig2 = SK.par.lme$sig2_eps, par = list(zrv=zrv))
tc.tree3 &lt;- E_DHx_HmDm_HT.f(Hx=seq(0, tree1$Ht[1], 0.1), 
                            Hm=tree1$Hx[i],
                            Dm=tree1$Dx[i], 
                            mHt = tree1$Ht[1], 
                            sHt = 0, 
                            par.lme = SK.par.lme,
                            Rfn=list(fn="dlnorm", par=list(zrv=zrv)))
plot(tc.tree1$Hx, tc.tree1$DHx, type="l", las=1, xlim=c(0, 4))
points(x=tc.tree3$Hx, y=tc.tree3$DHx, type="l", lty=2)
points(tree1$Hx[i], tree1$Dx[i], pch=3, col=2)
points(tree1$Hx, tree1$Dx)
</code></pre>

<hr>
<h2 id='E_HDx_HmDm_HT.f'>Estimate height of given diameter</h2><span id='topic+E_HDx_HmDm_HT.f'></span>

<h3>Description</h3>

<p>Calibrates a taper curve based on at least one diameter 
measurement and returns the height of a given diameter
</p>


<h3>Usage</h3>

<pre><code class='language-R'>E_HDx_HmDm_HT.f(
  Dx,
  Hm,
  Dm,
  mHt,
  sHt = 0,
  par.lme,
  Rfn = list(fn = "sig2"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="E_HDx_HmDm_HT.f_+3A_dx">Dx</code></td>
<td>
<p>Scalar. Diameter for which to return height.</p>
</td></tr>
<tr><td><code id="E_HDx_HmDm_HT.f_+3A_hm">Hm</code></td>
<td>
<p>Numeric vector of stem heights (m) along which diameter 
measurements were taken for calibration. Can be of length 1. Must be of same 
length as <code>Dm</code>.</p>
</td></tr>
<tr><td><code id="E_HDx_HmDm_HT.f_+3A_dm">Dm</code></td>
<td>
<p>Numeric vector of diameter measurements (cm) taken for calibration.
Can be of length 1. Must be of same length as <code>Hm</code>.</p>
</td></tr>
<tr><td><code id="E_HDx_HmDm_HT.f_+3A_mht">mHt</code></td>
<td>
<p>Scalar. Tree height (m).</p>
</td></tr>
<tr><td><code id="E_HDx_HmDm_HT.f_+3A_sht">sHt</code></td>
<td>
<p>Scalar. Standard deviation of stem height. Can be 0 if height was 
measured without error.</p>
</td></tr>
<tr><td><code id="E_HDx_HmDm_HT.f_+3A_par.lme">par.lme</code></td>
<td>
<p>List of taper model parameters obtained by 
<code><a href="#topic+TapeR_FIT_LME.f">TapeR_FIT_LME.f</a></code>.</p>
</td></tr>
<tr><td><code id="E_HDx_HmDm_HT.f_+3A_rfn">Rfn</code></td>
<td>
<p>list with function name to provide estimated or assumed residual 
variances for the given measurements, optionally parameters for such functions</p>
</td></tr>
<tr><td><code id="E_HDx_HmDm_HT.f_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Details</h3>

<p>returns the height given a certain diameter.
</p>


<h3>Value</h3>

<p>A scalar. Estimated height (m) given a diameter.
</p>


<h3>Author(s)</h3>

<p>Edgar Kublin
</p>


<h3>References</h3>

<p>Kublin, E., Breidenbach, J., Kaendler, G. (2013) A flexible stem 
taper and volume prediction method based on mixed-effects B-spline 
regression, Eur J For Res, 132:983-997.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+TapeR_FIT_LME.f">TapeR_FIT_LME.f</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># example data
data(DxHx.df)
# taper curve parameters based on all measured trees
data(SK.par.lme)

#select data of first tree
Idi &lt;- (DxHx.df[,"Id"] == unique(DxHx.df$Id)[1])
(tree1 &lt;- DxHx.df[Idi,])

## Predict the taper curve based on the diameter measurement in 2 m
## height and known height 
tc.tree1 &lt;- E_DHx_HmDm_HT.f(Hx=1:tree1$Ht[1], 
                            Hm=tree1$Hx[3],
                            Dm=tree1$Dx[3], 
                            mHt = tree1$Ht[1], 
                            sHt = 0, 
                            par.lme = SK.par.lme)
#plot the predicted taper curve
plot(tc.tree1$Hx, tc.tree1$DHx, type="l", las=1)

## Calculate the height given a certain diameter threshold, say 8.5 cm
ht.tree1.d8.5 &lt;- E_HDx_HmDm_HT.f (Dx=8.5, 
                                  Hm=tree1$Hx[3],
                                  Dm=tree1$Dx[3], 
                                  mHt = tree1$Ht[1], 
                                  sHt = 1, 
                                  par.lme = SK.par.lme,
                                  Rfn=list(fn="sig2")) 
# add to plot
points(x=ht.tree1.d8.5, y=8.5, pch=8, col=2, cex=2)

</code></pre>

<hr>
<h2 id='E_VOL_AB_HmDm_HT.f'>Estimate volume for stem and sections</h2><span id='topic+E_VOL_AB_HmDm_HT.f'></span>

<h3>Description</h3>

<p>Estimate volume for a complete stem from bottom to tip or 
for a section defined by lower and upper diameter or height. Variances for
estimated volumes are calculated.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>E_VOL_AB_HmDm_HT.f(
  Hm,
  Dm,
  mHt,
  sHt = 0,
  A = NULL,
  B = NULL,
  iDH = "D",
  par.lme,
  Rfn = list(fn = "sig2"),
  IA = F,
  nGL = 51,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="E_VOL_AB_HmDm_HT.f_+3A_hm">Hm</code></td>
<td>
<p>Numeric vector of stem heights (m) along which diameter 
measurements were taken for calibration. Can be of length 1. Must be of same 
length as <code>Dm</code>.</p>
</td></tr>
<tr><td><code id="E_VOL_AB_HmDm_HT.f_+3A_dm">Dm</code></td>
<td>
<p>Numeric vector of diameter measurements (cm) taken for calibration.
Can be of length 1. Must be of same length as <code>Hm</code>.</p>
</td></tr>
<tr><td><code id="E_VOL_AB_HmDm_HT.f_+3A_mht">mHt</code></td>
<td>
<p>Scalar. Tree height (m).</p>
</td></tr>
<tr><td><code id="E_VOL_AB_HmDm_HT.f_+3A_sht">sHt</code></td>
<td>
<p>Scalar. Standard deviation of stem height. Can be 0 if height was 
measured without error.</p>
</td></tr>
<tr><td><code id="E_VOL_AB_HmDm_HT.f_+3A_a">A</code></td>
<td>
<p>Numeric scalar defining the lower threshold of a stem section for 
volume estimation. Depends on <code>iDH</code>. If <code>iDH</code> = &quot;D&quot;, a diameter 
(cm), if <code>iDH</code> = &quot;H&quot;, a height (m). If NULL, section starts at lowest 
point.</p>
</td></tr>
<tr><td><code id="E_VOL_AB_HmDm_HT.f_+3A_b">B</code></td>
<td>
<p>Numeric scalar defining the upper threshold of a stem section for 
volume estimation. Depends on <code>iDH</code>. If <code>iDH</code> = &quot;D&quot;, a diameter
(cm), if <code>iDH</code> = &quot;H&quot;, a height (m). If NULL, section ends at tip.</p>
</td></tr>
<tr><td><code id="E_VOL_AB_HmDm_HT.f_+3A_idh">iDH</code></td>
<td>
<p>Character scalar. Either &quot;D&quot; or &quot;H&quot;. Type of threshold for section
volume estimation. See <code>A</code> or <code>B</code>.</p>
</td></tr>
<tr><td><code id="E_VOL_AB_HmDm_HT.f_+3A_par.lme">par.lme</code></td>
<td>
<p>List of taper model parameters obtained by 
<code><a href="#topic+TapeR_FIT_LME.f">TapeR_FIT_LME.f</a></code>.</p>
</td></tr>
<tr><td><code id="E_VOL_AB_HmDm_HT.f_+3A_rfn">Rfn</code></td>
<td>
<p>list with function name to provide estimated or assumed residual 
variances for the given measurements, optionally parameters for such functions</p>
</td></tr>
<tr><td><code id="E_VOL_AB_HmDm_HT.f_+3A_ia">IA</code></td>
<td>
<p>Logic scalar. If TRUE, variance calculation of height estimate 
based on 2-point distribution. If FALSE, variance calculation of height
estimate based on Normal approximation.</p>
</td></tr>
<tr><td><code id="E_VOL_AB_HmDm_HT.f_+3A_ngl">nGL</code></td>
<td>
<p>Numeric scalar. Number of support points for numerical
integration.</p>
</td></tr>
<tr><td><code id="E_VOL_AB_HmDm_HT.f_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Details</h3>

<p>calculates the volume for a complete stem or sections defined by
<code>A</code> and <code>B</code>, which might be defined as diameter or height. The
parameter <code>Rfn</code> can be used to force the taper curve through the
measured points (e.g. by <code>Rfn=list(fn="zero")</code>, cf. <code><a href="#topic+resVar">resVar</a></code>).
</p>


<h3>Value</h3>

<p>a list holding nine elements:
</p>

<ul>
<li><p>E_VOL: Estimated volume (m^3).
</p>
</li>
<li><p>VAR_VOL: Variance of the volume estimate.
</p>
</li>
<li><p>Hm: Height of diameter measurement (m).
</p>
</li>
<li><p>Dm: Diameter measurement (cm).
</p>
</li>
<li><p>Ht: Tree height (m).
</p>
</li>
<li><p>Da: Diameter at lower section threshold (cm).
</p>
</li>
<li><p>Db: Diameter at upper section threshold (cm).
</p>
</li>
<li><p>Ha: Height at lower section threshold (m).
</p>
</li>
<li><p>Hb: Height at upper section threshold (m).
</p>
</li>
<li><p>Rfn: Function applied for estimated or assumed residual variance.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Edgar Kublin
</p>


<h3>References</h3>

<p>Kublin, E., Breidenbach, J., Kaendler, G. (2013) A flexible stem 
taper and volume prediction method based on mixed-effects B-spline 
regression, Eur J For Res, 132:983-997.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+TapeR_FIT_LME.f">TapeR_FIT_LME.f</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># example data
data(DxHx.df)
# taper curve parameters based on all measured trees
data(SK.par.lme)

#select data of first tree
Idi &lt;- (DxHx.df[,"Id"] == unique(DxHx.df$Id)[1])
(tree1 &lt;- DxHx.df[Idi,])

## Calculate the timber volume for the whole stem
VOL &lt;- E_VOL_AB_HmDm_HT.f(Hm=tree1$Hx[3], 
                          Dm=tree1$Dx[3], 
                          mHt = tree1$Ht[1],
                          sHt = 0, # no height variance assumed
                          par.lme = SK.par.lme)
VOL$E_VOL #' expected value
VOL$VAR_VOL #' corresponding variance
VOL$Rfn

## Calculate the timber volume for the whole stem, using Rfn="zero"
VOL &lt;- E_VOL_AB_HmDm_HT.f(Hm=tree1$Hx[3], 
                          Dm=tree1$Dx[3], 
                          mHt = tree1$Ht[1],
                          sHt = 0, # no height variance assumed
                          par.lme = SK.par.lme,
                          Rfn = list(fn="zero"))
VOL$E_VOL #' expected value
VOL$VAR_VOL #' corresponding variance
VOL$Rfn

## Calculate the timber volume for the whole stem
VOL &lt;- E_VOL_AB_HmDm_HT.f(Hm=tree1$Hx[3], 
                          Dm=tree1$Dx[3], 
                          mHt = tree1$Ht[1],
                          sHt = 1, # no height variance assumed
                          par.lme = SK.par.lme)
VOL$E_VOL #' expected value
VOL$VAR_VOL #' corresponding variance
VOL$Rfn

## Calculate the timber volume for the whole stem, using Rfn="zero"
VOL &lt;- E_VOL_AB_HmDm_HT.f(Hm=tree1$Hx[3], 
                          Dm=tree1$Dx[3], 
                          mHt = tree1$Ht[1],
                          sHt = 1, #  height variance assumed
                          par.lme = SK.par.lme,
                          Rfn = list(fn="zero"))
VOL$E_VOL #' expected value
VOL$VAR_VOL #' corresponding variance
VOL$Rfn

## Calculate the timber volume for a selected section given a height (0.3 - 5 m)
VOL &lt;- E_VOL_AB_HmDm_HT.f(Hm=tree1$Hx[3], 
                          Dm=tree1$Dx[3], 
                          mHt = tree1$Ht[1], 
                          sHt = 1, 
                          par.lme = SK.par.lme, 
                          A=0.3, 
                          B=5, 
                          iDH = "H")
VOL$E_VOL #' expected value
VOL$VAR_VOL #' corresponding variance
VOL$Rfn

## Calculate the timber volume for a selected section given a height (0.3 - 5 m)
VOL &lt;- E_VOL_AB_HmDm_HT.f(Hm=tree1$Hx[3], 
                          Dm=tree1$Dx[3], 
                          mHt = tree1$Ht[1], 
                          sHt = 1, 
                          par.lme = SK.par.lme, 
                          A=0.3, 
                          B=5, 
                          iDH = "H", 
                          Rfn=list(fn="zero"))
VOL$E_VOL #' expected value
VOL$VAR_VOL #' corresponding variance
VOL$Rfn

## Calculate the timber volume for a selected section given a diameter
## threshold (30cm - 15cm) (negative value if A&lt;B)
VOL &lt;- E_VOL_AB_HmDm_HT.f(Hm=tree1$Hx[3],
                          Dm=tree1$Dx[3], 
                          mHt = tree1$Ht[1], 
                          sHt = 1, 
                          par.lme = SK.par.lme, 
                          A=30, 
                          B=15, 
                          iDH = "D")
VOL$E_VOL #' expected value
VOL$VAR_VOL #' corresponding variance

## Not run: 

## The variance estimate resulting from the tree height uncertainty using
## a Normal approximation takes much longer...
ptm &lt;- proc.time()
E_VOL_AB_HmDm_HT.f(Hm=tree1$Hx[3], Dm=tree1$Dx[3], mHt = tree1$Ht[1], 
                   sHt = 1, par.lme = SK.par.lme, IA=FALSE)
proc.time() - ptm


##... than the calculation using a 2-point distribution...
ptm &lt;- proc.time()
E_VOL_AB_HmDm_HT.f(Hm=tree1$Hx[3], Dm=tree1$Dx[3], mHt = tree1$Ht[1],
                   sHt = 1, par.lme = SK.par.lme, IA=TRUE)
proc.time() - ptm

##...fastest if no height variance is assumed
ptm &lt;- proc.time()
E_VOL_AB_HmDm_HT.f(Hm=tree1$Hx[3], Dm=tree1$Dx[3], mHt = tree1$Ht[1],
                   sHt = 0, par.lme = SK.par.lme, IA=FALSE)
proc.time() - ptm

## Also the number of supportive points for the numerical integration
## influences the calculation time
ptm &lt;- proc.time()
E_VOL_AB_HmDm_HT.f(Hm=tree1$Hx[3], Dm=tree1$Dx[3], mHt = tree1$Ht[1],
                   sHt = 0, par.lme = SK.par.lme, IA=FALSE, nGL=10)
proc.time() - ptm
##' End(Not run)

</code></pre>

<hr>
<h2 id='EYx_ssp.f'>estimate cubic smoothing spline with linear extrapolation</h2><span id='topic+EYx_ssp.f'></span>

<h3>Description</h3>

<p>Internal function not usually called by users
</p>


<h3>Usage</h3>

<pre><code class='language-R'>EYx_ssp.f(knt, coe, x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="EYx_ssp.f_+3A_knt">knt</code></td>
<td>
<p>knots position of B-Splines</p>
</td></tr>
<tr><td><code id="EYx_ssp.f_+3A_coe">coe</code></td>
<td>
<p>estimated coefficient for B-Splines</p>
</td></tr>
<tr><td><code id="EYx_ssp.f_+3A_x">x</code></td>
<td>
<p>position at which to evaluate B-Splines model</p>
</td></tr>
<tr><td><code id="EYx_ssp.f_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>expected diameter given knots and coefficients at position (height)
<code>x</code>.
</p>


<h3>Author(s)</h3>

<p>Edgar Kublin
</p>

<hr>
<h2 id='HT.par'>

Height tariff parameters for estimating tree heights of unmeasured
trees in the BWI3.
</h2><span id='topic+HT.par'></span>

<h3>Description</h3>


<p>Height is only measured on a subset of the trees on a sample
plots. This Height tariff is used to estimate the height of the trees
with only a dbh measurement.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(HT.par)</code></pre>


<h3>Format</h3>

<p>The format is:
List of 4
$ knt.mw: num [1:16] 0 0 0 0 19.6 ...
$ coe.mw: num [1:12] 1.3 7.28 15.1 21.75 24.39 ...
$ knt.sd: num [1:53] 0 0 0 0 7.52 ...
$ coe.sd: num [1:49] 0 0.618 1.376 2.142 2.486 ...
</p>


<h3>References</h3>


<p>Kublin, E., Breidenbach, J., Kaendler, G. (2013) A flexible stem taper
and volume prediction method based on mixed-effects B-spline
regression, Eur J For Res, 132:983-997.  
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(HT.par)
## maybe str(HT.par) ; plot(HT.par) ...
</code></pre>

<hr>
<h2 id='Hx_root.f'>find root (height) given diameter, measurements and fitted model</h2><span id='topic+Hx_root.f'></span>

<h3>Description</h3>

<p>Internal function not usually called by users
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Hx_root.f(Hx, Dx, Hm, Dm, mHt, sHt, par.lme, Rfn, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Hx_root.f_+3A_hx">Hx</code></td>
<td>
<p>Numeric vector of stem heights (m) along which to return the 
expected diameter</p>
</td></tr>
<tr><td><code id="Hx_root.f_+3A_dx">Dx</code></td>
<td>
<p>expected diameter</p>
</td></tr>
<tr><td><code id="Hx_root.f_+3A_hm">Hm</code></td>
<td>
<p>Numeric vector of stem heights (m) along which diameter measurements 
were taken for calibration. Can be of length 1. Must be of same length as <code>Dm</code></p>
</td></tr>
<tr><td><code id="Hx_root.f_+3A_dm">Dm</code></td>
<td>
<p>Numeric vector of diameter measurements (cm) taken for calibration.
Can be of length 1. Must be of same length as <code>Hm</code></p>
</td></tr>
<tr><td><code id="Hx_root.f_+3A_mht">mHt</code></td>
<td>
<p>Scalar. Tree height (m)</p>
</td></tr>
<tr><td><code id="Hx_root.f_+3A_sht">sHt</code></td>
<td>
<p>Scalar. Standard deviation of stem height. Can be 0 if height was 
measured without error</p>
</td></tr>
<tr><td><code id="Hx_root.f_+3A_par.lme">par.lme</code></td>
<td>
<p>List of taper model parameters obtained by 
<code><a href="#topic+TapeR_FIT_LME.f">TapeR_FIT_LME.f</a></code>.</p>
</td></tr>
<tr><td><code id="Hx_root.f_+3A_rfn">Rfn</code></td>
<td>
<p>list with function name to provide estimated or assumed residual 
variances for the given measurements, optionally parameters for such functions</p>
</td></tr>
<tr><td><code id="Hx_root.f_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Details</h3>

<p>function is called by <code><a href="stats.html#topic+uniroot">uniroot</a></code> inside 
<code><a href="#topic+E_HDx_HmDm_HT.f">E_HDx_HmDm_HT.f</a></code>
</p>


<h3>Value</h3>

<p>deviation between observed diameter <code>Dx</code> and diameter in height
<code>Hx</code>.
</p>


<h3>Author(s)</h3>

<p>Edgar Kublin
</p>

<hr>
<h2 id='Int_CdN_DHx_dHt.f'>Int_CdN_DHx_dHt.f</h2><span id='topic+Int_CdN_DHx_dHt.f'></span>

<h3>Description</h3>

<p>Internal function not usually called by users
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Int_CdN_DHx_dHt.f(qD, Hx, Hm, Dm, mHt, sHt, par.lme, Rfn, nGL = 51, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Int_CdN_DHx_dHt.f_+3A_qd">qD</code></td>
<td>
<p>vector of quantiles, finally passed to <code>pnorm</code></p>
</td></tr>
<tr><td><code id="Int_CdN_DHx_dHt.f_+3A_hx">Hx</code></td>
<td>
<p>Numeric vector of stem heights (m) along which to return the 
expected diameter</p>
</td></tr>
<tr><td><code id="Int_CdN_DHx_dHt.f_+3A_hm">Hm</code></td>
<td>
<p>Numeric vector of stem heights (m) along which diameter measurements 
were taken for calibration. Can be of length 1. Must be of same length as <code>Dm</code></p>
</td></tr>
<tr><td><code id="Int_CdN_DHx_dHt.f_+3A_dm">Dm</code></td>
<td>
<p>Numeric vector of diameter measurements (cm) taken for calibration.
Can be of length 1. Must be of same length as <code>Hm</code></p>
</td></tr>
<tr><td><code id="Int_CdN_DHx_dHt.f_+3A_mht">mHt</code></td>
<td>
<p>Scalar. Tree height (m)</p>
</td></tr>
<tr><td><code id="Int_CdN_DHx_dHt.f_+3A_sht">sHt</code></td>
<td>
<p>Scalar. Standard deviation of stem height. Can be 0 if height was 
measured without error</p>
</td></tr>
<tr><td><code id="Int_CdN_DHx_dHt.f_+3A_par.lme">par.lme</code></td>
<td>
<p>List of taper model parameters obtained by <code><a href="#topic+TapeR_FIT_LME.f">TapeR_FIT_LME.f</a></code></p>
</td></tr>
<tr><td><code id="Int_CdN_DHx_dHt.f_+3A_rfn">Rfn</code></td>
<td>
<p>list with function name to provide estimated or assumed residual 
variances for the given measurements, optionally parameters for such functions</p>
</td></tr>
<tr><td><code id="Int_CdN_DHx_dHt.f_+3A_ngl">nGL</code></td>
<td>
<p>Numeric scalar. Number of support points for numerical integration</p>
</td></tr>
<tr><td><code id="Int_CdN_DHx_dHt.f_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Int_CdN_dN
</p>


<h3>Author(s)</h3>

<p>Edgar Kublin
</p>

<hr>
<h2 id='Int_E_VOL_AB_HmDm_HT_dHt.f'>Int_E_VOL_AB_HmDm_HT_dHt.f</h2><span id='topic+Int_E_VOL_AB_HmDm_HT_dHt.f'></span>

<h3>Description</h3>

<p>Internal function not usually called by users
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Int_E_VOL_AB_HmDm_HT_dHt.f(
  Hm,
  Dm,
  A = NULL,
  B = NULL,
  iDH = "D",
  mw_HtT,
  sd_HtT,
  par.lme,
  Rfn = list(fn = "sig2"),
  IA = FALSE,
  nGL = 51,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Int_E_VOL_AB_HmDm_HT_dHt.f_+3A_hm">Hm</code></td>
<td>
<p>Numeric vector of stem heights (m) along which diameter measurements 
were taken for calibration. Can be of length 1. Must be of same length as <code>Dm</code></p>
</td></tr>
<tr><td><code id="Int_E_VOL_AB_HmDm_HT_dHt.f_+3A_dm">Dm</code></td>
<td>
<p>Numeric vector of diameter measurements (cm) taken for calibration.
Can be of length 1. Must be of same length as <code>Hm</code></p>
</td></tr>
<tr><td><code id="Int_E_VOL_AB_HmDm_HT_dHt.f_+3A_a">A</code></td>
<td>
<p>Numeric scalar defining the lower threshold of a stem section for volume
estimation. Depends on <code>iDH</code>. If <code>iDH</code> = &quot;D&quot;, a diameter
(cm), if <code>iDH</code> = &quot;H&quot;, a height (m). If NULL, section starts at lowest point.</p>
</td></tr>
<tr><td><code id="Int_E_VOL_AB_HmDm_HT_dHt.f_+3A_b">B</code></td>
<td>
<p>Numeric scalar defining the upper threshold of a stem section for volume
estimation. Depends on <code>iDH</code>. If <code>iDH</code> = &quot;D&quot;, a diameter
(cm), if <code>iDH</code> = &quot;H&quot;, a height (m). If NULL, section ends at tip.</p>
</td></tr>
<tr><td><code id="Int_E_VOL_AB_HmDm_HT_dHt.f_+3A_idh">iDH</code></td>
<td>
<p>Character scalar. Either &quot;D&quot; or &quot;H&quot;. Type of threshold for
section volume estimation. See <code>A</code> or <code>B</code>.</p>
</td></tr>
<tr><td><code id="Int_E_VOL_AB_HmDm_HT_dHt.f_+3A_mw_htt">mw_HtT</code></td>
<td>
<p>Scalar. Tree height (m)</p>
</td></tr>
<tr><td><code id="Int_E_VOL_AB_HmDm_HT_dHt.f_+3A_sd_htt">sd_HtT</code></td>
<td>
<p>Scalar. Standard deviation of stem height. Can be 0 if height was 
measured without error</p>
</td></tr>
<tr><td><code id="Int_E_VOL_AB_HmDm_HT_dHt.f_+3A_par.lme">par.lme</code></td>
<td>
<p>List of taper model parameters obtained by <code><a href="#topic+TapeR_FIT_LME.f">TapeR_FIT_LME.f</a></code></p>
</td></tr>
<tr><td><code id="Int_E_VOL_AB_HmDm_HT_dHt.f_+3A_rfn">Rfn</code></td>
<td>
<p>list with function name to provide estimated or assumed residual 
variances for the given measurements, optionally parameters for such functions</p>
</td></tr>
<tr><td><code id="Int_E_VOL_AB_HmDm_HT_dHt.f_+3A_ia">IA</code></td>
<td>
<p>Logic scalar. If TRUE, variance calculation of height
estimate based on 2-point distribution. If FALSE, variance calculation of height
estimate based on Normal approximation.</p>
</td></tr>
<tr><td><code id="Int_E_VOL_AB_HmDm_HT_dHt.f_+3A_ngl">nGL</code></td>
<td>
<p>Numeric scalar. Number of support points for numerical integration.</p>
</td></tr>
<tr><td><code id="Int_E_VOL_AB_HmDm_HT_dHt.f_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Details</h3>

<p>integrating the taper curve considering uncertainty of height 
measurement
</p>


<h3>Value</h3>

<p>list with expected volume, variance of volume and squared expected value
incorporating the uncertainty of height measurement
</p>


<h3>Author(s)</h3>

<p>Edgar Kublin
</p>

<hr>
<h2 id='qD.rout.f'>qD.rout.f</h2><span id='topic+qD.rout.f'></span>

<h3>Description</h3>

<p>Internal function not usually called by users
</p>


<h3>Usage</h3>

<pre><code class='language-R'>qD.rout.f(qD, alpha = 0.975, Hx, Hm, Dm, mHt, sHt, par.lme, Rfn, nGL = 51, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="qD.rout.f_+3A_qd">qD</code></td>
<td>
<p>vector of quantiles, finally passed to <code>pnorm</code></p>
</td></tr>
<tr><td><code id="qD.rout.f_+3A_alpha">alpha</code></td>
<td>
<p>quantile for which root is sought</p>
</td></tr>
<tr><td><code id="qD.rout.f_+3A_hx">Hx</code></td>
<td>
<p>Numeric vector of stem heights (m) along which to return the 
expected diameter</p>
</td></tr>
<tr><td><code id="qD.rout.f_+3A_hm">Hm</code></td>
<td>
<p>Numeric vector of stem heights (m) along which diameter measurements 
were taken for calibration. Can be of length 1. Must be of same length as <code>Dm</code></p>
</td></tr>
<tr><td><code id="qD.rout.f_+3A_dm">Dm</code></td>
<td>
<p>Numeric vector of diameter measurements (cm) taken for calibration.
Can be of length 1. Must be of same length as <code>Hm</code></p>
</td></tr>
<tr><td><code id="qD.rout.f_+3A_mht">mHt</code></td>
<td>
<p>Scalar. Tree height (m)</p>
</td></tr>
<tr><td><code id="qD.rout.f_+3A_sht">sHt</code></td>
<td>
<p>Scalar. Standard deviation of stem height. Can be 0 if height was 
measured without error</p>
</td></tr>
<tr><td><code id="qD.rout.f_+3A_par.lme">par.lme</code></td>
<td>
<p>List of taper model parameters obtained by 
<code><a href="#topic+TapeR_FIT_LME.f">TapeR_FIT_LME.f</a></code>.</p>
</td></tr>
<tr><td><code id="qD.rout.f_+3A_rfn">Rfn</code></td>
<td>
<p>list with function name to provide estimated or assumed residual 
variances for the given measurements, optionally parameters for such functions</p>
</td></tr>
<tr><td><code id="qD.rout.f_+3A_ngl">nGL</code></td>
<td>
<p>Numeric scalar. Number of support points for numerical integration.</p>
</td></tr>
<tr><td><code id="qD.rout.f_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>qD</code> for given <code>alpha</code> with respect to <code>Int_CdN_DHx_dHt.f</code>
</p>


<h3>Author(s)</h3>

<p>Edgar Kublin
</p>

<hr>
<h2 id='resVar'>Functions to put different size of uncertainty on given measurements</h2><span id='topic+resVar'></span>

<h3>Description</h3>

<p>When estimating a tree specific taper curve based on given
measurements one can modify the assumed measurement uncertainty by these
functions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>resVar(relH, fn, sig2, par = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="resVar_+3A_relh">relH</code></td>
<td>
<p>relative tree height for which the assumed residual variance
should be calculated</p>
</td></tr>
<tr><td><code id="resVar_+3A_fn">fn</code></td>
<td>
<p>name of function to be applied as character string</p>
</td></tr>
<tr><td><code id="resVar_+3A_sig2">sig2</code></td>
<td>
<p>residual variance from fitted model, cf.
<code><a href="#topic+TapeR_FIT_LME.f">TapeR_FIT_LME.f</a></code></p>
</td></tr>
<tr><td><code id="resVar_+3A_par">par</code></td>
<td>
<p>either NULL or a list with parameters to the different functions.
See details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When estimating a tree specific taper curve based on given
measurements the residual variance of the model is taken into account to
estimate the tree specific random effects. Alternatively, it is possible to
make assumptions about the measurement error, eventually at specific
relative heights. With that, one can e.g. force the taper curve through the
given measurements. Standard behaviour not necessarily leads to passing the
measurements, if more than one is given.
</p>
<p>Different functions are available. <code>sig2</code> applies the model residual
variance and hence is the default behaviour.
<code>zero</code> means assuming no residual variance and forcing the taper curve
through the given measurements. Care has to be taken in this case because
forcing the taper curve through a lot of measurements might result in
implausible results.
<code>linear</code> interpolates between zero and the given residual variance along
the stem, i.e. from bottom to tree top.
<code>bilinear</code> puts zero variance not at zero but at a predefined location
(can be given via <code>par</code>). Below and above a linear interpolation is
done up to the given residual variance. If zero variance position is not
given, it is set at 5% of tree height (approximately height of dbh).
<code>laglinear</code> assumes zero variance up to a predefined location (defaults
to 5% of tree height) and interpolates upwards to the given residual
variance of the model.
<code>quadratic</code> function distributes residual variance according to a
quadratic function along the stem. It is build so that zero variance is put
at a predefined location (defaults to 5% of tree height) and model residual
variance (as a default) at tree top.
<code>dnorm</code> and <code>dlnorm</code> put residual variance in form of an inverse
normal or an inverse log-normal distribution along the stem with a
zero-minimum at a predefined location (defaults to 5% of tree height).
See examples for a visualisation.
</p>
<p>For all functions (except <code>zero</code> and <code>sig2</code>) the point of zero
residual variance is defined by <code>par$zrv</code> if given, otherwise set to 0.05.
For <code>dnorm</code> one can additionally provide the parameter <code>sd</code> to
determine standard deviation. By default it is set to <code>zrv/3</code>; in case
of <code>dlnorm</code> one can define <code>lsd</code> (sdlog, cf. <code><a href="stats.html#topic+dlnorm">dlnorm</a></code>),
which is by default set to <code>1-sqrt(zrv)</code>. It is up to the user to define
meaningful parameters and use the functions in appropriate context.
</p>


<h3>Value</h3>

<p>vector of assumed residual variance
</p>


<h3>Author(s)</h3>

<p>Christian Vonderach
</p>


<h3>Examples</h3>

<pre><code class='language-R'>curve(resVar(relH=x, fn = "sig2", 0.5))
curve(resVar(relH=x, fn = "zero", 0.5))
curve(resVar(relH=x, fn = "linear", 0.5))
curve(resVar(relH=x, fn = "bilinear", 0.5))
curve(resVar(relH=x, fn = "laglinear", 0.5))
curve(resVar(relH=x, fn = "quadratic", 0.5))
curve(resVar(relH=x, fn = "dnorm", 0.5))
curve(resVar(relH=x, fn = "dnorm", 0.5, par=list(zrv=0.2, sd=0.2/3)))
curve(resVar(relH=x, fn = "dlnorm", 0.5))
curve(resVar(relH=x, fn = "dlnorm", 0.5, par=list(zrv=0.2)))
invisible(sapply(seq(0.01, 0.99, length.out=20), function(a){
  curve(resVar(relH=x, fn = "dlnorm", 0.5, par=list(zrv=a, lsd=(1-sqrt(a)))),
  n=1000)
}))
</code></pre>

<hr>
<h2 id='SK_EBLUP_LME.f'>Evaluate fitted taper curve</h2><span id='topic+SK_EBLUP_LME.f'></span>

<h3>Description</h3>

<p>This is the actual function to estimate diameters according to
the fitted mixed B-splines model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SK_EBLUP_LME.f(xm, ym, xp, par.lme, Rfn = list(fn = "sig2"), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SK_EBLUP_LME.f_+3A_xm">xm</code></td>
<td>
<p>relative heights for which measurements are available</p>
</td></tr>
<tr><td><code id="SK_EBLUP_LME.f_+3A_ym">ym</code></td>
<td>
<p>corresponding diameter measurements in height <code>xm</code></p>
</td></tr>
<tr><td><code id="SK_EBLUP_LME.f_+3A_xp">xp</code></td>
<td>
<p>relative heights for which predictions are required</p>
</td></tr>
<tr><td><code id="SK_EBLUP_LME.f_+3A_par.lme">par.lme</code></td>
<td>
<p>Fitted model object, return of <code><a href="#topic+TapeR_FIT_LME.f">TapeR_FIT_LME.f</a></code></p>
</td></tr>
<tr><td><code id="SK_EBLUP_LME.f_+3A_rfn">Rfn</code></td>
<td>
<p>list with function name to provide estimated or assumed residual 
variances for the given measurements, optionally parameters for such functions</p>
</td></tr>
<tr><td><code id="SK_EBLUP_LME.f_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is the actual working horse for prediction using the
fitted taper model. Based on the model <code>par.lme</code> and the measured
diameters <code>ym</code> and corresponding (relative) heights <code>xm</code> of a 
specific tree (there might be just one measurement), the random
effect parameters and subsequently diameters are estimated. Depending on the
parameter <code>Rfn</code>, the calibrated taper curve is forced through the
given diameter <code>ym</code> (<code>Rfn = list(fn="zero")</code>), or calibrated using
the complete residual variance-covariance information 
(<code>Rfn = list(fn="sig2")</code>, the default). 
Further assumptions are possible, see also <code><a href="#topic+resVar">resVar</a></code> and
Kublin et al. (2013) p. 987 for more details.
</p>


<h3>Value</h3>

<p>a list holding nine elements:
</p>

<ul>
<li><p> b_fix fixed effects parameter of taper model
</p>
</li>
<li><p> b_rnd random effects parameter given tree (posterior mean b_k)
</p>
</li>
<li><p> yp estimated diameter in height <code>xp</code>
</p>
</li>
<li><p> KOV_Mean variance-covariance matrix of expected value
</p>
</li>
<li><p> KOV_Pred variance-covariance matrix of prediction
</p>
</li>
<li><p> CI_Mean mean and limits of confidence interval
</p>
</li>
<li><p> MSE_Mean mean squared error of expected value
</p>
</li>
<li><p> MSE_Pred mean squared error of prediction
</p>
</li>
<li><p> CI_Pred mean and limits of prediction interval
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Edgar Kublin
</p>


<h3>See Also</h3>

<p><code><a href="#topic+E_DHx_HmDm_HT.f">E_DHx_HmDm_HT.f</a></code>, <code><a href="#topic+E_VOL_AB_HmDm_HT.f">E_VOL_AB_HmDm_HT.f</a></code>, 
<code><a href="#topic+resVar">resVar</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("SK.par.lme")
TapeR:::SK_EBLUP_LME.f(1.3/27, 30, 1.3/27, SK.par.lme)
## using empirical best linear unbiased estimator: estimate != 30
TapeR:::SK_EBLUP_LME.f(1.3/27, 30, 1.3/27, SK.par.lme, Rfn=list(fn="sig2"))$yp
## interpolate / force through given diameter: estimate  == 30
TapeR:::SK_EBLUP_LME.f(1.3/27, 30, 1.3/27, SK.par.lme, Rfn=list(fn="zero"))$yp
TapeR:::SK_EBLUP_LME.f(1.3/27, 30, c(1.3, 5)/27, SK.par.lme)
par.lme &lt;- SK.par.lme
h &lt;- 12 # tree height
xm &lt;- c(1.3, 3) / h # relative measuring height
ym &lt;- c(8, 7.5) # measured diameter
xp &lt;- c(0.5, 1) / h # relative prediction height
TapeR:::SK_EBLUP_LME.f(xm, ym, xp, SK.par.lme)
</code></pre>

<hr>
<h2 id='SK_VOLab_EBLUP_LME.f'>taper volume estimation</h2><span id='topic+SK_VOLab_EBLUP_LME.f'></span>

<h3>Description</h3>

<p>Internal function not usually called by users
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SK_VOLab_EBLUP_LME.f(
  xm,
  ym,
  a = 0,
  b = 1,
  Ht,
  par.lme,
  Rfn = list(fn = "sig2"),
  IntPolOpt = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SK_VOLab_EBLUP_LME.f_+3A_xm">xm</code></td>
<td>
<p>relative heights for which measurements are available</p>
</td></tr>
<tr><td><code id="SK_VOLab_EBLUP_LME.f_+3A_ym">ym</code></td>
<td>
<p>corresponding diameter measurements in height <code>xm</code></p>
</td></tr>
<tr><td><code id="SK_VOLab_EBLUP_LME.f_+3A_a">a</code></td>
<td>
<p>relative height of lower threshold of stem section</p>
</td></tr>
<tr><td><code id="SK_VOLab_EBLUP_LME.f_+3A_b">b</code></td>
<td>
<p>relative height of upper threshold of stem section</p>
</td></tr>
<tr><td><code id="SK_VOLab_EBLUP_LME.f_+3A_ht">Ht</code></td>
<td>
<p>tree height</p>
</td></tr>
<tr><td><code id="SK_VOLab_EBLUP_LME.f_+3A_par.lme">par.lme</code></td>
<td>
<p>List of taper model parameters obtained by <code><a href="#topic+TapeR_FIT_LME.f">TapeR_FIT_LME.f</a></code></p>
</td></tr>
<tr><td><code id="SK_VOLab_EBLUP_LME.f_+3A_rfn">Rfn</code></td>
<td>
<p>list with function name to provide estimated or assumed residual 
variances for the given measurements, optionally parameters for such functions</p>
</td></tr>
<tr><td><code id="SK_VOLab_EBLUP_LME.f_+3A_intpolopt">IntPolOpt</code></td>
<td>
<p>option for method of interpolation, if TRUE using a natural 
interpolating spline (<code><a href="stats.html#topic+splinefun">splinefun</a></code>), if FALSE using a smoothing 
spline (<code><a href="stats.html#topic+smooth.spline">smooth.spline</a></code>); defaults to TRUE</p>
</td></tr>
<tr><td><code id="SK_VOLab_EBLUP_LME.f_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Details</h3>

<p>with <code>Rfn=list(fn="zero")</code> one can decide whether the 
measured diameters are forced to lie exactly on the taper curve; this 
interferes somewhat with the <code>IntPolOpt</code>, which determines the method of
taper curve point interpolation for integration. The default <code>TRUE</code> 
(used throughout all function calls) applies natural interpolating splines, 
hence this does not contradict the optional use of <code>Rfn=list(fn="zero")</code>.
</p>


<h3>Value</h3>

<p>List with two elements, the estimated volume and its variance
</p>


<h3>Author(s)</h3>

<p>Edgar Kublin
</p>

<hr>
<h2 id='SK.par.lme'>

Taper model parameters for spruce in Germany based on BWI3 data.
</h2><span id='topic+SK.par.lme'></span>

<h3>Description</h3>


<p>Taper model parameters for spruce in Germany based on BWI3 data obtained using
<code><a href="#topic+TapeR_FIT_LME.f">TapeR_FIT_LME.f</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(SK.par.lme)</code></pre>


<h3>Format</h3>

<p>See Value section of <code><a href="#topic+TapeR_FIT_LME.f">TapeR_FIT_LME.f</a></code>.
</p>


<h3>References</h3>

<p>Kublin, E., Breidenbach, J., Kaendler, G. (2013) A flexible stem taper
and volume prediction method based on mixed-effects B-spline
regression, Eur J For Res, 132:983-997.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(SK.par.lme)
</code></pre>

<hr>
<h2 id='TapeR_FIT_LME.f'>Fits a taper curve model to the specified diameter-height data</h2><span id='topic+TapeR_FIT_LME.f'></span>

<h3>Description</h3>

<p>Fits a taper curve model with random effects on tree-level based
on B-Splines to the specified diameter-height data. Number and position of
nodes and order of B-Splines can be specified.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>TapeR_FIT_LME.f(
  Id,
  x,
  y,
  knt_x,
  ord_x,
  knt_z,
  ord_z,
  IdKOVb = "pdSymm",
  control = list(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="TapeR_FIT_LME.f_+3A_id">Id</code></td>
<td>
<p>Vector of tree identifiers of same length as diameter and height
measurements.</p>
</td></tr>
<tr><td><code id="TapeR_FIT_LME.f_+3A_x">x</code></td>
<td>
<p>Numeric vector of height measurements (explanatory variables) along
the stem relative to the tree height.</p>
</td></tr>
<tr><td><code id="TapeR_FIT_LME.f_+3A_y">y</code></td>
<td>
<p>Numeric vector of diameter measurements (response) along the stem
(in centimeters).</p>
</td></tr>
<tr><td><code id="TapeR_FIT_LME.f_+3A_knt_x">knt_x</code></td>
<td>
<p>Numeric vector of relative knot positions for fixed effects.</p>
</td></tr>
<tr><td><code id="TapeR_FIT_LME.f_+3A_ord_x">ord_x</code></td>
<td>
<p>Numeric scalar. Order of fixed effects Spline (4=cubic).</p>
</td></tr>
<tr><td><code id="TapeR_FIT_LME.f_+3A_knt_z">knt_z</code></td>
<td>
<p>Numeric vector of relative knot positions for random effects.</p>
</td></tr>
<tr><td><code id="TapeR_FIT_LME.f_+3A_ord_z">ord_z</code></td>
<td>
<p>Numeric scalar. Order of random effects Spline (4=cubic).</p>
</td></tr>
<tr><td><code id="TapeR_FIT_LME.f_+3A_idkovb">IdKOVb</code></td>
<td>
<p>Character string. Type of covariance matrix used by
<code>lme</code>. Only &quot;pdSymm&quot; makes sense. Rather reduce number of knots if
function does not converge.</p>
</td></tr>
<tr><td><code id="TapeR_FIT_LME.f_+3A_control">control</code></td>
<td>
<p>a list of control values for the estimation algorithm to
replace the default values returned by the function
<code><a href="nlme.html#topic+lmeControl">lmeControl</a></code>. Defaults to an empty list.</p>
</td></tr>
<tr><td><code id="TapeR_FIT_LME.f_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If too few trees are given, the linear mixed model (lme) will not
converge. See examples for a suggestion of node positions.
</p>
<p>The variance parameters <code>theta</code> are stored in the natural parametrization
(Pinheiro and Bates (2004), p. 93). This means log for variances and logit for
covariances. <code>theta</code> is the vectorized triangle of the random effects
covariance matrix + the residual variance (lSigma). Given there are 2 inner
knots for random effects, the structure will be
c(sig^2_b1, sig_b1 sig_b2, sig_b1 sig_b3, sig_b1 sig_b4, sig^2_b2,...,sig^2_b4, lSigma)
</p>


<h3>Value</h3>

<p>List of model properties
</p>

<ul>
<li><p>fit.lmeSummary of the fitted lme model.
</p>
</li>
<li><p>par.lmeList of model parameters (e.g., coefficients and
variance-covariance matrices) needed for volume estimation and other
functions in this package.
Components of the <code>par.lme</code> list
</p>

<ul>
<li><p>knt_xRelative positions of the fixed effects Spline knots along the stem.
</p>
</li>
<li><p>pad_knt_xPadded version of knt_x, as used to define B-Spline design matrix.
</p>
</li>
<li><p>ord_xOrder of the spline.
</p>
</li>
<li><p>knt_zRelative positions of the random effects Spline knots along
the stem.
</p>
</li>
<li><p>pad_knt_zPadded version of knt_z, as used to define B-Spline design matrix.
</p>
</li>
<li><p>ord_zOrder of the spline.
</p>
</li>
<li><p>b_fixFixed-effects spline coefficients.
</p>
</li>
<li><p>KOVb_fixCovariance of fixed-effects.
</p>
</li>
<li><p>sig2_epsResidual variance.
</p>
</li>
<li><p>dfResResidual degrees of freedom.
</p>
</li>
<li><p>KOVb_rndCovariance of random effects.
</p>
</li>
<li><p>thetaVariance parameters in natural parametrization. See Details. 
</p>
</li>
<li><p>KOV_thetaApproximate asymptotic covariance matrix of variance parameters.
</p>
</li></ul>

</li></ul>



<h3>Author(s)</h3>

<p>Edgar Kublin
</p>


<h3>References</h3>

<p>Kublin, E., Breidenbach, J., Kaendler, G. (2013) A flexible stem
taper and volume prediction method based on mixed-effects B-spline
regression, Eur J For Res, 132:983-997.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+E_DHx_HmDm_HT.f">E_DHx_HmDm_HT.f</a></code>, <code><a href="#topic+E_DHx_HmDm_HT_CIdHt.f">E_DHx_HmDm_HT_CIdHt.f</a></code>,
<code><a href="#topic+E_HDx_HmDm_HT.f">E_HDx_HmDm_HT.f</a></code>, <code><a href="#topic+E_VOL_AB_HmDm_HT.f">E_VOL_AB_HmDm_HT.f</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># load example data
data(DxHx.df)

# prepare the data (could be defined in the function directly)
Id = DxHx.df[,"Id"]
x = DxHx.df[,"Hx"]/DxHx.df[,"Ht"]#calculate relative heights
y = DxHx.df[,"Dx"]

# define the relative knot positions and order of splines
knt_x = c(0.0, 0.1, 0.75, 1.0);	ord_x = 4 # B-Spline knots: fix effects; order (cubic = 4)
knt_z = c(0.0, 0.1       ,1.0); ord_z = 4 # B-Spline knots: rnd effects

# fit the model
taper.model &lt;- TapeR_FIT_LME.f(Id, x, y, knt_x, ord_x, knt_z, ord_z,
                               IdKOVb = "pdSymm")

## save model parameters for documentation or dissimination
## parameters can be load()-ed and used to predict the taper
## or volume using one or several measured dbh
#spruce.taper.pars &lt;- taper.model$par.lme
#save(spruce.taper.pars, file="spruce.taper.pars.rdata")
</code></pre>

<hr>
<h2 id='TapeR-package'>
Flexible tree taper curves based on Semiparametric Mixed Models.
</h2><span id='topic+TapeR-package'></span><span id='topic+TapeR'></span>

<h3>Description</h3>

<p>This package implements functions for fitting taper curves (a semiparametric linear
mixed effects taper model) to diameter measurements along
stems. Further functions are provided to estimate the
variance/confidence intervals
around the predicted curves, to calculate timber volume (also by
sections) and marginal (e.g., upper) diameters. For cases where tree
heights are not measured, methods for estimating
additional variance in volume predictions resulting from uncertainties in
tree height models (tariffs) are provided. The
example data include the taper curve parameters for Norway spruce used
in the 3rd German NFI fitted to 380 trees and a subset of section-wise
diameter measurements of these trees.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> TapeR</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL-2</td>
</tr>
<tr>
 <td style="text-align: left;">
LazyLoad: </td><td style="text-align: left;"> yes</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>Fits taper models using diameter measurements along the stem. Uses fitted
models and arbitrary numbers of diameter measurements to estimate
diameter at any position along the stem. Estimates timber volume from the
taper curve. Provides variances for all estimates.
</p>


<h3>Author(s)</h3>

<p>Edgar Kublin
</p>
<p>Maintainer: Johannes Breidenbach &lt;job@skogoglandskap.no&gt;
</p>


<h3>References</h3>

<p>Kublin, E., Breidenbach, J., Kaendler, G. (2013) A flexible stem taper
and volume prediction method based on mixed-effects B-spline regression,
Eur J For Res, 132:983-997. 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+TapeR_FIT_LME.f">TapeR_FIT_LME.f</a></code>, <code><a href="#topic+E_DHx_HmDm_HT.f">E_DHx_HmDm_HT.f</a></code>,
<code><a href="#topic+DxHx.df">DxHx.df</a></code>, <code><a href="#topic+SK.par.lme">SK.par.lme</a></code>, <code><a href="#topic+HT.par">HT.par</a></code>
</p>

<hr>
<h2 id='TransKnots'>transform knot vector</h2><span id='topic+TransKnots'></span>

<h3>Description</h3>

<p>Internal function not usually called by users
</p>


<h3>Usage</h3>

<pre><code class='language-R'>TransKnots(knots = c(seq(0, 1, 0.1)), ord = 4, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="TransKnots_+3A_knots">knots</code></td>
<td>
<p>knot positions for spline function</p>
</td></tr>
<tr><td><code id="TransKnots_+3A_ord">ord</code></td>
<td>
<p>order of the spline function</p>
</td></tr>
<tr><td><code id="TransKnots_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>transformed knots vector, especially with repeated first and last 
knot given order of spline function
</p>


<h3>Author(s)</h3>

<p>Edgar Kublin
</p>

<hr>
<h2 id='updateKOV'>update variance-covariance matrix</h2><span id='topic+updateKOV'></span>

<h3>Description</h3>

<p>Internal function not usually called by users
</p>


<h3>Usage</h3>

<pre><code class='language-R'>updateKOV(var, kov)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="updateKOV_+3A_var">var</code></td>
<td>
<p>vector of new variances</p>
</td></tr>
<tr><td><code id="updateKOV_+3A_kov">kov</code></td>
<td>
<p>variance-covariance matrix to be updated</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Firstly, <code>kov</code> is transformed to a correlation matrix. 
Secondly, this correlation matrix is backtransformed to a variance-covariance
matrix using the new variances.
</p>


<h3>Value</h3>

<p>updated variance-covariance matrix
</p>


<h3>Author(s)</h3>

<p>Christian Vonderach
</p>

<hr>
<h2 id='xy0_root.f'>xy0_root.f</h2><span id='topic+xy0_root.f'></span>

<h3>Description</h3>

<p>Internal function not usually called by users
</p>


<h3>Usage</h3>

<pre><code class='language-R'>xy0_root.f(x, y0, SK, par.lme, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="xy0_root.f_+3A_x">x</code></td>
<td>
<p>relative height</p>
</td></tr>
<tr><td><code id="xy0_root.f_+3A_y0">y0</code></td>
<td>
<p>diameter for which height is required</p>
</td></tr>
<tr><td><code id="xy0_root.f_+3A_sk">SK</code></td>
<td>
<p>return of <code><a href="#topic+SK_EBLUP_LME.f">SK_EBLUP_LME.f</a></code> containing estimated fixed
and the tree specific random effects of the taper model</p>
</td></tr>
<tr><td><code id="xy0_root.f_+3A_par.lme">par.lme</code></td>
<td>
<p>List of taper model parameters obtained by <code><a href="#topic+TapeR_FIT_LME.f">TapeR_FIT_LME.f</a></code></p>
</td></tr>
<tr><td><code id="xy0_root.f_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Details</h3>

<p>used in <code>xy0_SK_EBLUP_LME.f</code> to find the root of taper curve
(i.e. height <code>x</code>) at given diameter <code>y0</code>
</p>


<h3>Value</h3>

<p>difference between actual diameter at height <code>x</code> and given
diameter <code>y0</code>
</p>


<h3>Author(s)</h3>

<p>Edgar Kublin
</p>

<hr>
<h2 id='xy0_SK_EBLUP_LME.f'>find relative height of given diameter</h2><span id='topic+xy0_SK_EBLUP_LME.f'></span>

<h3>Description</h3>

<p>Internal function not usually called by users
</p>


<h3>Usage</h3>

<pre><code class='language-R'>xy0_SK_EBLUP_LME.f(xm, ym, y0, par.lme, Rfn = list(fn = "sig2"), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="xy0_SK_EBLUP_LME.f_+3A_xm">xm</code></td>
<td>
<p>relative heights for which measurements are available</p>
</td></tr>
<tr><td><code id="xy0_SK_EBLUP_LME.f_+3A_ym">ym</code></td>
<td>
<p>corresponding diameter measurements in height <code>xm</code></p>
</td></tr>
<tr><td><code id="xy0_SK_EBLUP_LME.f_+3A_y0">y0</code></td>
<td>
<p>given diameter for which height is required</p>
</td></tr>
<tr><td><code id="xy0_SK_EBLUP_LME.f_+3A_par.lme">par.lme</code></td>
<td>
<p>Fitted model object, return of <code><a href="#topic+TapeR_FIT_LME.f">TapeR_FIT_LME.f</a></code></p>
</td></tr>
<tr><td><code id="xy0_SK_EBLUP_LME.f_+3A_rfn">Rfn</code></td>
<td>
<p>list with function name to provide estimated or assumed residual 
variances for the given measurements, optionally parameters for such functions</p>
</td></tr>
<tr><td><code id="xy0_SK_EBLUP_LME.f_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Details</h3>

<p>function used to transform given diameter in volume calculation into
height; c.f <code><a href="#topic+E_VOL_AB_HmDm_HT.f">E_VOL_AB_HmDm_HT.f</a></code>; with <code>Rfn</code> one can decide 
whether the measured diameters are forced to lie exactly on the taper curve
<code>Rfn$fn="sig2"</code> or not <code>Rfn$fn="zero"</code>. Other options are possible, 
see also <code><a href="#topic+SK_EBLUP_LME.f">SK_EBLUP_LME.f</a></code> and <code><a href="#topic+resVar">resVar</a></code>.
</p>


<h3>Value</h3>

<p>relative height of given diameter <code>y0</code>
</p>


<h3>Author(s)</h3>

<p>Edgar Kublin
</p>

<hr>
<h2 id='XZ_BSPLINE.f'>construct B-Splines design matrices</h2><span id='topic+XZ_BSPLINE.f'></span>

<h3>Description</h3>

<p>Internal function not usually called by users
</p>


<h3>Usage</h3>

<pre><code class='language-R'>XZ_BSPLINE.f(x, knt, ord, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="XZ_BSPLINE.f_+3A_x">x</code></td>
<td>
<p>relative height measurements</p>
</td></tr>
<tr><td><code id="XZ_BSPLINE.f_+3A_knt">knt</code></td>
<td>
<p>knot positions for B-Splines, usually taken from a model fit by 
<code><a href="#topic+TapeR_FIT_LME.f">TapeR_FIT_LME.f</a></code></p>
</td></tr>
<tr><td><code id="XZ_BSPLINE.f_+3A_ord">ord</code></td>
<td>
<p>order of B-Splines, usually taken from a model fit by 
<code><a href="#topic+TapeR_FIT_LME.f">TapeR_FIT_LME.f</a></code></p>
</td></tr>
<tr><td><code id="XZ_BSPLINE.f_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List with height measurements (<code>x</code>), the fixed effects B-splines
matrix and the random effects B-splines matrix.
</p>


<h3>Author(s)</h3>

<p>Edgar Kublin
</p>


<h3>See Also</h3>

<p><code><a href="#topic+TapeR_FIT_LME.f">TapeR_FIT_LME.f</a></code>
</p>

<hr>
<h2 id='y2x_isp.f'>squared diameter using interpolating splines</h2><span id='topic+y2x_isp.f'></span>

<h3>Description</h3>

<p>Internal function not usually called by users
</p>


<h3>Usage</h3>

<pre><code class='language-R'>y2x_isp.f(x, x.grd, y.grd, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="y2x_isp.f_+3A_x">x</code></td>
<td>
<p>relative height</p>
</td></tr>
<tr><td><code id="y2x_isp.f_+3A_x.grd">x.grd</code></td>
<td>
<p>relative heights for interpolation</p>
</td></tr>
<tr><td><code id="y2x_isp.f_+3A_y.grd">y.grd</code></td>
<td>
<p>diameter of taper curve at relative heights <code>x.grd</code> for
interpolation</p>
</td></tr>
<tr><td><code id="y2x_isp.f_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>squared estimated diameter based on natural interpolating spline 
(<code><a href="stats.html#topic+splinefun">splinefun</a></code>)
</p>


<h3>Author(s)</h3>

<p>Edgar Kublin
</p>

<hr>
<h2 id='y2x_ssp.f'>squared diameter using smoothing splines</h2><span id='topic+y2x_ssp.f'></span>

<h3>Description</h3>

<p>Internal function not usually called by users
</p>


<h3>Usage</h3>

<pre><code class='language-R'>y2x_ssp.f(x, x.grd, y.grd, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="y2x_ssp.f_+3A_x">x</code></td>
<td>
<p>relative height</p>
</td></tr>
<tr><td><code id="y2x_ssp.f_+3A_x.grd">x.grd</code></td>
<td>
<p>relative heights for interpolation</p>
</td></tr>
<tr><td><code id="y2x_ssp.f_+3A_y.grd">y.grd</code></td>
<td>
<p>diameter of taper curve at relative heights <code>x.grd</code> for
interpolation</p>
</td></tr>
<tr><td><code id="y2x_ssp.f_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>squared estimated diameter based on smoothing splines 
(<code><a href="stats.html#topic+smooth.spline">smooth.spline</a></code>)
</p>


<h3>Author(s)</h3>

<p>Edgar Kublin
</p>

<hr>
<h2 id='yx_isp.f'>diameter using interpolating splines</h2><span id='topic+yx_isp.f'></span>

<h3>Description</h3>

<p>Internal function not usually called by users
</p>


<h3>Usage</h3>

<pre><code class='language-R'>yx_isp.f(x, x.grd, y.grd, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="yx_isp.f_+3A_x">x</code></td>
<td>
<p>relative height</p>
</td></tr>
<tr><td><code id="yx_isp.f_+3A_x.grd">x.grd</code></td>
<td>
<p>relative heights for interpolation</p>
</td></tr>
<tr><td><code id="yx_isp.f_+3A_y.grd">y.grd</code></td>
<td>
<p>diameter of taper curve at relative heights <code>x.grd</code> for
interpolation</p>
</td></tr>
<tr><td><code id="yx_isp.f_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>estimated diameter based on natural interpolating spline 
(<code><a href="stats.html#topic+splinefun">splinefun</a></code>)
</p>


<h3>Author(s)</h3>

<p>Edgar Kublin
</p>

<hr>
<h2 id='yx_ssp.f'>diameter using smoothing splines</h2><span id='topic+yx_ssp.f'></span>

<h3>Description</h3>

<p>Internal function not usually called by users
</p>


<h3>Usage</h3>

<pre><code class='language-R'>yx_ssp.f(x, x.grd, y.grd, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="yx_ssp.f_+3A_x">x</code></td>
<td>
<p>relative height</p>
</td></tr>
<tr><td><code id="yx_ssp.f_+3A_x.grd">x.grd</code></td>
<td>
<p>relative heights for interpolation</p>
</td></tr>
<tr><td><code id="yx_ssp.f_+3A_y.grd">y.grd</code></td>
<td>
<p>diameter of taper curve at relative heights <code>x.grd</code> for
interpolation</p>
</td></tr>
<tr><td><code id="yx_ssp.f_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>estimated diameter based on smoothing splines 
(<code><a href="stats.html#topic+smooth.spline">smooth.spline</a></code>)
</p>


<h3>Author(s)</h3>

<p>Edgar Kublin
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
