<!DOCTYPE html><html lang="en"><head><title>Help for package funspace</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {funspace}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#funspace'><p>Functional space</p></a></li>
<li><a href='#funspaceDim'><p>Dimensionality of a trait space</p></a></li>
<li><a href='#funspaceGAM'><p>Functional space GAM</p></a></li>
<li><a href='#funspaceNull'><p>Null models in functional space</p></a></li>
<li><a href='#GSPFF'><p>Aboveground traits from the global spectrum of plant form and function (complete data)</p></a></li>
<li><a href='#GSPFF_missing'><p>Aboveground traits from the global spectrum of plant form and function (incomplete data)</p></a></li>
<li><a href='#GSPFF_missing_tax'><p>Taxonomic information for plants from the global spectrum of plant form and function (incomplete data)</p></a></li>
<li><a href='#GSPFF_tax'><p>Taxonomic information for plants from the global spectrum of plant form and function (complete data)</p></a></li>
<li><a href='#impute'><p>Imputing Trait Information</p></a></li>
<li><a href='#phylo'><p>Phylogeny for species from the global spectrum of plant form and function (incomplete data)</p></a></li>
<li><a href='#plot.funspace'><p>Functional space plotting</p></a></li>
<li><a href='#summary.funspace'><p>Summarizing Functional Spaces</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Creating and Representing Functional Trait Spaces</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.2</td>
</tr>
<tr>
<td>Description:</td>
<td>Estimation of functional spaces based on traits of organisms.
    The package includes functions to impute missing trait values (with or
    without considering phylogenetic information), and to create,
    represent and analyse two dimensional functional spaces based on
    principal components analysis, other ordination methods, or raw
    traits. It also allows for mapping a third variable onto the
    functional space.  See 'Carmona et al. (2021)' 
    &lt;<a href="https://doi.org/10.1038%2Fs41586-021-03871-y">doi:10.1038/s41586-021-03871-y</a>&gt;, 'Puglielli et al.  (2021)'
    &lt;<a href="https://doi.org/10.1111%2Fnph.16952">doi:10.1111/nph.16952</a>&gt;, 'Carmona et al. (2021)'
    &lt;<a href="https://doi.org/10.1126%2Fsciadv.abf2675">doi:10.1126/sciadv.abf2675</a>&gt;, 'Carmona et al. (2019)'
    &lt;<a href="https://doi.org/10.1002%2Fecy.2876">doi:10.1002/ecy.2876</a>&gt; for more information.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>Imports:</td>
<td>ade4, ape, ks, mgcv, missForest, MASS, paran, vegan, phytools,
viridis</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-06-17 04:42:11 UTC; Carlos Perez Carmona</td>
</tr>
<tr>
<td>Author:</td>
<td>Carlos P. Carmona <a href="https://orcid.org/0000-0001-6935-4913"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [cre],
  Nicola Pavanetto <a href="https://orcid.org/0000-0002-9441-863X"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Giacomo Puglielli <a href="https://orcid.org/0000-0003-0085-4535"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Carlos P. Carmona &lt;perezcarmonacarlos@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-06-17 05:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='funspace'>Functional space</h2><span id='topic+funspace'></span>

<h3>Description</h3>

<p>Defines the functional structure of a set of species
</p>


<h3>Usage</h3>

<pre><code class='language-R'>funspace(
  x,
  PCs = c(1, 2),
  group.vec = NULL,
  fixed.bw = TRUE,
  n_divisions = 100,
  trait_ranges = NULL,
  threshold = 0.999
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="funspace_+3A_x">x</code></td>
<td>
<p>Data to create the functional space. It can be either a PCA object obtained using the <code>princomp</code> function, a PCoA obtained using the <code>capscale</code> function from the <code>vegan</code> package, an NMDS generated with the <code>metaMDS</code> or <code>monoMDS</code> functions from <code>vegan</code>, a TPDs object generated with the <code>TPD</code> package or a matrix or data frame with at least two columns (representing two dimensions which can be either traits or ordination scores obtained with other methods).</p>
</td></tr>
<tr><td><code id="funspace_+3A_pcs">PCs</code></td>
<td>
<p>A vector specifying the Principal Components to be considered (e.g. choosing <code>PCs = c(1,2)</code> would lead to to consider the first and the second principal components). Only applies if <code>x</code> contains a PCA. Defaults to <code>c(1, 2)</code>, which selects the first two principal components.</p>
</td></tr>
<tr><td><code id="funspace_+3A_group.vec">group.vec</code></td>
<td>
<p>An object of class factor specifying the levels of the grouping variable.</p>
</td></tr>
<tr><td><code id="funspace_+3A_fixed.bw">fixed.bw</code></td>
<td>
<p>Logical indicating whether the same bandwidth that is used in the kde estimation for the whole dataset should also be used for the kde estimation of individual groups of observations (<code>fixed.bw = T</code>), or if a different bandwidth has to be estimated for each group ((<code>fixed.bw = F</code>)). Defaults to TRUE, which makes the most extreme quantiles of the individual groups to coincide with those of the global distribution, and allows for more meaningful comparisons of the amount of functional space occupied by groups (functional richness).</p>
</td></tr>
<tr><td><code id="funspace_+3A_n_divisions">n_divisions</code></td>
<td>
<p>The number of equal-length parts in which each principal component  should be divided to calculate the grid in which calculations are based. Higher values of n_divisions will result in larger computation times, but also more smooth graphics. Defaults to 100.</p>
</td></tr>
<tr><td><code id="funspace_+3A_trait_ranges">trait_ranges</code></td>
<td>
<p>A list indicating the range of values that will be considered in the calculations for each of the considered PCA components. The list should contain the range (minimum and maximum) of  values that will be considered. Each element of the list corresponds with one PCA component. The order of the components must be the same as the order provided in <code>PCs</code>. Defaults to    NULL, in which case ranges are automatically calculated to ensure the functional space considered is sufficiently large to encompass the whole TPD function.</p>
</td></tr>
<tr><td><code id="funspace_+3A_threshold">threshold</code></td>
<td>
<p>The probability threshold to consider to estimate the TPD function. TPD functions are positive across the whole trait space; <code>threshold</code> defines boundaries beyond which the TPD function is set to 0 (see Carmona et al. 2016; 2019 for more information). Defaults to 0.999.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The functional structure of a set of organisms refers to how these organisms are distributed within a functional space (a space defined by traits). Functional structure can be expressed in probabilistic terms using trait probability density functions (TPD). TPD functions reflect how densely the organisms occupy the different parts of the functional space, and are implemented in the package <code>TPD</code> (Carmona et al. 2019).
</p>
<p><code>funspace</code> allows the user to define functional structure in a two-dimensional functional space created using a PCA, other ordination methods, or raw traits. The function automatically estimates the probability of occurrence of trait combinations within the space using kernel density estimation with unconstrained bandwidth using the functions from the <code>ks</code> R package  (Duong, 2007). Contour lines can be drawn at any quantile of the probability distribution. Colored areas, corresponding to the target quantiles, visually summarize the probability of occurrence of certain trait combinations within the trait space.
</p>


<h3>Value</h3>

<p><code>funspace</code> The function returns an object of class <code>funspace</code> containing characteristics of the functional space and the trait probability distributions. The object includes estimations of functional richness and functional divergence for all observations taken together (global) and for each individual group (if groups are provided). The <code>funspace</code> class has specific methods exists for the generic functions <code>plot</code> and <code>summary</code>.
</p>


<h3>References</h3>

<p>CP Carmona, F de Bello, NWH Mason, J Leps (2019). Trait Probability Density (TPD): measuring functional diversity across scales based on trait probability density with R. Ecology e02876.
T Duong, T., (2007). ks: Kernel Density Estimation and Kernel Discriminant Analysis for Multivariate Data in R. J. Stat. Softw. 21(7), 1-16.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# 1. Plotting a space based on a PCA
x &lt;- princomp(GSPFF)
funtest &lt;- funspace(x = x, PCs = c(1, 2), threshold = 0.95)
summary(funtest)
plot(funtest, type = "global")

#2. To include groups, let's consider two major families.
# We will use two raw traits, ph and sla:
selFam &lt;- c("Pinaceae", "Fabaceae")
selRows &lt;- which(GSPFF_tax$family %in% selFam)
GSPFF_subset &lt;- GSPFF[selRows, c("ph", "sla")]
tax_subset &lt;- droplevels(GSPFF_tax[selRows, ])
funtest &lt;- funspace(x = GSPFF_subset, threshold = 0.95, group.vec = tax_subset$family)
summary(funtest)
plot(funtest, type = "global")
plot(funtest, type = "groups", axis.title.x = "Plant height",
   axis.title.y = "Specific leaf area",
   quant.plot = TRUE, pnt = TRUE, pnt.cex = 0.5,
   pnt.col = rgb(0, 1, 1, alpha = 0.2))

</code></pre>

<hr>
<h2 id='funspaceDim'>Dimensionality of a trait space</h2><span id='topic+funspaceDim'></span>

<h3>Description</h3>

<p>Calculating the dimensionality of a functional space based on PCA
</p>


<h3>Usage</h3>

<pre><code class='language-R'>funspaceDim(data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="funspaceDim_+3A_data">data</code></td>
<td>
<p>A <code>data.frame</code> or <code>matrix</code> containing trait data</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>funspaceDim</code> allows the user to identify the number of dimensions that are needed to build a trait space. The identified dimensions are those that minimize redundancy while maximizing the information contained in the trait data. The number of significant PCA axes to be retained is determined by using the <code>paran()</code> function of the R package <code>paran</code> (Dinno, 2018). <code>paran()</code> is based on the method proposed by Horn (1965), which involves contrasting the eigenvalues produced through PCAs run on (30 * (number of variables)) random datasets with the same number of variables and observations as the input dataset. Eigenvalues &gt; 1 are retained in the adjustment.
</p>


<h3>Value</h3>

<p><code>funspaceDim</code> returns the number of dimensions to be retained. The output is stored and printed out in the R console as well.
</p>


<h3>References</h3>

<p>Horn, J.L. (1965). A rationale and test for the number of factors in factor analysis. Psychometrika 30: 179-185.
</p>
<p>Dinno, A. (2018). paran: Horn's test of principal components/factors. R package version 1.5.2.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Dimensionality of the GSPFF
funspaceDim(GSPFF)

</code></pre>

<hr>
<h2 id='funspaceGAM'>Functional space GAM</h2><span id='topic+funspaceGAM'></span>

<h3>Description</h3>

<p>Mapping response variables in a functional space
</p>


<h3>Usage</h3>

<pre><code class='language-R'>funspaceGAM(y, funspace, family = "gaussian", minObs = 30)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="funspaceGAM_+3A_y">y</code></td>
<td>
<p>vector including the variable to be mapped inside the functional space. There must be a correspondence between the elements of y and the observations used to make the PCA (contained in 'pca.object'), both in the number of elements and in their order.</p>
</td></tr>
<tr><td><code id="funspaceGAM_+3A_funspace">funspace</code></td>
<td>
<p>An object of class <code>funspace</code> providing the functional space to be considered. See function <code>funspace</code></p>
</td></tr>
<tr><td><code id="funspaceGAM_+3A_family">family</code></td>
<td>
<p>A family object specifying the distribution and link to use in the gam model. Defaults to &quot;gaussian&quot;. See package <code>mgcv</code> for more details.</p>
</td></tr>
<tr><td><code id="funspaceGAM_+3A_minobs">minObs</code></td>
<td>
<p>minimum number of observations needed in a  group to make a model (defaults to 30).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Different response variables can be mapped onto a functional space. In <code>funspace</code>, we follow the approach by Carmona et al. (2021), in which a generalized additive model is estimated across the bidimensional functional space. The resulting models show the predicted values of the response variable at each position of the portion of the functional space that is defined in the TPD of the global set of observations or of individual groups.
</p>


<h3>Value</h3>

<p>The function returns an object of class <code>funspace</code> containing the functional space, trait probability distributions, and the fitted gam models. The <code>funspace</code> class has specific methods exists for the generic functions <code>plot</code> and <code>summary</code>.
</p>


<h3>References</h3>

<p>CP Carmona, et al. (2021). Erosion of global functional diversity across the tree of life. Science Advances eabf2675
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# 1. GAM on a space based on a PCA
x &lt;- princomp(GSPFF)
funtest &lt;- funspace(x = x, PCs = c(1, 2), threshold = 0.95)
y &lt;- abs(x$scores[, 1] * x$scores[, 2]) + rnorm(nrow(GSPFF), mean = 0, sd = 1)
funtestGAM &lt;- funspaceGAM(y = y, funspace = funtest)
plot(funtestGAM, quant.plot = TRUE, quant.col = "grey90")
summary(funtestGAM)


</code></pre>

<hr>
<h2 id='funspaceNull'>Null models in functional space</h2><span id='topic+funspaceNull'></span>

<h3>Description</h3>

<p>Comparing the amount of occupied functional space against null models
</p>


<h3>Usage</h3>

<pre><code class='language-R'>funspaceNull(
  funspace,
  nrep = 100,
  alter = "greater",
  null.distribution = "multnorm",
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="funspaceNull_+3A_funspace">funspace</code></td>
<td>
<p>An object of class <code>funspace</code></p>
</td></tr>
<tr><td><code id="funspaceNull_+3A_nrep">nrep</code></td>
<td>
<p><code>numeric</code>The number of generated null surfaces</p>
</td></tr>
<tr><td><code id="funspaceNull_+3A_alter">alter</code></td>
<td>
<p><code>character</code>. The hypothesis to be tested when comparing the observed trait space against the null model. Options are 'greater', 'less', and 'two-sided'. See specification of the <code>as.randtest</code> function in the <code>ade4</code> R package</p>
</td></tr>
<tr><td><code id="funspaceNull_+3A_null.distribution">null.distribution</code></td>
<td>
<p><code>character</code>. Data distribution for null model building. Available options are 'multnorm' and 'uniform' to generate data with a multivariate normal or uniform distribution, respectively.</p>
</td></tr>
<tr><td><code id="funspaceNull_+3A_verbose">verbose</code></td>
<td>
<p><code>logical</code>. Do you want to  information about the progress of the null model to be written to the console?</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>funspaceNull</code> The function tests for the statistical difference between the size (functional richness) of the considered TPD, obtained using the <code>funspace</code> function, against a vector of functional richness values generated using null models (see below) across a user-defined number of iterations. Two null models are currently available for testing. One generates data with a multivariate normal distribution, creating a dataset with normally distributed variables having the same mean and covariance than the observations used to build the functional space (see Carmona et al. 2021). This null model returns a theoretical TPD where some trait combinations (those around the mean of the trait space axes, thus towards the center of the null trait space) are more likely than others (i.e., this null model resembles an ellipse). The other null model generates a dataset with variables following a uniform distribution (see null model 1 in Diaz et al. 2016), creating a distribution where all trait combinations within the range of the original observations are equally possible (i.e., the approximate shape of this null model is a rectangle).
Note that the function does not work for funspace objects that are based on a TPDs object created using the package <code>TPD</code>
</p>


<h3>Value</h3>

<p><code>funspaceNull</code> The function returns the list containing all the simulated datasets, the area of the observed trait space, the mean value of the area for the null model (calculated across iterations), the p-value of the difference between observed and simulated trait space, as well as a standardized effect size of the difference between observed trait space and mean null model areas. This output is reported together with the output of  <code>funspace</code>.
</p>


<h3>References</h3>

<p>CP Carmona, et al. (2021). Fine-root traits in the global spectrum of plant form and function. Nature 597, 683–687
S Diaz, et al. (2016). The global spectrum of plant form and function. Nature 529, 167–171
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# 1. PCA space, multivariate model (see Carmona et al. 2021, Nature)
x &lt;- princomp(GSPFF)
funtest &lt;- funspace(x = x, PCs = c(1, 2), threshold = 0.95)
funtestNull &lt;- funspaceNull(funtest, null.distribution = 'multnorm', nrep = 1000)
summary(funtestNull)

#'# 2. Two raw traits and uniform distribution (see Diaz et al. 2016, Nature)
x &lt;- GSPFF[, c("ph", "sla")]
funtest &lt;- funspace(x = x, threshold = 0.95)
funtestNull &lt;- funspaceNull(funtest, null.distribution = 'uniform', nrep = 1000)
summary(funtestNull)

</code></pre>

<hr>
<h2 id='GSPFF'>Aboveground traits from the global spectrum of plant form and function (complete data)</h2><span id='topic+GSPFF'></span>

<h3>Description</h3>

<p>Data on six aboveground traits for 2,630 species with complete trait information. Data was processed from the TRY database (https://www.try-db.org/TryWeb/Home.php) and used in the paper &quot;Fine-root traits in the global spectrum of plant form and function (Carmona et al. 2021, Nature). The data is available in https://doi.org/10.6084/m9.figshare.13140146. All traits are log10 transformed and scaled.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GSPFF
</code></pre>


<h3>Format</h3>

<p>## 'GSPFF'
A data frame with 2,630 rows and 6 columns:
</p>

<dl>
<dt>la</dt><dd><p>leaf area</p>
</dd>
<dt>ln</dt><dd><p>leaf nitrogen content</p>
</dd>
<dt>ph</dt><dd><p>plant height</p>
</dd>
<dt>sla</dt><dd><p>specific leaf area</p>
</dd>
<dt>ssd</dt><dd><p>specific stem density</p>
</dd>
<dt>sm</dt><dd><p>seed mass</p>
</dd>
</dl>
<p>...

</p>


<h3>Source</h3>

<p>&lt;https://doi.org/10.6084/m9.figshare.13140146&gt;
</p>

<hr>
<h2 id='GSPFF_missing'>Aboveground traits from the global spectrum of plant form and function (incomplete data)</h2><span id='topic+GSPFF_missing'></span>

<h3>Description</h3>

<p>Data on six aboveground traits for 10,746 species with incomplete trait information. Data was processed from the TRY database (https://www.try-db.org/TryWeb/Home.php) and used in the paper &quot;Fine-root traits in the global spectrum of plant form and function (Carmona et al. 2021, Nature). The data is available in https://doi.org/10.6084/m9.figshare.13140146. Only species with information for at least three traits are included. All traits are log10 transformed and scaled.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GSPFF_missing
</code></pre>


<h3>Format</h3>

<p>## 'GSPFF_missing'
A data frame with 10,746 rows and 6 columns:
</p>

<dl>
<dt>la</dt><dd><p>leaf area</p>
</dd>
<dt>ln</dt><dd><p>leaf nitrogen content</p>
</dd>
<dt>ph</dt><dd><p>plant height</p>
</dd>
<dt>sla</dt><dd><p>specific leaf area</p>
</dd>
<dt>ssd</dt><dd><p>specific stem density</p>
</dd>
<dt>sm</dt><dd><p>seed mass</p>
</dd>
</dl>
<p>...

</p>


<h3>Source</h3>

<p>&lt;https://doi.org/10.6084/m9.figshare.13140146&gt;
</p>

<hr>
<h2 id='GSPFF_missing_tax'>Taxonomic information for plants from the global spectrum of plant form and function (incomplete data)</h2><span id='topic+GSPFF_missing_tax'></span>

<h3>Description</h3>

<p>Taxonomic data for 10,746 species with incomplete trait information (species with at least three traits).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GSPFF_missing_tax
</code></pre>


<h3>Format</h3>

<p>## 'GSPFF_missing_tax'
A data frame with 10,746 rows and 3 columns:
</p>

<dl>
<dt>genus</dt><dd><p>genus to which the species belongs</p>
</dd>
<dt>family</dt><dd><p>family to which the species belongs</p>
</dd>
<dt>order</dt><dd><p>order to which the species belongs</p>
</dd>
</dl>
<p>...

</p>


<h3>Source</h3>

<p>&lt;https://doi.org/10.6084/m9.figshare.13140146&gt;
</p>

<hr>
<h2 id='GSPFF_tax'>Taxonomic information for plants from the global spectrum of plant form and function (complete data)</h2><span id='topic+GSPFF_tax'></span>

<h3>Description</h3>

<p>Taxonomic data for 2,630 species with complete trait information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GSPFF_tax
</code></pre>


<h3>Format</h3>

<p>## 'GSPFF_tax'
A data frame with 2,630 rows and 3 columns:
</p>

<dl>
<dt>genus</dt><dd><p>genus to which the species belongs</p>
</dd>
<dt>family</dt><dd><p>family to which the species belongs</p>
</dd>
<dt>order</dt><dd><p>order to which the species belongs</p>
</dd>
</dl>
<p>...

</p>


<h3>Source</h3>

<p>&lt;https://doi.org/10.6084/m9.figshare.13140146&gt;
</p>

<hr>
<h2 id='impute'>Imputing Trait Information</h2><span id='topic+impute'></span>

<h3>Description</h3>

<p>Imputing incomplete trait information, with the possibility of using phylogenetic information
</p>


<h3>Usage</h3>

<pre><code class='language-R'>impute(
  traits,
  phylo = NULL,
  addingSpecies = FALSE,
  nEigen = 10,
  messages = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="impute_+3A_traits">traits</code></td>
<td>
<p>A matrix or data.frame containing trait information with missing values. The rows correspond to observations (generally species) and the columns to the variables (generally traits). Traits can be continuous and/or categorical. Row names of the <code>traits</code> object must contain the names of the species. We recommend writing species name in the format &quot;Genus_species&quot; or &quot;Genus species&quot;.</p>
</td></tr>
<tr><td><code id="impute_+3A_phylo">phylo</code></td>
<td>
<p>(optional) A phylogenetic tree (an object of class &quot;phylo&quot;) containing the evolutionary relationships between species. <code>phylo</code> is used to estimate phylogenetic eigenvectors that are added to the <code>traits</code> matrix. Not all species in <code>traits</code> need to be necessarily included in <code>phylo</code>, despite this is highly recommended. Note that in order to assign phylogenetic information to species reliably, the names in <code>phylo$tip.label</code> must be exactly the same as <code>row.names(traits)</code>, although not necessarily in the same order. Note that computing cophenetic distances for very large trees (ca. 30,000 species) can result in memory allocation problems.</p>
</td></tr>
<tr><td><code id="impute_+3A_addingspecies">addingSpecies</code></td>
<td>
<p>Logical, defaults to FALSE. Should species present in the trait matrix but not in the phylogeny be added to the phylogeny? If TRUE, the <code>phytools::add.species.to.genus</code> function is used to add species to the root of the genus (in case there are any other congeneric species in the tree). Note that <code>phytools::add.species.to.genus</code> has other arguments that provide more flexibility, but those are not considered here for simplicity; users who want to make use of those options can instead modify their phylogenetic tree beforehand.</p>
</td></tr>
<tr><td><code id="impute_+3A_neigen">nEigen</code></td>
<td>
<p>The number of phylogenetic eigenvectors to be considered. Defaults to 10.</p>
</td></tr>
<tr><td><code id="impute_+3A_messages">messages</code></td>
<td>
<p>Logical, defaults to TRUE. Should the function return messages?</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>impute</code> imputes trait values in trait matrices with incomplete trait information. It uses the Random Forest approach implemented in the <code>missForest</code> package. Phylogenetic information can be incorporated in the imputation in the form of a phylogenetic tree, from which a number of phylogenetic eigenvectors are added to the trait matrix.
</p>


<h3>Value</h3>

<p>The function returns a list containing both the original trait data (incomplete) and the imputed trait data.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# GSPFF_missing dataset includes &gt;10,000 species.
# Preparing and imputing this data takes very long time.
# Let's select a small random subset:
selectSPS &lt;- 200
set.seed(2)
subset_traits &lt;- GSPFF_missing[sample(1:nrow(GSPFF_missing), selectSPS), ]
deleteTips &lt;- setdiff(phylo$tip.label, rownames(subset_traits))
subset_phylo &lt;- ape::drop.tip(phylo, tip = deleteTips)
GSPFF_subset &lt;- impute(traits = subset_traits, phylo = subset_phylo, addingSpecies = TRUE)
pca &lt;- princomp(GSPFF_subset$imputed)
funtest &lt;- funspace(pca)
plot(funtest, pnt = TRUE, pnt.cex = 0.2, arrows = TRUE)
summary(funtest)


</code></pre>

<hr>
<h2 id='phylo'>Phylogeny for species from the global spectrum of plant form and function (incomplete data)</h2><span id='topic+phylo'></span>

<h3>Description</h3>

<p>Phylogenetic tree including information for 10,746 species with incomplete trait information (species with at least three traits), contained in <code>GSPFF_missing</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phylo
</code></pre>


<h3>Format</h3>

<p>## 'phylo'
An object of class <code>"phylo"</code>
</p>

<hr>
<h2 id='plot.funspace'>Functional space plotting</h2><span id='topic+plot.funspace'></span>

<h3>Description</h3>

<p>Takes a <code>funspace</code> object produced by <code>funspace()</code> or <code>funspaceGAM()</code> and plots the trait probability distribution (TPD) or the map of the response variable (depending of which kind of funspace object is provided) in a functional space.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'funspace'
plot(
  x = NULL,
  type = "global",
  which.group = NULL,
  quant.plot = FALSE,
  quant = NULL,
  quant.lty = 1,
  quant.col = "grey30",
  quant.lwd = 1,
  quant.labels = TRUE,
  colors = NULL,
  ncolors = 100,
  pnt = FALSE,
  pnt.pch = 19,
  pnt.cex = 0.5,
  pnt.col = "grey80",
  arrows = FALSE,
  arrows.length = 1,
  arrows.head = 0.08,
  arrows.col = "black",
  arrows.label.col = "black",
  arrows.label.pos = 1.1,
  arrows.label.cex = 1,
  axis.title = TRUE,
  axis.title.x = NULL,
  axis.title.y = NULL,
  axis.title.cex = 1,
  axis.title.line = 2,
  axis.cex = 1,
  globalContour = TRUE,
  globalContour.quant = NULL,
  globalContour.lwd = 3,
  globalContour.lty = 1,
  globalContour.col = "grey50",
  xlim = NULL,
  ylim = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.funspace_+3A_x">x</code></td>
<td>
<p>A <code>funspace</code> object produced by <code>funspace()</code> or <code>funspaceGAM()</code>.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_type">type</code></td>
<td>
<p>character indicating whether the plots should represent the global distribution of observations (<code>type = "global"</code>), or be separated by the groups (<code>type = "groups"</code>) provided when the <code>funspace</code> object was created. Defaults to <code>"global"</code>. In the case of funspace objects based on a TPD function created with the <code>TPD</code> package, only groups are plotted (there is no &quot;global&quot; distribution).</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_which.group">which.group</code></td>
<td>
<p>when plotting groups, either a character or a number indicating the name (character) or position (number) of a single group to be plotted individually.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_quant.plot">quant.plot</code></td>
<td>
<p>Logical, Default is <code>TRUE</code>. Should contour lines representing quantiles (specified in <code>quant</code>) be plotted?</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_quant">quant</code></td>
<td>
<p>A vector specifying the quantiles to be plotted (in case <code>quant.plot</code> is set to <code>TRUE</code>. In case a TPD function is plotted, the quantiles represent the quantiles of the trait probability density function (lower quantiles indicate areas with higher probability density). In case a GAM object is plotted, the quantiles of the fitted response variable are plotted. In case a TPD function is plotted, default quantiles are 0.99 (or the selected threshold if it is lower), 0.5 and 0.25. In the GAM alternative, default quantiles are 0.99, 0.5 and 0.25.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_quant.lty">quant.lty</code></td>
<td>
<p>type of line to be used to represent quantiles. See <code>lty</code> argument in <code>graphics::par()</code>.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_quant.col">quant.col</code></td>
<td>
<p>Color to be used in the quantile lines. Defaults to <code>"grey30"</code>.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_quant.lwd">quant.lwd</code></td>
<td>
<p>Line width to be used in the quantile lines. Defaults to 1.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_quant.labels">quant.labels</code></td>
<td>
<p>Logical, Default is <code>TRUE</code>. Should labels be added to quantile lines?</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_colors">colors</code></td>
<td>
<p>A vector defining the colors of plotted quantiles in the TPD case. Only two colors need to be specified. The first color is automatically assigned to the highest quantile in <code>quantiles</code> (e.g. 0.99), the second color is assigned to the lowest quantile. These colors are then used to automatically generate a gradient from the greatest to the lowest quantile. Any color is admitted. Default is <code>NULL</code>, in which case <code>c("yellow", "red")</code> is used in case a trait probability density function is plotted and to <code>viridis::viridis(5)</code> in the GAM case.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_ncolors">ncolors</code></td>
<td>
<p>number of colors to include in the color gradients set by <code>colors</code>. Defaults to 100.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_pnt">pnt</code></td>
<td>
<p>Logical, defaults to <code>FALSE</code>. Should data points be added to the functional space?</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_pnt.pch">pnt.pch</code></td>
<td>
<p>Numerical. Graphical parameter to select the type of point to be drawn. Default is set to 19. See <code>pch</code> argument in <code>graphics::par()</code>..</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_pnt.cex">pnt.cex</code></td>
<td>
<p>Numerical. Graphical parameter to set the size of the points. Default is 0.5. See <code>cex</code> argument in <code>graphics::par()</code>.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_pnt.col">pnt.col</code></td>
<td>
<p>Graphical parameter to set the points color. Default is <code>"grey80"</code>.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_arrows">arrows</code></td>
<td>
<p>Logical, defaults to <code>FALSE</code>. In case the functional space is based on a PCA, should the loadings of the original traits be represented by arrows in the functional space?</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_arrows.length">arrows.length</code></td>
<td>
<p>Numerical. Graphical parameter to set the length of the arrow  (see <code>arrows</code>). Lower values lead to shorter arrows, which can help to make arrows fit within the represented functional space. Defaults to 1.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_arrows.head">arrows.head</code></td>
<td>
<p>Numerical. Graphical parameter to set the length of the arrow head (see <code>arrows</code>). Defaults to 0.08.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_arrows.col">arrows.col</code></td>
<td>
<p>Graphical parameter to set the arrows color (see <code>arrows</code>). Default is <code>"black"</code>.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_arrows.label.col">arrows.label.col</code></td>
<td>
<p>Graphical parameter to set the color of the arrows labels  color. Default is <code>"black"</code>.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_arrows.label.pos">arrows.label.pos</code></td>
<td>
<p>Numerical. Graphical parameter to set the position of the arrow labels with respect to the arrow heads. Default is 1.1, which draws arrow labels slightly beyond the arrow heads. A value of 1 means drawing labels on top of arrow heads.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_arrows.label.cex">arrows.label.cex</code></td>
<td>
<p>Numerical. Graphical parameter to set the size of arrow labels. Defaults to 1.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_axis.title">axis.title</code></td>
<td>
<p>Logical. Default is <code>TRUE</code>. Should axes titles be plotted?</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_axis.title.x">axis.title.x</code></td>
<td>
<p>Character. The title to be plotted in the x axis if <code>axis.title</code> is set to <code>TRUE</code>. If not specified, a default axis title is plotted.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_axis.title.y">axis.title.y</code></td>
<td>
<p>Character. The title to be plotted in the y axis if <code>axis.title</code> is set to <code>TRUE</code>. If not specified, a default axis title is plotted.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_axis.title.cex">axis.title.cex</code></td>
<td>
<p>Numerical. Graphical parameter to set the size of the axes titles. Default is 1.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_axis.title.line">axis.title.line</code></td>
<td>
<p>Numerical. Graphical parameter to set the on which margin line to plot axes titles. Default is 2.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_axis.cex">axis.cex</code></td>
<td>
<p>Numerical. Graphical parameter to set the size of the axes annotation. Default is 1.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_globalcontour">globalContour</code></td>
<td>
<p>Logical, Default is <code>TRUE</code>. Should a contour line representing the global distribution be plotted when <code>type</code> is set to <code>"groups"</code>. Adding a global contour lines provides a common reference for all groups and makes comparisons easier.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_globalcontour.quant">globalContour.quant</code></td>
<td>
<p>A vector specifying the quantiles to be plotted (in case <code>globalContour</code> is set to <code>TRUE</code>. Defaults to the threshold selected when the provided <code>funspace</code> object was originally created.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_globalcontour.lwd">globalContour.lwd</code></td>
<td>
<p>Line width to be used in the global contour lines. Defaults to 3.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_globalcontour.lty">globalContour.lty</code></td>
<td>
<p>type of line to be used to represent the global contour lines. See <code>lty</code> argument in <code>graphics::par()</code>. Defaults to 1 (a continuous line).</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_globalcontour.col">globalContour.col</code></td>
<td>
<p>Graphical parameter to set the color of the global contour lines. Default is <code>"grey50"</code>.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_xlim">xlim</code></td>
<td>
<p>the x limits (x1, x2) of the plot.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_ylim">ylim</code></td>
<td>
<p>the y limits (y1, y2) of the plot.</p>
</td></tr>
<tr><td><code id="plot.funspace_+3A_...">...</code></td>
<td>
<p>Other arguments</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Produces default plots. If the input object was generated with <code>funspace()</code>, the plot shows a bivariate functional trait space displaying trait probability densities (for single or multiple groups). If the input object was  generated with <code>funspaceGAM</code>, the plot shows a heatmap depicting how a target variable is distributed within the functional trait space (for single or multiple groups).
</p>


<h3>Value</h3>

<p>No return value. This function is called for its side effect: generating plots.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- princomp(GSPFF)
funtest &lt;- funspace(x = x, PCs = c(1, 2), threshold = 0.95)
plot(funtest, type = "global", quant.plot = TRUE, quant.lwd = 2, pnt = TRUE, pnt.cex = 0.1,
   pnt.col = rgb(0.1, 0.8, 0.2, alpha = 0.2), arrows = TRUE, arrows.length = 0.7)

</code></pre>

<hr>
<h2 id='summary.funspace'>Summarizing Functional Spaces</h2><span id='topic+summary.funspace'></span>

<h3>Description</h3>

<p><code>summary</code> method for class <code>funspace</code>&quot;
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'funspace'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.funspace_+3A_object">object</code></td>
<td>
<p>A <code>funspace</code> object produced by <code>funspace()</code>,
<code>funspaceGAM()</code>, or <code>funspaceNull()</code>.</p>
</td></tr>
<tr><td><code id="summary.funspace_+3A_...">...</code></td>
<td>
<p>Other arguments</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Produces default summary. If the input object was generated with <code>funspace()</code>, the summary includes information about the characteristics of the functional space (particularly if it derives from a PCA), along with functional diversity indicators (functional richness and functional divergence) for the whole set of observations and for each group (in case groups are specified). If the input object was generated with <code>funspaceGAM()</code>, the function returns the summary for the GAM models for the whole set of observations and individual groups. In the case of funspace objects based on a TPD object created with the <code>TPD</code> package, only information about groups is provided (since there is no global distribution). If the input was generated  with <code>funspaceNull()</code>, the function returns tests exploring the difference between the observed functional richness and the null model functional richness.
</p>


<h3>Value</h3>

<p>No return value. This function is called for its side effect: summarizing objects of class <code>"funspace"</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- princomp(GSPFF)
funtest &lt;- funspace(x = x, PCs = c(1, 2), threshold = 0.95)
summary(funtest)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
