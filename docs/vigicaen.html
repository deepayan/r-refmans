<!DOCTYPE html><html lang="en"><head><title>Help for package vigicaen</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {vigicaen}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#vigicaen-package'><p>vigicaen: 'VigiBase' Pharmacovigilance Database Toolbox</p></a></li>
<li><a href='#add_adr'><p>Add ADR column(s) to a dataset</p></a></li>
<li><a href='#add_drug'><p>Add DRUG column(s) to a dataset (tidyverse syntax)</p></a></li>
<li><a href='#cff'><p>Fast formatting of numbers</p></a></li>
<li><a href='#check_dm'><p>Check binary variables</p></a></li>
<li><a href='#compute_dispro'><p>Compute disproportionality</p></a></li>
<li><a href='#compute_interaction'><p>Compute interaction disproportionality</p></a></li>
<li><a href='#compute_or_mod'><p>Compute (r)OR from a model summary</p></a></li>
<li><a href='#create_example_tables'><p>Example source tables for VigiBase and MedDRA</p></a></li>
<li><a href='#demo_'><p>Data of immune checkpoint inhibitors.</p></a></li>
<li><a href='#desc_cont'><p>Summarize continuous variables</p></a></li>
<li><a href='#desc_dch'><p>Dechallenge descriptive</p></a></li>
<li><a href='#desc_facvar'><p>Summarise categorical variables</p></a></li>
<li><a href='#desc_outcome'><p>Outcome descriptive</p></a></li>
<li><a href='#desc_rch'><p>Rechallenge descriptive</p></a></li>
<li><a href='#desc_tto'><p>Time to onset descriptive</p></a></li>
<li><a href='#dt_fst'><p>Read fst and convert to data.table</p></a></li>
<li><a href='#dt_parquet'><p>Read parquet and convert to data.table</p></a></li>
<li><a href='#ex_'><p>Data for the immune checkpoint inhibitors example</p></a></li>
<li><a href='#extract_tto'><p>Time to onset extraction</p></a></li>
<li><a href='#get_atc_code'><p>Get ATC codes (DrecNos or MPIs)</p></a></li>
<li><a href='#get_drecno'><p>Get DrecNo from drug names or MedicinalProd_Id</p></a></li>
<li><a href='#get_llt_smq'><p>Extract low level terms from SMQs</p></a></li>
<li><a href='#get_llt_soc'><p>Extract low level terms from soc classification</p></a></li>
<li><a href='#ic_tail'><p>Credibility interval limits for the information component</p></a></li>
<li><a href='#meddra_'><p>Sample of Meddra.</p></a></li>
<li><a href='#mp_'><p>Sample of WHODrug</p></a></li>
<li><a href='#nice_p'><p>Nice printing of p-values</p></a></li>
<li><a href='#screen_adr'><p>Screening of Adverse Drug Reactions</p></a></li>
<li><a href='#screen_drug'><p>Screening of Drugs</p></a></li>
<li><a href='#tb_meddra'><p>Create MedDRA tables</p></a></li>
<li><a href='#tb_subset'><p>Extract of subset of Vigibase</p></a></li>
<li><a href='#tb_vigibase'><p>Create main VigiBase ECL tables</p></a></li>
<li><a href='#tb_who'><p>Create main WHO tables</p></a></li>
<li><a href='#vigi_routine'><p>Pharmacovigilance routine function</p></a></li>
<li><a href='#vigicaen-deprecated'><p>Deprecated functions in package <span class="pkg">vigicaen</span>.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>'VigiBase' Pharmacovigilance Database Toolbox</td>
</tr>
<tr>
<td>Version:</td>
<td>0.15.6</td>
</tr>
<tr>
<td>Description:</td>
<td>Perform the analysis of the World Health Organization
       (WHO) Pharmacovigilance database 'VigiBase' (Extract Case Level version),
       <a href="https://who-umc.org/">https://who-umc.org/</a>
       e.g., load data, perform data management,
       disproportionality analysis, and descriptive statistics. Intended for
       pharmacovigilance routine use or studies.
       This package is NOT supported nor reflect the opinion of the WHO, or the
       Uppsala Monitoring Centre.
       Disproportionality methods are described by Norén et 
       al (2013) &lt;<a href="https://doi.org/10.1177%2F0962280211403604">doi:10.1177/0962280211403604</a>&gt;.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.1.0),</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.cecill.info/licences/Licence_CeCILL_V2.1-en.txt">CeCILL-2.1</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>LazyDataCompression:</td>
<td>xz</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/pharmacologie-caen/vigicaen">https://github.com/pharmacologie-caen/vigicaen</a>,
<a href="https://pharmacologie-caen.github.io/vigicaen/">https://pharmacologie-caen.github.io/vigicaen/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/pharmacologie-caen/vigicaen/issues">https://github.com/pharmacologie-caen/vigicaen/issues</a></td>
</tr>
<tr>
<td>Suggests:</td>
<td>here, knitr, rmarkdown, testthat (&ge; 3.0.0), tzdb, vdiffr</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Imports:</td>
<td>arrow, cli, dplyr, data.table, fst, ggplot2, glue, gridExtra,
lifecycle, purrr, rlang, stringr, tidyr</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-03-13 15:02:24 UTC; dolladi231</td>
</tr>
<tr>
<td>Author:</td>
<td>Charles Dolladille
    <a href="https://orcid.org/0000-0003-0449-6261"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut, cre],
  Basile Chrétien <a href="https://orcid.org/0000-0002-7483-2489"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Universite de Caen Normandie [cph] (Caen, France),
  Unite de pharmaco-epidemiologie [cph] (Service de pharmacologie, Centre
    Hospitalier Universitaire de Caen, Caen, France)</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Charles Dolladille &lt;cdolladille@hotmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-03-13 15:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='vigicaen-package'>vigicaen: 'VigiBase' Pharmacovigilance Database Toolbox</h2><span id='topic+vigicaen'></span><span id='topic+vigicaen-package'></span>

<h3>Description</h3>

<p><img src="../help/figures/logo.png" style='float: right' alt='logo' width='120' />
</p>
<p>Perform the analysis of the World Health Organization (WHO) Pharmacovigilance database 'VigiBase' (Extract Case Level version), <a href="https://who-umc.org/">https://who-umc.org/</a> e.g., load data, perform data management, disproportionality analysis, and descriptive statistics. Intended for pharmacovigilance routine use or studies. This package is NOT supported nor reflect the opinion of the WHO, or the Uppsala Monitoring Centre. Disproportionality methods are described by Norén et al (2013) <a href="https://doi.org/10.1177/0962280211403604">doi:10.1177/0962280211403604</a>.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Charles Dolladille <a href="mailto:cdolladille@hotmail.com">cdolladille@hotmail.com</a> (<a href="https://orcid.org/0000-0003-0449-6261">ORCID</a>)
</p>
<p>Authors:
</p>

<ul>
<li><p> Basile Chrétien (<a href="https://orcid.org/0000-0002-7483-2489">ORCID</a>)
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> Universite de Caen Normandie (Caen, France) [copyright holder]
</p>
</li>
<li><p> Unite de pharmaco-epidemiologie (Service de pharmacologie, Centre Hospitalier Universitaire de Caen, Caen, France) [copyright holder]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/pharmacologie-caen/vigicaen">https://github.com/pharmacologie-caen/vigicaen</a>
</p>
</li>
<li> <p><a href="https://pharmacologie-caen.github.io/vigicaen/">https://pharmacologie-caen.github.io/vigicaen/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/pharmacologie-caen/vigicaen/issues">https://github.com/pharmacologie-caen/vigicaen/issues</a>
</p>
</li></ul>


<hr>
<h2 id='add_adr'>Add ADR column(s) to a dataset</h2><span id='topic+add_adr'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>Creates adr columns
in vigibase datasets (demo, link, drug, but also adr).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_adr(
  .data,
  a_code,
  a_names = names(a_code),
  adr_data,
  data_type = deprecated()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_adr_+3A_.data">.data</code></td>
<td>
<p>The dataset to update (demo, link, drug, adr).</p>
</td></tr>
<tr><td><code id="add_adr_+3A_a_code">a_code</code></td>
<td>
<p>A named list of low level terms codes (llt_codes).</p>
</td></tr>
<tr><td><code id="add_adr_+3A_a_names">a_names</code></td>
<td>
<p>A character vector. Names for adr columns (must be the
same length as adr_list), default to <code>names(a_code)</code></p>
</td></tr>
<tr><td><code id="add_adr_+3A_adr_data">adr_data</code></td>
<td>
<p>A data.frame containing the adr data (usually, it is <code>adr</code>)</p>
</td></tr>
<tr><td><code id="add_adr_+3A_data_type">data_type</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>. Data_type is now detected
internally.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Low-level term codes are the preferred level of requesting in
Vigibase extract case level since they capture all possible codes for a given
Preferred Term. Collect low-level terms with <code><a href="#topic+get_llt_soc">get_llt_soc()</a></code> and
<code><a href="#topic+get_llt_smq">get_llt_smq()</a></code>. You can add adr identification to a <code>demo</code>, a <code>link</code>, <code>drug</code>
or even an <code>adr</code> dataset (in this latter case, you must provide <code>adr</code> twice,
as <code>.data</code> and <code>adr_data</code>). Column names of these dataset should not have been
modified from the original vigibase dataset (as created with <code><a href="#topic+tb_vigibase">tb_vigibase()</a></code>).
</p>


<h3>Value</h3>

<p>A dataset with the new adr columns.
Each element of <code>a_names</code> will add a column with the same name in <code>.data</code>.
The value can be 0 (the corresponding adr is absent)
or 1 (the adr is present in the case if <code>.data</code> is <code>demo</code> or <code>drug</code>,
or &quot;this row correspond to this adr&quot;, if <code>.data</code> is <code>adr</code> or <code>link</code>).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_drug">add_drug()</a></code>, <code><a href="#topic+get_llt_soc">get_llt_soc()</a></code>, <code><a href="#topic+get_llt_smq">get_llt_smq()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># create adr_colitis, adr_embolism and adr_pneumonitis columns in demo

# be careful, this example may overwrite your own demo dataset
demo &lt;- demo_

a_pt_sel &lt;- ex_$pt_sel


adr &lt;- adr_

a_llt &lt;-
  get_llt_soc(
  term_sel = a_pt_sel,
  term_level = "pt",
  meddra = meddra_
  )

demo &lt;-
  demo |&gt;
    add_adr(
      a_code = a_llt,
      adr_data = adr
    )

demo |&gt;
  check_dm(names(a_pt_sel))
</code></pre>

<hr>
<h2 id='add_drug'>Add DRUG column(s) to a dataset (tidyverse syntax)</h2><span id='topic+add_drug'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Creates drug columns.
in vigibase datasets (demo, link, adr, but also drug).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_drug(
  .data,
  d_code,
  d_names = names(d_code),
  repbasis = "sci",
  method = c("DrecNo", "MedicinalProd_Id"),
  drug_data,
  data_type = deprecated()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_drug_+3A_.data">.data</code></td>
<td>
<p>The dataset used to identify individual reports (usually, it is <code>demo</code>)</p>
</td></tr>
<tr><td><code id="add_drug_+3A_d_code">d_code</code></td>
<td>
<p>A named list of drug codes (DrecNos or MPI). See Details.</p>
</td></tr>
<tr><td><code id="add_drug_+3A_d_names">d_names</code></td>
<td>
<p>A character vector. Names for drug columns (must be the same length as d_code), default to <code>names(d_code)</code></p>
</td></tr>
<tr><td><code id="add_drug_+3A_repbasis">repbasis</code></td>
<td>
<p>Suspect, interacting and/or concomitant.
Type initial of those you wish to select (&quot;s&quot; for suspect, &quot;c&quot; for concomitant
and &quot;i&quot; for interacting ; default to all, e.g. &quot;sci&quot;).</p>
</td></tr>
<tr><td><code id="add_drug_+3A_method">method</code></td>
<td>
<p>A character string. The type of drug code (DrecNo or MedicinalProd_Id). See details.</p>
</td></tr>
<tr><td><code id="add_drug_+3A_drug_data">drug_data</code></td>
<td>
<p>A data.frame containing the drug data (usually, it is <code>drug</code>)</p>
</td></tr>
<tr><td><code id="add_drug_+3A_data_type">data_type</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>. Data_type is now detected
internally.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>d_code</code> is a named list containing drug codes.
Either drug record numbers (e.g., from <code><a href="#topic+get_drecno">get_drecno()</a></code>), or
medicinalprod_ids (e.g., from <code><a href="#topic+get_atc_code">get_atc_code()</a></code>). Default method is to DrecNos.
</p>


<h3>Value</h3>

<p>A dataset with the new drug columns.
Each element of <code>d_names</code> will add a column with the same name in <code>.data</code>.
The value can be 0 (the corresponding drug is absent)
or 1 (the drug is present in the case if <code>.data</code> is <code>demo</code> or <code>adr</code>,
or &quot;this row correspond to this drug&quot;, if <code>.data</code> is <code>drug</code> or <code>link</code>).
</p>


<h3>Argument <code>repbasis</code></h3>

<p>Drugs can be reported according to one of three reputation bases:
</p>

<ul>
<li> <p><code>s</code> for suspect
</p>
</li>
<li> <p><code>c</code> for concomitant
</p>
</li>
<li> <p><code>i</code> for interacting
</p>
</li></ul>

<p>in the occurrence of the adverse drug reaction. To study only one of these
reputation basis, type only the corresponding letter in <code>repbasis</code>,
e.g. &quot;s&quot; for suspects, or &quot;si&quot; for suspect <strong>or</strong> interacting.
</p>
<p>You can add drug identification to a <code>demo</code>, <code>link</code>, <code>adr</code> or even <code>drug</code>
dataset.(in this latter case, you must provide <code>adr</code> twice,
as <code>.data</code> and <code>drug_data</code>)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_adr">add_adr()</a></code>, <code><a href="#topic+get_drecno">get_drecno()</a></code>, <code><a href="#topic+get_atc_code">get_atc_code()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># create a nivolumab column in demo_

d_sel_names &lt;- list(nivolumab = "nivolumab")

d_drecno &lt;- get_drecno(d_sel_names,
                        mp = mp_)
demo_ &lt;-
  add_drug(
    .data = demo_,
    d_code = d_drecno,
    method = "DrecNo",
    repbasis = "sci",
    drug_data = drug_
  )

# remember to assign the result to your actual demo dataset

# do you want to work only with cases where nivolumab was a "suspected" drug?
# change argument repbasis to "s"

demo_ &lt;-
  add_drug(
    .data = demo_,
    d_code = d_drecno,
    d_names = "nivolumab_suspected",
    method = "DrecNo",
    repbasis = "s",
    drug_data = drug_
  )

check_dm(demo_, cols = c("nivolumab", "nivolumab_suspected"))
</code></pre>

<hr>
<h2 id='cff'>Fast formatting of numbers</h2><span id='topic+cff'></span>

<h3>Description</h3>

<p>This is a formatting function for consistent number reporting.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cff(num, low_ci, up_ci, dig = 0, method = c("num_only", "num_ci", "ci"))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cff_+3A_num">num</code></td>
<td>
<p>A numeric. The number to format.</p>
</td></tr>
<tr><td><code id="cff_+3A_low_ci">low_ci</code></td>
<td>
<p>A numeric. Lower end of a confidence interval</p>
</td></tr>
<tr><td><code id="cff_+3A_up_ci">up_ci</code></td>
<td>
<p>A numeric. Upper end of a confidence interval</p>
</td></tr>
<tr><td><code id="cff_+3A_dig">dig</code></td>
<td>
<p>A numeric. Number of digits</p>
</td></tr>
<tr><td><code id="cff_+3A_method">method</code></td>
<td>
<p>What sort of printing do you need? (see Details)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Set <code>method</code> according to the printing you like: a unique number
with <code>num_only</code> (default), the number and its confidence interval
with <code>num_ci</code>, a <code>ci</code> only (for example a range of time to onset)
The function properly returns <code>NA</code> when input is missing.
</p>


<h3>Value</h3>

<p>A character vector with the formatted number(s)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>num &lt;- c(0.1, 0.02, 1.658)

cff(num)

cff(num, dig = 2)

cff(num = num[[1]],
     low_ci = num[[2]],
     up_ci = num[[3]],
     method = "num_ci",
     dig = 2)
</code></pre>

<hr>
<h2 id='check_dm'>Check binary variables</h2><span id='topic+check_dm'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Quick check
that your data management steps through <code><a href="#topic+add_adr">add_adr</a></code>
or <code><a href="#topic+add_drug">add_drug</a></code> found cases.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_dm(.data, cols)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_dm_+3A_.data">.data</code></td>
<td>
<p>A data.frame to be checked</p>
</td></tr>
<tr><td><code id="check_dm_+3A_cols">cols</code></td>
<td>
<p>A character vector, name of columns to look at (usually will be <code>d_names</code>, <code>a_names</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It is a simple wrapper around <code>dplyr::summarise()</code>.
Be careful not to supply factors with &gt; 2 levels or continuous outcome
(the function does NOT have a checker for this, so that it is faster).
Also, the function WONT work with NAs. Use <code><a href="#topic+desc_facvar">desc_facvar()</a></code>.
if you need more detailed description of your dataset.
</p>


<h3>Value</h3>

<p>A transposed data.frame, with row.names equal to <code>cols</code>, and first column
is the number of lines in <code>.data</code> where each col is equal to <code>1</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+desc_facvar">desc_facvar()</a></code>, <code><a href="#topic+add_adr">add_adr()</a></code>, <code><a href="#topic+add_drug">add_drug()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># first create some new variables

demo &lt;- demo_

demo &lt;-
  demo |&gt;
    add_adr(
      a_code = ex_$a_llt,
      adr_data = adr_
    )

 # then check the number of reports with each feature

demo |&gt;
  check_dm(names(ex_$a_llt))
</code></pre>

<hr>
<h2 id='compute_dispro'>Compute disproportionality</h2><span id='topic+compute_dispro'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Computes
bivariate (reporting) Odds-Ratio and Information Component for a drug-adr pair.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compute_dispro(
  .data,
  y,
  x,
  alpha = 0.05,
  na_format = "-",
  dig = 2,
  export_raw_values = FALSE,
  min_n_obs = 0
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compute_dispro_+3A_.data">.data</code></td>
<td>
<p>The data.table to compute from.</p>
</td></tr>
<tr><td><code id="compute_dispro_+3A_y">y</code></td>
<td>
<p>A character vector, one or more variable to explain (usually an adr).</p>
</td></tr>
<tr><td><code id="compute_dispro_+3A_x">x</code></td>
<td>
<p>A character vector, one or more explaining variable (usually a drug).</p>
</td></tr>
<tr><td><code id="compute_dispro_+3A_alpha">alpha</code></td>
<td>
<p>Alpha risk.</p>
</td></tr>
<tr><td><code id="compute_dispro_+3A_na_format">na_format</code></td>
<td>
<p>Character string to fill NA values in ror and ci legends.</p>
</td></tr>
<tr><td><code id="compute_dispro_+3A_dig">dig</code></td>
<td>
<p>Number of digits for rounding (this argument is passed to <code>cff</code>)</p>
</td></tr>
<tr><td><code id="compute_dispro_+3A_export_raw_values">export_raw_values</code></td>
<td>
<p>A logical. Should the raw values be exported?</p>
</td></tr>
<tr><td><code id="compute_dispro_+3A_min_n_obs">min_n_obs</code></td>
<td>
<p>A numeric, compute disproportionality only for pairs
with at least <code>min_n_obs</code> cases.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Significance in pharmacovigilance
analysis is only defined if the lower bound of the confidence/credibility
interval is above 1 (i.e. <code>low_ci &gt; 1</code>, or <code>ic_tail &gt; 0</code>).
Actually, the function computes an Odds-Ratio,
which is not necessarily a <strong>reporting</strong> Odds-Ratio.
</p>


<h3>Value</h3>

<p>A data.table, with ROR, IC, and their
confidence/credibility interval (at <code>1 - alpha</code>).
Significance of both (as <code>signif_or</code> and <code>signif_ic</code>, if <code>export_raw_values</code> is TRUE).
</p>
<p>A data.table with columns
</p>

<ul>
<li> <p><code>y</code> and <code>x</code>, same as input
</p>
</li>
<li> <p><code>n_obs</code> the number of observed cases
</p>
</li>
<li> <p><code>n_exp</code> the number of expected cases
</p>
</li>
<li> <p><code>orl</code> the formatted Odds-Ratio
</p>
</li>
<li> <p><code>or_ci</code> the formatted confidence interval
</p>
</li>
<li> <p><code>ic</code> the Information Component
</p>
</li>
<li> <p><code>ic_tail</code> the tail probability of the IC
</p>
</li>
<li> <p><code>ci_level</code> the confidence interval level
</p>
</li>
<li><p> Additional columns, if <code>export_raw_values</code> is <code>TRUE</code>:
</p>
</li>
<li> <p><code>a</code>, <code>b</code>, <code>c</code>, <code>d</code> the counts in the contingency table
</p>
</li>
<li> <p><code>std_er</code> the standard error of the log(OR)
</p>
</li>
<li> <p><code>or</code> the Odds-Ratio
</p>
</li>
<li> <p><code>low_ci</code> the lower bound of the confidence interval
</p>
</li>
<li> <p><code>up_ci</code> the upper bound of the confidence interval
</p>
</li>
<li> <p><code>signif_or</code> the significance of the Odds-Ratio
</p>
</li>
<li> <p><code>signif_ic</code> the significance of the Information Component
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+compute_or_mod">compute_or_mod()</a></code>, <code><a href="#topic+add_drug">add_drug()</a></code>, <code><a href="#topic+add_adr">add_adr()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Say you want to perform a disproportionality analysis between colitis and
# nivolumab among ICI cases

demo &lt;-
  demo_ |&gt;
  add_drug(
    d_code = ex_$d_drecno,
    drug_data = drug_
  ) |&gt;
  add_adr(
    a_code = ex_$a_llt,
    adr_data = adr_
  )

demo |&gt;
  compute_dispro(
    y = "a_colitis",
    x = "nivolumab"
  )

# You don't have to use the pipe syntax, if you're not familiar

compute_dispro(
    .data = demo,
    y = "a_colitis",
    x = "nivolumab"
  )


# Say you want to compute more than one univariate ror at a time.

many_drugs &lt;-
  names(ex_$d_drecno)

demo |&gt;
  compute_dispro(
    y = "a_colitis",
    x = many_drugs
  )


# could do the same with adrs

many_adrs &lt;-
  names(ex_$a_llt)

demo |&gt;
compute_dispro(
  y = many_adrs,
  x = many_drugs
)

# Export raw values if you want to built plots, or other tables.

demo |&gt;
  compute_dispro(
    y = "a_colitis",
    x = "nivolumab",
    export_raw_values = TRUE
  )

# Set a minimum number of observed cases to compute disproportionality

demo |&gt;
 compute_dispro(
 y = "a_colitis",
 x = "nivolumab",
 min_n_obs = 5
 )
</code></pre>

<hr>
<h2 id='compute_interaction'>Compute interaction disproportionality</h2><span id='topic+compute_interaction'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a> Returns the information
component of interaction for a set of 3 variables,
usually 2 drugs and an adr.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compute_interaction(
  .data,
  y,
  x,
  z,
  alpha = 0.05,
  na_format = "-",
  dig = 2,
  export_raw_values = FALSE,
  min_n_obs = 0
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compute_interaction_+3A_.data">.data</code></td>
<td>
<p>The data.table to compute from.</p>
</td></tr>
<tr><td><code id="compute_interaction_+3A_y">y</code></td>
<td>
<p>A character vector, one or more variable to explain.</p>
</td></tr>
<tr><td><code id="compute_interaction_+3A_x">x</code></td>
<td>
<p>A character vector, one or more explaining variable.</p>
</td></tr>
<tr><td><code id="compute_interaction_+3A_z">z</code></td>
<td>
<p>A character vector, one or more explaining variable.</p>
</td></tr>
<tr><td><code id="compute_interaction_+3A_alpha">alpha</code></td>
<td>
<p>Alpha risk.</p>
</td></tr>
<tr><td><code id="compute_interaction_+3A_na_format">na_format</code></td>
<td>
<p>Character string to fill NA values in ror and ci legends.</p>
</td></tr>
<tr><td><code id="compute_interaction_+3A_dig">dig</code></td>
<td>
<p>Number of digits for rounding (this argument is passed to <code>cff</code>)</p>
</td></tr>
<tr><td><code id="compute_interaction_+3A_export_raw_values">export_raw_values</code></td>
<td>
<p>A logical. Should the raw values be exported?</p>
</td></tr>
<tr><td><code id="compute_interaction_+3A_min_n_obs">min_n_obs</code></td>
<td>
<p>A numeric, compute disproportionality only for pairs
with at least <code>min_n_obs</code> cases.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Significance is similar to usual disproportionality (see <code><a href="#topic+compute_dispro">compute_dispro()</a></code>).
</p>


<h3>Value</h3>

<p>A data.table, with Information Component (IC) of interaction,
and its credibility interval (at <code>1 - alpha</code>).
Significance as <code>signif_ic</code>, if <code>export_raw_values</code> is TRUE).
</p>
<p>A data.table with columns
</p>

<ul>
<li> <p><code>y</code>, <code>x</code> and <code>z</code>, same as input
</p>
</li>
<li> <p><code>n_obs</code> the number of observed cases
</p>
</li>
<li> <p><code>n_exp</code> the number of expected cases
</p>
</li>
<li> <p><code>ic</code> the Information Component
</p>
</li>
<li> <p><code>ic_tail</code> the tail probability of the IC
</p>
</li>
<li> <p><code>ci_level</code> the confidence interval level
</p>
</li>
<li><p> Additional columns, if <code>export_raw_values</code> is <code>TRUE</code>:
</p>
</li>
<li> <p><code>a</code>, <code>b</code>, <code>c</code>, <code>d</code> the counts in the contingency table
</p>
</li>
<li> <p><code>signif_ic</code> the significance of the Information Component
</p>
</li>
<li><p> Additional columns, if <code>export_raw_values</code> is <code>TRUE</code>:
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;n_*&#8288;</code> the counts of each setting
</p>
</li>
<li> <p><code>signif_ic</code> the significance of the Information Component
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+compute_dispro">compute_dispro()</a></code>, <code><a href="#topic+compute_or_mod">compute_or_mod()</a></code>, <code><a href="#topic+add_drug">add_drug()</a></code>, <code><a href="#topic+add_adr">add_adr()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Interaction on reporting of colitis with ipilimumab and nivolumab
demo &lt;-
  demo_ |&gt;
  add_drug(
    d_code = ex_$d_drecno,
    drug_data = drug_
  ) |&gt;
  add_adr(
    a_code = ex_$a_llt,
    adr_data = adr_
  )

demo |&gt;
  compute_interaction(
    y = "a_colitis",
    x = "nivolumab",
    z = "ipilimumab"
  )

</code></pre>

<hr>
<h2 id='compute_or_mod'>Compute (r)OR from a model summary</h2><span id='topic+compute_or_mod'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Compute and format Odds-Ratio
from a model summary.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compute_or_mod(.coef_table, estimate, std_er, p_val = NULL, alpha = 0.05)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compute_or_mod_+3A_.coef_table">.coef_table</code></td>
<td>
<p>A coefficient table, see details.</p>
</td></tr>
<tr><td><code id="compute_or_mod_+3A_estimate">estimate</code></td>
<td>
<p>Quasiquoted name of estimate parameter.</p>
</td></tr>
<tr><td><code id="compute_or_mod_+3A_std_er">std_er</code></td>
<td>
<p>Quasiquoted name of standard error parameter.</p>
</td></tr>
<tr><td><code id="compute_or_mod_+3A_p_val">p_val</code></td>
<td>
<p>Quasiquoted name of p-value parameter. Optional.</p>
</td></tr>
<tr><td><code id="compute_or_mod_+3A_alpha">alpha</code></td>
<td>
<p>alpha risk.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Helper to compute and format Odds-Ratio based on
<code>summary(glm)$coefficients</code>, or any equivalent in other modelling packages.
(see examples).
Preferably, it is transformed into a data.table or data.frame before being
evaluated in the function. Otherwise, <code>compute_or_mod()</code> will transform it.
Significant OR-or column means low_ci is &gt; 1.
The <code>p_val</code> argument is only required if you wished to display a <code><a href="#topic+nice_p">nice_p()</a></code>.
</p>
<p>Output is a data.table.
Actually, the function computes an Odds-Ratio, which is not necessarily a <em>reporting</em> Odds-Ratio.
</p>


<h3>Value</h3>

<p>A data.table with OR, confidence intervals (at <code>1 - alpha</code>),
significance (<code>low_ci &gt; 1</code>) and (optionally) p-value.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+compute_dispro">compute_dispro()</a></code>, <code><a href="#topic+add_drug">add_drug()</a></code>, <code><a href="#topic+add_adr">add_adr()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Reporting Odds-Ratio of colitis with nivolumab among ICI cases.

demo &lt;-
  demo_ |&gt;
  add_drug(
    d_code = ex_$d_drecno,
    drug_data = drug_
  ) |&gt;
  add_adr(
    a_code = ex_$a_llt,
    adr_data = adr_
  )

# Compute the model
mod &lt;- glm(a_colitis ~ nivolumab, data = demo, family = "binomial")

# Extract coefficients
mod_summary &lt;-
 mod |&gt;
 summary()

coef_table &lt;-
 mod_summary$coefficients

# Transform coefficients into ORs with their CI

coef_table |&gt;
  compute_or_mod(
  estimate = Estimate,
  std_er = Std..Error,
  p_val = Pr...z..)

# Also works if you don't have a p_val column
 coef_table |&gt;
  compute_or_mod(
  estimate = Estimate,
  std_er = Std..Error)
</code></pre>

<hr>
<h2 id='create_example_tables'>Example source tables for VigiBase and MedDRA</h2><span id='topic+create_example_tables'></span><span id='topic+create_ex_main_txt'></span><span id='topic+create_ex_sub_txt'></span><span id='topic+create_ex_who_txt'></span><span id='topic+create_ex_meddra_asc'></span><span id='topic+create_ex_main_pq'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a> Write some example
tables as source text/ascii/parquet files.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_ex_main_txt(path)

create_ex_sub_txt(path)

create_ex_who_txt(path)

create_ex_meddra_asc(path)

create_ex_main_pq(path)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="create_example_tables_+3A_path">path</code></td>
<td>
<p>Character string. A folder on your computer where the tables should
be written.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>VigiBase tables and MedDRA tables are provided respectively
as text files and ascii files. The <code style="white-space: pre;">&#8288;tb_*&#8288;</code> family turns them
into parquet files. These <code style="white-space: pre;">&#8288;create_example_*&#8288;</code> functions are only used to produce
example source files to illustrate the <code style="white-space: pre;">&#8288;tb_*&#8288;</code> family, and parquet files for the
same purpose.
</p>


<h3>Value</h3>

<p>A set of text/ascii files,
as received by the Uppsala Monitoring Centre or MedDRA
</p>

<ul>
<li><p> For <code><a href="#topic+create_ex_main_txt">create_ex_main_txt()</a></code>,
DEMO.txt, DRUG.txt, LINK.txt, FOLLOWUP.txt,
ADR.txt, OUT.txt, SRCE.txt, and IND.txt
</p>
</li>
<li><p> For <code><a href="#topic+create_ex_sub_txt">create_ex_sub_txt()</a></code>,
AgeGroup_Lx.txt, Dechallenge_Lx.txt, Dechallenge2_Lx.txt,
Frequency_Lx.txt, Gender_Lx.txt, Notifier_Lx.txt, Outcome_Lx.txt,
Rechallenge_Lx.txt, Rechallenge2_Lx.txt, Region_Lx.txt, RepBasis_Lx.txt,
ReportType_Lx.txt, RouteOfAdm_Lx.txt, Seriousness_Lx.txt,
and SizeUnit_Lx.txt
</p>
</li>
<li><p> For <code><a href="#topic+create_ex_who_txt">create_ex_who_txt()</a></code>,
ATC.txt, CCODE.txt, ING.txt, MP.txt, ORG.txt,
PF.txt, PP.txt, PRT.txt, PRG.txt, SRCE.txt, STR.txt,
SUN.txt, ThG.txt, and Unit-X.txt
</p>
</li>
<li><p> For <code><a href="#topic+create_ex_meddra_asc">create_ex_meddra_asc()</a></code>,
llt.asc, mdhier.asc, smq_content.asc, smq_list.asc
</p>
</li>
<li><p> For <code><a href="#topic+create_ex_main_pq">create_ex_main_pq()</a></code>,
demo.parquet, adr.parquet, drug.parquet, link.parquet,
srce.parquet, ind.parquet, out.parquet, followup.parquet, suspdup.parquet
</p>
</li></ul>



<h3>Functions</h3>


<ul>
<li> <p><code>create_ex_sub_txt()</code>: sub txt tables
</p>
</li>
<li> <p><code>create_ex_who_txt()</code>: WHO txt tables
</p>
</li>
<li> <p><code>create_ex_meddra_asc()</code>: MedDRA txt tables
</p>
</li>
<li> <p><code>create_ex_main_pq()</code>: main parquet tables
</p>
</li></ul>


<h3>See Also</h3>

<p><code><a href="#topic+tb_vigibase">tb_vigibase()</a></code>, <code><a href="#topic+tb_who">tb_who()</a></code>, <code><a href="#topic+tb_meddra">tb_meddra()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
path &lt;- paste0(tempdir(), "/crex/")

dir.create(path)

# You may want to use different paths for each type of tables
create_ex_main_txt(path)

create_ex_sub_txt(path)

create_ex_who_txt(path)

create_ex_meddra_asc(path)

create_ex_main_pq(path)

# Remove temporary folders when you're done
unlink(path, recursive = TRUE)
</code></pre>

<hr>
<h2 id='demo_'>Data of immune checkpoint inhibitors.</h2><span id='topic+demo_'></span><span id='topic+drug_'></span><span id='topic+adr_'></span><span id='topic+link_'></span><span id='topic+followup_'></span><span id='topic+ind_'></span><span id='topic+out_'></span><span id='topic+srce_'></span>

<h3>Description</h3>

<p>Demo, drug, adr, link, ind, out, srce, and followup are the main table in
Vigibase Extract Case Level data.
In a regular workflow, you will work with those tables as R
objects (e.g. <code>demo</code>, <code>drug</code>, <code>adr</code>, <code>link</code>, <code>ind</code>, <code>out</code>, <code>srce</code>, <code>followup</code>).
These built-in example datasets use an underscore &quot;_&quot; to avoid ambiguity
with your own tables (e.g.
<code>demo_</code>, <code>drug_</code>, <code>adr_</code>, <code>link_</code>, <code>ind_</code>, <code>out_</code>, <code>srce_</code>, <code>followup_</code>).
This is a relational database, which means every table has a primary key
variable (e.g., <code>UMCReportId</code> for <code>demo_</code>. Keys will allow joints with other tables
The full details on the original structure can be found in
&quot;VigiBase Extract Case Level - file description.pdf&quot;
in your VigiBase ECL folders.
<code>demo_</code> will typically be your cornerstone table, since it contains
one row per report. It is the preferred table to update for drugs and adrs
identification before performing disproportionality analyses.
These tables are subsets of the original ones, with some of the
immune checkpoint inhibitor cases or immune-related adverse events.
All data shown in these example data are <strong>FAKE</strong>, which means
you shouldn't consider the counts and computations as accurate.
Immune checkpoint inhibitors drugs include
&quot;Ipilimumab&quot;, &quot;Atezolizumab&quot;, &quot;Durvalumab&quot;, &quot;Nivolumab&quot;, &quot;Pembrolizumab&quot;,
&quot;Avelumab&quot;, &quot;Cemiplimab&quot;,&quot;REGN 2810&quot;, &quot;Tremelimumab&quot;.
More details on how to use vigibase tables can be found in the vignettes.
<code>vignette("basic_workflow")</code>, <code>vignette("descriptive")</code>.
To build your own tables, use <code><a href="#topic+tb_vigibase">tb_vigibase()</a></code>. See <code>vignette("getting_started")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(demo_)

drug_

adr_

link_

followup_

ind_

out_

srce_
</code></pre>


<h3>Format</h3>

<p><code>demo_</code> is a data.table with 7 variables and 750 rows.
</p>

<ul>
<li> <p><code>UMCReportId</code> Integer. The unique identifier of the case report.
</p>
</li>
<li> <p><code>AgeGroup</code> Character. The age group of the patient. Correspondence
table is <code>path_sub/AgeGroup.parquet</code>.
</p>
</li>
<li> <p><code>Gender</code> Character. Case gender. <code>path_sub/Gender.parquet</code>
</p>
</li>
<li> <p><code>DateDatabase</code> Character (not date or numeric!). The date of the
latest update of the report in the database.
</p>
</li>
<li> <p><code>Type</code> Character. The type of report. <code>path_sub/ReportType.parquet</code>
</p>
</li>
<li> <p><code>Region</code> Character. The world region where the report comes from
<code>path_sub/Region.parquet</code>.
</p>
</li>
<li> <p><code>FirstDateDatabase</code> Character. The date the report was first
submitted to the database.
</p>
</li></ul>

<p><code>drug_</code> is a data.table with 10 variables and 3514 rows.
</p>

<ul>
<li> <p><code>UMCReportId</code> Integer. See <code>demo_</code>.
</p>
</li>
<li> <p><code>Drug_Id</code> Integer. The unique identifier of each drug report.
</p>
</li>
<li> <p><code>MedicinalProd_Id</code> Integer. The medicinalproduct identifier.
See <code><a href="#topic+get_atc_code">get_atc_code()</a></code>.
</p>
</li>
<li> <p><code>DrecNo</code> Integer. Drug Record Number, pivotal to identify drugs
with <code><a href="#topic+get_drecno">get_drecno()</a></code>.
</p>
</li>
<li> <p><code>Seq1</code>, <code>Seq2</code> Character. Seq 1 and 2 complement DrecNo,
in WHODrug dictionary.
</p>
</li>
<li> <p><code>Route</code> Character. The route of administration of the drug.
</p>
</li>
<li> <p><code>Basis</code> Character. The reputation basis of the drug (suspect,
concomitant, or interacting). <code>path_sub/RepBasis.parquet</code>
</p>
</li>
<li> <p><code>Amount</code> Character. The amount of drug administered.
</p>
</li>
<li> <p><code>AmountU</code> Character. The unit of the amount of drug administered.
<code>path_sub/SizeUnit.parquet</code>
</p>
</li>
<li> <p><code>Frequency</code> Character. The frequency of drug administration.
</p>
</li>
<li> <p><code>FrequencyU</code> Character. The unit of the frequency of drug
administration. <code>path_sub/Frequency.parquet</code>
</p>
</li></ul>

<p><code>adr_</code> is a data.table with 4 variables and 2133 rows.
</p>

<ul>
<li> <p><code>UMCReportId</code> Integer. See <code>demo_</code>.
</p>
</li>
<li> <p><code>Adr_Id</code> Integer. The unique identifier of each adverse event report.
</p>
</li>
<li> <p><code>MedDRA_Id</code> Integer. The MedDRA identifier of the adverse event.
It is used in <code><a href="#topic+get_llt_soc">get_llt_soc()</a></code> and <code><a href="#topic+get_llt_smq">get_llt_smq()</a></code>.
</p>
</li>
<li> <p><code>Outcome</code> Character. The outcome of the adverse event.
<code>path_sub/Outcome.parquet</code>
</p>
</li></ul>

<p><code>link_</code> is a data.table with 3 variables and 3514 rows. The version
built with <code><a href="#topic+tb_vigibase">tb_vigibase()</a></code> is slightly different than the original one.
</p>

<ul>
<li> <p><code>Drug_Id</code> and <code>Adr_Id</code> . Integers. Together, they are the key variable
of <code>link</code>. See <code>drug_</code> and <code>adr_</code>.
</p>
</li>
<li> <p><code>Dechallenge1</code> and <code>2</code> Characters. Dechallenge action and outcome.
<code>path_sub/Dechallenge.parquet</code>, <code>path_sub/Dechallenge2.parquet</code>
</p>
</li>
<li> <p><code>Rechallenge1</code> and <code>2</code> Characters. Rechallenge action and outcome.
<code>path_sub/Rechallenge.parquet</code>, <code>path_sub/Rechallenge2.parquet</code>
</p>
</li>
<li> <p><code>TimeToOnsetMin</code> and <code>Max</code> Numerics. The minimum and maximum time to
onset of the adverse event.
</p>
</li>
<li> <p><code>tto_mean</code> Numeric. The mean time to onset of the adverse event.
It is the average of <code>TimeToOnsetMin</code> and <code>Max</code>.
</p>
</li>
<li> <p><code>range</code> Numeric. The incertitude around <code>tto_mean</code>.
See <code>vignette("descriptive")</code>.
</p>
</li>
<li> <p><code>UMCReportId</code> Integer. See <code>demo_</code>.
</p>
</li></ul>

<p><code>ind_</code> is a data.table with 2 variables and 2426 rows.
</p>

<ul>
<li> <p><code>Drug_Id</code> Integer. See <code>drug_</code>.
</p>
</li>
<li> <p><code>Indication</code> Character. The indication of the drug.
</p>
</li></ul>

<p><code>out_</code> is a data.table with 3 variables and 747 rows.
</p>

<ul>
<li> <p><code>UMCReportId</code> Integer. See <code>demo_</code>.
</p>
</li>
<li> <p><code>Seriousness</code> Character. The seriousness criteria of the report.
<code>path_sub/Seriousness.parquet</code>
</p>
</li>
<li> <p><code>Serious</code> Character. Whether the case is serious or
not (&quot;N&quot; No, &quot;Y&quot; Yes)
</p>
</li></ul>

<p><code>srce_</code> is a data.table with 2 variables and 729 rows.
</p>

<ul>
<li> <p><code>UMCReportId</code> Integer. See <code>demo_</code>.
</p>
</li>
<li> <p><code>Type</code> Character. The Type of Reporter.
<code>path_sub/Notifier.parquet</code>
</p>
</li></ul>

<p><code>followup_</code> is a data.table with 2 variables and 902 rows.
</p>

<ul>
<li> <p><code>UMCReportId</code> Integer. See <code>demo_</code>.
</p>
</li>
<li> <p><code>ReplacedUMCReportId</code> Integer. Previous version of the case,
which is no longer available in <code>demo_</code>.
</p>
</li></ul>

<p>An object of class <code>data.table</code> (inherits from <code>data.frame</code>) with 3514 rows and 12 columns.
</p>
<p>An object of class <code>data.table</code> (inherits from <code>data.frame</code>) with 2133 rows and 4 columns.
</p>
<p>An object of class <code>data.table</code> (inherits from <code>data.frame</code>) with 5136 rows and 11 columns.
</p>
<p>An object of class <code>data.table</code> (inherits from <code>data.frame</code>) with 902 rows and 2 columns.
</p>
<p>An object of class <code>data.table</code> (inherits from <code>data.frame</code>) with 2426 rows and 2 columns.
</p>
<p>An object of class <code>data.table</code> (inherits from <code>data.frame</code>) with 747 rows and 3 columns.
</p>
<p>An object of class <code>data.table</code> (inherits from <code>data.frame</code>) with 729 rows and 2 columns.
</p>


<h3>Source</h3>

<p>None
</p>


<h3>References</h3>

<p>There is none
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(demo_)
demo_ |&gt; dplyr::count(AgeGroup)
</code></pre>

<hr>
<h2 id='desc_cont'>Summarize continuous variables</h2><span id='topic+desc_cont'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Summarize continuous data and
handle output format.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>desc_cont(
  .data,
  vc,
  format = "median (q1-q3) [min-max]",
  digits = 1,
  export_raw_values = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="desc_cont_+3A_.data">.data</code></td>
<td>
<p>A data.frame, where <code>vc</code> are column names of continuous variables</p>
</td></tr>
<tr><td><code id="desc_cont_+3A_vc">vc</code></td>
<td>
<p>A character vector, list of column names. Should only contain continuous variables</p>
</td></tr>
<tr><td><code id="desc_cont_+3A_format">format</code></td>
<td>
<p>A character string. How would you like the output? See details.</p>
</td></tr>
<tr><td><code id="desc_cont_+3A_digits">digits</code></td>
<td>
<p>A numeric. How many digits? This argument calls internal formatting function</p>
</td></tr>
<tr><td><code id="desc_cont_+3A_export_raw_values">export_raw_values</code></td>
<td>
<p>A logical. Should the raw values be exported?</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Many other packages provide tools to summarize data. This one is just
the package author's favorite.
This makes it much easier to map to nice labeling thereafter.
The <code>format</code> argument shows the output of the function. You can change square
and round brackets, spaces, separators... Important <code>format</code>
inputs are
</p>

<ul>
<li> <p><code>median</code> the median value
</p>
</li>
<li> <p><code>q1</code> the first quartile
</p>
</li>
<li> <p><code>q3</code> the third quartile
</p>
</li>
<li> <p><code>min</code> the minimum value
</p>
</li>
<li> <p><code>max</code> the maximum value
</p>
</li></ul>

<p>The analogous for categorical variables is <code><a href="#topic+desc_facvar">desc_facvar()</a></code>.
</p>


<h3>Value</h3>

<p>A data.frame with columns
</p>

<ul>
<li> <p><code>var</code> the variable name
</p>
</li>
<li> <p><code>level</code> NA, it is provided to have a consistent output
with <code><a href="#topic+desc_facvar">desc_facvar()</a></code>
</p>
</li>
<li> <p><code>value</code> the formatted value with possibly the median,
interquartile range, and range (see details)
</p>
</li>
<li> <p><code>n_avail</code> the number of cases with available data for this
variable.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+desc_facvar">desc_facvar()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>df &lt;-
  data.frame(
    smoke_status = c("smoker", "non-smoker",
           "smoker", "smoker",
           "smoker", "smoker",
           "non-smoker"
           ),
    age = c(60, 50, 56, 49, 75, 69, 85),
    bmi = c(18, 30, 25, 22, 23, 21, 22)
  )

# Use default formatting

desc_cont(.data = df, vc = c("age", "bmi"))

# Use custom formatting

desc_cont(.data = df,
          vc = c("age", "bmi"),
          format = "median (q1;q3)"
          )

# You might want to export raw values, to run plotting or
# other formatting functions

desc_cont(.data = df, vc = c("age", "bmi"),
          export_raw_values = TRUE)
</code></pre>

<hr>
<h2 id='desc_dch'>Dechallenge descriptive</h2><span id='topic+desc_dch'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Computes positive
dechallenge counts over a set of adr and drug pairs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>desc_dch(.data, drug_s = "drug1", adr_s = "adr1")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="desc_dch_+3A_.data">.data</code></td>
<td>
<p>A <code>link</code> data.table.</p>
</td></tr>
<tr><td><code id="desc_dch_+3A_drug_s">drug_s</code></td>
<td>
<p>A character vector, the drug column(s)</p>
</td></tr>
<tr><td><code id="desc_dch_+3A_adr_s">adr_s</code></td>
<td>
<p>A character vector, the adverse drug reaction column(s).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Counts are provided at the <strong>case</strong> level (not the drug-adr pair level).
Positive dechallenge refers to cases where drug was withdrawn or
dose-reduced and reaction abated (in part or in full).
You will need a <code>link</code> data.table, see <code><a href="#topic+link_">link_</a></code>, on which
you have added drugs and adrs with <code><a href="#topic+add_drug">add_drug()</a></code> and <code><a href="#topic+add_adr">add_adr()</a></code>.
</p>


<h3>Value</h3>

<p>A data.table with one row per drug-adr pair.
</p>

<ul>
<li> <p><code>drug_s</code> and <code>adr_s</code>, same as input
</p>
</li>
<li> <p><code>pos_dch</code>, number of positive dechallenge cases
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+link_">link_</a></code>, <code><a href="#topic+add_drug">add_drug()</a></code>, <code><a href="#topic+add_adr">add_adr()</a></code>, <code><a href="#topic+desc_tto">desc_tto()</a></code>, <code><a href="#topic+desc_rch">desc_rch()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
link_ &lt;-
  link_ |&gt;
  add_drug(
    d_code = ex_$d_groups_drecno,
    drug_data = drug_
  ) |&gt;
  add_adr(
    a_code = ex_$a_llt,
    adr_data = adr_
  )


desc_dch(link_,
         drug_s = "pd1",
         adr_s = "a_colitis")


# you can vectorize over multiple adrs and drugs

desc_dch(link_,
         drug_s = c("pd1", "pdl1"),
         adr_s = c("a_colitis", "a_pneumonitis"))
</code></pre>

<hr>
<h2 id='desc_facvar'>Summarise categorical variables</h2><span id='topic+desc_facvar'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Summarize categorical data and
handle output format.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>desc_facvar(
  .data,
  vf,
  format = "n_/N_ (pc_%)",
  digits = 0,
  pad_width = 12,
  ncat_max = 20,
  export_raw_values = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="desc_facvar_+3A_.data">.data</code></td>
<td>
<p>A data.frame, where <code>vf</code> are column names of categorical variables</p>
</td></tr>
<tr><td><code id="desc_facvar_+3A_vf">vf</code></td>
<td>
<p>A character vector</p>
</td></tr>
<tr><td><code id="desc_facvar_+3A_format">format</code></td>
<td>
<p>A character string, formatting options.</p>
</td></tr>
<tr><td><code id="desc_facvar_+3A_digits">digits</code></td>
<td>
<p>A numeric. Number of digits for the percentage (passed to interval formatting function).</p>
</td></tr>
<tr><td><code id="desc_facvar_+3A_pad_width">pad_width</code></td>
<td>
<p>A numeric. Minimum character length of value output (passed to <code>stringr::str_pad()</code>).</p>
</td></tr>
<tr><td><code id="desc_facvar_+3A_ncat_max">ncat_max</code></td>
<td>
<p>A numeric. How many levels should be allowed for all variables? See details.</p>
</td></tr>
<tr><td><code id="desc_facvar_+3A_export_raw_values">export_raw_values</code></td>
<td>
<p>A logical. Should the raw values be exported?</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Many other packages provide tools to summarize data. This one is just
the package author's favorite.
Important <code>format</code> inputs are
</p>

<ul>
<li> <p><code>n_</code> number of patients with the categorical variable at said level
</p>
</li>
<li> <p><code>N_</code> the first quartile number of patients with an available value for this variable
</p>
</li>
<li> <p><code>pc_</code> percentage of n / N
</p>
</li></ul>

<p>The format argument should contain at least the words &quot;n_&quot;, &quot;N_&quot;,
and optionally &quot;pc_&quot;.
<code>ncat_max</code> ensures that you didn't provided a continuous
variable to <code><a href="#topic+desc_facvar">desc_facvar()</a></code>. If you have many levels for one of your variables,
set to <code>Inf</code> or high value.
Equivalent for continuous data is <code><a href="#topic+desc_cont">desc_cont()</a></code>.
</p>


<h3>Value</h3>

<p>A data.frame with columns
</p>

<ul>
<li> <p><code>var</code> the variable name
</p>
</li>
<li> <p><code>level</code> the level of the variable
</p>
</li>
<li> <p><code>value</code> the formatted value with possible number of cases <code>n_</code>,
number of available cases <code>N_</code>, and percentage <code>pc_</code>, depending on
format argument.
</p>
</li>
<li> <p><code>n_avail</code> the number of cases with available data
for this variable.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+desc_cont">desc_cont()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>df1 &lt;-
  data.frame(
    smoke_status = c("smoker", "non-smoker",
           "smoker", "smoker",
           "smoker", "smoker",
           "non-smoker"
           ),
   hypertension = c(1, 1, 0, 1, 1, 1, 1),
    age = c(60, 50, 56, 49, 75, 69, 85),
    bmi = c(18, 30, 25, 22, 23, 21, 22)
  )

# Use default formatting
desc_facvar(.data = df1, vf = c("hypertension", "smoke_status"))

# Use custom formatting
desc_facvar(.data = df1,
           vf = c("hypertension", "smoke_status"),
           format = "n_ out of N_, pc_%",
           digits = 1)

# You might want to export raw values, to run plotting or
# other formatting functions

desc_facvar(.data = df1,
            vf = c("hypertension", "smoke_status"),
            export_raw_values = TRUE)
</code></pre>

<hr>
<h2 id='desc_outcome'>Outcome descriptive</h2><span id='topic+desc_outcome'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a> Compute
outcome description over a set of adr and drugs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>desc_outcome(.data, drug_s = "drug1", adr_s = "adr1")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="desc_outcome_+3A_.data">.data</code></td>
<td>
<p>An <code>adr</code> data.table. See <code><a href="#topic+adr_">adr_</a></code></p>
</td></tr>
<tr><td><code id="desc_outcome_+3A_drug_s">drug_s</code></td>
<td>
<p>A character vector, the drug column(s)</p>
</td></tr>
<tr><td><code id="desc_outcome_+3A_adr_s">adr_s</code></td>
<td>
<p>A character vector, the adverse drug reaction column(s).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>You need an <code>adr</code> data.table.
Be careful that you cannot directly filter <code>adr</code> data.table on drugs!
You first have to add drug columns to <code>adr</code>, with <code><a href="#topic+add_drug">add_drug()</a></code>.
The function reports the worst outcome into consideration for a given case,
if many are reported.
Outcomes, from best to worst are:
</p>

<ul>
<li><p> Recovered/resolved
</p>
</li>
<li><p> Recovering/resolving
</p>
</li>
<li><p> Recovered/resolved with sequelae
</p>
</li>
<li><p> Not recovered/not resolved
</p>
</li>
<li><p> Fatal
</p>
</li>
<li><p> Died- unrelated to reaction
</p>
</li>
<li><p> Died- reaction may be contributory
</p>
</li></ul>

<p>See <code>vignette("descriptive")</code> for more details.
</p>


<h3>Value</h3>

<p>A data.table with one row per drug-adr pair.
</p>

<ul>
<li> <p><code>drug_s</code> and <code>adr_s</code>, same as input
</p>
</li>
<li> <p><code>n_cas</code>, number of cases for each category
</p>
</li>
<li> <p><code>out_label</code>, the worst outcome for this drug-adr pair
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+adr_">adr_</a></code>, <code><a href="#topic+add_drug">add_drug()</a></code>, <code><a href="#topic+add_adr">add_adr()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
adr_ &lt;-
  adr_ |&gt;
  add_drug(
    d_code = ex_$d_groups_drecno,
    drug_data = drug_
  ) |&gt;
  add_adr(
    a_code = ex_$a_llt,
    adr_data = adr_
  )

desc_outcome(
  adr_,
  drug_s = "pd1",
  adr_s = "a_colitis"
  )

# you can vectorize over multiple adrs and drugs

desc_outcome(
  adr_,
  drug_s = c("pd1", "pdl1"),
  adr_s = c("a_colitis", "a_pneumonitis")
  )
</code></pre>

<hr>
<h2 id='desc_rch'>Rechallenge descriptive</h2><span id='topic+desc_rch'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Computes counts of rechallenge cases,
over a set of adr and drug pairs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>desc_rch(.data, drug_s = "drug1", adr_s = "adr1")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="desc_rch_+3A_.data">.data</code></td>
<td>
<p>A <code>link</code> data.table. See <code><a href="#topic+link_">link_</a></code>.</p>
</td></tr>
<tr><td><code id="desc_rch_+3A_drug_s">drug_s</code></td>
<td>
<p>A character string. The name of the drug column. Drug columns can be created with <code><a href="#topic+add_drug">add_drug</a></code>.</p>
</td></tr>
<tr><td><code id="desc_rch_+3A_adr_s">adr_s</code></td>
<td>
<p>A character string. The name of the adr column. Adr columns can be created with <code><a href="#topic+add_adr">add_adr</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Counts are provided at the <strong>case</strong> level (not the drug-adr pair level).
Description span from number of rechallenge cases
to <strong>informative</strong> rechallenge cases (those cases where the outcome is known).
You will need a <code>link</code> data.table, see <code><a href="#topic+link_">link_</a></code>, on which
you have added drugs and adrs with <code><a href="#topic+add_drug">add_drug()</a></code> and <code><a href="#topic+add_adr">add_adr()</a></code>.
Terminology
</p>

<ul>
<li> <p><code>Overall</code> as opposed to <code>rch</code> for rechallenged (<code>rch</code> + <code>no_rch</code> = <code>overall</code>).
</p>
</li>
<li><p> Among <code>rch</code>, <code>inf</code> (informative) as opposed to <code>non_inf</code> (<code>inf</code> + <code>non_inf</code> = <code>rch</code>)
</p>
</li>
<li><p> Among <code>inf</code>, <code>rec</code> (recurring) as opposed to <code>non_rec</code> (<code>rec</code> + <code>non_rec</code> = <code>inf</code>)
</p>
</li></ul>



<h3>Value</h3>

<p>A data.table with one row per drug-adr pair
</p>

<ul>
<li> <p><code>drug_s</code> and <code>adr_s</code>, same as input.
</p>
</li>
<li><p> Counts of <strong>overall</strong>, <strong>rch</strong>, <strong>inf</strong>, and <strong>rec</strong> cases (see details).
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+link_">link_</a></code>, <code><a href="#topic+add_drug">add_drug()</a></code>, <code><a href="#topic+add_adr">add_adr()</a></code>, <code><a href="#topic+desc_dch">desc_dch()</a></code>, <code><a href="#topic+desc_tto">desc_tto()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>link_ &lt;-
  link_ |&gt;
  add_drug(
    d_code = ex_$d_groups_drecno,
    drug_data = drug_
  ) |&gt;
  add_adr(
    a_code = ex_$a_llt,
    adr_data = adr_
  )

desc_rch(.data = link_,
         drug_s = "pd1",
         adr_s = "a_colitis")

# You can vectorize over drugs and adrs

desc_rch(.data = link_,
         adr_s = c("a_colitis", "a_pneumonitis"),
         drug_s = c("pd1", "pdl1")
         )
</code></pre>

<hr>
<h2 id='desc_tto'>Time to onset descriptive</h2><span id='topic+desc_tto'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> <code>desc_tto()</code> provides a
drug-adr pair description of time to onset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>desc_tto(.data, adr_s, drug_s, tto_time_range = 1, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="desc_tto_+3A_.data">.data</code></td>
<td>
<p>A <code>link</code> data.table. See <code><a href="#topic+link_">link_</a></code>.</p>
</td></tr>
<tr><td><code id="desc_tto_+3A_adr_s">adr_s</code></td>
<td>
<p>A character string. The name of the adr column. (see details)</p>
</td></tr>
<tr><td><code id="desc_tto_+3A_drug_s">drug_s</code></td>
<td>
<p>A character string. The name of the drug column. (see details)</p>
</td></tr>
<tr><td><code id="desc_tto_+3A_tto_time_range">tto_time_range</code></td>
<td>
<p>Incertitude range of Time to onset, in days. Defaults to 1 as recommended by umc</p>
</td></tr>
<tr><td><code id="desc_tto_+3A_...">...</code></td>
<td>
<p>Additional parameters to be passed to <code><a href="#topic+desc_cont">desc_cont()</a></code>. E.g. <code>format</code>, <code>digits</code>...</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Description of time (maximum available time) between drug initiation
and event onset. This runs at the drug-adr pair level.
Internally, it uses <code><a href="#topic+extract_tto">extract_tto()</a></code> and <code><a href="#topic+desc_cont">desc_cont()</a></code>,
You will need a <code>link</code> data.table, see <code><a href="#topic+link_">link_</a></code>, on which
you have added drugs and adrs with <code><a href="#topic+add_drug">add_drug()</a></code> and <code><a href="#topic+add_adr">add_adr()</a></code>.
you can supply extra arguments to <code><a href="#topic+desc_cont">desc_cont()</a></code> with <code>...</code>.
Uppsala Monitoring Centre recommends to use only cases where the incertitude
on time to onset is less than <strong>1 day</strong>. You can change this with <code>tto_time_range</code>.
</p>


<h3>Value</h3>

<p>A data.table with one row per drug-adr pair
</p>

<ul>
<li><p> A descriptive of time to onsets for this combination (column <code>tto_max</code>).
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+link_">link_</a></code>, <code><a href="#topic+extract_tto">extract_tto()</a></code>, <code><a href="#topic+add_drug">add_drug()</a></code>, <code><a href="#topic+add_adr">add_adr()</a></code>, <code><a href="#topic+desc_dch">desc_dch()</a></code>, <code><a href="#topic+desc_rch">desc_rch()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>link_ &lt;-
  link_ |&gt;
  add_drug(
    d_code = ex_$d_groups_drecno,
    drug_data = drug_
  ) |&gt;
  add_adr(
    a_code = ex_$a_llt,
    adr_data = adr_
  )

desc_tto(.data = link_,
         adr_s = "a_colitis",
         drug_s = "pd1")


desc_tto(.data = link_,
         adr_s = c("a_colitis", "a_pneumonitis"),
         drug_s = c("pd1", "ctla4"))
</code></pre>

<hr>
<h2 id='dt_fst'>Read fst and convert to data.table</h2><span id='topic+dt_fst'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a> Short hand to <code>as.data.table(read_fst())</code>.
File extension can be omitted.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dt_fst(path_base, name = NULL, ext = ".fst")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dt_fst_+3A_path_base">path_base</code></td>
<td>
<p>A character string, providing the path to read from.</p>
</td></tr>
<tr><td><code id="dt_fst_+3A_name">name</code></td>
<td>
<p>A character string, the file name.</p>
</td></tr>
<tr><td><code id="dt_fst_+3A_ext">ext</code></td>
<td>
<p>A character string, optional, specifying the file extension.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Output is a data.table.
The function is deprecated, with the use of parquet tables. Tables can now
be loaded <strong>IN</strong>-memory or <strong>OUT</strong> of memory with <code><a href="#topic+dt_parquet">dt_parquet</a></code>.
</p>


<h3>Value</h3>

<p>A data.table, read from <code>path_base/(name)</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dt_parquet">dt_parquet()</a></code>, <code><a href="#topic+tb_vigibase">tb_vigibase()</a></code>, <code><a href="#topic+tb_who">tb_who()</a></code>, <code><a href="#topic+tb_meddra">tb_meddra()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Say you have a data.frame stored in an fst format, such as this one
df &lt;- data.frame(a = 1:10)

path &lt;- paste0(tempdir(), "/dtfstex")
dir.create(path)

fst::write_fst(x = df,
              path = paste0(path, "/", "df.fst")
              )
# Now you have a new session without df.
rm(df)

# You may import the file directly to data.table format with dt_fst
df &lt;- dt_fst(path, "df")

# Clean up (required for CRAN checks)
unlink(path, recursive = TRUE)
</code></pre>

<hr>
<h2 id='dt_parquet'>Read parquet and convert to data.table</h2><span id='topic+dt_parquet'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Load data IN- our OUT- of memory.
File extension can be omitted.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dt_parquet(path_base, name = NULL, ext = ".parquet", in_memory = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dt_parquet_+3A_path_base">path_base</code></td>
<td>
<p>A character string, providing the path to read from.</p>
</td></tr>
<tr><td><code id="dt_parquet_+3A_name">name</code></td>
<td>
<p>Optional. A character string. The file name (if absent from <code>path_base</code>).</p>
</td></tr>
<tr><td><code id="dt_parquet_+3A_ext">ext</code></td>
<td>
<p>Optional. A character string. The file extension.</p>
</td></tr>
<tr><td><code id="dt_parquet_+3A_in_memory">in_memory</code></td>
<td>
<p>Logical, should data be loaded in memory?</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Output is a data.table.
For meddra and whodrug tables, it is still a good option to load data in-memory.
This function is wrapping <code>arrow::read_parquet()</code>, <code>dplyr::collect()</code> and
<code>data.table::as.data.table()</code> altogether.
If you want to load <strong>OUT</strong> of memory, set arg <code>in_memory</code> to FALSE.
<strong>Be careful that doing so will change the function output format</strong>.
For this latter case, the output is not a data.table, so there is no practical
benefit as compared to using <code>arrow::read_parquet()</code> directly, with
<code>as_data_frame</code> = FALSE.
</p>


<h3>Value</h3>

<p>A data.table if <code>in_memory</code> is set to <code>TRUE</code>,
a parquet Table if <code>in_memory</code> is set to <code>FALSE</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+tb_vigibase">tb_vigibase()</a></code>, <code><a href="#topic+tb_who">tb_who()</a></code>, <code><a href="#topic+tb_meddra">tb_meddra()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Say you have a data.frame stored in a parquet format, such as this one
demo &lt;-
  data.table::data.table(
    UMCReportId = c(1, 2, 3, 4),
    AgeGroup = c(1, 7, 7, 8)
  ) |&gt;
  arrow::as_arrow_table()

tmp_folder &lt;- paste0(tempdir(), "/dtparquetex")
dir.create(tmp_folder)
path_data &lt;- paste0(tmp_folder, "/")

arrow::write_parquet(demo,
                     sink = paste0(path_data, "demo.parquet")
)

# Now you have a new session without demo
rm(demo)

# You may import the file directly to data.table format with dt_parquet
demo &lt;-
  dt_parquet(path_data, "demo")

# Clean up (required for CRAN checks)
unlink(tmp_folder, recursive = TRUE)
</code></pre>

<hr>
<h2 id='ex_'>Data for the immune checkpoint inhibitors example</h2><span id='topic+ex_'></span>

<h3>Description</h3>

<p>These are a set of data to provide examples on the package.
</p>

<ul>
<li> <p><code>smq_sel</code> is a named list of smq names
</p>
</li>
<li> <p><code>pt_sel</code> is a named list of pt names
</p>
</li>
<li> <p><code>a_llt</code> is a named list of meddra llt codes related to adrs from <code>smq_sel</code> and <code>pt_sel</code>
</p>
</li>
<li> <p><code>d_drecno</code> is a named list of drecnos for immune checkpoint inhibitors (some of them)
</p>
</li>
<li> <p><code>d_groups</code> is a named list of ici classes according to icis
</p>
</li>
<li> <p><code>d_groups_drecno</code> is a named list of drecnos for drug groups
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>data(ex_)
</code></pre>


<h3>Format</h3>

<p>An object of class <code>list</code>.
</p>


<h3>Source</h3>

<p>VigiBase Extract Case Level
</p>


<h3>References</h3>

<p>There is none
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(ex_)
ex_$pt_sel
</code></pre>

<hr>
<h2 id='extract_tto'>Time to onset extraction</h2><span id='topic+extract_tto'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> <code>extract_tto()</code> collects
all available time to onsets for a set of drug-adr pairs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_tto(.data, adr_s, drug_s, tto_time_range = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="extract_tto_+3A_.data">.data</code></td>
<td>
<p>A <code>link</code> data.table. See <code><a href="#topic+link_">link_</a></code>.</p>
</td></tr>
<tr><td><code id="extract_tto_+3A_adr_s">adr_s</code></td>
<td>
<p>A character string. The name of the adr column. (see details)</p>
</td></tr>
<tr><td><code id="extract_tto_+3A_drug_s">drug_s</code></td>
<td>
<p>A character string. The name of the drug column. (see details)</p>
</td></tr>
<tr><td><code id="extract_tto_+3A_tto_time_range">tto_time_range</code></td>
<td>
<p>Incertitude range of Time to onset, in days. Defaults to 1 as recommended by umc</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Extraction of (maximum available) time between drug initiation
and event onset. This runs at the drug-adr pair level.
You will need a <code>link</code> data.table, see <code><a href="#topic+link_">link_</a></code>, on which
you have added drugs and adrs with <code><a href="#topic+add_drug">add_drug()</a></code> and <code><a href="#topic+add_adr">add_adr()</a></code>.
Uppsala Monitoring Centre recommends to use only cases where the incertitude
on time to onset is less than <strong>1 day</strong>. You can change this with <code>tto_time_range</code>.
You might want to use <code><a href="#topic+desc_tto">desc_tto()</a></code> to obtain summary statistics of
time to onset, but <code>extract_tto()</code> is useful to get the raw data and plot it,
for instance with <code>ggplot2</code>.
</p>


<h3>Value</h3>

<p>A data.frame with
</p>

<ul>
<li><p> All available time to onsets for this combination (column <code>tto_max</code>).
</p>
</li>
<li> <p><code>adr_s</code> and <code>drug_s</code>, same as input.
</p>
</li>
<li> <p><code>UMCReportId</code>, the unique identifier of the case.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+link_">link_</a></code>, <code><a href="#topic+desc_tto">desc_tto()</a></code>, <code><a href="#topic+add_drug">add_drug()</a></code>, <code><a href="#topic+add_adr">add_adr()</a></code>, <code><a href="#topic+desc_dch">desc_dch()</a></code>, <code><a href="#topic+desc_rch">desc_rch()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>link_ &lt;-
  link_ |&gt;
  add_drug(
    d_code = ex_$d_groups_drecno,
    drug_data = drug_
  ) |&gt;
  add_adr(
    a_code = ex_$a_llt,
    adr_data = adr_
  )

extract_tto(.data = link_,
         adr_s = "a_colitis",
         drug_s = "pd1")
extract_tto(.data = link_,
         adr_s = c("a_colitis", "a_pneumonitis"),
         drug_s = c("pd1", "ctla4"))
</code></pre>

<hr>
<h2 id='get_atc_code'>Get ATC codes (DrecNos or MPIs)</h2><span id='topic+get_atc_code'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Collect
Drug Record Numbers or MedicinalProd_Ids associated to one or more ATC classes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_atc_code(atc_sel, mp, thg_data, vigilyze = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_atc_code_+3A_atc_sel">atc_sel</code></td>
<td>
<p>A named list of ATC codes. See Details.</p>
</td></tr>
<tr><td><code id="get_atc_code_+3A_mp">mp</code></td>
<td>
<p>A modified MP data.table. See <code><a href="#topic+mp_">mp_</a></code></p>
</td></tr>
<tr><td><code id="get_atc_code_+3A_thg_data">thg_data</code></td>
<td>
<p>A data.table. Correspondence between ATC codes and MedicinalProd_Id (usually, it is <code>thg</code>)</p>
</td></tr>
<tr><td><code id="get_atc_code_+3A_vigilyze">vigilyze</code></td>
<td>
<p>A logical. Should ATC classes be retrieved using the vigilyze style? See details</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>get_atc_code()</code> is an <em>ID collector</em> function. Provide <code>atc_sel</code> in the same way as <code>d_sel</code> in <code><a href="#topic+add_drug">add_drug()</a></code>,
but remember to specify its method arg as <code>MedicinalProd_Id</code> if
<code>vigilyze</code> is set to <code>FALSE</code>.
Vigilyze style means all conditioning of drugs will be retrieved after
requesting an ATC class (i.e., drugs are identified with their DrecNos),
even if a specific conditioning is not present in the ATC class.
This is the default behavior in vigilyze.
</p>


<h3>Value</h3>

<p>A named list of integers. <strong>DrecNos</strong> if <code>vigilyze</code> is set to <code>TRUE</code>,
or <strong>MedicinalProd_Ids</strong> if <code>vigilyze</code> is set to <code>FALSE</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mp_">mp_</a></code>, <code><a href="#topic+thg_">thg_</a></code>, <code><a href="#topic+add_drug">add_drug()</a></code>, <code><a href="#topic+get_drecno">get_drecno()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># ## Find codes associated with one or more atc classes

# First, define which atc you want to use

atc_sel &lt;-
     rlang::list2(l03_j01 = c("L03AA", "J01CA"),
                  c09aa = c("C09AA")
     )

# You can get DrecNos for you ATCs (if vigilyze is TRUE)

atc_drecno &lt;-
  get_atc_code(atc_sel = atc_sel,
               mp = mp_,
               thg_data = thg_,
               vigilyze = TRUE)

# Or you can get MedicinalProd_Ids (if vigilyze is FALSE)

atc_mpi &lt;-
  get_atc_code(atc_sel = atc_sel,
               mp = mp_,
               thg_data = thg_,
               vigilyze = FALSE)
</code></pre>

<hr>
<h2 id='get_drecno'>Get DrecNo from drug names or MedicinalProd_Id</h2><span id='topic+get_drecno'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Collect
Drug Record Numbers associated to one or more drugs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_drecno(
  d_sel,
  mp,
  allow_combination = TRUE,
  method = c("drug_name", "mpi_list"),
  verbose = TRUE,
  show_all = deprecated(),
  inspect = deprecated()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_drecno_+3A_d_sel">d_sel</code></td>
<td>
<p>A named list. Selection of drug names or medicinalprod_id. See details</p>
</td></tr>
<tr><td><code id="get_drecno_+3A_mp">mp</code></td>
<td>
<p>A modified MP data.table. See <code><a href="#topic+mp_">mp_</a></code></p>
</td></tr>
<tr><td><code id="get_drecno_+3A_allow_combination">allow_combination</code></td>
<td>
<p>A logical. Should fixed associations including the drug of interest be retrieved? See details.</p>
</td></tr>
<tr><td><code id="get_drecno_+3A_method">method</code></td>
<td>
<p>Should DrecNo be found from drug names or from MedicinalProd_Id?</p>
</td></tr>
<tr><td><code id="get_drecno_+3A_verbose">verbose</code></td>
<td>
<p>A logical. Allows you to see matching drug names in the console.
Turn to FALSE once you've checked the matching.</p>
</td></tr>
<tr><td><code id="get_drecno_+3A_show_all">show_all</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>  Use <code>verbose</code> instead.</p>
</td></tr>
<tr><td><code id="get_drecno_+3A_inspect">inspect</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a> Use <code>verbose</code> instead.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>get_drecno()</code> is an <em>ID collector</em> function.
Collected IDs can be used to create drug columns in datasets
like <code>demo</code>, <code>link</code>, etc. (see <code>vignette("basic_workflow")</code>)
</p>


<h3>Value</h3>

<p>A named list of integers. DrecNos.
</p>


<h3>Argument <code>verbose</code></h3>

<p>The <code>verbose</code> argument is here to let you check
the result of <code>get_drecno()</code>. This is an important step in your
project setup: You must ensure that the drugs you are looking for
are correctly matched.
</p>


<h3>Argument <code>d_sel</code></h3>

<p><code>d_sel</code> must be a named list of character vectors.
To learn why, see <code>vignette("basic_workflow")</code>.
Names of <code>d_sel</code> are automatically lowered and trimed.
</p>


<h3>Matching drugs</h3>

<p>With &quot;drug_name&quot; method, either exact match or perl regex
match can be used. The latter
is built upon lookarounds to ensure that a string does not match to
composite drug names including the string,
i.e. <code style="white-space: pre;">&#8288;trastuzumab emtasine&#8288;</code> for <code>trastuzumab</code>, or close names
like <code>alitretinoin</code> when looking for <code>tretinoin</code>.
</p>
<p>Exact match is used for &quot;mpi_list&quot; method.
</p>


<h3>Choosing a method</h3>

<p>&quot;drug_name&quot; let you work with drug names. It's likely to be
the appropriate method in most of the cases.
</p>
<p>&quot;mpi_list&quot; is used when you have a list of MedicinalProd_Ids.
A drug can have multiple MedicinalProd_Ids, corresponding to
different packagings. The MedicinalProd_Id matching is typically used to identify DrecNo(s)
contained in an ATC class (extracted from <code>thg</code>), since not all MPI of drugs are present in <code>thg</code> (explanations in <code><a href="#topic+get_atc_code">get_atc_code()</a></code>).
</p>


<h3>WHO names</h3>

<p>WHO names are attributed to drugs by... the WHO.
A drug only has one WHO name, but can have multiple
international nonproprietary names (e.g. &quot;tretinoin&quot; and
&quot;all-trans retinoic acid&quot;).
</p>
<p>You should use WHO names to ensure proper identification of
drugs and DrecNos, especially if you work with combinations.
</p>


<h3>Argument <code>allow_combination</code></h3>

<p>Fixed associations of drugs refers to specialty containing
more than one active ingredient (for example,
acetylsalicylic acid and clopidogrel).
In VigiLyze, the default is <strong>NOT</strong> to account for
these fixed associations. For example, when you
call &quot;acetylsalicylic acid&quot; in VigiLyze, you don't have the cases
reported with the fixed-association &quot;acetylsalicylic acid; clopidogrel&quot;
<strong>unless the substances were distinctly coded by the reporter.</strong>
Here, the default is to find a drug even if it is prescribed in a fixed association.
Importantly, when retrieving fixed-association drugs, the non-of-interest
drug alone drecno is not found, hence the cases related to this drug will not be added to those of the drug of interest.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_drug">add_drug()</a></code>, <code><a href="#topic+get_atc_code">get_atc_code()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

# ## Get drecnos for a list a drugs. Check spelling and use WHO name,
# in lowercase

d_sel_names &lt;- list(
  nivolumab = "nivolumab",
  ipilimumab = "ipilimumab",
  nivo_ipi = c("nivolumab", "ipilimumab")
  )

# Read mp with get_drecno(), to identify drugs without combinations

# Take the time to read the matching drugs. Did you forget a drug?

d_drecno &lt;-
  get_drecno(d_sel_names,
             mp = mp_,
             allow_combination = FALSE,
             method = "drug_name")
d_drecno

# And DrecNos of drugs allowing for combinations

d_drecno &lt;-
  get_drecno(d_sel = d_sel_names,
             mp = mp_,
             allow_combination = TRUE,
             method = "drug_name")
d_drecno

</code></pre>

<hr>
<h2 id='get_llt_smq'>Extract low level terms from SMQs</h2><span id='topic+get_llt_smq'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Collect llts from <code>smq_list</code>
and <code>smq_content</code> data.tables, given an SMQ.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_llt_smq(
  smq,
  smq_scope = c("narrow", "broad"),
  smq_list,
  smq_content,
  smq_list_content = deprecated()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_llt_smq_+3A_smq">smq</code></td>
<td>
<p>A named list of character vector of length 1.</p>
</td></tr>
<tr><td><code id="get_llt_smq_+3A_smq_scope">smq_scope</code></td>
<td>
<p>A character vector. One of &quot;narrow&quot; or &quot;broad&quot;.</p>
</td></tr>
<tr><td><code id="get_llt_smq_+3A_smq_list">smq_list</code></td>
<td>
<p>A data.table. A list of SMQs.</p>
</td></tr>
<tr><td><code id="get_llt_smq_+3A_smq_content">smq_content</code></td>
<td>
<p>A data.table. A list of SMQs content.</p>
</td></tr>
<tr><td><code id="get_llt_smq_+3A_smq_list_content">smq_list_content</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a></p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>get_llt_smq()</code> is an <em>ID collector</em> function. SMQ stands for Standardized MedDRA query.
<code>get_llt_smq()</code>only works with NON-algorithmic SMQs
(this status is given in the smq_list table).
See <code><a href="#topic+smq_list_">smq_list_</a></code> and <code><a href="#topic+smq_content_">smq_content_</a></code>. You can choose
between the narrow and the broad scope of the SMQ.
If you want to work with the SOC hierarchy, use <code><a href="#topic+get_llt_soc">get_llt_soc()</a></code>.
</p>


<h3>Value</h3>

<p>A named list of integers. Low-level term codes.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_llt_soc">get_llt_soc()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Finding llt codes for Embolism (SMQ)

smq_sel &lt;- rlang::list2(
  embolism = "Embolic and thrombotic events, venous (SMQ)"
 )
get_llt_smq(smq_sel,
                smq_scope = "narrow",
                smq_list = smq_list_,
                smq_content = smq_content_
                )

# You can query multiple SMQs in one item, and query high level SMQs
smq_sel2 &lt;-
  rlang::list2(
    sepsis = c("Sepsis (SMQ)","Toxic-septic shock conditions (SMQ)"),
    ischemic_heart_disease = c("Ischaemic heart disease (SMQ)"),
  )

get_llt_smq(smq_sel2,
            smq_scope = "narrow",
            smq_list = smq_list_,
            smq_content = smq_content_
            )

</code></pre>

<hr>
<h2 id='get_llt_soc'>Extract low level terms from soc classification</h2><span id='topic+get_llt_soc'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Collect llt codes from a <code>meddra</code>
data.table, given another term of the MedDRA SOC Hierarchy.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_llt_soc(
  term_sel,
  term_level = c("soc", "hlgt", "hlt", "pt", "llt"),
  meddra,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_llt_soc_+3A_term_sel">term_sel</code></td>
<td>
<p>A named list of character vector(s). The terms to extract llts codes from. See details.</p>
</td></tr>
<tr><td><code id="get_llt_soc_+3A_term_level">term_level</code></td>
<td>
<p>A character string. One of &quot;soc&quot;, &quot;hlgt&quot;, &quot;hlt&quot;, &quot;pt&quot;, or &quot;llt&quot;</p>
</td></tr>
<tr><td><code id="get_llt_soc_+3A_meddra">meddra</code></td>
<td>
<p>A data.table. Built from meddra_builders functions</p>
</td></tr>
<tr><td><code id="get_llt_soc_+3A_verbose">verbose</code></td>
<td>
<p>Logical. Allows you to see matching reactions in the console.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>get_llt_soc()</code> is an <em>ID collector</em> function. The function extracts low level term codes.
<code>get_llt_soc()</code> is <strong>case-sensitive</strong>, and MedDRA terms always begin with a capital letter,
in their native version.
In <code>term_sel</code>, all terms should come from the same hierarchical level,
e.g. all preferred terms, all high level terms, etc.
</p>


<h3>Value</h3>

<p>A named list of integers. Low-level term codes.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_llt_smq">get_llt_smq()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

## Finding llt codes for colitis

pt_sel &lt;- rlang::list2(
  colitis = c("Colitis",
              "Autoimmune colitis"),
  pneumonitis = c("Pneumonitis",
                  "Organising pneumonia")
  )

hlt_sel &lt;- rlang::list2(
  colitis = c("Gastrointestinal inflammatory disorders NEC"),
  pneumonitis = c("Pulmonary thrombotic and embolic conditions")
  )

# Remember you can use more than one term to define each adverse reaction,
# but they should all be at the same hierarchical level in meddra.

# with preferred terms

get_llt_soc(
  term_sel = pt_sel,
  term_level = "pt",
  meddra = meddra_
  )

# with high level terms

get_llt_soc(
  term_sel = hlt_sel,
  term_level = "hlt",
  meddra = meddra_
  )

</code></pre>

<hr>
<h2 id='ic_tail'>Credibility interval limits for the information component</h2><span id='topic+ic_tail'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Compute
the Information Component credibility interval, typically the lower end of
the 95% CI, also known as the IC025.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ic_tail(n_obs, n_exp, p = 0.025)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ic_tail_+3A_n_obs">n_obs</code></td>
<td>
<p>Number of observed cases</p>
</td></tr>
<tr><td><code id="ic_tail_+3A_n_exp">n_exp</code></td>
<td>
<p>Number of expected cases (see Details)</p>
</td></tr>
<tr><td><code id="ic_tail_+3A_p">p</code></td>
<td>
<p>End of chosen credibility interval</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The ends of the credibility interval of the information component
are estimated with the gamma distribution.
<code>n_exp</code> is defined as <code>n_drug * n_event / n_total</code> for the basic IC
(formula is different for interactions)
Do not add <code>+.5</code> to <code>n_obs</code> and <code>n_exp</code> as it is automatically done in the function.
By default, IC025 is computed. Change <code>p</code> for different ends.
It may be easier to use <code><a href="#topic+compute_dispro">compute_dispro()</a></code>, which internally calls this function.
</p>


<h3>Value</h3>

<p>A numeric vector. The lower end of the credibility interval
</p>


<h3>See Also</h3>

<p><code><a href="#topic+compute_dispro">compute_dispro()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
ic_tail(n_obs = 12,
        n_exp = 5)

</code></pre>

<hr>
<h2 id='meddra_'>Sample of Meddra.</h2><span id='topic+meddra_'></span><span id='topic+smq_list_content_'></span><span id='topic+smq_list_'></span><span id='topic+smq_content_'></span>

<h3>Description</h3>

<p>Anonymized data from MedDRA, used to illustrate the package examples and vignettes.
You can find term codes related to colitis, pneumonitis, hepatitis, a SMQ of
embolisms.
Compounds are <code>meddra_</code>, <code>smq_list_</code>, <code>smq_content_</code> and <code>smq_list_content_</code>.
Create dedicated .parquet files using <code><a href="#topic+tb_meddra">tb_meddra()</a></code>.
See examples in <code><a href="#topic+get_llt_soc">get_llt_soc</a></code> and <code><a href="#topic+get_llt_smq">get_llt_smq</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(meddra_)

smq_list_content_

smq_list_

smq_content_
</code></pre>


<h3>Format</h3>

<p><code>meddra_</code> is a data.table with 15 variables and 677 rows.
</p>

<ul>
<li><p> The <code style="white-space: pre;">&#8288;*_code&#8288;</code> columns. Integers. MedDRA code for the given term.
</p>
</li>
<li><p> The <code style="white-space: pre;">&#8288;*_name&#8288;</code> columns. Characters. The name of the term.
</p>
</li>
<li> <p><code>soc_abbrev</code> Character. The abbreviation of the SOC.
</p>
</li>
<li> <p><code>null_field</code> Logical. Empty column.
</p>
</li>
<li> <p><code>pt_soc_code</code> Integer. The preferred term code of the SOC itself.
</p>
</li>
<li> <p><code>primary_soc_fg</code> Character. Whether the SOC is primary for this code.
&quot;Y&quot; or &quot;N&quot;, Yes or No.
</p>
</li>
<li> <p><code>empty_col</code> Logical. Empty column.
</p>
</li></ul>

<p><code>smq_list_</code> is a data.table with 9 variables and 11 rows.
It is the list of SMQ.
</p>

<ul>
<li> <p><code>smq_code</code> Integer. The code of the SMQ.
</p>
</li>
<li> <p><code>smq_name</code> Character. The name of the SMQ.
</p>
</li>
<li> <p><code>smq_level</code> Integer. The hierarchical level of the SMQ.
</p>
</li>
<li> <p><code>smq_description</code> Character. The description of the SMQ.
</p>
</li>
<li> <p><code>smq_source</code> Character. The source of the SMQ.
</p>
</li>
<li> <p><code>smq_note</code> Character. Additional note on the SMQ.
</p>
</li>
<li> <p><code>MedDRA_version</code> Numeric. The version of MedDRA.
</p>
</li>
<li> <p><code>status</code> Character. The status of the SMQ (active or not)
</p>
</li>
<li> <p><code>smq_algorithm</code> Character. Whether the SMQ is algorithmic or not.
</p>
</li>
<li> <p><code>empty_col</code> Logical. Empty column.
</p>
</li></ul>

<p><code>smq_content_</code> is a data.table with 9 variables and 3386 rows.
It is the content of each SMQ.
</p>

<ul>
<li> <p><code>smq_code</code> Integer. The code of the SMQ.
</p>
</li>
<li> <p><code>term_code</code> Integer. The low-level term code.
</p>
</li>
<li> <p><code>term_level</code> Integer. The hierarchical level of the term.
</p>
</li>
<li> <p><code>term_scope</code> Integer. The scope of the term (narrow 2 or broad 1)
</p>
</li>
<li> <p><code>term_category</code> Character. In algorithmic SMQs, the category of the term.
</p>
</li>
<li> <p><code>term_weight</code> Integer. The weight of the term (algorithmic SMQs).
</p>
</li>
<li> <p><code>term_status</code> Integer. The status of the term (active or not)
</p>
</li>
<li> <p><code>term_addition_version</code> Numeric. The version of the term addition.
</p>
</li>
<li> <p><code>term_last_modified_version</code> Numeric. The last MedDRA version
the term was modified.
</p>
</li>
<li> <p><code>empty_col</code> Logical. Empty column.
</p>
</li></ul>

<p><code>smq_list_content_</code> is a data.table with 19 variables and 3386 rows.
It is a fusion of smq_list and smq_content, as created with <code><a href="#topic+tb_meddra">tb_meddra()</a></code>.
</p>

<ul>
<li> <p><code>smq_code</code> Integer. The code of the SMQ.
</p>
</li>
<li> <p><code>smq_name</code> Character. The name of the SMQ.
</p>
</li>
<li> <p><code>smq_level</code> Integer. The hierarchical level of the SMQ.
</p>
</li>
<li> <p><code>smq_description</code> Character. The description of the SMQ.
</p>
</li>
<li> <p><code>smq_source</code> Character. The source of the SMQ.
</p>
</li>
<li> <p><code>smq_note</code> Character. Additional note on the SMQ.
</p>
</li>
<li> <p><code>MedDRA_version</code> Numeric. The version of MedDRA.
</p>
</li>
<li> <p><code>status</code> Character. The status of the SMQ (active or not)
</p>
</li>
<li> <p><code>smq_algorithm</code> Character. Whether the SMQ is algorithmic or not.
</p>
</li>
<li> <p><code>empty_col.x</code> Logical. Empty column.
</p>
</li>
<li> <p><code>term_code</code> Integer. The low-level term code.
</p>
</li>
<li> <p><code>term_level</code> Integer. The hierarchical level of the term.
</p>
</li>
<li> <p><code>term_scope</code> Integer. The scope of the term (narrow 2 or broad 1)
</p>
</li>
<li> <p><code>term_category</code> Character. In algorithmic SMQs, the category of the term.
</p>
</li>
<li> <p><code>term_weight</code> Integer. The weight of the term (algorithmic SMQs).
</p>
</li>
<li> <p><code>term_status</code> Integer. The status of the term (active or not)
</p>
</li>
<li> <p><code>term_addition_version</code> Numeric. The version of the term addition.
</p>
</li>
<li> <p><code>term_last_modified_version</code> Numeric. The last MedDRA version
the term was modified.
</p>
</li>
<li> <p><code>empty_col.y</code> Logical. Empty column.
</p>
</li></ul>

<p>An object of class <code>data.table</code> (inherits from <code>data.frame</code>) with 3386 rows and 19 columns.
</p>
<p>An object of class <code>data.table</code> (inherits from <code>data.frame</code>) with 11 rows and 9 columns.
</p>
<p>An object of class <code>data.table</code> (inherits from <code>data.frame</code>) with 3386 rows and 9 columns.
</p>


<h3>Source</h3>

<p>None
</p>


<h3>References</h3>

<p>There is none
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(meddra_)
</code></pre>

<hr>
<h2 id='mp_'>Sample of WHODrug</h2><span id='topic+mp_'></span><span id='topic+thg_'></span>

<h3>Description</h3>

<p>A small part of WHODrug, used to illustrate the package examples and vignettes.
You can find DrecNo related to immune checkpoint inhibitors, paracetamol,
tramadol, tretinoin, anti-thrombin iii, and ATC classes
L03AA Colony stimulating factors, C09AA ACE inhibitors, plain,
J01CA Penicillins with extended spectrum.
Compounds are <code>thg_</code> and <code>mp_</code>.
See examples in <code><a href="#topic+get_drecno">get_drecno</a></code> and <code><a href="#topic+get_atc_code">get_atc_code</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(mp_)

thg_
</code></pre>


<h3>Format</h3>

<p><code>mp_</code> is a data.table with 8 variables and 14146 rows.
</p>

<ul>
<li> <p><code>MedicinalProd_Id</code> Integer. The medicinalproduct identifier.
</p>
</li>
<li> <p><code>Sequence.number.1</code> and <code>2</code> Characters. Complement to DrecNo.
</p>
</li>
<li> <p><code>DrecNo</code> Character. Drug Record Number, pivotal to identify drugs
with <code><a href="#topic+get_drecno">get_drecno()</a></code>.
</p>
</li>
<li> <p><code>drug_name_t</code> Character. The name of the drug. Compared to the
original <code>drug_name</code> variable in <code>mp</code> table,
this variable is trimmed for white spaces, and names
are in lowercase.
</p>
</li>
<li> <p><code>Create.date</code> Character. The date the record was created.
</p>
</li>
<li> <p><code>Date.changed</code> Character. The date the record was last changed.
</p>
</li>
<li> <p><code>Country</code> Character. The country where the record was created.
</p>
</li></ul>

<p><code>thg_</code> is a data.table with 5 variables and 4079 rows.
</p>

<ul>
<li> <p><code>Therapgroup_Id</code> Integer. The identifier of the therapeutic group.
</p>
</li>
<li> <p><code>ATC.code</code> Character. The ATC code of the drug.
</p>
</li>
<li> <p><code>Create.date</code> Character. The date the record was created.
</p>
</li>
<li> <p><code>Official.ATC.code</code> Character. Whether the ATC code
is official (Yes/No).
</p>
</li>
<li> <p><code>MedicinalProd_Id</code> Integer. The medicinalproduct identifier.
</p>
</li></ul>

<p>An object of class <code>data.table</code> (inherits from <code>data.frame</code>) with 4079 rows and 5 columns.
</p>


<h3>Source</h3>

<p>None
</p>


<h3>References</h3>

<p>There is none
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mp_)
</code></pre>

<hr>
<h2 id='nice_p'>Nice printing of p-values</h2><span id='topic+nice_p'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Formatting function
for consistent p-value reporting.
</p>
<p>You can choose to print the leading zero (e.g. <code>0.01</code>) or not
(e.g. <code>.01</code>) with <code>print_zero</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nice_p(p_val, print_zero = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="nice_p_+3A_p_val">p_val</code></td>
<td>
<p>A numeric. The p-value to format.</p>
</td></tr>
<tr><td><code id="nice_p_+3A_print_zero">print_zero</code></td>
<td>
<p>A logical. Should leading zero be printed? (see Details)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A character vector with the formatted p-value(s)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>pvals &lt;-
  c(0.056548, 0.0002654, 0.816546, 0.0493321)
nice_p(pvals)

nice_p(pvals, print_zero = TRUE)
</code></pre>

<hr>
<h2 id='screen_adr'>Screening of Adverse Drug Reactions</h2><span id='topic+screen_adr'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
Identify and rank the
most frequently reported adverse drug reaction (ADR) terms
in a dataset, based on a specified MedDRA term level.
It allows users to filter terms by a frequency
threshold or extract the top <code>n</code> most frequently occurring terms.
</p>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="screen_adr_+3A_.data">.data</code></td>
<td>
<p>An <code>adr</code> data.table. See <code><a href="#topic+adr_">adr_</a></code></p>
</td></tr>
<tr><td><code id="screen_adr_+3A_meddra">meddra</code></td>
<td>
<p>A <code>meddra</code> data.table. See <code><a href="#topic+meddra_">meddra_</a></code></p>
</td></tr>
<tr><td><code id="screen_adr_+3A_term_level">term_level</code></td>
<td>
<p>A character string specifying the
MedDRA hierarchy level. Must be one
of <code>"soc"</code>, <code>"hlgt"</code>, <code>"hlt"</code>, <code>"pt"</code>, or <code>"llt"</code>.</p>
</td></tr>
<tr><td><code id="screen_adr_+3A_freq_threshold">freq_threshold</code></td>
<td>
<p>A numeric value indicating
the minimum frequency (as a proportion) of cases
where a term must appear to be included in the results.
For example, <code>0.05</code> means 5%. Defaults to <code>NULL</code>,
meaning no threshold is applied unless <code>top_n</code>
is different from <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="screen_adr_+3A_top_n">top_n</code></td>
<td>
<p>An integer specifying the number of most
frequently occurring terms to return.
Defaults to <code>NULL</code>. Overrides <code>freq_threshold</code> if both are provided.</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li><p> If <code>freq_threshold</code> is set (e.g., <code>0.05</code>), the function
filters ADR terms appearing in at least 5% of unique reports in <code>.data</code>.
</p>
</li>
<li><p> If <code>top_n</code> is specified, only the most frequent <code>n</code> terms
are returned. If both <code>freq_threshold</code> and <code>top_n</code> are provided,
only <code>top_n</code> is applied (a warning is issued in such cases).
</p>
</li>
<li><p> Counts are computed at the <em>case</em> level, not the ADR level.
This means frequencies reflect the proportion of unique
reports (cases) where a term is mentioned,
rather than the total mentions across all reports.
</p>
</li></ul>

<p>The function processes an ADR dataset (<code>adr_</code>) and
a MedDRA dataset (<code>meddra_</code>) to generate results
that are linked to a specific MedDRA hierarchy
level (<code>soc</code>, <code>hlgt</code>, <code>hlt</code>, <code>pt</code>, or <code>llt</code>).
</p>


<h3>Value</h3>

<p>A <code>data.frame</code> with the following columns:
</p>

<ul>
<li> <p><strong>term</strong>: The MedDRA term at the specified hierarchy level.
</p>
</li>
<li> <p><strong>n</strong>: The number of unique reports (cases) where
the term appears.
</p>
</li>
<li> <p><strong>percentage</strong>: The percentage of total unique reports
where the term appears.
</p>
</li></ul>

<p>The results are sorted in descending order of <code>percentage</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Example 1: Filter terms appearing in at least 5% of reports
screen_adr(
  .data = adr_,
  meddra = meddra_,
  term_level = "pt",
  freq_threshold = 0.05
)

# Example 2: Get the top 5 most frequent terms
screen_adr(
  .data = adr_,
  meddra = meddra_,
  term_level = "hlt",
  top_n = 5
)

</code></pre>

<hr>
<h2 id='screen_drug'>Screening of Drugs</h2><span id='topic+screen_drug'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
The <code>screen_drug()</code> function identifies and ranks the most frequently
reported drugs (by active ingredient) in a dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>screen_drug(.data, mp_data, freq_threshold = NULL, top_n = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="screen_drug_+3A_.data">.data</code></td>
<td>
<p>An <code>drug</code> data.table. See <code><a href="#topic+drug_">drug_</a></code></p>
</td></tr>
<tr><td><code id="screen_drug_+3A_mp_data">mp_data</code></td>
<td>
<p>An <code>MP</code> data.table. See <code><a href="#topic+mp_">mp_</a></code></p>
</td></tr>
<tr><td><code id="screen_drug_+3A_freq_threshold">freq_threshold</code></td>
<td>
<p>A numeric value indicating the minimum
frequency (as a proportion) of cases where a drug must appear
to be included in the results. Defaults to <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="screen_drug_+3A_top_n">top_n</code></td>
<td>
<p>An integer specifying the number of most frequently occurring drugs to return. Defaults to <code>NULL</code>.</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li><p> If <code>freq_threshold</code> is set (e.g., <code>0.05</code>), the function filters
drugs appearing in at least 5% of unique reports in <code>.data</code>.
</p>
</li>
<li><p> If <code>top_n</code> is specified, only the most frequent <code>n</code> drugs are returned.
If both <code>freq_threshold</code> and <code>top_n</code> are provided, only <code>top_n</code> is
applied (a warning is raised in such cases).
</p>
</li>
<li><p> Counts are computed at the <em>case</em> level, not the drug mention level.
This means frequencies reflect the proportion of unique
reports (cases) where a drug is mentioned, rather than the total
mentions across all reports.
</p>
</li></ul>



<h3>Value</h3>

<p>A <code>data.frame</code> with the following columns:
</p>

<ul>
<li> <p><code style="white-space: pre;">&#8288;Drug name&#8288;</code>: The drug name.
</p>
</li>
<li> <p><code>DrecNo</code>: The drug record number
</p>
</li>
<li> <p><code>N</code>: The number of unique reports (cases) where the drug appears.
</p>
</li>
<li> <p><code>percentage</code>: The percentage of total unique reports
where the drug appears.
</p>
</li></ul>

<p>The results are sorted in descending order of <code>percentage</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Set up start
data.table::setDTthreads(1)

# Filter drugs appearing in at least 10% of reports
screen_drug(
  .data = drug_,
  mp_data = mp_,
  freq_threshold = 0.10
)

# Get the top 5 most reported drugs
screen_drug(
  .data = drug_,
  mp_data = mp_,
  top_n = 5
)

# nb: in the example datasets, not all drugs are recorded in mp_,
# leading to NAs in screen_drug output.

# Set up end
data.table::setDTthreads(0)
</code></pre>

<hr>
<h2 id='tb_meddra'>Create MedDRA tables</h2><span id='topic+tb_meddra'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Transform MedDRA .ascii
files to .parquet files
</p>
<p>MedDRA is delivered as ascii files, that you should
transform to a more efficient format. Parquet format from arrow has many advantages:
It works with out-of-memory data, which makes it possible to process tables on
a computer with not-so-much RAM. It is also lightweighted and standard across different
langages.
The function also creates variables in each table.
You should note that NOT all MedDRA tables are processed with this function.
Three tables are created: <code>meddra_hierarchy</code>, that respects the System Organ
Class hierarchic classification. <code>smq_list</code> and <code>smq_content</code> for Standardized
MedDRA Queries.
<strong>Caution</strong> There tends to be small variations in the MedDRA ascii files structure.
Last verified version on which this function is working is <strong>26.1</strong>.
Use <code><a href="#topic+dt_parquet">dt_parquet()</a></code> to load the tables afterward.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tb_meddra(path_meddra)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tb_meddra_+3A_path_meddra">path_meddra</code></td>
<td>
<p>Character string, a directory containing MedDRA ascii tables.
It is also the output directory.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>.parquet files into the <code>path_meddra</code> directory.
Three tables: <code>meddra_hierarchy</code>, <code>smq_list</code>, and <code>smq_content</code>.
Some columns are returned as <code>integer</code> (all <code style="white-space: pre;">&#8288;*_code&#8288;</code> columns).
All other columns are <code>character</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+tb_vigibase">tb_vigibase()</a></code>, <code><a href="#topic+tb_who">tb_who()</a></code>, <code><a href="#topic+tb_subset">tb_subset()</a></code>, <code><a href="#topic+dt_parquet">dt_parquet()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

# Use the examples from tb_main if you want to see these functions in action.

path_meddra &lt;- paste0(tempdir(), "/meddra_directory/")
dir.create(path_meddra)
create_ex_meddra_asc(path_meddra)

tb_meddra(path_meddra = path_meddra)

# Clear temporary files when you're done
unlink(path_meddra, recursive = TRUE)

</code></pre>

<hr>
<h2 id='tb_subset'>Extract of subset of Vigibase</h2><span id='topic+tb_subset'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Create a subset of the VigiBase
ECL datasets
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tb_subset(
  wd_in,
  wd_out,
  subset_var = c("drecno", "medprod_id", "meddra_id", "age"),
  sv_selection,
  rm_suspdup = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tb_subset_+3A_wd_in">wd_in</code></td>
<td>
<p>Source directory pathway (character)</p>
</td></tr>
<tr><td><code id="tb_subset_+3A_wd_out">wd_out</code></td>
<td>
<p>Output directory pathway (character)</p>
</td></tr>
<tr><td><code id="tb_subset_+3A_subset_var">subset_var</code></td>
<td>
<p>One of <code>"drecno"</code>, <code>"medprod_id"</code>, <code>"meddra_id"</code>, <code>"age"</code></p>
</td></tr>
<tr><td><code id="tb_subset_+3A_sv_selection">sv_selection</code></td>
<td>
<p>A named list or a vector containing the appropriate ids (according to the method, see details)</p>
</td></tr>
<tr><td><code id="tb_subset_+3A_rm_suspdup">rm_suspdup</code></td>
<td>
<p>A logical. Should suspected duplicates be removed? TRUE by default</p>
</td></tr>
</table>


<h3>Details</h3>

<p>You must select a subset variable with <code>subset_var</code> and provide
an appropriate list according to this variable in <code>sv_selection</code>.
Available <code>subset_var</code> :
</p>

<ul>
<li> <p><code>drecno</code> will use Drug Record Number (DrecNo), from WHO Drug, and will subset from <code>drug</code> (see <code><a href="#topic+get_drecno">get_drecno()</a></code>).
</p>
</li>
<li> <p><code>medprod_id</code> will use MedicinalProd_Id, also from <code>drug</code>. May be useful if requesting from ATC classes. (see <code><a href="#topic+get_atc_code">get_atc_code()</a></code>).
</p>
</li>
<li> <p><code>meddra_id</code> will use MedDRA_Id, subset from <code>adr</code>. (see <code><a href="#topic+get_llt_soc">get_llt_soc()</a></code> or See <code><a href="#topic+get_llt_smq">get_llt_smq()</a></code>).
</p>
</li>
<li> <p><code>age</code> will use AgeGroup from <code>demo</code>. See below.
</p>
</li></ul>

<p>Age groups ids are as follows:
</p>

<ul>
<li><p> 1 0 - 27 days
</p>
</li>
<li><p> 2 28 days to 23 months
</p>
</li>
<li><p> 3 2 - 11 years
</p>
</li>
<li><p> 4 12 - 17 years
</p>
</li>
<li><p> 5 18 - 44 years
</p>
</li>
<li><p> 6 45 - 64 years
</p>
</li>
<li><p> 7 65 - 74 years
</p>
</li>
<li><p> 8 &gt;= 75 years
</p>
</li>
<li><p> 9 Unknown
</p>
</li></ul>

<p>Example: To work with patients aged 18 to 74, provide <code>c(5, 6, 7)</code>
as <code>sv_selection</code>.
</p>
<p>Use <code><a href="#topic+dt_parquet">dt_parquet()</a></code> to load the tables afterward.
</p>


<h3>Value</h3>

<p>Parquet files in the output directory. All files from a
vigibase ECL main folder are returned subsetted
(including suspectedduplicates).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_drecno">get_drecno()</a></code>, <code><a href="#topic+get_atc_code">get_atc_code()</a></code>, <code><a href="#topic+get_llt_soc">get_llt_soc()</a></code>, <code><a href="#topic+get_llt_smq">get_llt_smq()</a></code>, <code><a href="#topic+dt_parquet">dt_parquet()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

# --- technical steps ---- #

wd_in &lt;- paste0(tempdir(), "/", "tbsubsetex")
dir.create(wd_in)
create_ex_main_pq(wd_in)

# Select a subset_var and corresponding data

# Subset on adr colitis codes

adr_llt &lt;-
 list(
   colitis = "Colitis"
   ) |&gt;
   get_llt_soc(term_level = "pt", meddra_, verbose = FALSE)

wd_out &lt;- paste0(wd_in, "/", "colitis_subset", "/")

tb_subset(wd_in, wd_out,
          subset_var = "meddra_id",
          sv_selection = adr_llt)

# Subset on drug codes

 d_drecno &lt;-
   list(
    ipi = "ipilimumab") |&gt;
    get_drecno(mp = mp_, verbose = FALSE)

wd_out &lt;- paste0(wd_in, "/", "nivolumab_subset", "/")

tb_subset(wd_in, wd_out,
          subset_var = "drecno",
          sv_selection = d_drecno)

 # Subset on age &gt; 65 year-old

 sv_selection &lt;-
    c(7, 8)

wd_out &lt;- paste0(wd_in, "/", "more_than_65_subset", "/")

tb_subset(wd_in, wd_out,
          subset_var = "age",
          sv_selection = sv_selection)

unlink(wd_in, recursive = TRUE)

</code></pre>

<hr>
<h2 id='tb_vigibase'>Create main VigiBase ECL tables</h2><span id='topic+tb_vigibase'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Transform VigiBase .txt
files to .parquet files.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tb_vigibase(path_base, path_sub, force = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tb_vigibase_+3A_path_base">path_base</code></td>
<td>
<p>Character string, a directory containing vigibase txt tables. It is also the
output directory.</p>
</td></tr>
<tr><td><code id="tb_vigibase_+3A_path_sub">path_sub</code></td>
<td>
<p>Character string, a directory containing subsidiary tables.</p>
</td></tr>
<tr><td><code id="tb_vigibase_+3A_force">force</code></td>
<td>
<p>Logical, to be passed to <code>cli::cli_progress_update()</code>. Used for internal
purposes.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Vigibase Extract Case Level is delivered as zipped text files, that you should
transform to a more efficient format. Parquet format from <code>arrow</code> has many advantages:
It works with out-of-memory data, which makes it possible to process Vigibase tables on
a computer with not-so-much RAM. It is also lightweighted and standard across different
langages.
The function also creates variables in each table.
The <code>suspectedduplicates</code> table will be added to the base directory.
Use <code><a href="#topic+dt_parquet">dt_parquet()</a></code> to load the tables afterward.
</p>


<h3>Value</h3>


<ul>
<li><p> .parquet files of all main tables into the <code>path_base</code>
directory: demo, adr, drug, link, ind, out, srce,
followup, and the suspdup (suspected duplicates) table.
Check <code>?demo_</code> for more information on the tables.
</p>
</li>
<li><p> The link table is augmented with <code>tto_mean</code> and <code>range</code>, to analyze
time to onset according to WHo's recommendations (see <code>vignette("descriptive")</code>.
</p>
</li>
<li><p> .parquet files of all other subsidiary tables into the <code>path_sub</code>
directory: AgeGroup, Dechallenge, Dechallenge2, Frequency,
Gender, Notifier, Outcome, Rechallenge, Rechallenge2, Region,
RepBasis, ReportType, RouteOfAdm, Seriousness, and SizeUnit.
</p>
</li></ul>

<p>.parquet files into the <code>path_base</code> directory (<strong>including suspected duplicates tables</strong>).
Some columns are returned as <code>integer</code> (UMCReportId, Drug_Id, MedicinalProd_Id, Adr_Id, MedDRA_Id),
and some columns as <code>numeric</code> (TimeToOnsetMin, TimeToOnsetMax)
All other columns are <code>character</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+tb_who">tb_who()</a></code>, <code><a href="#topic+tb_meddra">tb_meddra()</a></code>, <code><a href="#topic+tb_subset">tb_subset()</a></code>, <code><a href="#topic+dt_parquet">dt_parquet()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

# --- Set up example source files ---- ####

path_base &lt;- paste0(tempdir(), "/", "main", "/")

path_sub  &lt;- paste0(tempdir(), "/", "sub",  "/")

dir.create(path_base)
dir.create(path_sub)

create_ex_main_txt(path_base)
create_ex_sub_txt(path_sub)

 # ---- Running tb_vigibase

 tb_vigibase(path_base = path_base,
        path_sub  = path_sub)

 # Clear temporary files when you're done
 unlink(path_base, recursive = TRUE)
 unlink(path_sub, recursive = TRUE)

</code></pre>

<hr>
<h2 id='tb_who'>Create main WHO tables</h2><span id='topic+tb_who'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a> Transform Vigibase WHO .txt files
to .parquet files
</p>
<p>WHODrug is delivered as zipped text files folder, that you should
transform to a more efficient format. Parquet format from arrow has many advantages:
It can work with out-of-memory data, which makes it possible to process tables on
a computer with not-so-much RAM. It is also lightweighted and standard across different
languages.
The function also creates variables in each table. See <code><a href="#topic+tb_vigibase">tb_vigibase()</a></code> for some running examples, and try <code>?mp_</code> or <code>?thg_</code> for more details.
Use <code><a href="#topic+dt_parquet">dt_parquet()</a></code> to load the tables afterward.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tb_who(path_who, force = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tb_who_+3A_path_who">path_who</code></td>
<td>
<p>Character string, a directory containing whodrug txt tables. It is also the
output directory.</p>
</td></tr>
<tr><td><code id="tb_who_+3A_force">force</code></td>
<td>
<p>Logical, to be passed to <code>cli::cli_progress_update()</code>. Used for internal
purposes.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>.parquet files into the <code>path_who</code> directory.
Some columns are returned as <code>integer</code> (all Id columns, including MedicinalProd_Id,
with notable exception of DrecNo),
and some columns as <code>numeric</code> (Quantity from ingredient table)
All other columns are <code>character</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+tb_vigibase">tb_vigibase()</a></code>, <code><a href="#topic+tb_meddra">tb_meddra()</a></code>, <code><a href="#topic+tb_subset">tb_subset()</a></code>, <code><a href="#topic+dt_parquet">dt_parquet()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

# Use the examples from tb_main if you want to see these functions in action.

path_who &lt;- paste0(tempdir(), "/whodrug_directory/")
dir.create(path_who)
create_ex_who_txt(path_who)

tb_who(path_who = path_who)

# Clear temporary files when you're done
unlink(path_who, recursive = TRUE)

</code></pre>

<hr>
<h2 id='vigi_routine'>Pharmacovigilance routine function</h2><span id='topic+vigi_routine'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a> <code>vigi_routine()</code> draws
an Information Component plot and
a Time to Onset plot for a given drug-adr pair.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vigi_routine(
  demo_data,
  drug_data,
  adr_data,
  link_data,
  d_code,
  a_code,
  case_tto = NULL,
  vigibase_version,
  analysis_setting = "All reports",
  d_label = NULL,
  a_label = NULL,
  export_to = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vigi_routine_+3A_demo_data">demo_data</code></td>
<td>
<p>A demo data.table.</p>
</td></tr>
<tr><td><code id="vigi_routine_+3A_drug_data">drug_data</code></td>
<td>
<p>A drug data.table.</p>
</td></tr>
<tr><td><code id="vigi_routine_+3A_adr_data">adr_data</code></td>
<td>
<p>An adr data.table.</p>
</td></tr>
<tr><td><code id="vigi_routine_+3A_link_data">link_data</code></td>
<td>
<p>A link data.table.</p>
</td></tr>
<tr><td><code id="vigi_routine_+3A_d_code">d_code</code></td>
<td>
<p>A named list. The drug code(s) to be used. There must be
only one item in d_code.</p>
</td></tr>
<tr><td><code id="vigi_routine_+3A_a_code">a_code</code></td>
<td>
<p>A named list. The adr code(s) to be used. There must be
only one item in a_code.</p>
</td></tr>
<tr><td><code id="vigi_routine_+3A_case_tto">case_tto</code></td>
<td>
<p>A numeric. The time to onset of the studied case. See details.</p>
</td></tr>
<tr><td><code id="vigi_routine_+3A_vigibase_version">vigibase_version</code></td>
<td>
<p>A character. The version of VigiBase used (e.g.
&quot;September 2024&quot;). This is passed to the plot legend.</p>
</td></tr>
<tr><td><code id="vigi_routine_+3A_analysis_setting">analysis_setting</code></td>
<td>
<p>A character. The setting of the analysis. See details.</p>
</td></tr>
<tr><td><code id="vigi_routine_+3A_d_label">d_label</code></td>
<td>
<p>A character. The name of the drug, as passed to the plot legend.
Defaults to names(d_code).</p>
</td></tr>
<tr><td><code id="vigi_routine_+3A_a_label">a_label</code></td>
<td>
<p>A character. The name of the adr, as passed to the plot legend.
Defaults to names(a_code).</p>
</td></tr>
<tr><td><code id="vigi_routine_+3A_export_to">export_to</code></td>
<td>
<p>A character. The path to export the plot. If NULL, the plot
is not exported. Should end by &quot;.eps&quot;, &quot;.ps&quot;, &quot;.tex&quot; (pictex), &quot;.pdf&quot;, &quot;.jpeg&quot;,
&quot;.tiff&quot;, &quot;.png&quot;, &quot;.bmp&quot;, &quot;.svg&quot; or &quot;.wmf&quot; (windows only).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code>vignette("routine_pharmacovigilance")</code> for examples.
The output can be exported. Time to onset data are bounded between
1 day and 10 years. Data outside this range are reassigned a 1 day and 10
years value, respectively.
The function only works if there is one item in <code>d_code</code> and <code>a_code</code>.
If you are working on a specific case, you can provide a <code>case_tto</code> value.
This value will be displayed on the Time to Onset plot.
If you're demo table was filtered on specific cases (e.g. older adults,
a subset of all drugs), then you may want to indicate this setting on the
plot legend, with arg <code>analysis_setting</code>.
</p>


<h3>Value</h3>

<p>A ggplot2 graph, with two panels.
The first panel, on top, is the Information Component (IC) plot.
The arrow and &quot;IC025 label&quot; indicate the IC value for the selected drug-adr pair.
The second panel, on the bottom, is the Time to Onset (TTO) density plot.
It is derived only of cases where the drug was <strong>suspected</strong> to be responsible
of the adr.
If you provide a case_tto value, it is represented by the red line, and the
label.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Say you want to perform a disproportionality analysis between colitis and
# nivolumab among ICI cases

# identify drug DrecNo, and adr LLT code

d_drecno &lt;-
  ex_$d_drecno["nivolumab"]

a_llt &lt;-
  ex_$a_llt["a_colitis"]

# But you could also use get_drecno() and get_llt_soc()

# load tables demo, drug, adr, and link

demo &lt;- demo_
adr  &lt;- adr_
drug &lt;- drug_
link &lt;- link_

# run routine

vigi_routine(
  demo_data = demo,
  drug_data = drug,
  adr_data  = adr,
  link_data = link,
  d_code = d_drecno,
  a_code = a_llt,
  vigibase_version = "September 2024"
)

# if you're working on a case, you can provide his/her time to onset
# with arg `case_tto`

vigi_routine(
  case_tto = 150,
  demo_data = demo,
  drug_data = drug,
  adr_data  = adr,
  link_data = link,
  d_code = d_drecno,
  a_code = a_llt,
  vigibase_version = "September 2024"
)


# Customize with d_name and a_name, export the plot with export_to

vigi_routine(
  case_tto = 150,
  demo_data = demo,
  drug_data = drug,
  adr_data  = adr,
  link_data = link,
  d_code = d_drecno,
  a_code = a_llt,
  vigibase_version = "September 2024",
  d_label = "Nivolumab",
  a_label = "Colitis",
  export_to = paste0(tempdir(), "/", "vigicaen_graph.png")
)
</code></pre>

<hr>
<h2 id='vigicaen-deprecated'>Deprecated functions in package <span class="pkg">vigicaen</span>.</h2><span id='topic+vigicaen-deprecated'></span>

<h3>Description</h3>

<p>The functions listed below are deprecated and will be defunct in
the near future. When possible, alternative functions with similar
functionality are also mentioned. Help pages for deprecated functions are
available at <code>help("&lt;function&gt;-deprecated")</code>.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
