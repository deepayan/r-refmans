<!DOCTYPE html><html><head><title>Help for package qrNLMM</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {qrNLMM}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#group.plots'><p>Plot function for grouped data</p></a></li>
<li><a href='#HIV'>
<p>HIV viral load study</p></a></li>
<li><a href='#predict.QRNLMM'>
<p>Predict method for Quantile Regression for Nonlinear Mixed-Effects (QRNLMM) fits</p></a></li>
<li><a href='#QRNLMM'>
<p>Quantile Regression for Nonlinear Mixed-Effects Models</p></a></li>
<li><a href='#qrNLMM-package'>
<p>Package for Quantile Regression for Linear Mixed-Effects Model</p></a></li>
<li><a href='#Soybean'><p>Growth of soybean plants</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Quantile Regression for Nonlinear Mixed-Effects Models</td>
</tr>
<tr>
<td>Version:</td>
<td>3.3</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-08-17</td>
</tr>
<tr>
<td>Author:</td>
<td>Christian E. Galarza &lt;chedgala@espol.edu.ec&gt; and Victor H. Lachos &lt;hlachos@uconn.edu&gt;</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Christian E. Galarza &lt;cgalarza88@gmail.com&gt;</td>
</tr>
<tr>
<td>Imports:</td>
<td>mvtnorm, lqr, quantreg, psych, ald, progress</td>
</tr>
<tr>
<td>Description:</td>
<td>Quantile regression (QR) for Nonlinear
             Mixed-Effects Models via the asymmetric Laplace distribution (ALD). 
             It uses the Stochastic Approximation of the EM (SAEM) algorithm for 
             deriving exact maximum likelihood estimates and full inference results 
             for the fixed-effects and variance components.
             It also provides prediction and graphical summaries for assessing the algorithm
             convergence and fitting results.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-08-17 13:36:29 UTC; cgala</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-08-18 12:40:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='group.plots'>Plot function for grouped data
</h2><span id='topic+group.plots'></span><span id='topic+group.plot'></span><span id='topic+group.lines'></span><span id='topic+group.points'></span>

<h3>Description</h3>

<p>Functions for plotting a profiles plot for grouped data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>group.plot(x,y,groups,...)
group.lines(x,y,groups,...)
group.points(x,y,groups,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="group.plots_+3A_y">y</code></td>
<td>

<p>the response vector of dimension <code class="reqn">N</code> where <code class="reqn">N</code> is the total of observations.
</p>
</td></tr>
<tr><td><code id="group.plots_+3A_x">x</code></td>
<td>

<p>vector of longitudinal (repeated measures) covariate of dimension <code class="reqn">N</code>. For example: Time, location, etc.  
</p>
</td></tr>
<tr><td><code id="group.plots_+3A_groups">groups</code></td>
<td>

<p>factor of dimension <code class="reqn">N</code> specifying the partitions of the data over which the random effects vary.
</p>
</td></tr>
<tr><td><code id="group.plots_+3A_...">...</code></td>
<td>

<p>additional graphical arguments passed to <code><a href="graphics.html#topic+matplot">matplot</a></code>. See <code><a href="graphics.html#topic+par">par</a></code>.
</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Christian E. Galarza &lt;<a href="mailto:chedgala@espol.edu.ec">chedgala@espol.edu.ec</a>&gt; and 
Victor H. Lachos &lt;<a href="mailto:hlachos@uconn.edu">hlachos@uconn.edu</a>&gt;
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Soybean">Soybean</a></code>, <code><a href="#topic+HIV">HIV</a></code>, <code><a href="#topic+QRNLMM">QRNLMM</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
#A full profile plot for Soybean data

data(Soybean)
attach(Soybean)

group.plot(x = Time,y = weight,groups = Plot,type="b",
             main="Soybean profiles",xlab="time (days)",
             ylab="mean leaf weight (gr)")

#Profile plot by genotype

group.plot(x = Time[Variety=="P"],y = weight[Variety=="P"],
             groups = Plot[Variety=="P"],type="l",col="blue",
             main="Soybean profiles by genotype",xlab="time (days)",
             ylab="mean leaf weight (gr)")

group.lines(x = Time[Variety=="F"],y = weight[Variety=="F"],
              groups = Plot[Variety=="F"],col="black")

## End(Not run)
</code></pre>

<hr>
<h2 id='HIV'>
HIV viral load study
</h2><span id='topic+HIV'></span>

<h3>Description</h3>

<p>The data set belongs to a clinical trial (ACTG 315) studied in previous researches by Wu (2002) and Lachos et al. (2013). In this study, we analyze the HIV viral load of 46 HIV-1 infected patients under antiretroviral treatment (protease inhibitor and reverse transcriptase inhibitor drugs). The viral load and some other covariates were mesured several times days after the start of treatment
been 4 and 10 the minimum and maximum number of measures per patient respectively.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(HIV)</code></pre>


<h3>Format</h3>

<p>This data frame contains the following columns:
</p>

<dl>
<dt><code>patid</code></dt><dd><p>a numeric vector indicating the patient register number.</p>
</dd>
<dt><code>ind</code></dt><dd><p>a numeric vector indicating the number patient on which the
measurement was made. It represents the subject number in the study.</p>
</dd>
<dt><code>day</code></dt><dd><p>time in days.</p>
</dd>
<dt><code>cd4</code></dt><dd><p>cd4 count in cells/<code class="reqn">mm^{3}</code>.</p>
</dd>
<dt><code>lgviral</code></dt><dd><p>viral load in log10 scale.</p>
</dd>
<dt><code>cd8</code></dt><dd><p>cd8 count in cells/<code class="reqn">mm^{3}</code>.</p>
</dd>
</dl>



<h3>Details</h3>

<p>In order to fit the nonlinear data we sugest to use the Nonlinear model proposed by Wu (2002) and also used by Lachos et al. (2013).</p>


<h3>Source</h3>

<p>Wu, L. (2002). A joint model for nonlinear mixed-effects models with censoring and covariates measured with error, with application to aids studies. Journal of the American Statistical association,
97(460), 955-964.
</p>
<p>Lachos, V. H., Castro, L. M. &amp; Dey, D. K. (2013). Bayesian inference in nonlinear mixed-effects
models using normal independent distributions. Computational Statistics &amp; Data Analysis, 64,
237-252.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data(HIV)
attach(HIV)

y     = lgviral            #response
x     = day/100            #time
covar = cd4/100            #covariate

#Nonlinear model used in Lachos(2013)

#Full Nonlinear expression
exprNL = expression(log(exp(fixed[1]+random[1])*exp(-(fixed[2]+random[2])*x)+
                    exp(fixed[3]+random[3])*exp(-(fixed[4]+random[4]+fixed[5]
                    *covar[1])*x))/log(10))

#Initial values for fixed effects
initial = c(12,31,6,-2,0.6)

#A median regression (by default)
median_reg = QRNLMM(y,x,ind,initial,exprNL,covar)

## End(Not run)
</code></pre>

<hr>
<h2 id='predict.QRNLMM'>
Predict method for Quantile Regression for Nonlinear Mixed-Effects (QRNLMM) fits
</h2><span id='topic+predict.QRNLMM'></span>

<h3>Description</h3>

<p>Takes a fitted object produced by <code>QRNLMM()</code> and produces predictions given a new set of values for the model covariates.

</p>


<h3>Usage</h3>

<pre><code class='language-R'>
## S3 method for class 'QRNLMM'
predict(object,x = NULL,groups = NULL,covar = NULL, y = NULL,MC = 1000,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict.QRNLMM_+3A_object">object</code></td>
<td>

<p>a fitted QRNLMM object as produced by QRNLMM().
</p>
</td></tr>
<tr><td><code id="predict.QRNLMM_+3A_x">x</code></td>
<td>

<p>vector of longitudinal (repeated measures) covariate of dimension <code class="reqn">N</code>. For example: Time, location, etc.  
</p>
</td></tr>
<tr><td><code id="predict.QRNLMM_+3A_groups">groups</code></td>
<td>

<p>factor of dimension <code class="reqn">N</code> specifying the partitions of the data over which the random effects vary.
</p>
</td></tr>
<tr><td><code id="predict.QRNLMM_+3A_covar">covar</code></td>
<td>

<p>a matrix of dimension <code class="reqn">N \times r</code> where <code class="reqn">r</code> represents the number of covariates.
</p>
</td></tr>
<tr><td><code id="predict.QRNLMM_+3A_y">y</code></td>
<td>

<p>the response vector of dimension <code class="reqn">N</code> where <code class="reqn">N</code> is the total of observations. Optional. See details.
</p>
</td></tr>
<tr><td><code id="predict.QRNLMM_+3A_mc">MC</code></td>
<td>

<p>number of MC replicates for the computation of new individual values (only when <code>y</code> is provided). By default <code>MC = 1000</code>. See details.
</p>
</td></tr>
<tr><td><code id="predict.QRNLMM_+3A_...">...</code></td>
<td>

<p>additional arguments affecting the predictions produced.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Prediction for QRNLMM objects can be performed under three different scenarios:
</p>

<ol>
<li> <p><code>predict(object)</code>: if no newdata is provided, fitted values for the original dataset is returned. Please refer to the <code>fitted.values</code> value in <code><a href="#topic+QRNLMM">QRNLMM</a></code>.
</p>
</li>
<li> <p><code>predict(object,x,groups,covar = NULL)</code>: if new data is provided, but only the independent variables (no response), population curves are provided. If no covariates are provided, the predicted curves will be the same.
</p>
</li>
<li> <p><code>predict(object,x,groups,covar = NULL,y)</code> if the response values are provided, a Metropolis-Hastings algorithm (with <code>MC</code> replicates and <code>thin = 5</code>) is performed in order to compute the random-effects for new subjects. The method is based on Galarza et.al. (2020).
</p>
</li></ol>



<h3>Value</h3>



<p>A <code>data.frame</code> containing the predicted values, one column per quantile.



</p>


<h3>Note</h3>

<p>For scenario 3, results may vary a little each time. For more precision, please increase <code>MC</code>.
</p>


<h3>Author(s)</h3>

<p>Christian E. Galarza &lt;<a href="mailto:chedgala@espol.edu.ec">chedgala@espol.edu.ec</a>&gt; and 
Victor H. Lachos &lt;<a href="mailto:hlachos@uconn.edu">hlachos@uconn.edu</a>&gt;
</p>


<h3>References</h3>

<p>Galarza, C.E., Castro, L.M., Louzada, F. &amp; Lachos, V. (2020) Quantile regression for nonlinear mixed effects models: a likelihood based perspective. Stat Papers 61, 1281-1307.
doi: <a href="https://doi.org/10.1007/s00362-018-0988-y">10.1007/s00362-018-0988-y</a>
</p>
<p>Delyon, B., Lavielle, M. &amp; Moulines, E. (1999). Convergence of a stochastic approximation version of the EM algorithm. Annals of Statistics, pages 94-128.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+QRNLMM">QRNLMM</a></code>,<code><a href="#topic+group.plots">group.plots</a></code>,<code><a href="#topic+group.lines">group.lines</a></code>,<code><a href="#topic+Soybean">Soybean</a></code>, <code><a href="#topic+HIV">HIV</a></code>, <code><a href="lqr.html#topic+lqr">lqr</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  ## Not run: 
    
#A model for comparing the two genotypes  (with covariates)

data(Soybean)
attach(Soybean)

y     = weight          #response
x     = Time            #time
covar = c(Variety)-1    #factor genotype (0=Forrest, 1=Plan Intro)

#Expression for the three parameter logistic curve with a covariate

exprNL = expression((fixed[1]+(fixed[4]*covar[1])+random[1])/
                      (1 + exp(((fixed[2]+random[2])- x)/
                      (fixed[3]+random[3]))))

#Initial values for fixed effects
initial = c(max(y),0.6*max(y),0.73*max(y),3)

# A quantile regression for percentiles p = c(0.05,0.50,0.95)

#Take your sit and some popcorn

results = qrNLMM::QRNLMM(
  y = y,
  x = x,
  groups = Plot,
  initial = initial,
  exprNL = exprNL,
  covar = covar,
  p= c(0.05,0.50,0.95),# quantiles to estimate
  MaxIter = 50,M = 15, # to accelerate
  verbose = FALSE      # show no output
)

######################################################################
# Predicting
######################################################################

# now we select two random subjects from original data
set.seed(19)
index = Plot %in% sample(Plot,size = 2)
index2 = c(1,diff(as.numeric(Plot)))&gt;0 &amp; index

# 1. Original dataset
#####################

prediction = predict(object = results)
head(prediction) # fitted values

if(TRUE){
  group.plot(x = Time[index],
             y = weight[index],
             groups = Plot[index],
             type="b",
             main="Soybean profiles",
             xlab="time (days)",
             ylab="mean leaf weight (gr)",
             col= ifelse(covar[index2],"gray70","gray90"),
             ylim = range(prediction[index,]),
             lty = 1
  )
  
  legend("bottomright",
         legend = c("Forrest","Plan Intro"),
         bty = "n",col = c(4,2),lty = 1)
  
  # predictions for these two plots
  
  group.lines(x = Time[index], # percentile 5
              y = prediction[index,1],
              groups = Plot[index],
              type = "l",
              col=ifelse(covar[index2],"red","blue"),
              lty = 2
  )
  
  group.lines(x = Time[index], # median
              y = prediction[index,2],
              groups = Plot[index],
              type = "l",
              col="black",
              lty = 2)
  
  group.lines(x = Time[index], # percentile 95
              y = prediction[index,3],
              groups = Plot[index],
              type = "l",
              col=ifelse(covar[index2],"red","blue"),
              lty = 2)
  
  legend("topleft",
         legend = c("p = 5","p = 50","p = 95"),
         col = c(4,1,4),lty = c(2,2,2),bty = "n")
}

# 2. New covariates with no response
####################################

# For the two randomly selected plots (index == TRUE)

# newdata
newdata = data.frame(new.groups = Plot[index],
                new.x = Time[index],
                new.covar = covar[index])

newdata
attach(newdata)

prediction2 = predict(object = results,
                      groups = new.groups,
                      x = new.x,
                      covar = new.covar)

# population curves

if(TRUE){
  group.plot(x = new.x, # percentile 5
             y = prediction2[,1],
             groups = new.groups,
             type = "l",
             col=ifelse(covar[index2],"red","blue"), 
             lty = 2,
             main="Soybean profiles",
             xlab="time (days)",
             ylab="mean leaf weight (gr)",
             ylim = range(prediction2)
  )
  
  legend("bottomright",
         legend = c("Forrest","Plan Intro"),
         bty = "n",col = c(4,2),lty = 1)
  
  # predictions for these two plots
  
  group.lines(x = new.x, # median
              y = prediction2[,2],
              groups = new.groups,
              type = "l",
              col="black",
              lty = 1)
  
  group.lines(x = new.x, # percentile 95
              y = prediction2[,3],
              groups = new.groups,
              type = "l",
              col=ifelse(covar[index2],"red","blue"),
              lty = 2)
  
  legend("topleft",
         legend = c("p = 5","p = 50","p = 95"),
         col = c(4,1,4),lty = c(2,1,2),bty = "n")
  
  segments(x0 = new.x[new.covar==1],
           y0 = prediction2[new.covar==1,1],
           y1 = prediction2[new.covar==1,3],
           lty=2,col = "red")
  
  segments(x0 = new.x[new.covar==0],
           y0 = prediction2[new.covar==0,1],
           y1 = prediction2[new.covar==0,3],
           lty=2,col = "blue")
}

# 3. New covariates + response
####################################

# newdata
newdata2 = data.frame(new.groups = Plot[index],
                     new.x = Time[index],
                     new.covar = covar[index],
                     new.y = weight[index])

newdata2
attach(newdata2)

prediction2 = predict(object = results,
                      groups = new.groups,
                      x = new.x,
                      covar = new.covar,
                      y = new.y)

# individual curves (random-effects to be computed)

if(TRUE){
  group.plot(x = Time[index],
             y = weight[index],
             groups = Plot[index],
             type="b",
             main="Soybean profiles",
             xlab="time (days)",
             ylab="mean leaf weight (gr)",
             col= ifelse(covar[index2],"gray70","gray90"),
             ylim = range(prediction[index,]),
             lty = 1
  )
  
  legend("bottomright",
         legend = c("Forrest","Plan Intro"),
         bty = "n",col = c(4,2),lty = 1)
  
  # predictions for these two plots
  
  group.lines(x = new.x, # percentile 5
              y = prediction2[,1],
              groups = new.groups,
              type = "l",
              col=ifelse(covar[index2],"red","blue"),
              lty = 2)
  
  group.lines(x = new.x, # median
              y = prediction2[,2],
              groups = new.groups,
              type = "l",
              col="black",
              lty = 1)
  
  group.lines(x = new.x, # percentile 95
              y = prediction2[,3],
              groups = new.groups,
              type = "l",
              col=ifelse(covar[index2],"red","blue"),
              lty = 2)
  
  legend("topleft",
         legend = c("p = 5","p = 50","p = 95"),
         col = c(4,1,4),lty = c(2,1,2),bty = "n")
}
  
## End(Not run)
</code></pre>

<hr>
<h2 id='QRNLMM'>
Quantile Regression for Nonlinear Mixed-Effects Models
</h2><span id='topic+QRNLMM'></span>

<h3>Description</h3>

<p>Performs a quantile regression for a NLMEM using the Stochastic-Approximation of the EM Algorithm (SAEM) for an unique or a set of quantiles.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>QRNLMM(y,x,groups,initial,exprNL,covar=NA,p=0.5,precision=0.0001,MaxIter=500,
       M=20,cp=0.25,beta=NA,sigma=NA,Psi=NA,show.convergence=TRUE,CI=95,verbose=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="QRNLMM_+3A_y">y</code></td>
<td>

<p>the response vector of dimension <code class="reqn">N</code> where <code class="reqn">N</code> is the total of observations.
</p>
</td></tr>
<tr><td><code id="QRNLMM_+3A_x">x</code></td>
<td>

<p>vector of longitudinal (repeated measures) covariate of dimension <code class="reqn">N</code>. For example: Time, location, etc.  
</p>
</td></tr>
<tr><td><code id="QRNLMM_+3A_groups">groups</code></td>
<td>

<p>factor of dimension <code class="reqn">N</code> specifying the partitions of the data over which the random effects vary.
</p>
</td></tr>
<tr><td><code id="QRNLMM_+3A_initial">initial</code></td>
<td>
<p>an numeric vector, or list of initial estimates
for the fixed effects. It must be provide adequately (see <code>details</code> section) in order to ensure a proper convergence.
</p>
</td></tr>
<tr><td><code id="QRNLMM_+3A_exprnl">exprNL</code></td>
<td>

<p>expression containing the proposed nonlinear function. It can be of class <code>character</code> or <code>expression</code>. It must have a defined structure defined in the <code>details</code> section in order to be correctly read by the derivate R function <code>deriv</code>.
</p>
</td></tr>
<tr><td><code id="QRNLMM_+3A_covar">covar</code></td>
<td>

<p>a matrix of dimension <code class="reqn">N \times r</code> where <code class="reqn">r</code> represents the number of covariates.
</p>
</td></tr>
<tr><td><code id="QRNLMM_+3A_p">p</code></td>
<td>

<p>unique quantile or a set of quantiles related to the quantile regression.
</p>
</td></tr>
<tr><td><code id="QRNLMM_+3A_precision">precision</code></td>
<td>

<p>the convergence maximum error.
</p>
</td></tr>
<tr><td><code id="QRNLMM_+3A_maxiter">MaxIter</code></td>
<td>

<p>the maximum number of iterations of the SAEM algorithm. Default = 500.
</p>
</td></tr>
<tr><td><code id="QRNLMM_+3A_m">M</code></td>
<td>

<p>Number of Monte Carlo simulations used by the SAEM Algorithm. Default = 20. For more accuracy we suggest to use <code>M=20</code>.
</p>
</td></tr>
<tr><td><code id="QRNLMM_+3A_cp">cp</code></td>
<td>

<p>cut point <code class="reqn">(0 \le cp \le 1)</code> which determines
the percentage of initial iterations with no memory.
</p>
</td></tr>
<tr><td><code id="QRNLMM_+3A_beta">beta</code></td>
<td>

<p>fixed effects vector of initial parameters, if desired. 
</p>
</td></tr>
<tr><td><code id="QRNLMM_+3A_sigma">sigma</code></td>
<td>

<p>dispersion initial parameter for the error term, if desired.
</p>
</td></tr>
<tr><td><code id="QRNLMM_+3A_psi">Psi</code></td>
<td>

<p>Variance-covariance random effects matrix of initial parameters, if desired.
</p>
</td></tr>
<tr><td><code id="QRNLMM_+3A_show.convergence">show.convergence</code></td>
<td>

<p>if <code>TRUE</code>, it will show a graphical summary for the convergence of the estimates of all parameters for each quantile in order to assess the convergence.
</p>
</td></tr>
<tr><td><code id="QRNLMM_+3A_ci">CI</code></td>
<td>

<p>Confidence to be used for the Confidence Interval when a grid of quantiles is provided. Default=95.
</p>
</td></tr>
<tr><td><code id="QRNLMM_+3A_verbose">verbose</code></td>
<td>

<p>if <code>TRUE</code>, an output summary is printed.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This algorithm performs the SAEM algorithm proposed by Delyon et al. (1999), a stochastic version of the usual EM Algorithm deriving exact maximum likelihood estimates of the fixed-effects and variance components. Covariates are allowed, the longitudinal (repeated measures) coded <code>x</code> and a set of covariates <code>covar</code>.
</p>
<p><code class="reqn">About initial values:</code> Estimation for fixed effects parameters envolves a Newton-Raphson step. In adition, NL models are highly sensitive to initial values. So, we suggest to set of intial values quite good, this based in the parameter interpretation of the proposed NL function.
</p>
<p><code class="reqn">About the nonlinear expression:</code> For the NL expression <code>exprNL</code> just the variables <code>x</code>, <code>covar</code>, <code>fixed</code> and <code>random</code> can be defined. Both <code>x</code> and <code>covar</code> represent the covariates defined above. The fixed effects must be declared as <code>fixed[1]</code>, <code>fixed[2]</code>,..., <code>fixed[d]</code> representing the first, second and <code class="reqn">d</code>th fixed effect. Exactly the same for the random effects and covariates where the term <code>fixed</code> should be replace for <code>random</code> and <code>covar</code> respectively.
</p>
<p>For instance, if we use the exponential nonlinear function with two parameters, each parameter represented by a fixed and a random effect, this will be defined by
</p>
<p style="text-align: center;"><code class="reqn">y_{ij} = (\beta_1 + b_1)\exp^{-(\beta_2 + b_2)x_{ij}}</code>
</p>

<p>and the <code>exprNL</code> should be a character or and expression defined by
</p>
<p><code>exprNL = "(fixed[1]+random[1])*exp(-(fixed[2]+random[2])*x)"</code>
</p>
<p>or
</p>
<p><code>exprNL = expression((fixed[1]+random[1])*exp(-(fixed[2]+random[2])*x))</code>.
</p>
<p>If we are interested in adding two covariates in order to explain on of the parameters, the covariates <code>covar[1]</code> and <code>covar[2]</code> must be included in the model. For example, for the nonlinear function
</p>
<p style="text-align: center;"><code class="reqn">y_{ij} = (\beta_1 + \beta_3*covar1_{ij} + b_1)\exp^{-(\beta_2 + \beta_4*
covar2_{ij} + b_2)x_{ij}}</code>
</p>

<p>the <code>exprNL</code> should be
</p>
<p><code>exprNL = "(fixed[1]+fixed[3]*covar[1]+random[1])*exp(-(fixed[2]+fixed[4]*covar[2]+random[2])*x)"</code>
</p>
<p>or
</p>
<p><code>exprNL = expression((fixed[1]+fixed[3]*covar[1]+random[1])*exp(-(fixed[2]+
fixed[4]*covar[2]+random[2])*x))</code>.
</p>
<p>Note that the mathematical function <code>exp</code> was used. For derivating the <code>deriv</code> R function recognizes in the <code>exprNL</code> expression the arithmetic operators +, -, *, / and ^, and the single-variable functions <code>exp</code>, <code>log</code>, <code>sin</code>, <code>cos</code>, <code>tan</code>, <code>sinh</code>, <code>cosh</code>, <code>sqrt</code>, <code>pnorm</code>, <code>dnorm</code>, <code>asin</code>, <code>acos</code>, <code>atan</code>, <code>gamma</code>, <code>lgamma</code>, <code>digamma</code> and <code>trigamma</code>, as well as <code>psigamma</code> for one or two arguments (but derivative only with respect to the first).
</p>
<p><code class="reqn">General details:</code> When a grid of quantiles is provided, a graphical summary with point estimates and Confidence Intervals for model parameters is shown and also a graphical summary for the convergence of these estimates (for each quantile), if <code>show.convergence=TRUE</code>.
</p>
<p>If the convergence graphical summary shows that convergence has not be attained, it's suggested to increase the total number of iterations <code>MaxIter</code>.
</p>
<p>About the cut point parameter <code>cp</code>, a number between 0 and 1 <code class="reqn">(0 \le cp \le 1)</code> will assure an initial convergence in distribution to a solution neighborhood for the first <code>cp</code>*<code>MaxIter</code> iterations and an almost sure convergence for the rest of the iterations. If you do not know how SAEM algorithm works, these parameters SHOULD NOT be changed.
</p>
<p>This program uses progress bars that will close when the algorithm ends. They must not be closed before, if not, the algorithm will stop.
</p>


<h3>Value</h3>

<p>The function returns a list with two objects
</p>
<table>
<tr><td><code>conv</code></td>
<td>
<p>A two elements list with the matrices <code>teta</code> and <code>se</code> containing the point estimates and standard error estimate for all parameters along all iterations.</p>
</td></tr>
</table>
<p>The second element of the list is <code>res</code>, a list of 13 elements detailed as
</p>
<table>
<tr><td><code>p</code></td>
<td>
<p>quantile(s) fitted.</p>
</td></tr>
<tr><td><code>iter</code></td>
<td>
<p>number of iterations.</p>
</td></tr>
<tr><td><code>criteria</code></td>
<td>
<p>attained criteria value.</p>
</td></tr>
<tr><td><code>nlmodel</code></td>
<td>
<p>the proposed nonlinear function.</p>
</td></tr>
<tr><td><code>beta</code></td>
<td>
<p>fixed effects estimates.</p>
</td></tr>
<tr><td><code>weights</code></td>
<td>
<p>random effects weights (<code class="reqn">b_i</code>).</p>
</td></tr>
<tr><td><code>sigma</code></td>
<td>
<p>scale parameter estimate for the error term.</p>
</td></tr>
<tr><td><code>Psi</code></td>
<td>
<p>Random effects variance-covariance estimate matrix.</p>
</td></tr>
<tr><td><code>SE</code></td>
<td>
<p>Standard Error estimates.</p>
</td></tr>
<tr><td><code>table</code></td>
<td>
<p>Table containing the inference for the fixed effects parameters.</p>
</td></tr>
<tr><td><code>loglik</code></td>
<td>
<p>Log-likelihood value.</p>
</td></tr>
<tr><td><code>AIC</code></td>
<td>
<p>Akaike information criterion.</p>
</td></tr>
<tr><td><code>BIC</code></td>
<td>
<p>Bayesian information criterion.</p>
</td></tr>
<tr><td><code>HQ</code></td>
<td>
<p>Hannan-Quinn information criterion.</p>
</td></tr>
<tr><td><code>fitted.values</code></td>
<td>
<p>vector containing the fitted values</p>
</td></tr>
<tr><td><code>residuals</code></td>
<td>
<p>vector containing the residuals.</p>
</td></tr>
<tr><td><code>time</code></td>
<td>
<p>processing time.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>If a grid of quantiles was provided, the result is a list of the same dimension where each element corresponds to each quantile as detailed above.
</p>


<h3>Author(s)</h3>

<p>Christian E. Galarza &lt;<a href="mailto:chedgala@espol.edu.ec">chedgala@espol.edu.ec</a>&gt; and 
Victor H. Lachos &lt;<a href="mailto:hlachos@uconn.edu">hlachos@uconn.edu</a>&gt;
</p>


<h3>References</h3>

<p>Galarza, C.E., Castro, L.M., Louzada, F. &amp; Lachos, V. (2020) Quantile regression for nonlinear mixed effects models: a likelihood based perspective. Stat Papers 61, 1281-1307.
doi: <a href="https://doi.org/10.1007/s00362-018-0988-y">10.1007/s00362-018-0988-y</a>
</p>
<p>Delyon, B., Lavielle, M. &amp; Moulines, E. (1999). Convergence of a stochastic approximation version of the EM algorithm. Annals of Statistics, pages 94-128.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Soybean">Soybean</a></code>, <code><a href="#topic+HIV">HIV</a></code>, <code><a href="lqr.html#topic+lqr">lqr</a></code> , <code><a href="#topic+group.plots">group.plots</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
#Using the Soybean data

data(Soybean)
attach(Soybean)

#################################
#A full model (no covariate)

y     = weight          #response
x     = Time            #time

#Expression for the three parameter logistic curve

exprNL = expression((fixed[1]+random[1])/
                    (1 + exp(((fixed[2]+random[2])- x)/(fixed[3]+random[3]))))

#Initial values for fixed effects
initial = c(max(y),0.6*max(y),0.73*max(y))

#A median regression (by default)
median_reg = QRNLMM(y,x,Plot,initial,exprNL)

#Assesing the fit

fxd     = median_reg$res$beta
nlmodel = median_reg$res$nlmodel
seqc    = seq(min(x),max(x),length.out = 500)

group.plot(x = Time,y = weight,groups = Plot,type="l",
           main="Soybean profiles",xlab="time (days)",
           ylab="mean leaf weight (gr)",col="gray")

for(i in 1:48)
{
  lines(seqc,nlmodel(x = seqc,fixed = fxd,random = weights[i,]),lty=2)
}

lines(seqc,nlmodel(x = seqc,fixed = fxd,random = rep(0,3)),
      lwd=3,col="red")          

#########################################
#A model for compairing the two genotypes

y     = weight          #response
x     = Time            #time
covar = c(Variety)-1    #factor genotype (0=Forrest, 1=Plan Introduction)

#Expression for the three parameter logistic curve with a covariate

exprNL = expression((fixed[1]+(fixed[4]*covar[1])+random[1])/
                    (1 + exp(((fixed[2]+random[2])- x)/(fixed[3]+random[3]))))

#Initial values for fixed effects
initial = c(max(y),0.6*max(y),0.73*max(y),3)

# A quantile regression for the three quartiles
box_reg = QRNLMM(y,x,Plot,initial,exprNL,covar,p=c(0.25,0.50,0.75))

#Assing the fit for the median (second quartile)

fxd     = box_reg[[2]]$res$beta
nlmodel = box_reg[[2]]$res$nlmodel
seqc    = seq(min(x),max(x),length.out = 500)

group.plot(x = Time[Variety=="P"],y = weight[Variety=="P"],
             groups = Plot[Variety=="P"],type="l",col="light blue",
             main="Soybean profiles by genotype",xlab="time (days)",
             ylab="mean leaf weight (gr)")
             
group.lines(x = Time[Variety=="F"],y = weight[Variety=="F"],
              groups = Plot[Variety=="F"],col="gray")
             
lines(seqc,nlmodel(x = seqc,fixed = fxd,random = rep(0,3),covar=1),
      lwd=2,col="blue")

lines(seqc,nlmodel(x = seqc,fixed = fxd,random = rep(0,3),covar=0),
      lwd=2,col="black")

#########################################
#A simple output example

---------------------------------------------------
Quantile Regression for Nonlinear Mixed Model
---------------------------------------------------
Quantile = 0.5
Subjects = 48 ; Observations = 412

- Nonlinear function

function(x,fixed,random,covar=NA){
  resp = (fixed[1] + random[1])/(1 + exp(((fixed[2] +
          random[2]) - x)/(fixed[3] + random[3])))
  return(resp)}

-----------
Estimates
-----------
- Fixed effects

       Estimate Std. Error   z value Pr(&gt;|z|)
beta 1 18.80029    0.53098  35.40704        0
beta 2 54.47930    0.29571 184.23015        0
beta 3  8.25797    0.09198  89.78489        0

sigma = 0.31569

Random effects Variance-Covariance Matrix matrix
         b1       b2      b3
b1 24.36687 12.27297 3.24721
b2 12.27297 15.15890 3.09129
b3  3.24721  3.09129 0.67193

------------------------
Model selection criteria
------------------------
        Loglik      AIC      BIC       HQ
Value -622.899 1265.798 1306.008 1281.703

-------
Details
-------
Convergence reached? = FALSE
Iterations = 300 / 300
Criteria = 0.00058
MC sample = 20
Cut point = 0.25
Processing time = 22.83885 mins

## End(Not run)
</code></pre>

<hr>
<h2 id='qrNLMM-package'>
Package for Quantile Regression for Linear Mixed-Effects Model
</h2><span id='topic+qrNLMM-package'></span>

<h3>Description</h3>

<p>This package contains a principal function that performs a quantile regression for a Nonlinear Mixed-Effects Model using the Stochastic-Approximation of the EM Algorithm (SAEM) for an unique or a set of quantiles.
</p>
<p>Exploiting the nice hierarchical representation of the ALD, our classical approach follows the Stochastic Approximation of the EM(SAEM) algorithm for deriving exact maximum likelihood estimates of the fixed-effects and variance components.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> qrNLMM</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.0</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2015-01-30</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> What license is it under?</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Christian E. Galarza &lt;<a href="mailto:chedgala@espol.edu.ec">chedgala@espol.edu.ec</a>&gt; and 
Victor H. Lachos &lt;<a href="mailto:hlachos@ime.unicamp.br">hlachos@ime.unicamp.br</a>&gt;
</p>
<p>Maintainer: Christian E. Galarza &lt;<a href="mailto:chedgala@espol.edu.ec">chedgala@espol.edu.ec</a>&gt;
</p>


<h3>References</h3>

<p>Galarza, C.E., Castro, L.M., Louzada, F. &amp; Lachos, V. (2020) Quantile regression for nonlinear mixed effects models: a likelihood based perspective. Stat Papers 61, 1281-1307.
doi: <a href="https://doi.org/10.1007/s00362-018-0988-y">10.1007/s00362-018-0988-y</a>
</p>
<p>Yu, K. &amp; Moyeed, R. (2001). Bayesian quantile regression. Statistics &amp; Probability Letters, 54(4), 437-447.
</p>
<p>Yu, K., &amp; Zhang, J. (2005). A three-parameter asymmetric Laplace distribution and its extension. Communications in Statistics-Theory and Methods, 34(9-10), 1867-1879.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Soybean">Soybean</a></code>, <code><a href="#topic+HIV">HIV</a></code>, <code><a href="#topic+QRNLMM">QRNLMM</a></code>,
<code><a href="lqr.html#topic+lqr">lqr</a></code> , <code><a href="#topic+group.plots">group.plots</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#See examples for the QRNLMM function linked above.
</code></pre>

<hr>
<h2 id='Soybean'>Growth of soybean plants</h2><span id='topic+Soybean'></span>

<h3>Description</h3>

<p>The <code>Soybean</code> data frame has 412 rows and 5 columns.
</p>


<h3>Format</h3>

<p>This data frame contains the following columns:
</p>

<dl>
<dt>Plot</dt><dd>
<p>a factor giving a unique identifier for each plot.
</p>
</dd>
<dt>Variety</dt><dd>
<p>a factor indicating the variety; Forrest (F) or Plant
Introduction #416937 (P).
</p>
</dd>
<dt>Year</dt><dd>
<p>a factor indicating the year the plot was planted.
</p>
</dd>
<dt>Time</dt><dd>
<p>a numeric vector giving the time the sample was taken (days
after planting).
</p>
</dd>
<dt>weight</dt><dd>
<p>a numeric vector giving the average leaf weight per plant (g).
</p>
</dd>
</dl>



<h3>Details</h3>

<p>These data are described in
Davidian and Giltinan (1995, 1.1.3, p.7) as &ldquo;Data from an
experiment to compare growth patterns of two genotypes of soybeans:
Plant Introduction #416937 (P), an experimental strain, and Forrest
(F), a commercial variety.&rdquo; In order to fit the Nonlinear data we sugest to use the three parameter logistic model as in Pinheiro &amp; Bates (1995).
</p>


<h3>Source</h3>

<p>Pinheiro, J. C. and Bates, D. M. (2000), <em>Mixed-Effects Models in S
and S-PLUS</em>, Springer, New York.  (Appendix A.27)
</p>
<p>Davidian, M. and Giltinan, D. M. (1995), <em>Nonlinear Models for
Repeated Measurement Data</em>,  Chapman and Hall, London.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data(Soybean)
attach(Soybean)

#################################
#A full model (no covariate)

y     = weight          #response
x     = Time            #time

#Expression for the three parameter logistic curve

exprNL = expression((fixed[1]+random[1])/(1 + exp(((fixed[2]+random[2])- x)/(fixed[3]+random[3]))))

#Initial values for fixed effects
initial = c(max(y),0.6*max(y),0.73*max(y))

#A median regression (by default)
median_reg = QRNLMM(y,x,Plot,initial,exprNL)

#Assing the fit

fxd     = median_reg$res$beta
nlmodel = median_reg$res$nlmodel
seqc    = seq(min(x),max(x),length.out = 500)

group.plot(x = Time,y = weight,groups = Plot,type="l",
             main="Soybean profiles",xlab="time (days)",
             ylab="mean leaf weight (gr)",col="gray")
             
lines(seqc,nlmodel(x = seqc,fixed = fxd,random = rep(0,3)),
      lwd=2,col="blue")             

#Histogram for residuals
hist(median_reg$res$residuals)

#########################################
#A model for comparing the two genotypes (with covariates)

y     = weight          #response
x     = Time            #time
covar = c(Variety)-1    #factor genotype (0=Forrest, 1=Plan Introduction)

#Expression for the three parameter logistic curve with a covariate

exprNL = expression((fixed[1]+(fixed[4]*covar[1])+random[1])/
                    (1 + exp(((fixed[2]+random[2])- x)/(fixed[3]+random[3]))))

#Initial values for fixed effects
initial = c(max(y),0.6*max(y),0.73*max(y),3)

# A quantile regression for the three quartiles
box_reg = QRNLMM(y,x,Plot,initial,exprNL,covar,p=c(0.25,0.50,0.75))

#Assing the fit for the median (second quartile)

fxd     = box_reg[[2]]$res$beta
nlmodel = box_reg[[2]]$res$nlmodel
seqc    = seq(min(x),max(x),length.out = 500)

group.plot(x = Time[Variety=="P"],y = weight[Variety=="P"],
             groups = Plot[Variety=="P"],type="l",col="light blue",
             main="Soybean profiles by genotype",xlab="time (days)",
             ylab="mean leaf weight (gr)")
             
group.lines(x = Time[Variety=="F"],y = weight[Variety=="F"],
              groups = Plot[Variety=="F"],col="gray")
             
lines(seqc,nlmodel(x = seqc,fixed = fxd,random = rep(0,3),covar=1),
      lwd=2,col="blue")

lines(seqc,nlmodel(x = seqc,fixed = fxd,random = rep(0,3),covar=0),
      lwd=2,col="black")


## End(Not run)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
