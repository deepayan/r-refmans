<!DOCTYPE html><html><head><title>Help for package epitweetr</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {epitweetr}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#check_all'><p>Run automatic sanity checks</p></a></li>
<li><a href='#create_map'><p>Plot the map report on the epitweetr dashboard</p></a></li>
<li><a href='#create_snapshot'><p>Snapshot of your epitweetr installation</p></a></li>
<li><a href='#create_topchart'><p>Plot the top elements for a specific series on the epitweetr dashboard</p></a></li>
<li><a href='#create_topwords'><p>Plot the top words report on the epitweetr dashboard</p></a></li>
<li><a href='#detect_loop'><p>Runs the detect loop</p></a></li>
<li><a href='#download_dependencies'><p>Updates Java dependencies</p></a></li>
<li><a href='#ears_t_reweighted'><p>algorithm for outbreak detection, extends the EARS algorithm</p></a></li>
<li><a href='#epitweetr_app'><p>Run the epitweetr Shiny app</p></a></li>
<li><a href='#fs_loop'><p>Runs the epitweetr embedded database loop</p></a></li>
<li><a href='#generate_alerts'><p>Execute the alert task</p></a></li>
<li><a href='#geolocate_text'><p>geolocate text in a data frame given a text column and optionally a language column</p></a></li>
<li><a href='#get_aggregates'><p>Getting already aggregated time series produced by <code>detect_loop</code></p></a></li>
<li><a href='#get_alerts'><p>Getting signals produced by the task <code>generate_alerts</code> of <code>detect_loop</code></p></a></li>
<li><a href='#get_tasks'><p>Get the <code>detect_loop</code> task status</p></a></li>
<li><a href='#get_todays_sample_tweets'><p>Get a sample of latest tweet geolocations (deprecated)</p></a></li>
<li><a href='#health_check'><p>Send email to administrator if a failure of epitweetr is detected</p></a></li>
<li><a href='#is_detect_running'><p>Check whether the alert detection task is running</p></a></li>
<li><a href='#is_fs_running'><p>Check whether the database is running</p></a></li>
<li><a href='#is_search_running'><p>Check whether the tweet collection task is running</p></a></li>
<li><a href='#json2lucene'><p>Function used for migrating tweets from to old to the new file system</p></a></li>
<li><a href='#register_detect_runner_task'><p>Registers the alert detection task</p></a></li>
<li><a href='#register_fs_monitor'><p>Registers the fs_monitor for the current process or exits</p></a></li>
<li><a href='#register_fs_runner_task'><p>Registers the epitweetr database task</p></a></li>
<li><a href='#register_search_runner_task'><p>Registers the tweet collection task</p></a></li>
<li><a href='#save_config'><p>Save the configuration changes</p></a></li>
<li><a href='#search_loop'><p>Runs the search loop</p></a></li>
<li><a href='#search_tweets'><p>perform full text search on tweets collected with epitweetr</p></a></li>
<li><a href='#set_twitter_app_auth'><p>Save Twitter App credentials</p></a></li>
<li><a href='#setup_config'><p>Load epitweetr application settings</p></a></li>
<li><a href='#stop_detect_runner_task'><p>Stops the alert detection task</p></a></li>
<li><a href='#stop_fs_runner_task'><p>Stops the epitweetr database task</p></a></li>
<li><a href='#stop_search_runner_task'><p>Stops the tweet collection task</p></a></li>
<li><a href='#trend_line'><p>Plot the trendline report of epitweetr dashboard</p></a></li>
<li><a href='#update_geonames'><p>Updates the local copy of the GeoNames database</p></a></li>
<li><a href='#update_languages'><p>Updates local copies of languages</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Early Detection of Public Health Threats from 'Twitter' Data</td>
</tr>
<tr>
<td>Version:</td>
<td>2.2.16</td>
</tr>
<tr>
<td>Description:</td>
<td>It allows you to automatically monitor trends of tweets by time, place and topic aiming at detecting public health threats early through the detection of signals (e.g. an unusual increase in the number of tweets). It was designed to focus on infectious diseases, and it can be extended to all hazards or other fields of study by modifying the topics and keywords. More information is available in the 'epitweetr' peer-review publication (doi:10.2807/1560-7917.ES.2022.27.39.2200177).</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://joinup.ec.europa.eu/software/page/eupl">EUPL</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/EU-ECDC/epitweetr">https://github.com/EU-ECDC/epitweetr</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/EU-ECDC/epitweetr/issues">https://github.com/EU-ECDC/epitweetr/issues</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Imports:</td>
<td>bit64, dplyr, crul, curl, DT, emayili, future, httpuv, httr,
htmltools, jsonlite, keyring, knitr, lifecycle, ggplot2,
janitor, magrittr, parallel, plotly, processx, rtweet, readxl,
rlang, rmarkdown, rnaturalearthdata, openxlsx, plyr, shiny, sp,
stringr, stats, tibble, tidyverse, tidytext, tools, utils,
xtable, xml2</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.0</td>
</tr>
<tr>
<td>Suggests:</td>
<td>taskscheduleR</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-11-15 08:32:48 UTC; lespinosa</td>
</tr>
<tr>
<td>Author:</td>
<td>Laura Espinosa <a href="https://orcid.org/0000-0003-0748-9657"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, fnd, cre] (Project manager, author of the design and concept
    of the package, and package maintainer),
  Francisco Orchard <a href="https://orcid.org/0000-0001-5793-3301"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, ctr] (Author of the package and original code),
  Ariana Wijermans [ctb] (Contributor to the design and concept of the
    package),
  Thomas Mollet [ctb, fnd] (Business owner of the project, and
    contributor to the design and concept of the package),
  Adrian Prodan [ctb],
  Thomas Czernichow [ctb],
  Maria Prieto Gonzalez [ctb],
  Esther Kissling [ctb],
  Michael HÃ¶hle [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Laura Espinosa &lt;laura.espinosa@ecdc.europa.eu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-11-15 09:30:08 UTC</td>
</tr>
</table>
<hr>
<h2 id='check_all'>Run automatic sanity checks</h2><span id='topic+check_all'></span>

<h3>Description</h3>

<p>It runs a set of automated sanity checks for helping the user to troubleshot issues
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_all()
</code></pre>


<h3>Details</h3>

<p>This function executes a series of sanity checks, concerning, Java, bitness, task status, dependencies and Twitter authentication.
</p>


<h3>Value</h3>

<p>Data frame containing the statuses of all realized checks
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   #importing epitweer
   library(epitweetr)
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
   #running all tests
   check_all()
}
</code></pre>

<hr>
<h2 id='create_map'>Plot the map report on the epitweetr dashboard</h2><span id='topic+create_map'></span>

<h3>Description</h3>

<p>Generates a bubble map plot of number of tweets by countries, for one topic
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_map(
  topic = c(),
  countries = c(1),
  date_min = "1900-01-01",
  date_max = "2100-01-01",
  with_retweets = FALSE,
  location_type = "tweet",
  caption = "",
  proj = NULL,
  forplotly = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_map_+3A_topic">topic</code></td>
<td>
<p>Character(1) containing the topic to use for the report</p>
</td></tr>
<tr><td><code id="create_map_+3A_countries">countries</code></td>
<td>
<p>Character vector containing the name of the countries and regions to plot or their respective indexes on the Shiny app, default: c(1)</p>
</td></tr>
<tr><td><code id="create_map_+3A_date_min">date_min</code></td>
<td>
<p>Date indicating start of the reporting period, default: &quot;1900-01-01&quot;</p>
</td></tr>
<tr><td><code id="create_map_+3A_date_max">date_max</code></td>
<td>
<p>Date indicating end of the reporting period, default: &quot;2100-01-01&quot;</p>
</td></tr>
<tr><td><code id="create_map_+3A_with_retweets">with_retweets</code></td>
<td>
<p>Logical value indicating whether to include retweets in the time series, default: FALSE</p>
</td></tr>
<tr><td><code id="create_map_+3A_location_type">location_type</code></td>
<td>
<p>Character(1) vector indicating the location type. Possible values 'tweet', 'user' or 'both', default: 'tweet'</p>
</td></tr>
<tr><td><code id="create_map_+3A_caption">caption</code></td>
<td>
<p>Character(1) vector indicating a caption to print at the bottom of the chart, default: &quot;&quot;</p>
</td></tr>
<tr><td><code id="create_map_+3A_proj">proj</code></td>
<td>
<p>Parameter indicating the CRS (Coordinate Reference System) to use on PROJ4 format <code><a href="sp.html#topic+CRS-class">CRS-class</a></code>?
If null and all countries are selected +proj=robin is used (Robinson projection) otherwise the Lambert azimuthal equal-area projection will be chosen, default: NULL</p>
</td></tr>
<tr><td><code id="create_map_+3A_forplotly">forplotly</code></td>
<td>
<p>Logical(1) parameter indicating whether some hacks are activated to improve plotly rendering, default: FALSE</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Produces a bubble chart map for a particular topic on number of tweets collected based on the provided parameters.
The map will display information at country level if more than one country is selected, otherwise it will display bubbles at the smallest possible location identified for each tweet within the period
which could be any administrative level or city level.
</p>
<p>Tweets associated with a country but with no finer granularity are omitted when displaying a single country.
</p>
<p>When an aggregated zone is requested, all countries in that zone are included.
</p>
<p>This functions requires that <code><a href="#topic+search_loop">search_loop</a></code> and <code><a href="#topic+detect_loop">detect_loop</a></code> have already been run successfully to show results.
</p>


<h3>Value</h3>

<p>A named list containing two elements: 'chart' with the ggplot2 figure and 'data' containing the dataframe that was used to build the map.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+trend_line">trend_line</a></code>
<code><a href="#topic+create_topwords">create_topwords</a></code>
<code><a href="#topic+detect_loop">detect_loop</a></code>
<code><a href="#topic+search_loop">search_loop</a></code>
<code><a href="sp.html#topic+spTransform">spTransform</a></code>,<code><a href="sp.html#topic+coordinates">coordinates</a></code>,<code><a href="sp.html#topic+is.projected">is.projected</a></code>,<code><a href="sp.html#topic+CRS-class">CRS-class</a></code>
<code><a href="ggplot2.html#topic+fortify">fortify</a></code>,<code><a href="ggplot2.html#topic+geom_polygon">geom_polygon</a></code>,<code><a href="ggplot2.html#topic+geom_point">geom_point</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   #Getting bubble chart for dengue for South America for last 30 days
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
   create_map(
     topic = "dengue", 
     countries = "South America", 
     date_min = as.Date(Sys.time())-30, 
     date_max=as.Date(Sys.time())
   ) 
}
</code></pre>

<hr>
<h2 id='create_snapshot'>Snapshot of your epitweetr installation</h2><span id='topic+create_snapshot'></span>

<h3>Description</h3>

<p>Creates a snapshot file of your epitweetr installation folder. This can include all or a subset of the data files.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_snapshot(
  destination_dir,
  types = c("settings", "dependencies", "machine-learning", "aggregations", "tweets",
    "logs"),
  tweets_period = get_aggregated_period(),
  aggregated_period = get_aggregated_period(),
  compress = TRUE,
  progress = function(v, m) message(paste(round(v * 100, 2), m))
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_snapshot_+3A_destination_dir">destination_dir</code></td>
<td>
<p>character(1) vector with the path of the destination folder to produce the snapshot</p>
</td></tr>
<tr><td><code id="create_snapshot_+3A_types">types</code></td>
<td>
<p>character vector indicating the types of data to include on a snapshot. Some of: &quot;settings&quot;, &quot;dependencies&quot;, &quot;machine-learning&quot;, &quot;aggregations&quot;, &quot;tweets&quot;, &quot;logs&quot;</p>
</td></tr>
<tr><td><code id="create_snapshot_+3A_tweets_period">tweets_period</code></td>
<td>
<p>date(2) start and end dates to filter tweets to include on snapshot (if selected)</p>
</td></tr>
<tr><td><code id="create_snapshot_+3A_aggregated_period">aggregated_period</code></td>
<td>
<p>date(2) start and end dates to filter time series to include on snapshot (if selected)</p>
</td></tr>
<tr><td><code id="create_snapshot_+3A_compress">compress</code></td>
<td>
<p>logical(1) whether to compress or not the output file</p>
</td></tr>
<tr><td><code id="create_snapshot_+3A_progress">progress</code></td>
<td>
<p>function to report progress during execution.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function can be used to create a a portable file to move your epitweetr installation in a single file, to backup your data, to archive your old data or to send information to technical team in order to reproduce an observed issue.
Different kinds of data can be included on the snapshot depending on the type of parameter. Possible values are:
- 'settings': Including all setting files of your installation (excluding passwords)
- 'dependencies': All jars and winutils.exe on windows installations
- 'machine-learning': All trained models and vectors and training data (this can include tweet text which is personal data)
- 'aggregations': Epitweetr aggregated time series
- 'tweets': Tweets collected by epitweetr
- 'logs': Log files produced automatically on windows task scheduler tasks.
</p>


<h3>Value</h3>

<p>Nothing
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   #importing epitweer
   library(epitweetr)
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
   #creating a compressed snapshot for settings and logs
   create_snapshot(getwd(), c("settings","dependencies"), compress = TRUE)
}
</code></pre>

<hr>
<h2 id='create_topchart'>Plot the top elements for a specific series on the epitweetr dashboard</h2><span id='topic+create_topchart'></span>

<h3>Description</h3>

<p>Generates a bar plot of most popular elements in tweets, for one topic. Top elements among (&quot;topwords&quot;, &quot;hashtags&quot;, &quot;entities&quot;, &quot;contexts&quot;, &quot;urls&quot;)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_topchart(
  topic,
  serie,
  country_codes = c(),
  date_min = "1900-01-01",
  date_max = "2100-01-01",
  with_retweets = FALSE,
  location_type = "tweet",
  top = 25
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_topchart_+3A_topic">topic</code></td>
<td>
<p>Character(1) containing the topic to use for the report</p>
</td></tr>
<tr><td><code id="create_topchart_+3A_serie">serie</code></td>
<td>
<p>Character(1) name of the series to be used for the report. It should be one of (&quot;topwords&quot;, &quot;hashtags&quot;, &quot;entities&quot;, &quot;contexts&quot;, &quot;urls&quot;)</p>
</td></tr>
<tr><td><code id="create_topchart_+3A_country_codes">country_codes</code></td>
<td>
<p>Character vector containing the ISO 3166-1 alpha-2 countries to plot, default: c()</p>
</td></tr>
<tr><td><code id="create_topchart_+3A_date_min">date_min</code></td>
<td>
<p>Date indicating start of the reporting period, default: &quot;1900-01-01&quot;</p>
</td></tr>
<tr><td><code id="create_topchart_+3A_date_max">date_max</code></td>
<td>
<p>Date indicating end of the reporting period, default: &quot;2100-01-01&quot;</p>
</td></tr>
<tr><td><code id="create_topchart_+3A_with_retweets">with_retweets</code></td>
<td>
<p>Logical value indicating whether to include retweets in the time series, default: FALSE</p>
</td></tr>
<tr><td><code id="create_topchart_+3A_location_type">location_type</code></td>
<td>
<p>Character(1) this parameter is currently being IGNORED since this report shows only tweet location and cannot show user or both locations for performance reasons, default: 'tweet'</p>
</td></tr>
<tr><td><code id="create_topchart_+3A_top">top</code></td>
<td>
<p>numeric(1) Parameter indicating the number of words to show, default: 25</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Produces a bar chart showing the occurrences of the most popular words in the collected tweets based on the provided parameters.
For performance reasons on tweet aggregation, this report only shows tweet location and ignores the location_type parameter
</p>
<p>This functions requires that <code><a href="#topic+search_loop">search_loop</a></code> and <code><a href="#topic+detect_loop">detect_loop</a></code> have already been run successfully to show results.
</p>


<h3>Value</h3>

<p>A named list containing two elements: 'chart' with the ggplot2 figure and 'data' containing the data frame that was used to build the map.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+trend_line">trend_line</a></code>
<code><a href="#topic+create_map">create_map</a></code>
<code><a href="#topic+detect_loop">detect_loop</a></code>
<code><a href="#topic+search_loop">search_loop</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
   #Getting topword chart for dengue for France, Chile, Australia for last 30 days
   create_topchart(
     topic = "dengue", 
     serie = "topwords", 
     country_codes = c("FR", "CL", "AU"),
     date_min = as.Date(Sys.time())-30, 
     date_max=as.Date(Sys.time())
   ) 
 }
</code></pre>

<hr>
<h2 id='create_topwords'>Plot the top words report on the epitweetr dashboard</h2><span id='topic+create_topwords'></span>

<h3>Description</h3>

<p>Generates a bar plot of most popular words in tweets, for one topic
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_topwords(
  topic,
  country_codes = c(),
  date_min = "1900-01-01",
  date_max = "2100-01-01",
  with_retweets = FALSE,
  location_type = "tweet",
  top = 25
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_topwords_+3A_topic">topic</code></td>
<td>
<p>Character(1) containing the topic to use for the report</p>
</td></tr>
<tr><td><code id="create_topwords_+3A_country_codes">country_codes</code></td>
<td>
<p>Character vector containing the ISO 3166-1 alpha-2 countries to plot, default: c()</p>
</td></tr>
<tr><td><code id="create_topwords_+3A_date_min">date_min</code></td>
<td>
<p>Date indicating start of the reporting period, default: &quot;1900-01-01&quot;</p>
</td></tr>
<tr><td><code id="create_topwords_+3A_date_max">date_max</code></td>
<td>
<p>Date indicating end of the reporting period, default: &quot;2100-01-01&quot;</p>
</td></tr>
<tr><td><code id="create_topwords_+3A_with_retweets">with_retweets</code></td>
<td>
<p>Logical value indicating whether to include retweets in the time series, default: FALSE</p>
</td></tr>
<tr><td><code id="create_topwords_+3A_location_type">location_type</code></td>
<td>
<p>Character(1) this parameter is currently being IGNORED since this report shows only tweet location and cannot show user or both locations for performance reasons, default: 'tweet'</p>
</td></tr>
<tr><td><code id="create_topwords_+3A_top">top</code></td>
<td>
<p>numeric(1) Parameter indicating the number of words to show, default: 25</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Produces a bar chart showing the occurrences of the most popular words in the collected tweets based on the provided parameters.
For performance reasons on tweet aggregation this report only shows tweet location and ignores the location_type parameter
</p>
<p>This report may be empty for combinations of countries and topics with very few tweets since for performance reasons, the calculation of top words is an approximation using chunks of 10.000 tweets.
</p>
<p>This function requires that <code><a href="#topic+search_loop">search_loop</a></code> and <code><a href="#topic+detect_loop">detect_loop</a></code> have already been run successfully to show results.
</p>


<h3>Value</h3>

<p>A named list containing two elements: 'chart' with the ggplot2 figure and 'data' containing the data frame that was used to build the map.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+trend_line">trend_line</a></code>
<code><a href="#topic+create_map">create_map</a></code>
<code><a href="#topic+detect_loop">detect_loop</a></code>
<code><a href="#topic+search_loop">search_loop</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
   #Getting topword chart for dengue for France, Chile, Australia for last 30 days
   create_topwords(
     topic = "dengue", 
     country_codes = c("FR", "CL", "AU"),
     date_min = as.Date(Sys.time())-30, 
     date_max=as.Date(Sys.time())
   ) 
 }
</code></pre>

<hr>
<h2 id='detect_loop'>Runs the detect loop</h2><span id='topic+detect_loop'></span>

<h3>Description</h3>

<p>Infinite loop ensuring the daily signal detection and email alerts
</p>


<h3>Usage</h3>

<pre><code class='language-R'>detect_loop(data_dir = NA)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="detect_loop_+3A_data_dir">data_dir</code></td>
<td>
<p>Path to the 'data directory' containing application settings, models and collected tweets.
If not provided the system will try to reuse the existing one from last session call of <code><a href="#topic+setup_config">setup_config</a></code> or use the EPI_HOME environment variable, default: NA</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The detect loop is composed of three 'one shot tasks' <code><a href="#topic+download_dependencies">download_dependencies</a></code>, <code><a href="#topic+update_geonames">update_geonames</a></code>, <code><a href="#topic+update_languages">update_languages</a></code> ensuring the system has
all necessary components and data to run the three recurrent tasks <code><a href="#topic+generate_alerts">generate_alerts</a></code>
</p>
<p>The loop report progress on the 'tasks.json' file which is read or created by this function.
</p>
<p>The recurrent tasks are scheduled to be executed each 'detect span' minutes, which is a parameter set on the Shiny app.
</p>
<p>If any of these tasks fails it will be retried three times before going to abort status. Aborted tasks can be relaunched from the Shiny app.
</p>


<h3>Value</h3>

<p>nothing
</p>


<h3>See Also</h3>

<p><code><a href="#topic+download_dependencies">download_dependencies</a></code>
</p>
<p><code><a href="#topic+update_geonames">update_geonames</a></code>
</p>
<p><code><a href="#topic+update_languages">update_languages</a></code>
</p>
<p><code><a href="#topic+detect_loop">detect_loop</a></code>
</p>
<p><code><a href="#topic+generate_alerts">generate_alerts</a></code>
</p>
<p><code><a href="#topic+get_tasks">get_tasks</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   #Running the detect loop
   library(epitweetr)
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
   detect_loop()
}
</code></pre>

<hr>
<h2 id='download_dependencies'>Updates Java dependencies</h2><span id='topic+download_dependencies'></span>

<h3>Description</h3>

<p>Download Java dependencies of the application mainly related to Apache SPARK and Lucene,
</p>


<h3>Usage</h3>

<pre><code class='language-R'>download_dependencies(tasks = get_tasks())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="download_dependencies_+3A_tasks">tasks</code></td>
<td>
<p>Task object for reporting progress and error messages, default: get_tasks()</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Run a one-shot task consisting of downloading Java and Scala dependencies, this is separated by the following subtasks
</p>

<ul>
<li><p>Download jar dependencies from configuration maven repo to project data folder. This includes, scala, spark, lucene. Packages to be downloaded are defined in package file 'sbt-deps.txt'
</p>
</li>
<li><p>Download winutils from configuration URL to project data folder. For more details on winutils please see 
<a href="https://issues.apache.org/jira/browse/HADOOP-13223">https://issues.apache.org/jira/browse/HADOOP-13223</a> and <a href="https://issues.apache.org/jira/browse/HADOOP-16816">https://issues.apache.org/jira/browse/HADOOP-16816</a>

</p>
</li></ul>

<p>The URLs to download the JAR dependencies (maven package manager) and Winutils are on the configuration tab of the Shiny app.
</p>
<p>Normally this function is not called directly by the user but from the <code><a href="#topic+detect_loop">detect_loop</a></code> function.
</p>


<h3>Value</h3>

<p>The list of tasks updated with produced messages
</p>


<h3>See Also</h3>

<p><code><a href="#topic+detect_loop">detect_loop</a></code>
</p>
<p><code><a href="#topic+get_tasks">get_tasks</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   library(epitweetr)
   # setting up the data folder
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())

   # geolocating last tweets
   tasks &lt;- download_dependencies()
}
</code></pre>

<hr>
<h2 id='ears_t_reweighted'>algorithm for outbreak detection, extends the EARS algorithm</h2><span id='topic+ears_t_reweighted'></span>

<h3>Description</h3>

<p>The simple 7 day running mean version of the Early Aberration Reporting System (EARS) 
algorithm is extended as follows:
</p>

<ul>
<li><p>proper computation of the prediction interval
</p>
</li>
<li><p>downweighting of previous signals, similar to the approach by Farrington (1996)
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>ears_t_reweighted(
  ts,
  alpha = 0.025,
  alpha_outlier = 0.05,
  k_decay = 4,
  no_historic = 7L,
  same_weekday_baseline = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ears_t_reweighted_+3A_ts">ts</code></td>
<td>
<p>A numeric vector containing the counts of the univariate
time series to monitor. The last time point in ts is
investigated</p>
</td></tr>
<tr><td><code id="ears_t_reweighted_+3A_alpha">alpha</code></td>
<td>
<p>The alpha is used to compute the upper limit of the prediction interval:
(1-alpha) * 100%, default: 0.025</p>
</td></tr>
<tr><td><code id="ears_t_reweighted_+3A_alpha_outlier">alpha_outlier</code></td>
<td>
<p>Residuals beyond 1-alpha_outlier quantile of the 
the t(n-k-1) distribution are downweighted, default: 0.05</p>
</td></tr>
<tr><td><code id="ears_t_reweighted_+3A_k_decay">k_decay</code></td>
<td>
<p>Power k in the expression (r_star/r_threshold)^k determining the weight, default: 4</p>
</td></tr>
<tr><td><code id="ears_t_reweighted_+3A_no_historic">no_historic</code></td>
<td>
<p>Number of previous values i.e -1, -2, ..., no_historic
to include when computing baseline parameters, default: 7</p>
</td></tr>
<tr><td><code id="ears_t_reweighted_+3A_same_weekday_baseline">same_weekday_baseline</code></td>
<td>
<p>whether to calculate baseline using same weekdays or any day, default: FALSE</p>
</td></tr>
</table>


<h3>Details</h3>

<p>for algorithm details see package vignette.
</p>


<h3>Value</h3>

<p>A dataframe containing the monitored time point,
the upper limit and whether a signal is detected or not.
</p>


<h3>Author(s)</h3>

<p>Michael Hoehle &lt;https://www.math.su.se/~hoehle&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   library(epitweetr)
   #Running the modifies version of the ears algorithm for a particular data series
    ts &lt;- c(150, 130, 122, 160, 155, 128, 144, 125, 300, 319, 289, 277, 500)
    show(ears_t_reweighted(ts))
}
</code></pre>

<hr>
<h2 id='epitweetr_app'>Run the epitweetr Shiny app</h2><span id='topic+epitweetr_app'></span>

<h3>Description</h3>

<p>Open the epitweetr Shiny app, used to setup the Data collection &amp; processing pipeline, the Requirements &amp; alerts pipeline and to visualise the outputs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>epitweetr_app(data_dir = NA)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="epitweetr_app_+3A_data_dir">data_dir</code></td>
<td>
<p>Path to the 'data directory' containing application settings, models and collected tweets.
If not provided the system will try to reuse the existing one from last session call of <code><a href="#topic+setup_config">setup_config</a></code> or use the EPI_HOME environment variable, default: NA</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The epitweetr app is the user entry point to the epitweetr package. This application will help the user to setup the tweet collection process, manage all settings, 
see the interactive dashboard visualisations, export them to Markdown or PDF, and setup the alert emails.
</p>
<p>All its functionality is described on the epitweetr vignette.
</p>


<h3>Value</h3>

<p>The Shiny server object containing the launched application
</p>


<h3>See Also</h3>

<p><code><a href="#topic+search_loop">search_loop</a></code>
</p>
<p><code><a href="#topic+detect_loop">detect_loop</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   #Running the epitweetr app
   library(epitweetr)
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
   epitweetr_app()
}
</code></pre>

<hr>
<h2 id='fs_loop'>Runs the epitweetr embedded database loop</h2><span id='topic+fs_loop'></span>

<h3>Description</h3>

<p>Infinite loop ensuring that the epitweetr embedded database is running (Lucene + akka-http)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fs_loop(data_dir = NA)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fs_loop_+3A_data_dir">data_dir</code></td>
<td>
<p>Path to the 'data directory' containing application settings, models and collected tweets.
If not provided, the system will try to reuse the existing one from last session call of <code><a href="#topic+setup_config">setup_config</a></code> or use the EPI_HOME environment variable, default: NA</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Launches the epitweetr embedded database which is accessed via a REST API located on <a href="http://localhost:8080">http://localhost:8080</a>. You can test that the database is running by accessing <a href="http://localhost:8080/ping">http://localhost:8080/ping</a>
the REST API provide epitweetr a way to send and retrieve data related with tweets and time series and to trigger geolocation or aggregation
The database is implemented using Apache Lucene indexes allowing epitweetr to access its data as a search engine but also as a tabular database.
<code><a href="#topic+health_check">health_check</a></code> called each 60 seconds on a background process to send alerts to the administrator if some epitweetr components fail.
</p>


<h3>Value</h3>

<p>nothing
</p>


<h3>See Also</h3>

<p><code><a href="#topic+detect_loop">detect_loop</a></code>
</p>
<p><code><a href="#topic+search_loop">search_loop</a></code>
</p>
<p><code><a href="#topic+health_check">health_check</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   #Running the detect loop
   library(epitweetr)
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
   fs_loop()
}
</code></pre>

<hr>
<h2 id='generate_alerts'>Execute the alert task</h2><span id='topic+generate_alerts'></span>

<h3>Description</h3>

<p>Evaluate alerts for the last collected day for all topics and regions and send email alerts to subscribers
</p>


<h3>Usage</h3>

<pre><code class='language-R'>generate_alerts(tasks = get_tasks())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="generate_alerts_+3A_tasks">tasks</code></td>
<td>
<p>Current tasks for reporting purposes, default: get_tasks()</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function calculates alerts for the last aggregated day and then send emails to subscribers.
</p>
<p>The alert calculation is based on the country_counts time series which stores alerts by country, hour and topics.
</p>
<p>For each country and region, the process starts by aggregating the last N days. A day is a block of consecutive 24 hours ending before the hour of the collected last tweet. 
N is defined by the alert baseline parameter on the configuration tab of the Shiny application (the default is N=7).
</p>
<p>An alert will be produced when the number of tweets observed is above the threshold calculated by the modified version of the EARS algorithm (for more details see the package vignette). 
The behaviour of the alert detection algorithm is modified by the signal false positive rate (alpha), downweighting of previous alerts and weekly or daily baseline parameters 
as defined on the configuration tab of the Shiny application and the topics file.
</p>
<p>A prerequisite to this function is that the <code><a href="#topic+search_loop">search_loop</a></code> must already have stored collected tweets in the search folder and that the geotagging and aggregation tasks have already been run.
Normally this function is not called directly by the user but from the <code><a href="#topic+detect_loop">detect_loop</a></code> function.
</p>


<h3>Value</h3>

<p>The list of tasks updated with produced messages
</p>


<h3>See Also</h3>

<p><code><a href="#topic+detect_loop">detect_loop</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   library(epitweetr)
   # setting up the data folder
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())

   # calculating alerts for last day tweets and sending emails to subscribers
   generate_alerts()
}
</code></pre>

<hr>
<h2 id='geolocate_text'>geolocate text in a data frame given a text column and optionally a language column</h2><span id='topic+geolocate_text'></span>

<h3>Description</h3>

<p>extracts geolocaion information on text on a column of the provided data frame and returns a new data frame with geolocation information
</p>


<h3>Usage</h3>

<pre><code class='language-R'>geolocate_text(df, text_col = "text", lang_col = NULL, min_score = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="geolocate_text_+3A_df">df</code></td>
<td>
<p>A data frame containing at least character column with text, a column with the language name can be provided to improve geolocation quality</p>
</td></tr>
<tr><td><code id="geolocate_text_+3A_text_col">text_col</code></td>
<td>
<p>character, name of the column on the data frame containing the text to geolocalize, default:text</p>
</td></tr>
<tr><td><code id="geolocate_text_+3A_lang_col">lang_col</code></td>
<td>
<p>character, name of the column on the data frame containing the language of texts, default: NULL</p>
</td></tr>
<tr><td><code id="geolocate_text_+3A_min_score">min_score</code></td>
<td>
<p>numeric, the minimum score obtained on the Lucene scoring function to accept matches on GeoNames. It has to be empirically set default: NULL</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function perform a call to the epitweetr database which includes functionality for geolocating for languages activated and successfully processed on the shiny app.
</p>
<p>The geolocation process tries to find the best match in GeoNames database <a href="https://www.geonames.org/">https://www.geonames.org/</a> including all local aliases for words.
</p>
<p>If no language is associated to the text, all tokens will be sent as a query to the indexed GeoNames database.
</p>
<p>If a language code is associated to the text and this language is trained on epitweetr, entity recognition techniques will be used to identify the best candidate in text to contain a location
and only these tokens will be sent to the GeoNames query.
</p>
<p>A custom scoring function is implemented to grant more weight to cities increasing with population to try to perform disambiguation.
</p>
<p>Rules for forcing the geolocation choices of the algorithms and for tuning performance with manual annotations can be performed on the geotag tab of the Shiny app.
</p>
<p>A prerequisite to this function is that the tasks <code><a href="#topic+download_dependencies">download_dependencies</a></code> <code><a href="#topic+update_geonames">update_geonames</a></code> and <code><a href="#topic+update_languages">update_languages</a></code> has been run successfully.
</p>
<p>This function is called from the Shiny app on geolocation evaluation tab but can also be used for manually evaluating the epitweetr geolocation algorithm.
</p>


<h3>Value</h3>

<p>A new data frame containing the following geolocation columns: geo_code, geo_country_code, geo_country, geo_name, tags
</p>


<h3>See Also</h3>

<p><code><a href="#topic+download_dependencies">download_dependencies</a></code>
</p>
<p><code><a href="#topic+update_geonames">update_geonames</a></code>
</p>
<p><code><a href="#topic+detect_loop">detect_loop</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE) {
   library(epitweetr)
   # setting up the data folder
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())

   # creating a test dataframe
   df &lt;- data.frame(text = c("Me gusta Santiago de Chile es una linda ciudad"), lang = c("es"))
   geo &lt;- geolocate_text(df = df, text_col = "text", lang_col="lang") 
   
}
</code></pre>

<hr>
<h2 id='get_aggregates'>Getting already aggregated time series produced by <code><a href="#topic+detect_loop">detect_loop</a></code></h2><span id='topic+get_aggregates'></span>

<h3>Description</h3>

<p>Read and returns the required aggregated dataset for the selected period and topics defined by the filter.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_aggregates(
  dataset = "country_counts",
  cache = TRUE,
  filter = list(),
  top_field = NULL,
  top_freq = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_aggregates_+3A_dataset">dataset</code></td>
<td>
<p>A character(1) vector with the name of the series to request, it must be one of 'country_counts', 'geolocated', 'topwords', 'hashtags', 'entities', 'urls', 'contexts', default: 'country_counts'</p>
</td></tr>
<tr><td><code id="get_aggregates_+3A_cache">cache</code></td>
<td>
<p>Whether to use the cache for lookup and storing the returned dataframe, default: TRUE</p>
</td></tr>
<tr><td><code id="get_aggregates_+3A_filter">filter</code></td>
<td>
<p>A named list defining the filter to apply on the requested series, it should be on the shape of a named list e.g. list(tweet_geo_country_code=list('FR', 'DE')) default: list()</p>
</td></tr>
<tr><td><code id="get_aggregates_+3A_top_field">top_field</code></td>
<td>
<p>Name of the top field used with top_frequency to enable optimisation for getting only most frequent elements. It will only keep top 500 items after first 50k lines on reverse index order</p>
</td></tr>
<tr><td><code id="get_aggregates_+3A_top_freq">top_freq</code></td>
<td>
<p>character, Name of the frequency fields used with top_field to enable optimisation for getting only most frequent elements. 
It will only keep top 500 items after first 50k rows on reverse index order</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function returns data aggregated by epitweetr. The data is found on the 'series' folder, which contains Rds files per weekday and type of series. 
starting on v 1.0.x it will also look on Lucene indexes situated on fs folder. Names of files and folders are parsed to limit the files to be read.
When using Lucene indexes, filters are directly applied on read. This is an improvement compared 'series' folder where filters are applied 
after read. All returned rows are joined in a single dataframe.
If no filter is provided all data series is returned, which can end up with millions of rows depending on the time series. 
To limit by period, the filter list must have an element 'period' containing a date vector or list with two dates representing the start and end of the request.
</p>
<p>To limit by topic, the filter list must have an element 'topic' containing a non-empty character vector or list with the names of the topics to return.
</p>
<p>The available time series are: 
</p>

<ul>
<li><p>&quot;country_counts&quot; counting tweets and retweets by posted date, hour and country
</p>
</li>
<li><p>&quot;geolocated&quot; counting tweets and retweets by posted date and the smallest possible geolocated unit (city, administrative level or country)
</p>
</li>
<li><p>&quot;topwords&quot; counting tweets and retweets by posted date, country and the most popular words, (this excludes words used in the topic search)
</p>
</li></ul>

<p>The returned dataset can be cached for further calls if requested. Only one dataset per series is cached.
</p>


<h3>Value</h3>

<p>A data frame containing the requested series for the requested period
</p>


<h3>See Also</h3>

<p><code><a href="#topic+detect_loop">detect_loop</a></code>
<code><a href="#topic+fs_loop">fs_loop</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
   # Getting all country tweets between 2020-jan-10 and 2020-jan-31 for all topics
   df &lt;- get_aggregates(
     dataset = "country_counts", 
     filter = list(period = c("2020-01-10", "2020-01-31"))
   )

   # Getting all country tweets for the topic dengue
   df &lt;- get_aggregates(dataset = "country_counts", filter = list(topic = "dengue"))

   # Getting all country tweets between 2020-jan-10 and 2020-jan-31 for the topic dengue
    df &lt;- get_aggregates(
        dataset = "country_counts",
         filter = list(topic = "dengue", period = c("2020-01-10", "2020-01-31"))
    )
}
</code></pre>

<hr>
<h2 id='get_alerts'>Getting signals produced by the task <code><a href="#topic+generate_alerts">generate_alerts</a></code> of <code><a href="#topic+detect_loop">detect_loop</a></code></h2><span id='topic+get_alerts'></span>

<h3>Description</h3>

<p>Returns a data frame of signals produced by the <code><a href="#topic+detect_loop">detect_loop</a></code>, which are stored on the signal folder.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_alerts(
  topic = character(),
  countries = numeric(),
  from = "1900-01-01",
  until = "2100-01-01",
  toptweets = 0,
  limit = 0,
  duplicates = "all",
  progress = function(a, b) { }
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_alerts_+3A_topic">topic</code></td>
<td>
<p>Character vector. When it is not empty it will limit the returned signals to the provided topics, default: character()</p>
</td></tr>
<tr><td><code id="get_alerts_+3A_countries">countries</code></td>
<td>
<p>Character vector containing the names of countries or regions or a numeric vector containing the indexes of countries 
as displayed at the Shiny App to filter the signals to return., default: numeric()</p>
</td></tr>
<tr><td><code id="get_alerts_+3A_from">from</code></td>
<td>
<p>Date defining the beginning of the period of signals to return, default: '1900-01-01'</p>
</td></tr>
<tr><td><code id="get_alerts_+3A_until">until</code></td>
<td>
<p>Date defining the end of the period of signals to return, default: '2100-01-01'</p>
</td></tr>
<tr><td><code id="get_alerts_+3A_toptweets">toptweets</code></td>
<td>
<p>Integer number of top tweets to be added to the alert. These are obtained from the tweet index based on topwords and Lucene score, default: 0</p>
</td></tr>
<tr><td><code id="get_alerts_+3A_limit">limit</code></td>
<td>
<p>Maximum number of alerts returned, default: 0</p>
</td></tr>
<tr><td><code id="get_alerts_+3A_duplicates">duplicates</code></td>
<td>
<p>Character, action to decide what to do with alerts generated on the same day. Options are &quot;all&quot; (keep all alerts), &quot;first&quot; get only first alert and &quot;last&quot; for getting only the last alert</p>
</td></tr>
<tr><td><code id="get_alerts_+3A_progress">progress</code></td>
<td>
<p>Function, function to report progress it should receive two parameter a progress between 0 and 1 and a message, default: empty function</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For more details see the package vignette.
</p>


<h3>Value</h3>

<p>a data frame containing the calculated alerts for the period. If no alerts are found then NULL is returned
</p>


<h3>See Also</h3>

<p><code><a href="#topic+generate_alerts">generate_alerts</a></code>
</p>
<p><code><a href="#topic+detect_loop">detect_loop</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   library(epitweetr)
   # setting up the data folder
   message('Please choose the epitweetr data directory')
   setup_config(file.choose()) 

   # Getting signals produced for last 30 days for a particular country
   get_alerts(
     countries = c("Chile", "Australia", "France"), 
     from = as.Date(Sys.time())-30, 
     until = as.Date(Sys.time())
   )
}
</code></pre>

<hr>
<h2 id='get_tasks'>Get the <code><a href="#topic+detect_loop">detect_loop</a></code> task status</h2><span id='topic+get_tasks'></span>

<h3>Description</h3>

<p>Reads the status of the <code><a href="#topic+detect_loop">detect_loop</a></code> tasks and updates it with changes requested by the Shiny app
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_tasks(statuses = list())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_tasks_+3A_statuses">statuses</code></td>
<td>
<p>Character vector for limiting the status of the returned tasks, default: list()</p>
</td></tr>
</table>


<h3>Details</h3>

<p>After reading the tasks.json file and parsing it with jsonlite, this function will update the necessary fields in the 
tasks for executing and monitoring them.
</p>


<h3>Value</h3>

<p>A named list containing all necessary information to run and monitor the detect loop tasks.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+download_dependencies">download_dependencies</a></code>
</p>
<p><code><a href="#topic+update_geonames">update_geonames</a></code>
</p>
<p><code><a href="#topic+update_languages">update_languages</a></code>
</p>
<p><code><a href="#topic+detect_loop">detect_loop</a></code>
</p>
<p><code><a href="#topic+generate_alerts">generate_alerts</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   #getting tasks statuses
   library(epitweetr)
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
   tasks &lt;- get_tasks()
}
</code></pre>

<hr>
<h2 id='get_todays_sample_tweets'>Get a sample of latest tweet geolocations (deprecated)</h2><span id='topic+get_todays_sample_tweets'></span>

<h3>Description</h3>

<p>This function was removed from epitweetr v1.0.1. Please use search_tweets instead
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_todays_sample_tweets(limit = 1000, text_col = "text", lang_col = "lang")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_todays_sample_tweets_+3A_limit">limit</code></td>
<td>
<p>Size of the sample, default: 100</p>
</td></tr>
<tr><td><code id="get_todays_sample_tweets_+3A_text_col">text_col</code></td>
<td>
<p>Name of the tweet field to geolocate it should be one of the following (&quot;text&quot;, &quot;linked_text&quot;, &quot;user_description&quot;, &quot;user_location&quot;, &quot;place_full_name&quot;, &quot;linked_place_full_name&quot;),
default: 'text'</p>
</td></tr>
<tr><td><code id="get_todays_sample_tweets_+3A_lang_col">lang_col</code></td>
<td>
<p>Name of the tweet variable containing the language to evaluate. It should be one of the following (&quot;lang&quot;, &quot;linked_lang&quot;, NA), default: &quot;lang&quot;</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function was removed from epitweetr v1.0.1. Please use search_tweets instead.
</p>


<h3>Value</h3>

<p>Data frame containing the sampled tweets and the geolocation metrics
</p>


<h3>See Also</h3>

<p><code><a href="#topic+download_dependencies">download_dependencies</a></code>
</p>
<p><code><a href="#topic+update_geonames">update_geonames</a></code>
</p>
<p><code><a href="#topic+update_languages">update_languages</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   library(epitweetr)
   # setting up the data folder
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())

   # geolocating today's tweets
   show(get_todays_sample_tweets())
}
</code></pre>

<hr>
<h2 id='health_check'>Send email to administrator if a failure of epitweetr is detected</h2><span id='topic+health_check'></span>

<h3>Description</h3>

<p>It validates if epitweetr is not collecting tweets, aggregating tweets or not calculating alerts
</p>


<h3>Usage</h3>

<pre><code class='language-R'>health_check(send_mail = TRUE, one_per_day = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="health_check_+3A_send_mail">send_mail</code></td>
<td>
<p>Boolean. Whether an email should be sent to the defined administrator, default: TRUE</p>
</td></tr>
<tr><td><code id="health_check_+3A_one_per_day">one_per_day</code></td>
<td>
<p>Boolean. Whether a limit of one email per day will be applied, default: TRUE</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function sends an email to the defined administrator if epitweetr is not collecting tweets, aggregating tweets or not calculating alerts
</p>


<h3>Value</h3>

<p>A list of health check errors found
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   #importing epitweetr
   library(epitweetr)
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
   #sending the email to the administrator if epitweetr components are not properly working
   health_check()
}
</code></pre>

<hr>
<h2 id='is_detect_running'>Check whether the alert detection task is running</h2><span id='topic+is_detect_running'></span>

<h3>Description</h3>

<p>gets the alert detection runner execution status
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_detect_running()
</code></pre>


<h3>Details</h3>

<p>returns a logical value being TRUE if the alert detection task is actually running
</p>


<h3>Value</h3>

<p>logical Whether the alert detection task is running
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   library(epitweetr)
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
   is_detect_running()
}
</code></pre>

<hr>
<h2 id='is_fs_running'>Check whether the database is running</h2><span id='topic+is_fs_running'></span>

<h3>Description</h3>

<p>gets the database runner execution status
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_fs_running()
</code></pre>


<h3>Details</h3>

<p>returns a logical value being TRUE if the database runner is actually running
</p>


<h3>Value</h3>

<p>logical Whether the database is running
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   library(epitweetr)
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
   is_fs_running()
}
</code></pre>

<hr>
<h2 id='is_search_running'>Check whether the tweet collection task is running</h2><span id='topic+is_search_running'></span>

<h3>Description</h3>

<p>gets the tweet collection execution status
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_search_running()
</code></pre>


<h3>Details</h3>

<p>returns a logical value being TRUE if the tweet collection is running
</p>


<h3>Value</h3>

<p>logical Whether the tweet collection is running
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   library(epitweetr)
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
   is_search_running()
}
</code></pre>

<hr>
<h2 id='json2lucene'>Function used for migrating tweets from to old to the new file system</h2><span id='topic+json2lucene'></span>

<h3>Description</h3>

<p>migrates geolocated tweets from the old to the new file system allowing full text search using Apache Lucene Indexes
</p>


<h3>Usage</h3>

<pre><code class='language-R'>json2lucene(tasks = get_tasks(), chunk_size = 400)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="json2lucene_+3A_tasks">tasks</code></td>
<td>
<p>named list, current tasks for logging and updating progress default: get_tasks()</p>
</td></tr>
<tr><td><code id="json2lucene_+3A_chunk_size">chunk_size</code></td>
<td>
<p>integer, the chunk size for indexing tweets, default: 400</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function can be called manually to perform the migration of tweets between v0.0.x to v2+
It iterates over existing tweets collected with epitweetr v0.0.x series
joins base tweets and geolocated tweets and then sends themes to the Lucene index via the dedicated REST API.
Migrated files will be moved to search_archive and geo_archive folders. Users can backup and remove these folders when migration ends to gain disk space.
Series folders are maintained for migrated tweets
</p>


<h3>Value</h3>

<p>the updated tasks.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   library(epitweetr)
   # setting up the data folder
   message('Please choose the epitweetr data directory')
   setup_config(file.choose()) 
   # runnint the migration
   json2lucene()
}
</code></pre>

<hr>
<h2 id='register_detect_runner_task'>Registers the alert detection task</h2><span id='topic+register_detect_runner_task'></span>

<h3>Description</h3>

<p>registers the alert detection task or stops if no configuration has been set or if it is already running
</p>


<h3>Usage</h3>

<pre><code class='language-R'>register_detect_runner_task()
</code></pre>


<h3>Details</h3>

<p>Registers the alert detection task or stops if no configuration has been set or if it is already running.
To generate alerts, this task needs the tweet collection to had successfully run since the last time it ran.
This function will use the task scheduler on windows and will fall back to launching the runner as a separate process (attached to this session) on Linux.
</p>


<h3>Value</h3>

<p>Nothing
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   #getting tasks statuses
   library(epitweetr)
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
   register_detect_runner_task()
}
</code></pre>

<hr>
<h2 id='register_fs_monitor'>Registers the fs_monitor for the current process or exits</h2><span id='topic+register_fs_monitor'></span>

<h3>Description</h3>

<p>registers the fs_monitor (by writing fs.monitor.PID file) for the current process or stops if no configuration has been set or if it is already running
</p>


<h3>Usage</h3>

<pre><code class='language-R'>register_fs_monitor()
</code></pre>


<h3>Details</h3>

<p>Registers the fs_monitor (by writing fs.monitor.PID file) for the current process or stops if no configuration has been set or if it is already running
This function has been exported so it can be properly called from the future package on the database runner, but it is not intended to be directly called by end users.
</p>


<h3>Value</h3>

<p>Nothing
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   #getting tasks statuses
   library(epitweetr)
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
   register_fs_monitor()
}
</code></pre>

<hr>
<h2 id='register_fs_runner_task'>Registers the epitweetr database task</h2><span id='topic+register_fs_runner_task'></span>

<h3>Description</h3>

<p>registers the epitweetr database task or stops if no configuration has been set or if it is already running
</p>


<h3>Usage</h3>

<pre><code class='language-R'>register_fs_runner_task()
</code></pre>


<h3>Details</h3>

<p>Registers the epitweetr database task or stops if no configuration has been set or if it is already running.
This task need the dependencies, geonames and languages steps to have been successfully ran. This can be done on the shiny app configuration page or by manually running the detect_runner_task.
This function will try to use the task scheduler on windows and will fall back to launching the runner as a separate process (attached to this session) on Linux.
</p>


<h3>Value</h3>

<p>Nothing
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   #getting tasks statuses
   library(epitweetr)
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
   register_fs_runner_task()
}
</code></pre>

<hr>
<h2 id='register_search_runner_task'>Registers the tweet collection task</h2><span id='topic+register_search_runner_task'></span>

<h3>Description</h3>

<p>registers the tweet collection task or stops if no configuration has been set or if it is already running
</p>


<h3>Usage</h3>

<pre><code class='language-R'>register_search_runner_task()
</code></pre>


<h3>Details</h3>

<p>Registers the tweet collextion task or stops if no configuration has been set or if it is already running.
Twitter authentication needs to be previously set on the shiny app or by calling set_twitter_app_auth(). 
You can test if authentication is working on the shiny app troubleshot page or by calling (with dplyr): epitweetr::check_all() 
This function will use the task scheduler on windows and will fall back to launching the runner as a separate process (attached to this session) on Linux.
</p>


<h3>Value</h3>

<p>Nothing
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   #getting tasks statuses
   library(epitweetr)
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
   register_search_runner_task()
}
</code></pre>

<hr>
<h2 id='save_config'>Save the configuration changes</h2><span id='topic+save_config'></span>

<h3>Description</h3>

<p>Permanently saves configuration changes to the data folder (excluding Twitter credentials, but not SMTP credentials)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>save_config(data_dir = conf$data_dir, properties = TRUE, topics = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="save_config_+3A_data_dir">data_dir</code></td>
<td>
<p>Path to a directory to save configuration settings, Default: conf$data_dir</p>
</td></tr>
<tr><td><code id="save_config_+3A_properties">properties</code></td>
<td>
<p>Whether to save the general properties to the properties.json file, default: TRUE</p>
</td></tr>
<tr><td><code id="save_config_+3A_topics">topics</code></td>
<td>
<p>Whether to save topic download plans to the topics.json file, default: TRUE</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Permanently saves configuration changes to the data folder (excluding Twitter credentials, but not SMTP credentials)
to save Twitter credentials please use <code><a href="#topic+set_twitter_app_auth">set_twitter_app_auth</a></code>
</p>


<h3>Value</h3>

<p>Nothing
</p>


<h3>See Also</h3>

<p><code><a href="#topic+setup_config">setup_config</a></code>
<code><a href="#topic+set_twitter_app_auth">set_twitter_app_auth</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   library(epitweetr)
   #load configuration
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
   #make some changes
   #conf$collect_span = 90
   #saving changes    
   save_config()
}
</code></pre>

<hr>
<h2 id='search_loop'>Runs the search loop</h2><span id='topic+search_loop'></span>

<h3>Description</h3>

<p>Infinite loop ensuring the permanent collection of tweets
</p>


<h3>Usage</h3>

<pre><code class='language-R'>search_loop(data_dir = NA)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="search_loop_+3A_data_dir">data_dir</code></td>
<td>
<p>optional path to the 'data directory' containing application settings, models and collected tweets. If not provided it will reuse the last set on the current session.
If not provided the system will try to reuse the existing one from last session call of <code><a href="#topic+setup_config">setup_config</a></code> or use the EPI_HOME environment variable, Default: NA</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The detect loop is a pure R function designed for downloading tweets from the Twitter search API. It can handle several topics ensuring that all of them will be downloaded fairly using a 
round-robin philosophy and respecting Twitter API rate-limits.
</p>
<p>The progress of this task is reported on the 'topics.json' file which is read or created by this function. This function will try to collect tweets respecting a 'collect_span' window
in minutes, which is defined on the Shiny app and defaults to 60 minutes.
</p>
<p>To see more details about the collection algorithm please see epitweetr vignette.
</p>
<p>In order to work, this task needs Twitter credentials, which can be set on the Shiny app or using <code><a href="#topic+set_twitter_app_auth">set_twitter_app_auth</a></code>
</p>


<h3>Value</h3>

<p>Nothing
</p>


<h3>See Also</h3>

<p><code><a href="#topic+set_twitter_app_auth">set_twitter_app_auth</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   #Running the search loop
   library(epitweetr)
   message('Please choose the epitweetr data directory')
   search_loop(file.choose())
}
</code></pre>

<hr>
<h2 id='search_tweets'>perform full text search on tweets collected with epitweetr</h2><span id='topic+search_tweets'></span>

<h3>Description</h3>

<p>perform full text search on tweets collected with epitweetr (tweets migrated from epitweetr v&lt;1.0.x are also included)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>search_tweets(
  query = NULL,
  topic = NULL,
  from = NULL,
  to = NULL,
  countries = NULL,
  mentioning = NULL,
  users = NULL,
  hide_users = FALSE,
  action = NULL,
  max = 100,
  by_relevance = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="search_tweets_+3A_query">query</code></td>
<td>
<p>character. The query to be used if a text it will match the tweet text. To see how to match particular fields please see details, default:NULL</p>
</td></tr>
<tr><td><code id="search_tweets_+3A_topic">topic</code></td>
<td>
<p>character, Vector of topics to include on the search default:NULL</p>
</td></tr>
<tr><td><code id="search_tweets_+3A_from">from</code></td>
<td>
<p>an object which can be converted to â&quot;POSIXlt&quot;â only tweets posted after or on this date will be included, default:NULL</p>
</td></tr>
<tr><td><code id="search_tweets_+3A_to">to</code></td>
<td>
<p>an object which can be converted to â&quot;POSIXlt&quot;â only tweets posted before or on this date will be included, default:NULL</p>
</td></tr>
<tr><td><code id="search_tweets_+3A_countries">countries</code></td>
<td>
<p>character or numeric, the position or name of epitweetr regions to be included on the query, default:NULL</p>
</td></tr>
<tr><td><code id="search_tweets_+3A_mentioning">mentioning</code></td>
<td>
<p>character, limit the search to the tweets mentioning the given users, default:NULL</p>
</td></tr>
<tr><td><code id="search_tweets_+3A_users">users</code></td>
<td>
<p>character, limit the search to the tweets created by the provided users, default:NULL</p>
</td></tr>
<tr><td><code id="search_tweets_+3A_hide_users">hide_users</code></td>
<td>
<p>logical, whether to hide user names on output replacing them by the USER keyword, default:FALSE</p>
</td></tr>
<tr><td><code id="search_tweets_+3A_action">action</code></td>
<td>
<p>character, an action to be performed on the search results respecting the max parameter. Possible values are 'delete' or 'anonymise' , default:NULL</p>
</td></tr>
<tr><td><code id="search_tweets_+3A_max">max</code></td>
<td>
<p>integer, maximum number of tweets to be included on the search, default:100</p>
</td></tr>
<tr><td><code id="search_tweets_+3A_by_relevance">by_relevance</code></td>
<td>
<p>logical, whether to sort the results by relevance of the matching query or by indexing order, default:FALSE
If not provided the system will try to reuse the existing one from last session call of <code><a href="#topic+setup_config">setup_config</a></code> or use the EPI_HOME environment variable, default: NA</p>
</td></tr>
</table>


<h3>Details</h3>

<p>epitweetr translate the query provided by all parameters into a single query that will be executed on tweet indexes which are weekly indexes.
The q parameter should respect the syntax of the Lucene classic parser <a href="https://lucene.apache.org/core/8_5_0/queryparser/org/apache/lucene/queryparser/classic/QueryParser.html">https://lucene.apache.org/core/8_5_0/queryparser/org/apache/lucene/queryparser/classic/QueryParser.html</a> 
So other than the provided parameters, multi field queries are supported by using the syntax field_name:value1;value2 
AND, OR and -(for excluding terms) are supported on q parameter.
Order by week is always applied before relevance so even if you provide by_relevance = TRUE all of the matching tweets of the first week will be returned first
</p>


<h3>Value</h3>

<p>a data frame containing the tweets matching the selected filters, the data frame contains the following columns: linked_user_location, linked_user_name, linked_user_description, 
screen_name, created_date, is_geo_located, user_location_loc, is_retweet, text, text_loc, user_id, hash, user_description, linked_lang, linked_screen_name, user_location, totalCount, 
created_at, topic_tweet_id, topic, lang, user_name, linked_text, tweet_id, linked_text_loc, hashtags, user_description_loc
</p>


<h3>See Also</h3>

<p><code><a href="#topic+search_loop">search_loop</a></code>
</p>
<p><code><a href="#topic+detect_loop">detect_loop</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   #Running the detect loop
   library(epitweetr)
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
   df &lt;- search_tweets(
        q = "vaccination", 
        topic="COVID-19", 
        countries=c("Chile", "Australia", "France"), 
        from = Sys.Date(), 
        to = Sys.Date()
   )
   df$text
}
</code></pre>

<hr>
<h2 id='set_twitter_app_auth'>Save Twitter App credentials</h2><span id='topic+set_twitter_app_auth'></span>

<h3>Description</h3>

<p>Update Twitter authentication tokens in a configuration object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_twitter_app_auth(
  app = "",
  access_token = "",
  access_token_secret = "",
  api_key = "",
  api_secret = "",
  bearer = ""
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_twitter_app_auth_+3A_app">app</code></td>
<td>
<p>Application name</p>
</td></tr>
<tr><td><code id="set_twitter_app_auth_+3A_access_token">access_token</code></td>
<td>
<p>Access token as provided by Twitter</p>
</td></tr>
<tr><td><code id="set_twitter_app_auth_+3A_access_token_secret">access_token_secret</code></td>
<td>
<p>Access token secret as provided by Twitter</p>
</td></tr>
<tr><td><code id="set_twitter_app_auth_+3A_api_key">api_key</code></td>
<td>
<p>API key as provided by Twitter</p>
</td></tr>
<tr><td><code id="set_twitter_app_auth_+3A_api_secret">api_secret</code></td>
<td>
<p>API secret as provided by Twitter</p>
</td></tr>
<tr><td><code id="set_twitter_app_auth_+3A_bearer">bearer</code></td>
<td>
<p>the bearer token of the application</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Update Twitter authentication tokens in configuration object
</p>


<h3>Value</h3>

<p>Nothing
</p>


<h3>See Also</h3>

<p><code><a href="#topic+save_config">save_config</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
 #Setting the configuration values
   set_twitter_app_auth(
     app = "my super app", 
     access_token = "123456", 
     access_token_secret = "123456", 
     api_key = "123456", 
     api_secret = "123456"
   )
   set_twitter_app_auth(
     bearer = "123456"
   )
}
</code></pre>

<hr>
<h2 id='setup_config'>Load epitweetr application settings</h2><span id='topic+setup_config'></span>

<h3>Description</h3>

<p>Load epitweetr application settings from the designated data directory
</p>


<h3>Usage</h3>

<pre><code class='language-R'>setup_config(
  data_dir = if (exists("data_dir", where = conf)) conf$data_dir else if
    (Sys.getenv("EPI_HOME") != "") Sys.getenv("EPI_HOME") else file.path(getwd(),
    "epitweetr"),
  ignore_keyring = FALSE,
  ignore_properties = FALSE,
  ignore_topics = FALSE,
  save_first = list()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="setup_config_+3A_data_dir">data_dir</code></td>
<td>
<p>Path to the directory containing the application settings (it must exist). 
If not provided it takes the value of the latest call to setup_config in the current session, or the value of the EPI_HOME environment variable or epitweetr subdirectory in the working directory, 
default: if (exists(&quot;data_dir&quot;, where = conf)) conf$data_dir else if (Sys.getenv(&quot;EPI_HOME&quot;) !=
&quot;&quot;) Sys.getenv(&quot;EPI_HOME&quot;) else file.path(getwd(), &quot;epitweetr&quot;)</p>
</td></tr>
<tr><td><code id="setup_config_+3A_ignore_keyring">ignore_keyring</code></td>
<td>
<p>Whether to skip loading settings from the keyring (Twitter and SMTP credentials), default: FALSE</p>
</td></tr>
<tr><td><code id="setup_config_+3A_ignore_properties">ignore_properties</code></td>
<td>
<p>Whether to skip loading settings managed by the Shiny app in properties.json file, Default: FALSE</p>
</td></tr>
<tr><td><code id="setup_config_+3A_ignore_topics">ignore_topics</code></td>
<td>
<p>Whether to skip loading settings defined in the topics.xlsx file and download plans from topics.json file, default: FALSE</p>
</td></tr>
<tr><td><code id="setup_config_+3A_save_first">save_first</code></td>
<td>
<p>Whether to save current settings before loading new ones from disk, default: list()</p>
</td></tr>
</table>


<h3>Details</h3>

<p>epitweetr relies on settings and data stored in a system folder, so before loading the dashboard, collecting tweets or detecting alerts the user has to designate this folder.
When a user wants to use epitweetr from the R console they will need to call this function for initialisation.
The 'data_folder' can also be given as a parameter for program launch functions <code><a href="#topic+epitweetr_app">epitweetr_app</a></code>, <code><a href="#topic+search_loop">search_loop</a></code> or <code><a href="#topic+detect_loop">detect_loop</a></code>, which will internally call this function.
</p>
<p>This call will fill (or refresh) a package scoped environment 'conf' that will store the settings. Settings stored in conf are:
</p>

<ul>
<li><p>General properties of the Shiny app (stored in properties.json)
</p>
</li>
<li><p>Download plans from the Twitter collection process (stored in topics.json merged with data from the topics.xlsx file
</p>
</li>
<li><p>Credentials for Twitter API and SMTP stored in the defined keyring
</p>
</li></ul>

<p>When calling this function and the keyring is locked, a password will be prompted to unlock the keyring.
This behaviour can be changed by setting the environment variable 'ecdc_twitter_tool_kr_password' with the password.
</p>
<p>Changes made to conf can be stored permanently (except for 'data_dir') using:
</p>

<ul>
<li><p><code><a href="#topic+save_config">save_config</a></code>, or
</p>
</li>
<li><p><code><a href="#topic+set_twitter_app_auth">set_twitter_app_auth</a></code>
</p>
</li></ul>



<h3>Value</h3>

<p>Nothing
</p>


<h3>See Also</h3>

<p><code><a href="#topic+save_config">save_config</a></code>
<code><a href="#topic+set_twitter_app_auth">set_twitter_app_auth</a></code>
<code><a href="#topic+epitweetr_app">epitweetr_app</a></code>
<code><a href="#topic+search_loop">search_loop</a></code>
<code><a href="#topic+detect_loop">detect_loop</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   library(epitweetr)
   #loading system settings
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
}
</code></pre>

<hr>
<h2 id='stop_detect_runner_task'>Stops the alert detection task</h2><span id='topic+stop_detect_runner_task'></span>

<h3>Description</h3>

<p>stops the alert detection task
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stop_detect_runner_task()
</code></pre>


<h3>Details</h3>

<p>Stops the alert detection task if it is already running
This function will try also deactivate the respective scheduled task on Windows.
</p>


<h3>Value</h3>

<p>Nothing
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   #getting tasks statuses
   library(epitweetr)
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
   stop_detect_runner_task()
}
</code></pre>

<hr>
<h2 id='stop_fs_runner_task'>Stops the epitweetr database task</h2><span id='topic+stop_fs_runner_task'></span>

<h3>Description</h3>

<p>stops the epitweetr database task
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stop_fs_runner_task()
</code></pre>


<h3>Details</h3>

<p>Stops the epitweetr database task if it is already running
This function will try also deactivate the respective scheduled task on Windows.
</p>


<h3>Value</h3>

<p>Nothing
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   #getting tasks statuses
   library(epitweetr)
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
   stop_fs_runner_task()
}
</code></pre>

<hr>
<h2 id='stop_search_runner_task'>Stops the tweet collection task</h2><span id='topic+stop_search_runner_task'></span>

<h3>Description</h3>

<p>stops the tweet collection task
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stop_search_runner_task()
</code></pre>


<h3>Details</h3>

<p>Stops the tweet collection task if it is already running
This function will try also deactivate the respective scheduled task on Windows.
</p>


<h3>Value</h3>

<p>Nothing
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   #getting tasks statuses
   library(epitweetr)
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
   stop_search_runner_task()
}
</code></pre>

<hr>
<h2 id='trend_line'>Plot the trendline report of epitweetr dashboard</h2><span id='topic+trend_line'></span>

<h3>Description</h3>

<p>Generates a trendline chart of number of tweets by region, for one topic, including alerts using the reweighted version of the EARS algorithm
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trend_line(
  topic,
  countries = c(1),
  date_type = "created_date",
  date_min = "1900-01-01",
  date_max = "2100-01-01",
  with_retweets = FALSE,
  location_type = "tweet",
  alpha = 0.025,
  alpha_outlier = 0.05,
  k_decay = 4,
  no_historic = 7,
  bonferroni_correction = FALSE,
  same_weekday_baseline = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="trend_line_+3A_topic">topic</code></td>
<td>
<p>Character(1) containing the topic to use for the report</p>
</td></tr>
<tr><td><code id="trend_line_+3A_countries">countries</code></td>
<td>
<p>Character vector containing the name of the countries and regions to plot or their respective indexes on the Shiny app select, default: c(1)</p>
</td></tr>
<tr><td><code id="trend_line_+3A_date_type">date_type</code></td>
<td>
<p>Character vector specifying the time granularity of the report either 'created_weeknum' or 'created_date', default: 'created_date'</p>
</td></tr>
<tr><td><code id="trend_line_+3A_date_min">date_min</code></td>
<td>
<p>Date indicating start of the reporting period, default: &quot;1900-01-01&quot;</p>
</td></tr>
<tr><td><code id="trend_line_+3A_date_max">date_max</code></td>
<td>
<p>Date indicating end of the reporting period, default: &quot;2100-01-01&quot;</p>
</td></tr>
<tr><td><code id="trend_line_+3A_with_retweets">with_retweets</code></td>
<td>
<p>Logical value indicating whether to include retweets in the time series, default: FALSE</p>
</td></tr>
<tr><td><code id="trend_line_+3A_location_type">location_type</code></td>
<td>
<p>Character(1) vector indicating the location type. Possible values 'tweet', 'user' or 'both', default: 'tweet'</p>
</td></tr>
<tr><td><code id="trend_line_+3A_alpha">alpha</code></td>
<td>
<p>Numeric(1) value indicating the alert detection confidence, default: 0.025</p>
</td></tr>
<tr><td><code id="trend_line_+3A_alpha_outlier">alpha_outlier</code></td>
<td>
<p>Numeric(1) value indicating the outliers detection confidence for downweighting, default: 0.05</p>
</td></tr>
<tr><td><code id="trend_line_+3A_k_decay">k_decay</code></td>
<td>
<p>Strength of outliers downweighting, default: 4</p>
</td></tr>
<tr><td><code id="trend_line_+3A_no_historic">no_historic</code></td>
<td>
<p>Number of observations to build the baseline for signal detection, default: 7</p>
</td></tr>
<tr><td><code id="trend_line_+3A_bonferroni_correction">bonferroni_correction</code></td>
<td>
<p>Logical value indicating whether to apply the Bonferroni correction for signal detection, default: FALSE</p>
</td></tr>
<tr><td><code id="trend_line_+3A_same_weekday_baseline">same_weekday_baseline</code></td>
<td>
<p>Logical value indicating whether to use same day of weeks for building the baseline or consecutive days, default: FALSE</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Produces a multi-region line chart for a particular topic of number of tweets collected based on the provided parameters. 
Alerts will be calculated using a modified version of the EARS algorithm that applies a Farrington inspired downweighting of previous outliers.
</p>
<p>Days in this function are considered as contiguous blocks of 24 hours starting for the previous hour of the last collected tweet.
</p>
<p>This function requires <code><a href="#topic+search_loop">search_loop</a></code> and <code><a href="#topic+detect_loop">detect_loop</a></code> to have already run successfully to show results.
</p>


<h3>Value</h3>

<p>A named list containing two elements: 'chart' with the ggplot2 figure and 'data' containing the data frame that was used to build the chart.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+create_map">create_map</a></code>
<code><a href="#topic+create_topwords">create_topwords</a></code>
<code><a href="#topic+generate_alerts">generate_alerts</a></code>
<code><a href="#topic+detect_loop">detect_loop</a></code>
<code><a href="#topic+search_loop">search_loop</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())
   #Getting trendline for dengue for South America for the last 30 days
   trend_line(
     topic = "dengue", 
     countries = "South America", 
     date_min = as.Date(Sys.time())-30, 
     date_max=as.Date(Sys.time())
   ) 
}
</code></pre>

<hr>
<h2 id='update_geonames'>Updates the local copy of the GeoNames database</h2><span id='topic+update_geonames'></span>

<h3>Description</h3>

<p>Downloading and indexing a fresh version of the GeoNames database from the provided URL
</p>


<h3>Usage</h3>

<pre><code class='language-R'>update_geonames(tasks = get_tasks())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="update_geonames_+3A_tasks">tasks</code></td>
<td>
<p>Tasks object for reporting progress and error messages, default: get_tasks()</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Run a one shot task to download and index a local copy of the  <a href="http://www.geonames.org/">GeoNames database</a>. 
The GeoNames geographical database covers all countries and contains over eleven million place names that are available; Creative Commons Attribution 4.0 License. 
</p>
<p>The URL to download the database from is set on the configuration tab of the Shiny app, in case it changes.
</p>
<p>The indexing is developed in Spark and Lucene
</p>
<p>A prerequisite to this function is that the <code><a href="#topic+search_loop">search_loop</a></code> must already have stored collected tweets in the search folder and that the task <code><a href="#topic+download_dependencies">download_dependencies</a></code>
has been successfully run.
</p>
<p>Normally this function is not called directly by the user but from the <code><a href="#topic+detect_loop">detect_loop</a></code> function.
</p>


<h3>Value</h3>

<p>The list of tasks updated with produced messages
</p>


<h3>See Also</h3>

<p><code><a href="#topic+download_dependencies">download_dependencies</a></code>
</p>
<p><code><a href="#topic+detect_loop">detect_loop</a></code>
</p>
<p><code><a href="#topic+get_tasks">get_tasks</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   library(epitweetr)
   # setting up the data folder
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())

   # geolocating last tweets
   tasks &lt;- update_geonames()
}
</code></pre>

<hr>
<h2 id='update_languages'>Updates local copies of languages</h2><span id='topic+update_languages'></span>

<h3>Description</h3>

<p>Downloading and indexing a fresh version of language models tagged for update on the Shiny app configuration tab
</p>


<h3>Usage</h3>

<pre><code class='language-R'>update_languages(tasks = get_tasks())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="update_languages_+3A_tasks">tasks</code></td>
<td>
<p>Tasks object for reporting progress and error messages, default: get_tasks()</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Run a one shot task to download and index a local fasttext <a href="https://fasttext.cc/docs/en/crawl-vectors.html">pretrained models</a>. 
A fasttext model is a collection of vectors for a language automatically produced scrolling a big corpus of text that can be used to capture the semantic of a word.
</p>
<p>The URL to download the vectors from are set on the configuration tab of the Shiny app.
</p>
<p>This task will also update SVM models to predict whether a word is a location that will be used in the geolocation process.
</p>
<p>The indexing is developed in SPARK and Lucene.
</p>
<p>A prerequisite to this function is that the <code><a href="#topic+search_loop">search_loop</a></code> must already have stored collected tweets in the search folder and that the tasks <code><a href="#topic+download_dependencies">download_dependencies</a></code>
and <code><a href="#topic+update_geonames">update_geonames</a></code> has been run successfully.
</p>
<p>Normally this function is not called directly by the user but from the <code><a href="#topic+detect_loop">detect_loop</a></code> function.
</p>


<h3>Value</h3>

<p>The list of tasks updated with produced messages
</p>


<h3>See Also</h3>

<p><code><a href="#topic+download_dependencies">download_dependencies</a></code>
</p>
<p><code><a href="#topic+update_geonames">update_geonames</a></code>
</p>
<p><code><a href="#topic+detect_loop">detect_loop</a></code>
</p>
<p><code><a href="#topic+get_tasks">get_tasks</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(FALSE){
   library(epitweetr)
   # setting up the data folder
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())

   # updating language tasks
   tasks &lt;- update_languages()
}
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
