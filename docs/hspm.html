<!DOCTYPE html><html lang="en"><head><title>Help for package hspm</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {hspm}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#baltim'><p>Baltimore house sales prices and hedonics</p></a></li>
<li><a href='#ivregimes'><p>Estimation of regime models with endogenous variables</p></a></li>
<li><a href='#natreg'><p>US Counties Homicides data</p></a></li>
<li><a href='#regimes'><p>Estimation of regimes models</p></a></li>
<li><a href='#spregimes'><p>Estimation of spatial regimes models</p></a></li>
<li><a href='#ws_6'><p>Spatial weighting matrix for the US Counties Homicides data</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Heterogeneous Spatial Models</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-03-07</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Gianfranco Piras &lt;gpiras@mac.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Spatial heterogeneity can be specified in various ways. 'hspm' is an ambitious project that aims at implementing various methodologies to control for heterogeneity in spatial models. The current version of 'hspm' deals with spatial and (non-spatial) regimes models. In particular, the package allows to estimate a general spatial regimes model with additional endogenous variables, specified in terms of a spatial lag of the dependent variable, the spatially lagged regressors, and, potentially, a spatially autocorrelated error term. Spatial regime models are estimated by instrumental variables and generalized methods of moments (see Arraiz et al., (2010) &lt;<a href="https://doi.org/10.1111%2Fj.1467-9787.2009.00618.x">doi:10.1111/j.1467-9787.2009.00618.x</a>&gt;, Bivand and Piras, (2015) &lt;<a href="https://doi.org/10.18637%2Fjss.v063.i18">doi:10.18637/jss.v063.i18</a>&gt;, Drukker et al., (2013) &lt;<a href="https://doi.org/10.1080%2F07474938.2013.741020">doi:10.1080/07474938.2013.741020</a>&gt;, Kelejian and Prucha, (2010) &lt;<a href="https://doi.org/10.1016%2Fj.jeconom.2009.10.025">doi:10.1016/j.jeconom.2009.10.025</a>&gt;).</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.2</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>Formula, sphet, stats, spdep, Matrix</td>
</tr>
<tr>
<td>Suggests:</td>
<td>splm</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/gpiras/hspm">https://github.com/gpiras/hspm</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/gpiras/hspm/issues">https://github.com/gpiras/hspm/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-03-07 12:47:11 UTC; gpiras</td>
</tr>
<tr>
<td>Author:</td>
<td>Gianfranco Piras <a href="https://orcid.org/0000-0003-0225-6061"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Mauricio Sarrias <a href="https://orcid.org/0000-0001-5932-4817"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-03-08 08:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='baltim'>Baltimore house sales prices and hedonics</h2><span id='topic+baltim'></span>

<h3>Description</h3>

<p>A dataset containing the prices and other attributes of 211 dwelling in Baltimore, MD
</p>


<h3>Usage</h3>

<pre><code class='language-R'>baltim
</code></pre>


<h3>Format</h3>

<p>A data frame with 211 rows and 17 variables:
</p>

<dl>
<dt>STATION</dt><dd><p>ID variable</p>
</dd>
<dt>PRICE</dt><dd><p>sales price, in 1,000 US dollars (MLS)</p>
</dd>
<dt>NROOM</dt><dd><p>number of rooms</p>
</dd>
<dt>DWELL</dt><dd><p>1 if detached unit, 0 otherwise</p>
</dd>
<dt>NBATH</dt><dd><p>number of bathrooms</p>
</dd>
<dt>PATIO</dt><dd><p>1 if patio, 0 otherwise</p>
</dd>
<dt>FIREPL</dt><dd><p>1 if fireplace, 0 otherwise</p>
</dd>
<dt>AC</dt><dd><p>1 if air conditioning, 0 otherwise</p>
</dd>
<dt>BMENT</dt><dd><p>1 if basement, 0 otherwise</p>
</dd>
<dt>NSTOR</dt><dd><p>number of stores</p>
</dd>
<dt>GAR</dt><dd><p>number of car space in garage, (0 = no garage)</p>
</dd>
<dt>AGE</dt><dd><p>age of dwellings in years</p>
</dd>
<dt>CITCOU</dt><dd><p>1 if dwelling is in Baltimore County, 0 otherwise</p>
</dd>
<dt>LOTSZ</dt><dd><p>lot size in hundreds of square feet</p>
</dd>
<dt>SQFT</dt><dd><p>interior living space in hundreds of square feet</p>
</dd>
<dt>X</dt><dd><p>X coordinate on the Maryland grid</p>
</dd>
<dt>Y</dt><dd><p>Y coordinate on the Maryland grid</p>
</dd>
</dl>



<h3>Source</h3>

<p><a href="https://geodacenter.github.io/data-and-lab/">https://geodacenter.github.io/data-and-lab/</a>
</p>

<hr>
<h2 id='ivregimes'>Estimation of regime models with endogenous variables</h2><span id='topic+ivregimes'></span>

<h3>Description</h3>

<p>The function <code>ivregimes</code> deals with
the estimation of regime models.
Most of the times the variable identifying the regimes
reveals some spatial aspects of the data (e.g., administrative boundaries).
The model includes exogenous as well as endogenous
variables among the regressors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ivregimes(formula, data, rgv = NULL, vc = c("homoskedastic", "robust", "OGMM"))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ivregimes_+3A_formula">formula</code></td>
<td>
<p>a symbolic description of the model of the form <code>y ~ x_f | x_v | h_f | h_v</code> where <code>y</code> is the dependent variable, <code>x_f</code> are the regressors that do not vary by regimes,  <code>x_v</code> are the regressors that vary by regimes, <code>h_f</code> are the fixed instruments and <code>h_v</code> are the instruments that vary by regimes.</p>
</td></tr>
<tr><td><code id="ivregimes_+3A_data">data</code></td>
<td>
<p>the data of class <code>data.frame</code>.</p>
</td></tr>
<tr><td><code id="ivregimes_+3A_rgv">rgv</code></td>
<td>
<p>an object of class <code>formula</code> to identify the regime variables</p>
</td></tr>
<tr><td><code id="ivregimes_+3A_vc">vc</code></td>
<td>
<p>one of <code>c("homoskedastic", "robust", "OGMM")</code>. If <code>"OGMM"</code> an optimal weighted GMM is used to estimate the VC matrix.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The basic (non spatial) model with endogenous variables
can be written in a general way as:
</p>
<p style="text-align: center;"><code class="reqn">
y
=
\begin{bmatrix}
X_1&amp; 0 \\
0 &amp; X_2 \\
\end{bmatrix}
\begin{bmatrix}
\beta_1 \\
\beta_2 \\
\end{bmatrix}
+ X\beta +
\begin{bmatrix}
Y_1&amp; 0 \\
0 &amp; Y_2 \\
\end{bmatrix}
\begin{bmatrix}
\pi_1 \\
\pi_2 \\
\end{bmatrix}
+ Y\pi +
 \varepsilon
</code>
</p>

<p>where  <code class="reqn">y = [y_1^\prime,y_2^\prime]^\prime</code>,
and the <code class="reqn">n_1 \times 1</code> vector <code class="reqn">y_1</code> contains the observations
on the dependent variable for the first regime,
and the <code class="reqn">n_2 \times 1</code> vector <code class="reqn">y_2</code> (with <code class="reqn">n_1 + n_2 = n</code>)
contains the observations on the dependent variable for the second regime.
The <code class="reqn">n_1 \times k</code> matrix <code class="reqn">X_1</code> and the <code class="reqn">n_2 \times k</code>
matrix <code class="reqn">X_2</code> are blocks of a block diagonal matrix,
the vectors of parameters  <code class="reqn">\beta_1</code> and <code class="reqn">\beta_2</code> have
dimension <code class="reqn">k_1 \times 1</code> and <code class="reqn">k_2 \times 1</code>, respectively,
<code class="reqn">X</code> is the <code class="reqn">n \times p</code> matrix of regressors that do not vary by regime,
<code class="reqn">\beta</code>  is a <code class="reqn">p\times 1</code> vector of parameters.
The three matrices <code class="reqn">Y_1</code> (<code class="reqn">n_1 \times q</code>),
<code class="reqn">Y_2</code> (<code class="reqn">n_2 \times q</code>) and <code class="reqn">Y</code> (<code class="reqn">n \times r</code>)
with corresponding vectors of parameters <code class="reqn">\pi_1</code>, <code class="reqn">\pi_2</code> and <code class="reqn">\pi</code>,
contain the endogenous variables.
Finally, <code class="reqn">\varepsilon = [\varepsilon_1^\prime,\varepsilon_2^\prime]^\prime</code>
is the <code class="reqn">n\times 1</code> vector of innovations.
The model is estimated by two stage least square.
In particular:
</p>

<ul>
<li><p> If <code>vc = "homoskedastic"</code>,
the variance-covariance matrix is estimated by <code class="reqn">\sigma^2(\hat Z^\prime \hat Z)^{-1}</code>,
where <code class="reqn">\hat Z= PZ</code>,  <code class="reqn">P= H(H^\prime H)^{-1}H^\prime</code>, <code class="reqn">H</code> is the matrix of instruments,
and <code class="reqn">Z</code> is the matrix of all exogenous and endogenous variables in the model.
</p>
</li>
<li><p> If <code>vc = "robust"</code>, the variance-covariance matrix is estimated by
<code class="reqn">(\hat Z^\prime \hat Z)^{-1}(\hat Z^\prime \hat\Sigma \hat Z) (\hat Z^\prime \hat Z)^{-1}</code>,
where <code class="reqn">\hat\Sigma</code> is a diagonal matrix with diagonal elements <code class="reqn">\hat\sigma_i</code>,
for <code class="reqn">i=1,...,n</code>.
</p>
</li>
<li><p> Finally, if <code>vc = "OGMM"</code>, the model is estimated in two steps.
In the first step, the model is estimated by 2SLS yielding
the residuals <code class="reqn">\hat \varepsilon</code>.
With the residuals, the diagonal matrix <code class="reqn">\hat \Sigma</code> is estimated and is
used to construct the matrix <code class="reqn">\hat S = H^\prime \hat \Sigma H</code>.
Then <code class="reqn">\eta_{OWGMM}=(Z^\prime H\hat S^{-1}H^\prime Z)^{-1}Z^\prime H\hat S^{-1}H^\prime y</code>, where <code class="reqn">\eta_{OWGMM}</code>
is the vector of all the parameters in the model,
The variance-covariance matrix is: <code class="reqn">n(Z^\prime H\hat S^{-1}H^\prime Z)^{-1}</code>.</p>
</li></ul>



<h3>Value</h3>

<p>An object of class <code>ivregimes</code>. A <code>list</code> of five elements. The first element of the list contains the estimation results. The other elements are needed for printing the results.
</p>


<h3>Author(s)</h3>

<p>Gianfranco Piras and Mauricio Sarrias
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("natreg")
form   &lt;- HR90  ~ 0 | MA90 + PS90 + RD90 + UE90 | 0 | MA90 + PS90 + RD90 + FH90 + FP89 + GI89
split  &lt;- ~ REGIONS
mod &lt;- ivregimes(formula = form, data = natreg, rgv = split, vc = "robust")
summary(mod)
mod1 &lt;- ivregimes(formula = form, data = natreg, rgv = split, vc = "OGMM")
summary(mod1)
form1   &lt;- HR90  ~ MA90 + PS90 |  RD90 + UE90 -1 | MA90 + PS90 | RD90 + FH90 + FP89 + GI89 -1
mod2 &lt;- ivregimes(formula = form1, data = natreg, rgv = split, vc = "homoskedastic")
summary(mod2)

</code></pre>

<hr>
<h2 id='natreg'>US Counties Homicides data</h2><span id='topic+natreg'></span>

<h3>Description</h3>

<p>Continental U.S. counties data for homicides and selected socio-economic characteristics. Data for four decennial census years: 1960, 1970, 1980 and 1990.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>natreg
</code></pre>


<h3>Format</h3>

<p>A data frame with 3085 rows and 73 variables
</p>

<dl>
<dt>REGIONS</dt><dd><p>Regions of the US</p>
</dd>
<dt>NOSOUTH</dt><dd><p>Counties not in the south</p>
</dd>
<dt>POLY_ID</dt><dd><p>Poligon id</p>
</dd>
<dt>NAME</dt><dd><p>Counties names</p>
</dd>
<dt>STATE_NAME</dt><dd><p>State name</p>
</dd>
<dt>STATE_FIPS</dt><dd><p>FIPS code for the state</p>
</dd>
<dt>CNTY_FIPS</dt><dd><p>FIPS code for the county</p>
</dd>
<dt>FIPS</dt><dd><p>state and  county FIPS code</p>
</dd>
<dt>STFIPS</dt><dd><p>FIPS code for the state</p>
</dd>
<dt>COFIPS</dt><dd><p>FIPS code for the county</p>
</dd>
<dt>FIPSNO</dt><dd><p>state + county FIPS code</p>
</dd>
<dt>SOUTH</dt><dd><p>dummy indicator: 1 if the county is in the southern US</p>
</dd>
<dt>HR60</dt><dd><p>homicide rate per 100,000 in 1960</p>
</dd>
<dt>HR70</dt><dd><p>homicide rate per 100,000 in 1970</p>
</dd>
<dt>HR80</dt><dd><p>homicide rate per 100,000 in 1980</p>
</dd>
<dt>HR90</dt><dd><p>homicide rate per 100,000 in 1990</p>
</dd>
<dt>HC60</dt><dd><p>homicide count, three year average centered on 1960</p>
</dd>
<dt>HC70</dt><dd><p>homicide count, three year average centered on 1970</p>
</dd>
<dt>HC80</dt><dd><p>homicide count, three year average centered on 1980</p>
</dd>
<dt>HC90</dt><dd><p>homicide count, three year average centered on 1990</p>
</dd>
<dt>PO60</dt><dd><p>county population in 1960</p>
</dd>
<dt>PO70</dt><dd><p>county population in 1970</p>
</dd>
<dt>PO80</dt><dd><p>county population in 1980</p>
</dd>
<dt>PO90</dt><dd><p>county population in 1990</p>
</dd>
<dt>RD60</dt><dd><p>resource deprivation in 1960</p>
</dd>
<dt>RD70</dt><dd><p>resource deprivation in 1970</p>
</dd>
<dt>RD80</dt><dd><p>resource deprivation in 1980</p>
</dd>
<dt>RD90</dt><dd><p>resource deprivation in 1990</p>
</dd>
<dt>PS60</dt><dd><p>population structure in 1960</p>
</dd>
<dt>PS70</dt><dd><p>population structure in 1970</p>
</dd>
<dt>PS80</dt><dd><p>population structure in 1980</p>
</dd>
<dt>PS90</dt><dd><p>population structure in 1990</p>
</dd>
<dt>UE60</dt><dd><p>unemployment rate in 1960</p>
</dd>
<dt>UE70</dt><dd><p>unemployment rate in 1970</p>
</dd>
<dt>UE80</dt><dd><p>unemployment rate in 1980</p>
</dd>
<dt>UE90</dt><dd><p>unemployment rate in 1990</p>
</dd>
<dt>DV60</dt><dd><p>divorce rate in 1960: pct. males over 14 divorced</p>
</dd>
<dt>DV70</dt><dd><p>divorce rate in 1970: pct. males over 14 divorced</p>
</dd>
<dt>DV80</dt><dd><p>divorce rate in 1980: pct. males over 14 divorced</p>
</dd>
<dt>DV90</dt><dd><p>divorce rate in 1990: pct. males over 14 divorced</p>
</dd>
<dt>MA60</dt><dd><p>median age in 1960</p>
</dd>
<dt>MA70</dt><dd><p>median age in 1970</p>
</dd>
<dt>MA80</dt><dd><p>median age in 1980</p>
</dd>
<dt>MA90</dt><dd><p>median age in 1990</p>
</dd>
<dt>POL60</dt><dd><p>log of population in 1960</p>
</dd>
<dt>POL70</dt><dd><p>log of population in 1970</p>
</dd>
<dt>POL80</dt><dd><p>log of population in 1980</p>
</dd>
<dt>POL90</dt><dd><p>log of population in 1990</p>
</dd>
<dt>DNL60</dt><dd><p>log of population density in 1960</p>
</dd>
<dt>DNL70</dt><dd><p>log of population density in 1970</p>
</dd>
<dt>DNL80</dt><dd><p>log of population density in 1980</p>
</dd>
<dt>DNL90</dt><dd><p>log of population density in 1990</p>
</dd>
<dt>MFIL59</dt><dd><p>log of median family income in 1959</p>
</dd>
<dt>MFIL69</dt><dd><p>log of median family income in 1969</p>
</dd>
<dt>MFIL79</dt><dd><p>log of median family income in 1979</p>
</dd>
<dt>MFIL89</dt><dd><p>log of median family income in 1989</p>
</dd>
<dt>FP59</dt><dd><p>pct. families below poverty in 1959</p>
</dd>
<dt>FP69</dt><dd><p>pct. families below poverty in 1969</p>
</dd>
<dt>FP79</dt><dd><p>pct. families below poverty in 1979</p>
</dd>
<dt>FP89</dt><dd><p>pct. families below poverty in 1989</p>
</dd>
<dt>BLK60</dt><dd><p>pct. black in 1960</p>
</dd>
<dt>BLK70</dt><dd><p>pct. black in 1970</p>
</dd>
<dt>BLK80</dt><dd><p>pct. black in 1980</p>
</dd>
<dt>BLK90</dt><dd><p>pct. black in 1990</p>
</dd>
<dt>GI59</dt><dd><p>Gini index of family income inequality in 1959</p>
</dd>
<dt>GI69</dt><dd><p>Gini index of family income inequality in 1969</p>
</dd>
<dt>GI79</dt><dd><p>Gini index of family income inequality in 1979</p>
</dd>
<dt>GI89</dt><dd><p>Gini index of family income inequality in 1989</p>
</dd>
<dt>FH60</dt><dd><p>pct. female headed households in 1960</p>
</dd>
<dt>FH70</dt><dd><p>pct. female headed households in 1970</p>
</dd>
<dt>FH80</dt><dd><p>pct. female headed households in 1980</p>
</dd>
<dt>FH90</dt><dd><p>pct. female headed households in 1990</p>
</dd>
<dt>West</dt><dd><p>West regional dummy</p>
</dd>
</dl>



<h3>Source</h3>

<p><a href="https://geodacenter.github.io/data-and-lab/">https://geodacenter.github.io/data-and-lab/</a>
</p>

<hr>
<h2 id='regimes'>Estimation of regimes models</h2><span id='topic+regimes'></span>

<h3>Description</h3>

<p>The function <code>regimes</code> deals with
the estimation of regime models.
Most of the times the variable identifying the regimes
reveals some spatial aspects of the data (e.g., administrative boundaries).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>regimes(formula, data, rgv = NULL, vc = c("homoskedastic", "groupwise"))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="regimes_+3A_formula">formula</code></td>
<td>
<p>a symbolic description of the model of the form <code>y ~ x_f | x_v</code> where <code>y</code> is the dependent variable, <code>x_f</code> are the regressors that do not vary by regimes and  <code>x_v</code> are the regressors that vary by regimes</p>
</td></tr>
<tr><td><code id="regimes_+3A_data">data</code></td>
<td>
<p>the data of class <code>data.frame</code>.</p>
</td></tr>
<tr><td><code id="regimes_+3A_rgv">rgv</code></td>
<td>
<p>an object of class <code>formula</code> to identify the regime variables</p>
</td></tr>
<tr><td><code id="regimes_+3A_vc">vc</code></td>
<td>
<p>one of <code>c("homoskedastic", "groupwise")</code>. If <code>groupwise</code>, the model VC matrix is estimated by weighted least square.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For convenience and without loss of generality,
we assume the presence of only two regimes.
In this case,
the basic (non-spatial) is:
</p>
<p style="text-align: center;"><code class="reqn">
y
=
\begin{bmatrix}
X_1&amp; 0 \\
0 &amp; X_2 \\
\end{bmatrix}
\begin{bmatrix}
\beta_1 \\
\beta_2 \\
\end{bmatrix}
+ X\beta +
\varepsilon
</code>
</p>

<p>where  <code class="reqn">y = [y_1^\prime,y_2^\prime]^\prime</code>,
and the <code class="reqn">n_1 \times 1</code> vector <code class="reqn">y_1</code> contains the observations
on the dependent variable for the first regime,
and the <code class="reqn">n_2 \times 1</code> vector <code class="reqn">y_2</code> (with <code class="reqn">n_1 + n_2 = n</code>)
contains the observations on the dependent variable for the second regime.
The <code class="reqn">n_1 \times k</code> matrix <code class="reqn">X_1</code> and the <code class="reqn">n_2 \times k</code>
matrix <code class="reqn">X_2</code> are blocks of a block diagonal matrix,
the vectors of parameters  <code class="reqn">\beta_1</code> and <code class="reqn">\beta_2</code> have
dimension <code class="reqn">k_1 \times 1</code> and <code class="reqn">k_2 \times 1</code>, respectively,
<code class="reqn">X</code> is the <code class="reqn">n \times p</code> matrix of regressors that do not vary by regime,
<code class="reqn">\beta</code>  is a <code class="reqn">p\times 1</code> vector of parameters
and <code class="reqn">\varepsilon = [\varepsilon_1^\prime,\varepsilon_2^\prime]^\prime</code>
is the <code class="reqn">n\times 1</code> vector of innovations.
</p>

<ul>
<li><p> If <code>vc = "homoskedastic"</code>, the model is estimated by OLS.
</p>
</li>
<li><p> If <code>vc = "groupwise"</code>, the model is estimated in two steps.
In the first step, the model is estimated by OLS. In the second step, the
inverse of the (groupwise) residuals from the first step are employed
as weights in a  weighted least square procedure.</p>
</li></ul>



<h3>Value</h3>

<p>An object of class <code>lm</code> and <code>spregimes</code>.
</p>


<h3>Author(s)</h3>

<p>Gianfranco Piras and Mauricio Sarrias
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("baltim")
form   &lt;- PRICE  ~ NROOM + NBATH + PATIO + FIREPL + AC + GAR + AGE + LOTSZ + SQFT
split  &lt;- ~ CITCOU
mod &lt;- regimes(formula = form, data = baltim, rgv = split, vc = "groupwise")
summary(mod)
form &lt;- PRICE  ~ AC + AGE + NROOM + PATIO + FIREPL + SQFT | NBATH + GAR + LOTSZ - 1
mod &lt;- regimes(form, baltim, split, vc = "homoskedastic")
summary(mod)


</code></pre>

<hr>
<h2 id='spregimes'>Estimation of spatial regimes models</h2><span id='topic+spregimes'></span><span id='topic+coef.spregimes'></span><span id='topic+vcov.spregimes'></span><span id='topic+print.spregimes'></span><span id='topic+summary.spregimes'></span><span id='topic+print.summary.spregimes'></span><span id='topic+residuals.spregimes'></span><span id='topic+fitted.spregimes'></span>

<h3>Description</h3>

<p>The function <code>spregimes</code> deals
with the estimation of spatial regimes models.
This is a general function that allows the estimation
of various spatial specifications, including the spatial lag regimes model,
the spatial error regimes model, and the spatial SARAR regimes model.
Since the estimation is based on generalized method of moments (GMM),
endogenous variables can be included.
For further information on estimation, see details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spregimes(
  formula,
  data = list(),
  model = c("sarar", "lag", "error", "ols"),
  listw,
  wy_rg = FALSE,
  weps_rg = FALSE,
  initial.value = NULL,
  rgv = NULL,
  het = FALSE,
  verbose = FALSE,
  control = list()
)

## S3 method for class 'spregimes'
coef(object, ...)

## S3 method for class 'spregimes'
vcov(object, ...)

## S3 method for class 'spregimes'
print(x, digits = max(3, getOption("digits") - 3), ...)

## S3 method for class 'spregimes'
summary(object, ...)

## S3 method for class 'summary.spregimes'
print(x, digits = max(5, getOption("digits") - 3), ...)

## S3 method for class 'spregimes'
residuals(object, ...)

## S3 method for class 'spregimes'
fitted(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="spregimes_+3A_formula">formula</code></td>
<td>
<p>a symbolic description of the model of
the form <code>y ~ x_f | x_v | wx | h_f | h_v | wh</code>
where <code>y</code> is the dependent variable,
<code>x_f</code> are the regressors that do not vary by regimes,
<code>x_v</code> are the regressors that vary by regimes,
<code>wx</code> are the spatially lagged regressors,
<code>h_f</code> are the instruments that do not vary by regimes,
<code>h_v</code> are the instruments that vary by regimes,
<code>wh</code> are the spatially lagged instruments.</p>
</td></tr>
<tr><td><code id="spregimes_+3A_data">data</code></td>
<td>
<p>the data of class <code>data.frame</code>.</p>
</td></tr>
<tr><td><code id="spregimes_+3A_model">model</code></td>
<td>
<p>should be one of <code>c("sarar", "lag", "error", "ols")</code></p>
</td></tr>
<tr><td><code id="spregimes_+3A_listw">listw</code></td>
<td>
<p>a spatial weighting matrix of class <code>listw</code>, <code>matrix</code> or <code>Matrix</code></p>
</td></tr>
<tr><td><code id="spregimes_+3A_wy_rg">wy_rg</code></td>
<td>
<p>default <code>wy_rg = FALSE</code>, the lagged dependent variable does not vary by regime (see details)</p>
</td></tr>
<tr><td><code id="spregimes_+3A_weps_rg">weps_rg</code></td>
<td>
<p>default <code>weps_rg = FALSE</code>, if <code>TRUE</code> the spatial error term varies by regimes (see details)</p>
</td></tr>
<tr><td><code id="spregimes_+3A_initial.value">initial.value</code></td>
<td>
<p>initial value for the spatial error parameter</p>
</td></tr>
<tr><td><code id="spregimes_+3A_rgv">rgv</code></td>
<td>
<p>an object of class <code>formula</code> to identify the regime variables</p>
</td></tr>
<tr><td><code id="spregimes_+3A_het">het</code></td>
<td>
<p>heteroskedastic variance-covariance matrix</p>
</td></tr>
<tr><td><code id="spregimes_+3A_verbose">verbose</code></td>
<td>
<p>print a trace of the optimization</p>
</td></tr>
<tr><td><code id="spregimes_+3A_control">control</code></td>
<td>
<p>select arguments for the optimization</p>
</td></tr>
<tr><td><code id="spregimes_+3A_object">object</code></td>
<td>
<p>an object of class spregimes</p>
</td></tr>
<tr><td><code id="spregimes_+3A_...">...</code></td>
<td>
<p>additional arguments</p>
</td></tr>
<tr><td><code id="spregimes_+3A_x">x</code></td>
<td>
<p>an object of class spregimes</p>
</td></tr>
<tr><td><code id="spregimes_+3A_digits">digits</code></td>
<td>
<p>number of digits</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function <code>spregimes</code> is a wrapper that allows the
estimation of a general
spatial regimes model.
For convenience and without loss of generality,
we assume the presence of only two regimes.
In this case the general model can be written as:
</p>
<p style="text-align: center;"><code class="reqn">
\begin{aligned}
y = &amp;	W\begin{bmatrix}
y_1&amp; 0 \\
0 &amp; y_2 \\
\end{bmatrix}
\begin{bmatrix}
\lambda_1 \\
\lambda_2 \\
\end{bmatrix}
+
 \begin{bmatrix}
X_1&amp; 0 \\
0 &amp; X_2 \\
\end{bmatrix}
\begin{bmatrix}
\beta_1 \\
\beta_2 \\
\end{bmatrix}
+ X\beta +
\begin{bmatrix}
Y_1&amp; 0 \\
0 &amp; Y_2 \\
\end{bmatrix}
\begin{bmatrix}
\pi_1 \\
\pi_2 \\
\end{bmatrix}
+ Y\pi +  \\
&amp;
W\begin{bmatrix}
X_1&amp; 0 \\
0 &amp; X_2 \\
\end{bmatrix}
\begin{bmatrix}
\delta_1 \\
\delta_2 \\
\end{bmatrix}+ WX\delta+
 W
\begin{bmatrix}
Y_1&amp; 0 \\
0 &amp; Y_2 \\
\end{bmatrix}
\begin{bmatrix}
\theta_1 \\
\theta_2 \\
\end{bmatrix}
+ WY\theta
+
\begin{bmatrix}
\varepsilon_1 \\
\varepsilon_2 \\
\end{bmatrix}
\end{aligned}
</code>
</p>

<p>where
</p>
<p style="text-align: center;"><code class="reqn">
\begin{bmatrix}
\varepsilon_1 \\
\varepsilon_2 \\
\end{bmatrix}
=W	\begin{bmatrix}
\varepsilon_1&amp;0 \\
0&amp;\varepsilon_2 \\
\end{bmatrix}
\begin{bmatrix}
\rho_1 \\
\rho_2 \\
\end{bmatrix}
+u \nonumber
</code>
</p>

<p>The model includes the spatial lag of the dependent variable,
the spatial lag of the regressors,
the spatial lag of the errors
and, possibly, additional endogenous variables.
The function
<code>spregimes</code> estimates all of the nested
specifications deriving from this model.
There are, however, some restrictions.
For example, if <code>weps_rg</code> is set to TRUE,
all the regressors in the model should also vary by regimes.
The estimation of the different models relies heavily
on code available from the package <span class="pkg">sphet</span>.
</p>

<ol>
<li><p> For the spatial lag (or Durbin) regimes model (i.e, when <code class="reqn">\rho_1</code>
and <code class="reqn">\rho_2</code> are zero), an instrumental variable
procedure is adopted, where the matrix of instruments
is formed by the spatial lags of the exogenous variables
and the additional instruments included in the <code>formula</code>.
A robust estimation
of the variance-covariance matrix can be obtained
by setting <code>het = TRUE</code>.
</p>
</li>
<li><p> For the spatial error regime models (i.e, when <code class="reqn">\lambda_1</code>
and <code class="reqn">\lambda_2</code> are zero), the spatial
coefficient(s)
are estimated with the GMM procedure described
in Kelejian and Prucha (2010) and Drukker et al., (2013).
The difference between Kelejian and Prucha (2010) and Drukker et al., (2013),
is that the former assume heteroskedastic innovations (<code>het = TRUE</code>),
while the latter does not (<code>het = FALSE</code>).
</p>
</li>
<li><p> For the SARAR regimes model, the estimation procedure
alternates a series of IV and GMM steps. The variance-covariance
can be estimated assuming that the innovations are homoskedastic (<code>het = FALSE</code>)
as well as heteroskedastic (<code>het = TRUE</code>).
</p>
</li></ol>



<h3>Value</h3>

<p>An object of class &ldquo;<code>spregimes</code>&rdquo;
</p>


<h3>Author(s)</h3>

<p>Gianfranco Piras and Mauricio Sarrias
</p>


<h3>References</h3>

<p>Arraiz, I. and Drukker, M.D. and Kelejian, H.H. and Prucha, I.R. (2010)
A spatial Cliff-Ord-type Model with Heteroskedastic Innovations: Small and Large Sample Results,
<em>Journal of Regional Sciences</em>, <b>50</b>, pages 592&ndash;614.
</p>
<p>Drukker, D.M. and Egger, P. and Prucha, I.R. (2013)
On Two-step Estimation of a Spatial Auto regressive Model with Autoregressive
Disturbances and Endogenous Regressors,
<em>Econometric Review</em>, <b>32</b>, pages 686&ndash;733.
</p>
<p>Kelejian, H.H. and Prucha, I.R. (2010)
Specification and Estimation of Spatial Autoregressive Models with Autoregressive and Heteroskedastic Disturbances,
<em>Journal of Econometrics</em>, <b>157</b>, pages 53&ndash;67.
</p>
<p>Gianfranco Piras (2010). sphet: Spatial Models with Heteroskedastic Innovations in R. <em>Journal of Statistical Software</em>, 35(1), 1-21. <a href="https://doi.org/10.18637/jss.v035.i01">doi:10.18637/jss.v035.i01</a>.
</p>
<p>Roger Bivand, Gianfranco Piras (2015). Comparing Implementations of Estimation Methods for Spatial Econometrics. <em>Journal of Statistical Software</em>, 63(18), 1-36. <a href="https://doi.org/10.18637/jss.v063.i18">doi:10.18637/jss.v063.i18</a>.
</p>
<p>Gianfranco Piras, Paolo Postiglione (2022).  A deeper look at impacts in spatial Durbin model with sphet. <em>Geographical Analysis</em>, 54(3), 664-684. <a href="https://onlinelibrary.wiley.com/doi/10.1111/gean.12318">https://onlinelibrary.wiley.com/doi/10.1111/gean.12318</a>
</p>
<p>Luc Anselin, Sergio J. Rey (2014). <em>Modern Spatial Econometrics in Practice: A Guide to GeoDa, GeoDaSpace and PySal.</em> GeoDa Press LLC.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("natreg")
data("ws_6")

form &lt;-  HR90  ~ 0 | MA90 + PS90 +
RD90 + UE90 | 0 | 0 | MA90 + PS90 +
RD90 + FH90 + FP89 + GI89 | 0

form1 &lt;-  HR90  ~ MA90 -1 |  PS90 +
RD90 + UE90 | 0 | MA90 -1 |  PS90 +
RD90 + FH90 + FP89 + GI89 | 0

form2 &lt;-  HR90  ~ MA90 -1 |  PS90 +
RD90 + UE90 | MA90 | MA90 -1 |  PS90 +
RD90 + FH90 + FP89 + GI89 | 0

form3 &lt;-  HR90  ~ MA90 -1 |  PS90 +
RD90 + UE90 | MA90 | MA90 -1 |  PS90 +
RD90 + FH90 + FP89 + GI89 | GI89

form4 &lt;-  HR90  ~ MA90 -1 |  PS90 +
RD90 + UE90 | MA90 + RD90 | MA90 -1 |  PS90 +
RD90 + FH90 + FP89 + GI89 | GI89


split  &lt;- ~ REGIONS

###################################################
# Linear model with regimes and lagged regressors #
###################################################
mod &lt;- spregimes(formula = form2, data = natreg,
rgv = split, listw = ws_6, model = "ols")
summary(mod)

mod1 &lt;- spregimes(formula = form3, data = natreg,
rgv = split, listw = ws_6, model = "ols")
summary(mod1)

mod2 &lt;- spregimes(formula = form4, data = natreg,
rgv = split, listw = ws_6, model = "ols")
summary(mod2)


###############################
# Spatial Error regimes model #
###############################
mod &lt;- spregimes(formula = form, data = natreg,
rgv = split, listw = ws_6, model = "error", het = TRUE)
summary(mod)
mod1 &lt;- spregimes(formula = form, data = natreg,
rgv = split, listw = ws_6, model = "error",
weps_rg = TRUE, het = TRUE)
summary(mod1)
mod2 &lt;- spregimes(formula = form1, data = natreg,
rgv = split, listw = ws_6, model = "error", het = TRUE)
summary(mod2)

###############################
#  Spatial Lag regimes model  #
###############################
mod4 &lt;- spregimes(formula = form, data = natreg,
rgv = split, listw = ws_6, model = "lag",
het = TRUE, wy_rg = TRUE)
summary(mod4)
mod5 &lt;- spregimes(formula = form1, data = natreg,
rgv = split, listw = ws_6, model = "lag",
het = TRUE, wy_rg = TRUE)
summary(mod5)

###############################
# Spatial SARAR regimes model #
###############################
mod6 &lt;- spregimes(formula = form, data = natreg,
rgv = split, listw = ws_6, model = "sarar",
het = TRUE, wy_rg = TRUE, weps_rg = TRUE)
summary(mod6)
mod7 &lt;- spregimes(formula = form, data = natreg,
rgv = split, listw = ws_6, model = "sarar",
het = TRUE, wy_rg = FALSE, weps_rg = FALSE)
summary(mod7)
mod8 &lt;- spregimes(formula = form1, data = natreg,
rgv = split, listw = ws_6, model = "sarar",
het = TRUE, wy_rg = TRUE, weps_rg = FALSE)
summary(mod8)
</code></pre>

<hr>
<h2 id='ws_6'>Spatial weighting matrix for the US Counties Homicides data</h2><span id='topic+ws_6'></span>

<h3>Description</h3>

<p>ws_6 is a spatial weights matrix based on the 6 nearest neighbors for the Continental U.S. counties data for homicides
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ws_6
</code></pre>


<h3>Format</h3>

<p>A spatial weighting matrix of class <code>Matrix</code>
</p>


<h3>Source</h3>

<p><a href="https://geodacenter.github.io/data-and-lab/">https://geodacenter.github.io/data-and-lab/</a>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
