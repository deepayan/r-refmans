<!DOCTYPE html><html><head><title>Help for package vdiffr</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {vdiffr}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#expect_doppelganger'><p>Does a figure look like its expected output?</p></a></li>
<li><a href='#vdiffr-package'><p>vdiffr: Visual Regression Testing and Graphical Diffing</p></a></li>
<li><a href='#write_svg'><p>Default SVG writer</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Visual Regression Testing and Graphical Diffing</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.7</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Description:</td>
<td>An extension to the 'testthat' package that makes it easy
    to add graphical unit tests. It provides a Shiny application to
    manage the test cases.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>ByteCompile:</td>
<td>true</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.2.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>diffobj, glue, grDevices, htmltools, lifecycle, rlang,
testthat (&ge; 3.0.3), xml2 (&ge; 1.0.0)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>covr, ggplot2 (&ge; 3.2.0), roxygen2, withr</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>cpp11</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.2</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://vdiffr.r-lib.org/">https://vdiffr.r-lib.org/</a>, <a href="https://github.com/r-lib/vdiffr">https://github.com/r-lib/vdiffr</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/r-lib/vdiffr/issues">https://github.com/r-lib/vdiffr/issues</a></td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>C++11, libpng</td>
</tr>
<tr>
<td>Config/Needs/website:</td>
<td>tidyverse/tidytemplate</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-09-21 14:48:37 UTC; lionel</td>
</tr>
<tr>
<td>Author:</td>
<td>Lionel Henry [cre, aut],
  Thomas Lin Pedersen
    <a href="https://orcid.org/0000-0002-5147-4711"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Posit Software, PBC [cph, fnd],
  T Jake Luciani [aut] (svglite),
  Matthieu Decorde [aut] (svglite),
  Vaudor Lise [aut] (svglite),
  Tony Plate [ctb] (svglite: Early line dashing code),
  David Gohel [ctb] (svglite: Line dashing code and raster code),
  Yixuan Qiu [ctb] (svglite: Improved styles; polypath implementation),
  Håkon Malmedal [ctb] (svglite: Opacity code)</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Lionel Henry &lt;lionel@posit.co&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-09-22 07:20:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='expect_doppelganger'>Does a figure look like its expected output?</h2><span id='topic+expect_doppelganger'></span>

<h3>Description</h3>

<p><code>expect_doppelganger()</code> is a testthat expectation for graphical
plots. It generates SVG snapshots that you can review graphically
with <code><a href="testthat.html#topic+snapshot_accept">testthat::snapshot_review()</a></code>. You will find more information
about snapshotting in the <a href="https://testthat.r-lib.org/articles/snapshotting.html">testthat snapshots vignette</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expect_doppelganger(
  title,
  fig,
  path = deprecated(),
  ...,
  writer = write_svg,
  cran = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="expect_doppelganger_+3A_title">title</code></td>
<td>
<p>A brief description of what is being tested in the
figure. For instance: &quot;Points and lines overlap&quot;.
</p>
<p>If a ggplot2 figure doesn't have a title already, <code>title</code> is
applied to the figure with <code>ggtitle()</code>.
</p>
<p>The title is also used as file name for storing SVG (in a
sanitzed form, with special characters converted to <code>"-"</code>).</p>
</td></tr>
<tr><td><code id="expect_doppelganger_+3A_fig">fig</code></td>
<td>
<p>A figure to test. This can be a ggplot object, a
recordedplot, or more generally any object with a <code>print</code> method.
</p>
<p>If you need to test a plot with non-printable objects (e.g. base
plots), <code>fig</code> can be a function that generates and prints the
plot, e.g. <code>fig = function() plot(1:3)</code>.</p>
</td></tr>
<tr><td><code id="expect_doppelganger_+3A_path">path</code>, <code id="expect_doppelganger_+3A_...">...</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>.</p>
</td></tr>
<tr><td><code id="expect_doppelganger_+3A_writer">writer</code></td>
<td>
<p>A function that takes the plot, a target SVG file,
and an optional plot title. It should transform the plot to SVG
in a deterministic way and write it to the target file. See
<code><a href="#topic+write_svg">write_svg()</a></code> (the default) for an example.</p>
</td></tr>
<tr><td><code id="expect_doppelganger_+3A_cran">cran</code></td>
<td>
<p>If <code>FALSE</code> (the default), mismatched snapshots only
cause a failure when you run tests locally or in your CI (Github
Actions or any platform that sets the <code>CI</code> environment variable).
If <code>TRUE</code>, failures may also occur on CRAN machines.
</p>
<p>Failures are disabled on CRAN by default because testing the
appearance of a figure is inherently fragile. Changes in the R
graphics engine or in ggplot2 may cause subtle differences in the
aspect of a plot, such as a slightly smaller or larger margin.
These changes will cause spurious failures because you need to
update your snapshots to reflect the upstream changes.
</p>
<p>It would be distracting for both you and the CRAN maintainers if
such changes systematically caused failures on CRAN. This is why
snapshot expectations do not fail on CRAN by default and should
be treated as a monitoring tool that allows you to quickly check
how the appearance of your figures changes over time, and to
manually assess whether changes reflect actual problems in your
package.
</p>
<p>Internally, this argument is passed to
<code><a href="testthat.html#topic+expect_snapshot_file">testthat::expect_snapshot_file()</a></code>.</p>
</td></tr>
</table>


<h3>Debugging</h3>

<p>It is sometimes difficult to understand the cause of a failure.
This usually indicates that the plot is not created
deterministically. Potential culprits are:
</p>

<ul>
<li><p> Some of the plot components depend on random variation. Try
setting a seed.
</p>
</li>
<li><p> The plot depends on some system library. For instance sf plots
depend on libraries like GEOS and GDAL. It might not be possible
to test these plots with vdiffr.
</p>
</li></ul>

<p>To help you understand the causes of a failure, vdiffr
automatically logs the SVG diff of all failures when run under R
CMD check. The log is located in <code>tests/vdiffr.Rout.fail</code> and
should be displayed on Travis.
</p>
<p>You can also set the <code>VDIFFR_LOG_PATH</code> environment variable with
<code>Sys.setenv()</code> to unconditionally (also interactively) log failures
in the file pointed by the variable.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if (FALSE) {  # Not run

library("ggplot2")

test_that("plots have known output", {
  disp_hist_base &lt;- function() hist(mtcars$disp)
  expect_doppelganger("disp-histogram-base", disp_hist_base)

  disp_hist_ggplot &lt;- ggplot(mtcars, aes(disp)) + geom_histogram()
  expect_doppelganger("disp-histogram-ggplot", disp_hist_ggplot)
})

}
</code></pre>

<hr>
<h2 id='vdiffr-package'>vdiffr: Visual Regression Testing and Graphical Diffing</h2><span id='topic+vdiffr'></span><span id='topic+vdiffr-package'></span>

<h3>Description</h3>

<p>An extension to the 'testthat' package that makes it easy to add graphical unit tests. It provides a Shiny application to manage the test cases.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Lionel Henry <a href="mailto:lionel@rstudio.com">lionel@rstudio.com</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> Thomas Lin Pedersen <a href="mailto:thomas.pedersen@rstudio.com">thomas.pedersen@rstudio.com</a> (<a href="https://orcid.org/0000-0002-5147-4711">ORCID</a>)
</p>
</li>
<li><p> T Jake Luciani <a href="mailto:jake@apache.org">jake@apache.org</a> (svglite)
</p>
</li>
<li><p> Matthieu Decorde <a href="mailto:matthieu.decorde@ens-lyon.fr">matthieu.decorde@ens-lyon.fr</a> (svglite)
</p>
</li>
<li><p> Vaudor Lise <a href="mailto:lise.vaudor@ens-lyon.fr">lise.vaudor@ens-lyon.fr</a> (svglite)
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> RStudio [copyright holder, funder]
</p>
</li>
<li><p> Tony Plate (svglite: Early line dashing code) [contributor]
</p>
</li>
<li><p> David Gohel (svglite: Line dashing code and raster code) [contributor]
</p>
</li>
<li><p> Yixuan Qiu (svglite: Improved styles; polypath implementation) [contributor]
</p>
</li>
<li><p> Håkon Malmedal (svglite: Opacity code) [contributor]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://vdiffr.r-lib.org/">https://vdiffr.r-lib.org/</a>
</p>
</li>
<li> <p><a href="https://github.com/r-lib/vdiffr">https://github.com/r-lib/vdiffr</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/r-lib/vdiffr/issues">https://github.com/r-lib/vdiffr/issues</a>
</p>
</li></ul>


<hr>
<h2 id='write_svg'>Default SVG writer</h2><span id='topic+write_svg'></span>

<h3>Description</h3>

<p>This is the default SVG writer for vdiffr test cases. It uses
embedded versions of <a href="https://svglite.r-lib.org">svglite</a>,
<a href="https://harfbuzz.github.io/">harfbuzz</a>, and the Liberation and
Symbola fonts in order to create deterministic SVGs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_svg(plot, file, title = "")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="write_svg_+3A_plot">plot</code></td>
<td>
<p>A plot object to convert to SVG. Can be a ggplot2 object,
a <a href="grDevices.html#topic+recordplot">recorded plot</a>, or any object with a
<a href="base.html#topic+print">print()</a> method.</p>
</td></tr>
<tr><td><code id="write_svg_+3A_file">file</code></td>
<td>
<p>The file to write the SVG to.</p>
</td></tr>
<tr><td><code id="write_svg_+3A_title">title</code></td>
<td>
<p>An optional title for the test case.</p>
</td></tr>
</table>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
