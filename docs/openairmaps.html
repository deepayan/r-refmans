<!DOCTYPE html><html><head><title>Help for package openairmaps</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {openairmaps}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#openairmaps-package'><p>openairmaps: Create Maps of Air Pollution Data</p></a></li>
<li><a href='#+25+26gt+3B+25'><p>Pipe operator</p></a></li>
<li><a href='#addPolarMarkers'><p>Add polar markers to leaflet map</p></a></li>
<li><a href='#addTrajPaths'><p>Add trajectory paths to leaflet map</p></a></li>
<li><a href='#annulusMap'><p>Polar annulus plots on interactive leaflet maps</p></a></li>
<li><a href='#annulusMapStatic'><p>Bivariate polar plots on a static ggmap</p></a></li>
<li><a href='#buildPopup'><p>Build a Complex Popup for a Leaflet Map</p></a></li>
<li><a href='#convertPostcode'><p>Convert a UK postcode to a latitude/longitude pair</p></a></li>
<li><a href='#diffMap'><p>Bivariate polar plots on interactive leaflet maps</p></a></li>
<li><a href='#diffMapStatic'><p>Bivariate polar plots on a static ggmap</p></a></li>
<li><a href='#freqMap'><p>Polar frequency plots on interactive leaflet maps</p></a></li>
<li><a href='#freqMapStatic'><p>Polar frequency plots on a static ggmap</p></a></li>
<li><a href='#networkMap'><p>Create a leaflet map of air quality measurement network sites</p></a></li>
<li><a href='#percentileMap'><p>Percentile roses on interactive leaflet maps</p></a></li>
<li><a href='#percentileMapStatic'><p>Percentile roses on a static ggmap</p></a></li>
<li><a href='#polar_data'><p>Example data for polar mapping functions</p></a></li>
<li><a href='#polarMap'><p>Bivariate polar plots on interactive leaflet maps</p></a></li>
<li><a href='#polarMapStatic'><p>Bivariate polar plots on a static ggmap</p></a></li>
<li><a href='#pollroseMap'><p>Pollution rose plots on interactive leaflet maps</p></a></li>
<li><a href='#pollroseMapStatic'><p>Percentile roses on a static ggmap</p></a></li>
<li><a href='#quickTextHTML'><p>Automatic text formatting for openairmaps</p></a></li>
<li><a href='#searchNetwork'><p>Geographically search the air quality networks made available by</p>
<code>openair::importMeta()</code></a></li>
<li><a href='#traj_data'><p>Example data for trajectory mapping functions</p></a></li>
<li><a href='#trajLevelMap'><p>Trajectory level plots in <code>leaflet</code></p></a></li>
<li><a href='#trajLevelMapStatic'><p>Trajectory level plots in <code>ggplot2</code></p></a></li>
<li><a href='#trajMap'><p>Trajectory line plots in <code>leaflet</code></p></a></li>
<li><a href='#trajMapStatic'><p>Trajectory line plots in <code>ggplot2</code></p></a></li>
<li><a href='#windroseMap'><p>Wind rose plots on interactive leaflet maps</p></a></li>
<li><a href='#windroseMapStatic'><p>Wind rose plots on a static ggmap</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Create Maps of Air Pollution Data</td>
</tr>
<tr>
<td>Version:</td>
<td>0.8.1</td>
</tr>
<tr>
<td>Description:</td>
<td>Combine the air quality data analysis methods of 'openair'
    with the JavaScript 'Leaflet' (<a href="https://leafletjs.com/">https://leafletjs.com/</a>) library.
    Functionality includes plotting site maps, "directional analysis"
    figures such as polar plots, and air mass trajectories.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://davidcarslaw.github.io/openairmaps/">https://davidcarslaw.github.io/openairmaps/</a>,
<a href="https://github.com/davidcarslaw/openairmaps">https://github.com/davidcarslaw/openairmaps</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/davidcarslaw/openairmaps/issues">https://github.com/davidcarslaw/openairmaps/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.2.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>cli, dplyr, forcats, ggmap, ggplot2, ggtext, leaflet,
lifecycle, lubridate, magrittr, mgcv, openair (&ge; 2.13), purrr
(&ge; 1.0.0), rlang, sf, stringr, tibble, tidyr</td>
</tr>
<tr>
<td>Suggests:</td>
<td>httr, jsonlite, worldmet</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Language:</td>
<td>en-GB</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-11-03 09:18:23 UTC; JD38</td>
</tr>
<tr>
<td>Author:</td>
<td>Jack Davison [cre, aut],
  David Carslaw [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jack Davison &lt;jack.davison@ricardo.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-11-03 10:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='openairmaps-package'>openairmaps: Create Maps of Air Pollution Data</h2><span id='topic+openairmaps'></span><span id='topic+openairmaps-package'></span>

<h3>Description</h3>

<p><img src="../help/figures/logo.png" style='float: right' alt='logo' width='120' />
</p>
<p>Combine the air quality data analysis methods of 'openair' with the JavaScript 'Leaflet' (<a href="https://leafletjs.com/">https://leafletjs.com/</a>) library. Functionality includes plotting site maps, &quot;directional analysis&quot; figures such as polar plots, and air mass trajectories.
</p>


<h3>Details</h3>

<p>This is a companion package to <code>openair</code>, a UK NERC- and
Defra-funded R package for the analysis of data pertaining to pollution
monitoring and dispersion modelling.
</p>
<p>As the R ecosystem has developed, R Markdown and, more recently, Quarto
have emerged as capable tools for combining data analysis with document
preparation. While these approaches can render typical .docx and .pdf
outputs, one of their most common output formats is the HTML document. This
format has many strengths, but a key one is interactivity; HTML widgets
allow documents to be more informative and engaging. Numerous packages have
been developed to easily develop these interactive widgets, such as
<code>plotly</code> and <code>dygraphs</code> for plots, <code>DT</code> for tables, and <code>leaflet</code> for maps.
The <code>openairmaps</code> package concerns itself with making <code>leaflet</code> maps.
</p>
<p>Air quality data analysis — particularly as it pertains to long term
monitoring data — naturally lends itself to being visualised spatially on a
map. Monitoring networks are geographically distributed, and ignoring their
geographical context may lead to incomplete insights at best and incorrect
conclusions at worst! Furthermore, many air quality analysis tools are
directional, asking questions of the data along the lines of “do elevated
concentrations come from the North, South, East or West?” The natural
question that follows is “well, what actually is it to the
North/South/East/West that could be causing elevated concentrations?” — a
map can help answer that question straightforwardly.
</p>
<p>The <code>openairmaps</code> package contains functions to visualise UK air quality
networks, and place &quot;polar analysis&quot; markers (like the <code>openair</code> <a href="openair.html#topic+polarPlot">polar plot</a>) and airmass trajectory paths on maps. It uses
a similar syntax to the <code>openair</code> package, which should make moving between
the two relatively seamless.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Jack Davison <a href="mailto:jack.davison@ricardo.com">jack.davison@ricardo.com</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> David Carslaw <a href="mailto:david.carslaw@york.ac.uk">david.carslaw@york.ac.uk</a>
</p>
</li></ul>



<h3>See Also</h3>

<p>The <code>openair</code> package, from which <code>openairmaps</code> is based.
</p>
<p>The <code>worldmet</code> package, which simplifies the access of
meteorological data in R.
</p>
<p>The <a href="https://bookdown.org/david_carslaw/openair/">openair book</a> for
more in-depth documentation of <code>openair</code> and <code>openairmaps</code>.
</p>

<hr>
<h2 id='+25+26gt+3B+25'>Pipe operator</h2><span id='topic++25+3E+25'></span>

<h3>Description</h3>

<p>See <code style="white-space: pre;">&#8288;magrittr::[\%&gt;\%][magrittr::pipe]&#8288;</code> for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lhs %&gt;% rhs
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="+2B25+2B26gt+2B3B+2B25_+3A_lhs">lhs</code></td>
<td>
<p>A value or the magrittr placeholder.</p>
</td></tr>
<tr><td><code id="+2B25+2B26gt+2B3B+2B25_+3A_rhs">rhs</code></td>
<td>
<p>A function call using the magrittr semantics.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The result of calling <code>rhs(lhs)</code>.
</p>

<hr>
<h2 id='addPolarMarkers'>Add polar markers to leaflet map</h2><span id='topic+addPolarMarkers'></span><span id='topic+addPolarDiffMarkers'></span>

<h3>Description</h3>

<p>This function is similar (but not identical to) the <code><a href="leaflet.html#topic+map-layers">leaflet::addMarkers()</a></code>
and <code><a href="leaflet.html#topic+map-layers">leaflet::addCircleMarkers()</a></code> functions in <code>leaflet</code>, which allows users
to add <code>openair</code> directional analysis plots to any leaflet map and have more
control over groups and layerIds than in &quot;all-in-one&quot; functions like
<code><a href="#topic+polarMap">polarMap()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>addPolarMarkers(
  map,
  pollutant,
  fun = openair::polarPlot,
  lng = NULL,
  lat = NULL,
  layerId = NULL,
  group = NULL,
  popup = NULL,
  popupOptions = NULL,
  label = NULL,
  labelOptions = NULL,
  options = leaflet::markerOptions(),
  clusterOptions = NULL,
  clusterId = NULL,
  key = FALSE,
  d.icon = 200,
  d.fig = 3.5,
  data = leaflet::getMapData(map),
  ...
)

addPolarDiffMarkers(
  map,
  pollutant,
  before = leaflet::getMapData(map),
  after = leaflet::getMapData(map),
  lng = NULL,
  lat = NULL,
  layerId = NULL,
  group = NULL,
  popup = NULL,
  popupOptions = NULL,
  label = NULL,
  labelOptions = NULL,
  options = leaflet::markerOptions(),
  clusterOptions = NULL,
  clusterId = NULL,
  key = FALSE,
  d.icon = 200,
  d.fig = 3.5,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="addPolarMarkers_+3A_map">map</code></td>
<td>
<p>a map widget object created from <code><a href="leaflet.html#topic+leaflet">leaflet</a>()</code></p>
</td></tr>
<tr><td><code id="addPolarMarkers_+3A_pollutant">pollutant</code></td>
<td>
<p>The name of the pollutant to be plot. Note that, if <code>fun = openair::windRose</code>, you must set <code>pollutant = "ws"</code>.</p>
</td></tr>
<tr><td><code id="addPolarMarkers_+3A_fun">fun</code></td>
<td>
<p>An <code>openair</code> directional analysis plotting function. Supported
functions include <code><a href="openair.html#topic+polarPlot">openair::polarPlot()</a></code> (the default),
<code><a href="openair.html#topic+polarAnnulus">openair::polarAnnulus()</a></code>, <code><a href="openair.html#topic+polarFreq">openair::polarFreq()</a></code>,
<code><a href="openair.html#topic+percentileRose">openair::percentileRose()</a></code>, <code><a href="openair.html#topic+pollutionRose">openair::pollutionRose()</a></code> and
<code><a href="openair.html#topic+windRose">openair::windRose()</a></code>. For <code><a href="openair.html#topic+polarDiff">openair::polarDiff()</a></code>, use
<code><a href="#topic+addPolarDiffMarkers">addPolarDiffMarkers()</a></code>.</p>
</td></tr>
<tr><td><code id="addPolarMarkers_+3A_lng">lng</code></td>
<td>
<p>The decimal longitude.</p>
</td></tr>
<tr><td><code id="addPolarMarkers_+3A_lat">lat</code></td>
<td>
<p>The decimal latitude.</p>
</td></tr>
<tr><td><code id="addPolarMarkers_+3A_layerid">layerId</code></td>
<td>
<p>the layer id</p>
</td></tr>
<tr><td><code id="addPolarMarkers_+3A_group">group</code></td>
<td>
<p>the name of the group the newly created layers should belong to
(for <code><a href="leaflet.html#topic+clearGroup">clearGroup</a></code> and <code><a href="leaflet.html#topic+addLayersControl">addLayersControl</a></code> purposes).
Human-friendly group names are permitted&ndash;they need not be short,
identifier-style names. Any number of layers and even different types of
layers (e.g. markers and polygons) can share the same group name.</p>
</td></tr>
<tr><td><code id="addPolarMarkers_+3A_popup">popup</code></td>
<td>
<p>A column of <code>data</code> to be used as a popup.</p>
</td></tr>
<tr><td><code id="addPolarMarkers_+3A_popupoptions">popupOptions</code></td>
<td>
<p>A Vector of <code><a href="leaflet.html#topic+popupOptions">popupOptions</a></code> to provide popups</p>
</td></tr>
<tr><td><code id="addPolarMarkers_+3A_label">label</code></td>
<td>
<p>A column of <code>data</code> to be used as a label.</p>
</td></tr>
<tr><td><code id="addPolarMarkers_+3A_labeloptions">labelOptions</code></td>
<td>
<p>A Vector of <code><a href="leaflet.html#topic+labelOptions">labelOptions</a></code> to provide label
options for each label. Default <code>NULL</code></p>
</td></tr>
<tr><td><code id="addPolarMarkers_+3A_options">options</code></td>
<td>
<p>a list of extra options for tile layers, popups, paths
(circles, rectangles, polygons, ...), or other map elements</p>
</td></tr>
<tr><td><code id="addPolarMarkers_+3A_clusteroptions">clusterOptions</code></td>
<td>
<p>if not <code>NULL</code>, markers will be clustered using
<a href="https://github.com/Leaflet/Leaflet.markercluster">Leaflet.markercluster</a>;
you can use <code><a href="leaflet.html#topic+markerClusterOptions">markerClusterOptions</a>()</code> to specify marker cluster
options</p>
</td></tr>
<tr><td><code id="addPolarMarkers_+3A_clusterid">clusterId</code></td>
<td>
<p>the id for the marker cluster layer</p>
</td></tr>
<tr><td><code id="addPolarMarkers_+3A_key">key</code></td>
<td>
<p>Should a key for each marker be drawn? Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="addPolarMarkers_+3A_d.icon">d.icon</code></td>
<td>
<p>The diameter of the plot on the map in pixels. This will affect
the size of the individual polar markers. Alternatively, a vector in the
form <code>c(width, height)</code> can be provided if a non-circular marker is
desired.</p>
</td></tr>
<tr><td><code id="addPolarMarkers_+3A_d.fig">d.fig</code></td>
<td>
<p>The diameter of the plots to be produced using <code>openair</code> in
inches. This will affect the resolution of the markers on the map.
Alternatively, a vector in the form <code>c(width, height)</code> can be provided if a
non-circular marker is desired.</p>
</td></tr>
<tr><td><code id="addPolarMarkers_+3A_data">data</code></td>
<td>
<p>A data frame. The data frame must contain the data to plot your
choice of openair directional analysis plot, which includes wind speed
(<code>ws</code>), wind direction (<code>wd</code>), and the column representing the
concentration of a pollutant. In addition, <code>data</code> must include a decimal
latitude and longitude. By default, it is the data object provided to
<code><a href="leaflet.html#topic+leaflet">leaflet::leaflet()</a></code> initially, but can be overridden.</p>
</td></tr>
<tr><td><code id="addPolarMarkers_+3A_...">...</code></td>
<td>
<p>Other arguments for the plotting function (e.g. <code>period</code> for
<code><a href="openair.html#topic+polarAnnulus">openair::polarAnnulus()</a></code>).</p>
</td></tr>
<tr><td><code id="addPolarMarkers_+3A_before">before</code>, <code id="addPolarMarkers_+3A_after">after</code></td>
<td>
<p>A data frame that represents the before/after case. See
<code><a href="openair.html#topic+polarPlot">openair::polarPlot()</a></code> for details of different input requirements. By
default, both <code>before</code> and <code>after</code> are the data object provided to
<code><a href="leaflet.html#topic+leaflet">leaflet::leaflet()</a></code> initially, but at least one should be overridden.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A leaflet object.
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>addPolarMarkers()</code>: Add any one-table polar marker (e.g.,
<code><a href="openair.html#topic+polarPlot">openair::polarPlot()</a></code>)
</p>
</li>
<li> <p><code>addPolarDiffMarkers()</code>: Add the two-table <code><a href="openair.html#topic+polarDiff">openair::polarDiff()</a></code> marker.
</p>
</li></ul>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(leaflet)
library(openair)

# different types of polar plot on one map
leaflet(data = polar_data) %&gt;%
  addTiles() %&gt;%
  addPolarMarkers("ws",
    fun = openair::windRose,
    group = "Wind Rose"
  ) %&gt;%
  addPolarMarkers("nox",
    fun = openair::polarPlot,
    group = "Polar Plot"
  ) %&gt;%
  addLayersControl(
    baseGroups = c("Wind Rose", "Polar Plot")
  )

# use of polar diff (NB: both 'before' and 'after' inherit from `leaflet()`,
# so at least one should be overridden - in this case 'after')
leaflet(data = polar_data) %&gt;%
  addTiles() %&gt;%
  addPolarDiffMarkers("nox",
    after = dplyr::mutate(polar_data, nox = jitter(nox, 5))
  )

## End(Not run)
</code></pre>

<hr>
<h2 id='addTrajPaths'>Add trajectory paths to leaflet map</h2><span id='topic+addTrajPaths'></span>

<h3>Description</h3>

<p>This function is similar (but not identical to) the <code><a href="leaflet.html#topic+map-layers">leaflet::addMarkers()</a></code>
function in <code>leaflet</code>, which allows users to add trajectory paths to any
leaflet map and have more control over groups and layerIds than in
&quot;all-in-one&quot; functions like <code><a href="#topic+trajMap">trajMap()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>addTrajPaths(
  map,
  lng = "lon",
  lat = "lat",
  layerId = NULL,
  group = NULL,
  data = leaflet::getMapData(map),
  npoints = 12,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="addTrajPaths_+3A_map">map</code></td>
<td>
<p>a map widget object created from <code><a href="leaflet.html#topic+leaflet">leaflet::leaflet()</a></code>.</p>
</td></tr>
<tr><td><code id="addTrajPaths_+3A_lng">lng</code></td>
<td>
<p>The decimal longitude.</p>
</td></tr>
<tr><td><code id="addTrajPaths_+3A_lat">lat</code></td>
<td>
<p>The decimal latitude.</p>
</td></tr>
<tr><td><code id="addTrajPaths_+3A_layerid">layerId</code></td>
<td>
<p>The layer id.</p>
</td></tr>
<tr><td><code id="addTrajPaths_+3A_group">group</code></td>
<td>
<p>the name of the group the newly created layers should belong to
(for <code><a href="leaflet.html#topic+remove">leaflet::clearGroup()</a></code> and <code><a href="leaflet.html#topic+addLayersControl">leaflet::addLayersControl()</a></code> purposes).
Human-friendly group names are permitted–they need not be short,
identifier-style names. Any number of layers and even different types of
layers (e.g. markers and polygons) can share the same group name.</p>
</td></tr>
<tr><td><code id="addTrajPaths_+3A_data">data</code></td>
<td>
<p>Data frame, the result of importing a trajectory file using
<code><a href="openair.html#topic+importTraj">openair::importTraj()</a></code>. By default, it is the data object provided to
<code><a href="leaflet.html#topic+leaflet">leaflet::leaflet()</a></code> initially, but can be overridden.</p>
</td></tr>
<tr><td><code id="addTrajPaths_+3A_npoints">npoints</code></td>
<td>
<p>A dot is placed every <code>npoints</code> along each full trajectory.
For hourly back trajectories points are plotted every <code>npoints</code> hours. This
helps to understand where the air masses were at particular times and get a
feel for the speed of the air (points closer together correspond to slower
moving air masses). Defaults to <code>12</code>.</p>
</td></tr>
<tr><td><code id="addTrajPaths_+3A_...">...</code></td>
<td>
<p>Other arguments to pass to both <code><a href="leaflet.html#topic+map-layers">leaflet::addCircleMarkers()</a></code> and
<code><a href="leaflet.html#topic+map-layers">leaflet::addPolylines()</a></code>. If you use the <code>color</code> argument, it is important
to ensure the vector you supply is of length one to avoid issues with
<code><a href="leaflet.html#topic+map-layers">leaflet::addPolylines()</a></code> (i.e., use <code>color = ~ pal(nox)[1]</code>). Note that
<code>opacity</code> controls the opacity of the lines and <code>fillOpacity</code> the opacity
of the markers.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code><a href="#topic+addTrajPaths">addTrajPaths()</a></code> can be a powerful way of quickly plotting
trajectories on a leaflet map, but users should take some care due to any
additional arguments being passed to both <code><a href="leaflet.html#topic+map-layers">leaflet::addCircleMarkers()</a></code> and
<code><a href="leaflet.html#topic+map-layers">leaflet::addPolylines()</a></code>. In particular, users should be weary of the use
of the <code>color</code> argument. Specifically, if <code>color</code> is passed a vector of
length greater than one, multiple polylines will be drawn on top of one
another. At best this will affect opacity, but at worst this will
significantly impact the performance of R and the final leaflet map.
</p>
<p>To mitigate this, please ensure that any vector passed to <code>color</code> is of
length one. This is simple if you want the whole path to be the same
colour, but more difficult if you want to colour by a pollutant, for
example. The easiest way to achieve this is to write a for loop or use
another iterative approach (e.g. the <code>purrr</code> package) to add one path per
arrival date. An example of this is provided in the Examples.
</p>


<h3>Value</h3>

<p>A leaflet object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(leaflet)
library(openairmaps)

pal &lt;- colorNumeric(palette = "viridis", domain = traj_data$nox)

map &lt;- leaflet() %&gt;%
  addTiles()

for (i in seq(length(unique(traj_data$date)))) {
  data &lt;- dplyr::filter(traj_data, date == unique(traj_data$date)[i])

  map &lt;- map %&gt;%
    addTrajPaths(
      data = data,
      color = pal(data$nox)[1]
    )
}

map

## End(Not run)
</code></pre>

<hr>
<h2 id='annulusMap'>Polar annulus plots on interactive leaflet maps</h2><span id='topic+annulusMap'></span>

<h3>Description</h3>

<p><code><a href="#topic+annulusMap">annulusMap()</a></code> creates a <code>leaflet</code> map using polar annulus plots as markers.
Any number of pollutants can be specified using the <code>pollutant</code> argument, and
multiple layers of markers can be added and toggled between using <code>control</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>annulusMap(
  data,
  pollutant = NULL,
  period = "hour",
  limits = "free",
  latitude = NULL,
  longitude = NULL,
  control = NULL,
  popup = NULL,
  label = NULL,
  provider = "OpenStreetMap",
  cols = "turbo",
  alpha = 1,
  key = FALSE,
  draw.legend = TRUE,
  collapse.control = FALSE,
  d.icon = 200,
  d.fig = 3.5,
  type = deprecated(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="annulusMap_+3A_data">data</code></td>
<td>
<p>A data frame. The data frame must contain the data to plot the
directional analysis marker, which includes wind speed (<code>ws</code>), wind
direction (<code>wd</code>), and the column representing the concentration of a
pollutant. In addition, <code>data</code> must include a decimal latitude and
longitude.</p>
</td></tr>
<tr><td><code id="annulusMap_+3A_pollutant">pollutant</code></td>
<td>
<p>The column name(s) of the pollutant(s) to plot. If multiple
pollutants are specified, they can be toggled between using a &quot;layer
control&quot; interface.</p>
</td></tr>
<tr><td><code id="annulusMap_+3A_period">period</code></td>
<td>
<p>This determines the temporal period to consider. Options are
&quot;hour&quot; (the default, to plot diurnal variations), &quot;season&quot; to plot
variation throughout the year, &quot;weekday&quot; to plot day of the week variation
and &quot;trend&quot; to plot the trend by wind direction.</p>
</td></tr>
<tr><td><code id="annulusMap_+3A_limits">limits</code></td>
<td>
<p>One of:
</p>

<ul>
<li> <p><code>"fixed"</code> which ensures all of the markers use the same colour scale.
</p>
</li>
<li> <p><code>"free"</code> (the default) which allows all of the markers to use different
colour scales.
</p>
</li>
<li><p> A numeric vector in the form <code>c(lower, upper)</code> used to define the colour
scale. For example, <code>limits = c(0, 100)</code> would force the plot limits to
span 0-100.
</p>
</li></ul>
</td></tr>
<tr><td><code id="annulusMap_+3A_latitude">latitude</code>, <code id="annulusMap_+3A_longitude">longitude</code></td>
<td>
<p>The decimal latitude/longitude. If not provided,
will be automatically inferred from data by looking for a column named
&quot;lat&quot;/&quot;latitude&quot; or &quot;lon&quot;/&quot;lng&quot;/&quot;long&quot;/&quot;longitude&quot; (case-insensitively).</p>
</td></tr>
<tr><td><code id="annulusMap_+3A_control">control</code></td>
<td>
<p>Used for splitting the input data into different groups which
can be selected between using a &quot;layer control&quot; interface, passed to the
<code>type</code> argument of <code><a href="openair.html#topic+cutData">openair::cutData()</a></code>. <code>control</code> cannot be used if
multiple <code>pollutant</code> columns have been provided.</p>
</td></tr>
<tr><td><code id="annulusMap_+3A_popup">popup</code></td>
<td>
<p>Columns to be used as the HTML content for marker popups. Popups
may be useful to show information about the individual sites (e.g., site
names, codes, types, etc.). If a vector of column names are provided they
are passed to <code><a href="#topic+buildPopup">buildPopup()</a></code> using its default values.</p>
</td></tr>
<tr><td><code id="annulusMap_+3A_label">label</code></td>
<td>
<p>Column to be used as the HTML content for hover-over labels.
Labels are useful for the same reasons as popups, though are typically
shorter.</p>
</td></tr>
<tr><td><code id="annulusMap_+3A_provider">provider</code></td>
<td>
<p>The base map(s) to be used. See
<a href="http://leaflet-extras.github.io/leaflet-providers/preview/">http://leaflet-extras.github.io/leaflet-providers/preview/</a> for a list of
all base maps that can be used. If multiple base maps are provided, they
can be toggled between using a &quot;layer control&quot; interface. By default, the
interface will use the provider names as labels, but users can define their
own using a named vector (e.g., <code>c("Default" = "OpenStreetMap", "Satellite" = "Esri.WorldImagery")</code>)</p>
</td></tr>
<tr><td><code id="annulusMap_+3A_cols">cols</code></td>
<td>
<p>The colours used for plotting. See <code><a href="openair.html#topic+openColours">openair::openColours()</a></code> for
more information.</p>
</td></tr>
<tr><td><code id="annulusMap_+3A_alpha">alpha</code></td>
<td>
<p>The alpha transparency to use for the plotting surface (a value
between 0 and 1 with zero being fully transparent and 1 fully opaque).</p>
</td></tr>
<tr><td><code id="annulusMap_+3A_key">key</code></td>
<td>
<p>Should a key for each marker be drawn? Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="annulusMap_+3A_draw.legend">draw.legend</code></td>
<td>
<p>When <code>limits</code> are specified, should a shared legend be
created at the side of the map? Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="annulusMap_+3A_collapse.control">collapse.control</code></td>
<td>
<p>Should the &quot;layer control&quot; interface be collapsed?
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="annulusMap_+3A_d.icon">d.icon</code></td>
<td>
<p>The diameter of the plot on the map in pixels. This will affect
the size of the individual polar markers. Alternatively, a vector in the
form <code>c(width, height)</code> can be provided if a non-circular marker is
desired.</p>
</td></tr>
<tr><td><code id="annulusMap_+3A_d.fig">d.fig</code></td>
<td>
<p>The diameter of the plots to be produced using <code>openair</code> in
inches. This will affect the resolution of the markers on the map.
Alternatively, a vector in the form <code>c(width, height)</code> can be provided if a
non-circular marker is desired.</p>
</td></tr>
<tr><td><code id="annulusMap_+3A_type">type</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>. Different sites are now
automatically detected based on latitude and longitude. Please use <code>label</code>
and/or <code>popup</code> to label different sites.</p>
</td></tr>
<tr><td><code id="annulusMap_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="openair.html#topic+polarAnnulus">openair::polarAnnulus</a></code>
</p>

<dl>
<dt><code>resolution</code></dt><dd><p>Two plot resolutions can be set: &ldquo;normal&rdquo; and
&ldquo;fine&rdquo; (the default).</p>
</dd>
<dt><code>local.tz</code></dt><dd><p>Should the results be calculated in local time that includes
a treatment of daylight savings time (DST)? The default is not to consider
DST issues, provided the data were imported without a DST offset. Emissions
activity tends to occur at local time e.g. rush hour is at 8 am every day.
When the clocks go forward in spring, the emissions are effectively
released into the atmosphere typically 1 hour earlier during the summertime
i.e. when DST applies. When plotting diurnal profiles, this has the effect
of &ldquo;smearing-out&rdquo; the concentrations. Sometimes, a useful approach
is to express time as local time. This correction tends to produce
better-defined diurnal profiles of concentration (or other variables) and
allows a better comparison to be made with emissions/activity data. If set
to <code>FALSE</code> then GMT is used. Examples of usage include <code>local.tz
  = "Europe/London"</code>, <code>local.tz = "America/New_York"</code>. See
<code>cutData</code> and <code>import</code> for more details.</p>
</dd>
<dt><code>statistic</code></dt><dd><p>The statistic that should be applied to each wind
speed/direction bin. Can be &ldquo;mean&rdquo; (default), &ldquo;median&rdquo;,
&ldquo;max&rdquo; (maximum), &ldquo;frequency&rdquo;. &ldquo;stdev&rdquo; (standard
deviation), &ldquo;weighted.mean&rdquo; or &ldquo;cpf&rdquo; (Conditional Probability
Function). Because of the smoothing involved, the colour scale for some of
these statistics is only to provide an indication of overall pattern and
should not be interpreted in concentration units e.g. for <code>statistic =
  "weighted.mean"</code> where the bin mean is multiplied by the bin frequency and
divided by the total frequency. In many cases using <code>polarFreq</code> will
be better. Setting <code>statistic = "weighted.mean"</code> can be useful because
it provides an indication of the concentration * frequency of occurrence
and will highlight the wind speed/direction conditions that dominate the
overall mean.</p>
</dd>
<dt><code>percentile</code></dt><dd><p>If <code>statistic = "percentile"</code> or <code>statistic =
  "cpf"</code> then <code>percentile</code> is used, expressed from 0 to 100. Note that
the percentile value is calculated in the wind speed, wind direction
&lsquo;bins&rsquo;. For this reason it can also be useful to set <code>min.bin</code>
to ensure there are a sufficient number of points available to estimate a
percentile. See <code>quantile</code> for more details of how percentiles are
calculated.</p>
</dd>
<dt><code>width</code></dt><dd><p>The width of the annulus; can be &ldquo;normal&rdquo; (the default),
&ldquo;thin&rdquo; or &ldquo;fat&rdquo;.</p>
</dd>
<dt><code>min.bin</code></dt><dd><p>The minimum number of points allowed in a wind speed/wind
direction bin.  The default is 1. A value of two requires at least 2 valid
records in each bin an so on; bins with less than 2 valid records are set
to NA. Care should be taken when using a value &gt; 1 because of the risk of
removing real data points. It is recommended to consider your data with
care. Also, the <code>polarFreq</code> function can be of use in such
circumstances.</p>
</dd>
<dt><code>exclude.missing</code></dt><dd><p>Setting this option to <code>TRUE</code> (the default)
removes points from the plot that are too far from the original data. The
smoothing routines will produce predictions at points where no data exist
i.e. they predict. By removing the points too far from the original data
produces a plot where it is clear where the original data lie. If set to
<code>FALSE</code> missing data will be interpolated.</p>
</dd>
<dt><code>date.pad</code></dt><dd><p>For <code>type = "trend"</code> (default), <code>date.pad = TRUE</code>
will pad-out missing data to the beginning of the first year and the end of
the last year. The purpose is to ensure that the trend plot begins and ends
at the beginning or end of year.</p>
</dd>
<dt><code>force.positive</code></dt><dd><p>The default is <code>TRUE</code>. Sometimes if smoothing data
with steep gradients it is possible for predicted values to be negative.
<code>force.positive = TRUE</code> ensures that predictions remain positive. This
is useful for several reasons. First, with lots of missing data more
interpolation is needed and this can result in artefacts because the
predictions are too far from the original data. Second, if it is known
beforehand that the data are all positive, then this option carries that
assumption through to the prediction. The only likely time where setting
<code>force.positive = FALSE</code> would be if background concentrations were
first subtracted resulting in data that is legitimately negative. For the
vast majority of situations it is expected that the user will not need to
alter the default option.</p>
</dd>
<dt><code>k</code></dt><dd><p>The smoothing value supplied to <code>gam</code> for the temporal and wind
direction components, respectively. In some cases e.g. a trend plot with
less than 1-year of data the smoothing with the default values may become
too noisy and affected more by outliers. Choosing a lower value of <code>k</code>
(say 10) may help produce a better plot.</p>
</dd>
<dt><code>normalise</code></dt><dd><p>If <code>TRUE</code> concentrations are normalised by dividing by
their mean value. This is done <em>after</em> fitting the smooth surface.
This option is particularly useful if one is interested in the patterns of
concentrations for several pollutants on different scales e.g. NOx and CO.
Often useful if more than one <code>pollutant</code> is chosen.</p>
</dd>
<dt><code>key.header</code></dt><dd><p>Adds additional text/labels to the scale key. For example,
passing the options <code>key.header = "header", key.footer = "footer1"</code>
adds addition text above and below the scale key. These arguments are
passed to <code>drawOpenKey</code> via <code>quickText</code>, applying the
<code>auto.text</code> argument, to handle formatting.</p>
</dd>
<dt><code>key.footer</code></dt><dd><p>see <code>key.footer</code>.</p>
</dd>
<dt><code>key.position</code></dt><dd><p>Location where the scale key is to plotted. Allowed
arguments currently include <code>"top"</code>, <code>"right"</code>, <code>"bottom"</code>
and <code>"left"</code>.</p>
</dd>
<dt><code>auto.text</code></dt><dd><p>Either <code>TRUE</code> (default) or <code>FALSE</code>. If <code>TRUE</code>
titles and axis labels will automatically try and format pollutant names
and units properly e.g.  by subscripting the &lsquo;2&rsquo; in NO2.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>A leaflet object.
</p>


<h3>See Also</h3>

<p>the original <code><a href="openair.html#topic+polarAnnulus">openair::polarAnnulus()</a></code>
</p>
<p><code><a href="#topic+annulusMapStatic">annulusMapStatic()</a></code> for the static <code>ggmap</code> equivalent of
<code><a href="#topic+annulusMap">annulusMap()</a></code>
</p>
<p>Other interactive directional analysis maps: 
<code><a href="#topic+diffMap">diffMap</a>()</code>,
<code><a href="#topic+freqMap">freqMap</a>()</code>,
<code><a href="#topic+percentileMap">percentileMap</a>()</code>,
<code><a href="#topic+polarMap">polarMap</a>()</code>,
<code><a href="#topic+pollroseMap">pollroseMap</a>()</code>,
<code><a href="#topic+windroseMap">windroseMap</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
annulusMap(polar_data,
  pollutant = "nox",
  period = "hour",
  provider = "Stamen.Toner"
)

## End(Not run)
</code></pre>

<hr>
<h2 id='annulusMapStatic'>Bivariate polar plots on a static ggmap</h2><span id='topic+annulusMapStatic'></span>

<h3>Description</h3>

<p><code><a href="#topic+annulusMapStatic">annulusMapStatic()</a></code> creates a <code>ggplot2</code> map using polar annulus plots as
markers. As this function returns a <code>ggplot2</code> object, further customisation
can be achieved using functions like <code><a href="ggplot2.html#topic+theme">ggplot2::theme()</a></code> and
<code><a href="ggplot2.html#topic+guides">ggplot2::guides()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>annulusMapStatic(
  data,
  pollutant = NULL,
  ggmap,
  period = "hour",
  facet = NULL,
  limits = "free",
  latitude = NULL,
  longitude = NULL,
  cols = "turbo",
  alpha = 1,
  key = FALSE,
  facet.nrow = NULL,
  d.icon = 150,
  d.fig = 3,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="annulusMapStatic_+3A_data">data</code></td>
<td>
<p>A data frame. The data frame must contain the data to plot the
directional analysis marker, which includes wind speed (<code>ws</code>), wind
direction (<code>wd</code>), and the column representing the concentration of a
pollutant. In addition, <code>data</code> must include a decimal latitude and
longitude.</p>
</td></tr>
<tr><td><code id="annulusMapStatic_+3A_pollutant">pollutant</code></td>
<td>
<p>The column name(s) of the pollutant(s) to plot. If multiple
pollutants are specified, they will each form part of a separate panel.</p>
</td></tr>
<tr><td><code id="annulusMapStatic_+3A_ggmap">ggmap</code></td>
<td>
<p>A <code>ggmap</code> object obtained using <code><a href="ggmap.html#topic+get_map">ggmap::get_map()</a></code> or a similar
function to use as the basemap.</p>
</td></tr>
<tr><td><code id="annulusMapStatic_+3A_period">period</code></td>
<td>
<p>This determines the temporal period to consider. Options are
&quot;hour&quot; (the default, to plot diurnal variations), &quot;season&quot; to plot
variation throughout the year, &quot;weekday&quot; to plot day of the week variation
and &quot;trend&quot; to plot the trend by wind direction.</p>
</td></tr>
<tr><td><code id="annulusMapStatic_+3A_facet">facet</code></td>
<td>
<p>Used for splitting the input data into different panels, passed
to the <code>type</code> argument of <code><a href="openair.html#topic+cutData">openair::cutData()</a></code>. <code>facet</code> cannot be used if
multiple <code>pollutant</code> columns have been provided.</p>
</td></tr>
<tr><td><code id="annulusMapStatic_+3A_limits">limits</code></td>
<td>
<p>One of:
</p>

<ul>
<li> <p><code>"fixed"</code> which ensures all of the markers use the same colour scale.
</p>
</li>
<li> <p><code>"free"</code> (the default) which allows all of the markers to use different
colour scales.
</p>
</li>
<li><p> A numeric vector in the form <code>c(lower, upper)</code> used to define the colour
scale. For example, <code>limits = c(0, 100)</code> would force the plot limits to
span 0-100.
</p>
</li></ul>
</td></tr>
<tr><td><code id="annulusMapStatic_+3A_latitude">latitude</code>, <code id="annulusMapStatic_+3A_longitude">longitude</code></td>
<td>
<p>The decimal latitude/longitude. If not provided,
will be automatically inferred from data by looking for a column named
&quot;lat&quot;/&quot;latitude&quot; or &quot;lon&quot;/&quot;lng&quot;/&quot;long&quot;/&quot;longitude&quot; (case-insensitively).</p>
</td></tr>
<tr><td><code id="annulusMapStatic_+3A_cols">cols</code></td>
<td>
<p>The colours used for plotting. See <code><a href="openair.html#topic+openColours">openair::openColours()</a></code> for
more information.</p>
</td></tr>
<tr><td><code id="annulusMapStatic_+3A_alpha">alpha</code></td>
<td>
<p>The alpha transparency to use for the plotting surface (a value
between 0 and 1 with zero being fully transparent and 1 fully opaque).</p>
</td></tr>
<tr><td><code id="annulusMapStatic_+3A_key">key</code></td>
<td>
<p>Should a key for each marker be drawn? Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="annulusMapStatic_+3A_facet.nrow">facet.nrow</code></td>
<td>
<p>Passed to the <code>nrow</code> argument of <code><a href="ggplot2.html#topic+facet_wrap">ggplot2::facet_wrap()</a></code>.</p>
</td></tr>
<tr><td><code id="annulusMapStatic_+3A_d.icon">d.icon</code></td>
<td>
<p>The diameter of the plot on the map in pixels. This will affect
the size of the individual polar markers. Alternatively, a vector in the
form <code>c(width, height)</code> can be provided if a non-circular marker is
desired.</p>
</td></tr>
<tr><td><code id="annulusMapStatic_+3A_d.fig">d.fig</code></td>
<td>
<p>The diameter of the plots to be produced using <code>openair</code> in
inches. This will affect the resolution of the markers on the map.
Alternatively, a vector in the form <code>c(width, height)</code> can be provided if a
non-circular marker is desired.</p>
</td></tr>
<tr><td><code id="annulusMapStatic_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="openair.html#topic+polarAnnulus">openair::polarAnnulus</a></code>
</p>

<dl>
<dt><code>resolution</code></dt><dd><p>Two plot resolutions can be set: &ldquo;normal&rdquo; and
&ldquo;fine&rdquo; (the default).</p>
</dd>
<dt><code>local.tz</code></dt><dd><p>Should the results be calculated in local time that includes
a treatment of daylight savings time (DST)? The default is not to consider
DST issues, provided the data were imported without a DST offset. Emissions
activity tends to occur at local time e.g. rush hour is at 8 am every day.
When the clocks go forward in spring, the emissions are effectively
released into the atmosphere typically 1 hour earlier during the summertime
i.e. when DST applies. When plotting diurnal profiles, this has the effect
of &ldquo;smearing-out&rdquo; the concentrations. Sometimes, a useful approach
is to express time as local time. This correction tends to produce
better-defined diurnal profiles of concentration (or other variables) and
allows a better comparison to be made with emissions/activity data. If set
to <code>FALSE</code> then GMT is used. Examples of usage include <code>local.tz
  = "Europe/London"</code>, <code>local.tz = "America/New_York"</code>. See
<code>cutData</code> and <code>import</code> for more details.</p>
</dd>
<dt><code>type</code></dt><dd><p><code>type</code> determines how the data are split i.e. conditioned,
and then plotted. The default is will produce a single plot using the
entire data. Type can be one of the built-in types as detailed in
<code>cutData</code> e.g. &ldquo;season&rdquo;, &ldquo;year&rdquo;, &ldquo;weekday&rdquo; and so
on. For example, <code>type = "season"</code> will produce four plots &mdash; one for
each season.
</p>
<p>It is also possible to choose <code>type</code> as another variable in the data
frame. If that variable is numeric, then the data will be split into four
quantiles (if possible) and labelled accordingly. If type is an existing
character or factor variable, then those categories/levels will be used
directly. This offers great flexibility for understanding the variation of
different variables and how they depend on one another.
</p>
<p>Type can be up length two e.g. <code>type = c("season", "site")</code> will
produce a 2x2 plot split by season and site. The use of two types is mostly
meant for situations where there are several sites. Note, when two types
are provided the first forms the columns and the second the rows.
</p>
<p>Also note that for the <code>polarAnnulus</code> function some type/period
combinations are forbidden or make little sense. For example, <code>type =
  "season"</code> and <code>period = "trend"</code> (which would result in a plot with
too many gaps in it for sensible smoothing), or <code>type = "weekday"</code> and
<code>period = "weekday"</code>.</p>
</dd>
<dt><code>statistic</code></dt><dd><p>The statistic that should be applied to each wind
speed/direction bin. Can be &ldquo;mean&rdquo; (default), &ldquo;median&rdquo;,
&ldquo;max&rdquo; (maximum), &ldquo;frequency&rdquo;. &ldquo;stdev&rdquo; (standard
deviation), &ldquo;weighted.mean&rdquo; or &ldquo;cpf&rdquo; (Conditional Probability
Function). Because of the smoothing involved, the colour scale for some of
these statistics is only to provide an indication of overall pattern and
should not be interpreted in concentration units e.g. for <code>statistic =
  "weighted.mean"</code> where the bin mean is multiplied by the bin frequency and
divided by the total frequency. In many cases using <code>polarFreq</code> will
be better. Setting <code>statistic = "weighted.mean"</code> can be useful because
it provides an indication of the concentration * frequency of occurrence
and will highlight the wind speed/direction conditions that dominate the
overall mean.</p>
</dd>
<dt><code>percentile</code></dt><dd><p>If <code>statistic = "percentile"</code> or <code>statistic =
  "cpf"</code> then <code>percentile</code> is used, expressed from 0 to 100. Note that
the percentile value is calculated in the wind speed, wind direction
&lsquo;bins&rsquo;. For this reason it can also be useful to set <code>min.bin</code>
to ensure there are a sufficient number of points available to estimate a
percentile. See <code>quantile</code> for more details of how percentiles are
calculated.</p>
</dd>
<dt><code>width</code></dt><dd><p>The width of the annulus; can be &ldquo;normal&rdquo; (the default),
&ldquo;thin&rdquo; or &ldquo;fat&rdquo;.</p>
</dd>
<dt><code>min.bin</code></dt><dd><p>The minimum number of points allowed in a wind speed/wind
direction bin.  The default is 1. A value of two requires at least 2 valid
records in each bin an so on; bins with less than 2 valid records are set
to NA. Care should be taken when using a value &gt; 1 because of the risk of
removing real data points. It is recommended to consider your data with
care. Also, the <code>polarFreq</code> function can be of use in such
circumstances.</p>
</dd>
<dt><code>exclude.missing</code></dt><dd><p>Setting this option to <code>TRUE</code> (the default)
removes points from the plot that are too far from the original data. The
smoothing routines will produce predictions at points where no data exist
i.e. they predict. By removing the points too far from the original data
produces a plot where it is clear where the original data lie. If set to
<code>FALSE</code> missing data will be interpolated.</p>
</dd>
<dt><code>date.pad</code></dt><dd><p>For <code>type = "trend"</code> (default), <code>date.pad = TRUE</code>
will pad-out missing data to the beginning of the first year and the end of
the last year. The purpose is to ensure that the trend plot begins and ends
at the beginning or end of year.</p>
</dd>
<dt><code>force.positive</code></dt><dd><p>The default is <code>TRUE</code>. Sometimes if smoothing data
with steep gradients it is possible for predicted values to be negative.
<code>force.positive = TRUE</code> ensures that predictions remain positive. This
is useful for several reasons. First, with lots of missing data more
interpolation is needed and this can result in artefacts because the
predictions are too far from the original data. Second, if it is known
beforehand that the data are all positive, then this option carries that
assumption through to the prediction. The only likely time where setting
<code>force.positive = FALSE</code> would be if background concentrations were
first subtracted resulting in data that is legitimately negative. For the
vast majority of situations it is expected that the user will not need to
alter the default option.</p>
</dd>
<dt><code>k</code></dt><dd><p>The smoothing value supplied to <code>gam</code> for the temporal and wind
direction components, respectively. In some cases e.g. a trend plot with
less than 1-year of data the smoothing with the default values may become
too noisy and affected more by outliers. Choosing a lower value of <code>k</code>
(say 10) may help produce a better plot.</p>
</dd>
<dt><code>normalise</code></dt><dd><p>If <code>TRUE</code> concentrations are normalised by dividing by
their mean value. This is done <em>after</em> fitting the smooth surface.
This option is particularly useful if one is interested in the patterns of
concentrations for several pollutants on different scales e.g. NOx and CO.
Often useful if more than one <code>pollutant</code> is chosen.</p>
</dd>
<dt><code>key.header</code></dt><dd><p>Adds additional text/labels to the scale key. For example,
passing the options <code>key.header = "header", key.footer = "footer1"</code>
adds addition text above and below the scale key. These arguments are
passed to <code>drawOpenKey</code> via <code>quickText</code>, applying the
<code>auto.text</code> argument, to handle formatting.</p>
</dd>
<dt><code>key.footer</code></dt><dd><p>see <code>key.footer</code>.</p>
</dd>
<dt><code>key.position</code></dt><dd><p>Location where the scale key is to plotted. Allowed
arguments currently include <code>"top"</code>, <code>"right"</code>, <code>"bottom"</code>
and <code>"left"</code>.</p>
</dd>
<dt><code>auto.text</code></dt><dd><p>Either <code>TRUE</code> (default) or <code>FALSE</code>. If <code>TRUE</code>
titles and axis labels will automatically try and format pollutant names
and units properly e.g.  by subscripting the &lsquo;2&rsquo; in NO2.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>ggplot2</code> plot with a <code>ggmap</code> basemap
</p>


<h3>Further customisation using ggplot2</h3>

<p>As the outputs of the static directional analysis functions are <code>ggplot2</code>
figures, further customisation is possible using functions such as
<code><a href="ggplot2.html#topic+theme">ggplot2::theme()</a></code>, <code><a href="ggplot2.html#topic+guides">ggplot2::guides()</a></code> and <code><a href="ggplot2.html#topic+labs">ggplot2::labs()</a></code>.
</p>
<p>If multiple pollutants are specified, subscripting (e.g., the &quot;x&quot; in &quot;NOx&quot;)
is achieved using the <a href="ggtext.html#topic+ggtext">ggtext</a> package. Therefore if you
choose to override the plot theme, it is recommended to use
<code style="white-space: pre;">&#8288;[ggplot2::theme()]&#8288;</code> and <code style="white-space: pre;">&#8288;[ggtext::element_markdown()]&#8288;</code> to define the
<code>strip.text</code> parameter.
</p>
<p>When arguments like <code>limits</code>, <code>percentile</code> or <code>breaks</code> are defined, a
legend is automatically added to the figure. Legends can be removed using
<code>ggplot2::theme(legend.position = "none")</code>, or further customised using
<code><a href="ggplot2.html#topic+guides">ggplot2::guides()</a></code> and either <code>color = ggplot2::guide_colourbar()</code> for
continuous legends or <code>fill = ggplot2::guide_legend()</code> for discrete
legends.
</p>


<h3>See Also</h3>

<p>the original <code><a href="openair.html#topic+polarAnnulus">openair::polarAnnulus()</a></code>
</p>
<p><code><a href="#topic+annulusMap">annulusMap()</a></code> for the interactive <code>leaflet</code> equivalent of
<code><a href="#topic+annulusMapStatic">annulusMapStatic()</a></code>
</p>
<p>Other static directional analysis maps: 
<code><a href="#topic+diffMapStatic">diffMapStatic</a>()</code>,
<code><a href="#topic+freqMapStatic">freqMapStatic</a>()</code>,
<code><a href="#topic+percentileMapStatic">percentileMapStatic</a>()</code>,
<code><a href="#topic+polarMapStatic">polarMapStatic</a>()</code>,
<code><a href="#topic+pollroseMapStatic">pollroseMapStatic</a>()</code>,
<code><a href="#topic+windroseMapStatic">windroseMapStatic</a>()</code>
</p>

<hr>
<h2 id='buildPopup'>Build a Complex Popup for a Leaflet Map</h2><span id='topic+buildPopup'></span>

<h3>Description</h3>

<p>Group a dataframe together by latitude/longitude columns and create a HTML
popup with user-defined columns. By default, the unique values of character
columns are collapsed into comma-separated lists, numeric columns are
averaged, and date columns are presented as a range. This function returns
the input dataframe appended with a &quot;popup&quot; column, which can then be used in
the <code>popup</code> argument of a function like <code><a href="#topic+polarMap">polarMap()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>buildPopup(
  data,
  cols,
  latitude = NULL,
  longitude = NULL,
  names = NULL,
  control = NULL,
  fun.character = function(x) paste(unique(x), collapse = ", "),
  fun.numeric = function(x) signif(mean(x, na.rm = TRUE), 3),
  fun.dttm = function(x) paste(lubridate::floor_date(range(x, na.rm = TRUE), "day"),
    collapse = " to ")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="buildPopup_+3A_data">data</code></td>
<td>
<p>A data frame containing latitude and longitude information that
will go on to be used in a function such as <code><a href="#topic+polarMap">polarMap()</a></code>.</p>
</td></tr>
<tr><td><code id="buildPopup_+3A_cols">cols</code></td>
<td>
<p>A character vector of column names, the data from which will
appear in the popup.</p>
</td></tr>
<tr><td><code id="buildPopup_+3A_latitude">latitude</code>, <code id="buildPopup_+3A_longitude">longitude</code></td>
<td>
<p>The decimal latitude/longitude. If not provided,
will be automatically inferred from data by looking for a column named
&quot;lat&quot;/&quot;latitude&quot; or &quot;lon&quot;/&quot;lng&quot;/&quot;long&quot;\&quot;longitude&quot;. (case-insensitively).</p>
</td></tr>
<tr><td><code id="buildPopup_+3A_names">names</code></td>
<td>
<p>Optional. A named vector used to rename certain columns in the
popups. See the Example for more information.</p>
</td></tr>
<tr><td><code id="buildPopup_+3A_control">control</code></td>
<td>
<p>Optional. Column which will be used for the <code>control</code> argument
of other mapping functions. This only needs to be used if <code>control</code> is
going to be used in <code><a href="#topic+polarMap">polarMap()</a></code> or another similar function, and you'd
expect different values for the different map layers (for example, if you
are calculating a mean pollutant concentration).</p>
</td></tr>
<tr><td><code id="buildPopup_+3A_fun.character">fun.character</code></td>
<td>
<p>A function to summarise character and factor columns.
Defaults to collapsing unique values into a comma-separated list.</p>
</td></tr>
<tr><td><code id="buildPopup_+3A_fun.numeric">fun.numeric</code></td>
<td>
<p>A function to summarise numeric columns. Defaults to
taking the mean to three significant figures.</p>
</td></tr>
<tr><td><code id="buildPopup_+3A_fun.dttm">fun.dttm</code></td>
<td>
<p>A function to summarise date columns. Defaults to presenting
the date as a range.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code><a href="tibble.html#topic+tibble">tibble::tibble()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
buildPopup(
  data = openairmaps::polar_data,
  cols = c("site", "site_type", "date", "nox"),
  names = c("Site" = "site", "Site Type" = "site_type", "Date Range" = "date")
) %&gt;%
  polarMap("nox", popup = "popup")

## End(Not run)
</code></pre>

<hr>
<h2 id='convertPostcode'>Convert a UK postcode to a latitude/longitude pair</h2><span id='topic+convertPostcode'></span>

<h3>Description</h3>

<p>This is a much simpler implementation of the tools found in the
<code>PostcodesioR</code> R package, intended for use with the <code><a href="#topic+searchNetwork">searchNetwork()</a></code>
function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>convertPostcode(postcode)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="convertPostcode_+3A_postcode">postcode</code></td>
<td>
<p>A valid UK postcode, e.g., <code>"SW1A 1AA"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the latitude, longitude, and input postcode.
</p>


<h3>Source</h3>

<p><a href="https://postcodes.io/">https://postcodes.io/</a>
</p>


<h3>See Also</h3>

<p>The <code>PostcodesioR</code> package at
<a href="https://github.com/ropensci/PostcodesioR/">https://github.com/ropensci/PostcodesioR/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># convert a UK postcode
convertPostcode("SW1A1AA")

## Not run: 
# use with `searchNetwork()`
palace &lt;- convertPostcode("SW1A1AA")
searchNetwork(lat = palace$lat, lng = palace$lng, max_dist = 10)

## End(Not run)

</code></pre>

<hr>
<h2 id='diffMap'>Bivariate polar plots on interactive leaflet maps</h2><span id='topic+diffMap'></span>

<h3>Description</h3>

<p><code><a href="#topic+diffMap">diffMap()</a></code> creates a <code>leaflet</code> map using bivariate polar &quot;difference&quot; plots
as markers. Any number of pollutants can be specified using the <code>pollutant</code>
argument, and multiple layers of markers can be added and toggled between
using <code>control</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>diffMap(
  before,
  after,
  pollutant = NULL,
  x = "ws",
  limits = "free",
  latitude = NULL,
  longitude = NULL,
  control = NULL,
  popup = NULL,
  label = NULL,
  provider = "OpenStreetMap",
  cols = c("#002F70", "#3167BB", "#879FDB", "#C8D2F1", "#F6F6F6", "#F4C8C8", "#DA8A8B",
    "#AE4647", "#5F1415"),
  alpha = 1,
  key = FALSE,
  draw.legend = TRUE,
  collapse.control = FALSE,
  d.icon = 200,
  d.fig = 3.5,
  type = deprecated(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="diffMap_+3A_before">before</code></td>
<td>
<p>A data frame that represents the &quot;before&quot; case. See
<code><a href="openair.html#topic+polarPlot">polarPlot()</a></code> for details of different input requirements.</p>
</td></tr>
<tr><td><code id="diffMap_+3A_after">after</code></td>
<td>
<p>A data frame that represents the &quot;after&quot; case. See <code><a href="openair.html#topic+polarPlot">polarPlot()</a></code>
for details of different input requirements.</p>
</td></tr>
<tr><td><code id="diffMap_+3A_pollutant">pollutant</code></td>
<td>
<p>Mandatory. A pollutant name corresponding to a variable in a
data frame should be supplied e.g. <code>pollutant = "nox"</code>. There can also
be more than one pollutant specified e.g. <code>pollutant = c("nox",
  "no2")</code>. The main use of using two or more pollutants is for model
evaluation where two species would be expected to have similar
concentrations. This saves the user stacking the data and it is possible to
work with columns of data directly. A typical use would be <code>pollutant
  = c("obs", "mod")</code> to compare two columns &ldquo;obs&rdquo; (the observations)
and &ldquo;mod&rdquo; (modelled values). When pair-wise statistics such as
Pearson correlation and regression techniques are to be plotted,
<code>pollutant</code> takes two elements too. For example, <code>pollutant =
  c("bc", "pm25")</code> where <code>"bc"</code> is a function of <code>"pm25"</code>.</p>
</td></tr>
<tr><td><code id="diffMap_+3A_x">x</code></td>
<td>
<p>Name of variable to plot against wind direction in polar
coordinates, the default is wind speed, &ldquo;ws&rdquo;.</p>
</td></tr>
<tr><td><code id="diffMap_+3A_limits">limits</code></td>
<td>
<p>By default, each individual polar marker has its own colour
scale. The <code>limits</code> argument will force all markers to use the same colour
scale. The limits are set in the form <code>c(lower, upper)</code>, so <code>limits = c(-5, 5)</code> would force the plot limits to span -5 to 5. It is recommended to use a
symmetrical limit scale (along with a &quot;diverging&quot; colour palette) for
effective visualisation.</p>
</td></tr>
<tr><td><code id="diffMap_+3A_latitude">latitude</code>, <code id="diffMap_+3A_longitude">longitude</code></td>
<td>
<p>The decimal latitude/longitude. If not provided,
will be automatically inferred from data by looking for a column named
&quot;lat&quot;/&quot;latitude&quot; or &quot;lon&quot;/&quot;lng&quot;/&quot;long&quot;/&quot;longitude&quot; (case-insensitively).</p>
</td></tr>
<tr><td><code id="diffMap_+3A_control">control</code></td>
<td>
<p>Used for splitting the input data into different groups which
can be selected between using a &quot;layer control&quot; interface, passed to the
<code>type</code> argument of <code><a href="openair.html#topic+cutData">openair::cutData()</a></code>. <code>control</code> cannot be used if
multiple <code>pollutant</code> columns have been provided.</p>
</td></tr>
<tr><td><code id="diffMap_+3A_popup">popup</code></td>
<td>
<p>Columns to be used as the HTML content for marker popups. Popups
may be useful to show information about the individual sites (e.g., site
names, codes, types, etc.). If a vector of column names are provided they
are passed to <code><a href="#topic+buildPopup">buildPopup()</a></code> using its default values.</p>
</td></tr>
<tr><td><code id="diffMap_+3A_label">label</code></td>
<td>
<p>Column to be used as the HTML content for hover-over labels.
Labels are useful for the same reasons as popups, though are typically
shorter.</p>
</td></tr>
<tr><td><code id="diffMap_+3A_provider">provider</code></td>
<td>
<p>The base map(s) to be used. See
<a href="http://leaflet-extras.github.io/leaflet-providers/preview/">http://leaflet-extras.github.io/leaflet-providers/preview/</a> for a list of
all base maps that can be used. If multiple base maps are provided, they
can be toggled between using a &quot;layer control&quot; interface. By default, the
interface will use the provider names as labels, but users can define their
own using a named vector (e.g., <code>c("Default" = "OpenStreetMap", "Satellite" = "Esri.WorldImagery")</code>)</p>
</td></tr>
<tr><td><code id="diffMap_+3A_cols">cols</code></td>
<td>
<p>The colours used for plotting. It is recommended to use a
&quot;diverging&quot; colour palette (along with a symmetrical limit scale) for
effective visualisation.</p>
</td></tr>
<tr><td><code id="diffMap_+3A_alpha">alpha</code></td>
<td>
<p>The alpha transparency to use for the plotting surface (a value
between 0 and 1 with zero being fully transparent and 1 fully opaque).</p>
</td></tr>
<tr><td><code id="diffMap_+3A_key">key</code></td>
<td>
<p>Should a key for each marker be drawn? Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="diffMap_+3A_draw.legend">draw.legend</code></td>
<td>
<p>When <code>limits</code> are specified, should a shared legend be
created at the side of the map? Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="diffMap_+3A_collapse.control">collapse.control</code></td>
<td>
<p>Should the &quot;layer control&quot; interface be collapsed?
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="diffMap_+3A_d.icon">d.icon</code></td>
<td>
<p>The diameter of the plot on the map in pixels. This will affect
the size of the individual polar markers. Alternatively, a vector in the
form <code>c(width, height)</code> can be provided if a non-circular marker is
desired.</p>
</td></tr>
<tr><td><code id="diffMap_+3A_d.fig">d.fig</code></td>
<td>
<p>The diameter of the plots to be produced using <code>openair</code> in
inches. This will affect the resolution of the markers on the map.
Alternatively, a vector in the form <code>c(width, height)</code> can be provided if a
non-circular marker is desired.</p>
</td></tr>
<tr><td><code id="diffMap_+3A_type">type</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>. Different sites are now
automatically detected based on latitude and longitude. Please use <code>label</code>
and/or <code>popup</code> to label different sites.</p>
</td></tr>
<tr><td><code id="diffMap_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="openair.html#topic+polarPlot">openair::polarPlot</a></code>
</p>

<dl>
<dt><code>wd</code></dt><dd><p>Name of wind direction field.</p>
</dd>
<dt><code>statistic</code></dt><dd><p>The statistic that should be applied to each wind
speed/direction bin. Because of the smoothing involved, the colour scale
for some of these statistics is only to provide an indication of overall
pattern and should not be interpreted in concentration units e.g. for
<code>statistic = "weighted.mean"</code> where the bin mean is multiplied by the
bin frequency and divided by the total frequency. In many cases using
<code>polarFreq</code> will be better. Setting <code>statistic = "weighted.mean"</code>
can be useful because it provides an indication of the concentration *
frequency of occurrence and will highlight the wind speed/direction
conditions that dominate the overall mean.Can be:
</p>
 <ul>
<li>  <p>&ldquo;mean&rdquo; (default), &ldquo;median&rdquo;, &ldquo;max&rdquo;
(maximum), &ldquo;frequency&rdquo;. &ldquo;stdev&rdquo; (standard deviation),
&ldquo;weighted.mean&rdquo;.
</p>
</li>
<li> <p><code>statistic = "nwr"</code> Implements the Non-parametric Wind
Regression approach of Henry et al. (2009) that uses kernel smoothers. The
<code>openair</code> implementation is not identical because Gaussian kernels are
used for both wind direction and speed. The smoothing is controlled by
<code>ws_spread</code> and <code>wd_spread</code>.
</p>
</li>
<li> <p><code>statistic = "cpf"</code> the conditional probability function (CPF)
is plotted and a single (usually high) percentile level is supplied. The
CPF is defined as CPF = my/ny, where my is the number of samples in the y
bin (by default a wind direction, wind speed interval) with mixing ratios
greater than the <em>overall</em> percentile concentration, and ny is the
total number of samples in the same wind sector (see Ashbaugh et al.,
1985). Note that percentile intervals can also be considered; see
<code>percentile</code> for details.
</p>
</li>
<li><p> When <code>statistic = "r"</code> or <code>statistic = "Pearson"</code>, the
Pearson correlation coefficient is calculated for <em>two</em> pollutants.
The calculation involves a weighted Pearson correlation coefficient, which
is weighted by Gaussian kernels for wind direction an the radial variable
(by default wind speed). More weight is assigned to values close to a wind
speed-direction interval. Kernel weighting is used to ensure that all data
are used rather than relying on the potentially small number of values in a
wind speed-direction interval.
</p>
</li>
<li><p> When <code>statistic = "Spearman"</code>, the Spearman correlation
coefficient is calculated for <em>two</em> pollutants. The calculation
involves a weighted Spearman correlation coefficient, which is weighted by
Gaussian kernels for wind direction an the radial variable (by default wind
speed). More weight is assigned to values close to a wind speed-direction
interval. Kernel weighting is used to ensure that all data are used rather
than relying on the potentially small number of values in a wind
speed-direction interval.
</p>
</li>
<li> <p><code>"robust_slope"</code> is another option for pair-wise statistics and
<code>"quantile.slope"</code>, which uses quantile regression to estimate the
slope for a particular quantile level (see also <code>tau</code> for setting the
quantile level).
</p>
</li>
<li> <p><code>"york_slope"</code> is another option for pair-wise statistics which
uses the <em>York regression method</em> to estimate the slope. In this
method the uncertainties in <code>x</code> and <code>y</code> are used in the
determination of the slope. The uncertainties are provided by
<code>x_error</code> and <code>y_error</code> &mdash; see below.</p>
</li></ul>
</dd>
<dt><code>exclude.missing</code></dt><dd><p>Setting this option to <code>TRUE</code> (the default)
removes points from the plot that are too far from the original data. The
smoothing routines will produce predictions at points where no data exist
i.e. they predict. By removing the points too far from the original data
produces a plot where it is clear where the original data lie. If set to
<code>FALSE</code> missing data will be interpolated.</p>
</dd>
<dt><code>uncertainty</code></dt><dd><p>Should the uncertainty in the calculated surface be shown?
If <code>TRUE</code> three plots are produced on the same scale showing the
predicted surface together with the estimated lower and upper uncertainties
at the 95% confidence interval. Calculating the uncertainties is useful to
understand whether features are real or not.  For example, at high wind
speeds where there are few data there is greater uncertainty over the
predicted values. The uncertainties are calculated using the GAM and
weighting is done by the frequency of measurements in each wind
speed-direction bin. Note that if uncertainties are calculated then the
type is set to &quot;default&quot;.</p>
</dd>
<dt><code>percentile</code></dt><dd><p>If <code>statistic = "percentile"</code> then <code>percentile</code>
is used, expressed from 0 to 100. Note that the percentile value is
calculated in the wind speed, wind direction &lsquo;bins&rsquo;. For this reason
it can also be useful to set <code>min.bin</code> to ensure there are a
sufficient number of points available to estimate a percentile. See
<code>quantile</code> for more details of how percentiles are calculated.
</p>
<p><code>percentile</code> is also used for the Conditional Probability Function
(CPF) plots. <code>percentile</code> can be of length two, in which case the
percentile <em>interval</em> is considered for use with CPF. For example,
<code>percentile = c(90, 100)</code> will plot the CPF for concentrations between
the 90 and 100th percentiles. Percentile intervals can be useful for
identifying specific sources. In addition, <code>percentile</code> can also be of
length 3. The third value is the &lsquo;trim&rsquo; value to be applied. When
calculating percentile intervals many can cover very low values where there
is no useful information. The trim value ensures that values greater than
or equal to the trim * mean value are considered <em>before</em> the
percentile intervals are calculated. The effect is to extract more detail
from many source signatures. See the manual for examples. Finally, if the
trim value is less than zero the percentile range is interpreted as
absolute concentration values and subsetting is carried out directly.</p>
</dd>
<dt><code>weights</code></dt><dd><p>At the edges of the plot there may only be a few data points
in each wind speed-direction interval, which could in some situations
distort the plot if the concentrations are high. <code>weights</code> applies a
weighting to reduce their influence. For example and by default if only a
single data point exists then the weighting factor is 0.25 and for two
points 0.5. To not apply any weighting and use the data as is, use
<code>weights = c(1, 1, 1)</code>.
</p>
<p>An alternative to down-weighting these points they can be removed
altogether using <code>min.bin</code>.</p>
</dd>
<dt><code>min.bin</code></dt><dd><p>The minimum number of points allowed in a wind speed/wind
direction bin.  The default is 1. A value of two requires at least 2 valid
records in each bin an so on; bins with less than 2 valid records are set
to NA. Care should be taken when using a value &gt; 1 because of the risk of
removing real data points. It is recommended to consider your data with
care. Also, the <code>polarFreq</code> function can be of use in such
circumstances.</p>
</dd>
<dt><code>mis.col</code></dt><dd><p>When <code>min.bin</code> is &gt; 1 it can be useful to show where data
are removed on the plots. This is done by shading the missing data in
<code>mis.col</code>. To not highlight missing data when <code>min.bin</code> &gt; 1
choose <code>mis.col = "transparent"</code>.</p>
</dd>
<dt><code>upper</code></dt><dd><p>This sets the upper limit wind speed to be used. Often there are
only a relatively few data points at very high wind speeds and plotting all
of them can reduce the useful information in the plot.</p>
</dd>
<dt><code>force.positive</code></dt><dd><p>The default is <code>TRUE</code>. Sometimes if smoothing data
with steep gradients it is possible for predicted values to be negative.
<code>force.positive = TRUE</code> ensures that predictions remain positive. This
is useful for several reasons. First, with lots of missing data more
interpolation is needed and this can result in artefacts because the
predictions are too far from the original data. Second, if it is known
beforehand that the data are all positive, then this option carries that
assumption through to the prediction. The only likely time where setting
<code>force.positive = FALSE</code> would be if background concentrations were
first subtracted resulting in data that is legitimately negative. For the
vast majority of situations it is expected that the user will not need to
alter the default option.</p>
</dd>
<dt><code>k</code></dt><dd><p>This is the smoothing parameter used by the <code>gam</code> function in
package <code>mgcv</code>. Typically, value of around 100 (the default) seems to
be suitable and will resolve important features in the plot. The most
appropriate choice of <code>k</code> is problem-dependent; but extensive testing
of polar plots for many different problems suggests a value of <code>k</code> of
about 100 is suitable. Setting <code>k</code> to higher values will not tend to
affect the surface predictions by much but will add to the computation
time. Lower values of <code>k</code> will increase smoothing. Sometimes with few
data to plot <code>polarPlot</code> will fail. Under these circumstances it can
be worth lowering the value of <code>k</code>.</p>
</dd>
<dt><code>normalise</code></dt><dd><p>If <code>TRUE</code> concentrations are normalised by dividing by
their mean value. This is done <em>after</em> fitting the smooth surface.
This option is particularly useful if one is interested in the patterns of
concentrations for several pollutants on different scales e.g. NOx and CO.
Often useful if more than one <code>pollutant</code> is chosen.</p>
</dd>
<dt><code>auto.text</code></dt><dd><p>Either <code>TRUE</code> (default) or <code>FALSE</code>. If <code>TRUE</code>
titles and axis labels will automatically try and format pollutant names
and units properly e.g.  by subscripting the &lsquo;2&rsquo; in NO2.</p>
</dd>
<dt><code>ws_spread</code></dt><dd><p>The value of sigma used for Gaussian kernel weighting of
wind speed when <code>statistic = "nwr"</code> or when correlation and regression
statistics are used such as <em>r</em>. Default is <code>0.5</code>.</p>
</dd>
<dt><code>wd_spread</code></dt><dd><p>The value of sigma used for Gaussian kernel weighting of
wind direction when <code>statistic = "nwr"</code> or when correlation and
regression statistics are used such as <em>r</em>. Default is <code>4</code>.</p>
</dd>
<dt><code>x_error</code></dt><dd><p>The <code>x</code> error / uncertainty used when <code>statistic =
"york_slope"</code>.</p>
</dd>
<dt><code>y_error</code></dt><dd><p>The <code>y</code> error / uncertainty used when <code>statistic =
"york_slope"</code>.</p>
</dd>
<dt><code>kernel</code></dt><dd><p>Type of kernel used for the weighting procedure for when
correlation or regression techniques are used. Only <code>"gaussian"</code> is
supported but this may be enhanced in the future.</p>
</dd>
<dt><code>formula.label</code></dt><dd><p>When pair-wise statistics such as regression slopes are
calculated and plotted, should a formula label be displayed?</p>
</dd>
<dt><code>tau</code></dt><dd><p>The quantile to be estimated when <code>statistic</code> is set to
<code>"quantile.slope"</code>. Default is <code>0.5</code> which is equal to the median
and will be ignored if <code>"quantile.slope"</code> is not used.</p>
</dd>
<dt><code>plot</code></dt><dd><p>Should a plot be produced? <code>FALSE</code> can be useful when
analysing data to extract plot components and plotting them in other ways.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>A leaflet object.
</p>


<h3>See Also</h3>

<p>the original <code><a href="openair.html#topic+polarDiff">openair::polarDiff()</a></code>
</p>
<p><code><a href="#topic+diffMapStatic">diffMapStatic()</a></code> for the static <code>ggmap</code> equivalent of <code><a href="#topic+diffMap">diffMap()</a></code>
</p>
<p>Other interactive directional analysis maps: 
<code><a href="#topic+annulusMap">annulusMap</a>()</code>,
<code><a href="#topic+freqMap">freqMap</a>()</code>,
<code><a href="#topic+percentileMap">percentileMap</a>()</code>,
<code><a href="#topic+polarMap">polarMap</a>()</code>,
<code><a href="#topic+pollroseMap">pollroseMap</a>()</code>,
<code><a href="#topic+windroseMap">windroseMap</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# NB: "after" is some dummy data to demonstrate functionality
diffMap(
  before = polar_data,
  after = dplyr::mutate(polar_data, nox = jitter(nox, factor = 5)),
  pollutant = "nox",
  provider = "Stamen.Toner"
)

## End(Not run)
</code></pre>

<hr>
<h2 id='diffMapStatic'>Bivariate polar plots on a static ggmap</h2><span id='topic+diffMapStatic'></span>

<h3>Description</h3>

<p><code><a href="#topic+diffMapStatic">diffMapStatic()</a></code> creates a <code>ggplot2</code> map using bivariate &quot;difference&quot; polar
plots as markers. As this function returns a <code>ggplot2</code> object, further
customisation can be achieved using functions like <code><a href="ggplot2.html#topic+theme">ggplot2::theme()</a></code> and
<code><a href="ggplot2.html#topic+guides">ggplot2::guides()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>diffMapStatic(
  before,
  after,
  pollutant = NULL,
  ggmap,
  limits = "free",
  x = "ws",
  latitude = NULL,
  longitude = NULL,
  facet = NULL,
  cols = c("#002F70", "#3167BB", "#879FDB", "#C8D2F1", "#F6F6F6", "#F4C8C8", "#DA8A8B",
    "#AE4647", "#5F1415"),
  alpha = 1,
  key = FALSE,
  facet.nrow = NULL,
  d.icon = 150,
  d.fig = 3,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="diffMapStatic_+3A_before">before</code></td>
<td>
<p>A data frame that represents the &quot;before&quot; case. See
<code><a href="openair.html#topic+polarPlot">polarPlot()</a></code> for details of different input requirements.</p>
</td></tr>
<tr><td><code id="diffMapStatic_+3A_after">after</code></td>
<td>
<p>A data frame that represents the &quot;after&quot; case. See <code><a href="openair.html#topic+polarPlot">polarPlot()</a></code>
for details of different input requirements.</p>
</td></tr>
<tr><td><code id="diffMapStatic_+3A_pollutant">pollutant</code></td>
<td>
<p>The column name(s) of the pollutant(s) to plot. If multiple
pollutants are specified, they will each form part of a separate panel.</p>
</td></tr>
<tr><td><code id="diffMapStatic_+3A_ggmap">ggmap</code></td>
<td>
<p>A <code>ggmap</code> object obtained using <code><a href="ggmap.html#topic+get_map">ggmap::get_map()</a></code> or a similar
function to use as the basemap.</p>
</td></tr>
<tr><td><code id="diffMapStatic_+3A_limits">limits</code></td>
<td>
<p>One of:
</p>

<ul>
<li> <p><code>"fixed"</code> which ensures all of the markers use the same colour scale.
</p>
</li>
<li> <p><code>"free"</code> (the default) which allows all of the markers to use different
colour scales.
</p>
</li>
<li><p> A numeric vector in the form <code>c(lower, upper)</code> used to define the colour
scale. For example, <code>limits = c(0, 100)</code> would force the plot limits to
span 0-100.
</p>
</li></ul>
</td></tr>
<tr><td><code id="diffMapStatic_+3A_x">x</code></td>
<td>
<p>The radial axis variable to plot.</p>
</td></tr>
<tr><td><code id="diffMapStatic_+3A_latitude">latitude</code>, <code id="diffMapStatic_+3A_longitude">longitude</code></td>
<td>
<p>The decimal latitude/longitude. If not provided,
will be automatically inferred from data by looking for a column named
&quot;lat&quot;/&quot;latitude&quot; or &quot;lon&quot;/&quot;lng&quot;/&quot;long&quot;/&quot;longitude&quot; (case-insensitively).</p>
</td></tr>
<tr><td><code id="diffMapStatic_+3A_facet">facet</code></td>
<td>
<p>Used for splitting the input data into different panels, passed
to the <code>type</code> argument of <code><a href="openair.html#topic+cutData">openair::cutData()</a></code>. <code>facet</code> cannot be used if
multiple <code>pollutant</code> columns have been provided.</p>
</td></tr>
<tr><td><code id="diffMapStatic_+3A_cols">cols</code></td>
<td>
<p>The colours used for plotting. See <code><a href="openair.html#topic+openColours">openair::openColours()</a></code> for
more information.</p>
</td></tr>
<tr><td><code id="diffMapStatic_+3A_alpha">alpha</code></td>
<td>
<p>The alpha transparency to use for the plotting surface (a value
between 0 and 1 with zero being fully transparent and 1 fully opaque).</p>
</td></tr>
<tr><td><code id="diffMapStatic_+3A_key">key</code></td>
<td>
<p>Should a key for each marker be drawn? Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="diffMapStatic_+3A_facet.nrow">facet.nrow</code></td>
<td>
<p>Passed to the <code>nrow</code> argument of <code><a href="ggplot2.html#topic+facet_wrap">ggplot2::facet_wrap()</a></code>.</p>
</td></tr>
<tr><td><code id="diffMapStatic_+3A_d.icon">d.icon</code></td>
<td>
<p>The diameter of the plot on the map in pixels. This will affect
the size of the individual polar markers. Alternatively, a vector in the
form <code>c(width, height)</code> can be provided if a non-circular marker is
desired.</p>
</td></tr>
<tr><td><code id="diffMapStatic_+3A_d.fig">d.fig</code></td>
<td>
<p>The diameter of the plots to be produced using <code>openair</code> in
inches. This will affect the resolution of the markers on the map.
Alternatively, a vector in the form <code>c(width, height)</code> can be provided if a
non-circular marker is desired.</p>
</td></tr>
<tr><td><code id="diffMapStatic_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="openair.html#topic+polarPlot">openair::polarPlot</a></code>
</p>

<dl>
<dt><code>wd</code></dt><dd><p>Name of wind direction field.</p>
</dd>
<dt><code>statistic</code></dt><dd><p>The statistic that should be applied to each wind
speed/direction bin. Because of the smoothing involved, the colour scale
for some of these statistics is only to provide an indication of overall
pattern and should not be interpreted in concentration units e.g. for
<code>statistic = "weighted.mean"</code> where the bin mean is multiplied by the
bin frequency and divided by the total frequency. In many cases using
<code>polarFreq</code> will be better. Setting <code>statistic = "weighted.mean"</code>
can be useful because it provides an indication of the concentration *
frequency of occurrence and will highlight the wind speed/direction
conditions that dominate the overall mean.Can be:
</p>
 <ul>
<li>  <p>&ldquo;mean&rdquo; (default), &ldquo;median&rdquo;, &ldquo;max&rdquo;
(maximum), &ldquo;frequency&rdquo;. &ldquo;stdev&rdquo; (standard deviation),
&ldquo;weighted.mean&rdquo;.
</p>
</li>
<li> <p><code>statistic = "nwr"</code> Implements the Non-parametric Wind
Regression approach of Henry et al. (2009) that uses kernel smoothers. The
<code>openair</code> implementation is not identical because Gaussian kernels are
used for both wind direction and speed. The smoothing is controlled by
<code>ws_spread</code> and <code>wd_spread</code>.
</p>
</li>
<li> <p><code>statistic = "cpf"</code> the conditional probability function (CPF)
is plotted and a single (usually high) percentile level is supplied. The
CPF is defined as CPF = my/ny, where my is the number of samples in the y
bin (by default a wind direction, wind speed interval) with mixing ratios
greater than the <em>overall</em> percentile concentration, and ny is the
total number of samples in the same wind sector (see Ashbaugh et al.,
1985). Note that percentile intervals can also be considered; see
<code>percentile</code> for details.
</p>
</li>
<li><p> When <code>statistic = "r"</code> or <code>statistic = "Pearson"</code>, the
Pearson correlation coefficient is calculated for <em>two</em> pollutants.
The calculation involves a weighted Pearson correlation coefficient, which
is weighted by Gaussian kernels for wind direction an the radial variable
(by default wind speed). More weight is assigned to values close to a wind
speed-direction interval. Kernel weighting is used to ensure that all data
are used rather than relying on the potentially small number of values in a
wind speed-direction interval.
</p>
</li>
<li><p> When <code>statistic = "Spearman"</code>, the Spearman correlation
coefficient is calculated for <em>two</em> pollutants. The calculation
involves a weighted Spearman correlation coefficient, which is weighted by
Gaussian kernels for wind direction an the radial variable (by default wind
speed). More weight is assigned to values close to a wind speed-direction
interval. Kernel weighting is used to ensure that all data are used rather
than relying on the potentially small number of values in a wind
speed-direction interval.
</p>
</li>
<li> <p><code>"robust_slope"</code> is another option for pair-wise statistics and
<code>"quantile.slope"</code>, which uses quantile regression to estimate the
slope for a particular quantile level (see also <code>tau</code> for setting the
quantile level).
</p>
</li>
<li> <p><code>"york_slope"</code> is another option for pair-wise statistics which
uses the <em>York regression method</em> to estimate the slope. In this
method the uncertainties in <code>x</code> and <code>y</code> are used in the
determination of the slope. The uncertainties are provided by
<code>x_error</code> and <code>y_error</code> &mdash; see below.</p>
</li></ul>
</dd>
<dt><code>exclude.missing</code></dt><dd><p>Setting this option to <code>TRUE</code> (the default)
removes points from the plot that are too far from the original data. The
smoothing routines will produce predictions at points where no data exist
i.e. they predict. By removing the points too far from the original data
produces a plot where it is clear where the original data lie. If set to
<code>FALSE</code> missing data will be interpolated.</p>
</dd>
<dt><code>uncertainty</code></dt><dd><p>Should the uncertainty in the calculated surface be shown?
If <code>TRUE</code> three plots are produced on the same scale showing the
predicted surface together with the estimated lower and upper uncertainties
at the 95% confidence interval. Calculating the uncertainties is useful to
understand whether features are real or not.  For example, at high wind
speeds where there are few data there is greater uncertainty over the
predicted values. The uncertainties are calculated using the GAM and
weighting is done by the frequency of measurements in each wind
speed-direction bin. Note that if uncertainties are calculated then the
type is set to &quot;default&quot;.</p>
</dd>
<dt><code>percentile</code></dt><dd><p>If <code>statistic = "percentile"</code> then <code>percentile</code>
is used, expressed from 0 to 100. Note that the percentile value is
calculated in the wind speed, wind direction &lsquo;bins&rsquo;. For this reason
it can also be useful to set <code>min.bin</code> to ensure there are a
sufficient number of points available to estimate a percentile. See
<code>quantile</code> for more details of how percentiles are calculated.
</p>
<p><code>percentile</code> is also used for the Conditional Probability Function
(CPF) plots. <code>percentile</code> can be of length two, in which case the
percentile <em>interval</em> is considered for use with CPF. For example,
<code>percentile = c(90, 100)</code> will plot the CPF for concentrations between
the 90 and 100th percentiles. Percentile intervals can be useful for
identifying specific sources. In addition, <code>percentile</code> can also be of
length 3. The third value is the &lsquo;trim&rsquo; value to be applied. When
calculating percentile intervals many can cover very low values where there
is no useful information. The trim value ensures that values greater than
or equal to the trim * mean value are considered <em>before</em> the
percentile intervals are calculated. The effect is to extract more detail
from many source signatures. See the manual for examples. Finally, if the
trim value is less than zero the percentile range is interpreted as
absolute concentration values and subsetting is carried out directly.</p>
</dd>
<dt><code>weights</code></dt><dd><p>At the edges of the plot there may only be a few data points
in each wind speed-direction interval, which could in some situations
distort the plot if the concentrations are high. <code>weights</code> applies a
weighting to reduce their influence. For example and by default if only a
single data point exists then the weighting factor is 0.25 and for two
points 0.5. To not apply any weighting and use the data as is, use
<code>weights = c(1, 1, 1)</code>.
</p>
<p>An alternative to down-weighting these points they can be removed
altogether using <code>min.bin</code>.</p>
</dd>
<dt><code>min.bin</code></dt><dd><p>The minimum number of points allowed in a wind speed/wind
direction bin.  The default is 1. A value of two requires at least 2 valid
records in each bin an so on; bins with less than 2 valid records are set
to NA. Care should be taken when using a value &gt; 1 because of the risk of
removing real data points. It is recommended to consider your data with
care. Also, the <code>polarFreq</code> function can be of use in such
circumstances.</p>
</dd>
<dt><code>mis.col</code></dt><dd><p>When <code>min.bin</code> is &gt; 1 it can be useful to show where data
are removed on the plots. This is done by shading the missing data in
<code>mis.col</code>. To not highlight missing data when <code>min.bin</code> &gt; 1
choose <code>mis.col = "transparent"</code>.</p>
</dd>
<dt><code>upper</code></dt><dd><p>This sets the upper limit wind speed to be used. Often there are
only a relatively few data points at very high wind speeds and plotting all
of them can reduce the useful information in the plot.</p>
</dd>
<dt><code>force.positive</code></dt><dd><p>The default is <code>TRUE</code>. Sometimes if smoothing data
with steep gradients it is possible for predicted values to be negative.
<code>force.positive = TRUE</code> ensures that predictions remain positive. This
is useful for several reasons. First, with lots of missing data more
interpolation is needed and this can result in artefacts because the
predictions are too far from the original data. Second, if it is known
beforehand that the data are all positive, then this option carries that
assumption through to the prediction. The only likely time where setting
<code>force.positive = FALSE</code> would be if background concentrations were
first subtracted resulting in data that is legitimately negative. For the
vast majority of situations it is expected that the user will not need to
alter the default option.</p>
</dd>
<dt><code>k</code></dt><dd><p>This is the smoothing parameter used by the <code>gam</code> function in
package <code>mgcv</code>. Typically, value of around 100 (the default) seems to
be suitable and will resolve important features in the plot. The most
appropriate choice of <code>k</code> is problem-dependent; but extensive testing
of polar plots for many different problems suggests a value of <code>k</code> of
about 100 is suitable. Setting <code>k</code> to higher values will not tend to
affect the surface predictions by much but will add to the computation
time. Lower values of <code>k</code> will increase smoothing. Sometimes with few
data to plot <code>polarPlot</code> will fail. Under these circumstances it can
be worth lowering the value of <code>k</code>.</p>
</dd>
<dt><code>normalise</code></dt><dd><p>If <code>TRUE</code> concentrations are normalised by dividing by
their mean value. This is done <em>after</em> fitting the smooth surface.
This option is particularly useful if one is interested in the patterns of
concentrations for several pollutants on different scales e.g. NOx and CO.
Often useful if more than one <code>pollutant</code> is chosen.</p>
</dd>
<dt><code>auto.text</code></dt><dd><p>Either <code>TRUE</code> (default) or <code>FALSE</code>. If <code>TRUE</code>
titles and axis labels will automatically try and format pollutant names
and units properly e.g.  by subscripting the &lsquo;2&rsquo; in NO2.</p>
</dd>
<dt><code>ws_spread</code></dt><dd><p>The value of sigma used for Gaussian kernel weighting of
wind speed when <code>statistic = "nwr"</code> or when correlation and regression
statistics are used such as <em>r</em>. Default is <code>0.5</code>.</p>
</dd>
<dt><code>wd_spread</code></dt><dd><p>The value of sigma used for Gaussian kernel weighting of
wind direction when <code>statistic = "nwr"</code> or when correlation and
regression statistics are used such as <em>r</em>. Default is <code>4</code>.</p>
</dd>
<dt><code>x_error</code></dt><dd><p>The <code>x</code> error / uncertainty used when <code>statistic =
"york_slope"</code>.</p>
</dd>
<dt><code>y_error</code></dt><dd><p>The <code>y</code> error / uncertainty used when <code>statistic =
"york_slope"</code>.</p>
</dd>
<dt><code>kernel</code></dt><dd><p>Type of kernel used for the weighting procedure for when
correlation or regression techniques are used. Only <code>"gaussian"</code> is
supported but this may be enhanced in the future.</p>
</dd>
<dt><code>formula.label</code></dt><dd><p>When pair-wise statistics such as regression slopes are
calculated and plotted, should a formula label be displayed?</p>
</dd>
<dt><code>tau</code></dt><dd><p>The quantile to be estimated when <code>statistic</code> is set to
<code>"quantile.slope"</code>. Default is <code>0.5</code> which is equal to the median
and will be ignored if <code>"quantile.slope"</code> is not used.</p>
</dd>
<dt><code>plot</code></dt><dd><p>Should a plot be produced? <code>FALSE</code> can be useful when
analysing data to extract plot components and plotting them in other ways.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>ggplot2</code> plot with a <code>ggmap</code> basemap
</p>


<h3>Further customisation using ggplot2</h3>

<p>As the outputs of the static directional analysis functions are <code>ggplot2</code>
figures, further customisation is possible using functions such as
<code><a href="ggplot2.html#topic+theme">ggplot2::theme()</a></code>, <code><a href="ggplot2.html#topic+guides">ggplot2::guides()</a></code> and <code><a href="ggplot2.html#topic+labs">ggplot2::labs()</a></code>.
</p>
<p>If multiple pollutants are specified, subscripting (e.g., the &quot;x&quot; in &quot;NOx&quot;)
is achieved using the <a href="ggtext.html#topic+ggtext">ggtext</a> package. Therefore if you
choose to override the plot theme, it is recommended to use
<code style="white-space: pre;">&#8288;[ggplot2::theme()]&#8288;</code> and <code style="white-space: pre;">&#8288;[ggtext::element_markdown()]&#8288;</code> to define the
<code>strip.text</code> parameter.
</p>
<p>When arguments like <code>limits</code>, <code>percentile</code> or <code>breaks</code> are defined, a
legend is automatically added to the figure. Legends can be removed using
<code>ggplot2::theme(legend.position = "none")</code>, or further customised using
<code><a href="ggplot2.html#topic+guides">ggplot2::guides()</a></code> and either <code>color = ggplot2::guide_colourbar()</code> for
continuous legends or <code>fill = ggplot2::guide_legend()</code> for discrete
legends.
</p>


<h3>See Also</h3>

<p>the original <code><a href="openair.html#topic+polarDiff">openair::polarDiff()</a></code>
</p>
<p><code><a href="#topic+diffMap">diffMap()</a></code> for the interactive <code>leaflet</code> equivalent of
<code><a href="#topic+diffMapStatic">diffMapStatic()</a></code>
</p>
<p>Other static directional analysis maps: 
<code><a href="#topic+annulusMapStatic">annulusMapStatic</a>()</code>,
<code><a href="#topic+freqMapStatic">freqMapStatic</a>()</code>,
<code><a href="#topic+percentileMapStatic">percentileMapStatic</a>()</code>,
<code><a href="#topic+polarMapStatic">polarMapStatic</a>()</code>,
<code><a href="#topic+pollroseMapStatic">pollroseMapStatic</a>()</code>,
<code><a href="#topic+windroseMapStatic">windroseMapStatic</a>()</code>
</p>

<hr>
<h2 id='freqMap'>Polar frequency plots on interactive leaflet maps</h2><span id='topic+freqMap'></span>

<h3>Description</h3>

<p><code><a href="#topic+freqMap">freqMap()</a></code> creates a <code>leaflet</code> map using binned polar plots as markers. Any
number of pollutants can be specified using the <code>pollutant</code> argument, and
multiple layers of markers can be added and toggled between using <code>control</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>freqMap(
  data,
  pollutant = NULL,
  statistic = "mean",
  breaks = "free",
  latitude = NULL,
  longitude = NULL,
  control = NULL,
  popup = NULL,
  label = NULL,
  provider = "OpenStreetMap",
  cols = "turbo",
  alpha = 1,
  key = FALSE,
  draw.legend = TRUE,
  collapse.control = FALSE,
  d.icon = 200,
  d.fig = 3.5,
  type = deprecated(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="freqMap_+3A_data">data</code></td>
<td>
<p>A data frame. The data frame must contain the data to plot the
directional analysis marker, which includes wind speed (<code>ws</code>), wind
direction (<code>wd</code>), and the column representing the concentration of a
pollutant. In addition, <code>data</code> must include a decimal latitude and
longitude.</p>
</td></tr>
<tr><td><code id="freqMap_+3A_pollutant">pollutant</code></td>
<td>
<p>The column name(s) of the pollutant(s) to plot. If multiple
pollutants are specified, they can be toggled between using a &quot;layer
control&quot; interface.</p>
</td></tr>
<tr><td><code id="freqMap_+3A_statistic">statistic</code></td>
<td>
<p>The statistic that should be applied to each wind
speed/direction bin. Can be &quot;frequency&quot;, &quot;mean&quot;, &quot;median&quot;, &quot;max&quot; (maximum),
&quot;stdev&quot; (standard deviation) or &quot;weighted.mean&quot;. The option &quot;frequency&quot; is
the simplest and plots the frequency of wind speed/direction in different
bins. The scale therefore shows the counts in each bin. The option &quot;mean&quot;
(the default) will plot the mean concentration of a pollutant (see next
point) in wind speed/direction bins, and so on.  Finally, &quot;weighted.mean&quot;
will plot the concentration of a pollutant weighted by wind
speed/direction. Each segment therefore provides the percentage overall
contribution to the total concentration. Note that for options other than
&quot;frequency&quot;, it is necessary to also provide the name of a pollutant. See
function <code><a href="openair.html#topic+cutData">openair::cutData()</a></code> for further details.</p>
</td></tr>
<tr><td><code id="freqMap_+3A_breaks">breaks</code></td>
<td>
<p>One of:
</p>

<ul>
<li> <p><code>"fixed"</code> which ensures all of the markers use the same colour scale.
</p>
</li>
<li> <p><code>"free"</code> (the default) which allows all of the markers to use different
colour scales.
</p>
</li>
<li><p> A numeric vector defining a sequence of numbers to use as the breaks. The
sequence could represent one with equal spacing, e.g., <code>breaks = seq(0, 100, 10)</code> - a scale from 0-10 in intervals of 10, or a more flexible
sequence, e.g., <code>breaks = c(0, 1, 5, 7, 10)</code>, which may be useful for some
situations.
</p>
</li></ul>
</td></tr>
<tr><td><code id="freqMap_+3A_latitude">latitude</code>, <code id="freqMap_+3A_longitude">longitude</code></td>
<td>
<p>The decimal latitude/longitude. If not provided,
will be automatically inferred from data by looking for a column named
&quot;lat&quot;/&quot;latitude&quot; or &quot;lon&quot;/&quot;lng&quot;/&quot;long&quot;/&quot;longitude&quot; (case-insensitively).</p>
</td></tr>
<tr><td><code id="freqMap_+3A_control">control</code></td>
<td>
<p>Used for splitting the input data into different groups which
can be selected between using a &quot;layer control&quot; interface, passed to the
<code>type</code> argument of <code><a href="openair.html#topic+cutData">openair::cutData()</a></code>. <code>control</code> cannot be used if
multiple <code>pollutant</code> columns have been provided.</p>
</td></tr>
<tr><td><code id="freqMap_+3A_popup">popup</code></td>
<td>
<p>Columns to be used as the HTML content for marker popups. Popups
may be useful to show information about the individual sites (e.g., site
names, codes, types, etc.). If a vector of column names are provided they
are passed to <code><a href="#topic+buildPopup">buildPopup()</a></code> using its default values.</p>
</td></tr>
<tr><td><code id="freqMap_+3A_label">label</code></td>
<td>
<p>Column to be used as the HTML content for hover-over labels.
Labels are useful for the same reasons as popups, though are typically
shorter.</p>
</td></tr>
<tr><td><code id="freqMap_+3A_provider">provider</code></td>
<td>
<p>The base map(s) to be used. See
<a href="http://leaflet-extras.github.io/leaflet-providers/preview/">http://leaflet-extras.github.io/leaflet-providers/preview/</a> for a list of
all base maps that can be used. If multiple base maps are provided, they
can be toggled between using a &quot;layer control&quot; interface. By default, the
interface will use the provider names as labels, but users can define their
own using a named vector (e.g., <code>c("Default" = "OpenStreetMap", "Satellite" = "Esri.WorldImagery")</code>)</p>
</td></tr>
<tr><td><code id="freqMap_+3A_cols">cols</code></td>
<td>
<p>The colours used for plotting. See <code><a href="openair.html#topic+openColours">openair::openColours()</a></code> for
more information.</p>
</td></tr>
<tr><td><code id="freqMap_+3A_alpha">alpha</code></td>
<td>
<p>The alpha transparency to use for the plotting surface (a value
between 0 and 1 with zero being fully transparent and 1 fully opaque).</p>
</td></tr>
<tr><td><code id="freqMap_+3A_key">key</code></td>
<td>
<p>Should a key for each marker be drawn? Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="freqMap_+3A_draw.legend">draw.legend</code></td>
<td>
<p>When <code>breaks</code> are specified, should a shared legend be
created at the side of the map? Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="freqMap_+3A_collapse.control">collapse.control</code></td>
<td>
<p>Should the &quot;layer control&quot; interface be collapsed?
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="freqMap_+3A_d.icon">d.icon</code></td>
<td>
<p>The diameter of the plot on the map in pixels. This will affect
the size of the individual polar markers. Alternatively, a vector in the
form <code>c(width, height)</code> can be provided if a non-circular marker is
desired.</p>
</td></tr>
<tr><td><code id="freqMap_+3A_d.fig">d.fig</code></td>
<td>
<p>The diameter of the plots to be produced using <code>openair</code> in
inches. This will affect the resolution of the markers on the map.
Alternatively, a vector in the form <code>c(width, height)</code> can be provided if a
non-circular marker is desired.</p>
</td></tr>
<tr><td><code id="freqMap_+3A_type">type</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>. Different sites are now
automatically detected based on latitude and longitude. Please use <code>label</code>
and/or <code>popup</code> to label different sites.</p>
</td></tr>
<tr><td><code id="freqMap_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="openair.html#topic+polarFreq">openair::polarFreq</a></code>
</p>

<dl>
<dt><code>ws.int</code></dt><dd><p>Wind speed interval assumed. In some cases e.g. a low met
mast, an interval of 0.5 may be more appropriate.</p>
</dd>
<dt><code>wd.nint</code></dt><dd><p>Number of intervals of wind direction.</p>
</dd>
<dt><code>grid.line</code></dt><dd><p>Radial spacing of grid lines.</p>
</dd>
<dt><code>trans</code></dt><dd><p>Should a transformation be applied? Sometimes when producing
plots of this kind they can be dominated by a few high points. The default
therefore is <code>TRUE</code> and a square-root transform is applied. This
results in a non-linear scale and (usually) a better representation of the
distribution. If set to <code>FALSE</code> a linear scale is used.</p>
</dd>
<dt><code>min.bin</code></dt><dd><p>The minimum number of points allowed in a wind speed/wind
direction bin.  The default is 1. A value of two requires at least 2 valid
records in each bin an so on; bins with less than 2 valid records are set
to NA. Care should be taken when using a value &gt; 1 because of the risk of
removing real data points. It is recommended to consider your data with
care. Also, the <code>polarFreq</code> function can be of use in such
circumstances.</p>
</dd>
<dt><code>ws.upper</code></dt><dd><p>A user-defined upper wind speed to use. This is useful for
ensuring a consistent scale between different plots. For example, to
always ensure that wind speeds are displayed between 1-10, set
<code>ws.int = 10</code>.</p>
</dd>
<dt><code>offset</code></dt><dd><p><code>offset</code> controls the size of the &lsquo;hole&rsquo; in the
middle and is expressed as a percentage of the maximum wind speed. Setting
a higher <code>offset</code> e.g. 50 is useful for <code>statistic =
  "weighted.mean"</code> when <code>ws.int</code> is greater than the maximum wind
speed. See example below.</p>
</dd>
<dt><code>border.col</code></dt><dd><p>The colour of the boundary of each wind speed/direction
bin. The default is transparent. Another useful choice sometimes is
&quot;white&quot;.</p>
</dd>
<dt><code>key.header</code></dt><dd><p>Adds additional text/labels to the scale key. For example,
passing the options <code>key.header = "header", key.footer = "footer1"</code>
adds addition text above and below the scale key. These arguments are
passed to <code>drawOpenKey</code> via <code>quickText</code>, applying the
<code>auto.text</code> argument, to handle formatting.</p>
</dd>
<dt><code>key.footer</code></dt><dd><p>see <code>key.footer</code>.</p>
</dd>
<dt><code>key.position</code></dt><dd><p>Location where the scale key is to plotted. Allowed
arguments currently include <code>"top"</code>, <code>"right"</code>, <code>"bottom"</code>
and <code>"left"</code>.</p>
</dd>
<dt><code>auto.text</code></dt><dd><p>Either <code>TRUE</code> (default) or <code>FALSE</code>. If <code>TRUE</code>
titles and axis labels will automatically try and format pollutant names
and units properly e.g.  by subscripting the &lsquo;2&rsquo; in NO2.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>A leaflet object.
</p>


<h3>See Also</h3>

<p>the original <code><a href="openair.html#topic+polarFreq">openair::polarFreq()</a></code>
</p>
<p><code><a href="#topic+freqMapStatic">freqMapStatic()</a></code> for the static <code>ggmap</code> equivalent of <code><a href="#topic+freqMap">freqMap()</a></code>
</p>
<p>Other interactive directional analysis maps: 
<code><a href="#topic+annulusMap">annulusMap</a>()</code>,
<code><a href="#topic+diffMap">diffMap</a>()</code>,
<code><a href="#topic+percentileMap">percentileMap</a>()</code>,
<code><a href="#topic+polarMap">polarMap</a>()</code>,
<code><a href="#topic+pollroseMap">pollroseMap</a>()</code>,
<code><a href="#topic+windroseMap">windroseMap</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
freqMap(polar_data,
  pollutant = "nox",
  statistic = "mean",
  provider = "Stamen.Toner"
)

## End(Not run)
</code></pre>

<hr>
<h2 id='freqMapStatic'>Polar frequency plots on a static ggmap</h2><span id='topic+freqMapStatic'></span>

<h3>Description</h3>

<p><code><a href="#topic+freqMapStatic">freqMapStatic()</a></code> creates a <code>ggplot2</code> map using polar frequency plots as
markers. As this function returns a <code>ggplot2</code> object, further customisation
can be achieved using functions like <code><a href="ggplot2.html#topic+theme">ggplot2::theme()</a></code> and
<code><a href="ggplot2.html#topic+guides">ggplot2::guides()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>freqMapStatic(
  data,
  pollutant = NULL,
  ggmap,
  statistic = "mean",
  breaks = "free",
  latitude = NULL,
  longitude = NULL,
  facet = NULL,
  cols = "turbo",
  alpha = 1,
  key = FALSE,
  facet.nrow = NULL,
  d.icon = 150,
  d.fig = 3,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="freqMapStatic_+3A_data">data</code></td>
<td>
<p>A data frame. The data frame must contain the data to plot the
directional analysis marker, which includes wind speed (<code>ws</code>), wind
direction (<code>wd</code>), and the column representing the concentration of a
pollutant. In addition, <code>data</code> must include a decimal latitude and
longitude.</p>
</td></tr>
<tr><td><code id="freqMapStatic_+3A_pollutant">pollutant</code></td>
<td>
<p>The column name(s) of the pollutant(s) to plot. If multiple
pollutants are specified, they will each form part of a separate panel.</p>
</td></tr>
<tr><td><code id="freqMapStatic_+3A_ggmap">ggmap</code></td>
<td>
<p>A <code>ggmap</code> object obtained using <code><a href="ggmap.html#topic+get_map">ggmap::get_map()</a></code> or a similar
function to use as the basemap.</p>
</td></tr>
<tr><td><code id="freqMapStatic_+3A_statistic">statistic</code></td>
<td>
<p>The statistic that should be applied to each wind
speed/direction bin. Can be &quot;frequency&quot;, &quot;mean&quot;, &quot;median&quot;, &quot;max&quot; (maximum),
&quot;stdev&quot; (standard deviation) or &quot;weighted.mean&quot;. The option &quot;frequency&quot; is
the simplest and plots the frequency of wind speed/direction in different
bins. The scale therefore shows the counts in each bin. The option &quot;mean&quot;
(the default) will plot the mean concentration of a pollutant (see next
point) in wind speed/direction bins, and so on.  Finally, &quot;weighted.mean&quot;
will plot the concentration of a pollutant weighted by wind
speed/direction. Each segment therefore provides the percentage overall
contribution to the total concentration. Note that for options other than
&quot;frequency&quot;, it is necessary to also provide the name of a pollutant. See
function <code><a href="openair.html#topic+cutData">openair::cutData()</a></code> for further details.</p>
</td></tr>
<tr><td><code id="freqMapStatic_+3A_breaks">breaks</code></td>
<td>
<p>One of:
</p>

<ul>
<li> <p><code>"fixed"</code> which ensures all of the markers use the same colour scale.
</p>
</li>
<li> <p><code>"free"</code> (the default) which allows all of the markers to use different
colour scales.
</p>
</li>
<li><p> A numeric vector defining a sequence of numbers to use as the breaks. The
sequence could represent one with equal spacing, e.g., <code>breaks = seq(0, 100, 10)</code> - a scale from 0-10 in intervals of 10, or a more flexible
sequence, e.g., <code>breaks = c(0, 1, 5, 7, 10)</code>, which may be useful for some
situations.
</p>
</li></ul>
</td></tr>
<tr><td><code id="freqMapStatic_+3A_latitude">latitude</code>, <code id="freqMapStatic_+3A_longitude">longitude</code></td>
<td>
<p>The decimal latitude/longitude. If not provided,
will be automatically inferred from data by looking for a column named
&quot;lat&quot;/&quot;latitude&quot; or &quot;lon&quot;/&quot;lng&quot;/&quot;long&quot;/&quot;longitude&quot; (case-insensitively).</p>
</td></tr>
<tr><td><code id="freqMapStatic_+3A_facet">facet</code></td>
<td>
<p>Used for splitting the input data into different panels, passed
to the <code>type</code> argument of <code><a href="openair.html#topic+cutData">openair::cutData()</a></code>. <code>facet</code> cannot be used if
multiple <code>pollutant</code> columns have been provided.</p>
</td></tr>
<tr><td><code id="freqMapStatic_+3A_cols">cols</code></td>
<td>
<p>The colours used for plotting. See <code><a href="openair.html#topic+openColours">openair::openColours()</a></code> for
more information.</p>
</td></tr>
<tr><td><code id="freqMapStatic_+3A_alpha">alpha</code></td>
<td>
<p>The alpha transparency to use for the plotting surface (a value
between 0 and 1 with zero being fully transparent and 1 fully opaque).</p>
</td></tr>
<tr><td><code id="freqMapStatic_+3A_key">key</code></td>
<td>
<p>Should a key for each marker be drawn? Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="freqMapStatic_+3A_facet.nrow">facet.nrow</code></td>
<td>
<p>Passed to the <code>nrow</code> argument of <code><a href="ggplot2.html#topic+facet_wrap">ggplot2::facet_wrap()</a></code>.</p>
</td></tr>
<tr><td><code id="freqMapStatic_+3A_d.icon">d.icon</code></td>
<td>
<p>The diameter of the plot on the map in pixels. This will affect
the size of the individual polar markers. Alternatively, a vector in the
form <code>c(width, height)</code> can be provided if a non-circular marker is
desired.</p>
</td></tr>
<tr><td><code id="freqMapStatic_+3A_d.fig">d.fig</code></td>
<td>
<p>The diameter of the plots to be produced using <code>openair</code> in
inches. This will affect the resolution of the markers on the map.
Alternatively, a vector in the form <code>c(width, height)</code> can be provided if a
non-circular marker is desired.</p>
</td></tr>
<tr><td><code id="freqMapStatic_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="openair.html#topic+polarFreq">openair::polarFreq</a></code>
</p>

<dl>
<dt><code>ws.int</code></dt><dd><p>Wind speed interval assumed. In some cases e.g. a low met
mast, an interval of 0.5 may be more appropriate.</p>
</dd>
<dt><code>wd.nint</code></dt><dd><p>Number of intervals of wind direction.</p>
</dd>
<dt><code>grid.line</code></dt><dd><p>Radial spacing of grid lines.</p>
</dd>
<dt><code>trans</code></dt><dd><p>Should a transformation be applied? Sometimes when producing
plots of this kind they can be dominated by a few high points. The default
therefore is <code>TRUE</code> and a square-root transform is applied. This
results in a non-linear scale and (usually) a better representation of the
distribution. If set to <code>FALSE</code> a linear scale is used.</p>
</dd>
<dt><code>type</code></dt><dd><p><code>type</code> determines how the data are split i.e. conditioned,
and then plotted. The default is will produce a single plot using the
entire data. Type can be one of the built-in types as detailed in
<code>cutData</code> e.g. &ldquo;season&rdquo;, &ldquo;year&rdquo;, &ldquo;weekday&rdquo; and so
on. For example, <code>type = "season"</code> will produce four plots &mdash; one for
each season.
</p>
<p>It is also possible to choose <code>type</code> as another variable in the data
frame. If that variable is numeric, then the data will be split into four
quantiles (if possible) and labelled accordingly. If type is an existing
character or factor variable, then those categories/levels will be used
directly. This offers great flexibility for understanding the variation of
different variables and how they depend on one another.
</p>
<p>Type can be up length two e.g. <code>type = c("season", "weekday")</code> will
produce a 2x2 plot split by season and day of the week. Note, when two
types are provided the first forms the columns and the second the rows.</p>
</dd>
<dt><code>min.bin</code></dt><dd><p>The minimum number of points allowed in a wind speed/wind
direction bin.  The default is 1. A value of two requires at least 2 valid
records in each bin an so on; bins with less than 2 valid records are set
to NA. Care should be taken when using a value &gt; 1 because of the risk of
removing real data points. It is recommended to consider your data with
care. Also, the <code>polarFreq</code> function can be of use in such
circumstances.</p>
</dd>
<dt><code>ws.upper</code></dt><dd><p>A user-defined upper wind speed to use. This is useful for
ensuring a consistent scale between different plots. For example, to
always ensure that wind speeds are displayed between 1-10, set
<code>ws.int = 10</code>.</p>
</dd>
<dt><code>offset</code></dt><dd><p><code>offset</code> controls the size of the &lsquo;hole&rsquo; in the
middle and is expressed as a percentage of the maximum wind speed. Setting
a higher <code>offset</code> e.g. 50 is useful for <code>statistic =
  "weighted.mean"</code> when <code>ws.int</code> is greater than the maximum wind
speed. See example below.</p>
</dd>
<dt><code>border.col</code></dt><dd><p>The colour of the boundary of each wind speed/direction
bin. The default is transparent. Another useful choice sometimes is
&quot;white&quot;.</p>
</dd>
<dt><code>key.header</code></dt><dd><p>Adds additional text/labels to the scale key. For example,
passing the options <code>key.header = "header", key.footer = "footer1"</code>
adds addition text above and below the scale key. These arguments are
passed to <code>drawOpenKey</code> via <code>quickText</code>, applying the
<code>auto.text</code> argument, to handle formatting.</p>
</dd>
<dt><code>key.footer</code></dt><dd><p>see <code>key.footer</code>.</p>
</dd>
<dt><code>key.position</code></dt><dd><p>Location where the scale key is to plotted. Allowed
arguments currently include <code>"top"</code>, <code>"right"</code>, <code>"bottom"</code>
and <code>"left"</code>.</p>
</dd>
<dt><code>auto.text</code></dt><dd><p>Either <code>TRUE</code> (default) or <code>FALSE</code>. If <code>TRUE</code>
titles and axis labels will automatically try and format pollutant names
and units properly e.g.  by subscripting the &lsquo;2&rsquo; in NO2.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>ggplot2</code> plot with a <code>ggmap</code> basemap
</p>


<h3>Further customisation using ggplot2</h3>

<p>As the outputs of the static directional analysis functions are <code>ggplot2</code>
figures, further customisation is possible using functions such as
<code><a href="ggplot2.html#topic+theme">ggplot2::theme()</a></code>, <code><a href="ggplot2.html#topic+guides">ggplot2::guides()</a></code> and <code><a href="ggplot2.html#topic+labs">ggplot2::labs()</a></code>.
</p>
<p>If multiple pollutants are specified, subscripting (e.g., the &quot;x&quot; in &quot;NOx&quot;)
is achieved using the <a href="ggtext.html#topic+ggtext">ggtext</a> package. Therefore if you
choose to override the plot theme, it is recommended to use
<code style="white-space: pre;">&#8288;[ggplot2::theme()]&#8288;</code> and <code style="white-space: pre;">&#8288;[ggtext::element_markdown()]&#8288;</code> to define the
<code>strip.text</code> parameter.
</p>
<p>When arguments like <code>limits</code>, <code>percentile</code> or <code>breaks</code> are defined, a
legend is automatically added to the figure. Legends can be removed using
<code>ggplot2::theme(legend.position = "none")</code>, or further customised using
<code><a href="ggplot2.html#topic+guides">ggplot2::guides()</a></code> and either <code>color = ggplot2::guide_colourbar()</code> for
continuous legends or <code>fill = ggplot2::guide_legend()</code> for discrete
legends.
</p>


<h3>See Also</h3>

<p>the original <code><a href="openair.html#topic+polarFreq">openair::polarFreq()</a></code>
</p>
<p><code><a href="#topic+freqMap">freqMap()</a></code> for the interactive <code>leaflet</code> equivalent of
<code><a href="#topic+freqMapStatic">freqMapStatic()</a></code>
</p>
<p>Other static directional analysis maps: 
<code><a href="#topic+annulusMapStatic">annulusMapStatic</a>()</code>,
<code><a href="#topic+diffMapStatic">diffMapStatic</a>()</code>,
<code><a href="#topic+percentileMapStatic">percentileMapStatic</a>()</code>,
<code><a href="#topic+polarMapStatic">polarMapStatic</a>()</code>,
<code><a href="#topic+pollroseMapStatic">pollroseMapStatic</a>()</code>,
<code><a href="#topic+windroseMapStatic">windroseMapStatic</a>()</code>
</p>

<hr>
<h2 id='networkMap'>Create a leaflet map of air quality measurement network sites</h2><span id='topic+networkMap'></span>

<h3>Description</h3>

<p>This function uses <code><a href="openair.html#topic+importMeta">openair::importMeta()</a></code> to obtain metadata for measurement
sites and uses it to create an attractive <code>leaflet</code> map. By default a map
will be created in which readers may toggle between a vector base map and a
satellite/aerial image, although users can further customise the control menu
using the <code>provider</code> and <code>control</code> parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>networkMap(
  source = "aurn",
  control = NULL,
  year = NULL,
  cluster = TRUE,
  provider = c(Default = "OpenStreetMap", Satellite = "Esri.WorldImagery"),
  draw.legend = TRUE,
  collapse.control = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="networkMap_+3A_source">source</code></td>
<td>
<p>One or more air quality networks for which data is available
through openair. Available networks include:
</p>

<ul>
<li> <p><code>"aurn"</code>,  The UK Automatic Urban and Rural Network.
</p>
</li>
<li> <p><code>"aqe"</code>,  The Air Quality England Network.
</p>
</li>
<li> <p><code>"saqn"</code>,  The Scottish Air Quality Network.
</p>
</li>
<li> <p><code>"waqn"</code>,  The Welsh Air Quality Network.
</p>
</li>
<li> <p><code>"ni"</code>,  The Northern Ireland Air Quality Network.
</p>
</li>
<li> <p><code>"local"</code>,  Locally managed air quality networks in England.
</p>
</li>
<li> <p><code>"kcl"</code>, King's College London networks.
</p>
</li>
<li> <p><code>"europe"</code>, European AirBase/e-reporting data.
There are two additional options provided for convenience:
</p>
</li>
<li> <p><code>"ukaq"</code> will return metadata for all networks for which data is imported by <code><a href="openair.html#topic+importUKAQ">importUKAQ()</a></code> (i.e., AURN, AQE, SAQN, WAQN, NI, and the local networks).
</p>
</li>
<li> <p><code>"all"</code> will import all available metadata (i.e., <code>"ukaq"</code> plus <code>"kcl"</code> and <code>"europe"</code>).
</p>
</li></ul>
</td></tr>
<tr><td><code id="networkMap_+3A_control">control</code></td>
<td>
<p>Option to add a &quot;layer control&quot; menu to allow readers to
select between different site types. Can choose between effectively any
column in the <code><a href="openair.html#topic+importMeta">openair::importMeta()</a></code> output, such as <code>"variable"</code>,
<code>"site_type"</code>, or <code>"agglomeration"</code>, as well as <code>"network"</code> when more than
one <code>source</code> was specified.</p>
</td></tr>
<tr><td><code id="networkMap_+3A_year">year</code></td>
<td>
<p>By default, <code><a href="#topic+networkMap">networkMap()</a></code> visualises sites which are currently
operational. <code>year</code> allows users to show sites open in a specific year, or
over a range of years. See <code><a href="openair.html#topic+importMeta">openair::importMeta()</a></code> for more information.</p>
</td></tr>
<tr><td><code id="networkMap_+3A_cluster">cluster</code></td>
<td>
<p>When <code>cluster = TRUE</code>, markers are clustered together. This
may be useful for sources like &quot;kcl&quot; where there are many markers very
close together. Defaults to <code>TRUE</code>, and is forced to be <code>TRUE</code> when <code>source = "europe"</code> due to the large number of sites.</p>
</td></tr>
<tr><td><code id="networkMap_+3A_provider">provider</code></td>
<td>
<p>The base map(s) to be used. See
<a href="http://leaflet-extras.github.io/leaflet-providers/preview/">http://leaflet-extras.github.io/leaflet-providers/preview/</a> for a list of
all base maps that can be used. If multiple base maps are provided, they
can be toggled between using a &quot;layer control&quot; interface.</p>
</td></tr>
<tr><td><code id="networkMap_+3A_draw.legend">draw.legend</code></td>
<td>
<p>When multiple <code>source</code>s are specified, should a legend be
created at the side of the map? Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="networkMap_+3A_collapse.control">collapse.control</code></td>
<td>
<p>Should the &quot;layer control&quot; interface be collapsed?
Defaults to <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When selecting multiple data sources using <code>source</code>, please be mindful that
there can be overlap between the different networks. For example, an air
quality site in Scotland may be part of the AURN <em>and</em> the SAQN.
<code><a href="#topic+networkMap">networkMap()</a></code> will only show one marker for such sites, and uses the order
in which <code>source</code> arguments are provided as the hierarchy by which to assign
sites to networks. The aforementioned AURN &amp; SAQN site will therefore have
its SAQN code displayed if <code>source = c("saqn", "aurn")</code>, and its AURN code
displayed if <code>source = c("aurn", "saqn")</code>.
</p>
<p>This hierarchy is also reflected when <code>control = "network"</code> is used. As
<code>leaflet</code> markers cannot be part of multiple groups, the AURN &amp; SAQN site
will be part of the &quot;SAQN&quot; layer control group when <code>source = c("saqn", "aurn")</code> and the &quot;AURN&quot; layer control group when <code>source = c("aurn", "saqn")</code>.
</p>


<h3>Value</h3>

<p>A leaflet object.
</p>


<h3>See Also</h3>

<p>Other uk air quality network mapping functions: 
<code><a href="#topic+searchNetwork">searchNetwork</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# view one network, grouped by site type
networkMap(source = "aurn", control = "site_type")

# view multiple networks, grouped by network
networkMap(source = c("aurn", "waqn", "saqn"), control = "network")

## End(Not run)

</code></pre>

<hr>
<h2 id='percentileMap'>Percentile roses on interactive leaflet maps</h2><span id='topic+percentileMap'></span>

<h3>Description</h3>

<p><code><a href="#topic+percentileMap">percentileMap()</a></code> creates a <code>leaflet</code> map using percentile roses as markers.
Any number of pollutants can be specified using the <code>pollutant</code> argument, and
multiple layers of markers can be added and toggled between using <code>control</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>percentileMap(
  data,
  pollutant = NULL,
  percentile = c(25, 50, 75, 90, 95),
  intervals = "fixed",
  latitude = NULL,
  longitude = NULL,
  control = NULL,
  popup = NULL,
  label = NULL,
  provider = "OpenStreetMap",
  cols = "turbo",
  alpha = 1,
  key = FALSE,
  draw.legend = TRUE,
  collapse.control = FALSE,
  d.icon = 200,
  d.fig = 3.5,
  type = deprecated(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="percentileMap_+3A_data">data</code></td>
<td>
<p>A data frame. The data frame must contain the data to plot the
directional analysis marker, which includes wind speed (<code>ws</code>), wind
direction (<code>wd</code>), and the column representing the concentration of a
pollutant. In addition, <code>data</code> must include a decimal latitude and
longitude.</p>
</td></tr>
<tr><td><code id="percentileMap_+3A_pollutant">pollutant</code></td>
<td>
<p>The column name(s) of the pollutant(s) to plot. If multiple
pollutants are specified, they can be toggled between using a &quot;layer
control&quot; interface.</p>
</td></tr>
<tr><td><code id="percentileMap_+3A_percentile">percentile</code></td>
<td>
<p>The percentile value(s) to plot. Must be between 0–100. If
<code>percentile = NA</code> then only a mean line will be shown.</p>
</td></tr>
<tr><td><code id="percentileMap_+3A_intervals">intervals</code></td>
<td>
<p>One of:
</p>

<ul>
<li> <p><code>"fixed"</code> (the default) which ensures all of the markers use the same radial axis scale.
</p>
</li>
<li> <p><code>"free"</code> which allows all of the markers to use different radial axis scales.
</p>
</li>
<li><p> A numeric vector defining a sequence of numbers to use as the intervals, e.g., <code>intervals = c(0, 10, 30, 50)</code>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="percentileMap_+3A_latitude">latitude</code>, <code id="percentileMap_+3A_longitude">longitude</code></td>
<td>
<p>The decimal latitude/longitude. If not provided,
will be automatically inferred from data by looking for a column named
&quot;lat&quot;/&quot;latitude&quot; or &quot;lon&quot;/&quot;lng&quot;/&quot;long&quot;/&quot;longitude&quot; (case-insensitively).</p>
</td></tr>
<tr><td><code id="percentileMap_+3A_control">control</code></td>
<td>
<p>Used for splitting the input data into different groups which
can be selected between using a &quot;layer control&quot; interface, passed to the
<code>type</code> argument of <code><a href="openair.html#topic+cutData">openair::cutData()</a></code>. <code>control</code> cannot be used if
multiple <code>pollutant</code> columns have been provided.</p>
</td></tr>
<tr><td><code id="percentileMap_+3A_popup">popup</code></td>
<td>
<p>Columns to be used as the HTML content for marker popups. Popups
may be useful to show information about the individual sites (e.g., site
names, codes, types, etc.). If a vector of column names are provided they
are passed to <code><a href="#topic+buildPopup">buildPopup()</a></code> using its default values.</p>
</td></tr>
<tr><td><code id="percentileMap_+3A_label">label</code></td>
<td>
<p>Column to be used as the HTML content for hover-over labels.
Labels are useful for the same reasons as popups, though are typically
shorter.</p>
</td></tr>
<tr><td><code id="percentileMap_+3A_provider">provider</code></td>
<td>
<p>The base map(s) to be used. See
<a href="http://leaflet-extras.github.io/leaflet-providers/preview/">http://leaflet-extras.github.io/leaflet-providers/preview/</a> for a list of
all base maps that can be used. If multiple base maps are provided, they
can be toggled between using a &quot;layer control&quot; interface. By default, the
interface will use the provider names as labels, but users can define their
own using a named vector (e.g., <code>c("Default" = "OpenStreetMap", "Satellite" = "Esri.WorldImagery")</code>)</p>
</td></tr>
<tr><td><code id="percentileMap_+3A_cols">cols</code></td>
<td>
<p>The colours used for plotting. See <code><a href="openair.html#topic+openColours">openair::openColours()</a></code> for
more information.</p>
</td></tr>
<tr><td><code id="percentileMap_+3A_alpha">alpha</code></td>
<td>
<p>The alpha transparency to use for the plotting surface (a value
between 0 and 1 with zero being fully transparent and 1 fully opaque).</p>
</td></tr>
<tr><td><code id="percentileMap_+3A_key">key</code></td>
<td>
<p>Should a key for each marker be drawn? Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="percentileMap_+3A_draw.legend">draw.legend</code></td>
<td>
<p>Should a shared legend be created at the side of the map?
Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="percentileMap_+3A_collapse.control">collapse.control</code></td>
<td>
<p>Should the &quot;layer control&quot; interface be collapsed?
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="percentileMap_+3A_d.icon">d.icon</code></td>
<td>
<p>The diameter of the plot on the map in pixels. This will affect
the size of the individual polar markers. Alternatively, a vector in the
form <code>c(width, height)</code> can be provided if a non-circular marker is
desired.</p>
</td></tr>
<tr><td><code id="percentileMap_+3A_d.fig">d.fig</code></td>
<td>
<p>The diameter of the plots to be produced using <code>openair</code> in
inches. This will affect the resolution of the markers on the map.
Alternatively, a vector in the form <code>c(width, height)</code> can be provided if a
non-circular marker is desired.</p>
</td></tr>
<tr><td><code id="percentileMap_+3A_type">type</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>. Different sites are now
automatically detected based on latitude and longitude. Please use <code>label</code>
and/or <code>popup</code> to label different sites.</p>
</td></tr>
<tr><td><code id="percentileMap_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="openair.html#topic+percentileRose">openair::percentileRose</a></code>
</p>

<dl>
<dt><code>wd</code></dt><dd><p>Name of wind direction field.</p>
</dd>
<dt><code>smooth</code></dt><dd><p>Should the wind direction data be smoothed using a cyclic
spline?</p>
</dd>
<dt><code>method</code></dt><dd><p>When <code>method = "default"</code> the supplied percentiles by wind
direction are calculated. When <code>method = "cpf"</code> the conditional
probability function (CPF) is plotted and a single (usually high)
percentile level is supplied. The CPF is defined as CPF = my/ny, where my
is the number of samples in the wind sector y with mixing ratios greater
than the <em>overall</em> percentile concentration, and ny is the total
number of samples in the same wind sector (see Ashbaugh et al., 1985).</p>
</dd>
<dt><code>angle</code></dt><dd><p>Default angle of &ldquo;spokes&rdquo; is when <code>smooth = FALSE</code>.</p>
</dd>
<dt><code>mean</code></dt><dd><p>Show the mean by wind direction as a line?</p>
</dd>
<dt><code>mean.lty</code></dt><dd><p>Line type for mean line.</p>
</dd>
<dt><code>mean.lwd</code></dt><dd><p>Line width for mean line.</p>
</dd>
<dt><code>mean.col</code></dt><dd><p>Line colour for mean line.</p>
</dd>
<dt><code>fill</code></dt><dd><p>Should the percentile intervals be filled (default) or should
lines be drawn (<code>fill = FALSE</code>).</p>
</dd>
<dt><code>angle.scale</code></dt><dd><p>Sometimes the placement of the scale may interfere with an
interesting feature. The user can therefore set <code>angle.scale</code> to any
value between 0 and 360 degrees to mitigate such problems. For example
<code>angle.scale = 45</code> will draw the scale heading in a NE direction.</p>
</dd>
<dt><code>auto.text</code></dt><dd><p>Either <code>TRUE</code> (default) or <code>FALSE</code>. If <code>TRUE</code>
titles and axis labels will automatically try and format pollutant names
and units properly e.g.  by subscripting the &lsquo;2&rsquo; in NO2.</p>
</dd>
<dt><code>key.header</code></dt><dd><p>Adds additional text/labels to the scale key. For example,
passing the options <code>key.header = "header", key.footer = "footer1"</code>
adds addition text above and below the scale key. These arguments are
passed to <code>drawOpenKey</code> via <code>quickText</code>, applying the
<code>auto.text</code> argument, to handle formatting.</p>
</dd>
<dt><code>key.footer</code></dt><dd><p>see <code>key.footer</code>.</p>
</dd>
<dt><code>key.position</code></dt><dd><p>Location where the scale key is to plotted. Allowed
arguments currently include <code>"top"</code>, <code>"right"</code>, <code>"bottom"</code>
and <code>"left"</code>.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>A leaflet object.
</p>


<h3>See Also</h3>

<p>the original <code><a href="openair.html#topic+percentileRose">openair::percentileRose()</a></code>
</p>
<p><code><a href="#topic+percentileMapStatic">percentileMapStatic()</a></code> for the static <code>ggmap</code> equivalent of
<code><a href="#topic+percentileMap">percentileMap()</a></code>
</p>
<p>Other interactive directional analysis maps: 
<code><a href="#topic+annulusMap">annulusMap</a>()</code>,
<code><a href="#topic+diffMap">diffMap</a>()</code>,
<code><a href="#topic+freqMap">freqMap</a>()</code>,
<code><a href="#topic+polarMap">polarMap</a>()</code>,
<code><a href="#topic+pollroseMap">pollroseMap</a>()</code>,
<code><a href="#topic+windroseMap">windroseMap</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
percentileMap(polar_data,
  pollutant = "nox",
  provider = "Stamen.Toner"
)

## End(Not run)
</code></pre>

<hr>
<h2 id='percentileMapStatic'>Percentile roses on a static ggmap</h2><span id='topic+percentileMapStatic'></span>

<h3>Description</h3>

<p><code><a href="#topic+percentileMapStatic">percentileMapStatic()</a></code> creates a <code>ggplot2</code> map using percentile roses as
markers. As this function returns a <code>ggplot2</code> object, further customisation
can be achieved using functions like <code><a href="ggplot2.html#topic+theme">ggplot2::theme()</a></code> and
<code><a href="ggplot2.html#topic+guides">ggplot2::guides()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>percentileMapStatic(
  data,
  pollutant = NULL,
  ggmap,
  percentile = c(25, 50, 75, 90, 95),
  intervals = "fixed",
  latitude = NULL,
  longitude = NULL,
  facet = NULL,
  cols = "turbo",
  alpha = 1,
  key = FALSE,
  facet.nrow = NULL,
  d.icon = 150,
  d.fig = 3,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="percentileMapStatic_+3A_data">data</code></td>
<td>
<p>A data frame. The data frame must contain the data to plot the
directional analysis marker, which includes wind speed (<code>ws</code>), wind
direction (<code>wd</code>), and the column representing the concentration of a
pollutant. In addition, <code>data</code> must include a decimal latitude and
longitude.</p>
</td></tr>
<tr><td><code id="percentileMapStatic_+3A_pollutant">pollutant</code></td>
<td>
<p>The column name(s) of the pollutant(s) to plot. If multiple
pollutants are specified, they will each form part of a separate panel.</p>
</td></tr>
<tr><td><code id="percentileMapStatic_+3A_ggmap">ggmap</code></td>
<td>
<p>A <code>ggmap</code> object obtained using <code><a href="ggmap.html#topic+get_map">ggmap::get_map()</a></code> or a similar
function to use as the basemap.</p>
</td></tr>
<tr><td><code id="percentileMapStatic_+3A_percentile">percentile</code></td>
<td>
<p>The percentile value(s) to plot. Must be between 0–100. If
<code>percentile = NA</code> then only a mean line will be shown.</p>
</td></tr>
<tr><td><code id="percentileMapStatic_+3A_intervals">intervals</code></td>
<td>
<p>One of:
</p>

<ul>
<li> <p><code>"fixed"</code> (the default) which ensures all of the markers use the same radial axis scale.
</p>
</li>
<li> <p><code>"free"</code> which allows all of the markers to use different radial axis scales.
</p>
</li>
<li><p> A numeric vector defining a sequence of numbers to use as the intervals, e.g., <code>intervals = c(0, 10, 30, 50)</code>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="percentileMapStatic_+3A_latitude">latitude</code>, <code id="percentileMapStatic_+3A_longitude">longitude</code></td>
<td>
<p>The decimal latitude/longitude. If not provided,
will be automatically inferred from data by looking for a column named
&quot;lat&quot;/&quot;latitude&quot; or &quot;lon&quot;/&quot;lng&quot;/&quot;long&quot;/&quot;longitude&quot; (case-insensitively).</p>
</td></tr>
<tr><td><code id="percentileMapStatic_+3A_facet">facet</code></td>
<td>
<p>Used for splitting the input data into different panels, passed
to the <code>type</code> argument of <code><a href="openair.html#topic+cutData">openair::cutData()</a></code>. <code>facet</code> cannot be used if
multiple <code>pollutant</code> columns have been provided.</p>
</td></tr>
<tr><td><code id="percentileMapStatic_+3A_cols">cols</code></td>
<td>
<p>The colours used for plotting. See <code><a href="openair.html#topic+openColours">openair::openColours()</a></code> for
more information.</p>
</td></tr>
<tr><td><code id="percentileMapStatic_+3A_alpha">alpha</code></td>
<td>
<p>The alpha transparency to use for the plotting surface (a value
between 0 and 1 with zero being fully transparent and 1 fully opaque).</p>
</td></tr>
<tr><td><code id="percentileMapStatic_+3A_key">key</code></td>
<td>
<p>Should a key for each marker be drawn? Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="percentileMapStatic_+3A_facet.nrow">facet.nrow</code></td>
<td>
<p>Passed to the <code>nrow</code> argument of <code><a href="ggplot2.html#topic+facet_wrap">ggplot2::facet_wrap()</a></code>.</p>
</td></tr>
<tr><td><code id="percentileMapStatic_+3A_d.icon">d.icon</code></td>
<td>
<p>The diameter of the plot on the map in pixels. This will affect
the size of the individual polar markers. Alternatively, a vector in the
form <code>c(width, height)</code> can be provided if a non-circular marker is
desired.</p>
</td></tr>
<tr><td><code id="percentileMapStatic_+3A_d.fig">d.fig</code></td>
<td>
<p>The diameter of the plots to be produced using <code>openair</code> in
inches. This will affect the resolution of the markers on the map.
Alternatively, a vector in the form <code>c(width, height)</code> can be provided if a
non-circular marker is desired.</p>
</td></tr>
<tr><td><code id="percentileMapStatic_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="openair.html#topic+percentileRose">openair::percentileRose</a></code>
</p>

<dl>
<dt><code>wd</code></dt><dd><p>Name of wind direction field.</p>
</dd>
<dt><code>type</code></dt><dd><p><code>type</code> determines how the data are split i.e. conditioned,
and then plotted. The default is will produce a single plot using the
entire data. Type can be one of the built-in types as detailed in
<code>cutData</code> e.g. &ldquo;season&rdquo;, &ldquo;year&rdquo;, &ldquo;weekday&rdquo; and so
on. For example, <code>type = "season"</code> will produce four plots &mdash; one for
each season.
</p>
<p>It is also possible to choose <code>type</code> as another variable in the data
frame. If that variable is numeric, then the data will be split into four
quantiles (if possible) and labelled accordingly. If type is an existing
character or factor variable, then those categories/levels will be used
directly. This offers great flexibility for understanding the variation of
different variables and how they depend on one another.
</p>
<p>Type can be up length two e.g. <code>type = c("season", "weekday")</code> will
produce a 2x2 plot split by season and day of the week. Note, when two
types are provided the first forms the columns and the second the rows.</p>
</dd>
<dt><code>smooth</code></dt><dd><p>Should the wind direction data be smoothed using a cyclic
spline?</p>
</dd>
<dt><code>method</code></dt><dd><p>When <code>method = "default"</code> the supplied percentiles by wind
direction are calculated. When <code>method = "cpf"</code> the conditional
probability function (CPF) is plotted and a single (usually high)
percentile level is supplied. The CPF is defined as CPF = my/ny, where my
is the number of samples in the wind sector y with mixing ratios greater
than the <em>overall</em> percentile concentration, and ny is the total
number of samples in the same wind sector (see Ashbaugh et al., 1985).</p>
</dd>
<dt><code>angle</code></dt><dd><p>Default angle of &ldquo;spokes&rdquo; is when <code>smooth = FALSE</code>.</p>
</dd>
<dt><code>mean</code></dt><dd><p>Show the mean by wind direction as a line?</p>
</dd>
<dt><code>mean.lty</code></dt><dd><p>Line type for mean line.</p>
</dd>
<dt><code>mean.lwd</code></dt><dd><p>Line width for mean line.</p>
</dd>
<dt><code>mean.col</code></dt><dd><p>Line colour for mean line.</p>
</dd>
<dt><code>fill</code></dt><dd><p>Should the percentile intervals be filled (default) or should
lines be drawn (<code>fill = FALSE</code>).</p>
</dd>
<dt><code>angle.scale</code></dt><dd><p>Sometimes the placement of the scale may interfere with an
interesting feature. The user can therefore set <code>angle.scale</code> to any
value between 0 and 360 degrees to mitigate such problems. For example
<code>angle.scale = 45</code> will draw the scale heading in a NE direction.</p>
</dd>
<dt><code>auto.text</code></dt><dd><p>Either <code>TRUE</code> (default) or <code>FALSE</code>. If <code>TRUE</code>
titles and axis labels will automatically try and format pollutant names
and units properly e.g.  by subscripting the &lsquo;2&rsquo; in NO2.</p>
</dd>
<dt><code>key.header</code></dt><dd><p>Adds additional text/labels to the scale key. For example,
passing the options <code>key.header = "header", key.footer = "footer1"</code>
adds addition text above and below the scale key. These arguments are
passed to <code>drawOpenKey</code> via <code>quickText</code>, applying the
<code>auto.text</code> argument, to handle formatting.</p>
</dd>
<dt><code>key.footer</code></dt><dd><p>see <code>key.footer</code>.</p>
</dd>
<dt><code>key.position</code></dt><dd><p>Location where the scale key is to plotted. Allowed
arguments currently include <code>"top"</code>, <code>"right"</code>, <code>"bottom"</code>
and <code>"left"</code>.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>ggplot2</code> plot with a <code>ggmap</code> basemap
</p>


<h3>Further customisation using ggplot2</h3>

<p>As the outputs of the static directional analysis functions are <code>ggplot2</code>
figures, further customisation is possible using functions such as
<code><a href="ggplot2.html#topic+theme">ggplot2::theme()</a></code>, <code><a href="ggplot2.html#topic+guides">ggplot2::guides()</a></code> and <code><a href="ggplot2.html#topic+labs">ggplot2::labs()</a></code>.
</p>
<p>If multiple pollutants are specified, subscripting (e.g., the &quot;x&quot; in &quot;NOx&quot;)
is achieved using the <a href="ggtext.html#topic+ggtext">ggtext</a> package. Therefore if you
choose to override the plot theme, it is recommended to use
<code style="white-space: pre;">&#8288;[ggplot2::theme()]&#8288;</code> and <code style="white-space: pre;">&#8288;[ggtext::element_markdown()]&#8288;</code> to define the
<code>strip.text</code> parameter.
</p>
<p>When arguments like <code>limits</code>, <code>percentile</code> or <code>breaks</code> are defined, a
legend is automatically added to the figure. Legends can be removed using
<code>ggplot2::theme(legend.position = "none")</code>, or further customised using
<code><a href="ggplot2.html#topic+guides">ggplot2::guides()</a></code> and either <code>color = ggplot2::guide_colourbar()</code> for
continuous legends or <code>fill = ggplot2::guide_legend()</code> for discrete
legends.
</p>


<h3>See Also</h3>

<p>the original <code><a href="openair.html#topic+percentileRose">openair::percentileRose()</a></code>
</p>
<p><code><a href="#topic+percentileMap">percentileMap()</a></code> for the interactive <code>leaflet</code> equivalent of
<code><a href="#topic+percentileMapStatic">percentileMapStatic()</a></code>
</p>
<p>Other static directional analysis maps: 
<code><a href="#topic+annulusMapStatic">annulusMapStatic</a>()</code>,
<code><a href="#topic+diffMapStatic">diffMapStatic</a>()</code>,
<code><a href="#topic+freqMapStatic">freqMapStatic</a>()</code>,
<code><a href="#topic+polarMapStatic">polarMapStatic</a>()</code>,
<code><a href="#topic+pollroseMapStatic">pollroseMapStatic</a>()</code>,
<code><a href="#topic+windroseMapStatic">windroseMapStatic</a>()</code>
</p>

<hr>
<h2 id='polar_data'>Example data for polar mapping functions</h2><span id='topic+polar_data'></span>

<h3>Description</h3>

<p>The <code>polar_data</code> dataset is provided as an example dataset as part of
the <code>openairmaps</code> package. The dataset contains hourly measurements of
air pollutant concentrations, location and meteorological data.
</p>


<h3>Format</h3>

<p>Data frame with example data from four sites in London in 2009.
</p>

<dl>
<dt>date</dt><dd><p>The date and time of the measurement</p>
</dd>
<dt>nox, no2, pm2.5, pm10</dt><dd><p>Pollutant concentrations</p>
</dd>
<dt>site</dt><dd><p>The site name. Useful for use with the <code>popup</code> and <code>label</code> arguments in <code>openairmaps</code> functions.</p>
</dd>
<dt>latitude, longitude</dt><dd><p>Decimal latitude and longitude of the sites.</p>
</dd>
<dt>site.type</dt><dd><p>Site type of the site (either &quot;Urban Traffic&quot; or &quot;Urban Background&quot;).</p>
</dd>
<dt>wd</dt><dd><p>Wind direction, in degrees from North, as a numeric vector.</p>
</dd>
<dt>ws</dt><dd><p>Wind speed, in m/s, as numeric vector.</p>
</dd>
<dt>visibility</dt><dd><p>The visibility in metres.</p>
</dd>
<dt>air_temp</dt><dd><p>Air temperature in degrees Celcius.</p>
</dd>
</dl>



<h3>Details</h3>

<p><code>polar_data</code> is supplied with the <code>openairmaps</code> package as an
example dataset for use with documented examples.
</p>


<h3>Source</h3>

<p><code>polar_data</code> was compiled from data using the
<code><a href="openair.html#topic+importUKAQ-wrapper">openair::importAURN()</a></code> function from the <code>openair</code> package with
meteorological data from the <code>worldmet</code> package.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# basic structure
head(polar_data)

</code></pre>

<hr>
<h2 id='polarMap'>Bivariate polar plots on interactive leaflet maps</h2><span id='topic+polarMap'></span>

<h3>Description</h3>

<p><code><a href="#topic+polarMap">polarMap()</a></code> creates a <code>leaflet</code> map using bivariate polar plots as markers.
Any number of pollutants can be specified using the <code>pollutant</code> argument, and
multiple layers of markers can be added and toggled between using <code>control</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>polarMap(
  data,
  pollutant = NULL,
  x = "ws",
  limits = "free",
  upper = "fixed",
  latitude = NULL,
  longitude = NULL,
  control = NULL,
  popup = NULL,
  label = NULL,
  provider = "OpenStreetMap",
  cols = "turbo",
  alpha = 1,
  key = FALSE,
  draw.legend = TRUE,
  collapse.control = FALSE,
  d.icon = 200,
  d.fig = 3.5,
  type = deprecated(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="polarMap_+3A_data">data</code></td>
<td>
<p>A data frame. The data frame must contain the data to plot the
directional analysis marker, which includes wind speed (<code>ws</code>), wind
direction (<code>wd</code>), and the column representing the concentration of a
pollutant. In addition, <code>data</code> must include a decimal latitude and
longitude.</p>
</td></tr>
<tr><td><code id="polarMap_+3A_pollutant">pollutant</code></td>
<td>
<p>The column name(s) of the pollutant(s) to plot. If multiple
pollutants are specified, they can be toggled between using a &quot;layer
control&quot; interface.</p>
</td></tr>
<tr><td><code id="polarMap_+3A_x">x</code></td>
<td>
<p>The radial axis variable to plot.</p>
</td></tr>
<tr><td><code id="polarMap_+3A_limits">limits</code></td>
<td>
<p>One of:
</p>

<ul>
<li> <p><code>"fixed"</code> which ensures all of the markers use the same colour scale.
</p>
</li>
<li> <p><code>"free"</code> (the default) which allows all of the markers to use different
colour scales.
</p>
</li>
<li><p> A numeric vector in the form <code>c(lower, upper)</code> used to define the colour
scale. For example, <code>limits = c(0, 100)</code> would force the plot limits to
span 0-100.
</p>
</li></ul>
</td></tr>
<tr><td><code id="polarMap_+3A_upper">upper</code></td>
<td>
<p>One of:
</p>

<ul>
<li> <p><code>"fixed"</code> (the default) which ensures all of the markers use the same radial axis scale.
</p>
</li>
<li> <p><code>"free"</code> which allows all of the markers to use different radial axis scales.
</p>
</li>
<li><p> A numeric value, used as the upper limit for the radial axis scale.
</p>
</li></ul>
</td></tr>
<tr><td><code id="polarMap_+3A_latitude">latitude</code>, <code id="polarMap_+3A_longitude">longitude</code></td>
<td>
<p>The decimal latitude/longitude. If not provided,
will be automatically inferred from data by looking for a column named
&quot;lat&quot;/&quot;latitude&quot; or &quot;lon&quot;/&quot;lng&quot;/&quot;long&quot;/&quot;longitude&quot; (case-insensitively).</p>
</td></tr>
<tr><td><code id="polarMap_+3A_control">control</code></td>
<td>
<p>Used for splitting the input data into different groups which
can be selected between using a &quot;layer control&quot; interface, passed to the
<code>type</code> argument of <code><a href="openair.html#topic+cutData">openair::cutData()</a></code>. <code>control</code> cannot be used if
multiple <code>pollutant</code> columns have been provided.</p>
</td></tr>
<tr><td><code id="polarMap_+3A_popup">popup</code></td>
<td>
<p>Columns to be used as the HTML content for marker popups. Popups
may be useful to show information about the individual sites (e.g., site
names, codes, types, etc.). If a vector of column names are provided they
are passed to <code><a href="#topic+buildPopup">buildPopup()</a></code> using its default values.</p>
</td></tr>
<tr><td><code id="polarMap_+3A_label">label</code></td>
<td>
<p>Column to be used as the HTML content for hover-over labels.
Labels are useful for the same reasons as popups, though are typically
shorter.</p>
</td></tr>
<tr><td><code id="polarMap_+3A_provider">provider</code></td>
<td>
<p>The base map(s) to be used. See
<a href="http://leaflet-extras.github.io/leaflet-providers/preview/">http://leaflet-extras.github.io/leaflet-providers/preview/</a> for a list of
all base maps that can be used. If multiple base maps are provided, they
can be toggled between using a &quot;layer control&quot; interface. By default, the
interface will use the provider names as labels, but users can define their
own using a named vector (e.g., <code>c("Default" = "OpenStreetMap", "Satellite" = "Esri.WorldImagery")</code>)</p>
</td></tr>
<tr><td><code id="polarMap_+3A_cols">cols</code></td>
<td>
<p>The colours used for plotting. See <code><a href="openair.html#topic+openColours">openair::openColours()</a></code> for
more information.</p>
</td></tr>
<tr><td><code id="polarMap_+3A_alpha">alpha</code></td>
<td>
<p>The alpha transparency to use for the plotting surface (a value
between 0 and 1 with zero being fully transparent and 1 fully opaque).</p>
</td></tr>
<tr><td><code id="polarMap_+3A_key">key</code></td>
<td>
<p>Should a key for each marker be drawn? Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="polarMap_+3A_draw.legend">draw.legend</code></td>
<td>
<p>When <code>limits</code> are specified, should a shared legend be
created at the side of the map? Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="polarMap_+3A_collapse.control">collapse.control</code></td>
<td>
<p>Should the &quot;layer control&quot; interface be collapsed?
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="polarMap_+3A_d.icon">d.icon</code></td>
<td>
<p>The diameter of the plot on the map in pixels. This will affect
the size of the individual polar markers. Alternatively, a vector in the
form <code>c(width, height)</code> can be provided if a non-circular marker is
desired.</p>
</td></tr>
<tr><td><code id="polarMap_+3A_d.fig">d.fig</code></td>
<td>
<p>The diameter of the plots to be produced using <code>openair</code> in
inches. This will affect the resolution of the markers on the map.
Alternatively, a vector in the form <code>c(width, height)</code> can be provided if a
non-circular marker is desired.</p>
</td></tr>
<tr><td><code id="polarMap_+3A_type">type</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>. Different sites are now
automatically detected based on latitude and longitude. Please use <code>label</code>
and/or <code>popup</code> to label different sites.</p>
</td></tr>
<tr><td><code id="polarMap_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="openair.html#topic+polarPlot">openair::polarPlot</a></code>
</p>

<dl>
<dt><code>wd</code></dt><dd><p>Name of wind direction field.</p>
</dd>
<dt><code>statistic</code></dt><dd><p>The statistic that should be applied to each wind
speed/direction bin. Because of the smoothing involved, the colour scale
for some of these statistics is only to provide an indication of overall
pattern and should not be interpreted in concentration units e.g. for
<code>statistic = "weighted.mean"</code> where the bin mean is multiplied by the
bin frequency and divided by the total frequency. In many cases using
<code>polarFreq</code> will be better. Setting <code>statistic = "weighted.mean"</code>
can be useful because it provides an indication of the concentration *
frequency of occurrence and will highlight the wind speed/direction
conditions that dominate the overall mean.Can be:
</p>
 <ul>
<li>  <p>&ldquo;mean&rdquo; (default), &ldquo;median&rdquo;, &ldquo;max&rdquo;
(maximum), &ldquo;frequency&rdquo;. &ldquo;stdev&rdquo; (standard deviation),
&ldquo;weighted.mean&rdquo;.
</p>
</li>
<li> <p><code>statistic = "nwr"</code> Implements the Non-parametric Wind
Regression approach of Henry et al. (2009) that uses kernel smoothers. The
<code>openair</code> implementation is not identical because Gaussian kernels are
used for both wind direction and speed. The smoothing is controlled by
<code>ws_spread</code> and <code>wd_spread</code>.
</p>
</li>
<li> <p><code>statistic = "cpf"</code> the conditional probability function (CPF)
is plotted and a single (usually high) percentile level is supplied. The
CPF is defined as CPF = my/ny, where my is the number of samples in the y
bin (by default a wind direction, wind speed interval) with mixing ratios
greater than the <em>overall</em> percentile concentration, and ny is the
total number of samples in the same wind sector (see Ashbaugh et al.,
1985). Note that percentile intervals can also be considered; see
<code>percentile</code> for details.
</p>
</li>
<li><p> When <code>statistic = "r"</code> or <code>statistic = "Pearson"</code>, the
Pearson correlation coefficient is calculated for <em>two</em> pollutants.
The calculation involves a weighted Pearson correlation coefficient, which
is weighted by Gaussian kernels for wind direction an the radial variable
(by default wind speed). More weight is assigned to values close to a wind
speed-direction interval. Kernel weighting is used to ensure that all data
are used rather than relying on the potentially small number of values in a
wind speed-direction interval.
</p>
</li>
<li><p> When <code>statistic = "Spearman"</code>, the Spearman correlation
coefficient is calculated for <em>two</em> pollutants. The calculation
involves a weighted Spearman correlation coefficient, which is weighted by
Gaussian kernels for wind direction an the radial variable (by default wind
speed). More weight is assigned to values close to a wind speed-direction
interval. Kernel weighting is used to ensure that all data are used rather
than relying on the potentially small number of values in a wind
speed-direction interval.
</p>
</li>
<li> <p><code>"robust_slope"</code> is another option for pair-wise statistics and
<code>"quantile.slope"</code>, which uses quantile regression to estimate the
slope for a particular quantile level (see also <code>tau</code> for setting the
quantile level).
</p>
</li>
<li> <p><code>"york_slope"</code> is another option for pair-wise statistics which
uses the <em>York regression method</em> to estimate the slope. In this
method the uncertainties in <code>x</code> and <code>y</code> are used in the
determination of the slope. The uncertainties are provided by
<code>x_error</code> and <code>y_error</code> &mdash; see below.</p>
</li></ul>
</dd>
<dt><code>exclude.missing</code></dt><dd><p>Setting this option to <code>TRUE</code> (the default)
removes points from the plot that are too far from the original data. The
smoothing routines will produce predictions at points where no data exist
i.e. they predict. By removing the points too far from the original data
produces a plot where it is clear where the original data lie. If set to
<code>FALSE</code> missing data will be interpolated.</p>
</dd>
<dt><code>uncertainty</code></dt><dd><p>Should the uncertainty in the calculated surface be shown?
If <code>TRUE</code> three plots are produced on the same scale showing the
predicted surface together with the estimated lower and upper uncertainties
at the 95% confidence interval. Calculating the uncertainties is useful to
understand whether features are real or not.  For example, at high wind
speeds where there are few data there is greater uncertainty over the
predicted values. The uncertainties are calculated using the GAM and
weighting is done by the frequency of measurements in each wind
speed-direction bin. Note that if uncertainties are calculated then the
type is set to &quot;default&quot;.</p>
</dd>
<dt><code>percentile</code></dt><dd><p>If <code>statistic = "percentile"</code> then <code>percentile</code>
is used, expressed from 0 to 100. Note that the percentile value is
calculated in the wind speed, wind direction &lsquo;bins&rsquo;. For this reason
it can also be useful to set <code>min.bin</code> to ensure there are a
sufficient number of points available to estimate a percentile. See
<code>quantile</code> for more details of how percentiles are calculated.
</p>
<p><code>percentile</code> is also used for the Conditional Probability Function
(CPF) plots. <code>percentile</code> can be of length two, in which case the
percentile <em>interval</em> is considered for use with CPF. For example,
<code>percentile = c(90, 100)</code> will plot the CPF for concentrations between
the 90 and 100th percentiles. Percentile intervals can be useful for
identifying specific sources. In addition, <code>percentile</code> can also be of
length 3. The third value is the &lsquo;trim&rsquo; value to be applied. When
calculating percentile intervals many can cover very low values where there
is no useful information. The trim value ensures that values greater than
or equal to the trim * mean value are considered <em>before</em> the
percentile intervals are calculated. The effect is to extract more detail
from many source signatures. See the manual for examples. Finally, if the
trim value is less than zero the percentile range is interpreted as
absolute concentration values and subsetting is carried out directly.</p>
</dd>
<dt><code>weights</code></dt><dd><p>At the edges of the plot there may only be a few data points
in each wind speed-direction interval, which could in some situations
distort the plot if the concentrations are high. <code>weights</code> applies a
weighting to reduce their influence. For example and by default if only a
single data point exists then the weighting factor is 0.25 and for two
points 0.5. To not apply any weighting and use the data as is, use
<code>weights = c(1, 1, 1)</code>.
</p>
<p>An alternative to down-weighting these points they can be removed
altogether using <code>min.bin</code>.</p>
</dd>
<dt><code>min.bin</code></dt><dd><p>The minimum number of points allowed in a wind speed/wind
direction bin.  The default is 1. A value of two requires at least 2 valid
records in each bin an so on; bins with less than 2 valid records are set
to NA. Care should be taken when using a value &gt; 1 because of the risk of
removing real data points. It is recommended to consider your data with
care. Also, the <code>polarFreq</code> function can be of use in such
circumstances.</p>
</dd>
<dt><code>mis.col</code></dt><dd><p>When <code>min.bin</code> is &gt; 1 it can be useful to show where data
are removed on the plots. This is done by shading the missing data in
<code>mis.col</code>. To not highlight missing data when <code>min.bin</code> &gt; 1
choose <code>mis.col = "transparent"</code>.</p>
</dd>
<dt><code>angle.scale</code></dt><dd><p>Sometimes the placement of the scale may interfere with an
interesting feature. The user can therefore set <code>angle.scale</code> to any
value between 0 and 360 degrees to mitigate such problems. For example
<code>angle.scale = 45</code> will draw the scale heading in a NE direction.</p>
</dd>
<dt><code>units</code></dt><dd><p>The units shown on the polar axis scale.</p>
</dd>
<dt><code>force.positive</code></dt><dd><p>The default is <code>TRUE</code>. Sometimes if smoothing data
with steep gradients it is possible for predicted values to be negative.
<code>force.positive = TRUE</code> ensures that predictions remain positive. This
is useful for several reasons. First, with lots of missing data more
interpolation is needed and this can result in artefacts because the
predictions are too far from the original data. Second, if it is known
beforehand that the data are all positive, then this option carries that
assumption through to the prediction. The only likely time where setting
<code>force.positive = FALSE</code> would be if background concentrations were
first subtracted resulting in data that is legitimately negative. For the
vast majority of situations it is expected that the user will not need to
alter the default option.</p>
</dd>
<dt><code>k</code></dt><dd><p>This is the smoothing parameter used by the <code>gam</code> function in
package <code>mgcv</code>. Typically, value of around 100 (the default) seems to
be suitable and will resolve important features in the plot. The most
appropriate choice of <code>k</code> is problem-dependent; but extensive testing
of polar plots for many different problems suggests a value of <code>k</code> of
about 100 is suitable. Setting <code>k</code> to higher values will not tend to
affect the surface predictions by much but will add to the computation
time. Lower values of <code>k</code> will increase smoothing. Sometimes with few
data to plot <code>polarPlot</code> will fail. Under these circumstances it can
be worth lowering the value of <code>k</code>.</p>
</dd>
<dt><code>normalise</code></dt><dd><p>If <code>TRUE</code> concentrations are normalised by dividing by
their mean value. This is done <em>after</em> fitting the smooth surface.
This option is particularly useful if one is interested in the patterns of
concentrations for several pollutants on different scales e.g. NOx and CO.
Often useful if more than one <code>pollutant</code> is chosen.</p>
</dd>
<dt><code>key.header</code></dt><dd><p>Adds additional text/labels to the scale key. For example,
passing the options <code>key.header = "header", key.footer = "footer1"</code>
adds addition text above and below the scale key. These arguments are
passed to <code>drawOpenKey</code> via <code>quickText</code>, applying the
<code>auto.text</code> argument, to handle formatting.</p>
</dd>
<dt><code>key.footer</code></dt><dd><p>see <code>key.footer</code>.</p>
</dd>
<dt><code>key.position</code></dt><dd><p>Location where the scale key is to plotted. Allowed
arguments currently include <code>"top"</code>, <code>"right"</code>, <code>"bottom"</code>
and <code>"left"</code>.</p>
</dd>
<dt><code>auto.text</code></dt><dd><p>Either <code>TRUE</code> (default) or <code>FALSE</code>. If <code>TRUE</code>
titles and axis labels will automatically try and format pollutant names
and units properly e.g.  by subscripting the &lsquo;2&rsquo; in NO2.</p>
</dd>
<dt><code>ws_spread</code></dt><dd><p>The value of sigma used for Gaussian kernel weighting of
wind speed when <code>statistic = "nwr"</code> or when correlation and regression
statistics are used such as <em>r</em>. Default is <code>0.5</code>.</p>
</dd>
<dt><code>wd_spread</code></dt><dd><p>The value of sigma used for Gaussian kernel weighting of
wind direction when <code>statistic = "nwr"</code> or when correlation and
regression statistics are used such as <em>r</em>. Default is <code>4</code>.</p>
</dd>
<dt><code>x_error</code></dt><dd><p>The <code>x</code> error / uncertainty used when <code>statistic =
"york_slope"</code>.</p>
</dd>
<dt><code>y_error</code></dt><dd><p>The <code>y</code> error / uncertainty used when <code>statistic =
"york_slope"</code>.</p>
</dd>
<dt><code>kernel</code></dt><dd><p>Type of kernel used for the weighting procedure for when
correlation or regression techniques are used. Only <code>"gaussian"</code> is
supported but this may be enhanced in the future.</p>
</dd>
<dt><code>formula.label</code></dt><dd><p>When pair-wise statistics such as regression slopes are
calculated and plotted, should a formula label be displayed?</p>
</dd>
<dt><code>tau</code></dt><dd><p>The quantile to be estimated when <code>statistic</code> is set to
<code>"quantile.slope"</code>. Default is <code>0.5</code> which is equal to the median
and will be ignored if <code>"quantile.slope"</code> is not used.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>A leaflet object.
</p>


<h3>See Also</h3>

<p>the original <code><a href="openair.html#topic+polarPlot">openair::polarPlot()</a></code>
</p>
<p><code><a href="#topic+polarMapStatic">polarMapStatic()</a></code> for the static <code>ggmap</code> equivalent of <code><a href="#topic+polarMap">polarMap()</a></code>
</p>
<p>Other interactive directional analysis maps: 
<code><a href="#topic+annulusMap">annulusMap</a>()</code>,
<code><a href="#topic+diffMap">diffMap</a>()</code>,
<code><a href="#topic+freqMap">freqMap</a>()</code>,
<code><a href="#topic+percentileMap">percentileMap</a>()</code>,
<code><a href="#topic+pollroseMap">pollroseMap</a>()</code>,
<code><a href="#topic+windroseMap">windroseMap</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
polarMap(polar_data,
  pollutant = "nox",
  x = "ws",
  provider = "Stamen.Toner"
)

## End(Not run)
</code></pre>

<hr>
<h2 id='polarMapStatic'>Bivariate polar plots on a static ggmap</h2><span id='topic+polarMapStatic'></span>

<h3>Description</h3>

<p><code><a href="#topic+polarMapStatic">polarMapStatic()</a></code> creates a <code>ggplot2</code> map using bivariate polar plots as
markers. As this function returns a <code>ggplot2</code> object, further customisation
can be achieved using functions like <code><a href="ggplot2.html#topic+theme">ggplot2::theme()</a></code> and
<code><a href="ggplot2.html#topic+guides">ggplot2::guides()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>polarMapStatic(
  data,
  pollutant = NULL,
  ggmap,
  x = "ws",
  limits = "free",
  upper = "fixed",
  latitude = NULL,
  longitude = NULL,
  facet = NULL,
  cols = "turbo",
  alpha = 1,
  key = FALSE,
  facet.nrow = NULL,
  d.icon = 150,
  d.fig = 3,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="polarMapStatic_+3A_data">data</code></td>
<td>
<p>A data frame. The data frame must contain the data to plot the
directional analysis marker, which includes wind speed (<code>ws</code>), wind
direction (<code>wd</code>), and the column representing the concentration of a
pollutant. In addition, <code>data</code> must include a decimal latitude and
longitude.</p>
</td></tr>
<tr><td><code id="polarMapStatic_+3A_pollutant">pollutant</code></td>
<td>
<p>The column name(s) of the pollutant(s) to plot. If multiple
pollutants are specified, they will each form part of a separate panel.</p>
</td></tr>
<tr><td><code id="polarMapStatic_+3A_ggmap">ggmap</code></td>
<td>
<p>A <code>ggmap</code> object obtained using <code><a href="ggmap.html#topic+get_map">ggmap::get_map()</a></code> or a similar
function to use as the basemap.</p>
</td></tr>
<tr><td><code id="polarMapStatic_+3A_x">x</code></td>
<td>
<p>The radial axis variable to plot.</p>
</td></tr>
<tr><td><code id="polarMapStatic_+3A_limits">limits</code></td>
<td>
<p>One of:
</p>

<ul>
<li> <p><code>"fixed"</code> which ensures all of the markers use the same colour scale.
</p>
</li>
<li> <p><code>"free"</code> (the default) which allows all of the markers to use different
colour scales.
</p>
</li>
<li><p> A numeric vector in the form <code>c(lower, upper)</code> used to define the colour
scale. For example, <code>limits = c(0, 100)</code> would force the plot limits to
span 0-100.
</p>
</li></ul>
</td></tr>
<tr><td><code id="polarMapStatic_+3A_upper">upper</code></td>
<td>
<p>One of:
</p>

<ul>
<li> <p><code>"fixed"</code> (the default) which ensures all of the markers use the same radial axis scale.
</p>
</li>
<li> <p><code>"free"</code> which allows all of the markers to use different radial axis scales.
</p>
</li>
<li><p> A numeric value, used as the upper limit for the radial axis scale.
</p>
</li></ul>
</td></tr>
<tr><td><code id="polarMapStatic_+3A_latitude">latitude</code>, <code id="polarMapStatic_+3A_longitude">longitude</code></td>
<td>
<p>The decimal latitude/longitude. If not provided,
will be automatically inferred from data by looking for a column named
&quot;lat&quot;/&quot;latitude&quot; or &quot;lon&quot;/&quot;lng&quot;/&quot;long&quot;/&quot;longitude&quot; (case-insensitively).</p>
</td></tr>
<tr><td><code id="polarMapStatic_+3A_facet">facet</code></td>
<td>
<p>Used for splitting the input data into different panels, passed
to the <code>type</code> argument of <code><a href="openair.html#topic+cutData">openair::cutData()</a></code>. <code>facet</code> cannot be used if
multiple <code>pollutant</code> columns have been provided.</p>
</td></tr>
<tr><td><code id="polarMapStatic_+3A_cols">cols</code></td>
<td>
<p>The colours used for plotting. See <code><a href="openair.html#topic+openColours">openair::openColours()</a></code> for
more information.</p>
</td></tr>
<tr><td><code id="polarMapStatic_+3A_alpha">alpha</code></td>
<td>
<p>The alpha transparency to use for the plotting surface (a value
between 0 and 1 with zero being fully transparent and 1 fully opaque).</p>
</td></tr>
<tr><td><code id="polarMapStatic_+3A_key">key</code></td>
<td>
<p>Should a key for each marker be drawn? Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="polarMapStatic_+3A_facet.nrow">facet.nrow</code></td>
<td>
<p>Passed to the <code>nrow</code> argument of <code><a href="ggplot2.html#topic+facet_wrap">ggplot2::facet_wrap()</a></code>.</p>
</td></tr>
<tr><td><code id="polarMapStatic_+3A_d.icon">d.icon</code></td>
<td>
<p>The diameter of the plot on the map in pixels. This will affect
the size of the individual polar markers. Alternatively, a vector in the
form <code>c(width, height)</code> can be provided if a non-circular marker is
desired.</p>
</td></tr>
<tr><td><code id="polarMapStatic_+3A_d.fig">d.fig</code></td>
<td>
<p>The diameter of the plots to be produced using <code>openair</code> in
inches. This will affect the resolution of the markers on the map.
Alternatively, a vector in the form <code>c(width, height)</code> can be provided if a
non-circular marker is desired.</p>
</td></tr>
<tr><td><code id="polarMapStatic_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="openair.html#topic+polarPlot">openair::polarPlot</a></code>
</p>

<dl>
<dt><code>wd</code></dt><dd><p>Name of wind direction field.</p>
</dd>
<dt><code>statistic</code></dt><dd><p>The statistic that should be applied to each wind
speed/direction bin. Because of the smoothing involved, the colour scale
for some of these statistics is only to provide an indication of overall
pattern and should not be interpreted in concentration units e.g. for
<code>statistic = "weighted.mean"</code> where the bin mean is multiplied by the
bin frequency and divided by the total frequency. In many cases using
<code>polarFreq</code> will be better. Setting <code>statistic = "weighted.mean"</code>
can be useful because it provides an indication of the concentration *
frequency of occurrence and will highlight the wind speed/direction
conditions that dominate the overall mean.Can be:
</p>
 <ul>
<li>  <p>&ldquo;mean&rdquo; (default), &ldquo;median&rdquo;, &ldquo;max&rdquo;
(maximum), &ldquo;frequency&rdquo;. &ldquo;stdev&rdquo; (standard deviation),
&ldquo;weighted.mean&rdquo;.
</p>
</li>
<li> <p><code>statistic = "nwr"</code> Implements the Non-parametric Wind
Regression approach of Henry et al. (2009) that uses kernel smoothers. The
<code>openair</code> implementation is not identical because Gaussian kernels are
used for both wind direction and speed. The smoothing is controlled by
<code>ws_spread</code> and <code>wd_spread</code>.
</p>
</li>
<li> <p><code>statistic = "cpf"</code> the conditional probability function (CPF)
is plotted and a single (usually high) percentile level is supplied. The
CPF is defined as CPF = my/ny, where my is the number of samples in the y
bin (by default a wind direction, wind speed interval) with mixing ratios
greater than the <em>overall</em> percentile concentration, and ny is the
total number of samples in the same wind sector (see Ashbaugh et al.,
1985). Note that percentile intervals can also be considered; see
<code>percentile</code> for details.
</p>
</li>
<li><p> When <code>statistic = "r"</code> or <code>statistic = "Pearson"</code>, the
Pearson correlation coefficient is calculated for <em>two</em> pollutants.
The calculation involves a weighted Pearson correlation coefficient, which
is weighted by Gaussian kernels for wind direction an the radial variable
(by default wind speed). More weight is assigned to values close to a wind
speed-direction interval. Kernel weighting is used to ensure that all data
are used rather than relying on the potentially small number of values in a
wind speed-direction interval.
</p>
</li>
<li><p> When <code>statistic = "Spearman"</code>, the Spearman correlation
coefficient is calculated for <em>two</em> pollutants. The calculation
involves a weighted Spearman correlation coefficient, which is weighted by
Gaussian kernels for wind direction an the radial variable (by default wind
speed). More weight is assigned to values close to a wind speed-direction
interval. Kernel weighting is used to ensure that all data are used rather
than relying on the potentially small number of values in a wind
speed-direction interval.
</p>
</li>
<li> <p><code>"robust_slope"</code> is another option for pair-wise statistics and
<code>"quantile.slope"</code>, which uses quantile regression to estimate the
slope for a particular quantile level (see also <code>tau</code> for setting the
quantile level).
</p>
</li>
<li> <p><code>"york_slope"</code> is another option for pair-wise statistics which
uses the <em>York regression method</em> to estimate the slope. In this
method the uncertainties in <code>x</code> and <code>y</code> are used in the
determination of the slope. The uncertainties are provided by
<code>x_error</code> and <code>y_error</code> &mdash; see below.</p>
</li></ul>
</dd>
<dt><code>exclude.missing</code></dt><dd><p>Setting this option to <code>TRUE</code> (the default)
removes points from the plot that are too far from the original data. The
smoothing routines will produce predictions at points where no data exist
i.e. they predict. By removing the points too far from the original data
produces a plot where it is clear where the original data lie. If set to
<code>FALSE</code> missing data will be interpolated.</p>
</dd>
<dt><code>uncertainty</code></dt><dd><p>Should the uncertainty in the calculated surface be shown?
If <code>TRUE</code> three plots are produced on the same scale showing the
predicted surface together with the estimated lower and upper uncertainties
at the 95% confidence interval. Calculating the uncertainties is useful to
understand whether features are real or not.  For example, at high wind
speeds where there are few data there is greater uncertainty over the
predicted values. The uncertainties are calculated using the GAM and
weighting is done by the frequency of measurements in each wind
speed-direction bin. Note that if uncertainties are calculated then the
type is set to &quot;default&quot;.</p>
</dd>
<dt><code>percentile</code></dt><dd><p>If <code>statistic = "percentile"</code> then <code>percentile</code>
is used, expressed from 0 to 100. Note that the percentile value is
calculated in the wind speed, wind direction &lsquo;bins&rsquo;. For this reason
it can also be useful to set <code>min.bin</code> to ensure there are a
sufficient number of points available to estimate a percentile. See
<code>quantile</code> for more details of how percentiles are calculated.
</p>
<p><code>percentile</code> is also used for the Conditional Probability Function
(CPF) plots. <code>percentile</code> can be of length two, in which case the
percentile <em>interval</em> is considered for use with CPF. For example,
<code>percentile = c(90, 100)</code> will plot the CPF for concentrations between
the 90 and 100th percentiles. Percentile intervals can be useful for
identifying specific sources. In addition, <code>percentile</code> can also be of
length 3. The third value is the &lsquo;trim&rsquo; value to be applied. When
calculating percentile intervals many can cover very low values where there
is no useful information. The trim value ensures that values greater than
or equal to the trim * mean value are considered <em>before</em> the
percentile intervals are calculated. The effect is to extract more detail
from many source signatures. See the manual for examples. Finally, if the
trim value is less than zero the percentile range is interpreted as
absolute concentration values and subsetting is carried out directly.</p>
</dd>
<dt><code>weights</code></dt><dd><p>At the edges of the plot there may only be a few data points
in each wind speed-direction interval, which could in some situations
distort the plot if the concentrations are high. <code>weights</code> applies a
weighting to reduce their influence. For example and by default if only a
single data point exists then the weighting factor is 0.25 and for two
points 0.5. To not apply any weighting and use the data as is, use
<code>weights = c(1, 1, 1)</code>.
</p>
<p>An alternative to down-weighting these points they can be removed
altogether using <code>min.bin</code>.</p>
</dd>
<dt><code>min.bin</code></dt><dd><p>The minimum number of points allowed in a wind speed/wind
direction bin.  The default is 1. A value of two requires at least 2 valid
records in each bin an so on; bins with less than 2 valid records are set
to NA. Care should be taken when using a value &gt; 1 because of the risk of
removing real data points. It is recommended to consider your data with
care. Also, the <code>polarFreq</code> function can be of use in such
circumstances.</p>
</dd>
<dt><code>mis.col</code></dt><dd><p>When <code>min.bin</code> is &gt; 1 it can be useful to show where data
are removed on the plots. This is done by shading the missing data in
<code>mis.col</code>. To not highlight missing data when <code>min.bin</code> &gt; 1
choose <code>mis.col = "transparent"</code>.</p>
</dd>
<dt><code>angle.scale</code></dt><dd><p>Sometimes the placement of the scale may interfere with an
interesting feature. The user can therefore set <code>angle.scale</code> to any
value between 0 and 360 degrees to mitigate such problems. For example
<code>angle.scale = 45</code> will draw the scale heading in a NE direction.</p>
</dd>
<dt><code>units</code></dt><dd><p>The units shown on the polar axis scale.</p>
</dd>
<dt><code>force.positive</code></dt><dd><p>The default is <code>TRUE</code>. Sometimes if smoothing data
with steep gradients it is possible for predicted values to be negative.
<code>force.positive = TRUE</code> ensures that predictions remain positive. This
is useful for several reasons. First, with lots of missing data more
interpolation is needed and this can result in artefacts because the
predictions are too far from the original data. Second, if it is known
beforehand that the data are all positive, then this option carries that
assumption through to the prediction. The only likely time where setting
<code>force.positive = FALSE</code> would be if background concentrations were
first subtracted resulting in data that is legitimately negative. For the
vast majority of situations it is expected that the user will not need to
alter the default option.</p>
</dd>
<dt><code>k</code></dt><dd><p>This is the smoothing parameter used by the <code>gam</code> function in
package <code>mgcv</code>. Typically, value of around 100 (the default) seems to
be suitable and will resolve important features in the plot. The most
appropriate choice of <code>k</code> is problem-dependent; but extensive testing
of polar plots for many different problems suggests a value of <code>k</code> of
about 100 is suitable. Setting <code>k</code> to higher values will not tend to
affect the surface predictions by much but will add to the computation
time. Lower values of <code>k</code> will increase smoothing. Sometimes with few
data to plot <code>polarPlot</code> will fail. Under these circumstances it can
be worth lowering the value of <code>k</code>.</p>
</dd>
<dt><code>normalise</code></dt><dd><p>If <code>TRUE</code> concentrations are normalised by dividing by
their mean value. This is done <em>after</em> fitting the smooth surface.
This option is particularly useful if one is interested in the patterns of
concentrations for several pollutants on different scales e.g. NOx and CO.
Often useful if more than one <code>pollutant</code> is chosen.</p>
</dd>
<dt><code>key.header</code></dt><dd><p>Adds additional text/labels to the scale key. For example,
passing the options <code>key.header = "header", key.footer = "footer1"</code>
adds addition text above and below the scale key. These arguments are
passed to <code>drawOpenKey</code> via <code>quickText</code>, applying the
<code>auto.text</code> argument, to handle formatting.</p>
</dd>
<dt><code>key.footer</code></dt><dd><p>see <code>key.footer</code>.</p>
</dd>
<dt><code>key.position</code></dt><dd><p>Location where the scale key is to plotted. Allowed
arguments currently include <code>"top"</code>, <code>"right"</code>, <code>"bottom"</code>
and <code>"left"</code>.</p>
</dd>
<dt><code>auto.text</code></dt><dd><p>Either <code>TRUE</code> (default) or <code>FALSE</code>. If <code>TRUE</code>
titles and axis labels will automatically try and format pollutant names
and units properly e.g.  by subscripting the &lsquo;2&rsquo; in NO2.</p>
</dd>
<dt><code>ws_spread</code></dt><dd><p>The value of sigma used for Gaussian kernel weighting of
wind speed when <code>statistic = "nwr"</code> or when correlation and regression
statistics are used such as <em>r</em>. Default is <code>0.5</code>.</p>
</dd>
<dt><code>wd_spread</code></dt><dd><p>The value of sigma used for Gaussian kernel weighting of
wind direction when <code>statistic = "nwr"</code> or when correlation and
regression statistics are used such as <em>r</em>. Default is <code>4</code>.</p>
</dd>
<dt><code>x_error</code></dt><dd><p>The <code>x</code> error / uncertainty used when <code>statistic =
"york_slope"</code>.</p>
</dd>
<dt><code>y_error</code></dt><dd><p>The <code>y</code> error / uncertainty used when <code>statistic =
"york_slope"</code>.</p>
</dd>
<dt><code>kernel</code></dt><dd><p>Type of kernel used for the weighting procedure for when
correlation or regression techniques are used. Only <code>"gaussian"</code> is
supported but this may be enhanced in the future.</p>
</dd>
<dt><code>formula.label</code></dt><dd><p>When pair-wise statistics such as regression slopes are
calculated and plotted, should a formula label be displayed?</p>
</dd>
<dt><code>tau</code></dt><dd><p>The quantile to be estimated when <code>statistic</code> is set to
<code>"quantile.slope"</code>. Default is <code>0.5</code> which is equal to the median
and will be ignored if <code>"quantile.slope"</code> is not used.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>ggplot2</code> plot with a <code>ggmap</code> basemap
</p>


<h3>Further customisation using ggplot2</h3>

<p>As the outputs of the static directional analysis functions are <code>ggplot2</code>
figures, further customisation is possible using functions such as
<code><a href="ggplot2.html#topic+theme">ggplot2::theme()</a></code>, <code><a href="ggplot2.html#topic+guides">ggplot2::guides()</a></code> and <code><a href="ggplot2.html#topic+labs">ggplot2::labs()</a></code>.
</p>
<p>If multiple pollutants are specified, subscripting (e.g., the &quot;x&quot; in &quot;NOx&quot;)
is achieved using the <a href="ggtext.html#topic+ggtext">ggtext</a> package. Therefore if you
choose to override the plot theme, it is recommended to use
<code style="white-space: pre;">&#8288;[ggplot2::theme()]&#8288;</code> and <code style="white-space: pre;">&#8288;[ggtext::element_markdown()]&#8288;</code> to define the
<code>strip.text</code> parameter.
</p>
<p>When arguments like <code>limits</code>, <code>percentile</code> or <code>breaks</code> are defined, a
legend is automatically added to the figure. Legends can be removed using
<code>ggplot2::theme(legend.position = "none")</code>, or further customised using
<code><a href="ggplot2.html#topic+guides">ggplot2::guides()</a></code> and either <code>color = ggplot2::guide_colourbar()</code> for
continuous legends or <code>fill = ggplot2::guide_legend()</code> for discrete
legends.
</p>


<h3>See Also</h3>

<p>the original <code><a href="openair.html#topic+polarPlot">openair::polarPlot()</a></code>
</p>
<p><code><a href="#topic+polarMap">polarMap()</a></code> for the interactive <code>leaflet</code> equivalent of
<code><a href="#topic+polarMapStatic">polarMapStatic()</a></code>
</p>
<p>Other static directional analysis maps: 
<code><a href="#topic+annulusMapStatic">annulusMapStatic</a>()</code>,
<code><a href="#topic+diffMapStatic">diffMapStatic</a>()</code>,
<code><a href="#topic+freqMapStatic">freqMapStatic</a>()</code>,
<code><a href="#topic+percentileMapStatic">percentileMapStatic</a>()</code>,
<code><a href="#topic+pollroseMapStatic">pollroseMapStatic</a>()</code>,
<code><a href="#topic+windroseMapStatic">windroseMapStatic</a>()</code>
</p>

<hr>
<h2 id='pollroseMap'>Pollution rose plots on interactive leaflet maps</h2><span id='topic+pollroseMap'></span>

<h3>Description</h3>

<p><code><a href="#topic+pollroseMap">pollroseMap()</a></code> creates a <code>leaflet</code> map using &quot;pollution roses&quot; as
markers. Any number of pollutants can be specified using the <code>pollutant</code>
argument, and multiple layers of markers can be added and toggled between
using <code>control</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pollroseMap(
  data,
  pollutant = NULL,
  statistic = "prop.count",
  breaks = NULL,
  latitude = NULL,
  longitude = NULL,
  control = NULL,
  popup = NULL,
  label = NULL,
  provider = "OpenStreetMap",
  cols = "turbo",
  alpha = 1,
  key = FALSE,
  draw.legend = TRUE,
  collapse.control = FALSE,
  d.icon = 200,
  d.fig = 3.5,
  type = deprecated(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pollroseMap_+3A_data">data</code></td>
<td>
<p>A data frame. The data frame must contain the data to plot the
directional analysis marker, which includes wind speed (<code>ws</code>), wind
direction (<code>wd</code>), and the column representing the concentration of a
pollutant. In addition, <code>data</code> must include a decimal latitude and
longitude.</p>
</td></tr>
<tr><td><code id="pollroseMap_+3A_pollutant">pollutant</code></td>
<td>
<p>The column name(s) of the pollutant(s) to plot. If multiple
pollutants are specified, they can be toggled between using a &quot;layer
control&quot; interface.</p>
</td></tr>
<tr><td><code id="pollroseMap_+3A_statistic">statistic</code></td>
<td>
<p>The <code>statistic</code> to be applied to each data bin in the
plot. Options currently include &quot;prop.count&quot;, &quot;prop.mean&quot; and
&quot;abs.count&quot;. The default &quot;prop.count&quot; sizes bins according to
the proportion of the frequency of measurements.  Similarly,
&quot;prop.mean&quot; sizes bins according to their relative contribution to
the mean. &quot;abs.count&quot; provides the absolute count of measurements in
each bin.</p>
</td></tr>
<tr><td><code id="pollroseMap_+3A_breaks">breaks</code></td>
<td>
<p>Most commonly, the number of break points. If not specified,
each marker will independently break its supplied data at approximately 6
sensible break points. When <code>breaks</code> are specified, all markers will
use the same break points. Breaks can also be used to set specific break
points. For example, the argument <code>breaks = c(0, 1, 10, 100)</code> breaks
the data into segments &lt;1, 1-10, 10-100, &gt;100.</p>
</td></tr>
<tr><td><code id="pollroseMap_+3A_latitude">latitude</code>, <code id="pollroseMap_+3A_longitude">longitude</code></td>
<td>
<p>The decimal latitude/longitude. If not provided,
will be automatically inferred from data by looking for a column named
&quot;lat&quot;/&quot;latitude&quot; or &quot;lon&quot;/&quot;lng&quot;/&quot;long&quot;/&quot;longitude&quot; (case-insensitively).</p>
</td></tr>
<tr><td><code id="pollroseMap_+3A_control">control</code></td>
<td>
<p>Used for splitting the input data into different groups which
can be selected between using a &quot;layer control&quot; interface, passed to the
<code>type</code> argument of <code><a href="openair.html#topic+cutData">openair::cutData()</a></code>. <code>control</code> cannot be used if
multiple <code>pollutant</code> columns have been provided.</p>
</td></tr>
<tr><td><code id="pollroseMap_+3A_popup">popup</code></td>
<td>
<p>Columns to be used as the HTML content for marker popups. Popups
may be useful to show information about the individual sites (e.g., site
names, codes, types, etc.). If a vector of column names are provided they
are passed to <code><a href="#topic+buildPopup">buildPopup()</a></code> using its default values.</p>
</td></tr>
<tr><td><code id="pollroseMap_+3A_label">label</code></td>
<td>
<p>Column to be used as the HTML content for hover-over labels.
Labels are useful for the same reasons as popups, though are typically
shorter.</p>
</td></tr>
<tr><td><code id="pollroseMap_+3A_provider">provider</code></td>
<td>
<p>The base map(s) to be used. See
<a href="http://leaflet-extras.github.io/leaflet-providers/preview/">http://leaflet-extras.github.io/leaflet-providers/preview/</a> for a list of
all base maps that can be used. If multiple base maps are provided, they
can be toggled between using a &quot;layer control&quot; interface. By default, the
interface will use the provider names as labels, but users can define their
own using a named vector (e.g., <code>c("Default" = "OpenStreetMap", "Satellite" = "Esri.WorldImagery")</code>)</p>
</td></tr>
<tr><td><code id="pollroseMap_+3A_cols">cols</code></td>
<td>
<p>The colours used for plotting. See <code><a href="openair.html#topic+openColours">openair::openColours()</a></code> for
more information.</p>
</td></tr>
<tr><td><code id="pollroseMap_+3A_alpha">alpha</code></td>
<td>
<p>The alpha transparency to use for the plotting surface (a value
between 0 and 1 with zero being fully transparent and 1 fully opaque).</p>
</td></tr>
<tr><td><code id="pollroseMap_+3A_key">key</code></td>
<td>
<p>Should a key for each marker be drawn? Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="pollroseMap_+3A_draw.legend">draw.legend</code></td>
<td>
<p>When <code>breaks</code> are specified, should a shared legend
be created at the side of the map? Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="pollroseMap_+3A_collapse.control">collapse.control</code></td>
<td>
<p>Should the &quot;layer control&quot; interface be collapsed?
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="pollroseMap_+3A_d.icon">d.icon</code></td>
<td>
<p>The diameter of the plot on the map in pixels. This will affect
the size of the individual polar markers. Alternatively, a vector in the
form <code>c(width, height)</code> can be provided if a non-circular marker is
desired.</p>
</td></tr>
<tr><td><code id="pollroseMap_+3A_d.fig">d.fig</code></td>
<td>
<p>The diameter of the plots to be produced using <code>openair</code> in
inches. This will affect the resolution of the markers on the map.
Alternatively, a vector in the form <code>c(width, height)</code> can be provided if a
non-circular marker is desired.</p>
</td></tr>
<tr><td><code id="pollroseMap_+3A_type">type</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>. Different sites are now
automatically detected based on latitude and longitude. Please use <code>label</code>
and/or <code>popup</code> to label different sites.</p>
</td></tr>
<tr><td><code id="pollroseMap_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="openair.html#topic+pollutionRose">openair::pollutionRose</a></code>
</p>

<dl>
<dt><code>key.footer</code></dt><dd><p>Adds additional text/labels below the scale key. See
<code>key.header</code> for further information.</p>
</dd>
<dt><code>key.position</code></dt><dd><p>Location where the scale key is to plotted. Allowed
arguments currently include &ldquo;top&rdquo;, &ldquo;right&rdquo;, &ldquo;bottom&rdquo;
and &ldquo;left&rdquo;.</p>
</dd>
<dt><code>paddle</code></dt><dd><p>Either <code>TRUE</code> or <code>FALSE</code>. If <code>TRUE</code> plots rose
using 'paddle' style spokes. If <code>FALSE</code> plots rose using 'wedge' style
spokes.</p>
</dd>
<dt><code>seg</code></dt><dd><p>When <code>paddle = TRUE</code>, <code>seg</code> determines with width of the
segments. For example, <code>seg = 0.5</code> will produce segments 0.5 *
<code>angle</code>.</p>
</dd>
<dt><code>normalise</code></dt><dd><p>If <code>TRUE</code> each wind direction segment is normalised to
equal one. This is useful for showing how the concentrations (or other
parameters) contribute to each wind sector when the proportion of time the
wind is from that direction is low. A line showing the probability that the
wind directions is from a particular wind sector is also shown.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>A leaflet object.
</p>


<h3>See Also</h3>

<p>the original <code><a href="openair.html#topic+pollutionRose">openair::pollutionRose()</a></code>
</p>
<p><code><a href="#topic+pollroseMapStatic">pollroseMapStatic()</a></code> for the static <code>ggmap</code> equivalent of
<code><a href="#topic+pollroseMap">pollroseMap()</a></code>
</p>
<p>Other interactive directional analysis maps: 
<code><a href="#topic+annulusMap">annulusMap</a>()</code>,
<code><a href="#topic+diffMap">diffMap</a>()</code>,
<code><a href="#topic+freqMap">freqMap</a>()</code>,
<code><a href="#topic+percentileMap">percentileMap</a>()</code>,
<code><a href="#topic+polarMap">polarMap</a>()</code>,
<code><a href="#topic+windroseMap">windroseMap</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
pollroseMap(polar_data,
  pollutant = "nox",
  statistic = "prop.count",
  provider = "Stamen.Toner"
)

## End(Not run)
</code></pre>

<hr>
<h2 id='pollroseMapStatic'>Percentile roses on a static ggmap</h2><span id='topic+pollroseMapStatic'></span>

<h3>Description</h3>

<p><code><a href="#topic+pollroseMapStatic">pollroseMapStatic()</a></code> creates a <code>ggplot2</code> map using percentile roses as
markers. As this function returns a <code>ggplot2</code> object, further customisation
can be achieved using functions like <code><a href="ggplot2.html#topic+theme">ggplot2::theme()</a></code> and
<code><a href="ggplot2.html#topic+guides">ggplot2::guides()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pollroseMapStatic(
  data,
  pollutant = NULL,
  ggmap,
  statistic = "prop.count",
  breaks = NULL,
  facet = NULL,
  latitude = NULL,
  longitude = NULL,
  cols = "turbo",
  alpha = 1,
  key = FALSE,
  facet.nrow = NULL,
  d.icon = 150,
  d.fig = 3,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pollroseMapStatic_+3A_data">data</code></td>
<td>
<p>A data frame. The data frame must contain the data to plot the
directional analysis marker, which includes wind speed (<code>ws</code>), wind
direction (<code>wd</code>), and the column representing the concentration of a
pollutant. In addition, <code>data</code> must include a decimal latitude and
longitude.</p>
</td></tr>
<tr><td><code id="pollroseMapStatic_+3A_pollutant">pollutant</code></td>
<td>
<p>The column name(s) of the pollutant(s) to plot. If multiple
pollutants are specified, they will each form part of a separate panel.</p>
</td></tr>
<tr><td><code id="pollroseMapStatic_+3A_ggmap">ggmap</code></td>
<td>
<p>A <code>ggmap</code> object obtained using <code><a href="ggmap.html#topic+get_map">ggmap::get_map()</a></code> or a similar
function to use as the basemap.</p>
</td></tr>
<tr><td><code id="pollroseMapStatic_+3A_statistic">statistic</code></td>
<td>
<p>The <code>statistic</code> to be applied to each data bin in the
plot. Options currently include &quot;prop.count&quot;, &quot;prop.mean&quot; and
&quot;abs.count&quot;. The default &quot;prop.count&quot; sizes bins according to
the proportion of the frequency of measurements.  Similarly,
&quot;prop.mean&quot; sizes bins according to their relative contribution to
the mean. &quot;abs.count&quot; provides the absolute count of measurements in
each bin.</p>
</td></tr>
<tr><td><code id="pollroseMapStatic_+3A_breaks">breaks</code></td>
<td>
<p>Most commonly, the number of break points. If not specified,
each marker will independently break its supplied data at approximately 6
sensible break points. When <code>breaks</code> are specified, all markers will
use the same break points. Breaks can also be used to set specific break
points. For example, the argument <code>breaks = c(0, 1, 10, 100)</code> breaks
the data into segments &lt;1, 1-10, 10-100, &gt;100.</p>
</td></tr>
<tr><td><code id="pollroseMapStatic_+3A_facet">facet</code></td>
<td>
<p>Used for splitting the input data into different panels, passed
to the <code>type</code> argument of <code><a href="openair.html#topic+cutData">openair::cutData()</a></code>. <code>facet</code> cannot be used if
multiple <code>pollutant</code> columns have been provided.</p>
</td></tr>
<tr><td><code id="pollroseMapStatic_+3A_latitude">latitude</code>, <code id="pollroseMapStatic_+3A_longitude">longitude</code></td>
<td>
<p>The decimal latitude/longitude. If not provided,
will be automatically inferred from data by looking for a column named
&quot;lat&quot;/&quot;latitude&quot; or &quot;lon&quot;/&quot;lng&quot;/&quot;long&quot;/&quot;longitude&quot; (case-insensitively).</p>
</td></tr>
<tr><td><code id="pollroseMapStatic_+3A_cols">cols</code></td>
<td>
<p>The colours used for plotting. See <code><a href="openair.html#topic+openColours">openair::openColours()</a></code> for
more information.</p>
</td></tr>
<tr><td><code id="pollroseMapStatic_+3A_alpha">alpha</code></td>
<td>
<p>The alpha transparency to use for the plotting surface (a value
between 0 and 1 with zero being fully transparent and 1 fully opaque).</p>
</td></tr>
<tr><td><code id="pollroseMapStatic_+3A_key">key</code></td>
<td>
<p>Should a key for each marker be drawn? Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="pollroseMapStatic_+3A_facet.nrow">facet.nrow</code></td>
<td>
<p>Passed to the <code>nrow</code> argument of <code><a href="ggplot2.html#topic+facet_wrap">ggplot2::facet_wrap()</a></code>.</p>
</td></tr>
<tr><td><code id="pollroseMapStatic_+3A_d.icon">d.icon</code></td>
<td>
<p>The diameter of the plot on the map in pixels. This will affect
the size of the individual polar markers. Alternatively, a vector in the
form <code>c(width, height)</code> can be provided if a non-circular marker is
desired.</p>
</td></tr>
<tr><td><code id="pollroseMapStatic_+3A_d.fig">d.fig</code></td>
<td>
<p>The diameter of the plots to be produced using <code>openair</code> in
inches. This will affect the resolution of the markers on the map.
Alternatively, a vector in the form <code>c(width, height)</code> can be provided if a
non-circular marker is desired.</p>
</td></tr>
<tr><td><code id="pollroseMapStatic_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="openair.html#topic+pollutionRose">openair::pollutionRose</a></code>
</p>

<dl>
<dt><code>key.footer</code></dt><dd><p>Adds additional text/labels below the scale key. See
<code>key.header</code> for further information.</p>
</dd>
<dt><code>key.position</code></dt><dd><p>Location where the scale key is to plotted. Allowed
arguments currently include &ldquo;top&rdquo;, &ldquo;right&rdquo;, &ldquo;bottom&rdquo;
and &ldquo;left&rdquo;.</p>
</dd>
<dt><code>paddle</code></dt><dd><p>Either <code>TRUE</code> or <code>FALSE</code>. If <code>TRUE</code> plots rose
using 'paddle' style spokes. If <code>FALSE</code> plots rose using 'wedge' style
spokes.</p>
</dd>
<dt><code>seg</code></dt><dd><p>When <code>paddle = TRUE</code>, <code>seg</code> determines with width of the
segments. For example, <code>seg = 0.5</code> will produce segments 0.5 *
<code>angle</code>.</p>
</dd>
<dt><code>normalise</code></dt><dd><p>If <code>TRUE</code> each wind direction segment is normalised to
equal one. This is useful for showing how the concentrations (or other
parameters) contribute to each wind sector when the proportion of time the
wind is from that direction is low. A line showing the probability that the
wind directions is from a particular wind sector is also shown.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>ggplot2</code> plot with a <code>ggmap</code> basemap
</p>


<h3>Further customisation using ggplot2</h3>

<p>As the outputs of the static directional analysis functions are <code>ggplot2</code>
figures, further customisation is possible using functions such as
<code><a href="ggplot2.html#topic+theme">ggplot2::theme()</a></code>, <code><a href="ggplot2.html#topic+guides">ggplot2::guides()</a></code> and <code><a href="ggplot2.html#topic+labs">ggplot2::labs()</a></code>.
</p>
<p>If multiple pollutants are specified, subscripting (e.g., the &quot;x&quot; in &quot;NOx&quot;)
is achieved using the <a href="ggtext.html#topic+ggtext">ggtext</a> package. Therefore if you
choose to override the plot theme, it is recommended to use
<code style="white-space: pre;">&#8288;[ggplot2::theme()]&#8288;</code> and <code style="white-space: pre;">&#8288;[ggtext::element_markdown()]&#8288;</code> to define the
<code>strip.text</code> parameter.
</p>
<p>When arguments like <code>limits</code>, <code>percentile</code> or <code>breaks</code> are defined, a
legend is automatically added to the figure. Legends can be removed using
<code>ggplot2::theme(legend.position = "none")</code>, or further customised using
<code><a href="ggplot2.html#topic+guides">ggplot2::guides()</a></code> and either <code>color = ggplot2::guide_colourbar()</code> for
continuous legends or <code>fill = ggplot2::guide_legend()</code> for discrete
legends.
</p>


<h3>See Also</h3>

<p>the original <code><a href="openair.html#topic+pollutionRose">openair::pollutionRose()</a></code>
</p>
<p><code><a href="#topic+pollroseMap">pollroseMap()</a></code> for the interactive <code>leaflet</code> equivalent of
<code><a href="#topic+pollroseMapStatic">pollroseMapStatic()</a></code>
</p>
<p>Other static directional analysis maps: 
<code><a href="#topic+annulusMapStatic">annulusMapStatic</a>()</code>,
<code><a href="#topic+diffMapStatic">diffMapStatic</a>()</code>,
<code><a href="#topic+freqMapStatic">freqMapStatic</a>()</code>,
<code><a href="#topic+percentileMapStatic">percentileMapStatic</a>()</code>,
<code><a href="#topic+polarMapStatic">polarMapStatic</a>()</code>,
<code><a href="#topic+windroseMapStatic">windroseMapStatic</a>()</code>
</p>

<hr>
<h2 id='quickTextHTML'>Automatic text formatting for openairmaps</h2><span id='topic+quickTextHTML'></span>

<h3>Description</h3>

<p>Workhorse function that automatically applies routine text formatting to
common pollutant names which may be used in the HTML widgets produced by
<code>openairmaps</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>quickTextHTML(text)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="quickTextHTML_+3A_text">text</code></td>
<td>
<p>A character vector.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code><a href="#topic+quickTextHTML">quickTextHTML()</a></code> is routine formatting lookup table. It screens the supplied
character vector <code>text</code> and automatically applies formatting to any
recognised character sub-series to properly render in HTML.
</p>


<h3>Value</h3>

<p>The function returns a character vector for HTML evaluation.
</p>


<h3>Author(s)</h3>

<p>Jack Davison.
</p>


<h3>See Also</h3>

<p>The original <code><a href="openair.html#topic+quickText">openair::quickText()</a></code>, useful for non-HTML/static maps
and plots
</p>


<h3>Examples</h3>

<pre><code class='language-R'>labs &lt;- c("no2", "o3", "so2")
quickTextHTML(labs)

</code></pre>

<hr>
<h2 id='searchNetwork'>Geographically search the air quality networks made available by
<code><a href="openair.html#topic+importMeta">openair::importMeta()</a></code></h2><span id='topic+searchNetwork'></span>

<h3>Description</h3>

<p>While <code><a href="#topic+networkMap">networkMap()</a></code> visualises entire UK air quality networks,
<code><a href="#topic+searchNetwork">searchNetwork()</a></code> can subset specific networks to find air quality sites near
to a specific site of interest (for example, the location of known industrial
activity, or the centroid of a specific urban area).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>searchNetwork(
  lat,
  lng,
  source = "aurn",
  year = NULL,
  site_type = NULL,
  variable = NULL,
  max_dist = NULL,
  n = NULL,
  map = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="searchNetwork_+3A_lat">lat</code>, <code id="searchNetwork_+3A_lng">lng</code></td>
<td>
<p>The latitude and longitude for the location of interest.</p>
</td></tr>
<tr><td><code id="searchNetwork_+3A_source">source</code></td>
<td>
<p>One or more air quality networks for which data is available
through openair. Available networks include:
</p>

<ul>
<li> <p><code>"aurn"</code>,  The UK Automatic Urban and Rural Network.
</p>
</li>
<li> <p><code>"aqe"</code>,  The Air Quality England Network.
</p>
</li>
<li> <p><code>"saqn"</code>,  The Scottish Air Quality Network.
</p>
</li>
<li> <p><code>"waqn"</code>,  The Welsh Air Quality Network.
</p>
</li>
<li> <p><code>"ni"</code>,  The Northern Ireland Air Quality Network.
</p>
</li>
<li> <p><code>"local"</code>,  Locally managed air quality networks in England.
</p>
</li>
<li> <p><code>"kcl"</code>, King's College London networks.
</p>
</li>
<li> <p><code>"europe"</code>, European AirBase/e-reporting data.
There are two additional options provided for convenience:
</p>
</li>
<li> <p><code>"ukaq"</code> will return metadata for all networks for which data is imported by <code><a href="openair.html#topic+importUKAQ">importUKAQ()</a></code> (i.e., AURN, AQE, SAQN, WAQN, NI, and the local networks).
</p>
</li>
<li> <p><code>"all"</code> will import all available metadata (i.e., <code>"ukaq"</code> plus <code>"kcl"</code> and <code>"europe"</code>).
</p>
</li></ul>
</td></tr>
<tr><td><code id="searchNetwork_+3A_year">year</code></td>
<td>
<p>If a single year is selected, only sites that were open at some
point in that year are returned. If <code>all = TRUE</code> only sites that
measured a particular pollutant in that year are returned. Year can also be
a sequence e.g. <code>year = 2010:2020</code> or of length 2 e.g. <code>year = c(2010, 2020)</code>, which will return only sites that were open over the
duration. Note that <code>year</code> is ignored when the <code>source</code> is either
<code>"kcl"</code> or <code>"europe"</code>.</p>
</td></tr>
<tr><td><code id="searchNetwork_+3A_site_type">site_type</code></td>
<td>
<p>Optional. One or more site types with which to subset the
site metadata. For example, <code>site_type = "urban background"</code> will only
search urban background sites.</p>
</td></tr>
<tr><td><code id="searchNetwork_+3A_variable">variable</code></td>
<td>
<p>Optional. One or more variables of interest with which to
subset the site metadata. For example, <code>variable = c("pm10", "co")</code> will
search sites that measure PM10 and/or CO.</p>
</td></tr>
<tr><td><code id="searchNetwork_+3A_max_dist">max_dist</code></td>
<td>
<p>Optional. A maximum distance from the location of interest in
kilometres.</p>
</td></tr>
<tr><td><code id="searchNetwork_+3A_n">n</code></td>
<td>
<p>Optional. The maximum number of sites to return.</p>
</td></tr>
<tr><td><code id="searchNetwork_+3A_map">map</code></td>
<td>
<p>If <code>TRUE</code>, the default, <code><a href="#topic+searchNetwork">searchNetwork()</a></code> will return a <code>leaflet</code>
map. If <code>FALSE</code>, it will instead return a <a href="tibble.html#topic+tibble-package">tibble</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Data subsetting progresses in the order in which the arguments are given;
first <code>source</code> and <code>year</code>, then <code>site_type</code> and <code>variable</code>, then <code>max_dist</code>,
and finally <code>n</code>.
</p>


<h3>Value</h3>

<p>Either a <a href="tibble.html#topic+tibble-package">tibble</a> or <code>leaflet</code> map.
</p>


<h3>See Also</h3>

<p>Other uk air quality network mapping functions: 
<code><a href="#topic+networkMap">networkMap</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# get all AURN sites open in 2020 within 20 km of Buckingham Palace
palace &lt;- convertPostcode("SW1A1AA")
searchNetwork(lat = palace$lat, lng = palace$lng, max_dist = 20, year = 2020)

## End(Not run)
</code></pre>

<hr>
<h2 id='traj_data'>Example data for trajectory mapping functions</h2><span id='topic+traj_data'></span>

<h3>Description</h3>

<p>The <code>traj_data</code> dataset is provided as an example dataset as part of the
<code>openairmaps</code> package. The dataset contains HYSPLIT back trajectory data for
air mass parcels arriving in London in 2009. It has been joined with air
quality pollutant concentrations from the &quot;London N. Kensington&quot; AURN urban
background monitoring site.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>traj_data
</code></pre>


<h3>Format</h3>

<p>A data frame with 53940 rows and 10 variables:
</p>

<dl>
<dt>date</dt><dd><p>The arrival time of the air-mass</p>
</dd>
<dt>receptor</dt><dd><p>The receptor number</p>
</dd>
<dt>year</dt><dd><p>Trajectory year</p>
</dd>
<dt>month</dt><dd><p>Trajectory month</p>
</dd>
<dt>day</dt><dd><p>Trajectory day</p>
</dd>
<dt>hour</dt><dd><p>Trajectory hour</p>
</dd>
<dt>hour.inc</dt><dd><p>Trajectory hour offset from the arrival date</p>
</dd>
<dt>lat</dt><dd><p>Latitude</p>
</dd>
<dt>lon</dt><dd><p>Longitude</p>
</dd>
<dt>height</dt><dd><p>Height of trajectory in m</p>
</dd>
<dt>pressure</dt><dd><p>Pressure of the trajectory in Pa</p>
</dd>
<dt>date2</dt><dd><p>Date of the trajectory</p>
</dd>
<dt>nox</dt><dd><p>Concentration of oxides of nitrogen (NO + NO2)</p>
</dd>
<dt>no2</dt><dd><p>Concentration of nitrogen dioxide (NO2)</p>
</dd>
<dt>o3</dt><dd><p>Concentration of ozone (O3)</p>
</dd>
<dt>pm10</dt><dd><p>Concentration of particulates (PM10)</p>
</dd>
<dt>pm2.5</dt><dd><p>Concentration of fine particulates (PM2.5)</p>
</dd>
</dl>



<h3>Details</h3>

<p><code>traj_data</code> is supplied with the <code>openairmaps</code> package as an example dataset
for use with documented examples.
</p>


<h3>Source</h3>

<p><code>traj_data</code> was compiled from data using the <code><a href="openair.html#topic+importTraj">openair::importTraj()</a></code>
function from the <code>openair</code> package with air quality data from
<code><a href="openair.html#topic+importUKAQ-wrapper">openair::importAURN()</a></code> function.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# basic structure
head(traj_data)
</code></pre>

<hr>
<h2 id='trajLevelMap'>Trajectory level plots in <code>leaflet</code></h2><span id='topic+trajLevelMap'></span>

<h3>Description</h3>

<p>This function plots back trajectories on a <code>leaflet</code> map. This function
requires that data are imported using the <code><a href="openair.html#topic+importTraj">openair::importTraj()</a></code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trajLevelMap(
  data,
  longitude = "lon",
  latitude = "lat",
  pollutant,
  control = "default",
  smooth = FALSE,
  statistic = "frequency",
  percentile = 90,
  lon.inc = 1,
  lat.inc = 1,
  min.bin = 1,
  .combine = NA,
  sigma = 1.5,
  cols = "default",
  alpha = 0.5,
  tile.border = NA,
  provider = "OpenStreetMap"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="trajLevelMap_+3A_data">data</code></td>
<td>
<p>Data frame, the result of importing a trajectory file using
<code><a href="openair.html#topic+importTraj">openair::importTraj()</a></code>.</p>
</td></tr>
<tr><td><code id="trajLevelMap_+3A_latitude">latitude</code>, <code id="trajLevelMap_+3A_longitude">longitude</code></td>
<td>
<p>The decimal latitude/longitude.</p>
</td></tr>
<tr><td><code id="trajLevelMap_+3A_pollutant">pollutant</code></td>
<td>
<p>Pollutant to be plotted. By default the trajectory height is
used.</p>
</td></tr>
<tr><td><code id="trajLevelMap_+3A_control">control</code></td>
<td>
<p>Used for splitting the trajectories into different groups
which can be selected between using a &quot;layer control&quot; menu. Passed to
<code><a href="openair.html#topic+cutData">openair::cutData()</a></code>.</p>
</td></tr>
<tr><td><code id="trajLevelMap_+3A_smooth">smooth</code></td>
<td>
<p>Should the trajectory surface be smoothed? Defaults to <code>FALSE</code>.
Note that, when <code>smooth = TRUE</code>, no popup information will be available.</p>
</td></tr>
<tr><td><code id="trajLevelMap_+3A_statistic">statistic</code></td>
<td>
<p>Statistic to use for <code><a href="openair.html#topic+trajLevel">trajLevel()</a></code>. By default, the function
will plot the trajectory frequencies (<code>statistic = "frequency"</code>). As an
alternative way of viewing trajectory frequencies, the argument <code>method = "hexbin"</code> can be used. In this case hexagonal binning of the trajectory
<em>points</em> (i.e., a point every three hours along each back trajectory).
The plot then shows the trajectory frequencies uses hexagonal binning.
</p>
<p>There are also various ways of plotting concentrations.
</p>
<p>It is possible to set <code>statistic = "difference"</code>. In this case trajectories
where the associated concentration is greater than <code>percentile</code> are
compared with the the full set of trajectories to understand the
differences in frequencies of the origin of air masses. The comparison is
made by comparing the percentage change in gridded frequencies. For
example, such a plot could show that the top 10\
tend to originate from air-mass origins to the east.
</p>
<p>If <code>statistic = "pscf"</code> then a Potential Source Contribution Function map
is produced. This statistic method interacts with <code>percentile</code>.
</p>
<p>If <code>statistic = "cwt"</code> then concentration weighted trajectories are
plotted.
</p>
<p>If <code>statistic = "sqtba"</code> then Simplified Quantitative Transport Bias
Analysis is undertaken. This statistic method interacts with <code>.combine</code> and
<code>sigma</code>.</p>
</td></tr>
<tr><td><code id="trajLevelMap_+3A_percentile">percentile</code></td>
<td>
<p>The percentile concentration of <code>pollutant</code> against which
the all trajectories are compared.</p>
</td></tr>
<tr><td><code id="trajLevelMap_+3A_lon.inc">lon.inc</code>, <code id="trajLevelMap_+3A_lat.inc">lat.inc</code></td>
<td>
<p>The longitude and latitude intervals to be used for
binning data.</p>
</td></tr>
<tr><td><code id="trajLevelMap_+3A_min.bin">min.bin</code></td>
<td>
<p>The minimum number of unique points in a grid cell. Counts
below <code>min.bin</code> are set as missing.</p>
</td></tr>
<tr><td><code id="trajLevelMap_+3A_.combine">.combine</code></td>
<td>
<p>When statistic is &quot;SQTBA&quot; it is possible to combine lots of
receptor locations to derive a single map. <code>.combine</code> identifies the column
that differentiates different sites (commonly a column named <code>"site"</code>).
Note that individual site maps are normalised first by dividing by their
mean value.</p>
</td></tr>
<tr><td><code id="trajLevelMap_+3A_sigma">sigma</code></td>
<td>
<p>For the SQTBA approach <code>sigma</code> determines the amount of back
trajectory spread based on the Gaussian plume equation. Values in the
literature suggest 5.4 km after one hour. However, testing suggests lower
values reveal source regions more effectively while not introducing too
much noise.</p>
</td></tr>
<tr><td><code id="trajLevelMap_+3A_cols">cols</code></td>
<td>
<p>Colours to be used for plotting. Options include &quot;default&quot;,
&quot;increment&quot;, &quot;heat&quot;, &quot;turbo&quot; and <code>RColorBrewer</code> colours — see the
<code><a href="openair.html#topic+openColours">openair::openColours()</a></code> function for more details. For user defined the
user can supply a list of colour names recognised by R (type
<code><a href="grDevices.html#topic+colors">grDevices::colours()</a></code> to see the full list). An example would be <code>cols = c("yellow", "green", "blue")</code>.</p>
</td></tr>
<tr><td><code id="trajLevelMap_+3A_alpha">alpha</code></td>
<td>
<p>Opacity of the tiles. Must be between <code>0</code> and <code>1</code>.</p>
</td></tr>
<tr><td><code id="trajLevelMap_+3A_tile.border">tile.border</code></td>
<td>
<p>Colour to use for the border of binned tiles. Defaults to
<code>NA</code>, which draws no border.</p>
</td></tr>
<tr><td><code id="trajLevelMap_+3A_provider">provider</code></td>
<td>
<p>The base map to be used. See
<a href="http://leaflet-extras.github.io/leaflet-providers/preview/">http://leaflet-extras.github.io/leaflet-providers/preview/</a> for a list of
all base maps that can be used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A leaflet object.
</p>


<h3>See Also</h3>

<p>the original <code><a href="openair.html#topic+trajLevel">openair::trajLevel()</a></code>
</p>
<p><code><a href="#topic+trajLevelMapStatic">trajLevelMapStatic()</a></code> for the static <code>ggplot2</code> equivalent of <code><a href="#topic+trajLevelMap">trajLevelMap()</a></code>
</p>
<p>Other interactive trajectory maps: 
<code><a href="#topic+trajMap">trajMap</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
trajLevelMap(traj_data, pollutant = "pm2.5", statistic = "pscf", min.bin = 10)

## End(Not run)

</code></pre>

<hr>
<h2 id='trajLevelMapStatic'>Trajectory level plots in <code>ggplot2</code></h2><span id='topic+trajLevelMapStatic'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>
<p>This function plots back trajectories on a <code>ggplot2</code> map. This function
requires that data are imported using the <code><a href="openair.html#topic+importTraj">openair::importTraj()</a></code> function.
It is a <code>ggplot2</code> implementation of <code><a href="openair.html#topic+trajLevel">openair::trajLevel()</a></code> with many of the
same arguments, which should be more flexible for post-hoc changes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trajLevelMapStatic(
  data,
  longitude = "lon",
  latitude = "lat",
  pollutant,
  facet = "default",
  smooth = FALSE,
  statistic = "frequency",
  percentile = 90,
  lon.inc = 1,
  lat.inc = 1,
  min.bin = 1,
  .combine = NA,
  sigma = 1.5,
  alpha = 0.5,
  tile.border = NA,
  xlim = NULL,
  ylim = NULL,
  crs = sf::st_crs(4326),
  map = TRUE,
  map.fill = "grey85",
  map.colour = "grey75",
  map.alpha = 0.8,
  map.lwd = 0.5,
  map.lty = 1,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="trajLevelMapStatic_+3A_data">data</code></td>
<td>
<p>Data frame, the result of importing a trajectory file using
<code><a href="openair.html#topic+importTraj">openair::importTraj()</a></code>.</p>
</td></tr>
<tr><td><code id="trajLevelMapStatic_+3A_latitude">latitude</code>, <code id="trajLevelMapStatic_+3A_longitude">longitude</code></td>
<td>
<p>The decimal latitude/longitude.</p>
</td></tr>
<tr><td><code id="trajLevelMapStatic_+3A_pollutant">pollutant</code></td>
<td>
<p>Pollutant to be plotted. By default the trajectory height is
used.</p>
</td></tr>
<tr><td><code id="trajLevelMapStatic_+3A_facet">facet</code></td>
<td>
<p>Used for splitting the trajectories into different panels.
Passed to <code><a href="openair.html#topic+cutData">openair::cutData()</a></code>.</p>
</td></tr>
<tr><td><code id="trajLevelMapStatic_+3A_smooth">smooth</code></td>
<td>
<p>Should the trajectory surface be smoothed? Defaults to <code>FALSE</code>.
Note that smoothing may cause the plot to render slower, so consider
setting <code>crs</code> to <code>sf::st_crs(4326)</code> or <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="trajLevelMapStatic_+3A_statistic">statistic</code></td>
<td>
<p>Statistic to use for <code><a href="openair.html#topic+trajLevel">trajLevel()</a></code>. By default, the function
will plot the trajectory frequencies (<code>statistic = "frequency"</code>). As an
alternative way of viewing trajectory frequencies, the argument <code>method = "hexbin"</code> can be used. In this case hexagonal binning of the trajectory
<em>points</em> (i.e., a point every three hours along each back trajectory).
The plot then shows the trajectory frequencies uses hexagonal binning.
</p>
<p>There are also various ways of plotting concentrations.
</p>
<p>It is possible to set <code>statistic = "difference"</code>. In this case trajectories
where the associated concentration is greater than <code>percentile</code> are
compared with the the full set of trajectories to understand the
differences in frequencies of the origin of air masses. The comparison is
made by comparing the percentage change in gridded frequencies. For
example, such a plot could show that the top 10\
tend to originate from air-mass origins to the east.
</p>
<p>If <code>statistic = "pscf"</code> then a Potential Source Contribution Function map
is produced. This statistic method interacts with <code>percentile</code>.
</p>
<p>If <code>statistic = "cwt"</code> then concentration weighted trajectories are
plotted.
</p>
<p>If <code>statistic = "sqtba"</code> then Simplified Quantitative Transport Bias
Analysis is undertaken. This statistic method interacts with <code>.combine</code> and
<code>sigma</code>.</p>
</td></tr>
<tr><td><code id="trajLevelMapStatic_+3A_percentile">percentile</code></td>
<td>
<p>The percentile concentration of <code>pollutant</code> against which
the all trajectories are compared.</p>
</td></tr>
<tr><td><code id="trajLevelMapStatic_+3A_lon.inc">lon.inc</code>, <code id="trajLevelMapStatic_+3A_lat.inc">lat.inc</code></td>
<td>
<p>The longitude and latitude intervals to be used for
binning data.</p>
</td></tr>
<tr><td><code id="trajLevelMapStatic_+3A_min.bin">min.bin</code></td>
<td>
<p>The minimum number of unique points in a grid cell. Counts
below <code>min.bin</code> are set as missing.</p>
</td></tr>
<tr><td><code id="trajLevelMapStatic_+3A_.combine">.combine</code></td>
<td>
<p>When statistic is &quot;SQTBA&quot; it is possible to combine lots of
receptor locations to derive a single map. <code>.combine</code> identifies the column
that differentiates different sites (commonly a column named <code>"site"</code>).
Note that individual site maps are normalised first by dividing by their
mean value.</p>
</td></tr>
<tr><td><code id="trajLevelMapStatic_+3A_sigma">sigma</code></td>
<td>
<p>For the SQTBA approach <code>sigma</code> determines the amount of back
trajectory spread based on the Gaussian plume equation. Values in the
literature suggest 5.4 km after one hour. However, testing suggests lower
values reveal source regions more effectively while not introducing too
much noise.</p>
</td></tr>
<tr><td><code id="trajLevelMapStatic_+3A_alpha">alpha</code></td>
<td>
<p>Opacity of the tiles. Must be between <code>0</code> and <code>1</code>.</p>
</td></tr>
<tr><td><code id="trajLevelMapStatic_+3A_tile.border">tile.border</code></td>
<td>
<p>Colour to use for the border of binned tiles. Defaults to
<code>NA</code>, which draws no border.</p>
</td></tr>
<tr><td><code id="trajLevelMapStatic_+3A_xlim">xlim</code>, <code id="trajLevelMapStatic_+3A_ylim">ylim</code></td>
<td>
<p>The x- and y-limits of the plot. If <code>NULL</code>, limits will be
estimated based on the lat/lon ranges of the input data.</p>
</td></tr>
<tr><td><code id="trajLevelMapStatic_+3A_crs">crs</code></td>
<td>
<p>The coordinate reference system (CRS) into which all data should
be projected before plotting. Defaults to latitude/longitude
(<code>sf::st_crs(4326)</code>).</p>
</td></tr>
<tr><td><code id="trajLevelMapStatic_+3A_map">map</code></td>
<td>
<p>Should a base map be drawn? Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="trajLevelMapStatic_+3A_map.fill">map.fill</code></td>
<td>
<p>Colour to use to fill the polygons of the base map (see
<code>colors()</code>).</p>
</td></tr>
<tr><td><code id="trajLevelMapStatic_+3A_map.colour">map.colour</code></td>
<td>
<p>Colour to use for the polygon borders of the base map (see
<code>colors()</code>).</p>
</td></tr>
<tr><td><code id="trajLevelMapStatic_+3A_map.alpha">map.alpha</code></td>
<td>
<p>Transparency of the base map polygons. Must be between <code>0</code>
(fully transparent) and <code>1</code> (fully opaque).</p>
</td></tr>
<tr><td><code id="trajLevelMapStatic_+3A_map.lwd">map.lwd</code></td>
<td>
<p>Line width of the base map polygon borders.</p>
</td></tr>
<tr><td><code id="trajLevelMapStatic_+3A_map.lty">map.lty</code></td>
<td>
<p>Line type of the base map polygon borders. See
<code><a href="ggplot2.html#topic+scale_linetype">ggplot2::scale_linetype()</a></code> for common examples.</p>
</td></tr>
<tr><td><code id="trajLevelMapStatic_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="ggplot2.html#topic+ggsf">ggplot2::coord_sf</a></code>
</p>

<dl>
<dt><code>expand</code></dt><dd><p>If <code>TRUE</code>, the default, adds a small expansion factor to
the limits to ensure that data and axes don't overlap. If <code>FALSE</code>,
limits are taken exactly from the data or <code>xlim</code>/<code>ylim</code>.</p>
</dd>
<dt><code>datum</code></dt><dd><p>CRS that provides datum to use when generating graticules.</p>
</dd>
<dt><code>label_graticule</code></dt><dd><p>Character vector indicating which graticule lines should be labeled
where. Meridians run north-south, and the letters <code>"N"</code> and <code>"S"</code> indicate that
they should be labeled on their north or south end points, respectively.
Parallels run east-west, and the letters <code>"E"</code> and <code>"W"</code> indicate that they
should be labeled on their east or west end points, respectively. Thus,
<code>label_graticule = "SW"</code> would label meridians at their south end and parallels at
their west end, whereas <code>label_graticule = "EW"</code> would label parallels at both
ends and meridians not at all. Because meridians and parallels can in general
intersect with any side of the plot panel, for any choice of <code>label_graticule</code> labels
are not guaranteed to reside on only one particular side of the plot panel. Also,
<code>label_graticule</code> can cause labeling artifacts, in particular if a graticule line
coincides with the edge of the plot panel. In such circumstances, <code>label_axes</code> will
generally yield better results and should be used instead.
</p>
<p>This parameter can be used alone or in combination with <code>label_axes</code>.</p>
</dd>
<dt><code>label_axes</code></dt><dd><p>Character vector or named list of character values
specifying which graticule lines (meridians or parallels) should be labeled on
which side of the plot. Meridians are indicated by <code>"E"</code> (for East) and
parallels by <code>"N"</code> (for North). Default is <code>"--EN"</code>, which specifies
(clockwise from the top) no labels on the top, none on the right, meridians
on the bottom, and parallels on the left. Alternatively, this setting could have been
specified with <code>list(bottom = "E", left = "N")</code>.
</p>
<p>This parameter can be used alone or in combination with <code>label_graticule</code>.</p>
</dd>
<dt><code>lims_method</code></dt><dd><p>Method specifying how scale limits are converted into
limits on the plot region. Has no effect when <code>default_crs = NULL</code>.
For a very non-linear CRS (e.g., a perspective centered
around the North pole), the available methods yield widely differing results, and
you may want to try various options. Methods currently implemented include <code>"cross"</code>
(the default), <code>"box"</code>, <code>"orthogonal"</code>, and <code>"geometry_bbox"</code>. For method <code>"cross"</code>,
limits along one direction (e.g., longitude) are applied at the midpoint of the
other direction (e.g., latitude). This method avoids excessively large limits for
rotated coordinate systems but means that sometimes limits need to be expanded a
little further if extreme data points are to be included in the final plot region.
By contrast, for method <code>"box"</code>, a box is generated out of the limits along both directions,
and then limits in projected coordinates are chosen such that the entire box is
visible. This method can yield plot regions that are too large. Finally, method
<code>"orthogonal"</code> applies limits separately along each axis, and method
<code>"geometry_bbox"</code> ignores all limit information except the bounding boxes of any
objects in the <code>geometry</code> aesthetic.</p>
</dd>
<dt><code>ndiscr</code></dt><dd><p>Number of segments to use for discretising graticule lines;
try increasing this number when graticules look incorrect.</p>
</dd>
<dt><code>default</code></dt><dd><p>Is this the default coordinate system? If <code>FALSE</code> (the default),
then replacing this coordinate system with another one creates a message alerting
the user that the coordinate system is being replaced. If <code>TRUE</code>, that warning
is suppressed.</p>
</dd>
<dt><code>clip</code></dt><dd><p>Should drawing be clipped to the extent of the plot panel? A
setting of <code>"on"</code> (the default) means yes, and a setting of <code>"off"</code>
means no. In most cases, the default of <code>"on"</code> should not be changed,
as setting <code>clip = "off"</code> can cause unexpected results. It allows
drawing of data points anywhere on the plot, including in the plot margins. If
limits are set via <code>xlim</code> and <code>ylim</code> and some data points fall outside those
limits, then those data points may show up in places such as the axes, the
legend, the plot title, or the plot margins.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>ggplot2</code> plot
</p>


<h3>See Also</h3>

<p>the original <code><a href="openair.html#topic+trajLevel">openair::trajLevel()</a></code>
</p>
<p><code><a href="#topic+trajLevelMap">trajLevelMap()</a></code> for the interactive <code>leaflet</code> equivalent of
<code><a href="#topic+trajLevelMapStatic">trajLevelMapStatic()</a></code>
</p>
<p>Other static trajectory maps: 
<code><a href="#topic+trajMapStatic">trajMapStatic</a>()</code>
</p>

<hr>
<h2 id='trajMap'>Trajectory line plots in <code>leaflet</code></h2><span id='topic+trajMap'></span>

<h3>Description</h3>

<p>This function plots back trajectories on a <code>leaflet</code> map. This function
requires that data are imported using the <code><a href="openair.html#topic+importTraj">openair::importTraj()</a></code> function.
Options are provided to colour the individual trajectories (e.g., by
pollutant concentrations) or create &quot;layer control&quot; menus to show/hide
different layers.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trajMap(
  data,
  longitude = "lon",
  latitude = "lat",
  colour,
  control = "default",
  cols = "default",
  alpha = 0.5,
  npoints = 12,
  provider = "OpenStreetMap",
  collapse.control = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="trajMap_+3A_data">data</code></td>
<td>
<p>Data frame, the result of importing a trajectory file using
<code><a href="openair.html#topic+importTraj">openair::importTraj()</a></code>.</p>
</td></tr>
<tr><td><code id="trajMap_+3A_latitude">latitude</code>, <code id="trajMap_+3A_longitude">longitude</code></td>
<td>
<p>The decimal latitude/longitude.</p>
</td></tr>
<tr><td><code id="trajMap_+3A_colour">colour</code></td>
<td>
<p>Column to be used for colouring each trajectory. This column
may be numeric, character or factor. This will commonly be a pollutant
concentration which has been joined (e.g., by <code><a href="dplyr.html#topic+mutate-joins">dplyr::left_join()</a></code>) to the
trajectory data by &quot;date&quot;.</p>
</td></tr>
<tr><td><code id="trajMap_+3A_control">control</code></td>
<td>
<p>Used for splitting the trajectories into different groups
which can be selected between using a &quot;layer control&quot; menu. Passed to
<code><a href="openair.html#topic+cutData">openair::cutData()</a></code>.</p>
</td></tr>
<tr><td><code id="trajMap_+3A_cols">cols</code></td>
<td>
<p>Colours to be used for plotting. Options include &quot;default&quot;,
&quot;increment&quot;, &quot;heat&quot;, &quot;turbo&quot; and <code>RColorBrewer</code> colours — see the
<code><a href="openair.html#topic+openColours">openair::openColours()</a></code> function for more details. For user defined the
user can supply a list of colour names recognised by R (type
<code><a href="grDevices.html#topic+colors">grDevices::colours()</a></code> to see the full list). An example would be <code>cols = c("yellow", "green", "blue")</code>. If the <code>"colour"</code> argument was not used, a
single colour can be named which will be used consistently for all
lines/points (e.g., <code>cols = "red"</code>).</p>
</td></tr>
<tr><td><code id="trajMap_+3A_alpha">alpha</code></td>
<td>
<p>Opacity of lines/points. Must be between <code>0</code> and <code>1</code>.</p>
</td></tr>
<tr><td><code id="trajMap_+3A_npoints">npoints</code></td>
<td>
<p>A dot is placed every <code>npoints</code> along each full trajectory.
For hourly back trajectories points are plotted every <code>npoints</code> hours. This
helps to understand where the air masses were at particular times and get a
feel for the speed of the air (points closer together correspond to slower
moving air masses). Defaults to <code>12</code>.</p>
</td></tr>
<tr><td><code id="trajMap_+3A_provider">provider</code></td>
<td>
<p>The base map to be used. See
<a href="http://leaflet-extras.github.io/leaflet-providers/preview/">http://leaflet-extras.github.io/leaflet-providers/preview/</a> for a list of
all base maps that can be used.</p>
</td></tr>
<tr><td><code id="trajMap_+3A_collapse.control">collapse.control</code></td>
<td>
<p>Should the &quot;layer control&quot; interface be collapsed?
Defaults to <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A leaflet object.
</p>


<h3>See Also</h3>

<p>the original <code><a href="openair.html#topic+trajPlot">openair::trajPlot()</a></code>
</p>
<p><code><a href="#topic+trajMapStatic">trajMapStatic()</a></code> for the static <code>ggplot2</code> equivalent of <code><a href="#topic+trajMap">trajMap()</a></code>
</p>
<p>Other interactive trajectory maps: 
<code><a href="#topic+trajLevelMap">trajLevelMap</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
trajMap(traj_data, colour = "nox")

## End(Not run)

</code></pre>

<hr>
<h2 id='trajMapStatic'>Trajectory line plots in <code>ggplot2</code></h2><span id='topic+trajMapStatic'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>
<p>This function plots back trajectories using <code>ggplot2</code>. The function
requires that data are imported using <code><a href="openair.html#topic+importTraj">openair::importTraj()</a></code>. It is a
<code>ggplot2</code> implementation of <code><a href="openair.html#topic+trajPlot">openair::trajPlot()</a></code> with many of the same
arguments, which should be more flexible for post-hoc changes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trajMapStatic(
  data,
  colour = "height",
  facet = NULL,
  group = NULL,
  longitude = "lon",
  latitude = "lat",
  npoints = 12,
  xlim = NULL,
  ylim = NULL,
  crs = sf::st_crs(3812),
  origin = TRUE,
  map = TRUE,
  map.fill = "grey85",
  map.colour = "grey75",
  map.alpha = 0.8,
  map.lwd = 0.5,
  map.lty = 1,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="trajMapStatic_+3A_data">data</code></td>
<td>
<p>Data frame, the result of importing a trajectory file using
<code><a href="openair.html#topic+importTraj">openair::importTraj()</a></code>.</p>
</td></tr>
<tr><td><code id="trajMapStatic_+3A_colour">colour</code></td>
<td>
<p>Column to be used for colouring each trajectory. This column
may be numeric, character or factor. This will commonly be a pollutant
concentration which has been joined (e.g., by <code><a href="dplyr.html#topic+mutate-joins">dplyr::left_join()</a></code>) to the
trajectory data by &quot;date&quot;.</p>
</td></tr>
<tr><td><code id="trajMapStatic_+3A_facet">facet</code></td>
<td>
<p>Used for splitting the trajectories into different panels.
Passed to <code><a href="openair.html#topic+cutData">openair::cutData()</a></code>.</p>
</td></tr>
<tr><td><code id="trajMapStatic_+3A_group">group</code></td>
<td>
<p>By default, trajectory paths are distinguished using the arrival
date. <code>group</code> allows for additional columns to be used (e.g.,
<code>"receptor"</code>).</p>
</td></tr>
<tr><td><code id="trajMapStatic_+3A_latitude">latitude</code>, <code id="trajMapStatic_+3A_longitude">longitude</code></td>
<td>
<p>The decimal latitude/longitude.</p>
</td></tr>
<tr><td><code id="trajMapStatic_+3A_npoints">npoints</code></td>
<td>
<p>A dot is placed every <code>npoints</code> along each full trajectory.
For hourly back trajectories points are plotted every <code>npoints</code> hours. This
helps to understand where the air masses were at particular times and get a
feel for the speed of the air (points closer together correspond to slower
moving air masses). Defaults to <code>12</code>.</p>
</td></tr>
<tr><td><code id="trajMapStatic_+3A_xlim">xlim</code>, <code id="trajMapStatic_+3A_ylim">ylim</code></td>
<td>
<p>The x- and y-limits of the plot. If <code>NULL</code>, limits will be
estimated based on the lat/lon ranges of the input data.</p>
</td></tr>
<tr><td><code id="trajMapStatic_+3A_crs">crs</code></td>
<td>
<p>The coordinate reference system (CRS) into which all data should
be projected before plotting. Defaults to the Lambert projection
(<code>sf::st_crs(3812)</code>). Alternatively, can be set to <code>NULL</code>, which will
typically render the map quicker but may cause countries far from the
equator or large areas to appear distorted.</p>
</td></tr>
<tr><td><code id="trajMapStatic_+3A_origin">origin</code></td>
<td>
<p>Should the receptor point be marked with a circle? Defaults to
<code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="trajMapStatic_+3A_map">map</code></td>
<td>
<p>Should a base map be drawn? Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="trajMapStatic_+3A_map.fill">map.fill</code></td>
<td>
<p>Colour to use to fill the polygons of the base map (see
<code>colors()</code>).</p>
</td></tr>
<tr><td><code id="trajMapStatic_+3A_map.colour">map.colour</code></td>
<td>
<p>Colour to use for the polygon borders of the base map (see
<code>colors()</code>).</p>
</td></tr>
<tr><td><code id="trajMapStatic_+3A_map.alpha">map.alpha</code></td>
<td>
<p>Transparency of the base map polygons. Must be between <code>0</code>
(fully transparent) and <code>1</code> (fully opaque).</p>
</td></tr>
<tr><td><code id="trajMapStatic_+3A_map.lwd">map.lwd</code></td>
<td>
<p>Line width of the base map polygon borders.</p>
</td></tr>
<tr><td><code id="trajMapStatic_+3A_map.lty">map.lty</code></td>
<td>
<p>Line type of the base map polygon borders. See
<code><a href="ggplot2.html#topic+scale_linetype">ggplot2::scale_linetype()</a></code> for common examples.</p>
</td></tr>
<tr><td><code id="trajMapStatic_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="ggplot2.html#topic+ggsf">ggplot2::coord_sf</a></code>
</p>

<dl>
<dt><code>expand</code></dt><dd><p>If <code>TRUE</code>, the default, adds a small expansion factor to
the limits to ensure that data and axes don't overlap. If <code>FALSE</code>,
limits are taken exactly from the data or <code>xlim</code>/<code>ylim</code>.</p>
</dd>
<dt><code>datum</code></dt><dd><p>CRS that provides datum to use when generating graticules.</p>
</dd>
<dt><code>label_graticule</code></dt><dd><p>Character vector indicating which graticule lines should be labeled
where. Meridians run north-south, and the letters <code>"N"</code> and <code>"S"</code> indicate that
they should be labeled on their north or south end points, respectively.
Parallels run east-west, and the letters <code>"E"</code> and <code>"W"</code> indicate that they
should be labeled on their east or west end points, respectively. Thus,
<code>label_graticule = "SW"</code> would label meridians at their south end and parallels at
their west end, whereas <code>label_graticule = "EW"</code> would label parallels at both
ends and meridians not at all. Because meridians and parallels can in general
intersect with any side of the plot panel, for any choice of <code>label_graticule</code> labels
are not guaranteed to reside on only one particular side of the plot panel. Also,
<code>label_graticule</code> can cause labeling artifacts, in particular if a graticule line
coincides with the edge of the plot panel. In such circumstances, <code>label_axes</code> will
generally yield better results and should be used instead.
</p>
<p>This parameter can be used alone or in combination with <code>label_axes</code>.</p>
</dd>
<dt><code>label_axes</code></dt><dd><p>Character vector or named list of character values
specifying which graticule lines (meridians or parallels) should be labeled on
which side of the plot. Meridians are indicated by <code>"E"</code> (for East) and
parallels by <code>"N"</code> (for North). Default is <code>"--EN"</code>, which specifies
(clockwise from the top) no labels on the top, none on the right, meridians
on the bottom, and parallels on the left. Alternatively, this setting could have been
specified with <code>list(bottom = "E", left = "N")</code>.
</p>
<p>This parameter can be used alone or in combination with <code>label_graticule</code>.</p>
</dd>
<dt><code>lims_method</code></dt><dd><p>Method specifying how scale limits are converted into
limits on the plot region. Has no effect when <code>default_crs = NULL</code>.
For a very non-linear CRS (e.g., a perspective centered
around the North pole), the available methods yield widely differing results, and
you may want to try various options. Methods currently implemented include <code>"cross"</code>
(the default), <code>"box"</code>, <code>"orthogonal"</code>, and <code>"geometry_bbox"</code>. For method <code>"cross"</code>,
limits along one direction (e.g., longitude) are applied at the midpoint of the
other direction (e.g., latitude). This method avoids excessively large limits for
rotated coordinate systems but means that sometimes limits need to be expanded a
little further if extreme data points are to be included in the final plot region.
By contrast, for method <code>"box"</code>, a box is generated out of the limits along both directions,
and then limits in projected coordinates are chosen such that the entire box is
visible. This method can yield plot regions that are too large. Finally, method
<code>"orthogonal"</code> applies limits separately along each axis, and method
<code>"geometry_bbox"</code> ignores all limit information except the bounding boxes of any
objects in the <code>geometry</code> aesthetic.</p>
</dd>
<dt><code>ndiscr</code></dt><dd><p>Number of segments to use for discretising graticule lines;
try increasing this number when graticules look incorrect.</p>
</dd>
<dt><code>default</code></dt><dd><p>Is this the default coordinate system? If <code>FALSE</code> (the default),
then replacing this coordinate system with another one creates a message alerting
the user that the coordinate system is being replaced. If <code>TRUE</code>, that warning
is suppressed.</p>
</dd>
<dt><code>clip</code></dt><dd><p>Should drawing be clipped to the extent of the plot panel? A
setting of <code>"on"</code> (the default) means yes, and a setting of <code>"off"</code>
means no. In most cases, the default of <code>"on"</code> should not be changed,
as setting <code>clip = "off"</code> can cause unexpected results. It allows
drawing of data points anywhere on the plot, including in the plot margins. If
limits are set via <code>xlim</code> and <code>ylim</code> and some data points fall outside those
limits, then those data points may show up in places such as the axes, the
legend, the plot title, or the plot margins.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>ggplot2</code> plot
</p>


<h3>See Also</h3>

<p>the original <code><a href="openair.html#topic+trajPlot">openair::trajPlot()</a></code>
</p>
<p><code><a href="#topic+trajMap">trajMap()</a></code> for the interactive <code>leaflet</code> equivalent of
<code><a href="#topic+trajMapStatic">trajMapStatic()</a></code>
</p>
<p>Other static trajectory maps: 
<code><a href="#topic+trajLevelMapStatic">trajLevelMapStatic</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# colour by height
trajMapStatic(traj_data) +
  ggplot2::scale_color_gradientn(colors = openair::openColours())

# colour by PM10, log transform scale
trajMapStatic(traj_data, colour = "pm10") +
  ggplot2::scale_color_viridis_c(trans = "log10") +
  ggplot2::labs(color = openair::quickText("PM10"))

# color by PM2.5, lat/lon projection
trajMapStatic(traj_data, colour = "pm2.5", crs = sf::st_crs(4326)) +
  ggplot2::scale_color_viridis_c(option = "turbo") +
  ggplot2::labs(color = openair::quickText("PM2.5"))

## End(Not run)
</code></pre>

<hr>
<h2 id='windroseMap'>Wind rose plots on interactive leaflet maps</h2><span id='topic+windroseMap'></span>

<h3>Description</h3>

<p><code><a href="#topic+windroseMap">windroseMap()</a></code> creates a <code>leaflet</code> map using wind roses as markers. Multiple
layers of markers can be added and toggled between using <code>control</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>windroseMap(
  data,
  ws.int = 2,
  breaks = 4,
  latitude = NULL,
  longitude = NULL,
  control = NULL,
  popup = NULL,
  label = NULL,
  provider = "OpenStreetMap",
  cols = "turbo",
  alpha = 1,
  key = FALSE,
  draw.legend = TRUE,
  collapse.control = FALSE,
  d.icon = 200,
  d.fig = 3.5,
  type = deprecated(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="windroseMap_+3A_data">data</code></td>
<td>
<p>A data frame. The data frame must contain the data to plot a
<code><a href="openair.html#topic+windRose">openair::windRose()</a></code>, which includes wind speed (<code>ws</code>), and wind direction
(<code>wd</code>). In addition, <code>data</code> must include a decimal latitude and longitude.</p>
</td></tr>
<tr><td><code id="windroseMap_+3A_ws.int">ws.int</code></td>
<td>
<p>The wind speed interval. Default is 2 m/s but for low met masts
with low mean wind speeds a value of 1 or 0.5 m/s may be better.</p>
</td></tr>
<tr><td><code id="windroseMap_+3A_breaks">breaks</code></td>
<td>
<p>Most commonly, the number of break points for wind speed in
windRose. For windRose and the ws.int default of 2 m/s, the default, 4,
generates the break points 2, 4, 6, 8 m/s. Breaks can also be used to set
specific break points. For example, the argument breaks = c(0, 1, 10, 100)
breaks the data into segments &lt;1, 1-10, 10-100, &gt;100.</p>
</td></tr>
<tr><td><code id="windroseMap_+3A_latitude">latitude</code>, <code id="windroseMap_+3A_longitude">longitude</code></td>
<td>
<p>The decimal latitude/longitude. If not provided,
will be automatically inferred from data by looking for a column named
&quot;lat&quot;/&quot;latitude&quot; or &quot;lon&quot;/&quot;lng&quot;/&quot;long&quot;/&quot;longitude&quot; (case-insensitively).</p>
</td></tr>
<tr><td><code id="windroseMap_+3A_control">control</code></td>
<td>
<p>Used for splitting the input data into different groups which
can be selected between using a &quot;layer control&quot; interface, passed to the
<code>type</code> argument of <code><a href="openair.html#topic+cutData">openair::cutData()</a></code>. <code>control</code> cannot be used if
multiple <code>pollutant</code> columns have been provided.</p>
</td></tr>
<tr><td><code id="windroseMap_+3A_popup">popup</code></td>
<td>
<p>Columns to be used as the HTML content for marker popups. Popups
may be useful to show information about the individual sites (e.g., site
names, codes, types, etc.). If a vector of column names are provided they
are passed to <code><a href="#topic+buildPopup">buildPopup()</a></code> using its default values.</p>
</td></tr>
<tr><td><code id="windroseMap_+3A_label">label</code></td>
<td>
<p>Column to be used as the HTML content for hover-over labels.
Labels are useful for the same reasons as popups, though are typically
shorter.</p>
</td></tr>
<tr><td><code id="windroseMap_+3A_provider">provider</code></td>
<td>
<p>The base map(s) to be used. See
<a href="http://leaflet-extras.github.io/leaflet-providers/preview/">http://leaflet-extras.github.io/leaflet-providers/preview/</a> for a list of
all base maps that can be used. If multiple base maps are provided, they
can be toggled between using a &quot;layer control&quot; interface. By default, the
interface will use the provider names as labels, but users can define their
own using a named vector (e.g., <code>c("Default" = "OpenStreetMap", "Satellite" = "Esri.WorldImagery")</code>)</p>
</td></tr>
<tr><td><code id="windroseMap_+3A_cols">cols</code></td>
<td>
<p>The colours used for plotting. See <code><a href="openair.html#topic+openColours">openair::openColours()</a></code> for
more information.</p>
</td></tr>
<tr><td><code id="windroseMap_+3A_alpha">alpha</code></td>
<td>
<p>The alpha transparency to use for the plotting surface (a value
between 0 and 1 with zero being fully transparent and 1 fully opaque).</p>
</td></tr>
<tr><td><code id="windroseMap_+3A_key">key</code></td>
<td>
<p>Should a key for each marker be drawn? Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="windroseMap_+3A_draw.legend">draw.legend</code></td>
<td>
<p>Should a shared legend be created at the side of the map?
Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="windroseMap_+3A_collapse.control">collapse.control</code></td>
<td>
<p>Should the &quot;layer control&quot; interface be collapsed?
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="windroseMap_+3A_d.icon">d.icon</code></td>
<td>
<p>The diameter of the plot on the map in pixels. This will affect
the size of the individual polar markers. Alternatively, a vector in the
form <code>c(width, height)</code> can be provided if a non-circular marker is
desired.</p>
</td></tr>
<tr><td><code id="windroseMap_+3A_d.fig">d.fig</code></td>
<td>
<p>The diameter of the plots to be produced using <code>openair</code> in
inches. This will affect the resolution of the markers on the map.
Alternatively, a vector in the form <code>c(width, height)</code> can be provided if a
non-circular marker is desired.</p>
</td></tr>
<tr><td><code id="windroseMap_+3A_type">type</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>. Different sites are now
automatically detected based on latitude and longitude. Please use <code>label</code>
and/or <code>popup</code> to label different sites.</p>
</td></tr>
<tr><td><code id="windroseMap_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="openair.html#topic+windRose">openair::windRose</a></code>
</p>

<dl>
<dt><code>ws</code></dt><dd><p>Name of the column representing wind speed.</p>
</dd>
<dt><code>wd</code></dt><dd><p>Name of the column representing wind direction.</p>
</dd>
<dt><code>ws2,wd2</code></dt><dd><p>The user can supply a second set of wind speed and wind
direction values with which the first can be compared. See
<code><a href="openair.html#topic+pollutionRose">pollutionRose()</a></code> for more details.</p>
</dd>
<dt><code>angle</code></dt><dd><p>Default angle of &ldquo;spokes&rdquo; is 30. Other potentially useful
angles are 45 and 10. Note that the width of the wind speed interval may
need adjusting using <code>width</code>.</p>
</dd>
<dt><code>bias.corr</code></dt><dd><p>When <code>angle</code> does not divide exactly into 360 a bias is
introduced in the frequencies when the wind direction is already supplied
rounded to the nearest 10 degrees, as is often the case. For example, if
<code>angle = 22.5</code>, N, E, S, W will include 3 wind sectors and all other
angles will be two. A bias correction can made to correct for this problem.
A simple method according to Applequist (2012) is used to adjust the
frequencies.</p>
</dd>
<dt><code>grid.line</code></dt><dd><p>Grid line interval to use. If <code>NULL</code>, as in default,
this is assigned based on the available data range. However, it can also be
forced to a specific value, e.g. <code>grid.line = 10</code>. <code>grid.line</code>
can also be a list to control the interval, line type and colour. For
example <code>grid.line = list(value = 10, lty = 5, col = "purple")</code>.</p>
</dd>
<dt><code>width</code></dt><dd><p>For <code>paddle = TRUE</code>, the adjustment factor for width of
wind speed intervals. For example, <code>width = 1.5</code> will make the paddle
width 1.5 times wider.</p>
</dd>
<dt><code>seg</code></dt><dd><p>When <code>paddle = TRUE</code>, <code>seg</code> determines with width of the
segments. For example, <code>seg = 0.5</code> will produce segments 0.5 *
<code>angle</code>.</p>
</dd>
<dt><code>auto.text</code></dt><dd><p>Either <code>TRUE</code> (default) or <code>FALSE</code>. If <code>TRUE</code>
titles and axis labels will automatically try and format pollutant names
and units properly, e.g., by subscripting the &lsquo;2&rsquo; in NO2.</p>
</dd>
<dt><code>offset</code></dt><dd><p>The size of the 'hole' in the middle of the plot, expressed as
a percentage of the polar axis scale, default 10.</p>
</dd>
<dt><code>normalise</code></dt><dd><p>If <code>TRUE</code> each wind direction segment is normalised to
equal one. This is useful for showing how the concentrations (or other
parameters) contribute to each wind sector when the proportion of time the
wind is from that direction is low. A line showing the probability that the
wind directions is from a particular wind sector is also shown.</p>
</dd>
<dt><code>max.freq</code></dt><dd><p>Controls the scaling used by setting the maximum value for
the radial limits. This is useful to ensure several plots use the same
radial limits.</p>
</dd>
<dt><code>paddle</code></dt><dd><p>Either <code>TRUE</code> or <code>FALSE</code>. If <code>TRUE</code> plots rose
using 'paddle' style spokes. If <code>FALSE</code> plots rose using 'wedge' style
spokes.</p>
</dd>
<dt><code>key.header</code></dt><dd><p>Adds additional text/labels above the scale key. For
example, passing <code>windRose(mydata, key.header = "ws")</code> adds the
addition text as a scale header. Note: This argument is passed to
<code><a href="openair.html#topic+drawOpenKey">drawOpenKey()</a></code> via <code><a href="openair.html#topic+quickText">quickText()</a></code>, applying the auto.text argument, to
handle formatting.</p>
</dd>
<dt><code>key.footer</code></dt><dd><p>Adds additional text/labels below the scale key. See
<code>key.header</code> for further information.</p>
</dd>
<dt><code>key.position</code></dt><dd><p>Location where the scale key is to plotted. Allowed
arguments currently include &ldquo;top&rdquo;, &ldquo;right&rdquo;, &ldquo;bottom&rdquo;
and &ldquo;left&rdquo;.</p>
</dd>
<dt><code>dig.lab</code></dt><dd><p>The number of significant figures at which scientific number
formatting is used in break point and key labelling. Default 5.</p>
</dd>
<dt><code>include.lowest</code></dt><dd><p>Logical. If <code>FALSE</code> (the default), the first
interval will be left exclusive and right inclusive. If <code>TRUE</code>, the
first interval will be left and right inclusive. Passed to the
<code>include.lowest</code> argument of <code><a href="base.html#topic+cut">cut()</a></code>.</p>
</dd>
<dt><code>statistic</code></dt><dd><p>The <code>statistic</code> to be applied to each data bin in the
plot. Options currently include &ldquo;prop.count&rdquo;, &ldquo;prop.mean&rdquo; and
&ldquo;abs.count&rdquo;. The default &ldquo;prop.count&rdquo; sizes bins according to
the proportion of the frequency of measurements.  Similarly,
&ldquo;prop.mean&rdquo; sizes bins according to their relative contribution to
the mean. &ldquo;abs.count&rdquo; provides the absolute count of measurements in
each bin.</p>
</dd>
<dt><code>pollutant</code></dt><dd><p>Alternative data series to be sampled instead of wind speed.
The <code><a href="openair.html#topic+windRose">windRose()</a></code> default NULL is equivalent to <code>pollutant = "ws"</code>. Use
in <code><a href="openair.html#topic+pollutionRose">pollutionRose()</a></code>.</p>
</dd>
<dt><code>angle.scale</code></dt><dd><p>The scale is by default shown at a 315 degree angle.
Sometimes the placement of the scale may interfere with an interesting
feature. The user can therefore set <code>angle.scale</code> to another value
(between 0 and 360 degrees) to mitigate such problems. For example
<code>angle.scale = 45</code> will draw the scale heading in a NE direction.</p>
</dd>
<dt><code>border</code></dt><dd><p>Border colour for shaded areas. Default is no border.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>A leaflet object.
</p>


<h3>See Also</h3>

<p>the original <code><a href="openair.html#topic+windRose">openair::windRose()</a></code>
</p>
<p><code><a href="#topic+windroseMapStatic">windroseMapStatic()</a></code> for the static <code>ggmap</code> equivalent of
<code><a href="#topic+windroseMap">windroseMap()</a></code>
</p>
<p>Other interactive directional analysis maps: 
<code><a href="#topic+annulusMap">annulusMap</a>()</code>,
<code><a href="#topic+diffMap">diffMap</a>()</code>,
<code><a href="#topic+freqMap">freqMap</a>()</code>,
<code><a href="#topic+percentileMap">percentileMap</a>()</code>,
<code><a href="#topic+polarMap">polarMap</a>()</code>,
<code><a href="#topic+pollroseMap">pollroseMap</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
windroseMap(polar_data,
  provider = "Stamen.Toner"
)

## End(Not run)
</code></pre>

<hr>
<h2 id='windroseMapStatic'>Wind rose plots on a static ggmap</h2><span id='topic+windroseMapStatic'></span>

<h3>Description</h3>

<p><code><a href="#topic+windroseMapStatic">windroseMapStatic()</a></code> creates a <code>ggplot2</code> map using wind roses as markers. As
this function returns a <code>ggplot2</code> object, further customisation can be
achieved using functions like <code><a href="ggplot2.html#topic+theme">ggplot2::theme()</a></code> and <code><a href="ggplot2.html#topic+guides">ggplot2::guides()</a></code>. See
<code><a href="openair.html#topic+polarPlot">openair::polarPlot()</a></code> for more information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>windroseMapStatic(
  data,
  ggmap = NULL,
  ws.int = 2,
  breaks = 4,
  facet = NULL,
  latitude = NULL,
  longitude = NULL,
  cols = "turbo",
  alpha = 1,
  key = FALSE,
  facet.nrow = NULL,
  d.icon = 150,
  d.fig = 3,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="windroseMapStatic_+3A_data">data</code></td>
<td>
<p>A data frame. The data frame must contain the data to plot the
directional analysis marker, which includes wind speed (<code>ws</code>), wind
direction (<code>wd</code>), and the column representing the concentration of a
pollutant. In addition, <code>data</code> must include a decimal latitude and
longitude.</p>
</td></tr>
<tr><td><code id="windroseMapStatic_+3A_ggmap">ggmap</code></td>
<td>
<p>A <code>ggmap</code> object obtained using <code><a href="ggmap.html#topic+get_map">ggmap::get_map()</a></code> or a similar
function to use as the basemap.</p>
</td></tr>
<tr><td><code id="windroseMapStatic_+3A_ws.int">ws.int</code></td>
<td>
<p>The wind speed interval. Default is 2 m/s but for low met masts
with low mean wind speeds a value of 1 or 0.5 m/s may be better.</p>
</td></tr>
<tr><td><code id="windroseMapStatic_+3A_breaks">breaks</code></td>
<td>
<p>Most commonly, the number of break points for wind speed in
windRose. For windRose and the ws.int default of 2 m/s, the default, 4,
generates the break points 2, 4, 6, 8 m/s. Breaks can also be used to set
specific break points. For example, the argument breaks = c(0, 1, 10, 100)
breaks the data into segments &lt;1, 1-10, 10-100, &gt;100.</p>
</td></tr>
<tr><td><code id="windroseMapStatic_+3A_facet">facet</code></td>
<td>
<p>Used for splitting the input data into different panels, passed
to the <code>type</code> argument of <code><a href="openair.html#topic+cutData">openair::cutData()</a></code>. <code>facet</code> cannot be used if
multiple <code>pollutant</code> columns have been provided.</p>
</td></tr>
<tr><td><code id="windroseMapStatic_+3A_latitude">latitude</code>, <code id="windroseMapStatic_+3A_longitude">longitude</code></td>
<td>
<p>The decimal latitude/longitude. If not provided,
will be automatically inferred from data by looking for a column named
&quot;lat&quot;/&quot;latitude&quot; or &quot;lon&quot;/&quot;lng&quot;/&quot;long&quot;/&quot;longitude&quot; (case-insensitively).</p>
</td></tr>
<tr><td><code id="windroseMapStatic_+3A_cols">cols</code></td>
<td>
<p>The colours used for plotting. See <code><a href="openair.html#topic+openColours">openair::openColours()</a></code> for
more information.</p>
</td></tr>
<tr><td><code id="windroseMapStatic_+3A_alpha">alpha</code></td>
<td>
<p>The alpha transparency to use for the plotting surface (a value
between 0 and 1 with zero being fully transparent and 1 fully opaque).</p>
</td></tr>
<tr><td><code id="windroseMapStatic_+3A_key">key</code></td>
<td>
<p>Should a key for each marker be drawn? Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="windroseMapStatic_+3A_facet.nrow">facet.nrow</code></td>
<td>
<p>Passed to the <code>nrow</code> argument of <code><a href="ggplot2.html#topic+facet_wrap">ggplot2::facet_wrap()</a></code>.</p>
</td></tr>
<tr><td><code id="windroseMapStatic_+3A_d.icon">d.icon</code></td>
<td>
<p>The diameter of the plot on the map in pixels. This will affect
the size of the individual polar markers. Alternatively, a vector in the
form <code>c(width, height)</code> can be provided if a non-circular marker is
desired.</p>
</td></tr>
<tr><td><code id="windroseMapStatic_+3A_d.fig">d.fig</code></td>
<td>
<p>The diameter of the plots to be produced using <code>openair</code> in
inches. This will affect the resolution of the markers on the map.
Alternatively, a vector in the form <code>c(width, height)</code> can be provided if a
non-circular marker is desired.</p>
</td></tr>
<tr><td><code id="windroseMapStatic_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="openair.html#topic+polarAnnulus">openair::polarAnnulus</a></code>
</p>

<dl>
<dt><code>resolution</code></dt><dd><p>Two plot resolutions can be set: &ldquo;normal&rdquo; and
&ldquo;fine&rdquo; (the default).</p>
</dd>
<dt><code>local.tz</code></dt><dd><p>Should the results be calculated in local time that includes
a treatment of daylight savings time (DST)? The default is not to consider
DST issues, provided the data were imported without a DST offset. Emissions
activity tends to occur at local time e.g. rush hour is at 8 am every day.
When the clocks go forward in spring, the emissions are effectively
released into the atmosphere typically 1 hour earlier during the summertime
i.e. when DST applies. When plotting diurnal profiles, this has the effect
of &ldquo;smearing-out&rdquo; the concentrations. Sometimes, a useful approach
is to express time as local time. This correction tends to produce
better-defined diurnal profiles of concentration (or other variables) and
allows a better comparison to be made with emissions/activity data. If set
to <code>FALSE</code> then GMT is used. Examples of usage include <code>local.tz
  = "Europe/London"</code>, <code>local.tz = "America/New_York"</code>. See
<code>cutData</code> and <code>import</code> for more details.</p>
</dd>
<dt><code>type</code></dt><dd><p><code>type</code> determines how the data are split i.e. conditioned,
and then plotted. The default is will produce a single plot using the
entire data. Type can be one of the built-in types as detailed in
<code>cutData</code> e.g. &ldquo;season&rdquo;, &ldquo;year&rdquo;, &ldquo;weekday&rdquo; and so
on. For example, <code>type = "season"</code> will produce four plots &mdash; one for
each season.
</p>
<p>It is also possible to choose <code>type</code> as another variable in the data
frame. If that variable is numeric, then the data will be split into four
quantiles (if possible) and labelled accordingly. If type is an existing
character or factor variable, then those categories/levels will be used
directly. This offers great flexibility for understanding the variation of
different variables and how they depend on one another.
</p>
<p>Type can be up length two e.g. <code>type = c("season", "site")</code> will
produce a 2x2 plot split by season and site. The use of two types is mostly
meant for situations where there are several sites. Note, when two types
are provided the first forms the columns and the second the rows.
</p>
<p>Also note that for the <code>polarAnnulus</code> function some type/period
combinations are forbidden or make little sense. For example, <code>type =
  "season"</code> and <code>period = "trend"</code> (which would result in a plot with
too many gaps in it for sensible smoothing), or <code>type = "weekday"</code> and
<code>period = "weekday"</code>.</p>
</dd>
<dt><code>statistic</code></dt><dd><p>The statistic that should be applied to each wind
speed/direction bin. Can be &ldquo;mean&rdquo; (default), &ldquo;median&rdquo;,
&ldquo;max&rdquo; (maximum), &ldquo;frequency&rdquo;. &ldquo;stdev&rdquo; (standard
deviation), &ldquo;weighted.mean&rdquo; or &ldquo;cpf&rdquo; (Conditional Probability
Function). Because of the smoothing involved, the colour scale for some of
these statistics is only to provide an indication of overall pattern and
should not be interpreted in concentration units e.g. for <code>statistic =
  "weighted.mean"</code> where the bin mean is multiplied by the bin frequency and
divided by the total frequency. In many cases using <code>polarFreq</code> will
be better. Setting <code>statistic = "weighted.mean"</code> can be useful because
it provides an indication of the concentration * frequency of occurrence
and will highlight the wind speed/direction conditions that dominate the
overall mean.</p>
</dd>
<dt><code>percentile</code></dt><dd><p>If <code>statistic = "percentile"</code> or <code>statistic =
  "cpf"</code> then <code>percentile</code> is used, expressed from 0 to 100. Note that
the percentile value is calculated in the wind speed, wind direction
&lsquo;bins&rsquo;. For this reason it can also be useful to set <code>min.bin</code>
to ensure there are a sufficient number of points available to estimate a
percentile. See <code>quantile</code> for more details of how percentiles are
calculated.</p>
</dd>
<dt><code>width</code></dt><dd><p>The width of the annulus; can be &ldquo;normal&rdquo; (the default),
&ldquo;thin&rdquo; or &ldquo;fat&rdquo;.</p>
</dd>
<dt><code>min.bin</code></dt><dd><p>The minimum number of points allowed in a wind speed/wind
direction bin.  The default is 1. A value of two requires at least 2 valid
records in each bin an so on; bins with less than 2 valid records are set
to NA. Care should be taken when using a value &gt; 1 because of the risk of
removing real data points. It is recommended to consider your data with
care. Also, the <code>polarFreq</code> function can be of use in such
circumstances.</p>
</dd>
<dt><code>exclude.missing</code></dt><dd><p>Setting this option to <code>TRUE</code> (the default)
removes points from the plot that are too far from the original data. The
smoothing routines will produce predictions at points where no data exist
i.e. they predict. By removing the points too far from the original data
produces a plot where it is clear where the original data lie. If set to
<code>FALSE</code> missing data will be interpolated.</p>
</dd>
<dt><code>date.pad</code></dt><dd><p>For <code>type = "trend"</code> (default), <code>date.pad = TRUE</code>
will pad-out missing data to the beginning of the first year and the end of
the last year. The purpose is to ensure that the trend plot begins and ends
at the beginning or end of year.</p>
</dd>
<dt><code>force.positive</code></dt><dd><p>The default is <code>TRUE</code>. Sometimes if smoothing data
with steep gradients it is possible for predicted values to be negative.
<code>force.positive = TRUE</code> ensures that predictions remain positive. This
is useful for several reasons. First, with lots of missing data more
interpolation is needed and this can result in artefacts because the
predictions are too far from the original data. Second, if it is known
beforehand that the data are all positive, then this option carries that
assumption through to the prediction. The only likely time where setting
<code>force.positive = FALSE</code> would be if background concentrations were
first subtracted resulting in data that is legitimately negative. For the
vast majority of situations it is expected that the user will not need to
alter the default option.</p>
</dd>
<dt><code>k</code></dt><dd><p>The smoothing value supplied to <code>gam</code> for the temporal and wind
direction components, respectively. In some cases e.g. a trend plot with
less than 1-year of data the smoothing with the default values may become
too noisy and affected more by outliers. Choosing a lower value of <code>k</code>
(say 10) may help produce a better plot.</p>
</dd>
<dt><code>normalise</code></dt><dd><p>If <code>TRUE</code> concentrations are normalised by dividing by
their mean value. This is done <em>after</em> fitting the smooth surface.
This option is particularly useful if one is interested in the patterns of
concentrations for several pollutants on different scales e.g. NOx and CO.
Often useful if more than one <code>pollutant</code> is chosen.</p>
</dd>
<dt><code>key.header</code></dt><dd><p>Adds additional text/labels to the scale key. For example,
passing the options <code>key.header = "header", key.footer = "footer1"</code>
adds addition text above and below the scale key. These arguments are
passed to <code>drawOpenKey</code> via <code>quickText</code>, applying the
<code>auto.text</code> argument, to handle formatting.</p>
</dd>
<dt><code>key.footer</code></dt><dd><p>see <code>key.footer</code>.</p>
</dd>
<dt><code>key.position</code></dt><dd><p>Location where the scale key is to plotted. Allowed
arguments currently include <code>"top"</code>, <code>"right"</code>, <code>"bottom"</code>
and <code>"left"</code>.</p>
</dd>
<dt><code>auto.text</code></dt><dd><p>Either <code>TRUE</code> (default) or <code>FALSE</code>. If <code>TRUE</code>
titles and axis labels will automatically try and format pollutant names
and units properly e.g.  by subscripting the &lsquo;2&rsquo; in NO2.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>ggplot2</code> plot with a <code>ggmap</code> basemap
</p>


<h3>Further customisation using ggplot2</h3>

<p>As the outputs of the static directional analysis functions are <code>ggplot2</code>
figures, further customisation is possible using functions such as
<code><a href="ggplot2.html#topic+theme">ggplot2::theme()</a></code>, <code><a href="ggplot2.html#topic+guides">ggplot2::guides()</a></code> and <code><a href="ggplot2.html#topic+labs">ggplot2::labs()</a></code>.
</p>
<p>If multiple pollutants are specified, subscripting (e.g., the &quot;x&quot; in &quot;NOx&quot;)
is achieved using the <a href="ggtext.html#topic+ggtext">ggtext</a> package. Therefore if you
choose to override the plot theme, it is recommended to use
<code style="white-space: pre;">&#8288;[ggplot2::theme()]&#8288;</code> and <code style="white-space: pre;">&#8288;[ggtext::element_markdown()]&#8288;</code> to define the
<code>strip.text</code> parameter.
</p>
<p>When arguments like <code>limits</code>, <code>percentile</code> or <code>breaks</code> are defined, a
legend is automatically added to the figure. Legends can be removed using
<code>ggplot2::theme(legend.position = "none")</code>, or further customised using
<code><a href="ggplot2.html#topic+guides">ggplot2::guides()</a></code> and either <code>color = ggplot2::guide_colourbar()</code> for
continuous legends or <code>fill = ggplot2::guide_legend()</code> for discrete
legends.
</p>


<h3>See Also</h3>

<p>the original <code><a href="openair.html#topic+windRose">openair::windRose()</a></code>
</p>
<p><code><a href="#topic+windroseMap">windroseMap()</a></code> for the interactive <code>leaflet</code> equivalent of
<code><a href="#topic+windroseMapStatic">windroseMapStatic()</a></code>
</p>
<p>Other static directional analysis maps: 
<code><a href="#topic+annulusMapStatic">annulusMapStatic</a>()</code>,
<code><a href="#topic+diffMapStatic">diffMapStatic</a>()</code>,
<code><a href="#topic+freqMapStatic">freqMapStatic</a>()</code>,
<code><a href="#topic+percentileMapStatic">percentileMapStatic</a>()</code>,
<code><a href="#topic+polarMapStatic">polarMapStatic</a>()</code>,
<code><a href="#topic+pollroseMapStatic">pollroseMapStatic</a>()</code>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
