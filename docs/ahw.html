<!DOCTYPE html><html lang="en"><head><title>Help for package ahw</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ahw}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#addNoiseAtEventTimes'><p>Tie removal</p></a></li>
<li><a href='#ahw'><p>Re-weighting Point Processes Based on Additive Hazard Models</p></a></li>
<li><a href='#fFrame'><p>fFrame</p></a></li>
<li><a href='#fr1'><p>fr1</p></a></li>
<li><a href='#makeContWeights'><p>Continuous time weight estimation based on <code>aalen.predict</code></p></a></li>
<li><a href='#naReplace'><p>Replaces NA-values in <code>vec</code> with last non-NA value</p></a></li>
<li><a href='#plotContWeights'><p>Plots mean and individual weight trajectories</p></a></li>
<li><a href='#refineTable'><p>Expands data.table</p></a></li>
<li><a href='#Tmat'><p>Tmat</p></a></li>
<li><a href='#weightPredict'><p>Continuous time weight estimation based on</p>
<code>predict.aalen</code></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Calculates Continuous Time Likelihood Ratio Weights Assuming
Multiplicative Intensity Models and Additive Hazard Models</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>methods, timereg, plyr, data.table (&ge; 1.10.4)</td>
</tr>
<tr>
<td>LazyData:</td>
<td>Yes</td>
</tr>
<tr>
<td>Description:</td>
<td>Estimates continuous time weights for performing causal survival
             analysis. For instance, weighted Nelson-Aalen or Kaplan-Meier
             estimates can be given a causal interpretation. See Ryalen, Stensrud, 
             and Røysland (2019) &lt;<a href="https://doi.org/10.1007%2Fs10985-019-09468-y">doi:10.1007/s10985-019-09468-y</a>&gt; and Ryalen (2019)
             <a href="https://www.duo.uio.no/handle/10852/70353">https://www.duo.uio.no/handle/10852/70353</a>
             for theory and examples.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 3.0.0), survival</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-12-22 11:10:00 UTC; paalcry</td>
</tr>
<tr>
<td>Author:</td>
<td>Kjetil Røysland [ths],
  Pål Christie Ryalen
    <a href="https://orcid.org/0000-0002-3236-6782"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Pål Christie Ryalen &lt;p.c.ryalen@medisin.uio.no&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-12-22 20:40:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='addNoiseAtEventTimes'>Tie removal</h2><span id='topic+addNoiseAtEventTimes'></span>

<h3>Description</h3>

<p>Removes ties from by adding noise at tied times
</p>


<h3>Usage</h3>

<pre><code class='language-R'>addNoiseAtEventTimes(fr, id, from, to)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="addNoiseAtEventTimes_+3A_fr">fr</code></td>
<td>
<p>Data on long format</p>
</td></tr>
<tr><td><code id="addNoiseAtEventTimes_+3A_id">id</code></td>
<td>
<p>Name of column in <code>dataFr</code> that identifies individuals</p>
</td></tr>
<tr><td><code id="addNoiseAtEventTimes_+3A_from">from</code></td>
<td>
<p>Name of the variable that contains the name of start state for
each at-risk interval</p>
</td></tr>
<tr><td><code id="addNoiseAtEventTimes_+3A_to">to</code></td>
<td>
<p>Name of column with stop time of the at risk period</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Longitudinally refined <code>data.table</code> of the input <code>data.table</code> <code>fr</code> with random noise added for tiebreaking.
</p>


<h3>Author(s)</h3>

<p>Pål Christie Ryalen &lt;p.c.ryalen@medisin.uio.no&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(data.table)
data(fr1)
fr1 &lt;- as.data.table(fr1)
fr1 &lt;- addNoiseAtEventTimes(fr1)
head(fr1)
</code></pre>

<hr>
<h2 id='ahw'>Re-weighting Point Processes Based on Additive Hazard Models</h2><span id='topic+ahw'></span>

<h3>Description</h3>

<p>Estimates continuous time weights for performing causal survival
analysis. For instance, weighted Nelson-Aalen or Kaplan-Meier
estimates can be given a causal interpretation.
</p>

<hr>
<h2 id='fFrame'>fFrame</h2><span id='topic+fFrame'></span>

<h3>Description</h3>

<p>fFrame
</p>

<hr>
<h2 id='fr1'>fr1</h2><span id='topic+fr1'></span>

<h3>Description</h3>

<p>fr1
</p>

<hr>
<h2 id='makeContWeights'>Continuous time weight estimation based on <code>aalen.predict</code></h2><span id='topic+makeContWeights'></span>

<h3>Description</h3>

<p>Refines data longitudinally in order to do estimate parameters(e.g. Nelson-Aalen or Kaplan-Meier) using continuous time weights. The weights can be assessed using the plot option.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>makeContWeights(
  faFit,
  cfaFit,
  dataFr,
  atRiskState,
  eventState,
  startTimeName,
  stopTimeName,
  startStatusName,
  endStatusName,
  idName,
  b,
  weightRange = c(0, 10),
  willPlotWeights = TRUE,
  withLeftLim = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="makeContWeights_+3A_fafit">faFit</code></td>
<td>
<p>The <code><a href="timereg.html#topic+aalen">aalen</a></code> fit for the factual hazard</p>
</td></tr>
<tr><td><code id="makeContWeights_+3A_cfafit">cfaFit</code></td>
<td>
<p>The  <code><a href="timereg.html#topic+aalen">aalen</a></code> fit for the hypothetical hazard</p>
</td></tr>
<tr><td><code id="makeContWeights_+3A_datafr">dataFr</code></td>
<td>
<p><code><a href="base.html#topic+data.frame">data.frame</a></code> or <code>data.table</code> on long format</p>
</td></tr>
<tr><td><code id="makeContWeights_+3A_atriskstate">atRiskState</code></td>
<td>
<p>At risk state for the event of interest</p>
</td></tr>
<tr><td><code id="makeContWeights_+3A_eventstate">eventState</code></td>
<td>
<p>State for the event of interest</p>
</td></tr>
<tr><td><code id="makeContWeights_+3A_starttimename">startTimeName</code></td>
<td>
<p>Name of column with start time of the at risk period</p>
</td></tr>
<tr><td><code id="makeContWeights_+3A_stoptimename">stopTimeName</code></td>
<td>
<p>Name of column with stop time of the at risk period</p>
</td></tr>
<tr><td><code id="makeContWeights_+3A_startstatusname">startStatusName</code></td>
<td>
<p>Name of the column that contains the starting state for each interval</p>
</td></tr>
<tr><td><code id="makeContWeights_+3A_endstatusname">endStatusName</code></td>
<td>
<p>Name of the column that contains the end state for each interval</p>
</td></tr>
<tr><td><code id="makeContWeights_+3A_idname">idName</code></td>
<td>
<p>Name of column in <code>dataFr</code> that identifies individuals</p>
</td></tr>
<tr><td><code id="makeContWeights_+3A_b">b</code></td>
<td>
<p>Smoothing bandwidth parameter</p>
</td></tr>
<tr><td><code id="makeContWeights_+3A_weightrange">weightRange</code></td>
<td>
<p>Truncates weights outside this interval</p>
</td></tr>
<tr><td><code id="makeContWeights_+3A_willplotweights">willPlotWeights</code></td>
<td>
<p>Plot indicator</p>
</td></tr>
<tr><td><code id="makeContWeights_+3A_withleftlim">withLeftLim</code></td>
<td>
<p>Calculates left limit at jump if desired</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Longitudinally refined <code>data.table</code> of the initial <code>dataFr</code> with <code>weights</code> column added.
</p>


<h3>Author(s)</h3>

<p>Pål Christie Ryalen &lt;p.c.ryalen@medisin.uio.no&gt;
</p>


<h3>References</h3>

<p><a href="https://arxiv.org/abs/1802.01946">https://arxiv.org/abs/1802.01946</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(data.table)
library(timereg)

# fr1 is a longitudinal data set with subjects that are diagnosed at time 0, and may
# be treated as time evolves. Subjects can die before receiving treatment

# The method assumes there are no tied event times in the observed data. Although there are no
# tied event times in fr1, we use the function addNoiseAtEventTimes() for illustration here
fr1 &lt;- as.data.table(fr1)
fr1 &lt;- addNoiseAtEventTimes(fr1)

# Time to treatment and death are confounded by the baseline variable L. We want to
# mimic a scenario where time to treatment is randomized (and does not depend on L):
fr1_diag &lt;- fr1[fr1$from.state == "diag", ]
fFit &lt;- aalen(
  Surv(from, to, to.state == "treat") ~ 1 + L, data = fr1_diag, n.sim = 50L,
  robust = 0
)
cfFit &lt;- aalen(
  Surv(from, to, to.state == "treat") ~ 1, data = fr1_diag, n.sim = 50L,
  robust = 0
)

# We calculate and plot the weights
frame1 &lt;- makeContWeights(fFit, cfFit, fr1, "diag", "treat", "from", "to",
  "from.state", "to.state", "id",
  b = 0.4,
  weightRange = c(0, 5)
)

# We fit a weighted model for the outcome. A is a treatment indicator (A=1 means treated).
a1 &lt;- aalen(
  Surv(from, to, to.state == "death") ~ 1 + A, data = frame1,
  weights = frame1$weights, n.sim = 50L, robust = 0
)

# We plot the A coefficient from the weighted regression,
# and compare with the true hypothetical coefficient
plot(a1$cum[, c(1, 3)],
  type = "s", ylim = c(-1.2, 0.5), xlim = c(0, 5),
  main = "Weighted additive hazard treatment coefficient"
)
lines(Tmat, col = 2)
legend("bottomleft", c("weighted estimate", "hypothetical treatment coef"),
  lty = 1, col = c(1, 2), bty = "n"
)

# Next we consider an example with dependent censoring.
# Subjects are censored depending on a baseline variable u. We wish to mimic the
# cumulative hazard for death we would have seen if the censoring were independent.

faFit &lt;- aalen(
  Surv(from, to, to.state == "Censored") ~ 1 + u, data = fFrame, n.sim = 50L,
  robust = 0
)
cfaFit &lt;- aalen(
  Surv(from, to, to.state == "Censored") ~ 1, data = fFrame, n.sim = 50L,
  robust = 0
)

frame &lt;- makeContWeights(
  faFit, cfaFit, fFrame, "Alive", "Censored", "from", "to", "from.state",
  "to.state", "id", 100
)

fMod &lt;- aalen(
  Surv(from, to, to.state == "Dead") ~ 1, data = fFrame, n.sim = 50L,
  robust = 0
)
wMod &lt;- aalen(
  Surv(from, to, to.state == "Dead") ~ 1, data = frame, weights = frame$weights,
  n.sim = 50L, robust = 0
)

plot(fMod$cum, type = "s", main = "Nelson-Aalen for death", ylab = "")
lines(wMod$cum, type = "s", col = "red")
legend("topleft", c("factual", "weighted factual"), lty = 1, col = c(1, "red"), bty = "n")
</code></pre>

<hr>
<h2 id='naReplace'>Replaces NA-values in <code>vec</code> with last non-NA value</h2><span id='topic+naReplace'></span>

<h3>Description</h3>

<p>Assumes first element is non-NA
</p>


<h3>Usage</h3>

<pre><code class='language-R'>naReplace(vec)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="naReplace_+3A_vec">vec</code></td>
<td>
<p>Vector of any type</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>numeric</code> <code>vector</code> with each <code>NA</code> entry replaced with the last previous non-<code>NA</code> entry.
</p>


<h3>Note</h3>

<p>Can be replaced by <code>link[zoo]{na.locf0}</code>
</p>


<h3>Author(s)</h3>

<p>Pål Christie Ryalen &lt;p.c.ryalen@medisin.uio.no&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>naReplace(c(1, 2, 3, NA, NA, 4))
naReplace(c("text", NA, NA))
</code></pre>

<hr>
<h2 id='plotContWeights'>Plots mean and individual weight trajectories</h2><span id='topic+plotContWeights'></span>

<h3>Description</h3>

<p>Plotting all the individual weight trajectories in fr,
along with the mean. Plots weights for assessment.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotContWeights(
  fr,
  stopTimeName = "to",
  startStatusName = "from.state",
  endStatusName = "to.state",
  idName = "id"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plotContWeights_+3A_fr">fr</code></td>
<td>
<p>Data with weight column</p>
</td></tr>
<tr><td><code id="plotContWeights_+3A_stoptimename">stopTimeName</code></td>
<td>
<p>Name of column with stop time of the at risk period</p>
</td></tr>
<tr><td><code id="plotContWeights_+3A_startstatusname">startStatusName</code></td>
<td>
<p>Name of the variable that contains the name of start
state for each at-risk interval</p>
</td></tr>
<tr><td><code id="plotContWeights_+3A_endstatusname">endStatusName</code></td>
<td>
<p>Name of the variable that contains the name of end state
for each at-risk interval</p>
</td></tr>
<tr><td><code id="plotContWeights_+3A_idname">idName</code></td>
<td>
<p>Name of column in <code>dataFr</code> that identifies individuals</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value.
</p>


<h3>Author(s)</h3>

<p>Pål Christie Ryalen &lt;p.c.ryalen@medisin.uio.no&gt;
</p>

<hr>
<h2 id='refineTable'>Expands data.table</h2><span id='topic+refineTable'></span>

<h3>Description</h3>

<p>Refines dataFr so that each individual at risk get a row for
each of the provided event times
</p>


<h3>Usage</h3>

<pre><code class='language-R'>refineTable(dataFr, atRiskState, eventState)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="refineTable_+3A_datafr">dataFr</code></td>
<td>
<p>data.frame or data.table on long format</p>
</td></tr>
<tr><td><code id="refineTable_+3A_atriskstate">atRiskState</code></td>
<td>
<p>At risk state(s)</p>
</td></tr>
<tr><td><code id="refineTable_+3A_eventstate">eventState</code></td>
<td>
<p>Observed event times</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.table
</p>


<h3>Author(s)</h3>

<p>Pål Christie Ryalen &lt;p.c.ryalen@medisin.uio.no&gt;
</p>

<hr>
<h2 id='Tmat'>Tmat</h2><span id='topic+Tmat'></span>

<h3>Description</h3>

<p>Tmat
</p>

<hr>
<h2 id='weightPredict'>Continuous time weight estimation based on
<code><a href="timereg.html#topic+predict.aalen">predict.aalen</a></code></h2><span id='topic+weightPredict'></span>

<h3>Description</h3>

<p>Extracts cumulative hazard estimates for each individual. Each
individual receives a weight process evaluated at pre-specified time points.
The weight process is estimated as a cumulative product involving estimated
cumulative hazard increments, and a hazard ratio estimated using a smoothing
parameter <code>b</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>weightPredict(fPred, cfPred, wtFrame, ids, eventTimes, eventIds, b)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="weightPredict_+3A_fpred">fPred</code></td>
<td>
<p><code><a href="timereg.html#topic+predict.aalen">predict.aalen</a></code> object of the factual fit</p>
</td></tr>
<tr><td><code id="weightPredict_+3A_cfpred">cfPred</code></td>
<td>
<p><code><a href="timereg.html#topic+predict.aalen">predict.aalen</a></code> object of the
counterfactual fit</p>
</td></tr>
<tr><td><code id="weightPredict_+3A_wtframe">wtFrame</code></td>
<td>
<p><code><a href="base.html#topic+data.frame">data.frame</a></code> or <code>data.table</code> for the
at risk individuals</p>
</td></tr>
<tr><td><code id="weightPredict_+3A_ids">ids</code></td>
<td>
<p>All individuals in the data set</p>
</td></tr>
<tr><td><code id="weightPredict_+3A_eventtimes">eventTimes</code></td>
<td>
<p>Observed event times</p>
</td></tr>
<tr><td><code id="weightPredict_+3A_eventids">eventIds</code></td>
<td>
<p>Individuals that experience the event</p>
</td></tr>
<tr><td><code id="weightPredict_+3A_b">b</code></td>
<td>
<p>Smoothing parameter</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.table
</p>


<h3>Author(s)</h3>

<p>Pål Christie Ryalen &lt;p.c.ryalen@medisin.uio.no&gt;
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
