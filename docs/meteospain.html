<!DOCTYPE html><html><head><title>Help for package meteospain</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {meteospain}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#get_meteo_from'><p>Get meteorological stations data</p></a></li>
<li><a href='#get_quota_from'><p>Get api quota info</p></a></li>
<li><a href='#get_stations_info_from'><p>Get meteorological stations info</p></a></li>
<li><a href='#services_options'><p>Options for meteorological services</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Access to Spanish Meteorological Stations Services</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.4</td>
</tr>
<tr>
<td>Description:</td>
<td>Access to different Spanish meteorological stations data services and APIs (AEMET, SMC, MG, 
  Meteoclimatic...).</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Suggests:</td>
<td>ggforce, ggplot2, keyring, knitr, rmarkdown, testthat (&ge;
3.0.0), withr</td>
</tr>
<tr>
<td>Imports:</td>
<td>assertthat, dplyr (&ge; 1.0.0), glue, httr, jsonlite, lubridate,
purrr (&ge; 1.0.0), rlang, sf, stringr, tidyr, units, xml2,
vctrs, memoise, cachem, curl, cli</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Config/testthat/parallel:</td>
<td>true</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://emf-creaf.github.io/meteospain/">https://emf-creaf.github.io/meteospain/</a>,
<a href="https://github.com/emf-creaf/meteospain">https://github.com/emf-creaf/meteospain</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/emf-creaf/meteospain/issues">https://github.com/emf-creaf/meteospain/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-12-19 15:04:57 UTC; malditobarbudo</td>
</tr>
<tr>
<td>Author:</td>
<td>Victor Granda <a href="https://orcid.org/0000-0002-0469-1991"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Miquel de Caceres <a href="https://orcid.org/0000-0001-7132-2080"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Aitor Ameztegui <a href="https://orcid.org/0000-0003-2006-1559"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Luis Franco [ctb],
  Rubén Fernández-Casal [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Victor Granda &lt;victorgrandagarcia@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-12-19 15:20:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='get_meteo_from'>Get meteorological stations data</h2><span id='topic+get_meteo_from'></span>

<h3>Description</h3>

<p>Connect and retrieve data from AEMET, SMC and other Spanish meteorological stations services.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_meteo_from(
  service = c("aemet", "meteocat", "meteoclimatic", "meteogalicia", "ria"),
  options
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_meteo_from_+3A_service">service</code></td>
<td>
<p>Character with the service name (in lower case).</p>
</td></tr>
<tr><td><code id="get_meteo_from_+3A_options">options</code></td>
<td>
<p>List with the needed service options. See <code><a href="#topic+services_options">services_options</a></code> to have more info
about the different services and their options.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Depending on the service and the temporal resolution selected, the variables present can change, but all
services have at least temperature values.
</p>


<h3>Value</h3>

<p>An sf (spatial) object with the stations meteorological data.
</p>


<h3>API limits</h3>

<p>Some APIs have limits in terms of the data that can be retrieved with one call. For example, AEMET
only serves daily data for 31 days in one query. See <code>vignette('api_limits', package = 'meteospain')</code>
for a detailed explanations of those limits and the ways to retrieve longer periods.
</p>


<h3>Cache</h3>

<p>In order to avoid unnecessary API calls, results of this function are cached in memory with
<code><a href="memoise.html#topic+memoise">memoise</a></code>. This means that subsequent calls from <code>get_meteo_from</code> with the same
arguments will be faster as they will not call the meteorological service API. This cache has a maximum
size of 1024 MB and persist 24 hours in the same R session after loading the package.
To forgot the cache, <code>memoise::forget(get_meteo_from)</code> can be used.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if (identical(Sys.getenv("NOT_CRAN"), "true")) {
  library(meteospain)
  library(keyring)

  # AEMET (we need a key)
  # key_set('aemet')
  options_for_aemet &lt;- aemet_options(
    'daily',
    start_date = as.Date('2012-01-01'),
    end_date = as.Date('2012-02-01'),
    api_key = key_get('aemet')
  )
  get_meteo_from('aemet', options_for_aemet)
}


</code></pre>

<hr>
<h2 id='get_quota_from'>Get api quota info</h2><span id='topic+get_quota_from'></span>

<h3>Description</h3>

<p>Obtain info about the API quota used
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_quota_from(service = c("meteocat"), options)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_quota_from_+3A_service">service</code></td>
<td>
<p>Character with the service name (in lower case).</p>
</td></tr>
<tr><td><code id="get_quota_from_+3A_options">options</code></td>
<td>
<p>List with the needed service options. See <code><a href="#topic+services_options">services_options</a></code> to have more info
about the different services and their options.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Depending on the service, some APIs allows only a number of data requests. This function access the user
quota numbers in the services that allow for this, <strong>(currently only MeteoCat)</strong>
</p>


<h3>Value</h3>

<p>A data frame with the quota info
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if (identical(Sys.getenv("NOT_CRAN"), "true")) {
  library(meteospain)
  library(keyring)

  # MeteoCat (we need a key)
  # key_set('meteocat')
  api_options &lt;- meteocat_options(api_key = key_get('meteocat'))
  get_quota_from('meteocat', api_options)
}


</code></pre>

<hr>
<h2 id='get_stations_info_from'>Get meteorological stations info</h2><span id='topic+get_stations_info_from'></span>

<h3>Description</h3>

<p>Obtain info and metadata for the available stations in the different services
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_stations_info_from(
  service = c("aemet", "meteocat", "meteoclimatic", "meteogalicia", "ria"),
  options
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_stations_info_from_+3A_service">service</code></td>
<td>
<p>Character with the service name (in lower case).</p>
</td></tr>
<tr><td><code id="get_stations_info_from_+3A_options">options</code></td>
<td>
<p>List with the needed service options. See <code><a href="#topic+services_options">services_options</a></code> to have more info
about the different services and their options.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Depending on the service the metadata available can be different. Also, some services only offer
info for active stations (i.e. AEMET), not historical stations, so some mismatch can occur between
the stations returned by this function and the stations returned by <code><a href="#topic+get_meteo_from">get_meteo_from</a></code> for
historical dates.
</p>


<h3>Value</h3>

<p>An sf (spatial) object with the stations metadata.
</p>


<h3>Cache</h3>

<p>In order to avoid unnecessary API calls, results of this function are cached in memory with
<code><a href="memoise.html#topic+memoise">memoise</a></code>. This means that subsequent calls from <code>get_meteo_from</code> with the same
arguments will be faster as they will not call the meteorological service API. This cache has a maximum
size of 1024 MB and persist 24 hours in the same R session after loading the package.
To forgot the cache, <code>memoise::forget(get_stations_info_from)</code> can be used.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if (identical(Sys.getenv("NOT_CRAN"), "true")) {
  library(meteospain)
  library(keyring)

  # AEMET (we need a key)
  # key_set('aemet')
  api_options &lt;- aemet_options(api_key = key_get('aemet'))
  get_stations_info_from('aemet', api_options)
}


</code></pre>

<hr>
<h2 id='services_options'>Options for meteorological services</h2><span id='topic+services_options'></span><span id='topic+aemet_options'></span><span id='topic+meteocat_options'></span><span id='topic+meteoclimatic_options'></span><span id='topic+meteogalicia_options'></span><span id='topic+ria_options'></span>

<h3>Description</h3>

<p>Set the options for accessing the different Spanish meteorological services
</p>


<h3>Usage</h3>

<pre><code class='language-R'>aemet_options(
  resolution = c("current_day", "daily", "monthly", "yearly"),
  start_date = Sys.Date(),
  end_date = start_date,
  stations = NULL,
  api_key
)

meteocat_options(
  resolution = c("instant", "hourly", "daily", "monthly", "yearly"),
  start_date = Sys.Date(),
  stations = NULL,
  api_key
)

meteoclimatic_options(resolution = c("current_day"), stations = NULL)

meteogalicia_options(
  resolution = c("instant", "current_day", "daily", "monthly"),
  start_date = Sys.Date(),
  end_date = start_date,
  stations = NULL
)

ria_options(
  resolution = c("daily", "monthly"),
  start_date = Sys.Date() - 1,
  end_date = start_date,
  stations = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="services_options_+3A_resolution">resolution</code></td>
<td>
<p>Character indicating the temporal resolution for the data. Services allows different
temporal resolutions that can be present or not in each of them (current_day, instant, daily, monthly).</p>
</td></tr>
<tr><td><code id="services_options_+3A_start_date">start_date</code></td>
<td>
<p>Date class object with the start date from which start collecting data. Ignored if
resolution is one of <code>current_day</code> or <code>instant</code>.</p>
</td></tr>
<tr><td><code id="services_options_+3A_end_date">end_date</code></td>
<td>
<p>Date class object with the end date from which stop collecting data. By default, same
date as <code>start_date</code>. Ignored if resolution is one of <code>current_day</code> or <code>instant</code>.</p>
</td></tr>
<tr><td><code id="services_options_+3A_stations">stations</code></td>
<td>
<p>Character vector with the stations codes from which extract data from. If NULL (default)
all available stations are returned. See Stations section for more details.</p>
</td></tr>
<tr><td><code id="services_options_+3A_api_key">api_key</code></td>
<td>
<p>Character with the API key. NULL by default as not all services require keys. See API Keys
section for more details.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the service API options to make the query to obtain the data.
</p>


<h3>Resolution</h3>

<p>Temporal resolutions vary from service to service. Check the &quot;Usage&quot; section to see resolutions available
to each service. Possible values are:
</p>

<ul>
<li><p><code>current_day</code> returns the last 24h of measures.
</p>
</li>
<li><p><code>instant</code> returns the last measures available.
</p>
</li>
<li><p><code>hourly</code> returns the hourly measures.
</p>
</li>
<li><p><code>daily</code> returns any past date/s with daily aggregation.
</p>
</li>
<li><p><code>monthly</code> returns any past date/s with monthly aggregation.
</p>
</li>
<li><p><code>yearly</code> returns any past date/s with yearly aggregation.
</p>
</li></ul>



<h3>Keys</h3>

<p>Some services (i.e. AEMET, MeteoCat...) require an API key to access the data. The requirements and process
to obtain the key varies from service to service.
</p>

<ul>
<li><p>AEMET: Visit <a href="https://opendata.aemet.es/centrodedescargas/inicio">https://opendata.aemet.es/centrodedescargas/inicio</a> and follow the instructions
at &quot;Obtención de API Key&quot;.
</p>
</li>
<li><p>MeteoCat: Visit <a href="https://apidocs.meteocat.gencat.cat/">https://apidocs.meteocat.gencat.cat/</a> and follow the instructions there.
</p>
</li></ul>

<p>It is not advisable to use the keys directly in any script shared or publicly available (github...), neither
store them in plain text files. One option is using the <a href="https://github.com/r-lib/keyring">keyring</a>
package for managing and accessing keys.
</p>


<h3>Stations</h3>

<p>Some services accept querying multiple stations at once, and other only allows one station per query:
</p>

<ul>
<li><p>AEMET: One or more stations can be provided in a character vector (except for
monthly and yearly resolutions, as they only accept one station.
</p>
</li>
<li><p>MeteoCat: One or more stations can be provided in a character vector.
</p>
</li>
<li><p>MeteoGalicia: One or more stations can be provided in a character vector.
</p>
</li>
<li><p>Meteoclimatic: Only one station can be provided. Nevertheless, some codes can be used to retrieve
common group of stations: &quot;ES&quot; for all Spanish stations, &quot;ESCAT&quot;, &quot;ESCYL&quot;, &quot;ESAND&quot;... for the different
autonomous communities.
</p>
</li>
<li><p>RIA: API accepts only one station. Nonetheless, an internal loop is performed to retrieve all the
stations provided
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
if (identical(Sys.getenv("NOT_CRAN"), "true")) {
  library(keyring)
  library(meteospain)

  ## AEMET examples ---------------------------------------------------------

  # setting the key (a prompt will appear in console to supply the API key)
  # keyring::key_set(service = 'aemet')

  # Options for the last 24h data
  current_opts &lt;- aemet_options(
    resolution = 'current_day',
    api = keyring::key_get('aemet')
  )

  # Options for daily data for January, 1990
  daily_opts &lt;- aemet_options(
    resolution = 'daily',
    start_date = as.Date('1990-01-01'),
    end_date = as.Date('1990-01-31'),
    api = keyring::key_get('aemet')
  )
}



if (identical(Sys.getenv("NOT_CRAN"), "true")) {
  ## MeteoCat examples -----------------------------------------------------------

  # setting the key (a prompt will appear in console to supply the API key)
  # keyring::key_set(service = 'meteocat')

  # create the options
  query_options &lt;- meteocat_options(
    resolution = 'hourly',
    start_date = as.Date('2020-12-31'),
    api = keyring::key_get('meteocat')
  )
}



## Meteoclimatic examples -------------------------------------------------

current_opts &lt;- meteoclimatic_options()
# same as before, but more verbose
current_opts &lt;- meteoclimatic_options(resolution = 'current_day', stations = 'ES')


## MeteoGalicia examples --------------------------------------------------

# Options for the last measured data
instant_opts &lt;- meteogalicia_options(resolution = 'instant')

# Options for the last 24h data
current_opts &lt;- meteogalicia_options(resolution = 'current_day')
# same, with stations
current_opts &lt;- meteogalicia_options('current_day', stations = c('10045', '10046'))

# Options for daily data for January, 2000
daily_opts &lt;- meteogalicia_options(
  resolution = 'daily',
  start_date = as.Date('2000-01-01'),
  end_date = as.Date('2000-01-31')
)

# Options for monthly data for year 2000
monthly_opts &lt;- meteogalicia_options(
  resolution = 'monthly',
  start_date = as.Date('2000-01-01'),
  end_date = as.Date('2000-12-31')
)


if (identical(Sys.getenv("NOT_CRAN"), "true")) {
  library(keyring)
  library(meteospain)

  ## RIA examples ---------------------------------------------------------

  # Options for daily data for April, 2020
  daily_opts &lt;- ria_options(
    resolution = 'daily',
    start_date = as.Date('2020-04-01'),
    end_date = as.Date('2020-04-30')
  )
}


</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
