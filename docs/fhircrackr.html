<!DOCTYPE html><html><head><title>Help for package fhircrackr</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {fhircrackr}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#as_fhir'><p>Coerce character vector to fhir_bundle_list</p></a></li>
<li><a href='#example_bundles1'><p>Toy example bundles for multiple entries</p></a></li>
<li><a href='#fhir_authenticate'><p>Create token for Authentication</p></a></li>
<li><a href='#fhir_body'><p>Create fhir_body object</p></a></li>
<li><a href='#fhir_body-class'><p>An s4 class to represent a body for a POST to a FHIR server</p></a></li>
<li><a href='#fhir_build_bundle'><p>Build a FHIR bundle</p></a></li>
<li><a href='#fhir_build_resource'><p>Build a single FHIR resource</p></a></li>
<li><a href='#fhir_bundle_list'><p>Create fhir_bundle_list object</p></a></li>
<li><a href='#fhir_bundle_list-class'><p>S4 class to represent a list of FHIR bundles</p></a></li>
<li><a href='#fhir_bundle_serialized-class'><p>An S4 class to represent a FHIR bundle in serialized form</p></a></li>
<li><a href='#fhir_bundle_xml'><p>Create fhir_bundle_xml object</p></a></li>
<li><a href='#fhir_bundle_xml-class'><p>An S4 class to represent a FHIR bundle in xml form</p></a></li>
<li><a href='#fhir_bundle-class'><p>An S4 class to represent FHIR bundles</p></a></li>
<li><a href='#fhir_canonical_design'><p>Retrieve design of last call to fhir_crack</p></a></li>
<li><a href='#fhir_capability_statement'><p>Get capability statement</p></a></li>
<li><a href='#fhir_cast'><p>Cast table with multiple entries</p>
This function divides multiple entries in a compact indexed table as produced by <code>fhir_crack()</code> into separate columns.</a></li>
<li><a href='#fhir_columns'><p>Create fhir_columns object</p></a></li>
<li><a href='#fhir_columns-class'><p>A S4 class to represent columns in a fhir_table_description</p></a></li>
<li><a href='#fhir_common_columns'><p>Find common columns</p></a></li>
<li><a href='#fhir_count_resource'><p>Get Resources' Counts</p></a></li>
<li><a href='#fhir_crack'><p>Flatten list of FHIR bundles</p></a></li>
<li><a href='#fhir_current_request'><p>Return FHIR search request used in last call to <code>fhir_search()</code> or <code>fhir_url()</code></p></a></li>
<li><a href='#fhir_design'><p>Create a fhir_design object</p></a></li>
<li><a href='#fhir_design-class'><p>A S4 class containing a design for <code>fhir_crack()</code></p></a></li>
<li><a href='#fhir_df_list-class'><p>List of data.frames as returned by <code>fhir_crack()</code></p></a></li>
<li><a href='#fhir_dt_list-class'><p>List of data.tables as returned by <code>fhir_crack()</code></p></a></li>
<li><a href='#fhir_get_resource_ids'><p>Get Resources' IDs</p></a></li>
<li><a href='#fhir_get_resources_by_ids'><p>Get Resources by their IDs</p></a></li>
<li><a href='#fhir_load'><p>Load bundles from xml-files</p></a></li>
<li><a href='#fhir_load_design'><p>Load design from xml</p></a></li>
<li><a href='#fhir_melt'><p>Melt multiple entries</p></a></li>
<li><a href='#fhir_next_bundle_url'><p>Next Bundle's URL</p></a></li>
<li><a href='#fhir_post'><p>POST to a FHIR server</p></a></li>
<li><a href='#fhir_put'><p>PUT to a FHIR server</p></a></li>
<li><a href='#fhir_recent_http_error'><p>Return most recent http error from <code>fhir_search()</code></p></a></li>
<li><a href='#fhir_request'><p>fhir_request</p></a></li>
<li><a href='#fhir_resource_serialized-class'><p>An S4 class to represent a FHIR resource in serialized form</p></a></li>
<li><a href='#fhir_resource_type'><p>Create fhir_resource_type object</p></a></li>
<li><a href='#fhir_resource_type-class'><p>A representation of a FHIR resource type</p></a></li>
<li><a href='#fhir_resource_xml'><p>Create fhir_resource_xml object</p></a></li>
<li><a href='#fhir_resource_xml-class'><p>An S4 class to represent a FHIR resource in xml form</p></a></li>
<li><a href='#fhir_resource-class'><p>An S4 class to represent FHIR resources</p></a></li>
<li><a href='#fhir_rm_div'><p>Remove html elements</p></a></li>
<li><a href='#fhir_rm_indices'><p>Remove indices from data.frame/data.table</p></a></li>
<li><a href='#fhir_rm_tag'><p>Remove a certain xml tag</p></a></li>
<li><a href='#fhir_sample_resources'><p>Randomly sample resources from a FHIR server</p></a></li>
<li><a href='#fhir_sample_resources_by_ids'><p>Download a random sample of resources from a vector of resource IDs.</p></a></li>
<li><a href='#fhir_save'><p>Save FHIR bundles as xml-files</p></a></li>
<li><a href='#fhir_save_design'><p>Write design to xml</p></a></li>
<li><a href='#fhir_search'><p>Download FHIR search result</p></a></li>
<li><a href='#fhir_serialize'><p>Serialize a fhir_bundle, fhir_bundle_list or fhir_resource</p></a></li>
<li><a href='#fhir_style'><p>Create fhir_style object</p></a></li>
<li><a href='#fhir_style-class'><p>An S4 class to represent a design for cracking FHIR resources</p></a></li>
<li><a href='#fhir_table_description'><p>Create fhir_table_description object</p></a></li>
<li><a href='#fhir_table_description-class'><p>A S4 class describing the form of a table produced by <code>fhir_crack()</code></p></a></li>
<li><a href='#fhir_tree'><p>Represent a wide cast table as a tree</p></a></li>
<li><a href='#fhir_unserialize'><p>Unserialize a fhir_bundle, fhir_bundle_list or fhir_resource</p></a></li>
<li><a href='#fhir_url'><p>Create FHIR URL</p></a></li>
<li><a href='#fhir_url-class'><p>An S4 object to represent a URL for a FHIR server</p></a></li>
<li><a href='#fhir_xpath_expression'><p>Create fhir_xpath_expression</p></a></li>
<li><a href='#fhir_xpath_expression-class'><p>An S4 class for xpath_expressions</p>
Objects of this class are essentially character vectors, but can only be valid
XPath (1.0) expressions.
They are mostly used in the <code>fhir_columns</code> class.</a></li>
<li><a href='#medication_bundles'><p>Exemplary FHIR bundles</p></a></li>
<li><a href='#paste_paths'><p>Concatenate two paths</p></a></li>
<li><a href='#pastep'><p>Concatenate paths</p></a></li>
<li><a href='#transaction_bundle_example'><p>Toy examples to POST/PUT on a server</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Handling HL7 FHIR® Resources in R</td>
</tr>
<tr>
<td>Version:</td>
<td>2.2.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-03-21</td>
</tr>
<tr>
<td>Description:</td>
<td>Useful tools for conveniently downloading FHIR resources in xml format 
    and converting them to R data.frames. The package uses FHIR-search to download bundles 
    from a FHIR server, provides functions to save and read xml-files containing such bundles 
    and allows flattening the bundles to data.frames using XPath expressions. FHIR® is the registered trademark 
    of HL7 and is used with the permission of HL7. Use of the FHIR trademark does not constitute endorsement of this product by HL7.</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/POLAR-fhiR/fhircrackr/issues">https://github.com/POLAR-fhiR/fhircrackr/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.1</td>
</tr>
<tr>
<td>Imports:</td>
<td>xml2, stringr, httr, utils, data.table, methods, parallel,
lifecycle</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.1.0)</td>
</tr>
<tr>
<td>Collate:</td>
<td>'fhir_body.R' 'fhir_resource.R' 'fhir_url.R' 'fhir_bundle.R'
'fhir_bundle_list.R' 'build_resources.R' 'design.R'
'download_resources.R' 'fhir_xpath_expression.R'
'fhir_columns.R' 'fhir_resource_type.R'
'fhir_table_description.R' 'fhir_design.R' 'fhir_style.R'
'fhir_table_list.R' 'fhir_tree.R' 'flatten_resources.R'
'miscellaneous.R' 'multiple_entries.R' 'sample_resources.R'</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-03-21 14:17:17 UTC; j01546</td>
</tr>
<tr>
<td>Author:</td>
<td>Thomas Peschel [aut],
  Julia Palm <a href="https://orcid.org/0000-0003-1568-5893"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cre],
  Jens Przybilla [aut],
  Frank Meineke <a href="https://orcid.org/0000-0002-9256-7543"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Julia Palm &lt;julia.palm@med.uni-jena.de&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-03-21 14:40:06 UTC</td>
</tr>
</table>
<hr>
<h2 id='as_fhir'>Coerce character vector to <a href="#topic+fhir_bundle_list-class">fhir_bundle_list</a></h2><span id='topic+as_fhir'></span>

<h3>Description</h3>

<p>Tries to convert a character vector containing xml strings representing FHIR bundles to an object of
class <a href="#topic+fhir_bundle_list-class">fhir_bundle_list</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as_fhir(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="as_fhir_+3A_x">x</code></td>
<td>
<p>A character vector where each element is a string representing an xml FHIR bundle.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
#character vector containing fhir bundles
bundle_strings &lt;- c(
"&lt;Bundle&gt;
 &lt;type value='searchset'/&gt;
 &lt;entry&gt;
  &lt;resource&gt;
    &lt;Patient&gt;
       &lt;id value='id1'/&gt;
	      &lt;name&gt;
	         &lt;given value='Marie'/&gt;
	      &lt;/name&gt;
    &lt;/Patient&gt;
  &lt;/resource&gt;
 &lt;/entry&gt;
&lt;/Bundle&gt;",
"&lt;Bundle&gt;
 &lt;type value='searchset'/&gt;
 &lt;entry&gt;
  &lt;resource&gt;
    &lt;Patient&gt;
       &lt;id value='id2'/&gt;
	      &lt;name&gt;
	         &lt;given value='Max'/&gt;
	      &lt;/name&gt;
    &lt;/Patient&gt;
  &lt;/resource&gt;
 &lt;/entry&gt;
&lt;/Bundle&gt;"
)

#convert to FHIR bundle list
bundles &lt;- as_fhir(bundle_strings)

</code></pre>

<hr>
<h2 id='example_bundles1'>Toy example bundles for multiple entries</h2><span id='topic+example_bundles1'></span><span id='topic+example_bundles2'></span><span id='topic+example_bundles3'></span><span id='topic+example_bundles4'></span><span id='topic+example_bundles5'></span>

<h3>Description</h3>

<p>These data examples are bundles that contain very few, very simple resources
that have multiple entries and can be used for demonstration purposes. See <strong>Source</strong> for how the
xml versions look.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>example_bundles1

example_bundles2

example_bundles3

example_bundles4

example_bundles5
</code></pre>


<h3>Format</h3>

<p>An object of class <code>fhir_bundle_list</code> of length 1.
</p>
<p>An object of class <code>fhir_bundle_list</code> of length 1.
</p>
<p>An object of class <code>fhir_bundle_list</code> of length 1.
</p>
<p>An object of class <code>fhir_bundle_list</code> of length 1.
</p>
<p>An object of class <code>fhir_bundle_list</code> of length 1.
</p>


<h3>Details</h3>

<p><code>example_bundles1</code> contains 1 bundle with 2 Patient resources.
</p>
<p><code>example_bundles2</code> contains 1 bundle with 3 Patient resources.
</p>
<p><code>example_bundles3</code> contains 1 bundle with 3 Patient resources and 1 Observation resource.
</p>
<p><code>example_bundles4</code> contains 1 bundle with 2 Medication resources, one of which has some <code style="white-space: pre;">&#8288;@id&#8288;</code> xml attributes
</p>
<p><code>example_bundles5</code> contains 1 bundle with 2 Observation resources.
</p>


<h3>Source</h3>

<p><strong>example_bundles1</strong>
</p>
<div class="sourceCode"><pre>&lt;Bundle&gt;
 &lt;type value='searchset'/&gt;
 &lt;entry&gt;
  &lt;resource&gt;
    &lt;Patient&gt;
       &lt;id value='id1'/&gt;
	      &lt;address&gt;
	         &lt;use value='home'/&gt;
	         &lt;city value='Amsterdam'/&gt;
	         &lt;type value='physical'/&gt;
	         &lt;country value='Netherlands'/&gt;
	      &lt;/address&gt;
	      &lt;name&gt;
	         &lt;given value='Marie'/&gt;
	      &lt;/name&gt;
    &lt;/Patient&gt;
  &lt;/resource&gt;
 &lt;/entry&gt;

 &lt;entry&gt;
  &lt;resource&gt;
    &lt;Patient&gt;
       &lt;id value='id3'/&gt;
	      &lt;address&gt;
	         &lt;use value='home'/&gt;
	         &lt;city value='Berlin'/&gt;
	      &lt;/address&gt;
       &lt;address&gt;
          &lt;type value='postal'/&gt;
          &lt;country value='France'/&gt;
       &lt;/address&gt;
	      &lt;address&gt;
	         &lt;use value='work'/&gt;
	         &lt;city value='London'/&gt;
	         &lt;type value='postal'/&gt;
	         &lt;country value='England'/&gt;
	      &lt;/address&gt;
       &lt;name&gt;
          &lt;given value='Frank'/&gt;
       &lt;/name&gt;
       &lt;name&gt;
          &lt;given value='Max'/&gt;
       &lt;/name&gt;
    &lt;/Patient&gt;
  &lt;/resource&gt;
 &lt;/entry&gt;
&lt;/Bundle&gt;
</pre></div>
<p><strong>example_bundles2</strong>
</p>
<div class="sourceCode"><pre>&lt;Bundle&gt;
 &lt;type value='searchset'/&gt;
 &lt;entry&gt;
  &lt;resource&gt;
     &lt;Patient&gt;
        &lt;id value='id1'/&gt;
        &lt;address&gt;
           &lt;use value='home'/&gt;
           &lt;city value='Amsterdam'/&gt;
           &lt;type value='physical'/&gt;
           &lt;country value='Netherlands'/&gt;
        &lt;/address&gt;
        &lt;name&gt;
           &lt;given value='Marie'/&gt;
        &lt;/name&gt;
     &lt;/Patient&gt;
   &lt;/resource&gt;
 &lt;/entry&gt;

 &lt;entry&gt;
  &lt;resource&gt;
    &lt;Patient&gt;
        &lt;id value='id2'/&gt;
        &lt;address&gt;
           &lt;use value='home'/&gt;
           &lt;city value='Rome'/&gt;
           &lt;type value='physical'/&gt;
           &lt;country value='Italy'/&gt;
        &lt;/address&gt;
        &lt;address&gt;
           &lt;use value='work'/&gt;
           &lt;city value='Stockholm'/&gt;
	          &lt;type value='postal'/&gt;
           &lt;country value='Sweden'/&gt;
        &lt;/address&gt;
        &lt;name&gt;
           &lt;given value='Susie'/&gt;
       &lt;/name&gt;
    &lt;/Patient&gt;
  &lt;/resource&gt;
 &lt;/entry&gt;

 &lt;entry&gt;
  &lt;resource&gt;
    &lt;Patient&gt;
       &lt;id value='id3'/&gt;
       &lt;address&gt;
          &lt;use value='home'/&gt;
          &lt;city value='Berlin'/&gt;
       &lt;/address&gt;
       &lt;address&gt;
          &lt;type value='postal'/&gt;
          &lt;country value='France'/&gt;
       &lt;/address&gt;
       &lt;address&gt;
          &lt;use value='work'/&gt;
          &lt;city value='London'/&gt;
          &lt;type value='postal'/&gt;
          &lt;country value='England'/&gt;
       &lt;/address&gt;
       &lt;name&gt;
          &lt;given value='Frank'/&gt;
      &lt;/name&gt;
      &lt;name&gt;
          &lt;given value='Max'/&gt;
       &lt;/name&gt;
    &lt;/Patient&gt;
  &lt;/resource&gt;
 &lt;/entry&gt;
&lt;/Bundle&gt;
</pre></div>
<p><strong>example_bundles3</strong>
</p>
<div class="sourceCode"><pre>&lt;Bundle&gt;
 &lt;type value='searchset'/&gt;
 &lt;entry&gt;
  &lt;resource&gt;
    &lt;Patient&gt;
       &lt;id value='id1'/&gt;
       &lt;address&gt;
          &lt;use value='home'/&gt;
          &lt;city value='Amsterdam'/&gt;
          &lt;type value='physical'/&gt;
          &lt;country value='Netherlands'/&gt;
       &lt;/address&gt;
       &lt;name&gt;
          &lt;given value='Marie'/&gt;
       &lt;/name&gt;
    &lt;/Patient&gt;
  &lt;/resource&gt;
 &lt;/entry&gt;

 &lt;entry&gt;
  &lt;resource&gt;
    &lt;Patient&gt;
       &lt;id value='id2'/&gt;
       &lt;address&gt;
          &lt;use value='home'/&gt;
          &lt;city value='Rome'/&gt;
          &lt;type value='physical'/&gt;
          &lt;country value='Italy'/&gt;
       &lt;/address&gt;
       &lt;address&gt;
          &lt;use value='work'/&gt;
          &lt;city value='Stockholm'/&gt;
          &lt;type value='postal'/&gt;
          &lt;country value='Sweden'/&gt;
       &lt;/address&gt;
       &lt;name&gt;
          &lt;given value='Susie'/&gt;
       &lt;/name&gt;
    &lt;/Patient&gt;
  &lt;/resource&gt;
 &lt;/entry&gt;

 &lt;entry&gt;
  &lt;resource&gt;
    &lt;Patient&gt;
       &lt;id value='id3'/&gt;
       &lt;address&gt;
          &lt;use value='home'/&gt;
          &lt;city value='Berlin'/&gt;
       &lt;/address&gt;
       &lt;address&gt;
          &lt;type value='postal'/&gt;
          &lt;country value='France'/&gt;
       &lt;/address&gt;
       &lt;address&gt;
          &lt;use value='work'/&gt;
          &lt;city value='London'/&gt;
          &lt;type value='postal'/&gt;
          &lt;country value='England'/&gt;
       &lt;/address&gt;
       &lt;name&gt;
          &lt;given value='Frank'/&gt;
       &lt;/name&gt;
       &lt;name&gt;
          &lt;given value='Max'/&gt;
       &lt;/name&gt;
    &lt;/Patient&gt;
  &lt;resource/&gt;
 &lt;/entry&gt;

 &lt;entry&gt;
  &lt;resource&gt;
    &lt;Observation&gt;
       &lt;id value = 'obs1'/&gt;
       &lt;code&gt;
          &lt;coding&gt;
             &lt;system value='http://loinc.org'/&gt;
             &lt;code value='29463-7'/&gt;
             &lt;display value='Body Weight'/&gt;
          &lt;/coding&gt;
          &lt;coding&gt;
             &lt;system value='http://snomed.info/sct'/&gt;
             &lt;code value='27113001'/&gt;
             &lt;display value='Body weight'/&gt;
          &lt;/coding&gt;
       &lt;/code&gt;
       &lt;subject&gt;
          &lt;reference value='Patient/id3'/&gt;
       &lt;/subject&gt;
    &lt;/Observation&gt;
  &lt;/resource&gt;
 &lt;/entry&gt;
&lt;/Bundle&gt;"

</pre></div>
<p><strong>example_bundles4</strong>
</p>
<div class="sourceCode"><pre>&lt;Bundle&gt;
    &lt;type value='searchset'/&gt;
 &lt;entry&gt;
	 &lt;resource&gt;
		&lt;Medication&gt;
		    &lt;id value='1285'/&gt;
		    &lt;code&gt;
		        &lt;coding&gt;
		            &lt;system value='http://www.nlm.nih.gov/research/umls/rxnorm'/&gt;
		            &lt;code value='1594660'/&gt;
		            &lt;display value='Alemtuzumab 10mg/ml (Lemtrada)'/&gt;
		        &lt;/coding&gt;
		    &lt;/code&gt;
		    &lt;ingredient id='1'&gt;
		    	&lt;itemReference&gt;
	        		&lt;reference value='Substance/5463'/&gt;
	    		&lt;/itemReference&gt;
		    &lt;/ingredient&gt;
		    &lt;ingredient id='2'&gt;
		    	&lt;itemReference&gt;
	        		&lt;reference value='Substance/3401'/&gt;
	    		&lt;/itemReference&gt;
		    &lt;/ingredient&gt;
		&lt;/Medication&gt;
	&lt;/resource&gt;
 &lt;/entry&gt;

 &lt;entry&gt;
	 &lt;resource&gt;
         &lt;Medication&gt;
             &lt;id value='45226'/&gt;
             &lt;code&gt;
                 &lt;coding&gt;
                     &lt;system value='http://snomed.info/sct'/&gt;
                     &lt;code value='373994007'/&gt;
                     &lt;display value='Prednisone 5mg tablet (Product)'/&gt;
                 &lt;/coding&gt;
                 &lt;text value='Prednisone 5mg tablet (Product)'/&gt;
             &lt;/code&gt;
		    &lt;ingredient id='1'&gt;
		    	&lt;itemReference&gt;
	        		&lt;reference value='Substance/6912'/&gt;
	    		&lt;/itemReference&gt;
		    &lt;/ingredient&gt;
		    &lt;ingredient id='2'&gt;
		    	&lt;itemReference&gt;
	        		&lt;reference value='Substance/3710'/&gt;
	    		&lt;/itemReference&gt;
		    &lt;/ingredient&gt;
		&lt;/Medication&gt;
	&lt;/resource&gt;
 &lt;/entry&gt;

&lt;/Bundle&gt;

</pre></div>
<p><strong>example_bundles5</strong>
</p>
<div class="sourceCode"><pre>&lt;Bundle&gt;
 &lt;type value='searchset'/&gt;
 &lt;entry&gt;
  &lt;resource&gt;
    &lt;Observation&gt;
       &lt;id value = 'obs1'/&gt;
       &lt;code&gt;
          &lt;coding&gt;
             &lt;system value='http://loinc.org'/&gt;
             &lt;code value='29463-7'/&gt;
             &lt;display value='Body Weight'/&gt;
          &lt;/coding&gt;
          &lt;coding&gt;
             &lt;system value='http://snomed.info/sct'/&gt;
             &lt;code value='27113001'/&gt;
             &lt;display value='Body weight'/&gt;
          &lt;/coding&gt;
       &lt;/code&gt;
       &lt;subject&gt;
          &lt;reference value='Patient/id3'/&gt;
       &lt;/subject&gt;
    &lt;/Observation&gt;
  &lt;/resource&gt;
 &lt;/entry&gt;

 &lt;entry&gt;
  &lt;resource&gt;
    &lt;Observation&gt;
       &lt;id value = 'obs2'/&gt;
       &lt;code&gt;
          &lt;coding&gt;
             &lt;system value='http://loinc.org'/&gt;
             &lt;code value='8302-2'/&gt;
             &lt;display value='Body Height'/&gt;
          &lt;/coding&gt;
          &lt;coding&gt;
             &lt;system value='http://snomed.info/sct'/&gt;
             &lt;code value='50373000'/&gt;
             &lt;display value='Body height measure'/&gt;
          &lt;/coding&gt;
       &lt;/code&gt;
       &lt;subject&gt;
          &lt;reference value='Patient/id3'/&gt;
       &lt;/subject&gt;
    &lt;/Observation&gt;
  &lt;/resource&gt;
 &lt;/entry&gt;
&lt;/Bundle&gt;"

</pre></div>


<h3>Examples</h3>

<pre><code class='language-R'>#unserialize xml objects before doing anything else with them!
fhir_unserialize(bundles = example_bundles1)
#unserialize xml objects before doing anything else with them!
fhir_unserialize(bundles = example_bundles2)
#unserialize xml objects before doing anything else with them!
fhir_unserialize(bundles = example_bundles3)
#unserialize xml objects before doing anything else with them!
fhir_unserialize(bundles = example_bundles4)
#unserialize xml objects before doing anything else with them!
fhir_unserialize(bundles = example_bundles5)
</code></pre>

<hr>
<h2 id='fhir_authenticate'>Create token for Authentication</h2><span id='topic+fhir_authenticate'></span>

<h3>Description</h3>

<p>This function is a wrapper to create an <a href="httr.html#topic+Token-class">httr::Token</a> object for authentication with OAuth2/OpenID Connect.
Internally, it calls <code><a href="httr.html#topic+oauth_app">httr::oauth_app()</a></code>, <code><a href="httr.html#topic+oauth_endpoint">httr::oauth_endpoint()</a></code> and <code><a href="httr.html#topic+oauth2.0_token">httr::oauth2.0_token()</a></code> to create a token that can
then be used in <a href="#topic+fhir_search">fhir_search</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_authenticate(
  secret,
  key,
  base_url,
  access,
  authorize,
  query_authorize_extra = list()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_authenticate_+3A_secret">secret</code></td>
<td>
<p>The consumer/client secret, belonging to <code>key</code>.</p>
</td></tr>
<tr><td><code id="fhir_authenticate_+3A_key">key</code></td>
<td>
<p>Consumer key, also called client ID.
For Keycloak this would for instance be the Keycloak client, e.g. &quot;postman&quot;.</p>
</td></tr>
<tr><td><code id="fhir_authenticate_+3A_base_url">base_url</code></td>
<td>
<p>The URL the user will be redirected to after authorization is complete.
This will usually be the base url of you FHIR server.</p>
</td></tr>
<tr><td><code id="fhir_authenticate_+3A_access">access</code></td>
<td>
<p>The url used to exchange unauthenticated for authenticated token.
This can be identical to <code>authorize</code>.</p>
</td></tr>
<tr><td><code id="fhir_authenticate_+3A_authorize">authorize</code></td>
<td>
<p>The url to send the client for authorization.</p>
</td></tr>
<tr><td><code id="fhir_authenticate_+3A_query_authorize_extra">query_authorize_extra</code></td>
<td>
<p>A named list holding query parameters to append to initial auth page query.
Could hold info about user identity and scope for keycloak like this:
</p>
<div class="sourceCode"><pre>list(scope = "openid",
     grant_type = "password",
     username = "fhir-user",
     password = "fhirtest")
</pre></div></td></tr>
</table>

<hr>
<h2 id='fhir_body'>Create <a href="#topic+fhir_body-class">fhir_body</a> object</h2><span id='topic+fhir_body'></span><span id='topic+fhir_body+2Clist+2Cmissing-method'></span><span id='topic+fhir_body+2Clist+2Cmissing-methods'></span><span id='topic+fhir_body+2Clist+2Ccharacter-method'></span><span id='topic+fhir_body+2Clist+2Ccharacter-methods'></span><span id='topic+fhir_body+2Ccharacter+2Ccharacter-method'></span><span id='topic+fhir_body+2Ccharacter+2Ccharacter-methods'></span>

<h3>Description</h3>

<p>Create <a href="#topic+fhir_body-class">fhir_body</a> object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_body(content, type)

## S4 method for signature 'list,missing'
fhir_body(content)

## S4 method for signature 'list,character'
fhir_body(content, type)

## S4 method for signature 'character,character'
fhir_body(content, type)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_body_+3A_content">content</code></td>
<td>
<p>A character vector of length one representing the body for the post in the format specified in <code>type</code>.
If you provide a named list here, it will be taken as key value pairs of FHIR search parameters
and will be concatenated appropriately. In this case the <code>type</code> will automatically be set to
<code>"application/x-www-form-urlencoded"</code>. See examples.</p>
</td></tr>
<tr><td><code id="fhir_body_+3A_type">type</code></td>
<td>
<p>A string defining the type of the body e.g. <code>"application/x-www-form-urlencoded"</code> or <code>"xml"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of type <a href="#topic+fhir_body-class">fhir_body</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#body that could be used in a FHIR search request POSTed to an URL like baseurl/Patient/_search
fhir_body(content = "gender=female&amp;_summary=count", type="application/x-www-form-urlencoded")
fhir_body(content = list("gender" = "female", "_summary" = "count"))
</code></pre>

<hr>
<h2 id='fhir_body-class'>An s4 class to represent a body for a POST to a FHIR server</h2><span id='topic+fhir_body-class'></span>

<h3>Description</h3>

<p>Objects of this class should always be created with a call to the function <code><a href="#topic+fhir_body">fhir_body()</a></code>
</p>


<h3>Slots</h3>


<dl>
<dt><code>content</code></dt><dd><p>A vector of length one representing the body for the post.</p>
</dd>
<dt><code>type</code></dt><dd><p>A vector of length one defining the type of the body e.g. <code>"application/x-www-form-urlencoded"</code> or <code>"xml"</code>.</p>
</dd>
</dl>

<hr>
<h2 id='fhir_build_bundle'>Build a FHIR bundle</h2><span id='topic+fhir_build_bundle'></span><span id='topic+fhir_build_bundle+2Cdata.frame-method'></span><span id='topic+fhir_build_bundle+2Clist-method'></span>

<h3>Description</h3>

<p>This function takes a table as produced by <code><a href="#topic+fhir_crack">fhir_crack()</a></code> with <code>format="wide"</code> and builds a <a href="#topic+fhir_bundle_xml-class">fhir_bundle_xml</a> object from it. It is primarily used
to create transaction/batch bundles to POST back to a FHIR server. The column names of the table must represent the XPath expression of the
respective element with indices for repeating items. A table like this is produced when FHIR resources have been cracked with <code><a href="#topic+fhir_crack">fhir_crack()</a></code> without
assigning explicit column names in the <a href="#topic+fhir_design-class">fhir_design</a>/<a href="#topic+fhir_table_description-class">fhir_table_description</a> and the format has been set to <code>"wide"</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_build_bundle(
  table,
  brackets,
  resource_type,
  bundle_type = "transaction",
  verbose = 1
)

## S4 method for signature 'data.frame'
fhir_build_bundle(
  table,
  brackets,
  resource_type,
  bundle_type = "transaction",
  verbose = 1
)

## S4 method for signature 'list'
fhir_build_bundle(table, brackets, bundle_type = "transaction", verbose = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_build_bundle_+3A_table">table</code></td>
<td>
<p>A wide table as produced by <code><a href="#topic+fhir_crack">fhir_crack()</a></code>, possibly modified (see details) or a named list
of wide tables, if different resource types have to be included in the same bundle. In this case the names of
the list elements must correspond to the resource type represented in the table!</p>
</td></tr>
<tr><td><code id="fhir_build_bundle_+3A_brackets">brackets</code></td>
<td>
<p>A character vector of length one. The brackets used for cracking.</p>
</td></tr>
<tr><td><code id="fhir_build_bundle_+3A_resource_type">resource_type</code></td>
<td>
<p>A character vector of length one or <a href="#topic+fhir_resource_type-class">fhir_resource_type</a> object
indicating which resource type is represented in the table, if a single table is provided. This argument is
ignored when <code>table</code> is a named list of tables.</p>
</td></tr>
<tr><td><code id="fhir_build_bundle_+3A_bundle_type">bundle_type</code></td>
<td>
<p>A character vector of length one defining the bundle type. Will usually be
either <code>"transaction"</code> (the default) or <code>"batch"</code>.</p>
</td></tr>
<tr><td><code id="fhir_build_bundle_+3A_verbose">verbose</code></td>
<td>
<p>An integer vector of length one. If 0, nothing is printed, if &gt; 0 progress message is printed. Defaults to 1.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The typical use case would look like this:
</p>

<ol>
<li><p> Download resources from a server with <code><a href="#topic+fhir_search">fhir_search()</a></code>
</p>
</li>
<li><p> Crack to wide format them with <code><a href="#topic+fhir_crack">fhir_crack()</a></code>
</p>
</li>
<li><p> Do something to values (e.g. some kind of anonymization)
</p>
</li>
<li><p> Translate the data back into FHIR resources with <code><a href="#topic+fhir_build_bundle">fhir_build_bundle()</a></code>
</p>
</li>
<li><p> Post the resources to a server
</p>
</li></ol>

<p>A FHIR bundle that can be POSTed to a server is usually of type <code>transaction</code> or <code>batch</code>. Each entry of these bundles consists of the resource itself
as well as an instruction for the server of what to to with the resource. A very simple example looks like this:
</p>
<div class="sourceCode"><pre>&lt;Bundle&gt;
   &lt;type value="transaction"/&gt;
  &lt;entry&gt;
     &lt;resource&gt;
        &lt;Patient&gt;
           &lt;id value="id1"/&gt;
	       &lt;address&gt;
	          &lt;city value="Amsterdam"/&gt;
	          &lt;country value="Netherlands"/&gt;
	       &lt;/address&gt;
	       &lt;name&gt;
	          &lt;given value="Marie"/&gt;
	       &lt;/name&gt;
        &lt;/Patient&gt;
    &lt;/resource&gt;
    &lt;request&gt;
	   &lt;method value="POST"/&gt;
	   &lt;url value="Patient"/&gt;
    &lt;/request&gt;
 &lt;/entry&gt;
 &lt;entry&gt;
     &lt;resource&gt;
        &lt;Patient&gt;
           &lt;id value="id2"/&gt;
	       &lt;address&gt;
	          &lt;city value="Paris"/&gt;
	          &lt;country value="France"/&gt;
	       &lt;/address&gt;
	       &lt;name&gt;
	          &lt;given value="Anne"/&gt;
	       &lt;/name&gt;
        &lt;/Patient&gt;
    &lt;/resource&gt;
    &lt;request&gt;
	   &lt;method value="POST"/&gt;
	   &lt;url value="Patient"/&gt;
    &lt;/request&gt;
 &lt;/entry&gt;
&lt;/Bundle&gt;
</pre></div>
<p>In this example the bundle contains two Patient resources that are sent to server with a POST. For more information the structure of transaction/batch bundles,
please see the FHIR documentation at https://www.hl7.org/fhir/http.html and https://www.hl7.org/fhir/bundle.html.
</p>
<p>In the table, each row corresponds to one resource that is created. To add the information for the <code>request</code> element of the bundle,
this table has to be augmented with two columns named <code>request.method</code> and <code>request.url</code>, which contain the respective HTTP verb and URL for the resource.
If these columns are not added to the table, <code><a href="#topic+fhir_build_bundle">fhir_build_bundle()</a></code> still builds bundles from it, but those bundles will not be POSTable to a server. See examples.
</p>


<h3>Value</h3>

<p>A <a href="#topic+fhir_bundle_xml-class">fhir_bundle_xml</a> object.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fhir_crack">fhir_crack()</a></code>,<code><a href="#topic+fhir_cast">fhir_cast()</a></code>, <code><a href="#topic+fhir_build_resource">fhir_build_resource()</a></code>, <code><a href="#topic+fhir_post">fhir_post()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#unserialize example
bundles &lt;- fhir_unserialize(bundles = example_bundles1)

#crack fhir resources
table_desc_pat &lt;- fhir_table_description(
    resource = "Patient",
    brackets = c("[", "]"),
    sep      = " ",
    format   = "wide"
)

df &lt;- fhir_crack(bundles = bundles, design = table_desc_pat)

#add request info to table
request &lt;- data.frame(
    request.method = c("POST", "PUT"),
    request.url    = c("Patient", "Patient/id3")
)

request_df &lt;- cbind(df, request)

#build bundle
bundle &lt;- fhir_build_bundle(table          = request_df,
                            brackets       = table_desc_pat@brackets,
                            resource_type  = "Patient",
                            bundle_type    = "transaction")

#print to console
cat(toString(bundle))
</code></pre>

<hr>
<h2 id='fhir_build_resource'>Build a single FHIR resource</h2><span id='topic+fhir_build_resource'></span>

<h3>Description</h3>

<p>This function takes a single row from a wide table as produced by <code><a href="#topic+fhir_crack">fhir_crack()</a></code> and builds a <a href="#topic+fhir_resource_xml-class">fhir_resource_xml</a> object from it. The column names of the table
must represent the XPath expression of the respective element with indices for repeating items. A table like this is produced when FHIR resources have
been cracked with <code><a href="#topic+fhir_crack">fhir_crack()</a></code> without assigning explicit column names in the <a href="#topic+fhir_design-class">fhir_design</a>/<a href="#topic+fhir_table_description-class">fhir_table_description</a> and with <code>format</code> set to <code>"wide"</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_build_resource(row, brackets, resource_type)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_build_resource_+3A_row">row</code></td>
<td>
<p>Single row from a wide table as produced by <code><a href="#topic+fhir_crack">fhir_crack()</a></code> with <code>format="wide"</code></p>
</td></tr>
<tr><td><code id="fhir_build_resource_+3A_brackets">brackets</code></td>
<td>
<p>A character vector of length one. The brackets used for cracking.</p>
</td></tr>
<tr><td><code id="fhir_build_resource_+3A_resource_type">resource_type</code></td>
<td>
<p>A character vector of length one or <a href="#topic+fhir_resource_type-class">fhir_resource_type</a> object
indicating which resource type the table is build from.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <a href="#topic+fhir_resource_xml-class">fhir_resource_xml</a> object.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fhir_cast">fhir_cast()</a></code>, <code><a href="#topic+fhir_crack">fhir_crack()</a></code>, <code><a href="#topic+fhir_build_bundle">fhir_build_bundle()</a></code>, <code><a href="#topic+fhir_post">fhir_post()</a></code>, <code><a href="#topic+fhir_put">fhir_put()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#unserialize example
bundles &lt;- fhir_unserialize(bundles = example_bundles1)

#crack fhir resources
Pat &lt;- fhir_table_description(
    resource = "Patient",
    brackets = c("[", "]"),
    sep      = " ",
    format   = "wide"
)

df &lt;- fhir_crack(bundles = bundles, design = Pat)


#build resource
resource &lt;- fhir_build_resource(
                row           = df[1,],
                brackets      = c('[', ']'),
                resource_type = "Patient"
            )

#print to console
resource
</code></pre>

<hr>
<h2 id='fhir_bundle_list'>Create <a href="#topic+fhir_bundle_list-class">fhir_bundle_list</a> object</h2><span id='topic+fhir_bundle_list'></span>

<h3>Description</h3>

<p>A fhir_bundle_list is a list of fhir_bundle_xml or fhir_bundle_serialized objects. It is
usually returned by a call to <code><a href="#topic+fhir_search">fhir_search()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_bundle_list(bundles)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_bundle_list_+3A_bundles">bundles</code></td>
<td>
<p>A list of xml_nodes/fhir_bundle_xml objects or of raw/fhir_bundle_serialized objects</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The only scenario where one would use this constructor function is when several <a href="#topic+fhir_bundle-class">fhir_bundle</a>
or <a href="#topic+fhir_bundle_list-class">fhir_bundle_list</a> objects should be merged into one big <a href="#topic+fhir_bundle_list-class">fhir_bundle_list</a> before cracking (see examples).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#unserialize example bundles
bundles1 &lt;- fhir_unserialize(example_bundles1)
bundles2 &lt;- fhir_unserialize(example_bundles2)

#bind them together in one fhir_bundle_list
bound_bundles &lt;- fhir_bundle_list(c(bundles1, bundles2))
class(bound_bundles)

#bound list contains bundles from both original lists
length(bundles1)
length(bundles2)
length(bound_bundles)



#Create fhir_bundle list from xml objects
b1 &lt;- xml2::read_xml("&lt;Bundle&gt;&lt;Resource&gt;&lt;item value='1'/&gt;&lt;/Resource&gt;&lt;/Bundle&gt;")
b2 &lt;- xml2::read_xml("&lt;Bundle&gt;&lt;Resource&gt;&lt;item value='2'/&gt;&lt;/Resource&gt;&lt;/Bundle&gt;")

fhir_bundle_list(bundles = list(b1, b2))
fhir_bundle_list(bundles = list(fhir_bundle_xml(b1), fhir_bundle_xml(b2)))

r1 &lt;- xml2::xml_serialize(object = b1, connection= NULL)
r2 &lt;- xml2::xml_serialize(object = b2, connection= NULL)

fhir_bundle_list(bundles = list(r1, r2))
</code></pre>

<hr>
<h2 id='fhir_bundle_list-class'>S4 class to represent a list of FHIR bundles</h2><span id='topic+fhir_bundle_list-class'></span>

<h3>Description</h3>

<p>A fhir_bundle_list is a list of fhir_bundle_xml or fhir_bundle_serialized objects. It should
not be created by the user but returned by a call to <code><a href="#topic+fhir_search">fhir_search()</a></code>.
</p>

<hr>
<h2 id='fhir_bundle_serialized-class'>An S4 class to represent a FHIR bundle in serialized form</h2><span id='topic+fhir_bundle_serialized-class'></span>

<h3>Description</h3>

<p>A <code>fhir_bundle_serialized</code> is a <code>fhir_bundle_xml</code> that has been serialized using <code><a href="#topic+fhir_serialize">fhir_serialize()</a></code>. In this form, the
bundle cannot be used in any meaningful way, but it can be saved and loaded as an <code>.RData</code> or <code>.rds</code> object without breaking the
external pointers in the xml. See <code>?fhir_serialize</code> and <code>?fhir_unserialize</code>.
</p>

<hr>
<h2 id='fhir_bundle_xml'>Create <a href="#topic+fhir_bundle_xml-class">fhir_bundle_xml</a> object</h2><span id='topic+fhir_bundle_xml'></span>

<h3>Description</h3>

<p>This should only be used if you want to create small examples. Usually, a <code>fhir_bundle_xml</code> will
be returned by <code><a href="#topic+fhir_search">fhir_search()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_bundle_xml(bundle)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_bundle_xml_+3A_bundle">bundle</code></td>
<td>
<p>A xml-object representing a FHIR bundle</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>fhir_bundle_xml(bundle = xml2::xml_unserialize(patient_bundles[[1]]))

</code></pre>

<hr>
<h2 id='fhir_bundle_xml-class'>An S4 class to represent a FHIR bundle in xml form</h2><span id='topic+fhir_bundle_xml-class'></span>

<h3>Description</h3>

<p>A <code>fhir_bundle_xml</code> is an xml representation of a FHIR bundle (https://www.hl7.org/fhir/bundle.html).
It is usually found inside a <code>fhir_bundle_list</code> which is returned by a call to <code><a href="#topic+fhir_search">fhir_search()</a></code>.
</p>


<h3>Slots</h3>


<dl>
<dt><code>next_link</code></dt><dd><p>A <a href="#topic+fhir_url-class">fhir_url</a> pointing to the next bundle on the server.</p>
</dd>
<dt><code>self_link</code></dt><dd><p>A <a href="#topic+fhir_url-class">fhir_url</a> pointing to this bundle on the server.</p>
</dd>
</dl>

<hr>
<h2 id='fhir_bundle-class'>An S4 class to represent FHIR bundles</h2><span id='topic+fhir_bundle-class'></span>

<h3>Description</h3>

<p>An S4 class to represent FHIR bundles
</p>

<hr>
<h2 id='fhir_canonical_design'>Retrieve design of last call to fhir_crack</h2><span id='topic+fhir_canonical_design'></span>

<h3>Description</h3>

<p>Returns the <a href="#topic+fhir_design-class">fhir_design</a> of the last call to <code><a href="#topic+fhir_crack">fhir_crack()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_canonical_design()
</code></pre>


<h3>See Also</h3>

<p><code><a href="#topic+fhir_design">fhir_design()</a></code>, <code><a href="#topic+fhir_table_description">fhir_table_description()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#load example bundles
bundles &lt;- fhir_unserialize(bundles = patient_bundles)

#define design
patients &lt;- fhir_table_description(resource = 'Patient')

design &lt;- fhir_design(patients)

result &lt;- fhir_crack(bundles = bundles, design = design)

fhir_canonical_design()

</code></pre>

<hr>
<h2 id='fhir_capability_statement'>Get capability statement</h2><span id='topic+fhir_capability_statement'></span>

<h3>Description</h3>

<p>Get the capability statement of a FHIR server.
</p>
<p>This function downloads a capability statement and creates three data.frames from it:
</p>

<ul>
<li> <p><code>Meta</code> contains general information on the server
</p>
</li>
<li> <p><code>Rest</code> contains information on the Rest operations the server supports
</p>
</li>
<li> <p><code>Resources</code> contains information on the supported resource types
</p>
</li></ul>

<p>When there is more than one piece of information regarding a variable in these data.frames,
they are divided by the string specified in <code>sep</code>. If <code>brackets</code> is not NULL, those entries
will also be assigned indices so you can melt them using <code><a href="#topic+fhir_melt">fhir_melt()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_capability_statement(
  url = "https://hapi.fhir.org/baseR4",
  username = NULL,
  password = NULL,
  token = NULL,
  add_headers = NULL,
  brackets = NULL,
  sep = " ::: ",
  log_errors = NULL,
  verbose = deprecated()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_capability_statement_+3A_url">url</code></td>
<td>
<p>The base URL of the FHIR server.</p>
</td></tr>
<tr><td><code id="fhir_capability_statement_+3A_username">username</code></td>
<td>
<p>A character vector of length one containing the username for basic authentication. Defaults to NULL, meaning no authentication.</p>
</td></tr>
<tr><td><code id="fhir_capability_statement_+3A_password">password</code></td>
<td>
<p>A character vector of length one containing the password for basic authentication. Defaults to NULL, meaning no authentication.</p>
</td></tr>
<tr><td><code id="fhir_capability_statement_+3A_token">token</code></td>
<td>
<p>A character vector of length one or object of class <a href="httr.html#topic+Token-class">httr::Token</a>, for bearer token authentication (e.g. OAuth2). See <code><a href="#topic+fhir_authenticate">fhir_authenticate()</a></code>
for how to create this.</p>
</td></tr>
<tr><td><code id="fhir_capability_statement_+3A_add_headers">add_headers</code></td>
<td>
<p>A named character vector of custom headers to add to the HTTP request, e.g. <code>c(myHeader = "somevalue")</code> or
<code>c(firstHeader = "value1", secondHeader = "value2")</code>.</p>
</td></tr>
<tr><td><code id="fhir_capability_statement_+3A_brackets">brackets</code></td>
<td>
<p>A character vector of length two defining the brackets surrounding indices for multiple entries, e.g. <code>c( "[", "]")</code>. Defaults to <code>NULL</code>.
If <code>NULL</code>, no indices will be added to multiple entries.</p>
</td></tr>
<tr><td><code id="fhir_capability_statement_+3A_sep">sep</code></td>
<td>
<p>A character vector of length one to separate pasted multiple entries</p>
</td></tr>
<tr><td><code id="fhir_capability_statement_+3A_log_errors">log_errors</code></td>
<td>
<p>Either <code>NULL</code> or a character vector of length one indicating the name of a file in which to save the http errors.
<code>NULL</code> means no error logging. When a file name is provided, the errors are saved in the specified file. Defaults to <code>NULL</code></p>
</td></tr>
<tr><td><code id="fhir_capability_statement_+3A_verbose">verbose</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of data frames containing the information from the statement
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
#without indices
cap &lt;- fhir_capability_statement(url = "https://server.fire.ly")

#with indices
cap &lt;- fhir_capability_statement(url = "https://server.fire.ly",
                                 brackets = c("[","]"),
                                 sep = " || ")

#melt searchInclude variable
resources &lt;- fhir_melt(cap$Resources,
                       columns = "searchInclude",
                       brackets = c("[", "]"),
                       sep = " || ",
                       all_columns = FALSE)

#remove indices
resources &lt;- fhir_rm_indices(resources, brackets = c("[", "]"))

head(resources)

## End(Not run)
</code></pre>

<hr>
<h2 id='fhir_cast'>Cast table with multiple entries
This function divides multiple entries in a compact indexed table as produced by <code><a href="#topic+fhir_crack">fhir_crack()</a></code> into separate columns.</h2><span id='topic+fhir_cast'></span>

<h3>Description</h3>

<p>This function turns a table from compact format into wide format. Every column containing multiple entries will be turned into multiple columns.
The number of columns created from a single column in the original table is determined by the maximum number of
multiple entries occurring in this column. Rows with less than the maximally occurring number of entries will
be filled with NA values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_cast(indexed_df, brackets, sep, verbose = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_cast_+3A_indexed_df">indexed_df</code></td>
<td>
<p>A compact data.frame/data.table with indexed multiple entries. Column names should reflect the XPath expression of the respective element.</p>
</td></tr>
<tr><td><code id="fhir_cast_+3A_brackets">brackets</code></td>
<td>
<p>A character vector of length two, defining the brackets used for the indices.</p>
</td></tr>
<tr><td><code id="fhir_cast_+3A_sep">sep</code></td>
<td>
<p>A character vector of length one defining the separator that was used when pasting together multiple entries in <code><a href="#topic+fhir_crack">fhir_crack()</a></code>.</p>
</td></tr>
<tr><td><code id="fhir_cast_+3A_verbose">verbose</code></td>
<td>
<p>An integer vector of length one. If 0, nothing is printed, if 1, only general progress is printed, if &gt; 1,
progress for each variable is printed. Defaults to 1.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For <code><a href="#topic+fhir_cast">fhir_cast()</a></code> to work properly, column names of the input data must reflect the Xpath to the corresponding resource element
with <code>.</code> as a separator, e.g. <code>code.coding.system</code>. These names are produced automatically by <code><a href="#topic+fhir_crack">fhir_crack()</a></code>
when the names are not explicitly set in the <code>cols</code> element of the <code><a href="#topic+fhir_table_description">fhir_table_description()</a></code>/<code><a href="#topic+fhir_design">fhir_design()</a></code>.
</p>
<p>In the names of the newly created columns the indices will be added in front of the column names, similar to the result of <code><a href="#topic+fhir_crack">fhir_crack()</a></code> with
<code>format="wide"</code>. See examples and the corresponding package vignette for a more detailed description.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fhir_crack">fhir_crack()</a></code>, <code><a href="#topic+fhir_melt">fhir_melt()</a></code>, <code><a href="#topic+fhir_build_bundle">fhir_build_bundle()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#unserialize example
bundles &lt;- fhir_unserialize(bundles = example_bundles1)

#crack fhir resources
table_desc &lt;- fhir_table_description(
    resource = "Patient",
    brackets = c('[', ']'),
    sep      = " ",
    keep_attr=TRUE
)
df &lt;- fhir_crack(bundles = bundles, design = table_desc)

#original df
df

#cast
fhir_cast(df, brackets=c('[', ']'), sep = ' ', verbose = 0)

</code></pre>

<hr>
<h2 id='fhir_columns'>Create <a href="#topic+fhir_columns-class">fhir_columns</a> object</h2><span id='topic+fhir_columns'></span><span id='topic+fhir_columns+2Cmissing+2Cmissing-method'></span><span id='topic+fhir_columns+2CNULL+2Cmissing-method'></span><span id='topic+fhir_columns+2Ccharacter+2Ccharacter-method'></span><span id='topic+fhir_columns+2Ccharacter+2Cmissing-method'></span><span id='topic+fhir_columns+2Clist+2Cmissing-method'></span>

<h3>Description</h3>

<p>An object of class <code>fhir_columns</code> is part of a <code>fhir_table_description</code> in a <code>fhir_design</code> and holds information on the elements
that should be extracted from the FHIR resources, as well as the column names of the resulting data.frame.
The elements to be extracted are indicated by XPath xpaths. If no column names are provided,
they are generated automatically and reflect the elements position in the resource.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_columns(xpaths, colnames)

## S4 method for signature 'missing,missing'
fhir_columns()

## S4 method for signature ''NULL',missing'
fhir_columns(xpaths)

## S4 method for signature 'character,character'
fhir_columns(xpaths, colnames)

## S4 method for signature 'character,missing'
fhir_columns(xpaths)

## S4 method for signature 'list,missing'
fhir_columns(xpaths)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_columns_+3A_xpaths">xpaths</code></td>
<td>
<p>A (named) character vector or (named) list containing xpath xpaths,
or a <a href="#topic+fhir_xpath_expression-class">fhir_xpath_expression</a> object.</p>
</td></tr>
<tr><td><code id="fhir_columns_+3A_colnames">colnames</code></td>
<td>
<p>The names of the columns to create. If no colnames are provided and the list or vector
in <code>xpaths</code> has names, those names are taken as the colnames. If no colnames are provided and
<code>xpaths</code> is unnamed too, the colnames are generated automatically from the xpath xpaths. See examples.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'> #provide colnames explicitly
 fhir_columns(xpaths = c("name/given", "code/coding/code"),
              colnames = c("name", "code"))

 #colnames are taken from xpaths argument
 fhir_columns(xpaths = c(name = "name/given", code = "code/coding/code"))

 #colnames are taken from xpaths argument
 fhir_columns(xpaths = list(name = "name/given", code = "code/coding/code"))

 #colnames are generated automatically
 fhir_columns(xpaths = c("name/given", "code/coding/code"))
</code></pre>

<hr>
<h2 id='fhir_columns-class'>A S4 class to represent columns in a <a href="#topic+fhir_table_description-class">fhir_table_description</a></h2><span id='topic+fhir_columns-class'></span>

<h3>Description</h3>

<p>An object of class <code>fhir_columns</code> is part of a <a href="#topic+fhir_table_description-class">fhir_table_description</a>
in a <a href="#topic+fhir_design-class">fhir_design</a> and holds information on the elements
that should be extracted from the FHIR resources, as well as the column names of the resulting data.frame.
The elements to be extracted are indicated by XPath xpaths.
</p>


<h3>Slots</h3>


<dl>
<dt><code>names</code></dt><dd><p>The column names</p>
</dd>
</dl>

<hr>
<h2 id='fhir_common_columns'>Find common columns</h2><span id='topic+fhir_common_columns'></span>

<h3>Description</h3>

<p>This is a convenience function to find all column names in a data frame starting with the same string that can
then be used for <code><a href="#topic+fhir_melt">fhir_melt()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_common_columns(data_frame, column_names_prefix)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_common_columns_+3A_data_frame">data_frame</code></td>
<td>
<p>A data.frame/data.table with automatically named columns as produced by <code><a href="#topic+fhir_crack">fhir_crack()</a></code>.</p>
</td></tr>
<tr><td><code id="fhir_common_columns_+3A_column_names_prefix">column_names_prefix</code></td>
<td>
<p>A string containing the common prefix of the desired columns.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It is intended for use on data frames with column names that have been automatically produced by <code><a href="#topic+fhir_design">fhir_design()</a></code>/<code><a href="#topic+fhir_crack">fhir_crack()</a></code>
and follow the form <code>level1.level2.level3</code> such as <code>name.given</code> or <code>code.coding.system</code>.
Note that this function will only work on column names following exactly this scheme.
</p>
<p>The resulting character vector can be used for melting all columns belonging to the same attribute in an indexed data frame,
see <code>?fhir_melt</code>.
</p>


<h3>Value</h3>

<p>A character vector with the names of all columns matching <code>column_names_prefix</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fhir_melt">fhir_melt()</a></code>, <code><a href="#topic+fhir_rm_indices">fhir_rm_indices()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#unserialize example bundles
bundles &lt;- fhir_unserialize(bundles = medication_bundles)

#crack Patient Resources
pats &lt;- fhir_table_description(resource = "Patient")

df &lt;- fhir_crack(bundles = bundles, design = pats)

#look at automatically generated names
names(df)

#extract all column names beginning with the string "name"
fhir_common_columns(data_frame = df, column_names_prefix = "name")
</code></pre>

<hr>
<h2 id='fhir_count_resource'>Get Resources' Counts</h2><span id='topic+fhir_count_resource'></span>

<h3>Description</h3>

<p>Downloads a count of resources matching the resource type and search parameters specified in <code>resource</code> and <code>parameters</code>.
This function makes use of the <code style="white-space: pre;">&#8288;_summary=count&#8288;</code> parameter of FHIR search and is therefore able to count resources on the server
without actually downloading them.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_count_resource(
  base_url,
  resource,
  parameters = NULL,
  username = NULL,
  password = NULL,
  token = NULL,
  add_headers = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_count_resource_+3A_base_url">base_url</code></td>
<td>
<p>A character vector of length one specifying the base URL of the FHIR server, e.g. <code>"http://hapi.fhir.org/baseR4"</code>.</p>
</td></tr>
<tr><td><code id="fhir_count_resource_+3A_resource">resource</code></td>
<td>
<p>A character vector of length one or <a href="#topic+fhir_resource_type-class">fhir_resource_type</a> object with the resource type to be searched, e.g. <code>"Patient"</code>.</p>
</td></tr>
<tr><td><code id="fhir_count_resource_+3A_parameters">parameters</code></td>
<td>
<p>Optional. Either a length 1 character vector containing properly formatted FHIR search parameters, e.g.
<code>"gender=male&amp;_summary=count"</code> or a named list or named character vector e.g. <code>list(gender="male", "_summary"="count")</code>
or <code>c(gender="male", "_summary"="count")</code>. Note that parameter names beginning with <code style="white-space: pre;">&#8288;_&#8288;</code> have to be put in quotation marks!</p>
</td></tr>
<tr><td><code id="fhir_count_resource_+3A_username">username</code></td>
<td>
<p>A character vector of length one containing the username for basic authentication.</p>
</td></tr>
<tr><td><code id="fhir_count_resource_+3A_password">password</code></td>
<td>
<p>A character vector of length one containing the password for basic authentication.</p>
</td></tr>
<tr><td><code id="fhir_count_resource_+3A_token">token</code></td>
<td>
<p>A character vector of length one or object of class <a href="httr.html#topic+Token-class">httr::Token</a>, for bearer token authentication (e.g. OAuth2). See <code><a href="#topic+fhir_authenticate">fhir_authenticate()</a></code>
for how to create this.</p>
</td></tr>
<tr><td><code id="fhir_count_resource_+3A_add_headers">add_headers</code></td>
<td>
<p>A named character vector of custom headers to add to the HTTP request, e.g. <code>c(myHeader = "somevalue")</code> or
<code>c(firstHeader = "value1", secondHeader = "value2")</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For more information on authentication options, please see the help page of <code><a href="#topic+fhir_search">fhir_search()</a></code>
</p>


<h3>Value</h3>

<p>An integer of length 1 containing the number of resources matching the type and search parameters specified in <code>resource</code> and <code>parameters</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

#the try({}, silent = TRUE) statement is only there to catch errors when the server is down
#you can skip it when the server is reachable

try({

#number of female Patient resources on the server
fhir_count_resource(
  base_url = 'https://vonk.fire.ly/R4',
  resource = "Patient",
  parameters = c(gender = "female"))
}, silent = TRUE)

</code></pre>

<hr>
<h2 id='fhir_crack'>Flatten list of FHIR bundles</h2><span id='topic+fhir_crack'></span><span id='topic+fhir_crack+2CANY+2Cfhir_table_description-method'></span><span id='topic+fhir_crack+2Cfhir_table_description-method'></span><span id='topic+fhir_crack+2CANY+2Cfhir_design-method'></span><span id='topic+fhir_crack+2Cfhir_design-method'></span>

<h3>Description</h3>

<p>Converts a <a href="#topic+fhir_bundle_list-class">fhir_bundle_list</a> (the result of <code><a href="#topic+fhir_search">fhir_search()</a></code>) to a data.frame/data.table or list of df/dt,
if more than one resource type is extracted at once.
</p>
<p>There are two main output formats for the table: compact and wide. They differ regarding their handling of multiple occurrences of
the same FHIR element (e.g. <code>Patient.adress</code>). In the compact format multiple occurrences are pasted together into one cell/column,
in the wide format multiple occurrences are distributed over several (indexed) columns. If none of the resources contains any multiple
values on the extracted elements, the two formats will result in the same structure.
</p>
<p>To increase speed with larger amounts of data the cracking process can be parallelised over a number of cores defined in the
<code>ncores</code> argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_crack(
  bundles,
  design,
  sep = NULL,
  brackets = NULL,
  rm_empty_cols = NULL,
  verbose = 2,
  data.table = FALSE,
  format = NULL,
  keep_attr = NULL,
  ncores = 1
)

## S4 method for signature 'ANY,fhir_table_description'
fhir_crack(
  bundles,
  design,
  sep = NULL,
  brackets = NULL,
  rm_empty_cols = NULL,
  verbose = 2,
  data.table = FALSE,
  format = NULL,
  keep_attr = NULL,
  ncores = 1
)

## S4 method for signature 'ANY,fhir_design'
fhir_crack(
  bundles,
  design,
  sep = NULL,
  brackets = NULL,
  rm_empty_cols = NULL,
  verbose = 2,
  data.table = FALSE,
  format = NULL,
  keep_attr = NULL,
  ncores = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_crack_+3A_bundles">bundles</code></td>
<td>
<p>A FHIR search result as returned by <code><a href="#topic+fhir_search">fhir_search()</a></code>.</p>
</td></tr>
<tr><td><code id="fhir_crack_+3A_design">design</code></td>
<td>
<p>A <a href="#topic+fhir_design-class">fhir_design</a> or <a href="#topic+fhir_table_description-class">fhir_table_description</a> object. See <code><a href="#topic+fhir_design">fhir_design()</a></code>/<code><a href="#topic+fhir_table_description">fhir_table_description()</a></code>
and the corresponding vignette (<code>vignette("flattenResources", package ="fhircrackr")</code>) for a more detailed explanation and
comprehensive examples of both.</p>
</td></tr>
<tr><td><code id="fhir_crack_+3A_sep">sep</code></td>
<td>
<p>Optional. A character of length one containing the separator string used for separating multiple entries in cells when <code>format = "compact"</code>.
Will overwrite the <code>sep</code> defined in <code>design</code>. If <code>sep = NULL</code>, it is looked up in <code>design</code>, where the default is <code>":::"</code>.</p>
</td></tr>
<tr><td><code id="fhir_crack_+3A_brackets">brackets</code></td>
<td>
<p>Optional. A character of length one or two used for the indices of multiple entries, which will overwrite the <code>brackets</code> defined in <code>design</code>.
If <code>brackets = NULL</code>, it is looked up in <code>design</code>, where the default is <code>character(0)</code>,i.e. no indices are added to multiple entries.
Empty strings (<code>""</code>) are not allowed.</p>
</td></tr>
<tr><td><code id="fhir_crack_+3A_rm_empty_cols">rm_empty_cols</code></td>
<td>
<p>Optional. Remove empty columns? Logical scalar which will overwrite the <code>rm_empty_cols</code> defined in
<code>design</code>. If <code>rm_empty_cols = NULL</code>, it is looked up in <code>design</code>, where the default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="fhir_crack_+3A_verbose">verbose</code></td>
<td>
<p>An integer vector of length one. If 0, nothing is printed, if 1, only finishing message is printed, if &gt; 1,
extraction progress will be printed. Defaults to 2.</p>
</td></tr>
<tr><td><code id="fhir_crack_+3A_data.table">data.table</code></td>
<td>
<p>A logical vector of length one. If it is set to <code>TRUE</code> the fhir_crack-function returns a data.table, otherwise a data.frame.
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="fhir_crack_+3A_format">format</code></td>
<td>
<p>Optional. A character of length one indicating whether the resulting table should be cracked to a <code>wide</code> or <code>compact</code> format. Will overwrite the <code>format</code> defined
in <code>design</code> which defaults to <code>compact</code>. <code>wide</code> means multiple entries will be distributed over several columns with indexed names. <code>compact</code> means multiple entries will be pasted into one cell/column separated by <code>sep</code>.</p>
</td></tr>
<tr><td><code id="fhir_crack_+3A_keep_attr">keep_attr</code></td>
<td>
<p>Optional. A logical of length one indicating whether the attribute name of the respective element (<code style="white-space: pre;">&#8288;@value&#8288;</code> in most cases)
should be attached to the name of the variable in the resulting table. Will overwrite <code>keep_attr</code> in <code>design</code> which defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="fhir_crack_+3A_ncores">ncores</code></td>
<td>
<p>Either <code>NULL</code> (no parallelisation) or an integer of length 1 containing the number of
cpu cores that should be used for parallelised cracking. Parallelisation currently only works on linux systems.
Defaults to <code>NULL</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If a <a href="#topic+fhir_design-class">fhir_design</a> was used, the result is a list of data.frames, i.e. a <a href="#topic+fhir_df_list-class">fhir_df_list</a> object, or a list of data.tables,
i.e. a <a href="#topic+fhir_dt_list-class">fhir_dt_list</a> object. If a <a href="#topic+fhir_table_description-class">fhir_table_description</a> was used, the result is a single data.frame/data.table.
</p>


<h3>See Also</h3>


<ul>
<li><p> Downloading bundles from a FHIR server: <code><a href="#topic+fhir_search">fhir_search()</a></code>
</p>
</li>
<li><p> Creating designs/table_descriptions: <code><a href="#topic+fhir_table_description">fhir_table_description()</a></code> and <code><a href="#topic+fhir_design">fhir_design()</a></code>
</p>
</li>
<li><p> Dealing with multiple entries: <code><a href="#topic+fhir_melt">fhir_melt()</a></code>, <code><a href="#topic+fhir_cast">fhir_cast()</a></code>, <code><a href="#topic+fhir_rm_indices">fhir_rm_indices()</a></code>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>#unserialize example bundle
bundles &lt;- fhir_unserialize(medication_bundles)


###Example 1###
#Extract just one resource type

#define attributes to extract
med_desc &lt;- fhir_table_description(
   resource = "MedicationStatement",
   cols     = c(
   	id              = "id",
   	status          = "status",
   	system          = "medicationCodeableConcept/coding/system",
   	code            = "medicationCodeableConcept/coding/code",
   	display         = "medicationCodeableConcept/coding/display"
  )
)

med_df &lt;- fhir_crack(bundles = bundles, design = med_desc)

head(med_df) #data.frame


###Example 2###
#extract two resource types at once

pat_desc &lt;- fhir_table_description(
   resource = "Patient"
)

design &lt;- fhir_design(med_desc, pat_desc)

df_list &lt;- fhir_crack(bundles = bundles, design = design)

#list of data.frames/fhir_df_list
head(df_list$med_desc)
head(df_list$pat_desc)

#The design that was used can be extracted from a fhir_df_list
fhir_design(df_list)


###Example 3###
#Filter values before extracting

#unserialize example bundle
b &lt;- fhir_unserialize(bundles = example_bundles5)

#only extract codings with loinc system
table_desc &lt;- fhir_table_description(
                    resource = "Observation",
                    cols = c(
                      id = "id",
		                 loinc = "code/coding[system[@value='http://loinc.org']]/code",
	                 display = "code/coding[system[@value='http://loinc.org']]/display"
	                 )
)

table &lt;- fhir_crack(bundles = b,
				    design = table_desc)

table
</code></pre>

<hr>
<h2 id='fhir_current_request'>Return FHIR search request used in last call to <code><a href="#topic+fhir_search">fhir_search()</a></code> or <code><a href="#topic+fhir_url">fhir_url()</a></code></h2><span id='topic+fhir_current_request'></span>

<h3>Description</h3>

<p>Return FHIR search request used in last call to <code><a href="#topic+fhir_search">fhir_search()</a></code> or <code><a href="#topic+fhir_url">fhir_url()</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_current_request()
</code></pre>


<h3>Value</h3>

<p>An object of class <code><a href="#topic+fhir_url">fhir_url()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#the try({}, silent = TRUE) statement is only there to catch errors when the server is down
#you can skip it when the server is reachable

try({


request &lt;- fhir_url(url = "https://server.fire.ly", resource = "Patient")
fhir_current_request()

fhir_search("https://server.fire.ly/Medication", max_bundles = 1)
fhir_current_request()


},silent = TRUE)




</code></pre>

<hr>
<h2 id='fhir_design'>Create a <a href="#topic+fhir_design-class">fhir_design</a> object</h2><span id='topic+fhir_design'></span><span id='topic+fhir_design+2Cfhir_table_description-method'></span><span id='topic+fhir_design+2Clist-method'></span><span id='topic+fhir_design+2Cfhir_table_list-method'></span>

<h3>Description</h3>

<p>A <code>fhir_design</code> is a named list of <code>fhir_table_description</code> objects (See <code><a href="#topic+fhir_table_description">fhir_table_description()</a></code>)
and should be created using the function described here. The design is used in <code><a href="#topic+fhir_crack">fhir_crack()</a></code> to tell
the function how to flatten each resource type.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_design(...)

## S4 method for signature 'fhir_table_description'
fhir_design(...)

## S4 method for signature 'list'
fhir_design(...)

## S4 method for signature 'fhir_table_list'
fhir_design(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_design_+3A_...">...</code></td>
<td>
<p>One or more <code>fhir_table_description</code> objects or a named list containing
<code>fhir_table_description</code> objects, or an object of class <a href="#topic+fhir_df_list-class">fhir_df_list</a>/<a href="#topic+fhir_dt_list-class">fhir_dt_list</a>.
See <code><a href="#topic+fhir_table_description">fhir_table_description()</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A <code>fhir_design</code> looks for example like this:
</p>
<div class="sourceCode"><pre>A fhir_design with 2 table_descriptions:
A fhir_table_description with the following elements:

	fhir_resource_type: Patient

fhir_columns:
	------------ -----------------
	column name | xpath expression
------------ -----------------
	id          | id
name        | name/family
gender      | gender
------------ -----------------

	sep:           '||'
brackets:      '[', ']'
rm_empty_cols: FALSE
format:        'compact'
keep_attr:     TRUE

A fhir_table_description with the following elements:

	fhir_resource_type: MedicationAdministration

fhir_columns:
	An empty fhir_columns object

sep:           ':::'
brackets:      no brackets
rm_empty_cols: FALSE
format:        'wide'
keep_attr:     TRUE
</pre></div>
<p>The names of the table_descriptions are taken from the names of the arguments. If the table_descriptions are
created within the call to <code>fhir_design</code> and therefore have no names, the names will be created from the respective
resource type. See examples.
</p>
<p>For backwards compatibility it is for the moment also possible to build it from an
old-style design as used in <code style="white-space: pre;">&#8288;fhircrackr (&lt; 1.0.0)&#8288;</code>. See examples.
</p>
<p>If this function is given an object of class <a href="#topic+fhir_df_list-class">fhir_df_list</a> or <a href="#topic+fhir_dt_list-class">fhir_dt_list</a>, it will
extract the design that was used to create the respective list.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fhir_table_description">fhir_table_description()</a></code>, <code><a href="#topic+fhir_crack">fhir_crack()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
####Example 1####

###create fhir_table_descriptions first
#see ?fhir_table_description for explanation

pat &lt;- fhir_table_description(
    resource      = "Patient",
    cols          = c(
        id            = "id",
        name          = "name/family",
        gender        = "gender"
    ),
    sep           = "||",
    brackets      = c("[", "]"),
    rm_empty_cols = FALSE

)

meds &lt;- fhir_table_description(resource = "MedicationAdministration")

###create design
#First option: Explicitly define names

design1 &lt;- fhir_design(Pats = pat, Medics = meds)
print(design1)


#Second option: Names are taken from the object names

design2 &lt;- fhir_design(pat, meds)
print(design2)


#Third option: Create table_description within fhir_design

design3 &lt;- fhir_design(fhir_table_description(resource = "MedicationAdministration"))
print(design3)


#Fourth option: Names are taken from named list

design3 &lt;- fhir_design(list(Patients = pat, Medications = meds))
print(design3)


###Example 2###
###Extract design from fhir_df_list/fhir_dt_list

#unserialize and crack example bundles
med_bundles &lt;- fhir_unserialize(bundles = medication_bundles)
dfs &lt;- fhir_crack(bundles = med_bundles, design = design1)

#extract design

fhir_design(dfs)

</code></pre>

<hr>
<h2 id='fhir_design-class'>A S4 class containing a design for <code><a href="#topic+fhir_crack">fhir_crack()</a></code></h2><span id='topic+fhir_design-class'></span>

<h3>Description</h3>

<p>A fhir_design is a named list of <a href="#topic+fhir_table_description-class">fhir_table_description</a> objects. Each table_description
contains information on how to flatten one resource type which will result in one
data.frame. The fhir_design is passed to the function <code><a href="#topic+fhir_crack">fhir_crack()</a></code> along with a
list of bundles containing FHIR resources.
</p>


<h3>Slots</h3>


<dl>
<dt><code>.Data</code></dt><dd><p>The list of <code>fhir_table_description</code> objects.</p>
</dd>
<dt><code>names</code></dt><dd><p>The names of the table_descriptions. Those will also be the names of the
resulting data.frames.</p>
</dd>
</dl>


<h3>See Also</h3>

<p><code><a href="#topic+fhir_table_description">fhir_table_description()</a></code>, <code><a href="#topic+fhir_crack">fhir_crack()</a></code>
</p>

<hr>
<h2 id='fhir_df_list-class'>List of data.frames as returned by <code><a href="#topic+fhir_crack">fhir_crack()</a></code></h2><span id='topic+fhir_df_list-class'></span>

<h3>Description</h3>

<p>Objects of this class are returned by <code><a href="#topic+fhir_crack">fhir_crack()</a></code> when <code>data.table=FALSE</code> (the default).
They behave like an ordinary named list of data.frames but have some additional information
in the slot <code>design</code>.
</p>


<h3>Slots</h3>


<dl>
<dt><code>names</code></dt><dd><p>Character vector containing the names of the data.frames.</p>
</dd>
<dt><code>design</code></dt><dd><p>An object of class <a href="#topic+fhir_design-class">fhir_design</a> that was used to create the df_list.</p>
</dd>
</dl>

<hr>
<h2 id='fhir_dt_list-class'>List of data.tables as returned by <code><a href="#topic+fhir_crack">fhir_crack()</a></code></h2><span id='topic+fhir_dt_list-class'></span>

<h3>Description</h3>

<p>Objects of this class are returned by <code><a href="#topic+fhir_crack">fhir_crack()</a></code> when <code>data.table=TRUE</code>.
They behave like an ordinary named list of data.tables but have some additional information
in the slot <code>design</code>.
</p>


<h3>Slots</h3>


<dl>
<dt><code>names</code></dt><dd><p>A character vector containing the names of the data.tables.</p>
</dd>
<dt><code>design</code></dt><dd><p>An object of class <a href="#topic+fhir_design-class">fhir_design</a> that was used to create the dt_list.</p>
</dd>
</dl>

<hr>
<h2 id='fhir_get_resource_ids'>Get Resources' IDs</h2><span id='topic+fhir_get_resource_ids'></span>

<h3>Description</h3>

<p>Download the resource (aka logical) IDs of all resources matching the FHIR search request build from the resource type and search
parameters specified in <code>resource</code> and <code>parameters</code>. This function does not download the entire resources, but only extracts their IDs
using the <code style="white-space: pre;">&#8288;_elements&#8288;</code> parameter of FHIR Search.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_get_resource_ids(
  base_url,
  resource,
  parameters = NULL,
  username = NULL,
  password = NULL,
  token = NULL,
  add_headers = NULL,
  verbose = 0
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_get_resource_ids_+3A_base_url">base_url</code></td>
<td>
<p>A character vector of length one specifying the base URL of the FHIR server, e.g. <code>"http://hapi.fhir.org/baseR4"</code>.</p>
</td></tr>
<tr><td><code id="fhir_get_resource_ids_+3A_resource">resource</code></td>
<td>
<p>A character vector of length one or <a href="#topic+fhir_resource_type-class">fhir_resource_type</a> object with the resource type to be searched, e.g. <code>"Patient"</code>.</p>
</td></tr>
<tr><td><code id="fhir_get_resource_ids_+3A_parameters">parameters</code></td>
<td>
<p>Optional. Either a length 1 character vector containing properly formatted FHIR search parameters, e.g.
<code>"gender=male&amp;_summary=count"</code> or a named list or named character vector e.g. <code>list(gender="male", "_summary"="count")</code>
or <code>c(gender="male", "_summary"="count")</code>. Note that parameter names beginning with <code style="white-space: pre;">&#8288;_&#8288;</code> have to be put in quotation marks!</p>
</td></tr>
<tr><td><code id="fhir_get_resource_ids_+3A_username">username</code></td>
<td>
<p>A character vector of length one containing the username for basic authentication.</p>
</td></tr>
<tr><td><code id="fhir_get_resource_ids_+3A_password">password</code></td>
<td>
<p>A character vector of length one containing the password for basic authentication.</p>
</td></tr>
<tr><td><code id="fhir_get_resource_ids_+3A_token">token</code></td>
<td>
<p>A character vector of length one or object of class <a href="httr.html#topic+Token-class">httr::Token</a>, for bearer token authentication (e.g. OAuth2). See <code><a href="#topic+fhir_authenticate">fhir_authenticate()</a></code>
for how to create this.</p>
</td></tr>
<tr><td><code id="fhir_get_resource_ids_+3A_add_headers">add_headers</code></td>
<td>
<p>A named character vector of custom headers to add to the HTTP request, e.g. <code>c(myHeader = "somevalue")</code> or
<code>c(firstHeader = "value1", secondHeader = "value2")</code>.</p>
</td></tr>
<tr><td><code id="fhir_get_resource_ids_+3A_verbose">verbose</code></td>
<td>
<p>An integer of length 1 containing the level of verbosity. Defaults to 0.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For more information on authentication options, please see the help page of <code><a href="#topic+fhir_search">fhir_search()</a></code>
</p>


<h3>Value</h3>

<p>A character vector containing the resource (aka logical) IDs of all requested resources.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fhir_search">fhir_search()</a></code>, <code><a href="#topic+fhir_get_resources_by_ids">fhir_get_resources_by_ids()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

#the try({}, silent = TRUE) statement is only there to catch errors when the server is down
#you can skip it when the server is reachable

try({

fhir_get_resource_ids(
  base_url   = 'https://vonk.fire.ly/R4',
  resource   = "Patient",
  parameters = "gender=female", verbose=1)

  }, silent = TRUE)

  
</code></pre>

<hr>
<h2 id='fhir_get_resources_by_ids'>Get Resources by their IDs</h2><span id='topic+fhir_get_resources_by_ids'></span>

<h3>Description</h3>

<p>Downloads FHIR resources represented by a vector of resource IDs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_get_resources_by_ids(
  base_url,
  resource,
  ids,
  id_param = "_id",
  parameters = NULL,
  username = NULL,
  password = NULL,
  token = NULL,
  add_headers = NULL,
  verbose = 0
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_get_resources_by_ids_+3A_base_url">base_url</code></td>
<td>
<p>A character vector of length one specifying the base URL of the FHIR server, e.g. <code>"http://hapi.fhir.org/baseR4"</code>.</p>
</td></tr>
<tr><td><code id="fhir_get_resources_by_ids_+3A_resource">resource</code></td>
<td>
<p>A character vector of length one or <a href="#topic+fhir_resource_type-class">fhir_resource_type</a> object with the resource type to be searched, e.g. <code>"Patient"</code>.</p>
</td></tr>
<tr><td><code id="fhir_get_resources_by_ids_+3A_ids">ids</code></td>
<td>
<p>A character vector containing the IDs of the resources that should be downloaded. In the default setting these should be resource (aka logical) IDs.</p>
</td></tr>
<tr><td><code id="fhir_get_resources_by_ids_+3A_id_param">id_param</code></td>
<td>
<p>A character vector of length one containing the FHIR Search parameter belonging to the ids in <code>ids</code>. Defaults to <code>"_id"</code> meaning <code>ids</code> is interpreted as
containing resource (aka logical) ids. Could be changed to <code>"identifier"</code> if <code>ids</code> contains a vector of identifier values instead.</p>
</td></tr>
<tr><td><code id="fhir_get_resources_by_ids_+3A_parameters">parameters</code></td>
<td>
<p>FHIR Search parameters to further restrict the set of resources that is returned, e.g. <code>gender=male</code> to only download the resources from
the <code>ids</code> list that correspond to males. Can be either a length 1 character containing properly formatted FHIR search parameters, e.g.
<code>"gender=male"</code> or a named list or named character vector e.g. <code>list(gender="male")</code>or <code>c(gender="male")</code>. Defaults to <code>NULL</code> meaning no restriction on
the IDs provided in <code>ids</code>.</p>
</td></tr>
<tr><td><code id="fhir_get_resources_by_ids_+3A_username">username</code></td>
<td>
<p>A character vector of length one containing the username for basic authentication.</p>
</td></tr>
<tr><td><code id="fhir_get_resources_by_ids_+3A_password">password</code></td>
<td>
<p>A character vector of length one containing the password for basic authentication.</p>
</td></tr>
<tr><td><code id="fhir_get_resources_by_ids_+3A_token">token</code></td>
<td>
<p>A character vector of length one or object of class <a href="httr.html#topic+Token-class">httr::Token</a>, for bearer token authentication (e.g. OAuth2). See <code><a href="#topic+fhir_authenticate">fhir_authenticate()</a></code>
for how to create this.</p>
</td></tr>
<tr><td><code id="fhir_get_resources_by_ids_+3A_add_headers">add_headers</code></td>
<td>
<p>A named character vector of custom headers to add to the HTTP request, e.g. <code>c(myHeader = "somevalue")</code> or
<code>c(firstHeader = "value1", secondHeader = "value2")</code>.</p>
</td></tr>
<tr><td><code id="fhir_get_resources_by_ids_+3A_verbose">verbose</code></td>
<td>
<p>An integer vector of length 1 containing the level of verbosity. Defaults to 0.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function takes a character vector <code>ids</code> containing logical Ids of resources of a given type (specified in <code>resource</code>) on a
FHIR server (specified in <code>base_url</code>) and downloads the corresponding resources from the server. The function will attempt to download the resources using a
FHIR search request via POST where the IDs are part of the body. See <code><a href="#topic+fhir_search">fhir_search()</a></code> for details. If this fails
(e.g. because the server doesn't allow POST operations), the function falls back on a GET request. If the set of ids is too long to fit
into one GET request (i.e. if the request gets longer than 2083 characters), it will be spread across several requests.
</p>
<p>For more information on authentication options, please see the help page of <code><a href="#topic+fhir_search">fhir_search()</a></code>
</p>


<h3>Value</h3>

<p>A <a href="#topic+fhir_bundle_list-class">fhir_bundle_list</a> containing the downloaded resources.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fhir_search">fhir_search()</a></code>, <code><a href="#topic+fhir_get_resource_ids">fhir_get_resource_ids()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

#the try({}, silent = TRUE) statement is only there to catch errors when the server is down
#you can skip it when the server is reachable

try({

#find IDs of Patient resources representing Homer Simpson
ids &lt;- fhir_get_resource_ids(
  base_url   = 'https://hapi.fhir.org/baseR4',
  resource   = "Patient",
  parameters = "name=Homer&amp;name=Simpson")

#Download all corresponding resources
bundles &lt;- fhir_get_resources_by_ids(
  base_url = 'https://hapi.fhir.org/baseR4',
  resource = "Patient",
  ids      = ids)

#have a look at the resources
fhir_crack(
  bundles,
  fhir_table_description(
    resource = "Patient",
    cols     = list(
      ID      = "id",
      given   = "name/given",
      family  = "name/family")))

}, silent = TRUE)

</code></pre>

<hr>
<h2 id='fhir_load'>Load bundles from xml-files</h2><span id='topic+fhir_load'></span>

<h3>Description</h3>

<p>Reads all bundles stored as xml files from a directory.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_load(directory, indices = NULL, pattern = "^[0-9]+\\.xml$")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_load_+3A_directory">directory</code></td>
<td>
<p>A character vector of length one containing the path to the folder were the files are stored.</p>
</td></tr>
<tr><td><code id="fhir_load_+3A_indices">indices</code></td>
<td>
<p>A numeric vector of integers indicating which bundles from the specified directory should be loaded. Defaults to NULL meaning all bundles from the directory are loaded.</p>
</td></tr>
<tr><td><code id="fhir_load_+3A_pattern">pattern</code></td>
<td>
<p>A character vector of length one with a regex expression defining the naming pattern of the xml files
to be read. Defaults to the regex expression matching file names as produced by <code><a href="#topic+fhir_save">fhir_save()</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <a href="#topic+fhir_bundle_list-class">fhir_bundle_list</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#unserialize example bundle
bundles &lt;- fhir_unserialize(medication_bundles)
length(bundles)

#save to temporary directory
dir &lt;- tempdir()
fhir_save(bundles, directory = dir)

#load from temporary directory
loaded_bundles &lt;- fhir_load(dir)
length(loaded_bundles)

#load only two, the second and the third bundle
loaded_bundles &lt;- fhir_load(dir, indices = c(2,3))
length(loaded_bundles)
</code></pre>

<hr>
<h2 id='fhir_load_design'>Load design from xml</h2><span id='topic+fhir_load_design'></span>

<h3>Description</h3>

<p>Loads a <a href="#topic+fhir_design-class">fhir_design</a> for use with <code><a href="#topic+fhir_crack">fhir_crack()</a></code> from an xml file into R.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_load_design(file)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_load_design_+3A_file">file</code></td>
<td>
<p>A string specifying the file from which to read.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <a href="#topic+fhir_design-class">fhir_design</a> object. See <code>?fhir_design</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fhir_design">fhir_design()</a></code>, <code><a href="#topic+fhir_table_description">fhir_table_description()</a></code>, <code><a href="#topic+fhir_save_design">fhir_save_design()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
table_desc1 &lt;- fhir_table_description(
    resource = 'Patient',
    cols     = c(
        id     = 'id',
        name   = 'name/family',
        gender = 'gender'
    ),
    sep           = ':::',
    brackets      = c('[', ']'),
    rm_empty_cols = FALSE,
    format        = 'compact',
    keep_attr     = FALSE
)

table_desc2 &lt;- fhir_table_description(
    resource = 'Observation',
    cols     = c(
        'code/coding/system',
        'code/coding/code'
    )
)

design &lt;- fhir_design(
    Patients     = table_desc1,
    Observations = table_desc2
)
temp &lt;- tempfile()

fhir_save_design(design = design, file = temp)

design &lt;- fhir_load_design(file = temp)

</code></pre>

<hr>
<h2 id='fhir_melt'>Melt multiple entries</h2><span id='topic+fhir_melt'></span>

<h3>Description</h3>

<p>This function divides multiple entries in an indexed data frame as produced by <code><a href="#topic+fhir_crack">fhir_crack()</a></code>
into separate rows.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_melt(
  indexed_data_frame,
  columns,
  brackets = c("&lt;", "&gt;"),
  sep = " ",
  id_name = "resource_identifier",
  all_columns = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_melt_+3A_indexed_data_frame">indexed_data_frame</code></td>
<td>
<p>A data.frame/data.table with indexed multiple entries.</p>
</td></tr>
<tr><td><code id="fhir_melt_+3A_columns">columns</code></td>
<td>
<p>A character vector specifying the names of all columns that should be molten simultaneously.
It is advisable to only melt columns simultaneously that belong to the same (repeating) attribute!</p>
</td></tr>
<tr><td><code id="fhir_melt_+3A_brackets">brackets</code></td>
<td>
<p>A character vector of length two, defining the brackets used for the indices.</p>
</td></tr>
<tr><td><code id="fhir_melt_+3A_sep">sep</code></td>
<td>
<p>A character vector of length one defining the separator that was used when pasting together multiple entries in <code><a href="#topic+fhir_crack">fhir_crack()</a></code>.</p>
</td></tr>
<tr><td><code id="fhir_melt_+3A_id_name">id_name</code></td>
<td>
<p>A character vector of length one, the name of the column that will hold the identification of the origin of the new rows.</p>
</td></tr>
<tr><td><code id="fhir_melt_+3A_all_columns">all_columns</code></td>
<td>
<p>Return all columns? Defaults to <code>FALSE</code>, meaning only those specified in <code>columns</code> are returned.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Every row containing values that consist of multiple entries on the variables specified by the argument <code>columns</code>
will be turned into multiple rows, one for each entry. Values on other variables will be repeated in all the new rows.
</p>
<p>The new data.frame will contain only the molten variables (if <code>all_cloumns = FALSE</code>) or all variables
(if <code>all_columns = TRUE</code>) as well as an additional variable <code>resource_identifier</code> that maps which rows came
from the same origin. The name of this column can be changed in the argument <code>id_name</code>.
</p>
<p>For a more detailed description on how to use this function please see the corresponding package vignette.
</p>


<h3>Value</h3>

<p>A data.frame/data.table where each entry from the variables in <code>columns</code> appears in a separate row.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fhir_common_columns">fhir_common_columns()</a></code>, <code><a href="#topic+fhir_rm_indices">fhir_rm_indices()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#unserialize example
bundles &lt;- fhir_unserialize(bundles = example_bundles1)

#crack fhir resources
table_desc &lt;- fhir_table_description(
    resource = "Patient",
    brackets = c("[", "]"),
    sep = " "
)

df &lt;- fhir_crack(bundles = bundles, design = table_desc)

#find all column names associated with attribute address
col_names &lt;- fhir_common_columns(df, "address")

#original data frame
df

#only keep address columns
fhir_melt(
     indexed_data_frame = df,
     columns            = col_names,
     brackets           = c("[", "]"),
     sep = " "
 )

#keep all columns
fhir_melt(indexed_data_frame = df, columns = col_names,
          brackets = c("[","]"), sep = " ", all_columns = TRUE)
</code></pre>

<hr>
<h2 id='fhir_next_bundle_url'>Next Bundle's URL</h2><span id='topic+fhir_next_bundle_url'></span>

<h3>Description</h3>

<p>fhir_next_bundle_url() gives the link to the next available bundle, either of the bundle
you provided in the argument <code>bundle</code> or of the last call to <code><a href="#topic+fhir_search">fhir_search()</a></code>, if <code>bundle=NULL</code> (the default).
</p>
<p>This function is useful when you don't have a lot of memory available or when a download of bundles was
interrupted for some reason. In case of small memory, you can use <code>fhir_next_bundle_url</code> together with the
<code>max_bundle</code> argument from <code><a href="#topic+fhir_search">fhir_search()</a></code> to download bundles in smaller batches in a loop.
See details in the example.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_next_bundle_url(bundle = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_next_bundle_url_+3A_bundle">bundle</code></td>
<td>
<p>The bundle from which you wish to extract the next link. If this is <code>NULL</code> (the default), the function will
extract the next link from the last bundle that was downloaded in the most recent call to <code><a href="#topic+fhir_search">fhir_search()</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <a href="#topic+fhir_url-class">fhir_url</a> object referencing next bundle available on the FHIR server.
Empty <a href="#topic+fhir_url-class">fhir_url</a> / character vector, if no further bundle is available.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

#' #the try({}, silent = TRUE) statement is only there to catch errors when the server is down
#you can skip it when the server is reachable

try({


# workflow for small memory environments, downloading small batches of bundles
# for really small memory environments consider also using the `_count` option in
# your FHIR search request.
# You can iteratively download, crack and save the bundles until all bundles are processed or the
# desired number of bundles is reached.
url &lt;- fhir_url("https://server.fire.ly/Patient")
count &lt;- 0
obs &lt;- fhir_table_description(resource = "Patient")
design &lt;- fhir_design(obs)
while(length(url)&gt;0 &amp;&amp; count &lt; 5){
	 bundles &lt;- fhir_search(url, max_bundles = 2)
	 tables &lt;- fhir_crack(bundles, design)
  save(tables, file = paste0(tempdir(),"/table_", count, ".RData"))
  count &lt;- count + 1
  url &lt;- fhir_next_bundle_url()
}
#you can see the saved tables here:
dir(tempdir())


}, silent = TRUE)


</code></pre>

<hr>
<h2 id='fhir_post'>POST to a FHIR server</h2><span id='topic+fhir_post'></span><span id='topic+fhir_post+2CANY+2Cfhir_resource-method'></span><span id='topic+fhir_post+2Cfhir_resource-method'></span><span id='topic+fhir_post+2CANY+2Cfhir_bundle_xml-method'></span><span id='topic+fhir_post+2Cfhir_bundle_xml-method'></span><span id='topic+fhir_post+2CANY+2Cfhir_body-method'></span><span id='topic+fhir_post+2Cfhir_body-method'></span>

<h3>Description</h3>

<p>This function is a convenience wrapper around <code><a href="httr.html#topic+POST">httr::POST()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_post(
  url,
  body,
  username = NULL,
  password = NULL,
  token = NULL,
  add_headers = NULL,
  verbose = 1,
  log_errors = NULL
)

## S4 method for signature 'ANY,fhir_resource'
fhir_post(
  url,
  body,
  username = NULL,
  password = NULL,
  token = NULL,
  add_headers = NULL,
  verbose = 1,
  log_errors = NULL
)

## S4 method for signature 'ANY,fhir_bundle_xml'
fhir_post(
  url,
  body,
  username = NULL,
  password = NULL,
  token = NULL,
  add_headers = NULL,
  verbose = 1,
  log_errors = NULL
)

## S4 method for signature 'ANY,fhir_body'
fhir_post(
  url,
  body,
  username = NULL,
  password = NULL,
  token = NULL,
  add_headers = NULL,
  verbose = 1,
  log_errors = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_post_+3A_url">url</code></td>
<td>
<p>An object of class <a href="#topic+fhir_url-class">fhir_url</a> or a character vector of length one containing the url to POST to.</p>
</td></tr>
<tr><td><code id="fhir_post_+3A_body">body</code></td>
<td>
<p>An object of class  <a href="#topic+fhir_resource-class">fhir_resource</a>, <a href="#topic+fhir_bundle_xml-class">fhir_bundle_xml</a> or <a href="#topic+fhir_body-class">fhir_body</a>.
See details for how to generate them.</p>
</td></tr>
<tr><td><code id="fhir_post_+3A_username">username</code></td>
<td>
<p>A character vector of length one containing the username for basic authentication.</p>
</td></tr>
<tr><td><code id="fhir_post_+3A_password">password</code></td>
<td>
<p>A character vector of length one containing the password for basic authentication.</p>
</td></tr>
<tr><td><code id="fhir_post_+3A_token">token</code></td>
<td>
<p>A character vector of length one or object of class <a href="httr.html#topic+Token-class">httr::Token</a>, for bearer token authentication (e.g. OAuth2). See <code><a href="#topic+fhir_authenticate">fhir_authenticate()</a></code>
for how to create this.</p>
</td></tr>
<tr><td><code id="fhir_post_+3A_add_headers">add_headers</code></td>
<td>
<p>A named character vector of custom headers to add to the HTTP request, e.g. <code>c(myHeader = "somevalue")</code> or
<code>c(firstHeader = "value1", secondHeader = "value2")</code>.</p>
</td></tr>
<tr><td><code id="fhir_post_+3A_verbose">verbose</code></td>
<td>
<p>An integer vector of length one. If 0, nothing is printed, if &gt; 0 success message is printed. Defaults to 1.</p>
</td></tr>
<tr><td><code id="fhir_post_+3A_log_errors">log_errors</code></td>
<td>
<p>Either <code>NULL</code> or a character vector of length one indicating the name of a file in which to save http errors.
<code>NULL</code> means no error logging. When a file name is provided, the errors are saved in the specified file. Defaults to <code>NULL</code>.
Regardless of the value of <code>log_errors</code> the most recent http error message within the current R session is saved internally and can
be accessed with <code><a href="#topic+fhir_recent_http_error">fhir_recent_http_error()</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code><a href="#topic+fhir_post">fhir_post()</a></code> accepts four classes for the body:
</p>

<ol>
<li><p> A <a href="#topic+fhir_resource-class">fhir_resource</a> as created by <code><a href="#topic+fhir_build_resource">fhir_build_resource()</a></code>. This is used when just a single resource should be POSTed to the server.
In this case <code>url</code> must contain the base url plus the resource type, e.g. http://hapi.fhir.org/baseR4/Patient.
</p>
</li>
<li><p> A <a href="#topic+fhir_bundle_xml-class">fhir_bundle_xml</a> representing a transaction or batch bundle as created by <code><a href="#topic+fhir_build_bundle">fhir_build_bundle()</a></code>.
</p>
</li>
<li><p> A <a href="#topic+fhir_body-class">fhir_body</a> as created by <code><a href="#topic+fhir_body">fhir_body()</a></code>. This is the most flexible approach, because within the <a href="#topic+fhir_body-class">fhir_body</a> object you can represent
any kind of <code>content</code> as a string and set the <code>type</code> accordingly. See examples.
</p>
</li></ol>

<p>For examples of how to create the different body types see the respective help pages. For an example of the entire workflow around creating
and POSTing resources, see the package vignette on recreating resources.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
### 1. POST transaction bundle
#unserialize example bundles
bundle &lt;- fhir_unserialize(transaction_bundle_example)

#have a look at the bundle
cat(toString(bundle))

#post
fhir_post(url = "http://hapi.fhir.org/baseR4", body = bundle)


### 2. POST single resouce
#unserialize example resource
resource &lt;- fhir_unserialize(example_resource1)

#have a look at the resource
resource

#post
url &lt;- fhir_url(url = "http://hapi.fhir.org/baseR4", resource = "Patient")
fhir_post(url = url, body = resource)


### 3. POST arbitrary body
#define body
body &lt;- fhir_body(content = "&lt;Patient&gt; &lt;gender value='female'/&gt; &lt;/Patient&gt;", type = "xml")

#post
url &lt;- fhir_url(url = "http://hapi.fhir.org/baseR4", resource = "Patient")
fhir_post(url = url, body = body)

## End(Not run)
</code></pre>

<hr>
<h2 id='fhir_put'>PUT to a FHIR server</h2><span id='topic+fhir_put'></span>

<h3>Description</h3>

<p>This function is a convenience wrapper around <code><a href="httr.html#topic+PUT">httr::PUT()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_put(
  url,
  body,
  username = NULL,
  password = NULL,
  token = NULL,
  add_headers = NULL,
  verbose = 1,
  log_errors = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_put_+3A_url">url</code></td>
<td>
<p>An object of class <a href="#topic+fhir_url-class">fhir_url</a> or a character vector of length one containing the url to PUT to.</p>
</td></tr>
<tr><td><code id="fhir_put_+3A_body">body</code></td>
<td>
<p>An object of class <a href="#topic+fhir_resource-class">fhir_resource</a> or <a href="#topic+fhir_body-class">fhir_body</a>. See details for how to generate them.</p>
</td></tr>
<tr><td><code id="fhir_put_+3A_username">username</code></td>
<td>
<p>A character vector of length one containing the username for basic authentication.</p>
</td></tr>
<tr><td><code id="fhir_put_+3A_password">password</code></td>
<td>
<p>A character vector of length one containing the password for basic authentication.</p>
</td></tr>
<tr><td><code id="fhir_put_+3A_token">token</code></td>
<td>
<p>A character vector of length one or object of class <a href="httr.html#topic+Token-class">httr::Token</a>, for bearer token authentication (e.g. OAuth2). See <code><a href="#topic+fhir_authenticate">fhir_authenticate()</a></code>
for how to create this.</p>
</td></tr>
<tr><td><code id="fhir_put_+3A_add_headers">add_headers</code></td>
<td>
<p>A named character vector of custom headers to add to the HTTP request, e.g. <code>c(myHeader = "somevalue")</code> or
<code>c(firstHeader = "value1", secondHeader = "value2")</code>.</p>
</td></tr>
<tr><td><code id="fhir_put_+3A_verbose">verbose</code></td>
<td>
<p>An integer vector of length one. If 0, nothing is printed, if &gt; 0 success message is printed. Defaults to 1.</p>
</td></tr>
<tr><td><code id="fhir_put_+3A_log_errors">log_errors</code></td>
<td>
<p>Either <code>NULL</code> or a character vector of length one indicating the name of a file in which to save http errors.
<code>NULL</code> means no error logging. When a file name is provided, the errors are saved in the specified file. Defaults to <code>NULL</code>.
Regardless of the value of <code>log_errors</code> the most recent http error message within the current R session is saved internally and can
be accessed with <code><a href="#topic+fhir_recent_http_error">fhir_recent_http_error()</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code><a href="#topic+fhir_put">fhir_put()</a></code> accepts two classes for the body:
</p>

<ol>
<li><p> A <a href="#topic+fhir_resource-class">fhir_resource</a> as created by <code><a href="#topic+fhir_build_resource">fhir_build_resource()</a></code>. This is used when just a single resource should be PUT to the server.
In this case <code>url</code> must contain the base url plus the resource type and the resource id,
e.g. http://hapi.fhir.org/baseR4/Patient/1a2b3c.
</p>
</li>
<li><p> A <a href="#topic+fhir_body-class">fhir_body</a> as created by <code><a href="#topic+fhir_body">fhir_body()</a></code>. This is the most flexible approach, because within the <a href="#topic+fhir_body-class">fhir_body</a> object you can represent
any kind of <code>content</code> as a string and set the <code>type</code> accordingly. See examples.
</p>
</li></ol>

<p>For examples of how to create the different body types see the respective help pages. For an example of the entire workflow around creating
and PUTing resources, see the package vignette on recreating resources.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
### 1. PUT fhir__resource object
#unserialize example resource
resource &lt;- fhir_unserialize(example_resource2)

#have a look at the resource
resource

#put
fhir_put(url = "http://hapi.fhir.org/baseR4/Patient/1a2b3c", body = resource)

### 2. PUT fhir_body object
#define body
body &lt;- fhir_body(content = "&lt;Patient&gt; &lt;id value='x1y2'/&gt; &lt;gender value='female'/&gt; &lt;/Patient&gt;",
                  type = "xml")

#put
fhir_put(url = "http://hapi.fhir.org/baseR4/Patient/x1y2", body = body)

## End(Not run)
</code></pre>

<hr>
<h2 id='fhir_recent_http_error'>Return most recent http error from <code><a href="#topic+fhir_search">fhir_search()</a></code></h2><span id='topic+fhir_recent_http_error'></span>

<h3>Description</h3>

<p>Whenever a call to <code><a href="#topic+fhir_search">fhir_search()</a></code> produces any http error, the error information is saved internally
until the next http error occurs (or the R session ends). The error information can be accessed with <code>fhir_recent_http_error</code>.
If you want to log that information outside of your R session, set the argument <code>log_errors</code> of <code><a href="#topic+fhir_search">fhir_search()</a></code> .
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_recent_http_error()
</code></pre>


<h3>Value</h3>

<p>A string containing the error message
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fhir_search">fhir_search()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
fhir_search("https://server.fire.ly/Medicatio", max_bundles = 1)
cat(fhir_recent_http_error())

## End(Not run)

</code></pre>

<hr>
<h2 id='fhir_request'>fhir_request</h2><span id='topic+fhir_request'></span>

<h3>Description</h3>

<p>A Wrapper for fhir_url
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_request(url, resource = NULL, parameters = NULL, url_enc = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_request_+3A_url">url</code></td>
<td>
<p>The same as for <code>fhir_url()</code>.</p>
</td></tr>
<tr><td><code id="fhir_request_+3A_resource">resource</code></td>
<td>
<p>The same as for <code>fhir_url()</code>. Defaults to NULL.</p>
</td></tr>
<tr><td><code id="fhir_request_+3A_parameters">parameters</code></td>
<td>
<p>The same as for <code>fhir_url()</code>. Defaults to NULL.</p>
</td></tr>
<tr><td><code id="fhir_request_+3A_url_enc">url_enc</code></td>
<td>
<p>The same as for <code>fhir_url()</code>. Defaults to TRUE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The same as for <code>fhir_url()</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#provide full FHIR search request
fhir_request(url = "http://hapi.fhir.org/baseR4/Patient?gender=male&amp;_summary=count")

#provide base url and resource type
fhir_request(
   url      = "http://hapi.fhir.org/baseR4",
   resource = "Patient"
 )

#parameters in one string
fhir_request(
   url        = "http://hapi.fhir.org/baseR4",
   resource   = "Patient",
   parameters = "gender=male&amp;_summary=count"
 )

#parameters as a named character
fhir_request(
   url        = "http://hapi.fhir.org/baseR4",
   resource   = "Patient",
   parameters = c("gender" = "male", "_summary" = "count")
 )

#parameters as a named list
fhir_request(
   url        = "http://hapi.fhir.org/baseR4",
   resource   = "Patient",
   parameters = list("gender" = "male", "_summary" = "count")
 )
</code></pre>

<hr>
<h2 id='fhir_resource_serialized-class'>An S4 class to represent a FHIR resource in serialized form</h2><span id='topic+fhir_resource_serialized-class'></span>

<h3>Description</h3>

<p>A <code>fhir_resource_serialized</code> is a <code>fhir_resource_xml</code> that has been serialized using <code><a href="#topic+fhir_serialize">fhir_serialize()</a></code>. In this form, the
resource cannot be used in any meaningful way, but it can be saved and loaded as an <code>.RData</code> or <code>.rds</code> object without breaking the
external pointers in the xml. See <code>?fhir_serialize</code> and <code>?fhir_unserialize</code>.
</p>

<hr>
<h2 id='fhir_resource_type'>Create <a href="#topic+fhir_resource_type-class">fhir_resource_type</a> object</h2><span id='topic+fhir_resource_type'></span>

<h3>Description</h3>

<p>This function creates an object of class <a href="#topic+fhir_resource_type-class">fhir_resource_type</a>. It checks the resource type against the list
of resource types provided at https://hl7.org/FHIR/resourcelist.html, corrects wrong cases (which can be disabled with <code>fix_capitalization = FALSE</code>)
and throws a warning if the resource cannot be found at hl7.org.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_resource_type(string, fix_capitalization = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_resource_type_+3A_string">string</code></td>
<td>
<p>A length one character vector containing the resource type. Will usually be one of the official FHIR resource
types listed at https://hl7.org/FHIR/resourcelist.html</p>
</td></tr>
<tr><td><code id="fhir_resource_type_+3A_fix_capitalization">fix_capitalization</code></td>
<td>
<p>Correct wrong capitalization for known resource types? E.g. <code>patients -&gt; Patients</code> or
<code>medicationstatement -&gt; MedicationStatement</code>. Defaults to TRUE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An <a href="#topic+fhir_resource_type-class">fhir_resource_type</a> object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>fhir_resource_type(string = "Patient")
fhir_resource_type(string = "medicationadministration")
</code></pre>

<hr>
<h2 id='fhir_resource_type-class'>A representation of a FHIR resource type</h2><span id='topic+fhir_resource_type-class'></span>

<h3>Description</h3>

<p>An object of class <code>fhir_resource_type</code> is a string containing a FHIR resource type.
It is part of a <code>fhir_table_description</code> which in turn is part of a <code>fhir_design</code> and used in
<code><a href="#topic+fhir_crack">fhir_crack()</a></code>.
</p>

<hr>
<h2 id='fhir_resource_xml'>Create <a href="#topic+fhir_resource_xml-class">fhir_resource_xml</a> object</h2><span id='topic+fhir_resource_xml'></span><span id='topic+fhir_resource_xml+2Cxml_document-method'></span><span id='topic+fhir_resource_xml+2Cxml_node-method'></span><span id='topic+fhir_resource_xml+2Ccharacter-method'></span>

<h3>Description</h3>

<p>Create <a href="#topic+fhir_resource_xml-class">fhir_resource_xml</a> object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_resource_xml(resource)

## S4 method for signature 'xml_document'
fhir_resource_xml(resource)

## S4 method for signature 'xml_node'
fhir_resource_xml(resource)

## S4 method for signature 'character'
fhir_resource_xml(resource)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_resource_xml_+3A_resource">resource</code></td>
<td>
<p>A xml-object representing a FHIR resource</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>fhir_resource_xml(resource = xml2::read_xml("&lt;Patient&gt;&lt;id value = '1'/&gt;&lt;/Patient&gt;"))

</code></pre>

<hr>
<h2 id='fhir_resource_xml-class'>An S4 class to represent a FHIR resource in xml form</h2><span id='topic+fhir_resource_xml-class'></span>

<h3>Description</h3>

<p>A <code>fhir_resource_xml</code> is an xml representation of a FHIR resource (https://www.hl7.org/fhir/resourcelist.html).
</p>

<hr>
<h2 id='fhir_resource-class'>An S4 class to represent FHIR resources</h2><span id='topic+fhir_resource-class'></span>

<h3>Description</h3>

<p>An S4 class to represent FHIR resources
</p>

<hr>
<h2 id='fhir_rm_div'>Remove html elements</h2><span id='topic+fhir_rm_div'></span>

<h3>Description</h3>

<p>This function is a convenience wrapper for <code><a href="#topic+fhir_rm_tag">fhir_rm_tag()</a></code> that removes all <code style="white-space: pre;">&#8288;&lt;div&gt; &lt;/div&gt;&#8288;</code> elements from an xml.
<code>div</code> tags in FHIR resources contain html code, which is often server generated and in most cases neither relevant nor
usable for data analysis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_rm_div(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_rm_div_+3A_x">x</code></td>
<td>
<p>A <a href="#topic+fhir_bundle_xml-class">fhir_bundle_xml</a> or <a href="#topic+fhir_bundle_list-class">fhir_bundle_list</a> object or a character vector
containing xml objects.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of the same class as <code>x</code> where all tags matching the <code>tag</code> argument are removed.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fhir_rm_tag">fhir_rm_tag()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#Example 1: Remove div tags from xmls in a character vector
string &lt;- c("Hallo&lt;div&gt;Please&lt;p&gt;Remove Me&lt;/p&gt;&lt;/div&gt; World!",
            "A&lt;div&gt;&lt;div&gt;&lt;p&gt;B&lt;/p&gt;&lt;/div&gt;C&lt;/div&gt;D")

fhir_rm_div(x = string)




#Example 2: Remove div tags in a single fhir bundle
bundle &lt;- fhir_unserialize(patient_bundles)[[1]]

#example bundle contains html parts in div tags:
cat(toString(bundle))

#remove html parts
bundle_cleaned &lt;- fhir_rm_div(x = bundle)

#have a look at the result
cat(toString(bundle_cleaned))





#Example 3: Remove div tags in a list of fhir bundles
bundle_list &lt;- fhir_unserialize(patient_bundles)


#remove html parts
bundle_list_cleaned &lt;- fhir_rm_div(x = bundle_list)

#check out how much the size of the bundle list is reduced by removing html
size_with_html &lt;- sum(sapply(bundle_list, function(x)object.size(toString(x))))
size_without_html &lt;- sum(sapply(bundle_list_cleaned, function(x)object.size(toString(x))))

size_without_html/size_with_html

</code></pre>

<hr>
<h2 id='fhir_rm_indices'>Remove indices from data.frame/data.table</h2><span id='topic+fhir_rm_indices'></span>

<h3>Description</h3>

<p>Removes the indices in front of multiple entries as produced by <code><a href="#topic+fhir_crack">fhir_crack()</a></code> when brackets are provided in
the design.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_rm_indices(
  indexed_data_frame,
  brackets = c("&lt;", "&gt;"),
  columns = names(indexed_data_frame)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_rm_indices_+3A_indexed_data_frame">indexed_data_frame</code></td>
<td>
<p>A data frame with indices for multiple entries as produced by <code><a href="#topic+fhir_crack">fhir_crack()</a></code></p>
</td></tr>
<tr><td><code id="fhir_rm_indices_+3A_brackets">brackets</code></td>
<td>
<p>A character vector of length two defining the brackets that were used in <code><a href="#topic+fhir_crack">fhir_crack()</a></code></p>
</td></tr>
<tr><td><code id="fhir_rm_indices_+3A_columns">columns</code></td>
<td>
<p>A character vector of column names, indicating from which columns indices should be removed.
Defaults to all columns.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame without indices.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fhir_melt">fhir_melt()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#unserialize example
bundles &lt;- fhir_unserialize(bundles = example_bundles1)

patients &lt;- fhir_table_description(resource = "Patient")

df &lt;- fhir_crack(bundles = bundles,
                  design = patients,
                  brackets = c("[", "]"))

df_indices_removed &lt;- fhir_rm_indices(indexed_data_frame = df, brackets=c("[", "]"))

</code></pre>

<hr>
<h2 id='fhir_rm_tag'>Remove a certain xml tag</h2><span id='topic+fhir_rm_tag'></span><span id='topic+fhir_rm_tag+2Ccharacter-method'></span><span id='topic+fhir_rm_tag+2Cfhir_bundle_xml-method'></span><span id='topic+fhir_rm_tag+2Cfhir_bundle_list-method'></span>

<h3>Description</h3>

<p>Removes a given xml tag from xml objects represented in a <a href="#topic+fhir_bundle_xml-class">fhir_bundle_xml</a>, <a href="#topic+fhir_bundle_list-class">fhir_bundle_list</a>
or character vector.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_rm_tag(x, tag)

## S4 method for signature 'character'
fhir_rm_tag(x, tag)

## S4 method for signature 'fhir_bundle_xml'
fhir_rm_tag(x, tag)

## S4 method for signature 'fhir_bundle_list'
fhir_rm_tag(x, tag)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_rm_tag_+3A_x">x</code></td>
<td>
<p>A <a href="#topic+fhir_bundle_xml-class">fhir_bundle_xml</a> or <a href="#topic+fhir_bundle_list-class">fhir_bundle_list</a> object or a character vector
containing xml objects.</p>
</td></tr>
<tr><td><code id="fhir_rm_tag_+3A_tag">tag</code></td>
<td>
<p>A character vector of length 1 containing the tag that should be removed, e.g. <code>"div"</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In the example <code style="white-space: pre;">&#8288;Hello&lt;div&gt;Please&lt;p&gt;Remove Me&lt;/p&gt;&lt;/div&gt;World!&#8288;</code> one could for example remove the
tag <code>p</code>, resulting in <code style="white-space: pre;">&#8288;Hello&lt;div&gt;Please&lt;/div&gt;World!&#8288;</code>or remove the <code>div</code> tag resulting in
<code style="white-space: pre;">&#8288;Hello World!&#8288;</code>.
</p>


<h3>Value</h3>

<p>An object of the same class as <code>x</code> where all tags matching the <code>tag</code> argument are removed.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fhir_rm_div">fhir_rm_div()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#Example 1: Remove tag from xmls in a character vector
string &lt;- c("Hello&lt;div&gt;Please&lt;p&gt;Remove Me&lt;/p&gt;&lt;/div&gt; World!",
            "A&lt;div&gt;&lt;div&gt;&lt;p&gt;B&lt;/p&gt;&lt;/div&gt;C&lt;/div&gt;D")

fhir_rm_tag(x = string, tag = "p")




#Example 2: Remove div tags in a single fhir bundle
bundle &lt;- fhir_unserialize(patient_bundles)[[1]]

#example bundle contains html parts in div tags:
cat(toString(bundle))

#remove html parts
bundle_cleaned &lt;- fhir_rm_tag(x = bundle, tag = "div")

#have a look at the result
cat(toString(bundle_cleaned))





#Example 3: Remove div tags in a list of fhir bundles
bundle_list &lt;- fhir_unserialize(patient_bundles)


#remove html parts
bundle_list_cleaned &lt;- fhir_rm_tag(x = bundle_list, tag = "div")

#check out how much the size of the bundle list is reduced by removing html
size_with_html &lt;- sum(sapply(bundle_list, function(x)object.size(toString(x))))
size_without_html &lt;- sum(sapply(bundle_list_cleaned, function(x)object.size(toString(x))))

size_without_html/size_with_html

</code></pre>

<hr>
<h2 id='fhir_sample_resources'>Randomly sample resources from a FHIR server</h2><span id='topic+fhir_sample_resources'></span>

<h3>Description</h3>

<p>Downloads a random sample of resources of a given resource type from a FHIR server. The resources can be further constrained
using FHIR search parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_sample_resources(
  base_url,
  resource,
  parameters = NULL,
  username = NULL,
  password = NULL,
  token = NULL,
  add_headers = NULL,
  sample_size = 20,
  seed = 1,
  verbose = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_sample_resources_+3A_base_url">base_url</code></td>
<td>
<p>A character vector of length one specifying the base URL of the FHIR server, e.g. <code>"http://hapi.fhir.org/baseR4"</code>.</p>
</td></tr>
<tr><td><code id="fhir_sample_resources_+3A_resource">resource</code></td>
<td>
<p>A character vector of length one or <a href="#topic+fhir_resource_type-class">fhir_resource_type</a> object with the resource type to be downloaded, e.g. <code>"Patient"</code>.</p>
</td></tr>
<tr><td><code id="fhir_sample_resources_+3A_parameters">parameters</code></td>
<td>
<p>Optional. Either a length 1 character vector containing properly formatted FHIR search parameters, e.g.
<code>"gender=male&amp;_summary=count"</code> or a named list or named character vector e.g. <code>list(gender="male", "_summary"="count")</code>
or <code>c(gender="male", "_summary"="count")</code>. Note that parameter names beginning with <code style="white-space: pre;">&#8288;_&#8288;</code> have to be put in quotation marks!</p>
</td></tr>
<tr><td><code id="fhir_sample_resources_+3A_username">username</code></td>
<td>
<p>A character vector of length one containing the username for basic authentication.</p>
</td></tr>
<tr><td><code id="fhir_sample_resources_+3A_password">password</code></td>
<td>
<p>A character vector of length one containing the password for basic authentication.</p>
</td></tr>
<tr><td><code id="fhir_sample_resources_+3A_token">token</code></td>
<td>
<p>A character vector of length one or object of class <a href="httr.html#topic+Token-class">httr::Token</a>, for bearer token authentication (e.g. OAuth2). See <code><a href="#topic+fhir_authenticate">fhir_authenticate()</a></code>
for how to create this.</p>
</td></tr>
<tr><td><code id="fhir_sample_resources_+3A_add_headers">add_headers</code></td>
<td>
<p>A named character vector of custom headers to add to the HTTP request, e.g. <code>c(myHeader = "somevalue")</code> or
<code>c(firstHeader = "value1", secondHeader = "value2")</code>.</p>
</td></tr>
<tr><td><code id="fhir_sample_resources_+3A_sample_size">sample_size</code></td>
<td>
<p>A integer of length 1 containing the number of resources to sample.</p>
</td></tr>
<tr><td><code id="fhir_sample_resources_+3A_seed">seed</code></td>
<td>
<p>A integer of length 1 containing the seed for the random generator.</p>
</td></tr>
<tr><td><code id="fhir_sample_resources_+3A_verbose">verbose</code></td>
<td>
<p>An integer of length 1 containing the level of verbosity. Defaults to 1.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function performs three steps to draw a random sample of resources from a FHIR server:
</p>

<ol>
<li><p> Count how many resources matching the type <code>resource</code> and the search parameters in <code>parameters</code> are found on the server. This is done to assert that the desired <code>sample_size</code>
is bigger than the number of resources it is drawn from. This step can also be performed individually using <code><a href="#topic+fhir_count_resource">fhir_count_resource()</a></code>.
</p>
</li>
<li><p> Extract the resource (aka logical) IDs of all requested resources (without downloading the resources completely).
This step can be also be performed individually using <code><a href="#topic+fhir_get_resource_ids">fhir_get_resource_ids()</a></code>
</p>
</li>
<li><p> Draw a random sample of size <code>sample_size</code> from the vector of resource IDs and download the corresponding set of resources from the server.
This can also be done individually using <code><a href="#topic+fhir_sample_resources_by_ids">fhir_sample_resources_by_ids()</a></code>
</p>
</li></ol>

<p>The actual download of the resources is done by <code><a href="#topic+fhir_get_resources_by_ids">fhir_get_resources_by_ids()</a></code>. This function will attempt to download the resources using a
FHIR search request via POST where the IDs are part of the body. See <code><a href="#topic+fhir_search">fhir_search()</a></code> for details. If this fails
(e.g. because the server doesn't allow POST operations), the function falls back on a GET request. If the set of IDs is too long to fit
into one GET request (i.e. if the request gets longer than 2083 characters), it will be spread across several requests.
</p>
<p>For more information on authentication options, please see the help page of <code><a href="#topic+fhir_search">fhir_search()</a></code>
</p>


<h3>Value</h3>

<p>A <a href="#topic+fhir_bundle_list-class">fhir_bundle_list</a> containing randomly sampled resources.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fhir_search">fhir_search()</a></code>, <code><a href="#topic+fhir_sample_resources_by_ids">fhir_sample_resources_by_ids()</a></code>, <code><a href="#topic+fhir_get_resources_by_ids">fhir_get_resources_by_ids()</a></code>, <code><a href="#topic+fhir_count_resource">fhir_count_resource()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

#the try({}, silent = TRUE) statement is only there to catch errors when the server is down
#you can skip it when the server is reachable

try({

#how many resources are on the server?
count &lt;- fhir_count_resource(
  base_url    = 'https://hapi.fhir.org/baseR4',
  resource    = "Patient",
  parameters  = "gender=female")

#randomly sample 30 of them
bundles &lt;- fhir_sample_resources(
  base_url    = 'https://hapi.fhir.org/baseR4',
  resource    = "Patient",
  parameters  = "gender=female",
  sample_size = 30,
  seed        = 1)

bundles

}, silent = TRUE)

</code></pre>

<hr>
<h2 id='fhir_sample_resources_by_ids'>Download a random sample of resources from a vector of resource IDs.</h2><span id='topic+fhir_sample_resources_by_ids'></span>

<h3>Description</h3>

<p>Download a random sample of resources from a vector of resource IDs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_sample_resources_by_ids(
  base_url,
  resource,
  ids,
  id_param = "_id",
  username = NULL,
  password = NULL,
  token = NULL,
  add_headers = NULL,
  sample_size = 20,
  seed = 1,
  verbose = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_sample_resources_by_ids_+3A_base_url">base_url</code></td>
<td>
<p>A character vector of length one specifying the base URL of the FHIR server, e.g. <code>"http://hapi.fhir.org/baseR4"</code>.</p>
</td></tr>
<tr><td><code id="fhir_sample_resources_by_ids_+3A_resource">resource</code></td>
<td>
<p>A character vector of length one or <a href="#topic+fhir_resource_type-class">fhir_resource_type</a> object with the resource type to be downloaded e.g. <code>"Patient"</code>.</p>
</td></tr>
<tr><td><code id="fhir_sample_resources_by_ids_+3A_ids">ids</code></td>
<td>
<p>A character vector containing the IDs from which to sample.</p>
</td></tr>
<tr><td><code id="fhir_sample_resources_by_ids_+3A_id_param">id_param</code></td>
<td>
<p>A character vector of length one containing the FHIR Search parameter belonging to the ids in <code>ids</code>. Defaults to <code>"_id"</code> meaning <code>ids</code> is interpreted as
containing resource (aka logical) ids. Could be changed to <code>"identifier"</code> if <code>ids</code> contains a vector of identifier values instead.</p>
</td></tr>
<tr><td><code id="fhir_sample_resources_by_ids_+3A_username">username</code></td>
<td>
<p>A character vector of length one containing the username for basic authentication.</p>
</td></tr>
<tr><td><code id="fhir_sample_resources_by_ids_+3A_password">password</code></td>
<td>
<p>A character vector of length one containing the password for basic authentication.</p>
</td></tr>
<tr><td><code id="fhir_sample_resources_by_ids_+3A_token">token</code></td>
<td>
<p>A character vector of length one or object of class <a href="httr.html#topic+Token-class">httr::Token</a>, for bearer token authentication (e.g. OAuth2). See <code><a href="#topic+fhir_authenticate">fhir_authenticate()</a></code>
for how to create this.</p>
</td></tr>
<tr><td><code id="fhir_sample_resources_by_ids_+3A_add_headers">add_headers</code></td>
<td>
<p>A named character vector of custom headers to add to the HTTP request, e.g. <code>c(myHeader = "somevalue")</code> or
<code>c(firstHeader = "value1", secondHeader = "value2")</code>.</p>
</td></tr>
<tr><td><code id="fhir_sample_resources_by_ids_+3A_sample_size">sample_size</code></td>
<td>
<p>A integer of length 1 containing the number of resources to sample.</p>
</td></tr>
<tr><td><code id="fhir_sample_resources_by_ids_+3A_seed">seed</code></td>
<td>
<p>A integer of length 1 containing the seed for the random generator.</p>
</td></tr>
<tr><td><code id="fhir_sample_resources_by_ids_+3A_verbose">verbose</code></td>
<td>
<p>An integer of length 1 containing the level of verbosity. Defaults to 1.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function takes a character vector <code>ids</code> containing logical Ids of resources of a given type (specified in <code>resource</code>) on a
FHIR server (specified in <code>base_url</code>) and downloads a random sample of size <code>sample_size</code> of the corresponding resources from the server.
</p>
<p>Internally, the download of the resources is done by <code><a href="#topic+fhir_get_resources_by_ids">fhir_get_resources_by_ids()</a></code>. This function will attempt to download the resources using a
FHIR search request via POST where the IDs are part of the body. See <code><a href="#topic+fhir_search">fhir_search()</a></code> for details. If this fails
(e.g. because the server doesn't allow POST operations), the function falls back on a GET request. If the set of IDs is too long to fit
into one GET request (i.e. if the request gets longer than 2083 characters), it will be spread across several requests.
</p>
<p>For more information on authentication options, please see the help page of '<code><a href="#topic+fhir_search">fhir_search()</a></code>
</p>


<h3>Value</h3>

<p>A list of bundles containing sampled resources.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fhir_search">fhir_search()</a></code>, <code><a href="#topic+fhir_sample_resources">fhir_sample_resources()</a></code>, <code><a href="#topic+fhir_get_resources_by_ids">fhir_get_resources_by_ids()</a></code>, <code><a href="#topic+fhir_count_resource">fhir_count_resource()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

#the try({}, silent = TRUE) statement is only there to catch errors when the server is down
#you can skip it when the server is reachable

try({

#find IDs of all resources representing Homer Simpson
ids &lt;- fhir_get_resource_ids(
  base_url   = 'https://hapi.fhir.org/baseR4',
  resource   = "Patient",
  parameters = "name=Homer&amp;name=Simpson")

#Sample 10 of them
bundles &lt;- fhir_sample_resources_by_ids(
  base_url    = 'https://hapi.fhir.org/baseR4',
  resource    = "Patient",
  ids         = ids,
  sample_size = 10,
  seed        = 1)

#Have a look at the samples
fhir_crack(
  bundles,
  fhir_table_description(
    resource = "Patient",
    cols     = list(
      ID     = "id",
      given  = "name/given",
      family = "name/family")))

}, silent = TRUE)

</code></pre>

<hr>
<h2 id='fhir_save'>Save FHIR bundles as xml-files</h2><span id='topic+fhir_save'></span>

<h3>Description</h3>

<p>Writes a list of FHIR bundles as numbered xml files into a directory.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_save(bundles, directory)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_save_+3A_bundles">bundles</code></td>
<td>
<p>A list of xml objects representing the FHIR bundles.</p>
</td></tr>
<tr><td><code id="fhir_save_+3A_directory">directory</code></td>
<td>
<p>A character vector of length one containing the path to the folder to store the data in.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>#unserialize example bundle
bundles &lt;- fhir_unserialize(medication_bundles)

#save all bundles to temporary directory
fhir_save(bundles, directory = tempdir())

#save only two bundles (the second and the third) to temporary directory
fhir_save(bundles[c(2,3)], directory = tempdir())
</code></pre>

<hr>
<h2 id='fhir_save_design'>Write design to xml</h2><span id='topic+fhir_save_design'></span>

<h3>Description</h3>

<p>Writes a <a href="#topic+fhir_design-class">fhir_design</a> for use with <code><a href="#topic+fhir_crack">fhir_crack()</a></code> to an xml file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_save_design(design, file = "design.xml")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_save_design_+3A_design">design</code></td>
<td>
<p>A <a href="#topic+fhir_design-class">fhir_design</a> object. See <code><a href="#topic+fhir_design">fhir_design()</a></code>.</p>
</td></tr>
<tr><td><code id="fhir_save_design_+3A_file">file</code></td>
<td>
<p>A string specifying the file to write to, defaults to writing 'design.xml'
into the current working directory.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+fhir_design">fhir_design()</a></code>, <code><a href="#topic+fhir_table_description">fhir_table_description()</a></code>, <code><a href="#topic+fhir_load_design">fhir_load_design()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#create and save design
table_desc1 &lt;- fhir_table_description(
    resource = 'Patient',
    cols     = c(
        id     = 'id',           # column names with xpaths
        name   = 'name/family',
        gender = 'gender'
    ),
    sep           = ':::',
    brackets      = c('[', ']'),
    rm_empty_cols = FALSE,
    format        = 'compact',
    keep_attr     = FALSE
)

table_desc2 &lt;- fhir_table_description(
    resource = 'Observation',
    cols     = c(
        'code/coding/system', # only xpaths
        'code/coding/code'
    )
)

design &lt;- fhir_design(
    Patients     = table_desc1,
    Observations = table_desc2
)

fhir_save_design(design = design, file = tempfile())
</code></pre>

<hr>
<h2 id='fhir_search'>Download FHIR search result</h2><span id='topic+fhir_search'></span>

<h3>Description</h3>

<p>Downloads all FHIR bundles of a FHIR search request from a FHIR server by iterating through the bundles. Search via GET
and POST is possible, see Details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_search(
  request = fhir_current_request(),
  body = NULL,
  username = NULL,
  password = NULL,
  token = NULL,
  add_headers = NULL,
  max_bundles = Inf,
  verbose = 1,
  delay_between_attempts = c(1, 3, 9, 27, 81),
  log_errors = NULL,
  save_to_disc = NULL,
  delay_between_bundles = 0,
  rm_tag = "div",
  max_attempts = deprecated()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_search_+3A_request">request</code></td>
<td>
<p>An object of class <a href="#topic+fhir_url-class">fhir_url</a> or a character vector of length one containing the full FHIR search request. It is
recommended to explicitly create the request via <code><a href="#topic+fhir_url">fhir_url()</a></code> as this will do some validity checks and format the url properly.
Defaults to <code><a href="#topic+fhir_current_request">fhir_current_request()</a></code></p>
</td></tr>
<tr><td><code id="fhir_search_+3A_body">body</code></td>
<td>
<p>A character vector of length one or object of class <code>fhir_body</code> with type <code>"application/x-www-form-urlencoded"</code>. A body should be provided
when the FHIR search request is too long and might exceed the maximal allowed length of the URL when send to the server. In this case
a search via POST (see https://www.hl7.org/fhir/search.html#Introduction) can be used. The body should contain all the parameters that
follow after the <code style="white-space: pre;">&#8288;?&#8288;</code> in the FHIR search request. When a body is provided, the required <code style="white-space: pre;">&#8288;_search&#8288;</code> is automatically added
to the url in <code>request</code>. See examples and <code>?fhir_body</code>.</p>
</td></tr>
<tr><td><code id="fhir_search_+3A_username">username</code></td>
<td>
<p>A character vector of length one containing the username for basic authentication.</p>
</td></tr>
<tr><td><code id="fhir_search_+3A_password">password</code></td>
<td>
<p>A character vector of length one containing the password for basic authentication.</p>
</td></tr>
<tr><td><code id="fhir_search_+3A_token">token</code></td>
<td>
<p>A character vector of length one or object of class <a href="httr.html#topic+Token-class">httr::Token</a>, for bearer token authentication (e.g. OAuth2). See <code><a href="#topic+fhir_authenticate">fhir_authenticate()</a></code>
for how to create this.</p>
</td></tr>
<tr><td><code id="fhir_search_+3A_add_headers">add_headers</code></td>
<td>
<p>A named character vector of custom headers to add to the HTTP request, e.g. <code>c(myHeader = "somevalue")</code> or
<code>c(firstHeader = "value1", secondHeader = "value2")</code>.</p>
</td></tr>
<tr><td><code id="fhir_search_+3A_max_bundles">max_bundles</code></td>
<td>
<p>Maximal number of bundles to get. Defaults to Inf meaning all available bundles are downloaded.</p>
</td></tr>
<tr><td><code id="fhir_search_+3A_verbose">verbose</code></td>
<td>
<p>An integer vector of length one. If 0, nothing is printed, if 1, only finishing message is printed, if &gt; 1,
downloading progress will be printed. Defaults to 1.</p>
</td></tr>
<tr><td><code id="fhir_search_+3A_delay_between_attempts">delay_between_attempts</code></td>
<td>
<p>A numeric vector specifying the delay in seconds between attempts of reaching the server
that <code>fhir_search()</code> will make. The length of this vector determines the number of attempts that will be made before stopping with an error.
Defaults to <code>c(1,3,9,27,81)</code>.</p>
</td></tr>
<tr><td><code id="fhir_search_+3A_log_errors">log_errors</code></td>
<td>
<p>Either <code>NULL</code> or a character vector of length one indicating the name of a file in which to save the http errors.
<code>NULL</code> means no error logging. When a file name is provided, the errors are saved in the specified file. Defaults to <code>NULL</code>.
Regardless of the value of <code>log_errors</code> the most recent http error message within the current R session is saved internally and can
be accessed with <code><a href="#topic+fhir_recent_http_error">fhir_recent_http_error()</a></code>.</p>
</td></tr>
<tr><td><code id="fhir_search_+3A_save_to_disc">save_to_disc</code></td>
<td>
<p>Either <code>NULL</code> or a character vector of length one indicating the name of a directory in which to save the bundles.
If a directory name is provided, the bundles are saved as numerated xml-files into the directory specified
and not returned as a bundle list in the R session. This is useful when a lot of bundles are to be downloaded and keeping them all
in one R session might overburden working memory. When the download is complete, the bundles can be loaded into R using <code><a href="#topic+fhir_load">fhir_load()</a></code>.
Defaults to <code>NULL</code>, i.e. bundles are returned as a list within the R session.</p>
</td></tr>
<tr><td><code id="fhir_search_+3A_delay_between_bundles">delay_between_bundles</code></td>
<td>
<p>A numeric scalar specifying a time in seconds to wait between pages of the search result,
i.e. between downloading the current bundle and the next bundle. This can be used to avoid choking a weak server with
too many requests to quickly. Defaults to zero.</p>
</td></tr>
<tr><td><code id="fhir_search_+3A_rm_tag">rm_tag</code></td>
<td>
<p>Character vector of length 1 defining an xml tag of elements that will removed from the bundle automatically.
Defaults to <code>"div"</code>,leading to the removal of all html parts (see Details). Set to <code>NULL</code> to keep the bundles untouched.
See <code><a href="#topic+fhir_rm_div">fhir_rm_div()</a></code> and <code><a href="#topic+fhir_rm_tag">fhir_rm_tag()</a></code> for more info.</p>
</td></tr>
<tr><td><code id="fhir_search_+3A_max_attempts">max_attempts</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a> The number of maximal attempts is now determined by the length of <code>delay_between_attempts</code></p>
</td></tr>
</table>


<h3>Details</h3>



<h4>Request type</h4>

<p><code>fhir_search</code> allows for two types of search request:
</p>

<ol>
<li><p> FHIR search via GET:
This is the more common approach. All information on which resources to download is contained in the URL
that is send to the server (<code>request</code> argument). This encompasses the base url of the server, the resource type and possible
search parameters to further qualify the search (see <code><a href="#topic+fhir_url">fhir_url()</a></code>). The search via GET is the default and performed whenever
the argument <code>body</code> is NULL.
</p>
</li>
<li><p> FHIR search via POST:
This option should only be used when the parameters make the search URL so long the server might deny it
because it exceeds the allowed length. In this case the search parameters (everything that would usually follow the resource type
after the <code style="white-space: pre;">&#8288;?&#8288;</code>) can be transferred to a body of type <code>"application/x-www-form-urlencoded"</code> and send via POST. If you provide a body in
<code>fhir_search()</code>, the url in <code>request</code> should only contain the base URL and the resource type.
The function will automatically amend it with <code style="white-space: pre;">&#8288;_search&#8288;</code> and perform a POST.
</p>
</li></ol>




<h4>Authentication</h4>

<p>There are several ways of authentication implemented in <code>fhir_search()</code>. If you don't need any authentication,
just leave the arguments described in the following at their default values of <code>NULL</code>.
</p>

<ol>
<li><p> Basic Authentication: Provide the <code>username</code> and the <code>password</code> for basic authentication in the respective arguments.
</p>
</li>
<li><p> Token Authentication: Provide a token in the argument <code>token</code>, either as a character vector of length one or as as an object of class
<a href="httr.html#topic+Token-class">httr::Token</a>. You can use the function <code><a href="#topic+fhir_authenticate">fhir_authenticate()</a></code> to create this object.
</p>
</li></ol>




<h4>Additional headers</h4>

<p>Per default, the underlying HTTP requests are equipped with <em>Accept</em> and <em>Authorization</em> headers. If you need to pass additional headers,
e.g. cookies for authentication or other custom headers, you can add these to the request as a named character vector using the
<code>add_headers</code> argument.
</p>



<h4>HTML removal</h4>

<p>FHIR resources can contain a considerable amount of html code (e.g. in a <a href="https://www.hl7.org/fhir/narrative.html#xhtml">narrative</a> object),
which is often created by the server for example to provide a human-readable summary of the resource.
This data is usually not the aim of structured statistical analysis, so in the default setting <code><a href="#topic+fhir_search">fhir_search()</a></code> will remove the html
parts immediately after download to reduce memory usage (on a hapi server typically by around 30%, see <code><a href="#topic+fhir_rm_div">fhir_rm_div()</a></code>).
The memory gain is payed with a runtime increase of 10%-20%. The html removal can be disabled by setting <code>rm_tag = NULL</code>
to increase speed at the cost of increased memory usage.
</p>



<h3>Value</h3>

<p>A <a href="#topic+fhir_bundle_list-class">fhir_bundle_list</a> when <code>save_to_disc = NULL</code> (the default),  else <code>NULL</code>.
</p>


<h3>See Also</h3>


<ul>
<li><p> Creating a FHIR search request: <code><a href="#topic+fhir_url">fhir_url()</a></code> and <code><a href="#topic+fhir_body">fhir_body()</a></code> (for POST based search)
</p>
</li>
<li><p> OAuth2 Authentication: <code><a href="#topic+fhir_authenticate">fhir_authenticate()</a></code>
</p>
</li>
<li><p> Saving/reading bundles from disc: <code><a href="#topic+fhir_save">fhir_save()</a></code> and <code><a href="#topic+fhir_load">fhir_load()</a></code>
</p>
</li>
<li><p> Flattening the bundles: <code><a href="#topic+fhir_crack">fhir_crack()</a></code>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
#the try({}, silent = TRUE) statement is only there to catch errors when the server is down
#you can skip it when the server is reachable

try({

### Search with GET

#create fhir search url

request &lt;- fhir_url(url = "https://server.fire.ly",
                    resource = "Patient",
                    parameters = c(gender="female"))

#download bundles
bundles &lt;- fhir_search(request, max_bundles = 5)



### Search with POST (should actually be used for longer requests)

request &lt;- fhir_url(url = "https://server.fire.ly",
                    resource = "Patient")

body &lt;- fhir_body(content = list(gender = "female"))

bundles &lt;- fhir_search(request = request,
                       body = body,
                       max_bundles = 5)


 }, silent = TRUE)
 
</code></pre>

<hr>
<h2 id='fhir_serialize'>Serialize a <a href="#topic+fhir_bundle-class">fhir_bundle</a>, <a href="#topic+fhir_bundle_list-class">fhir_bundle_list</a> or <a href="#topic+fhir_resource-class">fhir_resource</a></h2><span id='topic+fhir_serialize'></span><span id='topic+fhir_serialize+2Cfhir_bundle_xml-method'></span><span id='topic+fhir_serialize+2Cfhir_bundle_serialized-method'></span><span id='topic+fhir_serialize+2Cfhir_bundle_list-method'></span><span id='topic+fhir_serialize+2Cfhir_resource_xml-method'></span><span id='topic+fhir_serialize+2Cfhir_resource_serialized-method'></span>

<h3>Description</h3>

<p>Serializes FHIR bundles or resources to allow for saving in .rda or .RData format without losing integrity of pointers
i.e. it turns a <a href="#topic+fhir_bundle_xml-class">fhir_bundle_xml</a>/<a href="#topic+fhir_resource_xml-class">fhir_resource_xml</a> object into an <a href="#topic+fhir_bundle_serialized-class">fhir_bundle_serialized</a>/<a href="#topic+fhir_resource_serialized-class">fhir_resource_serialized</a> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_serialize(bundles)

## S4 method for signature 'fhir_bundle_xml'
fhir_serialize(bundles)

## S4 method for signature 'fhir_bundle_serialized'
fhir_serialize(bundles)

## S4 method for signature 'fhir_bundle_list'
fhir_serialize(bundles)

## S4 method for signature 'fhir_resource_xml'
fhir_serialize(bundles)

## S4 method for signature 'fhir_resource_serialized'
fhir_serialize(bundles)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_serialize_+3A_bundles">bundles</code></td>
<td>
<p>A <a href="#topic+fhir_bundle-class">fhir_bundle</a>, <a href="#topic+fhir_bundle_list-class">fhir_bundle_list</a> or <a href="#topic+fhir_resource-class">fhir_resource</a> object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A  <a href="#topic+fhir_bundle_xml-class">fhir_bundle_xml</a>, <a href="#topic+fhir_bundle_list-class">fhir_bundle_list</a> or <a href="#topic+fhir_resource_xml-class">fhir_resource_xml</a>  object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#example bundles are serialized, unserialize like this:
bundles &lt;- fhir_unserialize(medication_bundles)

#Serialize like this:
bundles_for_saving &lt;- fhir_serialize(bundles)

#works also on single bundles
fhir_serialize(bundles[[1]])


</code></pre>

<hr>
<h2 id='fhir_style'>Create fhir_style object</h2><span id='topic+fhir_style'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
This function was used to create an object of class <code>fhir_style</code> in fhircrackr &lt; 2.0.0.
It is now deprecated, the information that used to be coded in <code>fhir_style</code> has been moved to the <a href="#topic+fhir_table_description-class">fhir_table_description</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_style(sep = ":::", brackets = character(), rm_empty_cols = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_style_+3A_sep">sep</code></td>
<td>
<p>A character vector of length one to separate pasted multiple entries. Defaults to <code>":::"</code></p>
</td></tr>
<tr><td><code id="fhir_style_+3A_brackets">brackets</code></td>
<td>
<p>A character vector of length two defining the brackets surrounding indices for multiple entries, e.g. <code>c("&lt;|", "|&gt;")</code>.
If this is empty (i.e. character of length zero, the default) or 'NULL', no indices will be added to multiple entries. If it is a character
vector of length one, it will be recycled to length two, i.e. <code>"|"</code> will become <code>c("|", "|")</code>.
Empty strings (<code>""</code>) are not allowed.</p>
</td></tr>
<tr><td><code id="fhir_style_+3A_rm_empty_cols">rm_empty_cols</code></td>
<td>
<p>A logical vector of length one. Remove empty columns? Defaults to <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A <code>fhir_style</code> object is part of a <a href="#topic+fhir_table_description-class">fhir_table_description</a> which in turn is part of a <a href="#topic+fhir_design-class">fhir_design</a> and
ultimately used in <code><a href="#topic+fhir_crack">fhir_crack()</a></code>. A <code>fhir_style</code> object contains three elements:
</p>

<ul>
<li> <p><code>sep</code>: A string defining the separator used to separate multiple entries for the same element in a FHIR resource,
e.g. multiple <code>address/city</code> elements in a Patient resource.
</p>
</li>
<li> <p><code>brackets</code>: A character vector of length two defining the brackets surrounding indices for multiple entries, e.g. <code>c("&lt;|", "|&gt;")</code>.
If this is empty (i.e. character of length 0, the default), no indices will be added to multiple entries.
Empty strings (<code>""</code>) are not allowed.
</p>
</li>
<li> <p><code>rm_empty_cols</code>: A logical scalar defining whether or not to remove empty columns after cracking. Empty columns arise when you
try to extract an element that doesn't appear in any of the resources.
A <code>fhir_style</code> object looks for example like this:
</p>
</li></ul>

<div class="sourceCode"><pre>sep: ':::'
brackets: '&lt;|' '|&gt;'
rm_empty_cols: FALSE
</pre></div>


<h3>Value</h3>

<p>A fhir_style object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#instead of this:

style &lt;- fhir_style(sep           = ":::",
                    brackets      = c("&lt;|", "|&gt;"),
                    rm_empty_cols = TRUE)

table_description &lt;- fhir_table_description(
                        resource = "Patient",
                        style = style)
#use this:
table_description &lt;- fhir_table_description(
                        resource       = "Patient",
                        sep            = ":::",
                        brackets       = c("&lt;|", "|&gt;"),
                         rm_empty_cols = TRUE)

</code></pre>

<hr>
<h2 id='fhir_style-class'>An S4 class to represent a design for cracking FHIR resources</h2><span id='topic+fhir_style-class'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
<a href="#topic+fhir_style-class">fhir_style</a> is now deprecated, the information that used to be coded here has been moved to the <a href="#topic+fhir_table_description-class">fhir_table_description</a>.
</p>


<h3>Slots</h3>


<dl>
<dt><code>sep</code></dt><dd><p>A string to separate pasted multiple entries. Defaults to <code>":::"</code>.</p>
</dd>
<dt><code>brackets</code></dt><dd><p>A character vector of length two defining the brackets surrounding indices for multiple entries,
e.g. <code>c("&lt;|", "|&gt;")</code>. If this is empty (i.e. character of length 0, the default), no indices will be added to multiple entries.
Empty strings (<code>""</code>) are not allowed.</p>
</dd>
<dt><code>rm_empty_cols</code></dt><dd><p>Logical scalar. Remove empty columns? Defaults to FALSE.</p>
</dd>
</dl>

<hr>
<h2 id='fhir_table_description'>Create <a href="#topic+fhir_table_description-class">fhir_table_description</a> object</h2><span id='topic+fhir_table_description'></span>

<h3>Description</h3>

<p>A <code>fhir_table_description</code> holds the information <code><a href="#topic+fhir_crack">fhir_crack()</a></code> needs to flatten (aka crack)
FHIR resources from a FHIR bundle. There should be one <code>fhir_table_description</code> per resource type as
<code><a href="#topic+fhir_crack">fhir_crack()</a></code> will create one data.frame/data.table per resource type in a bundle. See Details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_table_description(
  resource,
  cols = fhir_columns(),
  sep = ":::",
  brackets = character(),
  rm_empty_cols = FALSE,
  format = "compact",
  keep_attr = FALSE,
  style = deprecated()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_table_description_+3A_resource">resource</code></td>
<td>
<p>A character vector of length one or <a href="#topic+fhir_resource_type-class">fhir_resource_type</a> object
indicating which resource type should be extracted.</p>
</td></tr>
<tr><td><code id="fhir_table_description_+3A_cols">cols</code></td>
<td>
<p>Optional. A <a href="#topic+fhir_columns-class">fhir_columns</a> object or something that can be coerced to one,
like a (named) character vector, a (named) list containing xpath expressions,
or a <a href="#topic+fhir_xpath_expression-class">fhir_xpath_expression</a> object. See <code><a href="#topic+fhir_columns">fhir_columns()</a></code> and the examples.
If this argument is omitted, an empty <a href="#topic+fhir_columns-class">fhir_columns</a> object will be supplied.
This means that in the call to <code><a href="#topic+fhir_crack">fhir_crack()</a></code>, all available elements are extracted in put
in automatically named columns.</p>
</td></tr>
<tr><td><code id="fhir_table_description_+3A_sep">sep</code></td>
<td>
<p>A character of length one containing the separator string used for separating multiple entries in cells when <code>format = "compact"</code>.
ignored when <code>format = "wide"</code>. Defaults to <code>":::"</code>.</p>
</td></tr>
<tr><td><code id="fhir_table_description_+3A_brackets">brackets</code></td>
<td>
<p>A character of length one or two used for the indices of multiple entries. The first one is the opening bracket
and the second one the closing bracket. Vectors of length one will be recycled.
Defaults to <code>character(0)</code>, i.e. no brackets, meaning that multiple entries won't be indexed.</p>
</td></tr>
<tr><td><code id="fhir_table_description_+3A_rm_empty_cols">rm_empty_cols</code></td>
<td>
<p>A logical of length one indicating whether empty columns should be removed from the resulting table or not. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="fhir_table_description_+3A_format">format</code></td>
<td>
<p>A character of length one indicating whether the resulting table should be cracked to a <code>"wide"</code> or <code>"compact"</code> format.
<code>"wide"</code> means multiple entries will be distributed over several columns with indexed names. <code>"compact"</code> means multiple entries will be pasted into one cell/column separated by <code>sep</code> .
Defaults to <code>"compact"</code>.</p>
</td></tr>
<tr><td><code id="fhir_table_description_+3A_keep_attr">keep_attr</code></td>
<td>
<p>A logical of length one indicating whether the attribute name of the respective element (<code style="white-space: pre;">&#8288;@value&#8288;</code> in most cases)
should be attached to the name of the variable in the resulting table. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="fhir_table_description_+3A_style">style</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a></p>
</td></tr>
</table>


<h3>Details</h3>

<p>A <code>fhir_table_description</code> consists of
the following elements:
</p>

<ul>
<li><p> The resource element: Defines the resource type (e.g. <code>Patient</code> or <code>Observation</code>). See <code><a href="#topic+fhir_resource_type">fhir_resource_type()</a></code>.
</p>
</li>
<li><p> The cols element: Contains the column names and XPath expressions defining the columns to extract.
If this element is empty, <code><a href="#topic+fhir_crack">fhir_crack()</a></code> will extract all available elements of the resource and name the
columns automatically. See <code><a href="#topic+fhir_columns">fhir_columns()</a></code>.
</p>
</li>
<li><p> The sep element: A character of length one containing the separator string used for separating multiple entries in cells.
</p>
</li>
<li><p> The brackets element: A character of length one or two used for the indices of multiple entries. The first one is the opening bracket
and the second one the closing bracket. Vectors of length one will be recycled.
Defaults to <code>character(0)</code>, i.e. no brackets, meaning that multiple entries won't be indexed.
</p>
</li>
<li><p> The rm_empty_cols element: A logical of length one indicating whether empty columns should be removed in the resulting table or not. Defaults to <code>FALSE</code>.
</p>
</li>
<li><p> The format element: A character of length one indicating whether the resulting table should be cracked to a <code>wide</code> or <code>compact</code> format.
<code>wide</code> means multiple entries will be distributed over several columns with indexed names. <code>compact</code> means multiple entries will be pasted into one cell/column separated by <code>sep</code> .
Defaults to <code>compact</code>.
</p>
</li>
<li><p> The keep_attr element: A logical of length one indicating whether the attribute name of the respective element (<code style="white-space: pre;">&#8288;@value&#8288;</code> in most cases)
should be attached to the name of the variable in the resulting table. Defaults to <code>FALSE</code>.
</p>
</li></ul>

<p>A full <code>fhir_table_description</code> looks for example like this:
</p>
<div class="sourceCode"><pre>fhir_resource_type: Patient

fhir_columns:
column name | xpath expression
------------------------
name        | name/family
gender      | gender
id          | id

sep:           ':::'
brackets:      '[', ']'
rm_empty_cols: FALSE
format:        'compact'
keep_attr:     FALSE
</pre></div>


<h3>Value</h3>

<p>An object of class <a href="#topic+fhir_table_description-class">fhir_table_description</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># a minimal table description
fhir_table_description(
    resource = "Patient"
)

# named list for cols
fhir_table_description(
    resource = "Patient",
    cols     = list(
        id     = "id",
        name   = "name/family",
        gender = "gender"
    )
)

#unnamed character for cols, colnames are generated automatically
fhir_table_description(
    resource = "Patient",
    cols     = c(
        "id",
        "name/family",
        "gender"
    )
)

# named character for cols, and overwritten default for other arguments
fhir_table_description(
    resource = "Patient",
    cols = c(
        id            = "id",
        name          = "name/family",
        gender        = "gender"
    ),
    brackets      = c("[", "]"),
    rm_empty_cols = TRUE,
    format        = "wide"
)

# no column arguments is given -&gt; creates a column for all available elements
fhir_table_description(
    resource = "Patient",
    sep           = " &lt;~&gt; ",
    brackets      = c("&lt;&lt;&lt;", "&gt;&gt;&gt;"),
    rm_empty_cols = FALSE,
    format        = "wide"
)

</code></pre>

<hr>
<h2 id='fhir_table_description-class'>A S4 class describing the form of a table produced by <code><a href="#topic+fhir_crack">fhir_crack()</a></code></h2><span id='topic+fhir_table_description-class'></span>

<h3>Description</h3>

<p>A <code>fhir_table_description</code> holds the information <code><a href="#topic+fhir_crack">fhir_crack()</a></code> needs to flatten (aka crack) FHIR resources from a FHIR bundle and
is created with its constructor function <code><a href="#topic+fhir_table_description">fhir_table_description()</a></code>.
Each <code>fhir_table_description</code> describes a table for a specific resource type as <code><a href="#topic+fhir_crack">fhir_crack()</a></code> will create one data.frame/data.table
per resource type. See Details.
</p>


<h3>Details</h3>

<p>A <code>fhir_table_description</code> consists of
the following elements:
</p>

<ul>
<li><p> The resource element: Defines the resource type (e.g. <code>Patient</code> or <code>Observation</code>). See <code><a href="#topic+fhir_resource_type">fhir_resource_type()</a></code>.
</p>
</li>
<li><p> The cols element: Contains the column names and XPath expressions defining the columns to extract.
If this element is empty, <code><a href="#topic+fhir_crack">fhir_crack()</a></code> will extract all available elements of the resource and name the
columns automatically. See <code><a href="#topic+fhir_columns">fhir_columns()</a></code>.
</p>
</li>
<li><p> The sep element: A character of length one containing the separator string used for separating multiple entries in cells.
</p>
</li>
<li><p> The brackets element: A character of length one or two used for the indices of multiple entries. The first one is the opening bracket
and the second one the closing bracket. Vectors of length one will be recycled.
Defaults to <code>character(0)</code>, i.e. no brackets, meaning that multiple entries won't be indexed.
</p>
</li>
<li><p> The rm_empty_cols element: A logical of length one indicating whether empty columns should be removed in the resulting table or not. Defaults to <code>FALSE</code>.
</p>
</li>
<li><p> The format element: A character of length one indicating whether the resulting table should be cracked to a <code>wide</code> or <code>compact</code> format.
<code>wide</code> means multiple entries will be distributed over several columns with indexed names. <code>compact</code> means multiple entries will be pasted into one cell/column separated by <code>sep</code> .
Defaults to <code>compact</code>.
</p>
</li>
<li><p> The keep_attr element: A logical of length one indicating whether the attribute name of the respective element (<code style="white-space: pre;">&#8288;@value&#8288;</code> in most cases)
should be attached to the name of the variable in the resulting table. Defaults to <code>FALSE</code>.
</p>
</li></ul>

<p>A full <code>fhir_table_description</code> looks for example like this:
</p>
<div class="sourceCode"><pre>fhir_resource_type: Patient

fhir_columns:
column name | xpath expression
------------------------
name        | name/family
gender      | gender
id          | id

sep:           ':::'
brackets:      '[', ']'
rm_empty_cols: FALSE
format:        'compact'
keep_attr:     FALSE
</pre></div>


<h3>Slots</h3>


<dl>
<dt><code>resource</code></dt><dd><p>An object of class <a href="#topic+fhir_resource_type-class">fhir_resource_type</a> defining the resource type that
should be extracted.</p>
</dd>
<dt><code>cols</code></dt><dd><p>An object of class <a href="#topic+fhir_columns-class">fhir_columns</a> describing which columns should be created and how.
If this is an empty <a href="#topic+fhir_columns-class">fhir_columns</a> object, the call to <code><a href="#topic+fhir_crack">fhir_crack()</a></code> will extract all available
elements and put them in automatically named columns.</p>
</dd>
<dt><code>sep</code></dt><dd><p>A character of length one containing the separator string used for separating multiple entries in cells when <code>format = "compact"</code>.
ignored when <code>format = "wide"</code>.</p>
</dd>
<dt><code>brackets</code></dt><dd><p>A character of length one or two used for the indices of multiple entries. The first one is the opening bracket
and the second one the closing bracket. Vectors of length one will be recycled.
Defaults to <code>character(0)</code>, i.e. no brackets, meaning that multiple entries won't be indexed.</p>
</dd>
<dt><code>rm_empty_cols</code></dt><dd><p>A logical of length one indicating whether empty columns should be removed from the resulting table or not. Defaults to FALSE.</p>
</dd>
<dt><code>format</code></dt><dd><p>A character of length one indicating whether the resulting table should be cracked to a <code>wide</code> or <code>compact</code> format.
<code>wide</code> means multiple entries will be distributed over several columns with indexed names. <code>compact</code> means multiple entries will be pasted into one cell/column separated by <code>sep</code> .
Defaults to <code>compact</code>.</p>
</dd>
<dt><code>keep_attr</code></dt><dd><p>A logical of length one indicating whether the attribute name of the respective element (<code style="white-space: pre;">&#8288;@value&#8288;</code> in most cases)
should be attached to the name of the variable in the resulting table. Defaults to <code>FALSE</code></p>
</dd>
</dl>


<h3>See Also</h3>

<p><code><a href="#topic+fhir_resource_type">fhir_resource_type()</a></code>,<code><a href="#topic+fhir_columns">fhir_columns()</a></code>, <code><a href="#topic+fhir_design">fhir_design()</a></code>, <code><a href="#topic+fhir_crack">fhir_crack()</a></code>
</p>

<hr>
<h2 id='fhir_tree'>Represent a wide cast table as a tree</h2><span id='topic+fhir_tree'></span>

<h3>Description</h3>

<p>This function takes a wide table as created by <code><a href="#topic+fhir_crack">fhir_crack()</a></code> with <code>format="wide"</code>and creates the tree structure implicit in the
column names of the tables. It is useful to get an overview over the implied structure when planning to create
FHIR bundles from this table using <code><a href="#topic+fhir_build_bundle">fhir_build_bundle()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_tree(
  table,
  brackets,
  resource = "Resource",
  keep_attr = FALSE,
  keep_ids = FALSE,
  skip_one = FALSE,
  format = "plain",
  prompt = ": "
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_tree_+3A_table">table</code></td>
<td>
<p>A data.frame or data.table as produced by <code><a href="#topic+fhir_crack">fhir_crack()</a></code> with <code>format="wide"</code> or <code><a href="#topic+fhir_cast">fhir_cast()</a></code></p>
</td></tr>
<tr><td><code id="fhir_tree_+3A_brackets">brackets</code></td>
<td>
<p>A character vector of length two. The brackets used in the table.</p>
</td></tr>
<tr><td><code id="fhir_tree_+3A_resource">resource</code></td>
<td>
<p>A character vector of length one or <a href="#topic+fhir_resource_type-class">fhir_resource_type</a> object indicating which resource type the table is build from.</p>
</td></tr>
<tr><td><code id="fhir_tree_+3A_keep_attr">keep_attr</code></td>
<td>
<p>A logical vector of length one indicating whether attributes should be displayed or not.
Only used for formats <code>"plain"</code> and <code>"fancy"</code>.</p>
</td></tr>
<tr><td><code id="fhir_tree_+3A_keep_ids">keep_ids</code></td>
<td>
<p>A logical vector of length one indicating whether indices should be displayed or not.
Only used for formats <code>"plain"</code> and <code>"fancy"</code>.</p>
</td></tr>
<tr><td><code id="fhir_tree_+3A_skip_one">skip_one</code></td>
<td>
<p>A logical vector of length one indicating whether first index 1 should be displayed or not.
Only used for formats <code>"plain"</code> and <code>"fancy"</code>.</p>
</td></tr>
<tr><td><code id="fhir_tree_+3A_format">format</code></td>
<td>
<p>The format of the tree. One of <code>"plain"</code>, <code>"fancy"</code> or <code>"xml"</code>.</p>
</td></tr>
<tr><td><code id="fhir_tree_+3A_prompt">prompt</code></td>
<td>
<p>A character vector of length one use as prompt
Only used for formats <code>"plain"</code> and <code>"fancy"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A string that can be used with <code>cat()</code> or can be written to a text file.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fhir_cast">fhir_cast()</a></code>, <code><a href="#topic+fhir_build_bundle">fhir_build_bundle()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#' #unserialize example
bundles &lt;- fhir_unserialize(bundles = example_bundles1)

#crack fhir resources
table_desc &lt;- fhir_table_description(
    resource = "Patient",
    brackets = c("[", "]"),
    sep      = " ",
    format   = "wide"
)

df &lt;- fhir_crack(bundles = bundles, design = table_desc)


###show tree

#plain format
cat(fhir_tree(
       table = df,
       brackets = c("[", "]"),
       resource = "Patient"
    )
 )

#fancy format with indices
cat(fhir_tree(
       table = df,
       brackets = c("[", "]"),
       resource = "Patient",
       format = "fancy",
       keep_ids = TRUE
     )
)

#xml format
cat(fhir_tree(
       table = df,
       brackets = c("[", "]"),
       resource = "Patient",
       format = "xml"
     )
 )
</code></pre>

<hr>
<h2 id='fhir_unserialize'>Unserialize a <a href="#topic+fhir_bundle-class">fhir_bundle</a>, <a href="#topic+fhir_bundle_list-class">fhir_bundle_list</a> or <a href="#topic+fhir_resource-class">fhir_resource</a></h2><span id='topic+fhir_unserialize'></span><span id='topic+fhir_unserialize+2Cfhir_bundle_xml-method'></span><span id='topic+fhir_unserialize+2Cfhir_bundle_serialized-method'></span><span id='topic+fhir_unserialize+2Cfhir_resource_xml-method'></span><span id='topic+fhir_unserialize+2Cfhir_resource_serialized-method'></span><span id='topic+fhir_unserialize+2Cfhir_bundle_list-method'></span>

<h3>Description</h3>

<p>Unserializes FHIR resources or bundles that have been serialized to allow for saving in .rda or .RData format,
i.e. it turns a <a href="#topic+fhir_bundle_serialized-class">fhir_bundle_serialized</a>/<a href="#topic+fhir_resource_serialized-class">fhir_resource_serialized</a> object into an <a href="#topic+fhir_bundle_xml-class">fhir_bundle_xml</a>/<a href="#topic+fhir_resource_xml-class">fhir_resource_xml</a> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_unserialize(bundles)

## S4 method for signature 'fhir_bundle_xml'
fhir_unserialize(bundles)

## S4 method for signature 'fhir_bundle_serialized'
fhir_unserialize(bundles)

## S4 method for signature 'fhir_resource_xml'
fhir_unserialize(bundles)

## S4 method for signature 'fhir_resource_serialized'
fhir_unserialize(bundles)

## S4 method for signature 'fhir_bundle_list'
fhir_unserialize(bundles)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_unserialize_+3A_bundles">bundles</code></td>
<td>
<p>A <a href="#topic+fhir_bundle-class">fhir_bundle</a>, <a href="#topic+fhir_bundle_list-class">fhir_bundle_list</a> or <a href="#topic+fhir_resource-class">fhir_resource</a> object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A  <a href="#topic+fhir_bundle_serialized-class">fhir_bundle_serialized</a>, <a href="#topic+fhir_bundle_list-class">fhir_bundle_list</a> or <a href="#topic+fhir_resource_serialized-class">fhir_resource_serialized</a>object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#unserialize bundle list
fhir_unserialize(patient_bundles)

#unserialize single bundle
fhir_unserialize(patient_bundles[[1]])

</code></pre>

<hr>
<h2 id='fhir_url'>Create FHIR URL</h2><span id='topic+fhir_url'></span><span id='topic+fhir_url+2Ccharacter+2Cmissing+2Cmissing-method'></span><span id='topic+fhir_url+2Ccharacter+2Ccharacter+2Cmissing-method'></span><span id='topic+fhir_url+2Ccharacter+2Ccharacter+2Ccharacter-method'></span><span id='topic+fhir_url+2Ccharacter+2Ccharacter+2Clist-method'></span>

<h3>Description</h3>

<p>This function creates an object of class <a href="#topic+fhir_url-class">fhir_url</a> which mostly represents a URL-encoded URL for
a FHIR search request. A valid Search URL contains a base URL and a resource type and may contain additional
search parameters. For more info on FHIR search see https://www.hl7.org/fhir/search.html.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_url(url, resource, parameters, url_enc = TRUE)

## S4 method for signature 'character,missing,missing'
fhir_url(url, url_enc = TRUE)

## S4 method for signature 'character,character,missing'
fhir_url(url, resource, url_enc = TRUE)

## S4 method for signature 'character,character,character'
fhir_url(url, resource, parameters, url_enc = TRUE)

## S4 method for signature 'character,character,list'
fhir_url(url, resource, parameters, url_enc = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_url_+3A_url">url</code></td>
<td>
<p>A character of length one specifying either the full search request,
e.g. <code>"http://hapi.fhir.org/baseR4/Patient?gender=male&amp;_summary=count"</code>, or
the base URL to the FHIR server, e.g. <code>"http://hapi.fhir.org/baseR4"</code>.</p>
</td></tr>
<tr><td><code id="fhir_url_+3A_resource">resource</code></td>
<td>
<p>A character of length one or <a href="#topic+fhir_resource_type-class">fhir_resource_type</a> object with the resource type to be searched, e.g. <code>"Patient"</code>.</p>
</td></tr>
<tr><td><code id="fhir_url_+3A_parameters">parameters</code></td>
<td>
<p>Optional. Either a length 1 character containing properly formatted FHIR search parameters, e.g.
<code>"gender=male&amp;_summary=count"</code> or a named list or named character vector e.g. <code>list(gender="male", "_summary"="count")</code>
or <code>c(gender="male", "_summary"="count")</code>. Note that parameter names beginning with <code style="white-space: pre;">&#8288;_&#8288;</code> have to be put in quotation marks!</p>
</td></tr>
<tr><td><code id="fhir_url_+3A_url_enc">url_enc</code></td>
<td>
<p>Should the url be URL-encoded? Defaults to <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>You can use this function in two ways. If you provide just one string in the argument url with the full FHIR search request, this string
will be taken as a full FHIR search request. If you also provide the arguments <code>resource</code> and/or <code>parameters</code>, the string in <code>url</code> will be taken
as the base url of your FHIR server and the arguments will be concatenated appropriately to form the full request. See examples.
</p>
<p>Note that only the latter approach does a validity check on the resource type!
</p>
<p>You can disable URL-encoding by setting <code>url_enc=FALSE</code>.
</p>


<h3>Value</h3>

<p>An object of class <a href="#topic+fhir_url-class">fhir_url</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#provide full FHIR search request
fhir_url(url = "http://hapi.fhir.org/baseR4/Patient?gender=male&amp;_summary=count")

#provide base url and resource type
fhir_url(
   url      = "http://hapi.fhir.org/baseR4",
   resource = "Patient"
 )

#parameters in one string
fhir_url(
   url        = "http://hapi.fhir.org/baseR4",
   resource   = "Patient",
   parameters = "gender=male&amp;_summary=count"
 )

#parameters as a named character
fhir_url(
   url        = "http://hapi.fhir.org/baseR4",
   resource   = "Patient",
   parameters = c("gender" = "male", "_summary" = "count")
 )

#parameters as a named list
fhir_url(
   url        = "http://hapi.fhir.org/baseR4",
   resource   = "Patient",
   parameters = list("gender" = "male", "_summary" = "count")
 )
</code></pre>

<hr>
<h2 id='fhir_url-class'>An S4 object to represent a URL for a FHIR server</h2><span id='topic+fhir_url-class'></span>

<h3>Description</h3>

<p>Objects of this class are basically strings (character vectors of length one) representing
a URL. They are usually url encoded. See <code><a href="#topic+fhir_url">fhir_url()</a></code> for how to build them.
</p>

<hr>
<h2 id='fhir_xpath_expression'>Create fhir_xpath_expression</h2><span id='topic+fhir_xpath_expression'></span>

<h3>Description</h3>

<p>This function takes a character vector, checks whether it contains valid XPath (1.0) expressions
and returns it as an fhir_xpath_expression object. These objects are used in <code>fhir_parameters</code> objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fhir_xpath_expression(expression)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fhir_xpath_expression_+3A_expression">expression</code></td>
<td>
<p>A character vector of the XPath expressions</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A XPath expression object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>fhir_xpath_expression(c("//Patient", "name/given"))

</code></pre>

<hr>
<h2 id='fhir_xpath_expression-class'>An S4 class for xpath_expressions
Objects of this class are essentially character vectors, but can only be valid
XPath (1.0) expressions.
They are mostly used in the <code>fhir_columns</code> class.</h2><span id='topic+fhir_xpath_expression-class'></span>

<h3>Description</h3>

<p>An S4 class for xpath_expressions
Objects of this class are essentially character vectors, but can only be valid
XPath (1.0) expressions.
They are mostly used in the <code>fhir_columns</code> class.
</p>

<hr>
<h2 id='medication_bundles'>Exemplary FHIR bundles</h2><span id='topic+medication_bundles'></span><span id='topic+patient_bundles'></span>

<h3>Description</h3>

<p>These data examples can be used to explore some of the functions from the fhircrackr package
when direct access to a FHIR server is not possible.
</p>
<p>All example data sets are <a href="#topic+fhir_bundle_list-class">fhir_bundle_list</a>s containing <a href="#topic+fhir_bundle_serialized-class">fhir_bundle_serialized</a> objects
representing FHIR bundles as returned by <code><a href="#topic+fhir_search">fhir_search()</a></code>. They have to be unserialized (once per R session),
before you can work with them!
</p>


<h3>Usage</h3>

<pre><code class='language-R'>medication_bundles

patient_bundles
</code></pre>


<h3>Format</h3>

<p>An object of class <code>fhir_bundle_list</code> of length 3.
</p>
<p>An object of class <code>fhir_bundle_list</code> of length 2.
</p>


<h3>Details</h3>

<p><code>medication_bundles</code> contains 3 bundles with MedicationStatement resources representing Medications with Snomed CT code
429374003 and the respective Patient resources that are linked to these MedicationStatements.
</p>
<p><code>patient_bundles</code> contains 2 bundles with Patient resources.
</p>


<h3>Source</h3>

<p>The data sets are generated by the following code:
</p>
<p><strong>medication_bundles</strong> (<em>Downloaded 10-05-21</em>)
</p>
<div class="sourceCode"><pre>search_request  &lt;- fhir_url(url = "https://hapi.fhir.org/baseR4",
							resource = "MedicationStatement",
							parameters = c("code" = "http://snomed.info/ct|429374003",
										   "_include" = "MedicationStatement:subject"))

bundles &lt;- fhir_search(request = search_request, max_bundles = 3)

medication_bundles &lt;- fhir_serialize(bundles = bundles)
</pre></div>
<p><strong>patient_bundles</strong> (<em>Downloaded 10-05-21</em>)
</p>
<div class="sourceCode"><pre>bundles &lt;- fhir_search(request="https://hapi.fhir.org/baseR4/Patient",
                       max_bundles=2,
                       verbose = 0)

patient_bundles &lt;- fhir_serialize(bundles = bundles)
</pre></div>


<h3>Examples</h3>

<pre><code class='language-R'>#unserialize xml objects before doing anything else with them!
fhir_unserialize(bundles = medication_bundles)

#unserialize xml objects before doing anything else with them!
fhir_unserialize(bundles = patient_bundles)
</code></pre>

<hr>
<h2 id='paste_paths'>Concatenate two paths</h2><span id='topic+paste_paths'></span>

<h3>Description</h3>

<p>Concatenates two strings to a path string correctly.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>paste_paths(path1 = "w", path2 = "d", os = "LiNuX")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="paste_paths_+3A_path1">path1</code></td>
<td>
<p>A a character vector of length one specifying the left hand part of the resulting path.</p>
</td></tr>
<tr><td><code id="paste_paths_+3A_path2">path2</code></td>
<td>
<p>A a character vector of length one specifying the right hand part of the resulting path.</p>
</td></tr>
<tr><td><code id="paste_paths_+3A_os">os</code></td>
<td>
<p>A a character vector of length one specifying the operating system you're operating on: windows or linux.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A a character vector of length one containing the concatenated path.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>paste_paths(path1 = "data", path2 = "patients")
paste_paths(path1 = "/data", path2 = "patients")
paste_paths(path1 = "/data/", path2 = "patients")
paste_paths(path1 = "/data", path2 = "/patients")
paste_paths(path1 = "/data/", path2 = "/patients/")
paste_paths(path1 = "data", path2 = "patients", os = "windows")
</code></pre>

<hr>
<h2 id='pastep'>Concatenate paths</h2><span id='topic+pastep'></span>

<h3>Description</h3>

<p>Concatenates two or more strings to a path string correctly.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pastep(..., list_of_paths = NULL, ext = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pastep_+3A_...">...</code></td>
<td>
<p>A Set of Path Strings. Only works if list_of_paths is NULL</p>
</td></tr>
<tr><td><code id="pastep_+3A_list_of_paths">list_of_paths</code></td>
<td>
<p>Either a vector or a list of paths strings</p>
</td></tr>
<tr><td><code id="pastep_+3A_ext">ext</code></td>
<td>
<p>An Extension to add at the end of the path</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A Character of length one, the combined path.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>pastep('a', 'b', 'c', 'd')
pastep(list_of_paths = list(paste0('/', letters, '/'), as.character(1:13)))
pastep(list_of_paths = c(letters, as.character(1:13)))
pastep(list_of_paths = c(letters, as.character(1:13)), ext = '.txt')
pastep(list_of_paths = c(letters, as.character(1:13)), ext = '_dat.txt')
</code></pre>

<hr>
<h2 id='transaction_bundle_example'>Toy examples to POST/PUT on a server</h2><span id='topic+transaction_bundle_example'></span><span id='topic+example_resource1'></span><span id='topic+example_resource2'></span><span id='topic+example_resource3'></span>

<h3>Description</h3>

<p>These data examples are simple examples to try out POSTing/PUTing resources
to a server. See <strong>Source</strong> for how the xml versions look.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>transaction_bundle_example

example_resource1

example_resource2

example_resource3
</code></pre>


<h3>Format</h3>

<p>An object of class <code>fhir_bundle_serialized</code> of length 1277.
</p>
<p>An object of class <code>fhir_resource_serialized</code> of length 267.
</p>
<p>An object of class <code>fhir_resource_serialized</code> of length 290.
</p>
<p>An object of class <code>fhir_resource_serialized</code> of length 608.
</p>


<h3>Details</h3>

<p><code>transaction_bundle_example</code> contains 1 transaction bundle with 2 Patient resources.
</p>
<p><code>example_resource1</code> contains 1 patient resource without id for POSTing
</p>
<p><code>example_resource2</code> contains 1 patient resource with id for PUTing
</p>
<p><code>example_resource3</code> contains 1 Medication resource with an id xml attribute
</p>


<h3>Source</h3>

<p><strong>transaction_bundle_example</strong>
</p>
<div class="sourceCode"><pre>&lt;Bundle&gt;
   &lt;type value='transaction'/&gt;
	  &lt;entry&gt;
	     &lt;resource&gt;
	        &lt;Patient&gt;
	           &lt;id value='id1'/&gt;
	           &lt;address&gt;
	              &lt;use value='home'/&gt;
	              &lt;city value='Amsterdam'/&gt;
	              &lt;type value='physical'/&gt;
	              &lt;country value='Netherlands'/&gt;
	           &lt;/address&gt;
	           &lt;name&gt;
	              &lt;given value='Marie'/&gt;
	           &lt;/name&gt;
	        &lt;/Patient&gt;
	     &lt;/resource&gt;
	     &lt;request&gt;
	        &lt;method value='POST'/&gt;
	        &lt;url value='Patient'/&gt;
	     &lt;/request&gt;
	  &lt;/entry&gt;
	  &lt;entry&gt;
	      &lt;resource&gt;
	         &lt;Patient&gt;
	            &lt;id value='id3'/&gt;
	            &lt;address&gt;
	               &lt;use value='home'/&gt;
	               &lt;city value='Berlin'/&gt;
	            &lt;/address&gt;
	            &lt;address&gt;
	               &lt;use value='work'/&gt;
	               &lt;city value='London'/&gt;
	               &lt;type value='postal'/&gt;
	               &lt;country value='England'/&gt;
             &lt;/address&gt;
	            &lt;address&gt;
	               &lt;type value='postal'/&gt;
	               &lt;country value='France'/&gt;
	            &lt;/address&gt;
	            &lt;name&gt;
	               &lt;given value='Frank'/&gt;
	            &lt;/name&gt;
	            &lt;name&gt;
	               &lt;given value='Max'/&gt;
	            &lt;/name&gt;
	        &lt;/Patient&gt;
	     &lt;/resource&gt;
	     &lt;request&gt;
	        &lt;method value='POST'/&gt;
	        &lt;url value='Patient'/&gt;
	     &lt;/request&gt;
	  &lt;/entry&gt;
&lt;/Bundle&gt;
</pre></div>
<p><strong>example_resource1</strong>
</p>
<div class="sourceCode"><pre>&lt;Patient&gt;
   &lt;name&gt;
	     &lt;given value = 'Marie'/&gt;
	  &lt;/name&gt;
	  &lt;gender value = 'female'/&gt;
	  &lt;birthDate value = '1970-01-01'/&gt;
&lt;/Patient&gt;
</pre></div>
<p><strong>example_resource2</strong>
</p>
<div class="sourceCode"><pre>&lt;Patient&gt;
   &lt;id value = '1a2b3c'/&gt;
   &lt;name&gt;
	     &lt;given value = 'Marie'/&gt;
	  &lt;/name&gt;
	  &lt;gender value = 'female'/&gt;
	  &lt;birthDate value = '1970-01-01'/&gt;
&lt;/Patient&gt;
</pre></div>
<p><strong>example_resource3</strong>
</p>
<div class="sourceCode"><pre>&lt;Medication&gt;
    &lt;code&gt;
        &lt;coding&gt;
            &lt;system value="http://www.nlm.nih.gov/research/umls/rxnorm"/&gt;
            &lt;code value="1594660"/&gt;
            &lt;display value="Alemtuzumab 10mg/ml (Lemtrada)"/&gt;
        &lt;/coding&gt;
    &lt;/code&gt;
    &lt;ingredient id="1"&gt;
    	&lt;itemReference&gt;
     		&lt;reference value="Substance/5463"/&gt;
   		&lt;/itemReference&gt;
    &lt;/ingredient&gt;
    &lt;ingredient id="2"&gt;
    	&lt;itemReference&gt;
     		&lt;reference value="Substance/3401"/&gt;
 		&lt;/itemReference&gt;
    &lt;/ingredient&gt;
&lt;/Medication&gt;
</pre></div>


<h3>Examples</h3>

<pre><code class='language-R'>#unserialize xml objects before doing anything else with them!
fhir_unserialize(bundles = transaction_bundle_example)
#unserialize xml objects before doing anything else with them!
fhir_unserialize(example_resource1)
#unserialize xml objects before doing anything else with them!
fhir_unserialize(example_resource2)
#unserialize xml objects before doing anything else with them!
fhir_unserialize(example_resource3)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
