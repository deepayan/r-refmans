<!DOCTYPE html><html><head><title>Help for package rslurm</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {rslurm}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#rslurm-package'><p>Introduction to the <code>rslurm</code> Package</p></a></li>
<li><a href='#cancel_slurm'><p>Cancels a scheduled Slurm job</p></a></li>
<li><a href='#cleanup_files'><p>Deletes temporary files associated with a Slurm job</p></a></li>
<li><a href='#get_job_status'><p>Get the status of a Slurm job</p></a></li>
<li><a href='#get_slurm_out'><p>Reads the output of a function calculated on the Slurm cluster</p></a></li>
<li><a href='#local_slurm_array'><p>Execute a Slurm job locally</p></a></li>
<li><a href='#print_job_status'><p>Deprecated functions in package <span class="pkg">rslurm</span>.</p></a></li>
<li><a href='#print_job_status-deprecated'><p>Prints the status of a Slurm job and, if completed, its console/error output</p></a></li>
<li><a href='#slurm_apply'><p>Parallel execution of a function on the Slurm cluster</p></a></li>
<li><a href='#slurm_call'><p>Execution of a single function call on the Slurm cluster</p></a></li>
<li><a href='#slurm_job'><p>Create a slurm_job object</p></a></li>
<li><a href='#slurm_map'><p>Parallel execution of a function over a list on the Slurm cluster</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Submit R Calculations to a 'Slurm' Cluster</td>
</tr>
<tr>
<td>Description:</td>
<td>Functions that simplify submitting R scripts to a 'Slurm' 
    workload manager, in part by automating the division of embarrassingly
    parallel calculations across cluster nodes.</td>
</tr>
<tr>
<td>Acknowledgements:</td>
<td>Development of this R package was supported by the
National Socio-Environmental Synthesis Center (SESYNC) under
funding received from the National Science Foundation grants
DBI-1052875 and DBI-1639145.</td>
</tr>
<tr>
<td>Version:</td>
<td>0.6.2</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-01-31</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://www.earthdatascience.org/rslurm/">https://www.earthdatascience.org/rslurm/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/earthlab/rslurm/issues">https://github.com/earthlab/rslurm/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>whisker (&ge; 0.3)</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Suggests:</td>
<td>parallel, testthat, knitr, rmarkdown, markdown</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-02-23 19:14:46 UTC; verleyee</td>
</tr>
<tr>
<td>Author:</td>
<td>Philippe Marchand [aut],
  Ian Carroll [aut],
  Mike Smorul [aut],
  Rachael Blake [aut],
  Quentin Read [aut],
  Dayne Filer [ctb],
  Ben Fasoli [ctb],
  Pol van Rijn [ctb],
  Sebastian Schubert [ctb],
  Rob Gilmore [ctb],
  Christopher Barrington [ctb],
  Se Jong Cho [art],
  Erick Verleye [cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Erick Verleye &lt;erve3705@colorado.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-02-24 08:42:35 UTC</td>
</tr>
</table>
<hr>
<h2 id='rslurm-package'>Introduction to the <code>rslurm</code> Package</h2><span id='topic+rslurm-package'></span>

<h3>Description</h3>

<p>Send long-running or parallel jobs to a Slurm workload manager (i.e. cluster)
using the <code><a href="#topic+slurm_call">slurm_call</a></code>, <code><a href="#topic+slurm_apply">slurm_apply</a></code>, or
<code><a href="#topic+slurm_map">slurm_map</a></code> functions.
</p>


<h3>Job submission</h3>

<p>This package includes three core functions used to send computations to a 
Slurm cluster: 1) <code><a href="#topic+slurm_call">slurm_call</a></code> executes a function using a 
single set of parameters (passed as a list), 2) <code><a href="#topic+slurm_apply">slurm_apply</a></code> 
evaluates a function in parallel for each row of parameters in a given 
data frame, and 3) <code><a href="#topic+slurm_map">slurm_map</a></code> evaluates a function in parallel
for each element of a list. 
The functions <code>slurm_apply</code> and <code>slurm_map</code> automatically split the 
parameter rows or list elements into equal-size chunks, 
each chunk to be processed by a separate cluster node. 
They use functions from the <code><a href="parallel.html#topic+parallel-package">parallel-package</a></code> 
package to parallelize computations across processors on a given node.
</p>
<p>The output of <code>slurm_apply</code>, <code>slurm_map</code>, or <code>slurm_call</code> 
is a <code>slurm_job</code> object that serves as an input to the other functions in the package: 
<code><a href="#topic+print_job_status">print_job_status</a></code>, <code><a href="#topic+cancel_slurm">cancel_slurm</a></code>, 
<code><a href="#topic+get_slurm_out">get_slurm_out</a></code> and <code><a href="#topic+cleanup_files">cleanup_files</a></code>.
</p>


<h3>Function specification</h3>

<p>To be compatible with <code><a href="#topic+slurm_apply">slurm_apply</a></code>, a function may accept any 
number of single value parameters. The names of these parameters must match
the column names of the <code>params</code> data frame supplied. There are no 
restrictions on the types of parameters passed as a list to 
<code><a href="#topic+slurm_call">slurm_call</a></code> or <code><a href="#topic+slurm_map">slurm_map</a></code>
</p>
<p>If the function passed to <code>slurm_call</code> or <code>slurm_apply</code> requires 
knowledge of any R objects (data, custom helper functions) besides 
<code>params</code>, a character vector corresponding to their names should be 
passed to the optional <code>global_objects</code> argument.
</p>
<p>When parallelizing a function, since any error will interrupt all 
calculations for the current node, it may be useful to wrap expressions 
which may generate errors into a <code><a href="base.html#topic+try">try</a></code> or 
<code><a href="base.html#topic+conditions">tryCatch</a></code> function. This will ensure the computation 
continues with the next parameter set after reporting the error.
</p>


<h3>Output Format</h3>

<p>The default output format for <code>get_slurm_out</code> (<code>outtype = "raw"</code>)
is a list where each element is the return value of one function call. If 
the function passed to <code>slurm_apply</code> produces a vector output, you may
use <code>outtype = "table"</code> to collect the output in a single data frame, 
with one row by function call.
</p>


<h3>Slurm Configuration</h3>

<p>Advanced options for the Slurm workload manager may accompany job submission
by <code><a href="#topic+slurm_call">slurm_call</a></code>, <code><a href="#topic+slurm_map">slurm_map</a></code>, and <code><a href="#topic+slurm_apply">slurm_apply</a></code> 
through the optional <code>slurm_options</code> argument. For example, passing
<code>list(time = '1:30:00')</code> for this options limits the job to 1 hour and 30
minutes. Some advanced configuration must be set through environment 
variables. On a multi-cluster head node, for example, the <code>SLURM_CLUSTERS</code>
environment variable must be set to direct jobs to a non-default cluster.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
# Create a data frame of mean/sd values for normal distributions 
pars &lt;- data.frame(par_m = seq(-10, 10, length.out = 1000), 
                   par_sd = seq(0.1, 10, length.out = 1000))
                   
# Create a function to parallelize
ftest &lt;- function(par_m, par_sd) {
 samp &lt;- rnorm(10^7, par_m, par_sd)
 c(s_m = mean(samp), s_sd = sd(samp))
}

sjob1 &lt;- slurm_apply(ftest, pars)
print_job_status(sjob1)
res &lt;- get_slurm_out(sjob1, "table")
all.equal(pars, res) # Confirm correct output
cleanup_files(sjob1)

## End(Not run)
  
</code></pre>

<hr>
<h2 id='cancel_slurm'>Cancels a scheduled Slurm job</h2><span id='topic+cancel_slurm'></span>

<h3>Description</h3>

<p>This function cancels the specified Slurm job by invoking the Slurm 
<code>scancel</code> command. It does <em>not</em> delete the temporary files 
(e.g. scripts) created by <code><a href="#topic+slurm_apply">slurm_apply</a></code> or 
<code><a href="#topic+slurm_call">slurm_call</a></code>. Use <code><a href="#topic+cleanup_files">cleanup_files</a></code> to remove those 
files.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cancel_slurm(slr_job)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cancel_slurm_+3A_slr_job">slr_job</code></td>
<td>
<p>A <code>slurm_job</code> object.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+cleanup_files">cleanup_files</a></code>
</p>

<hr>
<h2 id='cleanup_files'>Deletes temporary files associated with a Slurm job</h2><span id='topic+cleanup_files'></span>

<h3>Description</h3>

<p>This function deletes all temporary files associated with the specified Slurm
job, including files created by <code><a href="#topic+slurm_apply">slurm_apply</a></code> or 
<code><a href="#topic+slurm_call">slurm_call</a></code>, as well as outputs from the cluster. These files
should be located in the <em>_rslurm_[jobname]</em> folder of the current
working directory.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cleanup_files(slr_job, wait = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cleanup_files_+3A_slr_job">slr_job</code></td>
<td>
<p>A <code>slurm_job</code> object.</p>
</td></tr>
<tr><td><code id="cleanup_files_+3A_wait">wait</code></td>
<td>
<p>Specify whether to block until <code>slr_job</code> completes.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+slurm_apply">slurm_apply</a></code>, <code><a href="#topic+slurm_call">slurm_call</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
sjob &lt;- slurm_apply(func, pars)
print_job_status(sjob) # Prints console/error output once job is completed.
func_result &lt;- get_slurm_out(sjob, "table") # Loads output data into R.
cleanup_files(sjob)

## End(Not run)
</code></pre>

<hr>
<h2 id='get_job_status'>Get the status of a Slurm job</h2><span id='topic+get_job_status'></span>

<h3>Description</h3>

<p>This function returns the completion status of a Slurm job, its queue status 
if any and log outputs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_job_status(slr_job)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_job_status_+3A_slr_job">slr_job</code></td>
<td>
<p>A <code>slurm_job</code> object.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>queue</code> element of the output is a data frame matching the output
of the Slurm <code>squeue</code> command for that job; it will only indicate portions
of job that are running or in queue. The <code>log</code> element is a
vector of the contents of console/error output files for each node where the 
job is running.
</p>


<h3>Value</h3>

<p>A list with three elements: <code>completed</code> is a logical value 
indicating if all portions of the job have completed or stopped, <code>queue</code> 
contains the information on job elements still in queue, and
<code>log</code> contains the console/error logs.
</p>

<hr>
<h2 id='get_slurm_out'>Reads the output of a function calculated on the Slurm cluster</h2><span id='topic+get_slurm_out'></span>

<h3>Description</h3>

<p>This function reads all function output files (one by cluster node used) from 
the specified Slurm job and returns the result in a single data frame
(if &quot;table&quot; format selected) or list (if &quot;raw&quot; format selected). It doesn't 
record any messages (including warnings or errors) output to the R console
during the computation; these can be consulted by invoking 
<code><a href="#topic+print_job_status">print_job_status</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_slurm_out(slr_job, outtype = "raw", wait = TRUE, ncores = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_slurm_out_+3A_slr_job">slr_job</code></td>
<td>
<p>A <code>slurm_job</code> object.</p>
</td></tr>
<tr><td><code id="get_slurm_out_+3A_outtype">outtype</code></td>
<td>
<p>Can be &quot;table&quot; or &quot;raw&quot;, see &quot;Value&quot; below for details.</p>
</td></tr>
<tr><td><code id="get_slurm_out_+3A_wait">wait</code></td>
<td>
<p>Specify whether to block until <code>slr_job</code> completes.</p>
</td></tr>
<tr><td><code id="get_slurm_out_+3A_ncores">ncores</code></td>
<td>
<p>(optional) If not null, the number of cores passed to
mclapply</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>outtype</code> option is only relevant for jobs submitted with 
<code>slurm_apply</code>. Jobs sent with <code>slurm_call</code> only return a single
object, and setting <code>outtype = "table"</code> creates an error in that case.
</p>


<h3>Value</h3>

<p>If <code>outtype = "table"</code>: A data frame with one column by 
return value of the function passed to <code>slurm_apply</code>, where 
each row is the output of the corresponding row in the params data frame 
passed to <code>slurm_apply</code>.
</p>
<p>If <code>outtype = "raw"</code>: A list where each element is the output 
of the function passed to <code>slurm_apply</code> for the corresponding
row in the params data frame passed to <code>slurm_apply</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+slurm_apply">slurm_apply</a></code>, <code><a href="#topic+slurm_call">slurm_call</a></code>
</p>

<hr>
<h2 id='local_slurm_array'>Execute a Slurm job locally</h2><span id='topic+local_slurm_array'></span>

<h3>Description</h3>

<p>Run a previously created <code>slurm_job</code> object locally instead of on a
Slurm cluster
</p>


<h3>Usage</h3>

<pre><code class='language-R'>local_slurm_array(slr_job, rscript_path = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="local_slurm_array_+3A_slr_job">slr_job</code></td>
<td>
<p>An object of class <code>slurm_job</code>.</p>
</td></tr>
<tr><td><code id="local_slurm_array_+3A_rscript_path">rscript_path</code></td>
<td>
<p>The location of the Rscript command. If not specified, 
defaults to the location of Rscript within the R installation being run.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is most useful for testing your function on a reduced dataset
before submitting the full job to the Slurm cluster.
</p>
<p>Call <code>local_slurm_array</code> on a <code>slurm_job</code> object created with
<code>slurm_apply(..., submit = FALSE)</code> or <code>slurm_map(..., submit = FALSE)</code>.
The job will run serially on the local system rather than being submitted
to the Slurm cluster.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
sjob &lt;- slurm_apply(func, pars, submit = FALSE)
local_slurm_array(sjob)
func_result &lt;- get_slurm_out(sjob, "table") # Loads output data into R.
cleanup_files(sjob)

## End(Not run)
</code></pre>

<hr>
<h2 id='print_job_status'>Deprecated functions in package <span class="pkg">rslurm</span>.</h2><span id='topic+print_job_status'></span><span id='topic+rslurm-deprecated'></span>

<h3>Description</h3>

<p>The functions listed below are deprecated and will be defunct in
the near future. When possible, alternative functions with similar
functionality are also mentioned. Help pages for deprecated functions are
available at <code>help("-deprecated")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>print_job_status(slr_job)
</code></pre>


<h3><code>print_job_status</code></h3>

<p>For <code>print_job_status</code>, use <code><a href="#topic+get_job_status">get_job_status</a></code>.
</p>

<hr>
<h2 id='print_job_status-deprecated'>Prints the status of a Slurm job and, if completed, its console/error output</h2><span id='topic+print_job_status-deprecated'></span>

<h3>Description</h3>

<p>Prints the status of a Slurm job and, if completed, its console/error output.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>print_job_status(slr_job)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print_job_status-deprecated_+3A_slr_job">slr_job</code></td>
<td>
<p>A <code>slurm_job</code> object.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If the specified Slurm job is still in the queue or running, this function
prints its current status (as output by the Slurm <code>squeue</code> command).
The output displays one row by node currently running part of the job (&quot;R&quot; in
the &quot;ST&quot; column) and how long it has been running (&quot;TIME&quot;). One row indicates
the portions of the job still in queue (&quot;PD&quot; in the &quot;ST&quot; column), if any. 
</p>
<p>If all portions of the job have completed or stopped, the function prints the 
console and error output, if any, generated by each node.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rslurm-deprecated">rslurm-deprecated</a></code>
</p>

<hr>
<h2 id='slurm_apply'>Parallel execution of a function on the Slurm cluster</h2><span id='topic+slurm_apply'></span>

<h3>Description</h3>

<p>Use <code>slurm_apply</code> to compute function over multiple sets of
parameters in parallel, spread across multiple nodes of a Slurm cluster,
with similar syntax to <code>mapply</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>slurm_apply(
  f,
  params,
  ...,
  jobname = NA,
  nodes = 2,
  cpus_per_node = 2,
  processes_per_node = cpus_per_node,
  preschedule_cores = TRUE,
  job_array_task_limit = NULL,
  global_objects = NULL,
  add_objects = NULL,
  pkgs = rev(.packages()),
  libPaths = NULL,
  rscript_path = NULL,
  r_template = NULL,
  sh_template = NULL,
  slurm_options = list(),
  submit = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="slurm_apply_+3A_f">f</code></td>
<td>
<p>A function that accepts one or many single values as parameters and
may return any type of R object.</p>
</td></tr>
<tr><td><code id="slurm_apply_+3A_params">params</code></td>
<td>
<p>A data frame of parameter values to apply <code>f</code> to. Each
column corresponds to a parameter of <code>f</code> (<em>Note</em>: names must
match) and each row corresponds to a separate function call.</p>
</td></tr>
<tr><td><code id="slurm_apply_+3A_...">...</code></td>
<td>
<p>Additional arguments to <code>f</code>. These arguments do not vary
with each call to <code>f</code>.</p>
</td></tr>
<tr><td><code id="slurm_apply_+3A_jobname">jobname</code></td>
<td>
<p>The name of the Slurm job; if <code>NA</code>, it is assigned a
random name of the form &quot;slr####&quot;.</p>
</td></tr>
<tr><td><code id="slurm_apply_+3A_nodes">nodes</code></td>
<td>
<p>The (maximum) number of cluster nodes to spread the calculation
over. <code>slurm_apply</code> automatically divides <code>params</code> in chunks of
approximately equal size to send to each node. Less nodes are allocated if
the parameter set is too small to use all CPUs on the requested nodes.</p>
</td></tr>
<tr><td><code id="slurm_apply_+3A_cpus_per_node">cpus_per_node</code></td>
<td>
<p>The number of CPUs requested per node. This argument is
mapped to the Slurm parameter <code>cpus-per-task</code>.</p>
</td></tr>
<tr><td><code id="slurm_apply_+3A_processes_per_node">processes_per_node</code></td>
<td>
<p>The number of logical CPUs to utilize per node,
i.e. how many processes to run in parallel per node. This can exceed
<code>cpus_per_node</code> for nodes which support hyperthreading. Defaults to
<code>processes_per_node = cpus_per_node</code>.</p>
</td></tr>
<tr><td><code id="slurm_apply_+3A_preschedule_cores">preschedule_cores</code></td>
<td>
<p>Corresponds to the <code>mc.preschedule</code> argument of 
<code>parallel::mcmapply</code>. Defaults to <code>TRUE</code>. If <code>TRUE</code>, the 
rows of <code>params</code> are assigned to cores before computation. If <code>FALSE</code>, 
each row of <code>params</code> is executed by the next available core.
Setting <code>FALSE</code> may be faster if 
different values of <code>params</code> result in very variable completion time for
jobs.</p>
</td></tr>
<tr><td><code id="slurm_apply_+3A_job_array_task_limit">job_array_task_limit</code></td>
<td>
<p>The maximum number of job array tasks to run at 
the same time. Defaults to <code>NULL</code> (no limit).</p>
</td></tr>
<tr><td><code id="slurm_apply_+3A_global_objects">global_objects</code></td>
<td>
<p>A character vector containing the name of R objects to be
saved in a .RData file and loaded on each cluster node prior to calling
<code>f</code>.</p>
</td></tr>
<tr><td><code id="slurm_apply_+3A_add_objects">add_objects</code></td>
<td>
<p>Older deprecated name of <code>global_objects</code>, retained for
backwards compatibility.</p>
</td></tr>
<tr><td><code id="slurm_apply_+3A_pkgs">pkgs</code></td>
<td>
<p>A character vector containing the names of packages that must
be loaded on each cluster node. By default, it includes all packages
loaded by the user when <code>slurm_apply</code> is called.</p>
</td></tr>
<tr><td><code id="slurm_apply_+3A_libpaths">libPaths</code></td>
<td>
<p>A character vector describing the location of additional R
library trees to search through, or NULL. The default value of NULL
corresponds to libraries returned by <code>.libPaths()</code> on a cluster node.
Non-existent library trees are silently ignored.</p>
</td></tr>
<tr><td><code id="slurm_apply_+3A_rscript_path">rscript_path</code></td>
<td>
<p>The location of the Rscript command. If not specified, 
defaults to the location of Rscript within the R installation being run.</p>
</td></tr>
<tr><td><code id="slurm_apply_+3A_r_template">r_template</code></td>
<td>
<p>The path to the template file for the R script run on each node. 
If NULL, uses the default template &quot;rslurm/templates/slurm_run_R.txt&quot;.</p>
</td></tr>
<tr><td><code id="slurm_apply_+3A_sh_template">sh_template</code></td>
<td>
<p>The path to the template file for the sbatch submission script. 
If NULL, uses the default template &quot;rslurm/templates/submit_sh.txt&quot;.</p>
</td></tr>
<tr><td><code id="slurm_apply_+3A_slurm_options">slurm_options</code></td>
<td>
<p>A named list of options recognized by <code>sbatch</code>; see
Details below for more information.</p>
</td></tr>
<tr><td><code id="slurm_apply_+3A_submit">submit</code></td>
<td>
<p>Whether or not to submit the job to the cluster with
<code>sbatch</code>; see Details below for more information.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function creates a temporary folder (&quot;_rslurm_[jobname]&quot;) in the current
directory, holding .RData and .RDS data files, the R script to run and the Bash
submission script generated for the Slurm job.
</p>
<p>The set of input parameters is divided in equal chunks sent to each node, and
<code>f</code> is evaluated in parallel within each node using functions from the
<code>parallel</code> R package. The names of any other R objects (besides
<code>params</code>) that <code>f</code> needs to access should be included in
<code>global_objects</code> or passed as additional arguments through <code>...</code>.
</p>
<p>Use <code>slurm_options</code> to set any option recognized by <code>sbatch</code>, e.g.
<code>slurm_options = list(time = "1:00:00", share = TRUE)</code>.
See <a href="http://slurm.schedmd.com/sbatch.html">http://slurm.schedmd.com/sbatch.html</a> for details on possible options.
Note that full names must be used (e.g. &quot;time&quot; rather than &quot;t&quot;) and that flags
(such as &quot;share&quot;) must be specified as TRUE. The &quot;array&quot;, &quot;job-name&quot;, &quot;nodes&quot;, 
&quot;cpus-per-task&quot; and &quot;output&quot; options are already determined by 
<code>slurm_apply</code> and should not be manually set.
</p>
<p>When processing the computation job, the Slurm cluster will output two types
of files in the temporary folder: those containing the return values of the
function for each subset of parameters (&quot;results_[node_id].RDS&quot;) and those
containing any console or error output produced by R on each node
(&quot;slurm_[node_id].out&quot;).
</p>
<p>If <code>submit = TRUE</code>, the job is sent to the cluster and a confirmation
message (or error) is output to the console. If <code>submit = FALSE</code>,
a message indicates the location of the saved data and script files; the
job can be submitted manually by running the shell command
<code>sbatch submit.sh</code> from that directory.
</p>
<p>After sending the job to the Slurm cluster, <code>slurm_apply</code> returns a
<code>slurm_job</code> object which can be used to cancel the job, get the job
status or output, and delete the temporary files associated with it. See
the description of the related functions for more details.
</p>


<h3>Value</h3>

<p>A <code>slurm_job</code> object containing the <code>jobname</code> and the
number of <code>nodes</code> effectively used.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+slurm_call">slurm_call</a></code> to evaluate a single function call.
</p>
<p><code><a href="#topic+slurm_map">slurm_map</a></code> to evaluate a function over a list.
</p>
<p><code><a href="#topic+cancel_slurm">cancel_slurm</a></code>, <code><a href="#topic+cleanup_files">cleanup_files</a></code>,
<code><a href="#topic+get_slurm_out">get_slurm_out</a></code> and <code><a href="#topic+get_job_status">get_job_status</a></code>
which use the output of this function.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
sjob &lt;- slurm_apply(func, pars)
get_job_status(sjob) # Prints console/error output once job is completed.
func_result &lt;- get_slurm_out(sjob, "table") # Loads output data into R.
cleanup_files(sjob)

## End(Not run)
</code></pre>

<hr>
<h2 id='slurm_call'>Execution of a single function call on the Slurm cluster</h2><span id='topic+slurm_call'></span>

<h3>Description</h3>

<p>Use <code>slurm_call</code> to perform a single function evaluation a the Slurm 
cluster.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>slurm_call(
  f,
  params = list(),
  jobname = NA,
  global_objects = NULL,
  add_objects = NULL,
  pkgs = rev(.packages()),
  libPaths = NULL,
  rscript_path = NULL,
  r_template = NULL,
  sh_template = NULL,
  slurm_options = list(),
  submit = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="slurm_call_+3A_f">f</code></td>
<td>
<p>Any R function.</p>
</td></tr>
<tr><td><code id="slurm_call_+3A_params">params</code></td>
<td>
<p>A named list of parameters to pass to <code>f</code>.</p>
</td></tr>
<tr><td><code id="slurm_call_+3A_jobname">jobname</code></td>
<td>
<p>The name of the Slurm job; if <code>NA</code>, it is assigned a 
random name of the form &quot;slr####&quot;.</p>
</td></tr>
<tr><td><code id="slurm_call_+3A_global_objects">global_objects</code></td>
<td>
<p>A character vector containing the name of R objects to be 
saved in a .RData file and loaded on each cluster node prior to calling 
<code>f</code>.</p>
</td></tr>
<tr><td><code id="slurm_call_+3A_add_objects">add_objects</code></td>
<td>
<p>Older deprecated name of <code>global_objects</code>, retained for
backwards compatibility.</p>
</td></tr>
<tr><td><code id="slurm_call_+3A_pkgs">pkgs</code></td>
<td>
<p>A character vector containing the names of packages that must be
loaded on each cluster node. By default, it includes all packages loaded by
the user when <code>slurm_call</code> is called.</p>
</td></tr>
<tr><td><code id="slurm_call_+3A_libpaths">libPaths</code></td>
<td>
<p>A character vector describing the location of additional R
library trees to search through, or NULL. The default value of NULL
corresponds to libraries returned by <code>.libPaths()</code> on a cluster node.
Non-existent library trees are silently ignored.</p>
</td></tr>
<tr><td><code id="slurm_call_+3A_rscript_path">rscript_path</code></td>
<td>
<p>The location of the Rscript command. If not specified, 
defaults to the location of Rscript within the R installation being run.</p>
</td></tr>
<tr><td><code id="slurm_call_+3A_r_template">r_template</code></td>
<td>
<p>The path to the template file for the R script run on each node. 
If NULL, uses the default template &quot;rslurm/templates/slurm_run_single_R.txt&quot;.</p>
</td></tr>
<tr><td><code id="slurm_call_+3A_sh_template">sh_template</code></td>
<td>
<p>The path to the template file for the sbatch submission script. 
If NULL, uses the default template &quot;rslurm/templates/submit_single_sh.txt&quot;.</p>
</td></tr>
<tr><td><code id="slurm_call_+3A_slurm_options">slurm_options</code></td>
<td>
<p>A named list of options recognized by <code>sbatch</code>; see
Details below for more information.</p>
</td></tr>
<tr><td><code id="slurm_call_+3A_submit">submit</code></td>
<td>
<p>Whether or not to submit the job to the cluster with 
<code>sbatch</code>; see Details below for more information.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function creates a temporary folder (&quot;_rslurm_[jobname]&quot;) in the current
directory, holding .RData and .RDS data files, the R script to run and the
Bash submission script generated for the Slurm job.
</p>
<p>The names of any other R objects (besides <code>params</code>) that <code>f</code> needs 
to access should be listed in the <code>global_objects</code> argument.
</p>
<p>Use <code>slurm_options</code> to set any option recognized by <code>sbatch</code>, e.g. 
<code>slurm_options = list(time = "1:00:00", share = TRUE)</code>. See
<a href="http://slurm.schedmd.com/sbatch.html">http://slurm.schedmd.com/sbatch.html</a> for details on possible options. 
Note that full names must be used (e.g. &quot;time&quot; rather than &quot;t&quot;) and that
flags (such as &quot;share&quot;) must be specified as TRUE. The &quot;job-name&quot;, &quot;ntasks&quot; 
and &quot;output&quot; options are already determined by <code>slurm_call</code> and should 
not be manually set.
</p>
<p>When processing the computation job, the Slurm cluster will output two files 
in the temporary folder: one with the return value of the function 
(&quot;results_0.RDS&quot;) and one containing any console or error output produced by
R (&quot;slurm_[node_id].out&quot;).
</p>
<p>If <code>submit = TRUE</code>, the job is sent to the cluster and a confirmation 
message (or error) is output to the console. If <code>submit = FALSE</code>, a
message indicates the location of the saved data and script files; the job
can be submitted manually by running the shell command <code>sbatch
submit.sh</code> from that directory.
</p>
<p>After sending the job to the Slurm cluster, <code>slurm_call</code> returns a 
<code>slurm_job</code> object which can be used to cancel the job, get the job 
status or output, and delete the temporary files associated with it. See the
description of the related functions for more details.
</p>


<h3>Value</h3>

<p>A <code>slurm_job</code> object containing the <code>jobname</code> and the number
of <code>nodes</code> effectively used.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+slurm_apply">slurm_apply</a></code> to parallelize a function over a parameter
set.
</p>
<p><code><a href="#topic+cancel_slurm">cancel_slurm</a></code>, <code><a href="#topic+cleanup_files">cleanup_files</a></code>, 
<code><a href="#topic+get_slurm_out">get_slurm_out</a></code> and <code><a href="#topic+get_job_status">get_job_status</a></code> which use
the output of this function.
</p>

<hr>
<h2 id='slurm_job'>Create a slurm_job object</h2><span id='topic+slurm_job'></span>

<h3>Description</h3>

<p>This function creates a <code>slurm_job</code> object which can be passed to other
functions such as <code><a href="#topic+cancel_slurm">cancel_slurm</a></code>, <code><a href="#topic+cleanup_files">cleanup_files</a></code>, 
<code><a href="#topic+get_slurm_out">get_slurm_out</a></code> and <code><a href="#topic+get_job_status">get_job_status</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>slurm_job(jobname = NULL, jobid = NULL, nodes = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="slurm_job_+3A_jobname">jobname</code></td>
<td>
<p>The name of the Slurm job. The rslurm-generated scripts and 
output files associated with a job should be found in the 
<em>_rslurm_[jobname]</em> folder.</p>
</td></tr>
<tr><td><code id="slurm_job_+3A_jobid">jobid</code></td>
<td>
<p>The id of the Slurm job created by the sbatch command.</p>
</td></tr>
<tr><td><code id="slurm_job_+3A_nodes">nodes</code></td>
<td>
<p>The number of cluster nodes used by that job.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In general, <code>slurm_job</code> objects are created automatically as the output of 
<code><a href="#topic+slurm_apply">slurm_apply</a></code> or <code><a href="#topic+slurm_call">slurm_call</a></code>, but it may be necessary 
to manually recreate one if the job was submitted in a different R session.
</p>


<h3>Value</h3>

<p>A <code>slurm_job</code> object.
</p>

<hr>
<h2 id='slurm_map'>Parallel execution of a function over a list on the Slurm cluster</h2><span id='topic+slurm_map'></span>

<h3>Description</h3>

<p>Use <code>slurm_map</code> to compute function over a list
in parallel, spread across multiple nodes of a Slurm cluster,
with similar syntax to <code>lapply</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>slurm_map(
  x,
  f,
  ...,
  jobname = NA,
  nodes = 2,
  cpus_per_node = 2,
  processes_per_node = cpus_per_node,
  preschedule_cores = TRUE,
  job_array_task_limit = NULL,
  global_objects = NULL,
  pkgs = rev(.packages()),
  libPaths = NULL,
  rscript_path = NULL,
  r_template = NULL,
  sh_template = NULL,
  slurm_options = list(),
  submit = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="slurm_map_+3A_x">x</code></td>
<td>
<p>A list to apply <code>f</code> to. Each
element of <code>x</code> corresponds to a separate function call.</p>
</td></tr>
<tr><td><code id="slurm_map_+3A_f">f</code></td>
<td>
<p>A function that accepts one element of <code>x</code> as its first argument,
and may return any type of R object.</p>
</td></tr>
<tr><td><code id="slurm_map_+3A_...">...</code></td>
<td>
<p>Additional arguments to <code>f</code>. These arguments do not vary
with each call to <code>f</code>.</p>
</td></tr>
<tr><td><code id="slurm_map_+3A_jobname">jobname</code></td>
<td>
<p>The name of the Slurm job; if <code>NA</code>, it is assigned a
random name of the form &quot;slr####&quot;.</p>
</td></tr>
<tr><td><code id="slurm_map_+3A_nodes">nodes</code></td>
<td>
<p>The (maximum) number of cluster nodes to spread the calculation
over. <code>slurm_map</code> automatically divides <code>x</code> in chunks of
approximately equal size to send to each node. Less nodes are allocated if
the parameter set is too small to use all CPUs on the requested nodes.</p>
</td></tr>
<tr><td><code id="slurm_map_+3A_cpus_per_node">cpus_per_node</code></td>
<td>
<p>The number of CPUs requested per node. This argument is
mapped to the Slurm parameter <code>cpus-per-task</code>.</p>
</td></tr>
<tr><td><code id="slurm_map_+3A_processes_per_node">processes_per_node</code></td>
<td>
<p>The number of logical CPUs to utilize per node,
i.e. how many processes to run in parallel per node. This can exceed
<code>cpus_per_node</code> for nodes which support hyperthreading. Defaults to
<code>processes_per_node = cpus_per_node</code>.</p>
</td></tr>
<tr><td><code id="slurm_map_+3A_preschedule_cores">preschedule_cores</code></td>
<td>
<p>Corresponds to the <code>mc.preschedule</code> argument of 
<code>parallel::mclapply</code>. Defaults to <code>TRUE</code>. If <code>TRUE</code>, the 
elements of <code>x</code> are assigned to cores before computation. 
If <code>FALSE</code>, each element of <code>x</code> is executed by the next available core.
Setting <code>FALSE</code> may be faster if 
different elements of <code>x</code> result in very variable completion time for
jobs.</p>
</td></tr>
<tr><td><code id="slurm_map_+3A_job_array_task_limit">job_array_task_limit</code></td>
<td>
<p>The maximum number of job array tasks to run at 
the same time. Defaults to <code>NULL</code> (no limit).</p>
</td></tr>
<tr><td><code id="slurm_map_+3A_global_objects">global_objects</code></td>
<td>
<p>A character vector containing the name of R objects to be
saved in a .RData file and loaded on each cluster node prior to calling
<code>f</code>.</p>
</td></tr>
<tr><td><code id="slurm_map_+3A_pkgs">pkgs</code></td>
<td>
<p>A character vector containing the names of packages that must
be loaded on each cluster node. By default, it includes all packages
loaded by the user when <code>slurm_map</code> is called.</p>
</td></tr>
<tr><td><code id="slurm_map_+3A_libpaths">libPaths</code></td>
<td>
<p>A character vector describing the location of additional R
library trees to search through, or NULL. The default value of NULL
corresponds to libraries returned by <code>.libPaths()</code> on a cluster node.
Non-existent library trees are silently ignored.</p>
</td></tr>
<tr><td><code id="slurm_map_+3A_rscript_path">rscript_path</code></td>
<td>
<p>The location of the Rscript command. If not specified, 
defaults to the location of Rscript within the R installation being run.</p>
</td></tr>
<tr><td><code id="slurm_map_+3A_r_template">r_template</code></td>
<td>
<p>The path to the template file for the R script run on each node. 
If NULL, uses the default template &quot;rslurm/templates/slurm_run_R.txt&quot;.</p>
</td></tr>
<tr><td><code id="slurm_map_+3A_sh_template">sh_template</code></td>
<td>
<p>The path to the template file for the sbatch submission script. 
If NULL, uses the default template &quot;rslurm/templates/submit_sh.txt&quot;.</p>
</td></tr>
<tr><td><code id="slurm_map_+3A_slurm_options">slurm_options</code></td>
<td>
<p>A named list of options recognized by <code>sbatch</code>; see
Details below for more information.</p>
</td></tr>
<tr><td><code id="slurm_map_+3A_submit">submit</code></td>
<td>
<p>Whether or not to submit the job to the cluster with
<code>sbatch</code>; see Details below for more information.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function creates a temporary folder (&quot;_rslurm_[jobname]&quot;) in the current
directory, holding .RData and .RDS data files, the R script to run and the Bash
submission script generated for the Slurm job.
</p>
<p>The set of input parameters is divided in equal chunks sent to each node, and
<code>f</code> is evaluated in parallel within each node using functions from the
<code>parallel</code> R package. The names of any other R objects (besides
<code>x</code>) that <code>f</code> needs to access should be included in
<code>global_objects</code> or passed as additional arguments through <code>...</code>.
</p>
<p>Use <code>slurm_options</code> to set any option recognized by <code>sbatch</code>, e.g.
<code>slurm_options = list(time = "1:00:00", share = TRUE)</code>.
See <a href="http://slurm.schedmd.com/sbatch.html">http://slurm.schedmd.com/sbatch.html</a> for details on possible options.
Note that full names must be used (e.g. &quot;time&quot; rather than &quot;t&quot;) and that flags
(such as &quot;share&quot;) must be specified as TRUE. The &quot;array&quot;, &quot;job-name&quot;, &quot;nodes&quot;, 
&quot;cpus-per-task&quot; and &quot;output&quot; options are already determined by 
<code>slurm_map</code> and should not be manually set.
</p>
<p>When processing the computation job, the Slurm cluster will output two types
of files in the temporary folder: those containing the return values of the
function for each subset of parameters (&quot;results_[node_id].RDS&quot;) and those
containing any console or error output produced by R on each node
(&quot;slurm_[node_id].out&quot;).
</p>
<p>If <code>submit = TRUE</code>, the job is sent to the cluster and a confirmation
message (or error) is output to the console. If <code>submit = FALSE</code>,
a message indicates the location of the saved data and script files; the
job can be submitted manually by running the shell command
<code>sbatch submit.sh</code> from that directory.
</p>
<p>After sending the job to the Slurm cluster, <code>slurm_map</code> returns a
<code>slurm_job</code> object which can be used to cancel the job, get the job
status or output, and delete the temporary files associated with it. See
the description of the related functions for more details.
</p>


<h3>Value</h3>

<p>A <code>slurm_job</code> object containing the <code>jobname</code> and the
number of <code>nodes</code> effectively used.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+slurm_call">slurm_call</a></code> to evaluate a single function call.
</p>
<p><code><a href="#topic+slurm_apply">slurm_apply</a></code> to evaluate a function row-wise over a
data frame of parameters.
</p>
<p><code><a href="#topic+cancel_slurm">cancel_slurm</a></code>, <code><a href="#topic+cleanup_files">cleanup_files</a></code>,
<code><a href="#topic+get_slurm_out">get_slurm_out</a></code> and <code><a href="#topic+get_job_status">get_job_status</a></code>
which use the output of this function.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
sjob &lt;- slurm_map(func, list)
get_job_status(sjob) # Prints console/error output once job is completed.
func_result &lt;- get_slurm_out(sjob, "table") # Loads output data into R.
cleanup_files(sjob)

## End(Not run)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
