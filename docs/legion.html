<!DOCTYPE html><html><head><title>Help for package legion</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {legion}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#auto.vets'><p>Vector ETS-PIC model</p></a></li>
<li><a href='#is.legion'><p>legion classes checkers</p></a></li>
<li><a href='#legion'><p>Legion package</p></a></li>
<li><a href='#oves'><p>Occurrence part of Vector State Space</p></a></li>
<li><a href='#plot.legion'><p>Plots for the fit and states</p></a></li>
<li><a href='#sim.ves'><p>Simulate Vector Exponential Smoothing</p></a></li>
<li><a href='#ves'><p>Vector Exponential Smoothing in SSOE state space model</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Forecasting Using Multivariate Models</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.2</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-01-30</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/config-i1/legion">https://github.com/config-i1/legion</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/config-i1/legion/issues">https://github.com/config-i1/legion/issues</a></td>
</tr>
<tr>
<td>Language:</td>
<td>en-GB</td>
</tr>
<tr>
<td>Description:</td>
<td>Functions implementing multivariate state space models for purposes of time series analysis and forecasting.
             The focus of the package is on multivariate models, such as Vector Exponential Smoothing,
             Vector ETS (Error-Trend-Seasonal model) etc. It currently includes Vector Exponential
             Smoothing (VES, de Silva et al., 2010, &lt;<a href="https://doi.org/10.1177%2F1471082X0901000401">doi:10.1177/1471082X0901000401</a>&gt;), Vector ETS and
             simulation function for VES.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0), greybox (&ge; 1.0.4), smooth (&ge; 3.1.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>Rcpp (&ge; 0.12.3), stats, generics (&ge; 0.1.2), graphics,
grDevices, nloptr, utils, zoo</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo (&ge; 0.8.100.0.0)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>numDeriv, testthat, knitr, rmarkdown, doMC, doParallel,
foreach</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.1</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-01-30 22:07:42 UTC; config</td>
</tr>
<tr>
<td>Author:</td>
<td>Ivan Svetunkov [aut, cre] (Lecturer at Centre for Marketing Analytics
    and Forecasting, Lancaster University, UK),
  Kandrika Fadhlan Pritularga [aut] (PhD Student at Centre for Marketing
    Analytics and Forecasting, Lancaster University, UK)</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Ivan Svetunkov &lt;ivan@svetunkov.ru&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-01-31 09:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='auto.vets'>Vector ETS-PIC model</h2><span id='topic+auto.vets'></span><span id='topic+vets'></span>

<h3>Description</h3>

<p>Function constructs vector ETS model based on VETS-PIC taxonomy and returns
forecast, fitted values, errors and matrix of states along with other useful variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>auto.vets(data, model = "PPP", lags = c(frequency(data)),
  loss = c("likelihood", "diagonal", "trace"), ic = c("AICc", "AIC", "BIC",
  "BICc"), h = 10, holdout = FALSE, occurrence = c("none", "fixed",
  "logistic"), bounds = c("admissible", "usual", "none"), silent = TRUE,
  parallel = FALSE, ...)

vets(data, model = "PPP", lags = c(frequency(data)),
  parameters = c("level", "trend", "seasonal", "damped"),
  initials = c("seasonal"), components = c("none"),
  loss = c("likelihood", "diagonal", "trace"), ic = c("AICc", "AIC", "BIC",
  "BICc"), h = 10, holdout = FALSE, occurrence = c("none", "fixed",
  "logistic"), bounds = c("admissible", "usual", "none"), silent = TRUE,
  ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="auto.vets_+3A_data">data</code></td>
<td>
<p>The matrix with the data, where series are in columns and
observations are in rows.</p>
</td></tr>
<tr><td><code id="auto.vets_+3A_model">model</code></td>
<td>
<p>The type of ETS model. Can consist of 3 or 4 chars: <code>ANN</code>,
<code>AAN</code>, <code>AAdN</code>, <code>AAA</code>, <code>AAdA</code>, <code>MMdM</code> etc.
<code>PPP</code> means that the best pure model will be selected based on the chosen
information criteria type.
ATTENTION! ONLY PURE ADDITIVE AND PURE MULTIPLICATIVE MODELS ARE
AVAILABLE!
Pure multiplicative models are done as additive model applied to log(y).
</p>
<p>Also <code>model</code> can accept a previously estimated VETS model and use all its
parameters.</p>
</td></tr>
<tr><td><code id="auto.vets_+3A_lags">lags</code></td>
<td>
<p>The lags of the model. Needed for seasonal models.</p>
</td></tr>
<tr><td><code id="auto.vets_+3A_loss">loss</code></td>
<td>
<p>Type of Loss Function used in optimization. <code>loss</code> can
be:
</p>

<ul>
<li> <p><code>"likelihood"</code> - which implies the maximisation of likelihood of
multivariate normal distribution (or log Normal if the multiplicative model
is constructed);
</p>
</li>
<li> <p><code>"diagonal"</code> - similar to <code>"likelihood"</code>, but assumes that
covariances between the error terms are zero.
</p>
</li>
<li> <p><code>"trace"</code> - the trace of the covariance matrix of errors.
The sum of variances is minimised in this case.
</p>
</li>
<li><p> Provided by user as a custom function of <code>actual</code>, <code>fitted</code> and
<code>B</code>. Note that internally function transposes the data, so that <code>actual</code>
and <code>fitted</code> contain observations in columns and series in rows.
</p>
</li></ul>

<p>An example of the latter option is:
<code>lossFunction &lt;- function(actual,fitted,B){return(mean(abs(actual - fitted)))}</code>
followed by <code>loss=lossFunction</code>.</p>
</td></tr>
<tr><td><code id="auto.vets_+3A_ic">ic</code></td>
<td>
<p>The information criterion used in the model selection procedure.</p>
</td></tr>
<tr><td><code id="auto.vets_+3A_h">h</code></td>
<td>
<p>Length of forecasting horizon.</p>
</td></tr>
<tr><td><code id="auto.vets_+3A_holdout">holdout</code></td>
<td>
<p>If <code>TRUE</code>, holdout sample of size <code>h</code> is taken from
the end of the data.</p>
</td></tr>
<tr><td><code id="auto.vets_+3A_occurrence">occurrence</code></td>
<td>
<p>Defines type of occurrence model used. Can be:
</p>

<ul>
<li> <p><code>none</code>, meaning that the data should be considered as non-intermittent;
</p>
</li>
<li> <p><code>fixed</code>, taking into account constant Bernoulli distribution of
demand occurrences;
</p>
</li>
<li> <p><code>logistic</code>, based on logistic regression.
</p>
</li></ul>

<p>In this case, the ETS model inside the occurrence part will correspond to
<code>model</code> and <code>probability="dependent"</code>.
Alternatively, model estimated using <a href="#topic+oves">oves</a> function can be provided
here.</p>
</td></tr>
<tr><td><code id="auto.vets_+3A_bounds">bounds</code></td>
<td>
<p>What type of bounds to use in the model estimation. The first
letter can be used instead of the whole word. <code>"admissible"</code> means that the
model stability is ensured, while <code>"usual"</code> means that the all the parameters
are restricted by the (0, 1) region.</p>
</td></tr>
<tr><td><code id="auto.vets_+3A_silent">silent</code></td>
<td>
<p>If <code>silent="none"</code>, then nothing is silent, everything is
printed out and drawn. <code>silent="all"</code> means that nothing is produced or
drawn (except for warnings). In case of <code>silent="graph"</code>, no graph is
produced. If <code>silent="legend"</code>, then legend of the graph is skipped.
And finally <code>silent="output"</code> means that nothing is printed out in the
console, but the graph is produced. <code>silent</code> also accepts <code>TRUE</code>
and <code>FALSE</code>. In this case <code>silent=TRUE</code> is equivalent to
<code>silent="all"</code>, while <code>silent=FALSE</code> is equivalent to
<code>silent="none"</code>. The parameter also accepts first letter of words (&quot;n&quot;,
&quot;a&quot;, &quot;g&quot;, &quot;l&quot;, &quot;o&quot;).</p>
</td></tr>
<tr><td><code id="auto.vets_+3A_parallel">parallel</code></td>
<td>
<p>If TRUE, the estimation of ADAM models is done in parallel (used in <code>auto.adam</code> only).
If the number is provided (e.g. <code>parallel=41</code>), then the specified number of cores is set up.
WARNING! Packages <code>foreach</code> and either <code>doMC</code> (Linux and Mac only)
or <code>doParallel</code> are needed in order to run the function in parallel.</p>
</td></tr>
<tr><td><code id="auto.vets_+3A_...">...</code></td>
<td>
<p>Other non-documented parameters. For example <code>FI=TRUE</code> will
make the function also produce Fisher Information matrix, which then can be
used to calculated variances of smoothing parameters and initial states of
the model. The vector of initial parameter for the optimiser can be provided
here as the variable <code>B</code>. The upper bound for the optimiser is provided
via <code>ub</code>, while the lower one is <code>lb</code>. Also, the options for nloptr can be
passed here:
</p>

<ul>
<li> <p><code>maxeval=40*k</code> is the default number of iterations for both optimisers
used in the function (k is the number of parameters to estimate).
</p>
</li>
<li> <p><code>algorithm1="NLOPT_LN_BOBYQA"</code> is the algorithm used in the first
optimiser, while <code>algorithm2="NLOPT_LN_NELDERMEAD"</code> is the second one.
</p>
</li>
<li> <p><code>xtol_rel1=1e-8</code> is the relative tolerance in the first optimiser,
while <code>xtol_rel2=1e-6</code> is for the second one. All of this can be amended and
passed in ellipsis for finer tuning.
</p>
</li>
<li> <p><code>print_level</code> - the level of output for the optimiser (0 by default).
If equal to 41, then the detailed results of the optimisation are returned.</p>
</li></ul>
</td></tr>
<tr><td><code id="auto.vets_+3A_parameters">parameters</code></td>
<td>
<p>The character vector, specifying, which of the parameters
should be common between time series. This includes smoothing parameters for
<code>"level"</code>, <code>"trend"</code>, <code>"seasonal"</code> components and <code>"damped"</code>
trend parameter. If <code>parameters="none"</code>, then all parameters are set to be
individual. An example is the model with all parameters being common:
<code>parameters=c("level","trend","seasonal","damped")</code>. The order is not important
and the first letters can be used instead of the full words as well.</p>
</td></tr>
<tr><td><code id="auto.vets_+3A_initials">initials</code></td>
<td>
<p>The character vector, specifying, which of the initial values of
components should be common. This can be <code>"level"</code>, <code>"trend"</code> and / or
<code>"seasonal"</code>, setting initials of respective components to be common. This
can also be <code>"none"</code>, making the initials individual for all series. An
example is the model with only seasonal initials being common:
<code>initials="seasonal"</code>. The order is not important, and the first letters can
be used instead of the full words.</p>
</td></tr>
<tr><td><code id="auto.vets_+3A_components">components</code></td>
<td>
<p>The character vector, specifying, which of the components
components should be shared between time series. This can be <code>"level"</code>,
<code>"trend"</code> and / or <code>"seasonal"</code>, setting respective components to be
shared. This can also be <code>"none"</code>, making them individual for all series.
The order is not important, and the first letters can be used instead of the full
words. Please, note that making components common automatically sets the
respective <code>initials</code> common as well.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function estimates vector ETS in the form of the Single Source of Error state space
model of the following type:
</p>
<p style="text-align: center;"><code class="reqn">
\mathbf{y}_{t} = \mathbf{o}_{t} (\mathbf{W} \mathbf{v}_{t-l} + \mathbf{x}_t
\mathbf{a}_{t-1} + \mathbf{\epsilon}_{t})
</code>
</p>

<p style="text-align: center;"><code class="reqn">
\mathbf{v}_{t} = \mathbf{F} \mathbf{v}_{t-l} + \mathbf{G}
\mathbf{\epsilon}_{t}
</code>
</p>

<p style="text-align: center;"><code class="reqn">\mathbf{a}_{t} = \mathbf{F_{X}} \mathbf{a}_{t-1} + \mathbf{G_{X}}
\mathbf{\epsilon}_{t} / \mathbf{x}_{t}</code>
</p>

<p>Where <code class="reqn">y_{t}</code> is the vector of time series on observation <code class="reqn">t</code>, <code class="reqn">o_{t}</code>
is the vector of Bernoulli distributed random variable (in case of normal data it
becomes unit vector for all observations), <code class="reqn">\mathbf{v}_{t}</code> is the matrix of
states and <code class="reqn">l</code> is the matrix of lags, <code class="reqn">\mathbf{x}_t</code> is the vector of
exogenous variables. <code class="reqn">\mathbf{W}</code> is the measurement matrix, <code class="reqn">\mathbf{F}</code>
is the transition matrix and <code class="reqn">\mathbf{G}</code> is the persistence matrix.
Finally, <code class="reqn">\epsilon_{t}</code> is the vector of error terms.
</p>
<p>Conventionally we formulate values as:
</p>
<p style="text-align: center;"><code class="reqn">\mathbf{y}'_t = (y_{1,t}, y_{2,t}, \dots, y_{m,t})</code>
</p>

<p>where <code class="reqn">m</code> is the number of series in the group.
</p>
<p style="text-align: center;"><code class="reqn">\mathbf{v}'_t = (v_{1,t}, v_{2,t}, \dots, v_{m,t})</code>
</p>

<p>where <code class="reqn">v_{i,t}</code> is vector of components for i-th time series.
</p>
<p style="text-align: center;"><code class="reqn">\mathbf{W}' = (w_{1}, \dots , 0;
\vdots , \ddots , \vdots;
0 , \vdots , w_{m})</code>
</p>
<p> is matrix of measurement vectors.
</p>
<p>The main idea of the function is in imposing restrictions on parameters / initials /
components of the model in order to capture the common dynamics between series.
</p>
<p>In case of multiplicative model, instead of the vector y_t we use its logarithms.
As a result the multiplicative model is much easier to work with.
</p>
<p>For some more information about the model and its implementation, see the
vignette: <code>vignette("vets","legion")</code>
</p>


<h3>Value</h3>

<p>Object of class &quot;legion&quot; is returned. It contains the following list of
values:
</p>

<ul>
<li> <p><code>model</code> - The name of the fitted model;
</p>
</li>
<li> <p><code>timeElapsed</code> - The time elapsed for the construction of the model;
</p>
</li>
<li> <p><code>states</code> - The matrix of states with components in columns and time in rows;
</p>
</li>
<li> <p><code>persistence</code> - The persistence matrix;
</p>
</li>
<li> <p><code>transition</code> - The transition matrix;
</p>
</li>
<li> <p><code>measurement</code> - The measurement matrix;
</p>
</li>
<li> <p><code>phi</code> - The damping parameter value;
</p>
</li>
<li> <p><code>B</code> - The vector of all the estimated coefficients;
</p>
</li>
<li> <p><code>lagsAll</code> - The vector of the internal lags used in the model;
</p>
</li>
<li> <p><code>nParam</code> - The number of estimated parameters;
</p>
</li>
<li> <p><code>occurrence</code> - The occurrence model estimated with VETS;
</p>
</li>
<li> <p><code>data</code> - The matrix with the original data;
</p>
</li>
<li> <p><code>fitted</code> - The matrix of the fitted values;
</p>
</li>
<li> <p><code>holdout</code> - The matrix with the holdout values (if <code>holdout=TRUE</code> in
the estimation);
</p>
</li>
<li> <p><code>residuals</code> - The matrix of the residuals of the model;
</p>
</li>
<li> <p><code>Sigma</code> - The covariance matrix of the errors (estimated with the correction
for the number of degrees of freedom);
</p>
</li>
<li> <p><code>forecast</code> - The matrix of point forecasts;
</p>
</li>
<li> <p><code>ICs</code> - The values of the information criteria;
</p>
</li>
<li> <p><code>logLik</code> - The log-likelihood function;
</p>
</li>
<li> <p><code>lossValue</code> - The value of the loss function;
</p>
</li>
<li> <p><code>loss</code> - The type of the used loss function;
</p>
</li>
<li> <p><code>lossFunction</code> - The loss function if the custom was used in the process;
</p>
</li>
<li> <p><code>accuracy</code> - the values of the error measures. Currently not available.
</p>
</li>
<li> <p><code>FI</code> - Fisher information if user asked for it using <code>FI=TRUE</code>.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Ivan Svetunkov, <a href="mailto:ivan@svetunkov.ru">ivan@svetunkov.ru</a>
</p>


<h3>References</h3>


<ul>
<li><p> de Silva A., Hyndman R.J. and Snyder, R.D. (2010). The vector
innovations structural time series framework: a simple approach to
multivariate forecasting. Statistical Modelling, 10 (4), pp.353-374
</p>
</li>
<li><p> Hyndman, R.J., Koehler, A.B., Ord, J.K., and Snyder, R.D. (2008)
Forecasting with exponential smoothing: the state space approach,
Springer-Verlag.
</p>
</li>
<li><p> Lütkepohl, H. (2005). New Introduction to Multiple Time Series
Analysis. New introduction to Multiple Time Series Analysis. Berlin,
Heidelberg: Springer Berlin Heidelberg.
<a href="https://doi.org/10.1007/978-3-540-27752-1">doi:10.1007/978-3-540-27752-1</a>
</p>
</li>
<li><p> Chen H., Svetunkov I., Boylan J. (2021). A New Taxonomy for
Vector Exponential Smoothing and Its Application to Seasonal Time
Series.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+ves">ves</a>, <a href="smooth.html#topic+es">es</a>, <a href="smooth.html#topic+adam">adam</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
Y &lt;- ts(cbind(rnorm(100,100,10),rnorm(100,75,8)),frequency=12)

# The simplest model applied to the data with the default values
vets(Y,model="ANN",h=10,holdout=TRUE)

# Multiplicative damped trend model with common parameters
# and initial seasonal indices
vets(Y,model="MMdM",h=10,holdout=TRUE,parameters=c("l","t","s","d"),
     initials="seasonal")

# Automatic selection of ETS components
vets(Y, model="PPP", h=10, holdout=TRUE, initials="seasonal")

</code></pre>

<hr>
<h2 id='is.legion'>legion classes checkers</h2><span id='topic+is.legion'></span><span id='topic+is.oves'></span><span id='topic+is.legion.sim'></span>

<h3>Description</h3>

<p>Functions to check if an object is of the specified class
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is.legion(x)

is.oves(x)

is.legion.sim(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is.legion_+3A_x">x</code></td>
<td>
<p>The object to check.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The list of methods includes:
</p>

<ul>
<li> <p><code>is.legion()</code> tests if the object was produced by a vector model (e.g.
<a href="#topic+ves">ves</a>);
</p>
</li>
<li> <p><code>is.oves()</code> tests if the object was produced by <a href="#topic+oves">oves</a>
function;
</p>
</li>
<li> <p><code>is.legion.sim()</code> tests if the object was produced by the functions
<a href="#topic+sim.ves">sim.ves</a>;
</p>
</li></ul>



<h3>Value</h3>

<p><code>TRUE</code> if this is the specified class and <code>FALSE</code> otherwise.
</p>


<h3>Author(s)</h3>

<p>Ivan Svetunkov, <a href="mailto:ivan@svetunkov.ru">ivan@svetunkov.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
ourModel &lt;- ves(cbind(rnorm(100,100,10),rnorm(100,100,10)))

is.legion(ourModel)

</code></pre>

<hr>
<h2 id='legion'>Legion package</h2><span id='topic+legion'></span>

<h3>Description</h3>

<p>Package contains functions for multivariate time series forecasting
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;"> Package: </td><td style="text-align: left;"> legion</td>
</tr>
<tr>
 <td style="text-align: left;"> Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;"> Date: </td><td style="text-align: left;">
2021-02-18 - Inf</td>
</tr>
<tr>
 <td style="text-align: left;"> License: </td><td style="text-align: left;"> GPL-2 </td>
</tr>
<tr>
 <td style="text-align: left;"> </td>
</tr>

</table>
<p> The following functions are
included in the package:
</p>

<ul>
<li> <p><a href="#topic+ves">ves</a> - Vector Exponential Smoothing.
</p>
</li>
<li> <p><a href="#topic+vets">vets</a> - Vector ETS-PIC model.
</p>
</li>
<li> <p><a href="#topic+oves">oves</a> - Multivariate occurrence ETS model.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Ivan Svetunkov
</p>
<p>Kandrika Pritularga
</p>
<p>Maintainer: Ivan Svetunkov &lt;ivan@svetunkov.ru&gt;
</p>


<h3>References</h3>


<ul>
<li><p> de Silva A., Hyndman R.J. and Snyder, R.D. (2010). The vector
innovations structural time series framework: a simple approach to
multivariate forecasting. Statistical Modelling, 10 (4), pp.353-374
</p>
</li>
<li><p> Hyndman, R.J., Koehler, A.B., Ord, J.K., and Snyder, R.D. (2008)
Forecasting with exponential smoothing: the state space approach,
Springer-Verlag.
</p>
</li>
<li><p> Lütkepohl, H. (2005). New Introduction to Multiple Time Series
Analysis. New introduction to Multiple Time Series Analysis. Berlin,
Heidelberg: Springer Berlin Heidelberg.
<a href="https://doi.org/10.1007/978-3-540-27752-1">doi:10.1007/978-3-540-27752-1</a>
</p>
</li>
<li><p> Chen H., Svetunkov I., Boylan J. (2021). A New Taxonomy for
Vector Exponential Smoothing and Its Application to Seasonal Time
Series.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="generics.html#topic+forecast">forecast</a>, <a href="smooth.html#topic+es">es</a>, <a href="smooth.html#topic+adam">adam</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: y &lt;- cbind(rnorm(100,10,3),rnorm(100,10,3))

ves(y,h=20,holdout=TRUE)
## End(Not run)

</code></pre>

<hr>
<h2 id='oves'>Occurrence part of Vector State Space</h2><span id='topic+oves'></span>

<h3>Description</h3>

<p>Function calculates the probability for the occurrence part of vector state space model.
This is needed in order to forecast intermittent demand using other functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>oves(data, occurrence = c("logistic", "none", "fixed"), ic = c("AICc",
  "AIC", "BIC", "BICc"), h = 10, holdout = FALSE,
  probability = c("dependent", "independent"), model = "ANN",
  persistence = NULL, transition = NULL, phi = NULL, initial = NULL,
  initialSeason = NULL, xreg = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="oves_+3A_data">data</code></td>
<td>
<p>The matrix with data, where series are in columns and
observations are in rows.</p>
</td></tr>
<tr><td><code id="oves_+3A_occurrence">occurrence</code></td>
<td>
<p>Type of method used in probability estimation. Can be
<code>"none"</code> - none, <code>"fixed"</code> - constant probability or
<code>"logistic"</code> - probability based on logit model.</p>
</td></tr>
<tr><td><code id="oves_+3A_ic">ic</code></td>
<td>
<p>Information criteria to use in case of model selection.</p>
</td></tr>
<tr><td><code id="oves_+3A_h">h</code></td>
<td>
<p>Forecast horizon.</p>
</td></tr>
<tr><td><code id="oves_+3A_holdout">holdout</code></td>
<td>
<p>If <code>TRUE</code>, holdout sample of size <code>h</code> is taken from
the end of the data.</p>
</td></tr>
<tr><td><code id="oves_+3A_probability">probability</code></td>
<td>
<p>Type of probability assumed in the model. If
<code>"dependent"</code>, then it is assumed that occurrence of one variable is
connected with the occurrence with another one. In case of <code>"independent"</code>
the occurrence of the variables is assumed to happen independent of each
other.</p>
</td></tr>
<tr><td><code id="oves_+3A_model">model</code></td>
<td>
<p>Type of ETS model used for the estimation. Normally this should
be either <code>"ANN"</code> or <code>"MNN"</code>. If you assume that there are some
tendencies in occurrence, then you can use more complicated models. Model
selection is not yet available.</p>
</td></tr>
<tr><td><code id="oves_+3A_persistence">persistence</code></td>
<td>
<p>Persistence matrix type. If <code>NULL</code>, then it is estimated.
See <a href="#topic+ves">ves</a> for the details.</p>
</td></tr>
<tr><td><code id="oves_+3A_transition">transition</code></td>
<td>
<p>Transition matrix type. If <code>NULL</code>, then it is estimated.
See <a href="#topic+ves">ves</a> for the details.</p>
</td></tr>
<tr><td><code id="oves_+3A_phi">phi</code></td>
<td>
<p>Damping parameter type. If <code>NULL</code>, then it is estimated.
See <a href="#topic+ves">ves</a> for the details.</p>
</td></tr>
<tr><td><code id="oves_+3A_initial">initial</code></td>
<td>
<p>Initial vector type. If <code>NULL</code>, then it is estimated.
See <a href="#topic+ves">ves</a> for the details.</p>
</td></tr>
<tr><td><code id="oves_+3A_initialseason">initialSeason</code></td>
<td>
<p>Type of the initial vector of seasonal components.
If <code>NULL</code>, then it is estimated. See <a href="#topic+ves">ves</a> for the details.</p>
</td></tr>
<tr><td><code id="oves_+3A_xreg">xreg</code></td>
<td>
<p>Vector of matrix of exogenous variables, explaining some parts
of occurrence variable (probability).</p>
</td></tr>
<tr><td><code id="oves_+3A_...">...</code></td>
<td>
<p>Other parameters. This is not needed for now.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function estimates probability of demand occurrence, using one of the VES
state-space models.
</p>


<h3>Value</h3>

<p>The object of class &quot;oves&quot; is returned. It contains following list of
values:
</p>

<ul>
<li> <p><code>model</code> - the type of the estimated ETS model;
</p>
</li>
<li> <p><code>fitted</code> - fitted values of the constructed model;
</p>
</li>
<li> <p><code>forecast</code> - forecast for <code>h</code> observations ahead;
</p>
</li>
<li> <p><code>states</code> - values of states (currently level only);
</p>
</li>
<li> <p><code>variance</code> - conditional variance of the forecast;
</p>
</li>
<li> <p><code>logLik</code> - likelihood value for the model
</p>
</li>
<li> <p><code>nParam</code> - number of parameters used in the model;
</p>
</li>
<li> <p><code>residuals</code> - residuals of the model;
</p>
</li>
<li> <p><code>data</code> - actual values of probabilities (zeros and ones).
</p>
</li>
<li> <p><code>persistence</code> - the vector of smoothing parameters;
</p>
</li>
<li> <p><code>initial</code> - initial values of the state vector;
</p>
</li>
<li> <p><code>initialSeason</code> - the matrix of initials seasonal states;
</p>
</li>
<li> <p><code>occurrence</code> - type of occurrence model used;
</p>
</li>
<li> <p><code>probability</code> - type of probability used;
</p>
</li>
<li> <p><code>issModel</code> - intermittent state-space model used for
calculations. Useful only in the case of <code>occurrence="l"</code> and
<code>probability="d"</code>.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Ivan Svetunkov, <a href="mailto:ivan@svetunkov.ru">ivan@svetunkov.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="smooth.html#topic+oes">oes</a>, <a href="#topic+ves">ves</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
Y &lt;- cbind(c(rpois(25,0.1),rpois(25,0.5),rpois(25,1),rpois(25,5)),
           c(rpois(25,0.1),rpois(25,0.5),rpois(25,1),rpois(25,5)))

oves(Y, occurrence="l")
oves(Y, occurrence="l", probability="i")

</code></pre>

<hr>
<h2 id='plot.legion'>Plots for the fit and states</h2><span id='topic+plot.legion'></span>

<h3>Description</h3>

<p>The function produces diagnostics plots for a <code>legion</code> model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'legion'
plot(x, which = c(1, 2, 4, 6), level = 0.95,
  legend = FALSE, ask = prod(par("mfcol")) &lt; length(which) * nvariate(x) &amp;&amp;
  dev.interactive(), lowess = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.legion_+3A_x">x</code></td>
<td>
<p>Estimated legion model.</p>
</td></tr>
<tr><td><code id="plot.legion_+3A_which">which</code></td>
<td>
<p>Which of the plots to produce. The possible options (see details for explanations):
</p>

<ol>
<li><p> Actuals vs Fitted values;
</p>
</li>
<li><p> Standardised residuals vs Fitted;
</p>
</li>
<li><p> Studentised residuals vs Fitted;
</p>
</li>
<li><p> Absolute residuals vs Fitted;
</p>
</li>
<li><p> Squared residuals vs Fitted;
</p>
</li>
<li><p> Q-Q plot with the specified distribution;
</p>
</li>
<li><p> Fitted over time;
</p>
</li>
<li><p> Standardised residuals vs Time;
</p>
</li>
<li><p> Studentised residuals vs Time;
</p>
</li>
<li><p> ACF of the residuals;
</p>
</li>
<li><p> PACF of the residuals.
</p>
</li>
<li><p> Plot of states of the model.
</p>
</li></ol>
</td></tr>
<tr><td><code id="plot.legion_+3A_level">level</code></td>
<td>
<p>Confidence level. Defines width of confidence interval. Used in plots (2), (3), (7), (8),
(9), (10) and (11).</p>
</td></tr>
<tr><td><code id="plot.legion_+3A_legend">legend</code></td>
<td>
<p>If <code>TRUE</code>, then the legend is produced on plots (2), (3) and (7).</p>
</td></tr>
<tr><td><code id="plot.legion_+3A_ask">ask</code></td>
<td>
<p>Logical; if <code>TRUE</code>, the user is asked to press Enter before each plot.</p>
</td></tr>
<tr><td><code id="plot.legion_+3A_lowess">lowess</code></td>
<td>
<p>Logical; if <code>TRUE</code>, LOWESS lines are drawn on scatterplots, see <a href="stats.html#topic+lowess">lowess</a>.</p>
</td></tr>
<tr><td><code id="plot.legion_+3A_...">...</code></td>
<td>
<p>The parameters passed to the plot functions. Recommended to use with separate plots.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The list of produced plots includes:
</p>

<ol>
<li><p> Actuals vs Fitted values. Allows analysing, whether there are any issues in the fit.
Does the variability of actuals increase with the increase of fitted values? Is the relation
well captured? They grey line on the plot corresponds to the perfect fit of the model.
</p>
</li>
<li><p> Standardised residuals vs Fitted. Plots the points and the confidence bounds
(red lines) for the specified confidence <code>level</code>. Useful for the analysis of outliers;
</p>
</li>
<li><p> Studentised residuals vs Fitted. This is similar to the previous plot, but with the
residuals divided by the scales with the leave-one-out approach. Should be more sensitive
to outliers;
</p>
</li>
<li><p> Absolute residuals vs Fitted. Useful for the analysis of heteroscedasticity;
</p>
</li>
<li><p> Squared residuals vs Fitted - similar to (3), but with squared values;
</p>
</li>
<li><p> Q-Q plot with the specified distribution. Can be used in order to see if the
residuals follow the assumed distribution. The type of distribution depends on the one used
in the estimation (see <code>distribution</code> parameter in <a href="greybox.html#topic+alm">alm</a>);
</p>
</li>
<li><p> ACF of the residuals. Are the residuals autocorrelated? See <a href="stats.html#topic+acf">acf</a> for
details;
</p>
</li>
<li><p> Fitted over time. Plots actuals (black line), fitted values (purple line), point forecast
(blue line) and prediction interval (grey lines). Can be used in order to make sure that the model
did not miss any important events over time;
</p>
</li>
<li><p> Standardised residuals vs Time. Useful if you want to see, if there is autocorrelation or
if there is heteroscedasticity in time. This also shows, when the outliers happen;
</p>
</li>
<li><p> Studentised residuals vs Time. Similar to previous, but with studentised residuals;
</p>
</li>
<li><p> PACF of the residuals. No, really, are they autocorrelated? See pacf function from stats
package for details;
</p>
</li>
<li><p> Plot of the states of the model. It is not recommended to produce this plot together with
the others, because there might be several states, which would cause the creation of a different
canvas. In case of &quot;msdecompose&quot;, this will produce the decomposition of the series into states
on a different canvas.
</p>
</li></ol>

<p>Which of the plots to produce, is specified via the <code>which</code> parameter.
Currently only <code>which=c(1,4:7)</code> are supported.
</p>


<h3>Value</h3>

<p>The function produces the number of plots, specified in the parameter <code>which</code>.
</p>


<h3>Author(s)</h3>

<p>Ivan Svetunkov, <a href="mailto:ivan@svetunkov.ru">ivan@svetunkov.ru</a>
</p>


<h3>See Also</h3>

<p><a href="greybox.html#topic+plot.greybox">plot.greybox</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
ourModel &lt;- es(c(rnorm(50,100,10),rnorm(50,120,10)), "ANN", h=10)
plot(ourModel, c(1:11))
plot(ourModel, 12)

</code></pre>

<hr>
<h2 id='sim.ves'>Simulate Vector Exponential Smoothing</h2><span id='topic+sim.ves'></span>

<h3>Description</h3>

<p>Function generates data using VES model as a data generating process.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim.ves(model = "ANN", obs = 10, nsim = 1, nvariate = 2,
  frequency = 1, persistence = NULL, phi = 1, transition = NULL,
  initial = NULL, initialSeason = NULL,
  seasonal = c("individual, common"), weights = rep(1/nvariate, nvariate),
  bounds = c("usual", "admissible", "restricted"), randomizer = c("rnorm",
  "rt", "rlaplace", "rs"), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sim.ves_+3A_model">model</code></td>
<td>
<p>Type of ETS model. This can consist of 3 or 4 chars:
<code>ANN</code>, <code>AAN</code>, <code>AAdN</code>, <code>AAA</code>, <code>AAdA</code> etc.
Only pure additive models are supported. If you want to have multiplicative
one, then just take exponent of the generated data.</p>
</td></tr>
<tr><td><code id="sim.ves_+3A_obs">obs</code></td>
<td>
<p>Number of observations in each generated time series.</p>
</td></tr>
<tr><td><code id="sim.ves_+3A_nsim">nsim</code></td>
<td>
<p>Number of series to generate (number of simulations to do).</p>
</td></tr>
<tr><td><code id="sim.ves_+3A_nvariate">nvariate</code></td>
<td>
<p>Number of series in each generated group of series.</p>
</td></tr>
<tr><td><code id="sim.ves_+3A_frequency">frequency</code></td>
<td>
<p>Frequency of generated data. In cases of seasonal models
must be greater than 1.</p>
</td></tr>
<tr><td><code id="sim.ves_+3A_persistence">persistence</code></td>
<td>
<p>Matrix of smoothing parameters for all the components
of all the generated time series.</p>
</td></tr>
<tr><td><code id="sim.ves_+3A_phi">phi</code></td>
<td>
<p>Value of damping parameter. If trend is not chosen in the model,
the parameter is ignored. If vector is provided, then several parameters
are used for different series.</p>
</td></tr>
<tr><td><code id="sim.ves_+3A_transition">transition</code></td>
<td>
<p>Transition matrix. This should have the size appropriate
to the selected model and <code>nvariate</code>. e.g. if ETS(A,A,N) is selected
and <code>nvariate=3</code>, then the transition matrix should be 6 x 6. In case
of damped trend, the phi parameter should be placed in the matrix manually.
if <code>NULL</code>, then the default transition matrix for the selected type
of model is used. If both <code>phi</code> and <code>transition</code> are provided,
then the value of <code>phi</code> is ignored.</p>
</td></tr>
<tr><td><code id="sim.ves_+3A_initial">initial</code></td>
<td>
<p>Vector of initial states of level and trend. The minimum
length is one (in case of ETS(A,N,N), the initial is used for all the
series), the maximum length is 2 x nvariate. If <code>NULL</code>, values are
generated for each series.</p>
</td></tr>
<tr><td><code id="sim.ves_+3A_initialseason">initialSeason</code></td>
<td>
<p>Vector or matrix of initial states for seasonal
coefficients. Should have number of rows equal to <code>frequency</code>
parameter. If <code>NULL</code>, values are generated for each series.</p>
</td></tr>
<tr><td><code id="sim.ves_+3A_seasonal">seasonal</code></td>
<td>
<p>The type of seasonal component across the series. Can be
<code>"individual"</code>, so that each series has its own component or <code>"common"</code>,
so that the component is shared across the series.</p>
</td></tr>
<tr><td><code id="sim.ves_+3A_weights">weights</code></td>
<td>
<p>The weights for the errors between the series with the common
seasonal component. Ignored if <code>seasonal="individual"</code>.</p>
</td></tr>
<tr><td><code id="sim.ves_+3A_bounds">bounds</code></td>
<td>
<p>Type of bounds to use for persistence vector if values are
generated. <code>"usual"</code> - bounds from p.156 by Hyndman et. al., 2008.
<code>"restricted"</code> - similar to <code>"usual"</code> but with upper bound equal
to 0.3. <code>"admissible"</code> - bounds from tables 10.1 and 10.2 of Hyndman
et. al., 2008. Using first letter of the type of bounds also works.</p>
</td></tr>
<tr><td><code id="sim.ves_+3A_randomizer">randomizer</code></td>
<td>
<p>Type of random number generator function used for error
term. Defaults are: <code>rnorm</code>, <code>rt</code>, <code>rlaplace</code>, <code>rs</code>. But
any function from <a href="stats.html#topic+Distributions">Distributions</a> will do the trick if the
appropriate parameters are passed. <code>mvrnorm</code> from MASS package can also
be used.</p>
</td></tr>
<tr><td><code id="sim.ves_+3A_...">...</code></td>
<td>
<p>Additional parameters passed to the chosen randomizer. All the
parameters should be passed in the order they are used in chosen randomizer.
For example, passing just <code>sd=0.5</code> to <code>rnorm</code> function will lead
to the call <code>rnorm(obs, mean=0.5, sd=1)</code>. ATTENTION! When generating
the multiplicative errors some tuning might be needed to obtain meaningful
data. <code>sd=0.1</code> is usually already a high value for such models.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of the following values is returned:
</p>

<ul>
<li> <p><code>model</code> - Name of ETS model.
</p>
</li>
<li> <p><code>data</code> - The matrix (or an array if <code>nsim&gt;1</code>) of the
generated series.
</p>
</li>
<li> <p><code>states</code> - The matrix (or array if <code>nsim&gt;1</code>) of states.
States are in columns, time is in rows.
</p>
</li>
<li> <p><code>persistence</code> - The matrix (or array if <code>nsim&gt;1</code>) of
smoothing parameters used in the simulation.
</p>
</li>
<li> <p><code>transition</code> - The transition matrix (or array if <code>nsim&gt;1</code>).
</p>
</li>
<li> <p><code>initial</code> - Vector (or matrix) of initial values.
</p>
</li>
<li> <p><code>initialSeason</code> - Vector (or matrix) of initial seasonal
coefficients.
</p>
</li>
<li> <p><code>residuals</code> - Error terms used in the simulation. Either matrix
or array, depending on <code>nsim</code>.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Ivan Svetunkov, <a href="mailto:ivan@svetunkov.ru">ivan@svetunkov.ru</a>
</p>


<h3>References</h3>


<ul>
<li><p> de Silva A., Hyndman R.J. and Snyder, R.D. (2010). The vector
innovations structural time series framework: a simple approach to
multivariate forecasting. Statistical Modelling, 10 (4), pp.353-374
</p>
</li>
<li><p> Hyndman, R.J., Koehler, A.B., Ord, J.K., and Snyder, R.D. (2008)
Forecasting with exponential smoothing: the state space approach,
Springer-Verlag.
</p>
</li>
<li><p> Lütkepohl, H. (2005). New Introduction to Multiple Time Series
Analysis. New introduction to Multiple Time Series Analysis. Berlin,
Heidelberg: Springer Berlin Heidelberg.
<a href="https://doi.org/10.1007/978-3-540-27752-1">doi:10.1007/978-3-540-27752-1</a>
</p>
</li>
<li><p> Chen H., Svetunkov I., Boylan J. (2021). A New Taxonomy for
Vector Exponential Smoothing and Its Application to Seasonal Time
Series.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+ves">ves</a>, <a href="stats.html#topic+Distributions">Distributions</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Create 40 observations of quarterly data using AAA model with errors
# from normal distribution
VESAAA &lt;- sim.ves(model="AAA",frequency=4,obs=40,nvariate=3,
                   randomizer="rnorm",mean=0,sd=100)

# You can also use mvrnorm function from MASS package as randomizer,
# but you need to provide mu and Sigma explicitly
## Not run: VESANN &lt;- sim.ves(model="ANN",frequency=4,obs=40,nvariate=2,
                   randomizer="mvrnorm",mu=c(100,50),sigma=matrix(c(40,20,20,30),2,2))
## End(Not run)

# When generating the data with multiplicative model a more diligent definitiion
# of parameters is needed. Here's an example with MMM model:

VESMMM &lt;- sim.ves("AAA", obs=120, nvariate=2, frequency=12, initial=c(10,0),
          initialSeason=runif(12,-1,1), persistence=c(0.06,0.05,0.2), mean=0, sd=0.03)
VESMMM$data &lt;- exp(VESMMM$data)

# Note that smoothing parameters should be low and the standard diviation should
# definitely be less than 0.1. Otherwise you might face the explosions.

</code></pre>

<hr>
<h2 id='ves'>Vector Exponential Smoothing in SSOE state space model</h2><span id='topic+ves'></span>

<h3>Description</h3>

<p>Function constructs vector ETS model and returns forecast, fitted values, errors
and matrix of states along with other useful variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ves(data, model = "PPP", lags = c(frequency(data)),
  persistence = c("common", "individual", "dependent"),
  transition = c("common", "individual", "dependent"), phi = c("common",
  "individual"), initial = c("individual", "common"),
  initialSeason = c("common", "individual"), loss = c("likelihood",
  "diagonal", "trace"), ic = c("AICc", "AIC", "BIC", "BICc"), h = 10,
  holdout = FALSE, occurrence = c("none", "fixed", "logistic"),
  bounds = c("admissible", "usual", "none"), silent = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ves_+3A_data">data</code></td>
<td>
<p>The matrix with the data, where series are in columns and
observations are in rows.</p>
</td></tr>
<tr><td><code id="ves_+3A_model">model</code></td>
<td>
<p>The type of ETS model. Can consist of 3 or 4 chars: <code>ANN</code>,
<code>AAN</code>, <code>AAdN</code>, <code>AAA</code>, <code>AAdA</code>, <code>MMdM</code> etc.
<code>PPP</code> means that the best pure model will be selected based on the chosen
information criteria type.
ATTENTION! ONLY PURE ADDITIVE AND PURE MULTIPLICATIVE MODELS ARE
AVAILABLE!
Pure multiplicative models are done as additive model applied to log(y).
</p>
<p>Also <code>model</code> can accept a previously estimated VES model and use all its
parameters.</p>
</td></tr>
<tr><td><code id="ves_+3A_lags">lags</code></td>
<td>
<p>The lags of the model. Needed for seasonal models.</p>
</td></tr>
<tr><td><code id="ves_+3A_persistence">persistence</code></td>
<td>
<p>Persistence matrix <code class="reqn">G</code>, containing smoothing
parameters. Can be:
</p>

<ul>
<li> <p><code>"independent"</code> - each series has its own smoothing parameters
and no interactions are modelled (all the other values in the matrix are set
to zero);
</p>
</li>
<li> <p><code>"dependent"</code> - each series has its own smoothing parameters, but
interactions between the series are modelled (the whole matrix is estimated);
</p>
</li>
<li> <p><code>"group"</code> each series has the same smoothing parameters for respective
components (the values of smoothing parameters are repeated, all the other values
in the matrix are set to zero).
</p>
</li>
<li> <p><code>"seasonal"</code> - each component has its own smoothing parameter, except
for the seasonal one, which is common across the time series.
</p>
</li>
<li><p> provided by user as a vector or as a matrix. The value is used by the model.
</p>
</li></ul>

<p>You can also use the first letter instead of writing the full word.</p>
</td></tr>
<tr><td><code id="ves_+3A_transition">transition</code></td>
<td>
<p>Transition matrix <code class="reqn">F</code>. Can be:
</p>

<ul>
<li> <p><code>"independent"</code> - each series has its own preset transition matrix
and no interactions are modelled (all the other values in the matrix are set
to zero);
</p>
</li>
<li> <p><code>"dependent"</code> - each series has its own transition matrix, but
interactions between the series are modelled (the whole matrix is estimated). The
estimated model behaves similar to VAR in this case;
</p>
</li>
<li> <p><code>"group"</code> each series has the same transition matrix for respective
components (the values are repeated, all the other values in the matrix are set to
zero).
</p>
</li>
<li><p> provided by user as a vector or as a matrix. The value is used by the model.
</p>
</li></ul>

<p>You can also use the first letter instead of writing the full word.</p>
</td></tr>
<tr><td><code id="ves_+3A_phi">phi</code></td>
<td>
<p>In cases of damped trend this parameter defines whether the <code class="reqn">phi</code>
should be estimated separately for each series (<code>"individual"</code>) or for the whole
set (<code>"common"</code>). If vector or a value is provided here, then it is used by the
model.</p>
</td></tr>
<tr><td><code id="ves_+3A_initial">initial</code></td>
<td>
<p>Can be either character or a vector / matrix of initial states.
If it is character, then it can be <code>"individual"</code>, individual values of
the initial non-seasonal components are used, or <code>"common"</code>, meaning that
the initials for all the time series are set to be equal to the same value.
If vector of states is provided, then it is automatically transformed into
a matrix, assuming that these values are provided for the whole group.</p>
</td></tr>
<tr><td><code id="ves_+3A_initialseason">initialSeason</code></td>
<td>
<p>Can be either character or a vector / matrix of initial
states. Treated the same way as <code>initial</code>. This means that different time
series may share the same initial seasonal component.</p>
</td></tr>
<tr><td><code id="ves_+3A_loss">loss</code></td>
<td>
<p>Type of Loss Function used in optimization. <code>loss</code> can
be:
</p>

<ul>
<li> <p><code>"likelihood"</code> - which implies the maximisation of likelihood of
multivariate normal distribution (or log Normal if the multiplicative model
is constructed);
</p>
</li>
<li> <p><code>"diagonal"</code> - similar to <code>"likelihood"</code>, but assumes that
covariances between the error terms are zero.
</p>
</li>
<li> <p><code>"trace"</code> - the trace of the covariance matrix of errors.
The sum of variances is minimised in this case.
</p>
</li>
<li><p> Provided by user as a custom function of <code>actual</code>, <code>fitted</code> and
<code>B</code>. Note that internally function transposes the data, so that <code>actual</code>
and <code>fitted</code> contain observations in columns and series in rows.
</p>
</li></ul>

<p>An example of the latter option is:
<code>lossFunction &lt;- function(actual,fitted,B){return(mean(abs(actual - fitted)))}</code>
followed by <code>loss=lossFunction</code>.</p>
</td></tr>
<tr><td><code id="ves_+3A_ic">ic</code></td>
<td>
<p>The information criterion used in the model selection procedure.</p>
</td></tr>
<tr><td><code id="ves_+3A_h">h</code></td>
<td>
<p>Length of forecasting horizon.</p>
</td></tr>
<tr><td><code id="ves_+3A_holdout">holdout</code></td>
<td>
<p>If <code>TRUE</code>, holdout sample of size <code>h</code> is taken from
the end of the data.</p>
</td></tr>
<tr><td><code id="ves_+3A_occurrence">occurrence</code></td>
<td>
<p>Defines type of occurrence model used. Can be:
</p>

<ul>
<li> <p><code>none</code>, meaning that the data should be considered as non-intermittent;
</p>
</li>
<li> <p><code>fixed</code>, taking into account constant Bernoulli distribution of
demand occurrences;
</p>
</li>
<li> <p><code>logistic</code>, based on logistic regression.
</p>
</li></ul>

<p>In this case, the ETS model inside the occurrence part will correspond to
<code>model</code> and <code>probability="dependent"</code>.
Alternatively, model estimated using <a href="#topic+oves">oves</a> function can be provided
here.</p>
</td></tr>
<tr><td><code id="ves_+3A_bounds">bounds</code></td>
<td>
<p>What type of bounds to use in the model estimation. The first
letter can be used instead of the whole word. <code>"admissible"</code> means that the
model stability is ensured, while <code>"usual"</code> means that the all the parameters
are restricted by the (0, 1) region.</p>
</td></tr>
<tr><td><code id="ves_+3A_silent">silent</code></td>
<td>
<p>If <code>silent="none"</code>, then nothing is silent, everything is
printed out and drawn. <code>silent="all"</code> means that nothing is produced or
drawn (except for warnings). In case of <code>silent="graph"</code>, no graph is
produced. If <code>silent="legend"</code>, then legend of the graph is skipped.
And finally <code>silent="output"</code> means that nothing is printed out in the
console, but the graph is produced. <code>silent</code> also accepts <code>TRUE</code>
and <code>FALSE</code>. In this case <code>silent=TRUE</code> is equivalent to
<code>silent="all"</code>, while <code>silent=FALSE</code> is equivalent to
<code>silent="none"</code>. The parameter also accepts first letter of words (&quot;n&quot;,
&quot;a&quot;, &quot;g&quot;, &quot;l&quot;, &quot;o&quot;).</p>
</td></tr>
<tr><td><code id="ves_+3A_...">...</code></td>
<td>
<p>Other non-documented parameters. For example <code>FI=TRUE</code> will
make the function also produce Fisher Information matrix, which then can be
used to calculated variances of smoothing parameters and initial states of
the model. The vector of initial parameter for the optimiser can be provided
here as the variable <code>B</code>. The upper bound for the optimiser is provided
via <code>ub</code>, while the lower one is <code>lb</code>. Also, the options for nloptr can be
passed here:
</p>

<ul>
<li> <p><code>maxeval=40*k</code> is the default number of iterations for both optimisers
used in the function (k is the number of parameters to estimate).
</p>
</li>
<li> <p><code>algorithm1="NLOPT_LN_BOBYQA"</code> is the algorithm used in the first
optimiser, while <code>algorithm2="NLOPT_LN_NELDERMEAD"</code> is the second one.
</p>
</li>
<li> <p><code>xtol_rel1=1e-8</code> is the relative tolerance in the first optimiser,
while <code>xtol_rel2=1e-6</code> is for the second one. All of this can be amended and
passed in ellipsis for finer tuning.
</p>
</li>
<li> <p><code>print_level</code> - the level of output for the optimiser (0 by default).
If equal to 41, then the detailed results of the optimisation are returned.</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>Function estimates vector ETS in a form of the Single Source of Error state space
model of the following type:
</p>
<p style="text-align: center;"><code class="reqn">
\mathbf{y}_{t} = (\mathbf{W} \mathbf{v}_{t-l} + \mathbf{x}_t
\mathbf{a}_{t-1} + \mathbf{\epsilon}_{t})
</code>
</p>

<p style="text-align: center;"><code class="reqn">
\mathbf{v}_{t} = \mathbf{F} \mathbf{v}_{t-l} + \mathbf{G}
\mathbf{\epsilon}_{t}
</code>
</p>

<p style="text-align: center;"><code class="reqn">\mathbf{a}_{t} = \mathbf{F_{X}} \mathbf{a}_{t-1} + \mathbf{G_{X}}
\mathbf{\epsilon}_{t} / \mathbf{x}_{t}</code>
</p>

<p>Where <code class="reqn">y_{t}</code> is the vector of time series on observation <code class="reqn">t</code>,
<code class="reqn">\mathbf{v}_{t}</code> is the matrix of
states and <code class="reqn">l</code> is the matrix of lags, <code class="reqn">\mathbf{x}_t</code> is the vector of
exogenous variables. <code class="reqn">\mathbf{W}</code> is the measurement matrix, <code class="reqn">\mathbf{F}</code>
is the transition matrix and <code class="reqn">\mathbf{G}</code> is the persistence matrix.
Finally, <code class="reqn">\epsilon_{t}</code> is the vector of error terms.
</p>
<p>Conventionally we formulate values as:
</p>
<p style="text-align: center;"><code class="reqn">\mathbf{y}'_t = (y_{1,t}, y_{2,t}, \dots, y_{m,t})</code>
</p>

<p>where <code class="reqn">m</code> is the number of series in the group.
</p>
<p style="text-align: center;"><code class="reqn">\mathbf{v}'_t = (v_{1,t}, v_{2,t}, \dots, v_{m,t})</code>
</p>

<p>where <code class="reqn">v_{i,t}</code> is vector of components for i-th time series.
</p>
<p style="text-align: center;"><code class="reqn">\mathbf{W}' = (w_{1}, \dots , 0;
\vdots , \ddots , \vdots;
0 , \vdots , w_{m})</code>
</p>
<p> is matrix of measurement vectors.
</p>
<p>For the details on the additive model see Hyndman et al. (2008),
chapter 17.
</p>
<p>In case of multiplicative model, instead of the vector y_t we use its logarithms.
As a result the multiplicative model is much easier to work with.
</p>
<p>For some more information about the model and its implementation, see the
vignette: <code>vignette("ves","legion")</code>
</p>


<h3>Value</h3>

<p>Object of class &quot;legion&quot; is returned. It contains the following list of
values:
</p>

<ul>
<li> <p><code>model</code> - The name of the fitted model;
</p>
</li>
<li> <p><code>timeElapsed</code> - The time elapsed for the construction of the model;
</p>
</li>
<li> <p><code>states</code> - The matrix of states with components in columns and time in rows;
</p>
</li>
<li> <p><code>persistence</code> - The persistence matrix;
</p>
</li>
<li> <p><code>transition</code> - The transition matrix;
</p>
</li>
<li> <p><code>measurement</code> - The measurement matrix;
</p>
</li>
<li> <p><code>phi</code> - The damping parameter value;
</p>
</li>
<li> <p><code>lagsAll</code> - The vector of the internal lags used in the model;
</p>
</li>
<li> <p><code>B</code> - The vector of all the estimated coefficients;
</p>
</li>
<li> <p><code>initial</code> - The initial values of the non-seasonal components;
</p>
</li>
<li> <p><code>initialSeason</code> - The initial values of the seasonal components;
</p>
</li>
<li> <p><code>nParam</code> - The number of estimated parameters;
</p>
</li>
<li> <p><code>occurrence</code> - The occurrence part of the model estimated with VES;
</p>
</li>
<li> <p><code>data</code> - The matrix with the original data;
</p>
</li>
<li> <p><code>fitted</code> - The matrix of the fitted values;
</p>
</li>
<li> <p><code>holdout</code> - The matrix with the holdout values (if <code>holdout=TRUE</code> in
the estimation);
</p>
</li>
<li> <p><code>residuals</code> - The matrix of the residuals of the model;
</p>
</li>
<li> <p><code>Sigma</code> - The covariance matrix of the errors (estimated with the correction
for the number of degrees of freedom);
</p>
</li>
<li> <p><code>forecast</code> - The matrix of point forecasts;
</p>
</li>
<li> <p><code>ICs</code> - The values of the information criteria;
</p>
</li>
<li> <p><code>logLik</code> - The log-likelihood function;
</p>
</li>
<li> <p><code>lossValue</code> - The value of the loss function;
</p>
</li>
<li> <p><code>loss</code> - The type of the used loss function;
</p>
</li>
<li> <p><code>lossFunction</code> - The loss function if the custom was used in the process;
</p>
</li>
<li> <p><code>accuracy</code> - the values of the error measures. Currently not available.
</p>
</li>
<li> <p><code>FI</code> - Fisher information if user asked for it using <code>FI=TRUE</code>.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Ivan Svetunkov, <a href="mailto:ivan@svetunkov.ru">ivan@svetunkov.ru</a>
</p>


<h3>References</h3>


<ul>
<li><p> de Silva A., Hyndman R.J. and Snyder, R.D. (2010). The vector
innovations structural time series framework: a simple approach to
multivariate forecasting. Statistical Modelling, 10 (4), pp.353-374
</p>
</li>
<li><p> Hyndman, R.J., Koehler, A.B., Ord, J.K., and Snyder, R.D. (2008)
Forecasting with exponential smoothing: the state space approach,
Springer-Verlag.
</p>
</li>
<li><p> Lütkepohl, H. (2005). New Introduction to Multiple Time Series
Analysis. New introduction to Multiple Time Series Analysis. Berlin,
Heidelberg: Springer Berlin Heidelberg.
<a href="https://doi.org/10.1007/978-3-540-27752-1">doi:10.1007/978-3-540-27752-1</a>
</p>
</li>
<li><p> Chen H., Svetunkov I., Boylan J. (2021). A New Taxonomy for
Vector Exponential Smoothing and Its Application to Seasonal Time
Series.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+vets">vets</a>, <a href="smooth.html#topic+es">es</a>, <a href="smooth.html#topic+adam">adam</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
Y &lt;- ts(cbind(rnorm(100,100,10),rnorm(100,75,8)),frequency=12)

# The simplest model applied to the data with the default values
ves(Y,model="ANN",h=10,holdout=TRUE)

# Damped trend model with the dependent persistence
ves(Y,model="AAdN",persistence="d",h=10,holdout=TRUE)

# Multiplicative damped trend model with individual phi
ves(Y,model="MMdM",persistence="i",h=10,holdout=TRUE,initialSeason="c")

# Automatic selection between pure models
ves(Y,model="PPP",persistence="i",h=10,holdout=TRUE,initialSeason="c")

# Intermittent demand vector model
Y &lt;- cbind(c(rpois(25,0.1),rpois(25,0.5),rpois(25,1),rpois(25,5)),
           c(rpois(25,0.1),rpois(25,0.5),rpois(25,1),rpois(25,5)))

ves(Y,model="MNN",h=10,holdout=TRUE,occurrence="l")

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
