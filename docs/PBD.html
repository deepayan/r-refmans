<!DOCTYPE html><html lang="en"><head><title>Help for package PBD</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {PBD}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#PBD-package'><p>Protracted Birth-Death Model of Diversification</p></a></li>
<li><a href='#pbd_bootstrap'><p>Bootstrap analysis under protracted birth-death model of diversification</p></a></li>
<li><a href='#pbd_brts_density'><p>Node depth probbaility density for protracted birth-death model of diversification</p></a></li>
<li><a href='#pbd_durspec_cumdensity'><p>Cumulative density of duration of speciation under protracted birth-death model of diversification</p></a></li>
<li><a href='#pbd_durspec_density'><p>Probability density for duration of speciation under protracted birth-death model of diversification</p></a></li>
<li><a href='#pbd_durspec_mean'><p>Mean duration of speciation under protracted birth-death model of diversification</p></a></li>
<li><a href='#pbd_durspec_mode'><p>mode of the duration of speciation under protracted birth-death model of diversification</p></a></li>
<li><a href='#pbd_durspec_moment'><p>Moments of duration of speciation under protracted birth-death model of diversification</p></a></li>
<li><a href='#pbd_durspec_quantile'><p>Quantiles of duration of speciation under protracted birth-death model of diversification</p></a></li>
<li><a href='#pbd_durspec_var'><p>Variance in duration of speciation under protracted birth-death model of diversification</p></a></li>
<li><a href='#pbd_loglik'><p>Loglikelihood for protracted birth-death model of diversification</p></a></li>
<li><a href='#pbd_LR'><p>Bootstrap likelihood ratio test of protracted birth-death model of diversification</p></a></li>
<li><a href='#pbd_ML'><p>Maximization of loglikelihood under protracted birth-death model of diversification</p></a></li>
<li><a href='#pbd_sim'><p> Function to simulate the protracted speciation process</p></a></li>
<li><a href='#pbd_sim_cpp'><p> Function to simulate the approximate protracted speciation process</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Protracted Birth-Death Model of Diversification</td>
</tr>
<tr>
<td>Version:</td>
<td>1.4</td>
</tr>
<tr>
<td>Date:</td>
<td>2017-5-4</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>deSolve, ade4, ape, DDD, phytools, graphics, stats, utils</td>
</tr>
<tr>
<td>Author:</td>
<td>Rampal S. Etienne</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Rampal S. Etienne &lt;r.s.etienne@rug.nl&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Conducts maximum likelihood analysis and simulation of the
    protracted birth-death model of diversification. See
    Etienne, R.S. &amp; J. Rosindell 2012 &lt;<a href="https://doi.org/10.1093%2Fsysbio%2Fsyr091">doi:10.1093/sysbio/syr091</a>&gt;;
    Lambert, A., H. Morlon &amp; R.S. Etienne 2014, &lt;<a href="https://doi.org/10.1007%2Fs00285-014-0767-x">doi:10.1007/s00285-014-0767-x</a>&gt;;
    Etienne, R.S., H. Morlon &amp; A. Lambert 2014, &lt;<a href="https://doi.org/10.1111%2Fevo.12433">doi:10.1111/evo.12433</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>5.0.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2017-05-04 09:37:14 UTC; rampa</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2017-05-04 16:32:06 UTC</td>
</tr>
</table>
<hr>
<h2 id='PBD-package'>Protracted Birth-Death Model of Diversification </h2><span id='topic+PBD-package'></span><span id='topic+PBD'></span>

<h3>Description</h3>

<p> This package computes the (maximum) likelihood of the protracted speciation model for a given set of branching times
This package is a likelihood-based statistical package to estimate parameters
under the protracted speciation model.<br /> <br />
First version: 0.8<br />
New in version 0.9<br />
- Bug fix for stem age<br />
New in version 0.91<br />
- Reports loglik = -Inf on an error in the deSolve package (function ode)<br />
New in version 0.92<br />
- Correcting order of parameters of pbd_sim<br />
New in version 0.93<br />
- pbd_sim produces a tree, a matrix containing all events in the simulation, and a tree with one sample per species.<br />
New in version 1.0<br />
- Conditioning is also possible on a range of values of the number of species.<br />
New in version 1.1<br />
- Simulation of the protracted speciation tree has more features. <br />
New in version 1.2<br />
- Optimization can make use of subplex (default) and simplex (older versions).<br />
New in version 1.3<br />
- Contains a function to carry out a bootstrap likelihood ratio test.<br />
- Vignette and test added.<br />
- Reports an error if exteq = TRUE and initparsopt contains 4 parameters.<br />
- Option to limit a simulation to a certain maximum number of species; if exceeded, the simulation is ignored.<br />
New in version 1.4:<br />
- Includes all special cases in pbd_durspec_mean<br />
- Fixes a bug in conditioning on a range of values of the number of species<br />
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> PBD</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.4</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2017-5-4</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL-2</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>pbd_loglik computes the likelihood of the protracted birth-death model of
diversification, given a set of parameters and a data set of phylogenetic branching times.
</p>
<p>pbd_ML finds the parameters that maximizes the likelihood computed by pbd_loglik.
</p>
<p>pbd_bootstrap performs a maximum likelihood analysis and simulates with the maximum likelihood parameters. The ML parameters of the simulated data sets are then estimated, providing an uncertainty distribution for the original ML estimate on the original data.
</p>


<h3>Author(s)</h3>

<p>Rampal S. Etienne
Maintainer: Rampal S. Etienne &lt;r.s.etienne@rug.nl&gt;
</p>


<h3>References</h3>

<p>- Etienne, R.S. &amp; J. Rosindell 2012. Systematic Biology 61: 204-213.<br />
- Lambert, A., H. Morlon &amp; R.S. Etienne 2014. Journal of Mathmematical Biology 70: 367-397. doi:10.1007/s00285-014-0767-x<br />
- Etienne, R.S., H. Morlon &amp; A. Lambert 2014. Evolution 68: 2430-2440, doi:10.1111/evo.12433<br />.
- Etienne, R.S., A.L. Pigot &amp; A.B. Phillimore 2016. Methods in Ecology &amp; Evolution 7: 1092-1099, doi: 10.1111/2041-210X.12565 <br />
</p>


<h3>See Also</h3>

 <p><code>DDD</code> </p>

<hr>
<h2 id='pbd_bootstrap'>Bootstrap analysis under protracted birth-death model of diversification</h2><span id='topic+pbd_bootstrap'></span>

<h3>Description</h3>

<p>Likelihood maximization for protracted birth-death model of diversification followed by simulations of the model using the maximum
likelihood parameter estimates to compute an estimate of the error in these estimates and to assess the goodness-of-fit of the model by comparing
maximum likelihoods of the simulated data sets to the maximum likelihood of the real data set.</p>


<h3>Usage</h3>

<pre><code class='language-R'>pbd_bootstrap(
   brts,
   initparsopt = c(0.2,0.1,1),
   idparsopt = 1:length(initparsopt),
   idparsfix = NULL,
   parsfix = NULL,
   exteq = (length(initparsopt) &lt; 4),
   parsfunc = c(function(t,pars) {pars[1]},function(t,pars) {pars[2]},
function(t,pars) {pars[3]}, function(t,pars) {pars[4]}),
   missnumspec = 0,
   cond = 1,
   btorph = 0,
   soc = 2,
   plotltt = 1,
   methode = "lsoda",
   n_low = 0,
   n_up = 0,
   tol = c(1E-4, 1E-4, 1E-6),
   maxiter = 1000 * round((1.25)^length(idparsopt)),
   endmc = 100,
   seed = 42
)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pbd_bootstrap_+3A_brts">brts</code></td>
<td>
<p>A set of branching times of a phylogeny, all positive </p>
</td></tr>
<tr><td><code id="pbd_bootstrap_+3A_initparsopt">initparsopt</code></td>
<td>
<p>The initial values of the parameters that must be optimized</p>
</td></tr>
<tr><td><code id="pbd_bootstrap_+3A_idparsopt">idparsopt</code></td>
<td>

<p>The ids of the parameters that must be optimized, e.g. 1:4 for all parameters.
The ids are defined as follows: <br />
id == 1 corresponds to b (speciation-initiation rate) <br />
id == 2 corresponds to mu_1 (extinction rate of good species) <br />
id == 3 corresponds to la_1 (speciation-completion rate) <br />
id == 4 corresponds to mu_2 (extinction rate of incipient species) <br />
</p>
</td></tr>
<tr><td><code id="pbd_bootstrap_+3A_idparsfix">idparsfix</code></td>
<td>

<p>The ids of the parameters that should not be optimized, e.g. c(2,4) if mu_1 and mu_2
should not be optimized, but only b and la_1. In that case idparsopt must be c(1,3).
</p>
</td></tr>
<tr><td><code id="pbd_bootstrap_+3A_parsfix">parsfix</code></td>
<td>
<p> The values of the parameters that should not be optimized </p>
</td></tr>
<tr><td><code id="pbd_bootstrap_+3A_exteq">exteq</code></td>
<td>
<p>Sets whether incipient species have the same (1) or different (0) extinction rate as good species.
If exteq = 0, then idparsfix and idparsopt should together have all parameters 1:4
</p>
</td></tr>
<tr><td><code id="pbd_bootstrap_+3A_parsfunc">parsfunc</code></td>
<td>
<p> Specifies functions how the rates depend on time, default functions are constant functions </p>
</td></tr>
<tr><td><code id="pbd_bootstrap_+3A_missnumspec">missnumspec</code></td>
<td>

<p>The number of species that are in the clade but missing in the phylogeny </p>
</td></tr>
<tr><td><code id="pbd_bootstrap_+3A_cond">cond</code></td>
<td>
<p>Conditioning: <br />
cond == 0 : conditioning on stem or crown age <br />
cond == 1 : conditioning on stem or crown age and non-extinction of the phylogeny <br />
</p>
</td></tr>
<tr><td><code id="pbd_bootstrap_+3A_btorph">btorph</code></td>
<td>
<p>Sets whether the likelihood is for the branching times (0) or the phylogeny (1)</p>
</td></tr>
<tr><td><code id="pbd_bootstrap_+3A_soc">soc</code></td>
<td>
<p>Sets whether the first element of the branching times is the stem (1) or the crown (2) age</p>
</td></tr>
<tr><td><code id="pbd_bootstrap_+3A_plotltt">plotltt</code></td>
<td>
<p>Sets whether the lineage-through-time plot should be plotted (1) or not (0) </p>
</td></tr>
<tr><td><code id="pbd_bootstrap_+3A_methode">methode</code></td>
<td>
<p>Sets which method should be used in the ode-solver. Default is 'lsoda'.
See package deSolve for details.</p>
</td></tr>
<tr><td><code id="pbd_bootstrap_+3A_n_low">n_low</code></td>
<td>
<p>Sets the lower bound of the number of species on which conditioning should be done when cond = 2. Set this to 0 when conditioning should be done on precisely the number of species (default)</p>
</td></tr>
<tr><td><code id="pbd_bootstrap_+3A_n_up">n_up</code></td>
<td>
<p>Sets the upper bound of the number of species on which conditioning should be done when cond = 2. Set this to 0 when conditioning should be done on precisely the number of species (default)</p>
</td></tr>
<tr><td><code id="pbd_bootstrap_+3A_tol">tol</code></td>
<td>
<p>Sets the tolerances in the optimization. Consists of: <br />
reltolx = relative tolerance of parameter values in optimization <br />
reltolf = relative tolerance of function value in optimization <br />
abstolx = absolute tolerance of parameter values in optimization
</p>
</td></tr>
<tr><td><code id="pbd_bootstrap_+3A_maxiter">maxiter</code></td>
<td>
<p>Sets the maximum number of iterations in the optimization</p>
</td></tr>
<tr><td><code id="pbd_bootstrap_+3A_endmc">endmc</code></td>
<td>
<p>Sets the number of simulations for the bootstrap</p>
</td></tr>
<tr><td><code id="pbd_bootstrap_+3A_seed">seed</code></td>
<td>
<p>Sets the seed for the simulations of the bootstrap</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of three dataframes. The first dataframe contains the maximum likelihood results of the real data set, the second contains the simulated trees, and the third dataframe, with number of rows equal to endmc, contain the maximum likelihood results for the simulated data. The columns of both frames contains the following elements for each simulated data set:
</p>
<table role = "presentation">
<tr><td><code>ntips</code></td>
<td>
<p> gives the number of tips </p>
</td></tr>
<tr><td><code>b</code></td>
<td>
<p> gives the maximum likelihood estimate of b</p>
</td></tr>
<tr><td><code>mu_1</code></td>
<td>
<p> gives the maximum likelihood estimate of mu_1</p>
</td></tr>
<tr><td><code>la_1</code></td>
<td>
<p> gives the maximum likelihood estimate of la_1</p>
</td></tr>
<tr><td><code>mu_2</code></td>
<td>
<p> gives the maximum likelihood estimate of mu_2</p>
</td></tr>
<tr><td><code>loglik</code></td>
<td>
<p> gives the maximum loglikelihood</p>
</td></tr>
<tr><td><code>df</code></td>
<td>
<p> gives the number of estimated parameters, i.e. degrees of feedom</p>
</td></tr>
<tr><td><code>conv</code></td>
<td>
<p> gives a message on convergence of optimization; conv = 0 means convergence</p>
</td></tr>
<tr><td><code>exp_durspec</code></td>
<td>
<p> gives the expected duration of speciation</p>
</td></tr>
<tr><td><code>median_durspec</code></td>
<td>
<p> gives the median duration of speciation</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Rampal S. Etienne
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pbd_ML">pbd_ML</a></code>
</p>

<hr>
<h2 id='pbd_brts_density'>Node depth probbaility density for protracted birth-death model of diversification</h2><span id='topic+pbd_brts_density'></span>

<h3>Description</h3>

<p>pbd_brts_density computes the probability density of node depths under the protracted speciation model given a set of parameters
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pbd_brts_density(
    pars1,
    pars1f = c(function(t,pars) {pars[1]},function(t,pars) {pars[2]},
function(t,pars) {pars[3]}, function(t,pars) {pars[4]}),
    methode = "lsoda",
    brts
)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pbd_brts_density_+3A_pars1">pars1</code></td>
<td>
<p>Vector of parameters: <br /> <br />
<code>pars1[1]</code> corresponds to b (= la_1 in Etienne &amp; Rosindell R2012) = speciation initiation rate <br />
<code>pars1[2]</code> corresponds to mu_1 (= mu_g in Etienne &amp; Rosindell 2012) = extinction rate of good species <br />
<code>pars1[3]</code> corresponds to la_1 (= la_2 in Etienne &amp; Rosindell 2012) = speciation completion rate <br />
<code>pars1[4]</code> corresponds to mu_2 (= mu_i in ER2012) = extinction rate of incipient species <br />
When rates depend on time this time dependence should be specified in pars1f and pars1 then becomes the parameters used in pars1f <br /> <br />
</p>
</td></tr>
<tr><td><code id="pbd_brts_density_+3A_pars1f">pars1f</code></td>
<td>
<p>Vector of functions how the rates depend on time, default functions are constant functions of the parameters in pars1: <br /> <br />
<code>pars1f[1]</code> corresponds to time-dependence of b (= la_1 in Etienne &amp; Rosindell R2012) = speciation initiation rate <br />
<code>pars1f[2]</code> corresponds to time-dependence of mu_1 (= mu_g in Etienne &amp; Rosindell 2012) = extinction rate of good species <br />
<code>pars1f[3]</code> corresponds to tiem-dependence of la_1 (= la_2 in Etienne &amp; Rosindell 2012) = speciation completion rate <br />
<code>pars1f[4]</code> corresponds to time-dependence of mu_2 (= mu_i in ER2012) = extinction rate of incipient species <br /> <br />
</p>
</td></tr>
<tr><td><code id="pbd_brts_density_+3A_methode">methode</code></td>
<td>
<p> sets which method should be used in the ode-solver. Default is 'lsoda'. See package deSolve for details. <br /> <br />
</p>
</td></tr>
<tr><td><code id="pbd_brts_density_+3A_brts">brts</code></td>
<td>
<p>A set of branching times of a phylogeny, all positive, for which the density must be computed </p>
</td></tr>
</table>


<h3>Value</h3>

<p>The probability density for all branching times</p>


<h3>Author(s)</h3>

<p> Rampal S. Etienne </p>


<h3>See Also</h3>

<p><code><a href="#topic+pbd_ML">pbd_ML</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'> pbd_brts_density(pars1 = c(0.2,0.1,1,0.1), methode = "lsoda",brts = 1:10) </code></pre>

<hr>
<h2 id='pbd_durspec_cumdensity'>Cumulative density of duration of speciation under protracted birth-death model of diversification</h2><span id='topic+pbd_durspec_cumdensity'></span>

<h3>Description</h3>

<p>pbd_durspec_cumdensity computes the cumulative density of the duration of speciation under the protracted speciation model for a given set of parameters
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pbd_durspec_cumdensity(
    pars,
    tau
)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pbd_durspec_cumdensity_+3A_pars">pars</code></td>
<td>
<p>Vector of parameters: <br /> <br />
<code>pars[1]</code> corresponds to b (= la_3 in Etienne &amp; Rosindell R2012) = speciation initiation rate <br />
<code>pars[2]</code> corresponds to la_1 (= la_2 in Etienne &amp; Rosindell 2012) = speciation completion rate <br />
<code>pars[3]</code> corresponds to mu_2 (= mu_i in ER2012) = extinction rate of incipient species <br />
</p>
</td></tr>
<tr><td><code id="pbd_durspec_cumdensity_+3A_tau">tau</code></td>
<td>
<p> Value of the duration of speciation at which the cumulative density must be computed </p>
</td></tr>
</table>


<h3>Value</h3>

<p> The cumulative density of the duration of speciation </p>


<h3>Author(s)</h3>

<p> Rampal S. Etienne </p>


<h3>See Also</h3>

<p><code><a href="#topic+pbd_durspec_density">pbd_durspec_density</a></code><br />
<code><a href="#topic+pbd_durspec_mean">pbd_durspec_mean</a></code><br />
<code><a href="#topic+pbd_durspec_mode">pbd_durspec_mode</a></code><br />
<code><a href="#topic+pbd_durspec_quantile">pbd_durspec_quantile</a></code><br />
<code><a href="#topic+pbd_durspec_moment">pbd_durspec_moment</a></code><br />
<code><a href="#topic+pbd_durspec_var">pbd_durspec_var</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'> pbd_durspec_cumdensity(pars = c(0.5,0.3,0.1),3) </code></pre>

<hr>
<h2 id='pbd_durspec_density'>Probability density for duration of speciation under protracted birth-death model of diversification</h2><span id='topic+pbd_durspec_density'></span>

<h3>Description</h3>

<p>pbd_durspec_density computes the probability density of the duration of speciation under the protracted speciation model for a given set of parameters
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pbd_durspec_density(
    pars,
    tau
)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pbd_durspec_density_+3A_pars">pars</code></td>
<td>
<p>Vector of parameters: <br /> <br />
<code>pars[1]</code> corresponds to b (= la_3 in Etienne &amp; Rosindell R2012) = speciation initiation rate <br />
<code>pars[2]</code> corresponds to la_1 (= la_2 in Etienne &amp; Rosindell 2012) = speciation completion rate <br />
<code>pars[3]</code> corresponds to mu_2 (= mu_i in ER2012) = extinction rate of incipient species <br />
</p>
</td></tr>
<tr><td><code id="pbd_durspec_density_+3A_tau">tau</code></td>
<td>
<p> The duration of speciation for which the density must be computed </p>
</td></tr>
</table>


<h3>Value</h3>

<p> The probability density </p>


<h3>Author(s)</h3>

<p> Rampal S. Etienne </p>


<h3>See Also</h3>

<p><code><a href="#topic+pbd_durspec_cumdensity">pbd_durspec_cumdensity</a></code><br />
<code><a href="#topic+pbd_durspec_mean">pbd_durspec_mean</a></code><br />
<code><a href="#topic+pbd_durspec_mode">pbd_durspec_mode</a></code><br />
<code><a href="#topic+pbd_durspec_quantile">pbd_durspec_quantile</a></code><br />
<code><a href="#topic+pbd_durspec_moment">pbd_durspec_moment</a></code><br />
<code><a href="#topic+pbd_durspec_var">pbd_durspec_var</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'> pbd_durspec_density(pars = c(0.5,0.3,0.1), tau = 1) </code></pre>

<hr>
<h2 id='pbd_durspec_mean'>Mean duration of speciation under protracted birth-death model of diversification</h2><span id='topic+pbd_durspec_mean'></span>

<h3>Description</h3>

<p>pbd_durspec_mean computes the mean duration of speciation under the protracted speciation model for a given set of parameters
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pbd_durspec_mean(
    pars
)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pbd_durspec_mean_+3A_pars">pars</code></td>
<td>
<p>Vector of parameters: <br /> <br />
<code>pars[1]</code> corresponds to b (= la_3 in Etienne &amp; Rosindell R2012) = speciation initiation rate <br />
<code>pars[2]</code> corresponds to la_1 (= la_2 in Etienne &amp; Rosindell 2012) = speciation completion rate <br />
<code>pars[3]</code> corresponds to mu_2 (= mu_i in ER2012) = extinction rate of incipient species <br />
</p>
</td></tr>
</table>


<h3>Value</h3>

<p> The expected duration of speciation </p>


<h3>Author(s)</h3>

<p> Rampal S. Etienne </p>


<h3>See Also</h3>

<p><code><a href="#topic+pbd_durspec_density">pbd_durspec_density</a></code><br />
<code><a href="#topic+pbd_durspec_cumdensity">pbd_durspec_cumdensity</a></code><br />
<code><a href="#topic+pbd_durspec_mode">pbd_durspec_mode</a></code><br />
<code><a href="#topic+pbd_durspec_quantile">pbd_durspec_quantile</a></code><br />
<code><a href="#topic+pbd_durspec_moment">pbd_durspec_moment</a></code><br />
<code><a href="#topic+pbd_durspec_var">pbd_durspec_var</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'> pbd_durspec_mean(pars = c(0.5,0.3,0.1)) </code></pre>

<hr>
<h2 id='pbd_durspec_mode'>mode of the duration of speciation under protracted birth-death model of diversification</h2><span id='topic+pbd_durspec_mode'></span>

<h3>Description</h3>

<p>pbd_durspec_mode computes the mode of the duration of speciation under the protracted speciation model for a given set of parameters
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pbd_durspec_mode(
    pars
)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pbd_durspec_mode_+3A_pars">pars</code></td>
<td>
<p>Vector of parameters: <br /> <br />
<code>pars[1]</code> corresponds to b (= la_3 in Etienne &amp; Rosindell R2012) = speciation initiation rate <br />
<code>pars[2]</code> corresponds to la_1 (= la_2 in Etienne &amp; Rosindell 2012) = speciation completion rate <br />
<code>pars[3]</code> corresponds to mu_2 (= mu_i in ER2012) = extinction rate of incipient species <br />
</p>
</td></tr>
</table>


<h3>Value</h3>

<p> The expected duration of speciation </p>


<h3>Author(s)</h3>

<p> Rampal S. Etienne </p>


<h3>See Also</h3>

<p><code><a href="#topic+pbd_durspec_density">pbd_durspec_density</a></code><br />
<code><a href="#topic+pbd_durspec_cumdensity">pbd_durspec_cumdensity</a></code><br />
<code><a href="#topic+pbd_durspec_mean">pbd_durspec_mean</a></code><br />
<code><a href="#topic+pbd_durspec_quantile">pbd_durspec_quantile</a></code><br />
<code><a href="#topic+pbd_durspec_moment">pbd_durspec_moment</a></code><br />
<code><a href="#topic+pbd_durspec_var">pbd_durspec_var</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'> pbd_durspec_mode(pars = c(0.5,0.3,0.1)) </code></pre>

<hr>
<h2 id='pbd_durspec_moment'>Moments of duration of speciation under protracted birth-death model of diversification</h2><span id='topic+pbd_durspec_moment'></span>

<h3>Description</h3>

<p>pbd_durspec_moment computes the moments of the duration of speciation under the protracted speciation model for a given set of parameters
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pbd_durspec_moment(
    pars,
    order
)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pbd_durspec_moment_+3A_pars">pars</code></td>
<td>
<p>Vector of parameters: <br /> <br />
<code>pars[1]</code> corresponds to b (= la_3 in Etienne &amp; Rosindell R2012) = speciation initiation rate <br />
<code>pars[2]</code> corresponds to la_1 (= la_2 in Etienne &amp; Rosindell 2012) = speciation completion rate <br />
<code>pars[3]</code> corresponds to mu_2 (= mu_i in ER2012) = extinction rate of incipient species <br />
</p>
</td></tr>
<tr><td><code id="pbd_durspec_moment_+3A_order">order</code></td>
<td>
<p> order of the moment to compute (1 is first moment, giving the mean) </p>
</td></tr>
</table>


<h3>Value</h3>

<p> The moment of the duration of speciation </p>


<h3>Author(s)</h3>

<p> Rampal S. Etienne </p>


<h3>See Also</h3>

<p><code><a href="#topic+pbd_durspec_density">pbd_durspec_density</a></code><br />
<code><a href="#topic+pbd_durspec_cumdensity">pbd_durspec_cumdensity</a></code><br />
<code><a href="#topic+pbd_durspec_mean">pbd_durspec_mean</a></code><br />
<code><a href="#topic+pbd_durspec_mode">pbd_durspec_mode</a></code><br />
<code><a href="#topic+pbd_durspec_quantile">pbd_durspec_quantile</a></code><br />
<code><a href="#topic+pbd_durspec_var">pbd_durspec_var</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'> pbd_durspec_moment(pars = c(0.5,0.3,0.1),2) </code></pre>

<hr>
<h2 id='pbd_durspec_quantile'>Quantiles of duration of speciation under protracted birth-death model of diversification</h2><span id='topic+pbd_durspec_quantile'></span>

<h3>Description</h3>

<p>pbd_durspec_quantile computes a quantile of the duration of speciation under the protracted speciation model for a given set of parameters
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pbd_durspec_quantile(
    pars,
    p
)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pbd_durspec_quantile_+3A_pars">pars</code></td>
<td>
<p>Vector of parameters: <br /> <br />
<code>pars[1]</code> corresponds to b (= la_3 in Etienne &amp; Rosindell R2012) = speciation initiation rate <br />
<code>pars[2]</code> corresponds to la_1 (= la_2 in Etienne &amp; Rosindell 2012) = speciation completion rate <br />
<code>pars[3]</code> corresponds to mu_2 (= mu_i in ER2012) = extinction rate of incipient species <br />
</p>
</td></tr>
<tr><td><code id="pbd_durspec_quantile_+3A_p">p</code></td>
<td>
<p> Quantile (e.g. p = 0.5 gives the median) </p>
</td></tr>
</table>


<h3>Value</h3>

<p> The quantil of the duration of speciation </p>


<h3>Author(s)</h3>

<p> Rampal S. Etienne </p>


<h3>See Also</h3>

<p><code><a href="#topic+pbd_durspec_density">pbd_durspec_density</a></code><br />
<code><a href="#topic+pbd_durspec_cumdensity">pbd_durspec_cumdensity</a></code><br />
<code><a href="#topic+pbd_durspec_mean">pbd_durspec_mean</a></code><br />
<code><a href="#topic+pbd_durspec_mode">pbd_durspec_mode</a></code><br />
<code><a href="#topic+pbd_durspec_moment">pbd_durspec_moment</a></code><br />
<code><a href="#topic+pbd_durspec_var">pbd_durspec_var</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'> pbd_durspec_quantile(pars = c(0.5,0.3,0.1),0.5) </code></pre>

<hr>
<h2 id='pbd_durspec_var'>Variance in duration of speciation under protracted birth-death model of diversification</h2><span id='topic+pbd_durspec_var'></span>

<h3>Description</h3>

<p>pbd_durspec_var computes the variance in the duration of speciation under the protracted speciation model for a given set of parameters
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pbd_durspec_var(
    pars
)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pbd_durspec_var_+3A_pars">pars</code></td>
<td>
<p>Vector of parameters: <br /> <br />
<code>pars[1]</code> corresponds to b (= la_3 in Etienne &amp; Rosindell R2012) = speciation initiation rate <br />
<code>pars[2]</code> corresponds to la_1 (= la_2 in Etienne &amp; Rosindell 2012) = speciation completion rate <br />
<code>pars[3]</code> corresponds to mu_2 (= mu_i in ER2012) = extinction rate of incipient species <br />
</p>
</td></tr>
</table>


<h3>Value</h3>

<p> The variance in the duration of speciation </p>


<h3>Author(s)</h3>

<p> Rampal S. Etienne </p>


<h3>See Also</h3>

<p><code><a href="#topic+pbd_durspec_density">pbd_durspec_density</a></code><br />
<code><a href="#topic+pbd_durspec_cumdensity">pbd_durspec_cumdensity</a></code><br />
<code><a href="#topic+pbd_durspec_mean">pbd_durspec_mean</a></code><br />
<code><a href="#topic+pbd_durspec_mode">pbd_durspec_mode</a></code><br />
<code><a href="#topic+pbd_durspec_quantile">pbd_durspec_quantile</a></code><br />
<code><a href="#topic+pbd_durspec_moment">pbd_durspec_moment</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'> pbd_durspec_var(pars = c(0.5,0.3,0.1)) </code></pre>

<hr>
<h2 id='pbd_loglik'>Loglikelihood for protracted birth-death model of diversification</h2><span id='topic+pbd_loglik'></span>

<h3>Description</h3>

<p>pbd_loglik computes the loglikelihood of the parameters of the protracted speciation model given a set of branching times and number of missing species
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pbd_loglik(
    pars1,
    pars1f = c(function(t,pars) {pars[1]},function(t,pars) {pars[2]},
function(t,pars) {pars[3]}, function(t,pars) {pars[4]}),
    pars2 = c(1,1,2,1,"lsoda",0,0),
    brts,
    missnumspec = 0
)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pbd_loglik_+3A_pars1">pars1</code></td>
<td>
<p>Vector of parameters: <br /> <br />
<code>pars1[1]</code> corresponds to b (= la_1 in Etienne &amp; Rosindell R2012) = speciation initiation rate <br />
<code>pars1[2]</code> corresponds to mu_1 (= mu_g in Etienne &amp; Rosindell 2012) = extinction rate of good species <br />
<code>pars1[3]</code> corresponds to la_1 (= la_2 in Etienne &amp; Rosindell 2012) = speciation completion rate <br />
<code>pars1[4]</code> corresponds to mu_2 (= mu_i in ER2012) = extinction rate of incipient species <br />
When rates depend on time this time dependence should be specified in pars1f and pars1 then becomes the parameters used in pars1f <br /> <br />
</p>
</td></tr>
<tr><td><code id="pbd_loglik_+3A_pars1f">pars1f</code></td>
<td>
<p>Vector of functions how the rates depend on time, default functions are constant functions of the parameters in pars1: <br /> <br />
<code>pars1f[1]</code> corresponds to time-dependence of b (= la_1 in Etienne &amp; Rosindell R2012) = speciation initiation rate <br />
<code>pars1f[2]</code> corresponds to time-dependence of mu_1 (= mu_g in Etienne &amp; Rosindell 2012) = extinction rate of good species <br />
<code>pars1f[3]</code> corresponds to tiem-dependence of la_1 (= la_2 in Etienne &amp; Rosindell 2012) = speciation completion rate <br />
<code>pars1f[4]</code> corresponds to time-dependence of mu_2 (= mu_i in ER2012) = extinction rate of incipient species <br /> <br />
</p>
</td></tr>
<tr><td><code id="pbd_loglik_+3A_pars2">pars2</code></td>
<td>
<p>Vector of model settings: <br /> <br />
<code>pars2[1]</code> set the conditioning on non-extinction of the clade (1) or not (0) <br /> <br />
<code>pars2[2]</code> sets whether the likelihood is for the branching times (0) or the phylogeny (1) <br /> <br />
<code>pars2[3]</code> sets whether the first element of the branching times is the stem (1) or the crown (2) age <br /> <br />
<code>pars2[4]</code> sets whether the parameters and likelihood should be shown on screen (1) or not (0) <br /> <br />
<code>pars2[5]</code> sets which method should be used in the ode-solver. Default is 'lsoda'. See package deSolve for details. <br /> <br />
<code>pars2[6]</code>Sets the lower bound of the number of species on which conditioning should be done when cond = 2. Set this to 0 when conditioning should be done on precisely the number of species (default)<br /> <br />
<code>pars2[7]</code>Sets the upper bound of the number of species on which conditioning should be done when cond = 2. Set this to 0 when conditioning should be done on precisely the number of species (default)<br /> <br />  
</p>
</td></tr>
<tr><td><code id="pbd_loglik_+3A_brts">brts</code></td>
<td>
<p>A set of branching times of a phylogeny, all positive </p>
</td></tr>
<tr><td><code id="pbd_loglik_+3A_missnumspec">missnumspec</code></td>
<td>
<p>The number of species that are in the clade but missing in the phylogeny </p>
</td></tr>
</table>


<h3>Value</h3>

<p>The loglikelihood</p>


<h3>Author(s)</h3>

<p> Rampal S. Etienne </p>


<h3>See Also</h3>

<p><code><a href="#topic+pbd_ML">pbd_ML</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'> pbd_loglik(pars1 = c(0.2,0.1,1,0.1), pars2 = c(1,1,2,0,"lsoda"),brts = 1:10) </code></pre>

<hr>
<h2 id='pbd_LR'>Bootstrap likelihood ratio test of protracted birth-death model of diversification
</h2><span id='topic+pbd_LR'></span>

<h3>Description</h3>

<p>This function computes the maximum likelihood and the associated estimates of the parameters of a protracted birth-death model of diversification for a given set of phylogenetic branching times. It then performs a bootstrap likelihood ratio test of the protracted birth-death (PBD) model against the constant-rates (CR) birth-death model. Finally, it computes the power of this test.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pbd_LR(
  brts,
  initparsoptPBD,
  initparsoptCR,
  missnumspec,
  outputfilename = NULL,
  seed = 42,
  endmc = 1000,
  alpha = 0.05,
  plotit = TRUE,
  parsfunc = c(function(t,pars) {pars[1]},
  function(t,pars) {pars[2]},
  function(t,pars) {pars[3]},
  function(t,pars) {pars[4]}),
  cond = 1,
  btorph = 1,
  soc = 2,
  methode = 'lsoda',
  n_low = 0,
  n_up = 0,
  tol = c(1E-6,1E-6,1E-6),
  maxiter = 2000,
  optimmethod = 'subplex',
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pbd_LR_+3A_brts">brts</code></td>
<td>
<p>A set of branching times of a phylogeny, all positive </p>
</td></tr>
<tr><td><code id="pbd_LR_+3A_initparsoptpbd">initparsoptPBD</code></td>
<td>
<p>The initial values of the parameters that must be optimized for the protracted birth-death (PBD) model: b, mu and lambda</p>
</td></tr>
<tr><td><code id="pbd_LR_+3A_initparsoptcr">initparsoptCR</code></td>
<td>
<p>The initial values of the parameters that must be optimized for the constant-rates (CR) model: b and mu</p>
</td></tr>
<tr><td><code id="pbd_LR_+3A_missnumspec">missnumspec</code></td>
<td>
<p>The number of species that are in the clade but missing in the phylogeny </p>
</td></tr>
<tr><td><code id="pbd_LR_+3A_outputfilename">outputfilename</code></td>
<td>
<p>The name (and location) of the file where the output will be saved. Default is no save.</p>
</td></tr>
<tr><td><code id="pbd_LR_+3A_seed">seed</code></td>
<td>
<p>The seed for the pseudo random number generator for simulating the bootstrap data</p>
</td></tr>
<tr><td><code id="pbd_LR_+3A_endmc">endmc</code></td>
<td>
<p>The number of bootstraps</p>
</td></tr>
<tr><td><code id="pbd_LR_+3A_alpha">alpha</code></td>
<td>
<p>The significance level of the test</p>
</td></tr>
<tr><td><code id="pbd_LR_+3A_plotit">plotit</code></td>
<td>
<p>Boolean to plot results or not</p>
</td></tr>
<tr><td><code id="pbd_LR_+3A_parsfunc">parsfunc</code></td>
<td>
<p>Specifies functions how the rates depend on time, default functions are constant functions</p>
</td></tr>
<tr><td><code id="pbd_LR_+3A_cond">cond</code></td>
<td>
<p> Conditioning: <br />
cond == 0 : conditioning on stem or crown age <br />
cond == 1 : conditioning on stem or crown age and non-extinction of the phylogeny <br />
cond == 2 : conditioning on stem or crown age and on the total number of extant taxa (including missing species) <br />
cond == 3 : conditioning on the total number of extant taxa (including missing species) <br />
Note: cond == 3 assumes a uniform prior on stem age, as is the standard in constant-rate birth-death models, see
e.g. D. Aldous &amp; L. Popovic 2004. Adv. Appl. Prob. 37: 1094-1115 and T. Stadler 2009. J. Theor. Biol. 261: 58-66.
</p>
</td></tr>
<tr><td><code id="pbd_LR_+3A_btorph">btorph</code></td>
<td>
<p>Sets whether the likelihood is for the branching times (0) or the phylogeny (1)</p>
</td></tr>
<tr><td><code id="pbd_LR_+3A_soc">soc</code></td>
<td>
<p>Sets whether stem or crown age should be used (1 or 2) </p>
</td></tr>
<tr><td><code id="pbd_LR_+3A_methode">methode</code></td>
<td>
<p>The numerical method used to solve the master equation, such as 'lsoda' or 'ode45'.</p>
</td></tr>
<tr><td><code id="pbd_LR_+3A_n_low">n_low</code></td>
<td>
<p>Sets the lower bound of the number of species on which conditioning should be done when cond = 2. Set this to 0 when conditioning should be done on precisely the number of species (default)</p>
</td></tr>
<tr><td><code id="pbd_LR_+3A_n_up">n_up</code></td>
<td>
<p>Sets the upper bound of the number of species on which conditioning should be done when cond = 2. Set this to 0 when conditioning should be done on precisely the number of species (default)</p>
</td></tr>
<tr><td><code id="pbd_LR_+3A_tol">tol</code></td>
<td>
<p>Sets the tolerances in the optimization. Consists of: <br />
reltolx = relative tolerance of parameter values in optimization <br />
reltolf = relative tolerance of function value in optimization <br />
abstolx = absolute tolerance of parameter values in optimization
</p>
</td></tr>
<tr><td><code id="pbd_LR_+3A_maxiter">maxiter</code></td>
<td>
<p>Sets the maximum number of iterations in the optimization</p>
</td></tr>
<tr><td><code id="pbd_LR_+3A_optimmethod">optimmethod</code></td>
<td>
<p>Method used in optimization of the likelihood. Current default is 'subplex'. Alternative is 'simplex'.</p>
</td></tr>
<tr><td><code id="pbd_LR_+3A_verbose">verbose</code></td>
<td>
<p>if TRUE, explanatory text will be shown</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The output is a list with 3 elements:
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>brtsCR</code></td>
<td>
<p>a list of sets of branching times generated under the constant-rates model using the ML parameters under the CR model</p>
</td></tr>
<tr><td><code>brtsDD</code></td>
<td>
<p>a list of sets of branching times generated under the protracted birth-death model using the ML parameters under the PBD model</p>
</td></tr>
<tr><td><code>out</code></td>
<td>
<p>a dataframe with the parameter estimates and maximum likelihoods for protracted birth-death and constant-rates models
<code>$model</code> - the model used to generate the data. 0 = unknown (for real data), 1 = CR, 2 = PBD <br />
<code>$mc</code> - the simulation number for each model <br />
<code>$b_CR</code> - speciation rate estimated under CR <br />
<code>$mu_CR</code> - extinction rate estimated under CR <br />
<code>$LL_CR</code> - maximum likelihood estimated under CR <br />
<code>$conv_CR</code> - convergence code for likelihood optimization; conv = 0 means convergence <br />
<code>$b_PBD1</code> - speciation-initation rate estimated under PBD for first set of initial values<br />
<code>$mu_PB1</code> - extinction rate estimated under DD for first set of initial values <br />
<code>$lambda_PB1</code> - speciation-completion rate estimated under PBD for first set of initial values <br />
<code>$LL_PBD1</code> - maximum likelihood estimated under DD for first set of initial values <br />
<code>$conv_PBD1</code> - convergence code for likelihood optimization for first set of initial values; conv = 0 means convergence <br />
<code>$b_PBD2</code> - speciation-initation rate estimated under PBD for second set of initial values<br />
<code>$mu_PB2</code> - extinction rate estimated under DD for second set of initial values <br />
<code>$lambda_PB2</code> - speciation-completion rate estimated under PBD for second set of initial values <br />
<code>$LL_PBD2</code> - maximum likelihood estimated under DD for second set of initial values <br />
<code>$conv_PBD2</code> - convergence code for likelihood optimization for second set of initial values; conv = 0 means convergence <br />
<code>$LR</code> - likelihood ratio between DD and CR
</p>
</td></tr>
<tr><td><code>pvalue</code></td>
<td>
<p>p-value of the test</p>
</td></tr>
<tr><td><code>LRalpha</code></td>
<td>
<p>Likelihood ratio at the signifiance level alpha</p>
</td></tr>
<tr><td><code>poweroftest</code></td>
<td>
<p>power of the test for significance level alpha</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p> Rampal S. Etienne </p>


<h3>References</h3>

<p>- Etienne, R.S. et al. 2016. Meth. Ecol. Evol. 7: 1092-1099, doi: 10.1111/2041-210X.12565 <br />
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pbd_loglik">pbd_loglik</a></code>,
<code><a href="#topic+pbd_ML">pbd_ML</a></code>
</p>

<hr>
<h2 id='pbd_ML'>Maximization of loglikelihood under protracted birth-death model of diversification</h2><span id='topic+pbd_ML'></span>

<h3>Description</h3>

<p>Likelihood maximization for protracted birth-death model of diversification</p>


<h3>Usage</h3>

<pre><code class='language-R'>pbd_ML(
   brts,
   initparsopt = c(0.2,0.1,1),
   idparsopt = 1:length(initparsopt),
   idparsfix = NULL,
   parsfix = NULL,
   exteq = 1,
   parsfunc = c(function(t,pars) {pars[1]},function(t,pars) {pars[2]},
function(t,pars) {pars[3]}, function(t,pars) {pars[4]}),
   missnumspec = 0,
   cond = 1,
   btorph = 1,
   soc = 2,
   methode = "lsoda",
   n_low = 0,
   n_up = 0,
   tol = c(1E-6, 1E-6, 1E-6),
   maxiter = 1000 * round((1.25)^length(idparsopt)),
   optimmethod = 'subplex',
   verbose = TRUE
)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pbd_ML_+3A_brts">brts</code></td>
<td>
<p>A set of branching times of a phylogeny, all positive </p>
</td></tr>
<tr><td><code id="pbd_ML_+3A_initparsopt">initparsopt</code></td>
<td>
<p>The initial values of the parameters that must be optimized</p>
</td></tr>
<tr><td><code id="pbd_ML_+3A_idparsopt">idparsopt</code></td>
<td>

<p>The ids of the parameters that must be optimized, e.g. 1:4 for all parameters.
The ids are defined as follows: <br />
id == 1 corresponds to b (speciation-initiation rate) <br />
id == 2 corresponds to mu_1 (extinction rate of good species) <br />
id == 3 corresponds to la_1 (speciation-completion rate) <br />
id == 4 corresponds to mu_2 (extinction rate of incipient species) <br />
</p>
</td></tr>
<tr><td><code id="pbd_ML_+3A_idparsfix">idparsfix</code></td>
<td>

<p>The ids of the parameters that should not be optimized, e.g. c(2,4) if mu_1 and mu_2
should not be optimized, but only b and la_1. In that case idparsopt must be c(1,3).
</p>
</td></tr>
<tr><td><code id="pbd_ML_+3A_parsfix">parsfix</code></td>
<td>
<p> The values of the parameters that should not be optimized </p>
</td></tr>
<tr><td><code id="pbd_ML_+3A_exteq">exteq</code></td>
<td>
<p>Sets whether incipient species have the same (1) or different (0) extinction rate as good species.
If exteq = 0, then idparsfix and idparsopt should together have all parameters 1:4
</p>
</td></tr>
<tr><td><code id="pbd_ML_+3A_parsfunc">parsfunc</code></td>
<td>
<p> Specifies functions how the rates depend on time, default functions are constant functions </p>
</td></tr>
<tr><td><code id="pbd_ML_+3A_missnumspec">missnumspec</code></td>
<td>

<p>The number of species that are in the clade but missing in the phylogeny </p>
</td></tr>
<tr><td><code id="pbd_ML_+3A_cond">cond</code></td>
<td>
<p>Conditioning: <br />
cond == 0 : conditioning on stem or crown age <br />
cond == 1 : conditioning on stem or crown age and non-extinction of the phylogeny <br />
cond == 2 : conditioning on stem or crown age and number of extant taxa <br />
</p>
</td></tr>
<tr><td><code id="pbd_ML_+3A_btorph">btorph</code></td>
<td>
<p>Sets whether the likelihood is for the branching times (0) or the phylogeny (1)</p>
</td></tr>
<tr><td><code id="pbd_ML_+3A_soc">soc</code></td>
<td>
<p>Sets whether the first element of the branching times is the stem (1) or the crown (2) age</p>
</td></tr>
<tr><td><code id="pbd_ML_+3A_methode">methode</code></td>
<td>
<p>Sets which method should be used in the ode-solver. Default is 'lsoda'.
See package deSolve for details.</p>
</td></tr>
<tr><td><code id="pbd_ML_+3A_n_low">n_low</code></td>
<td>
<p>Sets the lower bound of the number of species on which conditioning should be done when cond = 2. Set this to 0 when conditioning should be done on precisely the number of species (default)</p>
</td></tr>
<tr><td><code id="pbd_ML_+3A_n_up">n_up</code></td>
<td>
<p>Sets the upper bound of the number of species on which conditioning should be done when cond = 2. Set this to 0 when conditioning should be done on precisely the number of species (default)</p>
</td></tr>
<tr><td><code id="pbd_ML_+3A_tol">tol</code></td>
<td>
<p>Sets the tolerances in the optimization. Consists of: <br />
reltolx = relative tolerance of parameter values in optimization <br />
reltolf = relative tolerance of function value in optimization <br />
abstolx = absolute tolerance of parameter values in optimization
</p>
</td></tr>
<tr><td><code id="pbd_ML_+3A_maxiter">maxiter</code></td>
<td>
<p>Sets the maximum number of iterations in the optimization</p>
</td></tr>
<tr><td><code id="pbd_ML_+3A_optimmethod">optimmethod</code></td>
<td>
<p> Method used in optimization of the likelihood. Current default is 'subplex'. Alternative is 'simplex' (default of previous versions)</p>
</td></tr>
<tr><td><code id="pbd_ML_+3A_verbose">verbose</code></td>
<td>
<p> if TRUE, explanatory text will be shown</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with the following components:<br />
</p>
<table role = "presentation">
<tr><td><code>b</code></td>
<td>
<p> gives the maximum likelihood estimate of b</p>
</td></tr>
<tr><td><code>mu_1</code></td>
<td>
<p> gives the maximum likelihood estimate of mu_1</p>
</td></tr>
<tr><td><code>la_1</code></td>
<td>
<p> gives the maximum likelihood estimate of la_1</p>
</td></tr>
<tr><td><code>mu_2</code></td>
<td>
<p> gives the maximum likelihood estimate of mu_2</p>
</td></tr>
<tr><td><code>loglik</code></td>
<td>
<p> gives the maximum loglikelihood</p>
</td></tr>
<tr><td><code>df</code></td>
<td>
<p> gives the number of estimated parameters, i.e. degrees of feedom</p>
</td></tr>
<tr><td><code>conv</code></td>
<td>
<p> gives a message on convergence of optimization; conv = 0 means convergence</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Rampal S. Etienne
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pbd_loglik">pbd_loglik</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>pbd_ML(1:10,initparsopt = c(4.640321,4.366528,0.030521), exteq = 1)
</code></pre>

<hr>
<h2 id='pbd_sim'> Function to simulate the protracted speciation process </h2><span id='topic+pbd_sim'></span>

<h3>Description</h3>

<p> Simulating the protracted speciation process using the Doob-Gillespie algorithm.
This function differs from pbd_sim_cpp that 1) it does not require that the speciation-initiation
rate is the same for good and incipient species, and 2) that it simulates the exact protracted
speciation process, and not the approximation made by the coalescent point process. This function
provides also the conversion to the approximation as output.
</p>


<h3>Usage</h3>

<pre><code class='language-R'> pbd_sim(
   pars,
   age,
   soc = 2,
   plotit = FALSE,
   limitsize = Inf
) </code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pbd_sim_+3A_pars">pars</code></td>
<td>
<p>Vector of parameters: <br /> <br />
<code>pars[1]</code> corresponds to b_1, the speciation-initiation rate of good species <br />
<code>pars[2]</code> corresponds to la_1, the speciation-completion rate <br />
<code>pars[3]</code> corresponds to b_2, the speciation-initiation rate of incipient species <br />
<code>pars[4]</code> corresponds to mu_1, the extinction rate of good species <br />
<code>pars[5]</code> corresponds to mu_2, the extinction rate of incipient species <br />
</p>
</td></tr>
<tr><td><code id="pbd_sim_+3A_age">age</code></td>
<td>
<p> Sets the age for the simulation </p>
</td></tr>
<tr><td><code id="pbd_sim_+3A_soc">soc</code></td>
<td>
<p> Sets whether this age is the stem (1) or crown (2) age </p>
</td></tr>
<tr><td><code id="pbd_sim_+3A_plotit">plotit</code></td>
<td>
<p> Sets whether the various trees produced by the function should be plotted or not</p>
</td></tr>
<tr><td><code id="pbd_sim_+3A_limitsize">limitsize</code></td>
<td>
<p> Sets a maximum to the number of incipient + good species that are created during the simulation; if exceeded, the simulation is aborted and removed.</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>out</code></td>
<td>
<p> A list with the following elements: <br /> <br />
<code>tree</code> is the tree of extant species in phylo format <br />
<code>stree_random</code> is a tree with one random sample per species in phylo format <br />
<code>stree_oldest</code> is a tree with the oldest sample per species in phylo format <br />
<code>stree_youngest</code> is a tree with the youngest sample per species in phylo format <br />
<code>L</code> is a matrix of all events in the simulation where <br />
- the first column is the incipient-level label of a species <br />
- the second column is the incipient-level label of the parent of the species <br />
- the third column is the time at which a species is born as incipient species<br />
- the fourth column is the time of speciation-completion of the species <br />
If the fourth element equals -1, then the species is still incipient.
- the fifth column is the time of extinction of the species <br />
If the fifth element equals -1, then the species is still extant.
- The sixth column is the species-level label of the species <br />
<code>sL_random</code> is a matrix like L but for <code>stree_random</code> <br />
<code>sL_oldest</code> is a matrix like L but for <code>stree_oldest</code> <br />
<code>sL_youngest</code> is a matrix like L but for <code>stree_youngest</code> <br />
<code>igtree.extinct</code> is the tree in simmap format with incipient and good flags and including extinct species <br />
<code>igtree.extant</code> is the tree in simmap format with incipient and good flags without extinct species <br />
<code>recontree</code> is the reconstructed tree in phylo format, reconstructed using the approximation in Lambert et al. 2014 <br />
<code>reconL</code> is the matrix corresponding to <code>recontree</code> <br />
<code>L0</code> is a matrix where the crown age is at 0; for internal use only <br />
</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p> Rampal S. Etienne </p>


<h3>See Also</h3>

<p><code><a href="#topic+pbd_sim_cpp">pbd_sim_cpp</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'> pbd_sim(c(0.2,1,0.2,0.1,0.1),15) </code></pre>

<hr>
<h2 id='pbd_sim_cpp'> Function to simulate the approximate protracted speciation process </h2><span id='topic+pbd_sim_cpp'></span>

<h3>Description</h3>

<p> Simulating the protracted speciation process according to the approxiomate model of Lambert et al. 2014.
This function differs from pbd_sim that 1) it requires that the speciation-initiation
rate is the same for good and incipient species, and 2) that it does not simulate the exact protracted
speciation process, but an approximation made by the coalescent point process. </p>


<h3>Usage</h3>

<pre><code class='language-R'> pbd_sim_cpp(
  pars,
  parsf = c(function(t,pars) {pars[1]},function(t,pars) {pars[2]},
function(t,pars) {pars[3]},function(t,pars) {pars[4]}),
  age,
  soc = 2,
  plotltt = 1,
  methode = "lsoda"
)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pbd_sim_cpp_+3A_pars">pars</code></td>
<td>
<p>Vector of parameters: <br /> <br />
<code>pars[1]</code> corresponds to b (= la_1 in Etienne &amp; Rosindell R2012) = speciation initiation rate <br />
<code>pars[2]</code> corresponds to mu_1 (= mu_g in Etienne &amp; Rosindell 2012) = extinction rate of good species <br />
<code>pars[3]</code> corresponds to la_1 (= la_2 in Etienne &amp; Rosindell 2012) = speciation completion rate <br />
<code>pars[4]</code> corresponds to mu_2 (= mu_i in ER2012) = extinction rate of incipient species <br />
When rates depend on time this time dependence should be specified in pars1f and pars1 then becomes the parameters used in pars1f <br /> <br />
</p>
</td></tr>
<tr><td><code id="pbd_sim_cpp_+3A_parsf">parsf</code></td>
<td>
<p>Vector of functions how the rates depend on time, default functions are constant functions of the parameters in pars1: <br /> <br />
<code>parsf[1]</code> corresponds to time-dependence of b (= la_1 in Etienne &amp; Rosindell R2012) = speciation initiation rate <br />
<code>parsf[2]</code> corresponds to time-dependence of mu_1 (= mu_g in Etienne &amp; Rosindell 2012) = extinction rate of good species <br />
<code>parsf[3]</code> corresponds to tiem-dependence of la_1 (= la_2 in Etienne &amp; Rosindell 2012) = speciation completion rate <br />
<code>parsf[4]</code> corresponds to time-dependence of mu_2 (= mu_i in ER2012) = extinction rate of incipient species <br /> <br />
</p>
</td></tr>
<tr><td><code id="pbd_sim_cpp_+3A_age">age</code></td>
<td>
<p> Sets the crown age for the simulation </p>
</td></tr>
<tr><td><code id="pbd_sim_cpp_+3A_soc">soc</code></td>
<td>
<p> Determines whether the simulation should start at stem (1) or crown (2) age </p>
</td></tr>
<tr><td><code id="pbd_sim_cpp_+3A_plotltt">plotltt</code></td>
<td>
<p>Sets whether the lineage-through-time plot should be plotted (1) or not (0) </p>
</td></tr>
<tr><td><code id="pbd_sim_cpp_+3A_methode">methode</code></td>
<td>
<p>Sets which method should be used in the ode-solver. Default is 'lsoda'.
See package deSolve for details.</p>
</td></tr>
</table>


<h3>Value</h3>

<p> A set of branching times </p>


<h3>Author(s)</h3>

<p> Rampal S. Etienne </p>


<h3>See Also</h3>

<p><code><a href="#topic+pbd_sim">pbd_sim</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'> pbd_sim_cpp(pars = c(0.2,1,0.2,0.1),age = 15) </code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
