<!DOCTYPE html><html><head><title>Help for package GeoAdjust</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {GeoAdjust}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#dummy'><p>Roxygen commands</p></a></li>
<li><a href='#estimateModel'><p>Estimates model parameters</p></a></li>
<li><a href='#gridCountry'><p>Creates a grid of locations within the bounding box of the national borders of a country of interest.</p></a></li>
<li><a href='#meshCountry'><p>Creates a constrained refined Delaunay triangulation mesh based on the country borders.</p></a></li>
<li><a href='#plotPred'><p>Plots the predictions and the corresponding uncertainty (coefficient of</p>
variation)</a></li>
<li><a href='#predRes'><p>Predicts model outcomes at new locations.</p></a></li>
<li><a href='#prepareInput'><p>Prepares input data list for the model estimation with estimateModel()</p>
function.</a></li>
<li><a href='#print.res'><p>Prints the output of estimateModel() function.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Accounting for Random Displacements of True GPS Coordinates of
Data</td>
</tr>
<tr>
<td>Version:</td>
<td>2.0.0</td>
</tr>
<tr>
<td>Description:</td>
<td>The purpose is to account for the random displacements 
 (jittering) of true survey household cluster center coordinates in geostatistical 
 analyses of Demographic and Health Surveys program (DHS) data. Adjustment for 
 jittering can be implemented either in the spatial random effect, or in the 
 raster/distance based covariates, or in both. Detailed information about the methods 
 behind the package functionality can be found in two preprints.
 Umut Altay, John Paige, Andrea Riebler, Geir-Arne Fuglstad (2022) &lt;<a href="https://arxiv.org/abs/2202.11035v2">arXiv:2202.11035v2</a>&gt;. 
 Umut Altay, John Paige, Andrea Riebler, Geir-Arne Fuglstad (2022) &lt;<a href="https://arxiv.org/abs/2211.07442v1">arXiv:2211.07442v1</a>&gt;. </td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat (&ge; 3.0.0),</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5)</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>TMB, RcppEigen</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Imports:</td>
<td>fmesher, terra, sf, stats, SUMMER, Matrix, ggplot2, fields,
TMB</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-09-15 18:19:08 UTC; umuta</td>
</tr>
<tr>
<td>Author:</td>
<td>Umut Altay [cre, aut],
  John Paige [aut],
  Geir-Arne Fuglstad [aut],
  Andrea Riebler [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Umut Altay &lt;altayumut.ua@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-09-15 20:54:36 UTC</td>
</tr>
</table>
<hr>
<h2 id='dummy'>Roxygen commands</h2><span id='topic+dummy'></span>

<h3>Description</h3>

<p>Roxygen commands
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dummy()
</code></pre>

<hr>
<h2 id='estimateModel'>Estimates model parameters</h2><span id='topic+estimateModel'></span>

<h3>Description</h3>

<p>Estimates model parameters
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimateModel(
  data = NULL,
  options = NULL,
  priors = NULL,
  n.sims = NULL,
  log_tau = NULL,
  log_kappa = NULL,
  USpatial = 1,
  alphaSpatial = 0.05,
  UNugget = 1,
  alphaNug = 0.05
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estimateModel_+3A_data">data</code></td>
<td>
<p>A data input list that is created by prepareInput() function.</p>
</td></tr>
<tr><td><code id="estimateModel_+3A_options">options</code></td>
<td>
<p>A list containing two components, namely, random and covariates.
The function accounts for jittering both in the spatial random effect and in
covariates (if there are any) by default. However, the jittering adjustment
can be turned off in either the random effect or in covariates, or both, by
setting the corresponding component of the list to zero.</p>
</td></tr>
<tr><td><code id="estimateModel_+3A_priors">priors</code></td>
<td>
<p>A list of two components. Beta is a vector of two elements and
passes the parameters of the Gaussian prior that will be assigned to the covariates
(including the intercept). The first element of it is the mean and the second
one is the standard deviation of Gaussian prior. Range is a value representing
the median range in kilometers, which will be used for constructing the
PC (Penalized-complexity) priors.</p>
</td></tr>
<tr><td><code id="estimateModel_+3A_n.sims">n.sims</code></td>
<td>
<p>number of samples to be drawn for each model parameter</p>
</td></tr>
<tr><td><code id="estimateModel_+3A_log_tau">log_tau</code></td>
<td>
<p>SPDE parameter related to the spatial precision</p>
</td></tr>
<tr><td><code id="estimateModel_+3A_log_kappa">log_kappa</code></td>
<td>
<p>SPDE parameter related to the range and spatial precision</p>
</td></tr>
<tr><td><code id="estimateModel_+3A_uspatial">USpatial</code></td>
<td>
<p>The threshold that is crossed by the the variance prior.</p>
</td></tr>
<tr><td><code id="estimateModel_+3A_alphaspatial">alphaSpatial</code></td>
<td>
<p>The probability of crossing the threshold for the variance prior.</p>
</td></tr>
<tr><td><code id="estimateModel_+3A_unugget">UNugget</code></td>
<td>
<p>The threshold that is crossed by the prior on the nugget standard
deviation. It will only be used when the likelihood is Gaussian.</p>
</td></tr>
<tr><td><code id="estimateModel_+3A_alphanug">alphaNug</code></td>
<td>
<p>The probability  of crossing the threshold for the
prior on the nugget standard deviation. It will only be used when the likelihood
is Gaussian.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Model estimation results of class GAmodel. The output consists of four
elements: A data frame containing the estimated model parameters and the
corresponding 95
from autodifferentiation of TMB, A matrix containing the sampled coefficient
effect sizes and the random effect coefficients, A character string indicating
the likelihood type in the model.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
path1 &lt;- system.file("extdata", "exampleInputData.rda", package = "GeoAdjust")
path2 &lt;- system.file("extdata", "exampleMesh.rda", package = "GeoAdjust")
load(path1)
load(path2)
results &lt;- estimateModel(data = exampleInputData, priors = list(beta = c(0,1),
range = 114), USpatial = 1, alphaSpatial = 0.05, UNugget = 1, alphaNug = 0.05, n.sims = 1000)

</code></pre>

<hr>
<h2 id='gridCountry'>Creates a grid of locations within the bounding box of the national borders of a country of interest.</h2><span id='topic+gridCountry'></span>

<h3>Description</h3>

<p>Creates a grid of locations within the bounding box of the national borders of a country of interest.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gridCountry(admin0 = NULL, res = NULL, target_crs = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gridCountry_+3A_admin0">admin0</code></td>
<td>
<p>An sf class MULTIPOLYGON representing the country borders.</p>
</td></tr>
<tr><td><code id="gridCountry_+3A_res">res</code></td>
<td>
<p>A value representing the resolution in kilometers.</p>
</td></tr>
<tr><td><code id="gridCountry_+3A_target_crs">target_crs</code></td>
<td>
<p>A projection string representing the desired coordinate
reference system according to which the prediction grid will be constructed.
The measurement unit of the target_crs should be in kilometers.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list. The first element of the list, predRast, is a SpatRaster object.
The second element of the list, loc.pred, is an sf class POINT object containing
coordinates of the cell centers (in target_crs) of the prediction raster.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>path1 &lt;- system.file("extdata", "geoData.rda", package = "GeoAdjust")
load(path1)
crs_KM = "+units=km +proj=utm +zone=37 +ellps=clrk80 +towgs84=-160,-6,-302,0,0,0,0 +no_defs"
grid = gridCountry(admin0 = adm0, res = 5, target_crs = crs_KM)
</code></pre>

<hr>
<h2 id='meshCountry'>Creates a constrained refined Delaunay triangulation mesh based on the country borders.</h2><span id='topic+meshCountry'></span>

<h3>Description</h3>

<p>Creates a constrained refined Delaunay triangulation mesh based on the country borders.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>meshCountry(
  admin0 = NULL,
  max.edge = NULL,
  cutoff = NULL,
  offset = NULL,
  target_crs = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="meshCountry_+3A_admin0">admin0</code></td>
<td>
<p>An sf class multipolygon representing the country borders.</p>
</td></tr>
<tr><td><code id="meshCountry_+3A_max.edge">max.edge</code></td>
<td>
<p>A vector of two values. The first and the second elements of
the vector represent the largest allowed triangle lengths for the inner and
outer mesh, respectively.</p>
</td></tr>
<tr><td><code id="meshCountry_+3A_cutoff">cutoff</code></td>
<td>
<p>The minimum allowed distance of the vertices to each other.</p>
</td></tr>
<tr><td><code id="meshCountry_+3A_offset">offset</code></td>
<td>
<p>A value representing the extension distance for the mesh.</p>
</td></tr>
<tr><td><code id="meshCountry_+3A_target_crs">target_crs</code></td>
<td>
<p>A projection string representing the desired coordinate
reference system according to which the mesh will be constructed. The
measurement unit of the target_crs should be in kilometers.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A constrained refined Delaunay triangulation mesh created based on
the country borders.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>path1 &lt;- system.file("extdata", "geoData.rda", package = "GeoAdjust")
load(path1)
crs_KM = "+units=km +proj=utm +zone=37 +ellps=clrk80
+towgs84=-160,-6,-302,0,0,0,0 +no_defs"
mesh.s &lt;- meshCountry(admin0= adm0, max.edge = c(25, 50), offset = -.08,
cutoff=4, target_crs = crs_KM)
</code></pre>

<hr>
<h2 id='plotPred'>Plots the predictions and the corresponding uncertainty (coefficient of
variation)</h2><span id='topic+plotPred'></span>

<h3>Description</h3>

<p>Plots the predictions and the corresponding uncertainty (coefficient of
variation)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotPred(
  pred = NULL,
  predRaster = NULL,
  admin0 = NULL,
  admin1 = NULL,
  admin2 = NULL,
  rmPoly = NULL,
  target_crs = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotPred_+3A_pred">pred</code></td>
<td>
<p>A matrix that is the output of predRes() function.</p>
</td></tr>
<tr><td><code id="plotPred_+3A_predraster">predRaster</code></td>
<td>
<p>The prediction raster that is constructed by the
gridCountry() function.</p>
</td></tr>
<tr><td><code id="plotPred_+3A_admin0">admin0</code></td>
<td>
<p>An sf class MULTIPOLYGON representing the national level (admin0)
borders of the country.</p>
</td></tr>
<tr><td><code id="plotPred_+3A_admin1">admin1</code></td>
<td>
<p>An sf class MULTIPOLYGON representing the first level (admin1)
subnational borders of the country.</p>
</td></tr>
<tr><td><code id="plotPred_+3A_admin2">admin2</code></td>
<td>
<p>An sf class MULTIPOLYGON representing the second level (admin2)
subnational borders of the country.</p>
</td></tr>
<tr><td><code id="plotPred_+3A_rmpoly">rmPoly</code></td>
<td>
<p>A number referring to the ID number of the admin2 level polygon
that needs to be left uncolored. It can be set to NULL as well.</p>
</td></tr>
<tr><td><code id="plotPred_+3A_target_crs">target_crs</code></td>
<td>
<p>A projection string representing the desired coordinate
reference system according to which the maps will be created.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of two ggplot objects. One of them (ggPred) shows the median
predictions and the other one (ggUncertainty) shows the
corresponding coefficient of variations across the country, respectively.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
path1 &lt;- system.file("extdata", "examplePredictionResults.rda", package = "GeoAdjust")
path2 &lt;- system.file("extdata", "geoData.rda", package = "GeoAdjust")
load(path1)
load(path2)
crs_KM = "+units=km +proj=utm +zone=37 +ellps=clrk80 +towgs84=-160,-6,-302,0,0,0,0 +no_defs"
exampleGrid &lt;- gridCountry(admin0 = adm0, res = 5, target_crs = crs_KM)
plots = plotPred(pred = examplePredictionResults,
predRaster = exampleGrid[["predRast"]], admin0 = adm0,
admin1 = adm1, target_crs = crs_KM)

</code></pre>

<hr>
<h2 id='predRes'>Predicts model outcomes at new locations.</h2><span id='topic+predRes'></span>

<h3>Description</h3>

<p>Predicts model outcomes at new locations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predRes(
  obj = NULL,
  predCoords = NULL,
  draws = NULL,
  covariateData = NULL,
  mesh.s = NULL,
  flag = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predRes_+3A_obj">obj</code></td>
<td>
<p>The optimized core model object returned by estimateModel() function.</p>
</td></tr>
<tr><td><code id="predRes_+3A_predcoords">predCoords</code></td>
<td>
<p>An sf class POINT object containing the coordinates of the
prediction locations. It should contain crs information.</p>
</td></tr>
<tr><td><code id="predRes_+3A_draws">draws</code></td>
<td>
<p>A matrix containing 10.000 sampled values for each covariate effect
size and 10.000 sampled values of random effect coefficients for each mesh node.
It is one of the elements of the returning output list of estimateModel() function.</p>
</td></tr>
<tr><td><code id="predRes_+3A_covariatedata">covariateData</code></td>
<td>
<p>A list containing the covariate rasters. Each covariate
raster should be SpatRast object and contain crs information.</p>
</td></tr>
<tr><td><code id="predRes_+3A_mesh.s">mesh.s</code></td>
<td>
<p>A mesh created based on the country borders.</p>
</td></tr>
<tr><td><code id="predRes_+3A_flag">flag</code></td>
<td>
<p>A value indicating the type of the likelihood that will be used.
Pass 0 for Gaussian, 1 for binomial and 2 for Poisson likelihoods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix containing the mean, median,standard deviation and the lower
and the upper bounds of 95
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
path1 &lt;- system.file("extdata", "exampleInputData.rda", package = "GeoAdjust")
path2 &lt;- system.file("extdata", "exampleMesh.rda", package = "GeoAdjust")
path3 &lt;- system.file("extdata", "geoData.rda", package = "GeoAdjust")
load(path1)
load(path2)
load(path3)
results &lt;- estimateModel(data = exampleInputData,
options = list(random = 1, covariates = 1), priors = list(beta = c(0,1),
range = 114), USpatial = 1, alphaSpatial = 0.05, UNugget = 1, alphaNug = 0.05, n.sims = 1000)
crs_KM = "+units=km +proj=utm +zone=37 +ellps=clrk80 +towgs84=-160,-6,-302,0,0,0,0 +no_defs"
exampleGrid &lt;- gridCountry(admin0 = adm0, res = 5, target_crs = crs_KM)
pred = predRes(obj = results[["obj"]],
predCoords = exampleGrid[["loc.pred"]],
draws = results[["draws"]],
mesh.s = exampleMesh, covariateData = NULL, flag = 1)

</code></pre>

<hr>
<h2 id='prepareInput'>Prepares input data list for the model estimation with estimateModel()
function.</h2><span id='topic+prepareInput'></span>

<h3>Description</h3>

<p>Prepares input data list for the model estimation with estimateModel()
function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prepareInput(
  response = NULL,
  locObs = NULL,
  likelihood,
  jScale = 1,
  urban = NULL,
  mesh.s = NULL,
  adminMap = NULL,
  covariateData = NULL,
  target_crs
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="prepareInput_+3A_response">response</code></td>
<td>
<p>A list containing the number of trials (ns) and number of
successes (ys) for the binomial model, response
values (ys) for the Gaussian model or the Poisson counts for the Poisson
model.</p>
</td></tr>
<tr><td><code id="prepareInput_+3A_locobs">locObs</code></td>
<td>
<p>An sf class multipoint object containing the coordinates of DHS
survey cluster centers. (It should contain the crs information.)</p>
</td></tr>
<tr><td><code id="prepareInput_+3A_likelihood">likelihood</code></td>
<td>
<p>A value indicating which likelihood model should be used
(0, 1 or 2 for Gaussian, binomial or Poisson, respectively).</p>
</td></tr>
<tr><td><code id="prepareInput_+3A_jscale">jScale</code></td>
<td>
<p>Jittering scale, where 1 represents the default DHS jittering
scheme. It allows experimenting with larger jittering scales. Otherwise should
remain as 1.</p>
</td></tr>
<tr><td><code id="prepareInput_+3A_urban">urban</code></td>
<td>
<p>A vector containing the urbanization classification of the
administrative area that each cluster center is initially located within
(U for urban and R for rural).</p>
</td></tr>
<tr><td><code id="prepareInput_+3A_mesh.s">mesh.s</code></td>
<td>
<p>A triangulation mesh. It should be constructed in the
target_crs.</p>
</td></tr>
<tr><td><code id="prepareInput_+3A_adminmap">adminMap</code></td>
<td>
<p>An sf class multipolygon object. It contains the borders of
the administrative area level that was respected while the cluster centers
were initially being jittered (can be obtained from https://gadm.org). It
should contain crs information.</p>
</td></tr>
<tr><td><code id="prepareInput_+3A_covariatedata">covariateData</code></td>
<td>
<p>A list containing the covariates as SpatRaster objects.
Each SpatRaster should contain the crs information.</p>
</td></tr>
<tr><td><code id="prepareInput_+3A_target_crs">target_crs</code></td>
<td>
<p>A projection string representing the desired coordinate
reference system according to which, the integration rings and integration
points will be located. The measurement unit of the target_crs should be in
kilometers.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the data input for estimateModel() function.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>path1 &lt;- system.file("extdata", "geoData.rda", package = "GeoAdjust")
path2 &lt;- system.file("extdata", "exampleMesh.rda", package = "GeoAdjust")
load(path1)
load(path2)
crs_KM = "+units=km +proj=utm +zone=37 +ellps=clrk80 +towgs84=-160,-6,-302,0,0,0,0 +no_defs"
crs_Degrees = "+proj=longlat +datum=WGS84"
locObs = data.frame(long = surveyData$long, lat = surveyData$lat)
locObs = sf::st_as_sf(locObs, coords=c("long","lat"), crs = crs_Degrees)
inputData &lt;- prepareInput(response = list(ys = surveyData$ys, ns = surveyData$ns),
locObs = locObs, likelihood = 1, jScale = 1,
urban = surveyData$urbanRural, mesh.s = exampleMesh, adminMap = adm1,
covariateData = NULL, target_crs = crs_KM)
</code></pre>

<hr>
<h2 id='print.res'>Prints the output of estimateModel() function.</h2><span id='topic+print.res'></span>

<h3>Description</h3>

<p>Prints the output of estimateModel() function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'res'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.res_+3A_x">x</code></td>
<td>
<p>A list containing the model estimation output, returned by
estimateModel() function.</p>
</td></tr>
<tr><td><code id="print.res_+3A_...">...</code></td>
<td>
<p>not used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Prints the model estimation results of class GAmodel as a table that
shows the estimated model parameters and the corresponding 95
interval lengths.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
path1 &lt;- system.file("extdata", "exampleInputData.rda", package = "GeoAdjust")
load(path1)
results &lt;- estimateModel(data = exampleInputData,
options = list(random = 1, covariates = 1), priors = list(beta = c(0,1),
range = 114, USpatial = 1, alphaSpatial = 0.05, UNugget = 1, alphaNug = 0.05), n.sims = 1000)
print(results)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
