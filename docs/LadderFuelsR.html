<!DOCTYPE html><html><head><title>Help for package LadderFuelsR</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {LadderFuelsR}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#calculate_gaps_perc'><p>Compute the percentile value of each height</p></a></li>
<li><a href='#get_cbh_metrics'><p>Methods to estimated the canopy Base Height of a tree: maximum LAD percentage, maximum distance and the last distance</p></a></li>
<li><a href='#get_cum_break'><p>CBH estimation using the breaking point method and the LAD percentage below and above the CBH</p></a></li>
<li><a href='#get_depths'><p>Fuels depth in meters</p></a></li>
<li><a href='#get_distance'><p>Distances between fuel layers</p></a></li>
<li><a href='#get_effective_gap'><p>Effective Distances between fuel layers</p></a></li>
<li><a href='#get_gaps_fbhs'><p>Gaps and Fuel layers Base Height (FBH)</p></a></li>
<li><a href='#get_layers_lad'><p>Leaf Area Density (LAD) percentage comprised in each effective fuel layer</p></a></li>
<li><a href='#get_plots_cbh_bp'><p>Plot of the Canopy Base Height (CBH) based on the breaking point method</p></a></li>
<li><a href='#get_plots_cbh_LAD'><p>Plots the Canopy Base Height (CBH) based on the maximum LAD percentage criterium</p></a></li>
<li><a href='#get_plots_cbh_lastdist'><p>Plots the Canopy Base Height (CBH) based on the last distance criterium</p></a></li>
<li><a href='#get_plots_cbh_maxdist'><p>Plots the Canopy Base Height (CBH) based on the maximum LAD percentage criterium</p></a></li>
<li><a href='#get_plots_effective'><p>Plots of fuel layers with LAD percentage greater than a specified threshold</p></a></li>
<li><a href='#get_plots_gap_fbh'><p>Plots of tree profiles with gaps and fuel layers base height (fbh)</p></a></li>
<li><a href='#get_real_depths'><p>Effective fuel layers depth</p></a></li>
<li><a href='#get_real_fbh'><p>Fuels base height after removing distances = 1 m</p></a></li>
<li><a href='#get_renamed_df'><p>Rename and reorder columns (II)</p></a></li>
<li><a href='#get_renamed0_df'><p>Rename and reorder columns (I)</p></a></li>
<li><a href='#remove_no_flayer_noconsec'><p>Remove non-consecutive fuel layers with a Leaf Area Density (LAD) less than a specified threshold</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Automated Tool for Vertical Fuel Continuity Analysis using
Airborne Laser Scanning Data</td>
</tr>
<tr>
<td>Version:</td>
<td>0.0.4</td>
</tr>
<tr>
<td>Description:</td>
<td>Set of tools for analyzing vertical fuel continuity at the tree level using Airborne Laser Scanning data. The workflow consisted of: 1) calculating the vertical height profiles of each segmented tree; 2) identifying gaps and fuel layers; 3) estimating the distance between fuel layers; and 4) retrieving the fuel layers base height and depth. Additionally, other functions recalculate previous metrics after considering distances greater than 1 m and calculate the canopy base height as the fuel base height located at the largest- and at the last-distance. Moreover, the package calculates: i) the percentage of Leaf Area Density comprised in each fuel layer, ii) remove fuel layers with Leaf Area Density percentage less than 25, iii) recalculate the distances among the reminder ones, and iv) identify the canopy base height as the fuel base height with the highest Leaf Area Density percentage. On the other hand, when there is only one fuel layer, it identifies the canopy base height performing a segmented linear regression (breaking points) on the cumulative sum of Leaf Area Density as a function of height. Finally, a collection of plotting functions is developed to represent: i) the initial gaps and fuel layers; ii) the fuels base height, depths and gaps with distances greater than 1 m and, iii) the fuels base height and depths after applying the breaking point method over trees with only one fuel layer. The methods implemented in this package are original and have not been published elsewhere.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/olgaviedma/LadderFuelsR">https://github.com/olgaviedma/LadderFuelsR</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr, gdata, ggplot2, magrittr, segmented, stringr, tidyr,
tibble, tidyselect</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Collate:</td>
<td>'calculate_gaps_perc.R' 'gap_fbh.R' 'distances_calculation.R'
'depths_calculation.R' 'corrected_base_heights.R'
'corrected_depth.R' 'corrected_distances.R'
'maxlad_metrics_25perc.R' 'remove_no_flayer_noconsec.R'
'cbh_metrics.R' 'cummLAD_breaks_metrics.R' 'plot_cbh_bpoint.R'
'plot_gaps_fbhs.R' 'plot_cbh_maxdist.R' 'plot_cbh_lastdist.R'
'plot_cbh_maxlad.R' 'plot_effective_metrics.R' 'renamed0_df.R'
'renamed_df.R'</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/olgaviedma/LadderFuelsR/issues">https://github.com/olgaviedma/LadderFuelsR/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-03-18 21:35:43 UTC; Olga.Viedma</td>
</tr>
<tr>
<td>Author:</td>
<td>Olga Viedma [aut, cph, cre],
  Carlos Alberto Silva [aut, cph],
  Jose Manuel Moreno [aut, cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Olga Viedma &lt;olga.viedma@uclm.es&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-03-18 23:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='calculate_gaps_perc'>Compute the percentile value of each height</h2><span id='topic+calculate_gaps_perc'></span>

<h3>Description</h3>

<p>This function calculates the percentile value of each height
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_gaps_perc (LAD_profiles)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calculate_gaps_perc_+3A_lad_profiles">LAD_profiles</code></td>
<td>
<p>original tree Leaf Area Density (LAD) profile (output of [lad.profile()] function in the <em>leafR</em> package.
An object of the class text</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame giving the percentile value of each height.
</p>


<h3>Author(s)</h3>

<p>Olga Viedma, Carlos Silva and JM Moreno
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(magrittr)
library(dplyr)

# LAD profiles derived from normalized ALS data after applying [lad.profile()] function
LAD_profiles &lt;- read.table(system.file("extdata", "LAD_profiles.txt", package = "LadderFuelsR"),
header = TRUE)
LAD_profiles$treeID &lt;- factor(LAD_profiles$treeID)

trees_name1 &lt;- as.character(LAD_profiles$treeID)
trees_name2 &lt;- factor(unique(trees_name1))

percentile_list1&lt;-list()

for (i in levels(trees_name2)) {
tree1 &lt;- LAD_profiles |&gt; dplyr::filter(treeID == i)
percentiles &lt;- calculate_gaps_perc(tree1)
percentile_list1[[i]] &lt;- percentiles
}
gaps_perc &lt;- dplyr::bind_rows(percentile_list1)
gaps_perc$treeID &lt;- factor(gaps_perc$treeID)

</code></pre>

<hr>
<h2 id='get_cbh_metrics'>Methods to estimated the canopy Base Height of a tree: maximum LAD percentage, maximum distance and the last distance</h2><span id='topic+get_cbh_metrics'></span>

<h3>Description</h3>

<p>This function determines the CBH of a segmented tree using three criteria: maximum LAD percentage, maximum distance and the last distance.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_cbh_metrics(effective_LAD, verbose=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_cbh_metrics_+3A_effective_lad">effective_LAD</code></td>
<td>
<p>Tree metrics with gaps (distances), fuel base heights, and depths of fuel layers with LAD percentage greater than a threshold.
(output of [get_layers_lad()] function).
An object of the class text.</p>
</td></tr>
<tr><td><code id="get_cbh_metrics_+3A_verbose">verbose</code></td>
<td>
<p>Logical, indicating whether to display informational messages (default is TRUE).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>List of tree metrics:
</p>

<ul>
<li><p> treeID: tree ID with strings and numeric values
</p>
</li>
<li><p> treeID1: tree ID with only numeric values
</p>
</li>
<li><p> dist: Distance between consecutive fuel layers (m)
</p>
</li>
<li><p> Hdist: Height of the distance between consecutive fuel layers (m)
</p>
</li>
<li><p> Hcbh: Height of the base of each fuel layer (m)
</p>
</li>
<li><p> effdist: Effective distance between consecutive fuel layers (m) (&gt; 1 m)
</p>
</li>
<li><p> dptf: Depth of fuel layers (m) at distances greater than 1 m
</p>
</li>
<li><p> Hdptf: Height of the depth of fuel layers (m) at distances greater than 1 m
</p>
</li>
<li><p> maxlad_Hcbh - Height of the CBH of the segmented tree based on the maximum LAD percentage
</p>
</li>
<li><p> max_Hcbh - Height of the CBH of the segmented tree based on the maximum distance found in its profile
</p>
</li>
<li><p> last_Hcbh - Height of the CBH of the segmented tree based on the last distance found in its profile
</p>
</li>
<li><p> maxlad_ - Values of distance and fuel depth and their corresponding heights at the maximum LAD percentage
</p>
</li>
<li><p> max_ - Values of distance and fuel depth and their corresponding heights at the maximum distance
</p>
</li>
<li><p> last_ - Values of distance and fuel depth and their corresponding heights at the last distance
</p>
</li>
<li><p> nlayers - Number of effective fuel layers
</p>
</li>
<li><p> max_height - Maximum height of the tree profile
</p>
</li></ul>



<h3>Value</h3>

<p>A data frame giving the Canopy Base Height (CBH) of a tree using three criteria: maximum LAD percentage, maximum distance and the last distance.
</p>


<h3>Author(s)</h3>

<p>Olga Viedma, Carlos Silva and JM Moreno
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_layers_lad">get_layers_lad</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(magrittr)
library(stringr)
library(dplyr)

# Before running this example, make sure to run get_real_depths().
if (interactive()) {
effective_LAD &lt;- get_layers_lad()
LadderFuelsR::effective_LAD$treeID &lt;- factor(LadderFuelsR::effective_LAD$treeID)

trees_name1 &lt;- as.character(effective_LAD$treeID)
trees_name2 &lt;- factor(unique(trees_name1))

cbh_dist_list &lt;- list()

for (i in levels(trees_name2)) {
tree1 &lt;- effective_LAD |&gt; dplyr::filter(treeID == i)
cbh_dist_metrics &lt;- get_cbh_metrics(tree1, verbose=TRUE)
cbh_dist_list[[i]] &lt;- cbh_dist_metrics
}

# Combine the individual data frames
cbh_metrics &lt;- dplyr::bind_rows(cbh_dist_list)

# Get original column names
original_column_names &lt;- colnames(cbh_metrics)

# Specify prefixes
desired_order &lt;- c("treeID", "Hcbh", "dptf","effdist","dist", "Hdist", "Hdptf", "max_","last_",
"maxlad_", "nlayers")

# Identify unique prefixes
prefixes &lt;- unique(sub("^([a-zA-Z]+).*", "\\1", original_column_names))
# Initialize vector to store new order
new_order &lt;- c()

# Loop over desired order of prefixes
for (prefix in desired_order) {
 # Find column names matching the current prefix
matching_columns &lt;- grep(paste0("^", prefix), original_column_names, value = TRUE)
# Append to the new order
new_order &lt;- c(new_order, matching_columns)
}
# Reorder values
cbh_metrics &lt;- cbh_metrics[, new_order]
}
</code></pre>

<hr>
<h2 id='get_cum_break'>CBH estimation using the breaking point method and the LAD percentage below and above the CBH</h2><span id='topic+get_cum_break'></span>

<h3>Description</h3>

<p>This function calculates the canopy base height (CBH) of the vertical tree profile (VTP) using a segmented regression model fitted
to the cumulative LAD values as a function of height.The function also calculates the percentage of LAD values below and above the identified
CBH or breaking point.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_cum_break(LAD_profiles, cbh_metrics, threshold=75, verbose=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_cum_break_+3A_lad_profiles">LAD_profiles</code></td>
<td>
<p>Original tree Leaf Area Density (LAD) profile (output of [lad.profile()] function in the <em>leafR</em> package).
An object of the class data frame.</p>
</td></tr>
<tr><td><code id="get_cum_break_+3A_cbh_metrics">cbh_metrics</code></td>
<td>
<p>CBH metrics based on three criteria: maximum LAD percentage, maximum distance and last distance (output of [get_cbh_metrics()] function).
An object of the class data frame.</p>
</td></tr>
<tr><td><code id="get_cum_break_+3A_threshold">threshold</code></td>
<td>
<p>Numeric value of the LAD percentage below or above the breaking point to set the CBH (default 75).</p>
</td></tr>
<tr><td><code id="get_cum_break_+3A_verbose">verbose</code></td>
<td>
<p>Logical, indicating whether to display informational messages (default is TRUE).</p>
</td></tr>
</table>


<h3>Details</h3>

<p># List of tree metrics:
</p>

<ul>
<li><p> treeID: tree ID with strings and numeric values
</p>
</li>
<li><p> treeID1: tree ID with only numeric values
</p>
</li>
<li><p> Hdist: Height of the distance between the ground and the CBH or breaking point (m)
</p>
</li>
<li><p> Hcbh_brpt: Height of the CBH based on the breaking point method (m)
</p>
</li>
<li><p> below_hcbhbp: Percentage of LAD values below the CBH or breaking point
</p>
</li>
<li><p> above_hcbhbp: Percentage of LAD values above the CBH or breaking point
</p>
</li>
<li><p> bp_hcbh: Height of the CBH based on the breaking point method or on the maximum LAD criterium if there is not breaking point (m)
</p>
</li>
<li><p> bp_Hdptf: Height of the canopy layer depth using the breaking point method or the maximum LAD criterium (m)
</p>
</li>
<li><p> bp_dptf: Depth of the CBH using the breaking point method or the maximum LAD criterium (m)
</p>
</li>
<li><p> bp_Hdist: Height of the distance between the CBH and the ground using the breaking point method or the maximum LAD criterium (m)
</p>
</li>
<li><p> bp_effdist: Distance between the CBH and the ground using the breaking point method or the maximum LAD criterium (m)
</p>
</li>
<li><p> bp_lad: Percentage of LAD comprised by the canopy layer
</p>
</li>
<li><p> cumlad: Cumulative LAD values at the CBH or breaking point
</p>
</li>
<li><p> max_height: Maximum height of the tree profile
</p>
</li></ul>



<h3>Value</h3>

<p>A data frame identifying the CBH of the vertical tree profile (VTP) based on the breaking point method and
the percentage of LAD values below and above the identified CBH or breaking point.
</p>


<h3>Author(s)</h3>

<p>Olga Viedma, Carlos Silva and JM Moreno
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_cbh_metrics">get_cbh_metrics</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(magrittr)
library(segmented)
library(gdata)
library(dplyr)

# LAD profiles derived from normalized ALS data after applying [lad.profile()] function
LAD_profiles &lt;- read.table(system.file("extdata", "LAD_profiles.txt", package = "LadderFuelsR"),
header = TRUE)
LAD_profiles$treeID &lt;- factor(LAD_profiles$treeID)

# Before running this example, make sure to run get_cbh_metrics().
if (interactive()) {
cbh_metrics &lt;- get_cbh_dist()
LadderFuelsR::cbh_metrics$treeID &lt;- factor(LadderFuelsR::cbh_metrics$treeID)

trees_name1 &lt;- as.character(cbh_metrics$treeID)
trees_name2 &lt;- factor(unique(trees_name1))

cum_LAD_metrics_list &lt;- list()

for (i in levels(trees_name2)) {
# Filter data for each tree
tree1 &lt;- LAD_profiles |&gt; dplyr::filter(treeID == i)
tree2 &lt;- cbh_metrics |&gt; dplyr::filter(treeID == i)

# Get cumulative LAD metrics for each tree
cum_LAD_metrics &lt;- get_cum_break(tree1, tree2, threshold=75, verbose=TRUE)
cum_LAD_metrics_list[[i]] &lt;- cum_LAD_metrics
}

# Combine the individual data frames
cummulative_LAD &lt;- dplyr::bind_rows(cum_LAD_metrics_list)
}
</code></pre>

<hr>
<h2 id='get_depths'>Fuels depth in meters</h2><span id='topic+get_depths'></span>

<h3>Description</h3>

<p>This function calculates fuels depth as the difference between gaps interleaved between fuel layers minus 1 if the fuel depths are greater than 1.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_depths (LAD_profiles, distance_metrics,verbose=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_depths_+3A_lad_profiles">LAD_profiles</code></td>
<td>
<p>original tree Leaf Area Density (LAD) profile (output of [lad.profile()] function in the <em>leafR</em> package.
An object of the class text.</p>
</td></tr>
<tr><td><code id="get_depths_+3A_distance_metrics">distance_metrics</code></td>
<td>
<p>tree metrics with gaps (distances) and fuel base heights (output of [get_distance()] function).
An object of the class text.</p>
</td></tr>
<tr><td><code id="get_depths_+3A_verbose">verbose</code></td>
<td>
<p>Logical, indicating whether to display informational messages (default is TRUE).</p>
</td></tr>
</table>


<h3>Details</h3>

<p># List of tree metrics:
</p>

<ul>
<li><p> treeID: tree ID with strings and numeric values
</p>
</li>
<li><p> treeID1: tree ID with only numeric values
</p>
</li>
<li><p> cbh - Height of the fuel layers base height (m)
</p>
</li>
<li><p> gap - Height of gaps between consecutive fuel layers (m)
</p>
</li>
<li><p> dist: Distance between consecutive fuel layers (m)
</p>
</li>
<li><p> Hdist - Height of the distance between consecutive fuel layers (m)
</p>
</li>
<li><p> depth - Depth of fuel layers (m)
</p>
</li>
<li><p> Hdepth - Height of the depth of fuel layers (m)
</p>
</li>
<li><p> max_height - Maximum height of the tree profile
</p>
</li></ul>



<h3>Value</h3>

<p>A data frame giving fuel layers depth and the height of the depths in meters.
</p>


<h3>Author(s)</h3>

<p>Olga Viedma, Carlos Silva and JM Moreno
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_distance">get_distance</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(magrittr)
library(dplyr)

# Before running this example, make sure to run get_distance().
if (interactive()) {
distance_metrics &lt;- get_distance()
LadderFuelsR::LAD_profiles$treeID &lt;- factor(LadderFuelsR::LAD_profiles$treeID)
LadderFuelsR::distance_metrics$treeID &lt;- factor(LadderFuelsR::distance_metrics$treeID)

metrics_depth_list &lt;- list()

for (i in levels(LAD_profiles$treeID)){

tree1 &lt;- LAD_profiles |&gt; dplyr::filter(treeID == i)
tree2 &lt;- distance_metrics |&gt; dplyr::filter(treeID == i)

# Get depths for each tree
metrics_depth &lt;- get_depths(tree1, tree2,verbose=TRUE)
metrics_depth_list[[i]] &lt;- metrics_depth
}

# Combine the individual data frames
depth_metrics &lt;- dplyr::bind_rows(metrics_depth_list)
}
</code></pre>

<hr>
<h2 id='get_distance'>Distances between fuel layers</h2><span id='topic+get_distance'></span>

<h3>Description</h3>

<p>This function calculates distances (and their heights) between fuel layers as the difference between consecutive gaps and fuel bases
(the gap height always must be lower than the fuel base height).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_distance (gap_cbh_metrics,gaps_perc,verbose=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_distance_+3A_gap_cbh_metrics">gap_cbh_metrics</code></td>
<td>
<p>data frame with gaps (distances) and fuel base heights (output of [get_gaps_fbhs()] function).
An object of the class text.</p>
</td></tr>
<tr><td><code id="get_distance_+3A_gaps_perc">gaps_perc</code></td>
<td>
<p>data frame with Leaf Area Density (LAD) percentiles for each height values (output of [calculate_gaps_perc()] function).
An object of the class text.</p>
</td></tr>
<tr><td><code id="get_distance_+3A_verbose">verbose</code></td>
<td>
<p>Logical, indicating whether to display informational messages (default is TRUE).</p>
</td></tr>
</table>


<h3>Details</h3>

<p># List of tree metrics:
</p>

<ul>
<li><p> treeID: tree ID with strings and numeric values
</p>
</li>
<li><p> treeID1: tree ID with only numeric values
</p>
</li>
<li><p> cbh - Height of the fuel layers base height (m)
</p>
</li>
<li><p> gap - Height of gaps between consecutive fuel layers (m)
</p>
</li>
<li><p> dist: Distance between consecutive fuel layers (m)
</p>
</li>
<li><p> Hdist - Height of the distance between consecutive fuel layers (m)
</p>
</li>
<li><p> max_height - Maximum height of the tree profile
</p>
</li></ul>



<h3>Value</h3>

<p>A data frame giving distances (and their heights) between fuel layers in meters.
</p>


<h3>Author(s)</h3>

<p>Olga Viedma, Carlos Silva and JM Moreno
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_gaps_fbhs">get_gaps_fbhs</a></code>
</p>
<p><code><a href="#topic+calculate_gaps_perc">calculate_gaps_perc</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(magrittr)
library(gdata)
library(dplyr)

# Before running this example, make sure to run get_gaps_fbhs().
if (interactive()) {
gap_cbh_metrics &lt;- get_gaps_fbhs()
LadderFuelsR::gap_cbh_metrics$treeID &lt;- factor(LadderFuelsR::gap_cbh_metrics$treeID)

# Before running this example, make sure to run calculate_gaps_perc().
LadderFuelsR::gaps_perc$treeID &lt;- factor(LadderFuelsR::gaps_perc$treeID)

trees_name1 &lt;- as.character(gaps_perc$treeID)
trees_name2 &lt;- factor(unique(trees_name1))

metrics_distance_list &lt;- list()

for (i in levels(trees_name2)) {

# Filter data for each tree
tree1 &lt;- gap_cbh_metrics |&gt; dplyr::filter(treeID == i)
tree2 &lt;- gaps_perc |&gt; dplyr::filter(treeID == i)
# Get distance metrics for each tree
metrics_distance &lt;- get_distance(tree1, tree2)
metrics_distance_list[[i]] &lt;- metrics_distance
}
# Combine the individual data frames
distance_metrics &lt;- dplyr::bind_rows(metrics_distance_list)
}
</code></pre>

<hr>
<h2 id='get_effective_gap'>Effective Distances between fuel layers</h2><span id='topic+get_effective_gap'></span>

<h3>Description</h3>

<p>This function recalculates the distance between fuel layers after removing distances = 1 m.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_effective_gap(effective_depth, verbose=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_effective_gap_+3A_effective_depth">effective_depth</code></td>
<td>
<p>Tree metrics with the recalculated depth values considering distances &gt; 1 m (output of [get_real_depths()] function).
An object of the class data frame.</p>
</td></tr>
<tr><td><code id="get_effective_gap_+3A_verbose">verbose</code></td>
<td>
<p>Logical, indicating whether to display informational messages (default is TRUE).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>List of tree metrics:
</p>

<ul>
<li><p> treeID: tree ID with strings and numeric values
</p>
</li>
<li><p> treeID1: tree ID with only numeric values
</p>
</li>
<li><p> dist: Distance between consecutive fuel layers (m)
</p>
</li>
<li><p> dptf: Depth of fuel layers (m) after removing distances equal to 1 m
</p>
</li>
<li><p> effdist: Effective distance between consecutive fuel layers (m) (&gt; 1 m)
</p>
</li>
<li><p> Hcbh: Height of the base of each fuel layer (m)
</p>
</li>
<li><p> Hdist: Height of the distance between consecutive fuel layers (m)
</p>
</li>
<li><p> Hdptf: Height of the depth of fuel layers (m) after removing distances equal to 1 m
</p>
</li>
<li><p> max_height: Maximum height of the tree
</p>
</li></ul>



<h3>Value</h3>

<p>A data frame giving the effective distances (&gt; 1 m) between consecutive fuel layers.
</p>


<h3>Author(s)</h3>

<p>Olga Viedma, Carlos Silva and JM Moreno
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_real_depths">get_real_depths</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(magrittr)
library(stringr)
library(dplyr)

# Before running this example, make sure to run get_real_depths().
if (interactive()) {
effective_depth &lt;- get_real_depths()
LadderFuelsR::effective_depth$treeID &lt;- factor(LadderFuelsR::effective_depth$treeID)

trees_name1 &lt;- as.character(effective_depth$treeID)
trees_name2 &lt;- factor(unique(trees_name1))

corr_distance_metrics_list &lt;- list()

for (i in levels(trees_name2)) {
tree1 &lt;- effective_depth |&gt; dplyr::filter(treeID == i)
corr_distance_metrics &lt;- get_effective_gap(tree1, verbose=TRUE)
corr_distance_metrics_list[[i]] &lt;- corr_distance_metrics
}

# Combine the individual data frames
effective_distances &lt;- dplyr::bind_rows(corr_distance_metrics_list)

# Get original column names
original_column_names &lt;- colnames(effective_distances)

# Specify prefixes
desired_order &lt;- c("treeID", "Hcbh", "dptf","effdist","dist", "Hdist", "Hdptf", "max_")

# Identify unique prefixes
prefixes &lt;- unique(sub("^([a-zA-Z]+).*", "\\1", original_column_names))
# Initialize vector to store new order
new_order &lt;- c()

# Loop over desired order of prefixes
for (prefix in desired_order) {
 # Find column names matching the current prefix
matching_columns &lt;- grep(paste0("^", prefix), original_column_names, value = TRUE)
# Append to the new order
new_order &lt;- c(new_order, matching_columns)
}
effective_distances &lt;- effective_distances[, new_order]
}
</code></pre>

<hr>
<h2 id='get_gaps_fbhs'>Gaps and Fuel layers Base Height (FBH)</h2><span id='topic+get_gaps_fbhs'></span>

<h3>Description</h3>

<p>This function calculates gaps and fuel layers base height (FBH) as the difference in percentiles between consecutive LAD values along the vertical tree profile (VTP).
Negative differences are linked to gaps and positive differences to fuel base height.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_gaps_fbhs (LAD_profiles, verbose=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_gaps_fbhs_+3A_lad_profiles">LAD_profiles</code></td>
<td>
<p>original tree Leaf Area Density (LAD) profile (output of [lad.profile()] function in the <em>leafR</em> package.
An object of the class text.</p>
</td></tr>
<tr><td><code id="get_gaps_fbhs_+3A_verbose">verbose</code></td>
<td>
<p>Logical, indicating whether to display informational messages (default is TRUE).</p>
</td></tr>
</table>


<h3>Details</h3>

<p># List of tree metrics:
</p>

<ul>
<li><p> treeID: tree ID with strings and numeric values
</p>
</li>
<li><p> treeID1: tree ID with only numeric values
</p>
</li>
<li><p> cbh - Height of the fuel layer base height (m)
</p>
</li>
<li><p> gap - Height of gap between fuel layers (m)
</p>
</li>
<li><p> gap_lad: LAD value in the gap height
</p>
</li>
<li><p> gap_perc - Percentage of LAD in the gap height
</p>
</li>
<li><p> cbh_lad - LAD value in the fuel base height
</p>
</li>
<li><p> cbh_perc - Percentage of LAD in the fuel base height
</p>
</li>
<li><p> max_height - Maximum height of the tree profile
</p>
</li></ul>



<h3>Value</h3>

<p>A data frame giving the height of gaps and fuel layers bases in meters.
</p>


<h3>Author(s)</h3>

<p>Olga Viedma, Carlos Silva and JM Moreno
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(magrittr)
library(dplyr)

# LAD profiles derived from normalized ALS data after applying [lad.profile()] function
LAD_profiles &lt;- read.table(system.file("extdata", "LAD_profiles.txt", package = "LadderFuelsR"),
header = TRUE)
LAD_profiles$treeID &lt;- factor(LAD_profiles$treeID)

trees_name1 &lt;- as.character(LAD_profiles$treeID)
trees_name2 &lt;- factor(unique(trees_name1))

metrics_precentile_list1&lt;-list()

for (i in levels(trees_name2)) {
tree1 &lt;- LAD_profiles |&gt; dplyr::filter(treeID == i)
metrics_precentil &lt;- get_gaps_fbhs(tree1, verbose=TRUE)
metrics_precentile_list1[[i]] &lt;- metrics_precentil
}

metrics_all_percentil &lt;- dplyr::bind_rows(metrics_precentile_list1)
metrics_all_percentil$treeID &lt;- factor(metrics_all_percentil$treeID)

# Remove the row with all NA values from the original data frame
# First remove "treeID" and "treeID1" columns
no_treeID &lt;- metrics_all_percentil[, -which(names(metrics_all_percentil) == c("treeID","treeID1"))]

# Check if any row has all NA values
NA_or_zero &lt;- apply(no_treeID, 1, function(row) all(is.na(row) | row == 0))

# Get the row index with all NA values
row_index &lt;- which(NA_or_zero)

# Remove the row with all NA values from the original data frame
if (length(row_index) &gt; 0) {
gap_cbh_metrics &lt;- metrics_all_percentil[-row_index, ]
} else {
gap_cbh_metrics &lt;- metrics_all_percentil
}
</code></pre>

<hr>
<h2 id='get_layers_lad'>Leaf Area Density (LAD) percentage comprised in each effective fuel layer</h2><span id='topic+get_layers_lad'></span>

<h3>Description</h3>

<p>This function calculates the percentage of Leaf Area Density (LAD) within each fuel layer (first output)
and removes those fuel layers with LAD percentage less than a specified threshold, recalculating the distances and
the depth of the remaining ones (second output).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_layers_lad(LAD_profiles, effective_distances, threshold=25, verbose=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_layers_lad_+3A_lad_profiles">LAD_profiles</code></td>
<td>
<p>Original tree Leaf Area Density (LAD) profile (output of [lad.profile()] function in the <em>leafR</em> package).
An object of the class text.</p>
</td></tr>
<tr><td><code id="get_layers_lad_+3A_effective_distances">effective_distances</code></td>
<td>
<p>Tree metrics of fuel layers separated by distances greater than 1 m (output of [get_effective_gap()] function).
An object of the class text.</p>
</td></tr>
<tr><td><code id="get_layers_lad_+3A_threshold">threshold</code></td>
<td>
<p>Numeric value for the minimum required LAD percentage in a fuel layer. The default threshold is 25.</p>
</td></tr>
<tr><td><code id="get_layers_lad_+3A_verbose">verbose</code></td>
<td>
<p>Logical, indicating whether to display informational messages (default is TRUE).</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li><p> treeID: tree ID with strings and numeric values
</p>
</li>
<li><p> treeID1: tree ID with only numeric values
</p>
</li>
<li><p> Hcbh - Height of the base of each effective fuel layer (m)
</p>
</li>
<li><p> Hdist - Height of the distance between consecutive fuel layers (m)
</p>
</li>
<li><p> effdist - Distance between consecutive fuel layers (m)
</p>
</li>
<li><p> dptf - Depth of the effective fuel layers (m) at distances greater than 1 m
</p>
</li>
<li><p> Hdptf - Height of the depth of fuel layers (m) at distances greater than 1 m
</p>
</li>
<li><p> Hcbh_Hdptf - Percentage of LAD values comprised in each effective fuel layer
</p>
</li>
<li><p> max_height - Maximum height of the tree profile
</p>
</li>
<li><p> nlayers - Number of effective fuel layers
</p>
</li></ul>



<h3>Value</h3>

<p>A data frame identifying the fuel layers with their corresponding LAD percentage.
</p>


<h3>Author(s)</h3>

<p>Olga Viedma, Carlos Silva and JM Moreno
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_renamed_df">get_renamed_df</a></code>
</p>
<p><code><a href="#topic+get_effective_gap">get_effective_gap</a></code>
</p>
<p><code><a href="#topic+remove_no_flayer_noconsec">remove_no_flayer_noconsec</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(magrittr)
library(gdata)
library(dplyr)
library(stringr)

# LAD profiles derived from normalized ALS data after applying [lad.profile()] function
LAD_profiles &lt;- read.table(system.file("extdata", "LAD_profiles.txt", package = "LadderFuelsR"),
header = TRUE)
LAD_profiles$treeID &lt;- factor(LAD_profiles$treeID)

# Before running this example, make sure to run get_effective_gap().
if (interactive()) {
effective_distances &lt;- get_effective_gap()
LadderFuelsR::effective_distances$treeID &lt;- factor(LadderFuelsR::effective_distances$treeID)

trees_name1 &lt;- as.character(effective_distances$treeID)
trees_name2 &lt;- factor(unique(trees_name1))

LAD_metrics1 &lt;- list()
LAD_metrics2 &lt;- list()

for (i in levels(trees_name2)) {
# Filter data for each tree
tree1 &lt;- LAD_profiles |&gt; dplyr::filter(treeID == i)
tree2 &lt;- effective_distances |&gt; dplyr::filter(treeID == i)

# Get LAD metrics for each tree
LAD_metrics &lt;- get_layers_lad(tree1, tree2, threshold=25, verbose=TRUE)
LAD_metrics1[[i]] &lt;- LAD_metrics$df1
LAD_metrics2[[i]] &lt;- LAD_metrics$df2
}

all_LAD &lt;- dplyr::bind_rows(LAD_metrics1)
effective_LAD &lt;- dplyr::bind_rows(LAD_metrics2)
}
</code></pre>

<hr>
<h2 id='get_plots_cbh_bp'>Plot of the Canopy Base Height (CBH) based on the breaking point method</h2><span id='topic+get_plots_cbh_bp'></span>

<h3>Description</h3>

<p>This function plots the canopy base height (CBH) based on breaking point over the cummulative LAD values and gives the LAD percentage
of the canopy layer
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_plots_cbh_bp(LAD_profiles, cummulative_LAD)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_plots_cbh_bp_+3A_lad_profiles">LAD_profiles</code></td>
<td>
<p>original tree Leaf Area Density (LAD) profile (output of [lad.profile()] function from leafR package).
An object of the class text.</p>
</td></tr>
<tr><td><code id="get_plots_cbh_bp_+3A_cummulative_lad">cummulative_LAD</code></td>
<td>
<p>tree metrics derived from using breaking points on cummulative LAD (output of [get_cum_break()] function).
An object of the class text.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A plot of the Canopy Base Height (CBH) based on the breaking point method and Leaf Area Density (LAD) percentage of the canopy layer.
</p>


<h3>Author(s)</h3>

<p>Olga Viedma, Carlos Silva and JM Moreno
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_cum_break">get_cum_break</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ggplot2)
library(dplyr)

# LAD profiles derived from normalized ALS data after applying [lad.profile()] function
LAD_profiles &lt;- read.table(system.file("extdata", "LAD_profiles.txt", package = "LadderFuelsR"),
header = TRUE)
LAD_profiles$treeID &lt;- factor(LAD_profiles$treeID)

# Before running this example, make sure to run get_cum_break().
if (interactive()) {
cummulative_LAD &lt;- get_cum_break()
LadderFuelsR::cummulative_LAD$treeID &lt;- factor(LadderFuelsR::cummulative_LAD$treeID)

# Generate cumulative LAD plots
plots_cbh_bp &lt;- get_plots_cbh_bp(LAD_profiles, cummulative_LAD)
}
</code></pre>

<hr>
<h2 id='get_plots_cbh_LAD'>Plots the Canopy Base Height (CBH) based on the maximum LAD percentage criterium</h2><span id='topic+get_plots_cbh_LAD'></span>

<h3>Description</h3>

<p>This function plots the CBH of a segmented tree based on the fuel layer with the maximum LAD percentage.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_plots_cbh_LAD(LAD_profiles, cbh_metrics)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_plots_cbh_LAD_+3A_lad_profiles">LAD_profiles</code></td>
<td>
<p>Original tree Leaf Area Density (LAD) profile (output of [lad.profile()] function in the <em>leafR</em> package).
An object of the class text.</p>
</td></tr>
<tr><td><code id="get_plots_cbh_LAD_+3A_cbh_metrics">cbh_metrics</code></td>
<td>
<p>CBH metrics based on three criteria: maximum LAD percentage, maximum distance and last distance.
(output of [get_cbh_metrics()] function).
An object of the class text.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A plot drawing the Canopy Base Height (CBH) of the fuel layer with the maximum Leaf Area Density (LAD) percentage.
</p>


<h3>Author(s)</h3>

<p>Olga Viedma, Carlos Silva and JM Moreno
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_layers_lad">get_layers_lad</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ggplot2)
library(dplyr)

# LAD profiles derived from normalized ALS data after applying [lad.profile()] function
LAD_profiles &lt;- read.table(system.file("extdata", "LAD_profiles.txt", package = "LadderFuelsR"),
header = TRUE)
LAD_profiles$treeID &lt;- factor(LAD_profiles$treeID)

# Before running this example, make sure to run get_cbh_metrics().
if (interactive()) {
cbh_metrics &lt;- get_cbh_metrics()
LadderFuelsR::cbh_metrics$treeID &lt;- factor(LadderFuelsR::cbh_metrics$treeID)

trees_name1 &lt;- as.character(cbh_metrics$treeID)
trees_name2 &lt;- factor(unique(trees_name1))

# Generate plots for fuels LAD metrics
plots_trees_LAD &lt;- get_plots_cbh_LAD(LAD_profiles, cbh_metrics)
}
</code></pre>

<hr>
<h2 id='get_plots_cbh_lastdist'>Plots the Canopy Base Height (CBH) based on the last distance criterium</h2><span id='topic+get_plots_cbh_lastdist'></span>

<h3>Description</h3>

<p>This function plots the CBH of a segmented tree based on the fuel layer located at the last distance.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_plots_cbh_lastdist(LAD_profiles, cbh_metrics)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_plots_cbh_lastdist_+3A_lad_profiles">LAD_profiles</code></td>
<td>
<p>Original tree Leaf Area Density (LAD) profile (output of [lad.profile()] function in the <em>leafR</em> package).
An object of the class text.</p>
</td></tr>
<tr><td><code id="get_plots_cbh_lastdist_+3A_cbh_metrics">cbh_metrics</code></td>
<td>
<p>CBH metrics based on three criteria: maximum LAD percentage, maximum distance and last distance.
(output of [get_cbh_metrics()] function).
An object of the class text.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A plot drawing the Canopy Base Height (CBH) of the fuel layer located at the last distance.
</p>


<h3>Author(s)</h3>

<p>Olga Viedma, Carlos Silva and JM Moreno
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_cbh_metrics">get_cbh_metrics</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ggplot2)
library(dplyr)

# LAD profiles derived from normalized ALS data after applying [lad.profile()] function
LAD_profiles &lt;- read.table(system.file("extdata", "LAD_profiles.txt", package = "LadderFuelsR"),
header = TRUE)
LAD_profiles$treeID &lt;- factor(LAD_profiles$treeID)

# Before running this example, make sure to run get_cbh_metrics().
if (interactive()) {
cbh_metrics &lt;- get_cbh_metrics()
LadderFuelsR::cbh_metrics$treeID &lt;- factor(LadderFuelsR::cbh_metrics$treeID)

trees_name1 &lt;- as.character(cbh_metrics$treeID)
trees_name2 &lt;- factor(unique(trees_name1))

# Generate plots for CBH based on the fuel layer at the last distance
plots_cbh_lastdist &lt;- get_plots_cbh_lastdist(LAD_profiles, cbh_metrics)
}
</code></pre>

<hr>
<h2 id='get_plots_cbh_maxdist'>Plots the Canopy Base Height (CBH) based on the maximum LAD percentage criterium</h2><span id='topic+get_plots_cbh_maxdist'></span>

<h3>Description</h3>

<p>This function plots the CBH of a segmented tree based on the fuel layer located at the maximum distance.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_plots_cbh_maxdist(LAD_profiles, cbh_metrics)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_plots_cbh_maxdist_+3A_lad_profiles">LAD_profiles</code></td>
<td>
<p>Original tree Leaf Area Density (LAD) profile (output of [lad.profile()] function in the <em>leafR</em> package).
An object of the class text.</p>
</td></tr>
<tr><td><code id="get_plots_cbh_maxdist_+3A_cbh_metrics">cbh_metrics</code></td>
<td>
<p>CBH metrics based on three criteria: maximum LAD percentage, maximum distance and last distance.
(output of [get_cbh_metrics()] function).
An object of the class text.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A plot drawing the Canopy Base Height (CBH) of the fuel layer located at the maximum distance.
</p>


<h3>Author(s)</h3>

<p>Olga Viedma, Carlos Silva and JM Moreno
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_cbh_metrics">get_cbh_metrics</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ggplot2)
library(dplyr)

# LAD profiles derived from normalized ALS data after applying [lad.profile()] function
LAD_profiles &lt;- read.table(system.file("extdata", "LAD_profiles.txt", package = "LadderFuelsR"),
header = TRUE)
LAD_profiles$treeID &lt;- factor(LAD_profiles$treeID)

# Before running this example, make sure to run get_cbh_metrics().
if (interactive()) {
cbh_metrics &lt;- get_cbh_metrics()
LadderFuelsR::cbh_metrics$treeID &lt;- factor(LadderFuelsR::cbh_metrics$treeID)

trees_name1 &lt;- as.character(cbh_metrics$treeID)
trees_name2 &lt;- factor(unique(trees_name1))

# Generate plots for fuels LAD metrics
plots_cbh_maxdist &lt;- get_plots_cbh_maxdist(LAD_profiles, cbh_metrics)
}
</code></pre>

<hr>
<h2 id='get_plots_effective'>Plots of fuel layers with LAD percentage greater than a specified threshold</h2><span id='topic+get_plots_effective'></span>

<h3>Description</h3>

<p>This function plots effective fuel layers separated by effective distances (&gt; 1 m).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_plots_effective(LAD_profiles, effective_LAD)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_plots_effective_+3A_lad_profiles">LAD_profiles</code></td>
<td>
<p>Original tree Leaf Area Density (LAD) profile (output of [lad.profile()] function in the <em>leafR</em> package).
An object of the class text.</p>
</td></tr>
<tr><td><code id="get_plots_effective_+3A_effective_lad">effective_LAD</code></td>
<td>
<p>Tree metrics with gaps (distances), fuel base heights, and depths of fuel layers with LAD percentage greater than a specified threshold
(output of [get_layers_lad()] function).
An object of the class text.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A plot drawing the effective fuel layers with LAD percentage greater than a specified threshold.
</p>


<h3>Author(s)</h3>

<p>Olga Viedma, Carlos Silva and JM Moreno
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_layers_lad">get_layers_lad</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ggplot2)
library(dplyr)

# LAD profiles derived from normalized ALS data after applying [lad.profile()] function
LAD_profiles &lt;- read.table(system.file("extdata", "LAD_profiles.txt", package = "LadderFuelsR"),
header = TRUE)
LAD_profiles$treeID &lt;- factor(LAD_profiles$treeID)

# Before running this example, make sure to run get_layers_lad().
if (interactive()) {
effective_LAD &lt;- get_layers_lad()
LadderFuelsR::effective_LAD$treeID &lt;- factor(LadderFuelsR::effective_LAD$treeID)

trees_name1 &lt;- as.character(effective_LAD$treeID)
trees_name2 &lt;- factor(unique(trees_name1))

# Generate plots for fuels LAD metrics
plots_effective_metrics &lt;- get_plots_effective(LAD_profiles, effective_LAD)
}
</code></pre>

<hr>
<h2 id='get_plots_gap_fbh'>Plots of tree profiles with gaps and fuel layers base height (fbh)</h2><span id='topic+get_plots_gap_fbh'></span>

<h3>Description</h3>

<p>This function plots gaps and fuel layers base height (fbh) in the vertical tree profile (VTP).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_plots_gap_fbh (LAD_profiles,depth_metrics)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_plots_gap_fbh_+3A_lad_profiles">LAD_profiles</code></td>
<td>
<p>original tree Leaf Area Density (LAD) profile (output of [lad.profile()] function in the <em>leafR</em> package.
An object of the class text</p>
</td></tr>
<tr><td><code id="get_plots_gap_fbh_+3A_depth_metrics">depth_metrics</code></td>
<td>
<p>tree metrics with gaps (distances), fuel base heights and depths (output of [get_depths()] function).
An object of the class text</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A plot drawing by lines the height of gaps and fuel layers bases in tiff format.
</p>


<h3>Author(s)</h3>

<p>Olga Viedma, Carlos Silva and JM Moreno
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_depths">get_depths</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ggplot2)
library(dplyr)

# LAD profiles derived from normalized ALS data after applying [lad.profile()] function
LAD_profiles &lt;- read.table(system.file("extdata", "LAD_profiles.txt", package = "LadderFuelsR"),
header = TRUE)
LAD_profiles$treeID &lt;- factor(LAD_profiles$treeID)

# Before running this example, make sure to run get_depths().
if (interactive()) {
depth_metrics &lt;- get_depths()
LadderFuelsR::depth_metrics$treeID &lt;- factor(LadderFuelsR::depth_metrics$treeID)

# Generate plots for gaps and fbhs
plots_gaps_fbhs &lt;- get_plots_gap_fbh(LAD_profiles, depth_metrics)
}
</code></pre>

<hr>
<h2 id='get_real_depths'>Effective fuel layers depth</h2><span id='topic+get_real_depths'></span>

<h3>Description</h3>

<p>This function recalculates fuel layers depth after removing distances = 1 m
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_real_depths (effective_fbh, verbose=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_real_depths_+3A_effective_fbh">effective_fbh</code></td>
<td>
<p>tree metrics with the recalculated base height of fuel layers after considering distances &gt; 1 m  (output of [get_real_fbh()] function).
An object of the class text.</p>
</td></tr>
<tr><td><code id="get_real_depths_+3A_verbose">verbose</code></td>
<td>
<p>Logical, indicating whether to display informational messages (default is TRUE).</p>
</td></tr>
</table>


<h3>Details</h3>

<p># List of tree metrics:
</p>

<ul>
<li><p> treeID: tree ID with strings and numeric values
</p>
</li>
<li><p> treeID1: tree ID with only numeric values
</p>
</li>
<li><p> dist: Distance between consecutive fuel layers (m)
</p>
</li>
<li><p> Hdist - Height of the distance between consecutive fuel layers (m)
</p>
</li>
<li><p> Hcbh - Height of the base of each fuel layer (m)
</p>
</li>
<li><p> dptf - Depth of fuel layers (m) after removing distances equal 1 m
</p>
</li>
<li><p> Hdptf - Height of the depth of fuel layers (m) after removing distances equal 1 m
</p>
</li>
<li><p> max_height - Maximum height of the tree profile
</p>
</li></ul>



<h3>Value</h3>

<p>A data frame giving the fuel layers depth after removing distances = 1 m.
</p>


<h3>Author(s)</h3>

<p>Olga Viedma, Carlos Silva and JM Moreno
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_renamed0_df">get_renamed0_df</a></code>
</p>
<p><code><a href="#topic+get_real_fbh">get_real_fbh</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(magrittr)
library(tidyr)
library(dplyr)

# Before running this example, make sure to run get_real_fbh().
if (interactive()) {
effective_fbh &lt;- get_real_fbh()
LadderFuelsR::effective_fbh$treeID &lt;- factor(LadderFuelsR::effective_fbh$treeID)

trees_name1 &lt;- as.character(effective_fbh$treeID)
trees_name2 &lt;- factor(unique(trees_name1))

depth_metrics_corr_list &lt;- list()

for (i in levels(trees_name2)){
# Filter data for each tree
tree3 &lt;- effective_fbh |&gt; dplyr::filter(treeID == i)
# Get real depths for each tree
depth_metrics_corr &lt;- get_real_depths(tree3, verbose=TRUE)
depth_metrics_corr_list[[i]] &lt;- depth_metrics_corr
}

# Combine depth values for all trees
effective_depth &lt;- dplyr::bind_rows(depth_metrics_corr_list)

# Reorder columns
original_column_names &lt;- colnames(effective_depth)

# Specify prefixes
desired_order &lt;- c("treeID", "Hcbh", "dptf", "dist", "Hdist", "Hdptf", "max_height")

# Identify unique prefixes
prefixes &lt;- unique(sub("^([a-zA-Z]+).*", "\\1", original_column_names))
# Initialize vector to store new order
new_order &lt;- c()

# Loop over desired order of prefixes
for (prefix in desired_order) {
  # Find column names matching the current prefix
  matching_columns &lt;- grep(paste0("^", prefix), original_column_names, value = TRUE)
  # Append to the new order
  new_order &lt;- c(new_order, matching_columns)
}
effective_depth &lt;- effective_depth[, new_order]
}
</code></pre>

<hr>
<h2 id='get_real_fbh'>Fuels base height after removing distances = 1 m</h2><span id='topic+get_real_fbh'></span>

<h3>Description</h3>

<p>This function recalculates fuels base height after removing distances = 1 m,
keeping the first &quot;base height&quot; from those consecutive ones separated by a distance = 1.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_real_fbh(depth_metrics,verbose=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_real_fbh_+3A_depth_metrics">depth_metrics</code></td>
<td>
<p>Tree metrics with gaps (distances), fuel base heights, and depths
(output of [get_depths()] function). An object of the class text.</p>
</td></tr>
<tr><td><code id="get_real_fbh_+3A_verbose">verbose</code></td>
<td>
<p>Logical, indicating whether to display informational messages (default is TRUE).</p>
</td></tr>
</table>


<h3>Details</h3>

<p># List of tree metrics:
</p>

<ul>
<li><p> treeID: tree ID with strings and numeric values
</p>
</li>
<li><p> treeID1: tree ID with only numeric values
</p>
</li>
<li><p> dist: Distance between consecutive fuel layers (m)
</p>
</li>
<li><p> Hdist - Height of the distance between consecutive fuel layers (m)
</p>
</li>
<li><p> Hcbh - Height of the first base height from those ones separated by a distance = 1.
</p>
</li>
<li><p> depth - Depth of fuel layers (m)
</p>
</li>
<li><p> Hdepth - Height of the depth of fuel layers (m)
</p>
</li>
<li><p> max_height - Maximum height of the tree profile
</p>
</li></ul>



<h3>Value</h3>

<p>A data frame giving the first &quot;base height&quot; from those consecutive ones separated by a distance = 1.
This value replaces the values of the next base heights if they are separated by a distance = 1.
</p>


<h3>Author(s)</h3>

<p>Olga Viedma, Carlos Silva and JM Moreno
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_depths">get_depths</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(magrittr)
library(dplyr)
#Before running this example, make sure to run get_depths()
if (interactive()) {
depth_metrics &lt;- get_depths()
LadderFuelsR::depth_metrics$treeID &lt;- factor(LadderFuelsR::depth_metrics$treeID)

trees_name1 &lt;- as.character(depth_metrics$treeID)
trees_name2 &lt;- factor(unique(trees_name1))

fbh_corr_list &lt;- list()

for (i in levels(trees_name2)){
# Filter data for each tree
tree3 &lt;- depth_metrics |&gt; dplyr::filter(treeID == i)
# Get real fbh for each tree
fbh_corr &lt;- get_real_fbh(tree3, verbose=TRUE)
# Store fbh values in a list
fbh_corr_list[[i]] &lt;- fbh_corr
}

# Combine fbh values for all trees
effective_fbh &lt;- dplyr::bind_rows(fbh_corr_list)
effective_fbh$treeID &lt;- factor(effective_fbh$treeID)
}
</code></pre>

<hr>
<h2 id='get_renamed_df'>Rename and reorder columns (II)</h2><span id='topic+get_renamed_df'></span>

<h3>Description</h3>

<p>This function deals with concatenated column names, reorders columns and appends numeric suffixes.
Dont run it. It is an internal function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_renamed_df (df)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_renamed_df_+3A_df">df</code></td>
<td>
<p>internal data frame derived from [get_layers_lad()] function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value. The function is called for side effects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
# get_renamed_df concatenates column names, reorders columns and appends numeric suffixes
</code></pre>

<hr>
<h2 id='get_renamed0_df'>Rename and reorder columns (I)</h2><span id='topic+get_renamed0_df'></span>

<h3>Description</h3>

<p>This function reorders columns and appends numeric suffixes. Dont run it. It is an internal function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_renamed0_df (df)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_renamed0_df_+3A_df">df</code></td>
<td>
<p>internal data frame derived from [get_real_depths()] function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value. The function is called for side effects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
# get_renamed0_df function reorders columns and appends numeric suffixes
</code></pre>

<hr>
<h2 id='remove_no_flayer_noconsec'>Remove non-consecutive fuel layers with a Leaf Area Density (LAD) less than a specified threshold</h2><span id='topic+remove_no_flayer_noconsec'></span>

<h3>Description</h3>

<p>This function removes non-consecutive fuel layers with a Leaf Area Density (LAD) less than a specified threshold and
recalculates the distances and the depth of remaining fuel layers. Don't run it. It is an internal function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>remove_no_flayer_noconsec(df, threshold = 25)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="remove_no_flayer_noconsec_+3A_df">df</code></td>
<td>
<p>Internal data frame derived from [get_layers_lad()] function.</p>
</td></tr>
<tr><td><code id="remove_no_flayer_noconsec_+3A_threshold">threshold</code></td>
<td>
<p>Numeric value for the minimum required LAD percentage in a fuel layer. The default threshold is 25.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value. The function is called for side effects.
</p>


<h3>Author(s)</h3>

<p>Olga Viedma, Carlos Silva and JM Moreno
</p>


<h3>Examples</h3>

<pre><code class='language-R'># remove_no_flayer_noconsec() removes fuel layers with a LAD percentage less than a threshold
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
