<!DOCTYPE html><html><head><title>Help for package bhm</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {bhm}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#bhm-package'>
<p>An R package for the biomarker threshold models</p></a></li>
<li><a href='#bhm'>
<p>Fitting Biomarker Threshold Models</p></a></li>
<li><a href='#bhmControl'><p> Auxiliary function for bhm fitting</p></a></li>
<li><a href='#brm'>
<p>Fitting Biomarker Continuous Threshold Models</p></a></li>
<li><a href='#data'><p>dataset</p></a></li>
<li><a href='#glmpLRT'><p>Penalized likelihood ratio test for the generalized linear models.</p></a></li>
<li><a href='#llm'><p>Fit an L-shape linear model</p></a></li>
<li><a href='#mpl'>
<p>Joint models for clustered data with binary and survival outcomes.</p></a></li>
<li><a href='#pIndex'>
<p>Probability Index for Survival Time Difference</p></a></li>
<li><a href='#pIndexControl'><p> Auxiliary function for pIndex fitting</p></a></li>
<li><a href='#plot'>
<p>Plot a fitted biomarker threhold model</p></a></li>
<li><a href='#print'>
<p>print a fitted object or a summary of fitted object</p></a></li>
<li><a href='#resboot'>
<p>Rresidual Bootstrap Test (RBT) for treatment-biomarker interaction</p></a></li>
<li><a href='#rmscb'>
<p>Fitting Restricted Mean Survival Time Models with a Continuous Biomarker</p></a></li>
<li><a href='#rpicexp'>
<p>The Piecewise Exponential Distribution</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Biomarker Threshold Models</td>
</tr>
<tr>
<td>Version:</td>
<td>1.18</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-08-29</td>
</tr>
<tr>
<td>Author:</td>
<td>Bingshu E. Chen</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Bingshu E. Chen &lt;bingshu.chen@queensu.ca&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0), coda, ggplot2, MASS, survival</td>
</tr>
<tr>
<td>Imports:</td>
<td>methods</td>
</tr>
<tr>
<td>Description:</td>
<td>Contains tools to fit both predictive and prognostic biomarker effects using biomarker threshold models and continuous threshold models. Evaluate the treatment effect, biomarker effect and treatment-biomarker interaction using probability index measurement. Test for treatment-biomarker interaction using residual bootstrap method.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-08-31 14:46:24 UTC; b3chen</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-08-31 17:00:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='bhm-package'>
An R package for the biomarker threshold models
</h2><span id='topic+bhm-package'></span><span id='topic+bhm-doc'></span>

<h3>Description</h3>

<p>This package fits biomarker threshold regression models for predictive and prognostic biomarker effects 
with binary data and survival data with an unknown biomarker cutoff point (Chen et al, 2014)&lt;DOI:10.1016/j.csda.2013.05.015&gt;. 
Multivariable models can also be fitted for adjusted biomarker effect (Fang et al, 2017)&lt;DOI:10.1016/j.csda.2017.02.011&gt;. 
Tools such as Probability index are included to measure treatment effect, biomarker effect or treatment-biomarker interaction(Jiang et al, 2016)&lt;DOI:10.1002/sim.6907&gt;. 
</p>


<h3>Details</h3>

<p>&quot;bhm&quot; is a R package for Biomarker Threshold Models.
Please use the following steps to install the most recent version of 'bhm' package:
</p>
<p>1. First, you need to install the 'devtools' package. 
You can skip this step if you have 'devtools' installed in your R. Invoke R and then type
</p>
<p>install.packages(&quot;devtools&quot;)
</p>
<p>2. Load the devtools package.
</p>
<p>library(devtools)
</p>
<p>3. Install &quot;bhm&quot; package from github with R commond
</p>
<p>install_github(&quot;statapps/bhm&quot;)
</p>
<p>&quot;bhm&quot; uses different statistical methods to identify cut-point (thershold parameter) for the 
biomarker in either generalized linear models or Cox proportional hazards model.
</p>
<p>A stable version of View the &quot;bhm&quot; package is also available from the Comprehensive R Archive Network 
(https://CRAN.R-project.org/package=bhm) and can be installed using R command 
</p>
<p>install.packages(&quot;bhm&quot;)
</p>


<h3>Author(s)</h3>

<p>Bingshu E. Chen, Tian Fang, Jia Wang, Shuoshuo Liu
</p>
<p>Maintainer: Bingshu E. Chen &lt;bingshu.chen@queensu.ca&gt;
</p>


<h3>References</h3>

<p>Chen, B. E., Jiang, W. and Tu, D. (2014). A hierarchical Bayes model for biomarker subset effects in clinical trials. Computational Statistics and Data Analysis. vol 71, page 324-334.
</p>
<p>Fang, T., Mackillop, W., Jiang, W., Hildesheim, A., Wacholder, S. and Chen, B. E. (2017). A Bayesian method for risk window estimatin with application to HPV vaccine trial. Computational Statistics and Data Analysis. 112, page 53-62.
</p>
<p>Jiang, S., Chen, B. E. and Tu, D.(2016). Inference on treatment-covariate interaction based on a nonparametric measure of treatment effects and censored survival data. Statistics in Medicine. 35, 2715-2725.
</p>
<p>Gavanji, P., Chen, B. E. and Jiang, W.(2018). Residual Bootstrap test for interactions in biomarker threshold models with survival data. Statistics in Biosciences.
</p>
<p>Chen, B. E. and Wang, J.(2020). Joint modelling of binary response and survival for clustered data in clinical trials. Statistics in Medicine. Vol 39. 326-339.
</p>
<p>Liu, S. S. and Chen, B. E. (2020). Continuous threshold models with two-way interactions in sur
vival analysis. Canadian Journal of Statistics. 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bhm">bhm</a></code>,  
<code><a href="#topic+brm">brm</a></code>, 
<code><a href="survival.html#topic+coxph">coxph</a></code>, 
<code><a href="stats.html#topic+glm">glm</a></code>, 
<code>survival</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># fit = bhm(y~biomarker+treatment)
# print(summary(fit))
</code></pre>

<hr>
<h2 id='bhm'>
Fitting Biomarker Threshold Models
</h2><span id='topic+bhm'></span><span id='topic+bhm.default'></span><span id='topic+bhm.formula'></span><span id='topic+bhmFit'></span><span id='topic+bhmGibbs'></span><span id='topic+prolikFit'></span><span id='topic+summary.bhm'></span><span id='topic+thm.fit'></span><span id='topic+thm.lik'></span><span id='topic+x.cdf'></span>

<h3>Description</h3>

<p>{bhm} is a R package for Biomarker Threshold Models.
It uses either Hierarchical Bayes method or proflie likehood method (Chen, et al, 2014 and Tian, et al, 2017) 
to identify a cut-point (thershold parameter) for the biomarker in either generalized 
linear models or Cox proportional hazards model.
The model is specified by giving a symbolic description of the linear predictor and a description of the distribution family.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bhm(x, ...)

## S3 method for class 'formula'
bhm(formula, family, data, control = list(...),...)

# use 
#          bhm(y ~ biomarker)             
#
# to fit a prognostic model with biomarker term only
#
# use 
#
#          bhm(y ~ biomarker+treatment)
#
# to fit a predictive model with interaciton between biomarker 
# and treatment, use 
#
          bhmFit(x, y, family, control)  
#
# to fit a model without the formula
#
# Biomarker shall be in the first dependent variable
# 
#  To summary a "bhm" boject,
#
          ## S3 method for class 'bhm'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bhm_+3A_formula">formula</code></td>
<td>
<p>an object of class &quot;formula&quot;(or one that can be coerced to that class): a symbolic description of the model to be fitted. 
The details of model specification are given under 'Details'.</p>
</td></tr>
<tr><td><code id="bhm_+3A_family">family</code></td>
<td>
<p>a description of the response distribution and link function to be used in the model. 
The available family function are either &quot;binomial&quot; for fitting a logistic regression model or &quot;surv&quot; for fitting a Cox proportional hazards model</p>
</td></tr>
<tr><td><code id="bhm_+3A_data">data</code></td>
<td>
<p>an optional data frame, list or environment (or object coercible by 'as.data.frame' to a data frame) containing the variables in the model. 
If not found in data, the variables are taken from environment(formula), typically the environment from which glm is called.</p>
</td></tr>
<tr><td><code id="bhm_+3A_x">x</code>, <code id="bhm_+3A_y">y</code></td>
<td>
<p>For &quot;bhmFit&quot;, x is a design matrix of dimension n * p and y is a vector of observations of length n for &quot;glm&quot; models or a &quot;Surv&quot; survival object for &quot;coxph&quot; models.</p>
</td></tr>
<tr><td><code id="bhm_+3A_control">control</code></td>
<td>
<p>a list of parameters for controlling the fitting process. See &quot;bhmControl&quot; for details</p>
</td></tr> 
<tr><td><code id="bhm_+3A_object">object</code></td>
<td>
<p>object returned from model fit</p>
</td></tr>
<tr><td><code id="bhm_+3A_...">...</code></td>
<td>
<p>additional arguments to be passed to the low level regression fitting functions (see below)</p>
</td></tr>  
</table>


<h3>Details</h3>

<p>'biomarker' is a Biomarker variable. This variable is required and shall be the first dependent variable in the formula.
</p>
<p>&quot;interaction&quot; is an option of fitting model with itneractin term.
When interaction = TRUE, a predictive biomarker model will be fitted.
When interaction = FALSE, a prognostic biomarker model will be fitted.
Both Biomarker and Treatment variables are required if 'interaction' = TRUE and 'treatment' shall be the second variable in the formula.
</p>
<p>&quot;bhmFit&quot; and &quot;bhmGibbs&quot; are the workhorse functions: they are not normally called directly but can be more efficient where the response vector, design matrix and family have already been calculated.
</p>
<p>&quot;x.cdf&quot; is a function that maps biomarker values to interval (0, 1) using its empirical cumulative distribution function. After the threshold parameters are identified, the biomarker variable will be transformed back to its original scale.
</p>


<h3>Value</h3>

<p>bhm returns an object of class inheriting from &quot;bhm&quot; which inherits from the class glm or 'coxph'. See later in this section.  
</p>
<p>The function &quot;summary&quot; (i.e., &quot;summary.bhm&quot;) can be used to obtain or print a summary of the results, 
for example, the 95
</p>
<p>An object of class &quot;bhm&quot; is a list containing at least the following components:
</p>
<table>
<tr><td><code>c.max</code></td>
<td>
<p>a vector of the mean estimates for the threshold parameter(s)</p>
</td></tr>
<tr><td><code>coefficients</code></td>
<td>
<p>a named vector of coefficients from 'bhm'</p>
</td></tr>
<tr><td><code>c.fit</code></td>
<td>
<p>fitted conditional regression model given c = c.max</p>
</td></tr>
<tr><td><code>cg</code></td>
<td>
<p>Gibbs sample for threshold parmeter c</p>
</td></tr>
<tr><td><code>bg</code></td>
<td>
<p>Gibbs sample for the coefficients beta</p>
</td></tr>
</table>


<h3>Note</h3>

<p>The logistic regression part are based on codes wrote by Tian Fang. 
</p>


<h3>Author(s)</h3>

<p>Bingshu E. Chen (bingshu.chen@queensu.ca)
</p>


<h3>References</h3>

<p>Chen, B. E., Jiang, W. and Tu, D. (2014). A hierarchical Bayes model for biomarker subset effects in clinical trials. Computational Statistics and Data Analysis. vol 71, page 324-334.
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+glm">glm</a></code>, 
<code><a href="survival.html#topic+coxph">coxph</a></code>, 
<code><a href="#topic+bhmControl">bhmControl</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##
## Generate a random data set
n = 300
b = c(0.5, 1, 1.5)
data = gendat.surv(n, c0 = 0.40, beta = b)
age = runif(n, 0, 1)*100
tm = data[, 1]
status = data[, 2]
trt = data[, 3]
ki67 = data[, 4]
## fit a biomarker threshold survival model with one single cut point

# fit = bhm(Surv(tm, status)~ki67+trt+age, interaction = TRUE, B=5, R=10)


## here B=5 and R=10 is used for test run. In general, B &gt; 500 and R &gt; 2000 is
## recommend for the analysis of biomarker variable. To fit a model with 
## two cut points, use: 
##
##     fit = bhm(Surv(tm, status)~bmk+trt+age, B = 500,  R = 2000, c.n = 2)
##
## To print the output, use
##
#       print(fit)
##
</code></pre>

<hr>
<h2 id='bhmControl'> Auxiliary function for bhm fitting</h2><span id='topic+bhmControl'></span><span id='topic+prolikControl'></span>

<h3>Description</h3>

<p>Auxiliary function for <code><a href="#topic+bhm">bhm</a></code> fitting. 
Typically only used internally by 'bhmFit', but may be used to construct a control argument to either function. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  bhmControl(method = 'Bayes', interaction, biomarker.main, alpha, 
               B, R, thin, epsilon, c.n, beta0, sigma0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bhmControl_+3A_method">method</code></td>
<td>
<p>choose either &lsquo;Bayes&rsquo; for Bayes method with MCMC or &lsquo;profile&rsquo; for profile likelihood method with Bootstrap. The default value is 'Bayes'</p>
</td></tr>
<tr><td><code id="bhmControl_+3A_interaction">interaction</code></td>
<td>
<p>an option of fitting model with interaction term
When interaction = TRUE, a predictive biomarker model will be fitted
When interaction = FALSE, a prognostic biomarker model will be fitted
The default value is interaction = TRUE.</p>
</td></tr>
<tr><td><code id="bhmControl_+3A_biomarker.main">biomarker.main</code></td>
<td>
<p>include biomarker main effect, default is TRUE</p>
</td></tr>
<tr><td><code id="bhmControl_+3A_b">B</code></td>
<td>
<p>number of burn in</p>
</td></tr>
<tr><td><code id="bhmControl_+3A_r">R</code></td>
<td>
<p>number of replications for Bayes meothd or number of Bootstrap for profile likelihood method</p>
</td></tr>
<tr><td><code id="bhmControl_+3A_thin">thin</code></td>
<td>
<p>thinning parameter for Gibbs samples, default is 2</p>
</td></tr>
<tr><td><code id="bhmControl_+3A_epsilon">epsilon</code></td>
<td>
<p>biomarker (transformed) step length for profile likelihood method, default is 0.01</p>
</td></tr>
<tr><td><code id="bhmControl_+3A_alpha">alpha</code></td>
<td>
<p>significance level (e.g. alpha=0.05)</p>
</td></tr>
<tr><td><code id="bhmControl_+3A_c.n">c.n</code></td>
<td>
<p>number of threshold (i.e. the cut point), default is 1</p>
</td></tr>
<tr><td><code id="bhmControl_+3A_beta0">beta0</code></td>
<td>
<p>initial value for mean of the prior distribution of beta, default is 0</p>
</td></tr>
<tr><td><code id="bhmControl_+3A_sigma0">sigma0</code></td>
<td>
<p>initial value for variance of the prior distribution of beta, default is 10000</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Control is used in model fitting of &quot;bhm&quot;.
</p>


<h3>Value</h3>

<p>This function checks the internal consisitency and returns a list of value as inputed to control model fit of bhm.
</p>


<h3>Note</h3>

<p>Based on code from Tian Fang.
</p>


<h3>Author(s)</h3>

<p>Bingshu E. Chen</p>


<h3>See Also</h3>

<p><code><a href="#topic+bhm">bhm</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## To fit a prognostic model for biomarker with two cut-points, 
## 500 burn-in samples and 10000 Gibbs samples,

ctl = bhmControl(interaction = FALSE, B = 500, R = 10000, c.n = 2)

##
## then fit the following model
##
#  fit = bhmFit(x, y, family = 'surv', control = ctl)
##
</code></pre>

<hr>
<h2 id='brm'>
Fitting Biomarker Continuous Threshold Models
</h2><span id='topic+brm'></span><span id='topic+brm.default'></span><span id='topic+brm.formula'></span><span id='topic+residuals.brm'></span><span id='topic+summary.brm'></span>

<h3>Description</h3>

<p>{brm} is an R function for Continuous Threshold Models.
It uses the maximum likehood method (Liu and Chen, 2020) 
to identify a cut-point (thershold parameter) for the biomarker in the Cox proportional hazards model.
The model is specified by giving a symbolic description of the linear predictor and a description of the distribution family.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>brm(x, ...)

## S3 method for class 'formula'
brm(formula, data = list(...), interaction = TRUE, 
      method = c("gradient", "profile", "single"), q=1, epsilon = NULL, ...)
# use 
#          brm(y ~ biomarker)             
# or
#          brm(y ~ biomarker + x1 + x2, interactin = FALSE)
#
# to fit a prognostic model with biomarker term only (will be implement in the future)
#
# use 
#
#          brm(y ~ biomarker+treatment+x1+x2+...)
#
# to fit a predictive model with interaciton between biomarker 
# and treatment, adjusted for x1, x2, etc.
# 
# use 
#          brm(x, y, control, ...)
#
# to fit a model without formula
#
# Biomarker shall be in the first dependent variable
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="brm_+3A_formula">formula</code></td>
<td>
<p>an object of class &quot;formula&quot;(or one that can be coerced to that class): a symbolic description of the model to be fitted. 
The details of model specification are given under 'Details'.</p>
</td></tr>

<tr><td><code id="brm_+3A_data">data</code></td>
<td>
<p>an optional data frame, list or environment (or object coercible by 'as.data.frame' to a data frame) containing the variables in the model. 
If not found in data, the variables are taken from environment(formula), typically the environment from which glm is called.</p>
</td></tr>
<tr><td><code id="brm_+3A_interaction">interaction</code></td>
<td>
<p>model with interaction term between biomarker and treatment variables. Default is TRUE.</p>
</td></tr>
<tr><td><code id="brm_+3A_method">method</code></td>
<td>
<p>method to fit a brm model, such as a gradient method or a single-index model. The default method is the &quot;gradient&quot; method.</p>
</td></tr>
<tr><td><code id="brm_+3A_q">q</code></td>
<td>
<p>nubmer of biomarker variables. If q &gt; 1, a single-index model will be fitted. Default is q = 1.</p>
</td></tr>
<tr><td><code id="brm_+3A_x">x</code></td>
<td>
<p>For &quot;brm.default&quot;, x is a design matrix of dimension n * p and y is a vector of observations of length n for a &quot;Surv&quot; survival object for &quot;coxph&quot; models.</p>
</td></tr>

<tr><td><code id="brm_+3A_...">...</code></td>
<td>
<p>additional arguments to be passed to the low level regression fitting functions (see below).</p>
</td></tr>  
<tr><td><code id="brm_+3A_epsilon">epsilon</code></td>
<td>
<p>Step width for the profile likelihood method, default is (max(w)-min(w))/20.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>'biomarker' is a Biomarker variable. This variable is required and shall be the first dependent variable in the formula.
</p>
<p>&quot;interaction&quot; is an option of fitting model with itneractin term.
When interaction = TRUE, a predictive biomarker model will be fitted.
When interaction = FALSE, a prognostic biomarker model will be fitted.
Both Biomarker and Treatment variables are required if 'interaction' = TRUE and 'treatment' shall be the second variable in the formula.
</p>
<p>&quot;brm.default&quot; is the workhorse functions: they are not normally called directly but can be more efficient where the response vector, design matrix and family have already been calculated.
</p>


<h3>Value</h3>

<p>brm returns an object of class inheriting from &quot;brm&quot; which inherits from the class glm or 'coxph'. See later in this section.  
</p>
<p>The function &quot;summary&quot; (i.e., &quot;summary.brm&quot;) can be used to obtain or print a summary of the results, 
for example, the 95
</p>
<p>An object of class &quot;brm&quot; is a list containing at least the following components:
</p>
<table>
<tr><td><code>coefficients</code></td>
<td>
<p>a named vector of coefficients from 'brm'</p>
</td></tr>
<tr><td><code>c.max</code></td>
<td>
<p>the maximum likelihood estimate for the threshold parameter(s).</p>
</td></tr>
<tr><td><code>theta</code></td>
<td>
<p>a vector contains both the coefficients and c.max.</p>
</td></tr>
<tr><td><code>var</code></td>
<td>
<p>the variance matrix of theta.</p>
</td></tr>
<tr><td><code>loglik</code></td>
<td>
<p>the log-likelihood with the final values of the coefficients.</p>
</td></tr>
<tr><td><code>linear.predictors</code></td>
<td>
<p>the vector of linear predictors, one per subject.</p>
</td></tr>
<tr><td><code>first</code></td>
<td>
<p>the first derivative vector at the solution.</p>
</td></tr>

</table>


<h3>Author(s)</h3>

<p>Shuoshuo Liu (shuoshuo.liu@psu.edu) and Bingshu E. Chen (bingshu.chen@queensu.ca)
</p>


<h3>References</h3>

<p>Liu, S. S. and Chen, B. E. (2020). Continuous threshold models with two-way interactions in survival analysis. Canadian Journal of Statistics. Vol. 48, page 751-772. 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bhm">bhm</a></code>, 
<code><a href="survival.html#topic+coxph">coxph</a></code>,
<code><a href="#topic+plot.brm">plot.brm</a></code>,
<code><a href="#topic+print.brm">print.brm</a></code>,
<code><a href="#topic+residuals.brm">residuals.brm</a></code>,
<code><a href="#topic+summary.brm">summary.brm</a></code>,
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##
## Generate a random data set
n = 100
b = c(0.5, 1, 1.5)
data = gendat.surv(n, c0 = 0.40, beta = b, type="brm")
age = runif(n, 0, 1)*100
tm = data[, 1]
status = data[, 2]
trt = data[, 3]
ki67 = data[, 4]
## fit a biomarker threshold survival model with one single cut point

   fit = brm(Surv(tm, status)~ki67+trt+age)
##
## fit a prognostic continuous threshold model with biomarker only
##
#    fit = brm(Surv(tm, status)~ki67)
##
## To print the output, use
##
#    print(fit)
##
</code></pre>

<hr>
<h2 id='data'>dataset</h2><span id='topic+data'></span><span id='topic+gendat.glm'></span><span id='topic+gendat.surv'></span>

<h3>Description</h3>

<p>dataset for biomarker threshold model (bhm)
</p>


<h3>Usage</h3>

<pre><code class='language-R'># to generate survival data, use: 

   gendat.surv(n, c0, beta, type=c("brm", "bhm"))

# to generate glm data, use:

   gendat.glm(n, c0, beta)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="data_+3A_n">n</code></td>
<td>
<p>sample size</p>
</td></tr>
<tr><td><code id="data_+3A_c0">c0</code></td>
<td>
<p>cut off point, for example c0 = 0.4</p>
</td></tr>
<tr><td><code id="data_+3A_beta">beta</code></td>
<td>
<p>regression coefficient, for example, beta = c(0.3, log(0.5), log(0.25))</p>
</td></tr>
<tr><td><code id="data_+3A_type">type</code></td>
<td>
<p>type of biomarker threshold model, either bhm or brm, default is type = &quot;brm&quot;</p>
</td></tr>
</table>


<h3>Format</h3>

<p>The format of the data set for analysis shall be a data frame with a response variable (either a 
Surv object for Cox model or a glm response variable object) and at least one dependent variable as 
the biomarker variable.
</p>


<h3>Details</h3>

<p>data set of prostate cancer in the 'survival' package is used as an example in paper 
by Chen, et al. (2014).
</p>


<h3>Source</h3>

<p>prosate dataset can be loaded with 'library(survival)'.
</p>


<h3>References</h3>

<p>Chen, B. E., Jiang, W. and Tu, D. (2014). A hierarchical Bayes model for biomarker subset eff
ects in clinical trials. Computational Statistics and Data Analysis. vol 71, page 324-334.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#data(data)
## maybe str(data) ; plot(data) ...
c0 = 0.4
b = c(-0.5, 1.5, 1.3)
data = gendat.surv(n=30, c0 = c0, beta = b)
</code></pre>

<hr>
<h2 id='glmpLRT'>Penalized likelihood ratio test for the generalized linear models.
</h2><span id='topic+glmpLRT'></span><span id='topic+glmpLRT.default'></span><span id='topic+glmpLRT.formula'></span><span id='topic+plot.glmpLRT'></span><span id='topic+print.glmpLRT'></span><span id='topic+summary.glmpLRT'></span>

<h3>Description</h3>

<p>{glmpLRT} is an R function for the penalized likelihood ratio test in generalized lienar models.
It uses the penalized likehood method (Gavanji, Jiang and Chen, 2021)
to identify a cut-point (thershold parameter) for the biomarker in the generalized linear models.
The model is specified by giving a symbolic description of the linear predictor and 
a description of the distribution family.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'formula'
glmpLRT(formula, family = binomial, 
  data=list(...), lambda = 15, c0 = 0.5, p1 = 1, 
  method = c("pLRT", "Davies", "Bootstrap"), 
  B=10, K = 50, epsilon = 0.025,...)
# use 
#          glmpLRT(y ~ biomarker)             
# or
#          glmpLRT(y ~ biomarker + x1 + x2, p1=0)
#
# to fit a prognostic model with biomarker term adjust for 
# covariates x1, x2, etc.
#
# use 
#
#          glmpLRT(y ~ biomarker+x1+x2+x3+x4+x5, p1=2...)
#
# to fit a predictive model with interaciton between biomarker 
# and x1, x2, adjusted for x3, x4, x5, etc.
# 
# use 
#          glmpLRT(x, y, control, ...)
#
# to fit a model without formula
#
# Biomarker shall be in the first dependent variable
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="glmpLRT_+3A_formula">formula</code></td>
<td>
<p>an object of class &quot;<code>formula</code>&quot;: a sympolic description of the model to be fitted. The details of model specificatoin are given under 'Details'.</p>
</td></tr>
<tr><td><code id="glmpLRT_+3A_family">family</code></td>
<td>
<p>a description of the error distribution and the link function to be used in the glm model. (See <code>family</code> for details of family functions.)</p>
</td></tr>
<tr><td><code id="glmpLRT_+3A_data">data</code></td>
<td>
<p>an optional data frame, list or enviroment containing the variables in the model.</p>
</td></tr>
<tr><td><code id="glmpLRT_+3A_method">method</code></td>
<td>
<p>the method to be used to fit a glmpLRT model. The default method is the &quot;pLRT&quot; method for the penalized likelihood ratio test. Other options include &quot;Davis&quot; for the Davis test and &quot;Bootstrap&quot; for the bootstrap test.</p>
</td></tr>
<tr><td><code id="glmpLRT_+3A_lambda">lambda</code></td>
<td>
<p>the tuning parameter for the penalized likelihood function, default is lambda = 15.</p>
</td></tr>
<tr><td><code id="glmpLRT_+3A_c0">c0</code></td>
<td>
<p>the cut point for the threshold function, default is c0 = 0.5. Other options include c0 = 0.25 and c0 = 0.75.</p>
</td></tr>
<tr><td><code id="glmpLRT_+3A_p1">p1</code></td>
<td>
<p>the number of covariates interact with the biomarker variable, the default is p1 = 1. If p1 = 0, then fit a model with biomarker main effect, adjusted for other potential covariates.</p>
</td></tr>
<tr><td><code id="glmpLRT_+3A_b">B</code></td>
<td>
<p>the number of bootstrap sample if the Bootstrap method is used.</p>
</td></tr>
<tr><td><code id="glmpLRT_+3A_k">K</code></td>
<td>
<p>smoothing parameter for the indicator function, the large value of K the better approximation of the indicator function, default is K = 50.</p>
</td></tr>
<tr><td><code id="glmpLRT_+3A_epsilon">epsilon</code></td>
<td>
<p>Step width for the profile likelihood method, default is epsilon = 0.025.</p>
</td></tr>
<tr><td><code id="glmpLRT_+3A_...">...</code></td>
<td>
<p>additional arguments to be passed to the low level regression fitting functions (see below).</p>
</td></tr>  
</table>


<h3>Details</h3>

<p>'biomarker' is a Biomarker variable. This variable is required and shall be the first dependent variable in the formula. It is not necessary to use the variable name 'biomarker', other variable name is allowed too.
</p>
<p>'p1' controls the number of other covariates that interact with the biomarker variable. 
</p>
<p>&quot;glmpLRT.default&quot; is the workhorse functions: they are not normally
called directly but can be more efficient where the response 
vector, design matrix and family have already been calculated.
</p>
<p>&quot;print&quot;, &quot;plot&quot; and &quot;summary&quot; methods can be applied to a fitted &quot;glmpLRT&quot; class to display the results.
</p>


<h3>Value</h3>

<p>glmpLRT returns an object of class inheriting from &quot;glmpLRT&quot; which inherits from the class glm. See later in this section.  
</p>
<p>An object of class &quot;glmpLRT&quot; is a list containing at least the following components:
</p>
<table>
<tr><td><code>coefficients</code></td>
<td>
<p>a named vector of coefficients from 'glmpLRT'</p>
</td></tr>
<tr><td><code>c.max</code></td>
<td>
<p>the maximum likelihood estimate for the threshold parameter(s).</p>
</td></tr>
<tr><td><code>loglik</code></td>
<td>
<p>the log-likelihood with the final values of the coefficients.</p>
</td></tr>
<tr><td><code>linear.predictors</code></td>
<td>
<p>the vector of linear predictors, one per subject.</p>
</td></tr>
<tr><td><code>mpv</code></td>
<td>
<p>p-value for the penalized likelihood ratio test.</p>
</td></tr>
<tr><td><code>rpv</code></td>
<td>
<p>p-value for the Davis test.</p>
</td></tr>
<tr><td><code>bpv</code></td>
<td>
<p>p-value for the Bootstrap test.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Bingshu E. Chen (bingshu.chen@queensu.ca)
</p>


<h3>References</h3>

<p>Gavanji, P., Jiang, W. and Chen, B. E. (2021).
Penalized likelihood ratio test for a biomarker threshold effect in clinical trials based on generalized linear models.
Canadian Journal of Statistics. 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+glmpLRT">glmpLRT</a></code>, 
<code><a href="stats.html#topic+glm">glm</a></code>,
<code><a href="#topic+plot.glmpLRT">plot.glmpLRT</a></code>,
<code><a href="#topic+print.glmpLRT">print.glmpLRT</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## A simulated example
bmk = rnorm(100, 3, 0.25)
age = rnorm(100, 50, 20)
trt = rbinom(100, 1, 0.5)
lp = exp(log(0.25) + 0.1*ifelse(bmk&gt;2.5, 1, 0) + 0.69*trt)
p = lp/(1+lp)
y = rbinom(100, 1, p)
fit = glmpLRT(y~bmk+trt+age, p1 = 0)
print(fit)
</code></pre>

<hr>
<h2 id='llm'>Fit an L-shape linear model</h2><span id='topic+llm'></span><span id='topic+llm.default'></span><span id='topic+llm.formula'></span><span id='topic+plot.llm'></span><span id='topic+print.llm'></span>

<h3>Description</h3>

<p>Fit an L-shape linear model with the cut point estimated by the profile likelihood method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'formula'
llm(formula, data=list(...), epsilon = 0.025, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="llm_+3A_formula">formula</code></td>
<td>
<p>an object of class &quot;<code>formula</code>&quot;: a sympolic description of the model to be fitted. The details of model specificatoin are given under 'Details'.</p>
</td></tr>
<tr><td><code id="llm_+3A_data">data</code></td>
<td>
<p>an optional data frame, list or enviroment containing the variables in the model.</p>
</td></tr>
<tr><td><code id="llm_+3A_epsilon">epsilon</code></td>
<td>
<p>Step width for the profile likelihood method, default is 0.025</p>
</td></tr>
<tr><td><code id="llm_+3A_...">...</code></td>
<td>
<p>additional arguments to be passed to the low level regression fitting functions (see below).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Define a L shape linear funcation that change slope at c0:
</p>
<p>when x &lt;c0, y = b1 + b2*x
</p>
<p>when x&gt;=c0, y = b1 + b2*x  + b3*(x-x0)
= (b1-b3*c0) + (b2+b3)*x
</p>


<h3>Value</h3>

<p>llm returns an object of class inheriting from &quot;llm&quot; which inherits from the class glm. See later in this section.
</p>
<p>An object of class &quot;llm&quot; is a list containing at least the following components:
</p>
<table>
<tr><td><code>coefficients</code></td>
<td>
<p>a named vector of coefficients from 'llm'</p>
</td></tr>
<tr><td><code>residuals</code></td>
<td>
<p>the residuals, that is response minus fitted values.</p>
</td></tr>
<tr><td><code>fitted.values</code></td>
<td>
<p>the fitted mean values.</p>
</td></tr>
<tr><td><code>rank</code></td>
<td>
<p>the numeric rank of the fitted linear model.</p>
</td></tr>
<tr><td><code>df.residual</code></td>
<td>
<p>the residual degrees of freedom.</p>
</td></tr>
<tr><td><code>call</code></td>
<td>
<p>the matched call.</p>
</td></tr>
<tr><td><code>terms</code></td>
<td>
<p>the 'terms' object used.</p>
</td></tr>
<tr><td><code>c.max</code></td>
<td>
<p>the maximum likelihood estimate for the threshold parameter(s).</p>
</td></tr>
<tr><td><code>loglik</code></td>
<td>
<p>the log-likelihood with the final values of the coefficients.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Bingshu E. Chen (bingshu.chen@queensu.ca)
</p>


<h3>References</h3>

<p>Liu, S. S. and Chen, B. E. (2020). Continuous threshold models with two-way interactions in survival analysis. Canadian Journal of Statistics. Vol. 48, page 751-772.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+brm">brm</a></code>, 
<code><a href="stats.html#topic+lm">lm</a></code>,
<code><a href="stats.html#topic+glm">glm</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#### simulate the data and fit a L-shape model.
n = 50 ; p &lt;- 2
X = matrix(rnorm(n * p), n, p) # no intercept!
w = X[, 1]; age = X[, 2]

wc = w - 0.2; sigma = 0.25
y = rnorm(n, -0.1+0.7*w-1.2*ifelse(wc&gt;0, wc, 0), sigma)

fit=llm(y~w+age)
print(fit)
print(summary(fit))
#### to plot the L-shape function
# plot(fit)
</code></pre>

<hr>
<h2 id='mpl'>
Joint models for clustered data with binary and survival outcomes.
</h2><span id='topic+mpl'></span><span id='topic+mpl.formula'></span><span id='topic+mplFit'></span>

<h3>Description</h3>

<p>{mpl} is a function to fit a joint model for clustered binary and survival data using maximum penalized likelihood (MPL) method  with Jackknife variance.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mpl(formula, ...)

## S3 method for class 'formula'
mpl(formula, formula.glm, formula.cluster, data, weights=NULL,
    subset = NULL, max.iter=100, tol = 0.005, jackknife=TRUE, ...)
#
# Use:
#
# fit = mpl(Surv(time, status)~w+z, y~x1+x2, ~cluster, data=data)
#
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mpl_+3A_formula">formula</code></td>
<td>
<p>an object of class &quot;formula&quot;(or one that can be coerced to
that class): a symbolic description of the Cox proportiobal hazards model to be fitted
for survival data.</p>
</td></tr>
<tr><td><code id="mpl_+3A_formula.glm">formula.glm</code></td>
<td>
<p>an object of class &quot;formula&quot;(or one that can be coerced to 
that class): a symbolic description of the generalized linear model to be fitted for 
binary data.</p>
</td></tr>
<tr><td><code id="mpl_+3A_formula.cluster">formula.cluster</code></td>
<td>
<p>an object of class &quot;formula&quot;(or one that can be coerced to
that class): a symbolic description of the cluster variable.</p>
</td></tr>
<tr><td><code id="mpl_+3A_data">data</code></td>
<td>
<p>an optional data frame, list or environment (or object coercible by 
'as.data.frame' to a data frame) containing the variables in the model. 
If not found in data, the variables are taken from environment(formula), typically the enviro
nment from which mpl is called.</p>
</td></tr>
<tr><td><code id="mpl_+3A_weights">weights</code></td>
<td>
<p>an optional vector of weights to be used in the fitting
process.  Should be 'NULL' or a numeric vector. If non-NULL, weights options 
in the glm model and the coxph model will be assinged with the supplied weights.</p>
</td></tr>
<tr><td><code id="mpl_+3A_subset">subset</code></td>
<td>
<p>only a subset of data will be used for model fitting.</p>
</td></tr>
<tr><td><code id="mpl_+3A_max.iter">max.iter</code></td>
<td>
<p>Maximum number of iterations, default is max.iter = 100</p>
</td></tr>
<tr><td><code id="mpl_+3A_tol">tol</code></td>
<td>
<p>Tolrance for convergence, default is tol = 0.005</p>
</td></tr>
<tr><td><code id="mpl_+3A_jackknife">jackknife</code></td>
<td>
<p>Jackknife method for variance, default is jackknife = TRUE</p>
</td></tr>
<tr><td><code id="mpl_+3A_...">...</code></td>
<td>
<p>additional arguments to be passed to the low level regression fitting 
functions (see below).</p>
</td></tr>  
</table>


<h3>Details</h3>

<p>mpl(Surv(time, event)~w+z, y~x1+x2, ~cluster) will fit penalized likelihood for binary and survival data with cluster effect.
Function print(x) can be used to print a summary of mpl results.
</p>


<h3>Value</h3>

<p>mpl returns an object of class inheriting from &quot;mpl&quot;. 
When jackknife = TRUE, an object of class &quot;mpl&quot; is a list containing the following components:
</p>
<table>
<tr><td><code>theta</code></td>
<td>
<p>the maximum estimate of the regression coefficients and varaince component</p>
</td></tr>  
<tr><td><code>OR_HR</code></td>
<td>
<p>Odds ratios (OR) and hazard ratios (HR) for binary and survival outcomes, respectively</p>
</td></tr>
<tr><td><code>ase</code></td>
<td>
<p>Asymptotic standard error for theta, which is usually understimated</p>
</td></tr>
<tr><td><code>jse</code></td>
<td>
<p>Jackknife standard error of theta based on resampling, this is considered to be more robust</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Based on code from J. Wang.
</p>


<h3>Author(s)</h3>

<p>Bingshu E. Chen (bingshu.chen@queensu.ca)
</p>


<h3>References</h3>

<p>Chen, B. E. and Wang, J. (2020). Joint modelling of binary response and survival for clustered data in clinical trials. Statistics in Medicine. Vol 39. 326-339.
</p>


<h3>See Also</h3>

<p><code><a href="survival.html#topic+coxph">coxph</a></code>, 
<code><a href="stats.html#topic+glm">glm</a></code>, 
<code><a href="base.html#topic+print">print</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##
### No run
# 
# fit = mpl(Surv(time, event)~trt+ki67, resp~trt+age, ~center.id) 
#
</code></pre>

<hr>
<h2 id='pIndex'>
Probability Index for Survival Time Difference
</h2><span id='topic+pIndex'></span><span id='topic+pIndex.default'></span><span id='topic+pIndex.formula'></span><span id='topic+pIndexFit'></span><span id='topic+pIndexLocal'></span><span id='topic+pIndexThreshold'></span>

<h3>Description</h3>

<p>{pIndex} is a function to estimate and test differce of survival time among groups.
It is defined as p = Pr{T_1 &lt; T_2 }, where $T_1$ is survival time for subjects in 
group 1 and $T_2$ is surval time in group 2.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pIndex(x, ...)

## S3 method for class 'formula'
pIndex(formula, data, control = list(...),...)
###To estimate probability index for treatment and control groups (define by trt):
#
# fit = pIndex(Surv(time, status) ~ trt)
#
###To estimate probability index difference for treatment and control 
###groups (define by trt) between biomarker postive and biomarker negative
###subjects(i.e. Treatment-biomarker interaction):
#
# fit = pIndex(Surv(time, status) ~ trt+biomarker)
#
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pIndex_+3A_formula">formula</code></td>
<td>
<p>an object of class &quot;formula&quot;(or one that can be coerced to that class): a sy
mbolic description of the model to be fitted. 
The details of model specification are given under 'Details'.</p>
</td></tr>
<tr><td><code id="pIndex_+3A_data">data</code></td>
<td>
<p>an optional data frame, list or environment (or object coercible by 
'as.data.frame' to a data frame) containing the variables in the model. 
If not found in data, the variables are taken from environment(formula), typically the enviro
nment from which pIndex is called.</p>
</td></tr>
<tr><td><code id="pIndex_+3A_x">x</code></td>
<td>
<p>Here covariate x is a design matrix of dimension n * 1 (for two sample test) 
or dimension n * 2 (for treatment * biomarker interaction).</p>
</td></tr>
<tr><td><code id="pIndex_+3A_control">control</code></td>
<td>
<p>a list of parameters for controlling the fitting process. 
See 'pIndexControl' for details</p>
</td></tr> 
<tr><td><code id="pIndex_+3A_...">...</code></td>
<td>
<p>additional arguments to be passed to the low level regression fitting 
functions (see below).</p>
</td></tr>  
</table>


<h3>Details</h3>

<p>pIndex(y~x) will estimate probability index of two groups (eg. treatment vs control) define by x. 
pIndex(y~x1 + x2) will estimate the difference of probability index of x1 (eg. treatment vs control)
between biomarker positive and biomarker negative groups (x2).
Function print(x) can be used to print a summary of pIndex results.
</p>


<h3>Value</h3>

<p>pIndex returns an object of class inheriting from &quot;pIndex&quot;. 
When B &gt; 0, an object of class &quot;pIndex&quot; is a list containing at least the following components:
</p>
<table>
<tr><td><code>theta</code></td>
<td>
<p>the estimated probability index</p>
</td></tr>  
<tr><td><code>theta.b</code></td>
<td>
<p>Bootstrap or Jackknife sample of the probability index</p>
</td></tr>
<tr><td><code>sd</code></td>
<td>
<p>standard deviation of theta based on resampling</p>
</td></tr>
<tr><td><code>ci</code></td>
<td>
<p>(1-alpha) percent confidence interval based on resampling</p>
</td></tr>
</table>


<h3>Note</h3>

<p>This function is part of the bhm package.
</p>


<h3>Author(s)</h3>

<p>Bingshu E. Chen (bingshu.chen@queensu.ca)
</p>


<h3>References</h3>

<p>Jiang, S., Chen, B. E. and Tu, D.(2016). Inference on treatment-covariate interaction based on a nonparametric measure of treatment effects and censored survival data. Statistics in Medicine. 35, 2715-2725.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bhm">bhm</a>, <a href="#topic+pIndexControl">pIndexControl</a></code>, 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##
## Generate a random data set
n = 50
b = c(0.5, 1, 1.5)
data = gendat.surv(n, c0 = 0.40, beta = b, type='brm')
age = runif(n, 0, 1)*100
tm = data[, 1]
status = data[, 2]
trt = data[, 3]
ki67 = data[, 4]
#
### No run
# 
# fit = pIndex(Surv(tm, status) ~ trt + ki67) 
#
</code></pre>

<hr>
<h2 id='pIndexControl'> Auxiliary function for pIndex fitting</h2><span id='topic+pIndexControl'></span>

<h3>Description</h3>

<p>Auxiliary function for <code><a href="#topic+pIndex">pIndex</a></code> fitting. 
Typically only used internally by 'pIndexFit', but may be used to construct a control argument to either function. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  pIndexControl(method = c("Efron", "Elc", "Elw", "Pic"), 
                model = c("default", "local", "threshold"), 
	        ci = c("Bootstrap", "Jackknife"), weights = NULL, 
		kernel = NULL, h = 0.1, w  = seq(0.05, 0.95, 0.05), 
		alpha = 0.05, B = 0, pct = 0.5, tau=NULL) 
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pIndexControl_+3A_method">method</code></td>
<td>
<p>choose either &lsquo;Efron&rsquo; for Efron method, 
&lsquo;Elc&rsquo; for conditional empirical likelihood, 
&lsquo;Elw&rsquo; for weighted empirical likelihood method, and 
&lsquo;Pic&rsquo; for piecewise exponential distribution. The default value is &lsquo;Efron&rsquo;</p>
</td></tr>
<tr><td><code id="pIndexControl_+3A_model">model</code></td>
<td>
<p>&lsquo;default&rsquo; for default pIndex model, &lsquo;local&rsquo; for kernel method, &lsquo;threshold&rsquo; for threshold method</p>
</td></tr>
<tr><td><code id="pIndexControl_+3A_ci">ci</code></td>
<td>
<p>Method to construct confidence interval, &lsquo;Bootstrap&rsquo; for Bootstrap method and 
&lsquo;Jackknife&rsquo; for Jackknife method</p>
</td></tr>
<tr><td><code id="pIndexControl_+3A_weights">weights</code></td>
<td>
<p>case weight</p>
</td></tr>
<tr><td><code id="pIndexControl_+3A_kernel">kernel</code></td>
<td>
<p>kernel funtion types, including &quot;gaussian&quot;, &quot;epanechnikov&quot;, &quot;rectangular&quot;, &quot;triangular&quot;, &quot;biweiht&quot;, &quot;cosine&quot;, &quot;optcosine&quot;. The default value is &lsquo;gaussian&rsquo;</p>
</td></tr>
<tr><td><code id="pIndexControl_+3A_h">h</code></td>
<td>
<p>bandwidth, defaul is 0.1</p>
</td></tr>
<tr><td><code id="pIndexControl_+3A_w">w</code></td>
<td>
<p>percentile of biomarker value for local fit</p>
</td></tr>
<tr><td><code id="pIndexControl_+3A_b">B</code></td>
<td>
<p>number of Bootstrap sample</p>
</td></tr>
<tr><td><code id="pIndexControl_+3A_alpha">alpha</code></td>
<td>
<p>significance level (e.g. alpha=0.05)</p>
</td></tr>
<tr><td><code id="pIndexControl_+3A_pct">pct</code></td>
<td>
<p>Percentile of threshold (i.e. the cut point), default is 0.5</p>
</td></tr>
<tr><td><code id="pIndexControl_+3A_tau">tau</code></td>
<td>
<p>maximum time tau to be used for pIndex</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Control is used in model fitting of &lsquo;pIndex&rsquo;.
</p>


<h3>Value</h3>

<p>This function checks the internal consisitency and returns a list of value as inputed to control model fit of pIndex.
</p>


<h3>Note</h3>

<p>Based on code from Bingshu E. Chen.
</p>


<h3>Author(s)</h3>

<p>Bingshu E. Chen</p>


<h3>See Also</h3>

<p><code><a href="#topic+bhm">bhm</a>, <a href="#topic+pIndex">pIndex</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## To calculate the probability index for a biomarker with conditional empirical likelihood method, 
## and the corresponding 90 percent CI using Bootstrap method with 10000 bootstrap sample

ctl = pIndexControl(method = 'Elc', ci = 'Bootstrap', B = 10000, alpha = 0.1)

##
## then fit the following model
##
#  fit = pIndex(y~x1 + x2, family = 'surv', control = ctl)
##
</code></pre>

<hr>
<h2 id='plot'>
Plot a fitted biomarker threhold model
</h2><span id='topic+plot.bhm'></span><span id='topic+plot.brm'></span><span id='topic+plot.pIndex'></span><span id='topic+plot.resboot'></span><span id='topic+plot.residuals.brm'></span>

<h3>Description</h3>

<p>Several different type of plots can be produced for biomarker threshold mdels. 
Plot method is used to provide a summary of outputs from &quot;bhm&quot;, &quot;pIndex&quot;, &quot;resboot&quot;.
</p>
<p>Use &quot;methods(plot)&quot; and the documentation for these for other plot methods.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bhm'
plot(x, type = c("profile", "density"), ...)
## S3 method for class 'brm'
plot(x, type = c("HR"), ...)
## S3 method for class 'pIndex'
plot(x, ...)
## S3 method for class 'resboot'
plot(x, ...)
## S3 method for class 'residuals.brm'
plot(x, type="Martingale", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_+3A_x">x</code></td>
<td>
<p>a class returned from &quot;bhm&quot;, &quot;pIndex&quot; or &quot;resboot&quot; fit.</p>
</td></tr>
<tr><td><code id="plot_+3A_type">type</code></td>
<td>
<p>type of plot in bhm object, &quot;profile&quot; to plot profile likelihood,   &quot;density&quot; to plot trace and density of the threshold distribution. &quot;HR&quot; to plot hazard ratio of the &quot;brm&quot; boject.</p>
</td></tr>
<tr><td><code id="plot_+3A_...">...</code></td>
<td>
<p>other options used in plot().</p>
</td></tr>
</table>


<h3>Details</h3>

<p>plot.bhm is called to plot either the profilelihood function or the threshold
density function. 
</p>
<p>plot.pIndex is called to plot local probability index (<code><a href="#topic+pIndex">pIndex</a></code>)
of a continuous biomarker.
</p>
<p>plot.resboot is called to plot the bootstrap distribution of the likelihood 
ratio test statistics for biomarker threshold models (<code><a href="#topic+resboot">resboot</a></code>).
</p>
<p>The default method, plot.default has its own help page. Use methods(&quot;plot&quot;) to get all the methods for the plot generic.
</p>


<h3>Author(s)</h3>

<p>Bingshu E. Chen</p>


<h3>See Also</h3>

<p>The default method for plot <code><a href="graphics.html#topic+plot.default">plot.default</a></code>.
<code><a href="stats.html#topic+glm">glm</a></code>
<code><a href="#topic+bhm">bhm</a></code>
<code><a href="#topic+pIndex">pIndex</a></code>
<code><a href="#topic+resboot">resboot</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#
#  plot(fit)
# 
######## plot for bhm object
#
#  plot(fit, type = 'density')
#
</code></pre>

<hr>
<h2 id='print'>
print a fitted object or a summary of fitted object
</h2><span id='topic+print.bhm'></span><span id='topic+print.brm'></span><span id='topic+print.mpl'></span><span id='topic+print.picreg'></span><span id='topic+print.pIndex'></span><span id='topic+print.resboot'></span><span id='topic+print.summary.bhm'></span><span id='topic+print.summary.brm'></span>

<h3>Description</h3>

<p>print and summary are used to provide a short summary of outputs from &quot;bhm&quot;, &quot;brm&quot;, &quot;mpl&quot;, &quot;pIndex&quot;, &quot;resboot&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bhm'
print(x, ...)
## S3 method for class 'brm'
print(x, digits = 4, ...)
## S3 method for class 'mpl'
print(x, digits = 3, ...)
## S3 method for class 'pIndex'
print(x, ...)
## S3 method for class 'picreg'
print(x, digits=3, ...)
## S3 method for class 'resboot'
print(x, ...)
## S3 method for class 'summary.bhm'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print_+3A_x">x</code></td>
<td>
<p>a class returned from bhm, pIndex or resboot fit</p>
</td></tr>
<tr><td><code id="print_+3A_digits">digits</code></td>
<td>
<p>number if digits to be printed</p>
</td></tr>
<tr><td><code id="print_+3A_...">...</code></td>
<td>
<p>other options used in print()</p>
</td></tr>
</table>


<h3>Details</h3>

<p>print.bhm is called to print object or summary of object from the biomarker threshold models <code><a href="#topic+bhm">bhm</a></code>.  
print.pIndex is called to print object or summary of object from the probability index model <code><a href="#topic+pIndex">pIndex</a></code>.
print.resboot is called to print object or summary of object from the residuall bootstrap method for biomarker threshold models <code><a href="#topic+resboot">resboot</a></code>.
summary(fit) provides detail summary of &lsquo;bhm&rsquo; model fit, including parameter estimates, 
standard errors, and 95 percent CIs.
</p>
<p>The default method, print.default has its own help page. Use methods(&quot;print&quot;) to get all the methods for the print generic.
</p>


<h3>Author(s)</h3>

<p>Bingshu E. Chen</p>


<h3>See Also</h3>

<p>The default method for print <code><a href="base.html#topic+print.default">print.default</a></code>. Other methods include
<code><a href="stats.html#topic+glm">glm</a></code>, 
<code><a href="#topic+bhm">bhm</a></code>,
<code><a href="#topic+brm">brm</a></code>, 
<code><a href="#topic+mpl">mpl</a></code>,
<code><a href="#topic+pIndex">pIndex</a></code>,
<code><a href="#topic+resboot">resboot</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#
#  print(fit)
#
</code></pre>

<hr>
<h2 id='resboot'>
Rresidual Bootstrap Test (RBT) for treatment-biomarker interaction
</h2><span id='topic+resboot'></span><span id='topic+resboot.default'></span><span id='topic+resboot.formula'></span>

<h3>Description</h3>

<p>{resboot} is a function to test the existance of treatment-biomarker 
interaction in biomarker threshold model 
</p>
<p>g(Y) = b0+b1*I(w&gt;c) + b2*z + b3*I(w&gt;c)*z.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>resboot(x, ...)

## S3 method for class 'formula'
resboot(formula, family, data=list(...), B = 100, epsilon = 0.01, ...)
#
###To test the null hypothesis of interaction between treatment variable  
###(define by z) and biomarker variables (define by w) for survival dataa, 
###use:
#
# fit = resboot(Surv(time, status) ~ w + z + w:z)
#
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="resboot_+3A_formula">formula</code></td>
<td>
<p>an object of class &quot;formula&quot;(or one that can be coerced to 
that class): a symbolic description of the model to be fitted. 
The details of model specification are given under 'Details'.</p>
</td></tr>
<tr><td><code id="resboot_+3A_family">family</code></td>
<td>
<p>default is family = 'Surv' for survival data.</p>
</td></tr>
<tr><td><code id="resboot_+3A_data">data</code></td>
<td>
<p>an optional data frame, list or environment (or object coercible by 
'as.data.frame' to a data frame) containing the variables in the model. 
If not found in data, the variables are taken from environment(formula), typically the enviro
nment from which resboot is called.</p>
</td></tr>
<tr><td><code id="resboot_+3A_x">x</code></td>
<td>
<p>Here covariate x is a design matrix of dimension n * 1 (for two sample test) 
or dimension n * 2 (for treatment * biomarker interaction).</p>
</td></tr>
<tr><td><code id="resboot_+3A_b">B</code></td>
<td>
<p>Number of bootstraps, default is B = 100</p>
</td></tr>
<tr><td><code id="resboot_+3A_epsilon">epsilon</code></td>
<td>
<p>Biomarker (transformed) step length for profile likelihood method, default is epsilon = 0.01</p>
</td></tr>
<tr><td><code id="resboot_+3A_...">...</code></td>
<td>
<p>additional arguments to be passed to the low level regression fitting 
functions (see below).</p>
</td></tr>  
</table>


<h3>Details</h3>

<p>resboot(y~w + z + w:z) will give residual bootstrap p-value for interaction
between biomarker variable (w) and treatment variable (z).
The null hypothesis is given by H0: b3 = 0, where b3 is the regression 
coefficient for the interaction term I(w&gt;c)*z.
Function print(x) can be used to print a summary of resboot results.
</p>


<h3>Value</h3>

<p>resboot returns an object of class inheriting from &quot;resboot&quot;. 
When B &gt; 0, an object of class &quot;resboot&quot; is a list containing at least the following components:
</p>
<table>
<tr><td><code>theta</code></td>
<td>
<p>the estimated maximum of likelihood ratio statistics</p>
</td></tr>  
<tr><td><code>theta.b</code></td>
<td>
<p>Bootstrap sample of theta</p>
</td></tr>
<tr><td><code>sd</code></td>
<td>
<p>standard deviation of theta based on resampling</p>
</td></tr>
<tr><td><code>ci</code></td>
<td>
<p>(1-alpha) percent confidence interval for theta based on resampling</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Based on code from Parisa Gavanji.
</p>


<h3>Author(s)</h3>

<p>Bingshu E. Chen (bingshu.chen@queensu.ca)
</p>


<h3>References</h3>

<p>Gavanji, P., Chen, B. E. and Jiang, W.(2018). Residual Bootstrap test for interactions in biomarker threshold models with survival data. Statistics in Biosciences.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bhm">bhm</a></code>
<code><a href="survival.html#topic+coxph">coxph</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##
## Generate a random data set
n = 30
b = c(0.5, 1, 1.5)
data = gendat.surv(n, c0 = 0.40, beta = b)
tm = data[, 1]
status = data[, 2]
trt = data[, 3]
ki67 = data[, 4]
#
### No run
# 
# fit = resboot(Surv(tm, status) ~ ki67+trt+ki67:trt) 
#
</code></pre>

<hr>
<h2 id='rmscb'>
Fitting Restricted Mean Survival Time Models with a Continuous Biomarker
</h2><span id='topic+rmscb'></span><span id='topic+rmsControl'></span><span id='topic+rmscb.default'></span><span id='topic+rmscb.formula'></span><span id='topic+plot.rmscb'></span><span id='topic+print.rmscb'></span><span id='topic+summary.rmscb'></span><span id='topic+summary.rmscb'></span>

<h3>Description</h3>

<p>{rmscb} is an R function for restricted mean survival time (RMST) as a continuous function for a 
biomarker variables.
The model is specified by giving a symbolic description of the linear predictor and a description of the distribution family.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  rmscb(x, ...)

  ## S3 method for class 'formula'
rmscb(formula, data, subset, na.action, tau=5, h=0.2, w0=NULL, 
        sig.level = 0.95, rho = 2,...)
# use 
#          rmscb(y ~ biomarker)             
#
# to fit a prognostic model with biomarker term only 
# 
# use
#          rmscb(y ~ biomarker + trt)
#
# to fit the difference of RMSTs between two treatment groups.
#
# use 
   ## Default S3 method:
rmscb(x, y, control, ...)
#
# to fit a model without formula, where the biomarker shall be in the 
# first dependent variable
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rmscb_+3A_formula">formula</code></td>
<td>
<p>an object of class &quot;formula&quot;(or one that can be coerced to that class): 
a symbolic description of the model to be fitted. 
The details of model specification are given under 'Details'.</p>
</td></tr>
<tr><td><code id="rmscb_+3A_data">data</code></td>
<td>
<p>an optional data frame, list or environment (or object coercible by 'as.data.frame' 
to a data frame) containing the variables in the model. 
If not found in data, the variables are taken from environment(formula), 
typically the environment from which &quot;rmscb&quot; is called.</p>
</td></tr>
<tr><td><code id="rmscb_+3A_tau">tau</code></td>
<td>
<p>a prespecified time point at which the restricted mean survival time will be calculated.</p>
</td></tr>
<tr><td><code id="rmscb_+3A_subset">subset</code></td>
<td>
<p>an optional vector specifying a subset of observations to be
used in the fitting process.</p>
</td></tr>
<tr><td><code id="rmscb_+3A_na.action">na.action</code></td>
<td>
<p>a function which indicates what should happen when the data contain NAs. 
The default is set by the 'na.action' setting of 'options', and is 'na.fail' if that is unset. 
The 'factory-fresh' default is 'na.omit'.
Another possible value is 'NULL', no action.  Value 'na.exclude' can be useful.</p>
</td></tr>
<tr><td><code id="rmscb_+3A_h">h</code></td>
<td>
<p>the bandwidth, default is h = 0.2, if h = NULL, then the bandwidth will be selected 
using the cross validation method.</p>
</td></tr>
<tr><td><code id="rmscb_+3A_w0">w0</code></td>
<td>
<p>the values of biomarker at which the RMST E(T|w=w0) will be estimated.</p>
</td></tr>
<tr><td><code id="rmscb_+3A_sig.level">sig.level</code></td>
<td>
<p>the significant level of the simultaneuous confidence band will be constructed.</p>
</td></tr>
<tr><td><code id="rmscb_+3A_rho">rho</code></td>
<td>
<p>the mode for the prediction error used in the cross validation bandwidth selection.</p>
</td></tr>
<tr><td><code id="rmscb_+3A_x">x</code></td>
<td>
<p>for 'rmscb.default', x is a design matrix of dimension n * p</p>
</td></tr>
<tr><td><code id="rmscb_+3A_y">y</code></td>
<td>
<p>y is a vector of observations of length n for a &quot;Surv&quot; survival object.</p>
</td></tr>
<tr><td><code id="rmscb_+3A_control">control</code></td>
<td>
<p>a list of parameters for controlling the fitting process. See &quot;rmsControl&quot; for details</p>
</td></tr> 
<tr><td><code id="rmscb_+3A_...">...</code></td>
<td>
<p>additional arguments to be passed to the low level regression fitting functions (see below).</p>
</td></tr>  
</table>


<h3>Details</h3>

<p>'biomarker' is a Biomarker variable. This variable is required and shall be the first dependent variable in the formula.
</p>
<p>'rmscb.default' is the workhorse functions: they are not normally called directly but can be more efficient
where the response vector, design matrix and family have already been calculated.
</p>


<h3>Value</h3>

<p>rmscb returns an object of class inheriting from &quot;rmscb&quot;. See later in this section.  
</p>
<p>The function &quot;summary&quot; (i.e., &quot;summary.rmscb&quot;) can be used to obtain or print a summary of the results, 
for example, the 95 percent CI of the parameters.
</p>
<p>An object of class &quot;rmscb&quot; is a list containing at least the following components:
</p>
<table>
<tr><td><code>w0</code></td>
<td>
<p>w0 from the input.</p>
</td></tr>
<tr><td><code>rms</code></td>
<td>
<p>a named vector of restriected mean survival time from the &quot;rmscb&quot;.</p>
</td></tr>
<tr><td><code>LB</code></td>
<td>
<p>lower bound of the simultaneuous confidence band.</p>
</td></tr>
<tr><td><code>UB</code></td>
<td>
<p>upper bound of the simultaneuous confidence band.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Wen Teng, Wenyu Jiang and Bingshu E. Chen (bingshu.chen@queensu.ca)
</p>


<h3>References</h3>

<p>Teng, W., Jiang, W. and Chen, B. E. (2022). Continuous threshold models with two-way interactions in survival analysis. 
Statistics in Medicine, 
submitted.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##
## Generate a random data set
n = 100
age = runif(n, 0, 1)*100
tm = rexp(n, 1/10)
status = rbinom(n, 1, 0.5)
trt= rbinom(n, 1, 0.5)

## fit a restricted mean survival time with one biomarker 

   fit = rmscb(Surv(tm, status)~age)
   print(fit)
## plot(fit)
## summary(fit) 
</code></pre>

<hr>
<h2 id='rpicexp'>
The Piecewise Exponential Distribution
</h2><span id='topic+dpicexp'></span><span id='topic+ppicexp'></span><span id='topic+qpicexp'></span><span id='topic+rpicexp'></span><span id='topic+hpicexp'></span><span id='topic+Hpicexp'></span><span id='topic+picfit'></span><span id='topic+picreg'></span><span id='topic+summary.picreg'></span>

<h3>Description</h3>

<p>Density, distribution function, quantile function, hazard function h(t), 
cumulative hazard function H(t), and random 
generation for the piecewise exponential distribution with rate equal to 'rate'
and cut points equal to 'cuts'.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dpicexp(x, rate=1, cuts=c(0, 10), log = FALSE)
ppicexp(q, rate=1, cuts=c(0, 10), lower.tail = TRUE, index = NULL)
qpicexp(p, rate=1, cuts=c(0, 10), lower.tail = TRUE)
rpicexp(n, rate=1, cuts=c(0, 10))

hpicexp(x, rate, cuts, index=NULL)
Hpicexp(x, rate, cuts, index=NULL)
#
## to fit a piece exponential survival model use:
#
# picfit(y, cuts=c(0, 10))
#
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rpicexp_+3A_x">x</code>, <code id="rpicexp_+3A_q">q</code></td>
<td>
<p>vector of quantiles.</p>
</td></tr>
<tr><td><code id="rpicexp_+3A_p">p</code></td>
<td>
<p>vector of probabilities.</p>
</td></tr>
<tr><td><code id="rpicexp_+3A_n">n</code></td>
<td>
<p>number of observations. If 'length(n) &gt; 1', the length is
taken to be the number required.</p>
</td></tr>
<tr><td><code id="rpicexp_+3A_rate">rate</code></td>
<td>
<p>vector rate parameter, defaulting to 1.</p>
</td></tr>
<tr><td><code id="rpicexp_+3A_cuts">cuts</code></td>
<td>
<p>cut points, defaulting 0 to 10.</p>
</td></tr>
<tr><td><code id="rpicexp_+3A_log">log</code></td>
<td>
<p>logical; if TRUE, probability p are given as log(p).</p>
</td></tr>
<tr><td><code id="rpicexp_+3A_lower.tail">lower.tail</code></td>
<td>
<p>logical; if TRUE(default), probabilities are P[X &lt;= x],
otherwise, P[X&gt;x].</p>
</td></tr>
<tr><td><code id="rpicexp_+3A_index">index</code></td>
<td>
<p>index of x, q in the interval defined by cuts, it saves time if index is known.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If the rate is not specified, it assumes the default value of 1.
</p>


<h3>Value</h3>

<p>dpicexp gives the density, ppicexp gives the distribution function, 
qpicexp gives the quantile function, and 
rpicexp generates random deviates. 
</p>
<p>The length of the result is determined by n for rpicexp.
</p>
<p>Only the first elements of the logical arguments are used.
</p>


<h3>Note</h3>

<p>The cumulative hazard H(t) = -log(1-F(t)) is log(1-ppicexp(t, rate, cuts)), 
or more efficiently call function Hpicexp(t, rate, cuts).
</p>


<h3>Author(s)</h3>

<p>Bingshu E. Chen (bingshu.chen@queensu.ca)
</p>


<h3>References</h3>

<p>Chen, B. E., Cook, R. J., Lawless, J. F. and Zhan, M. (2005). 
Statistical methods for multivariate interval-censored recurrent events. 
Statistics in Medicine. Vol 24, 671-691.
</p>


<h3>See Also</h3>

<p><code><a href="base.html#topic+exp">exp</a></code> for the exponential function.
</p>
<p><code><a href="stats.html#topic+Distributions">Distributions</a></code> for other standard distributions, including 
<code><a href="stats.html#topic+dgamma">dgamma</a></code> for the gamma distribution and 
<code><a href="stats.html#topic+dweibull">dweibull</a></code> for the Weibull distribution.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##
### No run
# n = 100
# rate = c(1, 1, 0.5, 0.125) 
# cuts = c(0, 1, 2.5, 5, 10)
# x = rpicexp(n, rate, cuts)
#
### compare rexp and rpicexp
#
#print(ppicexp(2.5, rate = .5))
#print(pexp(2.5, rate = 0.5))
#
#
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
