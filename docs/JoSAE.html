<!DOCTYPE html><html><head><title>Help for package JoSAE</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {JoSAE}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#JoSAE-package'>
<p>Provides functions for some small area estimators and their</p>
mean squared errors.</a></li>
<li><a href='#eblup.mse.f.wrap'>

<p>Functions to calculate the variance of an EBLUP estimate.</p></a></li>
<li><a href='#JoSAE.domain.data'>

<p>Dataframe containing the domains population and number of elements and</p>
mean of the auxiliary variable</a></li>
<li><a href='#JoSAE.sample.data'>
<p>Sample plots of the Norwegian National Forest Inventory (NNFI) with</p>
a variable of interest and an auxiliary variable</a></li>
<li><a href='#landsat'><p> LANDSAT data:</p>
Prediction of County Crop Areas Using Survey and Satellite Data</a></li>
<li><a href='#nfi'>
<p>Sample plots of the Norwegian National Forest Inventory (NFI) with</p>
a variable  of interest and an auxiliary variable</a></li>
<li><a href='#sae.al.f'>
<p>Area-level small area estimation under heteroscedasticity or homoscedasticity.</p></a></li>
<li><a href='#sae.ul.f'>
<p>Unit-level small area estimation under heteroscedasticity.</p></a></li>
<li><a href='#ulal.sub.dom.dat'>

<p>Domain-level data.</p></a></li>
<li><a href='#ulal.sub.samp.dat'>

<p>Unit-level sample data.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Unit-Level and Area-Level Small Area Estimation</td>
</tr>
<tr>
<td>Version:</td>
<td>0.3.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2018-05-31</td>
</tr>
<tr>
<td>Author:</td>
<td>Johannes Breidenbach</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Johannes Breidenbach &lt;job@nibio.no&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Implementation of some unit and area level EBLUP estimators as well as the estimators of their MSE also under heteroscedasticity. The package further documents the publications Breidenbach and Astrup (2012) &lt;<a href="https://doi.org/10.1007%2Fs10342-012-0596-7">doi:10.1007/s10342-012-0596-7</a>&gt;, Breidenbach et al. (2016) &lt;<a href="https://doi.org/10.1016%2Fj.rse.2015.07.026">doi:10.1016/j.rse.2015.07.026</a>&gt; and Breidenbach et al. (2018 in press). The vignette further explains the use of the implemented functions.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>Depends:</td>
<td>nlme</td>
</tr>
<tr>
<td>Suggests:</td>
<td>lattice,xtable</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2018-05-06 08:50:27 UTC; JoBr</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2018-05-06 09:05:03 UTC</td>
</tr>
</table>
<hr>
<h2 id='JoSAE-package'>
Provides functions for some small area estimators and their
mean squared errors.
</h2><span id='topic+JoSAE-package'></span><span id='topic+JoSAE'></span>

<h3>Description</h3>

<p> This package implements unit-level (Battese et al. 1988)
and area-level EBLUP (Fay and Herriot 1979), and GREG (Sarndal 1984)
estimators as well as their variance/MSE estimators. It also contains
data and a vignette that explain its use. Heteroscedasticity can
be considered. </p>


<h3>Details</h3>

<p>The aim in the analysis of sample surveys is frequently to derive
estimates of subpopulation characteristics. Often, the sample available
for the subpopulation is, however, too small to allow a reliable
estimate. If an auxiliary variable exists that is correlated with the
variable of interest, small area estimation (SAE) provides methods to
solve the problem (Rao 2003, Rao and Molina 2015). 
</p>
<p>The purpose of this package is primarily to document the functions used
in the publications Breidenbach and Astrup (2012) and Breidenbach et
al. (2018). The data used in Breidenbach and Astrup (2012) are provided.
A subset of the data used in Breidenbach et al. (2018) is also provided
for testing the functions. The vignette further documents the
publication Breidenbach et al. (2015).
</p>
<p>You might wonder why this package is called JoSAE. Well, first of all,
JoSAE sounds good (if pronounced like the female name). The other reason
was that the packages SAE and SAE2 already exist (Gomez-Rubio,
2008). They are, however, not available on CRAN and unmaintained (as of
July 2011). They also do not seem to implement the variance estimators
that we needed. So I just combined SAE with the first part of my name.
</p>


<h3>Note</h3>

<p>All the implemented functions/estimators are described in Rao (2003). This
package merely makes the use of the estimators easier for the users
that are not keen on programming. Especially the EBLUP variance
estimator would require some effort.
</p>
<p>Today, there are several well programmed SAE packages available on
CRAN that also provide the functions described here. This was not the
case when the first version of the package was uploaded. This package
is therefore mostly to document the publications mentioned above. With
respect to heteroskedasticity, this package also implements functions
that, as far as I can see, are not available in other packages (as of
May 2018).
</p>


<h3>Author(s)</h3>

<p>Johannes Breidenbach
</p>
<p>Maintainer: Johannes Breidenbach &lt;job@nibio.no&gt;
</p>


<h3>References</h3>

<p>Battese, G. E., Harter, R. M. &amp; Fuller, W. A. (1988), An error-components model
for prediction of county crop areas using survey and satellite data
Journal of the American Statistical Association, 83, 28-36 
</p>
<p>Breidenbach, J. and Astrup, R. (2012), Small area estimation of
forest attributes in the Norwegian National Forest Inventory. European
Journal of Forest Research, 131:1255-1267.
</p>
<p>Breidenbach, J., Ronald E. McRoberts, Astrup, R. (2016), Empirical
coverage of model-based variance estimators for 
remote sensing assisted estimation of stand-level timber volume. Remote
Sensing of Environment, 173,
274-281. https://doi.org/10.1016/j.rse.2015.07.026
</p>
<p>Breidenbach, J., Rahlf, J., Magnussen, S., Astrup, R. (2018)
Unit-level and area-level small area estimation under
heteroscedasticity using digital aerial photogrammetry data. Remote
Sensing of Environment. In press.
</p>
<p>Fay, R. E., Herriot, R. A., 1979. Estimates of income for small places: an
application of James- Stein procedures to census data. Journal of the
American Statistical Association 74 (366a), 269-277.
</p>
<p>Gomez-Rubio (2008), Tutorial on small area estimation, UseR
conference 2008, August 12-14, Technische Universitat Dortmund,
Germany.
</p>
<p>Rao, J.N.K. (2003), Small area estimation. Wiley.
</p>
<p>Rao, J. N., Molina, I., (2015). Small area estimation, 2nd Edition. John Wiley &amp; Sons. 
</p>
<p>Sarndal, C. (1984), Design-consistent versus model-dependent estimation for
small domains Journal of the American Statistical Association, JSTOR,
624-631 
</p>
<p>Schoch, T. (2011), rsae: Robust Small Area Estimation. R package
version 0.1-3. 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+eblup.mse.f.wrap">eblup.mse.f.wrap</a></code>,
<code><a href="#topic+JoSAE.sample.data">JoSAE.sample.data</a></code>, <code><a href="#topic+JoSAE.domain.data">JoSAE.domain.data</a></code>, 
<code><a href="#topic+sae.al.f">sae.al.f</a></code>, <code><a href="#topic+sae.ul.f">sae.ul.f</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>	#mean auxiliary variables for the populations in the domains
data(JoSAE.domain.data)
	#data for the sampled elements
data(JoSAE.sample.data)
plot(biomass.ha~mean.canopy.ht,JoSAE.sample.data)

## use the original wrapper function

    #lme model
summary(fit.lme &lt;- lme(biomass.ha ~ mean.canopy.ht, data=JoSAE.sample.data
                       , random=~1|domain.ID))

    #domain data need to have the same column names as sample data or vice versa
d.data &lt;- JoSAE.domain.data
names(d.data)[3] &lt;- "mean.canopy.ht"

result &lt;- eblup.mse.f.wrap(domain.data = d.data, lme.obj = fit.lme)
result

##END: use the original wrapper function


## the same with a newer function that can consider heteroskedasticity
res &lt;-
    sae.ul.f(samp.data=JoSAE.sample.data,
             population.data=d.data,
				#assuming homoskedasticity
             k.ij=rep(1, nrow(JoSAE.sample.data)),
             formula=biomass.ha ~ mean.canopy.ht,
             domain.col="domain.ID",
             sample.id.col="sample.ID",
             neg.sfrac=TRUE)
res$est$est

##END: the same with a newer function that can consider heteroskedasticity

</code></pre>

<hr>
<h2 id='eblup.mse.f.wrap'>

Functions to calculate the variance of an EBLUP estimate.
</h2><span id='topic+eblup.mse.f.wrap'></span><span id='topic+eblup.mse.f.gamma.i'></span><span id='topic+eblup.mse.f.c1'></span><span id='topic+eblup.mse.f.c2.ai'></span><span id='topic+eblup.mse.f.c2'></span><span id='topic+eblup.mse.f.c3.asyvarcovarmat'></span><span id='topic+eblup.mse.f.c3'></span><span id='topic+eblup.mse.f.c3.star'></span>

<h3>Description</h3>


<p>Functions to calculate the EBLUP MSE (=variance). The wrap function
calls all the other functions and calculates EBLUP, GREG, SRS, and Synthetic
estimates for domain means as well as the variances of the EBLUP, GREG
and SRS estimates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>eblup.mse.f.wrap(domain.data, lme.obj, debug=F, ...)
eblup.mse.f.gamma.i(lme.obj, n.i, ...)
eblup.mse.f.c1(lme.obj, n.i, gamma.i, ...)
eblup.mse.f.c2.ai(lme.obj, n.i, gamma.i, X.i, ...)
eblup.mse.f.c2(gamma.i, X.i, X.bar.i, sum.A.i, ...)
eblup.mse.f.c3.asyvarcovarmat(lme.obj, n.i, ...)
eblup.mse.f.c3(lme.obj, asympt.var.covar, n.i, ...)
eblup.mse.f.c3.star(lme.obj, asympt.var.covar, n.i, mean.resid.i, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="eblup.mse.f.wrap_+3A_domain.data">domain.data</code></td>
<td>

<p>data set with the mean of the auxiliary variables for every
domain including the domain ID. Names of the variables must be the same as in the
unit-level sample data that were used to fit the lme model.
</p>
</td></tr>  
<tr><td><code id="eblup.mse.f.wrap_+3A_lme.obj">lme.obj</code></td>
<td>


<p>a linear mixed-effects model generated with <code><a href="nlme.html#topic+lme">lme</a></code>	
</p>
</td></tr>
<tr><td><code id="eblup.mse.f.wrap_+3A_n.i">n.i</code></td>
<td>


<p>the number of samples within domain i	
</p>
</td></tr>
<tr><td><code id="eblup.mse.f.wrap_+3A_gamma.i">gamma.i</code></td>
<td>


<p>the gamma_i value resulting from the gamma.i method of this function
</p>
</td></tr>
<tr><td><code id="eblup.mse.f.wrap_+3A_x.i">X.i</code></td>
<td>

<p>the design matrix of sampled elements in domain i
</p>
</td></tr>
<tr><td><code id="eblup.mse.f.wrap_+3A_x.bar.i">X.bar.i</code></td>
<td>

<p>mean of the populations elements design matrix in domain i
</p>
</td></tr>
<tr><td><code id="eblup.mse.f.wrap_+3A_sum.a.i">sum.A.i</code></td>
<td>

<p>sum of the domains A_i matrices resulting from <code><a href="#topic+eblup.mse.f.c2.ai">eblup.mse.f.c2.ai</a></code>
</p>
</td></tr>
<tr><td><code id="eblup.mse.f.wrap_+3A_asympt.var.covar">asympt.var.covar</code></td>
<td>

<p>the asymptotic variance-covariance matrix of the mixed-effects model
resulting from <code><a href="#topic+eblup.mse.f.c3.asyvarcovarmat">eblup.mse.f.c3.asyvarcovarmat</a></code>
</p>
</td></tr>
<tr><td><code id="eblup.mse.f.wrap_+3A_mean.resid.i">mean.resid.i</code></td>
<td>

<p>the mean residual of the fixed-part of the linear mixed-effects
model in domain i (i.e., use <code>level=0</code> in <code><a href="nlme.html#topic+predict.lme">predict.lme</a></code>)
</p>
</td></tr>  
<tr><td><code id="eblup.mse.f.wrap_+3A_...">...</code></td>
<td>


<p>forward attributes to other functions. Not used so far.
</p>
</td></tr>
<tr><td><code id="eblup.mse.f.wrap_+3A_debug">debug</code></td>
<td>

<p>details are printed if true - Only used by the wrapper function
</p>
</td></tr>  
</table>


<h3>Details</h3>


<p>Most users will probably only use the convenient wrap
function. Nonetheless, all components of the EBLUP variance can also
be calculated separately.
</p>


<h3>Value</h3>

<p>A compontent of the EBLUP variance (aka mean squared error). Which
component depends on the function used.
</p>
<p>The wrap function returns a data
frame with many entrys for every domain: The domain-level predictor
variables obtained from the domain.data, the mean of the predictor
variables and response (aka the sample mean or SRS estimate) observed at the samples, the number of samples (n.i.sample),
the mean residuals of a lm (fitted using the fixed part of the lme) and
the lme (mean.resid.lm, mean.resid.lme), 
the synthetic (Synth), EBLUP, and GREG estimates of the mean of the
variable of interest, the gamma_i value,
the variance of the means for the sample and GREG estimates (.var.mean), the
components of the EBLUP variance (c1-c3star), the results of the first and the second
method (cf. Rao 2003) to derive the EBLUP variance
(EBLUP.var.1, EBLUP.var.2), and the standard errors derived from the
variances (.se).
</p>


<h3>Note</h3>


<p>Currently, only random intercept mixed-effects models with homogeneous
variance structure are supported.
</p>


<h3>Author(s)</h3>

<p>Johannes Breidenbach
</p>


<h3>References</h3>


<p>Breidenbach and Astrup (2012), Small area estimation of
forest attributes in the Norwegian National Forest Inventory. European
Journal of Forest Research, 131:1255-1267.
</p>


<h3>See Also</h3>


<p><code><a href="#topic+JoSAE-package">JoSAE-package</a></code> for more examples
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(nlme)
data(JoSAE.sample.data)
#fit a lme 
summary(fit.lme &lt;- lme(biomass.ha ~ mean.canopy.ht, data=JoSAE.sample.data
                       , random=~1|domain.ID))
#calculate the first component of the EBLUP variance for a domain with 5 samples
eblup.mse.f.c1(fit.lme, 5, 0.2)
</code></pre>

<hr>
<h2 id='JoSAE.domain.data'>

Dataframe containing the domains population and number of elements and
mean of the auxiliary variable
</h2><span id='topic+JoSAE.domain.data'></span>

<h3>Description</h3>


<p>Auxiliary variable: Mean canopy height derived from a photogrammetric
canopy height model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(JoSAE.domain.data)</code></pre>


<h3>Format</h3>

<p>A data frame with 14 observations on the following 3 variables.
</p>

<dl>
<dt><code>domain.ID</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>N.i</code></dt><dd><p>a numeric vector - number of population elements</p>
</dd>
<dt><code>mean.canopy.ht.bar</code></dt><dd><p>a numeric vector - mean of the
auxiliary variable</p>
</dd>
</dl>



<h3>Source</h3>

<p>Breidenbach, J. and Astrup, R. (2012), Small area estimation of
forest attributes in the Norwegian National Forest Inventory. European
Journal of Forest Research, 131:1255-1267.
</p>


<h3>See Also</h3>


<p><code><a href="#topic+JoSAE-package">JoSAE-package</a></code> for more examples
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(JoSAE.domain.data)

str(JoSAE.domain.data)
</code></pre>

<hr>
<h2 id='JoSAE.sample.data'>
Sample plots of the Norwegian National Forest Inventory (NNFI) with
a variable of interest and an auxiliary variable
</h2><span id='topic+JoSAE.sample.data'></span>

<h3>Description</h3>


<p>Above ground forest biomass over all tree species is the variable of
interest. Mean canopy height derived from a photogrammetric canopy
height model of 20~cm geometric and 10~cm radiometric
resolution is the auxiliary variable.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(JoSAE.sample.data)</code></pre>


<h3>Format</h3>

<p>A data frame with 145 observations on the following 4 variables.
</p>

<dl>
<dt><code>sample.ID</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>domain.ID</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>biomass.ha</code></dt><dd><p>a numeric vector of the variable of interest</p>
</dd>
<dt><code>mean.canopy.ht</code></dt><dd><p>a numeric vector of the auxiliary variable</p>
</dd>
</dl>



<h3>Source</h3>



<p>Breidenbach, J. and Astrup, R. (2012), Small area estimation of
forest attributes in the Norwegian National Forest Inventory. European
Journal of Forest Research, 131:1255-1267.  
</p>


<h3>See Also</h3>


<p><code><a href="#topic+JoSAE-package">JoSAE-package</a></code> for more examples
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(JoSAE.sample.data)
## maybe str(JoSAE.sample.data) ; plot(JoSAE.sample.data) ...
plot(biomass.ha~mean.canopy.ht,JoSAE.sample.data)
</code></pre>

<hr>
<h2 id='landsat'> LANDSAT data:
Prediction of County Crop Areas Using Survey and Satellite Data </h2><span id='topic+landsat'></span>

<h3>Description</h3>

<p> The <code>landsat</code> data.frame is a compilation (by Battese
et al., 1988) of survey and satellite data. It consists of data on
segments (primary sampling unit; 1 segement =approx= 250 hectares) under
corn and soybeans for 12 counties in north-central Iowa; see Details,
below.
</p>
<p>The landsat data.frame was made available by Tobias Schoch with the R
package rsae. Since rsae was archived as of R 3.0.2, the data and this
description was copied from rsae 0.1-4 in the archives.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(landsat)</code></pre>


<h3>Format</h3>

<p>A data frame with 37 observations on the following 10 variables.
</p>

<dl>
<dt><code>SegmentsInCounty</code></dt><dd>
<p>a numeric vector; no. of segments per county
</p>
</dd>
<dt><code>SegementID</code></dt><dd>
<p>a numeric vector; sample segment identifier (per county)
</p>
</dd>
<dt><code>HACorn</code></dt><dd>
<p>a numeric vector; hectares of corn for each sample segment (as reported in the June 1978 Enumerative Survey)
</p>
</dd>
<dt><code>HASoybeans</code></dt><dd><p>a numeric vector; hectares of soybeans for each sample segment (as reported in the June 1978 Enumerative Survey)
</p>
</dd>
<dt><code>PixelsCorn</code></dt><dd>
<p>a numeric vector; no. of pixels classified as corn for each sample segment (LANDSAT readings)
</p>
</dd>
<dt><code>PixelsSoybeans</code></dt><dd>
<p>a numeric vector; no. of pixels classified as soybeans for each sample segment (LANDSAT readings)
</p>
</dd>
<dt><code>MeanPixelsCorn</code></dt><dd>
<p>a numeric vector; county mean number of pixels classified as corn
</p>
</dd>
<dt><code>MeanPixelsSoybeans</code></dt><dd>
<p>a numeric vector; county mean number of pixels classified as soybeans
</p>
</dd>
<dt><code>outlier</code></dt><dd>
<p>a logical vector; flags observation no. 33 as outlier
</p>
</dd>
<dt><code>CountyName</code></dt><dd>
<p>a factor with levels (i.e., county names) <code>Cerro Gordo</code> <code>Hamilton</code> <code>Worth</code> <code>Humboldt</code> <code>Franklin</code> <code>Pocahontas</code> <code>Winnebago</code> <code>Wright</code> <code>Webster</code> <code>Hancock</code> <code>Kossuth</code> <code>Hardin</code>
</p>
</dd>
</dl>



<h3>Details</h3>

<p>The <code>landsat</code> data is a compilation (by Battese et al., 1988) of the LANDSAT satellite data from the U.S. Department of Agriculture (USDA) and the 1978 June Enumerative Survey. 
</p>


<h4>Survey data</h4>

<p>The survey data on the areas under corn and soybeans (reported in hectares) in the 37 segments of the 12 counties (north-central Iowa) have been determined by USDA Statistical Reporting Service staff, who interviewed farm operators. A segment is about 250 hectares.
</p>



<h4>Satellite data</h4>

<p>For the LANDSAT satellite data, information is recorded as &quot;pixels&quot;. The USDA has been engaged in research toward transforming satellite information into good estimates of crop areas at the individual pixel and segments level. A pixel is about 0.45 hectares. The satellite (LANDSAT) readings were obtained during August and September 1978.
</p>

<p>Data for more than one sample segment are available for several counties (i.e, unbalanced data). 
</p>
<p>Observations No. 33 has been flaged as outlier (cf., Battese et al. (1988, p. 28).
</p>


<h3>Source</h3>

<p>The data <code>landsat</code> is from Table 1 of Battese et al. (1988,
p. 29).
</p>
<p>Schoch (2011) rsae: Robust Small Area Estimation, R package version 0.1-4: http://cran.r-project.org/src/contrib/Archive/rsae/rsae_0.1-4.tar.gz
</p>


<h3>References</h3>

<p>Battese, G.E, R.M. Harter, and W.A. Fuller (1988): An Error-Components Model for Prediction of County Crop Areas Using Survey and Satellite Data, <em>Journal of the American Statistical Association</em> 83, pp. 28&ndash;36.  
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(landsat)
</code></pre>

<hr>
<h2 id='nfi'>
Sample plots of the Norwegian National Forest Inventory (NFI) with
a variable  of interest and an auxiliary variable  
</h2><span id='topic+nfi'></span>

<h3>Description</h3>


<p>A total of 131 sample plots of the Norwegian National Forest Inventory (NFI) with
timber volume interpolated and extrapolated to the year 2011 as the variable
of interest and mean vegetation height derived from image matching  as
the auxiliary variable. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(nfi)</code></pre>


<h3>Format</h3>

<p>A data frame with 131 observations on the following 2 variables.
</p>

<dl>
<dt><code>vol.2011</code></dt><dd><p>numeric vector of the variable of interest</p>
</dd>
<dt><code>Elev.Mean</code></dt><dd><p>numeric vector of the auxiliary variable</p>
</dd>
</dl>



<h3>Source</h3>



<p>Breidenbach, J., Ronald E. McRoberts, Astrup, R. (2015), Empirical
coverage of model-based variance estimators for 
remote sensing assisted estimation of stand-level timber volume. Remote
Sensing of Environment. In press. 
</p>


<h3>See Also</h3>


<p><code><a href="#topic+JoSAE-package">JoSAE-package</a></code> and Vignette for more examples
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(nfi)
plot(vol.2011~Elev.Mean, nfi)
</code></pre>

<hr>
<h2 id='sae.al.f'>
Area-level small area estimation under heteroscedasticity or homoscedasticity.
</h2><span id='topic+sae.al.f'></span>

<h3>Description</h3>

<p>Area-level small area estimation, possibly under
heteroscedasticity. Assumes SRS within domains. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sae.al.f(domain.id, n.i, psi.i, formula, data, b.i, type = "RE", verbose
= F, iter = 100, a.conv = 0.001,...) 
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sae.al.f_+3A_domain.id">domain.id</code></td>
<td>

<p>Vector of unique domain IDs corresponding to data.
</p>
</td></tr>
<tr><td><code id="sae.al.f_+3A_n.i">n.i</code></td>
<td>

<p>Vector of number of samples within each domain i, corresponding to data.
</p>
</td></tr>
<tr><td><code id="sae.al.f_+3A_psi.i">psi.i</code></td>
<td>

<p>Vector of variances of the direct estimator within each domain i, corresponding to data.
</p>
</td></tr>
<tr><td><code id="sae.al.f_+3A_formula">formula</code></td>
<td>

<p>Formula for fixed effects.
</p>
</td></tr>
<tr><td><code id="sae.al.f_+3A_data">data</code></td>
<td>

<p>Domain-level data.
</p>
</td></tr>
<tr><td><code id="sae.al.f_+3A_b.i">b.i</code></td>
<td>

<p>Parameter for modeling heteroscedasticity.
</p>
</td></tr>
<tr><td><code id="sae.al.f_+3A_type">type</code></td>
<td>

<p>Method for estimating variance parameters. Currently, only option is
&quot;RE&quot; for REML.
</p>
</td></tr>
<tr><td><code id="sae.al.f_+3A_verbose">verbose</code></td>
<td>

<p>Boolean. Should more info be printed?
</p>
</td></tr>
<tr><td><code id="sae.al.f_+3A_iter">iter</code></td>
<td>

<p>Max number of iterations. Default is 100.
</p>
</td></tr>
<tr><td><code id="sae.al.f_+3A_a.conv">a.conv</code></td>
<td>

<p>Threshold for accepting convergency. Default is 0.001
</p>
</td></tr>
<tr><td><code id="sae.al.f_+3A_...">...</code></td>
<td>

<p>Parameters forwarded to other functions.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>SRS (simple random sampling) is assumed within each domain. If the
direct estimator is not based on SRS, RV components of the results do
not make sense.
</p>


<h3>Value</h3>

<table>
<tr><td><code>results</code></td>
<td>
<p>Area-level estimates and associated standard errors
(SE). <code>FH</code> Fay-Harriot estimate (the standard area-level
estimator), <code>RV</code> Rivest-Vandal estimate, considering uncertainty
in variance parameters. <code>bias.sig.sq.v</code> Bias in random effect
variance. <code>synth</code> Synthetic estimate. <code>trans.resid.v.i</code>
Transformed residuals. The other parameters are details and are named
as in the reference.</p>
</td></tr>
<tr><td><code>beta.hat</code></td>
<td>
<p>Estimated fixed-effects parameters.</p>
</td></tr>
<tr><td><code>des.mat</code></td>
<td>
<p>Design matrix.</p>
</td></tr>
</table>
<p>Other list elements have descriptive names.
</p>


<h3>Author(s)</h3>

<p>Johannes Breidenbach
</p>


<h3>References</h3>

<p>Breidenbach et al. (2018) Unit-level and area-level small area
estimation under heteroscedasticity using digital aerial photogrammetry
data. Remote Sensing of Environment.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(nlme)
#sample data
data(ulal.sub.samp.dat)
#domain means of x
data(ulal.sub.dom.dat)

#The easiest way of getting the data into the right format
#is to fit a unit-level model first.
res &lt;-
    sae.ul.f(samp.data=ulal.sub.samp.dat,
             population.data=ulal.sub.dom.dat,
             k.ij=ulal.sub.samp.dat[,"k.ij.one"],
             formula=w.VMPRHA ~ elev.mean + elev.mean.sq,
             domain.col="stand.ID",
             sample.id.col="plot.ID",
             neg.sfrac=TRUE)

#data for AL
dat.al &lt;- merge(res$data$samp.agg.X.pop[,c("domain.id","n.i","w.VMPRHA.ybar.i","elev.mean.X.pop")],
                res$est$se[,c("domain.id","se.srs")])

#area-level SAE under homoscedasticity
res &lt;- sae.al.f(
    domain.id=dat.al$domain.id , n.i=dat.al$n.i , psi.i=dat.al$se.srs^2
    , formula=w.VMPRHA.ybar.i ~ elev.mean.X.pop , data=dat.al
    , b.i=rep(1, nrow(dat.al))
    , type="RE")

#area-level SAE heteroskedasticity
bi.par &lt;- 0.39#select b.i parameter
#helper function
range01 &lt;- function(x, ...){(x - min(x, ...)) /
                                (max(x, ...) - min(x, ...))}
res &lt;- sae.al.f(
    domain.id=dat.al$domain.id , n.i=dat.al$n.i , psi.i=dat.al$se.srs^2
    , formula=w.VMPRHA.ybar.i ~ elev.mean.X.pop, data=dat.al
    , b.i=range01(dat.al$elev.mean.X.pop)+bi.par
    , type="RE")

</code></pre>

<hr>
<h2 id='sae.ul.f'>
Unit-level small area estimation under heteroscedasticity.
</h2><span id='topic+sae.ul.f'></span><span id='topic+ul.data.prep.f'></span><span id='topic+ul.reml.f'></span><span id='topic+ul.est.f'></span>

<h3>Description</h3>

<p>The only function that should be used is <code>sae.ul.f</code> which wraps
the data preparation (<code>ul.data.prep.f</code>), parameter estimation
(<code>ul.reml.f</code>), and EBLUP and MSE 
estimation (<code>ul.est.f</code>) functions. The other functions
are helpers that do not need to be called by the user directly.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sae.ul.f(...)
ul.data.prep.f(k.ij, samp.data, population.data, formula, domain.col,
sample.id.col, neg.sfrac, pop.r, sum.i.k.ij.sq.r, N.i, ...)
ul.reml.f(samp.data, formula, samp.agg.X.pop, y.name, X.names, ...)
ul.est.f(samp.data, samp.agg.X.pop, X.names, y.name, beta.hat,
cov.beta.hat, sig.sq.e, sig.sq.v, V.bar.ee, V.bar.vv, V.bar.ve,
neg.sfrac, resid = F, ...) 
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sae.ul.f_+3A_samp.data">samp.data</code></td>
<td>

<p>Data frame of unit-level sample data of the response and explanatory
variables. Transformations of x have to be calculated before hand,
not using formula.
</p>
</td></tr>
<tr><td><code id="sae.ul.f_+3A_k.ij">k.ij</code></td>
<td>

<p>Vector of the same length and corresponding to <code>samp.data</code>
containing 
the <code>k_ij</code> values for modeling heteroscedasticity. A vector of
1's if heteroscedasticity is not 
considered. <code>k_ij</code> is squared and used as the input to the
<code>varFix</code> variance function in <code>lme</code>. 
</p>
</td></tr>
<tr><td><code id="sae.ul.f_+3A_population.data">population.data</code></td>
<td>

<p>Data frame of domain-level means of the explanatory variables. Names
have to match to sample data.
</p>
</td></tr>
<tr><td><code id="sae.ul.f_+3A_formula">formula</code></td>
<td>

<p>The fixed effects formula to be used in the mixed model using <code>lme</code>.
</p>
</td></tr>
<tr><td><code id="sae.ul.f_+3A_domain.col">domain.col</code></td>
<td>

<p>Character string identifying the column name in <code>sample.data</code>
and <code>population.data</code>
containing unique domain IDs.
</p>
</td></tr>
<tr><td><code id="sae.ul.f_+3A_sample.id.col">sample.id.col</code></td>
<td>

<p>Character string identifying the column name in <code>sample.data</code>
containing unique sample IDs.
</p>
</td></tr>
<tr><td><code id="sae.ul.f_+3A_neg.sfrac">neg.sfrac</code></td>
<td>

<p>Boolean. Are sampling fractions negligible?
</p>
</td></tr>
<tr><td><code id="sae.ul.f_+3A_pop.r">pop.r</code></td>
<td>

<p>Only required if <code>neg.sfrac</code> is FALSE. Same as
<code>population.data</code> but calculated with the sample elements
removed. 
</p>
</td></tr>
<tr><td><code id="sae.ul.f_+3A_sum.i.k.ij.sq.r">sum.i.k.ij.sq.r</code></td>
<td>

<p>Only required if <code>neg.sfrac</code> is FALSE. Same as the values in the
<code>population.k.column</code> but calculated with the sample elements
removed.
</p>
</td></tr>
<tr><td><code id="sae.ul.f_+3A_n.i">N.i</code></td>
<td>

<p>Only required if <code>neg.sfrac</code> is FALSE. Number of elements
within domain i.
</p>
</td></tr>
<tr><td><code id="sae.ul.f_+3A_samp.agg.x.pop">samp.agg.X.pop</code></td>
<td>

<p>Data frame containing the aggregated sample data and domain-level
explanatory variables. 
</p>
</td></tr>
<tr><td><code id="sae.ul.f_+3A_y.name">y.name</code></td>
<td>

<p>Character string identifying the column name of the response.
</p>
</td></tr>
<tr><td><code id="sae.ul.f_+3A_x.names">X.names</code></td>
<td>

<p>Vector of character strings identifying the column names of the
explanatory variables.
</p>
</td></tr>
<tr><td><code id="sae.ul.f_+3A_beta.hat">beta.hat</code></td>
<td>

<p>Vector of estimated fixed effects.
</p>
</td></tr>
<tr><td><code id="sae.ul.f_+3A_cov.beta.hat">cov.beta.hat</code></td>
<td>

<p>Covariance matrix of fixed effects.
</p>
</td></tr>
<tr><td><code id="sae.ul.f_+3A_sig.sq.e">sig.sq.e</code></td>
<td>

<p>Residual variance.
</p>
</td></tr>
<tr><td><code id="sae.ul.f_+3A_sig.sq.v">sig.sq.v</code></td>
<td>

<p>Random effect variance.
</p>
</td></tr>
<tr><td><code id="sae.ul.f_+3A_v.bar.ee">V.bar.ee</code></td>
<td>

<p>Assymptotic variance of the residual variance.
</p>
</td></tr>
<tr><td><code id="sae.ul.f_+3A_v.bar.vv">V.bar.vv</code></td>
<td>

<p>Assymptotic variance of the random effect variance.
</p>
</td></tr>
<tr><td><code id="sae.ul.f_+3A_v.bar.ve">V.bar.ve</code></td>
<td>

<p>Assymptotic covariance of the residual and random effect variance.
</p>
</td></tr>
<tr><td><code id="sae.ul.f_+3A_resid">resid</code></td>
<td>

<p>Boolean. Should residuals be returned?
</p>
</td></tr>
<tr><td><code id="sae.ul.f_+3A_...">...</code></td>
<td>

<p>Parameters forwarded to other functions.
</p>
</td></tr>
</table>


<h3>Details</h3>


<p>These functions can also be used for eblups
without heteroskedasticity as the 
the older functions around <code>eblup.mse.f.wrap</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>est</code></td>
<td>
<p>List of point estimates and standard errors based on
different estimators. <code>est</code>: Point estimates of EBLUP, SRS, GREG,
Survey regression (svreg), and EBLUP synthetic estimators. Also
contains random effects. <code>se</code>: Standard errors. EBLUP global was used
in the reference publication. <code>resids</code>: Different forms of
raw and transformed residuals.</p>
</td></tr>
<tr><td><code>var.pars</code></td>
<td>
<p>List of estimated variance parameters. Among others
the lme object fitted to the data. See list of arguments above.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>List of data frames in the format required by the other
functions.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Johannes Breidenbach
</p>


<h3>References</h3>

<p>Breidenbach et al. (2018) Unit-level and area-level small area
estimation under heteroscedasticity using digital aerial photogrammetry
data. Remote Sensing of Environment.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(nlme)
#sample data
data(ulal.sub.samp.dat)
#domain means of x
data(ulal.sub.dom.dat)

#eblup under homoskedasticity
res &lt;-
    sae.ul.f(samp.data=ulal.sub.samp.dat,
             population.data=ulal.sub.dom.dat,
             k.ij=ulal.sub.samp.dat[,"k.ij.one"],
             formula=w.VMPRHA ~ elev.mean + elev.mean.sq,
             domain.col="stand.ID",
             sample.id.col="plot.ID",
             neg.sfrac=TRUE)

#eblup under heteroskedasticity
res &lt;-
    sae.ul.f(samp.data=ulal.sub.samp.dat,
             population.data=ulal.sub.dom.dat,
             k.ij=ulal.sub.samp.dat[,"k.ij.em.0.48"],
             formula=w.VMPRHA ~ elev.mean + elev.mean.sq,
             domain.col="stand.ID",
             sample.id.col="plot.ID",
             neg.sfrac=TRUE)
</code></pre>

<hr>
<h2 id='ulal.sub.dom.dat'>

Domain-level data.
</h2><span id='topic+ulal.sub.dom.dat'></span>

<h3>Description</h3>


<p>Domain-level means of the explanatory variables obtained from digital
aerial photogrammetry (i.e., means of all elements not just the means
of the samples). The domains are 15 forest stands in the
municipality of Stokke, Norway.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("ulal.sub.dom.dat")</code></pre>


<h3>Format</h3>

<p>A data frame with 15 observations on the following 5 variables.
</p>

<dl>
<dt><code>stand.ID</code></dt><dd><p>a factor with unique stand IDs.</p>
</dd> 
<dt><code>elev.mean</code></dt><dd><p>a numeric vector. Mean height
obtained from digital aerial photogrammetry.</p>
</dd>
<dt><code>elev.mean.sq</code></dt><dd><p>a numeric vector. Mean height squared
obtained from digital aerial photogrammetry.</p>
</dd>
<dt><code>k.i.one</code></dt><dd><p>a numeric vector of ones.</p>
</dd>
<dt><code>sum.i.k.ij.sq.em.0.48.r</code></dt><dd><p>a numeric vector. Domain-level
sums of the k_ij values of all elements that were not sampled. Needed
if fpc cannot be neglected in EBLUP estimation.</p>
</dd>
<dt><code>n.pixels</code></dt><dd><p>Number of elements with the domain i.</p>
</dd>
</dl>



<h3>Source</h3>

<p>Breidenbach et al. (2018) Unit-level and area-level small area
estimation under heteroscedasticity using digital aerial photogrammetry
data. Remote Sensing of Environment.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(ulal.sub.dom.dat)
</code></pre>

<hr>
<h2 id='ulal.sub.samp.dat'>

Unit-level sample data.
</h2><span id='topic+ulal.sub.samp.dat'></span>

<h3>Description</h3>


<p>73 sample plots clustered in 15 stands in the
municipality of Stokke, Norway.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("ulal.sub.samp.dat")</code></pre>


<h3>Format</h3>

<p>A data frame with 73 observations on the following 7 variables.
</p>

<dl>
<dt><code>plot.ID</code></dt><dd><p>a character vector with unique plot IDs.</p>
</dd>
<dt><code>w.VMPRHA</code></dt><dd><p>a numeric vector. Timber volume per hectare
(m3/ha).</p>
</dd>
<dt><code>stand.ID</code></dt><dd><p>a factor with unique stand IDs.</p>
</dd> 
<dt><code>elev.mean</code></dt><dd><p>a numeric vector. Mean height
obtained from digital aerial photogrammetry.</p>
</dd>
<dt><code>elev.mean.sq</code></dt><dd><p>a numeric vector. Mean height squared
obtained from digital aerial photogrammetry.</p>
</dd>
<dt><code>k.ij.one</code></dt><dd><p>a numeric vector of ones (used in cases where
heteroscedasticity can be ignored)</p>
</dd>
<dt><code>k.ij.em.0.48</code></dt><dd><p>a numeric vector. <code>elev.mean</code> to the
power of 0.48 for modeling heteroscedasticity.</p>
</dd>
</dl>



<h3>Source</h3>

<p>Breidenbach et al. (2018) Unit-level and area-level small area
estimation under heteroscedasticity using digital aerial photogrammetry
data. Remote Sensing of Environment.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(ulal.sub.samp.dat)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
