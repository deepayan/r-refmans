<!DOCTYPE html><html lang="en-US"><head><title>Help for package crunchy</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {crunchy}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#crunchPage'><p>Build a Crunchy UI</p></a></li>
<li><a href='#crunchyBody'><p>A Shiny UI with Crunch auth</p></a></li>
<li><a href='#crunchyPublicBody'><p>Alternate UIs for unauthenticated and unauthorized users</p></a></li>
<li><a href='#crunchyServer'><p>A Shiny server with Crunch auth</p></a></li>
<li><a href='#listDatasetGadget'><p>Open dataset selector</p></a></li>
<li><a href='#makeArrayGadget'><p>Launch array builder gadget</p></a></li>
<li><a href='#setCrunchyAuthorization'><p>Register authorization logic for your Crunchy app</p></a></li>
<li><a href='#shinyDataset'><p>Load a dataset for a Shiny session</p></a></li>
<li><a href='#shinyUser'><p>Return Crunch User Information</p></a></li>
<li><a href='#withCrunchyProgress'><p>Display progress from Crunch API processes</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Shiny Apps on Crunch</td>
</tr>
<tr>
<td>Description:</td>
<td>To facilitate building custom dashboards on the Crunch data
    platform <a href="https://crunch.io/">https://crunch.io/</a>, the 'crunchy' package provides tools for
    working with 'shiny'. These tools include utilities to manage authentication
    and authorization automatically and custom stylesheets to help match the
    look and feel of the Crunch web application. The package also includes
    several gadgets for use in 'RStudio'.</td>
</tr>
<tr>
<td>Version:</td>
<td>0.3.3</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://crunch.io/r/crunchy/">https://crunch.io/r/crunchy/</a>, <a href="https://github.com/Crunch-io/crunchy">https://github.com/Crunch-io/crunchy</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/Crunch-io/crunchy/issues">https://github.com/Crunch-io/crunchy/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/LGPL-3">LGPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.0.0), crunch, shiny</td>
</tr>
<tr>
<td>Imports:</td>
<td>httpcache, miniUI, rstudioapi (&ge; 0.4)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>covr, htmltools, httptest (&ge; 3.0.0), knitr, rmarkdown,
shinytest, spelling, testthat, withr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>6.1.1</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-01-13 20:45:58 UTC; gregfreedmanellis</td>
</tr>
<tr>
<td>Author:</td>
<td>Greg Freedman Ellis [aut, cre],
  Neal Richardson [aut],
  Jonathan Keane [aut],
  Gordon Shotwell [aut],
  Mike Malecki [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Greg Freedman Ellis &lt;greg@crunch.io&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-01-13 21:20:06 UTC</td>
</tr>
</table>
<hr>
<h2 id='crunchPage'>Build a Crunchy UI</h2><span id='topic+crunchPage'></span><span id='topic+crunchFluidPage'></span><span id='topic+crunchFillPage'></span><span id='topic+crunchNavbarPage'></span>

<h3>Description</h3>

<p>These are no longer necessary. Just use the <code>shiny</code> ones and it just works.
These functions are left here for backwards compatibility.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>crunchPage(...)

crunchFluidPage(...)

crunchFillPage(...)

crunchNavbarPage(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="crunchPage_+3A_...">...</code></td>
<td>
<p>arguments passed to <code>fluidPage</code>, <code>fillPage</code> or <code>navbarPage</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>The result of <code>fluidPage</code>, <code>fillPage</code> or <code>navbarPage</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
crunchPage(
    fluidRow(
        column(6,
            selectInput("filter",
                label="Filter",
                choices=filterList,
                selected="All"),
            br(),
            plotOutput("funnel1", height="300"),
        ),
        column(6,
            selectInput("brand",
                label="Competitor",
                choices=brands,
                selected="Nike"),
            br(),
            plotOutput("funnel2", height="300"),
        )
    )
)

## End(Not run)
</code></pre>

<hr>
<h2 id='crunchyBody'>A Shiny UI with Crunch auth</h2><span id='topic+crunchyBody'></span>

<h3>Description</h3>

<p>When using <code><a href="#topic+crunchyServer">crunchyServer()</a></code> to wrap your app in Crunch authentication and
authorization, you need to wrap your UI body content inside <code>crunchyBody()</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>crunchyBody(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="crunchyBody_+3A_...">...</code></td>
<td>
<p>UI elements for your app</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is the part that is conditionally rendered if the user is allowed.
Any UI elements you want always to show, including <code>&lt;head&gt;</code> tags, should go
outside this function.
</p>


<h3>Value</h3>

<p>A <code>uiOutput()</code> container into which <code>crunchyServer()</code> will
conditionally render output.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+crunchyPublicBody">crunchyPublicBody()</a></code> <code><a href="#topic+crunchyServer">crunchyServer()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
shinyUI(fluidPage(
    tags$head(
        # This is content that will always be rendered
        tags$title("My secure app")
    ),
    crunchyBody(
        # This is content that only is rendered if the user is authorized
        fluidRow(
            column(6, h1("Column 1")),
            column(6, h1("Column 2"))
        )
    )
))

## End(Not run)
</code></pre>

<hr>
<h2 id='crunchyPublicBody'>Alternate UIs for unauthenticated and unauthorized users</h2><span id='topic+crunchyPublicBody'></span><span id='topic+crunchyUnauthorizedBody'></span>

<h3>Description</h3>

<p><code><a href="#topic+crunchyServer">crunchyServer()</a></code> and <code><a href="#topic+crunchyBody">crunchyBody()</a></code> allow you to protect your app with
Crunch authentication and authorization. Add these UI contents to your
<code><a href="shiny.html#topic+shinyUI">shiny::shinyUI()</a></code> body to display different content for visitors who are
not authenticated with Crunch (<code>crunchyPublicBody()</code>) or who are
authenticated but not authorized to access your app
(<code>crunchyUnauthorizedBody</code>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>crunchyPublicBody(...)

crunchyUnauthorizedBody(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="crunchyPublicBody_+3A_...">...</code></td>
<td>
<p>UI elements for your app, to be conditionally rendered</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An empty string; these functions are called for their side effects of
registering the UI elements so that <code>crunchyServer()</code> can render them as
appropriate.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+crunchyBody">crunchyBody()</a></code>; <code><a href="#topic+setCrunchyAuthorization">setCrunchyAuthorization()</a></code> for governing who is
authorized to view your app.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# This is the example from crunchyBody(), adding these alternate bodies:
shinyUI(fluidPage(
    tags$head(
        # This is content that will always be rendered
        tags$title("My secure app")
    ),
    crunchyBody(
        # This is content that only is rendered if the user is authorized
        fluidRow(
            column(6, h1("Column 1")),
            column(6, h1("Column 2"))
        )
    ),
    crunchyPublicBody(
        # This is shown to visitors who are not logged into Crunch at all
        h1("Please log into Crunch.")
    ),
    crunchyUnauthorizedBody(
        # This is for Crunch users who don't meet your authorization criteria
        # Perhaps they don't have access to a particular dataset
        h1("You don't have access to this app."),
        tags$div("Contact your_admin@example.com.")
    )
))

## End(Not run)
</code></pre>

<hr>
<h2 id='crunchyServer'>A Shiny server with Crunch auth</h2><span id='topic+crunchyServer'></span>

<h3>Description</h3>

<p>To make sure that users who access your shiny.crunch.io app are allowed to
access it, use <code>crunchyServer()</code> instead of <code><a href="shiny.html#topic+shinyServer">shiny::shinyServer()</a></code>, and wrap
your UI content inside <code><a href="#topic+crunchyBody">crunchyBody()</a></code>. This will prevent anyone who is not
logged into Crunch in their browser from accessing your app.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>crunchyServer(func, authz = getOption("crunchy.authorization"))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="crunchyServer_+3A_func">func</code></td>
<td>
<p>A <code>function (input, output, session)</code>, as you'd normally give to
<code>shinyServer()</code>. If the user is not authenticated or authorized, this
function will not be evaluated.</p>
</td></tr>
<tr><td><code id="crunchyServer_+3A_authz">authz</code></td>
<td>
<p>A <code>function (input, output, session)</code> to evaluate
to determine if the current user is authorized to enter the app.
Since it will be called repeatedly, it should be cheap to execute.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>To restrict access further to only certain Crunch users, you can set an
authorization method, either by passing a server function to
the <code>authz</code> argument of this function, or by calling
<code><a href="#topic+setCrunchyAuthorization">setCrunchyAuthorization()</a></code>.
</p>
<p>For a simple example app using <code>crunchyServer()</code>, copy
<code>system.file("example_apps/crunchy_server/app.R", package="crunchy")</code>,
supply your dataset id on line 14, and run it.
</p>


<h3>Value</h3>

<p>Invisibly, a Shiny server function with the auth logic wrapped around
<code>func</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+crunchyBody">crunchyBody()</a></code> for wrapping the UI contents, <code><a href="#topic+crunchyPublicBody">crunchyPublicBody()</a></code>
for specifying an alternate UI for when the user is not authenticated,
<code><a href="#topic+crunchyUnauthorizedBody">crunchyUnauthorizedBody()</a></code> for giving an alternate UI for users who are
authenticated with Crunch but not authorized to view this app, and
<code><a href="#topic+setCrunchyAuthorization">setCrunchyAuthorization()</a></code> for governing who is authorized to view
your app.
</p>

<hr>
<h2 id='listDatasetGadget'>Open dataset selector</h2><span id='topic+listDatasetGadget'></span>

<h3>Description</h3>

<p>Open dataset selector
</p>


<h3>Usage</h3>

<pre><code class='language-R'>listDatasetGadget(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="listDatasetGadget_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code>crunch::listDatasets()</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>loadDataset()</code> call is pasted into your RStudio session
</p>

<hr>
<h2 id='makeArrayGadget'>Launch array builder gadget</h2><span id='topic+makeArrayGadget'></span>

<h3>Description</h3>

<p>Categorical Array and Multiple Response variables can be difficult to
construct without being able to investigate the available variables, and
their categories. This shiny gadget lets you select subvariables from the
dataset list, and ensures that those variables have consistent categories. To
use the gadget you must have at least one CrunchDataset loaded into the global
environment.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>makeArrayGadget(env = globalenv())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="makeArrayGadget_+3A_env">env</code></td>
<td>
<p>the environment to run the gadget</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a valid call to <code>makeArray()</code> or <code>makeMR()</code>
</p>

<hr>
<h2 id='setCrunchyAuthorization'>Register authorization logic for your Crunchy app</h2><span id='topic+setCrunchyAuthorization'></span>

<h3>Description</h3>

<p>Call this to set an expression or server function to evaluate to determine
whether the current user is authorized to access your app. Ideally, this is
cheap to execute because it will be called repeatedly.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>setCrunchyAuthorization(func)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="setCrunchyAuthorization_+3A_func">func</code></td>
<td>
<p>A <code>function (input, output, session)</code> to call
inside <code><a href="#topic+crunchyServer">crunchyServer()</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisibly, the server function. This function is called
for the side effect of setting the authorization function globally. The
function should return <code>TRUE</code> if the current user is authorized.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>setCrunchyAuthorization(function (input, output, session) {
    # Restrict to users who have crunch.io emails
    endsWith(email(shinyUser()()), "@crunch.io")
})
</code></pre>

<hr>
<h2 id='shinyDataset'>Load a dataset for a Shiny session</h2><span id='topic+shinyDataset'></span>

<h3>Description</h3>

<p>This function wraps <code><a href="crunch.html#topic+loadDataset">crunch::loadDataset()</a></code> in a
<code><a href="shiny.html#topic+reactive">shiny::reactive()</a></code> object for use in a Shiny app. It also ensures
that the current user is authenticated with Crunch before proceeding.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>shinyDataset(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="shinyDataset_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code>loadDataset</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A Shiny <code>reactive</code> object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
shinyServer(function(input, output, session) {
    ds &lt;- shinyDataset("Your dataset name")

    freqs &lt;- reactive({
        fmla &lt;- as.formula(paste("~", input$varname))
        crtabs(fmla, data=ds())
    })
})

## End(Not run)
</code></pre>

<hr>
<h2 id='shinyUser'>Return Crunch User Information</h2><span id='topic+shinyUser'></span>

<h3>Description</h3>

<p>This function returns information about the current user of the shiny app. This
is useful if you want to change the behavior of the app depending on who is
viewing the app. You can access elements of this record with crunch functions
like <code>name()</code> or <code>email().</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>shinyUser()
</code></pre>


<h3>Value</h3>

<p>A user record if the user is logged in, otherwise a character vector or error
</p>

<hr>
<h2 id='withCrunchyProgress'>Display progress from Crunch API processes</h2><span id='topic+withCrunchyProgress'></span>

<h3>Description</h3>

<p>Some potentially large operations, such as imports and exports, report
progress in the Crunch API. In an interactive R session, they print a text
progress bar. This context, which wraps <code><a href="shiny.html#topic+withProgress">shiny::withProgress()</a></code>, reports that
Crunch API progress up to the Shiny web app.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>withCrunchyProgress(expr, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="withCrunchyProgress_+3A_expr">expr</code></td>
<td>
<p>Code to evaluate</p>
</td></tr>
<tr><td><code id="withCrunchyProgress_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code><a href="shiny.html#topic+withProgress">shiny::withProgress()</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>The result of <code>expr</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
withCrunchyProgress(
    ds &lt;- newDataset(df),
    message = "Importing..."
)

## End(Not run)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
