<!DOCTYPE html><html lang="en"><head><title>Help for package tidywater</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {tidywater}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#tidywater-package'><p>tidywater: Water Quality Models for Drinking Water Treatment Processes</p></a></li>
<li><a href='#+25+26gt+3B+25'><p>Pipe operator</p></a></li>
<li><a href='#balance_ions'><p>Add Na, K, Cl, or SO4 to balance overall charge in a water</p></a></li>
<li><a href='#balance_ions_chain'><p>Apply 'balance_ions' within a dataframe and output a column of 'water' class to be chained to other tidywater functions</p></a></li>
<li><a href='#balance_ions_once'><p>Apply 'balance_ions' function and output a dataframe</p></a></li>
<li><a href='#biofilter_toc'><p>Determine TOC removal from biofiltration using Terry &amp; Summers BDOC model</p></a></li>
<li><a href='#biofilter_toc_chain'><p>Apply 'biofilter_toc' within a dataframe and output a column of 'water' class to be chained to other tidywater functions</p></a></li>
<li><a href='#biofilter_toc_once'><p>Apply 'biofilter_toc' function and output a data frame</p></a></li>
<li><a href='#blend_waters'><p>Determine blended water quality from multiple waters based on mass balance and acid/base equilibrium</p></a></li>
<li><a href='#blend_waters_chain'><p>Apply 'blend_waters' within a dataframe and output a column of 'water' class to be chained to other tidywater functions</p></a></li>
<li><a href='#blend_waters_once'><p>Apply 'blend_waters' to a dataframe and output 'water' slots as a dataframe</p></a></li>
<li><a href='#bromatecoeffs'><p>Data frame of bromate coefficients for predicting bromate formation during ozonation</p></a></li>
<li><a href='#calculate_corrosion'><p>Calculate six corrosion and scaling indices (AI, RI, LSI, LI, CSMR, CCPP)</p></a></li>
<li><a href='#calculate_corrosion_chain'><p>Apply 'calculate_corrosion' to a dataframe and output a column of 'water' class to be chained to other tidywater functions.</p></a></li>
<li><a href='#calculate_corrosion_once'><p>Apply 'calculate_corrosion' to a dataframe and create new columns with up to 6 corrosion indices</p></a></li>
<li><a href='#calculate_dic'><p>Calculate dissolved inorganic carbon (DIC) from total carbonate</p></a></li>
<li><a href='#calculate_hardness'><p>Calculate hardness from calcium and magnesium</p></a></li>
<li><a href='#chemdose_chlordecay'><p>Calculate chlorine decay</p></a></li>
<li><a href='#chemdose_chlordecay_chain'><p>Apply 'chemdose_chlordecay' within a data frame and output a column of 'water' class to be chained to other tidywater functions</p></a></li>
<li><a href='#chemdose_chlordecay_once'><p>Apply 'chemdose_chlordecay'function within a data frame and output a data frame</p></a></li>
<li><a href='#chemdose_dbp'><p>Calculate DBP formation</p></a></li>
<li><a href='#chemdose_dbp_chain'><p>Apply 'chemdose_dbp' within a data frame and output a column of 'water' class to be chained to other tidywater functions</p></a></li>
<li><a href='#chemdose_dbp_once'><p>Apply 'chemdose_dbp'function within a data frame and output a data frame</p></a></li>
<li><a href='#chemdose_f'><p>Calculate new fluoride concentration after dosing alum.</p></a></li>
<li><a href='#chemdose_ph'><p>Calculate new pH and ion balance after chemical addition</p></a></li>
<li><a href='#chemdose_ph_chain'><p>Apply 'chemdose_ph' within a dataframe and output a column of 'water' class to be chained to other tidywater functions</p></a></li>
<li><a href='#chemdose_ph_once'><p>Apply 'chemdose_ph' function and output a dataframe</p></a></li>
<li><a href='#chemdose_toc'><p>Determine TOC removal from coagulation</p></a></li>
<li><a href='#chemdose_toc_chain'><p>Apply 'chemdose_toc' within a dataframe and output a column of 'water' class to be chained to other tidywater functions</p></a></li>
<li><a href='#chemdose_toc_once'><p>Apply 'chemdose_toc' function and output a data frame</p></a></li>
<li><a href='#chloramine_conv'><p>Data frame of conversion factors for estimating DBP formation from chloramines</p></a></li>
<li><a href='#cl2coeffs'><p>Data frame of Cl2 decay coefficients</p></a></li>
<li><a href='#convert_units'><p>Calculate unit conversions for common compounds</p></a></li>
<li><a href='#convert_water'><p>Convert 'water' class object to a dataframe</p></a></li>
<li><a href='#convert_watermg'><p>Convert a 'water' class object to a dataframe with ions in mg/L or ug/L</p></a></li>
<li><a href='#dbp_correction'><p>Data frame of correction factors for estimating DBP formation as a function of location</p></a></li>
<li><a href='#dbpcoeffs'><p>Data frame of DBP coefficients for predicting DBP formation</p></a></li>
<li><a href='#define_water'><p>Create a water class object given water quality parameters</p></a></li>
<li><a href='#define_water_chain'><p>Apply 'define_water' within a dataframe and output a column of 'water' class to be chained to other tidywater functions</p></a></li>
<li><a href='#define_water_once'><p>Apply 'define_water' and output a dataframe</p></a></li>
<li><a href='#discons'><p>Dissociation constants and standard enthalpy for weak acids/bases</p></a></li>
<li><a href='#dissolve_pb'><p>Simulate contributions of various lead solids to total soluble lead</p></a></li>
<li><a href='#dissolve_pb_once'><p>Apply 'dissolve_pb' to a dataframe and create a new column with numeric dose</p></a></li>
<li><a href='#edwardscoeff'><p>Data frame of Edwards model coefficients</p></a></li>
<li><a href='#leadsol_constants'><p>Data frame of equilibrium constants for lead and copper solubility</p></a></li>
<li><a href='#mweights'><p>Molar weights of relevant compounds</p></a></li>
<li><a href='#ozonate_bromate'><p>Calculate bromate formation</p></a></li>
<li><a href='#ozonate_bromate_chain'><p>Apply 'ozonate_bromate' within a data frame and output a column of 'water' class to be chained to other tidywater functions</p></a></li>
<li><a href='#ozonate_bromate_once'><p>Apply 'ozonate_bromate'function within a data frame and output a data frame</p></a></li>
<li><a href='#pac_toc'><p>Calculate DOC Concentration in PAC system</p></a></li>
<li><a href='#pac_toc_chain'><p>Apply 'pac_toc' within a data frame and output a column of 'water' class to be chained to other tidywater functions</p>
PAC = powdered activated carbon</a></li>
<li><a href='#pac_toc_once'><p>Apply 'pac_toc'function within a data frame and output a data frame</p></a></li>
<li><a href='#plot_ions'><p>Create summary plot of ions from water class</p></a></li>
<li><a href='#pluck_water'><p>Pluck out a single parameter from a 'water' class object</p></a></li>
<li><a href='#solvecost_chem'><p>Determine chemical cost</p></a></li>
<li><a href='#solvecost_labor'><p>Determine labor cost</p></a></li>
<li><a href='#solvecost_power'><p>Determine power cost</p></a></li>
<li><a href='#solvecost_solids'><p>Determine solids disposal cost</p></a></li>
<li><a href='#solvect_chlorine'><p>Determine disinfection credit from chlorine.</p></a></li>
<li><a href='#solvect_chlorine_once'><p>Apply 'solvect_chlorine' to a data frame and create new columns with ct and log removals.</p></a></li>
<li><a href='#solvect_o3'><p>Determine disinfection credit from ozone.</p></a></li>
<li><a href='#solvect_o3_once'><p>Apply 'solvect_o3' to a data frame and create new columns with ct and log removals.</p></a></li>
<li><a href='#solvedose_alk'><p>Calculate a desired chemical dose for a target alkalinity</p></a></li>
<li><a href='#solvedose_alk_once'><p>Apply 'solvedose_alk' to a dataframe and create a new column with numeric dose</p></a></li>
<li><a href='#solvedose_ph'><p>Calculate a desired chemical dose for a target pH</p></a></li>
<li><a href='#solvedose_ph_once'><p>Apply 'solvedose_ph' to a dataframe and create a new column with numeric dose</p></a></li>
<li><a href='#solvemass_chem'><p>Convert mg/L of chemical to lb/day</p></a></li>
<li><a href='#solvemass_solids'><p>Determine solids lb/day</p></a></li>
<li><a href='#solveresid_o3'><p>Determine ozone decay</p></a></li>
<li><a href='#solveresid_o3_once'><p>Apply 'solveresid_o3' to a data frame and create a new column with residual ozone dose</p></a></li>
<li><a href='#summarize_wq'><p>Create summary table from water class</p></a></li>
<li><a href='#water_df'><p>Data frame of water quality parameters</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Water Quality Models for Drinking Water Treatment Processes</td>
</tr>
<tr>
<td>Version:</td>
<td>0.7.0</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/BrownandCaldwell-Public/tidywater">https://github.com/BrownandCaldwell-Public/tidywater</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/BrownandCaldwell-Public/tidywater/issues">https://github.com/BrownandCaldwell-Public/tidywater/issues</a></td>
</tr>
<tr>
<td>Description:</td>
<td>Provides multiple water chemistry-based models and published empirical models in one standard format.
    Functions can be chained together to model a complete treatment process and are designed to work in a 'tidyverse' workflow.
    Models are primarily based on these sources:
    Benjamin, M. M. (2002, ISBN:147862308X),
    Crittenden, J. C., Trussell, R., Hand, D., Howe, J. K., &amp; Tchobanoglous, G., Borchardt, J. H. (2012, ISBN:9781118131473),
    USEPA. (2001) <a href="https://www.epa.gov/sites/default/files/2017-03/documents/wtp_model_v._2.0_manual_508.pdf">https://www.epa.gov/sites/default/files/2017-03/documents/wtp_model_v._2.0_manual_508.pdf</a>.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License (&ge; 2)</a> | <a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr, tidyr, knitr, ggplot2, ggrepel, magrittr, purrr, furrr,
methods, rlang</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>rmarkdown, testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Date:</td>
<td>2025-01-22</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-01-22 23:09:09 UTC; SJohnson2</td>
</tr>
<tr>
<td>Author:</td>
<td>Sierra Johnson [aut, cre],
  Libby McKenna [aut],
  Riley Mulhern <a href="https://orcid.org/0000-0001-6293-3672"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Chris Corwin <a href="https://orcid.org/0000-0002-9462-0352"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Rachel Merrifield [ctb],
  Mayuri Namasivayam [ctb],
  Phoebe Chen [ctb],
  USEPA [cph] (Copyright holder of included TELSS fragments (dissolve_pb
    function)),
  Brown and Caldwell [fnd, cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Sierra Johnson &lt;sjohnson2@brwncald.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-01-22 23:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='tidywater-package'>tidywater: Water Quality Models for Drinking Water Treatment Processes</h2><span id='topic+tidywater'></span><span id='topic+tidywater-package'></span>

<h3>Description</h3>

<p>Provides multiple water chemistry-based models and published empirical models in one standard format. Functions can be chained together to model a complete treatment process and are designed to work in a 'tidyverse' workflow. Models are primarily based on these sources: Benjamin, M. M. (2002, ISBN:147862308X), Crittenden, J. C., Trussell, R., Hand, D., Howe, J. K., &amp; Tchobanoglous, G., Borchardt, J. H. (2012, ISBN:9781118131473), USEPA. (2001) <a href="https://www.epa.gov/sites/default/files/2017-03/documents/wtp_model_v._2.0_manual_508.pdf">https://www.epa.gov/sites/default/files/2017-03/documents/wtp_model_v._2.0_manual_508.pdf</a>.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Sierra Johnson <a href="mailto:sjohnson2@brwncald.com">sjohnson2@brwncald.com</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> Libby McKenna <a href="mailto:lmckenna@brwncald.com">lmckenna@brwncald.com</a>
</p>
</li>
<li><p> Riley Mulhern <a href="mailto:rmulhern@brwncald.com">rmulhern@brwncald.com</a> (<a href="https://orcid.org/0000-0001-6293-3672">ORCID</a>)
</p>
</li>
<li><p> Chris Corwin <a href="mailto:ccorwin@brwncald.com">ccorwin@brwncald.com</a> (<a href="https://orcid.org/0000-0002-9462-0352">ORCID</a>)
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> Rachel Merrifield [contributor]
</p>
</li>
<li><p> Mayuri Namasivayam [contributor]
</p>
</li>
<li><p> Phoebe Chen [contributor]
</p>
</li>
<li><p> USEPA (Copyright holder of included TELSS fragments (dissolve_pb function)) [copyright holder]
</p>
</li>
<li><p> Brown and Caldwell [funder, copyright holder]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/BrownandCaldwell-Public/tidywater">https://github.com/BrownandCaldwell-Public/tidywater</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/BrownandCaldwell-Public/tidywater/issues">https://github.com/BrownandCaldwell-Public/tidywater/issues</a>
</p>
</li></ul>


<hr>
<h2 id='+25+26gt+3B+25'>Pipe operator</h2><span id='topic++25+3E+25'></span>

<h3>Description</h3>

<p>See <code>magrittr::<a href="magrittr.html#topic+pipe">%&gt;%</a></code> for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lhs %&gt;% rhs
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="+2B25+2B26gt+2B3B+2B25_+3A_lhs">lhs</code></td>
<td>
<p>A value or the magrittr placeholder.</p>
</td></tr>
<tr><td><code id="+2B25+2B26gt+2B3B+2B25_+3A_rhs">rhs</code></td>
<td>
<p>A function call using the magrittr semantics.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The result of calling 'rhs(lhs)'.
</p>

<hr>
<h2 id='balance_ions'>Add Na, K, Cl, or SO4 to balance overall charge in a water</h2><span id='topic+balance_ions'></span>

<h3>Description</h3>

<p>This function takes a water defined by <code><a href="#topic+define_water">define_water</a></code> and balances charge.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>balance_ions(water)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="balance_ions_+3A_water">water</code></td>
<td>
<p>Water created with define_water, which may have some ions set to 0 when unknown</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If more cations are needed, sodium will be added, unless a number for sodium is already provided and potassium is 0, then it will add potassium. Similarly,
anions are added using chloride, unless sulfate is 0. If calcium and magnesium are not specified when defining a water with
<code><a href="#topic+define_water">define_water</a></code>, they will default to 0 and not be changed by this function.  This function is purely mathematical.
User should always check the outputs to make sure values are reasonable for the input source water.
</p>


<h3>Value</h3>

<p>A water class object with updated ions to balance water charge.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>water_defined &lt;- define_water(7, 20, 50, 100, 80, 10, 10, 10, 10, tot_po4 = 1) %&gt;%
  balance_ions()

</code></pre>

<hr>
<h2 id='balance_ions_chain'>Apply 'balance_ions' within a dataframe and output a column of 'water' class to be chained to other tidywater functions</h2><span id='topic+balance_ions_chain'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+balance_ions">balance_ions</a></code> to be added to a piped data frame.
Its output is a 'water' class, and can therefore be used with &quot;downstream&quot; tidywater functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>balance_ions_chain(
  df,
  input_water = "defined_water",
  output_water = "balanced_water"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="balance_ions_chain_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already been computed using <code><a href="#topic+define_water_chain">define_water_chain</a></code></p>
</td></tr>
<tr><td><code id="balance_ions_chain_+3A_input_water">input_water</code></td>
<td>
<p>name of the column of water class data to be used as the input for this function. Default is &quot;defined_water&quot;.</p>
</td></tr>
<tr><td><code id="balance_ions_chain_+3A_output_water">output_water</code></td>
<td>
<p>name of the output column storing updated parameters with the class, water. Default is &quot;balanced_water&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame containing a water class column with updated ions to balance water charge.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+balance_ions">balance_ions</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  chemdose_ph_chain(naoh = 5)

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain(output_water = "balanced ions, balanced life") %&gt;%
  chemdose_ph_chain(input_water = "balanced ions, balanced life", naoh = 5)

# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  chemdose_ph_chain(naoh = 5)

# Optional: explicitly close multisession processing
plan(sequential)

</code></pre>

<hr>
<h2 id='balance_ions_once'>Apply 'balance_ions' function and output a dataframe</h2><span id='topic+balance_ions_once'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+balance_ions">balance_ions</a></code> to be added to a piped data frame.
tidywater functions cannot be added after this function because they require a 'water' class input.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>balance_ions_once(df, input_water = "defined_water")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="balance_ions_once_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already been computed using <code><a href="#topic+define_water_chain">define_water_chain</a></code></p>
</td></tr>
<tr><td><code id="balance_ions_once_+3A_input_water">input_water</code></td>
<td>
<p>name of the column of water class data to be used as the input for this function. Default is &quot;defined_water&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A dataframe with updated ions to balance water charge
</p>


<h3>See Also</h3>

<p><code><a href="#topic+balance_ions">balance_ions</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_once()

example_df &lt;- water_df %&gt;%
  define_water_chain(output_water = "Different_defined_water_column") %&gt;%
  balance_ions_once(input_water = "Different_defined_water_column")

# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_once()

# Optional: explicitly close multisession processing
plan(sequential)

</code></pre>

<hr>
<h2 id='biofilter_toc'>Determine TOC removal from biofiltration using Terry &amp; Summers BDOC model</h2><span id='topic+biofilter_toc'></span>

<h3>Description</h3>

<p>This function applies the Terry model to a water created by <code><a href="#topic+define_water">define_water</a></code> to determine biofiltered
DOC (mg/L).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>biofilter_toc(water, ebct, ozonated = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="biofilter_toc_+3A_water">water</code></td>
<td>
<p>Source water object of class &quot;water&quot; created by <code><a href="#topic+define_water">define_water</a></code>.</p>
</td></tr>
<tr><td><code id="biofilter_toc_+3A_ebct">ebct</code></td>
<td>
<p>The empty bed contact time (min) used for the biofilter</p>
</td></tr>
<tr><td><code id="biofilter_toc_+3A_ozonated">ozonated</code></td>
<td>
<p>Logical; TRUE if the water is ozonated (default), FALSE otherwise</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A water class object with modeled DOC removal from biofiltration.
</p>


<h3>Source</h3>

<p>Terry and Summers 2018
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(tidywater)
water &lt;- define_water(ph = 7, temp = 25, alk = 100, toc = 5.0, doc = 4.0, uv254 = .1) %&gt;%
  biofilter_toc(ebct = 10, ozonated = FALSE)

</code></pre>

<hr>
<h2 id='biofilter_toc_chain'>Apply 'biofilter_toc' within a dataframe and output a column of 'water' class to be chained to other tidywater functions</h2><span id='topic+biofilter_toc_chain'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+biofilter_toc">biofilter_toc</a></code> to be added to a piped data frame.
Its output is a 'water' class, and can therefore be used with &quot;downstream&quot; tidywater functions.
TOC, DOC, and UV254 water slots will be updated based on input EBCT and whether the water is ozonated.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>biofilter_toc_chain(
  df,
  input_water = "defined_water",
  output_water = "biofiltered_water",
  ebct = 0,
  ozonated = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="biofilter_toc_chain_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already been computed using
<code><a href="#topic+define_water_chain">define_water_chain</a></code>. The df may include a column indicating the EBCT or whether the water is ozonated.
and a column named for the set of coefficients to use.</p>
</td></tr>
<tr><td><code id="biofilter_toc_chain_+3A_input_water">input_water</code></td>
<td>
<p>name of the column of Water class data to be used as the input for this function. Default is &quot;defined_water&quot;.</p>
</td></tr>
<tr><td><code id="biofilter_toc_chain_+3A_output_water">output_water</code></td>
<td>
<p>name of the output column storing updated parameters with the class, Water. Default is &quot;biofiltered_water&quot;.</p>
</td></tr>
<tr><td><code id="biofilter_toc_chain_+3A_ebct">ebct</code></td>
<td>
<p>The empty bed contact time (min) used for the biofilter</p>
</td></tr>
<tr><td><code id="biofilter_toc_chain_+3A_ozonated">ozonated</code></td>
<td>
<p>Logical; TRUE if the water is ozonated (default), FALSE otherwise</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data input comes from a 'water' class column, as initialized in <code><a href="#topic+define_water_chain">define_water_chain</a></code>.
</p>
<p>If the input data frame has column(s) named &quot;ebct&quot; or &quot;ozonated&quot;, the function uses those as arguments. Note:
The function can use either a column or the direct function arguments, not both.
</p>
<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame containing a water class column with updated DOC, TOC, and UV254 water slots.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+biofilter_toc">biofilter_toc</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  biofilter_toc_chain(input_water = "defined_water", ebct = 10, ozonated = FALSE)

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  mutate(
    ebct = c(10, 10, 10, 15, 15, 15, 20, 20, 20, 25, 25, 25),
    ozonated = c(rep(TRUE, 6), rep(FALSE, 6))
  ) %&gt;%
  biofilter_toc_chain(input_water = "defined_water")

# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  biofilter_toc_chain(input_water = "defined_water", ebct = c(10, 20))

# Optional: explicitly close multisession processing
plan(sequential)

</code></pre>

<hr>
<h2 id='biofilter_toc_once'>Apply 'biofilter_toc' function and output a data frame</h2><span id='topic+biofilter_toc_once'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+biofilter_toc">biofilter_toc</a></code> to be added to a piped data frame.
Its output is a data frame with updated TOC, DOC, and BDOC
</p>


<h3>Usage</h3>

<pre><code class='language-R'>biofilter_toc_once(
  df,
  input_water = "defined_water",
  ebct = 0,
  ozonated = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="biofilter_toc_once_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already been computed using
<code><a href="#topic+define_water_chain">define_water_chain</a></code>. The df may include a column indicating the EBCT or whether the water is ozonated.</p>
</td></tr>
<tr><td><code id="biofilter_toc_once_+3A_input_water">input_water</code></td>
<td>
<p>name of the column of Water class data to be used as the input for this function. Default is &quot;defined_water&quot;.</p>
</td></tr>
<tr><td><code id="biofilter_toc_once_+3A_ebct">ebct</code></td>
<td>
<p>The empty bed contact time (min) used for the biofilter</p>
</td></tr>
<tr><td><code id="biofilter_toc_once_+3A_ozonated">ozonated</code></td>
<td>
<p>Logical; TRUE if the water is ozonated (default), FALSE otherwise</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data input comes from a 'water' class column, as initialized in <code><a href="#topic+define_water_chain">define_water_chain</a></code>.
</p>
<p>If the input data frame has column(s) named &quot;ebct&quot; or &quot;ozonated&quot;, the function uses those as arguments. Note:
The function can use either a column or the direct function arguments, not both.
</p>
<p>tidywater functions cannot be added after this function because they require a 'water' class input.
</p>
<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame with updated DOC, TOC, and BDOC concentrations.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+biofilter_toc">biofilter_toc</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  biofilter_toc_once(input_water = "defined_water", ebct = 10, ozonated = FALSE)

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  mutate(
    ebct = rep(c(10, 15, 20), 4),
    ozonated = c(rep(TRUE, 6), rep(FALSE, 6))
  ) %&gt;%
  biofilter_toc_once(input_water = "defined_water")

# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  biofilter_toc_once(input_water = "defined_water", ebct = c(10, 20))

# Optional: explicitly close multisession processing
plan(sequential)

</code></pre>

<hr>
<h2 id='blend_waters'>Determine blended water quality from multiple waters based on mass balance and acid/base equilibrium</h2><span id='topic+blend_waters'></span>

<h3>Description</h3>

<p>This function takes a vector of waters defined by <code><a href="#topic+define_water">define_water</a></code>
and a vector of ratios and outputs a new water object with updated ions and pH.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>blend_waters(waters, ratios)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="blend_waters_+3A_waters">waters</code></td>
<td>
<p>Vector of source waters created by <code><a href="#topic+define_water">define_water</a></code></p>
</td></tr>
<tr><td><code id="blend_waters_+3A_ratios">ratios</code></td>
<td>
<p>Vector of ratios in the same order as waters. (Blend ratios must sum to 1)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A water class object with blended water quality parameters.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+define_water">define_water</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>water1 &lt;- define_water(7, 20, 50)
water2 &lt;- define_water(7.5, 20, 100, tot_nh3 = 2)
blend_waters(c(water1, water2), c(.4, .6))

</code></pre>

<hr>
<h2 id='blend_waters_chain'>Apply 'blend_waters' within a dataframe and output a column of 'water' class to be chained to other tidywater functions</h2><span id='topic+blend_waters_chain'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+blend_waters">blend_waters</a></code> to be added to a piped data frame.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>blend_waters_chain(df, waters, ratios, output_water = "blended_water")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="blend_waters_chain_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already
been computed using <code><a href="#topic+define_water_chain">define_water_chain</a></code>,</p>
</td></tr>
<tr><td><code id="blend_waters_chain_+3A_waters">waters</code></td>
<td>
<p>List of column names containing a water class to be blended</p>
</td></tr>
<tr><td><code id="blend_waters_chain_+3A_ratios">ratios</code></td>
<td>
<p>List of column names or vector of blend ratios in the same order as waters. (Blend ratios must sum to 1)</p>
</td></tr>
<tr><td><code id="blend_waters_chain_+3A_output_water">output_water</code></td>
<td>
<p>name of output column storing updated parameters with the class, water. Default is &quot;blended_water&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data input comes from a 'water' class column, initialized in <code><a href="#topic+define_water">define_water</a></code> or <code><a href="#topic+balance_ions">balance_ions</a></code>.
The 'water' class columns to use in the function are specified as function arguments. Ratios may be input
as columns with varied ratios (in this case, input column names in the function arguments), OR input as numbers directly.
</p>
<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame with a water class column containing updated ions and pH.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+blend_waters">blend_waters</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  chemdose_ph_chain(naoh = 22) %&gt;%
  mutate(
    ratios1 = .4,
    ratios2 = .6
  ) %&gt;%
  blend_waters_chain(
    waters = c("defined_water", "dosed_chem_water"),
    ratios = c("ratios1", "ratios2"), output_water = "Blending_after_chemicals"
  )


example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  chemdose_ph_chain(naoh = 22, output_water = "dosed") %&gt;%
  blend_waters_chain(waters = c("defined_water", "dosed", "balanced_water"), ratios = c(.2, .3, .5))


# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  chemdose_ph_chain(naoh = 22, output_water = "dosed") %&gt;%
  blend_waters_chain(waters = c("defined_water", "dosed", "balanced_water"), ratios = c(.2, .3, .5))

# Optional: explicitly close multisession processing
plan(sequential)


</code></pre>

<hr>
<h2 id='blend_waters_once'>Apply 'blend_waters' to a dataframe and output 'water' slots as a dataframe</h2><span id='topic+blend_waters_once'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+blend_waters">blend_waters</a></code> to be added to a piped data frame.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>blend_waters_once(df, waters, ratios)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="blend_waters_once_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already been computed using
<code><a href="#topic+define_water_chain">define_water_chain</a></code></p>
</td></tr>
<tr><td><code id="blend_waters_once_+3A_waters">waters</code></td>
<td>
<p>List of column names containing a water class to be blended</p>
</td></tr>
<tr><td><code id="blend_waters_once_+3A_ratios">ratios</code></td>
<td>
<p>List of column names or vector of blend ratios in the same order as waters. (Blend ratios must sum to 1)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data input comes from a 'water' class column, initialized in <code><a href="#topic+define_water">define_water</a></code> or <code><a href="#topic+balance_ions">balance_ions</a></code>.
The 'water' class columns to use in the function are specified as function arguments. Ratios may be input
as columns with varied ratios (in this case, input column names in the function arguments), OR input as numbers directly.
</p>
<p>tidywater functions cannot be added after this function because they require a 'water' class input.
</p>
<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame with blended water quality parameters.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+blend_waters">blend_waters</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  chemdose_ph_chain(naoh = 22, output_water = "dosed") %&gt;%
  mutate(
    ratios1 = .4,
    ratios2 = .6
  ) %&gt;%
  blend_waters_once(waters = c("defined_water", "dosed"), ratios = c("ratios1", "ratios2"))

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  chemdose_ph_chain(naoh = 22, output_water = "dosed") %&gt;%
  blend_waters_once(waters = c("defined_water", "dosed", "balanced_water"), ratios = c(.2, .3, .5))


# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  chemdose_ph_chain(naoh = 22, output_water = "dosed") %&gt;%
  blend_waters_once(waters = c("defined_water", "dosed", "balanced_water"), ratios = c(.2, .3, .5))

# Optional: explicitly close multisession processing
plan(sequential)


</code></pre>

<hr>
<h2 id='bromatecoeffs'>Data frame of bromate coefficients for predicting bromate formation during ozonation</h2><span id='topic+bromatecoeffs'></span>

<h3>Description</h3>

<p>A dataset containing coefficients for calculating ozone formation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bromatecoeffs
</code></pre>


<h3>Format</h3>

<p>A dataframe with 30 rows and 10 columns
</p>

<dl>
<dt>model</dt><dd><p>First author of source model</p>
</dd>
<dt>ammonia</dt><dd><p>Either T or F, depending on whether the model applies to waters with ammonia present.</p>
</dd>
<dt>A</dt><dd><p>First coefficient in bromate model</p>
</dd>
<dt>a</dt><dd><p>Exponent in bromate model, associated with Br-</p>
</dd>
<dt>b</dt><dd><p>Exponent in bromate model, associated with DOC</p>
</dd>
<dt>c</dt><dd><p>Exponent in bromate model, associated with UVA</p>
</dd>
<dt>d</dt><dd><p>Exponent in bromate model, associated with pH</p>
</dd>
<dt>e</dt><dd><p>Exponent in bromate model, associated with Alkalinity</p>
</dd>
<dt>f</dt><dd><p>Exponent in bromate model, associated with ozone dose</p>
</dd>
<dt>g</dt><dd><p>Exponent in bromate model, associated with reaction time</p>
</dd>
<dt>h</dt><dd><p>Exponent in bromate model, associated with ammonia (NH4+)</p>
</dd>
<dt>i</dt><dd><p>Exponent in bromate model, associated with temperature</p>
</dd>
<dt>I</dt><dd><p>Coefficient in bromate model, associated with temperature in the exponent. Either i or I are used, not both.</p>
</dd>
</dl>



<h3>Source</h3>

<p>Ozekin (1994), Sohn et al (2004), Song et al (1996), Galey et al (1997), Siddiqui et al (1994)
</p>
<p>See references list at: <a href="https://github.com/BrownandCaldwell-Public/tidywater/wiki/References">https://github.com/BrownandCaldwell-Public/tidywater/wiki/References</a>
</p>

<hr>
<h2 id='calculate_corrosion'>Calculate six corrosion and scaling indices (AI, RI, LSI, LI, CSMR, CCPP)</h2><span id='topic+calculate_corrosion'></span>

<h3>Description</h3>

<p><code>calculate_corrosion</code> takes an object of class &quot;water&quot; created by <code><a href="#topic+define_water">define_water</a></code> and calculates
corrosion and scaling indices.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_corrosion(
  water,
  index = c("aggressive", "ryznar", "langelier", "ccpp", "larsonskold", "csmr"),
  form = "calcite"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calculate_corrosion_+3A_water">water</code></td>
<td>
<p>Source water of class &quot;water&quot; created by <code><a href="#topic+define_water">define_water</a></code></p>
</td></tr>
<tr><td><code id="calculate_corrosion_+3A_index">index</code></td>
<td>
<p>The indices to be calculated.
Default calculates all six indices: &quot;aggressive&quot;, &quot;ryznar&quot;, &quot;langelier&quot;, &quot;ccpp&quot;, &quot;larsonskold&quot;, &quot;csmr&quot;
CCPP may not be able to be calculated sometimes, so it may be advantageous to leave this out of the function to avoid errors</p>
</td></tr>
<tr><td><code id="calculate_corrosion_+3A_form">form</code></td>
<td>
<p>Form of calcium carbonate mineral to use for modelling solubility: &quot;calcite&quot; (default), &quot;aragonite&quot;, or &quot;vaterite&quot;</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Aggressiveness Index (AI), unitless - the corrosive tendency of water and its effect on asbestos cement pipe.
</p>
<p>Ryznar Index (RI), unitless - a measure of scaling potential.
</p>
<p>Langelier Saturation Index (LSI), unitless - describes the potential for calcium carbonate scale formation.
Equations use empirical calcium carbonate solubilities from Plummer and Busenberg (1982) and Crittenden et al. (2012)
rather than calculated from the concentrations of calcium and carbonate in the water.
</p>
<p>Larson-skold Index (LI), unitless - describes the corrosivity towards mild steel.
</p>
<p>Chloride-to-sulfate mass ratio (CSMR), mg Cl/mg SO4 - indicator of galvanic corrosion for lead solder pipe joints.
</p>
<p>Calcium carbonate precipitation potential (CCPP), mg/L as CaCO3 - a prediction of the mass of calcium carbonate that will precipitate at equilibrium.
A positive CCPP value indicates the amount of CaCO3 (mg/L as CaCO3) that will precipitate.
A negative CCPP indicates how much CaCO3 can be dissolved in the water.
</p>


<h3>Value</h3>

<p>A water class object with updated corrosion and scaling index slots.
</p>


<h3>Source</h3>

<p>AWWA (1977)
</p>
<p>Crittenden et al. (2012)
</p>
<p>Langelier (1936)
</p>
<p>Larson and Skold (1958)
</p>
<p>Merrill and Sanks (1977a)
</p>
<p>Merrill and Sanks (1977b)
</p>
<p>Merrill and Sanks (1978)
</p>
<p>Nguyen et al. (2011)
</p>
<p>Plummer and Busenberg (1982)
</p>
<p>Ryznar (1946)
</p>
<p>Schock (1984)
</p>
<p>Trussell (1998)
</p>
<p>U.S. EPA (1980)
</p>
<p>See reference list at <a href="https://github.com/BrownandCaldwell-Public/tidywater/wiki/References">https://github.com/BrownandCaldwell-Public/tidywater/wiki/References</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+define_water">define_water</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>water &lt;- define_water(
  ph = 8, temp = 25, alk = 200, tot_hard = 200,
  tds = 576, cl = 150, so4 = 200
) %&gt;%
  calculate_corrosion()

water &lt;- define_water(ph = 8, temp = 25, alk = 100, tot_hard = 50, tds = 200) %&gt;%
  calculate_corrosion(index = c("aggressive", "ccpp"))

</code></pre>

<hr>
<h2 id='calculate_corrosion_chain'>Apply 'calculate_corrosion' to a dataframe and output a column of 'water' class to be chained to other tidywater functions.</h2><span id='topic+calculate_corrosion_chain'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+calculate_corrosion">calculate_corrosion</a></code> to be added to a piped data frame.
Up to six additional columns will be added to the output 'water' class column depending on what corrosion/scaling
indices are selected: Aggressive index (AI), Ryznar index (RI), Langelier saturation index (LSI),
Larson-Skold index (LI), chloride-to-sulfate mass ratio (CSMR) &amp; calcium carbonate precipitation potential (CCPP).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_corrosion_chain(
  df,
  input_water = "defined_water",
  output_water = "corrosion_indices",
  index = c("aggressive", "ryznar", "langelier", "ccpp", "larsonskold", "csmr"),
  form = "calcite"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calculate_corrosion_chain_+3A_df">df</code></td>
<td>
<p>a data frame containing a column, defined_water, which has already
been computed using <code><a href="#topic+define_water">define_water</a></code>, and a column named for each of the chemicals being dosed</p>
</td></tr>
<tr><td><code id="calculate_corrosion_chain_+3A_input_water">input_water</code></td>
<td>
<p>name of the column of water class data to be used as the input. Default is &quot;defined_water&quot;.</p>
</td></tr>
<tr><td><code id="calculate_corrosion_chain_+3A_output_water">output_water</code></td>
<td>
<p>name of output column storing updated indices with the class, water. Default is &quot;corrosion_indices&quot;.</p>
</td></tr>
<tr><td><code id="calculate_corrosion_chain_+3A_index">index</code></td>
<td>
<p>The indices to be calculated.
Default calculates all six indices: &quot;aggressive&quot;, &quot;ryznar&quot;, &quot;langelier&quot;, &quot;ccpp&quot;, &quot;larsonskold&quot;, &quot;csmr&quot;
CCPP may not be able to be calculated sometimes, so it may be advantageous to leave this out of the function to avoid errors</p>
</td></tr>
<tr><td><code id="calculate_corrosion_chain_+3A_form">form</code></td>
<td>
<p>Form of calcium carbonate mineral to use for modelling solubility: &quot;calcite&quot; (default), &quot;aragonite&quot;, or &quot;vaterite&quot;</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data input comes from a 'water' class column, initialized in <code><a href="#topic+define_water">define_water</a></code> or <code><a href="#topic+balance_ions">balance_ions</a></code>.
The 'water' class column to use in the function is specified in the 'input_water' argument (default input 'water' is &quot;defined_water&quot;.
The name of the output 'water' class column defaults to  &quot;corrosion_indices&quot;, but may be altered using the 'output_water' argument.
</p>
<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame containing a water class column with updated corrosion and scaling index slots.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+calculate_corrosion">calculate_corrosion</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;%
  slice_head(n = 2) %&gt;% # used to make example run faster
  define_water_chain() %&gt;%
  calculate_corrosion_chain()

example_df &lt;- water_df %&gt;%
  slice_head(n = 2) %&gt;% # used to make example run faster
  define_water_chain() %&gt;%
  calculate_corrosion_chain(index = c("aggressive", "ccpp"))


# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  calculate_corrosion_chain(index = c("aggressive", "ccpp"))

# Optional: explicitly close multisession processing
plan(sequential)


</code></pre>

<hr>
<h2 id='calculate_corrosion_once'>Apply 'calculate_corrosion' to a dataframe and create new columns with up to 6 corrosion indices</h2><span id='topic+calculate_corrosion_once'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+calculate_corrosion">calculate_corrosion</a></code> to be added to a piped data frame.
Up to six additional columns will be added to the dataframe depending on what corrosion/scaling
indices are selected: Aggressive index (AI), Ryznar index (RI), Langelier saturation index (LSI),
Larson-Skold index (LI), chloride-to-sulfate mass ratio (CSMR) &amp; calcium carbonate precipitation potential (CCPP).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_corrosion_once(
  df,
  input_water = "defined_water",
  index = c("aggressive", "ryznar", "langelier", "ccpp", "larsonskold", "csmr"),
  form = "calcite"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calculate_corrosion_once_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, created using <code><a href="#topic+define_water">define_water</a></code></p>
</td></tr>
<tr><td><code id="calculate_corrosion_once_+3A_input_water">input_water</code></td>
<td>
<p>name of the column of water class data to be used as the input. Default is &quot;defined_water&quot;.</p>
</td></tr>
<tr><td><code id="calculate_corrosion_once_+3A_index">index</code></td>
<td>
<p>The indices to be calculated.
Default calculates all six indices: &quot;aggressive&quot;, &quot;ryznar&quot;, &quot;langelier&quot;, &quot;ccpp&quot;, &quot;larsonskold&quot;, &quot;csmr&quot;.
CCPP may not be able to be calculated sometimes, so it may be advantageous to leave this out of the function to avoid errors</p>
</td></tr>
<tr><td><code id="calculate_corrosion_once_+3A_form">form</code></td>
<td>
<p>Form of calcium carbonate mineral to use for modelling solubility: &quot;calcite&quot; (default), &quot;aragonite&quot;, or &quot;vaterite&quot;</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data input comes from a 'water' class column, initialized in <code><a href="#topic+define_water">define_water</a></code> or <code><a href="#topic+balance_ions">balance_ions</a></code>.
</p>
<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame containing specified corrosion and scaling indices.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+calculate_corrosion">calculate_corrosion</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;%
  slice_head(n = 2) %&gt;% # used to make example run faster
  define_water_chain() %&gt;%
  calculate_corrosion_once()

example_df &lt;- water_df %&gt;%
  slice_head(n = 2) %&gt;% # used to make example run faster
  define_water_chain() %&gt;%
  calculate_corrosion_once(index = c("aggressive", "ccpp"))


# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  calculate_corrosion_once(index = c("aggressive", "ccpp"))

# Optional: explicitly close multisession processing
plan(sequential)


</code></pre>

<hr>
<h2 id='calculate_dic'>Calculate dissolved inorganic carbon (DIC) from total carbonate</h2><span id='topic+calculate_dic'></span>

<h3>Description</h3>

<p>This function takes a water class object defined by <code><a href="#topic+define_water">define_water</a></code>
and outputs a DIC (mg/L).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_dic(water)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calculate_dic_+3A_water">water</code></td>
<td>
<p>a water class object containing columns with all the parameters listed in <code><a href="#topic+define_water">define_water</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric value for the calculated DIC.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+define_water">define_water</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
example_dic &lt;- define_water(8, 15, 200) %&gt;%
  calculate_dic()

</code></pre>

<hr>
<h2 id='calculate_hardness'>Calculate hardness from calcium and magnesium</h2><span id='topic+calculate_hardness'></span>

<h3>Description</h3>

<p>This function takes Ca and Mg in mg/L and returns hardness in mg/L as CaCO3
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_hardness(ca, mg, type = "total", startunit = "mg/L")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calculate_hardness_+3A_ca">ca</code></td>
<td>
<p>Calcium concentration in mg/L as Ca</p>
</td></tr>
<tr><td><code id="calculate_hardness_+3A_mg">mg</code></td>
<td>
<p>Magnesium concentration in mg/L as Mg</p>
</td></tr>
<tr><td><code id="calculate_hardness_+3A_type">type</code></td>
<td>
<p>&quot;total&quot; returns total hardness, &quot;ca&quot; returns calcium hardness. Defaults to &quot;total&quot;</p>
</td></tr>
<tr><td><code id="calculate_hardness_+3A_startunit">startunit</code></td>
<td>
<p>Units of Ca and Mg. Defaults to mg/L</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric value for the total hardness in mg/L as CaCO3.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>calculate_hardness(50, 10)

water_defined &lt;- define_water(7, 20, 50, 100, 80, 10, 10, 10, 10, tot_po4 = 1)
calculate_hardness(water_defined@ca, water_defined@mg, "total", "M")

</code></pre>

<hr>
<h2 id='chemdose_chlordecay'>Calculate chlorine decay</h2><span id='topic+chemdose_chlordecay'></span>

<h3>Description</h3>

<p>calculates the decay of chlorine or chloramine based on the U.S. EPA's
Water Treatment Plant Model (U.S. EPA, 2001).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chemdose_chlordecay(
  water,
  cl2_dose,
  time,
  treatment = "raw",
  cl_type = "chlorine"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="chemdose_chlordecay_+3A_water">water</code></td>
<td>
<p>Source water object of class &quot;water&quot; created by <code><a href="#topic+define_water">define_water</a></code></p>
</td></tr>
<tr><td><code id="chemdose_chlordecay_+3A_cl2_dose">cl2_dose</code></td>
<td>
<p>Applied chlorine or chloramine dose (mg/L as cl2). Model results are valid for doses between 0.995 and 41.7 mg/L for raw water,
and for doses between 1.11 and 24.7 mg/L for coagulated water.</p>
</td></tr>
<tr><td><code id="chemdose_chlordecay_+3A_time">time</code></td>
<td>
<p>Reaction time (hours). Chlorine decay model results are valid for reaction times between 0.25 and 120 hours.Chloramine decay model
does not have specified boundary conditions.</p>
</td></tr>
<tr><td><code id="chemdose_chlordecay_+3A_treatment">treatment</code></td>
<td>
<p>Type of treatment applied to the water. Options include &quot;raw&quot; for no treatment (default), &quot;coag&quot; for
water that has been coagulated or softened.</p>
</td></tr>
<tr><td><code id="chemdose_chlordecay_+3A_cl_type">cl_type</code></td>
<td>
<p>Type of chlorination applied, either &quot;chlorine&quot; (default) or &quot;chloramine&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Required arguments include an object of class &quot;water&quot; created by <code><a href="#topic+define_water">define_water</a></code>,
applied chlorine/chloramine dose, type, reaction time, and treatment applied (options include &quot;raw&quot; for
no treatment, or &quot;coag&quot; for coagulated water). The function also requires additional water quality
parameters defined in <code>define_water</code> including TOC and UV254. The output is a new &quot;water&quot; class
with the calculated total chlorine value stored in the 'free_chlorine' or 'combined_chlorine' slot,
depending on what type of chlorine is dosed. When modeling residual concentrations
through a unit process, the U.S. EPA Water Treatment Plant Model applies a correction factor based on the
influent and effluent residual concentrations (see U.S. EPA (2001) equation 5-118) that may need to be
applied manually by the user based on the output.
</p>


<h3>Value</h3>

<p>An updated disinfectant residual in the free_chlorine or combined chlorine water slot in units of M.
Use <code><a href="#topic+convert_units">convert_units</a></code> to convert to mg/L.
</p>


<h3>Source</h3>

<p>U.S. EPA (2001)
</p>
<p>See references list at: <a href="https://github.com/BrownandCaldwell-Public/tidywater/wiki/References">https://github.com/BrownandCaldwell-Public/tidywater/wiki/References</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>example_cl2 &lt;- suppressWarnings(define_water(8, 20, 66, toc = 4, uv254 = 0.2)) %&gt;%
  chemdose_chlordecay(cl2_dose = 2, time = 8)
</code></pre>

<hr>
<h2 id='chemdose_chlordecay_chain'>Apply 'chemdose_chlordecay' within a data frame and output a column of 'water' class to be chained to other tidywater functions</h2><span id='topic+chemdose_chlordecay_chain'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+chemdose_chlordecay">chemdose_chlordecay</a></code> to be added to a piped data frame.
Its output is a 'water' class, and can therefore be used with &quot;downstream&quot; tidywater functions.
free_chlorine or combined_chlorine slots will be updated depending on chlorine type.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chemdose_chlordecay_chain(
  df,
  input_water = "defined_water",
  output_water = "disinfected_water",
  cl2_dose = 0,
  time = 0,
  treatment = "raw",
  cl_type = "chlorine"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="chemdose_chlordecay_chain_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already been computed using
<code><a href="#topic+define_water_chain">define_water_chain</a></code>. The df may include a column named for the applied chlorine dose (cl2_dose),
and a column for time in hours.</p>
</td></tr>
<tr><td><code id="chemdose_chlordecay_chain_+3A_input_water">input_water</code></td>
<td>
<p>name of the column of water class data to be used as the input for this function. Default is &quot;defined_water&quot;.</p>
</td></tr>
<tr><td><code id="chemdose_chlordecay_chain_+3A_output_water">output_water</code></td>
<td>
<p>name of the output column storing updated parameters with the class, water. Default is &quot;disinfected_water&quot;.</p>
</td></tr>
<tr><td><code id="chemdose_chlordecay_chain_+3A_cl2_dose">cl2_dose</code></td>
<td>
<p>Applied chlorine or chloramine dose (mg/L as cl2). Model results are valid for doses between 0.995 and 41.7 mg/L for raw water,
and for doses between 1.11 and 24.7 mg/L for coagulated water.</p>
</td></tr>
<tr><td><code id="chemdose_chlordecay_chain_+3A_time">time</code></td>
<td>
<p>Reaction time (hours). Chlorine decay model results are valid for reaction times between 0.25 and 120 hours. Chloramine decay model
does not have specified boundary conditions.</p>
</td></tr>
<tr><td><code id="chemdose_chlordecay_chain_+3A_treatment">treatment</code></td>
<td>
<p>Type of treatment applied to the water. Options include &quot;raw&quot; for no treatment (default), &quot;coag&quot; for
water that has been coagulated or softened.</p>
</td></tr>
<tr><td><code id="chemdose_chlordecay_chain_+3A_cl_type">cl_type</code></td>
<td>
<p>Type of chlorination applied, either &quot;chlorine&quot; (default) or &quot;chloramine&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data input comes from a 'water' class column, as initialized in <code><a href="#topic+define_water_chain">define_water_chain</a></code>.
</p>
<p>If the input data frame has a chlorine dose column (cl2_dose) or time column (time), the function will use those columns. Note:
The function can only take cl2_dose and time inputs as EITHER a column or as function arguments, not both.
</p>
<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame containing a water class column with updated chlorine residuals.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+chemdose_chlordecay">chemdose_chlordecay</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;%
  mutate(br = 50) %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  chemdose_chlordecay_chain(input_water = "balanced_water", cl2_dose = 4, time = 8)

example_df &lt;- water_df %&gt;%
  mutate(br = 50) %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  mutate(
    cl2_dose = seq(2, 24, 2),
    time = 30
  ) %&gt;%
  chemdose_chlordecay_chain(input_water = "balanced_water")

example_df &lt;- water_df %&gt;%
  mutate(br = 80) %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  mutate(time = 8) %&gt;%
  chemdose_chlordecay_chain(
    input_water = "balanced_water", cl2_dose = 6, treatment = "coag",
    cl_type = "chloramine"
  )


# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;%
  mutate(br = 50) %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  chemdose_chlordecay_chain(input_water = "balanced_water", cl2_dose = 4, time = 8)

# Optional: explicitly close multisession processing
plan(sequential)


</code></pre>

<hr>
<h2 id='chemdose_chlordecay_once'>Apply 'chemdose_chlordecay'function within a data frame and output a data frame</h2><span id='topic+chemdose_chlordecay_once'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+chemdose_chlordecay">chemdose_chlordecay</a></code> to be added to a piped data frame.
Its output is a data frame containing columns for free_chlorine or combined_chlorine (depending on chlorine type).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chemdose_chlordecay_once(
  df,
  input_water = "defined_water",
  cl2_dose = 0,
  time = 0,
  treatment = "raw",
  cl_type = "chlorine"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="chemdose_chlordecay_once_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already been computed using
<code><a href="#topic+define_water_once">define_water_once</a></code>. The df may include a column named for the applied chlorine dose (cl2),
and a column for time in hours.</p>
</td></tr>
<tr><td><code id="chemdose_chlordecay_once_+3A_input_water">input_water</code></td>
<td>
<p>name of the column of water class data to be used as the input for this function. Default is &quot;defined_water&quot;.</p>
</td></tr>
<tr><td><code id="chemdose_chlordecay_once_+3A_cl2_dose">cl2_dose</code></td>
<td>
<p>Applied chlorine or chloramine dose (mg/L as cl2). Model results are valid for doses between 0.995 and 41.7 mg/L for raw water,
and for doses between 1.11 and 24.7 mg/L for coagulated water.</p>
</td></tr>
<tr><td><code id="chemdose_chlordecay_once_+3A_time">time</code></td>
<td>
<p>Reaction time (hours). Chlorine decay model results are valid for reaction times between 0.25 and 120 hours. Chloramine decay model
does not have specified boundary conditions.</p>
</td></tr>
<tr><td><code id="chemdose_chlordecay_once_+3A_treatment">treatment</code></td>
<td>
<p>Type of treatment applied to the water. Options include &quot;raw&quot; for no treatment (default), &quot;coag&quot; for
water that has been coagulated or softened.</p>
</td></tr>
<tr><td><code id="chemdose_chlordecay_once_+3A_cl_type">cl_type</code></td>
<td>
<p>Type of chlorination applied, either &quot;chlorine&quot; (default) or &quot;chloramine&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data input comes from a 'water' class column, as initialized in <code><a href="#topic+define_water_chain">define_water_chain</a></code>.
</p>
<p>If the input data frame has a chlorine dose column (cl2) or time column (time), the function will use those columns. Note:
The function can only take cl2 and time inputs as EITHER a column or as function arguments, not both.
</p>
<p>tidywater functions cannot be added after this function because they require a 'water' class input.
</p>
<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame with updated chlorine residuals.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+chemdose_chlordecay">chemdose_chlordecay</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;%
  mutate(br = 50) %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  chemdose_chlordecay_once(input_water = "balanced_water", cl2_dose = 4, time = 8)

example_df &lt;- water_df %&gt;%
  mutate(br = 50) %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  mutate(
    cl2_dose = seq(2, 24, 2),
    time = 30
  ) %&gt;%
  chemdose_chlordecay_once(input_water = "balanced_water")

example_df &lt;- water_df %&gt;%
  mutate(br = 80) %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  mutate(time = 8) %&gt;%
  chemdose_chlordecay_once(
    input_water = "balanced_water", cl2_dose = 6, treatment = "coag",
    cl_type = "chloramine"
  )

# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;%
  mutate(br = 50) %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  chemdose_chlordecay_once(input_water = "balanced_water", cl2_dose = 4, time = 8)

# Optional: explicitly close multisession processing
plan(sequential)


</code></pre>

<hr>
<h2 id='chemdose_dbp'>Calculate DBP formation</h2><span id='topic+chemdose_dbp'></span>

<h3>Description</h3>

<p><code>chemdose_dbp</code> calculates disinfection byproduct (DBP) formation based on the U.S. EPA's
Water Treatment Plant Model (U.S. EPA, 2001). Required arguments include an object of class &quot;water&quot;
created by <code><a href="#topic+define_water">define_water</a></code> chlorine dose, type, reaction time, and treatment applied (if any).
The function also requires additional water quality parameters defined in <code>define_water</code>
including bromide, TOC, UV254, temperature, and pH.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chemdose_dbp(
  water,
  cl2,
  time,
  treatment = "raw",
  cl_type = "chorine",
  location = "plant"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="chemdose_dbp_+3A_water">water</code></td>
<td>
<p>Source water object of class &quot;water&quot; created by <code><a href="#topic+define_water">define_water</a></code></p>
</td></tr>
<tr><td><code id="chemdose_dbp_+3A_cl2">cl2</code></td>
<td>
<p>Applied chlorine dose (mg/L as Cl2). Model results are valid for doses between 1.51 and 33.55 mg/L.</p>
</td></tr>
<tr><td><code id="chemdose_dbp_+3A_time">time</code></td>
<td>
<p>Reaction time (hours). Model results are valid for reaction times between 2 and 168 hours.</p>
</td></tr>
<tr><td><code id="chemdose_dbp_+3A_treatment">treatment</code></td>
<td>
<p>Type of treatment applied to the water. Options include &quot;raw&quot; for no treatment (default), &quot;coag&quot; for
water that has been coagulated or softened, and &quot;gac&quot; for water that has been treated by granular activated carbon (GAC).
GAC treatment has also been used for estimating formation after membrane treatment with good results.</p>
</td></tr>
<tr><td><code id="chemdose_dbp_+3A_cl_type">cl_type</code></td>
<td>
<p>Type of chlorination applied, either &quot;chlorine&quot; (default) or &quot;chloramine&quot;.</p>
</td></tr>
<tr><td><code id="chemdose_dbp_+3A_location">location</code></td>
<td>
<p>Location for DBP formation, either in the &quot;plant&quot; (default), or in the distributions system, &quot;ds&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function will calculate haloacetic acids (HAA) as HAA5, and total trihalomethanes (TTHM).
Use <code>summarise_wq</code> to quickly tabulate the results.
</p>


<h3>Value</h3>

<p>A water class object with predicted DBP concentrations.
</p>


<h3>Source</h3>

<p>TTHMs, raw: U.S. EPA (2001) equation 5-131
</p>
<p>HAAs, raw: U.S. EPA (2001) equation 5-134
</p>
<p>TTHMs, treated: U.S. EPA (2001) equation 5-139
</p>
<p>HAAs, treated: U.S. EPA (2001) equation 5-142
</p>
<p>See references list at: <a href="https://github.com/BrownandCaldwell-Public/tidywater/wiki/References">https://github.com/BrownandCaldwell-Public/tidywater/wiki/References</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>example_dbp &lt;- suppressWarnings(define_water(8, 20, 66, toc = 4, uv254 = .2, br = 50)) %&gt;%
  chemdose_dbp(cl2 = 2, time = 8)
example_dbp &lt;- suppressWarnings(define_water(7.5, 20, 66, toc = 4, uv254 = .2, br = 50)) %&gt;%
  chemdose_dbp(cl2 = 3, time = 168, treatment = "coag", location = "ds")

</code></pre>

<hr>
<h2 id='chemdose_dbp_chain'>Apply 'chemdose_dbp' within a data frame and output a column of 'water' class to be chained to other tidywater functions</h2><span id='topic+chemdose_dbp_chain'></span>

<h3>Description</h3>

<p>DBP = disinfection byproduct
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chemdose_dbp_chain(
  df,
  input_water = "defined_water",
  output_water = "disinfected_water",
  cl2 = 0,
  time = 0,
  treatment = "raw",
  cl_type = "chlorine",
  location = "plant"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="chemdose_dbp_chain_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already been computed using
<code><a href="#topic+define_water_chain">define_water_chain</a></code>. The df may include a column named for the applied chlorine dose (cl2),
and a column for time.</p>
</td></tr>
<tr><td><code id="chemdose_dbp_chain_+3A_input_water">input_water</code></td>
<td>
<p>name of the column of water class data to be used as the input for this function. Default is &quot;defined_water&quot;.</p>
</td></tr>
<tr><td><code id="chemdose_dbp_chain_+3A_output_water">output_water</code></td>
<td>
<p>name of the output column storing updated parameters with the class, water. Default is &quot;disinfected_water&quot;.</p>
</td></tr>
<tr><td><code id="chemdose_dbp_chain_+3A_cl2">cl2</code></td>
<td>
<p>Applied chlorine dose (mg/L as Cl2). Model results are valid for doses between 1.51 and 33.55 mg/L.</p>
</td></tr>
<tr><td><code id="chemdose_dbp_chain_+3A_time">time</code></td>
<td>
<p>Reaction time (hours). Model results are valid for reaction times between 2 and 168 hours.</p>
</td></tr>
<tr><td><code id="chemdose_dbp_chain_+3A_treatment">treatment</code></td>
<td>
<p>Type of treatment applied to the water. Options include &quot;raw&quot; for no treatment (default),
&quot;coag&quot; for water that has been coagulated or softened, and &quot;gac&quot; for water that has been treated by granular activated carbon (GAC).
GAC treatment has also been used for estimating formation after membrane treatment with good results.</p>
</td></tr>
<tr><td><code id="chemdose_dbp_chain_+3A_cl_type">cl_type</code></td>
<td>
<p>Type of chlorination applied, either &quot;chlorine&quot; (default) or &quot;chloramine&quot;.</p>
</td></tr>
<tr><td><code id="chemdose_dbp_chain_+3A_location">location</code></td>
<td>
<p>Location for DBP formation, either in the &quot;plant&quot; (default), or in the distribution system, &quot;ds&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function allows <code><a href="#topic+chemdose_dbp">chemdose_dbp</a></code> to be added to a piped data frame.
Its output is a 'water' class, and can therefore be used with &quot;downstream&quot; tidywater functions.
TTHM, HAA5, and individual DBP species will be updated based on the applied chlorine dose,
the reaction time, treatment type, chlorine type, and DBP formation location.
</p>
<p>The data input comes from a 'water' class column, as initialized in <code><a href="#topic+define_water">define_water</a></code> or <code><a href="#topic+balance_ions">balance_ions</a></code>.
</p>
<p>If the input data frame has a chlorine dose column (cl2) or time column (time), the function will use those columns. Note:
The function can only take cl2 and time inputs as EITHER a column or from the function arguments, not both.
</p>
<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame containing a water class column with predicted DBP concentrations.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+chemdose_dbp">chemdose_dbp</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;%
  mutate(br = 50) %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  chemdose_dbp_chain(input_water = "balanced_water", cl2 = 4, time = 8)

example_df &lt;- water_df %&gt;%
  mutate(br = 50) %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  mutate(
    cl2 = seq(2, 24, 2),
    time = 30
  ) %&gt;%
  chemdose_dbp_chain(input_water = "balanced_water")

example_df &lt;- water_df %&gt;%
  mutate(br = 80) %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  mutate(time = 8) %&gt;%
  chemdose_dbp_chain(
    input_water = "balanced_water", cl = 6, treatment = "coag",
    location = "ds", cl_type = "chloramine"
  )


# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;%
  mutate(br = 50) %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  chemdose_dbp_chain(input_water = "balanced_water", cl2 = 4, time = 8)

# Optional: explicitly close multisession processing
plan(sequential)


</code></pre>

<hr>
<h2 id='chemdose_dbp_once'>Apply 'chemdose_dbp'function within a data frame and output a data frame</h2><span id='topic+chemdose_dbp_once'></span>

<h3>Description</h3>

<p>DBP = disinfection byproduct
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chemdose_dbp_once(
  df,
  input_water = "defined_water",
  cl2 = 0,
  time = 0,
  treatment = "raw",
  cl_type = "chlorine",
  location = "plant"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="chemdose_dbp_once_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already been computed using
<code><a href="#topic+define_water_once">define_water_once</a></code>. The df may include a column named for the applied chlorine dose (cl2),
and a column for time.</p>
</td></tr>
<tr><td><code id="chemdose_dbp_once_+3A_input_water">input_water</code></td>
<td>
<p>name of the column of water class data to be used as the input for this function. Default is &quot;defined_water&quot;.</p>
</td></tr>
<tr><td><code id="chemdose_dbp_once_+3A_cl2">cl2</code></td>
<td>
<p>Applied chlorine dose (mg/L as Cl2). Model results are valid for doses between 1.51 and 33.55 mg/L.</p>
</td></tr>
<tr><td><code id="chemdose_dbp_once_+3A_time">time</code></td>
<td>
<p>Reaction time (hours). Model results are valid for reaction times between 2 and 168 hours.</p>
</td></tr>
<tr><td><code id="chemdose_dbp_once_+3A_treatment">treatment</code></td>
<td>
<p>Type of treatment applied to the water. Options include &quot;raw&quot; for no treatment (default),
&quot;coag&quot; for water that has been coagulated or softened, and &quot;gac&quot; for water that has been treated by granular activated carbon (GAC).
GAC treatment has also been used for estimating formation after membrane treatment with good results.</p>
</td></tr>
<tr><td><code id="chemdose_dbp_once_+3A_cl_type">cl_type</code></td>
<td>
<p>Type of chlorination applied, either &quot;chlorine&quot; (default) or &quot;chloramine&quot;.</p>
</td></tr>
<tr><td><code id="chemdose_dbp_once_+3A_location">location</code></td>
<td>
<p>Location for DBP formation, either in the &quot;plant&quot; (default), or in the distribution system, &quot;ds&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function allows <code><a href="#topic+chemdose_dbp">chemdose_dbp</a></code> to be added to a piped data frame.
Its output is a data frame containing columns for TTHM, HAA5, and individual DBP species.
DBPs are estimated based on the applied chlorine dose, the reaction time, treatment type, chlorine type, and DBP formation location.
</p>
<p>The data input comes from a 'water' class column, as initialized in <code><a href="#topic+define_water">define_water</a></code> or <code><a href="#topic+balance_ions">balance_ions</a></code>.
</p>
<p>If the input data frame has a chlorine dose column (cl2) or time column (time), the function will use those columns. Note:
The function can only take cl2 and time inputs as EITHER a column or from the function arguments, not both.
</p>
<p>tidywater functions cannot be added after this function because they require a 'water' class input.
</p>
<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame with predicted DBP concentrations.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+chemdose_dbp">chemdose_dbp</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;%
  mutate(br = 50) %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  chemdose_dbp_once(input_water = "balanced_water", cl2 = 4, time = 8)

example_df &lt;- water_df %&gt;%
  mutate(br = 50) %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  mutate(
    cl2 = seq(2, 24, 2),
    time = 30
  ) %&gt;%
  chemdose_dbp_once(input_water = "balanced_water")

example_df &lt;- water_df %&gt;%
  mutate(br = 80) %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  mutate(time = 8) %&gt;%
  chemdose_dbp_once(
    input_water = "balanced_water", cl = 6, treatment = "coag",
    location = "ds", cl_type = "chloramine"
  )

# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;%
  mutate(br = 50) %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  chemdose_dbp_once(input_water = "balanced_water", cl2 = 4, time = 8)

# Optional: explicitly close multisession processing
plan(sequential)


</code></pre>

<hr>
<h2 id='chemdose_f'>Calculate new fluoride concentration after dosing alum.</h2><span id='topic+chemdose_f'></span>

<h3>Description</h3>

<p>Applies equation of the form: raw_f - A*alum^a*ph ^ b * raw_f^c. There is no published model, so it is
recommended to fit the coefficients with experimental data. When fitting, the following units must be used:
Alum in mg/L as chemical, Fluoride in mg/L, pH in SU. Default coefficients are fit from Sollo et al (1978). This function
outputs a water class object with an updated fluoride concentration (which will be in M, per standard water units).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chemdose_f(water, alum, coeff = c(1.11, 0.628, -2.07, 0.861))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="chemdose_f_+3A_water">water</code></td>
<td>
<p>Source water object of class &quot;water&quot; created by <code><a href="#topic+define_water">define_water</a></code></p>
</td></tr>
<tr><td><code id="chemdose_f_+3A_alum">alum</code></td>
<td>
<p>Amount of hydrated aluminum sulfate added in mg/L: Al2(SO4)3*14H2O + 6HCO3 -&gt; 2Al(OH)3(am) +3SO4 + 14H2O + 6CO2</p>
</td></tr>
<tr><td><code id="chemdose_f_+3A_coeff">coeff</code></td>
<td>
<p>Model coefficients to use as vector of numbers.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A water class object with an updated fluoride concentration.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dosed_water &lt;- define_water(ph = 7, temp = 25, alk = 50, f = 4) %&gt;%
  chemdose_ph(alum = 50) %&gt;%
  chemdose_f(alum = 50)

convert_units(dosed_water@f, "f", "M", "mg/L")

</code></pre>

<hr>
<h2 id='chemdose_ph'>Calculate new pH and ion balance after chemical addition</h2><span id='topic+chemdose_ph'></span>

<h3>Description</h3>

<p><code>chemdose_ph</code> calculates the new pH, alkalinity, and ion balance of a water based on different chemical
additions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chemdose_ph(
  water,
  hcl = 0,
  h2so4 = 0,
  h3po4 = 0,
  co2 = 0,
  naoh = 0,
  caoh2 = 0,
  mgoh2 = 0,
  na2co3 = 0,
  nahco3 = 0,
  caco3 = 0,
  cacl2 = 0,
  cl2 = 0,
  naocl = 0,
  nh4oh = 0,
  nh42so4 = 0,
  alum = 0,
  ferricchloride = 0,
  ferricsulfate = 0,
  ach = 0,
  softening_correction = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="chemdose_ph_+3A_water">water</code></td>
<td>
<p>Source water object of class &quot;water&quot; created by <code><a href="#topic+define_water">define_water</a></code></p>
</td></tr>
<tr><td><code id="chemdose_ph_+3A_hcl">hcl</code></td>
<td>
<p>Amount of hydrochloric acid added in mg/L: HCl -&gt; H + Cl</p>
</td></tr>
<tr><td><code id="chemdose_ph_+3A_h2so4">h2so4</code></td>
<td>
<p>Amount of sulfuric acid added in mg/L: H2SO4 -&gt; 2H + SO4</p>
</td></tr>
<tr><td><code id="chemdose_ph_+3A_h3po4">h3po4</code></td>
<td>
<p>Amount of phosphoric acid added in mg/L: H3PO4 -&gt; 3H + PO4</p>
</td></tr>
<tr><td><code id="chemdose_ph_+3A_co2">co2</code></td>
<td>
<p>Amount of carbon dioxide added in mg/L: CO2 (gas) + H2O -&gt; H2CO3*</p>
</td></tr>
<tr><td><code id="chemdose_ph_+3A_naoh">naoh</code></td>
<td>
<p>Amount of caustic added in mg/L: NaOH -&gt; Na + OH</p>
</td></tr>
<tr><td><code id="chemdose_ph_+3A_caoh2">caoh2</code></td>
<td>
<p>Amount of lime added in mg/L: Ca(OH)2 -&gt; Ca + 2OH</p>
</td></tr>
<tr><td><code id="chemdose_ph_+3A_mgoh2">mgoh2</code></td>
<td>
<p>Amount of magneisum hydroxide added in mg/L: Mg(OH)2 -&gt; Mg + 2OH</p>
</td></tr>
<tr><td><code id="chemdose_ph_+3A_na2co3">na2co3</code></td>
<td>
<p>Amount of soda ash added in mg/L: Na2CO3 -&gt; 2Na + CO3</p>
</td></tr>
<tr><td><code id="chemdose_ph_+3A_nahco3">nahco3</code></td>
<td>
<p>Amount of sodium bicarbonate added in mg/L: NaHCO3 -&gt; Na + H + CO3</p>
</td></tr>
<tr><td><code id="chemdose_ph_+3A_caco3">caco3</code></td>
<td>
<p>Amount of calcium carbonate added (or removed) in mg/L: CaCO3 -&gt; Ca + CO3</p>
</td></tr>
<tr><td><code id="chemdose_ph_+3A_cacl2">cacl2</code></td>
<td>
<p>Amount of calcium chloride added in mg/L: CaCl2 -&gt; Ca2+ + 2Cl-</p>
</td></tr>
<tr><td><code id="chemdose_ph_+3A_cl2">cl2</code></td>
<td>
<p>Amount of chlorine gas added in mg/L as Cl2: Cl2(g) + H2O -&gt; HOCl + H + Cl</p>
</td></tr>
<tr><td><code id="chemdose_ph_+3A_naocl">naocl</code></td>
<td>
<p>Amount of sodium hypochlorite added in mg/L as Cl2: NaOCl -&gt; Na + OCl</p>
</td></tr>
<tr><td><code id="chemdose_ph_+3A_nh4oh">nh4oh</code></td>
<td>
<p>Amount of ammonium hydroxide added in mg/L as N: NH4OH -&gt; NH4 + OH</p>
</td></tr>
<tr><td><code id="chemdose_ph_+3A_nh42so4">nh42so4</code></td>
<td>
<p>Amount of ammonium sulfate added in mg/L as N: (NH4)2SO4 -&gt; 2NH4 + SO4</p>
</td></tr>
<tr><td><code id="chemdose_ph_+3A_alum">alum</code></td>
<td>
<p>Amount of hydrated aluminum sulfate added in mg/L: Al2(SO4)3*14H2O + 6HCO3 -&gt; 2Al(OH)3(am) +3SO4 + 14H2O + 6CO2</p>
</td></tr>
<tr><td><code id="chemdose_ph_+3A_ferricchloride">ferricchloride</code></td>
<td>
<p>Amount of ferric Chloride added in mg/L: FeCl3 + 3HCO3 -&gt; Fe(OH)3(am) + 3Cl + 3CO2</p>
</td></tr>
<tr><td><code id="chemdose_ph_+3A_ferricsulfate">ferricsulfate</code></td>
<td>
<p>Amount of ferric sulfate added in mg/L: Fe2(SO4)3*8.8H2O + 6HCO3 -&gt; 2Fe(OH)3(am) + 3SO4 + 8.8H2O + 6CO2</p>
</td></tr>
<tr><td><code id="chemdose_ph_+3A_ach">ach</code></td>
<td>
<p>Amount of aluminum chlorohydrate added in mg/L: Al2(OH)5Cl*2H2O + HCO3 -&gt; 2Al(OH)3(am) + Cl + 2H2O + CO2</p>
</td></tr>
<tr><td><code id="chemdose_ph_+3A_softening_correction">softening_correction</code></td>
<td>
<p>Set to TRUE to correct post-softening pH (caco3 must be &lt; 0). Default is FALSE. Based on WTP model equation 5-62</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function takes an object of class &quot;water&quot; created by <code><a href="#topic+define_water">define_water</a></code> and user-specified
chemical additions and returns a new object of class &quot;water&quot; with updated water quality.
Units of all chemical additions are in mg/L as chemical (not as product).
</p>
<p><code>chemdose_ph</code> works by evaluating all the user-specified chemical additions and solving for what the new pH
must be using <code>uniroot</code> to satisfy the principle of electroneutrality in pure water while correcting for the existing alkalinity
of the water that the chemical is added to. Multiple chemicals can be added simultaneously or each addition can be
modeled independently through sequential doses.
</p>


<h3>Value</h3>

<p>A water class object with updated pH, alkalinity, and ions post-chemical addition.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+define_water">define_water</a></code>, <code><a href="#topic+convert_units">convert_units</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>water &lt;- define_water(ph = 7, temp = 25, alk = 10)
# Dose 1 mg/L of hydrochloric acid
dosed_water &lt;- chemdose_ph(water, hcl = 1)
dosed_water@ph

# Dose 1 mg/L of hydrochloric acid and 5 mg/L of alum simultaneously
dosed_water &lt;- chemdose_ph(water, hcl = 1, alum = 5)
dosed_water@ph

# Dose 1 mg/L of hydrochloric acid and 5 mg/L of alum sequentially
dosed_water1 &lt;- chemdose_ph(water, hcl = 1)
dosed_water1@ph
dosed_water2 &lt;- chemdose_ph(dosed_water1, alum = 5)
dosed_water2@ph

# Softening:
water2 &lt;- define_water(ph = 7, temp = 25, alk = 100, tot_hard = 350)
dosed_water1 &lt;- chemdose_ph(water2, caco3 = -100)
dosed_water1@ph
dosed_water2 &lt;- chemdose_ph(water2, caco3 = -100, softening_correction = TRUE)
dosed_water2@ph

</code></pre>

<hr>
<h2 id='chemdose_ph_chain'>Apply 'chemdose_ph' within a dataframe and output a column of 'water' class to be chained to other tidywater functions</h2><span id='topic+chemdose_ph_chain'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+chemdose_ph">chemdose_ph</a></code> to be added to a piped data frame.
Its output is a 'water' class, and can therefore be used with &quot;downstream&quot; tidywater functions.
Ions and pH will be updated based on input chemical doses.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chemdose_ph_chain(
  df,
  input_water = "defined_water",
  output_water = "dosed_chem_water",
  hcl = 0,
  h2so4 = 0,
  h3po4 = 0,
  co2 = 0,
  naoh = 0,
  na2co3 = 0,
  nahco3 = 0,
  caoh2 = 0,
  mgoh2 = 0,
  cl2 = 0,
  naocl = 0,
  nh4oh = 0,
  nh42so4 = 0,
  alum = 0,
  ferricchloride = 0,
  ferricsulfate = 0,
  ach = 0,
  caco3 = 0
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="chemdose_ph_chain_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already been computed using
<code><a href="#topic+define_water_chain">define_water_chain</a></code>. The df may include columns named for the chemical(s) being dosed.</p>
</td></tr>
<tr><td><code id="chemdose_ph_chain_+3A_input_water">input_water</code></td>
<td>
<p>name of the column of water class data to be used as the input for this function. Default is &quot;defined_water&quot;.</p>
</td></tr>
<tr><td><code id="chemdose_ph_chain_+3A_output_water">output_water</code></td>
<td>
<p>name of the output column storing updated parameters with the class, water. Default is &quot;dosed_chem_water&quot;.</p>
</td></tr>
<tr><td><code id="chemdose_ph_chain_+3A_hcl">hcl</code></td>
<td>
<p>Hydrochloric acid: HCl -&gt; H + Cl</p>
</td></tr>
<tr><td><code id="chemdose_ph_chain_+3A_h2so4">h2so4</code></td>
<td>
<p>Sulfuric acid: H2SO4 -&gt; 2H + SO4</p>
</td></tr>
<tr><td><code id="chemdose_ph_chain_+3A_h3po4">h3po4</code></td>
<td>
<p>Phosphoric acid: H3PO4 -&gt; 3H + PO4</p>
</td></tr>
<tr><td><code id="chemdose_ph_chain_+3A_co2">co2</code></td>
<td>
<p>Carbon Dioxide CO2 (gas) + H2O -&gt; H2CO3*</p>
</td></tr>
<tr><td><code id="chemdose_ph_chain_+3A_naoh">naoh</code></td>
<td>
<p>Caustic: NaOH -&gt; Na + OH</p>
</td></tr>
<tr><td><code id="chemdose_ph_chain_+3A_na2co3">na2co3</code></td>
<td>
<p>Soda ash: Na2CO3 -&gt; 2Na + CO3</p>
</td></tr>
<tr><td><code id="chemdose_ph_chain_+3A_nahco3">nahco3</code></td>
<td>
<p>Sodium bicarbonate: NaHCO3 -&gt; Na + H + CO3</p>
</td></tr>
<tr><td><code id="chemdose_ph_chain_+3A_caoh2">caoh2</code></td>
<td>
<p>Lime: Ca(OH)2 -&gt; Ca + 2OH</p>
</td></tr>
<tr><td><code id="chemdose_ph_chain_+3A_mgoh2">mgoh2</code></td>
<td>
<p>Magneisum hydroxide: Mg(OH)2 -&gt; Mg + 2OH</p>
</td></tr>
<tr><td><code id="chemdose_ph_chain_+3A_cl2">cl2</code></td>
<td>
<p>Chlorine gas: Cl2(g) + H2O -&gt; HOCl + H + Cl</p>
</td></tr>
<tr><td><code id="chemdose_ph_chain_+3A_naocl">naocl</code></td>
<td>
<p>Sodium hypochlorite: NaOCl -&gt; Na + OCl</p>
</td></tr>
<tr><td><code id="chemdose_ph_chain_+3A_nh4oh">nh4oh</code></td>
<td>
<p>Amount of ammonium hydroxide added in mg/L as N: NH4OH -&gt; NH4 + OH</p>
</td></tr>
<tr><td><code id="chemdose_ph_chain_+3A_nh42so4">nh42so4</code></td>
<td>
<p>Amount of ammonium sulfate added in mg/L as N: (NH4)2SO4 -&gt; 2NH4 + SO4</p>
</td></tr>
<tr><td><code id="chemdose_ph_chain_+3A_alum">alum</code></td>
<td>
<p>Hydrated aluminum sulfate Al2(SO4)3*14H2O + 6HCO3 -&gt; 2Al(OH)3(am) +3SO4 + 14H2O + 6CO2</p>
</td></tr>
<tr><td><code id="chemdose_ph_chain_+3A_ferricchloride">ferricchloride</code></td>
<td>
<p>Ferric Chloride FeCl3 + 3HCO3 -&gt; Fe(OH)3(am) + 3Cl + 3CO2</p>
</td></tr>
<tr><td><code id="chemdose_ph_chain_+3A_ferricsulfate">ferricsulfate</code></td>
<td>
<p>Amount of ferric sulfate added in mg/L: Fe2(SO4)3*8.8H2O + 6HCO3 -&gt; 2Fe(OH)3(am) + 3SO4 + 8.8H2O + 6CO2</p>
</td></tr>
<tr><td><code id="chemdose_ph_chain_+3A_ach">ach</code></td>
<td>
<p>Amount of aluminum chlorohydrate added in mg/L: Al2(OH)5Cl*2H2O + HCO3 -&gt; 2Al(OH)3(am) + Cl + 2H2O + CO2</p>
</td></tr>
<tr><td><code id="chemdose_ph_chain_+3A_caco3">caco3</code></td>
<td>
<p>Amount of calcium carbonate added (or removed) in mg/L: CaCO3 -&gt; Ca + CO3</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data input comes from a 'water' class column, as initialized in <code><a href="#topic+define_water">define_water</a></code> or <code><a href="#topic+balance_ions">balance_ions</a></code>.
</p>
<p>If the input data frame has a column(s) name matching a valid chemical(s), the function will dose that chemical(s) in addition to the
ones specified in the function's arguments.
The column names must match the chemical names as displayed in <code><a href="#topic+chemdose_ph">chemdose_ph</a></code>.
To see which chemicals can be passed into the function, see <code><a href="#topic+chemdose_ph">chemdose_ph</a></code>.
</p>
<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame containing a water class column with updated pH, alkalinity, and ions post-chemical addition.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+chemdose_ph">chemdose_ph</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  chemdose_ph_chain(input_water = "balanced_water", naoh = 5)

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  mutate(
    hcl = seq(1, 12, 1),
    naoh = 20
  ) %&gt;%
  chemdose_ph_chain(input_water = "balanced_water", mgoh2 = 55, co2 = 4)

# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  chemdose_ph_chain(input_water = "balanced_water", naoh = 5)

# Optional: explicitly close multisession processing
plan(sequential)

</code></pre>

<hr>
<h2 id='chemdose_ph_once'>Apply 'chemdose_ph' function and output a dataframe</h2><span id='topic+chemdose_ph_once'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+chemdose_ph">chemdose_ph</a></code> to be added to a piped data frame.
Its output is a data frame with updated ions and pH.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chemdose_ph_once(
  df,
  input_water = "defined_water",
  hcl = 0,
  h2so4 = 0,
  h3po4 = 0,
  co2 = 0,
  naoh = 0,
  na2co3 = 0,
  nahco3 = 0,
  caoh2 = 0,
  mgoh2 = 0,
  cl2 = 0,
  naocl = 0,
  nh4oh = 0,
  nh42so4 = 0,
  alum = 0,
  ferricchloride = 0,
  ferricsulfate = 0,
  ach = 0,
  caco3 = 0
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="chemdose_ph_once_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already been computed using
<code><a href="#topic+define_water_chain">define_water_chain</a></code>. The df may include columns named for the chemical(s) being dosed.</p>
</td></tr>
<tr><td><code id="chemdose_ph_once_+3A_input_water">input_water</code></td>
<td>
<p>name of the column of water class data to be used as the input for this function. Default is &quot;defined_water&quot;.</p>
</td></tr>
<tr><td><code id="chemdose_ph_once_+3A_hcl">hcl</code></td>
<td>
<p>Hydrochloric acid: HCl -&gt; H + Cl</p>
</td></tr>
<tr><td><code id="chemdose_ph_once_+3A_h2so4">h2so4</code></td>
<td>
<p>Sulfuric acid: H2SO4 -&gt; 2H + SO4</p>
</td></tr>
<tr><td><code id="chemdose_ph_once_+3A_h3po4">h3po4</code></td>
<td>
<p>Phosphoric acid: H3PO4 -&gt; 3H + PO4</p>
</td></tr>
<tr><td><code id="chemdose_ph_once_+3A_co2">co2</code></td>
<td>
<p>Carbon Dioxide CO2 (gas) + H2O -&gt; H2CO3*</p>
</td></tr>
<tr><td><code id="chemdose_ph_once_+3A_naoh">naoh</code></td>
<td>
<p>Caustic: NaOH -&gt; Na + OH</p>
</td></tr>
<tr><td><code id="chemdose_ph_once_+3A_na2co3">na2co3</code></td>
<td>
<p>Soda ash: Na2CO3 -&gt; 2Na + CO3</p>
</td></tr>
<tr><td><code id="chemdose_ph_once_+3A_nahco3">nahco3</code></td>
<td>
<p>Sodium bicarbonate: NaHCO3 -&gt; Na + H + CO3</p>
</td></tr>
<tr><td><code id="chemdose_ph_once_+3A_caoh2">caoh2</code></td>
<td>
<p>Lime: Ca(OH)2 -&gt; Ca + 2OH</p>
</td></tr>
<tr><td><code id="chemdose_ph_once_+3A_mgoh2">mgoh2</code></td>
<td>
<p>Magneisum hydroxide: Mg(OH)2 -&gt; Mg + 2OH</p>
</td></tr>
<tr><td><code id="chemdose_ph_once_+3A_cl2">cl2</code></td>
<td>
<p>Chlorine gas: Cl2(g) + H2O -&gt; HOCl + H + Cl</p>
</td></tr>
<tr><td><code id="chemdose_ph_once_+3A_naocl">naocl</code></td>
<td>
<p>Sodium hypochlorite: NaOCl -&gt; Na + OCl</p>
</td></tr>
<tr><td><code id="chemdose_ph_once_+3A_nh4oh">nh4oh</code></td>
<td>
<p>Amount of ammonium hydroxide added in mg/L as N: NH4OH -&gt; NH4 + OH</p>
</td></tr>
<tr><td><code id="chemdose_ph_once_+3A_nh42so4">nh42so4</code></td>
<td>
<p>Amount of ammonium sulfate added in mg/L as N: (NH4)2SO4 -&gt; 2NH4 + SO4</p>
</td></tr>
<tr><td><code id="chemdose_ph_once_+3A_alum">alum</code></td>
<td>
<p>Hydrated aluminum sulfate Al2(SO4)3*14H2O + 6HCO3 -&gt; 2Al(OH)3(am) +3SO4 + 14H2O + 6CO2</p>
</td></tr>
<tr><td><code id="chemdose_ph_once_+3A_ferricchloride">ferricchloride</code></td>
<td>
<p>Ferric Chloride FeCl3 + 3HCO3 -&gt; Fe(OH)3(am) + 3Cl + 3CO2</p>
</td></tr>
<tr><td><code id="chemdose_ph_once_+3A_ferricsulfate">ferricsulfate</code></td>
<td>
<p>Amount of ferric sulfate added in mg/L: Fe2(SO4)3*8.8H2O + 6HCO3 -&gt; 2Fe(OH)3(am) + 3SO4 + 8.8H2O + 6CO2</p>
</td></tr>
<tr><td><code id="chemdose_ph_once_+3A_ach">ach</code></td>
<td>
<p>Amount of aluminum chlorohydrate added in mg/L: Al2(OH)5Cl*2H2O + HCO3 -&gt; 2Al(OH)3(am) + Cl + 2H2O + CO2</p>
</td></tr>
<tr><td><code id="chemdose_ph_once_+3A_caco3">caco3</code></td>
<td>
<p>Amount of calcium carbonate added (or removed) in mg/L: CaCO3 -&gt; Ca + CO3</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data input comes from a 'water' class column, as initialized in <code><a href="#topic+define_water">define_water</a></code> or <code><a href="#topic+balance_ions">balance_ions</a></code>.
</p>
<p>If the input data frame has a column(s) name matching a valid chemical(s), the function will dose that chemical(s) in addition to the
ones specified in the function's arguments.
The column names must match the chemical names as displayed in <code><a href="#topic+chemdose_ph">chemdose_ph</a></code>.
To see which chemicals can be passed into the function, see <code><a href="#topic+chemdose_ph">chemdose_ph</a></code>.
</p>
<p>tidywater functions cannot be added after this function because they require a 'water' class input.
</p>
<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame with updated pH, alkalinity, and ions post-chemical addition.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+chemdose_ph">chemdose_ph</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  chemdose_ph_once(input_water = "balanced_water", naoh = 5)

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  mutate(
    hcl = seq(1, 12, 1),
    naoh = 20
  ) %&gt;%
  chemdose_ph_once(input_water = "balanced_water", mgoh2 = 55, co2 = 4)

# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  chemdose_ph_once(input_water = "balanced_water", naoh = 5)

# Optional: explicitly close multisession processing
plan(sequential)

</code></pre>

<hr>
<h2 id='chemdose_toc'>Determine TOC removal from coagulation</h2><span id='topic+chemdose_toc'></span>

<h3>Description</h3>

<p>This function applies the Edwards (1997) model to a water created by <code><a href="#topic+define_water">define_water</a></code> to determine coagulated
DOC. Coagulated UVA is from U.S. EPA (2001) equation 5-80. Note that the models rely on pH of coagulation. If
only raw water pH is known, utilize <code><a href="#topic+chemdose_ph">chemdose_ph</a></code> first.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chemdose_toc(
  water,
  alum = 0,
  ferricchloride = 0,
  ferricsulfate = 0,
  coeff = "Alum"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="chemdose_toc_+3A_water">water</code></td>
<td>
<p>Source water object of class &quot;water&quot; created by <code><a href="#topic+define_water">define_water</a></code>. Water must include ph, doc, and uv254</p>
</td></tr>
<tr><td><code id="chemdose_toc_+3A_alum">alum</code></td>
<td>
<p>Amount of hydrated aluminum sulfate added in mg/L: Al2(SO4)3*14H2O + 6HCO3 -&gt; 2Al(OH)3(am) +3SO4 + 14H2O + 6CO2</p>
</td></tr>
<tr><td><code id="chemdose_toc_+3A_ferricchloride">ferricchloride</code></td>
<td>
<p>Amount of ferric chloride added in mg/L: FeCl3 + 3HCO3 -&gt; Fe(OH)3(am) + 3Cl + 3CO2</p>
</td></tr>
<tr><td><code id="chemdose_toc_+3A_ferricsulfate">ferricsulfate</code></td>
<td>
<p>Amount of ferric sulfate added in mg/L: Fe2(SO4)3*8.8H2O + 6HCO3 -&gt; 2Fe(OH)3(am) + 3SO4 + 8.8H2O + 6CO2</p>
</td></tr>
<tr><td><code id="chemdose_toc_+3A_coeff">coeff</code></td>
<td>
<p>String specifying the Edwards coefficients to be used from &quot;Alum&quot;, &quot;Ferric&quot;, &quot;General Alum&quot;, &quot;General Ferric&quot;, or &quot;Low DOC&quot; or
named vector of coefficients, which must include: k1, k2, x1, x2, x3, b</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A water class object with an updated DOC, TOC, and UV254 concentration.
</p>


<h3>Source</h3>

<p>Edwards (1997)
</p>
<p>U.S. EPA (2001)
</p>
<p>See reference list at: <a href="https://github.com/BrownandCaldwell-Public/tidywater/wiki/References">https://github.com/BrownandCaldwell-Public/tidywater/wiki/References</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+chemdose_ph">chemdose_ph</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>water &lt;- define_water(ph = 7, temp = 25, alk = 100, toc = 3.7, doc = 3.5, uv254 = .1)
dosed_water &lt;- chemdose_ph(water, alum = 30) %&gt;%
  chemdose_toc(alum = 30, coeff = "Alum")

dosed_water &lt;- chemdose_ph(water, ferricsulfate = 30) %&gt;%
  chemdose_toc(ferricsulfate = 30, coeff = "Ferric")

dosed_water &lt;- chemdose_ph(water, alum = 10, h2so4 = 10) %&gt;%
  chemdose_toc(alum = 10, coeff = c(
    "x1" = 280, "x2" = -73.9, "x3" = 4.96,
    "k1" = -0.028, "k2" = 0.23, "b" = 0.068
  ))

</code></pre>

<hr>
<h2 id='chemdose_toc_chain'>Apply 'chemdose_toc' within a dataframe and output a column of 'water' class to be chained to other tidywater functions</h2><span id='topic+chemdose_toc_chain'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+chemdose_toc">chemdose_toc</a></code> to be added to a piped data frame.
Its output is a 'water' class, and can therefore be used with &quot;downstream&quot; tidywater functions.
TOC, DOC, and UV254 will be updated based on input chemical doses.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chemdose_toc_chain(
  df,
  input_water = "defined_water",
  output_water = "coagulated_water",
  alum = 0,
  ferricchloride = 0,
  ferricsulfate = 0,
  coeff = "Alum"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="chemdose_toc_chain_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already been computed using
<code><a href="#topic+define_water_chain">define_water_chain</a></code>. The df may include a column named for the coagulant being dosed,
and a column named for the set of coefficients to use.</p>
</td></tr>
<tr><td><code id="chemdose_toc_chain_+3A_input_water">input_water</code></td>
<td>
<p>name of the column of Water class data to be used as the input for this function. Default is &quot;defined_water&quot;.</p>
</td></tr>
<tr><td><code id="chemdose_toc_chain_+3A_output_water">output_water</code></td>
<td>
<p>name of the output column storing updated parameters with the class, Water. Default is &quot;coagulated_water&quot;.</p>
</td></tr>
<tr><td><code id="chemdose_toc_chain_+3A_alum">alum</code></td>
<td>
<p>Hydrated aluminum sulfate Al2(SO4)3*14H2O + 6HCO3 -&gt; 2Al(OH)3(am) +3SO4 + 14H2O + 6CO2</p>
</td></tr>
<tr><td><code id="chemdose_toc_chain_+3A_ferricchloride">ferricchloride</code></td>
<td>
<p>Ferric Chloride FeCl3 + 3HCO3 -&gt; Fe(OH)3(am) + 3Cl + 3CO2</p>
</td></tr>
<tr><td><code id="chemdose_toc_chain_+3A_ferricsulfate">ferricsulfate</code></td>
<td>
<p>Amount of ferric sulfate added in mg/L: Fe2(SO4)3*8.8H2O + 6HCO3 -&gt; 2Fe(OH)3(am) + 3SO4 + 8.8H2O + 6CO2</p>
</td></tr>
<tr><td><code id="chemdose_toc_chain_+3A_coeff">coeff</code></td>
<td>
<p>String specifying the Edwards coefficients to be used from &quot;Alum&quot;, &quot;Ferric&quot;, &quot;General Alum&quot;, &quot;General Ferric&quot;, or &quot;Low DOC&quot; or
named vector of coefficients, which must include: k1, k2, x1, x2, x3, b</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data input comes from a 'water' class column, as initialized in <code><a href="#topic+define_water">define_water</a></code> or <code><a href="#topic+balance_ions">balance_ions</a></code>.
</p>
<p>If the input data frame has a coagulant(s) name matching a valid coagulant(s), the function will dose that coagulant(s). Note:
The function can only dose a coagulant either a column or from the function arguments, not both.
</p>
<p>The column names must match the chemical names as displayed in <code><a href="#topic+chemdose_toc">chemdose_toc</a></code>.
To see which chemicals can be passed into the function, see <code><a href="#topic+chemdose_toc">chemdose_toc</a></code>.
</p>
<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame containing a water class column with updated DOC, TOC, and UV254 concentrations.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+chemdose_toc">chemdose_toc</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  chemdose_ph_chain(alum = 30) %&gt;%
  chemdose_toc_chain(input_water = "dosed_chem_water")

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  mutate(
    ferricchloride = seq(1, 12, 1),
    coeff = "Ferric"
  ) %&gt;%
  chemdose_toc_chain(input_water = "balanced_water")

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  chemdose_toc_chain(input_water = "balanced_water", alum = 40, coeff = "General Alum")

# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  mutate(ferricchloride = seq(1, 12, 1)) %&gt;%
  chemdose_toc_chain(input_water = "balanced_water", coeff = "Ferric")

# Optional: explicitly close multisession processing
plan(sequential)

</code></pre>

<hr>
<h2 id='chemdose_toc_once'>Apply 'chemdose_toc' function and output a data frame</h2><span id='topic+chemdose_toc_once'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+chemdose_toc">chemdose_toc</a></code> to be added to a piped data frame.
Its output is a data frame with updated TOC, DOC, and UV254.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chemdose_toc_once(
  df,
  input_water = "defined_water",
  alum = 0,
  ferricchloride = 0,
  ferricsulfate = 0,
  coeff = "Alum"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="chemdose_toc_once_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already been computed using
<code><a href="#topic+define_water_chain">define_water_chain</a></code>. The df may include a column named for the coagulant being dosed,
and a column named for the set of coefficients to use.</p>
</td></tr>
<tr><td><code id="chemdose_toc_once_+3A_input_water">input_water</code></td>
<td>
<p>name of the column of Water class data to be used as the input for this function. Default is &quot;defined_water&quot;.</p>
</td></tr>
<tr><td><code id="chemdose_toc_once_+3A_alum">alum</code></td>
<td>
<p>Hydrated aluminum sulfate Al2(SO4)3*14H2O + 6HCO3 -&gt; 2Al(OH)3(am) +3SO4 + 14H2O + 6CO2</p>
</td></tr>
<tr><td><code id="chemdose_toc_once_+3A_ferricchloride">ferricchloride</code></td>
<td>
<p>Ferric Chloride FeCl3 + 3HCO3 -&gt; Fe(OH)3(am) + 3Cl + 3CO2</p>
</td></tr>
<tr><td><code id="chemdose_toc_once_+3A_ferricsulfate">ferricsulfate</code></td>
<td>
<p>Amount of ferric sulfate added in mg/L: Fe2(SO4)3*8.8H2O + 6HCO3 -&gt; 2Fe(OH)3(am) + 3SO4 + 8.8H2O + 6CO2</p>
</td></tr>
<tr><td><code id="chemdose_toc_once_+3A_coeff">coeff</code></td>
<td>
<p>String specifying the Edwards coefficients to be used from &quot;Alum&quot;, &quot;Ferric&quot;, &quot;General Alum&quot;, &quot;General Ferric&quot;, or &quot;Low DOC&quot; or
named vector of coefficients, which must include: k1, k2, x1, x2, x3, b</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data input comes from a 'water' class column, as initialized in <code><a href="#topic+define_water">define_water</a></code> or <code><a href="#topic+balance_ions">balance_ions</a></code>.
</p>
<p>If the input data frame has a column(s) name matching a valid coagulant(s), the function will dose that coagulant(s). Note:
The function can only dose a coagulant as either a column or from the function arguments, not both.
</p>
<p>The column names must match the coagulant names as displayed in <code><a href="#topic+chemdose_toc">chemdose_toc</a></code>.
To see which coagulants can be passed into the function, see <code><a href="#topic+chemdose_toc">chemdose_toc</a></code>.
</p>
<p>tidywater functions cannot be added after this function because they require a 'water' class input.
</p>
<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame with an updated DOC, TOC, and UV254 concentration.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+chemdose_toc">chemdose_toc</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  chemdose_ph_chain(alum = 30) %&gt;%
  chemdose_toc_once(input_water = "dosed_chem_water")

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  mutate(
    ferricchloride = seq(1, 12, 1),
    coeff = "Ferric"
  ) %&gt;%
  chemdose_toc_once(input_water = "balanced_water")

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  chemdose_toc_once(input_water = "balanced_water", alum = 40, coeff = "General Alum")

# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  mutate(ferricchloride = seq(1, 12, 1)) %&gt;%
  chemdose_toc_once(input_water = "balanced_water", coeff = "Ferric")

# Optional: explicitly close multisession processing
plan(sequential)

</code></pre>

<hr>
<h2 id='chloramine_conv'>Data frame of conversion factors for estimating DBP formation from chloramines</h2><span id='topic+chloramine_conv'></span>

<h3>Description</h3>

<p>A dataset containing conversion factors for calculating DBP formation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chloramine_conv
</code></pre>


<h3>Format</h3>

<p>A dataframe with 17 rows and 3 columns
</p>

<dl>
<dt>ID</dt><dd><p>abbreviation of dbp species</p>
</dd>
<dt>alias</dt><dd><p>full name of dbp species</p>
</dd>
<dt>percent</dt><dd><p>specifies the percent of DBP formation predicted from chloramines compared to chlorine, assuming the same chlorine dose applied</p>
</dd>
</dl>



<h3>Source</h3>

<p>U.S. EPA (2001), Table 5-10
</p>
<p>See references list at: <a href="https://github.com/BrownandCaldwell-Public/tidywater/wiki/References">https://github.com/BrownandCaldwell-Public/tidywater/wiki/References</a>
</p>

<hr>
<h2 id='cl2coeffs'>Data frame of Cl2 decay coefficients</h2><span id='topic+cl2coeffs'></span>

<h3>Description</h3>

<p>A dataset containing coefficients for calculating Cl2 decay
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cl2coeffs
</code></pre>


<h3>Format</h3>

<p>A dataframe with 3 rows and 4 columns
</p>

<dl>
<dt>treatment</dt><dd><p>Specifies the treatment applied to the water</p>
</dd>
<dt>a</dt><dd><p>Coefficient in chlorine decay model, associated with chlorine dose and time</p>
</dd>
<dt>b</dt><dd><p>Coefficient in chlorine decay model, associated with chlorine dose &amp; organics</p>
</dd>
<dt>c</dt><dd><p>Exponent in chlorine decay model, associated with chlorine dose &amp; organics</p>
</dd>
</dl>



<h3>Source</h3>

<p>U.S. EPA (2001)
</p>

<hr>
<h2 id='convert_units'>Calculate unit conversions for common compounds</h2><span id='topic+convert_units'></span>

<h3>Description</h3>

<p>This function takes a value and converts units based on compound name.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>convert_units(value, formula, startunit = "mg/L", endunit = "M")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="convert_units_+3A_value">value</code></td>
<td>
<p>Value to be converted</p>
</td></tr>
<tr><td><code id="convert_units_+3A_formula">formula</code></td>
<td>
<p>Chemical formula of compound. Accepts compounds in mweights for conversions between g and mol or eq</p>
</td></tr>
<tr><td><code id="convert_units_+3A_startunit">startunit</code></td>
<td>
<p>Units of current value, currently accepts g/L; g/L CaCO3; g/L N; M; eq/L;
and the same units with &quot;m&quot;, &quot;u&quot;, &quot;n&quot; prefixes</p>
</td></tr>
<tr><td><code id="convert_units_+3A_endunit">endunit</code></td>
<td>
<p>Desired units, currently accepts same as start units</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric value for the converted parameter.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>convert_units(50, "ca") # converts from mg/L to M by default
convert_units(50, "ca", "mg/L", "mg/L CaCO3")
convert_units(50, "ca", startunit = "mg/L", endunit = "eq/L")

</code></pre>

<hr>
<h2 id='convert_water'>Convert 'water' class object to a dataframe</h2><span id='topic+convert_water'></span>

<h3>Description</h3>

<p>This converts a 'water' class to a dataframe with individual columns for each slot (water quality parameter) in the 'water'.
This is useful for one-off checks and is applied in all 'fn_once' tidywater functions. For typical applications,
there may be a 'fn_once' tidywater function that provides a more efficient solution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>convert_water(water)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="convert_water_+3A_water">water</code></td>
<td>
<p>A water class object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame containing columns for all non-NA water slots.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+define_water">define_water</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(tidyr)

# Generates 1 row dataframe
example_df &lt;- define_water(ph = 7, temp = 20, alk = 100) %&gt;%
  convert_water()

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  mutate(to_dataframe = map(defined_water, convert_water)) %&gt;%
  unnest(to_dataframe) %&gt;%
  select(-defined_water)

</code></pre>

<hr>
<h2 id='convert_watermg'>Convert a 'water' class object to a dataframe with ions in mg/L or ug/L</h2><span id='topic+convert_watermg'></span>

<h3>Description</h3>

<p>This function is the same as <code><a href="#topic+convert_water">convert_water</a></code> except it converts the units of following slots from
M to mg/L: na, ca, mg, k, cl, so4, hco3, co3, h2po4, hpo4, po4, ocl, bro3, f, fe, al.  These slots are converted to
ug/L: br, mn.  All other values remain unchanged.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>convert_watermg(water)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="convert_watermg_+3A_water">water</code></td>
<td>
<p>A water class object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame containing columns for all non-NA water slots with ions in mg/L.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>water_defined &lt;- define_water(7, 20, 50, 100, 80, 10, 10, 10, 10, tot_po4 = 1) %&gt;%
  convert_watermg()

</code></pre>

<hr>
<h2 id='dbp_correction'>Data frame of correction factors for estimating DBP formation as a function of location</h2><span id='topic+dbp_correction'></span>

<h3>Description</h3>

<p>A dataset containing correction factors for calculating DBP formation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dbp_correction
</code></pre>


<h3>Format</h3>

<p>A dataframe with 17 rows and 4 columns
</p>

<dl>
<dt>ID</dt><dd><p>abbreviation of dbp species</p>
</dd>
<dt>alias</dt><dd><p>full name of dbp species</p>
</dd>
<dt>plant</dt><dd><p>specifies the correction factor for modelling DBP formation within a treatment plant</p>
</dd>
<dt>ds</dt><dd><p>specifies the correction factor for modelling DBP formation within the distribution system</p>
</dd>
</dl>



<h3>Source</h3>

<p>U.S. EPA (2001), Table 5-7
</p>
<p>See references list at: <a href="https://github.com/BrownandCaldwell-Public/tidywater/wiki/References">https://github.com/BrownandCaldwell-Public/tidywater/wiki/References</a>
</p>

<hr>
<h2 id='dbpcoeffs'>Data frame of DBP coefficients for predicting DBP formation</h2><span id='topic+dbpcoeffs'></span>

<h3>Description</h3>

<p>A dataset containing coefficients for calculating DBP formation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dbpcoeffs
</code></pre>


<h3>Format</h3>

<p>A dataframe with 30 rows and 10 columns
</p>

<dl>
<dt>ID</dt><dd><p>abbreviation of dbp species</p>
</dd>
<dt>alias</dt><dd><p>full name of dbp species</p>
</dd>
<dt>water_type</dt><dd><p>specifies which model the constants apply to, either treated or untreated water</p>
</dd>
<dt>A</dt><dd><p>First coefficient in DBP model</p>
</dd>
<dt>a</dt><dd><p>Second coefficient in DBP model, associated with TOC or DOC</p>
</dd>
<dt>b</dt><dd><p>Third coefficient in DBP model, associated with Cl2 </p>
</dd>
<dt>c</dt><dd><p>Fourth coefficient in DBP model, associated with Br-</p>
</dd>
<dt>d</dt><dd><p>Fifth coefficient in DBP model, associated with temperature</p>
</dd>
<dt>e</dt><dd><p>Sixth coefficient in DBP model, associated with pH</p>
</dd>
<dt>f</dt><dd><p>Seventh coefficient in DBP model, associated with reaction time</p>
</dd>
</dl>



<h3>Source</h3>

<p>U.S. EPA (2001)
</p>
<p>See references list at: <a href="https://github.com/BrownandCaldwell-Public/tidywater/wiki/References">https://github.com/BrownandCaldwell-Public/tidywater/wiki/References</a>
</p>

<hr>
<h2 id='define_water'>Create a water class object given water quality parameters</h2><span id='topic+define_water'></span>

<h3>Description</h3>

<p>This function takes user-defined water quality parameters and creates an S4 &quot;water&quot; class object that forms the input and output of all tidywater models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>define_water(
  ph,
  temp = 25,
  alk,
  tot_hard,
  ca,
  mg,
  na,
  k,
  cl,
  so4,
  free_chlorine = 0,
  combined_chlorine = 0,
  tot_po4 = 0,
  tot_nh3 = 0,
  tds,
  cond,
  toc,
  doc,
  uv254,
  br,
  f,
  fe,
  al,
  mn
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="define_water_+3A_ph">ph</code></td>
<td>
<p>water pH</p>
</td></tr>
<tr><td><code id="define_water_+3A_temp">temp</code></td>
<td>
<p>Temperature in degree C</p>
</td></tr>
<tr><td><code id="define_water_+3A_alk">alk</code></td>
<td>
<p>Alkalinity in mg/L as CaCO3</p>
</td></tr>
<tr><td><code id="define_water_+3A_tot_hard">tot_hard</code></td>
<td>
<p>Total hardness in mg/L as CaCO3</p>
</td></tr>
<tr><td><code id="define_water_+3A_ca">ca</code></td>
<td>
<p>Calcium in mg/L Ca2+</p>
</td></tr>
<tr><td><code id="define_water_+3A_mg">mg</code></td>
<td>
<p>Magnesium in mg/L Mg2+</p>
</td></tr>
<tr><td><code id="define_water_+3A_na">na</code></td>
<td>
<p>Sodium in mg/L Na+</p>
</td></tr>
<tr><td><code id="define_water_+3A_k">k</code></td>
<td>
<p>Potassium in mg/L K+</p>
</td></tr>
<tr><td><code id="define_water_+3A_cl">cl</code></td>
<td>
<p>Chloride in mg/L Cl-</p>
</td></tr>
<tr><td><code id="define_water_+3A_so4">so4</code></td>
<td>
<p>Sulfate in mg/L SO42-</p>
</td></tr>
<tr><td><code id="define_water_+3A_free_chlorine">free_chlorine</code></td>
<td>
<p>Free chlorine in mg/L as Cl2. Used when a starting water has a free chlorine residual.</p>
</td></tr>
<tr><td><code id="define_water_+3A_combined_chlorine">combined_chlorine</code></td>
<td>
<p>Combined chlorine (chloramines) in mg/L as Cl2. Used when a starting water has a chloramine residual.</p>
</td></tr>
<tr><td><code id="define_water_+3A_tot_po4">tot_po4</code></td>
<td>
<p>Phosphate in mg/L as PO4 3-. Used when a starting water has a phosphate residual.</p>
</td></tr>
<tr><td><code id="define_water_+3A_tot_nh3">tot_nh3</code></td>
<td>
<p>Total ammonia in mg/L as N</p>
</td></tr>
<tr><td><code id="define_water_+3A_tds">tds</code></td>
<td>
<p>Total Dissolved Solids in mg/L (optional if ions are known)</p>
</td></tr>
<tr><td><code id="define_water_+3A_cond">cond</code></td>
<td>
<p>Electrical conductivity in uS/cm (optional if ions are known)</p>
</td></tr>
<tr><td><code id="define_water_+3A_toc">toc</code></td>
<td>
<p>Total organic carbon (TOC) in mg/L</p>
</td></tr>
<tr><td><code id="define_water_+3A_doc">doc</code></td>
<td>
<p>Dissolved organic carbon (DOC) in mg/L</p>
</td></tr>
<tr><td><code id="define_water_+3A_uv254">uv254</code></td>
<td>
<p>UV absorbance at 254 nm (cm-1)</p>
</td></tr>
<tr><td><code id="define_water_+3A_br">br</code></td>
<td>
<p>Bromide in ug/L Br-</p>
</td></tr>
<tr><td><code id="define_water_+3A_f">f</code></td>
<td>
<p>Fluoride in mg/L F-</p>
</td></tr>
<tr><td><code id="define_water_+3A_fe">fe</code></td>
<td>
<p>Iron in mg/L Fe3+</p>
</td></tr>
<tr><td><code id="define_water_+3A_al">al</code></td>
<td>
<p>Aluminum in mg/L Al3+</p>
</td></tr>
<tr><td><code id="define_water_+3A_mn">mn</code></td>
<td>
<p>Manganese in ug/L Mn2+</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Carbonate balance is calculated and units are converted to mol/L. Ionic strength is determined from ions, TDS, or conductivity. Missing values are handled by defaulting to 0 or
NA. Calcium hardness defaults to 65
manually specify all ions in the define_water arguments. The following equations are used to determine ionic strength:
Ionic strength (if TDS provided): Crittenden et al. (2012) equation 5-38
Ionic strength (if electrical conductivity provided): Snoeyink &amp; Jenkins (1980)
Ionic strength (from ion concentrations): Lewis and Randall (1921), Crittenden et al. (2012) equation 5-37
Temperature correction of dielectric constant (relative permittivity): Harned and Owen (1958), Crittenden et al. (2012) equation 5-45.
</p>


<h3>Value</h3>

<p>A water class object where slots are filled or calculated based on input parameters.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>water_missingions &lt;- define_water(ph = 7, temp = 15, alk = 100, tds = 10)
water_defined &lt;- define_water(7, 20, 50, 100, 80, 10, 10, 10, 10, tot_po4 = 1)

</code></pre>

<hr>
<h2 id='define_water_chain'>Apply 'define_water' within a dataframe and output a column of 'water' class to be chained to other tidywater functions</h2><span id='topic+define_water_chain'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+define_water">define_water</a></code> to be added to a piped data frame.
Its output is a 'water' class, and can therefore be chained with &quot;downstream&quot; tidywater functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>define_water_chain(df, output_water = "defined_water")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="define_water_chain_+3A_df">df</code></td>
<td>
<p>a data frame containing columns with all the parameters listed in <code><a href="#topic+define_water">define_water</a></code></p>
</td></tr>
<tr><td><code id="define_water_chain_+3A_output_water">output_water</code></td>
<td>
<p>name of the output column storing updated parameters with the class, water. Default is &quot;defined_water&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame containing a water class column.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+define_water">define_water</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_once()

example_df &lt;- water_df %&gt;%
  define_water_chain(output_water = "This is a column of water") %&gt;%
  balance_ions_once(input_water = "This is a column of water")

# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_once()

#' #Optional: explicitly close multisession processing
plan(sequential)

</code></pre>

<hr>
<h2 id='define_water_once'>Apply 'define_water' and output a dataframe</h2><span id='topic+define_water_once'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+define_water">define_water</a></code> to be added to a piped data frame.
It outputs all carbonate calculations and other parameters in a data frame.
tidywater functions cannot be added after this function because they require a 'water' class input.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>define_water_once(df)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="define_water_once_+3A_df">df</code></td>
<td>
<p>a data frame containing columns with all the parameters listed in <code><a href="#topic+define_water">define_water</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame containing columns that were filled or calculated based on define_water.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+define_water">define_water</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;% define_water_once()

# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;% define_water_once()

# Optional: explicitly close multisession processing
plan(sequential)

</code></pre>

<hr>
<h2 id='discons'>Dissociation constants and standard enthalpy for weak acids/bases</h2><span id='topic+discons'></span>

<h3>Description</h3>

<p>Equilibrium constants (k) and corresponding standard enthalpy of reaction values (deltah) for significant acids in
water influencing pH at equilibrium. Includes carbonate, sulfate, phosphate, and hypochlorite.
Standard enthalpy of reaction is calculated by taking the sum of the enthalpy of formation of each individual component
minus the enthalpy of formation of the final product. e.g., the standard enthalpy of reaction for water can be
calculated as: deltah_h2o = deltah_f_oh + deltah_f_h - deltah_f_h2o = -230 + 0 - (-285.83) = 55.83 kJ/mol.
See MWH (2012) example 5-5 and Benjamin (2002) eq. 2.96.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>discons
</code></pre>


<h3>Format</h3>

<p>A dataframe with 8 rows and 3 columns
</p>

<dl>
<dt>ID</dt><dd><p>Coefficient type</p>
</dd>
<dt>k</dt><dd><p>Equilibrium constant</p>
</dd>
<dt>deltah</dt><dd><p>Standard enthalpy in J/mol</p>
</dd>
</dl>



<h3>Source</h3>

<p>Benjamin (2015) Appendix A.1 and A.2.
</p>
<p>See references list at: <a href="https://github.com/BrownandCaldwell-Public/tidywater/wiki/References">https://github.com/BrownandCaldwell-Public/tidywater/wiki/References</a>
</p>

<hr>
<h2 id='dissolve_pb'>Simulate contributions of various lead solids to total soluble lead</h2><span id='topic+dissolve_pb'></span>

<h3>Description</h3>

<p>This function takes a water data frame defined by <code><a href="#topic+define_water">define_water</a></code>
and outputs a dataframe of the controlling lead solid and total lead solubility.
Lead solid solubility is calculated based on controlling solid.
Total dissolved lead species (tot_dissolved_pb, M) are calculated based on lead complex calculations.
Some lead solids have two k-constant options. The function will default to the EPA's default constants.
The user may change the constants to hydroxypyromorphite = &quot;Zhu&quot; or pyromorphite = &quot;Xie&quot; or laurionite = &quot;Lothenbach&quot;
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dissolve_pb(
  water,
  hydroxypyromorphite = "Schock",
  pyromorphite = "Topolska",
  laurionite = "Nasanen"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dissolve_pb_+3A_water">water</code></td>
<td>
<p>Source water object of class &quot;water&quot; created by <code><a href="#topic+define_water">define_water</a></code>. Water must include alk and is.
If po4, cl, and so4 are known, those should also be included.</p>
</td></tr>
<tr><td><code id="dissolve_pb_+3A_hydroxypyromorphite">hydroxypyromorphite</code></td>
<td>
<p>defaults to &quot;Schock&quot;, the constant, K, developed by Schock et al (1996). Can also use &quot;Zhu&quot;.</p>
</td></tr>
<tr><td><code id="dissolve_pb_+3A_pyromorphite">pyromorphite</code></td>
<td>
<p>defaults to &quot;Topolska&quot;, the constant, K, developed by Topolska et al (2016). Can also use &quot;Xie&quot;.</p>
</td></tr>
<tr><td><code id="dissolve_pb_+3A_laurionite">laurionite</code></td>
<td>
<p>defaults to &quot;Nasanen&quot;, the constant, K, developed by Nasanen &amp; Lindell (1976). Can also use &quot;Lothenbach&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The solid with lowest solubility will form the lead scale (controlling lead solid).
</p>
<p>Make sure that total dissolved solids, conductivity, or
ca, na, cl, so4 are used in 'define_water' so that an ionic strength is calculated.
</p>


<h3>Value</h3>

<p>A data frame containing only the controlling lead solid and modeled dissolved lead concentration.
</p>


<h3>Source</h3>

<p>Code is from EPA's TELSS lead solubility dashboard <a href="https://github.com/USEPA/TELSS">https://github.com/USEPA/TELSS</a>
which is licensed under MIT License:
Permission is hereby granted, free of charge, to any person obtaining a copy of this software and
associated documentation files (the &quot;Software&quot;), to deal in the Software without restriction,
including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the
following conditions: The above copyright notice and this permission notice shall be included in all copies or
substantial portions of the Software.
</p>
<p>Wahman et al. (2021)
</p>
<p>See references list at: <a href="https://github.com/BrownandCaldwell-Public/tidywater/wiki/References">https://github.com/BrownandCaldwell-Public/tidywater/wiki/References</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+define_water">define_water</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
example_pb &lt;- define_water(
  ph = 7.5, temp = 25, alk = 93, cl = 240,
  tot_po4 = 0, so4 = 150, tds = 200
) %&gt;%
  dissolve_pb()
example_pb &lt;- define_water(
  ph = 7.5, temp = 25, alk = 93, cl = 240,
  tot_po4 = 0, so4 = 150, tds = 200
) %&gt;%
  dissolve_pb(pyromorphite = "Xie")

</code></pre>

<hr>
<h2 id='dissolve_pb_once'>Apply 'dissolve_pb' to a dataframe and create a new column with numeric dose</h2><span id='topic+dissolve_pb_once'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+dissolve_pb">dissolve_pb</a></code> to be added to a piped data frame.
Two additional columns will be added to the dataframe; the name of the controlling lead solid, and total dissolved lead (M).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dissolve_pb_once(
  df,
  input_water = "defined_water",
  output_col_solid = "controlling_solid",
  output_col_result = "pb",
  hydroxypyromorphite = "Schock",
  pyromorphite = "Topolska",
  laurionite = "Nasanen",
  water_prefix = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dissolve_pb_once_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already been computed using
<code><a href="#topic+define_water_chain">define_water_chain</a></code></p>
</td></tr>
<tr><td><code id="dissolve_pb_once_+3A_input_water">input_water</code></td>
<td>
<p>name of the column of water class data to be used as the input. Default is &quot;defined_water&quot;.</p>
</td></tr>
<tr><td><code id="dissolve_pb_once_+3A_output_col_solid">output_col_solid</code></td>
<td>
<p>name of the output column storing the controlling lead solid. Default is &quot;controlling_solid&quot;.</p>
</td></tr>
<tr><td><code id="dissolve_pb_once_+3A_output_col_result">output_col_result</code></td>
<td>
<p>name of the output column storing dissolved lead in M. Default is &quot;pb&quot;.</p>
</td></tr>
<tr><td><code id="dissolve_pb_once_+3A_hydroxypyromorphite">hydroxypyromorphite</code></td>
<td>
<p>defaults to &quot;Schock&quot;, the constant, K, developed by Schock et al (1996). Can also use &quot;Zhu&quot;.</p>
</td></tr>
<tr><td><code id="dissolve_pb_once_+3A_pyromorphite">pyromorphite</code></td>
<td>
<p>defaults to &quot;Topolska&quot;, the constant, K, developed by Topolska et al (2016). Can also use &quot;Xie&quot;.</p>
</td></tr>
<tr><td><code id="dissolve_pb_once_+3A_laurionite">laurionite</code></td>
<td>
<p>defaults to &quot;Nasanen&quot;, the constant, K, developed by Nasanen &amp; Lindell (1976). Can also use &quot;Lothenbach&quot;.</p>
</td></tr>
<tr><td><code id="dissolve_pb_once_+3A_water_prefix">water_prefix</code></td>
<td>
<p>name of the input water used for the calculation, appended to the start of output columns. Default is TRUE.
Chenge to FALSE to remove the water prefix from output column names.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data input comes from a 'water' class column, initialized in <code><a href="#topic+define_water">define_water</a></code> or <code><a href="#topic+balance_ions">balance_ions</a></code>.
Use the 'output_col_solid' and 'output_col_result' arguments to name the ouput columns for the controlling lead solid
and total dissolved lead, respectively. The input 'water' used for the calculation will be appended to the
start of these output columns. Omit the input 'water' in the output columns, set 'water_prefix' to FALSE (default is TRUE).
</p>
<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame containing the controlling lead solid and modeled dissolved lead concentration as new columns.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dissolve_pb">dissolve_pb</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  dissolve_pb_once(input_water = "balanced_water")

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  dissolve_pb_once(output_col_result = "dissolved_lead", pyromorphite = "Xie")

# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  dissolve_pb_once(output_col_result = "dissolved_lead", laurionite = "Lothenbach")

# Optional: explicitly close multisession processing
plan(sequential)

</code></pre>

<hr>
<h2 id='edwardscoeff'>Data frame of Edwards model coefficients</h2><span id='topic+edwardscoeff'></span>

<h3>Description</h3>

<p>A dataset containing coefficients from the Edwards (1997) model for coagulation TOC removal.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>edwardscoeff
</code></pre>


<h3>Format</h3>

<p>A dataframe with 5 rows and 7 columns:
</p>

<dl>
<dt>ID</dt><dd><p>Coefficient type</p>
</dd>
<dt>x3</dt><dd><p>x3 parameter</p>
</dd>
<dt>x2</dt><dd><p>x2 parameter</p>
</dd>
<dt>x1</dt><dd><p>x1 parameter</p>
</dd>
<dt>k1</dt><dd><p>k1 parameter</p>
</dd>
<dt>k2</dt><dd><p>k2 parameter</p>
</dd>
<dt>b</dt><dd><p>b parameter</p>
</dd>
</dl>



<h3>Source</h3>

<p>Edwards (1997) Table 2.
</p>
<p>See references list at: <a href="https://github.com/BrownandCaldwell-Public/tidywater/wiki/References">https://github.com/BrownandCaldwell-Public/tidywater/wiki/References</a>
</p>

<hr>
<h2 id='leadsol_constants'>Data frame of equilibrium constants for lead and copper solubility</h2><span id='topic+leadsol_constants'></span>

<h3>Description</h3>

<p>A dataset containing equilibrium constants for lead solubility
</p>


<h3>Usage</h3>

<pre><code class='language-R'>leadsol_constants
</code></pre>


<h3>Format</h3>

<p>A dataframe with 38 rows and 3 columns
</p>
<p>Solids:
</p>

<dl>
<dt>species_name</dt><dd><p>Name of lead solid or complex with possible _letter to cite different references</p>
</dd>
<dt>constant_name</dt><dd><p>Reference ID for constants</p>
</dd>
<dt>log_value</dt><dd><p>Equilibrium constant log value</p>
</dd>
<dt>source</dt><dd><p>Source for equilibrium constant value</p>
</dd>
</dl>



<h3>Source</h3>

<p>Benjamin (2010)
</p>
<p>Lothenbach et al. (1999)
</p>
<p>Nasanen &amp; Lindell (1976)
</p>
<p>Powell et al. (2009)
</p>
<p>Powell et al. (2005)
</p>
<p>Schock et al. (1996)
</p>
<p>Topolska et al. (2016)
</p>
<p>Xie &amp; Giammar (2007)
</p>
<p>Zhu et al. (2015)
</p>
<p>Wahman et al. (2021)
</p>
<p>See references list at: <a href="https://github.com/BrownandCaldwell-Public/tidywater/wiki/References">https://github.com/BrownandCaldwell-Public/tidywater/wiki/References</a>
</p>

<hr>
<h2 id='mweights'>Molar weights of relevant compounds</h2><span id='topic+mweights'></span>

<h3>Description</h3>

<p>A dataset containing the molar weights of several compounds in g/mol. Column names are lowercase chemical formulas (with no charge),
with the exception of the following coagulants:
alum = Al2(SO4)3*14H2O,
ferricchloride = FeCl3,
ferricsulfate = Fe2(SO4)3*8.8H2O,
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mweights
</code></pre>


<h3>Format</h3>

<p>A dataframe with one row and one column per compound
</p>

<hr>
<h2 id='ozonate_bromate'>Calculate bromate formation</h2><span id='topic+ozonate_bromate'></span>

<h3>Description</h3>

<p>Calculates bromate (BrO3-, ug/L) formation based on selected model. Required arguments include an object of class &quot;water&quot;
created by <code><a href="#topic+define_water">define_water</a></code> ozone dose, reaction time, and desired model.
The function also requires additional water quality parameters defined in <code>define_water</code>
including bromide, DOC or UV254 (depending on the model), pH, alkalinity (depending on the model), and
optionally, ammonia (added when defining water using the 'tot_nh3' argument.)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ozonate_bromate(water, dose, time, model = "Ozekin")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ozonate_bromate_+3A_water">water</code></td>
<td>
<p>Source water object of class &quot;water&quot; created by <code><a href="#topic+define_water">define_water</a></code></p>
</td></tr>
<tr><td><code id="ozonate_bromate_+3A_dose">dose</code></td>
<td>
<p>Applied ozone dose (mg/L as O3). Results typically valid for 1-10 mg/L, but varies depending on model.</p>
</td></tr>
<tr><td><code id="ozonate_bromate_+3A_time">time</code></td>
<td>
<p>Reaction time (minutes). Results typically valid for 1-120 minutes, but varies depending on model.</p>
</td></tr>
<tr><td><code id="ozonate_bromate_+3A_model">model</code></td>
<td>
<p>Model to apply. One of c(&quot;Ozekin&quot;, &quot;Sohn&quot;, &quot;Song&quot;, &quot;Galey&quot;, &quot;Siddiqui&quot;)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A water class object with calculated bromate (ug/L).
</p>


<h3>Source</h3>

<p>Ozekin (1994), Sohn et al (2004), Song et al (1996), Galey et al (1997), Siddiqui et al (1994)
</p>
<p>See references list at: <a href="https://github.com/BrownandCaldwell-Public/tidywater/wiki/References">https://github.com/BrownandCaldwell-Public/tidywater/wiki/References</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>example_dbp &lt;- suppressWarnings(define_water(8, 20, 66, toc = 4, uv254 = .2, br = 50)) %&gt;%
  ozonate_bromate(dose = 1.5, time = 5, model = "Ozekin")
example_dbp &lt;- suppressWarnings(define_water(7.5, 20, 66, toc = 4, uv254 = .2, br = 50)) %&gt;%
  ozonate_bromate(dose = 3, time = 15, model = "Sohn")

</code></pre>

<hr>
<h2 id='ozonate_bromate_chain'>Apply 'ozonate_bromate' within a data frame and output a column of 'water' class to be chained to other tidywater functions</h2><span id='topic+ozonate_bromate_chain'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+ozonate_bromate">ozonate_bromate</a></code> to be added to a piped data frame.
Its output is a 'water' class, and can therefore be used with &quot;downstream&quot; tidywater functions.
The bro3 slot will be updated.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ozonate_bromate_chain(
  df,
  input_water = "defined_water",
  output_water = "ozonated_water",
  dose = 0,
  time = 0,
  model = "Ozekin"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ozonate_bromate_chain_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already been computed using
<code><a href="#topic+define_water_chain">define_water_chain</a></code>. The df may include a column named for the applied ozone dose (dose),
and a column for time in minutes.</p>
</td></tr>
<tr><td><code id="ozonate_bromate_chain_+3A_input_water">input_water</code></td>
<td>
<p>name of the column of water class data to be used as the input for this function. Default is &quot;defined_water&quot;.</p>
</td></tr>
<tr><td><code id="ozonate_bromate_chain_+3A_output_water">output_water</code></td>
<td>
<p>name of the output column storing updated parameters with the class, water. Default is &quot;ozonated_water&quot;.</p>
</td></tr>
<tr><td><code id="ozonate_bromate_chain_+3A_dose">dose</code></td>
<td>
<p>Applied ozone dose (mg/L as O3). Results typically valid for 1-10 mg/L, but varies depending on model.</p>
</td></tr>
<tr><td><code id="ozonate_bromate_chain_+3A_time">time</code></td>
<td>
<p>Reaction time (minutes). Results typically valid for 1-120 minutes, but varies depending on model.</p>
</td></tr>
<tr><td><code id="ozonate_bromate_chain_+3A_model">model</code></td>
<td>
<p>Model to apply, defaults to &quot;Ozekin&quot;. One of c(&quot;Ozekin&quot;, &quot;Sohn&quot;, &quot;Song&quot;, &quot;Galey&quot;, &quot;Siddiqui&quot;)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data input comes from a 'water' class column, as initialized in <code><a href="#topic+define_water_chain">define_water_chain</a></code>.
</p>
<p>If the input data frame has a dose column (dose) or time column (time), the function will use those columns. Note:
The function can only take dose and time inputs as EITHER a column or as function arguments, not both.
</p>
<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame containing a water class column with updated bro3.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ozonate_bromate">ozonate_bromate</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;%
  mutate(br = 50) %&gt;%
  define_water_chain() %&gt;%
  ozonate_bromate_chain(dose = 4, time = 8)

example_df &lt;- water_df %&gt;%
  mutate(br = 50) %&gt;%
  define_water_chain() %&gt;%
  mutate(
    dose = c(seq(.5, 3, .5), seq(.5, 3, .5)),
    time = 30
  ) %&gt;%
  ozonate_bromate_chain()

example_df &lt;- water_df %&gt;%
  mutate(br = 80) %&gt;%
  define_water_chain() %&gt;%
  mutate(time = 8) %&gt;%
  ozonate_bromate_chain(
    dose = 6, model = "Sohn"
  )


# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;%
  mutate(br = 50) %&gt;%
  define_water_chain() %&gt;%
  ozonate_bromate_chain(dose = 4, time = 8)

# Optional: explicitly close multisession processing
plan(sequential)


</code></pre>

<hr>
<h2 id='ozonate_bromate_once'>Apply 'ozonate_bromate'function within a data frame and output a data frame</h2><span id='topic+ozonate_bromate_once'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+ozonate_bromate">ozonate_bromate</a></code> to be added to a piped data frame.
Its output is a data frame containing a bro3 column.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ozonate_bromate_once(
  df,
  input_water = "defined_water",
  dose = 0,
  time = 0,
  model = "Ozekin"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ozonate_bromate_once_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already been computed using
<code><a href="#topic+define_water_once">define_water_once</a></code>. The df may include a column named for the applied chlorine dose (cl2),
and a column for time in minutes.</p>
</td></tr>
<tr><td><code id="ozonate_bromate_once_+3A_input_water">input_water</code></td>
<td>
<p>name of the column of water class data to be used as the input for this function. Default is &quot;defined_water&quot;.</p>
</td></tr>
<tr><td><code id="ozonate_bromate_once_+3A_dose">dose</code></td>
<td>
<p>Applied ozone dose (mg/L as O3). Results typically valid for 1-10 mg/L, but varies depending on model.</p>
</td></tr>
<tr><td><code id="ozonate_bromate_once_+3A_time">time</code></td>
<td>
<p>Reaction time (minutes). Results typically valid for 1-120 minutes, but varies depending on model.</p>
</td></tr>
<tr><td><code id="ozonate_bromate_once_+3A_model">model</code></td>
<td>
<p>Model to apply, defaults to &quot;Ozekin&quot;. One of c(&quot;Ozekin&quot;, &quot;Sohn&quot;, &quot;Song&quot;, &quot;Galey&quot;, &quot;Siddiqui&quot;)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data input comes from a 'water' class column, as initialized in <code><a href="#topic+define_water_chain">define_water_chain</a></code>.
</p>
<p>If the input data frame has a dose column (dose) or time column (time), the function will use those columns. Note:
The function can only take dose and time inputs as EITHER a column or as function arguments, not both.
</p>
<p>tidywater functions cannot be added after this function because they require a 'water' class input.
</p>
<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame with updated bromate.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ozonate_bromate">ozonate_bromate</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;%
  mutate(br = 50) %&gt;%
  define_water_chain("raw") %&gt;%
  ozonate_bromate_once(input_water = "raw", dose = 3, time = 8)

example_df &lt;- water_df %&gt;%
  mutate(br = 50) %&gt;%
  define_water_chain("raw") %&gt;%
  mutate(
    dose = c(seq(.5, 3, .5), seq(.5, 3, .5)),
    time = 10
  ) %&gt;%
  ozonate_bromate_once(input_water = "raw")

example_df &lt;- water_df %&gt;%
  mutate(br = 80) %&gt;%
  define_water_chain("raw") %&gt;%
  mutate(time = 8) %&gt;%
  ozonate_bromate_once(
    input_water = "raw", dose = 6, model = "Sohn"
  )

# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;%
  mutate(br = 50) %&gt;%
  define_water_chain() %&gt;%
  ozonate_bromate_once(input_water = "defined_water", dose = 4, time = 8)

# Optional: explicitly close multisession processing
plan(sequential)


</code></pre>

<hr>
<h2 id='pac_toc'>Calculate DOC Concentration in PAC system</h2><span id='topic+pac_toc'></span>

<h3>Description</h3>

<p>Calculates DOC concentration multiple linear regression model found in 2-METHYLISOBORNEOL AND NATURAL ORGANIC MATTER
ADSORPTION BY POWDERED ACTIVATED CARBON by HYUKJIN CHO (2007)
Required arguments include an object of class &quot;water&quot;
created by <code><a href="#topic+define_water">define_water</a></code> initial DOC concentration, amount of PAC added to system, contact time with PAC, type of PAC
</p>
<p>water must contain DOC or TOC value.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pac_toc(water, dose, time, type = "bituminous")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pac_toc_+3A_water">water</code></td>
<td>
<p>Source water object of class &quot;water&quot; created by <code><a href="#topic+define_water">define_water</a></code></p>
</td></tr>
<tr><td><code id="pac_toc_+3A_dose">dose</code></td>
<td>
<p>Applied PAC dose (mg/L). Model results are valid for doses concentrations between 5 and 30 mg/L.</p>
</td></tr>
<tr><td><code id="pac_toc_+3A_time">time</code></td>
<td>
<p>Contact time (minutes). Model results are valid for reaction times between 10 and 1440 minutes</p>
</td></tr>
<tr><td><code id="pac_toc_+3A_type">type</code></td>
<td>
<p>Type of PAC applied, either &quot;bituminous&quot;, &quot;lignite&quot;, &quot;wood&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function will calculate DOC concentration by PAC adsorption in drinking water treatment.
UV254 concentrations are predicted based on a linear relationship with DOC.
</p>


<h3>Value</h3>

<p>A water class object with updated DOC, TOC, and UV254 slots.
</p>


<h3>Source</h3>

<p>See references list at: <a href="https://github.com/BrownandCaldwell-Public/tidywater/wiki/References">https://github.com/BrownandCaldwell-Public/tidywater/wiki/References</a>
</p>
<p>CHO(2007)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>water &lt;- define_water(toc = 2.5, uv254 = .05, doc = 1.5) %&gt;%
  pac_toc(dose = 15, time = 50, type = "wood")

</code></pre>

<hr>
<h2 id='pac_toc_chain'>Apply 'pac_toc' within a data frame and output a column of 'water' class to be chained to other tidywater functions
PAC = powdered activated carbon</h2><span id='topic+pac_toc_chain'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+pac_toc">pac_toc</a></code> to be added to a piped data frame.
Its output is a 'water' class, and can therefore be used with &quot;downstream&quot; tidywater functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pac_toc_chain(
  df,
  input_water = "defined_water",
  output_water = "pac_water",
  dose = 0,
  time = 0,
  type = "bituminous"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pac_toc_chain_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already been computed using
<code><a href="#topic+define_water_chain">define_water_chain</a></code>. The df may include columns named for the dose, time, and type</p>
</td></tr>
<tr><td><code id="pac_toc_chain_+3A_input_water">input_water</code></td>
<td>
<p>name of the column of water class data to be used as the input for this function. Default is &quot;defined_water&quot;.</p>
</td></tr>
<tr><td><code id="pac_toc_chain_+3A_output_water">output_water</code></td>
<td>
<p>name of the output column storing updated parameters with the class, water. Default is &quot;pac_water&quot;.</p>
</td></tr>
<tr><td><code id="pac_toc_chain_+3A_dose">dose</code></td>
<td>
<p>Applied PAC dose (mg/L). Model results are valid for doses concentrations between 5 and 30 mg/L.</p>
</td></tr>
<tr><td><code id="pac_toc_chain_+3A_time">time</code></td>
<td>
<p>Contact time (minutes). Model results are valid for reaction times between 10 and 1440 minutes</p>
</td></tr>
<tr><td><code id="pac_toc_chain_+3A_type">type</code></td>
<td>
<p>Type of PAC applied, either &quot;bituminous&quot;, &quot;lignite&quot;, &quot;wood&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data input comes from a 'water' class column, as initialized in <code><a href="#topic+define_water">define_water</a></code>.
</p>
<p>If the input data frame has a dose, time or type column, the function will use those columns. Note:
The function can only take dose, time, and type inputs as EITHER a column or from the function arguments, not both.
</p>
<p>tidywater functions cannot be added after this function because they require a 'water' class input.
</p>
<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame containing a water class column with updated DOC, TOC, and UV254 slots
</p>


<h3>Source</h3>

<p>See references list at: <a href="https://github.com/BrownandCaldwell-Public/tidywater/wiki/References">https://github.com/BrownandCaldwell-Public/tidywater/wiki/References</a>
</p>
<p>CHO(2007)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pac_toc">pac_toc</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;%
  define_water_chain("raw") %&gt;%
  pac_toc_chain(input_water = "raw", dose = 10, time = 20)

example_df &lt;- water_df %&gt;%
  define_water_chain("raw") %&gt;%
  mutate(dose = seq(11, 22, 1), time = 30) %&gt;%
  pac_toc_chain(input_water = "raw")

example_df &lt;- water_df %&gt;%
  define_water_chain("raw") %&gt;%
  mutate(time = 8) %&gt;%
  pac_toc_chain(
    input_water = "raw", dose = 6, type = "wood"
  )

# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;%
  define_water_chain("raw") %&gt;%
  pac_toc_chain(input_water = "raw", dose = 4, time = 8)

# Optional: explicitly close multisession processing
plan(sequential)
</code></pre>

<hr>
<h2 id='pac_toc_once'>Apply 'pac_toc'function within a data frame and output a data frame</h2><span id='topic+pac_toc_once'></span>

<h3>Description</h3>

<p>PAC = powdered activated carbon
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pac_toc_once(
  df,
  input_water = "defined_water",
  dose = 0,
  time = 0,
  type = "bituminous"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pac_toc_once_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already been computed using
<code><a href="#topic+define_water_chain">define_water_chain</a></code>. The df may include columns named for the dose, time, and type</p>
</td></tr>
<tr><td><code id="pac_toc_once_+3A_input_water">input_water</code></td>
<td>
<p>name of the column of water class data to be used as the input for this function. Default is &quot;defined_water&quot;.</p>
</td></tr>
<tr><td><code id="pac_toc_once_+3A_dose">dose</code></td>
<td>
<p>Applied PAC dose (mg/L). Model results are valid for doses concentrations between 5 and 30 mg/L.</p>
</td></tr>
<tr><td><code id="pac_toc_once_+3A_time">time</code></td>
<td>
<p>Contact time (minutes). Model results are valid for reaction times between 10 and 1440 minutes</p>
</td></tr>
<tr><td><code id="pac_toc_once_+3A_type">type</code></td>
<td>
<p>Type of PAC applied, either &quot;bituminous&quot;, &quot;lignite&quot;, &quot;wood&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function allows <code><a href="#topic+pac_toc">pac_toc</a></code> to be added to a piped data frame.
Its output is a data frame containing a water with updated TOC, DOC, and UV254.
</p>
<p>The data input comes from a 'water' class column, as initialized in <code><a href="#topic+define_water">define_water</a></code>.
</p>
<p>If the input data frame has a dose, time or type column, the function will use those columns. Note:
The function can only take dose, time, and type inputs as EITHER a column or from the function arguments, not both.
</p>
<p>tidywater functions cannot be added after this function because they require a 'water' class input.
</p>
<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame with an updated DOC, TOC, and UV254 concentration.
</p>


<h3>Source</h3>

<p>See references list at: <a href="https://github.com/BrownandCaldwell-Public/tidywater/wiki/References">https://github.com/BrownandCaldwell-Public/tidywater/wiki/References</a>
</p>
<p>CHO(2007)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pac_toc">pac_toc</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;%
  define_water_chain("raw") %&gt;%
  pac_toc_once(input_water = "raw", dose = 10, time = 20)

example_df &lt;- water_df %&gt;%
  define_water_chain("raw") %&gt;%
  mutate(dose = seq(5, 60, 5), time = 30) %&gt;%
  pac_toc_once(input_water = "raw")

example_df &lt;- water_df %&gt;%
  define_water_chain("raw") %&gt;%
  mutate(time = 8) %&gt;%
  pac_toc_once(
    input_water = "raw", dose = 6, type = "wood"
  )

# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;%
  define_water_chain("raw") %&gt;%
  pac_toc_once(input_water = "raw", dose = 4, time = 8)

# Optional: explicitly close multisession processing
plan(sequential)

</code></pre>

<hr>
<h2 id='plot_ions'>Create summary plot of ions from water class</h2><span id='topic+plot_ions'></span>

<h3>Description</h3>

<p>This function takes a water data frame defined by <code><a href="#topic+define_water">define_water</a></code> and outputs an ion balance plot.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_ions(water)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_ions_+3A_water">water</code></td>
<td>
<p>Source water vector created by link function here</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggplot object displaying the water's ion balance.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>water_defined &lt;- define_water(7, 20, 50, 100, 80, 10, 10, 10, 10, tot_po4 = 1)
plot_ions(water_defined)

</code></pre>

<hr>
<h2 id='pluck_water'>Pluck out a single parameter from a 'water' class object</h2><span id='topic+pluck_water'></span>

<h3>Description</h3>

<p>This function plucks one or more selected parameters from selected columns of 'water' class objects.
The names of the output columns will follow the form 'water_parameter'
To view all slots as columns, please use one of the 'fn_once' functions or <code><a href="#topic+convert_water">convert_water</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pluck_water(df, input_waters = c("defined_water"), parameter)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pluck_water_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already
been computed using <code><a href="#topic+define_water">define_water</a></code></p>
</td></tr>
<tr><td><code id="pluck_water_+3A_input_waters">input_waters</code></td>
<td>
<p>vector of names of the columns of water class data to be used as the input for this function.</p>
</td></tr>
<tr><td><code id="pluck_water_+3A_parameter">parameter</code></td>
<td>
<p>vector of water class parameters to view outside the water column</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame containing columns of selected parameters from a list of water class objects.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+convert_water">convert_water</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(furrr)
library(purrr)
library(tidyr)

pluck_example &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  pluck_water(parameter = "tot_co3")

pluck_example &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  pluck_water(input_waters = c("defined_water", "balanced_water"), parameter = c("na", "cl"))

plan(multisession, workers = 2) # Remove the workers argument to use all available compute
pluck_example &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  pluck_water(parameter = c("ph", "alk"))

# Optional: explicitly close multisession processing
plan(sequential)
</code></pre>

<hr>
<h2 id='solvecost_chem'>Determine chemical cost</h2><span id='topic+solvecost_chem'></span>

<h3>Description</h3>

<p>This function takes a chemical dose in mg/L, plant flow, chemical strength, and $/lb and calculates cost.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>solvecost_chem(dose, flow, strength = 100, cost, time = "day")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="solvecost_chem_+3A_dose">dose</code></td>
<td>
<p>Chemical dose in mg/L as chemical</p>
</td></tr>
<tr><td><code id="solvecost_chem_+3A_flow">flow</code></td>
<td>
<p>Plant flow in MGD</p>
</td></tr>
<tr><td><code id="solvecost_chem_+3A_strength">strength</code></td>
<td>
<p>Chemical product strength in percent. Defaults to 100 percent.</p>
</td></tr>
<tr><td><code id="solvecost_chem_+3A_cost">cost</code></td>
<td>
<p>Chemical product cost in $/lb</p>
</td></tr>
<tr><td><code id="solvecost_chem_+3A_time">time</code></td>
<td>
<p>Desired output units, one of c(&quot;day&quot;, &quot;month&quot;, &quot;year&quot;). Defaults to &quot;day&quot;.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric value for chemical cost, $/time.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>alum_cost &lt;- solvecost_chem(dose = 20, flow = 10, strength = 49, cost = .22)

library(dplyr)
cost_data &lt;- tibble(
  dose = seq(10, 50, 10),
  flow = 10
) %&gt;%
  mutate(costs = solvecost_chem(dose = dose, flow = flow, strength = 49, cost = .22))

</code></pre>

<hr>
<h2 id='solvecost_labor'>Determine labor cost</h2><span id='topic+solvecost_labor'></span>

<h3>Description</h3>

<p>This function takes number of FTE and annual $/FTE and determines labor cost
</p>


<h3>Usage</h3>

<pre><code class='language-R'>solvecost_labor(fte, cost, time = "day")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="solvecost_labor_+3A_fte">fte</code></td>
<td>
<p>Number of FTEs. Can be decimal.</p>
</td></tr>
<tr><td><code id="solvecost_labor_+3A_cost">cost</code></td>
<td>
<p>$/year per FTE</p>
</td></tr>
<tr><td><code id="solvecost_labor_+3A_time">time</code></td>
<td>
<p>Desired output units, one of c(&quot;day&quot;, &quot;month&quot;, &quot;year&quot;). Defaults to &quot;day&quot;.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric value for labor $/time.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>laborcost &lt;- solvecost_labor(1.5, 50000)

library(dplyr)
cost_data &lt;- tibble(
  fte = seq(1, 10, 1)
) %&gt;%
  mutate(costs = solvecost_labor(fte = fte, cost = .08))

</code></pre>

<hr>
<h2 id='solvecost_power'>Determine power cost</h2><span id='topic+solvecost_power'></span>

<h3>Description</h3>

<p>This function takes kW, 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>solvecost_power(power, utilization = 100, cost, time = "day")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="solvecost_power_+3A_power">power</code></td>
<td>
<p>Power consumed in kW</p>
</td></tr>
<tr><td><code id="solvecost_power_+3A_utilization">utilization</code></td>
<td>
<p>Amount of time equipment is running in percent. Defaults to continuous.</p>
</td></tr>
<tr><td><code id="solvecost_power_+3A_cost">cost</code></td>
<td>
<p>Power cost in $/kWhr</p>
</td></tr>
<tr><td><code id="solvecost_power_+3A_time">time</code></td>
<td>
<p>Desired output units, one of c(&quot;day&quot;, &quot;month&quot;, &quot;year&quot;). Defaults to &quot;day&quot;.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric value for power, $/time.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>powercost &lt;- solvecost_power(50, 100, .08)

library(dplyr)
cost_data &lt;- tibble(
  power = seq(10, 50, 10),
  utilization = 80
) %&gt;%
  mutate(costs = solvecost_power(power = power, utilization = utilization, cost = .08))

</code></pre>

<hr>
<h2 id='solvecost_solids'>Determine solids disposal cost</h2><span id='topic+solvecost_solids'></span>

<h3>Description</h3>

<p>This function takes coagulant doses in mg/L as chemical, removed turbidity, and cost ($/lb) to determine disposal cost.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>solvecost_solids(
  alum = 0,
  ferricchloride = 0,
  ferricsulfate = 0,
  flow,
  turb,
  b = 1.5,
  cost,
  time = "day"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="solvecost_solids_+3A_alum">alum</code></td>
<td>
<p>Hydrated aluminum sulfate Al2(SO4)3*14H2O + 6HCO3 -&gt; 2Al(OH)3(am) +3SO4 + 14H2O + 6CO2</p>
</td></tr>
<tr><td><code id="solvecost_solids_+3A_ferricchloride">ferricchloride</code></td>
<td>
<p>Ferric Chloride FeCl3 + 3HCO3 -&gt; Fe(OH)3(am) + 3Cl + 3CO2</p>
</td></tr>
<tr><td><code id="solvecost_solids_+3A_ferricsulfate">ferricsulfate</code></td>
<td>
<p>Amount of ferric sulfate added in mg/L: Fe2(SO4)3*8.8H2O + 6HCO3 -&gt; 2Fe(OH)3(am) + 3SO4 + 8.8H2O + 6CO2</p>
</td></tr>
<tr><td><code id="solvecost_solids_+3A_flow">flow</code></td>
<td>
<p>Plant flow in MGD</p>
</td></tr>
<tr><td><code id="solvecost_solids_+3A_turb">turb</code></td>
<td>
<p>Turbidity removed in NTU</p>
</td></tr>
<tr><td><code id="solvecost_solids_+3A_b">b</code></td>
<td>
<p>Correlation factor from turbidity to suspended solids. Defaults to 1.5.</p>
</td></tr>
<tr><td><code id="solvecost_solids_+3A_cost">cost</code></td>
<td>
<p>Disposal cost in $/lb</p>
</td></tr>
<tr><td><code id="solvecost_solids_+3A_time">time</code></td>
<td>
<p>Desired output units, one of c(&quot;day&quot;, &quot;month&quot;, &quot;year&quot;). Defaults to &quot;day&quot;.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric value for disposal costs, $/time.
</p>


<h3>Source</h3>

<p>https://water.mecc.edu/courses/ENV295Residuals/lesson3b.htm#:~:text=From
</p>


<h3>Examples</h3>

<pre><code class='language-R'>alum_solidscost &lt;- solvecost_solids(alum = 50, flow = 10, turb = 2, cost = 0.05)

library(dplyr)
cost_data &lt;- tibble(
  alum = seq(10, 50, 10),
  flow = 10
) %&gt;%
  mutate(costs = solvecost_solids(alum = alum, flow = flow, turb = 2, cost = 0.05))

</code></pre>

<hr>
<h2 id='solvect_chlorine'>Determine disinfection credit from chlorine.</h2><span id='topic+solvect_chlorine'></span>

<h3>Description</h3>

<p>This function takes a water defined by <code><a href="#topic+define_water">define_water</a></code> and other disinfection parameters
and outputs a data frame of the required CT ('ct_required'), actual CT ('ct_actual'), and giardia log removal ('glog_removal').
</p>


<h3>Usage</h3>

<pre><code class='language-R'>solvect_chlorine(water, time, residual, baffle)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="solvect_chlorine_+3A_water">water</code></td>
<td>
<p>Source water object of class &quot;water&quot; created by <code><a href="#topic+define_water">define_water</a></code>. Water must include ph and temp</p>
</td></tr>
<tr><td><code id="solvect_chlorine_+3A_time">time</code></td>
<td>
<p>Retention time of disinfection segment in minutes.</p>
</td></tr>
<tr><td><code id="solvect_chlorine_+3A_residual">residual</code></td>
<td>
<p>Minimum chlorine residual in disinfection segment in mg/L as Cl2.</p>
</td></tr>
<tr><td><code id="solvect_chlorine_+3A_baffle">baffle</code></td>
<td>
<p>Baffle factor - unitless value between 0 and 1.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>CT actual is a function of time, chlorine residual, and baffle factor, whereas CT required is a function of
pH, temperature, chlorine residual, and the standard 0.5 log removal of giardia requirement.  CT required is an
empirical regression equation developed by Smith et al. (1995) to provide conservative estimates for CT tables
in USEPA Disinfection Profiling Guidance.
Log removal is a rearrangement of the CT equations.
</p>


<h3>Value</h3>

<p>A data frame of the required CT, actual CT, and giardia log removal.
</p>


<h3>Source</h3>

<p>Smith et al. (1995)
</p>
<p>USEPA (2020)
</p>
<p>See references list at: <a href="https://github.com/BrownandCaldwell-Public/tidywater/wiki/References">https://github.com/BrownandCaldwell-Public/tidywater/wiki/References</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+define_water">define_water</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
example_ct &lt;- define_water(ph = 7.5, temp = 25) %&gt;%
  solvect_chlorine(time = 30, residual = 1, baffle = 0.7)
</code></pre>

<hr>
<h2 id='solvect_chlorine_once'>Apply 'solvect_chlorine' to a data frame and create new columns with ct and log removals.</h2><span id='topic+solvect_chlorine_once'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+solvect_chlorine">solvect_chlorine</a></code> to be added to a piped data frame.
Three additional columns will be added to the data frame; ct_required (mg/L*min), ct_actual (mg/L*min), glog_removal
</p>


<h3>Usage</h3>

<pre><code class='language-R'>solvect_chlorine_once(
  df,
  input_water = "defined_water",
  time = 0,
  residual = 0,
  baffle = 0,
  water_prefix = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="solvect_chlorine_once_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already been computed using <code><a href="#topic+define_water_chain">define_water_chain</a></code></p>
</td></tr>
<tr><td><code id="solvect_chlorine_once_+3A_input_water">input_water</code></td>
<td>
<p>name of the column of Water class data to be used as the input for this function. Default is &quot;defined_water&quot;.</p>
</td></tr>
<tr><td><code id="solvect_chlorine_once_+3A_time">time</code></td>
<td>
<p>Retention time of disinfection segment in minutes.</p>
</td></tr>
<tr><td><code id="solvect_chlorine_once_+3A_residual">residual</code></td>
<td>
<p>Minimum chlorine residual in disinfection segment in mg/L as Cl2.</p>
</td></tr>
<tr><td><code id="solvect_chlorine_once_+3A_baffle">baffle</code></td>
<td>
<p>Baffle factor - unitless value between 0 and 1.</p>
</td></tr>
<tr><td><code id="solvect_chlorine_once_+3A_water_prefix">water_prefix</code></td>
<td>
<p>name of the input water used for the calculation will be appended to the start of output columns. Default is TRUE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data input comes from a 'water' class column, initialized in <code><a href="#topic+define_water_chain">define_water_chain</a></code>.
</p>
<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame containing the original data frame and columns for required CT, actual CT, and giardia log removal.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
ct_calc &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  solvect_chlorine_once(residual = 2, time = 10)

ozone_resid &lt;- water_df %&gt;%
  mutate(br = 50) %&gt;%
  define_water_chain() %&gt;%
  mutate(
    residual = seq(1, 12, 1),
    time = seq(2, 24, 2),
    baffle = 0.7
  ) %&gt;%
  solvect_chlorine_once()

</code></pre>

<hr>
<h2 id='solvect_o3'>Determine disinfection credit from ozone.</h2><span id='topic+solvect_o3'></span>

<h3>Description</h3>

<p>This function takes a water defined by <code><a href="#topic+define_water">define_water</a></code> and the first order decay curve parameters
from an ozone dose and outputs a dataframe of acutal CT, and log removal for giardia, virus, and crypto
</p>


<h3>Usage</h3>

<pre><code class='language-R'>solvect_o3(water, time, dose, kd, baffle)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="solvect_o3_+3A_water">water</code></td>
<td>
<p>Source water object of class &quot;water&quot; created by <code><a href="#topic+define_water">define_water</a></code>. Water must include ph and temp</p>
</td></tr>
<tr><td><code id="solvect_o3_+3A_time">time</code></td>
<td>
<p>Retention time of disinfection segment in minutes.</p>
</td></tr>
<tr><td><code id="solvect_o3_+3A_dose">dose</code></td>
<td>
<p>Ozone dose in mg/L. This value can also be the y intercept of the decay curve (often slightly lower than ozone dose.)</p>
</td></tr>
<tr><td><code id="solvect_o3_+3A_kd">kd</code></td>
<td>
<p>First order decay constant. This parameter is optional. If not specified, the default ozone decay equations will be used.</p>
</td></tr>
<tr><td><code id="solvect_o3_+3A_baffle">baffle</code></td>
<td>
<p>Baffle factor - unitless value between 0 and 1.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>First order decay curve for ozone has the form: 'residual = dose * exp(kd*time)'. kd should be a negative number.
Actual CT is an integration of the first order curve. The first 30 seconds are removed from the integral to account for
instantaneous demand.
</p>


<h3>Value</h3>

<p>A data frame containing actual CT, giardia log removal, virus log removal, and crypto log removal.
</p>


<h3>Source</h3>

<p>USEPA (2020) Equation 4-4 through 4-7
https://www.epa.gov/system/files/documents/2022-02/disprof_bench_3rules_final_508.pdf
</p>
<p>See references list at: <a href="https://github.com/BrownandCaldwell-Public/tidywater/wiki/References">https://github.com/BrownandCaldwell-Public/tidywater/wiki/References</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+define_water">define_water</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Use kd from experimental data (recommended):
define_water(ph = 7.5, temp = 25) %&gt;%
  solvect_o3(time = 10, dose = 2, kd = -0.5, baffle = 0.9)
define_water(ph = 7.5, alk = 100, doc = 2, uv254 = .02, br = 50) %&gt;%
  solvect_o3(time = 10, dose = 2, baffle = 0.5)

</code></pre>

<hr>
<h2 id='solvect_o3_once'>Apply 'solvect_o3' to a data frame and create new columns with ct and log removals.</h2><span id='topic+solvect_o3_once'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+solvect_o3">solvect_o3</a></code> to be added to a piped data frame.
Three additional columns will be added to the data frame; ct_required (mg/L*min), ct_actual (mg/L*min), glog_removal
</p>


<h3>Usage</h3>

<pre><code class='language-R'>solvect_o3_once(
  df,
  input_water = "defined_water",
  time = 0,
  dose = 0,
  kd = 0,
  baffle = 0,
  water_prefix = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="solvect_o3_once_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already been computed using <code><a href="#topic+define_water_chain">define_water_chain</a></code></p>
</td></tr>
<tr><td><code id="solvect_o3_once_+3A_input_water">input_water</code></td>
<td>
<p>name of the column of Water class data to be used as the input for this function. Default is &quot;defined_water&quot;.</p>
</td></tr>
<tr><td><code id="solvect_o3_once_+3A_time">time</code></td>
<td>
<p>Retention time of disinfection segment in minutes.</p>
</td></tr>
<tr><td><code id="solvect_o3_once_+3A_dose">dose</code></td>
<td>
<p>Ozone dose (mg/L as O3). This value can also be the y intercept of the decay curve (often slightly lower than ozone dose.)</p>
</td></tr>
<tr><td><code id="solvect_o3_once_+3A_kd">kd</code></td>
<td>
<p>First order decay constant. This parameter is optional. If not specified, the default ozone decay equations will be used.</p>
</td></tr>
<tr><td><code id="solvect_o3_once_+3A_baffle">baffle</code></td>
<td>
<p>Baffle factor - unitless value between 0 and 1.</p>
</td></tr>
<tr><td><code id="solvect_o3_once_+3A_water_prefix">water_prefix</code></td>
<td>
<p>name of the input water used for the calculation will be appended to the start of output columns. Default is TRUE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data input comes from a 'water' class column, initialized in <code><a href="#topic+define_water_chain">define_water_chain</a></code>.
</p>
<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame containing the original data frame and columns for required CT, actual CT, and giardia log removal.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
ct_calc &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  solvect_o3_once(dose = 2, kd = -0.5, time = 10)

ozone_resid &lt;- water_df %&gt;%
  mutate(br = 50) %&gt;%
  define_water_chain() %&gt;%
  mutate(
    dose = rep(seq(1, 4, 1), 3),
    time = rep(seq(2, 8, 2), 3),
    baffle = .5
  ) %&gt;%
  solvect_o3_once()

</code></pre>

<hr>
<h2 id='solvedose_alk'>Calculate a desired chemical dose for a target alkalinity</h2><span id='topic+solvedose_alk'></span>

<h3>Description</h3>

<p>This function calculates the required amount of a chemical to dose based on a target alkalinity and existing water quality.
Returns numeric value for dose in mg/L. Uses uniroot on the chemdose_ph function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>solvedose_alk(water, target_alk, chemical)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="solvedose_alk_+3A_water">water</code></td>
<td>
<p>Source water of class &quot;water&quot; created by <code><a href="#topic+define_water">define_water</a></code></p>
</td></tr>
<tr><td><code id="solvedose_alk_+3A_target_alk">target_alk</code></td>
<td>
<p>The final alkalinity in mg/L as CaCO3 to be achieved after the specified chemical is added.</p>
</td></tr>
<tr><td><code id="solvedose_alk_+3A_chemical">chemical</code></td>
<td>
<p>The chemical to be added. Current supported chemicals include:
acids: &quot;hcl&quot;, &quot;h2so4&quot;, &quot;h3po4&quot;, &quot;co2&quot;, bases: &quot;naoh&quot;, &quot;na2co3&quot;, &quot;nahco3&quot;, &quot;caoh2&quot;, &quot;mgoh2&quot;</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric value for the required chemical dose.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+define_water">define_water</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dose_required &lt;- define_water(ph = 7.9, temp = 22, alk = 100, 80, 50) %&gt;%
  solvedose_alk(target_alk = 150, "naoh")
</code></pre>

<hr>
<h2 id='solvedose_alk_once'>Apply 'solvedose_alk' to a dataframe and create a new column with numeric dose</h2><span id='topic+solvedose_alk_once'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+solvedose_alk">solvedose_alk</a></code> to be added to a piped data frame.
Its output is a chemical dose in mg/L.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>solvedose_alk_once(
  df,
  input_water = "defined_water",
  output_column = "dose_required",
  target_alk = NULL,
  chemical = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="solvedose_alk_once_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already been computed using
<code><a href="#topic+define_water_chain">define_water_chain</a></code>. The df may include a column with names for each of the chemicals being dosed.</p>
</td></tr>
<tr><td><code id="solvedose_alk_once_+3A_input_water">input_water</code></td>
<td>
<p>name of the column of water class data to be used as the input. Default is &quot;defined_water&quot;.</p>
</td></tr>
<tr><td><code id="solvedose_alk_once_+3A_output_column">output_column</code></td>
<td>
<p>name of the output column storing doses in mg/L. Default is &quot;dose_required&quot;.</p>
</td></tr>
<tr><td><code id="solvedose_alk_once_+3A_target_alk">target_alk</code></td>
<td>
<p>set a goal for alkalinity using the function argument or a data frame column</p>
</td></tr>
<tr><td><code id="solvedose_alk_once_+3A_chemical">chemical</code></td>
<td>
<p>select the chemical to be used to reach the desired alkalinity using function argument or data frame column</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data input comes from a 'water' class column, initialized in <code><a href="#topic+define_water">define_water</a></code> or <code><a href="#topic+balance_ions">balance_ions</a></code>.
</p>
<p>If the input data frame has column(s) named &quot;target_alk&quot; or &quot;chemical&quot;, the function will use the column(s)
as function argument(s). If these columns aren't present, specify &quot;target_alk&quot; or &quot;chemical&quot; as function arguments.
The chemical names must match the chemical names as displayed in <code><a href="#topic+solvedose_alk">solvedose_alk</a></code>.
To see which chemicals can be dosed, see <code><a href="#topic+solvedose_alk">solvedose_alk</a></code>.
</p>
<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame containing the original data frame and columns for target alkalinity, chemical dosed, and required chemical dose.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+solvedose_alk">solvedose_alk</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  balance_ions_chain() %&gt;%
  mutate(
    target_alk = 300,
    chemical = rep(c("naoh", "na2co3"), 6)
  ) %&gt;%
  solvedose_alk_once()

# When the selected chemical can't raise the alkalinity, the dose_required will be NA
# Eg,soda ash can't bring the alkalinity to 100 when the water's alkalinity is already at 200.

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  solvedose_alk_once(input_water = "defined_water", target_alk = 100, chemical = "na2co3")


example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  mutate(target_alk = seq(100, 210, 10)) %&gt;%
  solvedose_alk_once(chemical = "na2co3")


# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  mutate(target_alk = seq(100, 210, 10)) %&gt;%
  solvedose_alk_once(chemical = "na2co3")

# Optional: explicitly close multisession processing
plan(sequential)


</code></pre>

<hr>
<h2 id='solvedose_ph'>Calculate a desired chemical dose for a target pH</h2><span id='topic+solvedose_ph'></span>

<h3>Description</h3>

<p><code>solvedose_ph</code> calculates the required amount of a chemical to dose based on a target pH and existing water quality.
The function takes an object of class &quot;water&quot; created by <code><a href="#topic+define_water">define_water</a></code>, and user-specified chemical and target pH
and returns a numeric value for the required dose in mg/L.
</p>
<p><code>solvedose_ph</code> uses <code>uniroot</code> on <code><a href="#topic+chemdose_ph">chemdose_ph</a></code> to match the required dose for the requested pH target.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>solvedose_ph(water, target_ph, chemical)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="solvedose_ph_+3A_water">water</code></td>
<td>
<p>Source water of class &quot;water&quot; created by <code><a href="#topic+define_water">define_water</a></code></p>
</td></tr>
<tr><td><code id="solvedose_ph_+3A_target_ph">target_ph</code></td>
<td>
<p>The final pH to be achieved after the specified chemical is added.</p>
</td></tr>
<tr><td><code id="solvedose_ph_+3A_chemical">chemical</code></td>
<td>
<p>The chemical to be added. Current supported chemicals include:
acids: &quot;hcl&quot;, &quot;h2so4&quot;, &quot;h3po4&quot;, &quot;co2&quot;; bases: &quot;naoh&quot;, &quot;na2co3&quot;, &quot;nahco3&quot;, &quot;caoh2&quot;, &quot;mgoh2&quot;</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric value for the required chemical dose.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+define_water">define_water</a></code>, <code><a href="#topic+chemdose_ph">chemdose_ph</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>water &lt;- define_water(ph = 7, temp = 25, alk = 10)

# Calculate required dose of lime to reach pH 8
solvedose_ph(water, target_ph = 8, chemical = "caoh2")

</code></pre>

<hr>
<h2 id='solvedose_ph_once'>Apply 'solvedose_ph' to a dataframe and create a new column with numeric dose</h2><span id='topic+solvedose_ph_once'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+solvedose_ph">solvedose_ph</a></code> to be added to a piped data frame.
Its output is a chemical dose in mg/L.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>solvedose_ph_once(
  df,
  input_water = "defined_water",
  output_column = "dose_required",
  target_ph = NULL,
  chemical = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="solvedose_ph_once_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already been computed using
<code><a href="#topic+define_water_chain">define_water_chain</a></code>. The df may include a column with names for each of the chemicals being dosed.</p>
</td></tr>
<tr><td><code id="solvedose_ph_once_+3A_input_water">input_water</code></td>
<td>
<p>name of the column of water class data to be used as the input. Default is &quot;defined_water&quot;.</p>
</td></tr>
<tr><td><code id="solvedose_ph_once_+3A_output_column">output_column</code></td>
<td>
<p>name of the output column storing doses in mg/L. Default is &quot;dose_required&quot;.</p>
</td></tr>
<tr><td><code id="solvedose_ph_once_+3A_target_ph">target_ph</code></td>
<td>
<p>set a goal for pH using the function argument or a data frame column</p>
</td></tr>
<tr><td><code id="solvedose_ph_once_+3A_chemical">chemical</code></td>
<td>
<p>select the chemical to be used to reach the desired pH using function argument or data frame column</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data input comes from a 'water' class column, initialized in <code><a href="#topic+define_water">define_water</a></code> or <code><a href="#topic+balance_ions">balance_ions</a></code>.
</p>
<p>If the input data frame has column(s) named &quot;target_ph&quot; or &quot;chemical&quot;, the function will use the column(s)
as function argument(s). If these columns aren't present, specify &quot;target_ph&quot; or &quot;chemical&quot; as function arguments.
The chemical names must match the chemical names as displayed in <code><a href="#topic+solvedose_ph">solvedose_ph</a></code>.
To see which chemicals can be dosed, see <code><a href="#topic+solvedose_ph">solvedose_ph</a></code>.
</p>
<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame containing the original data frame and columns for target pH, chemical dosed, and required chemical dose.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+solvedose_ph">solvedose_ph</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(purrr)
library(furrr)
library(tidyr)
library(dplyr)

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  mutate(
    target_ph = 10,
    chemical = rep(c("naoh", "mgoh2"), 6)
  ) %&gt;%
  solvedose_ph_once(input_water = "defined_water")

example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  solvedose_ph_once(input_water = "defined_water", target_ph = 8.8, chemical = "naoh")


example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  mutate(target_ph = seq(9, 10.1, .1)) %&gt;%
  solvedose_ph_once(chemical = "naoh")


# Initialize parallel processing
plan(multisession, workers = 2) # Remove the workers argument to use all available compute
example_df &lt;- water_df %&gt;%
  define_water_chain() %&gt;%
  mutate(target_ph = seq(9, 10.1, .1)) %&gt;%
  solvedose_ph_once(chemical = "naoh")

# Optional: explicitly close multisession processing
plan(sequential)


</code></pre>

<hr>
<h2 id='solvemass_chem'>Convert mg/L of chemical to lb/day</h2><span id='topic+solvemass_chem'></span>

<h3>Description</h3>

<p>This function takes a chemical dose in mg/L, plant flow in MGD, and chemical strength and calculates lb/day of product
</p>


<h3>Usage</h3>

<pre><code class='language-R'>solvemass_chem(dose, flow, strength = 100)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="solvemass_chem_+3A_dose">dose</code></td>
<td>
<p>Chemical dose in mg/L as chemical</p>
</td></tr>
<tr><td><code id="solvemass_chem_+3A_flow">flow</code></td>
<td>
<p>Plant flow in MGD</p>
</td></tr>
<tr><td><code id="solvemass_chem_+3A_strength">strength</code></td>
<td>
<p>Chemical product strength in percent. Defaults to 100 percent.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric value for the chemical mass in lb/day.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>alum_mass &lt;- solvemass_chem(dose = 20, flow = 10, strength = 49)

library(dplyr)
mass_data &lt;- tibble(
  dose = seq(10, 50, 10),
  flow = 10
) %&gt;%
  mutate(mass = solvemass_chem(dose = dose, flow = flow, strength = 49))

</code></pre>

<hr>
<h2 id='solvemass_solids'>Determine solids lb/day</h2><span id='topic+solvemass_solids'></span>

<h3>Description</h3>

<p>This function takes coagulant doses in mg/L as chemical, removed turbidity, and plant flow as MGD to determine solids production.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>solvemass_solids(
  alum = 0,
  ferricchloride = 0,
  ferricsulfate = 0,
  flow,
  turb,
  b = 1.5
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="solvemass_solids_+3A_alum">alum</code></td>
<td>
<p>Amount of hydrated aluminum sulfate added in mg/L as chemical: Al2(SO4)3*14H2O + 6HCO3 -&gt; 2Al(OH)3(am) +3SO4 + 14H2O + 6CO2</p>
</td></tr>
<tr><td><code id="solvemass_solids_+3A_ferricchloride">ferricchloride</code></td>
<td>
<p>Amount of ferric chloride added in mg/L as chemical: FeCl3 + 3HCO3 -&gt; Fe(OH)3(am) + 3Cl + 3CO2</p>
</td></tr>
<tr><td><code id="solvemass_solids_+3A_ferricsulfate">ferricsulfate</code></td>
<td>
<p>Amount of ferric sulfate added in mg/L as chemical: Fe2(SO4)3*8.8H2O + 6HCO3 -&gt; 2Fe(OH)3(am) + 3SO4 + 8.8H2O + 6CO2</p>
</td></tr>
<tr><td><code id="solvemass_solids_+3A_flow">flow</code></td>
<td>
<p>Plant flow in MGD</p>
</td></tr>
<tr><td><code id="solvemass_solids_+3A_turb">turb</code></td>
<td>
<p>Turbidity removed in NTU</p>
</td></tr>
<tr><td><code id="solvemass_solids_+3A_b">b</code></td>
<td>
<p>Correlation factor from turbidity to suspended solids. Defaults to 1.5.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric value for solids mass in lb/day.
</p>


<h3>Source</h3>

<p>https://water.mecc.edu/courses/ENV295Residuals/lesson3b.htm#:~:text=From
</p>


<h3>Examples</h3>

<pre><code class='language-R'>solids_mass &lt;- solvemass_solids(alum = 50, flow = 10, turb = 20)

library(dplyr)
mass_data &lt;- tibble(
  alum = seq(10, 50, 10),
  flow = 10
) %&gt;%
  mutate(mass = solvemass_solids(alum = alum, flow = flow, turb = 20))
#'
</code></pre>

<hr>
<h2 id='solveresid_o3'>Determine ozone decay</h2><span id='topic+solveresid_o3'></span>

<h3>Description</h3>

<p>This function applies the ozone decay model to a water created by <code><a href="#topic+define_water">define_water</a></code>
from U.S. EPA (2001) equation 5-128.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>solveresid_o3(water, dose, time)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="solveresid_o3_+3A_water">water</code></td>
<td>
<p>Source water object of class &quot;water&quot; created by <code><a href="#topic+define_water">define_water</a></code>.</p>
</td></tr>
<tr><td><code id="solveresid_o3_+3A_dose">dose</code></td>
<td>
<p>Applied ozone dose in mg/L</p>
</td></tr>
<tr><td><code id="solveresid_o3_+3A_time">time</code></td>
<td>
<p>Ozone contact time in minutes</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric value for the resiudal ozone.
</p>


<h3>Source</h3>

<p>U.S. EPA (2001)
</p>
<p>See reference list at: <a href="https://github.com/BrownandCaldwell-Public/tidywater/wiki/References">https://github.com/BrownandCaldwell-Public/tidywater/wiki/References</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ozone_resid &lt;- define_water(7, 20, 100, doc = 2, toc = 2.2, uv254 = .02, br = 50) %&gt;%
  solveresid_o3(dose = 2, time = 10)

</code></pre>

<hr>
<h2 id='solveresid_o3_once'>Apply 'solveresid_o3' to a data frame and create a new column with residual ozone dose</h2><span id='topic+solveresid_o3_once'></span>

<h3>Description</h3>

<p>This function allows <code><a href="#topic+solveresid_o3">solveresid_o3</a></code> to be added to a piped data frame.
One additional column will be added to the data frame; the residual ozone dose (mg/L)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>solveresid_o3_once(df, input_water = "defined_water", dose = 0, time = 0)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="solveresid_o3_once_+3A_df">df</code></td>
<td>
<p>a data frame containing a water class column, which has already been computed using <code><a href="#topic+define_water_chain">define_water_chain</a></code></p>
</td></tr>
<tr><td><code id="solveresid_o3_once_+3A_input_water">input_water</code></td>
<td>
<p>name of the column of Water class data to be used as the input for this function. Default is &quot;defined_water&quot;.</p>
</td></tr>
<tr><td><code id="solveresid_o3_once_+3A_dose">dose</code></td>
<td>
<p>Applied ozone dose in mg/L</p>
</td></tr>
<tr><td><code id="solveresid_o3_once_+3A_time">time</code></td>
<td>
<p>Ozone contact time in minutes</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data input comes from a 'water' class column, initialized in <code><a href="#topic+define_water">define_water</a></code> or <code><a href="#topic+balance_ions">balance_ions</a></code>.
</p>
<p>For large datasets, using 'fn_once' or 'fn_chain' may take many minutes to run. These types of functions use the furrr package
for the option to use parallel processing and speed things up. To initialize parallel processing, use
'plan(multisession)' or 'plan(multicore)' (depending on your operating system) prior to your piped code with the
'fn_once' or 'fn_chain' functions. Note, parallel processing is best used when your code block takes more than a minute to run,
shorter run times will not benefit from parallel processing.
</p>


<h3>Value</h3>

<p>A data frame containing the original data frame and columns for ozone dosed, time, and ozone residual.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
ozone_resid &lt;- water_df %&gt;%
  mutate(br = 50) %&gt;%
  define_water_chain() %&gt;%
  solveresid_o3_once(dose = 2, time = 10)

ozone_resid &lt;- water_df %&gt;%
  mutate(br = 50) %&gt;%
  define_water_chain() %&gt;%
  mutate(
    dose = seq(1, 12, 1),
    time = seq(2, 24, 2)
  ) %&gt;%
  solveresid_o3_once()

</code></pre>

<hr>
<h2 id='summarize_wq'>Create summary table from water class</h2><span id='topic+summarize_wq'></span><span id='topic+summarise_wq'></span>

<h3>Description</h3>

<p>This function takes a water data frame defined by <code><a href="#topic+define_water">define_water</a></code> and outputs a formatted summary table of
specified water quality parameters.
</p>
<p><code>summarise_wq()</code> and <code>summarize_wq()</code> are synonyms.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>summarize_wq(water, params = c("general"))

summarise_wq(water, params = c("general"))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summarize_wq_+3A_water">water</code></td>
<td>
<p>Source water vector created by <code><a href="#topic+define_water">define_water</a></code>.</p>
</td></tr>
<tr><td><code id="summarize_wq_+3A_params">params</code></td>
<td>
<p>List of water quality parameters to be summarized. Options include &quot;general&quot;, &quot;ions&quot;, &quot;corrosion&quot;, and &quot;dbps&quot;. Defaults to &quot;general&quot; only.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Use <code><a href="#topic+calculate_corrosion">calculate_corrosion</a></code> for corrosivity indicators and <code><a href="#topic+chemdose_dbp">chemdose_dbp</a></code> for modeled DBP concentrations.
</p>


<h3>Value</h3>

<p>A knitr_kable table of specified water quality parameters.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Summarize general parameters
water_defined &lt;- define_water(7, 20, 50, 100, 80, 10, 10, 10, 10, tot_po4 = 1)
summarize_wq(water_defined)

# Summarize major cations and anions
summarize_wq(water_defined, params = list("ions"))

</code></pre>

<hr>
<h2 id='water_df'>Data frame of water quality parameters</h2><span id='topic+water_df'></span>

<h3>Description</h3>

<p>A dataset containing fabricated water quality to use as tidywater inputs.
Parameters are set to reasonable water quality ranges. Parameters are as follows:
</p>


<h3>Usage</h3>

<pre><code class='language-R'>water_df
</code></pre>


<h3>Format</h3>

<p>A dataframe with 12 rows and 11 columns:
</p>

<dl>
<dt>ph</dt><dd><p>pH in standard units (SU)</p>
</dd>
<dt>temp</dt><dd><p>Temperature in degree C</p>
</dd>
<dt>alk</dt><dd><p>Alkalinity in mg/L as CaCO3</p>
</dd>
<dt>tot_hard</dt><dd><p>Total hardness in mg/L as CaCO3</p>
</dd>
<dt>ca_hard</dt><dd><p>Calcium hardness in mg/L as CaCO3</p>
</dd>
<dt>na</dt><dd><p>Sodium in mg/L Na+</p>
</dd>
<dt>k</dt><dd><p>Potassium in mg/L K+</p>
</dd>
<dt>cl</dt><dd><p>Chloride in mg/L Cl-</p>
</dd>
<dt>so4</dt><dd><p>Sulfate in mg/L SO42-</p>
</dd>
<dt>tot_ocl</dt><dd><p>Total chlorine in mg/L as Cl2</p>
</dd>
<dt>tot_po4</dt><dd><p>Total phosphate in mg/L as PO42-</p>
</dd>
</dl>



<h3>Source</h3>

<p>Fabricated for use in examples.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
