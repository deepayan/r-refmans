<!DOCTYPE html><html><head><title>Help for package nhm</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {nhm}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#ematrix.nhm'>
<p>Compute the misclassification probability matrix from a fitted nhm model</p></a></li>
<li><a href='#example_data1'>
<p>Example of data on a progressive 4 state process</p></a></li>
<li><a href='#example_data2'>
<p>Example of data on a progressive 4 state process with state misclassification</p></a></li>
<li><a href='#initialprob.nhm'>
<p>Compute the initial probability vector from a fitted nhm model</p></a></li>
<li><a href='#model.nhm'>
<p>Model object set up for non-homogeneous Markov models</p></a></li>
<li><a href='#nhm'><p>Fit a non-homogeneous Markov model using maximum likelihood</p></a></li>
<li><a href='#nhm.control'>
<p>Ancillary arguments for controlling nhm fits</p></a></li>
<li><a href='#plot.nhm'>
<p>Plot transition probabilities or intensities from a fitted nhm model.</p></a></li>
<li><a href='#predict.nhm'>
<p>Compute state occupation or transition probabilities from a fitted nhm model</p></a></li>
<li><a href='#print.nhm_score'>
<p>Print output from a score test of a nhm object</p></a></li>
<li><a href='#qmatrix.nhm'>
<p>Compute transition intensities from a fitted nhm model</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Non-Homogeneous Markov and Hidden Markov Multistate Models</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.1</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Andrew Titman &lt;a.titman@lancaster.ac.uk&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Fits non-homogeneous Markov multistate models and misclassification-type hidden Markov models in continuous time to intermittently observed data. Implements the methods in Titman (2011) &lt;<a href="https://doi.org/10.1111%2Fj.1541-0420.2010.01550.x">doi:10.1111/j.1541-0420.2010.01550.x</a>&gt;. Uses direct numerical solution of the Kolmogorov forward equations to calculate the transition probabilities.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats, deSolve, maxLik, mvtnorm</td>
</tr>
<tr>
<td>Suggests:</td>
<td>msm, parallel, splines, R.rsp</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>R.rsp</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-11-02 20:24:41 UTC; andre</td>
</tr>
<tr>
<td>Author:</td>
<td>Andrew Titman [aut, cre]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-11-02 21:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='ematrix.nhm'>
Compute the misclassification probability matrix from a fitted nhm model
</h2><span id='topic+ematrix.nhm'></span>

<h3>Description</h3>

<p>Outputs the matrix of misclasification probabilities in a misclassification type hidden Markov multi-state model fitted using <code><a href="#topic+nhm">nhm</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ematrix.nhm(object, covvalue=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ematrix.nhm_+3A_object">object</code></td>
<td>

<p>Fitted model object produced using <code><a href="#topic+nhm">nhm</a></code>.
</p>
</td></tr>
<tr><td><code id="ematrix.nhm_+3A_covvalue">covvalue</code></td>
<td>

<p>Optional vector of covariate vectors (should be given in the order specified in the <code>covariate</code> option in <code>nhm</code>). If omitted the function will use the mean values of the covariates.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>emat_nhm</code> function used to fit the model is called to obtain the values of the misclassification probabilities at the supplied times for the supplied covariate value.</p>


<h3>Value</h3>

<p>Returns a list containing a matrix of misclassification probabilities and a matrix of corresponding standard errors computed using the delta method.
</p>


<h3>Author(s)</h3>

<p>Andrew Titman <a href="mailto:a.titman@lancaster.ac.uk">a.titman@lancaster.ac.uk</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+nhm">nhm</a></code>, <code><a href="#topic+plot.nhm">plot.nhm</a></code>, <code><a href="#topic+predict.nhm">predict.nhm</a></code>, <code><a href="#topic+qmatrix.nhm">qmatrix.nhm</a></code>
</p>

<hr>
<h2 id='example_data1'>
Example of data on a progressive 4 state process
</h2><span id='topic+example_data1'></span>

<h3>Description</h3>

<p>The observed states and associated observation times for 1000 patients simulated from a 4 state process non-homogeneous Markov model</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("example_data1")</code></pre>


<h3>Format</h3>

<p>A data frame with 3861 rows and 5 variables:
</p>

<dl>
<dt>state</dt><dd><p>Observed state at the time of observation</p>
</dd>
<dt>time</dt><dd><p>Time at which the observation occurred</p>
</dd>
<dt>id</dt><dd><p>Patient identification number</p>
</dd>
<dt>cov1</dt><dd><p>Binary covariate</p>
</dd>
<dt>cov2</dt><dd><p>Continuous covariate</p>
</dd>
</dl>


<hr>
<h2 id='example_data2'>
Example of data on a progressive 4 state process with state misclassification
</h2><span id='topic+example_data2'></span>

<h3>Description</h3>

<p>The observed states and associated observation times for 1000 patients simulated from a 4 state process non-homogeneous Markov model with misclassification to adjacent transient states.</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("example_data1")</code></pre>


<h3>Format</h3>

<p>A data frame with 3864 rows and 5 variables:
</p>

<dl>
<dt>state</dt><dd><p>Observed state at the time of observation</p>
</dd>
<dt>time</dt><dd><p>Time at which the observation occurred</p>
</dd>
<dt>id</dt><dd><p>Patient identification number</p>
</dd>
<dt>cov1</dt><dd><p>Binary covariate</p>
</dd>
<dt>cov2</dt><dd><p>Continuous covariate</p>
</dd>
</dl>


<hr>
<h2 id='initialprob.nhm'>
Compute the initial probability vector from a fitted nhm model
</h2><span id='topic+initialprob.nhm'></span>

<h3>Description</h3>

<p>Outputs the vector of initial state probabilities in a misclassification type hidden Markov multi-state model fitted using <code><a href="#topic+nhm">nhm</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>initialprob.nhm(object, covvalue=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="initialprob.nhm_+3A_object">object</code></td>
<td>

<p>Fitted model object produced using <code><a href="#topic+nhm">nhm</a></code>.
</p>
</td></tr>
<tr><td><code id="initialprob.nhm_+3A_covvalue">covvalue</code></td>
<td>

<p>Optional vector of covariate vectors (should be given in the order specified in the <code>covariate</code> option in <code>nhm</code>). If omitted the function will use the mean values of the covariates.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>initp_nhm</code> function used to fit the model is called to obtain the values of the initial state vector at the supplied times for the supplied covariate value.</p>


<h3>Value</h3>

<p>Returns a list containing a vector of initial state probabilities and a corresponding vector of standard errors computed using the delta method.
</p>


<h3>Author(s)</h3>

<p>Andrew Titman <a href="mailto:a.titman@lancaster.ac.uk">a.titman@lancaster.ac.uk</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+nhm">nhm</a></code>, <code><a href="#topic+ematrix.nhm">ematrix.nhm</a></code>
</p>

<hr>
<h2 id='model.nhm'>
Model object set up for non-homogeneous Markov models
</h2><span id='topic+model.nhm'></span>

<h3>Description</h3>

<p>Sets up a model object in preparation for fitting a non-homogeneous Markov or misclassification type hidden Markov multi-state model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>model.nhm(formula,  data, subject, covariates=NULL,  type, trans,
nonh=NULL, covm=NULL, centre_time=NULL, emat=NULL, ecovm=NULL,
firstobs=NULL, initp=NULL, initp_value=NULL, initcovm=NULL,
splinelist=NULL,degrees=NULL,censor=NULL,
censor.states=NULL,death=FALSE,death.states=NULL,intens=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="model.nhm_+3A_formula">formula</code></td>
<td>

<p>A formula identifying the state and time variables within <code>data</code>, for instance <code>state ~ time</code> would imply the variables are <code>state</code> and <code>time</code>, respectively.
</p>
</td></tr>
<tr><td><code id="model.nhm_+3A_data">data</code></td>
<td>

<p>data frame containing the observed states, observation times, subject identifiers and covariates. Should include initial observation/recruitment times.
</p>
</td></tr>
<tr><td><code id="model.nhm_+3A_subject">subject</code></td>
<td>

<p>Name of the subject identifier variable within the <code>data</code> data frame.
</p>
</td></tr>
<tr><td><code id="model.nhm_+3A_covariates">covariates</code></td>
<td>

<p>A character vector giving the variable names of the covariates to be used in the model
</p>
</td></tr>
<tr><td><code id="model.nhm_+3A_type">type</code></td>
<td>

<p>type of intensity model.
<code>'bespoke'</code>: user supplied,
<code>'weibull'</code>: Model with Weibull transition intensity functions with respect to time.
<code>'gompertz'</code>: Gompertz/exponential growth intensity models.
<code>'bspline'</code>: b-spline function of time model.
</p>
</td></tr>
<tr><td><code id="model.nhm_+3A_trans">trans</code></td>
<td>

<p>Square matrix of viable transitions with dimension equal to the number of states. Impossible transitions should be 0. Others should be labelled consecutively from 1. Labelling transitions with the same value assumes the parameter is shared.
</p>
</td></tr>
<tr><td><code id="model.nhm_+3A_nonh">nonh</code></td>
<td>

<p>Square matrix to indicate non-homogeneous transitions with dimension equal to the number of states. Impossible transitions or homogeneous transitions should be 0. Otherwise label consecutively from 1. Labelling the same value implies the same non-homogeneity. Not required if <code>type='bespoke'</code>. If otherwise omitted a time homogeneous model is fitted.
</p>
</td></tr>
<tr><td><code id="model.nhm_+3A_covm">covm</code></td>
<td>

<p>Either a named list of nstate x nstates indicating the covariate effects with respect to a particular covariate OR
an nstate x nstate x ncov array to indicate covariate effects, where ncov is the length of the supplied <code>covariates</code> vector. 0 implies no covariate effect. Otherwise label consecutively from 1. Labelling the same value implies a common covariate effect. Not required if <code>type='bespoke'</code>.
</p>
</td></tr>
<tr><td><code id="model.nhm_+3A_centre_time">centre_time</code></td>
<td>

<p>Value by which to centre time for Gompertz models. By default the model is of the form <code class="reqn">h(t) = exp(a + bt)</code>, centring  by <code class="reqn">c</code> reparametrizes this to <code class="reqn">h(t) = exp(a + b(t - c))</code>. Centring can improve the convergence of optimization routines.
</p>
</td></tr>
<tr><td><code id="model.nhm_+3A_emat">emat</code></td>
<td>

<p>Square matrix of viable misclassification errors. Must be supplied if the model has misclassification. Impossible errors should be 0. Others should be labelled consecutively. Labelling the same implies a common parameter on the logit scale.
</p>
</td></tr>
<tr><td><code id="model.nhm_+3A_ecovm">ecovm</code></td>
<td>

<p>Either a named list of nstate x nstates indicating the covariate effects with respect to a particular covariate OR
an nstate x nstate x ncov array to indicate indicate covariate effects on misclassification, where ncov is the length of the supplied <code>covariates</code> vector. 0 implies no covariate effect. Otherwise label consecutively from 1. Labelling the same value implies a common covariate effect.
</p>
</td></tr>
<tr><td><code id="model.nhm_+3A_firstobs">firstobs</code></td>
<td>

<p>For misclassification models: Form of the first observation for each subject in the data.
<code>'exact'</code>: Initial state not subject to misclassification (default)
<code>'absent'</code>: No initial state. First observation is ignored and state occupied is based on initial probabilities model.
<code>'misc'</code>: Initial state is subject to misclassification.
</p>
</td></tr>
<tr><td><code id="model.nhm_+3A_initp">initp</code></td>
<td>

<p>For misclassification models: Numerical vector of length nstate to define the model for the initial probabilities. The first entry should be zero. Should be numbered consecutively. If the same number is repeated implies a shared parameter. If absent then initial probabilities taken from <code>initp_value</code>.
</p>
</td></tr>
<tr><td><code id="model.nhm_+3A_initp_value">initp_value</code></td>
<td>

<p>For misclassification models where <code>firstobs="absent"</code> or <code>"misc"</code>: Fixed value of initial probabilities is missing. Should be a numerical vector of length nstate. Ignored if <code>initp</code> is present. Default if absent is <code>c(1,0,...)</code>.
</p>
</td></tr>
<tr><td><code id="model.nhm_+3A_initcovm">initcovm</code></td>
<td>

<p>For misclassification models; Either a named list of vectors of length nstate, or an nstate x ncovs matrix to specify the covariate effects on misclassification probabilities. 0 implies no covariate effect. Otherwise label consecutively from 1. Labelling the same value implies a common covariate effect.
</p>
</td></tr>
<tr><td><code id="model.nhm_+3A_splinelist">splinelist</code></td>
<td>

<p>For bspline models only: list (of length equal to the number of nonhomogeneous transitions) of knot point locations including the boundary knots.
</p>
</td></tr>
<tr><td><code id="model.nhm_+3A_degrees">degrees</code></td>
<td>

<p>For bspline models only: optional vector (of length equal to number of nonhomogeneous transitions) of degrees of splines. Defaults to 3 if not specified.
</p>
</td></tr>
<tr><td><code id="model.nhm_+3A_censor">censor</code></td>
<td>

<p>Vector of censor state indicators in the data. Note that censored observations can only occur as the last observation for a subject.
</p>
</td></tr>
<tr><td><code id="model.nhm_+3A_censor.states">censor.states</code></td>
<td>

<p>List of vectors of states in which subject occupy if censored by corresponding censor state indicator. Can be a vector if only one censor state marker is present.
</p>
</td></tr>
<tr><td><code id="model.nhm_+3A_death">death</code></td>
<td>

<p>Setting <code>TRUE</code> assumes exact death times are present in the data set
</p>
</td></tr>
<tr><td><code id="model.nhm_+3A_death.states">death.states</code></td>
<td>

<p>Vector specifying which states have exact death times. Should only correspond to absorbing states.
</p>
</td></tr>
<tr><td><code id="model.nhm_+3A_intens">intens</code></td>
<td>

<p>Optional supplied intensity function. See below for details.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function allows the model to be specified and creates the metadata needed to use <code>nhm</code> to fit it. The function automatically generates a function <code>intens</code> which defines the generator matrix of the model and its first derivatives as a function of time  <code>t</code>, covariates <code>z</code> and the underlying parameters <code>x</code>, provided the model is of Weibull, Gompertz or B-spline type.
</p>
<p>Alternatively, <code>type='bespoke'</code> can be chosen. In which case it is necessary for the user to supply a function <code>intens</code>. This must have arguments <code>t, z, x</code> and return a list consisting of a component <code>q</code> which is the nstate x nstate generator matrix, and <code>dq</code> which is the nstate x nstate x nparQ first derivatives of the generator matrix with respect to the parameters of the model, where nparQ is the number of parameters in the model for the intensities only (excludes parameters for the emat or initp). Since unrestricted maximization is used so the parameters must take values on <code>-Inf, Inf</code>. Note that using a hard-coded version via <code>type='bespoke'</code> can be substantially faster than the analogous automatically generated function, so for large models or datasets it may be advantageous to code directly.
</p>
<p>For misclassification type models, the function also automatically creates functions <code>emat_nhm</code> and <code>initp_nhm</code>, to allow the misclassification probability matrix and the initial probability vectors and their derivatives to be calculated at given parameter and covariate values. In each case, a multinomial logistic regression is used for the covariate model. User specification of the misclassification probability function or initial probability vector is not currently possible.
</p>


<h3>Value</h3>

<p>Returns an object of class <code>nhm_model</code> containing the necessary metadata needed to use <code>nhm</code> to fit the model.
</p>


<h3>Author(s)</h3>

<p>Andrew Titman <a href="mailto:a.titman@lancaster.ac.uk">a.titman@lancaster.ac.uk</a></p>


<h3>See Also</h3>

<p><code><a href="#topic+nhm">nhm</a></code>
</p>

<hr>
<h2 id='nhm'>Fit a non-homogeneous Markov model using maximum likelihood</h2><span id='topic+nhm'></span>

<h3>Description</h3>

<p>Fit a continuous-time Markov or hidden Markov multi-state model
by maximum likelihood. Observations of the process
can be made at arbitrary times, or the exact times of
transition between states can be known.
Covariates can be fitted to the Markov chain transition intensities or
to the hidden Markov observation process.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nhm(model_object, initial=NULL, gen_inits=FALSE,
control, score_test=FALSE, fixedpar=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nhm_+3A_model_object">model_object</code></td>
<td>
<p>Model object created using <code><a href="#topic+model.nhm">model.nhm</a></code></p>
</td></tr>
<tr><td><code id="nhm_+3A_initial">initial</code></td>
<td>
<p>Vector of initial parameter values</p>
</td></tr>
<tr><td><code id="nhm_+3A_gen_inits">gen_inits</code></td>
<td>
<p>If <code>TRUE</code>, then initial values for the
transition intensities are generated automatically using the method
in <code>crudeinits.msm</code> from the <span class="pkg">msm</span> package.  This is not available for models with misclassified states.
If <code>FALSE</code> a BHHH algorithm implemented using <span class="pkg">maxLik</span> is used.</p>
</td></tr>
<tr><td><code id="nhm_+3A_control">control</code></td>
<td>
<p>Object of class <code>nhm.control</code> specifying various settings for the solution of the KFEs and the optimization. See <code><a href="#topic+nhm.control">nhm.control</a></code> for default settings.
</p>
</td></tr>
<tr><td><code id="nhm_+3A_score_test">score_test</code></td>
<td>
<p>If <code>TRUE</code> just the gradient and Fisher information at the supplied values will be computed to allow score tests to be performed.</p>
</td></tr>
<tr><td><code id="nhm_+3A_fixedpar">fixedpar</code></td>
<td>
<p>Numerical vector indicating which parameters are taken as fixed at the value specified by <code>initial</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For more details about the methodology behind the <span class="pkg">nhm</span> package, see Titman (2011) and the package vignette.
</p>


<h3>Value</h3>

<p>By default returns an object of class <code>nhm</code> containing model output data such as the estimated parameters, maximized likelihood value, information matrix etc. The object can be used with <code>print</code>, <code>predict</code>, <code>plot</code> and <code>anova</code>.
</p>
<p>If <code>score.test=TRUE</code> then returns an object of class <code>nhm_score</code>. See <code><a href="#topic+print.nhm_score">print.nhm_score</a></code> for more details.
</p>


<h3>Author(s)</h3>

<p>Andrew Titman <a href="mailto:a.titman@lancaster.ac.uk">a.titman@lancaster.ac.uk</a></p>


<h3>References</h3>

<p>Titman AC. Flexible Nonhomogeneous Markov Models for Panel Observed Data. <em>Biometrics</em>, 2011. 67, 780-787.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+model.nhm">model.nhm</a></code>, <code><a href="#topic+nhm.control">nhm.control</a></code>, <code><a href="#topic+plot.nhm">plot.nhm</a></code>, <code><a href="#topic+predict.nhm">predict.nhm</a></code>, <code><a href="#topic+print.nhm_score">print.nhm_score</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>### Example dataset
### For further examples, see the vignette
trans &lt;- rbind(c(0,1,0,0),c(0,0,2,0),c(0,0,0,3),rep(0,4))
nonh &lt;- rbind(c(0,1,0,0),c(0,0,2,0),c(0,0,0,3),rep(0,4))
gomp_model &lt;- model.nhm(state~time, data=example_data1, subject = id,
                        type="gompertz",trans=trans,nonh=nonh)
initial_val &lt;- c(-0.65,-0.45,-0.55,0,0,0)
gomp_fit &lt;- nhm(gomp_model,initial=initial_val,control=nhm.control(obsinfo=FALSE))
gomp_fit
plot(gomp_fit)
plot(gomp_fit,what="intensities")
</code></pre>

<hr>
<h2 id='nhm.control'>
Ancillary arguments for controlling nhm fits
</h2><span id='topic+nhm.control'></span>

<h3>Description</h3>

<p>This is used to set various logical or numeric parameters controlling a non-homogeneous Markov model fit. Usually to be used within a call to <code>nhm</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nhm.control(tmax=NULL, coarsen=FALSE, coarsen.vars=NULL, coarsen.lv=NULL,
checks=FALSE,rtol=1e-6, atol=1e-6, fishscore=NULL, linesearch=FALSE, damped=FALSE,
damppar=0,obsinfo=TRUE,splits=NULL,ncores=1,print.level=2, maxLikcontrol=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nhm.control_+3A_tmax">tmax</code></td>
<td>
<p>Optional parameter to set the maximum time to which the Kolmogorov Forward equations should be integrated. Defaults to 1+max(time) if left unspecified.</p>
</td></tr>
<tr><td><code id="nhm.control_+3A_coarsen">coarsen</code></td>
<td>
<p>If <code>TRUE</code> the covariate values will be subjected to coarsening using K-means clustering, so there are fewer unique values. This is useful for large datasets with continuous covariates.</p>
</td></tr>
<tr><td><code id="nhm.control_+3A_coarsen.vars">coarsen.vars</code></td>
<td>
<p>Vector of the index of covariates which require coarsening. Must be supplied if <code>coarsen=TRUE</code>.</p>
</td></tr>
<tr><td><code id="nhm.control_+3A_coarsen.lv">coarsen.lv</code></td>
<td>
<p>Number of unique covariate values to which the covariates should be coarsened.</p>
</td></tr>
<tr><td><code id="nhm.control_+3A_checks">checks</code></td>
<td>
<p>If <code>TRUE</code> some basic checks will be performed to ensure the accuracy of the supplied <code>intens</code> function. Mainly useful if a user defined <code>type="bespoke"</code> intensity function is used for which the default is <code>TRUE</code>, otherwise default is <code>FALSE</code></p>
</td></tr>
<tr><td><code id="nhm.control_+3A_rtol">rtol</code></td>
<td>
<p>Relative error tolerance to be passed to lsoda, default is 1e-6</p>
</td></tr>
<tr><td><code id="nhm.control_+3A_atol">atol</code></td>
<td>
<p>Absolute error tolerance to be passed to lsoda, default is 1e-6</p>
</td></tr>
<tr><td><code id="nhm.control_+3A_fishscore">fishscore</code></td>
<td>
<p>If <code>TRUE</code> then the Fisher scoring algorithm will be used provided the model has no censoring, exact death times or misclassification. This is generally faster, but less robust than the BHHH algorithm.</p>
</td></tr>
<tr><td><code id="nhm.control_+3A_linesearch">linesearch</code></td>
<td>
<p>If <code>TRUE</code> and <code>fishscore=TRUE</code> then a line search will be performed to find the best step length in the Fisher scoring algorithm.</p>
</td></tr>
<tr><td><code id="nhm.control_+3A_damped">damped</code></td>
<td>
<p>If <code>TRUE</code> the Fisher scoring algorithm will be damped (e.g. Levenberg type algorithm). Useful if some parameters are close to being unidentifiable.</p>
</td></tr>
<tr><td><code id="nhm.control_+3A_damppar">damppar</code></td>
<td>
<p>Numerical damping parameter to be applied if <code>damped=TRUE</code></p>
</td></tr>
<tr><td><code id="nhm.control_+3A_obsinfo">obsinfo</code></td>
<td>
<p>If <code>TRUE</code> the observed Fisher information will be computed in addition to the expected information when the Fisher scoring algorithm is used. For optimization with <code><a href="maxLik.html#topic+maxLik">maxLik</a></code> the observed Fisher information will be used as the Hessian rather than the squared gradient vectors. </p>
</td></tr>
<tr><td><code id="nhm.control_+3A_splits">splits</code></td>
<td>
<p>Optional vector of intermediate split times for solving the ODEs. Only needed if P(0,t) becomes singular for some t causing the optimization to stop. Should be a set of consecutive values less than tmax.</p>
</td></tr>
<tr><td><code id="nhm.control_+3A_ncores">ncores</code></td>
<td>
<p>Number of cores to use. 1= no parallelization, 2 or more: Uses <code><a href="parallel.html#topic+mclapply">mclapply</a></code> when solving ODEs with different covariates patterns.</p>
</td></tr>
<tr><td><code id="nhm.control_+3A_print.level">print.level</code></td>
<td>
<p>For <code><a href="maxLik.html#topic+maxLik">maxLik</a></code> optimization; level of detail to print. Integer from 0 to 3. Defaults to 2.</p>
</td></tr>
<tr><td><code id="nhm.control_+3A_maxlikcontrol">maxLikcontrol</code></td>
<td>
<p>For <code><a href="maxLik.html#topic+maxLik">maxLik</a></code> optimization; optional list of control parameters to be passed to <code><a href="maxLik.html#topic+maxLik">maxLik</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>tmax</code>, <code>rtol</code> and <code>atol</code> refer directly to parameters with the <code>lsoda</code> function in <code>deSolve</code> and relate to how the Kolmogorov Forward Equations are numerically solved.
</p>
<p><code>coarsen</code>, <code>coarsen.vars</code> and <code>coarsen.lv</code> are useful in situations where it is computationally infeasible (or unattractive) to compute the exact solution for all covariate patterns. Implements an approximate solution in which the covariates are coarsened using K-means clustering (as proposed in Titman (2011)).
</p>
<p><code>linesearch</code>, <code>damped</code>, <code>damppar</code> are specific to the Fisher scoring algorithm.
</p>
<p>Setting <code>obsinfo=TRUE</code> will tend to give more accurate standard error estimates and gives more opportunity to check for non-convergence of the maximum likelihood procedure.
</p>
<p>The option <code>splits</code> modifies the way in which the transition probabilities are computed. By default, <code><a href="#topic+nhm">nhm</a></code> solves a single system of differential equations starting from 0 to obtain <code class="reqn">P(0,t)</code> and then uses inversion of the Chapman-Kolmogorov equation <code class="reqn">P(0,t) =P(0,t_0)P(t_0,t)</code> to find <code class="reqn">P(t_0,t)</code> for a given <code class="reqn">t_0 &gt; 0</code>. In some cases <code class="reqn">P(0,t_0)</code> will be singular or effectively singular. If a split is specified at <code class="reqn">s</code> then <code>nhm</code> will find <code class="reqn">P(t_0,t)</code> for <code class="reqn">t_0 &gt; t*</code> by solving the system of equations <code class="reqn">P(t*,t)</code> where <code class="reqn">t*</code> is the smallest interval start time greater than or equal to <code class="reqn">s</code> within the data. If <code><a href="#topic+nhm">nhm</a></code> fails due to the lack of split times, the error message will advise on the interval in which the split should be introduced. Note that the need for splits can also arise if the initial parameters specified are inappropriate. It may often be better to find more appropriate initial parameter estimates,for instance by fitting the analogous homogeneous model in <code><a href="msm.html#topic+msm">msm</a></code>, rather than adding multiple split times.
</p>
<p><code>ncores</code> allows parallel processing to be used, through the <span class="pkg">parallel</span> package, to simultaneously solve the systems of differential equations for each covariate pattern. If <code>ncores &gt; 1</code> then <code>ncores</code> defines the <code>mc.cores</code> value in <code>mclapply</code>. Note that the data needs to include multiple covariate patterns for this to successfully increase computation speed.
</p>


<h3>Value</h3>

<p>A list containing the values of each of the above constants
</p>


<h3>Author(s)</h3>

<p>Andrew Titman <a href="mailto:a.titman@lancaster.ac.uk">a.titman@lancaster.ac.uk</a></p>


<h3>References</h3>

<p>Titman AC. Flexible Nonhomogeneous Markov Models for Panel Observed Data. <em>Biometrics</em>, 2011. 67, 780-787.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+nhm">nhm</a></code>
</p>

<hr>
<h2 id='plot.nhm'>
Plot transition probabilities or intensities from a fitted nhm model.
</h2><span id='topic+plot.nhm'></span>

<h3>Description</h3>

<p>Produces plots of the transition probabilites or intensities from a non-homogeneous Markov or misclassification type hidden Markov multi-state model fitted using <code><a href="#topic+nhm">nhm</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'nhm'
plot(x, what="probabilities",time0=0, state0=1, times=NULL,
covvalue=NULL, ci=TRUE, sim=FALSE, coverage=0.95, B=1000, rtol=1e-6,
atol=1e-6, main_arg=NULL, xlab="Time", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.nhm_+3A_x">x</code></td>
<td>

<p>Fitted model object produced using <code><a href="#topic+nhm">nhm</a></code>.
</p>
</td></tr>
<tr><td><code id="plot.nhm_+3A_what">what</code></td>
<td>

<p>Character string to indicate what should be plotted. Options are <code>probabilities</code> (the default which produces transition probabilities) or <code>intensities</code> (to produce a plot of the intensities)
</p>
</td></tr>
<tr><td><code id="plot.nhm_+3A_time0">time0</code></td>
<td>

<p>Starting time from which to compute the transition probabilities or intensities. Defaults to 0.
</p>
</td></tr>
<tr><td><code id="plot.nhm_+3A_state0">state0</code></td>
<td>

<p>Starting state from which to compute the transition probabilities. Defaults to 1. Not required for transition intensities
</p>
</td></tr>
<tr><td><code id="plot.nhm_+3A_times">times</code></td>
<td>

<p>Optional vector of times at which to compute the transition probabilities or intensities. If omitted, the probabilities/intensities will be computed at a sequence of times of length 100 from <code>time0</code> to the maximum observed time in the data.
</p>
</td></tr>
<tr><td><code id="plot.nhm_+3A_covvalue">covvalue</code></td>
<td>

<p>Optional vector of covariate vectors (should be given in the order specified in the <code>covariate</code> option in <code>nhm</code>). 
If omitted the function will use the mean values of the covariates.
</p>
</td></tr>
<tr><td><code id="plot.nhm_+3A_ci">ci</code></td>
<td>

<p>If <code>TRUE</code> pointwise confidence intervals will be shown in addition to the point estimates.
</p>
</td></tr>
<tr><td><code id="plot.nhm_+3A_sim">sim</code></td>
<td>

<p>If <code>TRUE</code> a simulation Delta method (Mandel, 2013) will be used to calculate the confidence intervals. Otherwise the standard Delta method will be applied.
</p>
</td></tr>
<tr><td><code id="plot.nhm_+3A_coverage">coverage</code></td>
<td>

<p>Coverage level (should be a value between 0 and 1) for the confidence intervals. Defaults to 0.95.
</p>
</td></tr>
<tr><td><code id="plot.nhm_+3A_b">B</code></td>
<td>

<p>Number of simulations to be performed to compute the simulation Delta method.
</p>
</td></tr>
<tr><td><code id="plot.nhm_+3A_rtol">rtol</code></td>
<td>

<p>Relative tolerance parameter to be used by <code>lsoda</code> when solving the differential equations for the transition probabilites.
</p>
</td></tr>
<tr><td><code id="plot.nhm_+3A_atol">atol</code></td>
<td>

<p>Absolute tolerance parameter to be used by <code>lsoda</code> when solving the differential equations for the transition probabilites.</p>
</td></tr>
<tr><td><code id="plot.nhm_+3A_main_arg">main_arg</code></td>
<td>

<p>Character string specifying beginning of title to be given to each of the plot panes generated.
</p>
</td></tr>
<tr><td><code id="plot.nhm_+3A_xlab">xlab</code></td>
<td>

<p>Character string specifying x-axis label to be given to each plot.
</p>
</td></tr>
<tr><td><code id="plot.nhm_+3A_...">...</code></td>
<td>

<p>Other items to be passed to the function. Currently not used.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Computation is performed by calling <code><a href="#topic+predict.nhm">predict.nhm</a></code>, for the transition probabilities, or <code>qmatrix.nhm</code> for the intensities (see for more details).
</p>


<h3>Value</h3>

<p>Generates a multi-pane plot for each state. If values are required they can be obtained using <code><a href="#topic+predict.nhm">predict.nhm</a></code>.
</p>


<h3>Author(s)</h3>

<p>Andrew Titman <a href="mailto:a.titman@lancaster.ac.uk">a.titman@lancaster.ac.uk</a>
</p>


<h3>References</h3>

<p>Mandel M. Simulation-based confidence intervals for functions with complicated derivatives. 2013. <em>The American Statistician</em>, 67. 76-81.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+nhm">nhm</a></code>, <code><a href="#topic+predict.nhm">predict.nhm</a></code>, <code><a href="#topic+qmatrix.nhm">qmatrix.nhm</a></code>
</p>

<hr>
<h2 id='predict.nhm'>
Compute state occupation or transition probabilities from a fitted nhm model
</h2><span id='topic+predict.nhm'></span>

<h3>Description</h3>

<p>Outputs the transition probabilites from a non-homogeneous Markov or misclassification type hidden Markov multi-state model fitted using <code><a href="#topic+nhm">nhm</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'nhm'
predict(object, time0=0, state0=1, times=NULL, covvalue=NULL,
ci=TRUE, sim=FALSE, coverage=0.95, B=1000, rtol=1e-6,
atol=1e-6, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict.nhm_+3A_object">object</code></td>
<td>

<p>Fitted model object produced using <code><a href="#topic+nhm">nhm</a></code>.
</p>
</td></tr>
<tr><td><code id="predict.nhm_+3A_time0">time0</code></td>
<td>

<p>Starting time from which to compute the transition probabilities. Defaults to 0.
</p>
</td></tr>
<tr><td><code id="predict.nhm_+3A_state0">state0</code></td>
<td>

<p>Starting state from which to compute the transition probabilities. Defaults to 1.
</p>
</td></tr>
<tr><td><code id="predict.nhm_+3A_times">times</code></td>
<td>

<p>Optional vector of times at which to compute the transition probabilities. If omitted, the probabilities will be computed at a sequence of times from <code>time0</code> to the maximum observed time in the data.
</p>
</td></tr>
<tr><td><code id="predict.nhm_+3A_covvalue">covvalue</code></td>
<td>

<p>Optional vector of covariate vectors (should be given in the order specified in the <code>covariate</code> option in <code>nhm</code>). If omitted the function will use the mean values of the covariates.
</p>
</td></tr>
<tr><td><code id="predict.nhm_+3A_ci">ci</code></td>
<td>

<p>If <code>TRUE</code> pointwise confidence intervals will be shown in addition to the point estimates.
</p>
</td></tr>
<tr><td><code id="predict.nhm_+3A_sim">sim</code></td>
<td>

<p>If <code>TRUE</code> a simulation Delta method (Mandel, 2013) will be used to calculate the confidence intervals. Otherwise the standard Delta method will be applied.
</p>
</td></tr>
<tr><td><code id="predict.nhm_+3A_coverage">coverage</code></td>
<td>

<p>Coverage level (should be a value between 0 and 1) for the confidence intervals. Defaults to 0.95.
</p>
</td></tr>
<tr><td><code id="predict.nhm_+3A_b">B</code></td>
<td>

<p>Number of simulations to be performed to compute the simulation Delta method.
</p>
</td></tr>
<tr><td><code id="predict.nhm_+3A_rtol">rtol</code></td>
<td>

<p>Relative tolerance parameter to be used by <code>lsoda</code> when solving the differential equations
</p>
</td></tr>
<tr><td><code id="predict.nhm_+3A_atol">atol</code></td>
<td>

<p>Absolute tolerance parameter to be used by <code>lsoda</code> when solving the differential equations</p>
</td></tr>
<tr><td><code id="predict.nhm_+3A_...">...</code></td>
<td>

<p>Other items to be passed to the function. Currently not used.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The same approach as in the main <code>nhm</code> function of numerically solving the system of differential equations is used to compute transition probabilities based on the maximum likelihood estimates found in <code>nhm</code> and assuming a specific vector of covariates.
</p>
<p>If the simulation delta method approach is specified then the function will generate <code>B</code> parameter vectors from the asymptotic distribution of the MLE and solve the system of equations for each of them, before finding pointwise percentile bootstrap confidence intervals from them.</p>


<h3>Value</h3>

<p>Returns a list containing the vector of times at which the probabilities are computed, a matrix of probabilities for each state at each of the times. If confidence intervals are requested then the lower and upper limits are also provided.
</p>
<p>If transition intensity (as opposed to probability) estimates are required then <code><a href="#topic+qmatrix.nhm">qmatrix.nhm</a></code> should be used.
</p>


<h3>Author(s)</h3>

<p>Andrew Titman <a href="mailto:a.titman@lancaster.ac.uk">a.titman@lancaster.ac.uk</a>
</p>


<h3>References</h3>

<p>Mandel M. Simulation-based confidence intervals for functions with complicated derivatives. 2013. <em>The American Statistician</em>, 67. 76-81.</p>


<h3>See Also</h3>

<p><code><a href="#topic+nhm">nhm</a></code>, <code><a href="#topic+plot.nhm">plot.nhm</a></code>, <code><a href="#topic+qmatrix.nhm">qmatrix.nhm</a></code>
</p>

<hr>
<h2 id='print.nhm_score'>
Print output from a score test of a nhm object
</h2><span id='topic+print.nhm_score'></span>

<h3>Description</h3>

<p>Print output from a score test based on parameters supplied to <code><a href="#topic+nhm">nhm</a></code> with <code>score_test=TRUE</code> specified.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'nhm_score'
print(x, which_comp = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.nhm_score_+3A_x">x</code></td>
<td>

<p>An object of class <code>nhm_code</code> generated using <code><a href="#topic+nhm">nhm</a></code>.
</p>
</td></tr>
<tr><td><code id="print.nhm_score_+3A_which_comp">which_comp</code></td>
<td>

<p>Optional vector to specify which of the parameters are to be tested. If omitted, the function will assume all parameters governing non-homogeneity are to be tested.
</p>
<p>Must be supplied if <code>type='bespoke'</code> was specified when creating the object.
</p>
</td></tr>
<tr><td><code id="print.nhm_score_+3A_...">...</code></td>
<td>

<p>Other parameters to be supplied. Currently ignored.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function provides usable output from specifying <code>score_test=TRUE</code> when using <code><a href="#topic+nhm">nhm</a></code>. It is most useful to provide a quick(er) test of whether there may be non-homogeneity in a specific model. Note that the model assumes the initial parameters correspond to the constrained maximum likelihood estimate (for instance a model with all the parameters relating to time homogeneity).
</p>
<p>The method can be used to compute the local score tests of homogeneity proposed by de Stavola (1988) if <code>type="gompertz"</code> is specified in <code><a href="#topic+nhm">nhm</a></code>.
</p>
<p>If <code>fisherscore=TRUE</code> in <code><a href="#topic+nhm">nhm</a></code> then the expected Fisher information is used. Otherwise, the empirical mean of the squared gradient terms (as used in the BHHH algorithm) is used to estimate the information.
</p>


<h3>Value</h3>

<p>Prints the results of a score test.
</p>


<h3>Author(s)</h3>

<p>Andrew Titman <a href="mailto:a.titman@lancaster.ac.uk">a.titman@lancaster.ac.uk</a></p>


<h3>References</h3>

<p>de Stavola BL. Testing Departures from Time Homogeneity in Multistate Markov Processes. <em>Journal of the Royal Statistical Society: Series C (Applied Statistics)</em> 1988. 37. 242-250.</p>


<h3>See Also</h3>

<p><code><a href="#topic+nhm">nhm</a></code>
</p>

<hr>
<h2 id='qmatrix.nhm'>
Compute transition intensities from a fitted nhm model
</h2><span id='topic+qmatrix.nhm'></span>

<h3>Description</h3>

<p>Outputs the transition intensities from a non-homogeneous Markov or misclassification type hidden Markov multi-state model fitted using <code><a href="#topic+nhm">nhm</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>qmatrix.nhm(object, time0=0, times=NULL, covvalue=NULL, ci=TRUE, sim=FALSE,
coverage=0.95, B=1000)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="qmatrix.nhm_+3A_object">object</code></td>
<td>

<p>Fitted model object produced using <code><a href="#topic+nhm">nhm</a></code>.
</p>
</td></tr>
<tr><td><code id="qmatrix.nhm_+3A_time0">time0</code></td>
<td>

<p>Starting time from which to compute the transition intensities. Defaults to 0.
</p>
</td></tr>
<tr><td><code id="qmatrix.nhm_+3A_times">times</code></td>
<td>

<p>Optional vector of times at which to compute the transition intensities. If omitted, the intensities will be computed at a sequence of times from <code>time0</code> to the maximum observed time in the data.
</p>
</td></tr>
<tr><td><code id="qmatrix.nhm_+3A_covvalue">covvalue</code></td>
<td>

<p>Optional vector of covariate vectors (should be given in the order specified in the <code>covariate</code> option in <code>nhm</code>). If omitted the function will use the mean values of the covariates.
</p>
</td></tr>
<tr><td><code id="qmatrix.nhm_+3A_ci">ci</code></td>
<td>

<p>If <code>TRUE</code> pointwise confidence intervals will be shown in addition to the point estimates.
</p>
</td></tr>
<tr><td><code id="qmatrix.nhm_+3A_sim">sim</code></td>
<td>

<p>If <code>TRUE</code> a simulation Delta method (Mandel, 2013) will be used to calculate the confidence intervals. Otherwise the standard Delta method will be applied.
</p>
</td></tr>
<tr><td><code id="qmatrix.nhm_+3A_coverage">coverage</code></td>
<td>

<p>Coverage level (should be a value between 0 and 1) for the confidence intervals. Defaults to 0.95.
</p>
</td></tr>
<tr><td><code id="qmatrix.nhm_+3A_b">B</code></td>
<td>

<p>Number of simulations to be performed to compute the simulation Delta method.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>intens</code> function used to fit the model is called to obtain the values of the transition intensities at the supplied times for the supplied covariate value.
</p>
<p>If the simulation delta method approach is specified then the function will generate <code>B</code> parameter vectors from the asymptotic distribution of the MLE and compute the intensities for each of them, before finding pointwise percentile bootstrap confidence intervals from them.</p>


<h3>Value</h3>

<p>Returns a list containing the vector of times at which the intensities are computed, a matrix of probabilities for each state at each of the times. If confidence intervals are requested then the lower and upper limits are also provided.
</p>
<p>If transition probability (as opposed to intensity) estimates are required then <code><a href="#topic+predict.nhm">predict.nhm</a></code> should be used.
</p>


<h3>Author(s)</h3>

<p>Andrew Titman <a href="mailto:a.titman@lancaster.ac.uk">a.titman@lancaster.ac.uk</a>
</p>


<h3>References</h3>

<p>Mandel M. Simulation-based confidence intervals for functions with complicated derivatives. 2013. <em>The American Statistician</em>, 67. 76-81.</p>


<h3>See Also</h3>

<p><code><a href="#topic+nhm">nhm</a></code>, <code><a href="#topic+plot.nhm">plot.nhm</a></code>, <code><a href="#topic+predict.nhm">predict.nhm</a></code>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
