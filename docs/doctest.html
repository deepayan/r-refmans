<!DOCTYPE html><html lang="en"><head><title>Help for package doctest</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {doctest}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#doctest-package'><p>Write testthat tests for your examples, using roxygen tags</p></a></li>
<li><a href='#doctest-tag'><p>Start a doctest</p></a></li>
<li><a href='#doctestExample-tag'><p>Add an example from a file</p></a></li>
<li><a href='#dt_roclet'><p>Create the doctest roclet</p></a></li>
<li><a href='#expect-tag'><p>Create an expectation</p></a></li>
<li><a href='#expectRaw-tag'><p>Create an expectation as-is</p></a></li>
<li><a href='#omit-tag'><p>Exclude example code from a test</p></a></li>
<li><a href='#snap-tag'><p>Create a snapshot test</p></a></li>
<li><a href='#test_doctests'><p>Test doctests in a package</p></a></li>
<li><a href='#testRaw-tag'><p>Add a line of code to the test</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Generate Tests from Examples Using 'roxygen' and 'testthat'</td>
</tr>
<tr>
<td>Version:</td>
<td>0.3.0</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>David Hugh-Jones &lt;davidhughjones@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Creates 'testthat' tests from 'roxygen' examples using simple tags.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Imports:</td>
<td>cli, fs, pkgload, purrr, rlang, roxygen2, testthat</td>
</tr>
<tr>
<td>Suggests:</td>
<td>covr, knitr, lifecycle, rmarkdown</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://hughjonesd.github.io/doctest/">https://hughjonesd.github.io/doctest/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/hughjonesd/doctest/issues">https://github.com/hughjonesd/doctest/issues</a></td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-01-11 21:54:34 UTC; davidhugh-jones</td>
</tr>
<tr>
<td>Author:</td>
<td>David Hugh-Jones [aut, cre]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-01-11 22:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='doctest-package'>Write testthat tests for your examples, using roxygen tags</h2><span id='topic+doctest'></span><span id='topic+doctest-package'></span>

<h3>Description</h3>

<p>The doctest package lets you test the code in your &quot;Examples&quot;
section in .Rd files. It uses the roxygen2 and testthat packages.
For more information, see <a href="#topic++40doctest">@doctest</a> and <a href="#topic++40expect">@expect</a>.
</p>


<h3>Details</h3>



<h4>Example</h4>

<p>Here's some <a href="https://roxygen2.r-lib.org">roxygen</a> documentation for a function:
</p>
<div class="sourceCode r"><pre>
#' Fibonacci function 
#' 
#' @param n Integer
#' @return The nth Fibonacci number
#' 
#' @doctest
#'
#' @expect type("integer")
#' fib(2)
#'
#' n &lt;- 6 
#' @expect equal(8)
#' fib(n)
#' 
#' @expect warning("not numeric")
#' fib("a")
#'
#' @expect warning("NA")
#' fib(NA)
fib &lt;- function (n) {
  if (! is.numeric(n)) warning("n is not numeric")
  ...
}
</pre></div>
<p>Instead of an <code style="white-space: pre;">&#8288;@examples&#8288;</code> section, we have a <code style="white-space: pre;">&#8288;@doctest&#8288;</code> section.
</p>
<p>This will create tests like:
</p>
<div class="sourceCode"><pre># Generated by doctest: do not edit by hand
# Please edit file in R/&lt;text&gt;

test_that("Doctest: fib", {
  # Created from @doctest for `fib`
  # Source file: &lt;text&gt;
  # Source line: 7
  expect_type(fib(2), "integer")
  n &lt;- 6
  expect_equal(fib(n), 8)
  expect_warning(fib("a"), "not numeric")
  expect_warning(fib(NA), "NA")
})
</pre></div>
<p>The .Rd file will be created as normal, with an example section like:
</p>
<div class="sourceCode"><pre>\examples{
fib(2)

n &lt;- 6 
fib(n)
fib("a")
fib(NA)
}
</pre></div>



<h4>Usage</h4>

<p>Install doctest from <a href="https://r-universe.dev">r-universe</a>:
</p>
<div class="sourceCode r"><pre>install.packages("doctest", repos = c("https://hughjonesd.r-universe.dev", 
                                      "https://cloud.r-project.org"))
</pre></div>
<p>Or from CRAN:
</p>
<div class="sourceCode r"><pre>install.packages("doctest")
</pre></div>
<p>Or get the development version:
</p>
<div class="sourceCode r"><pre>devtools::install("hughjonesd/doctest")
</pre></div>
<p>To use doctest in your package, alter its DESCRIPTION file to add the
<code>dt_roclet</code> roclet and <code>"doctest"</code> package to roxygen:
</p>
<div class="sourceCode r"><pre>Roxygen: list(roclets = c("collate", "rd", "namespace", 
              "doctest::dt_roclet"), packages = "doctest") 
</pre></div>
<p>Then use <code>roxygen2::roxygenize()</code> or <code>devtools::document()</code> to build
your package documentation.
</p>
<p>Doctest is <a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>.
</p>



<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: David Hugh-Jones <a href="mailto:davidhughjones@gmail.com">davidhughjones@gmail.com</a>
</p>


<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://hughjonesd.github.io/doctest/">https://hughjonesd.github.io/doctest/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/hughjonesd/doctest/issues">https://github.com/hughjonesd/doctest/issues</a>
</p>
</li></ul>


<hr>
<h2 id='doctest-tag'>Start a doctest</h2><span id='topic+doctest-tag'></span><span id='topic++40doctest'></span>

<h3>Description</h3>

<p><code style="white-space: pre;">&#8288;@doctest&#8288;</code> starts a doctest: a code example that also contains one or more
<a href="testthat.html#topic+testthat-package">testthat</a> expectations.
</p>


<h3>Details</h3>

<p>Use <code style="white-space: pre;">&#8288;@doctest&#8288;</code> where you would usually use <code style="white-space: pre;">&#8288;@examples&#8288;</code>. Then add
<a href="#topic++40expect">@expect</a> and <a href="#topic++40expectRaw">@expectRaw</a> tags beneath it to create expectations.
</p>
<p>By default, a test labelled &quot;Example: &lt;object name&gt;&quot; is created. You
can put a different label after <code style="white-space: pre;">&#8288;@doctest&#8288;</code>:
</p>
<div class="sourceCode"><pre>#' @doctest Positive numbers
#'
#' x &lt;- 1
#' @expect equal(x)
#' abs(x)
#'
#' @doctest Negative numbers
#' x &lt;- -1
#' @expect equal(-x)
#' abs(x)
</pre></div>
<p>You can have more than one <code style="white-space: pre;">&#8288;@doctest&#8288;</code> tag in a roxygen block. Each doctest
will create a new test, but they will all be merged into a single Rd example.
Each doctest must contain an independent unit of code. For example, this
won't work:
</p>
<div class="sourceCode"><pre>#' @doctest Test x
#' @expect equal(2)
#' x &lt;- 1 + 1
#'
#' @doctest Keep testing x
#' @expect equal(4)
#' x^2
#' # Test will error, because `x` has not been defined here
</pre></div>
<p>A test will only be written if the <code style="white-space: pre;">&#8288;@doctest&#8288;</code> section has at least one
<a href="#topic++40expect">@expect</a> or <a href="#topic++40expectRaw">@expectRaw</a> in it. This lets you change <code style="white-space: pre;">&#8288;@examples&#8288;</code> to
<code style="white-space: pre;">&#8288;@doctest&#8288;</code> in your code, without generating unexpected tests.
</p>

<hr>
<h2 id='doctestExample-tag'>Add an example from a file</h2><span id='topic+doctestExample-tag'></span><span id='topic++40doctestExample'></span>

<h3>Description</h3>

<p><code style="white-space: pre;">&#8288;@doctestExample path/to/file.R&#8288;</code> is a drop-in replacement for
<code style="white-space: pre;">&#8288;@example path/to/file.R&#8288;</code>. It doesn't add the contents of <code>file.R</code> to
the test.
</p>


<h3>Details</h3>

<p>If you have complex examples you may want to store them separately.
Roxygen2 uses the <code style="white-space: pre;">&#8288;@example&#8288;</code> tag for this. <code style="white-space: pre;">&#8288;@doctestExample&#8288;</code> does the
same: it adds the contents of its file to the resulting example.
Suppose <code>man/R/example-code.R</code> contains the line:
</p>
<div class="sourceCode"><pre>2 + 2
</pre></div>
<p>Then the following roxygen:
</p>
<div class="sourceCode"><pre>#' @doctest
#'
#' @expect equal(2)
#' 1 + 1
#' @doctestExample man/R/example-code.R
</pre></div>
<p>will generate an example like:
</p>
<div class="sourceCode"><pre>1 + 1
2 + 2
</pre></div>
<p>At present, <code style="white-space: pre;">&#8288;@doctestExample&#8288;</code> doesn't add any code to the tests.
</p>
<p><code style="white-space: pre;">&#8288;@doctestExample&#8288;</code> was added after doctest 0.2.0.
</p>

<hr>
<h2 id='dt_roclet'>Create the doctest roclet</h2><span id='topic+dt_roclet'></span>

<h3>Description</h3>

<p>You can use this in your package DESCRIPTION like this:
</p>
<div class="sourceCode r"><pre>Roxygen: list(roclets = c("collate", "rd", "namespace", "doctest::dt_roclet"))
</pre></div>


<h3>Usage</h3>

<pre><code class='language-R'>dt_roclet()
</code></pre>


<h3>Value</h3>

<p>The doctest roclet
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
roxygen2::roxygenize(roclets = "doctest::dt_roclet")

## End(Not run)
</code></pre>

<hr>
<h2 id='expect-tag'>Create an expectation</h2><span id='topic+expect-tag'></span><span id='topic++40expect'></span>

<h3>Description</h3>

<p><code style="white-space: pre;">&#8288;@expect&#8288;</code> creates an expectation for your example code.
</p>


<h3>Details</h3>

<p>Use <code style="white-space: pre;">&#8288;@expect&#8288;</code> to create a <a href="testthat.html#topic+testthat-package">testthat</a> expectation.
</p>
<div class="sourceCode"><pre>#' @doctest
#'
#' @expect equals(4)
#' 2 + 2
#'
#' f &lt;- function () warning("Watch out")
#' @expect warning()
#' f()
</pre></div>
<p>The next expression will be inserted as the first
argument to the <code style="white-space: pre;">&#8288;expect_*&#8288;</code> call.
</p>
<p>Don't include the <code>expect_</code> prefix.
</p>
<p>If you want to include the expression in a different
place or places, use a dot <code>.</code>:
</p>
<div class="sourceCode"><pre>@expect equals(., rev(.))
c("T", "E", "N", "E", "T")
</pre></div>
<p>The <code style="white-space: pre;">&#8288;@expect&#8288;</code> tag and code must fit on a single line.
</p>


<h3>See Also</h3>

<p>Other expectations: 
<code><a href="#topic+expectRaw-tag">expectRaw-tag</a></code>,
<code><a href="#topic+snap-tag">snap-tag</a></code>
</p>

<hr>
<h2 id='expectRaw-tag'>Create an expectation as-is</h2><span id='topic+expectRaw-tag'></span><span id='topic++40expectRaw'></span>

<h3>Description</h3>

<p><code style="white-space: pre;">&#8288;@expectRaw&#8288;</code> creates an expectation for your example code, without adding
the next expression as the subject.
</p>


<h3>Details</h3>

<p><code style="white-space: pre;">&#8288;@expectRaw&#8288;</code> creates a <a href="testthat.html#topic+testthat-package">testthat</a> expectation.
Unlike <a href="#topic++40expect">@expect</a>, it doesn't insert the subsequent expression as the first
argument.
</p>
<div class="sourceCode"><pre>#' @doctest
#'
#' x &lt;- 2 + 2
#' @expectRaw equals(x, 4)
#'
#' f &lt;- function () warning("Watch out")
#' @expectRaw warning(f())
</pre></div>
<p>Don't include the <code>expect_</code> prefix.
</p>
<p>The <code style="white-space: pre;">&#8288;@expectRaw&#8288;</code> tag and code must fit on a single line.
</p>


<h3>See Also</h3>

<p>Other expectations: 
<code><a href="#topic+expect-tag">expect-tag</a></code>,
<code><a href="#topic+snap-tag">snap-tag</a></code>
</p>

<hr>
<h2 id='omit-tag'>Exclude example code from a test</h2><span id='topic+omit-tag'></span><span id='topic+resume-tag'></span><span id='topic++40omit'></span><span id='topic++40resume'></span>

<h3>Description</h3>

<p><code style="white-space: pre;">&#8288;@omit&#8288;</code> excludes example code from a test until the next tag.
Use <code style="white-space: pre;">&#8288;@resume&#8288;</code> to restart including code without creating an expectation.
</p>


<h3>Details</h3>

<p>Use <code style="white-space: pre;">&#8288;@omit&#8288;</code> to avoid redundant or noisy code:
</p>
<div class="sourceCode"><pre>#' @doctest
#'
#' @expect equal(0)
#' sin(0)
#'
#' @omit
#' curve(sin(x), 0, 2 * pi)
#'
#' @expect equal(1)
#' cos(0)
</pre></div>
<p><code style="white-space: pre;">&#8288;@omit&#8288;</code> is separate from <code style="white-space: pre;">&#8288;\donttest&#8288;</code> and <code style="white-space: pre;">&#8288;\dontrun&#8288;</code> tags in Rd files. This
allows you to test code that would cause an error if run by R CMD CHECK. If
you also want R CMD CHECK to skip your code, you should use <code style="white-space: pre;">&#8288;\donttest{}&#8288;</code>
separately (see
<a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Writing-R-documentation-files">writing R extensions</a>).
</p>
<p>Remember that the main purpose of examples is to document your package for
your users. If your code is getting too different from your example, consider
splitting it off into a proper test file. You can do this by renaming it and
deleting the <code style="white-space: pre;">&#8288;Generated by doctest&#8288;</code> comment.
</p>

<hr>
<h2 id='snap-tag'>Create a snapshot test</h2><span id='topic+snap-tag'></span><span id='topic++40snap'></span>

<h3>Description</h3>

<p><code style="white-space: pre;">&#8288;@snap&#8288;</code> creates a
<a href="https://testthat.r-lib.org/articles/snapshotting.html">snapshot test</a>
for your example. It is shorthand for <code style="white-space: pre;">&#8288;@expect snapshot()&#8288;</code>.
</p>


<h3>Details</h3>

<p>Often, examples show complex output to the user. If this output changes,
you want to check that it still &quot;looks right&quot;. Snapshot tests help by
failing when the output changes, and allowing you to review and approve
the new output.
</p>
<div class="sourceCode"><pre>#' @doctest
#'
#' @snap
#' summary(lm(Petal.Width ~ Species, data = iris))
</pre></div>


<h3>See Also</h3>

<p>Other expectations: 
<code><a href="#topic+expect-tag">expect-tag</a></code>,
<code><a href="#topic+expectRaw-tag">expectRaw-tag</a></code>
</p>

<hr>
<h2 id='test_doctests'>Test doctests in a package</h2><span id='topic+test_doctests'></span>

<h3>Description</h3>

<p>This is a utility function to run doctests in a local source package.
It calls <code><a href="testthat.html#topic+test_package">testthat::test_local()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>test_doctests(path = ".", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="test_doctests_+3A_path">path</code></td>
<td>
<p>Path to package</p>
</td></tr>
<tr><td><code id="test_doctests_+3A_...">...</code></td>
<td>
<p>Passed to <code><a href="testthat.html#topic+test_package">testthat::test_local()</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The result of <code><a href="testthat.html#topic+test_package">testthat::test_local()</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  test_doctests()

## End(Not run)
</code></pre>

<hr>
<h2 id='testRaw-tag'>Add a line of code to the test</h2><span id='topic+testRaw-tag'></span><span id='topic++40testRaw'></span>

<h3>Description</h3>

<p><code style="white-space: pre;">&#8288;@testRaw&#8288;</code> adds an arbitrary line of code to your test, without including it
in the .Rd example.
</p>


<h3>Details</h3>

<p><code style="white-space: pre;">&#8288;@testRaw&#8288;</code> adds an arbitrary line of code to your test:
</p>
<div class="sourceCode"><pre>#' @doctest
#' @testRaw skip_on_cran("Takes too long")
#' @expect equal(6765)
#' fibonacci(20)
</pre></div>
<p>Unless your doctest has at least one <a href="#topic++40expect">@expect</a> or <a href="#topic++40expectRaw">@expectRaw</a> tag, no test
will be created. So use those tags, not <code style="white-space: pre;">&#8288;@testRaw&#8288;</code>, to add expectations.
</p>
<p>Remember that the main purpose of examples is to document your package for
your users. If your code is getting too different from your example, consider
splitting it off into a proper test file. To do this, rename the
file in <code>tests/testthat</code>, and deleting the <code style="white-space: pre;">&#8288;Generated by doctest&#8288;</code> comment.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
