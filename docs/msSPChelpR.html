<!DOCTYPE html><html><head><title>Help for package msSPChelpR</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {msSPChelpR}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#%&gt;%'><p>Pipe operator</p></a></li>
<li><a href='#asir'><p>Calculate age-standardized incidence rates</p></a></li>
<li><a href='#calc_futime'><p>Calculate follow-up time per case until end of follow-up depending on pat_status - tidyverse version</p></a></li>
<li><a href='#calc_futime_tt'><p>Calculate follow-up time per case until end of follow-up depending on pat_status - tidytable version</p></a></li>
<li><a href='#calc_refrates'><p>Calculate age-, sex-, cohort-, region-specific incidence rates from a cohort</p></a></li>
<li><a href='#histgroup_iarc'><p>Create variable for groups of malignant neoplasms considered to be histologically 'different' for the purpose of defining multiple tumors, ICD-O-3</p></a></li>
<li><a href='#ir_crosstab'><p>Calculate crude incidence rates and crosstabulate results by break variables</p></a></li>
<li><a href='#ir_crosstab_byfutime'><p>Calculate crude incidence rates and cross-tabulate results by break variables; cumulative FU-times as are used as xbreak_var</p></a></li>
<li><a href='#msSPChelpR'><p>msSPChelpR</p></a></li>
<li><a href='#msSPChelpR-package'><p>msSPChelpR: Helper Functions for Second Primary Cancer Analyses</p></a></li>
<li><a href='#pat_status'><p>Determine patient status at specific end of follow-up - tidyverse version</p></a></li>
<li><a href='#pat_status_tt'><p>Determine patient status at specific end of follow-up - tidytable version</p></a></li>
<li><a href='#population_us'><p>US Populations Data</p></a></li>
<li><a href='#renumber_time_id'><p>Renumber the time ID per case (i.e. Tumor sequence)</p></a></li>
<li><a href='#renumber_time_id_tt'><p>Renumber the time ID per case (i.e. Tumor sequence) - tidytable version</p></a></li>
<li><a href='#reshape_long'><p>Reshape dataset to long format - stats::reshape version</p></a></li>
<li><a href='#reshape_long_tidyr'><p>Reshape dataset to wide format - tidyr version</p></a></li>
<li><a href='#reshape_long_tt'><p>Reshape dataset to wide format - tidytable version</p></a></li>
<li><a href='#reshape_wide'><p>Reshape dataset to wide format</p></a></li>
<li><a href='#reshape_wide_tidyr'><p>Reshape dataset to wide format - tidyr version</p></a></li>
<li><a href='#reshape_wide_tt'><p>Reshape dataset to wide format - tidytable version</p></a></li>
<li><a href='#sir_byfutime'><p>Calculate standardized incidence ratios with custom grouping variables stratified by follow-up time</p></a></li>
<li><a href='#sir_ratio'><p>Calculate Ratio of two SIRs or SMRs</p></a></li>
<li><a href='#standard_population'><p>Standard Populations Data</p></a></li>
<li><a href='#summarize_sir_results'><p>Summarize detailed SIR results</p></a></li>
<li><a href='#us_refrates_icd2'><p>US Reference Rates for Cancer Data (ICD-O 2digit code)</p></a></li>
<li><a href='#us_second_cancer'><p>US Second Cancer Data</p></a></li>
<li><a href='#vital_status'><p>Determine vital status at end of follow-up depending on pat_status - tidyverse version</p></a></li>
<li><a href='#vital_status_tt'><p>Determine vital status at end of follow-up depending on pat_status - tidytable version</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Helper Functions for Second Primary Cancer Analyses</td>
</tr>
<tr>
<td>Version:</td>
<td>0.9.1</td>
</tr>
<tr>
<td>Description:</td>
<td>A collection of helper functions for analyzing Second Primary Cancer data, 
    including functions to reshape data, to calculate patient states and analyze cancer incidence.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://marianschmidt.github.io/msSPChelpR/">https://marianschmidt.github.io/msSPChelpR/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/marianschmidt/msSPChelpR/issues">https://github.com/marianschmidt/msSPChelpR/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5)</td>
</tr>
<tr>
<td>Imports:</td>
<td>cli, dplyr (&ge; 1.0.0), lubridate, magrittr, purrr, rlang (&ge;
0.1.2), sjlabelled, stringr, tidyselect, tidytable (&ge; 0.9.0),
tidyr (&ge; 1.0.0)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>haven, tibble, rmarkdown, knitr, testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.0</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-01-23 22:22:49 UTC; maria</td>
</tr>
<tr>
<td>Author:</td>
<td>Marian Eberl <a href="https://orcid.org/0000-0001-6584-3197"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Marian Eberl &lt;marian.eberl@tum.de&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-01-23 22:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='+25+26gt+3B+25'>Pipe operator</h2><span id='topic++25+3E+25'></span>

<h3>Description</h3>

<p>See <code>magrittr::<a href="magrittr.html#topic+pipe">%&gt;%</a></code> for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lhs %&gt;% rhs
</code></pre>

<hr>
<h2 id='asir'>Calculate age-standardized incidence rates</h2><span id='topic+asir'></span>

<h3>Description</h3>

<p>Calculate age-standardized incidence rates
</p>


<h3>Usage</h3>

<pre><code class='language-R'>asir(
  df,
  dattype = NULL,
  std_pop = "ESP2013",
  truncate_std_pop = FALSE,
  futime_src = "refpop",
  summarize_groups = "none",
  count_var,
  stdpop_df = standard_population,
  refpop_df = population,
  region_var = NULL,
  age_var = NULL,
  sex_var = NULL,
  year_var = NULL,
  site_var = NULL,
  futime_var = NULL,
  pyar_var = NULL,
  alpha = 0.05
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="asir_+3A_df">df</code></td>
<td>
<p>dataframe in wide format</p>
</td></tr>
<tr><td><code id="asir_+3A_dattype">dattype</code></td>
<td>
<p>can be &quot;zfkd&quot; or &quot;seer&quot; or NULL. Will set default variable names if dattype is &quot;seer&quot; or &quot;zfkd&quot;. Default is NULL.</p>
</td></tr>
<tr><td><code id="asir_+3A_std_pop">std_pop</code></td>
<td>
<p>can be either &quot;ESP2013, ESP1976, WHO1960, WHO2000</p>
</td></tr>
<tr><td><code id="asir_+3A_truncate_std_pop">truncate_std_pop</code></td>
<td>
<p>if TRUE standard population will be truncated for all age-groups that do not occur in df</p>
</td></tr>
<tr><td><code id="asir_+3A_futime_src">futime_src</code></td>
<td>
<p>can be either &quot;refpop&quot; or &quot;cohort&quot;. Default is &quot;refpop&quot;.</p>
</td></tr>
<tr><td><code id="asir_+3A_summarize_groups">summarize_groups</code></td>
<td>
<p>option to define summarizing stratified groups. Default is &quot;none&quot;.
If you want to define variables that should be summarized into one group, you can chose from region_var, sex_var, year_var.
Define multiple summarize variables by summarize_groups = c(&quot;region&quot;, &quot;sex&quot;, &quot;year&quot;)</p>
</td></tr>
<tr><td><code id="asir_+3A_count_var">count_var</code></td>
<td>
<p>variable to be counted as observed case. Should be 1 for case to be counted.</p>
</td></tr>
<tr><td><code id="asir_+3A_stdpop_df">stdpop_df</code></td>
<td>
<p>df where standard population is defined. It is assumed that stdpop_df has the columns &quot;sex&quot; for biological sex, &quot;age&quot; for age-groups,
&quot;standard_pop&quot; for name of standard population (e.g. &quot;European Standard Population 2013) and &quot;population_n&quot; for size of standard population age-group.
stdpop_df must use the same category coding of age and sex as age_var and sex_var.</p>
</td></tr>
<tr><td><code id="asir_+3A_refpop_df">refpop_df</code></td>
<td>
<p>df where reference population data is defined. Only required if option futime = &quot;refpop&quot; is chosen. It is assumed that refpop_df has the columns
&quot;region&quot; for region, &quot;sex&quot; for biological sex, &quot;age&quot; for age-groups (can be single ages or 5-year brackets), &quot;year&quot; for time period (can be single year or 5-year brackets),
&quot;population_pyar&quot; for person-years at risk in the respective age/sex/year cohort.
refpop_df must use the same category coding of age, sex, region, year and site as age_var, sex_var, region_var, year_var and site_var.</p>
</td></tr>
<tr><td><code id="asir_+3A_region_var">region_var</code></td>
<td>
<p>variable in df that contains information on region where case was incident. Default is set if dattype is given.</p>
</td></tr>
<tr><td><code id="asir_+3A_age_var">age_var</code></td>
<td>
<p>variable in df that contains information on age-group. Default is set if dattype is given.</p>
</td></tr>
<tr><td><code id="asir_+3A_sex_var">sex_var</code></td>
<td>
<p>variable in df that contains information on biological sex. Default is set if dattype is given.</p>
</td></tr>
<tr><td><code id="asir_+3A_year_var">year_var</code></td>
<td>
<p>variable in df that contains information on year or year-period when case was incident. Default is set if dattype is given.</p>
</td></tr>
<tr><td><code id="asir_+3A_site_var">site_var</code></td>
<td>
<p>variable in df that contains information on ICD code of case diagnosis. Default is set if dattype is given.</p>
</td></tr>
<tr><td><code id="asir_+3A_futime_var">futime_var</code></td>
<td>
<p>variable in df that contains follow-up time per person (in years) in cohort (can only be used with futime_src = &quot;cohort&quot;). Default is set if dattype is given.</p>
</td></tr>
<tr><td><code id="asir_+3A_pyar_var">pyar_var</code></td>
<td>
<p>variable in refpop_df that contains person-years-at-risk in reference population (can only be used with futime_src = &quot;refpop&quot;) Default is set if dattype is given.</p>
</td></tr>
<tr><td><code id="asir_+3A_alpha">alpha</code></td>
<td>
<p>significance level for confidence interval calculations. Default is alpha = 0.05 which will give 95 percent confidence intervals.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>df
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#load sample data
data("us_second_cancer")
data("standard_population")
data("population_us")

#make wide data as this is the required format
usdata_wide &lt;- us_second_cancer %&gt;%
                    #only use sample
                    dplyr::filter(as.numeric(fake_id) &lt; 200000) %&gt;%
                    msSPChelpR::reshape_wide_tidyr(case_id_var = "fake_id", 
                    time_id_var = "SEQ_NUM", timevar_max = 2)
                    
#create count variable
usdata_wide &lt;- usdata_wide %&gt;%
                    dplyr::mutate(count_spc = dplyr::case_when(is.na(t_site_icd.2)   ~ 1,
                    TRUE ~ 0))
 
#remove cases for which no reference population exists
usdata_wide &lt;- usdata_wide %&gt;%
                    dplyr::filter(t_yeardiag.2 %in% c("1990 - 1994", "1995 - 1999", "2000 - 2004",
                                                       "2005 - 2009", "2010 - 2014"))
                    

#now we can run the function
msSPChelpR::asir(usdata_wide,
      dattype = "seer",
      std_pop = "ESP2013",
      truncate_std_pop = FALSE,
      futime_src = "refpop",
      summarize_groups = "none",
      count_var = "count_spc",
      refpop_df = population_us,
      region_var = "registry.1", 
      age_var = "fc_agegroup.1",
      sex_var = "sex.1",
      year_var = "t_yeardiag.2", 
      site_var = "t_site_icd.2",
      pyar_var = "population_pyar")


</code></pre>

<hr>
<h2 id='calc_futime'>Calculate follow-up time per case until end of follow-up depending on pat_status - tidyverse version</h2><span id='topic+calc_futime'></span>

<h3>Description</h3>

<p>Calculate follow-up time per case until end of follow-up depending on pat_status - tidyverse version
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calc_futime(
  wide_df,
  futime_var_new = "p_futimeyrs",
  fu_end,
  dattype = NULL,
  check = TRUE,
  time_unit = "years",
  status_var = "p_status",
  lifedat_var = NULL,
  fcdat_var = NULL,
  spcdat_var = NULL,
  quiet = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calc_futime_+3A_wide_df">wide_df</code></td>
<td>
<p>dataframe in wide format</p>
</td></tr>
<tr><td><code id="calc_futime_+3A_futime_var_new">futime_var_new</code></td>
<td>
<p>Name of the newly calculated variable for follow-up time. Default is p_futimeyrs.</p>
</td></tr>
<tr><td><code id="calc_futime_+3A_fu_end">fu_end</code></td>
<td>
<p>end of follow-up in time format YYYY-MM-DD.</p>
</td></tr>
<tr><td><code id="calc_futime_+3A_dattype">dattype</code></td>
<td>
<p>can be &quot;zfkd&quot; or &quot;seer&quot; or NULL. Will set default variable names if dattype is &quot;seer&quot; or &quot;zfkd&quot;. Default is NULL.</p>
</td></tr>
<tr><td><code id="calc_futime_+3A_check">check</code></td>
<td>
<p>Check newly calculated variable p_status by printing frequency table. Default is TRUE.</p>
</td></tr>
<tr><td><code id="calc_futime_+3A_time_unit">time_unit</code></td>
<td>
<p>Unit of follow-up time (can be &quot;days&quot;, &quot;weeks&quot;, &quot;months&quot;, &quot;years&quot;). Default is &quot;years&quot;.</p>
</td></tr>
<tr><td><code id="calc_futime_+3A_status_var">status_var</code></td>
<td>
<p>Name of the patient status variable that was previously created. Default is p_status.</p>
</td></tr>
<tr><td><code id="calc_futime_+3A_lifedat_var">lifedat_var</code></td>
<td>
<p>Name of variable containing Date of Death. Will override dattype preset.</p>
</td></tr>
<tr><td><code id="calc_futime_+3A_fcdat_var">fcdat_var</code></td>
<td>
<p>Name of variable containing Date of Primary Cancer diagnosis. Will override dattype preset.</p>
</td></tr>
<tr><td><code id="calc_futime_+3A_spcdat_var">spcdat_var</code></td>
<td>
<p>Name of variable containing Date of SPC diagnosis Will override dattype preset.</p>
</td></tr>
<tr><td><code id="calc_futime_+3A_quiet">quiet</code></td>
<td>
<p>If TRUE, warnings and messages will be suppressed. Default is FALSE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>wide_df
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#load sample data
data("us_second_cancer")

#prep step - make wide data as this is the required format
usdata_wide &lt;- us_second_cancer %&gt;%
                    msSPChelpR::reshape_wide_tidyr(case_id_var = "fake_id", 
                    time_id_var = "SEQ_NUM", timevar_max = 10)
                    
#prep step - calculate p_spc variable
usdata_wide &lt;- usdata_wide %&gt;%
                 dplyr::mutate(p_spc = dplyr::case_when(is.na(t_site_icd.2)   ~ "No SPC",
                                                       !is.na(t_site_icd.2)   ~ "SPC developed",
                                                       TRUE ~ NA_character_)) %&gt;%
                 dplyr::mutate(count_spc = dplyr::case_when(is.na(t_site_icd.2)   ~ 1,
                                                              TRUE ~ 0))
                                                              
#prep step - create patient status variable
usdata_wide &lt;- usdata_wide %&gt;%
                  msSPChelpR::pat_status(., fu_end = "2017-12-31", dattype = "seer",
                                         status_var = "p_status", life_var = "p_alive.1",
                                         birthdat_var = "datebirth.1", lifedat_var = "datedeath.1")
 
#now we can run the function
msSPChelpR::calc_futime(usdata_wide, 
                        futime_var_new = "p_futimeyrs", 
                        fu_end = "2017-12-31",
                        dattype = "seer", 
                        time_unit = "years",
                        status_var = "p_status",
                        lifedat_var = "datedeath.1", 
                        fcdat_var = "t_datediag.1", 
                        spcdat_var = "t_datediag.2")

</code></pre>

<hr>
<h2 id='calc_futime_tt'>Calculate follow-up time per case until end of follow-up depending on pat_status - tidytable version</h2><span id='topic+calc_futime_tt'></span>

<h3>Description</h3>

<p>Calculate follow-up time per case until end of follow-up depending on pat_status - tidytable version
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calc_futime_tt(
  wide_df,
  futime_var_new = "p_futimeyrs",
  fu_end,
  dattype = NULL,
  check = TRUE,
  time_unit = "years",
  status_var = "p_status",
  lifedat_var = NULL,
  fcdat_var = NULL,
  spcdat_var = NULL,
  quiet = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calc_futime_tt_+3A_wide_df">wide_df</code></td>
<td>
<p>dataframe or data.table in wide format</p>
</td></tr>
<tr><td><code id="calc_futime_tt_+3A_futime_var_new">futime_var_new</code></td>
<td>
<p>Name of the newly calculated variable for follow-up time. Default is p_futimeyrs.</p>
</td></tr>
<tr><td><code id="calc_futime_tt_+3A_fu_end">fu_end</code></td>
<td>
<p>end of follow-up in time format YYYY-MM-DD.</p>
</td></tr>
<tr><td><code id="calc_futime_tt_+3A_dattype">dattype</code></td>
<td>
<p>can be &quot;zfkd&quot; or &quot;seer&quot; or NULL. Will set default variable names if dattype is &quot;seer&quot; or &quot;zfkd&quot;. Default is NULL.</p>
</td></tr>
<tr><td><code id="calc_futime_tt_+3A_check">check</code></td>
<td>
<p>Check newly calculated variable &quot;p_futimeyrs&quot; by printing frequency table. Default is TRUE.</p>
</td></tr>
<tr><td><code id="calc_futime_tt_+3A_time_unit">time_unit</code></td>
<td>
<p>Unit of follow-up time (can be &quot;days&quot;, &quot;weeks&quot;, &quot;months&quot;, &quot;years&quot;). Default is &quot;years&quot;.</p>
</td></tr>
<tr><td><code id="calc_futime_tt_+3A_status_var">status_var</code></td>
<td>
<p>Name of the patient status variable that was previously created. Default is p_status.</p>
</td></tr>
<tr><td><code id="calc_futime_tt_+3A_lifedat_var">lifedat_var</code></td>
<td>
<p>Name of variable containing Date of Death. Will override dattype preset.</p>
</td></tr>
<tr><td><code id="calc_futime_tt_+3A_fcdat_var">fcdat_var</code></td>
<td>
<p>Name of variable containing Date of Primary Cancer diagnosis. Will override dattype preset.</p>
</td></tr>
<tr><td><code id="calc_futime_tt_+3A_spcdat_var">spcdat_var</code></td>
<td>
<p>Name of variable containing Date of SPC diagnosis Will override dattype preset.</p>
</td></tr>
<tr><td><code id="calc_futime_tt_+3A_quiet">quiet</code></td>
<td>
<p>If TRUE, warnings and messages will be suppressed. Default is FALSE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>wide_df
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#load sample data
data("us_second_cancer")

#make wide data as this is the required format
usdata_wide &lt;- us_second_cancer %&gt;%
                    msSPChelpR::reshape_wide_tidyr(case_id_var = "fake_id", 
                    time_id_var = "SEQ_NUM", timevar_max = 10)
                    
#prep step - calculate p_spc variable
usdata_wide &lt;- usdata_wide %&gt;%
                 dplyr::mutate(p_spc = dplyr::case_when(is.na(t_site_icd.2)   ~ "No SPC",
                                                       !is.na(t_site_icd.2)   ~ "SPC developed",
                                                       TRUE ~ NA_character_)) %&gt;%
                 dplyr::mutate(count_spc = dplyr::case_when(is.na(t_site_icd.2)   ~ 1,
                                                              TRUE ~ 0))
                                                              
#prep step - create patient status variable
usdata_wide &lt;- usdata_wide %&gt;%
                  msSPChelpR::pat_status(., fu_end = "2017-12-31", dattype = "seer",
                                         status_var = "p_status", life_var = "p_alive.1",
                                         birthdat_var = "datebirth.1", lifedat_var = "datedeath.1")
 
#now we can run the function
msSPChelpR::calc_futime_tt(usdata_wide, 
                        futime_var_new = "p_futimeyrs", 
                        fu_end = "2017-12-31",
                        dattype = "seer", 
                        time_unit = "years",
                        status_var = "p_status",
                        lifedat_var = "datedeath.1", 
                        fcdat_var = "t_datediag.1", 
                        spcdat_var = "t_datediag.2")

</code></pre>

<hr>
<h2 id='calc_refrates'>Calculate age-, sex-, cohort-, region-specific incidence rates from a cohort</h2><span id='topic+calc_refrates'></span>

<h3>Description</h3>

<p>Calculate age-, sex-, cohort-, region-specific incidence rates from a cohort
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calc_refrates(
  df,
  dattype = NULL,
  count_var,
  refpop_df,
  calc_totals = FALSE,
  fill_sites = "no",
  region_var = NULL,
  age_var = NULL,
  sex_var = NULL,
  year_var = NULL,
  race_var = NULL,
  site_var = NULL,
  quiet = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calc_refrates_+3A_df">df</code></td>
<td>
<p>dataframe in long format</p>
</td></tr>
<tr><td><code id="calc_refrates_+3A_dattype">dattype</code></td>
<td>
<p>can be &quot;zfkd&quot; or &quot;seer&quot; or NULL. Will set default variable names if dattype is &quot;seer&quot; or &quot;zfkd&quot;. Default is NULL.</p>
</td></tr>
<tr><td><code id="calc_refrates_+3A_count_var">count_var</code></td>
<td>
<p>variable to be counted as observed case. Should be 1 for case to be counted.</p>
</td></tr>
<tr><td><code id="calc_refrates_+3A_refpop_df">refpop_df</code></td>
<td>
<p>df where reference population data is defined. Only required if option futime = &quot;refpop&quot; is chosen. It is assumed that refpop_df has the columns
&quot;region&quot; for region, &quot;sex&quot; for biological sex, &quot;age&quot; for age-groups (can be single ages or 5-year brackets), &quot;year&quot; for time period (can be single year or 5-year brackets),
&quot;population_pyar&quot; for person-years at risk in the respective age/sex/year cohort.
refpop_df must use the same category coding of age, sex, region, year and site as age_var, sex_var, region_var, year_var and site_var.</p>
</td></tr>
<tr><td><code id="calc_refrates_+3A_calc_totals">calc_totals</code></td>
<td>
<p>option to calculate totals for all age-groups, all sexes, all years, all races, all sites. Default is FALSE.</p>
</td></tr>
<tr><td><code id="calc_refrates_+3A_fill_sites">fill_sites</code></td>
<td>
<p>option to fill missing sites in observed with incidence rate of 0. Needs to define the coding system used.
Can be either &quot;no&quot; for not filling missing sites. &quot;icd2d&quot; for ICD-O-3 2 digit (C00-C80), &quot;icd3d&quot; for ICD-O-3 3digit,
&quot;icd10gm2d&quot; for ICD-10-GM 2-digit (C00-C97), &quot;sitewho&quot; for Site SEER WHO coding (no 1-89 categories), &quot;sitewho_b&quot;  for Site SEER WHO B recoding (no. 1-111 categories),
&quot;sitewho_epi&quot; for SITE SEER WHO coding with additional sums,  &quot;sitewhogen&quot; for SITE WHO coding with less categories to make compatible for international rates,
&quot;sitewho_num&quot; for numeric coding of Site SEER WHO coding (no 1-89 categories), &quot;sitewho_b_num&quot;  for numeric coding of Site SEER WHO B recoding (no. 1-111 categories),
&quot;sitewhogen_num&quot; for numeric international rates, c(&quot;manual&quot;, char_vector) of sites manually defined</p>
</td></tr>
<tr><td><code id="calc_refrates_+3A_region_var">region_var</code></td>
<td>
<p>variable in df that contains information on region where case was incident. Default is set if dattype is given.</p>
</td></tr>
<tr><td><code id="calc_refrates_+3A_age_var">age_var</code></td>
<td>
<p>variable in df that contains information on age-group. Default is set if dattype is given.</p>
</td></tr>
<tr><td><code id="calc_refrates_+3A_sex_var">sex_var</code></td>
<td>
<p>variable in df that contains information on sex. Default is set if dattype is given.</p>
</td></tr>
<tr><td><code id="calc_refrates_+3A_year_var">year_var</code></td>
<td>
<p>variable in df that contains information on year or year-period when case was incident. Default is set if dattype is given.</p>
</td></tr>
<tr><td><code id="calc_refrates_+3A_race_var">race_var</code></td>
<td>
<p>optional argument, if rates should be calculated stratified by race. If you want to use this option, provide variable name of df that contains race information. If race_var is provided refpop_df needs to contain the variable &quot;race&quot;.</p>
</td></tr>
<tr><td><code id="calc_refrates_+3A_site_var">site_var</code></td>
<td>
<p>variable in df that contains information on ICD code of case diagnosis. Cases are usually the second cancers. Default is set if dattype is given.</p>
</td></tr>
<tr><td><code id="calc_refrates_+3A_quiet">quiet</code></td>
<td>
<p>If TRUE, warnings and messages will be suppressed. Default is FALSE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>df
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#load sample data
data("us_second_cancer")
data("population_us")

us_second_cancer %&gt;%
  #create variable to indicate to be counted as case
  dplyr::mutate(is_case = 1) %&gt;%
  #calculate refrates - warning: these are not realistic numbers, just showing functionality
  calc_refrates(dattype = "seer", , count_var = "is_case", refpop_df = population_us,
               region_var = "registry", age_var = "fc_agegroup", sex_var = "sex", 
               site_var = "t_site_icd")
</code></pre>

<hr>
<h2 id='histgroup_iarc'>Create variable for groups of malignant neoplasms considered to be histologically 'different' for the purpose of defining multiple tumors, ICD-O-3</h2><span id='topic+histgroup_iarc'></span>

<h3>Description</h3>

<p>Create variable for groups of malignant neoplasms considered to be histologically 'different' for the purpose of defining multiple tumors, ICD-O-3
</p>


<h3>Usage</h3>

<pre><code class='language-R'>histgroup_iarc(df, hist_var, new_var_hist = t_histgroupiarc, version = "3.1")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="histgroup_iarc_+3A_df">df</code></td>
<td>
<p>dataframe in long or wide format</p>
</td></tr>
<tr><td><code id="histgroup_iarc_+3A_hist_var">hist_var</code></td>
<td>
<p>variable in df that contains first 4 digits of tumor histology (without behavior)</p>
</td></tr>
<tr><td><code id="histgroup_iarc_+3A_new_var_hist">new_var_hist</code></td>
<td>
<p>Name of the newly calculated variable for histology groups. Default is t_histgroupiarc.</p>
</td></tr>
<tr><td><code id="histgroup_iarc_+3A_version">version</code></td>
<td>
<p>Version of ICD-O-3 classification used.  Can be either &quot;3.0&quot; for 2000 publication, &quot;3.1&quot; for 2013 first revision or &quot;3.2&quot; for 2019 second revision.
Default is <code>version = "3.1"</code> for ICD-O-3 revision 1, released 2013.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>df
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#load sample data
data("us_second_cancer")

us_second_cancer %&gt;% 
   msSPChelpR::histgroup_iarc(., hist_var = t_hist) %&gt;%
   dplyr::select(fake_id, t_hist, t_histgroupiarc) 
                
</code></pre>

<hr>
<h2 id='ir_crosstab'>Calculate crude incidence rates and crosstabulate results by break variables</h2><span id='topic+ir_crosstab'></span>

<h3>Description</h3>

<p>Calculate crude incidence rates and crosstabulate results by break variables
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ir_crosstab(
  df,
  dattype = NULL,
  count_var,
  xbreak_var = "none",
  ybreak_vars,
  collapse_ci = FALSE,
  add_total = "no",
  add_n_percentages = FALSE,
  futime_var = NULL,
  alpha = 0.05
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ir_crosstab_+3A_df">df</code></td>
<td>
<p>dataframe in wide format</p>
</td></tr>
<tr><td><code id="ir_crosstab_+3A_dattype">dattype</code></td>
<td>
<p>can be &quot;zfkd&quot; or &quot;seer&quot; or NULL. Will set default variable names if dattype is &quot;seer&quot; or &quot;zfkd&quot;. Default is NULL.</p>
</td></tr>
<tr><td><code id="ir_crosstab_+3A_count_var">count_var</code></td>
<td>
<p>variable to be counted as observed case. Should be 1 for case to be counted.</p>
</td></tr>
<tr><td><code id="ir_crosstab_+3A_xbreak_var">xbreak_var</code></td>
<td>
<p>variable from df by which rates should be stratified in columns of result df. Default is &quot;none&quot;.</p>
</td></tr>
<tr><td><code id="ir_crosstab_+3A_ybreak_vars">ybreak_vars</code></td>
<td>
<p>variables from df by which rates should be stratified in rows of result df. Multiple variables will result in
appended rows in result df. y_break_vars is required.</p>
</td></tr>
<tr><td><code id="ir_crosstab_+3A_collapse_ci">collapse_ci</code></td>
<td>
<p>If TRUE upper and lower confidence interval will be collapsed into one column separated by &quot;-&quot;. Default is FALSE.</p>
</td></tr>
<tr><td><code id="ir_crosstab_+3A_add_total">add_total</code></td>
<td>
<p>option to add a row of totals. Can be either &quot;no&quot; for not adding such a row or &quot;top&quot; or &quot;bottom&quot; for adding it at the first or last row. Default is &quot;no&quot;.</p>
</td></tr>
<tr><td><code id="ir_crosstab_+3A_add_n_percentages">add_n_percentages</code></td>
<td>
<p>option to add a column of percentages for n_base in its respective yvar_group. Can only be used when xbreak_var = &quot;none&quot;. Default is FALSE.</p>
</td></tr>
<tr><td><code id="ir_crosstab_+3A_futime_var">futime_var</code></td>
<td>
<p>variable in df that contains follow-up time per person (in years). Default is set if dattype is given.</p>
</td></tr>
<tr><td><code id="ir_crosstab_+3A_alpha">alpha</code></td>
<td>
<p>significance level for confidence interval calculations. Default is alpha = 0.05 which will give 95 percent confidence intervals.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>df
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#load sample data
data("us_second_cancer")

#prep step - make wide data as this is the required format
usdata_wide &lt;- us_second_cancer %&gt;%
                    msSPChelpR::reshape_wide_tidyr(case_id_var = "fake_id", 
                    time_id_var = "SEQ_NUM", timevar_max = 10)
                    
#prep step - calculate p_spc variable
usdata_wide &lt;- usdata_wide %&gt;%
                 dplyr::mutate(p_spc = dplyr::case_when(is.na(t_site_icd.2)   ~ "No SPC",
                                                       !is.na(t_site_icd.2)   ~ "SPC developed",
                                                       TRUE ~ NA_character_)) %&gt;%
                 dplyr::mutate(count_spc = dplyr::case_when(is.na(t_site_icd.2)   ~ 1,
                                                              TRUE ~ 0))
                                                              
#prep step - create patient status variable
usdata_wide &lt;- usdata_wide %&gt;%
                  msSPChelpR::pat_status(., fu_end = "2017-12-31", dattype = "seer",
                                         status_var = "p_status", life_var = "p_alive.1",
                                         birthdat_var = "datebirth.1", lifedat_var = "datedeath.1")
 
#now we can run the function
usdata_wide &lt;- usdata_wide %&gt;%
                 msSPChelpR::calc_futime(., 
                        futime_var_new = "p_futimeyrs", 
                        fu_end = "2017-12-31",
                        dattype = "seer", 
                        time_unit = "years",
                        status_var = "p_status",
                        lifedat_var = "datedeath.1", 
                        fcdat_var = "t_datediag.1", 
                        spcdat_var = "t_datediag.2")
                    
#for example, you can calculate incidence and summarize by sex and registry
msSPChelpR::ir_crosstab(usdata_wide,
      dattype = "seer",
      count_var = "count_spc",
      xbreak_var = "none",
      ybreak_vars = c("sex.1", "registry.1"),
      collapse_ci = FALSE,
      add_total = "no",
      add_n_percentages = FALSE,
      futime_var = "p_futimeyrs",
      alpha = 0.05)


</code></pre>

<hr>
<h2 id='ir_crosstab_byfutime'>Calculate crude incidence rates and cross-tabulate results by break variables; cumulative FU-times as are used as xbreak_var</h2><span id='topic+ir_crosstab_byfutime'></span>

<h3>Description</h3>

<p>Calculate crude incidence rates and cross-tabulate results by break variables; cumulative FU-times as are used as xbreak_var
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ir_crosstab_byfutime(
  df,
  dattype = NULL,
  count_var,
  futime_breaks = c(0, 0.5, 1, 5, 10, Inf),
  ybreak_vars,
  collapse_ci = FALSE,
  add_total = "no",
  futime_var = NULL,
  alpha = 0.05
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ir_crosstab_byfutime_+3A_df">df</code></td>
<td>
<p>dataframe in wide format</p>
</td></tr>
<tr><td><code id="ir_crosstab_byfutime_+3A_dattype">dattype</code></td>
<td>
<p>can be &quot;zfkd&quot; or &quot;seer&quot; or NULL. Will set default variable names if dattype is &quot;seer&quot; or &quot;zfkd&quot;. Default is NULL.</p>
</td></tr>
<tr><td><code id="ir_crosstab_byfutime_+3A_count_var">count_var</code></td>
<td>
<p>variable to be counted as observed case. Should be 1 for case to be counted.</p>
</td></tr>
<tr><td><code id="ir_crosstab_byfutime_+3A_futime_breaks">futime_breaks</code></td>
<td>
<p>vector that indicates split points for follow-up time groups (in years) that will be used as xbreak_var.
Default is c(0, .5, 1, 5, 10, Inf) that will result in 5 groups (up to 6 months, 6-12 months, 1-5 years, 5-10 years, 10+ years).</p>
</td></tr>
<tr><td><code id="ir_crosstab_byfutime_+3A_ybreak_vars">ybreak_vars</code></td>
<td>
<p>variables from df by which rates should be stratified in rows of result df. Multiple variables will result in
appended rows in result df. y_break_vars is required.</p>
</td></tr>
<tr><td><code id="ir_crosstab_byfutime_+3A_collapse_ci">collapse_ci</code></td>
<td>
<p>If TRUE upper and lower confidence interval will be collapsed into one column separated by &quot;-&quot;. Default is FALSE.</p>
</td></tr>
<tr><td><code id="ir_crosstab_byfutime_+3A_add_total">add_total</code></td>
<td>
<p>option to add a row of totals. Can be either &quot;no&quot; for not adding such a row or &quot;top&quot; or &quot;bottom&quot; for adding it at the first or last row. Default is &quot;no&quot;.</p>
</td></tr>
<tr><td><code id="ir_crosstab_byfutime_+3A_futime_var">futime_var</code></td>
<td>
<p>variable in df that contains follow-up time per person (in years). Default is set if dattype is given.</p>
</td></tr>
<tr><td><code id="ir_crosstab_byfutime_+3A_alpha">alpha</code></td>
<td>
<p>significance level for confidence interval calculations. Default is alpha = 0.05 which will give 95 percent confidence intervals.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>df
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#load sample data
data("us_second_cancer")

#prep step - make wide data as this is the required format
usdata_wide &lt;- us_second_cancer %&gt;%
                    #only use sample
                    dplyr::filter(as.numeric(fake_id) &lt; 200000) %&gt;%
                    msSPChelpR::reshape_wide_tidyr(case_id_var = "fake_id", 
                    time_id_var = "SEQ_NUM", timevar_max = 2)
                    
#prep step - calculate p_spc variable
usdata_wide &lt;- usdata_wide %&gt;%
                 dplyr::mutate(p_spc = dplyr::case_when(is.na(t_site_icd.2)   ~ "No SPC",
                                                       !is.na(t_site_icd.2)   ~ "SPC developed",
                                                       TRUE ~ NA_character_)) %&gt;%
                 dplyr::mutate(count_spc = dplyr::case_when(is.na(t_site_icd.2)   ~ 1,
                                                              TRUE ~ 0))
                                                              
#prep step - create patient status variable
usdata_wide &lt;- usdata_wide %&gt;%
                  msSPChelpR::pat_status(., fu_end = "2017-12-31", dattype = "seer",
                                         status_var = "p_status", life_var = "p_alive.1",
                                         birthdat_var = "datebirth.1", lifedat_var = "datedeath.1")
 
#now we can run the function
usdata_wide &lt;- usdata_wide %&gt;%
                 msSPChelpR::calc_futime(., 
                        futime_var_new = "p_futimeyrs", 
                        fu_end = "2017-12-31",
                        dattype = "seer", 
                        time_unit = "years",
                        status_var = "p_status",
                        lifedat_var = "datedeath.1", 
                        fcdat_var = "t_datediag.1", 
                        spcdat_var = "t_datediag.2")
                    
#for example, you can calculate incidence and summarize by sex and registry
msSPChelpR::ir_crosstab_byfutime(usdata_wide,
      dattype = "seer",
      count_var = "count_spc",
      futime_breaks = c(0, .5, 1, 5, 10, Inf),
      ybreak_vars = c("sex.1", "registry.1"),
      collapse_ci = FALSE,
      add_total = "no",
      futime_var = "p_futimeyrs",
      alpha = 0.05)


</code></pre>

<hr>
<h2 id='msSPChelpR'>msSPChelpR</h2><span id='topic+msSPChelpR'></span>

<h3>Description</h3>

<p>R helper functions for Second Primary Cancer analyses
</p>


<h3>Main functions</h3>

<p>Functions include asir, ir_crosstab, pat_status, reshape, sir_byfutime and summarize_sir_results.
</p>


<h3>Package context</h3>

<p>This package follows the principles of the &quot;tidyverse&quot;.
</p>

<hr>
<h2 id='msSPChelpR-package'>msSPChelpR: Helper Functions for Second Primary Cancer Analyses</h2><span id='topic+msSPChelpR-package'></span>

<h3>Description</h3>

<p>A collection of helper functions for analyzing Second Primary Cancer data, including functions to reshape data, to calculate patient states and analyze cancer incidence.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Marian Eberl <a href="mailto:marian.eberl@tum.de">marian.eberl@tum.de</a> (<a href="https://orcid.org/0000-0001-6584-3197">ORCID</a>)
</p>


<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://marianschmidt.github.io/msSPChelpR/">https://marianschmidt.github.io/msSPChelpR/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/marianschmidt/msSPChelpR/issues">https://github.com/marianschmidt/msSPChelpR/issues</a>
</p>
</li></ul>


<hr>
<h2 id='pat_status'>Determine patient status at specific end of follow-up - tidyverse version</h2><span id='topic+pat_status'></span>

<h3>Description</h3>

<p>Determine patient status at specific end of follow-up - tidyverse version
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pat_status(
  wide_df,
  fu_end = NULL,
  dattype = NULL,
  status_var = "p_status",
  life_var = NULL,
  spc_var = NULL,
  birthdat_var = NULL,
  lifedat_var = NULL,
  lifedatmin_var = NULL,
  fcdat_var = NULL,
  spcdat_var = NULL,
  life_stat_alive = NULL,
  life_stat_dead = NULL,
  spc_stat_yes = NULL,
  spc_stat_no = NULL,
  lifedat_fu_end = NULL,
  use_lifedatmin = FALSE,
  check = TRUE,
  as_labelled_factor = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pat_status_+3A_wide_df">wide_df</code></td>
<td>
<p>dataframe in wide format</p>
</td></tr>
<tr><td><code id="pat_status_+3A_fu_end">fu_end</code></td>
<td>
<p>end of follow-up in time format YYYY-MM-DD.</p>
</td></tr>
<tr><td><code id="pat_status_+3A_dattype">dattype</code></td>
<td>
<p>can be &quot;zfkd&quot; or &quot;seer&quot; or NULL. Will set default variable names if dattype is &quot;seer&quot; or &quot;zfkd&quot;. Default is NULL.</p>
</td></tr>
<tr><td><code id="pat_status_+3A_status_var">status_var</code></td>
<td>
<p>Name of the newly calculated variable for patient status. Default is p_status.</p>
</td></tr>
<tr><td><code id="pat_status_+3A_life_var">life_var</code></td>
<td>
<p>Name of variable containing life status. Will override dattype preset.</p>
</td></tr>
<tr><td><code id="pat_status_+3A_spc_var">spc_var</code></td>
<td>
<p>Name of variable containing SPC status. Will override dattype preset.</p>
</td></tr>
<tr><td><code id="pat_status_+3A_birthdat_var">birthdat_var</code></td>
<td>
<p>Name of variable containing Date of Birth. Will override dattype preset.</p>
</td></tr>
<tr><td><code id="pat_status_+3A_lifedat_var">lifedat_var</code></td>
<td>
<p>Name of variable containing Date of Death. Will override dattype preset.</p>
</td></tr>
<tr><td><code id="pat_status_+3A_lifedatmin_var">lifedatmin_var</code></td>
<td>
<p>Name of variable containing the minimum Date of Death when true DoD is missing. Will override dattype preset. Will only  be used if use_lifedatmin = TRUE.</p>
</td></tr>
<tr><td><code id="pat_status_+3A_fcdat_var">fcdat_var</code></td>
<td>
<p>Name of variable containing Date of Primary Cancer diagnosis. Will override dattype preset.</p>
</td></tr>
<tr><td><code id="pat_status_+3A_spcdat_var">spcdat_var</code></td>
<td>
<p>Name of variable containing Date of SPC diagnosis Will override dattype preset.</p>
</td></tr>
<tr><td><code id="pat_status_+3A_life_stat_alive">life_stat_alive</code></td>
<td>
<p>Value for alive status in life_var. Will override dattype preset.</p>
</td></tr>
<tr><td><code id="pat_status_+3A_life_stat_dead">life_stat_dead</code></td>
<td>
<p>Value for dead status in life_var. Will override dattype preset.</p>
</td></tr>
<tr><td><code id="pat_status_+3A_spc_stat_yes">spc_stat_yes</code></td>
<td>
<p>Value for SPC occurred in spc_var. Will override dattype preset.</p>
</td></tr>
<tr><td><code id="pat_status_+3A_spc_stat_no">spc_stat_no</code></td>
<td>
<p>Value for no SPC in spc_var. Will override dattype preset.</p>
</td></tr>
<tr><td><code id="pat_status_+3A_lifedat_fu_end">lifedat_fu_end</code></td>
<td>
<p>Date of last FU of alive status in registry data. Will override dattype preset (2017-03-31 for zfkd; 2018-12-31 for seer).</p>
</td></tr>
<tr><td><code id="pat_status_+3A_use_lifedatmin">use_lifedatmin</code></td>
<td>
<p>If TRUE, option to use Date of Death from lifedatmin_var when DOD is missing. Default is FALSE.</p>
</td></tr>
<tr><td><code id="pat_status_+3A_check">check</code></td>
<td>
<p>Check newly calculated variable p_status. Default is TRUE.</p>
</td></tr>
<tr><td><code id="pat_status_+3A_as_labelled_factor">as_labelled_factor</code></td>
<td>
<p>If TRUE, output status_var as labelled factor variable. Default is FALSE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>wide_df
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#load sample data
data("us_second_cancer")

#prep step - make wide data as this is the required format
usdata_wide &lt;- us_second_cancer %&gt;%
                    msSPChelpR::reshape_wide_tidyr(case_id_var = "fake_id", 
                    time_id_var = "SEQ_NUM", timevar_max = 10)
                    
#prep step - calculate p_spc variable
usdata_wide &lt;- usdata_wide %&gt;%
                 dplyr::mutate(p_spc = dplyr::case_when(is.na(t_site_icd.2)   ~ "No SPC",
                                                       !is.na(t_site_icd.2)   ~ "SPC developed",
                                                       TRUE ~ NA_character_)) %&gt;%
                 dplyr::mutate(count_spc = dplyr::case_when(is.na(t_site_icd.2)   ~ 1,
                                                              TRUE ~ 0))
                                                              
#now we can run the function
msSPChelpR::pat_status(usdata_wide, 
                       fu_end = "2017-12-31", 
                       dattype = "seer", 
                       status_var = "p_status", 
                       life_var = "p_alive.1", 
                       spc_var = NULL, 
                       birthdat_var = "datebirth.1", 
                       lifedat_var = "datedeath.1",
                       use_lifedatmin = FALSE, 
                       check = TRUE, 
                       as_labelled_factor = FALSE)
                       
</code></pre>

<hr>
<h2 id='pat_status_tt'>Determine patient status at specific end of follow-up - tidytable version</h2><span id='topic+pat_status_tt'></span>

<h3>Description</h3>

<p>Determine patient status at specific end of follow-up - tidytable version
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pat_status_tt(
  wide_df,
  fu_end,
  dattype = NULL,
  status_var = "p_status",
  life_var = NULL,
  spc_var = NULL,
  birthdat_var = NULL,
  lifedat_var = NULL,
  lifedatmin_var = NULL,
  fcdat_var = NULL,
  spcdat_var = NULL,
  life_stat_alive = NULL,
  life_stat_dead = NULL,
  spc_stat_yes = NULL,
  spc_stat_no = NULL,
  lifedat_fu_end = NULL,
  use_lifedatmin = FALSE,
  check = TRUE,
  as_labelled_factor = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pat_status_tt_+3A_wide_df">wide_df</code></td>
<td>
<p>dataframe or data.table in wide format</p>
</td></tr>
<tr><td><code id="pat_status_tt_+3A_fu_end">fu_end</code></td>
<td>
<p>end of follow-up in time format YYYY-MM-DD.</p>
</td></tr>
<tr><td><code id="pat_status_tt_+3A_dattype">dattype</code></td>
<td>
<p>can be &quot;zfkd&quot; or &quot;seer&quot; or NULL. Will set default variable names if dattype is &quot;seer&quot; or &quot;zfkd&quot;. Default is NULL.</p>
</td></tr>
<tr><td><code id="pat_status_tt_+3A_status_var">status_var</code></td>
<td>
<p>Name of the newly calculated variable for patient status. Default is p_status.</p>
</td></tr>
<tr><td><code id="pat_status_tt_+3A_life_var">life_var</code></td>
<td>
<p>Name of variable containing life status. Will override dattype preset.</p>
</td></tr>
<tr><td><code id="pat_status_tt_+3A_spc_var">spc_var</code></td>
<td>
<p>Name of variable containing SPC status. Will override dattype preset.</p>
</td></tr>
<tr><td><code id="pat_status_tt_+3A_birthdat_var">birthdat_var</code></td>
<td>
<p>Name of variable containing Date of Birth. Will override dattype preset.</p>
</td></tr>
<tr><td><code id="pat_status_tt_+3A_lifedat_var">lifedat_var</code></td>
<td>
<p>Name of variable containing Date of Death. Will override dattype preset.</p>
</td></tr>
<tr><td><code id="pat_status_tt_+3A_lifedatmin_var">lifedatmin_var</code></td>
<td>
<p>Name of variable containing the minimum Date of Death when true DoD is missing. Will override dattype preset. Will only  be used if use_lifedatmin = TRUE.</p>
</td></tr>
<tr><td><code id="pat_status_tt_+3A_fcdat_var">fcdat_var</code></td>
<td>
<p>Name of variable containing Date of Primary Cancer diagnosis. Will override dattype preset.</p>
</td></tr>
<tr><td><code id="pat_status_tt_+3A_spcdat_var">spcdat_var</code></td>
<td>
<p>Name of variable containing Date of SPC diagnosis Will override dattype preset.</p>
</td></tr>
<tr><td><code id="pat_status_tt_+3A_life_stat_alive">life_stat_alive</code></td>
<td>
<p>Value for alive status in life_var. Will override dattype preset.</p>
</td></tr>
<tr><td><code id="pat_status_tt_+3A_life_stat_dead">life_stat_dead</code></td>
<td>
<p>Value for dead status in life_var. Will override dattype preset.</p>
</td></tr>
<tr><td><code id="pat_status_tt_+3A_spc_stat_yes">spc_stat_yes</code></td>
<td>
<p>Value for SPC occurred in spc_var. Will override dattype preset.</p>
</td></tr>
<tr><td><code id="pat_status_tt_+3A_spc_stat_no">spc_stat_no</code></td>
<td>
<p>Value for no SPC in spc_var. Will override dattype preset.</p>
</td></tr>
<tr><td><code id="pat_status_tt_+3A_lifedat_fu_end">lifedat_fu_end</code></td>
<td>
<p>Date of last FU of alive status in registry data. Will override dattype preset (2017-03-31 for zfkd; 2018-12-31 for seer).</p>
</td></tr>
<tr><td><code id="pat_status_tt_+3A_use_lifedatmin">use_lifedatmin</code></td>
<td>
<p>If TRUE, option to use Date of Death from lifedatmin_var when DOD is missing. Default is FALSE.</p>
</td></tr>
<tr><td><code id="pat_status_tt_+3A_check">check</code></td>
<td>
<p>Check newly calculated variable p_status. Default is TRUE.</p>
</td></tr>
<tr><td><code id="pat_status_tt_+3A_as_labelled_factor">as_labelled_factor</code></td>
<td>
<p>If TRUE, output status_var as labelled factor variable. Default is FALSE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>wide_df
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#load sample data
data("us_second_cancer")

#prep step - make wide data as this is the required format
usdata_wide &lt;- us_second_cancer %&gt;%
                    msSPChelpR::reshape_wide_tidyr(case_id_var = "fake_id", 
                    time_id_var = "SEQ_NUM", timevar_max = 10)
                    
#prep step - calculate p_spc variable
usdata_wide &lt;- usdata_wide %&gt;%
                 dplyr::mutate(p_spc = dplyr::case_when(is.na(t_site_icd.2)   ~ "No SPC",
                                                       !is.na(t_site_icd.2)   ~ "SPC developed",
                                                       TRUE ~ NA_character_)) %&gt;%
                 dplyr::mutate(count_spc = dplyr::case_when(is.na(t_site_icd.2)   ~ 1,
                                                              TRUE ~ 0))
                                                              
#now we can run the function
msSPChelpR::pat_status_tt(usdata_wide, 
                       fu_end = "2017-12-31", 
                       dattype = "seer", 
                       status_var = "p_status", 
                       life_var = "p_alive.1", 
                       spc_var = NULL, 
                       birthdat_var = "datebirth.1", 
                       lifedat_var = "datedeath.1",
                       use_lifedatmin = FALSE, 
                       check = TRUE, 
                       as_labelled_factor = FALSE)
                       
</code></pre>

<hr>
<h2 id='population_us'>US Populations Data</h2><span id='topic+population_us'></span>

<h3>Description</h3>

<p>Dataset that contains different standard populations needed to run some package functions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>population_us
</code></pre>


<h3>Format</h3>

<p>A data frame with the following variables:
</p>

<dl>
<dt><code>region</code></dt><dd><p>Region / Registry</p>
</dd>
<dt><code>year</code></dt><dd><p>Year group</p>
</dd>
<dt><code>sex</code></dt><dd><p>Sex</p>
</dd>
<dt><code>age</code></dt><dd><p>Age group</p>
</dd>
<dt><code>race</code></dt><dd><p>Race</p>
</dd>
<dt><code>population_pyar</code></dt><dd><p>Population Years used for rate calculation (PYAR)</p>
</dd>
<dt><code>population_n_per_year</code></dt><dd><p>Absolute Population in single years or periods (PYAR / 5 years)]</p>
</dd>
</dl>


<hr>
<h2 id='renumber_time_id'>Renumber the time ID per case (i.e. Tumor sequence)</h2><span id='topic+renumber_time_id'></span>

<h3>Description</h3>

<p>Renumber the time ID per case (i.e. Tumor sequence)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>renumber_time_id(
  df,
  new_time_id_var,
  dattype = NULL,
  case_id_var = NULL,
  time_id_var = NULL,
  diagdat_var = NULL,
  timevar_max = Inf
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="renumber_time_id_+3A_df">df</code></td>
<td>
<p>dataframe</p>
</td></tr>
<tr><td><code id="renumber_time_id_+3A_new_time_id_var">new_time_id_var</code></td>
<td>
<p>Name of the newly calculated variable for time_id. Required.</p>
</td></tr>
<tr><td><code id="renumber_time_id_+3A_dattype">dattype</code></td>
<td>
<p>can be &quot;zfkd&quot; or &quot;seer&quot; or NULL. Will set default variable names if dattype is &quot;seer&quot; or &quot;zfkd&quot;. Default is NULL.</p>
</td></tr>
<tr><td><code id="renumber_time_id_+3A_case_id_var">case_id_var</code></td>
<td>
<p>String with name of ID variable indicating same patient.
E.g. <code>case_id_var="PUBCSNUM"</code> for SEER data.</p>
</td></tr>
<tr><td><code id="renumber_time_id_+3A_time_id_var">time_id_var</code></td>
<td>
<p>String with name of variable that indicates diagnosis per patient.
E.g. <code>time_id_var="SEQ_NUM"</code> for SEER data.</p>
</td></tr>
<tr><td><code id="renumber_time_id_+3A_diagdat_var">diagdat_var</code></td>
<td>
<p>String with name of variable that indicates date of diagnosis per event.
E.g. <code>diagdat_var="t_datediag"</code> for SEER data.</p>
</td></tr>
<tr><td><code id="renumber_time_id_+3A_timevar_max">timevar_max</code></td>
<td>
<p>Numeric; default Inf. Maximum number of cases per id.
All tumors &gt; timevar_max will be deleted.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>df
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(us_second_cancer)
us_second_cancer %&gt;%
 #only select first 10000 rows so example runs faster
 dplyr::slice(1:10000) %&gt;%
 msSPChelpR::renumber_time_id(new_time_id_var = "t_tumid",
                             dattype = "seer",
                             case_id_var = "fake_id")
                             
</code></pre>

<hr>
<h2 id='renumber_time_id_tt'>Renumber the time ID per case (i.e. Tumor sequence) - tidytable version</h2><span id='topic+renumber_time_id_tt'></span>

<h3>Description</h3>

<p>Renumber the time ID per case (i.e. Tumor sequence) - tidytable version
</p>


<h3>Usage</h3>

<pre><code class='language-R'>renumber_time_id_tt(
  df,
  new_time_id_var,
  dattype = NULL,
  case_id_var = NULL,
  time_id_var = NULL,
  diagdat_var = NULL,
  timevar_max = Inf
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="renumber_time_id_tt_+3A_df">df</code></td>
<td>
<p>dataframe</p>
</td></tr>
<tr><td><code id="renumber_time_id_tt_+3A_new_time_id_var">new_time_id_var</code></td>
<td>
<p>Name of the newly calculated variable for time_id. Required.</p>
</td></tr>
<tr><td><code id="renumber_time_id_tt_+3A_dattype">dattype</code></td>
<td>
<p>can be &quot;zfkd&quot; or &quot;seer&quot; or NULL. Will set default variable names if dattype is &quot;seer&quot; or &quot;zfkd&quot;. Default is NULL.</p>
</td></tr>
<tr><td><code id="renumber_time_id_tt_+3A_case_id_var">case_id_var</code></td>
<td>
<p>String with name of ID variable indicating same patient.
E.g. <code>case_id_var="PUBCSNUM"</code> for SEER data.</p>
</td></tr>
<tr><td><code id="renumber_time_id_tt_+3A_time_id_var">time_id_var</code></td>
<td>
<p>String with name of variable that indicates diagnosis per patient.
E.g. <code>time_id_var="SEQ_NUM"</code> for SEER data.</p>
</td></tr>
<tr><td><code id="renumber_time_id_tt_+3A_diagdat_var">diagdat_var</code></td>
<td>
<p>String with name of variable that indicates date of diagnosis per event.
E.g. <code>diagdat_var="t_datediag"</code> for SEER data.</p>
</td></tr>
<tr><td><code id="renumber_time_id_tt_+3A_timevar_max">timevar_max</code></td>
<td>
<p>Numeric; default Inf. Maximum number of cases per id.
All tumors &gt; timevar_max will be deleted.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>df
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(us_second_cancer)
us_second_cancer %&gt;%
 #only select first 10000 rows so example runs faster
 dplyr::slice(1:10000) %&gt;%
 msSPChelpR::renumber_time_id_tt(new_time_id_var = "t_tumid",
                             dattype = "seer",
                             case_id_var = "fake_id")

</code></pre>

<hr>
<h2 id='reshape_long'>Reshape dataset to long format - stats::reshape version</h2><span id='topic+reshape_long'></span>

<h3>Description</h3>

<p>Reshape dataset to long format - stats::reshape version
</p>


<h3>Usage</h3>

<pre><code class='language-R'>reshape_long(wide_df, case_id_var, time_id_var, datsize = Inf, chunks = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="reshape_long_+3A_wide_df">wide_df</code></td>
<td>
<p>dataframe in wide format</p>
</td></tr>
<tr><td><code id="reshape_long_+3A_case_id_var">case_id_var</code></td>
<td>
<p>String with name of ID variable indicating same patient.
E.g. <code>idvar="PUBCSNUM"</code> for SEER data.</p>
</td></tr>
<tr><td><code id="reshape_long_+3A_time_id_var">time_id_var</code></td>
<td>
<p>String with name of variable that indicates diagnosis per patient.
E.g. <code>timevar="SEQ_NUM"</code> for SEER data.</p>
</td></tr>
<tr><td><code id="reshape_long_+3A_datsize">datsize</code></td>
<td>
<p>Number of rows to be taken from df. This parameter is mainly for testing. Default is Inf so that df is fully processed.</p>
</td></tr>
<tr><td><code id="reshape_long_+3A_chunks">chunks</code></td>
<td>
<p>Numeric; default 1. Technical parameter how the data is split during reshaping.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>long df
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(us_second_cancer)

#prep step - reshape wide a sample of 10000 rows from us_second_cancer
usdata_wide_sample &lt;- msSPChelpR::reshape_wide(us_second_cancer,
                         case_id_var = "fake_id", 
                         time_id_var = "SEQ_NUM", 
                         timevar_max = 2,
                         datsize = 10000)

#now we can reshape long again
msSPChelpR::reshape_long(usdata_wide_sample,
                         case_id_var = "fake_id", 
                         time_id_var = "SEQ_NUM")


</code></pre>

<hr>
<h2 id='reshape_long_tidyr'>Reshape dataset to wide format - tidyr version</h2><span id='topic+reshape_long_tidyr'></span>

<h3>Description</h3>

<p>Reshape dataset to wide format - tidyr version
</p>


<h3>Usage</h3>

<pre><code class='language-R'>reshape_long_tidyr(wide_df, case_id_var, time_id_var, datsize = Inf)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="reshape_long_tidyr_+3A_wide_df">wide_df</code></td>
<td>
<p>dataframe</p>
</td></tr>
<tr><td><code id="reshape_long_tidyr_+3A_case_id_var">case_id_var</code></td>
<td>
<p>String with name of ID variable indicating same patient.
E.g. <code>idvar="PUBCSNUM"</code> for SEER data.</p>
</td></tr>
<tr><td><code id="reshape_long_tidyr_+3A_time_id_var">time_id_var</code></td>
<td>
<p>String with name of variable that indicates diagnosis per patient.
E.g. <code>timevar="SEQ_NUM"</code> for SEER data.</p>
</td></tr>
<tr><td><code id="reshape_long_tidyr_+3A_datsize">datsize</code></td>
<td>
<p>Number of rows to be taken from df. This parameter is mainly for testing. Default is Inf so that df is fully processed.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>long_df
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(us_second_cancer)

#prep step - reshape wide a sample of 10000 rows from us_second_cancer
usdata_wide_sample &lt;- msSPChelpR::reshape_wide(us_second_cancer,
                         case_id_var = "fake_id", 
                         time_id_var = "SEQ_NUM", 
                         timevar_max = 2,
                         datsize = 10000)

#now we can reshape long again
msSPChelpR::reshape_long_tidyr(usdata_wide_sample,
                         case_id_var = "fake_id", 
                         time_id_var = "SEQ_NUM")


</code></pre>

<hr>
<h2 id='reshape_long_tt'>Reshape dataset to wide format - tidytable version</h2><span id='topic+reshape_long_tt'></span>

<h3>Description</h3>

<p>Reshape dataset to wide format - tidytable version
</p>


<h3>Usage</h3>

<pre><code class='language-R'>reshape_long_tt(wide_df, case_id_var, time_id_var, datsize = Inf)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="reshape_long_tt_+3A_wide_df">wide_df</code></td>
<td>
<p>dataframe</p>
</td></tr>
<tr><td><code id="reshape_long_tt_+3A_case_id_var">case_id_var</code></td>
<td>
<p>String with name of ID variable indicating same patient.
E.g. <code>idvar="PUBCSNUM"</code> for SEER data.</p>
</td></tr>
<tr><td><code id="reshape_long_tt_+3A_time_id_var">time_id_var</code></td>
<td>
<p>String with name of variable that indicates diagnosis per patient.
E.g. <code>timevar="SEQ_NUM"</code> for SEER data.</p>
</td></tr>
<tr><td><code id="reshape_long_tt_+3A_datsize">datsize</code></td>
<td>
<p>Number of rows to be taken from df. This parameter is mainly for testing. Default is Inf so that df is fully processed.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>long_df
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(us_second_cancer)

#prep step - reshape wide a sample of 10000 rows from us_second_cancer
usdata_wide_sample &lt;- msSPChelpR::reshape_wide(us_second_cancer,
                         case_id_var = "fake_id", 
                         time_id_var = "SEQ_NUM", 
                         timevar_max = 2,
                         datsize = 10000)

#now we can reshape long again
msSPChelpR::reshape_long_tt(usdata_wide_sample,
                         case_id_var = "fake_id", 
                         time_id_var = "SEQ_NUM")


</code></pre>

<hr>
<h2 id='reshape_wide'>Reshape dataset to wide format</h2><span id='topic+reshape_wide'></span>

<h3>Description</h3>

<p>Reshape dataset to wide format
</p>


<h3>Usage</h3>

<pre><code class='language-R'>reshape_wide(
  df,
  case_id_var,
  time_id_var,
  timevar_max = 6,
  datsize = Inf,
  chunks = 10
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="reshape_wide_+3A_df">df</code></td>
<td>
<p>dataframe</p>
</td></tr>
<tr><td><code id="reshape_wide_+3A_case_id_var">case_id_var</code></td>
<td>
<p>String with name of ID variable indicating same patient.
E.g. <code>idvar="PUBCSNUM"</code> for SEER data.</p>
</td></tr>
<tr><td><code id="reshape_wide_+3A_time_id_var">time_id_var</code></td>
<td>
<p>String with name of variable that indicates diagnosis per patient.
E.g. <code>timevar="SEQ_NUM"</code> for SEER data.</p>
</td></tr>
<tr><td><code id="reshape_wide_+3A_timevar_max">timevar_max</code></td>
<td>
<p>Numeric; default 6. Maximum number of cases per id.
All tumors &gt; timevar_max will be deleted before reshaping.</p>
</td></tr>
<tr><td><code id="reshape_wide_+3A_datsize">datsize</code></td>
<td>
<p>Number of rows to be taken from df. This parameter is mainly for testing. Default is Inf so that df is fully processed.</p>
</td></tr>
<tr><td><code id="reshape_wide_+3A_chunks">chunks</code></td>
<td>
<p>Numeric; default 10. Technical parameter how the data is split during reshaping.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>df
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(us_second_cancer)

msSPChelpR::reshape_wide(us_second_cancer,
                         case_id_var = "fake_id", 
                         time_id_var = "SEQ_NUM", 
                         timevar_max = 2,
                         datsize = 10000)

</code></pre>

<hr>
<h2 id='reshape_wide_tidyr'>Reshape dataset to wide format - tidyr version</h2><span id='topic+reshape_wide_tidyr'></span>

<h3>Description</h3>

<p>Reshape dataset to wide format - tidyr version
</p>


<h3>Usage</h3>

<pre><code class='language-R'>reshape_wide_tidyr(
  df,
  case_id_var,
  time_id_var,
  timevar_max = 6,
  datsize = Inf
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="reshape_wide_tidyr_+3A_df">df</code></td>
<td>
<p>dataframe</p>
</td></tr>
<tr><td><code id="reshape_wide_tidyr_+3A_case_id_var">case_id_var</code></td>
<td>
<p>String with name of ID variable indicating same patient.
E.g. <code>idvar="PUBCSNUM"</code> for SEER data.</p>
</td></tr>
<tr><td><code id="reshape_wide_tidyr_+3A_time_id_var">time_id_var</code></td>
<td>
<p>String with name of variable that indicates diagnosis per patient.
E.g. <code>timevar="SEQ_NUM"</code> for SEER data.</p>
</td></tr>
<tr><td><code id="reshape_wide_tidyr_+3A_timevar_max">timevar_max</code></td>
<td>
<p>Numeric; default 6. Maximum number of cases per id.
All tumors &gt; timevar_max will be deleted before reshaping.</p>
</td></tr>
<tr><td><code id="reshape_wide_tidyr_+3A_datsize">datsize</code></td>
<td>
<p>Number of rows to be taken from df. This parameter is mainly for testing. Default is Inf so that df is fully processed.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>df
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(us_second_cancer)

msSPChelpR::reshape_wide_tidyr(us_second_cancer,
                         case_id_var = "fake_id", 
                         time_id_var = "SEQ_NUM", 
                         timevar_max = 2,
                         datsize = 10000)

</code></pre>

<hr>
<h2 id='reshape_wide_tt'>Reshape dataset to wide format - tidytable version</h2><span id='topic+reshape_wide_tt'></span>

<h3>Description</h3>

<p>Reshape dataset to wide format - tidytable version
</p>


<h3>Usage</h3>

<pre><code class='language-R'>reshape_wide_tt(df, case_id_var, time_id_var, timevar_max = 6, datsize = Inf)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="reshape_wide_tt_+3A_df">df</code></td>
<td>
<p>dataframe</p>
</td></tr>
<tr><td><code id="reshape_wide_tt_+3A_case_id_var">case_id_var</code></td>
<td>
<p>String with name of ID variable indicating same patient.
E.g. <code>idvar="PUBCSNUM"</code> for SEER data.</p>
</td></tr>
<tr><td><code id="reshape_wide_tt_+3A_time_id_var">time_id_var</code></td>
<td>
<p>String with name of variable that indicates diagnosis per patient.
E.g. <code>timevar="SEQ_NUM"</code> for SEER data.</p>
</td></tr>
<tr><td><code id="reshape_wide_tt_+3A_timevar_max">timevar_max</code></td>
<td>
<p>Numeric; default 6. Maximum number of cases per id.
All tumors &gt; timevar_max will be deleted before reshaping.</p>
</td></tr>
<tr><td><code id="reshape_wide_tt_+3A_datsize">datsize</code></td>
<td>
<p>Number of rows to be taken from df. This parameter is mainly for testing. Default is Inf so that df is fully processed.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>wide_df
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(us_second_cancer)

msSPChelpR::reshape_wide_tt(us_second_cancer,
                         case_id_var = "fake_id", 
                         time_id_var = "SEQ_NUM", 
                         timevar_max = 2,
                         datsize = 10000)

</code></pre>

<hr>
<h2 id='sir_byfutime'>Calculate standardized incidence ratios with custom grouping variables stratified by follow-up time</h2><span id='topic+sir_byfutime'></span>

<h3>Description</h3>

<p>Calculate standardized incidence ratios with custom grouping variables stratified by follow-up time
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sir_byfutime(
  df,
  dattype = NULL,
  ybreak_vars = "none",
  xbreak_var = "none",
  futime_breaks = c(0, 0.5, 1, 5, 10, Inf),
  count_var,
  refrates_df = rates,
  calc_total_row = TRUE,
  calc_total_fu = TRUE,
  region_var = NULL,
  age_var = NULL,
  sex_var = NULL,
  year_var = NULL,
  race_var = NULL,
  site_var = NULL,
  futime_var = NULL,
  expect_missing_refstrata_df = NULL,
  alpha = 0.05,
  quiet = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sir_byfutime_+3A_df">df</code></td>
<td>
<p>dataframe in wide format</p>
</td></tr>
<tr><td><code id="sir_byfutime_+3A_dattype">dattype</code></td>
<td>
<p>can be &quot;zfkd&quot; or &quot;seer&quot; or NULL. Will set default variable names if dattype is &quot;seer&quot; or &quot;zfkd&quot;. Default is NULL.</p>
</td></tr>
<tr><td><code id="sir_byfutime_+3A_ybreak_vars">ybreak_vars</code></td>
<td>
<p>variables from df by which SIRs should be stratified in result df. Multiple variables will result in
appended rows in result df.
Careful: do not chose any variables that are dependent on occurrence of count_var (e.g. Histology of second cancer).
If y_break_vars = &quot;none&quot;, no stratification is performed. Default is &quot;none&quot;.</p>
</td></tr>
<tr><td><code id="sir_byfutime_+3A_xbreak_var">xbreak_var</code></td>
<td>
<p>One variable from df by which SIRs should be stratified as a second dimension in result df. This variable will be added as
a second stratification dimension to ybreak_vars and all variables will be calculated for subpopulations of x and y combinations.
Careful: do not chose any variables that are dependent on occurrence of count_var (e.g. Year of second cancer).
If y_break_vars = &quot;none&quot;, no stratification is performed. Default is &quot;none&quot;.</p>
</td></tr>
<tr><td><code id="sir_byfutime_+3A_futime_breaks">futime_breaks</code></td>
<td>
<p>vector that indicates split points for follow-up time groups (in years) that will be used as xbreak_var.
Default is c(0, .5, 1, 5, 10, Inf) that will result in 5 groups (up to 6 months, 6-12 months, 1-5 years, 5-10 years, 10+ years).
If you don't want to split by follow-up time, use futime_breaks = &quot;none&quot;.</p>
</td></tr>
<tr><td><code id="sir_byfutime_+3A_count_var">count_var</code></td>
<td>
<p>variable to be counted as observed case. Cases are usually the second cancers. Should be 1 for case to be counted.</p>
</td></tr>
<tr><td><code id="sir_byfutime_+3A_refrates_df">refrates_df</code></td>
<td>
<p>df where reference rate from general population are defined. It is assumed that refrates_df has the columns
&quot;region&quot; for region, &quot;sex&quot; for biological sex, &quot;age&quot; for age-groups (can be single ages or 5-year brackets), &quot;year&quot; for time period (can be single year or 5-year brackets),
&quot;incidence_crude_rate&quot; for incidence rate in the respective age/sex/year cohort.The variable &quot;race&quot; is additionally required if the option &quot;race_var&quot; is used.
refrates_df must use the same category coding of age, sex, region, year and t_site as age_var, sex_var, region_var, year_var and site_var.</p>
</td></tr>
<tr><td><code id="sir_byfutime_+3A_calc_total_row">calc_total_row</code></td>
<td>
<p>option to calculate a row of totals. Can be either FALSE for not adding such a row or TRUE for adding it at the first row. Default is TRUE.</p>
</td></tr>
<tr><td><code id="sir_byfutime_+3A_calc_total_fu">calc_total_fu</code></td>
<td>
<p>option to calculate totals for follow-up time. Can be either FALSE for not adding such a column or TRUE for adding. Default is TRUE.</p>
</td></tr>
<tr><td><code id="sir_byfutime_+3A_region_var">region_var</code></td>
<td>
<p>variable in df that contains information on region where case was incident. Default is set if dattype is given.</p>
</td></tr>
<tr><td><code id="sir_byfutime_+3A_age_var">age_var</code></td>
<td>
<p>variable in df that contains information on age-group. Default is set if dattype is given.</p>
</td></tr>
<tr><td><code id="sir_byfutime_+3A_sex_var">sex_var</code></td>
<td>
<p>variable in df that contains information on sex. Default is set if dattype is given.</p>
</td></tr>
<tr><td><code id="sir_byfutime_+3A_year_var">year_var</code></td>
<td>
<p>variable in df that contains information on year or year-period when case was incident. Default is set if dattype is given.</p>
</td></tr>
<tr><td><code id="sir_byfutime_+3A_race_var">race_var</code></td>
<td>
<p>optional argument, if SIR should be calculated stratified by race. If you want to use this option, provide variable name of df that contains race information. If race_var is provided refrates_df needs to contain the variable &quot;race&quot;.</p>
</td></tr>
<tr><td><code id="sir_byfutime_+3A_site_var">site_var</code></td>
<td>
<p>variable in df that contains information on site or subsite (e.g. ICD code, SEER site code or others that matches t_site in refrates_df) of case diagnosis. Cases are usually the second cancers. Default is set if dattype is given.</p>
</td></tr>
<tr><td><code id="sir_byfutime_+3A_futime_var">futime_var</code></td>
<td>
<p>variable in df that contains follow-up time per person between date of first cancer and any of death, date of event (case), end of FU date (in years; whatever event comes first). Default is set if dattype is given.</p>
</td></tr>
<tr><td><code id="sir_byfutime_+3A_expect_missing_refstrata_df">expect_missing_refstrata_df</code></td>
<td>
<p>optional argument, if strata with missing refrates are expected, because incidence rates of value 0 are not explicit, but missing from refrates_df.
It is assumed that expect_missing_refstrata_df is a data.frame has the columns
&quot;region&quot; for region, &quot;sex&quot; for biological sex, &quot;age&quot; for age-groups (can be single ages or 5-year brackets), &quot;year&quot; for time period (can be single year or 5-year brackets), and &quot;t_site&quot; for
The variable &quot;race&quot; is additionally required if the option &quot;race_var&quot; is used.
refrates_df must use the same category coding of age, sex, region, year and t_site as age_var, sex_var, region_var, year_var and site_var.</p>
</td></tr>
<tr><td><code id="sir_byfutime_+3A_alpha">alpha</code></td>
<td>
<p>significance level for confidence interval calculations. Default is alpha = 0.05 which will give 95 percent confidence intervals.</p>
</td></tr>
<tr><td><code id="sir_byfutime_+3A_quiet">quiet</code></td>
<td>
<p>If TRUE, warnings and messages will be suppressed. Default is FALSE.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>#There are various preparation steps required, before you can run this function.
#Please refer to the Introduction vignette to see how to prepare your data
## Not run: 
usdata_wide %&gt;%
  sir_byfutime(
        dattype = "seer",
        ybreak_vars = c("race.1", "t_dco.1"),
        xbreak_var = "none",
        futime_breaks = c(0, 1/12, 2/12, 1, 5, 10, Inf),
        count_var = "count_spc",
        refrates_df = us_refrates_icd2,
        calc_total_row = TRUE,
        calc_total_fu = TRUE,
        region_var = "registry.1",
        age_var = "fc_agegroup.1",
        sex_var = "sex.1",
        year_var = "t_yeardiag.1",
        site_var = "t_site_icd.1", #using grouping by second cancer incidence
        futime_var = "p_futimeyrs",
        alpha = 0.05)
        
## End(Not run)

</code></pre>

<hr>
<h2 id='sir_ratio'>Calculate Ratio of two SIRs or SMRs</h2><span id='topic+sir_ratio'></span><span id='topic+sir_ratio_lci'></span><span id='topic+sir_ratio_uci'></span>

<h3>Description</h3>

<p>Calculate ratio of two SIRs by providing observed and expected counts to <code>sir_ratio</code>
The related functions <code>sir_ratio_lci</code> and <code>sir_ratio_uci</code> can also calculate lower and upper estimates of the confidence interval
Calculations are based on formulas suggested by Breslow &amp; Day 1987
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sir_ratio(o1, o2, e1, e2)

sir_ratio_lci(o1, o2, e1, e2, alpha = 0.05)

sir_ratio_uci(o1, o2, e1, e2, alpha = 0.05)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sir_ratio_+3A_o1">o1</code></td>
<td>
<p>observed count for SIR 1</p>
</td></tr>
<tr><td><code id="sir_ratio_+3A_o2">o2</code></td>
<td>
<p>observed count for SIR 2</p>
</td></tr>
<tr><td><code id="sir_ratio_+3A_e1">e1</code></td>
<td>
<p>expected count for SIR 1</p>
</td></tr>
<tr><td><code id="sir_ratio_+3A_e2">e2</code></td>
<td>
<p>observed count for SIR 2</p>
</td></tr>
<tr><td><code id="sir_ratio_+3A_alpha">alpha</code></td>
<td>
<p>alpha significance level for confidence interval calculations. Default is alpha = 0.05 which will give 95 percent confidence intervals.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>num numeric value of SIR / SMR estimate
</p>


<h3>References</h3>

<p>Breslow NE, Day NE. Statistical Methods in Cancer Research Volume II: The Design and Analysis of Cohort Studies. Lyon, France: IARC; 1987. (IARC Scientific Publications IARC Scientific Publications No. 82). Available from: http://publications.iarc.fr/Book-And-Report-Series/Iarc-Scientific-Publications/Statistical-Methods-In-Cancer-Research-Volume-II-The-Design-And-Analysis-Of-Cohort-Studies-1986
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#provide the two expected and observed count to get the ratio of SIRs/SMRs
msSPChelpR::sir_ratio(o1 = 2140, o2 = 3158, e1 = 1993, e2 = 2123)

#calculate lower confidence limit
msSPChelpR::sir_ratio_lci(o1 = 2140, o2 = 3158, e1 = 1993, e2 = 2123, alpha = 0.05)

#calculate upper confidence limit
msSPChelpR::sir_ratio_uci(o1 = 2140, o2 = 3158, e1 = 1993, e2 = 2123, alpha = 0.05)

#functions can be easily used inside dplyr::mutate function
library(dplyr)
test_df &lt;- data.frame(sir_oth = c(1.07, 1.36, 0.96), 
                  sir_smo = c(1.49, 1.81, 1.41),
                  observed_oth = c(2140, 748, 1392),
                  expected_oth = c(1993, 550, 1443),
                  observed_smo = c(3158, 744, 2414),
                  expected_smo = c(2123, 412, 1711))

test_df %&gt;%
  mutate(smo_ratio = sir_ratio(observed_oth, observed_smo, expected_oth, expected_smo),
         smo_ratio_lci = sir_ratio_lci(observed_oth, observed_smo, expected_oth, expected_smo),
         smo_ratio_uci = sir_ratio_uci(observed_oth, observed_smo, expected_oth, expected_smo))
</code></pre>

<hr>
<h2 id='standard_population'>Standard Populations Data</h2><span id='topic+standard_population'></span>

<h3>Description</h3>

<p>Dataset that contains different standard populations needed to run some package functions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>standard_population
</code></pre>


<h3>Format</h3>

<p>A data frame with the following variables:
</p>

<dl>
<dt><code>standard_pop</code></dt><dd><p>Standard Population</p>
</dd>
<dt><code>sex</code></dt><dd><p>Sex</p>
</dd>
<dt><code>age</code></dt><dd><p>Age group</p>
</dd>
<dt><code>population_n</code></dt><dd><p>Absolute Population number in standard population age group</p>
</dd>
<dt><code>group_proportion</code></dt><dd><p>Proportion of age-group in gender-specific total population</p>
</dd>
</dl>


<hr>
<h2 id='summarize_sir_results'>Summarize detailed SIR results</h2><span id='topic+summarize_sir_results'></span>

<h3>Description</h3>

<p>Summarize detailed SIR results
</p>


<h3>Usage</h3>

<pre><code class='language-R'>summarize_sir_results(
  sir_df,
  summarize_groups,
  summarize_site = FALSE,
  output = "long",
  output_information = "full",
  add_total_row = "no",
  add_total_fu = "no",
  collapse_ci = FALSE,
  shorten_total_cols = FALSE,
  fubreak_var_name = "fu_time",
  ybreak_var_name = "yvar_name",
  xbreak_var_name = "none",
  site_var_name = "t_site",
  alpha = 0.05
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summarize_sir_results_+3A_sir_df">sir_df</code></td>
<td>
<p>dataframe with stratified sir results created using the sir or sir_byfutime functions</p>
</td></tr>
<tr><td><code id="summarize_sir_results_+3A_summarize_groups">summarize_groups</code></td>
<td>
<p>option to define summarizing stratified groups. Default is &quot;none&quot;.
If you want to define variables that should be summarized into one group, you can chose from age, sex, region, year.
Define multiple summarize variables e.g. by summarize_groups = c(&quot;region&quot;, &quot;sex&quot;, &quot;year&quot;)</p>
</td></tr>
<tr><td><code id="summarize_sir_results_+3A_summarize_site">summarize_site</code></td>
<td>
<p>If TRUE results will be summarized over all t_site categories. Default is FALSE.</p>
</td></tr>
<tr><td><code id="summarize_sir_results_+3A_output">output</code></td>
<td>
<p>Define the format of the output.
Can be either &quot;nested&quot; for nested dataframe with fubreak_var and xbreak_var in separate sub_tables (purrr).
Or &quot;wide&quot; for wide format where fubreak_var and xbreak_var are appended as columns.
Or &quot;long&quot; for long format where sir_df is not reshaped, but just summarized (ybreak_var, xbreak_var and fubreak_var remain in rows).
Default is &quot;long&quot;.</p>
</td></tr>
<tr><td><code id="summarize_sir_results_+3A_output_information">output_information</code></td>
<td>
<p>option to define information to be presented in final output table. Default is &quot;full&quot; information, i.e. all variables from
from sir_df. &quot;reduced&quot; is observed, expected, sir, sir_ci / sir_lci+sir_uci, pyar, n_base. &quot;minimal&quot; is observed, expected, sir, sir_ci.
Default is &quot;full&quot;.</p>
</td></tr>
<tr><td><code id="summarize_sir_results_+3A_add_total_row">add_total_row</code></td>
<td>
<p>option to add a row of totals. Can be either &quot;no&quot; for not adding such a row or &quot;start&quot; or &quot;end&quot; for adding it at the first or last row
or &quot;only&quot; for only showing totals and no yvar. Default is &quot;no&quot;.</p>
</td></tr>
<tr><td><code id="summarize_sir_results_+3A_add_total_fu">add_total_fu</code></td>
<td>
<p>option to add totals for follow-up time. Can be either &quot;no&quot; for not adding such a column or &quot;start&quot; or &quot;end&quot; for adding it at the first or last column
or &quot;only&quot; for only showing follow-up time totals. Default is &quot;no&quot;.</p>
</td></tr>
<tr><td><code id="summarize_sir_results_+3A_collapse_ci">collapse_ci</code></td>
<td>
<p>If TRUE upper and lower confidence interval will be collapsed into one column separated by &quot;-&quot;. Default is FALSE.</p>
</td></tr>
<tr><td><code id="summarize_sir_results_+3A_shorten_total_cols">shorten_total_cols</code></td>
<td>
<p>Shorten text in all results columns that start with &quot;Total&quot;. Default == FALSE.</p>
</td></tr>
<tr><td><code id="summarize_sir_results_+3A_fubreak_var_name">fubreak_var_name</code></td>
<td>
<p>Name of variable with futime stratification. Default is &quot;fu_time&quot;.</p>
</td></tr>
<tr><td><code id="summarize_sir_results_+3A_ybreak_var_name">ybreak_var_name</code></td>
<td>
<p>Name of variable with futime stratification. Default is &quot;yvar_name&quot;.</p>
</td></tr>
<tr><td><code id="summarize_sir_results_+3A_xbreak_var_name">xbreak_var_name</code></td>
<td>
<p>Name of variable with futime stratification. Default is &quot;xvar_name&quot;.</p>
</td></tr>
<tr><td><code id="summarize_sir_results_+3A_site_var_name">site_var_name</code></td>
<td>
<p>Name of variable with site stratification. Default is &quot;t_site&quot;.</p>
</td></tr>
<tr><td><code id="summarize_sir_results_+3A_alpha">alpha</code></td>
<td>
<p>significance level for confidence interval calculations. Default is alpha = 0.05 which will give 95 percent confidence intervals.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>#There are various preparation steps required, before you can run this function.
#Please refer to the Introduction vignette to see how to prepare your data
## Not run: 
summarize_sir_results(.,
    summarize_groups = c("region", "age", "year", "race"),
    summarize_site = TRUE,
    output = "long",  output_information = "minimal",
    add_total_row = "only",  add_total_fu = "no",
    collapse_ci = FALSE,  shorten_total_cols = TRUE,
    fubreak_var_name = "fu_time", ybreak_var_name = "yvar_name",
    xbreak_var_name = "none", site_var_name = "t_site",
    alpha = 0.05
    )
    
## End(Not run)
    
</code></pre>

<hr>
<h2 id='us_refrates_icd2'>US Reference Rates for Cancer Data (ICD-O 2digit code)</h2><span id='topic+us_refrates_icd2'></span>

<h3>Description</h3>

<p>Synthetic dataset of reference incidence rates for the US population to demonstrate package functions
Cancer site is coded using ICD-O 2digit code
</p>


<h3>Usage</h3>

<pre><code class='language-R'>us_refrates_icd2
</code></pre>


<h3>Format</h3>

<p>A data frame with the following variables:
</p>

<dl>
<dt><code>t_site</code></dt><dd><p>Tumor Site</p>
</dd>
<dt><code>region</code></dt><dd><p>Region / Region groups</p>
</dd>
<dt><code>year</code></dt><dd><p>Year / Periods</p>
</dd>
<dt><code>sex</code></dt><dd><p>Sex</p>
</dd>
<dt><code>age</code></dt><dd><p>Age / Age groups</p>
</dd>
<dt><code>race</code></dt><dd><p>Race</p>
</dd>
<dt><code>comment</code></dt><dd><p>Comment</p>
</dd>
<dt><code>incidence_cases</code></dt><dd><p>Incident Cases (raw count)</p>
</dd>
<dt><code>incidence_crude_rate</code></dt><dd><p>Incidence Rate (crude rate)</p>
</dd>
<dt><code>population_pyar</code></dt><dd><p>Population Years used for rate calculation (PYAR)</p>
</dd>
<dt><code>population_n_per_year</code></dt><dd><p>Absolute Population number used for rate calculation (PYAR / 5 years)</p>
</dd>
</dl>


<hr>
<h2 id='us_second_cancer'>US Second Cancer Data</h2><span id='topic+us_second_cancer'></span>

<h3>Description</h3>

<p>Synthetic dataset of patients with cancer to demonstrate package functions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>us_second_cancer
</code></pre>


<h3>Format</h3>

<p>A data frame with the following variables:
</p>

<dl>
<dt><code>fake_id</code></dt><dd><p>ID of patient</p>
</dd>
<dt><code>SEQ_NUM</code></dt><dd><p>Original tumor sequence</p>
</dd>
<dt><code>registry</code></dt><dd><p>SEER registry</p>
</dd>
<dt><code>sex</code></dt><dd><p>Biological sex of patient</p>
</dd>
<dt><code>race</code></dt><dd><p>Race</p>
</dd>
<dt><code>datebirth</code></dt><dd><p>Date of birth</p>
</dd>
<dt><code>t_datediag</code></dt><dd><p>Date of diagnosis of tumor</p>
</dd>
<dt><code>t_site_icd</code></dt><dd><p>Primary site of tumor in ICD-O coding</p>
</dd>
<dt><code>t_hist</code></dt><dd><p>Histology, i.e. ICD-O-3-Code on tumor morphology (4 digits)</p>
</dd>
<dt><code>t_dco</code></dt><dd><p>Tumor diagnosis is based on Death Certificate only</p>
</dd>
<dt><code>fc_age</code></dt><dd><p>Age at first primary cancer in years</p>
</dd>
<dt><code>datedeath</code></dt><dd><p>Date of death</p>
</dd>
<dt><code>p_alive</code></dt><dd><p>Patient alive at end of follow-up 2019</p>
</dd>
<dt><code>p_dodmin</code></dt><dd><p>Minimum Date of Death if datedeath is missing</p>
</dd>
<dt><code>fc_agegroup</code></dt><dd><p>Age group of first cancer diagnosis</p>
</dd>
<dt><code>t_yeardiag</code></dt><dd><p>Time period of diagnosis of tumor</p>
</dd>
</dl>


<hr>
<h2 id='vital_status'>Determine vital status at end of follow-up depending on pat_status - tidyverse version</h2><span id='topic+vital_status'></span>

<h3>Description</h3>

<p>Determine vital status at end of follow-up depending on pat_status - tidyverse version
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vital_status(
  wide_df,
  status_var = "p_status",
  life_var_new = "p_alive",
  check = TRUE,
  as_labelled_factor = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vital_status_+3A_wide_df">wide_df</code></td>
<td>
<p>dataframe in wide format</p>
</td></tr>
<tr><td><code id="vital_status_+3A_status_var">status_var</code></td>
<td>
<p>Name of the patient status variable that was previously created. Default is p_status.</p>
</td></tr>
<tr><td><code id="vital_status_+3A_life_var_new">life_var_new</code></td>
<td>
<p>Name of the newly calculated variable for patient vital status. Default is p_alive.</p>
</td></tr>
<tr><td><code id="vital_status_+3A_check">check</code></td>
<td>
<p>Check newly calculated variable life_var_new by printing frequency table. Default is TRUE.</p>
</td></tr>
<tr><td><code id="vital_status_+3A_as_labelled_factor">as_labelled_factor</code></td>
<td>
<p>If true, output life_var_new as labelled factor variable. Default is FALSE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>wide_df
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#load sample data
data("us_second_cancer")

#prep step - make wide data as this is the required format
usdata_wide &lt;- us_second_cancer %&gt;%
                    msSPChelpR::reshape_wide_tidyr(case_id_var = "fake_id", 
                    time_id_var = "SEQ_NUM", timevar_max = 10)
                    
#prep step - calculate p_spc variable
usdata_wide &lt;- usdata_wide %&gt;%
                 dplyr::mutate(p_spc = dplyr::case_when(is.na(t_site_icd.2)   ~ "No SPC",
                                                       !is.na(t_site_icd.2)   ~ "SPC developed",
                                                       TRUE ~ NA_character_)) %&gt;%
                 dplyr::mutate(count_spc = dplyr::case_when(is.na(t_site_icd.2)   ~ 1,
                                                              TRUE ~ 0))
                                                              
#prep step - create patient status variable
usdata_wide &lt;- usdata_wide %&gt;%
                  msSPChelpR::pat_status(., fu_end = "2017-12-31", dattype = "seer",
                                         status_var = "p_status", life_var = "p_alive.1",
                                         birthdat_var = "datebirth.1", lifedat_var = "datedeath.1")
 
#now we can run the function
msSPChelpR::vital_status(usdata_wide, 
                        status_var = "p_status",
                        life_var_new = "p_alive_new", 
                        check = TRUE, 
                        as_labelled_factor = FALSE)

</code></pre>

<hr>
<h2 id='vital_status_tt'>Determine vital status at end of follow-up depending on pat_status - tidytable version</h2><span id='topic+vital_status_tt'></span>

<h3>Description</h3>

<p>Determine vital status at end of follow-up depending on pat_status - tidytable version
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vital_status_tt(
  wide_df,
  status_var = "p_status",
  life_var_new = "p_alive",
  check = TRUE,
  as_labelled_factor = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vital_status_tt_+3A_wide_df">wide_df</code></td>
<td>
<p>dataframe or data.table in wide format</p>
</td></tr>
<tr><td><code id="vital_status_tt_+3A_status_var">status_var</code></td>
<td>
<p>Name of the patient status variable that was previously created. Default is p_status.</p>
</td></tr>
<tr><td><code id="vital_status_tt_+3A_life_var_new">life_var_new</code></td>
<td>
<p>Name of the newly calculated variable for patient vital status. Default is p_alive.</p>
</td></tr>
<tr><td><code id="vital_status_tt_+3A_check">check</code></td>
<td>
<p>Check newly calculated variable life_var_new by printing frequency table. Default is TRUE.</p>
</td></tr>
<tr><td><code id="vital_status_tt_+3A_as_labelled_factor">as_labelled_factor</code></td>
<td>
<p>If true, output life_var_new as labelled factor variable. Default is FALSE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>wide_df
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#load sample data
data("us_second_cancer")

#prep step - make wide data as this is the required format
usdata_wide &lt;- us_second_cancer %&gt;%
                    msSPChelpR::reshape_wide_tidyr(case_id_var = "fake_id", 
                    time_id_var = "SEQ_NUM", timevar_max = 10)
                    
#prep step - calculate p_spc variable
usdata_wide &lt;- usdata_wide %&gt;%
                 dplyr::mutate(p_spc = dplyr::case_when(is.na(t_site_icd.2)   ~ "No SPC",
                                                       !is.na(t_site_icd.2)   ~ "SPC developed",
                                                       TRUE ~ NA_character_)) %&gt;%
                 dplyr::mutate(count_spc = dplyr::case_when(is.na(t_site_icd.2)   ~ 1,
                                                              TRUE ~ 0))
                                                              
#prep step - create patient status variable
usdata_wide &lt;- usdata_wide %&gt;%
                  msSPChelpR::pat_status(., fu_end = "2017-12-31", dattype = "seer",
                                         status_var = "p_status", life_var = "p_alive.1",
                                         birthdat_var = "datebirth.1", lifedat_var = "datedeath.1")
 
#now we can run the function
msSPChelpR::vital_status_tt(usdata_wide, 
                        status_var = "p_status",
                        life_var_new = "p_alive_new", 
                        check = TRUE, 
                        as_labelled_factor = FALSE)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
