<!DOCTYPE html><html><head><title>Help for package CohortSurvival</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {CohortSurvival}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#%&gt;%'><p>Pipe operator</p></a></li>
<li><a href='#addCohortSurvival'><p>Add survival information to a cohort table</p></a></li>
<li><a href='#asSurvivalResult'><p>A tidy implementation of the summarised_characteristics object.</p></a></li>
<li><a href='#benchmarkCohortSurvival'><p>Estimate performance of estimateSurvival function for benchmarking</p></a></li>
<li><a href='#CohortSurvival-package'><p>CohortSurvival: Estimate Survival from Common Data Model Cohorts</p></a></li>
<li><a href='#estimateCompetingRiskSurvival'><p>Estimate survival for a given event and competing risk of interest using</p>
cohorts in the OMOP Common Data Model</a></li>
<li><a href='#estimateSingleEventSurvival'><p>Estimate survival for a given event of interest using cohorts in the OMOP Common Data Model</p></a></li>
<li><a href='#generateDeathCohortSet'><p>To create a death cohort</p></a></li>
<li><a href='#mockMGUS2cdm'><p>Create mock CDM reference with survival::mgus2 dataset</p></a></li>
<li><a href='#plotSurvival'><p>Plot survival results</p></a></li>
<li><a href='#reexports'><p>Objects exported from other packages</p></a></li>
<li><a href='#splitNameLevel'><p>Split name and level columns into the columns.</p></a></li>
<li><a href='#survivalParticipants'><p>Participants contributing to a survival analysis</p></a></li>
<li><a href='#tableSurvival'><p>Table with survival summary</p></a></li>
<li><a href='#tidyeval'><p>Tidy eval helpers</p></a></li>
<li><a href='#uniteNameLevel'><p>Unite one or more columns in name-level format.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Estimate Survival from Common Data Model Cohorts</td>
</tr>
<tr>
<td>Version:</td>
<td>0.4.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Estimate survival using data mapped to the Observational Medical Outcomes Partnership common data model. Survival can be estimated based on user-defined study cohorts.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License (&ge; 2)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>Imports:</td>
<td>CDMConnector (&ge; 1.3.0), omopgenerics, checkmate, cli, DBI,
dplyr, dbplyr, magrittr, lubridate, broom, PatientProfiles,
visOmopResults, rlang (&ge; 0.4.11), survival, scales, stringr,
tibble, tidyr</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 3.0.0), CodelistGenerator, roxygen2, knitr,
tictoc, rmarkdown, ggplot2, duckdb</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Config/testthat/parallel:</td>
<td>true</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://darwin-eu-dev.github.io/CohortSurvival/">https://darwin-eu-dev.github.io/CohortSurvival/</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-04-02 16:50:21 UTC; eburn</td>
</tr>
<tr>
<td>Author:</td>
<td>Edward Burn <a href="https://orcid.org/0000-0002-9286-1128"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cre],
  Kim Lopez <a href="https://orcid.org/0000-0002-8462-8668"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Marti Catala <a href="https://orcid.org/0000-0003-3308-9905"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Xintong Li <a href="https://orcid.org/0000-0003-3308-9905"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [ctb],
  Danielle Newby <a href="https://orcid.org/0000-0002-3001-1478"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Edward Burn &lt;edward.burn@ndorms.ox.ac.uk&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-04-02 17:35:00 UTC</td>
</tr>
</table>
<hr>
<h2 id='+25+26gt+3B+25'>Pipe operator</h2><span id='topic++25+3E+25'></span>

<h3>Description</h3>

<p>See <code>magrittr::<a href="magrittr.html#topic+pipe">%&gt;%</a></code> for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lhs %&gt;% rhs
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="+2B25+2B26gt+2B3B+2B25_+3A_lhs">lhs</code></td>
<td>
<p>A value or the magrittr placeholder.</p>
</td></tr>
<tr><td><code id="+2B25+2B26gt+2B3B+2B25_+3A_rhs">rhs</code></td>
<td>
<p>A function call using the magrittr semantics.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The result of calling <code>rhs(lhs)</code>.
</p>

<hr>
<h2 id='addCohortSurvival'>Add survival information to a cohort table</h2><span id='topic+addCohortSurvival'></span>

<h3>Description</h3>

<p>Add survival information to a cohort table
</p>


<h3>Usage</h3>

<pre><code class='language-R'>addCohortSurvival(
  x,
  cdm,
  outcomeCohortTable,
  outcomeCohortId = 1,
  outcomeDateVariable = "cohort_start_date",
  outcomeWashout = Inf,
  censorOnCohortExit = FALSE,
  censorOnDate = NULL,
  followUpDays = Inf
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="addCohortSurvival_+3A_x">x</code></td>
<td>
<p>cohort table to add survival information</p>
</td></tr>
<tr><td><code id="addCohortSurvival_+3A_cdm">cdm</code></td>
<td>
<p>CDM reference</p>
</td></tr>
<tr><td><code id="addCohortSurvival_+3A_outcomecohorttable">outcomeCohortTable</code></td>
<td>
<p>The outcome cohort table of interest.</p>
</td></tr>
<tr><td><code id="addCohortSurvival_+3A_outcomecohortid">outcomeCohortId</code></td>
<td>
<p>ID of event cohorts to include. Only one outcome
(and so one ID) can be considered.</p>
</td></tr>
<tr><td><code id="addCohortSurvival_+3A_outcomedatevariable">outcomeDateVariable</code></td>
<td>
<p>Variable containing date of outcome event</p>
</td></tr>
<tr><td><code id="addCohortSurvival_+3A_outcomewashout">outcomeWashout</code></td>
<td>
<p>Washout time in days for the outcome</p>
</td></tr>
<tr><td><code id="addCohortSurvival_+3A_censoroncohortexit">censorOnCohortExit</code></td>
<td>
<p>If TRUE, an individual's follow up will be
censored at their cohort exit</p>
</td></tr>
<tr><td><code id="addCohortSurvival_+3A_censorondate">censorOnDate</code></td>
<td>
<p>if not NULL, an individual's follow up will be censored
at the given date</p>
</td></tr>
<tr><td><code id="addCohortSurvival_+3A_followupdays">followUpDays</code></td>
<td>
<p>Number of days to follow up individuals (lower bound 1,
upper bound Inf)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Two additional columns will be added to x. The &quot;time&quot; column will
contain number of days to censoring. The &quot;status&quot; column will indicate
whether the patient had the event (value: 1), or did not have the event
(value: 0)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

cdm &lt;- mockMGUS2cdm()
cdm$mgus_diagnosis &lt;- cdm$mgus_diagnosis %&gt;%
  addCohortSurvival(
    cdm = cdm,
    outcomeCohortTable = "death_cohort",
    outcomeCohortId = 1
  )
  

</code></pre>

<hr>
<h2 id='asSurvivalResult'>A tidy implementation of the summarised_characteristics object.</h2><span id='topic+asSurvivalResult'></span>

<h3>Description</h3>

<p>A tidy implementation of the summarised_characteristics object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>asSurvivalResult(result)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="asSurvivalResult_+3A_result">result</code></td>
<td>
<p>A summarised_characteristics object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble with a tidy version of the summarised_characteristics
object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
cdm &lt;- mockMGUS2cdm()
surv &lt;- estimateSingleEventSurvival(
  cdm = cdm,
  targetCohortTable = "mgus_diagnosis",
  targetCohortId = 1,
  outcomeCohortTable = "death_cohort",
  outcomeCohortId = 1,
  eventGap = 7
) %&gt;%
  asSurvivalResult()


</code></pre>

<hr>
<h2 id='benchmarkCohortSurvival'>Estimate performance of estimateSurvival function for benchmarking</h2><span id='topic+benchmarkCohortSurvival'></span>

<h3>Description</h3>

<p>Estimate performance of estimateSurvival function for benchmarking
</p>


<h3>Usage</h3>

<pre><code class='language-R'>benchmarkCohortSurvival(
  cdm,
  targetSize,
  outcomeSize,
  outcomeDateVariable = "cohort_start_date",
  competingOutcomeSize = NULL,
  competingOutcomeDateVariable = "cohort_start_date",
  censorOnCohortExit = FALSE,
  censorOnDate = NULL,
  followUpDays = Inf,
  strata = NULL,
  eventGap = 30,
  estimateGap = 1,
  minCellCount = 5,
  returnParticipants = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="benchmarkCohortSurvival_+3A_cdm">cdm</code></td>
<td>
<p>CDM reference</p>
</td></tr>
<tr><td><code id="benchmarkCohortSurvival_+3A_targetsize">targetSize</code></td>
<td>
<p>number of people in the target cohort table</p>
</td></tr>
<tr><td><code id="benchmarkCohortSurvival_+3A_outcomesize">outcomeSize</code></td>
<td>
<p>number of people in the outcome cohort table</p>
</td></tr>
<tr><td><code id="benchmarkCohortSurvival_+3A_outcomedatevariable">outcomeDateVariable</code></td>
<td>
<p>Variable containing date of outcome event</p>
</td></tr>
<tr><td><code id="benchmarkCohortSurvival_+3A_competingoutcomesize">competingOutcomeSize</code></td>
<td>
<p>number of people in the competing outcome cohort table</p>
</td></tr>
<tr><td><code id="benchmarkCohortSurvival_+3A_competingoutcomedatevariable">competingOutcomeDateVariable</code></td>
<td>
<p>Variable containing date of
competing event</p>
</td></tr>
<tr><td><code id="benchmarkCohortSurvival_+3A_censoroncohortexit">censorOnCohortExit</code></td>
<td>
<p>If TRUE, an individual's follow up will be
censored at their cohort exit</p>
</td></tr>
<tr><td><code id="benchmarkCohortSurvival_+3A_censorondate">censorOnDate</code></td>
<td>
<p>if not NULL, an individual's follow up will be censored
at the given date</p>
</td></tr>
<tr><td><code id="benchmarkCohortSurvival_+3A_followupdays">followUpDays</code></td>
<td>
<p>Number of days to follow up individuals (lower bound 1,
upper bound Inf)</p>
</td></tr>
<tr><td><code id="benchmarkCohortSurvival_+3A_strata">strata</code></td>
<td>
<p>strata</p>
</td></tr>
<tr><td><code id="benchmarkCohortSurvival_+3A_eventgap">eventGap</code></td>
<td>
<p>Days between time points for which to report survival
estimates. First day will be day zero with risk estimates provided
for times up to the end of follow-up, with a gap in days equivalent
to eventGap.</p>
</td></tr>
<tr><td><code id="benchmarkCohortSurvival_+3A_estimategap">estimateGap</code></td>
<td>
<p>vector of time points at which to give survival estimates,
if NULL estimates at all times are calculated</p>
</td></tr>
<tr><td><code id="benchmarkCohortSurvival_+3A_mincellcount">minCellCount</code></td>
<td>
<p>The minimum number of events to reported, below which
results will be obscured. If 0, all results will be reported.</p>
</td></tr>
<tr><td><code id="benchmarkCohortSurvival_+3A_returnparticipants">returnParticipants</code></td>
<td>
<p>Either TRUE or FALSE. If TRUE, references to
participants from the analysis will be returned allowing for further
analysis.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>tibble with performance of estimateSurvival function information,
according to the selected input parameters
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
cdm &lt;- mockMGUS2cdm()
cdm$condition_occurrence &lt;- cdm$death_cohort %&gt;%
dplyr::rename("condition_start_date" = "cohort_start_date",
             "condition_end_date" = "cohort_end_date") %&gt;%
             dplyr::compute()
surv_timings &lt;- benchmarkCohortSurvival(
cdm, targetSize = 100, outcomeSize = 20)


</code></pre>

<hr>
<h2 id='CohortSurvival-package'>CohortSurvival: Estimate Survival from Common Data Model Cohorts</h2><span id='topic+CohortSurvival'></span><span id='topic+CohortSurvival-package'></span>

<h3>Description</h3>

<p>Estimate survival using data mapped to the Observational Medical Outcomes Partnership common data model. Survival can be estimated based on user-defined study cohorts.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Edward Burn <a href="mailto:edward.burn@ndorms.ox.ac.uk">edward.burn@ndorms.ox.ac.uk</a> (<a href="https://orcid.org/0000-0002-9286-1128">ORCID</a>)
</p>
<p>Authors:
</p>

<ul>
<li><p> Kim Lopez <a href="mailto:kim.lopez@spc.ox.ac.uk">kim.lopez@spc.ox.ac.uk</a> (<a href="https://orcid.org/0000-0002-8462-8668">ORCID</a>)
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> Marti Catala <a href="mailto:marti.catalasabate@ndorms.ox.ac.uk">marti.catalasabate@ndorms.ox.ac.uk</a> (<a href="https://orcid.org/0000-0003-3308-9905">ORCID</a>) [contributor]
</p>
</li>
<li><p> Xintong Li <a href="mailto:xintong.li@ndorms.ox.ac.uk">xintong.li@ndorms.ox.ac.uk</a> (<a href="https://orcid.org/0000-0003-3308-9905">ORCID</a>) [contributor]
</p>
</li>
<li><p> Danielle Newby <a href="mailto:danielle.newby@ndorms.ox.ac.uk">danielle.newby@ndorms.ox.ac.uk</a> (<a href="https://orcid.org/0000-0002-3001-1478">ORCID</a>) [contributor]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://darwin-eu-dev.github.io/CohortSurvival/">https://darwin-eu-dev.github.io/CohortSurvival/</a>
</p>
</li></ul>


<hr>
<h2 id='estimateCompetingRiskSurvival'>Estimate survival for a given event and competing risk of interest using
cohorts in the OMOP Common Data Model</h2><span id='topic+estimateCompetingRiskSurvival'></span>

<h3>Description</h3>

<p>Estimate survival for a given event and competing risk of interest using
cohorts in the OMOP Common Data Model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimateCompetingRiskSurvival(
  cdm,
  targetCohortTable,
  targetCohortId = NULL,
  outcomeCohortTable,
  outcomeCohortId = NULL,
  outcomeDateVariable = "cohort_start_date",
  outcomeWashout = Inf,
  competingOutcomeCohortTable,
  competingOutcomeCohortId = NULL,
  competingOutcomeDateVariable = "cohort_start_date",
  competingOutcomeWashout = Inf,
  censorOnCohortExit = FALSE,
  censorOnDate = NULL,
  followUpDays = Inf,
  strata = NULL,
  eventGap = 30,
  estimateGap = 1,
  minimumSurvivalDays = 1,
  minCellCount = 5,
  returnParticipants = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estimateCompetingRiskSurvival_+3A_cdm">cdm</code></td>
<td>
<p>CDM reference</p>
</td></tr>
<tr><td><code id="estimateCompetingRiskSurvival_+3A_targetcohorttable">targetCohortTable</code></td>
<td>
<p>targetCohortTable</p>
</td></tr>
<tr><td><code id="estimateCompetingRiskSurvival_+3A_targetcohortid">targetCohortId</code></td>
<td>
<p>targetCohortId</p>
</td></tr>
<tr><td><code id="estimateCompetingRiskSurvival_+3A_outcomecohorttable">outcomeCohortTable</code></td>
<td>
<p>The outcome cohort table of interest.</p>
</td></tr>
<tr><td><code id="estimateCompetingRiskSurvival_+3A_outcomecohortid">outcomeCohortId</code></td>
<td>
<p>ID of event cohorts to include. Only one outcome
(and so one ID) can be considered.</p>
</td></tr>
<tr><td><code id="estimateCompetingRiskSurvival_+3A_outcomedatevariable">outcomeDateVariable</code></td>
<td>
<p>Variable containing date of outcome event</p>
</td></tr>
<tr><td><code id="estimateCompetingRiskSurvival_+3A_outcomewashout">outcomeWashout</code></td>
<td>
<p>Washout time in days for the outcome</p>
</td></tr>
<tr><td><code id="estimateCompetingRiskSurvival_+3A_competingoutcomecohorttable">competingOutcomeCohortTable</code></td>
<td>
<p>The competing outcome cohort table of interest.</p>
</td></tr>
<tr><td><code id="estimateCompetingRiskSurvival_+3A_competingoutcomecohortid">competingOutcomeCohortId</code></td>
<td>
<p>ID of event cohorts to include. Only one competing outcome
(and so one ID) can be considered.</p>
</td></tr>
<tr><td><code id="estimateCompetingRiskSurvival_+3A_competingoutcomedatevariable">competingOutcomeDateVariable</code></td>
<td>
<p>Variable containing date of competing outcome event</p>
</td></tr>
<tr><td><code id="estimateCompetingRiskSurvival_+3A_competingoutcomewashout">competingOutcomeWashout</code></td>
<td>
<p>Washout time in days for the competing outcome</p>
</td></tr>
<tr><td><code id="estimateCompetingRiskSurvival_+3A_censoroncohortexit">censorOnCohortExit</code></td>
<td>
<p>If TRUE, an individual's follow up will be
censored at their cohort exit</p>
</td></tr>
<tr><td><code id="estimateCompetingRiskSurvival_+3A_censorondate">censorOnDate</code></td>
<td>
<p>if not NULL, an individual's follow up will be censored
at the given date</p>
</td></tr>
<tr><td><code id="estimateCompetingRiskSurvival_+3A_followupdays">followUpDays</code></td>
<td>
<p>Number of days to follow up individuals (lower bound 1,
upper bound Inf)</p>
</td></tr>
<tr><td><code id="estimateCompetingRiskSurvival_+3A_strata">strata</code></td>
<td>
<p>strata</p>
</td></tr>
<tr><td><code id="estimateCompetingRiskSurvival_+3A_eventgap">eventGap</code></td>
<td>
<p>Days between time points for which to report survival
events, which are grouped into the specified intervals.</p>
</td></tr>
<tr><td><code id="estimateCompetingRiskSurvival_+3A_estimategap">estimateGap</code></td>
<td>
<p>Days between time points for which to report survival
estimates. First day will be day zero with risk estimates provided
for times up to the end of follow-up, with a gap in days equivalent
to eventGap.</p>
</td></tr>
<tr><td><code id="estimateCompetingRiskSurvival_+3A_minimumsurvivaldays">minimumSurvivalDays</code></td>
<td>
<p>Minimum number of days required for the main cohort
to have survived</p>
</td></tr>
<tr><td><code id="estimateCompetingRiskSurvival_+3A_mincellcount">minCellCount</code></td>
<td>
<p>The minimum number of events to reported, below which
results will be obscured. If 0, all results will be reported.</p>
</td></tr>
<tr><td><code id="estimateCompetingRiskSurvival_+3A_returnparticipants">returnParticipants</code></td>
<td>
<p>Either TRUE or FALSE. If TRUE, references to
participants from the analysis will be returned allowing for further
analysis.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>tibble with survival information for desired cohort, including:
time, people at risk, survival probability, cumulative incidence,
95 CIs, strata and outcome. A tibble with the number of events is
outputted as an attribute of the output
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
cdm &lt;- mockMGUS2cdm()
surv &lt;- estimateCompetingRiskSurvival(
  cdm = cdm,
  targetCohortTable = "mgus_diagnosis",
  targetCohortId = 1,
  outcomeCohortTable = "progression",
  outcomeCohortId = 1,
  competingOutcomeCohortTable = "death_cohort",
  competingOutcomeCohortId = 1,
  eventGap = 7
)


</code></pre>

<hr>
<h2 id='estimateSingleEventSurvival'>Estimate survival for a given event of interest using cohorts in the OMOP Common Data Model</h2><span id='topic+estimateSingleEventSurvival'></span>

<h3>Description</h3>

<p>Estimate survival for a given event of interest using cohorts in the OMOP Common Data Model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimateSingleEventSurvival(
  cdm,
  targetCohortTable,
  targetCohortId = NULL,
  outcomeCohortTable,
  outcomeCohortId = NULL,
  outcomeDateVariable = "cohort_start_date",
  outcomeWashout = Inf,
  censorOnCohortExit = FALSE,
  censorOnDate = NULL,
  followUpDays = Inf,
  strata = NULL,
  eventGap = 30,
  estimateGap = 1,
  minimumSurvivalDays = 1,
  minCellCount = 5,
  returnParticipants = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estimateSingleEventSurvival_+3A_cdm">cdm</code></td>
<td>
<p>CDM reference</p>
</td></tr>
<tr><td><code id="estimateSingleEventSurvival_+3A_targetcohorttable">targetCohortTable</code></td>
<td>
<p>targetCohortTable</p>
</td></tr>
<tr><td><code id="estimateSingleEventSurvival_+3A_targetcohortid">targetCohortId</code></td>
<td>
<p>targetCohortId</p>
</td></tr>
<tr><td><code id="estimateSingleEventSurvival_+3A_outcomecohorttable">outcomeCohortTable</code></td>
<td>
<p>The outcome cohort table of interest.</p>
</td></tr>
<tr><td><code id="estimateSingleEventSurvival_+3A_outcomecohortid">outcomeCohortId</code></td>
<td>
<p>ID of event cohorts to include. Only one outcome
(and so one ID) can be considered.</p>
</td></tr>
<tr><td><code id="estimateSingleEventSurvival_+3A_outcomedatevariable">outcomeDateVariable</code></td>
<td>
<p>Variable containing date of outcome event</p>
</td></tr>
<tr><td><code id="estimateSingleEventSurvival_+3A_outcomewashout">outcomeWashout</code></td>
<td>
<p>Washout time in days for the outcome</p>
</td></tr>
<tr><td><code id="estimateSingleEventSurvival_+3A_censoroncohortexit">censorOnCohortExit</code></td>
<td>
<p>If TRUE, an individual's follow up will be
censored at their cohort exit</p>
</td></tr>
<tr><td><code id="estimateSingleEventSurvival_+3A_censorondate">censorOnDate</code></td>
<td>
<p>if not NULL, an individual's follow up will be censored
at the given date</p>
</td></tr>
<tr><td><code id="estimateSingleEventSurvival_+3A_followupdays">followUpDays</code></td>
<td>
<p>Number of days to follow up individuals (lower bound 1,
upper bound Inf)</p>
</td></tr>
<tr><td><code id="estimateSingleEventSurvival_+3A_strata">strata</code></td>
<td>
<p>strata</p>
</td></tr>
<tr><td><code id="estimateSingleEventSurvival_+3A_eventgap">eventGap</code></td>
<td>
<p>Days between time points for which to report survival
events, which are grouped into the specified intervals.</p>
</td></tr>
<tr><td><code id="estimateSingleEventSurvival_+3A_estimategap">estimateGap</code></td>
<td>
<p>Days between time points for which to report survival
estimates. First day will be day zero with risk estimates provided
for times up to the end of follow-up, with a gap in days equivalent
to eventGap.</p>
</td></tr>
<tr><td><code id="estimateSingleEventSurvival_+3A_minimumsurvivaldays">minimumSurvivalDays</code></td>
<td>
<p>Minimum number of days required for the main cohort
to have survived</p>
</td></tr>
<tr><td><code id="estimateSingleEventSurvival_+3A_mincellcount">minCellCount</code></td>
<td>
<p>The minimum number of events to reported, below which
results will be obscured. If 0, all results will be reported.</p>
</td></tr>
<tr><td><code id="estimateSingleEventSurvival_+3A_returnparticipants">returnParticipants</code></td>
<td>
<p>Either TRUE or FALSE. If TRUE, references to
participants from the analysis will be returned allowing for further
analysis.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>tibble with survival information for desired cohort, including:
time, people at risk, survival probability, cumulative incidence,
95 CIs, strata and outcome. A tibble with the number of events is
outputted as an attribute of the output
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
cdm &lt;- mockMGUS2cdm()
surv &lt;- estimateSingleEventSurvival(
  cdm = cdm,
  targetCohortTable = "mgus_diagnosis",
  targetCohortId = 1,
  outcomeCohortTable = "death_cohort",
  outcomeCohortId = 1,
  eventGap = 7
)


</code></pre>

<hr>
<h2 id='generateDeathCohortSet'>To create a death cohort</h2><span id='topic+generateDeathCohortSet'></span>

<h3>Description</h3>

<p>To create a death cohort
</p>


<h3>Usage</h3>

<pre><code class='language-R'>generateDeathCohortSet(
  cdm,
  name,
  cohortTable = NULL,
  cohortId = NULL,
  overwrite = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="generateDeathCohortSet_+3A_cdm">cdm</code></td>
<td>
<p>CDM reference</p>
</td></tr>
<tr><td><code id="generateDeathCohortSet_+3A_name">name</code></td>
<td>
<p>name for the created death cohort table</p>
</td></tr>
<tr><td><code id="generateDeathCohortSet_+3A_cohorttable">cohortTable</code></td>
<td>
<p>name of the cohort table to create a death cohort for</p>
</td></tr>
<tr><td><code id="generateDeathCohortSet_+3A_cohortid">cohortId</code></td>
<td>
<p>name of the cohort table to create a death cohort for</p>
</td></tr>
<tr><td><code id="generateDeathCohortSet_+3A_overwrite">overwrite</code></td>
<td>
<p>Should the cohort table be overwritten if it already exists?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A cohort table with a death cohort in cdm
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(CDMConnector)
library(CohortSurvival)
observation_period &lt;- dplyr::tibble(
  observation_period_id = c(1, 2, 3, 4, 5,6),
  person_id = c(1, 2, 3, 4, 5,6),
  observation_period_start_date = c(
    rep(as.Date("1980-07-20"),6)
  ),
  observation_period_end_date = c(
    rep(as.Date("2023-05-20"),6)
  ),
  period_type_concept_id = c(rep(0,6))
)

deathTable &lt;- dplyr::tibble(
  person_id = c(1,2,3),
  death_date = c(as.Date("2020-01-01"),
                 as.Date("2020-01-02"),
                 as.Date("2020-01-01")))

person &lt;- dplyr::tibble(
  person_id = c(1, 2, 3, 4, 5),
  year_of_birth = c(rep("1990", 5)),
  month_of_birth = c(rep("02", 5)),
  day_of_birth = c(rep("11", 5)),
  gender_concept_id = c(rep(0,5)),
  ethnicity_concept_id = c(rep(0,5)),
  race_concept_id = c(rep(0,5))
)

cdm &lt;- omopgenerics::cdmFromTables(
  tables = list(
    person = person,
    observation_period = observation_period,
    death = deathTable
  ),
  cdmName = "mock_es"
)
 db &lt;- DBI::dbConnect(duckdb::duckdb(), ":memory:")
cdm2 = CDMConnector::copy_cdm_to(db,
                                 cdm,
                                 schema = "main",
                                 overwrite = TRUE)

attr(cdm2, "cdm_schema") &lt;- "main"
attr(cdm2, "write_schema") &lt;- "main"

cdm2 &lt;- generateDeathCohortSet(cdm=cdm2,
                               name = "death_cohort",
                               overwrite = TRUE)

</code></pre>

<hr>
<h2 id='mockMGUS2cdm'>Create mock CDM reference with survival::mgus2 dataset</h2><span id='topic+mockMGUS2cdm'></span>

<h3>Description</h3>

<p>Create mock CDM reference with survival::mgus2 dataset
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mockMGUS2cdm()
</code></pre>


<h3>Value</h3>

<p>CDM reference containing data from the survival::mgus2 dataset
</p>


<h3>Examples</h3>

<pre><code class='language-R'> 
cdm &lt;- mockMGUS2cdm()
cdm$person

</code></pre>

<hr>
<h2 id='plotSurvival'>Plot survival results</h2><span id='topic+plotSurvival'></span>

<h3>Description</h3>

<p>Plot survival results
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotSurvival(
  result,
  x = "time",
  xscale = "days",
  ylim = c(0, NA),
  cumulativeFailure = FALSE,
  ribbon = TRUE,
  facet = NULL,
  colour = NULL,
  colourName = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotSurvival_+3A_result">result</code></td>
<td>
<p>Survival results</p>
</td></tr>
<tr><td><code id="plotSurvival_+3A_x">x</code></td>
<td>
<p>Variable to plot on x axis</p>
</td></tr>
<tr><td><code id="plotSurvival_+3A_xscale">xscale</code></td>
<td>
<p>X axis scale. Can be &quot;days&quot; or &quot;years&quot;.</p>
</td></tr>
<tr><td><code id="plotSurvival_+3A_ylim">ylim</code></td>
<td>
<p>Limits for the Y axis</p>
</td></tr>
<tr><td><code id="plotSurvival_+3A_cumulativefailure">cumulativeFailure</code></td>
<td>
<p>whether to plot the cumulative failure probability
instead of the survival probability</p>
</td></tr>
<tr><td><code id="plotSurvival_+3A_ribbon">ribbon</code></td>
<td>
<p>If TRUE, the plot will join points using a ribbon</p>
</td></tr>
<tr><td><code id="plotSurvival_+3A_facet">facet</code></td>
<td>
<p>Variables to use for facets</p>
</td></tr>
<tr><td><code id="plotSurvival_+3A_colour">colour</code></td>
<td>
<p>Variables to use for colours</p>
</td></tr>
<tr><td><code id="plotSurvival_+3A_colourname">colourName</code></td>
<td>
<p>Colour legend name</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A plot of survival probabilities over time
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
cdm &lt;- mockMGUS2cdm()
surv &lt;- estimateSingleEventSurvival(cdm,
                                    targetCohortTable = "mgus_diagnosis",
                                    outcomeCohortTable = "death_cohort")
plotSurvival(surv)


</code></pre>

<hr>
<h2 id='reexports'>Objects exported from other packages</h2><span id='topic+reexports'></span><span id='topic+summariseCharacteristics'></span>

<h3>Description</h3>

<p>These objects are imported from other packages. Follow the links
below to see their documentation.
</p>

<dl>
<dt>PatientProfiles</dt><dd><p><code><a href="PatientProfiles.html#topic+summariseCharacteristics">summariseCharacteristics</a></code></p>
</dd>
</dl>

<hr>
<h2 id='splitNameLevel'>Split name and level columns into the columns.</h2><span id='topic+splitNameLevel'></span>

<h3>Description</h3>

<p>Pivots the input dataframe so the values of the name columns are tranformed
into columns, which values come from the specified level column.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>splitNameLevel(
  result,
  name = "group_name",
  level = "group_level",
  keep = FALSE,
  overall = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="splitNameLevel_+3A_result">result</code></td>
<td>
<p>Omop result object (summarised_result or compared_result).</p>
</td></tr>
<tr><td><code id="splitNameLevel_+3A_name">name</code></td>
<td>
<p>Column with the names.</p>
</td></tr>
<tr><td><code id="splitNameLevel_+3A_level">level</code></td>
<td>
<p>Column with the levels.</p>
</td></tr>
<tr><td><code id="splitNameLevel_+3A_keep">keep</code></td>
<td>
<p>Whether to keep the original group_name and group_level columns.</p>
</td></tr>
<tr><td><code id="splitNameLevel_+3A_overall">overall</code></td>
<td>
<p>Whether to keep overall column if present.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A dataframe with the specified name column values as columns.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- dplyr::tibble(
  variable = "number subjects",
  value = c(10, 15, 40, 78),
  group_name = c("sex and age_group", "sex and age_group",
  "sex and age_group", "sex and age_group"),
  group_level = c("Male and &lt;40", "Female and &gt;40", "Male and &gt;40", "Male and &lt;40")
)
  x %&gt;% splitNameLevel(name = "group_name",
                 level = "group_level",
                 keep = FALSE)

</code></pre>

<hr>
<h2 id='survivalParticipants'>Participants contributing to a survival analysis</h2><span id='topic+survivalParticipants'></span>

<h3>Description</h3>

<p>Participants contributing to a survival analysis
</p>


<h3>Usage</h3>

<pre><code class='language-R'>survivalParticipants(result)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="survivalParticipants_+3A_result">result</code></td>
<td>
<p>Result object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>References to the study participants contributing to
a given analysis
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
cdm &lt;- mockMGUS2cdm()
surv &lt;- estimateSingleEventSurvival(cdm,
                                    targetCohortTable = "mgus_diagnosis",
                                    outcomeCohortTable = "death_cohort",
                                    returnParticipants = TRUE)
survivalParticipants(surv)

</code></pre>

<hr>
<h2 id='tableSurvival'>Table with survival summary</h2><span id='topic+tableSurvival'></span>

<h3>Description</h3>

<p>Table with survival summary
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tableSurvival(x, times = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tableSurvival_+3A_x">x</code></td>
<td>
<p>Result from estimateSingleEventSurvival or estimateCompetingRiskSurvival</p>
</td></tr>
<tr><td><code id="tableSurvival_+3A_times">times</code></td>
<td>
<p>Times at which to report survival in the summary table</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble containing a summary of observed survival in days
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
cdm &lt;- mockMGUS2cdm()
surv &lt;- estimateSingleEventSurvival(cdm,
                                    targetCohortTable = "mgus_diagnosis",
                                    outcomeCohortTable = "death_cohort")
tableSurvival(surv, times = c(50,100,365))

</code></pre>

<hr>
<h2 id='tidyeval'>Tidy eval helpers</h2><span id='topic+tidyeval'></span><span id='topic+enquo'></span><span id='topic+enquos'></span><span id='topic+.data'></span><span id='topic++3A+3D'></span><span id='topic+as_name'></span><span id='topic+as_label'></span>

<h3>Description</h3>

<p>This page lists the tidy eval tools reexported in this package from
rlang. To learn about using tidy eval in scripts and packages at a
high level, see the <a href="https://dplyr.tidyverse.org/articles/programming.html">dplyr programming vignette</a>
and the <a href="https://ggplot2.tidyverse.org/articles/ggplot2-in-packages.html">ggplot2 in packages vignette</a>.
The <a href="https://adv-r.hadley.nz/metaprogramming.html">Metaprogramming section</a> of <a href="https://adv-r.hadley.nz">Advanced R</a> may also be useful for a deeper dive.
</p>

<ul>
<li><p> The tidy eval operators <code style="white-space: pre;">&#8288;{{&#8288;</code>, <code style="white-space: pre;">&#8288;!!&#8288;</code>, and <code style="white-space: pre;">&#8288;!!!&#8288;</code> are syntactic
constructs which are specially interpreted by tidy eval functions.
You will mostly need <code style="white-space: pre;">&#8288;{{&#8288;</code>, as <code style="white-space: pre;">&#8288;!!&#8288;</code> and <code style="white-space: pre;">&#8288;!!!&#8288;</code> are more advanced
operators which you should not have to use in simple cases.
</p>
<p>The curly-curly operator <code style="white-space: pre;">&#8288;{{&#8288;</code> allows you to tunnel data-variables
passed from function arguments inside other tidy eval functions.
<code style="white-space: pre;">&#8288;{{&#8288;</code> is designed for individual arguments. To pass multiple
arguments contained in dots, use <code>...</code> in the normal way.
</p>
<div class="sourceCode"><pre>my_function &lt;- function(data, var, ...) {
  data %&gt;%
    group_by(...) %&gt;%
    summarise(mean = mean({{ var }}))
}
</pre></div>
</li>
<li> <p><code><a href="#topic+enquo">enquo()</a></code> and <code><a href="#topic+enquos">enquos()</a></code> delay the execution of one or several
function arguments. The former returns a single expression, the
latter returns a list of expressions. Once defused, expressions
will no longer evaluate on their own. They must be injected back
into an evaluation context with <code style="white-space: pre;">&#8288;!!&#8288;</code> (for a single expression) and
<code style="white-space: pre;">&#8288;!!!&#8288;</code> (for a list of expressions).
</p>
<div class="sourceCode"><pre>my_function &lt;- function(data, var, ...) {
  # Defuse
  var &lt;- enquo(var)
  dots &lt;- enquos(...)

  # Inject
  data %&gt;%
    group_by(!!!dots) %&gt;%
    summarise(mean = mean(!!var))
}
</pre></div>
<p>In this simple case, the code is equivalent to the usage of <code style="white-space: pre;">&#8288;{{&#8288;</code>
and <code>...</code> above. Defusing with <code>enquo()</code> or <code>enquos()</code> is only
needed in more complex cases, for instance if you need to inspect
or modify the expressions in some way.
</p>
</li>
<li><p> The <code>.data</code> pronoun is an object that represents the current
slice of data. If you have a variable name in a string, use the
<code>.data</code> pronoun to subset that variable with <code>[[</code>.
</p>
<div class="sourceCode"><pre>my_var &lt;- "disp"
mtcars %&gt;% summarise(mean = mean(.data[[my_var]]))
</pre></div>
</li>
<li><p> Another tidy eval operator is <code style="white-space: pre;">&#8288;:=&#8288;</code>. It makes it possible to use
glue and curly-curly syntax on the LHS of <code>=</code>. For technical
reasons, the R language doesn't support complex expressions on
the left of <code>=</code>, so we use <code style="white-space: pre;">&#8288;:=&#8288;</code> as a workaround.
</p>
<div class="sourceCode"><pre>my_function &lt;- function(data, var, suffix = "foo") {
  # Use `{{` to tunnel function arguments and the usual glue
  # operator `{` to interpolate plain strings.
  data %&gt;%
    summarise("{{ var }}_mean_{suffix}" := mean({{ var }}))
}
</pre></div>
</li>
<li><p> Many tidy eval functions like <code>dplyr::mutate()</code> or
<code>dplyr::summarise()</code> give an automatic name to unnamed inputs. If
you need to create the same sort of automatic names by yourself,
use <code>as_label()</code>. For instance, the glue-tunnelling syntax above
can be reproduced manually with:
</p>
<div class="sourceCode"><pre>my_function &lt;- function(data, var, suffix = "foo") {
  var &lt;- enquo(var)
  prefix &lt;- as_label(var)
  data %&gt;%
    summarise("{prefix}_mean_{suffix}" := mean(!!var))
}
</pre></div>
<p>Expressions defused with <code>enquo()</code> (or tunnelled with <code style="white-space: pre;">&#8288;{{&#8288;</code>) need
not be simple column names, they can be arbitrarily complex.
<code>as_label()</code> handles those cases gracefully. If your code assumes
a simple column name, use <code>as_name()</code> instead. This is safer
because it throws an error if the input is not a name as expected.
</p>
</li></ul>



<h3>Value</h3>

<p>No return value, called for side effects
</p>

<hr>
<h2 id='uniteNameLevel'>Unite one or more columns in name-level format.</h2><span id='topic+uniteNameLevel'></span>

<h3>Description</h3>

<p>Unite one or more columns in name-level format.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>uniteNameLevel(
  x,
  cols,
  name = "group_name",
  level = "group_level",
  keep = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="uniteNameLevel_+3A_x">x</code></td>
<td>
<p>Tibble or data.frame.</p>
</td></tr>
<tr><td><code id="uniteNameLevel_+3A_cols">cols</code></td>
<td>
<p>Columns to aggregate.</p>
</td></tr>
<tr><td><code id="uniteNameLevel_+3A_name">name</code></td>
<td>
<p>Column name of the <code>name</code> column.</p>
</td></tr>
<tr><td><code id="uniteNameLevel_+3A_level">level</code></td>
<td>
<p>Column name of the <code>level</code> column.</p>
</td></tr>
<tr><td><code id="uniteNameLevel_+3A_keep">keep</code></td>
<td>
<p>Whether to keep the original columns.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A Tibble with the new columns.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
x &lt;- dplyr::tibble(
  variable = "number subjects",
  value = c(10, 15, 40, 78),
  sex = c("Male", "Female", "Male", "Female"),
  age_group = c("&lt;40", "&gt;40", "&gt;40", "&lt;40")
)

x

x %&gt;%
  CohortSurvival:::uniteNameLevel(
    cols = c("sex", "age_group"),
    name = "new_column_name",
    level = "new_column_level"
  )



</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
