<!DOCTYPE html><html><head><title>Help for package AzureRMR</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {AzureRMR}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#az_resource'><p>Azure resource class</p></a></li>
<li><a href='#az_resource_group'><p>Azure resource group class</p></a></li>
<li><a href='#az_rm'><p>Azure Resource Manager</p></a></li>
<li><a href='#az_role_assignment'><p>Azure role assignment class</p></a></li>
<li><a href='#az_role_definition'><p>Azure role definition class</p></a></li>
<li><a href='#az_subscription'><p>Azure subscription class</p></a></li>
<li><a href='#az_template'><p>Azure template class</p></a></li>
<li><a href='#build_template_definition'><p>Build the JSON for a template and its parameters</p></a></li>
<li><a href='#call_azure_rm'><p>Call the Azure Resource Manager REST API</p></a></li>
<li><a href='#create_azure_login'><p>Login to Azure Resource Manager</p></a></li>
<li><a href='#init_pool'><p>Manage parallel Azure connections</p></a></li>
<li><a href='#is_azure_login'><p>Informational functions</p></a></li>
<li><a href='#is_url'><p>Miscellaneous utility functions</p></a></li>
<li><a href='#lock'><p>Management locks</p></a></li>
<li><a href='#rbac'><p>Role-based access control (RBAC)</p></a></li>
<li><a href='#reexports'><p>Objects exported from other packages</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Interface to 'Azure Resource Manager'</td>
</tr>
<tr>
<td>Version:</td>
<td>2.4.4</td>
</tr>
<tr>
<td>Description:</td>
<td>A lightweight but powerful R interface to the 'Azure Resource Manager' REST API. The package exposes a comprehensive class framework and related tools for creating, updating and deleting 'Azure' resource groups, resources and templates. While 'AzureRMR' can be used to manage any 'Azure' service, it can also be extended by other packages to provide extra functionality for specific services. Part of the 'AzureR' family of packages.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/Azure/AzureRMR">https://github.com/Azure/AzureRMR</a> <a href="https://github.com/Azure/AzureR">https://github.com/Azure/AzureR</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/Azure/AzureRMR/issues">https://github.com/Azure/AzureRMR/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.3)</td>
</tr>
<tr>
<td>Imports:</td>
<td>AzureGraph (&ge; 1.2.0), AzureAuth (&ge; 1.2.1), utils, parallel,
httr (&ge; 1.3), jsonlite, R6, uuid</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat, httpuv, AzureStor</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-09-21 08:23:36 UTC; hongo</td>
</tr>
<tr>
<td>Author:</td>
<td>Hong Ooi [aut, cre],
  Microsoft [cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Hong Ooi &lt;hongooi73@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-09-21 08:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='az_resource'>Azure resource class</h2><span id='topic+az_resource'></span>

<h3>Description</h3>

<p>Class representing a generic Azure resource.
</p>


<h3>Format</h3>

<p>An R6 object of class <code>az_resource</code>.
</p>


<h3>Methods</h3>


<ul>
<li> <p><code>new(...)</code>: Initialize a new resource object. See 'Initialization' for more details.
</p>
</li>
<li> <p><code>delete(confirm=TRUE, wait=FALSE)</code>: Delete this resource, after a confirmation check. Optionally wait for the delete to finish.
</p>
</li>
<li> <p><code>update(...)</code>: Update this resource on the host.
</p>
</li>
<li> <p><code>sync_fields()</code>: Synchronise the R object with the resource it represents in Azure. Returns the <code>properties$provisioningState</code> field, so you can query this programmatically to check if a resource has finished provisioning. Not all resource types require explicit provisioning, in which case this method will return NULL.
</p>
</li>
<li> <p><code>set_api_version(api_version, stable_only=TRUE)</code>: Set the API version to use when interacting with the host. If <code>api_version</code> is not supplied, use the latest version available, either the latest stable version (if <code>stable_only=TRUE</code>) or the latest preview version (if <code>stable_only=FALSE</code>).
</p>
</li>
<li> <p><code>get_api_version()</code>: Get the current API version.
</p>
</li>
<li> <p><code>get_subresource(type, name)</code>: Get a sub-resource of this resource. See 'Sub-resources' below.
</p>
</li>
<li> <p><code>create_subresource(type, name, ...)</code>: Create a sub-resource of this resource.
</p>
</li>
<li> <p><code>delete_subresource(type, name, confirm=TRUE)</code>: Delete a sub-resource of this resource.
</p>
</li>
<li> <p><code>do_operation(...)</code>: Carry out an operation. See 'Operations' for more details.
</p>
</li>
<li> <p><code>set_tags(..., keep_existing=TRUE)</code>: Set the tags on this resource. The tags can be either names or name-value pairs. To delete a tag, set it to <code>NULL</code>.
</p>
</li>
<li> <p><code>get_tags()</code>: Get the tags on this resource.
</p>
</li>
<li> <p><code>create_lock(name, level)</code>: Create a management lock on this resource.
</p>
</li>
<li> <p><code>get_lock(name)</code>: Returns a management lock object.
</p>
</li>
<li> <p><code>delete_lock(name)</code>: Deletes a management lock object.
</p>
</li>
<li> <p><code>list_locks()</code>: List all locks that apply to this resource. Note this includes locks created at the subscription or resource group level.
</p>
</li>
<li> <p><code>add_role_assignment(name, ...)</code>: Adds a new role assignment. See 'Role-based access control' below.
</p>
</li>
<li> <p><code>get_role_assignment(id)</code>: Retrieves an existing role assignment.
</p>
</li>
<li> <p><code>remove_role_assignment(id)</code>: Removes an existing role assignment.
</p>
</li>
<li> <p><code>list_role_assignments()</code>: Lists role assignments.
</p>
</li>
<li> <p><code>get_role_definition(id)</code>: Retrieves an existing role definition.
</p>
</li>
<li> <p><code>list_role_definitions()</code> Lists role definitions.
</p>
</li></ul>



<h3>Initialization</h3>

<p>There are multiple ways to initialize a new resource object. The <code>new()</code> method can retrieve an existing resource, deploy/create a new resource, or create an empty/null object (without communicating with the host), based on the arguments you supply.
</p>
<p>All of these initialization options have the following arguments in common.
</p>

<ol>
<li> <p><code>token</code>: An OAuth 2.0 token, as generated by <a href="#topic+get_azure_token">get_azure_token</a>.
</p>
</li>
<li> <p><code>subscription</code>: The subscription ID.
</p>
</li>
<li> <p><code>api_version</code>: Optionally, the API version to use when interacting with the host. By default, this is NULL in which case the latest API version will be used.
</p>
</li>
<li><p> A set of <em>identifying arguments</em>:
</p>

<ul>
<li> <p><code>resource_group</code>: The resource group containing the resource.
</p>
</li>
<li> <p><code>id</code>: The full ID of the resource. This is a string of the form <code style="white-space: pre;">&#8288;/subscriptions/{uuid}/resourceGroups/{resource-group-name}/provider/{resource-provider-name}/{resource-path}/{resource-name}&#8288;</code>.
</p>
</li>
<li> <p><code>provider</code>: The provider of the resource, eg <code>Microsoft.Compute</code>.
</p>
</li>
<li> <p><code>path</code>: The path to the resource, eg <code>virtualMachines</code>.
</p>
</li>
<li> <p><code>type</code>: The combination of provider and path, eg <code>Microsoft.Compute/virtualMachines</code>.
</p>
</li>
<li> <p><code>name</code>: The name of the resource instance, eg <code>myWindowsVM</code>.
</p>
</li></ul>

</li></ol>

<p>Providing <code>id</code> will fill in the values for all the other identifying arguments. Similarly, providing <code>type</code> will fill in the values for <code>provider</code> and <code>path</code>. Unless you provide <code>id</code>, you must also provide <code>name</code>.
</p>
<p>The default behaviour for <code>new()</code> is to retrieve an existing resource, which occurs if you supply only the arguments listed above. If you also supply an argument <code>deployed_properties=NULL</code>, this will create a null object. If you supply any other (named) arguments, <code>new()</code> will create a new object on the host, with the supplied arguments as parameters.
</p>
<p>Generally, the easiest way to initialize an object is via the <code>get_resource</code>, <code>create_resource</code> or <code>list_resources</code> methods of the <a href="#topic+az_resource_group">az_resource_group</a> class, which will handle all the gory details automatically.
</p>


<h3>Operations</h3>

<p>The <code>do_operation()</code> method allows you to carry out arbitrary operations on the resource. It takes the following arguments:
</p>

<ul>
<li> <p><code>op</code>: The operation in question, which will be appended to the URL path of the request.
</p>
</li>
<li> <p><code>options</code>: A named list giving the URL query parameters.
</p>
</li>
<li> <p><code>...</code>: Other named arguments passed to <a href="#topic+call_azure_rm">call_azure_rm</a>, and then to the appropriate call in httr. In particular, use <code>body</code> to supply the body of a PUT, POST or PATCH request.
</p>
</li>
<li> <p><code>http_verb</code>: The HTTP verb as a string, one of <code>GET</code>, <code>PUT</code>, <code>POST</code>, <code>DELETE</code>, <code>HEAD</code> or <code>PATCH</code>.
</p>
</li></ul>

<p>Consult the Azure documentation for your resource to find out what operations are supported.
</p>


<h3>Sub-resources</h3>

<p>Some resource types can have sub-resources: objects exposed by Resource Manager that make up a part of their parent's functionality. For example, a storage account (type <code>Microsoft.Storage/storageAccounts</code>) provides the blob storage service, which can be accessed via Resource Manager as a sub-resource of type <code>Microsoft.Storage/storageAccounts/blobServices/default</code>.
</p>
<p>To retrieve an existing sub-resource, use the <code>get_subresource()</code> method. You do not need to include the parent resource's type and name. For example, if <code>res</code> is a resource for a storage account, and you want to retrieve the sub-resource for the blob container &quot;myblobs&quot;, call
</p>
<div class="sourceCode"><pre>res$get_subresource(type="blobServices/default/containers", name="myblobs")
</pre></div>
<p>Notice that the storage account's resource type and name are omitted from the <code>get_subresource</code> arguments. Similarly, to create a new subresource, call the <code>create_subresource()</code> method with the same naming convention, passing any required fields as named arguments; and to delete it, call <code>delete_subresource()</code>.
</p>


<h3>Role-based access control</h3>

<p>AzureRMR implements a subset of the full RBAC functionality within Azure Active Directory. You can retrieve role definitions and add and remove role assignments, at the subscription, resource group and resource levels. See <a href="#topic+rbac">rbac</a> for more information.
</p>


<h3>See Also</h3>

<p><a href="#topic+az_resource_group">az_resource_group</a>, <a href="#topic+call_azure_rm">call_azure_rm</a>, <a href="#topic+call_azure_url">call_azure_url</a>,
<a href="https://learn.microsoft.com/en-us/rest/api/resources/resources">Resources API reference</a>
</p>
<p>For role-based access control methods, see <a href="#topic+rbac">rbac</a>
</p>
<p>For management locks, see <a href="#topic+lock">lock</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

# recommended way to retrieve a resource: via a resource group object
# storage account:
stor &lt;- resgroup$get_resource(type="Microsoft.Storage/storageAccounts", name="mystorage")
# virtual machine:
vm &lt;- resgroup$get_resource(type="Microsoft.Compute/virtualMachines", name="myvm")

## carry out operations on a resource

# storage account: get access keys
stor$do_operation("listKeys", http_verb="POST")

# virtual machine: run a script
vm$do_operation("runCommand",
    body=list(
        commandId="RunShellScript", # RunPowerShellScript for Windows
        script=as.list("ifconfig &gt; /tmp/ifconfig.out")
    ),
    encode="json",
    http_verb="POST")

## retrieve properties

# storage account: endpoint URIs
stor$properties$primaryEndpoints$file
stor$properties$primaryEndpoints$blob

# virtual machine: hardware profile
vm$properties$hardwareProfile

## update a resource: resizing a VM
properties &lt;- list(hardwareProfile=list(vmSize="Standard_DS3_v2"))
vm$do_operation(http_verb="PATCH",
    body=list(properties=properties),
    encode="json")

# sync with Azure: useful to track resource creation/update status
vm$sync_fields()

## subresource: create a public blob container
stor$create_subresource(type="blobservices/default/containers", name="mycontainer",
    properties=list(publicAccess="container"))

## delete a subresource and resource
stor$delete_subresource(type="blobservices/default/containers", name="mycontainer")
stor$delete()


## End(Not run)
</code></pre>

<hr>
<h2 id='az_resource_group'>Azure resource group class</h2><span id='topic+az_resource_group'></span>

<h3>Description</h3>

<p>Class representing an Azure resource group.
</p>


<h3>Format</h3>

<p>An R6 object of class <code>az_resource_group</code>.
</p>


<h3>Methods</h3>


<ul>
<li> <p><code>new(token, subscription, id, ...)</code>: Initialize a resource group object. See 'Initialization' for more details.
</p>
</li>
<li> <p><code>delete(confirm=TRUE)</code>: Delete this resource group, after a confirmation check. This is asynchronous: while the method returns immediately, the delete operation continues on the host in the background. For resource groups containing a large number of deployed resources, this may take some time to complete.
</p>
</li>
<li> <p><code>sync_fields()</code>: Synchronise the R object with the resource group it represents in Azure.
</p>
</li>
<li> <p><code>list_templates(filter, top)</code>: List deployed templates in this resource group. <code>filter</code> and <code>top</code> are optional arguments to filter the results; see the <a href="https://learn.microsoft.com/en-us/rest/api/resources/deployments/listbyresourcegroup">Azure documentation</a> for more details. If <code>top</code> is specified, the returned list will have a maximum of this many items.
</p>
</li>
<li> <p><code>get_template(name)</code>: Return an object representing an existing template.
</p>
</li>
<li> <p><code>deploy_template(...)</code>: Deploy a new template. See 'Templates' for more details. By default, AzureRMR will set the <code>createdBy</code> tag on a newly-deployed template to the value <code>AzureR/AzureRMR</code>.
</p>
</li>
<li> <p><code>delete_template(name, confirm=TRUE, free_resources=FALSE)</code>: Delete a deployed template, and optionally free any resources that were created.
</p>
</li>
<li> <p><code>get_resource(...)</code>: Return an object representing an existing resource. See 'Resources' for more details.
</p>
</li>
<li> <p><code>create_resource(...)</code>: Create a new resource. By default, AzureRMR will set the <code>createdBy</code> tag on a newly-created resource to the value <code>AzureR/AzureRMR</code>.
</p>
</li>
<li> <p><code>delete_resource(..., confirm=TRUE, wait=FALSE)</code>: Delete an existing resource. Optionally wait for the delete to finish.
</p>
</li>
<li> <p><code>resource_exists(...)</code>: Check if a resource exists.
</p>
</li>
<li> <p><code>list_resources(filter, expand, top)</code>: Return a list of resource group objects for this subscription. <code>filter</code>, <code>expand</code> and <code>top</code> are optional arguments to filter the results; see the <a href="https://learn.microsoft.com/en-us/rest/api/resources/resources/list">Azure documentation</a> for more details. If <code>top</code> is specified, the returned list will have a maximum of this many items.
</p>
</li>
<li> <p><code>do_operation(...)</code>: Carry out an operation. See 'Operations' for more details.
</p>
</li>
<li> <p><code>set_tags(..., keep_existing=TRUE)</code>: Set the tags on this resource group. The tags can be either names or name-value pairs. To delete a tag, set it to <code>NULL</code>.
</p>
</li>
<li> <p><code>get_tags()</code>: Get the tags on this resource group.
</p>
</li>
<li> <p><code>create_lock(name, level)</code>: Create a management lock on this resource group (which will propagate to all resources within it).
</p>
</li>
<li> <p><code>get_lock(name)</code>: Returns a management lock object.
</p>
</li>
<li> <p><code>delete_lock(name)</code>: Deletes a management lock object.
</p>
</li>
<li> <p><code>list_locks()</code>: List all locks that apply to this resource group. Note this includes locks created at the subscription level, and for any resources within the resource group.
</p>
</li>
<li> <p><code>add_role_assignment(name, ...)</code>: Adds a new role assignment. See 'Role-based access control' below.
</p>
</li>
<li> <p><code>get_role_assignment(id)</code>: Retrieves an existing role assignment.
</p>
</li>
<li> <p><code>remove_role_assignment(id)</code>: Removes an existing role assignment.
</p>
</li>
<li> <p><code>list_role_assignments()</code>: Lists role assignments.
</p>
</li>
<li> <p><code>get_role_definition(id)</code>: Retrieves an existing role definition.
</p>
</li>
<li> <p><code>list_role_definitions()</code> Lists role definitions.
</p>
</li></ul>



<h3>Initialization</h3>

<p>Initializing a new object of this class can either retrieve an existing resource group, or create a new resource group on the host. Generally, the easiest way to create a resource group object is via the <code>get_resource_group</code>, <code>create_resource_group</code> or <code>list_resource_groups</code> methods of the <a href="#topic+az_subscription">az_subscription</a> class, which handle this automatically.
</p>
<p>To create a resource group object in isolation, supply (at least) an Oauth 2.0 token of class <a href="AzureAuth.html#topic+AzureToken">AzureToken</a>, the subscription ID, and the resource group name. If this object refers to a <em>new</em> resource group, supply the location as well (use the <code>list_locations</code> method of the <code style="white-space: pre;">&#8288;az_subscription class&#8288;</code> for possible locations). You can also pass any optional parameters for the resource group as named arguments to <code>new()</code>.
</p>


<h3>Templates</h3>

<p>To deploy a new template, pass the following arguments to <code>deploy_template()</code>:
</p>

<ul>
<li> <p><code>name</code>: The name of the deployment.
</p>
</li>
<li> <p><code>template</code>: The template to deploy. This can be provided in a number of ways:
</p>

<ol>
<li><p> A nested list of name-value pairs representing the parsed JSON
</p>
</li>
<li><p> The name of a template file
</p>
</li>
<li><p> A vector of strings containing unparsed JSON
</p>
</li>
<li><p> A URL from which the template can be downloaded
</p>
</li></ol>

</li>
<li> <p><code>parameters</code>: The parameters for the template. This can be provided using any of the same methods as the <code>template</code> argument.
</p>
</li>
<li> <p><code>wait</code>: Optionally, whether or not to wait until the deployment is complete before returning. Defaults to <code>FALSE</code>.
</p>
</li></ul>

<p>Retrieving or deleting a deployed template requires only the name of the deployment.
</p>


<h3>Resources</h3>

<p>There are a number of arguments to <code>get_resource()</code>, <code>create_resource()</code> and <code>delete_resource()</code> that serve to identify the specific resource in question:
</p>

<ul>
<li> <p><code>id</code>: The full ID of the resource, including subscription ID and resource group.
</p>
</li>
<li> <p><code>provider</code>: The provider of the resource, eg <code>Microsoft.Compute</code>.
</p>
</li>
<li> <p><code>path</code>: The full path to the resource, eg <code>virtualMachines</code>.
</p>
</li>
<li> <p><code>type</code>: The combination of provider and path, eg <code>Microsoft.Compute/virtualMachines</code>.
</p>
</li>
<li> <p><code>name</code>: The name of the resource instance, eg <code>myWindowsVM</code>.
</p>
</li></ul>

<p>Providing the <code>id</code> argument will fill in the values for all the other arguments. Similarly, providing the <code>type</code> argument will fill in the values for <code>provider</code> and <code>path</code>. Unless you provide <code>id</code>, you must also provide <code>name</code>.
</p>
<p>To create/deploy a new resource, specify any extra parameters that the provider needs as named arguments to <code>create_resource()</code>. Like <code>deploy_template()</code>, <code>create_resource()</code> also takes an optional <code>wait</code> argument that specifies whether to wait until resource creation is complete before returning.
</p>


<h3>Operations</h3>

<p>The <code>do_operation()</code> method allows you to carry out arbitrary operations on the resource group. It takes the following arguments:
</p>

<ul>
<li> <p><code>op</code>: The operation in question, which will be appended to the URL path of the request.
</p>
</li>
<li> <p><code>options</code>: A named list giving the URL query parameters.
</p>
</li>
<li> <p><code>...</code>: Other named arguments passed to <a href="#topic+call_azure_rm">call_azure_rm</a>, and then to the appropriate call in httr. In particular, use <code>body</code> to supply the body of a PUT, POST or PATCH request, and <code>api_version</code> to set the API version.
</p>
</li>
<li> <p><code>http_verb</code>: The HTTP verb as a string, one of <code>GET</code>, <code>PUT</code>, <code>POST</code>, <code>DELETE</code>, <code>HEAD</code> or <code>PATCH</code>.
</p>
</li></ul>

<p>Consult the Azure documentation for what operations are supported.
</p>


<h3>Role-based access control</h3>

<p>AzureRMR implements a subset of the full RBAC functionality within Azure Active Directory. You can retrieve role definitions and add and remove role assignments, at the subscription, resource group and resource levels. See <a href="#topic+rbac">rbac</a> for more information.
</p>


<h3>See Also</h3>

<p><a href="#topic+az_subscription">az_subscription</a>, <a href="#topic+az_template">az_template</a>, <a href="#topic+az_resource">az_resource</a>,
<a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/resource-group-overview#resource-groups">Azure resource group overview</a>,
<a href="https://learn.microsoft.com/en-us/rest/api/resources/resources">Resources API reference</a>,
<a href="https://learn.microsoft.com/en-us/rest/api/resources/deployments">Template API reference</a>
</p>
<p>For role-based access control methods, see <a href="#topic+rbac">rbac</a>
</p>
<p>For management locks, see <a href="#topic+lock">lock</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

# recommended way to retrieve a resource group object
rg &lt;- get_azure_login("myaadtenant")$
    get_subscription("subscription_id")$
    get_resource_group("rgname")

# list resources &amp; templates in this resource group
rg$list_resources()
rg$list_templates()

# get a resource (virtual machine)
rg$get_resource(type="Microsoft.Compute/virtualMachines", name="myvm")

# create a resource (storage account)
rg$create_resource(type="Microsoft.Storage/storageAccounts", name="mystorage",
    kind="StorageV2",
    sku=list(name="Standard_LRS"))

# delete a resource
rg$delete_resource(type="Microsoft.Storage/storageAccounts", name="mystorage")

# deploy a template
rg$deploy_template("tplname",
    template="template.json",
    parameters="parameters.json")

# deploy a template with parameters inline
rg$deploy_template("mydeployment",
    template="template.json",
    parameters=list(parm1="foo", parm2="bar"))

# delete a template and free resources
rg$delete_template("tplname", free_resources=TRUE)

# delete the resource group itself
rg$delete()


## End(Not run)
</code></pre>

<hr>
<h2 id='az_rm'>Azure Resource Manager</h2><span id='topic+az_rm'></span>

<h3>Description</h3>

<p>Base class for interacting with Azure Resource Manager.
</p>


<h3>Format</h3>

<p>An R6 object of class <code>az_rm</code>.
</p>


<h3>Methods</h3>


<ul>
<li> <p><code>new(tenant, app, ...)</code>: Initialize a new ARM connection with the given credentials. See 'Authentication' for more details.
</p>
</li>
<li> <p><code>list_subscriptions()</code>: Returns a list of objects, one for each subscription associated with this app ID.
</p>
</li>
<li> <p><code>get_subscription(id)</code>: Returns an object representing a subscription.
</p>
</li>
<li> <p><code>get_subscription_by_name(name)</code>: Returns the subscription with the given name (as opposed to a GUID).
</p>
</li>
<li> <p><code>do_operation(...)</code>: Carry out an operation. See 'Operations' for more details.
</p>
</li></ul>



<h3>Authentication</h3>

<p>The recommended way to authenticate with ARM is via the <a href="#topic+get_azure_login">get_azure_login</a> function, which creates a new instance of this class.
</p>
<p>To authenticate with the <code>az_rm</code> class directly, provide the following arguments to the <code>new</code> method:
</p>

<ul>
<li> <p><code>tenant</code>: Your tenant ID. This can be a name (&quot;myaadtenant&quot;), a fully qualified domain name (&quot;myaadtenant.onmicrosoft.com&quot; or &quot;mycompanyname.com&quot;), or a GUID.
</p>
</li>
<li> <p><code>app</code>: The client/app ID to use to authenticate with Azure Active Directory. The default is to login interactively using the Azure CLI cross-platform app, but it's recommended to supply your own app credentials if possible.
</p>
</li>
<li> <p><code>password</code>: if <code>auth_type == "client_credentials"</code>, the app secret; if <code>auth_type == "resource_owner"</code>, your account password.
</p>
</li>
<li> <p><code>username</code>: if <code>auth_type == "resource_owner"</code>, your username.
</p>
</li>
<li> <p><code>certificate</code>: If 'auth_type == &quot;client_credentials&quot;, a certificate to authenticate with. This is a more secure alternative to using an app secret.
</p>
</li>
<li> <p><code>auth_type</code>: The OAuth authentication method to use, one of &quot;client_credentials&quot;, &quot;authorization_code&quot;, &quot;device_code&quot; or &quot;resource_owner&quot;. See <a href="#topic+get_azure_token">get_azure_token</a> for how the default method is chosen, along with some caveats.
</p>
</li>
<li> <p><code>version</code>: The Azure Active Directory version to use for authenticating.
</p>
</li>
<li> <p><code>host</code>: your ARM host. Defaults to <code style="white-space: pre;">&#8288;https://management.azure.com/&#8288;</code>. Change this if you are using a government or private cloud.
</p>
</li>
<li> <p><code>aad_host</code>: Azure Active Directory host for authentication. Defaults to <code style="white-space: pre;">&#8288;https://login.microsoftonline.com/&#8288;</code>. Change this if you are using a government or private cloud.
</p>
</li>
<li> <p><code>...</code>: Further arguments to pass to <code>get_azure_token</code>.
</p>
</li>
<li> <p><code>scopes</code>: The Azure Service Management scopes (permissions) to obtain for this login. Only for <code>version=2</code>.
</p>
</li>
<li> <p><code>token</code>: Optionally, an OAuth 2.0 token, of class <a href="AzureAuth.html#topic+AzureToken">AzureToken</a>. This allows you to reuse the authentication details for an existing session. If supplied, all other arguments will be ignored.
</p>
</li></ul>



<h3>Operations</h3>

<p>The <code>do_operation()</code> method allows you to carry out arbitrary operations on the Resource Manager endpoint. It takes the following arguments:
</p>

<ul>
<li> <p><code>op</code>: The operation in question, which will be appended to the URL path of the request.
</p>
</li>
<li> <p><code>options</code>: A named list giving the URL query parameters.
</p>
</li>
<li> <p><code>...</code>: Other named arguments passed to <a href="#topic+call_azure_rm">call_azure_rm</a>, and then to the appropriate call in httr. In particular, use <code>body</code> to supply the body of a PUT, POST or PATCH request, and <code>api_version</code> to set the API version.
</p>
</li>
<li> <p><code>http_verb</code>: The HTTP verb as a string, one of <code>GET</code>, <code>PUT</code>, <code>POST</code>, <code>DELETE</code>, <code>HEAD</code> or <code>PATCH</code>.
</p>
</li></ul>

<p>Consult the Azure documentation for what operations are supported.
</p>


<h3>See Also</h3>

<p><a href="#topic+create_azure_login">create_azure_login</a>, <a href="#topic+get_azure_login">get_azure_login</a>
</p>
<p><a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/resource-group-overview">Azure Resource Manager overview</a>,
<a href="https://learn.microsoft.com/en-us/rest/api/resources/">REST API reference</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

# start a new Resource Manager session
az &lt;- az_rm$new(tenant="myaadtenant.onmicrosoft.com", app="app_id", password="password")

# authenticate with credentials in a file
az &lt;- az_rm$new(config_file="creds.json")

# authenticate with device code
az &lt;- az_rm$new(tenant="myaadtenant.onmicrosoft.com", app="app_id", auth_type="device_code")

# retrieve a list of subscription objects
az$list_subscriptions()

# a specific subscription
az$get_subscription("subscription_id")


## End(Not run)
</code></pre>

<hr>
<h2 id='az_role_assignment'>Azure role assignment class</h2><span id='topic+az_role_assignment'></span>

<h3>Description</h3>

<p>Azure role assignment class
</p>


<h3>Format</h3>

<p>An R6 object of class <code>az_role_assignment</code>.
</p>


<h3>Fields</h3>


<ul>
<li> <p><code>id</code>: The full resource ID for this role assignment.
</p>
</li>
<li> <p><code>type</code>: The resource type for a role assignment. Always <code>Microsoft.Authorization/roleAssignments</code>.
</p>
</li>
<li> <p><code>name</code>: A GUID that identifies this role assignment.
</p>
</li>
<li> <p><code>role_name</code>: The role definition name (in text), eg &quot;Contributor&quot;.
</p>
</li>
<li> <p><code>properties</code>: Properties for the role definition.
</p>
</li>
<li> <p><code>token</code>: An OAuth token, obtained via <a href="#topic+get_azure_token">get_azure_token</a>.
</p>
</li></ul>



<h3>Methods</h3>


<ul>
<li> <p><code>remove(confirm=TRUE)</code>: Removes this role assignment.
</p>
</li></ul>



<h3>Initialization</h3>

<p>The recommended way to create new instances of this class is via the <a href="#topic+add_role_assignment">add_role_assignment</a> and <a href="#topic+get_role_assignment">get_role_assignment</a> methods for subscription, resource group and resource objects.
</p>
<p>Technically role assignments and role definitions are Azure <em>resources</em>, and could be implemented as subclasses of <code>az_resource</code>. AzureRMR treats them as distinct, due to limited RBAC functionality currently supported.
</p>


<h3>See Also</h3>

<p><a href="#topic+add_role_assignment">add_role_assignment</a>, <a href="#topic+get_role_assignment">get_role_assignment</a>, <a href="#topic+get_role_definition">get_role_definition</a>, <a href="#topic+az_role_definition">az_role_definition</a>
</p>
<p><a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/overview">Overview of role-based access control</a>
</p>

<hr>
<h2 id='az_role_definition'>Azure role definition class</h2><span id='topic+az_role_definition'></span>

<h3>Description</h3>

<p>Azure role definition class
</p>


<h3>Format</h3>

<p>An R6 object of class <code>az_role_definition</code>.
</p>


<h3>Fields</h3>


<ul>
<li> <p><code>id</code>: The full resource ID for this role definition.
</p>
</li>
<li> <p><code>type</code>: The resource type for a role definition. Always <code>Microsoft.Authorization/roleDefinitions</code>.
</p>
</li>
<li> <p><code>name</code>: A GUID that identifies this role definition.
</p>
</li>
<li> <p><code>properties</code>: Properties for the role definition.
</p>
</li></ul>



<h3>Methods</h3>

<p>This class has no methods.
</p>


<h3>Initialization</h3>

<p>The recommended way to create new instances of this class is via the <a href="#topic+get_role_definition">get_role_definition</a> method for subscription, resource group and resource objects.
</p>
<p>Technically role assignments and role definitions are Azure <em>resources</em>, and could be implemented as subclasses of <code>az_resource</code>. AzureRMR treats them as distinct, due to limited RBAC functionality currently supported. In particular, role definitions are read-only: you can retrieve a definition, but not modify it, nor create new definitions.
</p>


<h3>See Also</h3>

<p><a href="#topic+get_role_definition">get_role_definition</a>, <a href="#topic+get_role_assignment">get_role_assignment</a>, <a href="#topic+az_role_assignment">az_role_assignment</a>
</p>
<p><a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/overview">Overview of role-based access control</a>
</p>

<hr>
<h2 id='az_subscription'>Azure subscription class</h2><span id='topic+az_subscription'></span>

<h3>Description</h3>

<p>Class representing an Azure subscription.
</p>


<h3>Format</h3>

<p>An R6 object of class <code>az_subscription</code>.
</p>


<h3>Methods</h3>


<ul>
<li> <p><code>new(token, id, ...)</code>: Initialize a subscription object.
</p>
</li>
<li> <p><code>list_resource_groups(filter, top)</code>: Return a list of resource group objects for this subscription. <code>filter</code> and <code>top</code> are optional arguments to filter the results; see the <a href="https://learn.microsoft.com/en-us/rest/api/resources/resourcegroups/list">Azure documentation</a> for more details. If <code>top</code> is specified, the returned list will have a maximum of this many items.
</p>
</li>
<li> <p><code>get_resource_group(name)</code>: Return an object representing an existing resource group.
</p>
</li>
<li> <p><code>create_resource_group(name, location)</code>: Create a new resource group in the specified region/location, and return an object representing it. By default, AzureRMR will set the <code>createdBy</code> tag on a newly-created resource group to the value <code>AzureR/AzureRMR</code>.
</p>
</li>
<li> <p><code>delete_resource_group(name, confirm=TRUE)</code>: Delete a resource group, after asking for confirmation.
</p>
</li>
<li> <p><code>resource_group_exists(name)</code>: Check if a resource group exists.
</p>
</li>
<li> <p><code>list_resources(filter, expand, top)</code>: List all resources deployed under this subscription. <code>filter</code>, <code>expand</code> and <code>top</code> are optional arguments to filter the results; see the <a href="https://learn.microsoft.com/en-us/rest/api/resources/resources/list">Azure documentation</a> for more details. If <code>top</code> is specified, the returned list will have a maximum of this many items.
</p>
</li>
<li> <p><code>list_locations(info=c("partial", "all"))</code>: List locations available. The default <code>info="partial"</code> returns a subset of the information about each location; set <code>info="all"</code> to return everything.
</p>
</li>
<li> <p><code>get_provider_api_version(provider, type, which=1, stable_only=TRUE)</code>: Get the current API version for the given resource provider and type. If no resource type is supplied, returns a vector of API versions, one for each resource type for the given provider. If neither provider nor type is supplied, returns the API versions for all resources and providers. Set <code>stable_only=FALSE</code> to allow preview APIs to be returned. Set <code>which</code> to a number &gt; 1 to return an API other than the most recent.
</p>
</li>
<li> <p><code>do_operation(...)</code>: Carry out an operation. See 'Operations' for more details.
</p>
</li>
<li> <p><code>create_lock(name, level)</code>: Create a management lock on this subscription (which will propagate to all resources within it).
</p>
</li>
<li> <p><code>get_lock(name)</code>: Returns a management lock object.
</p>
</li>
<li> <p><code>delete_lock(name)</code>: Deletes a management lock object.
</p>
</li>
<li> <p><code>list_locks()</code>: List all locks that exist in this subscription.
</p>
</li>
<li> <p><code>add_role_assignment(name, ...)</code>: Adds a new role assignment. See 'Role-based access control' below.
</p>
</li>
<li> <p><code>get_role_assignment(id)</code>: Retrieves an existing role assignment.
</p>
</li>
<li> <p><code>remove_role_assignment(id)</code>: Removes an existing role assignment.
</p>
</li>
<li> <p><code>list_role_assignments()</code>: Lists role assignments.
</p>
</li>
<li> <p><code>get_role_definition(id)</code>: Retrieves an existing role definition.
</p>
</li>
<li> <p><code>list_role_definitions()</code> Lists role definitions.
</p>
</li>
<li> <p><code>get_tags()</code> Get the tags on this subscription.
</p>
</li></ul>



<h3>Details</h3>

<p>Generally, the easiest way to create a subscription object is via the <code>get_subscription</code> or <code>list_subscriptions</code> methods of the <a href="#topic+az_rm">az_rm</a> class. To create a subscription object in isolation, call the <code>new()</code> method and supply an Oauth 2.0 token of class <a href="AzureAuth.html#topic+AzureToken">AzureToken</a>, along with the ID of the subscription.
</p>


<h3>Operations</h3>

<p>The <code>do_operation()</code> method allows you to carry out arbitrary operations on the subscription. It takes the following arguments:
</p>

<ul>
<li> <p><code>op</code>: The operation in question, which will be appended to the URL path of the request.
</p>
</li>
<li> <p><code>options</code>: A named list giving the URL query parameters.
</p>
</li>
<li> <p><code>...</code>: Other named arguments passed to <a href="#topic+call_azure_rm">call_azure_rm</a>, and then to the appropriate call in httr. In particular, use <code>body</code> to supply the body of a PUT, POST or PATCH request, and <code>api_version</code> to set the API version.
</p>
</li>
<li> <p><code>http_verb</code>: The HTTP verb as a string, one of <code>GET</code>, <code>PUT</code>, <code>POST</code>, <code>DELETE</code>, <code>HEAD</code> or <code>PATCH</code>.
</p>
</li></ul>

<p>Consult the Azure documentation for what operations are supported.
</p>


<h3>Role-based access control</h3>

<p>AzureRMR implements a subset of the full RBAC functionality within Azure Active Directory. You can retrieve role definitions and add and remove role assignments, at the subscription, resource group and resource levels. See <a href="#topic+rbac">rbac</a> for more information.
</p>


<h3>See Also</h3>

<p><a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/resource-group-overview">Azure Resource Manager overview</a>
</p>
<p>For role-based access control methods, see <a href="#topic+rbac">rbac</a>
</p>
<p>For management locks, see <a href="#topic+lock">lock</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

# recommended way to retrieve a subscription object
sub &lt;- get_azure_login("myaadtenant")$
    get_subscription("subscription_id")

# retrieve list of resource group objects under this subscription
sub$list_resource_groups()

# get a resource group
sub$get_resource_group("rgname")

# check if a resource group exists, and if not, create it
rg_exists &lt;- sub$resource_group_exists("rgname")
if(!rg_exists)
    sub$create_resource_group("rgname", location="australiaeast")

# delete a resource group
sub$delete_resource_group("rgname")

# get provider API versions for some resource types
sub$get_provider_api_version("Microsoft.Compute", "virtualMachines")
sub$get_provider_api_version("Microsoft.Storage", "storageAccounts")


## End(Not run)
</code></pre>

<hr>
<h2 id='az_template'>Azure template class</h2><span id='topic+az_template'></span>

<h3>Description</h3>

<p>Class representing an Azure deployment template.
</p>


<h3>Format</h3>

<p>An R6 object of class <code>az_template</code>.
</p>


<h3>Methods</h3>


<ul>
<li> <p><code>new(token, subscription, resource_group, name, ...)</code>: Initialize a new template object. See 'Initialization' for more details.
</p>
</li>
<li> <p><code>check()</code>: Check the deployment status of the template; throw an error if the template has been deleted.
</p>
</li>
<li> <p><code>cancel(free_resources=FALSE)</code>: Cancel an in-progress deployment. Optionally free any resources that have already been created.
</p>
</li>
<li> <p><code>delete(confirm=TRUE, free_resources=FALSE)</code>: Delete a deployed template, after a confirmation check. Optionally free any resources that were created. If the template was deployed in Complete mode (its resource group is exclusive to its use), the latter process will delete the entire resource group. Otherwise resources are deleted in the order given by the template's output resources list; in this case, some may be left behind if the ordering is incompatible with dependencies.
</p>
</li>
<li> <p><code>list_resources()</code>: Returns a list of Azure resource objects that were created by the template. This returns top-level resources only, not those that represent functionality provided by another resource.
</p>
</li>
<li> <p><code>get_tags()</code>: Returns the tags for the deployment template (note: this is not the same as the tags applied to resources that are deployed).
</p>
</li></ul>



<h3>Initialization</h3>

<p>Initializing a new object of this class can either retrieve an existing template, or deploy a new template on the host. Generally, the easiest way to create a template object is via the <code>get_template</code>, <code>deploy_template</code> or <code>list_templates</code> methods of the <a href="#topic+az_resource_group">az_resource_group</a> class, which handle the details automatically.
</p>
<p>To initialize an object that refers to an existing deployment, supply the following arguments to <code>new()</code>:
</p>

<ul>
<li> <p><code>token</code>: An OAuth 2.0 token, as generated by <a href="#topic+get_azure_token">get_azure_token</a>.
</p>
</li>
<li> <p><code>subscription</code>: The subscription ID.
</p>
</li>
<li> <p><code>resource_group</code>: The resource group.
</p>
</li>
<li> <p><code>name</code>: The deployment name'.
</p>
</li></ul>

<p>If you also supply the following arguments to <code>new()</code>, a new template will be deployed:
</p>

<ul>
<li> <p><code>template</code>: The template to deploy. This can be provided in a number of ways:
</p>

<ol>
<li><p> A nested list of R objects, which will be converted to JSON via <code>jsonlite::toJSON</code>
</p>
</li>
<li><p> A vector of strings containing unparsed JSON
</p>
</li>
<li><p> The name of a template file
</p>
</li>
<li><p> A URL from which the host can download the template
</p>
</li></ol>

</li>
<li> <p><code>parameters</code>: The parameters for the template. This can be provided using any of the same methods as the <code>template</code> argument.
</p>
</li>
<li> <p><code>wait</code>: Optionally, whether to wait until the deployment is complete. Defaults to FALSE, in which case the method will return immediately.
</p>
</li></ul>

<p>You can use the <code>build_template_definition</code> and <code>build_template_parameters</code> helper functions to construct the inputs for deploying a template. These can take as inputs R lists, JSON text strings, or file connections, and can also be extended by other packages.
</p>


<h3>See Also</h3>

<p><a href="#topic+az_resource_group">az_resource_group</a>, <a href="#topic+az_resource">az_resource</a>, <a href="#topic+build_template_definition">build_template_definition</a>, <a href="#topic+build_template_parameters">build_template_parameters</a>
<a href="https://learn.microsoft.com/en-us/azure/templates/">Template overview</a>,
<a href="https://learn.microsoft.com/en-us/rest/api/resources/deployments">Template API reference</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

# recommended way to deploy a template: via a resource group object

tpl &lt;- resgroup$deploy_template("mydeployment",
    template="template.json",
    parameters="parameters.json")

# retrieve list of created resource objects
tpl$list_resources()

# delete template (will not touch resources)
tpl$delete()

# delete template and free resources
tpl$delete(free_resources=TRUE)


## End(Not run)
</code></pre>

<hr>
<h2 id='build_template_definition'>Build the JSON for a template and its parameters</h2><span id='topic+build_template_definition'></span><span id='topic+build_template'></span><span id='topic+build_template_definition.default'></span><span id='topic+build_template_parameters'></span><span id='topic+build_template_parameters.default'></span>

<h3>Description</h3>

<p>Build the JSON for a template and its parameters
</p>


<h3>Usage</h3>

<pre><code class='language-R'>build_template_definition(...)

## Default S3 method:
build_template_definition(parameters = named_list(),
  variables = named_list(), functions = list(), resources = list(),
  outputs = named_list(), schema = "2019-04-01", version = "1.0.0.0",
  api_profile = NULL, ...)

build_template_parameters(...)

## Default S3 method:
build_template_parameters(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="build_template_definition_+3A_...">...</code></td>
<td>
<p>For <code>build_template_parameters</code>, named arguments giving the values of each template parameter. For <code>build_template_definition</code>, further arguments passed to class methods.</p>
</td></tr>
<tr><td><code id="build_template_definition_+3A_parameters">parameters</code></td>
<td>
<p>For <code>build_template_definition</code>, the parameter names and types for the template. See 'Details' below.</p>
</td></tr>
<tr><td><code id="build_template_definition_+3A_variables">variables</code></td>
<td>
<p>Internal variables used by the template.</p>
</td></tr>
<tr><td><code id="build_template_definition_+3A_functions">functions</code></td>
<td>
<p>User-defined functions used by the template.</p>
</td></tr>
<tr><td><code id="build_template_definition_+3A_resources">resources</code></td>
<td>
<p>List of resources that the template should deploy.</p>
</td></tr>
<tr><td><code id="build_template_definition_+3A_outputs">outputs</code></td>
<td>
<p>The template outputs.</p>
</td></tr>
<tr><td><code id="build_template_definition_+3A_schema">schema</code>, <code id="build_template_definition_+3A_version">version</code>, <code id="build_template_definition_+3A_api_profile">api_profile</code></td>
<td>
<p>Less commonly used arguments that can be used to customise the template. See the guide to template syntax on Microsoft Docs, linked below.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>build_template_definition</code> is used to generate a template from its components. The main arguments are <code>parameters</code>, <code>variables</code>, <code>functions</code>, <code>resources</code> and <code>outputs</code>. Each of these can be specified in various ways:
</p>

<ul>
<li><p> As character strings containing unparsed JSON text.
</p>
</li>
<li><p> As an R list of (nested) objects, which will be converted to JSON via <code>jsonlite::toJSON</code>.
</p>
</li>
<li><p> A connection pointing to a JSON file or object.
</p>
</li>
<li><p> For the <code>parameters</code> argument, this can also be a character vector containing the types of each parameter.
</p>
</li></ul>

<p><code>build_template_parameters</code> is for creating the list of parameters to be passed along with the template. Its arguments should all be named, and contain either the JSON text or an R list giving the parsed JSON.
</p>
<p>Both of these are generics and can be extended by other packages to handle specific deployment scenarios, eg virtual machines.
</p>


<h3>Value</h3>

<p>The JSON text for the template definition and its parameters.
</p>


<h3>See Also</h3>

<p><a href="#topic+az_template">az_template</a>, <a href="jsonlite.html#topic+fromJSON">jsonlite::toJSON</a>
</p>
<p><a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/templates/template-syntax">Guide to template syntax</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># dummy example
# note that 'resources' arg should be a _list_ of resources
build_template_definition(resources=list(list(name="resource here")))

# specifying parameters as a list
build_template_definition(parameters=list(par1=list(type="string")),
                          resources=list(list(name="resource here")))

# specifying parameters as a vector
build_template_definition(parameters=c(par1="string"),
                          resources=list(list(name="resource here")))

# a user-defined function
build_template_definition(
    parameters=c(name="string"),
    functions=list(
        list(
            namespace="mynamespace",
            members=list(
                prefixedName=list(
                    parameters=list(
                        list(name="name", type="string")
                    ),
                    output=list(
                        type="string",
                        value="[concat('AzureR', parameters('name'))]"
                    )
                )
            )
        )
    )
)

# realistic example: storage account
build_template_definition(
    parameters=c(
        name="string",
        location="string",
        sku="string"
    ),
    variables=list(
        id="[resourceId('Microsoft.Storage/storageAccounts', parameters('name'))]"
    ),
    resources=list(
        list(
            name="[parameters('name')]",
            location="[parameters('location')]",
            type="Microsoft.Storage/storageAccounts",
            apiVersion="2018-07-01",
            sku=list(
                name="[parameters('sku')]"
            ),
            kind="Storage"
        )
    ),
    outputs=list(
        storageId="[variables('id')]"
    )
)

# providing JSON text as input
build_template_definition(
    parameters=c(name="string", location="string", sku="string"),
    resources='[
        {
            "name": "[parameters(\'name\')]",
            "location": "[parameters(\'location\')]",
            "type": "Microsoft.Storage/storageAccounts",
            "apiVersion": "2018-07-01",
            "sku": {
                "name": "[parameters(\'sku\')]"
            },
            "kind": "Storage"
        }
    ]'
)

# parameter values
build_template_parameters(name="mystorageacct", location="westus", sku="Standard_LRS")

build_template_parameters(
    param='{
        "name": "myname",
        "properties": { "prop1": 42, "prop2": "hello" }
    }'
)

param_json &lt;- '{
        "name": "myname",
        "properties": { "prop1": 42, "prop2": "hello" }
    }'
build_template_parameters(param=textConnection(param_json))

## Not run: 
# reading JSON definitions from files
build_template_definition(
    parameters=file("parameter_def.json"),
    resources=file("resource_def.json")
)

build_template_parameters(name="myres_name", complex_type=file("myres_params.json"))

## End(Not run)

</code></pre>

<hr>
<h2 id='call_azure_rm'>Call the Azure Resource Manager REST API</h2><span id='topic+call_azure_rm'></span><span id='topic+call_azure_url'></span>

<h3>Description</h3>

<p>Call the Azure Resource Manager REST API
</p>


<h3>Usage</h3>

<pre><code class='language-R'>call_azure_rm(token, subscription, operation, ..., options = list(),
  api_version = getOption("azure_api_version"))

call_azure_url(token, url, ..., body = NULL, encode = "json",
  http_verb = c("GET", "DELETE", "PUT", "POST", "HEAD", "PATCH"),
  http_status_handler = c("stop", "warn", "message", "pass"),
  auto_refresh = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="call_azure_rm_+3A_token">token</code></td>
<td>
<p>An Azure OAuth token, of class <a href="AzureAuth.html#topic+AzureToken">AzureToken</a>.</p>
</td></tr>
<tr><td><code id="call_azure_rm_+3A_subscription">subscription</code></td>
<td>
<p>For <code>call_azure_rm</code>, a subscription ID.</p>
</td></tr>
<tr><td><code id="call_azure_rm_+3A_operation">operation</code></td>
<td>
<p>The operation to perform, which will form part of the URL path.</p>
</td></tr>
<tr><td><code id="call_azure_rm_+3A_...">...</code></td>
<td>
<p>Other arguments passed to lower-level code, ultimately to the appropriate functions in httr.</p>
</td></tr>
<tr><td><code id="call_azure_rm_+3A_options">options</code></td>
<td>
<p>A named list giving the URL query parameters.</p>
</td></tr>
<tr><td><code id="call_azure_rm_+3A_api_version">api_version</code></td>
<td>
<p>The API version to use, which will form part of the URL sent to the host.</p>
</td></tr>
<tr><td><code id="call_azure_rm_+3A_url">url</code></td>
<td>
<p>A complete URL to send to the host.</p>
</td></tr>
<tr><td><code id="call_azure_rm_+3A_body">body</code></td>
<td>
<p>The body of the request, for <code>PUT</code>/<code>POST</code>/<code>PATCH</code>.</p>
</td></tr>
<tr><td><code id="call_azure_rm_+3A_encode">encode</code></td>
<td>
<p>The encoding (really content-type) for the request body. The default value &quot;json&quot; means to serialize a list body into a JSON object. If you pass an already-serialized JSON object as the body, set <code>encode</code> to &quot;raw&quot;.</p>
</td></tr>
<tr><td><code id="call_azure_rm_+3A_http_verb">http_verb</code></td>
<td>
<p>The HTTP verb as a string, one of <code>GET</code>, <code>PUT</code>, <code>POST</code>, <code>DELETE</code>, <code>HEAD</code> or <code>PATCH</code>.</p>
</td></tr>
<tr><td><code id="call_azure_rm_+3A_http_status_handler">http_status_handler</code></td>
<td>
<p>How to handle in R the HTTP status code of a response. <code>"stop"</code>, <code>"warn"</code> or <code>"message"</code> will call the appropriate handlers in httr, while <code>"pass"</code> ignores the status code.</p>
</td></tr>
<tr><td><code id="call_azure_rm_+3A_auto_refresh">auto_refresh</code></td>
<td>
<p>Whether to refresh/renew the OAuth token if it is no longer valid.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>These functions form the low-level interface between R and Azure. <code>call_azure_rm</code> builds a URL from its arguments and passes it to <code>call_azure_url</code>. Authentication is handled automatically.
</p>


<h3>Value</h3>

<p>If <code>http_status_handler</code> is one of <code>"stop"</code>, <code>"warn"</code> or <code>"message"</code>, the status code of the response is checked. If an error is not thrown, the parsed content of the response is returned with the status code attached as the &quot;status&quot; attribute.
</p>
<p>If <code>http_status_handler</code> is <code>"pass"</code>, the entire response is returned without modification.
</p>


<h3>See Also</h3>

<p><a href="httr.html#topic+GET">httr::GET</a>, <a href="httr.html#topic+PUT">httr::PUT</a>, <a href="httr.html#topic+POST">httr::POST</a>, <a href="httr.html#topic+DELETE">httr::DELETE</a>, <a href="httr.html#topic+stop_for_status">httr::stop_for_status</a>, <a href="httr.html#topic+content">httr::content</a>
</p>

<hr>
<h2 id='create_azure_login'>Login to Azure Resource Manager</h2><span id='topic+create_azure_login'></span><span id='topic+get_azure_login'></span><span id='topic+delete_azure_login'></span><span id='topic+list_azure_logins'></span>

<h3>Description</h3>

<p>Login to Azure Resource Manager
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_azure_login(tenant = "common", app = .az_cli_app_id,
  password = NULL, username = NULL, certificate = NULL,
  auth_type = NULL, version = 2, host = "https://management.azure.com/",
  aad_host = "https://login.microsoftonline.com/", scopes = ".default",
  config_file = NULL, token = NULL,
  graph_host = "https://graph.microsoft.com/", ...)

get_azure_login(tenant = "common", selection = NULL, app = NULL,
  scopes = NULL, auth_type = NULL, refresh = TRUE)

delete_azure_login(tenant = "common", confirm = TRUE)

list_azure_logins()
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_azure_login_+3A_tenant">tenant</code></td>
<td>
<p>The Azure Active Directory tenant for which to obtain a login client. Can be a name (&quot;myaadtenant&quot;), a fully qualified domain name (&quot;myaadtenant.onmicrosoft.com&quot; or &quot;mycompanyname.com&quot;), or a GUID. The default is to login via the &quot;common&quot; tenant, which will infer your actual tenant from your credentials.</p>
</td></tr>
<tr><td><code id="create_azure_login_+3A_app">app</code></td>
<td>
<p>The client/app ID to use to authenticate with Azure Active Directory. The default is to login interactively using the Azure CLI cross-platform app, but you can supply your own app credentials as well.</p>
</td></tr>
<tr><td><code id="create_azure_login_+3A_password">password</code></td>
<td>
<p>If <code>auth_type == "client_credentials"</code>, the app secret; if <code>auth_type == "resource_owner"</code>, your account password.</p>
</td></tr>
<tr><td><code id="create_azure_login_+3A_username">username</code></td>
<td>
<p>If <code>auth_type == "resource_owner"</code>, your username.</p>
</td></tr>
<tr><td><code id="create_azure_login_+3A_certificate">certificate</code></td>
<td>
<p>If 'auth_type == &quot;client_credentials&quot;, a certificate to authenticate with. This is a more secure alternative to using an app secret.</p>
</td></tr>
<tr><td><code id="create_azure_login_+3A_auth_type">auth_type</code></td>
<td>
<p>The OAuth authentication method to use, one of &quot;client_credentials&quot;, &quot;authorization_code&quot;, &quot;device_code&quot; or &quot;resource_owner&quot;. If <code>NULL</code>, this is chosen based on the presence of the <code>username</code> and <code>password</code> arguments.</p>
</td></tr>
<tr><td><code id="create_azure_login_+3A_version">version</code></td>
<td>
<p>The Azure Active Directory version to use for authenticating.</p>
</td></tr>
<tr><td><code id="create_azure_login_+3A_host">host</code></td>
<td>
<p>Your ARM host. Defaults to <code style="white-space: pre;">&#8288;https://management.azure.com/&#8288;</code>. Change this if you are using a government or private cloud.</p>
</td></tr>
<tr><td><code id="create_azure_login_+3A_aad_host">aad_host</code></td>
<td>
<p>Azure Active Directory host for authentication. Defaults to <code style="white-space: pre;">&#8288;https://login.microsoftonline.com/&#8288;</code>. Change this if you are using a government or private cloud.</p>
</td></tr>
<tr><td><code id="create_azure_login_+3A_scopes">scopes</code></td>
<td>
<p>The Azure Service Management scopes (permissions) to obtain for this login. Only for <code>version=2</code>.</p>
</td></tr>
<tr><td><code id="create_azure_login_+3A_config_file">config_file</code></td>
<td>
<p>Optionally, a JSON file containing any of the arguments listed above. Arguments supplied in this file take priority over those supplied on the command line. You can also use the output from the Azure CLI <code style="white-space: pre;">&#8288;az ad sp create-for-rbac&#8288;</code> command.</p>
</td></tr>
<tr><td><code id="create_azure_login_+3A_token">token</code></td>
<td>
<p>Optionally, an OAuth 2.0 token, of class <a href="AzureAuth.html#topic+AzureToken">AzureToken</a>. This allows you to reuse the authentication details for an existing session. If supplied, the other arguments above to <code>create_azure_login</code> will be ignored.</p>
</td></tr>
<tr><td><code id="create_azure_login_+3A_graph_host">graph_host</code></td>
<td>
<p>The Microsoft Graph endpoint. See 'Microsoft Graph integration' below.</p>
</td></tr>
<tr><td><code id="create_azure_login_+3A_...">...</code></td>
<td>
<p>For <code>create_azure_login</code>, other arguments passed to <code>get_azure_token</code>.</p>
</td></tr>
<tr><td><code id="create_azure_login_+3A_selection">selection</code></td>
<td>
<p>For <code>get_azure_login</code>, if you have multiple logins for a given tenant, which one to use. This can be a number, or the input MD5 hash of the token used for the login. If not supplied, <code>get_azure_login</code> will print a menu and ask you to choose a login.</p>
</td></tr>
<tr><td><code id="create_azure_login_+3A_refresh">refresh</code></td>
<td>
<p>For <code>get_azure_login</code>, whether to refresh the authentication token on loading the client.</p>
</td></tr>
<tr><td><code id="create_azure_login_+3A_confirm">confirm</code></td>
<td>
<p>For <code>delete_azure_login</code>, whether to ask for confirmation before deleting.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>create_azure_login</code> creates a login client to authenticate with Azure Resource Manager (ARM), using the supplied arguments. The Azure Active Directory (AAD) authentication token is obtained using <a href="#topic+get_azure_token">get_azure_token</a>, which automatically caches and reuses tokens for subsequent sessions. Note that credentials are only cached if you allowed AzureRMR to create a data directory at package startup.
</p>
<p><code>create_azure_login()</code> without any arguments is roughly equivalent to the Azure CLI command <code style="white-space: pre;">&#8288;az login&#8288;</code>.
</p>
<p><code>get_azure_login</code> returns a login client by retrieving previously saved credentials. It searches for saved credentials according to the supplied tenant; if multiple logins are found, it will prompt for you to choose one.
</p>
<p>One difference between <code>create_azure_login</code> and <code>get_azure_login</code> is the former will delete any previously saved credentials that match the arguments it was given. You can use this to force AzureRMR to remove obsolete tokens that may be lying around.
</p>


<h3>Value</h3>

<p>For <code>get_azure_login</code> and <code>create_azure_login</code>, an object of class <code>az_rm</code>, representing the ARM login client. For <code>list_azure_logins</code>, a (possibly nested) list of such objects.
</p>
<p>If the AzureRMR data directory for saving credentials does not exist, <code>get_azure_login</code> will throw an error.
</p>


<h3>Microsoft Graph integration</h3>

<p>If the AzureGraph package is installed and the <code>graph_host</code> argument is not <code>NULL</code>, <code>create_azure_login</code> will also create a login client for Microsoft Graph with the same credentials. This is to facilitate working with registered apps and service principals, eg when managing roles and permissions. Some Azure services also require creating service principals as part of creating a resource (eg Azure Kubernetes Service), and keeping the Graph credentials consistent with ARM helps ensure nothing breaks.
</p>


<h3>Linux DSVM note</h3>

<p>If you are using a Linux <a href="https://azure.microsoft.com/en-us/products/virtual-machines/data-science-virtual-machines/">Data Science Virtual Machine</a> in Azure, you may have problems running <code>create_azure_login()</code> (ie, without any arguments). In this case, try <code>create_azure_login(auth_type="device_code")</code>.
</p>


<h3>See Also</h3>

<p><a href="#topic+az_rm">az_rm</a>, <a href="AzureAuth.html#topic+get_azure_token">AzureAuth::get_azure_token</a> for more details on authentication methods, <a href="AzureGraph.html#topic+graph_login">AzureGraph::create_graph_login</a> for the corresponding function to create a Microsoft Graph login client
</p>
<p><a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/resource-group-overview">Azure Resource Manager overview</a>,
<a href="https://learn.microsoft.com/en-us/rest/api/resources/">REST API reference</a>
</p>
<p><a href="https://learn.microsoft.com/en-us/azure/active-directory/develop/authentication-scenarios">Authentication in Azure Active Directory</a>
</p>
<p><a href="https://learn.microsoft.com/en-us/cli/azure/?view=azure-cli-latest">Azure CLI documentation</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

# without any arguments, this will create a client using your AAD credentials
az &lt;- create_azure_login()

# retrieve the login in subsequent sessions
az &lt;- get_azure_login()

# this will create a Resource Manager client for the AAD tenant 'myaadtenant.onmicrosoft.com',
# using the client_credentials method
az &lt;- create_azure_login("myaadtenant", app="app_id", password="password")

# you can also login using credentials in a json file
az &lt;- create_azure_login(config_file="~/creds.json")


## End(Not run)
</code></pre>

<hr>
<h2 id='init_pool'>Manage parallel Azure connections</h2><span id='topic+init_pool'></span><span id='topic+delete_pool'></span><span id='topic+pool_exists'></span><span id='topic+pool_size'></span><span id='topic+pool_export'></span><span id='topic+pool_lapply'></span><span id='topic+pool_sapply'></span><span id='topic+pool_map'></span><span id='topic+pool_call'></span><span id='topic+pool_evalq'></span>

<h3>Description</h3>

<p>Manage parallel Azure connections
</p>


<h3>Usage</h3>

<pre><code class='language-R'>init_pool(size = 10, restart = FALSE, ...)

delete_pool()

pool_exists()

pool_size()

pool_export(...)

pool_lapply(...)

pool_sapply(...)

pool_map(...)

pool_call(...)

pool_evalq(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="init_pool_+3A_size">size</code></td>
<td>
<p>For <code>init_pool</code>, the number of background R processes to create. Limit this is you are low on memory.</p>
</td></tr>
<tr><td><code id="init_pool_+3A_restart">restart</code></td>
<td>
<p>For <code>init_pool</code>, whether to terminate an already running pool first.</p>
</td></tr>
<tr><td><code id="init_pool_+3A_...">...</code></td>
<td>
<p>Other arguments passed on to functions in the parallel package. See below.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>AzureRMR provides the ability to parallelise communicating with Azure by utilizing a pool of R processes in the background. This often leads to major speedups in scenarios like downloading large numbers of small files, or working with a cluster of virtual machines. This functionality is intended for use by packages that extend AzureRMR (and was originally implemented as part of the AzureStor package), but can also be called directly by the end-user.
</p>
<p>A small API consisting of the following functions is currently provided for managing the pool. They pass their arguments down to the corresponding functions in the parallel package.
</p>

<ul>
<li> <p><code>init_pool</code> initialises the pool, creating it if necessary. The pool is created by calling <code>parallel::makeCluster</code> with the pool size and any additional arguments. If <code>init_pool</code> is called and the current pool is smaller than <code>size</code>, it is resized.
</p>
</li>
<li> <p><code>delete_pool</code> shuts down the background processes and deletes the pool.
</p>
</li>
<li> <p><code>pool_exists</code> checks for the existence of the pool, returning a TRUE/FALSE value.
</p>
</li>
<li> <p><code>pool_size</code> returns the size of the pool, or zero if the pool does not exist.
</p>
</li>
<li> <p><code>pool_export</code> exports variables to the pool nodes. It calls <code>parallel::clusterExport</code> with the given arguments.
</p>
</li>
<li> <p><code>pool_lapply</code>, <code>pool_sapply</code> and <code>pool_map</code> carry out work on the pool. They call <code>parallel::parLapply</code>, <code>parallel::parSapply</code> and <code>parallel::clusterMap</code> with the given arguments.
</p>
</li>
<li> <p><code>pool_call</code> and <code>pool_evalq</code> execute code on the pool nodes. They call <code>parallel::clusterCall</code> and <code>parallel::clusterEvalQ</code> with the given arguments.
</p>
</li></ul>

<p>The pool is persistent for the session or until terminated by <code>delete_pool</code>. You should initialise the pool by calling <code>init_pool</code> before running any code on it. This restores the original state of the pool nodes by removing any objects that may be in memory, and resetting the working directory to the master working directory.
</p>


<h3>See Also</h3>

<p><a href="parallel.html#topic+makeCluster">parallel::makeCluster</a>, <a href="parallel.html#topic+clusterApply">parallel::clusterCall</a>, <a href="parallel.html#topic+clusterApply">parallel::parLapply</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

init_pool()

pool_size()

x &lt;- 42
pool_export("x")
pool_sapply(1:5, function(i) i + x)

init_pool()
# error: x no longer exists on nodes
try(pool_sapply(1:5, function(i) i + x))

delete_pool()


## End(Not run)
</code></pre>

<hr>
<h2 id='is_azure_login'>Informational functions</h2><span id='topic+is_azure_login'></span><span id='topic+is_subscription'></span><span id='topic+is_resource_group'></span><span id='topic+is_resource'></span><span id='topic+is_template'></span><span id='topic+is_role_definition'></span><span id='topic+is_role_assignment'></span>

<h3>Description</h3>

<p>These functions return whether the object is of the corresponding AzureRMR class.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_azure_login(object)

is_subscription(object)

is_resource_group(object)

is_resource(object)

is_template(object)

is_role_definition(object)

is_role_assignment(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is_azure_login_+3A_object">object</code></td>
<td>
<p>An R object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A boolean.
</p>

<hr>
<h2 id='is_url'>Miscellaneous utility functions</h2><span id='topic+is_url'></span><span id='topic+get_paged_list'></span>

<h3>Description</h3>

<p>Miscellaneous utility functions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_url(x, https_only = FALSE)

get_paged_list(lst, token, next_link_name = "nextLink",
  value_name = "value")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is_url_+3A_x">x</code></td>
<td>
<p>For <code>is_url</code>, An R object.</p>
</td></tr>
<tr><td><code id="is_url_+3A_https_only">https_only</code></td>
<td>
<p>For <code>is_url</code>, whether to allow only HTTPS URLs.</p>
</td></tr>
<tr><td><code id="is_url_+3A_lst">lst</code></td>
<td>
<p>A named list of objects.</p>
</td></tr>
<tr><td><code id="is_url_+3A_token">token</code></td>
<td>
<p>For <code>get_paged_list</code>, an Azure OAuth token, of class <a href="AzureAuth.html#topic+AzureToken">AzureToken</a>.</p>
</td></tr>
<tr><td><code id="is_url_+3A_next_link_name">next_link_name</code>, <code id="is_url_+3A_value_name">value_name</code></td>
<td>
<p>For <code>get_paged_list</code>, the names of the next link and value components in the <code>lst</code> argument. The default values are correct for Resource Manager.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>get_paged_list</code> reconstructs a complete list of objects from a paged response. Many Resource Manager list operations will return <em>paged</em> output, that is, the response contains a subset of all items, along with a URL to query to retrieve the next subset. <code>get_paged_list</code> retrieves each subset and returns all items in a single list.
</p>


<h3>Value</h3>

<p>For <code>get_paged_list</code>, a list.
</p>
<p>For <code>is_url</code>, whether the object appears to be a URL (is character of length 1, and starts with the string <code>"http"</code>). Optionally, restricts the check to HTTPS URLs only.
</p>

<hr>
<h2 id='lock'>Management locks</h2><span id='topic+lock'></span><span id='topic+create_lock'></span><span id='topic+get_lock'></span><span id='topic+delete_lock'></span><span id='topic+list_locks'></span>

<h3>Description</h3>

<p>Create, retrieve and delete locks. These are methods for the <code>az_subscription</code>, <code>az_resource_group</code> and <code>az_resource</code> classes.
</p>


<h3>Usage</h3>

<div class="sourceCode"><pre>create_lock(name, level = c("cannotdelete", "readonly"), notes = "")

get_lock(name)

delete_lock(name)

list_locks()
</pre></div>


<h3>Arguments</h3>


<ul>
<li> <p><code>name</code>: The name of a lock.
</p>
</li>
<li> <p><code>level</code>: The level of protection that the lock provides.
</p>
</li>
<li> <p><code>notes</code>: An optional character string to describe the lock.
</p>
</li></ul>



<h3>Details</h3>

<p>Management locks in Resource Manager can be assigned at the subscription, resource group, or resource level. They serve to protect a resource against unwanted changes. A lock can either protect against deletion (<code>level="cannotdelete"</code>) or against modification of any kind (<code>level="readonly"</code>).
</p>
<p>Locks assigned at parent scopes also apply to lower ones, recursively. The most restrictive lock in the inheritance takes precedence. To modify/delete a resource, any existing locks for its subscription and resource group must also be removed.
</p>
<p>Note if you logged in via a custom service principal, it must have &quot;Owner&quot; or &quot;User Access Administrator&quot; access to manage locks.
</p>


<h3>Value</h3>

<p>The <code>create_lock</code> and <code>get_lock</code> methods return a lock object, which is itself an Azure resource. The <code>list_locks</code> method returns a list of such objects. The <code>delete_lock</code> method returns NULL on a successful delete.
</p>
<p>The <code>get_role_definition</code> method returns an object of class <code>az_role_definition</code>. This is a plain-old-data R6 class (no methods), which can be used as input for creating role assignments (see the examples below).
</p>
<p>The <code>list_role_definitions</code> method returns a list of <code>az_role_definition</code> if the <code>as_data_frame</code> argument is FALSE. If this is TRUE, it instead returns a data frame containing the most broadly useful fields for each role definition: the definition ID and role name.
</p>


<h3>See Also</h3>

<p><a href="#topic+rbac">rbac</a>
</p>
<p><a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/resource-group-lock-resources">Overview of management locks</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

az &lt;- get_azure_login("myaadtenant")
sub &lt;- az$get_subscription("subscription_id")
rg &lt;- sub$get_resource_group("rgname")
res &lt;- rg$get_resource(type="provider_type", name="resname")

sub$create_lock("lock1", "cannotdelete")
rg$create_lock("lock2", "cannotdelete")

# error! resource is locked
res$delete()

# subscription level
rg$delete_lock("lock2")
sub$delete_lock("lock1")

# now it works
res$delete()


## End(Not run)
</code></pre>

<hr>
<h2 id='rbac'>Role-based access control (RBAC)</h2><span id='topic+rbac'></span><span id='topic+add_role_assignment'></span><span id='topic+get_role_assignment'></span><span id='topic+remove_role_assignment'></span><span id='topic+list_role_assignments'></span><span id='topic+get_role_definition'></span><span id='topic+list_role_definitions'></span>

<h3>Description</h3>

<p>Basic methods for RBAC: manage role assignments and retrieve role definitions. These are methods for the <code>az_subscription</code>, <code>az_resource_group</code> and <code>az_resource</code> classes.
</p>


<h3>Usage</h3>

<div class="sourceCode"><pre>add_role_assignment(principal, role, scope = NULL)

get_role_assignment(id)

remove_role_assignment(id, confirm = TRUE)

list_role_assignments(filter = "atScope()", as_data_frame = TRUE)

get_role_definition(id)

list_role_definitions(filter=NULL, as_data_frame = TRUE)
</pre></div>


<h3>Arguments</h3>


<ul>
<li> <p><code>principal</code>: For <code>add_role_assignment</code>, the principal for which to assign a role. This can be a GUID, or an object of class <code>az_user</code>, <code>az_app</code> or <code>az_storage_principal</code> (from the AzureGraph package).
</p>
</li>
<li> <p><code>role</code>: For <code>add_role_assignment</code>, the role to assign the principal. This can be a GUID, a string giving the role name (eg &quot;Contributor&quot;), or an object of class <code style="white-space: pre;">&#8288;[az_role_definition]&#8288;</code>.
</p>
</li>
<li> <p><code>scope</code>: For <code>add_role_assignment</code>, an optional scope for the assignment.
</p>
</li>
<li> <p><code>id</code>: A role ID. For <code>get_role_assignment</code> and <code>remove_role_assignment</code>, this is a role assignment GUID. For <code>get_role_definition</code>, this can be a role definition GUID or a role name.
</p>
</li>
<li> <p><code>confirm</code>: For <code>remove_role_assignment</code>, whether to ask for confirmation before removing the role assignment.
</p>
</li>
<li> <p><code>filter</code>: For <code>list_role_assignments</code> and <code>list_role_definitions</code>, an optional filter condition to limit the returned roles.
</p>
</li>
<li> <p><code>as_data_frame</code>: For <code>list_role_assignments</code> and <code>list_role_definitions</code>, whether to return a data frame or a list of objects. See 'Value' below.
</p>
</li></ul>



<h3>Details</h3>

<p>AzureRMR implements a subset of the full RBAC functionality within Azure Active Directory. You can retrieve role definitions and add and remove role assignments, at the subscription, resource group and resource levels.
</p>


<h3>Value</h3>

<p>The <code>add_role_assignment</code> and <code>get_role_assignment</code> methods return an object of class <code>az_role_assignment</code>. This is a simple R6 class, with one method: <code>remove</code> to remove the assignment.
</p>
<p>The <code>list_role_assignments</code> method returns a list of <code>az_role_assignment</code> objects if the <code>as_data_frame</code> argument is FALSE. If this is TRUE, it instead returns a data frame containing the most broadly useful fields for each assigned role: the role assignment ID, the principal, and the role name.
</p>
<p>The <code>get_role_definition</code> method returns an object of class <code>az_role_definition</code>. This is a plain-old-data R6 class (no methods), which can be used as input for creating role assignments (see the examples below).
</p>
<p>The <code>list_role_definitions</code> method returns a list of <code>az_role_definition</code> if the <code>as_data_frame</code> argument is FALSE. If this is TRUE, it instead returns a data frame containing the most broadly useful fields for each role definition: the definition ID and role name.
</p>


<h3>See Also</h3>

<p><a href="#topic+az_rm">az_rm</a>, <a href="#topic+az_role_definition">az_role_definition</a>, <a href="#topic+az_role_assignment">az_role_assignment</a>
</p>
<p><a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/overview">Overview of role-based access control</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

az &lt;- get_azure_login("myaadtenant")
sub &lt;- az$get_subscription("subscription_id")
rg &lt;- sub$get_resource_group("rgname")
res &lt;- rg$get_resource(type="provider_type", name="resname")

sub$list_role_definitions()
sub$list_role_assignments()
sub$get_role_definition("Contributor")

# get an app using the AzureGraph package
app &lt;- get_graph_login("myaadtenant")$get_app("app_id")

# subscription level
asn1 &lt;- sub$add_role_assignment(app, "Reader")

# resource group level
asn2 &lt;- rg$add_role_assignment(app, "Contributor")

# resource level
asn3 &lt;- res$add_role_assignment(app, "Owner")

res$remove_role_assignment(asn3$id)
rg$remove_role_assignment(asn2$id)
sub$remove_role_assignment(asn1$id)


## End(Not run)

</code></pre>

<hr>
<h2 id='reexports'>Objects exported from other packages</h2><span id='topic+reexports'></span><span id='topic+named_list'></span><span id='topic+is_empty'></span><span id='topic+format_public_fields'></span><span id='topic+format_public_methods'></span><span id='topic+clean_token_directory'></span><span id='topic+delete_azure_token'></span><span id='topic+get_azure_token'></span><span id='topic+is_azure_token'></span><span id='topic+is_azure_v1_token'></span><span id='topic+is_guid'></span><span id='topic+list_azure_tokens'></span><span id='topic+AzureR_dir'></span>

<h3>Description</h3>

<p>These objects are imported from other packages. Follow the links
below to see their documentation.
</p>

<dl>
<dt>AzureAuth</dt><dd><p><code><a href="AzureAuth.html#topic+AzureR_dir">AzureR_dir</a></code>, <code><a href="AzureAuth.html#topic+get_azure_token">clean_token_directory</a></code>, <code><a href="AzureAuth.html#topic+get_azure_token">delete_azure_token</a></code>, <code><a href="AzureAuth.html#topic+get_azure_token">get_azure_token</a></code>, <code><a href="AzureAuth.html#topic+get_azure_token">is_azure_token</a></code>, <code><a href="AzureAuth.html#topic+get_azure_token">is_azure_v1_token</a></code>, <code><a href="AzureAuth.html#topic+get_azure_token">is_azure_v1_token</a></code>, <code><a href="AzureAuth.html#topic+guid">is_guid</a></code>, <code><a href="AzureAuth.html#topic+get_azure_token">list_azure_tokens</a></code></p>
</dd>
<dt>AzureGraph</dt><dd><p><code><a href="AzureGraph.html#topic+format">format_public_fields</a></code>, <code><a href="AzureGraph.html#topic+format">format_public_methods</a></code>, <code><a href="AzureGraph.html#topic+utils">is_empty</a></code>, <code><a href="AzureGraph.html#topic+utils">named_list</a></code></p>
</dd>
</dl>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
