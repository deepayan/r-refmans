<!DOCTYPE html><html><head><title>Help for package osdatahub</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {osdatahub}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#bng_to_geom'><p>Return the geometry of a British National Grid square</p></a></li>
<li><a href='#download_os_datapackages'><p>Download OS premium data packages</p></a></li>
<li><a href='#download_os_opendata'><p>Download OS OpenData Products</p></a></li>
<li><a href='#extent'><p>Create extents from geometries</p></a></li>
<li><a href='#extent_from_ons_code'><p>Retrieve an extent for ONS geographies</p></a></li>
<li><a href='#get_crs'><p>Convert the CRS to a URI.</p></a></li>
<li><a href='#get_ons_geom'><p>Retrieve ONS geographies</p></a></li>
<li><a href='#list_crs'><p>Print the currently accepted EPSG codes.</p></a></li>
<li><a href='#list_ngd_collections'><p>Retrieve OS NGD Feature Collections</p></a></li>
<li><a href='#list_os_datapackages'><p>Retrieve information on premium OS data packages</p></a></li>
<li><a href='#list_os_opendata'><p>Retrieve information on OS OpenData Downloads</p></a></li>
<li><a href='#osdatahub-package'><p><code>osdatahub</code>: Easier Interaction with the Ordnance Survey Data Hub</p></a></li>
<li><a href='#query_maps'><p>Query the OS Maps API</p></a></li>
<li><a href='#query_nearest_places'><p>Query the OS Places API</p></a></li>
<li><a href='#query_ngd'><p>Query the OS NGD Features API</p></a></li>
<li><a href='#query_places'><p>Query the OS Places API</p></a></li>
<li><a href='#query_postcode_places'><p>Query the OS Places API</p></a></li>
<li><a href='#query_uprn_places'><p>Query the OS Places API</p></a></li>
<li><a href='#set_os_key'><p>Set credentials for OS Data Hub</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Easier Interaction with the Ordnance Survey Data Hub</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Ordnance Survey ('OS') is the national mapping agency for Great 
    Britain and produces a large variety of mapping and geospatial products. 
    Much of OS's data is available via the OS Data Hub <a href="https://osdatahub.os.uk/">https://osdatahub.os.uk/</a>, 
    a platform that hosts both free and premium data products. 'osdatahub' 
    provides a user-friendly way to access, query, and download these data.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.0</td>
</tr>
<tr>
<td>Suggests:</td>
<td>httptest, knitr, rmarkdown, sf, testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>Imports:</td>
<td>geojsonsf, geos, httr, jsonlite</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-10-25 11:14:50 UTC; wjochem</td>
</tr>
<tr>
<td>Author:</td>
<td>Chris Jochem [cre, aut],
  Ordnance Survey Ltd [cph, fnd]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Chris Jochem &lt;chris.jochem@os.uk&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-10-25 18:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='bng_to_geom'>Return the geometry of a British National Grid square</h2><span id='topic+bng_to_geom'></span>

<h3>Description</h3>

<p>Convert a valid British National Grid (BNG) grid reference string into a grid
square with the resolution implied by the length of the reference string.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bng_to_geom(grid_ref, returnType = c("wkt", "geojson", "geos", "sf"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bng_to_geom_+3A_grid_ref">grid_ref</code></td>
<td>
<p>(character) BNG grid reference (required).</p>
</td></tr>
<tr><td><code id="bng_to_geom_+3A_returntype">returnType</code></td>
<td>
<p>(character) Representation for the returned geometry.
Choose <code>'wkt'</code> or <code>'geojson'</code> to return the geometry in
Well-Known Text format or GeoJSON, respectively, <code>'geos'</code> to return an
object of class <code>geos</code> or <code>'sf'</code> for a Simple Features object of
class <code>sf</code>. Default is WKT format.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The National Grid is a unique reference system that covers Great
Britain in a series of grid squares at multiple scales. Grid references
begin with 2 letters to identify 100km squares followed by a series of
digits to identify quadrants nested within. For more information, see
<a href="https://www.ordnancesurvey.co.uk/documents/resources/guide-to-nationalgrid.pdf">https://www.ordnancesurvey.co.uk/documents/resources/guide-to-nationalgrid.pdf</a>
</p>
<p>The purpose of this function is to generate geometries based on the extent
of the grid square which can be used as spatial filters in OS Data Hub API
queries.
</p>
<p>Note that all geometries returned will have a coordinate reference system
(CRS) of a EPSG:27700. The <code>sf</code> package must be installed in order to
return an object of class <code>sf</code>.
</p>


<h3>Value</h3>

<p>The coordinates of the grid square boundary in either Well-Known
Text (WKT) format, GeoJSON format, an object of class <code>geos</code> or as a
Simple Features object of class <code>sf</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+extent_from_bng">extent_from_bng()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>bng_to_geom('TL63')
bng_to_geom('TL683365', returnType = 'geojson')

</code></pre>

<hr>
<h2 id='download_os_datapackages'>Download OS premium data packages</h2><span id='topic+download_os_datapackages'></span><span id='topic+download_os_datapackages.package_list'></span><span id='topic+download_os_datapackages.data.frame'></span><span id='topic+download_os_datapackages.numeric'></span>

<h3>Description</h3>

<p>Main function for downloading OS data packages to your local machine.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>download_os_datapackages(product, ...)

## S3 method for class 'package_list'
download_os_datapackages(
  product,
  file_name,
  output_dir,
  overwrite = FALSE,
  key = get_os_key(),
  ...
)

## S3 method for class 'data.frame'
download_os_datapackages(
  product,
  version,
  file_name,
  output_dir,
  overwrite = FALSE,
  key = get_os_key(),
  ...
)

## S3 method for class 'numeric'
download_os_datapackages(
  product,
  version,
  file_name,
  output_dir,
  overwrite = FALSE,
  key = get_os_key(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="download_os_datapackages_+3A_product">product</code></td>
<td>
<p>A <code>product_list</code> object retrieved and filtered using
<code>list_os_datapackages</code>. Alternatively, a <code>data.frame</code> object or
integer or character string of a product ID that can be filtered further.</p>
</td></tr>
<tr><td><code id="download_os_datapackages_+3A_...">...</code></td>
<td>
<p>Additional parameters. Not currently used.</p>
</td></tr>
<tr><td><code id="download_os_datapackages_+3A_file_name">file_name</code></td>
<td>
<p>(character) Filter downloads to only include those with this
file name. Optional.</p>
</td></tr>
<tr><td><code id="download_os_datapackages_+3A_output_dir">output_dir</code></td>
<td>
<p>Path to the directory where the downloaded files will be
saved.</p>
</td></tr>
<tr><td><code id="download_os_datapackages_+3A_overwrite">overwrite</code></td>
<td>
<p>Boolean. Should existing files be overwritten? Default is
<code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="download_os_datapackages_+3A_key">key</code></td>
<td>
<p>(character) OS API key. Default action is to search for an
environment variable using <code>get_os_key()</code>.</p>
</td></tr>
<tr><td><code id="download_os_datapackages_+3A_version">version</code></td>
<td>
<p>(numeric or character) Retrieve information on a specific
version(s) of a data product. Required when <code>product</code> is a
<code>data.frame</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The OS Downloads API assists with the discovery and download of OS
OpenData and OS premium data packages. This function is used as the main
step to download data packages to your local machine. It is designed to
work best after <code>list_os_datapackages</code> is first used to search and
filter for the specific download product. The <code>package_list</code> returned
by the listing step can be used as the input value to download the desired
files. Alternatively, it is possible to supply a product and version IDs
directly when they are already known.
</p>
<p>Before downloading a data package, it must be ordered online. See:
<a href="https://osdatahub.os.uk/downloads/packages">https://osdatahub.os.uk/downloads/packages</a>.
</p>
<p>For more information on the Downloads API, see
<a href="https://osdatahub.os.uk/docs/downloads/technicalSpecification">https://osdatahub.os.uk/docs/downloads/technicalSpecification</a>.
</p>


<h3>Value</h3>

<p>Silently returns the directory where the downloaded files are
stored.
</p>


<h3>See Also</h3>

<p>list_os_datapackages
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Search and filter available open products.
pkg_list &lt;- list_os_datapackages()

# Use the package list to initiate a download.
# Note: 'version' will vary.
download_os_datapackages(pkg_list, version = 123, output_dir = tempdir())

## End(Not run)

</code></pre>

<hr>
<h2 id='download_os_opendata'>Download OS OpenData Products</h2><span id='topic+download_os_opendata'></span><span id='topic+download_os_opendata.product_list'></span><span id='topic+download_os_opendata.character'></span>

<h3>Description</h3>

<p>Main function for downloading OS open data product files to your local
machine.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>download_os_opendata(product, ...)

## S3 method for class 'product_list'
download_os_opendata(
  product,
  file_name,
  file_format,
  area,
  output_dir,
  overwrite = FALSE,
  ...
)

## S3 method for class 'character'
download_os_opendata(
  product,
  file_name,
  file_format,
  file_subformat,
  area,
  output_dir,
  overwrite = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="download_os_opendata_+3A_product">product</code></td>
<td>
<p>A <code>product_list</code> object retrieved and filtered using
<code>list_os_opendata</code>. Alternatively, a data product name as a character
string.</p>
</td></tr>
<tr><td><code id="download_os_opendata_+3A_...">...</code></td>
<td>
<p>Additional parameters. Not currently used.</p>
</td></tr>
<tr><td><code id="download_os_opendata_+3A_file_name">file_name</code></td>
<td>
<p>(character) Filter downloads to only include those with this
file name. Optional.</p>
</td></tr>
<tr><td><code id="download_os_opendata_+3A_file_format">file_format</code></td>
<td>
<p>(character) Filter downloads to only include those with
this format. Optional.</p>
</td></tr>
<tr><td><code id="download_os_opendata_+3A_area">area</code></td>
<td>
<p>(character) Filter downloads for only this area. Use 'GB' for all
Great Britain. Optional.</p>
</td></tr>
<tr><td><code id="download_os_opendata_+3A_output_dir">output_dir</code></td>
<td>
<p>Path to the directory where the downloaded files will be
saved.</p>
</td></tr>
<tr><td><code id="download_os_opendata_+3A_overwrite">overwrite</code></td>
<td>
<p>Boolean. Should existing files be overwritten? Default is
<code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="download_os_opendata_+3A_file_subformat">file_subformat</code></td>
<td>
<p>(character) Filter downloads to only include those with
this subformat. Optional and only used when <code>product</code> is a character
string.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The OS Downloads API assists with the discovery and download of OS
OpenData and OS Premium data packages. This function is used as the main
step to download open data products to your local machine. It is designed
to work best after <code>list_os_opendata</code> is first used to search and
filter for the specific download product. The <code>product_list</code> returned
by the listing step can be used as the input value to download the desired
files. Alternatively, it is possible to supply a product name and filtering
options based on file formats and areas.
</p>
<p>The optional <code>area</code> filter is based on two-letter British National
Grid tiles. Use 'GB' for all of Great Britain. Valid values area: GB, HP,
HT, HU, HW, HX, HY, HZ, NA, NB, NC, ND, NF, NG, NH, NJ, NK, NL, NM, NN, NO,
NR, NS, NT, NU, NW, NX, NY, NZ, OV, SD, SE, TA, SH, SJ, SK, TF, TG, SM, SN,
SO, SP, TL, TM, SR, SS, ST, SU, TQ, TR, SV, SW, SX, SY, SZ, TV.
</p>
<p>For more information on the Downloads API, see
<a href="https://osdatahub.os.uk/docs/downloads/technicalSpecification">https://osdatahub.os.uk/docs/downloads/technicalSpecification</a>.
</p>


<h3>Value</h3>

<p>Silently returns the directory where the downloaded files are
stored.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+list_os_opendata">list_os_opendata()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Search and filter available open products.
prod_list &lt;- list_os_opendata('OpenGreenSpace',
                              file_format = 'GeoPackage',
                              area = 'GB')

# Use the product list to initiate a download.
download_os_opendata(prod_list, output_dir = tempdir())

# Combine search and download.
# Be sure to know the products to avoid downloading more data than desired.
download_os_opendata(product = 'OpenGreenSpace',
                     file_format = 'GeoPackage',
                     area = 'GB',
                     output_dir = tempdir())


</code></pre>

<hr>
<h2 id='extent'>Create extents from geometries</h2><span id='topic+extent'></span><span id='topic+extent_from_bbox'></span><span id='topic+extent_from_polygon'></span><span id='topic+extent_from_geojson'></span><span id='topic+extent_from_radius'></span><span id='topic+extent_from_bng'></span>

<h3>Description</h3>

<p>Provide extents from various types of input features and geometries to be
used as filters in OS Data Hub API queries.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extent_from_bbox(bbox, crs = "crs84", returnType = c("qExtent", "geos", "wkt"))

extent_from_polygon(
  polygon,
  crs = "crs84",
  returnType = c("qExtent", "geos", "wkt")
)

extent_from_geojson(
  geojson,
  crs = "crs84",
  returnType = c("qExtent", "geos", "wkt")
)

extent_from_radius(
  centre,
  radius,
  crs = "epsg:27700",
  returnType = c("qExtent", "geos", "wkt")
)

extent_from_bng(grid_ref, returnType = c("qExtent", "geos", "wkt"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extent_+3A_bbox">bbox</code></td>
<td>
<p>A bounding box, passed as a numeric vector in (xmin, ymin, xmax,
ymax) or a <code>data.frame</code> object with numeric columns.</p>
</td></tr>
<tr><td><code id="extent_+3A_crs">crs</code></td>
<td>
<p>(character or numeric)  The identifier for coordinate reference
system information for the feature, either in the format &quot;epsg:xxxx&quot; or an
EPSG number. e.g. British National Grid can be supplied as &quot;epsg:27700&quot; or
27700. Available CRS values are: EPSG:27700, EPSG:4326, EPSG:7405,
EPSG:3857, and CRS84. Defaults to CRS84.</p>
</td></tr>
<tr><td><code id="extent_+3A_returntype">returnType</code></td>
<td>
<p>(character) Define the object returned. The default is
<code>'qExtent'</code> to define a &quot;query extent&quot; object expected internally by
<code>osdatahub</code>. Other options are <code>'wkt'</code> to return the geometry in
Well-Known Text format or <code>'geos'</code> to return an object of class
<code>geos</code>.</p>
</td></tr>
<tr><td><code id="extent_+3A_polygon">polygon</code></td>
<td>
<p>A polygon specified in a WKT string, an object of class
<code>geos</code>, or an object of class <code>sf</code>.</p>
</td></tr>
<tr><td><code id="extent_+3A_geojson">geojson</code></td>
<td>
<p>A character string defining a polygon in GeoJSON format.</p>
</td></tr>
<tr><td><code id="extent_+3A_centre">centre</code></td>
<td>
<p>Either a numeric vector with coordinates in the form (x, y), a
Point object in a WKT string, a Point as a <code>geos</code> geometry or an
object of class <code>sf</code>.</p>
</td></tr>
<tr><td><code id="extent_+3A_radius">radius</code></td>
<td>
<p>(numeric) The radius of the circle in meters.</p>
</td></tr>
<tr><td><code id="extent_+3A_grid_ref">grid_ref</code></td>
<td>
<p>A character string with a British National Grid reference.
The extent is formed by the grid square of the reference.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When defining an extent by a radius around a point, the CRS must be
either 'epsg:27700' or 'epsg:3857' which implies the units of the distance
for the radius are meters.
</p>
<p>The <code>qExtent</code> return option identifies a simple class of objects
containing a polygon of the extent in WKT format, the bounding box
coordinates, and a CRS string. It is intended to be used internally by
functions in <code>osdatahub</code>.
</p>


<h3>Value</h3>

<p>The coordinates of the polygon boundary as defined by
<code>returnType</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>extent_from_bbox(c(600000, 310200, 600900, 310900), "epsg:27700", returnType = 'wkt')

extent_from_radius(c(441317, 112165), radius = 200)

extent_from_bng("SU3715")

</code></pre>

<hr>
<h2 id='extent_from_ons_code'>Retrieve an extent for ONS geographies</h2><span id='topic+extent_from_ons_code'></span>

<h3>Description</h3>

<p>Retrieve an extent for ONS geographies
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extent_from_ons_code(ons_code, returnType = c("qExtent", "geos", "wkt"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extent_from_ons_code_+3A_ons_code">ons_code</code></td>
<td>
<p>(character) A single ONS code representing a statistical
area.</p>
</td></tr>
<tr><td><code id="extent_from_ons_code_+3A_returntype">returnType</code></td>
<td>
<p>(character) Define the object returned. The default is
<code>'qExtent'</code> to define a &quot;query extent&quot; object expected internally by
<code>osdatahub</code>. Other options are <code>'wkt'</code> to return the geometry in
Well-Known Text format or <code>'geos'</code> to return an object of class
<code>geos</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The Office for National Statistics (ONS) maintains a source of
official geographies for the UK, such as county boundaries, electoral
wards, parishes, and census output areas. These boundaries are commonly
used for data analysis, particularly of socio-economic factors. A full list
of available ONS geographies can be found here:
<a href="https://statistics.data.gov.uk:443/atlas/resource?uri=http://statistics.data.gov.uk/id/statistical-geography/K02000001">https://statistics.data.gov.uk:443/atlas/resource?uri=http://statistics.data.gov.uk/id/statistical-geography/K02000001</a>.
</p>
<p>When returning a <code>geos</code> object, the coordinate reference system
attribute will be set to CRS:84 by default and not to a full CRS
definition.
</p>
<p>The <code>qExtent</code> return option identifies a simple class of objects
containing a polygon of the extent in WKT format, the bounding box
coordinates, and a CRS string. It is intended to be used internally by
functions in <code>osdatahub</code>.
</p>


<h3>Value</h3>

<p>The coordinates of the polygon boundary.
</p>


<h3>See Also</h3>

<p><a href="#topic+extent">extent</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
ext &lt;- extent_from_ons_code("E05002470", returnType = 'wkt')


</code></pre>

<hr>
<h2 id='get_crs'>Convert the CRS to a URI.</h2><span id='topic+get_crs'></span>

<h3>Description</h3>

<p>Given possible user-inputs to specify a CRS, check validity and then convert
the CRS labels into a URI accepted by the OS Data Hub.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_crs(x, returnType = c("uri", "number", "code"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_crs_+3A_x">x</code></td>
<td>
<p>(character or numeric)  The CRS for the, either in the format
&quot;epsg:xxxx&quot; or an EPSG number. e.g. British National Grid can be supplied
as &quot;epsg:27700&quot; or 27700. Available CRS values are: EPSG:27700, EPSG:4326,
EPSG:7405, EPSG:3857, and CRS84.</p>
</td></tr>
<tr><td><code id="get_crs_+3A_returntype">returnType</code></td>
<td>
<p>(character) Should the URI to the CRS be returned
(<code>'uri'</code>), the EPSG number (<code>'number'</code>), or the string value
(<code>'code'</code>)? The default is <code>'uri'</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Character string of a URI to the CRS specification.
</p>

<hr>
<h2 id='get_ons_geom'>Retrieve ONS geographies</h2><span id='topic+get_ons_geom'></span>

<h3>Description</h3>

<p>Query the Office for National Statistics online geography resources.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_ons_geom(ons_code, returnType = c("wkt", "geojson", "geos", "sf"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_ons_geom_+3A_ons_code">ons_code</code></td>
<td>
<p>(character) A single ONS code representing a statistical
area.</p>
</td></tr>
<tr><td><code id="get_ons_geom_+3A_returntype">returnType</code></td>
<td>
<p>(character) Representation for the returned geometry.
Choose <code>'wkt'</code> or <code>'geojson'</code> to return the geometry in
Well-Known Text format or GeoJSON, respectively, <code>'geos'</code> to return an
object of class <code>geos</code> or <code>'sf'</code> for a Simple Features object of
class <code>sf</code>. Default is WKT format.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The Office for National Statistics (ONS) maintains a source of
official geographies for the UK, such as county boundaries, electoral
wards, parishes, and census output areas. These boundaries are commonly
used for data analysis, particularly of socio-economic factors. A full list
of available ONS geographies can be found here:
<a href="https://statistics.data.gov.uk:443/atlas/resource?uri=http://statistics.data.gov.uk/id/statistical-geography/K02000001">https://statistics.data.gov.uk:443/atlas/resource?uri=http://statistics.data.gov.uk/id/statistical-geography/K02000001</a>.
</p>
<p>When returning a <code>geos</code> object, the coordinate reference system
attribute will be set to CRS code 84 by default and not to a full CRS
definition. The <code>sf</code> package must be installed in order to return an
object of class <code>sf</code>.
</p>
<p>Data from the ONS are provided under the terms of the Open Government
Licence
<a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/">https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/</a>.
For more information, please see:
<a href="https://www.ons.gov.uk/methodology/geography/licences">https://www.ons.gov.uk/methodology/geography/licences</a>.
</p>


<h3>Value</h3>

<p>The coordinates of the polygon boundary in either Well-Known Text
(WKT) format, GeoJSON format, an object of class <code>geos</code> or as a Simple
Features object of class <code>sf</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Retrieve geography.
geog &lt;- get_ons_geom("E05002470")


</code></pre>

<hr>
<h2 id='list_crs'>Print the currently accepted EPSG codes.</h2><span id='topic+list_crs'></span>

<h3>Description</h3>

<p>Convenience function primarily used internally by <code>osdatahub</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>list_crs(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="list_crs_+3A_...">...</code></td>
<td>
<p>Not currently used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>(Invisible) Vector of character strings.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>list_crs()

</code></pre>

<hr>
<h2 id='list_ngd_collections'>Retrieve OS NGD Feature Collections</h2><span id='topic+list_ngd_collections'></span>

<h3>Description</h3>

<p>Query the osdatahub NGD Features API to gather information on available data
collections. An API key is not required for this query.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>list_ngd_collections(simple = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="list_ngd_collections_+3A_simple">simple</code></td>
<td>
<p>(logical) Should only the collection ID be returned? Default is
<code>TRUE</code>. Use <code>FALSE</code> to return the detailed output.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>OS NGD themes and collections have been created to group similar
geographic entities and data types, making it quicker and easier to
identify the data you need. The OGC API - Features standard also references
feature collections, and in the context of OS NGD datasets, this is
equivalent to feature types. The following naming convention has been
applied to the feature collections: theme-collection-featuretype. Short
codes have been used for both the theme and collection to keep the feature
collection names manageable and not overly long. An example of the short
codes used is: 'bld-fts-buildingline'. For more information, see
<a href="https://osdatahub.os.uk/docs/ofa/technicalSpecification">https://osdatahub.os.uk/docs/ofa/technicalSpecification</a>.
</p>


<h3>Value</h3>

<p>If <code>simple</code> is <code>TRUE</code> then return a character vector of
available collections identified by their shortened code, else return a
<code>data.frame</code> with the full details.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
ngd_collections &lt;- list_ngd_collections(simple = TRUE)
ngd_collections[1:10]

</code></pre>

<hr>
<h2 id='list_os_datapackages'>Retrieve information on premium OS data packages</h2><span id='topic+list_os_datapackages'></span>

<h3>Description</h3>

<p>Query the osdatahub Downloads API to gather information on available
downloads for a specific OS premium data package based on given filters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>list_os_datapackages(product_id, version_id, key = get_os_key(), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="list_os_datapackages_+3A_product_id">product_id</code></td>
<td>
<p>(numeric or character) Retrieve information on a specific
data product. Optional.</p>
</td></tr>
<tr><td><code id="list_os_datapackages_+3A_version_id">version_id</code></td>
<td>
<p>(numeric or character) Retrieve information on a specific
version of a data product. Optional and only available when
<code>product_id</code> has been specified.</p>
</td></tr>
<tr><td><code id="list_os_datapackages_+3A_key">key</code></td>
<td>
<p>(character) OS API key. Default action is to search for an
environment variable using <code>get_os_key()</code>.</p>
</td></tr>
<tr><td><code id="list_os_datapackages_+3A_...">...</code></td>
<td>
<p>Additional paramters. Not currently used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The OS Downloads API assists with the discovery and download of OS
OpenData and OS premium data packages. This function is used for initial
listing and discovery of premium products. Use the product and version IDs
from this list to filter further or to initiate a download.
</p>
<p>Before downloading a data package, it must be ordered online. See:
<a href="https://osdatahub.os.uk/downloads/packages">https://osdatahub.os.uk/downloads/packages</a>.
</p>
<p>When a <code>product_id</code> is not specified then all available data packages
are listed. The <code>version_id</code> filter can be used to find the specific
download, but this filter is only valid when a specific product has been
specified first.
</p>
<p>For more information on the Downloads API, see
<a href="https://osdatahub.os.uk/docs/downloads/technicalSpecification">https://osdatahub.os.uk/docs/downloads/technicalSpecification</a>.
</p>


<h3>Value</h3>

<p>A <code>data.frame</code> or a <code>package_list</code>, which extends a
<code>data.frame</code>, containing the information on downloadable files from
the Downloads API.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+download_os_datapackages">download_os_datapackages()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Retrieve a data.frame listing all OS Data Packages available.
# An API key is required and the packages must be ordered online first.
dp &lt;- list_os_datapackages()

# Retrieve a specific data package.
# Note: 'product_id' will vary.
dp &lt;- list_os_datapackages(product_id = 1234)

## End(Not run)

</code></pre>

<hr>
<h2 id='list_os_opendata'>Retrieve information on OS OpenData Downloads</h2><span id='topic+list_os_opendata'></span>

<h3>Description</h3>

<p>Query the osdatahub Downloads API to gather information on available data
collections. An API key is not required to list OS OpenData.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>list_os_opendata(product_id, file_name, file_format, file_subformat, area, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="list_os_opendata_+3A_product_id">product_id</code></td>
<td>
<p>(character) Retrieve information on a specific data product.
Optional.</p>
</td></tr>
<tr><td><code id="list_os_opendata_+3A_file_name">file_name</code></td>
<td>
<p>(character) Filter downloads to only include those with this
file name. Optional.</p>
</td></tr>
<tr><td><code id="list_os_opendata_+3A_file_format">file_format</code></td>
<td>
<p>(character) Filter downloads to only include those with
this format. Optional.</p>
</td></tr>
<tr><td><code id="list_os_opendata_+3A_file_subformat">file_subformat</code></td>
<td>
<p>(character) Filter downloads to only include those with
this subformat. Optional.</p>
</td></tr>
<tr><td><code id="list_os_opendata_+3A_area">area</code></td>
<td>
<p>(character) Filter downloads for only this area. Use 'GB' for all
Great Britain. Optional.</p>
</td></tr>
<tr><td><code id="list_os_opendata_+3A_...">...</code></td>
<td>
<p>Additional paramters. Not currently used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The OS Downloads API assists with the discovery and download of OS
OpenData and OS premium data packages. This function is used for initial
listing and discovery of open data products. Use the product ID from this
list to filter further or to initiate a download.
</p>
<p>When a <code>product_id</code> is not specified then all available open data is
listed. Additional filters (i.e. <code>file_name</code>, <code>file_format</code>,
<code>file_subformat</code>, <code>area</code>) can be used to find the specific
download, but these filters are only valid when a specific product has been
specified first.
</p>
<p>The optional <code>area</code> filter is based on two-letter British National
Grid tiles. Use 'GB' for all of Great Britain. Valid values area: GB, HP,
HT, HU, HW, HX, HY, HZ, NA, NB, NC, ND, NF, NG, NH, NJ, NK, NL, NM, NN, NO,
NR, NS, NT, NU, NW, NX, NY, NZ, OV, SD, SE, TA, SH, SJ, SK, TF, TG, SM, SN,
SO, SP, TL, TM, SR, SS, ST, SU, TQ, TR, SV, SW, SX, SY, SZ, TV.
</p>
<p>For more information on the Downloads API, see
<a href="https://osdatahub.os.uk/docs/downloads/technicalSpecification">https://osdatahub.os.uk/docs/downloads/technicalSpecification</a>.
</p>


<h3>Value</h3>

<p>A <code>data.frame</code> or a <code>product_list</code>, which extends a
<code>data.frame</code>, containing the information on downloadable files from
the Downloads API.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+download_os_opendata">download_os_opendata()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Retrieve a data.frame listing all OS OpenData products.
opendata &lt;- list_os_opendata()
opendata[, c("name", "url")]


</code></pre>

<hr>
<h2 id='osdatahub-package'><code>osdatahub</code>: Easier Interaction with the Ordnance Survey Data Hub</h2><span id='topic+osdatahub'></span><span id='topic+osdatahub-package'></span>

<h3>Description</h3>

<p>Ordnance Survey ('OS') is the national mapping agency for Great Britain and
produces a large variety of mapping and geospatial products. Much of OS's
data is available via the OS Data Hub <a href="https://osdatahub.os.uk/">https://osdatahub.os.uk/</a>, a platform
that hosts both free and premium data products. <code>osdatahub</code> provides a
user-friendly way to access, query, and download these data in <code>R</code>.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Chris Jochem <a href="mailto:chris.jochem@os.uk">chris.jochem@os.uk</a>
</p>
<p>Other contributors:
</p>

<ul>
<li><p> Ordnance Survey Ltd [copyright holder, funder]
</p>
</li></ul>


<hr>
<h2 id='query_maps'>Query the OS Maps API</h2><span id='topic+query_maps'></span><span id='topic+query_maps.qExtent'></span>

<h3>Description</h3>

<p>Retrieve pre-rendered tiles from the web maps service of the Maps API in the
Ordnance Survey Data Hub.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>query_maps(
  x,
  layer = c("Road_27700", "Road_3857", "Outdoor_27700", "Outdoor_3857", "Light_27700",
    "Light_3857", "Leisure_27700"),
  zoom,
  output_dir,
  overwrite = FALSE,
  key = get_os_key(),
  ...
)

## S3 method for class 'qExtent'
query_maps(
  x,
  layer = c("Road_27700", "Road_3857", "Outdoor_27700", "Outdoor_3857", "Light_27700",
    "Light_3857", "Leisure_27700"),
  zoom,
  output_dir,
  overwrite = FALSE,
  key = get_os_key(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="query_maps_+3A_x">x</code></td>
<td>
<p>Object defining the query extent. Should be of type <code>qExtent</code>
created by the <code>extent_from_*</code> functions.</p>
</td></tr>
<tr><td><code id="query_maps_+3A_layer">layer</code></td>
<td>
<p>(character) The name of the layer to query. See details.</p>
</td></tr>
<tr><td><code id="query_maps_+3A_zoom">zoom</code></td>
<td>
<p>(numeric) The zoom level of the tiles to return. If omitted, a
suitable zoom level will be estimated. See details.</p>
</td></tr>
<tr><td><code id="query_maps_+3A_output_dir">output_dir</code></td>
<td>
<p>(character) Path to the directory where the downloaded
tiles will be saved.</p>
</td></tr>
<tr><td><code id="query_maps_+3A_overwrite">overwrite</code></td>
<td>
<p>Boolean. Should existing files be overwritten? Default is
<code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="query_maps_+3A_key">key</code></td>
<td>
<p>(character) OS API key. Default action is to search for an
environment variable using <code>get_os_key()</code>.</p>
</td></tr>
<tr><td><code id="query_maps_+3A_...">...</code></td>
<td>
<p>Additional parameters (not currently used).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The OS Maps API serves pre-rendered raster tiles and is available in
two projections; British National Grid and Web Mercator. This function
provides basic access to download these tiles to your local machine.
</p>
<p>Alternatively, you can request the maps using the Open Geospatial
Consortium Web Map Tile Service (WMTS) standard or RESTful ZXY for easy
access/visualisation in most GIS software and web mapping applications.
More information on the Maps API is available from:
<a href="https://osdatahub.os.uk/docs/wmts/technicalSpecification">https://osdatahub.os.uk/docs/wmts/technicalSpecification</a>.
</p>
<p>The parameter <code>x</code> currently only accepts a query extent created from
<code>extent_from_*</code> family of functions. The coordinate reference system
of this extent must match the coordinate reference system of the returned
tiles (i.e. only EPSG:27700 and EPSG:3857 are accepted).
</p>
<p>The available layers are Road, Outdoor, Light in both 27700 and 3857, plus
Leisure in 27700. These should be specified as combined strings to the
<code>layer</code> argument, e.g. 'Road_27700'.
</p>
<p>The zoom levels available vary based on the projection of the tile matrix
set. EPSG:3857 is from 7 to 20 and EPSG:27700 is from 0 to 13. See the
technical specifications for more information on the scale and resolution:
<a href="https://osdatahub.os.uk/docs/wmts/technicalSpecification">https://osdatahub.os.uk/docs/wmts/technicalSpecification</a>
</p>


<h3>Value</h3>

<p>A list of file paths to the downloaded image tiles, their bounding
boxes, and coordinate reference system information.
</p>


<h3>See Also</h3>

<p><a href="#topic+extent">extent</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Define an extent.
OS_ext &lt;- extent_from_bng('SU3715')

# Download tiles.
imgTile &lt;- query_maps(OS_ext,
                      layer = 'Light_27700',
                      output_dir = tempdir())

# The tiles can be merged together and georeferenced for spatial applications.

</code></pre>

<hr>
<h2 id='query_nearest_places'>Query the OS Places API</h2><span id='topic+query_nearest_places'></span>

<h3>Description</h3>

<p>Takes a pair of coordinates (X, Y)/(Lon, Lat) as an input to determine the
closest address.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>query_nearest_places(
  point,
  point_crs,
  radius = 100,
  output_crs = "EPSG:27700",
  classification_code,
  logical_status_code,
  dataset = "DPA",
  key = get_os_key(),
  returnType = c("geojson", "list", "sf"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="query_nearest_places_+3A_point">point</code></td>
<td>
<p>A set of coordinates as a numeric vector, an object of class
<code>geos</code>, or an object of class <code>sf</code></p>
</td></tr>
<tr><td><code id="query_nearest_places_+3A_point_crs">point_crs</code></td>
<td>
<p>(character or numeric) The identifier for coordinate
reference system information for the point feature.</p>
</td></tr>
<tr><td><code id="query_nearest_places_+3A_radius">radius</code></td>
<td>
<p>(numeric) The search radius in metres (max. 1000). Defaults is
100.</p>
</td></tr>
<tr><td><code id="query_nearest_places_+3A_output_crs">output_crs</code></td>
<td>
<p>(character or numeric) The output CRS. Defaults to
“EPSG:27700”.</p>
</td></tr>
<tr><td><code id="query_nearest_places_+3A_classification_code">classification_code</code></td>
<td>
<p>Classification codes to filter query by.</p>
</td></tr>
<tr><td><code id="query_nearest_places_+3A_logical_status_code">logical_status_code</code></td>
<td>
<p>Logical status code to filter query by.</p>
</td></tr>
<tr><td><code id="query_nearest_places_+3A_dataset">dataset</code></td>
<td>
<p>(character) The dataset to return. Multiple values can be
provided as a vector. Default is 'DPA'.</p>
</td></tr>
<tr><td><code id="query_nearest_places_+3A_key">key</code></td>
<td>
<p>(character) OS API key. Default action is to search for an
environment variable using <code>get_os_key()</code>.</p>
</td></tr>
<tr><td><code id="query_nearest_places_+3A_returntype">returnType</code></td>
<td>
<p>(character) Return the query results as the raw
<code>'geojson'</code>, a nested <code>'list'</code> object containing the returns,
or convert them into Simple Features and return an object of class
<code>'sf'</code>.</p>
</td></tr>
<tr><td><code id="query_nearest_places_+3A_...">...</code></td>
<td>
<p>Additional parameters (not currently used).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The OS Places API provides a detailed view of an address and its
life cycle. Use this function to query Places to find the address nearest
to a given point location.
</p>
<p>The Places API contains all the records of AddressBase® Premium and
AddressBase® Premium – Islands and so provides all the information relating
to an address or property from creation to retirement. It contains local
authority, Ordnance Survey and Royal Mail® addresses, current addresses,
and alternatives for current addresses, provisional addresses (such as
planning developments) and historic information, plus OWPAs and cross
references to the OS MasterMap® TOIDS®. OS Places API contains addresses
located within the United Kingdom, Jersey, Guernsey and the Isle of Man.
For address records in Jersey and Guernsey the coordinates will be ‘0.0’ as
they fall outside of the British National Grid. This means they are not
compatible with the GeoSearch operations.
</p>
<p>Technical details on the Places API are documented on the Data Hub:
<a href="https://osdatahub.os.uk/docs/places/technicalSpecification">https://osdatahub.os.uk/docs/places/technicalSpecification</a>.
</p>
<p>Note: the Places API requires a Premium API key.
</p>


<h3>Value</h3>

<p>A GeoJSON string with the results of the API query, a list object,
or an object of class <code>sf</code> based on the <code>returnType</code> parameter.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+query_places">query_places()</a></code>, <code><a href="#topic+query_postcode_places">query_postcode_places()</a></code>, <code><a href="#topic+query_uprn_places">query_uprn_places()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Find address nearest to a point
pt &lt;- c(437292.4, 115541.9)

results &lt;- query_nearest_places(pt, point_crs = 'EPSG:27700')

</code></pre>

<hr>
<h2 id='query_ngd'>Query the OS NGD Features API</h2><span id='topic+query_ngd'></span><span id='topic+query_ngd.character'></span><span id='topic+query_ngd.qExtent'></span><span id='topic+query_ngd.geos_geometry'></span><span id='topic+query_ngd.sf'></span><span id='topic+query_ngd.sfc'></span>

<h3>Description</h3>

<p>Retrieve features from a given Collection of the National Geographic
Database in the Ordnance Survey Data Hub.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>query_ngd(x, ...)

## S3 method for class 'character'
query_ngd(
  x,
  collection,
  crs = "crs84",
  key = get_os_key(),
  returnType = c("geojson", "list", "sf"),
  ...
)

## S3 method for class 'qExtent'
query_ngd(
  x,
  collection,
  crs = "crs84",
  start_datetime,
  end_datetime,
  cql_filter,
  filter_crs,
  max_results = 100,
  offset = 0,
  key = get_os_key(),
  returnType = c("geojson", "list", "sf"),
  ...
)

## S3 method for class 'geos_geometry'
query_ngd(
  x,
  collection,
  crs = "crs84",
  start_datetime,
  end_datetime,
  cql_filter,
  filter_crs,
  max_results = 100,
  offset = 0,
  key = get_os_key(),
  returnType = c("geojson", "list", "sf"),
  ...
)

## S3 method for class 'sf'
query_ngd(
  x,
  collection,
  crs = "crs84",
  start_datetime,
  end_datetime,
  cql_filter,
  filter_crs,
  max_results = 100,
  offset = 0,
  key = get_os_key(),
  returnType = c("geojson", "list", "sf"),
  ...
)

## S3 method for class 'sfc'
query_ngd(
  x,
  collection,
  crs = "crs84",
  start_datetime,
  end_datetime,
  cql_filter,
  filter_crs,
  max_results = 100,
  offset = 0,
  key = get_os_key(),
  returnType = c("geojson", "list", "sf"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="query_ngd_+3A_x">x</code></td>
<td>
<p>Object defining the query parameters, including feature IDs,
extents, or spatial objects from which extents can be determined If
<code>x</code> is <code>NULL</code> or missing with other options specified by name,
then the first <code>max_results</code> of the collection will be returned.</p>
</td></tr>
<tr><td><code id="query_ngd_+3A_...">...</code></td>
<td>
<p>Additional parameters (not currently used).</p>
</td></tr>
<tr><td><code id="query_ngd_+3A_collection">collection</code></td>
<td>
<p>(character) The name of the NGD Collection to query
(required). See <code>list_ngd_collections()</code>.</p>
</td></tr>
<tr><td><code id="query_ngd_+3A_crs">crs</code></td>
<td>
<p>(character or numeric)  The CRS for the returned features, either
in the format &quot;epsg:xxxx&quot; or an EPSG number. e.g. British National Grid can
be supplied as &quot;epsg:27700&quot; or 27700. Available CRS values are: EPSG:27700,
EPSG:4326, EPSG:7405, EPSG:3857, and CRS84. Defaults to CRS84.</p>
</td></tr>
<tr><td><code id="query_ngd_+3A_key">key</code></td>
<td>
<p>(character) OS API key. Default action is to search for an
environment variable using <code>get_os_key()</code>.</p>
</td></tr>
<tr><td><code id="query_ngd_+3A_returntype">returnType</code></td>
<td>
<p>(character) Return the query results as the raw
<code>'geojson'</code>, a nested <code>'list'</code> object containing the returns,
or convert them into Simple Features and return an object of class
<code>'sf'</code>.</p>
</td></tr>
<tr><td><code id="query_ngd_+3A_start_datetime">start_datetime</code></td>
<td>
<p>(datetime or string)  Selects features that have a
temporal property after the given start time. If you want to query a single
timestamp, provide the same value to both <code>start_datetime</code> and
<code>end_datetime</code>.</p>
</td></tr>
<tr><td><code id="query_ngd_+3A_end_datetime">end_datetime</code></td>
<td>
<p>(datetime or string) Selects features that have a
temporal property before the given end time. If you want to query a single
timestamp, provide the same value to both <code>start_datetime</code> and
<code>end_datetime</code>.</p>
</td></tr>
<tr><td><code id="query_ngd_+3A_cql_filter">cql_filter</code></td>
<td>
<p>(character) A filter query in CQL format. More information
about supported CQL operators can be found at
<a href="https://osdatahub.os.uk/docs/ofa/technicalSpecification">https://osdatahub.os.uk/docs/ofa/technicalSpecification</a>.</p>
</td></tr>
<tr><td><code id="query_ngd_+3A_filter_crs">filter_crs</code></td>
<td>
<p>(character or numeric) The CRS for a given CQL query (if
required), either in the format “epsg:xxxx” or an epsg number. e.g. British
National Grid can be supplied as “epsg:27700” or 27700 Available CRS values
are: EPSG:27700, EPSG:4326, EPSG:7405, EPSG:3857, and CRS84. Defaults to
CRS84.</p>
</td></tr>
<tr><td><code id="query_ngd_+3A_max_results">max_results</code></td>
<td>
<p>(numeric) The maximum number of features to return.
Default is 100 which is the max return per page from the Data Hub.</p>
</td></tr>
<tr><td><code id="query_ngd_+3A_offset">offset</code></td>
<td>
<p>(numeric) The offset number skips past the specified number of
features in the collection. Used to page through results. Default is 0.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The value of <code>x</code> determines the type of query that is executed
against the NGD API. When <code>x</code> is missing or set to <code>NULL</code> the
first n=<code>max_results</code> features are returned. If a character string of
an OSID is supplied as <code>x</code>, then that one feature from the collection
will be returned.
</p>
<p>When <code>x</code> is present <code>query_ngd()</code> will attempt to derive an
extent from it. The <code>extent_from_*</code> family of functions are used and
can be passed to <code>query_ngd</code> as a more verbose option. The one
exception to this, <code>extent_from_grid_ref</code> must be used to create an
extent and query a BNG grid reference.
</p>
<p>The <code>start_datetime</code> and <code>end_datetime</code> parameters specify a
valid date-time with UTC time zone (Z). Leave either empty to specify an
open start/end interval. Only features that have a temporal geometry
('versionavailablefromdate' or 'versionavailabletodate') that intersect the
value in the datetime parameter are selected. Example
'2021-12-12T13:20:50Z'.
</p>
<p>More information on the structure and data in the NGD is available from:
<a href="https://osngd.gitbook.io/osngd/">https://osngd.gitbook.io/osngd/</a>. Technical details on the NGD API are
documented on the Data Hub:
<a href="https://osdatahub.os.uk/docs/ofa/technicalSpecification">https://osdatahub.os.uk/docs/ofa/technicalSpecification</a>.
</p>


<h3>Value</h3>

<p>A GeoJSON string with the results of the API query, a list object,
or an object of class <code>sf</code> based on the <code>returnType</code> parameter.
</p>


<h3>See Also</h3>

<p><a href="#topic+extent">extent</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Return the first 50 features in the collection.
results &lt;- query_ngd(collection = 'bld-fts-buildingline-1', max_results = 50)

# Return the most recent representation of a feature ID.
results &lt;- query_ngd('0000013e-5fed-447d-a627-dae6fb215138',
                     collection = 'bld-fts-buildingline-1')

# Use an ONS geography to define a query extent.
results &lt;- query_ngd(extent_from_ons_code('E05002470'),
                     collection = 'bld-fts-buildingpart-1')

# Use an BNG reference to define a query extent.
results &lt;- query_ngd(extent_from_bng("SU3715"),
                     collection = 'bld-fts-buildingpart-1')

# Use a spatial object to define a query extent.
# Return the features converted to a spatial object.
results &lt;- query_ngd(sf::st_read('path/to/file.shp'),
                     collection = 'bld-fts-buildingpart-1',
                     returnType = 'sf')

# Add a temporal filter to query.
results &lt;- query_ngd(collection = 'bld-fts-buildingline-1',
                     max_results = 50,
                     start_datetime = '2021-12-12 13:20:50')

</code></pre>

<hr>
<h2 id='query_places'>Query the OS Places API</h2><span id='topic+query_places'></span><span id='topic+query_places.qExtent'></span><span id='topic+query_places.character'></span>

<h3>Description</h3>

<p>Retrieve information on UK addresses within a geographic area or based on a
free text search.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>query_places(x, ...)

## S3 method for class 'qExtent'
query_places(
  x,
  output_crs,
  limit = 100,
  classification_code,
  logical_status_code,
  dataset = "DPA",
  key = get_os_key(),
  returnType = c("geojson", "list", "sf"),
  ...
)

## S3 method for class 'character'
query_places(
  x,
  output_crs = "EPSG:27700",
  limit = 100,
  classification_code,
  logical_status_code,
  minmatch,
  matchprecision,
  dataset = "DPA",
  key = get_os_key(),
  returnType = c("geojson", "list", "sf"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="query_places_+3A_x">x</code></td>
<td>
<p>Either a polygon created with <code>extent_from_*</code> functions
defining the geographic area, or a character string to search.</p>
</td></tr>
<tr><td><code id="query_places_+3A_...">...</code></td>
<td>
<p>Additional parameters (not currently used).</p>
</td></tr>
<tr><td><code id="query_places_+3A_output_crs">output_crs</code></td>
<td>
<p>Output CRS.</p>
</td></tr>
<tr><td><code id="query_places_+3A_limit">limit</code></td>
<td>
<p>(numeric) The maximum number of features to return.
Default is 100 which is the max return per page from the Data Hub.</p>
</td></tr>
<tr><td><code id="query_places_+3A_classification_code">classification_code</code></td>
<td>
<p>Classification codes to filter query by.</p>
</td></tr>
<tr><td><code id="query_places_+3A_logical_status_code">logical_status_code</code></td>
<td>
<p>Logical status code to filter query by.</p>
</td></tr>
<tr><td><code id="query_places_+3A_dataset">dataset</code></td>
<td>
<p>(character) The dataset to return. Multiple values can be
provided as a vector. Default is 'DPA'.</p>
</td></tr>
<tr><td><code id="query_places_+3A_key">key</code></td>
<td>
<p>(character) OS API key. Default action is to search for an
environment variable using <code>get_os_key()</code>.</p>
</td></tr>
<tr><td><code id="query_places_+3A_returntype">returnType</code></td>
<td>
<p>(character) Return the query results as the raw
<code>'geojson'</code>, a nested <code>'list'</code> object containing the returns,
or convert them into Simple Features and return an object of class
<code>'sf'</code>.</p>
</td></tr>
<tr><td><code id="query_places_+3A_minmatch">minmatch</code></td>
<td>
<p>The minimum matching score a result has to be returned.</p>
</td></tr>
<tr><td><code id="query_places_+3A_matchprecision">matchprecision</code></td>
<td>
<p>The decimal point position at which the match score
value is to be truncated.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The OS Places API provides a detailed view of an address and its
life cycle. Use this function to query Places based on a geographic area or
a free text search.
</p>
<p>The Places API contains all the records of AddressBase® Premium and
AddressBase® Premium – Islands and so provides all the information relating
to an address or property from creation to retirement. It contains local
authority, Ordnance Survey and Royal Mail® addresses, current addresses,
and alternatives for current addresses, provisional addresses (such as
planning developments) and historic information, plus OWPAs and cross
references to the OS MasterMap® TOIDS®. OS Places API contains addresses
located within the United Kingdom, Jersey, Guernsey and the Isle of Man.
For address records in Jersey and Guernsey the coordinates will be ‘0.0’ as
they fall outside of the British National Grid. This means they are not
compatible with the GeoSearch operations.
</p>
<p>Technical details on the Places API are documented on the Data Hub:
<a href="https://osdatahub.os.uk/docs/places/technicalSpecification">https://osdatahub.os.uk/docs/places/technicalSpecification</a>.
</p>
<p>Note: the Places API requires a Premium API key.
</p>


<h3>Value</h3>

<p>A GeoJSON string with the results of the API query, a list object,
or an object of class <code>sf</code> based on the <code>returnType</code> parameter.
</p>


<h3>See Also</h3>

<p><a href="#topic+extent">extent</a>, <code><a href="#topic+query_nearest_places">query_nearest_places()</a></code>, <code><a href="#topic+query_postcode_places">query_postcode_places()</a></code>, <code><a href="#topic+query_uprn_places">query_uprn_places()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Addresses within a bounding box
extent &lt;- extent_from_bbox(c(600000, 310200, 600900, 310900),
                           crs = 'EPSG:27700')

results &lt;- query_places(extent, limit = 50)

# Find addresses by text search.
results &lt;- query_places('Ordnance Survey, Adanac Drive, SO16',
                        minmatch = 0.5)

</code></pre>

<hr>
<h2 id='query_postcode_places'>Query the OS Places API</h2><span id='topic+query_postcode_places'></span>

<h3>Description</h3>

<p>A query of addresses based on a property's postcode.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>query_postcode_places(
  postcode,
  output_crs = "EPSG:27700",
  limit = 100,
  classification_code,
  logical_status_code,
  dataset = "DPA",
  key = get_os_key(),
  returnType = c("geojson", "list", "sf"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="query_postcode_places_+3A_postcode">postcode</code></td>
<td>
<p>The postcode search parameter as a character.</p>
</td></tr>
<tr><td><code id="query_postcode_places_+3A_output_crs">output_crs</code></td>
<td>
<p>(character or numeric) The output CRS. Defaults to
“EPSG:27700”.</p>
</td></tr>
<tr><td><code id="query_postcode_places_+3A_limit">limit</code></td>
<td>
<p>(numeric) The maximum number of features to return. Default is
100 which is the max return per page from the Data Hub.</p>
</td></tr>
<tr><td><code id="query_postcode_places_+3A_classification_code">classification_code</code></td>
<td>
<p>Classification codes to filter query by.</p>
</td></tr>
<tr><td><code id="query_postcode_places_+3A_logical_status_code">logical_status_code</code></td>
<td>
<p>Logical status code to filter query by.</p>
</td></tr>
<tr><td><code id="query_postcode_places_+3A_dataset">dataset</code></td>
<td>
<p>(character) The dataset to return. Multiple values can be
provided as a vector. Default is 'DPA'.</p>
</td></tr>
<tr><td><code id="query_postcode_places_+3A_key">key</code></td>
<td>
<p>(character) OS API key. Default action is to search for an
environment variable using <code>get_os_key()</code>.</p>
</td></tr>
<tr><td><code id="query_postcode_places_+3A_returntype">returnType</code></td>
<td>
<p>(character) Return the query results as the raw
<code>'geojson'</code>, a nested <code>'list'</code> object containing the returns,
or convert them into Simple Features and return an object of class
<code>'sf'</code>.</p>
</td></tr>
<tr><td><code id="query_postcode_places_+3A_...">...</code></td>
<td>
<p>Additional parameters (not currently used).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The OS Places API provides a detailed view of an address and its
life cycle. Use this function to query Places based on a postcode search.
The minimum search parameter for this resource is the postcode area and
postcode district. For example, 'SO16' is a valid search. Full postcodes,
consisting of area, district, sector and unit, e.g. SO16 0AS can also be
supplied.
</p>
<p>The Places API contains all the records of AddressBase® Premium and
AddressBase® Premium – Islands and so provides all the information relating
to an address or property from creation to retirement. It contains local
authority, Ordnance Survey and Royal Mail® addresses, current addresses,
and alternatives for current addresses, provisional addresses (such as
planning developments) and historic information, plus OWPAs and cross
references to the OS MasterMap® TOIDS®. OS Places API contains addresses
located within the United Kingdom, Jersey, Guernsey and the Isle of Man.
For address records in Jersey and Guernsey the coordinates will be ‘0.0’ as
they fall outside of the British National Grid. This means they are not
compatible with the GeoSearch operations.
</p>
<p>Technical details on the Places API are documented on the Data Hub:
<a href="https://osdatahub.os.uk/docs/places/technicalSpecification">https://osdatahub.os.uk/docs/places/technicalSpecification</a>.
</p>
<p>Note: the Places API requires a Premium API key.
</p>


<h3>Value</h3>

<p>A GeoJSON string with the results of the API query, a list object,
or an object of class <code>sf</code> based on the <code>returnType</code> parameter.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+query_places">query_places()</a></code>, <code><a href="#topic+query_nearest_places">query_nearest_places()</a></code>, <code><a href="#topic+query_uprn_places">query_uprn_places()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
results &lt;- query_postcode_places(postcode = 'SO16 0AS')

</code></pre>

<hr>
<h2 id='query_uprn_places'>Query the OS Places API</h2><span id='topic+query_uprn_places'></span>

<h3>Description</h3>

<p>A query of addresses based on a property's UPRN.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>query_uprn_places(
  uprn,
  output_crs = "EPSG:27700",
  classification_code,
  logical_status_code,
  dataset = "DPA",
  key = get_os_key(),
  returnType = c("geojson", "list", "sf"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="query_uprn_places_+3A_uprn">uprn</code></td>
<td>
<p>A valid UPRN.</p>
</td></tr>
<tr><td><code id="query_uprn_places_+3A_output_crs">output_crs</code></td>
<td>
<p>(character or numeric) The output CRS. Defaults to
“EPSG:27700”.</p>
</td></tr>
<tr><td><code id="query_uprn_places_+3A_classification_code">classification_code</code></td>
<td>
<p>Classification codes to filter query by.</p>
</td></tr>
<tr><td><code id="query_uprn_places_+3A_logical_status_code">logical_status_code</code></td>
<td>
<p>Logical status code to filter query by.</p>
</td></tr>
<tr><td><code id="query_uprn_places_+3A_dataset">dataset</code></td>
<td>
<p>(character) The dataset to return. Multiple values can be
provided as a vector. Default is 'DPA'.</p>
</td></tr>
<tr><td><code id="query_uprn_places_+3A_key">key</code></td>
<td>
<p>(character) OS API key. Default action is to search for an
environment variable using <code>get_os_key()</code>.</p>
</td></tr>
<tr><td><code id="query_uprn_places_+3A_returntype">returnType</code></td>
<td>
<p>(character) Return the query results as the raw
<code>'geojson'</code>, a nested <code>'list'</code> object containing the returns,
or convert them into Simple Features and return an object of class
<code>'sf'</code>.</p>
</td></tr>
<tr><td><code id="query_uprn_places_+3A_...">...</code></td>
<td>
<p>Additional parameters (not currently used).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The OS Places API provides a detailed view of an address and its
life cycle. Use this function to query Places based on a UPRN search.
</p>
<p>The Places API contains all the records of AddressBase® Premium and
AddressBase® Premium – Islands and so provides all the information relating
to an address or property from creation to retirement. It contains local
authority, Ordnance Survey and Royal Mail® addresses, current addresses,
and alternatives for current addresses, provisional addresses (such as
planning developments) and historic information, plus OWPAs and cross
references to the OS MasterMap® TOIDS®. OS Places API contains addresses
located within the United Kingdom, Jersey, Guernsey and the Isle of Man.
For address records in Jersey and Guernsey the coordinates will be ‘0.0’ as
they fall outside of the British National Grid. This means they are not
compatible with the GeoSearch operations.
</p>
<p>Technical details on the Places API are documented on the Data Hub:
<a href="https://osdatahub.os.uk/docs/places/technicalSpecification">https://osdatahub.os.uk/docs/places/technicalSpecification</a>.
</p>
<p>Note: the Places API requires a Premium API key.
</p>


<h3>Value</h3>

<p>A GeoJSON string with the results of the API query, a list object,
or an object of class <code>sf</code> based on the <code>returnType</code> parameter.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+query_places">query_places()</a></code>, <code><a href="#topic+query_nearest_places">query_nearest_places()</a></code>, <code><a href="#topic+query_uprn_places">query_uprn_places()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
results &lt;- query_uprn_places(uprn = 200010019924)

</code></pre>

<hr>
<h2 id='set_os_key'>Set credentials for OS Data Hub</h2><span id='topic+set_os_key'></span><span id='topic+get_os_key'></span><span id='topic+has_os_key'></span>

<h3>Description</h3>

<p>In order to use the Ordnance Survey Data Hub a valid API key is required.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_os_key(apikey)

get_os_key()

has_os_key()
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_os_key_+3A_apikey">apikey</code></td>
<td>
<p>(character) Required project API key.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Stores the user provided character string in an environment variable
named <code>OS_API_KEY</code>. No validation of the key is applied when storing.
To obtain a key go to <a href="https://osdatahub.os.uk/">https://osdatahub.os.uk/</a>.
</p>
<p>Be careful not to reveal secrets including API keys. This function
may print the API key to the console. It is used internally by the
<code>osdatahub</code> query functions.
</p>
<p>Primarily this is used internally to control when examples are
executed.
</p>


<h3>Value</h3>

<p>(Invisibly) A logical value from <code>Sys.setenv</code> whether an
environment variable was set.
</p>
<p>If an environment variable named <code>OS_API_KEY</code> is present, the
character string for the variable is returned.
</p>
<p>If an environment variable named <code>OS_API_KEY</code> is present, then
<code>TRUE</code>, else this function returns <code>FALSE</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set_os_key('my-api-key')


my_api_key &lt;- get_os_key()

has_os_key()

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
