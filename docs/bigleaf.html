<!DOCTYPE html><html lang="en"><head><title>Help for package bigleaf</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {bigleaf}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#aerodynamic.conductance'><p>Aerodynamic Conductance</p></a></li>
<li><a href='#air.density'><p>Air Density</p></a></li>
<li><a href='#Arrhenius.temp.response'><p>(Modified) Arrhenius Temperature Response Function</p></a></li>
<li><a href='#AT_Neu_Jul_2010'><p>Eddy Covariance Data of AT-Neu (Neustift)</p></a></li>
<li><a href='#bigleaf.constants'><p>Constants Used in the bigleaf Package</p></a></li>
<li><a href='#biochemical.energy'><p>Biochemical Energy</p></a></li>
<li><a href='#check.input'><p>Check Input for Functions in the bigleaf Package</p></a></li>
<li><a href='#check.length'><p>Test Variables for Equal Length</p></a></li>
<li><a href='#DE_Tha_Jun_2014'><p>Eddy Covariance Data of DE-Tha (Tharandt)</p></a></li>
<li><a href='#decoupling'><p>Canopy-Atmosphere Decoupling Coefficient</p></a></li>
<li><a href='#dew.point'><p>Dew Point</p></a></li>
<li><a href='#dew.point.solver'><p>Solver function for dew point temperature</p></a></li>
<li><a href='#energy.closure'><p>Energy Balance Closure</p></a></li>
<li><a href='#energy.use.efficiency'><p>Energy-Use Efficiency (EUE)</p></a></li>
<li><a href='#equilibrium.imposed.ET'><p>Equilibrium and Imposed Evapotranspiration</p></a></li>
<li><a href='#Esat.slope'><p>Saturation Vapor Pressure (Esat) and Slope of the Esat Curve</p></a></li>
<li><a href='#extraterrestrial.radiation'><p>Extraterrestrial solar radiation</p></a></li>
<li><a href='#filter.data'><p>Basic Eddy Covariance Data Filtering</p></a></li>
<li><a href='#filter.growing.season'><p>GPP-based Growing Season Filter</p></a></li>
<li><a href='#FR_Pue_May_2012'><p>Eddy Covariance Data of FR-Pue (Puechabon)</p></a></li>
<li><a href='#Gb.Choudhury'><p>Boundary Layer Conductance according to Choudhury &amp; Monteith 1988</p></a></li>
<li><a href='#Gb.Su'><p>Boundary Layer Conductance according to Su et al. 2001</p></a></li>
<li><a href='#Gb.Thom'><p>Boundary Layer Conductance according to Thom 1972</p></a></li>
<li><a href='#intercellular.CO2'><p>Bulk Intercellular CO2 Concentration</p></a></li>
<li><a href='#isothermal.Rn'><p>Isothermal Net Radiation</p></a></li>
<li><a href='#kg.to.mol'><p>Conversion between Mass and Molar Units</p></a></li>
<li><a href='#kinematic.viscosity'><p>Kinematic Viscosity of Air</p></a></li>
<li><a href='#latent.heat.vaporization'><p>Latent Heat of Vaporization</p></a></li>
<li><a href='#LE.to.ET'><p>Conversion between Latent Heat Flux and Evapotranspiration</p></a></li>
<li><a href='#light.response'><p>Ecosystem Light Response</p></a></li>
<li><a href='#light.use.efficiency'><p>Light-Use Efficiency (LUE)</p></a></li>
<li><a href='#longwave.conductance'><p>Longwave Radiative Transfer Conductance of the Canopy</p></a></li>
<li><a href='#Monin.Obukhov.length'><p>Monin-Obukhov Length</p></a></li>
<li><a href='#ms.to.mol'><p>Conversion between Conductance Units</p></a></li>
<li><a href='#optimum.temperature'><p>Optimum temperature of Gross Primary Productivity</p></a></li>
<li><a href='#photosynthetic.capacity'><p>Bulk Canopy Photosynthetic Capacity (Vcmax and Jmax)</p></a></li>
<li><a href='#potential.ET'><p>Potential Evapotranspiration</p></a></li>
<li><a href='#potential.radiation'><p>Potential radiation</p></a></li>
<li><a href='#pressure.from.elevation'><p>Atmospheric Pressure from Hypsometric Equation</p></a></li>
<li><a href='#psychrometric.constant'><p>Psychrometric Constant</p></a></li>
<li><a href='#radiometric.surface.temp'><p>Radiometric Surface Temperature</p></a></li>
<li><a href='#reference.ET'><p>Reference Evapotranspiration</p></a></li>
<li><a href='#Reynolds.Number'><p>Roughness Reynolds Number</p></a></li>
<li><a href='#Rg.to.PPFD'><p>Conversions between Global Radiation and Photosynthetic Photon Flux Density</p></a></li>
<li><a href='#roughness.length.heat'><p>Roughness length for heat</p></a></li>
<li><a href='#roughness.parameters'><p>Roughness Parameters</p></a></li>
<li><a href='#stability.correction'><p>Integrated Stability Correction Functions for Heat and Momentum</p></a></li>
<li><a href='#stability.parameter'><p>Stability Parameter &quot;zeta&quot;</p></a></li>
<li><a href='#stomatal.sensitivity'><p>Stomatal Sensitivity to VPD</p></a></li>
<li><a href='#stomatal.slope'><p>Stomatal Slope Parameter &quot;g1&quot;</p></a></li>
<li><a href='#surface.CO2'><p>CO2 Concentration at the Canopy Surface</p></a></li>
<li><a href='#surface.conditions'><p>Big-Leaf Surface Conditions</p></a></li>
<li><a href='#surface.conductance'><p>Surface Conductance to Water Vapor</p></a></li>
<li><a href='#umolCO2.to.gC'><p>Conversion between Mass and Molar Units of Carbon and CO2</p></a></li>
<li><a href='#virtual.temp'><p>Virtual Temperature</p></a></li>
<li><a href='#VPD.to.rH'><p>Conversions between Humidity Measures</p></a></li>
<li><a href='#wetbulb.solver'><p>Solver Function for Wet-Bulb Temperature</p></a></li>
<li><a href='#wetbulb.temp'><p>Wet-Bulb Temperature</p></a></li>
<li><a href='#wind.profile'><p>Wind Speed at a Given Height in the Surface Layer</p></a></li>
<li><a href='#WUE.metrics'><p>Water-Use Efficiency Metrics</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Version:</td>
<td>0.8.2</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-08-22</td>
</tr>
<tr>
<td>Title:</td>
<td>Physical and Physiological Ecosystem Properties from Eddy
Covariance Data</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Juergen Knauer &lt;J.Knauer@westernsydney.edu.au&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Calculation of physical (e.g. aerodynamic conductance, surface temperature), 
             and physiological (e.g. canopy conductance, water-use efficiency) ecosystem properties
			 from eddy covariance data and accompanying meteorological measurements. Calculations
			 assume the land surface to behave like a 'big-leaf' and return bulk ecosystem/canopy variables.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://bitbucket.org/juergenknauer/bigleaf">https://bitbucket.org/juergenknauer/bigleaf</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://bitbucket.org/juergenknauer/bigleaf/issues">https://bitbucket.org/juergenknauer/bigleaf/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>Imports:</td>
<td>robustbase, solartime</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>yes</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.1</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-08-22 05:21:04 UTC; 30044953</td>
</tr>
<tr>
<td>Author:</td>
<td>Juergen Knauer <a href="https://orcid.org/0000-0002-4947-7067"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Thomas Wutzler <a href="https://orcid.org/0000-0003-4159-5445"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Alison Bennett <a href="https://orcid.org/0000-0002-8249-976X"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Soenke Zaehle <a href="https://orcid.org/0000-0001-5602-7956"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Tarek El-Madany <a href="https://orcid.org/0000-0002-0726-7141"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Mirco Migliavacca <a href="https://orcid.org/0000-0003-3546-8407"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-08-22 06:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='aerodynamic.conductance'>Aerodynamic Conductance</h2><span id='topic+aerodynamic.conductance'></span>

<h3>Description</h3>

<p>Bulk aerodynamic conductance, including options for the boundary layer conductance
formulation and stability correction functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>aerodynamic.conductance(
  data,
  Tair = "Tair",
  pressure = "pressure",
  wind = "wind",
  ustar = "ustar",
  H = "H",
  zr,
  zh,
  d,
  z0m = NULL,
  Dl,
  N = 2,
  fc = NULL,
  LAI,
  Cd = 0.2,
  hs = 0.01,
  wind_profile = FALSE,
  stab_correction = TRUE,
  stab_formulation = c("Dyer_1970", "Businger_1971"),
  Rb_model = c("Thom_1972", "Choudhury_1988", "Su_2001", "constant_kB-1"),
  kB_h = NULL,
  Sc = NULL,
  Sc_name = NULL,
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="aerodynamic.conductance_+3A_data">data</code></td>
<td>
<p>Data.frame or matrix containing all required variables</p>
</td></tr>
<tr><td><code id="aerodynamic.conductance_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (deg C)</p>
</td></tr>
<tr><td><code id="aerodynamic.conductance_+3A_pressure">pressure</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
<tr><td><code id="aerodynamic.conductance_+3A_wind">wind</code></td>
<td>
<p>Wind speed (m s-1)</p>
</td></tr>
<tr><td><code id="aerodynamic.conductance_+3A_ustar">ustar</code></td>
<td>
<p>Friction velocity (m s-1)</p>
</td></tr>
<tr><td><code id="aerodynamic.conductance_+3A_h">H</code></td>
<td>
<p>Sensible heat flux (W m-2)</p>
</td></tr>
<tr><td><code id="aerodynamic.conductance_+3A_zr">zr</code></td>
<td>
<p>Instrument (reference) height (m)</p>
</td></tr>
<tr><td><code id="aerodynamic.conductance_+3A_zh">zh</code></td>
<td>
<p>Canopy height (m)</p>
</td></tr>
<tr><td><code id="aerodynamic.conductance_+3A_d">d</code></td>
<td>
<p>Zero-plane displacement height (m)</p>
</td></tr>
<tr><td><code id="aerodynamic.conductance_+3A_z0m">z0m</code></td>
<td>
<p>Roughness length for momentum (m), optional; if not provided, it is estimated from <code>roughness.parameters</code>
(method=&quot;wind_profile&quot;). Only used if <code>wind_profile = TRUE</code> and/or <code>Rb_model</code> = <code>"Su_2001"</code> or
<code>"Choudhury_1988"</code>.</p>
</td></tr>
<tr><td><code id="aerodynamic.conductance_+3A_dl">Dl</code></td>
<td>
<p>Characteristic leaf dimension (m) (if <code>Rb_model</code> = <code>"Su_2001"</code>) 
or leaf width (if <code>Rb_model</code> = <code>"Choudhury_1988"</code>); ignored otherwise.</p>
</td></tr>
<tr><td><code id="aerodynamic.conductance_+3A_n">N</code></td>
<td>
<p>Number of leaf sides participating in heat exchange (1 or 2); only used if <code>Rb_model = "Su_2001"</code>.
Defaults to 2.</p>
</td></tr>
<tr><td><code id="aerodynamic.conductance_+3A_fc">fc</code></td>
<td>
<p>Fractional vegetation cover (-); only used if <code>Rb_model = "Su_2001"</code>. See Details.</p>
</td></tr>
<tr><td><code id="aerodynamic.conductance_+3A_lai">LAI</code></td>
<td>
<p>One-sided leaf area index (m2 m-2); only used if <code>Rb_model</code> = <code>"Choudhury_1988"</code> or <code>"Su_2001"</code>.</p>
</td></tr>
<tr><td><code id="aerodynamic.conductance_+3A_cd">Cd</code></td>
<td>
<p>Foliage drag coefficient (-); only used if <code>Rb_model = "Su_2001"</code>.</p>
</td></tr>
<tr><td><code id="aerodynamic.conductance_+3A_hs">hs</code></td>
<td>
<p>Roughness length of bare soil (m); only used if <code>Rb_model = "Su_2001"</code>.</p>
</td></tr>
<tr><td><code id="aerodynamic.conductance_+3A_wind_profile">wind_profile</code></td>
<td>
<p>Should Ga for momentum be calculated based on the logarithmic wind profile equation? 
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="aerodynamic.conductance_+3A_stab_correction">stab_correction</code></td>
<td>
<p>Should stability correction be applied? Defaults to <code>TRUE</code>. Ignored if <code>wind_profile = FALSE</code>.</p>
</td></tr>
<tr><td><code id="aerodynamic.conductance_+3A_stab_formulation">stab_formulation</code></td>
<td>
<p>Stability correction function. Either <code>"Dyer_1970"</code> (default) or
<code>"Businger_1971"</code>. Ignored if <code>wind_profile = FALSE</code> or if <code>stab_correction = FALSE</code>.</p>
</td></tr>
<tr><td><code id="aerodynamic.conductance_+3A_rb_model">Rb_model</code></td>
<td>
<p>Boundary layer resistance formulation. One of <code>"Thom_1972","Choudhury_1988","Su_2001","constant_kB-1"</code>.</p>
</td></tr>
<tr><td><code id="aerodynamic.conductance_+3A_kb_h">kB_h</code></td>
<td>
<p>kB-1 value for heat transfer; only used if <code>Rb_model = "constant_kB-1"</code></p>
</td></tr>
<tr><td><code id="aerodynamic.conductance_+3A_sc">Sc</code></td>
<td>
<p>Optional: Schmidt number of additional quantities to be calculated</p>
</td></tr>
<tr><td><code id="aerodynamic.conductance_+3A_sc_name">Sc_name</code></td>
<td>
<p>Optional: Name of the additional quantities, has to be of same length than 
<code>Sc_name</code></p>
</td></tr>
<tr><td><code id="aerodynamic.conductance_+3A_constants">constants</code></td>
<td>
<p>k - von Karman constant <br />
cp - specific heat of air for constant pressure (J K-1 kg-1) <br />
Kelvin - conversion degree Celsius to Kelvin <br />
g - gravitational acceleration (m s-2) <br />
pressure0 - reference atmospheric pressure at sea level (Pa) <br />
Tair0 - reference air temperature (K) <br />
Sc_CO2 - Schmidt number for CO2 <br /> 
Pr - Prandtl number (if <code>Sc</code> is provided)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Aerodynamic conductance for heat (Ga_h) is calculated as:
</p>
<p style="text-align: center;"><code class="reqn">Ga_h = 1 / (Ra_m + Rb_h)</code>
</p>

<p>where Ra_m is the aerodynamic resistance for momentum and Rb the (quasi-laminar) canopy boundary
layer resistance ('excess resistance').
</p>
<p>The aerodynamic resistance for momentum Ra_m is given by:
</p>
<p style="text-align: center;"><code class="reqn">Ra_m = u/ustar^2</code>
</p>

<p>Note that this formulation accounts for changes in atmospheric stability, and does not require an
additional stability correction function. 
</p>
<p>An alternative method to calculate Ra_m is provided
(calculated if <code>wind_profile = TRUE</code>):
</p>
<p style="text-align: center;"><code class="reqn">Ra_m = (ln((zr - d)/z0m) - psi_h) / (k ustar)</code>
</p>

<p>If the roughness parameters z0m and d are unknown, they can be estimated using
<code><a href="#topic+roughness.parameters">roughness.parameters</a></code>. The argument <code>stab_formulation</code> determines the stability correction function used 
to account for the effect of atmospheric stability on Ra_m (Ra_m is lower for unstable
and higher for stable stratification). Stratification is based on a stability parameter zeta (z-d/L),
where z = reference height, d the zero-plane displacement height, and L the Monin-Obukhov length, 
calculated with <code><a href="#topic+Monin.Obukhov.length">Monin.Obukhov.length</a></code>
The stability correction function is chosen by the argument <code>stab_formulation</code>. Options are 
<code>"Dyer_1970"</code> and <code>"Businger_1971"</code>.
</p>
<p>The model used to determine the canopy boundary layer resistance for heat (Rb_h) is specified by 
the argument <code>Rb_model</code>. The following options are implemented:
<code>"Thom_1972"</code> is an empirical formulation based on the friction velocity (ustar) (Thom 1972):
</p>
<p style="text-align: center;"><code class="reqn">Rb_h = 6.2ustar^-0.667</code>
</p>

<p>The model by Choudhury &amp; Monteith 1988 (<code>Rb_model = "Choudhury_1988"</code>),
calculates Rb_h based on leaf width, LAI and ustar (Note that function argument <code>Dl</code>
represents leaf width (w) and not characteristic leaf dimension (Dl)
if <code>Rb_model</code> = <code>"Choudhury_1988"</code>):
</p>
<p style="text-align: center;"><code class="reqn">Gb_h = LAI((0.02/\alpha)*sqrt(u(zh)/w)*(1-exp(-\alpha/2)))</code>
</p>

<p>where <code class="reqn">\alpha</code> is a canopy attenuation coefficient modeled in dependence on LAI,
u(zh) is wind speed at canopy height (calculated from <code><a href="#topic+wind.profile">wind.profile</a></code>),
and w is leaf width (m). See <code><a href="#topic+Gb.Choudhury">Gb.Choudhury</a></code> for further details.
</p>
<p>The option <code>Rb_model = "Su_2001"</code> calculates Rb_h based on the physically-based Rb model by Su et al. 2001,
a simplification of the model developed by Massman 1999:
</p>
<p style="text-align: center;"><code class="reqn">kB_h = (k Cd fc^2) / (4Ct ustar/u(zh)) + kBs-1(1 - fc)^2</code>
</p>

<p>where Cd is a foliage drag coefficient (defaults to 0.2), fc is fractional
vegetation cover, Bs-1 is the inverse Stanton number for bare soil surface,
and Ct is a heat transfer coefficient. See <code><a href="#topic+Gb.Su">Gb.Su</a></code> for 
details on the model.
</p>
<p>The models calculate the parameter kB^(-1) (in the code referred to as <code>kB_h</code>), 
which is related to Rb_h:
</p>
<p style="text-align: center;"><code class="reqn">kB_h = Rb_h * (k * ustar)</code>
</p>

<p>From version 0.7.6 onwards, the roughness length for heat (z0h) is added to the output
if z0m is available (i.e. provided as input or calculated within this function).
z0h is calculated from <code><a href="#topic+roughness.length.heat">roughness.length.heat</a></code>:
</p>
<p style="text-align: center;"><code class="reqn">z0h = z0m / exp(kB_h)</code>
</p>

<p>Rb (and Gb) for water vapor and heat are assumed to be equal in this package.
Gb for other quantities x is calculated as (Hicks et al. 1987):
</p>
<p style="text-align: center;"><code class="reqn">Gb_x = Gb / (Sc_x / Pr)^0.67</code>
</p>

<p>where Sc_x is the Schmidt number of quantity x, and Pr is the Prandtl number (0.71).
</p>


<h3>Value</h3>

<p>a data.frame with the following columns:
</p>
<table role = "presentation">
<tr><td><code>Ga_m</code></td>
<td>
<p>Aerodynamic conductance for momentum transfer (m s-1)</p>
</td></tr>
<tr><td><code>Ra_m</code></td>
<td>
<p>Aerodynamic resistance for momentum transfer (s m-1)</p>
</td></tr>
<tr><td><code>Ga_h</code></td>
<td>
<p>Aerodynamic conductance for heat transfer (m s-1)</p>
</td></tr>
<tr><td><code>Ra_h</code></td>
<td>
<p>Aerodynamic resistance for heat transfer (s m-1)</p>
</td></tr>
<tr><td><code>Gb_h</code></td>
<td>
<p>Canopy boundary layer conductance for heat transfer (m s-1)</p>
</td></tr>
<tr><td><code>Rb_h</code></td>
<td>
<p>Canopy boundary layer resistance for heat transfer (s m-1)</p>
</td></tr>
<tr><td><code>kB_h</code></td>
<td>
<p>kB^(-1) parameter for heat transfer</p>
</td></tr>
<tr><td><code>z0h</code></td>
<td>
<p>Roughness length for heat (m) (NA if not input <code>z0m</code> not provided as input
or not estimated in this function)</p>
</td></tr>
<tr><td><code>zeta</code></td>
<td>
<p>Stability parameter 'zeta' (NA if <code>wind_profile = FALSE</code>)</p>
</td></tr>
<tr><td><code>psi_h</code></td>
<td>
<p>Integrated stability correction function (NA if <code>wind_profile = FALSE</code>)</p>
</td></tr>
<tr><td><code>Ra_CO2</code></td>
<td>
<p>Aerodynamic resistance for CO2 transfer (s m-1)</p>
</td></tr>
<tr><td><code>Ga_CO2</code></td>
<td>
<p>Aerodynamic conductance for CO2 transfer (m s-1)</p>
</td></tr>
<tr><td><code>Gb_CO2</code></td>
<td>
<p>Canopy boundary layer conductance for CO2 transfer (m s-1)</p>
</td></tr>
<tr><td><code>Ga_Sc_name</code></td>
<td>
<p>Aerodynamic conductance for <code>Sc_name</code> (m s-1). Only added if <code>Sc_name</code> and 
the respective <code>Sc</code> are provided</p>
</td></tr>
<tr><td><code>Gb_Sc_name</code></td>
<td>
<p>Boundary layer conductance for <code>Sc_name</code> (m s-1). Only added if <code>Sc_name</code> and 
the respective <code>Sc</code> are provided</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Input variables such as LAI, Dl, or zh can be either constants, or
vary with time (i.e. vectors of the same length as <code>data</code>).
</p>
<p>Note that boundary layer conductance to water vapor transfer (Gb_w) is often 
assumed to equal Gb_h. This assumption is also made in this R package, for 
example in the function <code><a href="#topic+surface.conductance">surface.conductance</a></code>.
</p>
<p>If the roughness length for momentum (<code>z0m</code>) is not provided as input, it is estimated 
from the function <code>roughness.parameters</code> within <code>wind.profile</code> if <code>wind_profile = TRUE</code> 
and/or <code>Rb_model</code> = <code>"Su_2001"</code> or <code>"Choudhury_1988"</code> The <code>roughness.parameters</code>
function estimates a single <code>z0m</code> value for the entire time period! If a varying <code>z0m</code> value 
(e.g. across seasons or years) is required, <code>z0m</code> should be provided as input argument.
</p>


<h3>References</h3>

<p>Verma, S., 1989: Aerodynamic resistances to transfers of heat, mass and momentum.
In: Estimation of areal evapotranspiration, IAHS Pub, 177, 13-20.
</p>
<p>Verhoef, A., De Bruin, H., Van Den Hurk, B., 1997: Some practical notes on the parameter kB-1
for sparse vegetation. Journal of Applied Meteorology, 36, 560-572.
</p>
<p>Hicks, B.B., Baldocchi, D.D., Meyers, T.P., Hosker, J.R., Matt, D.R., 1987:
A preliminary multiple resistance routine for deriving dry deposition velocities
from measured quantities. Water, Air, and Soil Pollution 36, 311-330.
</p>
<p>Monteith, J.L., Unsworth, M.H., 2008: Principles of environmental physics.
Third Edition. Elsevier Academic Press, Burlington, USA.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Gb.Thom">Gb.Thom</a></code>, <code><a href="#topic+Gb.Choudhury">Gb.Choudhury</a></code>, <code><a href="#topic+Gb.Su">Gb.Su</a></code> for calculations of Rb / Gb only
</p>


<h3>Examples</h3>

<pre><code class='language-R'>df &lt;- data.frame(Tair=25,pressure=100,wind=c(3,4,5),ustar=c(0.5,0.6,0.65),H=c(200,230,250))   
 
# simple calculation of Ga  
aerodynamic.conductance(df,Rb_model="Thom_1972") 

# calculation of Ga using a model derived from the logarithmic wind profile
aerodynamic.conductance(df,Rb_model="Thom_1972",zr=40,zh=25,d=17.5,z0m=2,wind_profile=TRUE) 

# simple calculation of Ga_m, but a physically based canopy boundary layer model
aerodynamic.conductance(df,Rb_model="Su_2001",zr=40,zh=25,d=17.5,Dl=0.05,N=2,fc=0.8)

</code></pre>

<hr>
<h2 id='air.density'>Air Density</h2><span id='topic+air.density'></span>

<h3>Description</h3>

<p>Air density of moist air from air temperature and pressure.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>air.density(Tair, pressure, constants = bigleaf.constants())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="air.density_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (deg C)</p>
</td></tr>
<tr><td><code id="air.density_+3A_pressure">pressure</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
<tr><td><code id="air.density_+3A_constants">constants</code></td>
<td>
<p>Kelvin - conversion degC to Kelvin <br />
Rd - gas constant of dry air (J kg-1 K-1) <br />
kPa2Pa - conversion kilopascal (kPa) to pascal (Pa)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Air density (<code class="reqn">\rho</code>) is calculated as:
</p>
<p style="text-align: center;"><code class="reqn">\rho = pressure / (Rd * Tair)</code>
</p>



<h3>Value</h3>

<p><code class="reqn">\rho</code> - air density (kg m-3)
</p>


<h3>References</h3>

<p>Foken, T, 2008: Micrometeorology. Springer, Berlin, Germany.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># air density at 25degC and standard pressure (101.325kPa)
air.density(25,101.325)

</code></pre>

<hr>
<h2 id='Arrhenius.temp.response'>(Modified) Arrhenius Temperature Response Function</h2><span id='topic+Arrhenius.temp.response'></span>

<h3>Description</h3>

<p>(Modified) Arrhenius function describing
the temperature response of biochemical parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Arrhenius.temp.response(
  param,
  Temp,
  Ha,
  Hd,
  dS,
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Arrhenius.temp.response_+3A_param">param</code></td>
<td>
<p>Parameter measured at measurement temperature (umol m-2 s-1)</p>
</td></tr>
<tr><td><code id="Arrhenius.temp.response_+3A_temp">Temp</code></td>
<td>
<p>Measurement temperature (degC)</p>
</td></tr>
<tr><td><code id="Arrhenius.temp.response_+3A_ha">Ha</code></td>
<td>
<p>Activation energy for param (kJ mol-1)</p>
</td></tr>
<tr><td><code id="Arrhenius.temp.response_+3A_hd">Hd</code></td>
<td>
<p>Deactivation energy for param (kJ mol-1)</p>
</td></tr>
<tr><td><code id="Arrhenius.temp.response_+3A_ds">dS</code></td>
<td>
<p>Entropy term for param (kJ mol-1 K-1)</p>
</td></tr>
<tr><td><code id="Arrhenius.temp.response_+3A_constants">constants</code></td>
<td>
<p>Kelvin - conversion degree Celsius to Kelvin <br />
Rgas - universal gas constant (J mol-1 K-1) <br />
kJ2J - conversion kilojoule (kJ) to joule (J)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function returns the biochemical rate at a reference
temperature of 25degC given a predefined temperature response function.
This temperature response is given by a modified form of the Arrhenius
function:
</p>
<p style="text-align: center;"><code class="reqn">param25 = param / 
                        ( exp(Ha * (Temp - Tref) / (Tref*Rgas*Temp)) *
                        (1 + exp((Tref*dS - Hd) / (Tref * Rgas))) /
                        (1 + exp((Temp*dS - Hd) / (Temp * Rgas)))
                        )
                 </code>
</p>

<p>where param is the value/rate of the parameter at measurement temperature,
Temp is temperature in K, Tref is reference temperature (298.15K), and Rgas
is the universal gas constant (8.314 J K-1 mol-1). Ha is the activation
energy (kJ mol-1), Hd is the deactivation energy (kJ mol-1), and dS the
entropy term (kJ mol-1 K-1) of the respective parameter.
</p>
<p>If either Hd or dS or both are not provided, the equation above reduces
to the first term (i.e. the common Arrhenius equation without the deactivation
term.)
</p>


<h3>Value</h3>

<p>param25 - value of the input parameter at the reference temperature of 25degC (umol m-2 s-1)
</p>


<h3>References</h3>

<p>Johnson F.H., Eyring H., Williams R.W. 1942: 
The nature of enzyme inhibitions in bacterial luminescence: sulfanilamide,
urethane, temperature and pressure. Journal of cellular and comparative
physiology 20, 247-268.
</p>
<p>Kattge J., Knorr W., 2007: Temperature acclimation in a biochemical
model of photosynthesis: a reanalysis of data from 36 species.
Plant, Cell and Environment 30, 1176-1190.
</p>

<hr>
<h2 id='AT_Neu_Jul_2010'>Eddy Covariance Data of AT-Neu (Neustift)</h2><span id='topic+AT_Neu_Jul_2010'></span>

<h3>Description</h3>

<p>Halfhourly eddy covariance Data of the site AT-Neu,
a mountain meadow in Austria.
(<a href="https://sites.fluxdata.org/AT-Neu/">https://sites.fluxdata.org/AT-Neu/</a>). 
Data are from July 2010.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>AT_Neu_Jul_2010
</code></pre>


<h3>Format</h3>

<p>A data frame with 1488 observations and 31 columns:
</p>

<dl>
<dt>year</dt><dd><p>year of measurement</p>
</dd>
<dt>month</dt><dd><p>month of measurement</p>
</dd>
<dt>doy</dt><dd><p>day of year</p>
</dd>
<dt>hour</dt><dd><p>hour (0 - 23.5)</p>
</dd>
<dt>Tair</dt><dd><p>Air temperature (degC) [TA_F]</p>
</dd>
<dt>Tair_qc</dt><dd><p>Quality control of <code>Tair</code> [TA_F_QC]</p>
</dd>
<dt>PPFD</dt><dd><p>Photosynthetic photon flux density (umol m-2 s-1) [PPFD_IN]</p>
</dd>
<dt>PPFD_qc</dt><dd><p>Quality control of <code>PPFD</code> [PPFD_IN_QC]</p>
</dd>
<dt>VPD</dt><dd><p>Vapor pressure deficit (kPa) [VPD_F]</p>
</dd>
<dt>VPD_qc</dt><dd><p>Quality control of <code>VPD</code> [VPD_F_QC]</p>
</dd>
<dt>pressure</dt><dd><p>Atmospheric pressure (kPa) [PA_F]</p>
</dd>
<dt>precip</dt><dd><p>precipitation (mm) [P_F]</p>
</dd>
<dt>precip_qc</dt><dd><p>Quality control of <code>precip</code> [P_F_QC]</p>
</dd>
<dt>ustar</dt><dd><p>friction velocity (m s-1) [USTAR]</p>
</dd>
<dt>wind</dt><dd><p>horizontal wind velocity (m s-1) [WS_F]</p>
</dd>
<dt>wind_qc</dt><dd><p>Quality control of <code>wind</code> [WS_F_QC]</p>
</dd>
<dt>Ca</dt><dd><p>CO2 concentration (ppm) [CO2_F_MDS]</p>
</dd>
<dt>Ca_qc</dt><dd><p>Quality control of <code>Ca</code> [CO2_F_MDS_QC]</p>
</dd>
<dt>LW_up</dt><dd><p>upward longwave radiation (W m-2) [LW_OUT]</p>
</dd>
<dt>Rn</dt><dd><p>Net radiation (W m-2) [NETRAD]</p>
</dd>
<dt>LE</dt><dd><p>Latent heat flux (W m-2) [LE_F_MDS]</p>
</dd>
<dt>LE_qc</dt><dd><p>Quality control of <code>LE</code> [LE_F_MDS_QC]</p>
</dd>
<dt>H</dt><dd><p>Sensible heat flux (W m-2) [H_F_MDS]</p>
</dd>
<dt>H_qc</dt><dd><p>Quality control of <code>H</code> [H_F_MDS_QC]</p>
</dd>
<dt>G</dt><dd><p>Ground heat flux (W m-2) [G_F_MDS]</p>
</dd>
<dt>G_qc</dt><dd><p>Quality control of <code>G</code> [G_F_MDS_QC]</p>
</dd>
<dt>NEE</dt><dd><p>Net ecosystem exchange (umol m-2 s-1) [NEE_VUT_USTAR50]</p>
</dd>
<dt>NEE_qc</dt><dd><p>Quality control of <code>NEE</code> [NEE_VUT_USTAR50_QC]</p>
</dd>
<dt>GPP</dt><dd><p>Gross primary productivity from nighttime partitioning (umol m-2 s-1) [GPP_NT_VUT_USTAR50]</p>
</dd>
<dt>GPP_qc</dt><dd><p>Quality control of <code>GPP</code> [NEE_VUT_USTAR50_QC]</p>
</dd>
<dt>Reco</dt><dd><p>Ecosystem respiration from nighttime partitioning (umol m-2 s-1) [RECO_NT_VUT_USTAR50]</p>
</dd>
</dl>



<h3>Note</h3>

<p>The original variable names as provided by the FLUXNET2015 dataset are 
given in squared brackets. Note that variable units have been converted
in some cases (e.g. VPD from hPa to kPa).
</p>


<h3>Source</h3>

<p>original data were downloaded from
<a href="https://fluxnet.org/">https://fluxnet.org/</a> (accessed 09 November 2016)
</p>

<hr>
<h2 id='bigleaf.constants'>Constants Used in the bigleaf Package</h2><span id='topic+bigleaf.constants'></span>

<h3>Description</h3>

<p>This function defines the following constants:
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bigleaf.constants(
  cp = 1004.834,
  Rgas = 8.31451,
  Rv = 461.5,
  Rd = 287.0586,
  Md = 0.0289645,
  Mw = 0.0180153,
  eps = 0.622,
  g = 9.81,
  solar_constant = 1366.1,
  pressure0 = 101325,
  Tair0 = 273.15,
  k = 0.41,
  Cmol = 0.012011,
  Omol = 0.0159994,
  H2Omol = 0.01801528,
  sigma = 5.670367e-08,
  Pr = 0.71,
  Sc_CO2 = 1.07,
  Le067 = 0.93,
  Kelvin = 273.15,
  DwDc = 1.6,
  days2seconds = 86400,
  kPa2Pa = 1000,
  Pa2kPa = 0.001,
  umol2mol = 1e-06,
  mol2umol = 1e+06,
  kg2g = 1000,
  g2kg = 0.001,
  kJ2J = 1000,
  J2kJ = 0.001,
  se_median = 1.253,
  frac2percent = 100
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="bigleaf.constants_+3A_cp">cp</code></td>
<td>
<p>Specific heat of air for constant pressure (J K-1 kg-1)</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_rgas">Rgas</code></td>
<td>
<p>Universal gas constant (J mol-1 K-1)</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_rv">Rv</code></td>
<td>
<p>Gas constant of water vapor (J kg-1 K-1) (Stull 1988 p.641)</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_rd">Rd</code></td>
<td>
<p>Gas constant of dry air (J kg-1 K-1) (Foken p. 245)</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_md">Md</code></td>
<td>
<p>Molar mass of dry air (kg mol-1)</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_mw">Mw</code></td>
<td>
<p>Molar mass of water vapor (kg mol-1)</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_eps">eps</code></td>
<td>
<p>Ratio of the molecular weight of water vapor to dry air (=Mw/Md)</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_g">g</code></td>
<td>
<p>Gravitational acceleration (m s-2)</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_solar_constant">solar_constant</code></td>
<td>
<p>Solar constant (W m-2)</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_pressure0">pressure0</code></td>
<td>
<p>Reference atmospheric pressure at sea level (Pa)</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_tair0">Tair0</code></td>
<td>
<p>Reference air temperature (K)</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_k">k</code></td>
<td>
<p>von Karman constant</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_cmol">Cmol</code></td>
<td>
<p>Molar mass of carbon (kg mol-1)</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_omol">Omol</code></td>
<td>
<p>Molar mass of oxygen (kg mol-1)</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_h2omol">H2Omol</code></td>
<td>
<p>Molar mass of water (kg mol-1)</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_sigma">sigma</code></td>
<td>
<p>Stefan-Boltzmann constant (W m-2 K-4)</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_pr">Pr</code></td>
<td>
<p>Prandtl number</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_sc_co2">Sc_CO2</code></td>
<td>
<p>Schmidt number for CO2</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_le067">Le067</code></td>
<td>
<p>Lewis number for water vapor to the power of 0.67</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_kelvin">Kelvin</code></td>
<td>
<p>Conversion degree Celsius to Kelvin</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_dwdc">DwDc</code></td>
<td>
<p>Ratio of the molecular diffusivities for water vapor and CO2</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_days2seconds">days2seconds</code></td>
<td>
<p>Seconds per day</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_kpa2pa">kPa2Pa</code></td>
<td>
<p>Conversion kilopascal (kPa) to pascal (Pa)</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_pa2kpa">Pa2kPa</code></td>
<td>
<p>Conversion pascal (Pa) to kilopascal (kPa)</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_umol2mol">umol2mol</code></td>
<td>
<p>Conversion micromole (umol) to mole (mol)</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_mol2umol">mol2umol</code></td>
<td>
<p>Conversion mole (mol) to micromole (umol)</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_kg2g">kg2g</code></td>
<td>
<p>Conversion kilogram (kg) to gram (g)</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_g2kg">g2kg</code></td>
<td>
<p>Conversion gram (g) to kilogram (kg)</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_kj2j">kJ2J</code></td>
<td>
<p>Conversion kilojoule (kJ) to joule (J)</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_j2kj">J2kJ</code></td>
<td>
<p>Conversion joule (J) to kilojoule (kJ)</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_se_median">se_median</code></td>
<td>
<p>Conversion standard error (SE) of the mean to SE of the median</p>
</td></tr>
<tr><td><code id="bigleaf.constants_+3A_frac2percent">frac2percent</code></td>
<td>
<p>Conversion between fraction and percent</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is passed as an argument to every function that uses one
or more constants. Individual constants passed to a function can be
easily altered. E.g. the following command will change the value of
the von Karman constant from 0.41 to 0.4:
</p>
<p><code>bigleaf.constants(k=0.4)</code>
</p>
<p>the value of a constant can be returned by calling:
</p>
<p><code>bigleaf.constants()$*name_of_constant*</code>
</p>
<p>To permanently change the constants contained within this function (which
makes sense for some of them, e.g. for the von Karman constant),
the command <code><a href="utils.html#topic+fixInNamespace">fixInNamespace</a></code> can be used. E.g.
</p>
<p><code>fixInNamespace(bigleaf.constants,ns="bigleaf")</code>
</p>
<p>Note that this has to be repeated every time the package is newly installed/loaded.
</p>

<hr>
<h2 id='biochemical.energy'>Biochemical Energy</h2><span id='topic+biochemical.energy'></span>

<h3>Description</h3>

<p>Radiant energy absorbed in photosynthesis or heat release by respiration calculated
from net ecosystem exchange of CO2 (NEE).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>biochemical.energy(NEE, alpha = 0.422)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="biochemical.energy_+3A_nee">NEE</code></td>
<td>
<p>Net ecosystem exchange (umol CO2 m-2 s-1)</p>
</td></tr>
<tr><td><code id="biochemical.energy_+3A_alpha">alpha</code></td>
<td>
<p>Energy taken up/released by photosynthesis/respiration per mol CO2 fixed/respired (J umol-1)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The following sign convention is employed: NEE is negative when carbon is taken up by the ecosystem.
Positive values of the resulting biochemical energy mean that energy (heat) is taken up by the ecosystem, 
negative ones that heat is released.
The value of alpha is taken from Nobel 1974 (see Meyers &amp; Hollinger 2004), but other values
have been used (e.g. Blanken et al., 1997)
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>Sp -</code></td>
<td>
<p>biochemical energy (W m-2)</p>
</td></tr>
</table>


<h3>References</h3>

<p>Meyers, T.P., Hollinger, S.E. 2004: An assessment of storage terms in the surface energy
balance of maize and soybean. Agricultural and Forest Meteorology 125, 105-115.
</p>
<p>Nobel, P.S., 1974: Introduction to Biophysical Plant Physiology.
Freeman, New York.
</p>
<p>Blanken, P.D. et al., 1997: Energy balance and canopy conductance of a boreal aspen
forest: Partitioning overstory and understory components. 
Journal of Geophysical Research 102, 28915-28927.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Calculate biochemical energy taken up by the ecosystem with 
# a measured NEE of -30umol CO2 m-2 s-1             
biochemical.energy(NEE=-30)            
           
</code></pre>

<hr>
<h2 id='check.input'>Check Input for Functions in the bigleaf Package</h2><span id='topic+check.input'></span>

<h3>Description</h3>

<p>Checks length and type of the provided input variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check.input(data, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check.input_+3A_data">data</code></td>
<td>
<p>Input data.frame or matrix</p>
</td></tr>
<tr><td><code id="check.input_+3A_...">...</code></td>
<td>
<p>Input variables. Either a list or individual vectors</p>
</td></tr>
</table>


<h3>Note</h3>

<p>This function can be run for named variables (in which case the return
value will be named according to the given name), or for placeholder
variables that are assigned and named according to e.g. entries of a character 
vector. In the latter case, the input variable has to be named as <code>"var"</code> or
<code>"var_qc"</code>.
</p>

<hr>
<h2 id='check.length'>Test Variables for Equal Length</h2><span id='topic+check.length'></span>

<h3>Description</h3>

<p>Test Variables for Equal Length
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check.length(varlist)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check.length_+3A_varlist">varlist</code></td>
<td>
<p>List of variables for which the length has to be compared</p>
</td></tr>
</table>


<h3>Note</h3>

<p>This function only plays a role if no input data.frame or matrix are 
provided. In this case it ensures that provided vectors have the same
length to avoid trouble later up the function call.
</p>

<hr>
<h2 id='DE_Tha_Jun_2014'>Eddy Covariance Data of DE-Tha (Tharandt)</h2><span id='topic+DE_Tha_Jun_2014'></span>

<h3>Description</h3>

<p>Halfhourly eddy covariance Data of the site DE-Tha,
a spruce forest in Eastern Germany 
(<a href="https://sites.fluxdata.org/DE-Tha/">https://sites.fluxdata.org/DE-Tha/</a>). 
Data are from June 2014.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>DE_Tha_Jun_2014
</code></pre>


<h3>Format</h3>

<p>A data frame with 1440 observations and 32 columns:
</p>

<dl>
<dt>year</dt><dd><p>year of measurement</p>
</dd>
<dt>month</dt><dd><p>month of measurement</p>
</dd>
<dt>doy</dt><dd><p>day of year</p>
</dd>
<dt>hour</dt><dd><p>hour (0 - 23.5)</p>
</dd>
<dt>Tair</dt><dd><p>Air temperature (degC) [TA_F]</p>
</dd>
<dt>Tair_qc</dt><dd><p>Quality control of <code>Tair</code> [TA_F_QC]</p>
</dd>
<dt>PPFD</dt><dd><p>Photosynthetic photon flux density (umol m-2 s-1) [PPFD_IN]</p>
</dd>
<dt>PPFD_qc</dt><dd><p>Quality control of <code>PPFD</code> [PPFD_IN_QC]</p>
</dd>
<dt>VPD</dt><dd><p>Vapor pressure deficit (kPa) [VPD_F]</p>
</dd>
<dt>VPD_qc</dt><dd><p>Quality control of <code>VPD</code> [VPD_F_QC]</p>
</dd>
<dt>pressure</dt><dd><p>Atmospheric pressure (kPa) [PA_F]</p>
</dd>
<dt>precip</dt><dd><p>precipitation (mm) [P_F]</p>
</dd>
<dt>precip_qc</dt><dd><p>Quality control of <code>precip</code> [P_F_QC]</p>
</dd>
<dt>ustar</dt><dd><p>friction velocity (m s-1) [USTAR]</p>
</dd>
<dt>wind</dt><dd><p>horizontal wind velocity (m s-1) [WS_F]</p>
</dd>
<dt>wind_qc</dt><dd><p>Quality control of <code>wind</code> [WS_F_QC]</p>
</dd>
<dt>Ca</dt><dd><p>CO2 concentration (ppm) [CO2_F_MDS]</p>
</dd>
<dt>Ca_qc</dt><dd><p>Quality control of <code>Ca</code> [CO2_F_MDS_QC]</p>
</dd>
<dt>LW_up</dt><dd><p>upward longwave radiation (W m-2) [LW_OUT]</p>
</dd>
<dt>LW_down</dt><dd><p>downward longwave radiation (W m-2) [LW_IN_F]</p>
</dd>
<dt>Rn</dt><dd><p>Net radiation (W m-2) [NETRAD]</p>
</dd>
<dt>LE</dt><dd><p>Latent heat flux (W m-2) [LE_F_MDS]</p>
</dd>
<dt>LE_qc</dt><dd><p>Quality control of <code>LE</code> [LE_F_MDS_QC]</p>
</dd>
<dt>H</dt><dd><p>Sensible heat flux (W m-2) [H_F_MDS]</p>
</dd>
<dt>H_qc</dt><dd><p>Quality control of <code>H</code> [H_F_MDS_QC]</p>
</dd>
<dt>G</dt><dd><p>Ground heat flux (W m-2) [G_F_MDS]</p>
</dd>
<dt>G_qc</dt><dd><p>Quality control of <code>G</code> [G_F_MDS_QC]</p>
</dd>
<dt>NEE</dt><dd><p>Net ecosystem exchange (umol m-2 s-1) [NEE_VUT_USTAR50]</p>
</dd>
<dt>NEE_qc</dt><dd><p>Quality control of <code>NEE</code> [NEE_VUT_USTAR50_QC]</p>
</dd>
<dt>GPP</dt><dd><p>Gross primary productivity from nighttime partitioning (umol m-2 s-1) [GPP_NT_VUT_USTAR50]</p>
</dd>
<dt>GPP_qc</dt><dd><p>Quality control of <code>GPP</code> [NEE_VUT_USTAR50_QC]</p>
</dd>
<dt>Reco</dt><dd><p>Ecosystem respiration from nighttime partitioning (umol m-2 s-1) [RECO_NT_VUT_USTAR50]</p>
</dd>
</dl>



<h3>Note</h3>

<p>The original variable names as provided by the FLUXNET2015 dataset are 
given in squared brackets. Note that variable units have been converted
in some cases (e.g. VPD from hPa to kPa).
</p>


<h3>Source</h3>

<p>original data were downloaded from
<a href="https://fluxnet.org/">https://fluxnet.org/</a> (accessed 09 November 2016)
</p>

<hr>
<h2 id='decoupling'>Canopy-Atmosphere Decoupling Coefficient</h2><span id='topic+decoupling'></span>

<h3>Description</h3>

<p>The canopy-atmosphere decoupling coefficient 'Omega'.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>decoupling(
  data,
  Tair = "Tair",
  pressure = "pressure",
  Ga = "Ga_h",
  Gs = "Gs_ms",
  approach = c("Jarvis&amp;McNaughton_1986", "Martin_1989"),
  LAI,
  Esat.formula = c("Sonntag_1990", "Alduchov_1996", "Allen_1998"),
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="decoupling_+3A_data">data</code></td>
<td>
<p>Data.frame or matrix containing all required input variables</p>
</td></tr>
<tr><td><code id="decoupling_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (deg C)</p>
</td></tr>
<tr><td><code id="decoupling_+3A_pressure">pressure</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
<tr><td><code id="decoupling_+3A_ga">Ga</code></td>
<td>
<p>Aerodynamic conductance to heat/water vapor (m s-1)</p>
</td></tr>
<tr><td><code id="decoupling_+3A_gs">Gs</code></td>
<td>
<p>Surface conductance (m s-1)</p>
</td></tr>
<tr><td><code id="decoupling_+3A_approach">approach</code></td>
<td>
<p>Approach used to calculate omega. Either <code>"Jarvis&amp;McNaughton_1986"</code> (default)
or <code>"Martin_1989"</code>.</p>
</td></tr>
<tr><td><code id="decoupling_+3A_lai">LAI</code></td>
<td>
<p>Leaf area index (m2 m-2), only used if <code>approach = "Martin_1989"</code>.</p>
</td></tr>
<tr><td><code id="decoupling_+3A_esat.formula">Esat.formula</code></td>
<td>
<p>Optional: formula to be used for the calculation of esat and the slope of esat.
One of <code>"Sonntag_1990"</code> (Default), <code>"Alduchov_1996"</code>, or <code>"Allen_1998"</code>.
See <code><a href="#topic+Esat.slope">Esat.slope</a></code>.</p>
</td></tr>
<tr><td><code id="decoupling_+3A_constants">constants</code></td>
<td>
<p>Kelvin - conversion degree Celsius to Kelvin <br />
cp - specific heat of air for constant pressure (J K-1 kg-1) <br />
eps - ratio of the molecular weight of water vapor to dry air (-) <br />
sigma - Stefan-Boltzmann constant (W m-2 K-4) <br />
Pa2kPa - conversion pascal (Pa) to kilopascal (kPa)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The decoupling coefficient Omega ranges from 0 to 1 and quantifies the
linkage of the conditions (foremost humidity and temperature) at the canopy surface
to the ambient air. Values close to 0 indicate well coupled conditions
characterized by high physiological (i.e. stomatal) control on transpiration
and similar conditions at the canopy surface compared to the atmosphere above
the canopy. Values close to 1 indicate the opposite, i.e. decoupled conditions and 
a low stomatal control on transpiration (Jarvis &amp; McNaughton 1986). <br />
The <code>"Jarvis&amp;McNaughton_1986"</code> approach (default option) is the original
formulation for the decoupling coefficient, given by (for an amphistomatous 
canopy):
</p>
<p style="text-align: center;"><code class="reqn">\Omega = \frac{\epsilon + 1}{\epsilon + 1 + \frac{Ga}{Gc}}</code>
</p>

<p>where <code class="reqn">\epsilon = \frac{s}{\gamma}</code> is a dimensionless coefficient
with s being the slope of the saturation vapor pressure curve (Pa K-1), and <code class="reqn">\gamma</code> the 
psychrometric constant (Pa K-1).
</p>
<p>The approach <code>"Martin_1989"</code> by Martin 1989 additionally takes radiative coupling
into account:
</p>
<p style="text-align: center;"><code class="reqn">\Omega = \frac{\epsilon + 1 + \frac{Gr}{Ga}}{\epsilon + (1 + \frac{Ga}{Gs}) (1 + \frac{Gr}{Ga})}</code>
</p>



<h3>Value</h3>

<p><code class="reqn">\Omega</code> - the decoupling coefficient Omega (-)
</p>


<h3>References</h3>

<p>Jarvis P.G., McNaughton K.G., 1986: Stomatal control of transpiration:
scaling up from leaf to region. Advances in Ecological Research 15, 1-49. 
</p>
<p>Martin P., 1989: The significance of radiative coupling between
vegetation and the atmosphere. Agricultural and Forest Meteorology 49, 45-53.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+aerodynamic.conductance">aerodynamic.conductance</a></code>, <code><a href="#topic+surface.conductance">surface.conductance</a></code>,
<code><a href="#topic+equilibrium.imposed.ET">equilibrium.imposed.ET</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Omega calculated following Jarvis &amp; McNaughton 1986
set.seed(3)
df &lt;- data.frame(Tair=rnorm(20,25,1),pressure=100,Ga_h=rnorm(20,0.06,0.01),
                 Gs_ms=rnorm(20,0.005,0.001))
decoupling(df,approach="Jarvis&amp;McNaughton_1986")

# Omega calculated following Martin 1989 (requires LAI)
decoupling(df,approach="Martin_1989",LAI=4)

</code></pre>

<hr>
<h2 id='dew.point'>Dew Point</h2><span id='topic+dew.point'></span>

<h3>Description</h3>

<p>calculates the dew point, the temperature to which air must be 
cooled to become saturated (i.e. e = Esat(Td))
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dew.point(
  Tair,
  VPD,
  accuracy = 0.001,
  Esat.formula = c("Sonntag_1990", "Alduchov_1996", "Allen_1998"),
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dew.point_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (degC)</p>
</td></tr>
<tr><td><code id="dew.point_+3A_vpd">VPD</code></td>
<td>
<p>Vapor pressure deficit (kPa)</p>
</td></tr>
<tr><td><code id="dew.point_+3A_accuracy">accuracy</code></td>
<td>
<p>Accuracy of the result (deg C)</p>
</td></tr>
<tr><td><code id="dew.point_+3A_esat.formula">Esat.formula</code></td>
<td>
<p>Optional: formula to be used for the calculation of esat and the slope of esat.
One of <code>"Sonntag_1990"</code> (Default), <code>"Alduchov_1996"</code>, or <code>"Allen_1998"</code>.
See <code><a href="#topic+Esat.slope">Esat.slope</a></code>.</p>
</td></tr>
<tr><td><code id="dew.point_+3A_constants">constants</code></td>
<td>
<p>Pa2kPa - conversion pascal (Pa) to kilopascal (kPa)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Dew point temperature (Td) is defined by:
</p>
<p style="text-align: center;"><code class="reqn">e = Esat(Td)</code>
</p>

<p>where e is vapor pressure of the air and Esat is the vapor pressure deficit.
This equation is solved for Td using <code><a href="stats.html#topic+optimize">optimize</a></code>.
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>Td -</code></td>
<td>
<p>dew point temperature (degC)</p>
</td></tr>
</table>


<h3>References</h3>

<p>Monteith J.L., Unsworth M.H., 2008: Principles of Environmental Physics.
3rd edition. Academic Press, London.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dew.point(c(25,30),1.5)                

</code></pre>

<hr>
<h2 id='dew.point.solver'>Solver function for dew point temperature</h2><span id='topic+dew.point.solver'></span>

<h3>Description</h3>

<p>Solver function used in dew.point()
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dew.point.solver(ea, accuracy, Esat.formula, constants = bigleaf.constants())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dew.point.solver_+3A_ea">ea</code></td>
<td>
<p>Air vapor pressure (kPa)</p>
</td></tr>
<tr><td><code id="dew.point.solver_+3A_accuracy">accuracy</code></td>
<td>
<p>Accuracy of the result (degC)</p>
</td></tr>
<tr><td><code id="dew.point.solver_+3A_esat.formula">Esat.formula</code></td>
<td>
<p>Optional: formula to be used for the calculation of esat and the slope of esat.
One of <code>"Sonntag_1990"</code> (Default), <code>"Alduchov_1996"</code>, or <code>"Allen_1998"</code>.
See <code><a href="#topic+Esat.slope">Esat.slope</a></code>.</p>
</td></tr>
<tr><td><code id="dew.point.solver_+3A_constants">constants</code></td>
<td>
<p>Pa2kPa - conversion pascal (Pa) to kilopascal (kPa)</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Arguments <code>accuracy</code> and <code>Esat.formula</code> are passed to this function by dew.point().
</p>

<hr>
<h2 id='energy.closure'>Energy Balance Closure</h2><span id='topic+energy.closure'></span>

<h3>Description</h3>

<p>Calculates the degree of the energy balance non-closure for the entire time span
based on the ratio of two sums (energy balance ratio), and ordinary least squares (OLS).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>energy.closure(
  data,
  Rn = "Rn",
  G = NULL,
  S = NULL,
  LE = "LE",
  H = "H",
  instantaneous = FALSE,
  missing.G.as.NA = FALSE,
  missing.S.as.NA = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="energy.closure_+3A_data">data</code></td>
<td>
<p>Data.frame or matrix containing all required variables.</p>
</td></tr>
<tr><td><code id="energy.closure_+3A_rn">Rn</code></td>
<td>
<p>Net radiation (W m-2)</p>
</td></tr>
<tr><td><code id="energy.closure_+3A_g">G</code></td>
<td>
<p>Ground heat flux (W m-2); optional</p>
</td></tr>
<tr><td><code id="energy.closure_+3A_s">S</code></td>
<td>
<p>Sum of all storage fluxes (W m-2); optional</p>
</td></tr>
<tr><td><code id="energy.closure_+3A_le">LE</code></td>
<td>
<p>Latent heat flux (W m-2)</p>
</td></tr>
<tr><td><code id="energy.closure_+3A_h">H</code></td>
<td>
<p>Sensible heat flux (W m-2)</p>
</td></tr>
<tr><td><code id="energy.closure_+3A_instantaneous">instantaneous</code></td>
<td>
<p>should the energy balance be calculated at the time step 
of the observations (<code>TRUE</code>), or over the entire time period
provided as input (<code>FALSE</code>)</p>
</td></tr>
<tr><td><code id="energy.closure_+3A_missing.g.as.na">missing.G.as.NA</code></td>
<td>
<p>if <code>TRUE</code>, missing G are treated as <code>NA</code>s ,otherwise set to 0.</p>
</td></tr>
<tr><td><code id="energy.closure_+3A_missing.s.as.na">missing.S.as.NA</code></td>
<td>
<p>if <code>TRUE</code>, missing S are treated as <code>NA</code>s, otherwise set to 0.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The energy balance ratio (EBR) is calculated as:
</p>
<p style="text-align: center;"><code class="reqn">EBR = sum(LE + H)/sum(Rn - G - S)</code>
</p>

<p>the sum is taken for all time steps with complete observations (i.e. where
all energy balance terms are available).
</p>


<h3>Value</h3>

<p>a named vector containing:
</p>
<table role = "presentation">
<tr><td><code>n</code></td>
<td>
<p>number of complete (all energy balance terms available) observations</p>
</td></tr>
<tr><td><code>intercept</code></td>
<td>
<p>intercept of the OLS regression</p>
</td></tr>
<tr><td><code>slope</code></td>
<td>
<p>slope of the OLS regression</p>
</td></tr>
<tr><td><code>r_squared</code></td>
<td>
<p>r^2 of the OLS regression</p>
</td></tr>
<tr><td><code>EBR</code></td>
<td>
<p>energy balance ratio</p>
</td></tr>
</table>
<p>if <code>instantaneous = TRUE</code>, only <code>EBR</code> is returned.
</p>


<h3>References</h3>

<p>Wilson K., et al. 2002: Energy balance closure at FLUXNET sites.
Agricultural and Forest Meteorology 113, 223-243.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## characterize energy balance closure for DE-Tha in June 2014
energy.closure(DE_Tha_Jun_2014,instantaneous=FALSE)

## look at half-hourly closure 
EBR_inst &lt;- energy.closure(DE_Tha_Jun_2014,instantaneous=TRUE)
summary(EBR_inst)

</code></pre>

<hr>
<h2 id='energy.use.efficiency'>Energy-Use Efficiency (EUE)</h2><span id='topic+energy.use.efficiency'></span>

<h3>Description</h3>

<p>Fraction of net radiation fixed by primary productivity.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>energy.use.efficiency(GPP, alpha = 0.422, Rn)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="energy.use.efficiency_+3A_gpp">GPP</code></td>
<td>
<p>Gross primary productivity exchange (umol CO2 m-2 s-1)</p>
</td></tr>
<tr><td><code id="energy.use.efficiency_+3A_alpha">alpha</code></td>
<td>
<p>Energy taken up/released by photosynthesis/respiration (J umol-1)</p>
</td></tr>
<tr><td><code id="energy.use.efficiency_+3A_rn">Rn</code></td>
<td>
<p>Net radiation (W m-2)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Energy use efficiency is calculated as:
</p>
<p style="text-align: center;"><code class="reqn">EUE = sum(GPP)/sum(Rn)</code>
</p>

<p>where the sums are calculated for complete cases of GPP and Rn over
the entire time period.
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>EUE -</code></td>
<td>
<p>Energy use efficiency (-)</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+light.use.efficiency">light.use.efficiency</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>energy.use.efficiency(GPP=20,Rn=500)

</code></pre>

<hr>
<h2 id='equilibrium.imposed.ET'>Equilibrium and Imposed Evapotranspiration</h2><span id='topic+equilibrium.imposed.ET'></span>

<h3>Description</h3>

<p>Evapotranspiration (ET) split up into imposed ET and equilibrium ET.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>equilibrium.imposed.ET(
  data,
  Tair = "Tair",
  pressure = "pressure",
  VPD = "VPD",
  Gs = "Gs_ms",
  Rn = "Rn",
  G = NULL,
  S = NULL,
  missing.G.as.NA = FALSE,
  missing.S.as.NA = FALSE,
  Esat.formula = c("Sonntag_1990", "Alduchov_1996", "Allen_1998"),
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="equilibrium.imposed.ET_+3A_data">data</code></td>
<td>
<p>Data.frame or matrix containing all required input variables</p>
</td></tr>
<tr><td><code id="equilibrium.imposed.ET_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (deg C)</p>
</td></tr>
<tr><td><code id="equilibrium.imposed.ET_+3A_pressure">pressure</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
<tr><td><code id="equilibrium.imposed.ET_+3A_vpd">VPD</code></td>
<td>
<p>Air vapor pressure deficit (kPa)</p>
</td></tr>
<tr><td><code id="equilibrium.imposed.ET_+3A_gs">Gs</code></td>
<td>
<p>surface conductance to water vapor (m s-1)</p>
</td></tr>
<tr><td><code id="equilibrium.imposed.ET_+3A_rn">Rn</code></td>
<td>
<p>Net radiation (W m-2)</p>
</td></tr>
<tr><td><code id="equilibrium.imposed.ET_+3A_g">G</code></td>
<td>
<p>Ground heat flux (W m-2); optional</p>
</td></tr>
<tr><td><code id="equilibrium.imposed.ET_+3A_s">S</code></td>
<td>
<p>Sum of all storage fluxes (W m-2); optional</p>
</td></tr>
<tr><td><code id="equilibrium.imposed.ET_+3A_missing.g.as.na">missing.G.as.NA</code></td>
<td>
<p>if <code>TRUE</code>, missing G are treated as <code>NA</code>s, otherwise set to 0.</p>
</td></tr>
<tr><td><code id="equilibrium.imposed.ET_+3A_missing.s.as.na">missing.S.as.NA</code></td>
<td>
<p>if <code>TRUE</code>, missing S are treated as <code>NA</code>s, otherwise set to 0.</p>
</td></tr>
<tr><td><code id="equilibrium.imposed.ET_+3A_esat.formula">Esat.formula</code></td>
<td>
<p>Optional: formula to be used for the calculation of esat and the slope of esat.
One of <code>"Sonntag_1990"</code> (Default), <code>"Alduchov_1996"</code>, or <code>"Allen_1998"</code>.
See <code><a href="#topic+Esat.slope">Esat.slope</a></code>.</p>
</td></tr>
<tr><td><code id="equilibrium.imposed.ET_+3A_constants">constants</code></td>
<td>
<p>cp - specific heat of air for constant pressure (J K-1 kg-1) <br />
eps - ratio of the molecular weight of water vapor to dry air (-) <br />
Pa2kPa - conversion pascal (Pa) to kilopascal (kPa)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Total evapotranspiration can be written in the form (Jarvis &amp; McNaughton 1986):
</p>
<p style="text-align: center;"><code class="reqn">ET = \Omega ET_eq + (1 - \Omega)ET_imp</code>
</p>

<p>where <code class="reqn">\Omega</code> is the decoupling coefficient as calculated from
<code><a href="#topic+decoupling">decoupling</a></code>. <code>ET_eq</code> is the equilibrium evapotranspiration rate,
the ET rate that would occur under uncoupled conditions, where the heat budget
is dominated by radiation (when Ga -&gt; 0):
</p>
<p style="text-align: center;"><code class="reqn">ET_eq = (\Delta * (Rn - G - S) * \lambda) / (\Delta + \gamma)</code>
</p>

<p>where <code class="reqn">\Delta</code> is the slope of the saturation vapor pressure curve (kPa K-1),
<code class="reqn">\lambda</code> is the latent heat of vaporization (J kg-1), and <code class="reqn">\gamma</code>
is the psychrometric constant (kPa K-1).
<code>ET_imp</code> is the imposed evapotranspiration rate, the ET rate
that would occur under fully coupled conditions (when Ga -&gt; inf):
</p>
<p style="text-align: center;"><code class="reqn">ET_imp = (\rho * cp * VPD * Gs * \lambda) / \gamma</code>
</p>

<p>where <code class="reqn">\rho</code> is the air density (kg m-3).
</p>


<h3>Value</h3>

<p>A data.frame with the following columns:
</p>
<table role = "presentation">
<tr><td><code>ET_eq</code></td>
<td>
<p>Equilibrium ET (kg m-2 s-1)</p>
</td></tr>
<tr><td><code>ET_imp</code></td>
<td>
<p>Imposed ET (kg m-2 s-1)</p>
</td></tr>
<tr><td><code>LE_eq</code></td>
<td>
<p>Equilibrium LE (W m-2)</p>
</td></tr>
<tr><td><code>LE_imp</code></td>
<td>
<p>Imposed LE (W m-2)</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Surface conductance (Gs) can be calculated with <code><a href="#topic+surface.conductance">surface.conductance</a></code>.
Aerodynamic conductance (Ga) can be calculated using <code><a href="#topic+aerodynamic.conductance">aerodynamic.conductance</a></code>.
</p>


<h3>References</h3>

<p>Jarvis, P.G., McNaughton, K.G., 1986: Stomatal control of transpiration:
scaling up from leaf to region. Advances in Ecological Research 15, 1-49.
</p>
<p>Monteith, J.L., Unsworth, M.H., 2008: Principles of Environmental Physics.
3rd edition. Academic Press, London.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+decoupling">decoupling</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>df &lt;- data.frame(Tair=20,pressure=100,VPD=seq(0.5,4,0.5),
                 Gs_ms=seq(0.01,0.002,length.out=8),Rn=seq(50,400,50))            
equilibrium.imposed.ET(df)            
            
</code></pre>

<hr>
<h2 id='Esat.slope'>Saturation Vapor Pressure (Esat) and Slope of the Esat Curve</h2><span id='topic+Esat.slope'></span>

<h3>Description</h3>

<p>Calculates saturation vapor pressure (Esat) over water and the
corresponding slope of the saturation vapor pressure curve.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Esat.slope(
  Tair,
  formula = c("Sonntag_1990", "Alduchov_1996", "Allen_1998"),
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Esat.slope_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (deg C)</p>
</td></tr>
<tr><td><code id="Esat.slope_+3A_formula">formula</code></td>
<td>
<p>Formula to be used. Either <code>"Sonntag_1990"</code> (Default), 
<code>"Alduchov_1996"</code>, or <code>"Allen_1998"</code>.</p>
</td></tr>
<tr><td><code id="Esat.slope_+3A_constants">constants</code></td>
<td>
<p>Pa2kPa - conversion pascal (Pa) to kilopascal (kPa)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Esat (kPa) is calculated using the Magnus equation:
</p>
<p style="text-align: center;"><code class="reqn">Esat = a * exp((b * Tair) / (c + Tair)) / 1000</code>
</p>

<p>where the coefficients a, b, c take different values depending on the formula used.
The default values are from Sonntag 1990 (a=611.2, b=17.62, c=243.12). This version
of the Magnus equation is recommended by the WMO (WMO 2008; p1.4-29). Alternatively,
parameter values determined by Alduchov &amp; Eskridge 1996 or Allen et al. 1998 can be 
used (see references).
The slope of the Esat curve (<code class="reqn">\Delta</code>) is calculated as the first derivative of the function:
</p>
<p style="text-align: center;"><code class="reqn">\Delta = dEsat / dTair</code>
</p>

<p>which is solved using <code><a href="stats.html#topic+D">D</a></code>.
</p>


<h3>Value</h3>

<p>A dataframe with the following columns: 
</p>
<table role = "presentation">
<tr><td><code>Esat</code></td>
<td>
<p>Saturation vapor pressure (kPa)</p>
</td></tr>
<tr><td><code>Delta</code></td>
<td>
<p>Slope of the saturation vapor pressure curve (kPa K-1)</p>
</td></tr>
</table>


<h3>References</h3>

<p>Sonntag D. 1990: Important new values of the physical constants of 1986, vapor 
pressure formulations based on the ITS-90 and psychrometric formulae. 
Zeitschrift fuer Meteorologie 70, 340-344.
</p>
<p>World Meteorological Organization 2008: Guide to Meteorological Instruments
and Methods of Observation (WMO-No.8). World Meteorological Organization,
Geneva. 7th Edition.
</p>
<p>Alduchov, O. A. &amp; Eskridge, R. E., 1996: Improved Magnus form approximation of 
saturation vapor pressure. Journal of Applied Meteorology, 35, 601-609
</p>
<p>Allen, R.G., Pereira, L.S., Raes, D., Smith, M., 1998: Crop evapotranspiration -
Guidelines for computing crop water requirements - FAO irrigation and drainage
paper 56, FAO, Rome.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>Esat.slope(seq(0,45,5))[,"Esat"]  # Esat in kPa
Esat.slope(seq(0,45,5))[,"Delta"] # the corresponding slope of the Esat curve (Delta) in kPa K-1
       
</code></pre>

<hr>
<h2 id='extraterrestrial.radiation'>Extraterrestrial solar radiation</h2><span id='topic+extraterrestrial.radiation'></span>

<h3>Description</h3>

<p>Compute the extraterrestrial solar radiation with the
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extraterrestrial.radiation(doy, constants = bigleaf.constants())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="extraterrestrial.radiation_+3A_doy">doy</code></td>
<td>
<p>integer vector with day of year (DoY)</p>
</td></tr>
<tr><td><code id="extraterrestrial.radiation_+3A_constants">constants</code></td>
<td>
<p>solar_constant - solar constant (W m-2)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Computation follows Lanini, 2010 (Master thesis, Bern University)
</p>


<h3>Value</h3>

<p>numeric vector of extraterrestrial radiation (W_m-2)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>plot(1:365, extraterrestrial.radiation(1:365), type = "l"
  , ylab = "radiation (W m-2)", xlab = "day of year")
  
</code></pre>

<hr>
<h2 id='filter.data'>Basic Eddy Covariance Data Filtering</h2><span id='topic+filter.data'></span>

<h3>Description</h3>

<p>Filters time series of EC data for high-quality values and specified
meteorological conditions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>filter.data(
  data,
  quality.control = TRUE,
  filter.growseas = FALSE,
  filter.precip = FALSE,
  filter.vars = NULL,
  filter.vals.min,
  filter.vals.max,
  NA.as.invalid = TRUE,
  vars.qc = NULL,
  quality.ext = "_qc",
  good.quality = c(0, 1),
  missing.qc.as.bad = TRUE,
  GPP = "GPP",
  doy = "doy",
  year = "year",
  tGPP = 0.5,
  ws = 15,
  min.int = 5,
  precip = "precip",
  tprecip = 0.01,
  precip.hours = 24,
  records.per.hour = 2,
  filtered.data.to.NA = TRUE,
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="filter.data_+3A_data">data</code></td>
<td>
<p>Data.frame or matrix containing all required input variables in 
half-hourly or hourly resolution. Including year, month, day information</p>
</td></tr>
<tr><td><code id="filter.data_+3A_quality.control">quality.control</code></td>
<td>
<p>Should quality control be applied? Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="filter.data_+3A_filter.growseas">filter.growseas</code></td>
<td>
<p>Should data be filtered for growing season? Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="filter.data_+3A_filter.precip">filter.precip</code></td>
<td>
<p>Should precipitation filtering be applied? Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="filter.data_+3A_filter.vars">filter.vars</code></td>
<td>
<p>Additional variables to be filtered. Vector of type character.</p>
</td></tr>
<tr><td><code id="filter.data_+3A_filter.vals.min">filter.vals.min</code></td>
<td>
<p>Minimum values of the variables to be filtered. Numeric vector of 
the same length than <code>filter.vars</code>. Set to <code>NA</code> to be ignored.</p>
</td></tr>
<tr><td><code id="filter.data_+3A_filter.vals.max">filter.vals.max</code></td>
<td>
<p>Maximum values of the variables to be filtered. Numeric vector of 
the same length than <code>filter.vars</code>. Set to <code>NA</code> to be ignored.</p>
</td></tr>
<tr><td><code id="filter.data_+3A_na.as.invalid">NA.as.invalid</code></td>
<td>
<p>If <code>TRUE</code> (the default) missing data are filtered out (applies to all variables).</p>
</td></tr>
<tr><td><code id="filter.data_+3A_vars.qc">vars.qc</code></td>
<td>
<p>Character vector indicating the variables for which quality filter should 
be applied. Ignored if <code>quality.control = FALSE</code>.</p>
</td></tr>
<tr><td><code id="filter.data_+3A_quality.ext">quality.ext</code></td>
<td>
<p>The extension to the variables' names that marks them as 
quality control variables. Ignored if <code>quality.control = FALSE</code>.</p>
</td></tr>
<tr><td><code id="filter.data_+3A_good.quality">good.quality</code></td>
<td>
<p>Which values indicate good quality (i.e. not to be filtered) 
in the quality control (qc) variables? Ignored if <code>quality.control = FALSE</code>.</p>
</td></tr>
<tr><td><code id="filter.data_+3A_missing.qc.as.bad">missing.qc.as.bad</code></td>
<td>
<p>If quality control variable is <code>NA</code>, should the corresponding data point be
treated as bad quality? Defaults to <code>TRUE</code>. Ignored if <code>quality.control = FALSE</code>.</p>
</td></tr>
<tr><td><code id="filter.data_+3A_gpp">GPP</code></td>
<td>
<p>Gross primary productivity (umol m-2 s-1); Ignored if <code>filter.growseas = FALSE</code>.</p>
</td></tr>
<tr><td><code id="filter.data_+3A_doy">doy</code></td>
<td>
<p>Day of year; Ignored if <code>filter.growseas = FALSE</code>.</p>
</td></tr>
<tr><td><code id="filter.data_+3A_year">year</code></td>
<td>
<p>Year; Ignored if <code>filter.growseas = FALSE</code>.</p>
</td></tr>
<tr><td><code id="filter.data_+3A_tgpp">tGPP</code></td>
<td>
<p>GPP threshold (fraction of 95th percentile of the GPP time series).
Must be between 0 and 1. Ignored if <code>filter.growseas</code> is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="filter.data_+3A_ws">ws</code></td>
<td>
<p>Window size used for GPP time series smoothing. 
Ignored if <code>filter.growseas = FALSE</code>.</p>
</td></tr>
<tr><td><code id="filter.data_+3A_min.int">min.int</code></td>
<td>
<p>Minimum time interval in days for a given state of growing season.
Ignored if <code>filter.growseas = FALSE</code>.</p>
</td></tr>
<tr><td><code id="filter.data_+3A_precip">precip</code></td>
<td>
<p>Precipitation (mm time-1)</p>
</td></tr>
<tr><td><code id="filter.data_+3A_tprecip">tprecip</code></td>
<td>
<p>Precipitation threshold used to identify a precipitation event (mm). 
Ignored if <code>filter.precip = FALSE</code>.</p>
</td></tr>
<tr><td><code id="filter.data_+3A_precip.hours">precip.hours</code></td>
<td>
<p>Number of hours removed following a precipitation event (h).
Ignored if <code>filter.precip = FALSE</code>.</p>
</td></tr>
<tr><td><code id="filter.data_+3A_records.per.hour">records.per.hour</code></td>
<td>
<p>Number of observations per hour. I.e. 2 for half-hourly data.</p>
</td></tr>
<tr><td><code id="filter.data_+3A_filtered.data.to.na">filtered.data.to.NA</code></td>
<td>
<p>Logical. If <code>TRUE</code> (the default), all variables in the input
data.frame/matrix are set to <code>NA</code> for the time step where ANY of the
<code>filter.vars</code> were beyond their acceptable range (as
determined by <code>filter.vals.min</code> and <code>filter.vals.max</code>).
If <code>FALSE</code>, values are not filtered, and an additional column 'valid'
is added to the data.frame/matrix, indicating if any value of a row
did (1) or did not fulfill the filter criteria (0).</p>
</td></tr>
<tr><td><code id="filter.data_+3A_constants">constants</code></td>
<td>
<p>frac2percent - conversion between fraction and percent</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This routine consists of two parts:
</p>
<p>1) Quality control: All variables included in <code>vars.qc</code> are filtered for 
good quality data. For these variables a corresponding quality variable with 
the same name as the variable plus the extension as specified in <code>quality.ext</code>
must be provided. For time steps where the value of the quality indicator is not included
in the argument <code>good.quality</code>, i.e. the quality is not considered as 'good', 
its value is set to <code>NA</code>.
</p>
<p>2) Meteorological filtering. Under certain conditions (e.g. low ustar), the assumptions
of the EC method are not fulfilled. Further, some data analysis require certain meteorological
conditions, such as periods without rainfall, or active vegetation (growing season, daytime).
The filter applied in this second step serves to exclude time periods that do not fulfill the criteria
specified in the arguments. More specifically, time periods where one of the variables is higher
or lower than the specified thresholds (<code>filter.vals.min</code> and <code>filter.vals.max</code>)
are set to <code>NA</code> for all variables. If a threshold is set to <code>NA</code>, it will be ignored.
</p>


<h3>Value</h3>

<p>If <code>filtered.data.to.NA = TRUE</code> (default), the input data.frame/matrix with 
observations which did not fulfill the filter criteria set to <code>NA</code>. 
If <code>filtered.data.to.NA = FALSE</code>, the input data.frame/matrix with an additional 
column &quot;valid&quot;, which indicates whether all the data of a time step fulfill the 
filtering criteria (1) or not (0).
</p>


<h3>Note</h3>

<p>The thresholds set with <code>filter.vals.min</code> and <code>filter.vals.max</code> filter all data
that are smaller than (&quot;&lt;&quot;), or greater than (&quot;&gt;&quot;) the specified thresholds. That means
if a variable has exactly the same value as the threshold, it will not be filtered. Likewise,
<code>tprecip</code> filters all data that are greater than <code>tprecip</code>. 
</p>
<p>Variables considered of bad quality (as specified by the corresponding quality control variables)      
will be set to <code>NA</code> by this routine. Data that do not fulfill the filtering criteria are set to
<code>NA</code> if <code>filtered.data.to.NA = TRUE</code>. Note that with this option *all* variables of the same
time step are set to <code>NA</code>. Alternatively, if <code>filtered.data.to.NA = FALSE</code> data are not set to <code>NA</code>,
and a new column &quot;valid&quot; is added to the data.frame/matrix, indicating if any value of a row
did (1) or did not fulfill the filter criteria (0).
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Example of data filtering; data are for a month within the growing season,
# hence growing season is not filtered.
# If filtered.data.to.NA=TRUE, all values of a row are set to NA if one filter
# variable is beyond its bounds. 
DE_Tha_Jun_2014_2 &lt;- filter.data(DE_Tha_Jun_2014,quality.control=FALSE,
                                 vars.qc=c("Tair","precip","H","LE"),
                                 filter.growseas=FALSE,filter.precip=TRUE,
                                 filter.vars=c("Tair","PPFD","ustar"),
                                 filter.vals.min=c(5,200,0.2),
                                 filter.vals.max=c(NA,NA,NA),NA.as.invalid=TRUE,
                                 quality.ext="_qc",good.quality=c(0,1),
                                 missing.qc.as.bad=TRUE,GPP="GPP",doy="doy",
                                 year="year",tGPP=0.5,ws=15,min.int=5,precip="precip",
                                 tprecip=0.1,precip.hours=24,records.per.hour=2,
                                 filtered.data.to.NA=TRUE)

 ## same, but with filtered.data.to.NA=FALSE
 DE_Tha_Jun_2014_3 &lt;- filter.data(DE_Tha_Jun_2014,quality.control=FALSE,
                                 vars.qc=c("Tair","precip","H","LE"),
                                 filter.growseas=FALSE,filter.precip=TRUE,
                                 filter.vars=c("Tair","PPFD","ustar"),
                                 filter.vals.min=c(5,200,0.2),
                                 filter.vals.max=c(NA,NA,NA),NA.as.invalid=TRUE,
                                 quality.ext="_qc",good.quality=c(0,1),
                                 missing.qc.as.bad=TRUE,GPP="GPP",doy="doy",
                                 year="year",tGPP=0.5,ws=15,min.int=5,precip="precip",
                                 tprecip=0.1,precip.hours=24,records.per.hour=2,
                                 filtered.data.to.NA=FALSE)
                                 
 # note the additional column 'valid' in DE_Tha_Jun_2014_3.
 # To remove time steps marked as filtered out (i.e. 0 values in column 'valid'):
 DE_Tha_Jun_2014_3[DE_Tha_Jun_2014_3["valid"] == 0,] &lt;- NA
  
  
</code></pre>

<hr>
<h2 id='filter.growing.season'>GPP-based Growing Season Filter</h2><span id='topic+filter.growing.season'></span>

<h3>Description</h3>

<p>Filters annual time series for growing season based on smoothed daily GPP data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>filter.growing.season(GPPd, tGPP, ws = 15, min.int = 5)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="filter.growing.season_+3A_gppd">GPPd</code></td>
<td>
<p>daily GPP (any unit)</p>
</td></tr>
<tr><td><code id="filter.growing.season_+3A_tgpp">tGPP</code></td>
<td>
<p>GPP threshold (fraction of 95th percentile of the GPP time series).
Takes values between 0 and 1.</p>
</td></tr>
<tr><td><code id="filter.growing.season_+3A_ws">ws</code></td>
<td>
<p>window size used for GPP time series smoothing</p>
</td></tr>
<tr><td><code id="filter.growing.season_+3A_min.int">min.int</code></td>
<td>
<p>minimum time interval in days for a given state of growing season</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The basic idea behind the growing season filter is that vegetation is 
considered to be active when its carbon uptake (GPP) is above a specified 
threshold, which is defined relative to the peak GPP (95th percentile) 
observed in the year. 
The GPP-threshold is calculated as:
</p>
<p style="text-align: center;"><code class="reqn">GPP_threshold = quantile(GPPd,0.95)*tGPP</code>
</p>

<p>GPPd time series are smoothed with a moving average to avoid fluctuations 
in the delineation of the growing season. The window size defaults to 15 
days, but depending on the ecosystem, other values can be appropriate. 
</p>
<p>The argument <code>min.int</code> serves to avoid short fluctuations in the 
status growing season vs. no growing season by defining a minimum length
of the status. If a time interval shorter than <code>min.int</code> is labeled
as growing season or non-growing season, it is changed to the status of 
the neighboring values.
</p>


<h3>Value</h3>

<p>a vector of type integer of the same length as the input GPPd in which 0 indicate
no growing season (dormant season) and 1 indicate growing season.
</p>

<hr>
<h2 id='FR_Pue_May_2012'>Eddy Covariance Data of FR-Pue (Puechabon)</h2><span id='topic+FR_Pue_May_2012'></span>

<h3>Description</h3>

<p>Halfhourly eddy covariance Data of the site FR-Pue,
a Mediterranean evergreen oak forest in Southern France
(<a href="https://sites.fluxdata.org/FR-Pue/">https://sites.fluxdata.org/FR-Pue/</a>).
Data are from May 2012.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>FR_Pue_May_2012
</code></pre>


<h3>Format</h3>

<p>A data frame with 1488 observations and 29 columns:
</p>

<dl>
<dt>year</dt><dd><p>year of measurement</p>
</dd>
<dt>month</dt><dd><p>month of measurement</p>
</dd>
<dt>doy</dt><dd><p>day of year</p>
</dd>
<dt>hour</dt><dd><p>hour (0 - 23.5)</p>
</dd>
<dt>Tair</dt><dd><p>Air temperature (degC) [TA_F]</p>
</dd>
<dt>Tair_qc</dt><dd><p>Quality control of <code>Tair</code> [TA_F_QC]</p>
</dd>
<dt>PPFD</dt><dd><p>Photosynthetic photon flux density (umol m-2 s-1) [PPFD_IN]</p>
</dd>
<dt>PPFD_qc</dt><dd><p>Quality control of <code>PPFD</code> [PPFD_IN_QC]</p>
</dd>
<dt>VPD</dt><dd><p>Vapor pressure deficit (kPa) [VPD_F]</p>
</dd>
<dt>VPD_qc</dt><dd><p>Quality control of <code>VPD</code> [VPD_F_QC]</p>
</dd>
<dt>pressure</dt><dd><p>Atmospheric pressure (kPa) [PA_F]</p>
</dd>
<dt>precip</dt><dd><p>precipitation (mm) [P_F]</p>
</dd>
<dt>precip_qc</dt><dd><p>Quality control of <code>precip</code> [P_F_QC]</p>
</dd>
<dt>ustar</dt><dd><p>friction velocity (m s-1) [USTAR]</p>
</dd>
<dt>wind</dt><dd><p>horizontal wind velocity (m s-1) [WS_F]</p>
</dd>
<dt>wind_qc</dt><dd><p>Quality control of <code>wind</code> [WS_F_QC]</p>
</dd>
<dt>Ca</dt><dd><p>CO2 concentration (ppm) [CO2_F_MDS]</p>
</dd>
<dt>Ca_qc</dt><dd><p>Quality control of <code>Ca</code> [CO2_F_MDS_QC]</p>
</dd>
<dt>LW_up</dt><dd><p>upward longwave radiation (W m-2) [LW_OUT]</p>
</dd>
<dt>Rn</dt><dd><p>Net radiation (W m-2) [NETRAD]</p>
</dd>
<dt>LE</dt><dd><p>Latent heat flux (W m-2) [LE_F_MDS]</p>
</dd>
<dt>LE_qc</dt><dd><p>Quality control of <code>LE</code> [LE_F_MDS_QC]</p>
</dd>
<dt>H</dt><dd><p>Sensible heat flux (W m-2) [H_F_MDS]</p>
</dd>
<dt>H_qc</dt><dd><p>Quality control of <code>H</code> [H_F_MDS_QC]</p>
</dd>
<dt>NEE</dt><dd><p>Net ecosystem exchange (umol m-2 s-1) [NEE_VUT_USTAR50]</p>
</dd>
<dt>NEE_qc</dt><dd><p>Quality control of <code>NEE</code> [NEE_VUT_USTAR50_QC]</p>
</dd>
<dt>GPP</dt><dd><p>Gross primary productivity from nighttime partitioning (umol m-2 s-1) [GPP_NT_VUT_USTAR50]</p>
</dd>
<dt>GPP_qc</dt><dd><p>Quality control of <code>GPP</code> [NEE_VUT_USTAR50_QC]</p>
</dd>
<dt>Reco</dt><dd><p>Ecosystem respiration from nighttime partitioning (umol m-2 s-1) [RECO_NT_VUT_USTAR50]</p>
</dd>
</dl>



<h3>Note</h3>

<p>The original variable names as provided by the FLUXNET2015 dataset are 
given in squared brackets. Note that variable units have been converted
in some cases (e.g. VPD from hPa to kPa).
</p>


<h3>Source</h3>

<p>original data were downloaded from
<a href="https://fluxnet.org/">https://fluxnet.org/</a> (accessed 09 November 2016)
</p>

<hr>
<h2 id='Gb.Choudhury'>Boundary Layer Conductance according to Choudhury &amp; Monteith 1988</h2><span id='topic+Gb.Choudhury'></span>

<h3>Description</h3>

<p>A formulation for the canopy boundary layer conductance 
for heat transfer according to Choudhury &amp; Monteith 1988.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Gb.Choudhury(
  data,
  Tair = "Tair",
  pressure = "pressure",
  wind = "wind",
  ustar = "ustar",
  H = "H",
  leafwidth,
  LAI,
  zh,
  zr,
  d,
  z0m = NULL,
  stab_formulation = c("Dyer_1970", "Businger_1971"),
  Sc = NULL,
  Sc_name = NULL,
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Gb.Choudhury_+3A_data">data</code></td>
<td>
<p>Data.frame or matrix containing all required variables</p>
</td></tr>
<tr><td><code id="Gb.Choudhury_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (degC)</p>
</td></tr>
<tr><td><code id="Gb.Choudhury_+3A_pressure">pressure</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
<tr><td><code id="Gb.Choudhury_+3A_wind">wind</code></td>
<td>
<p>Wind speed at sensor height (m s-1)</p>
</td></tr>
<tr><td><code id="Gb.Choudhury_+3A_ustar">ustar</code></td>
<td>
<p>Friction velocity (m s-1)</p>
</td></tr>
<tr><td><code id="Gb.Choudhury_+3A_h">H</code></td>
<td>
<p>Sensible heat flux (W m-2)</p>
</td></tr>
<tr><td><code id="Gb.Choudhury_+3A_leafwidth">leafwidth</code></td>
<td>
<p>Leaf width (m)</p>
</td></tr>
<tr><td><code id="Gb.Choudhury_+3A_lai">LAI</code></td>
<td>
<p>One-sided leaf area index</p>
</td></tr>
<tr><td><code id="Gb.Choudhury_+3A_zh">zh</code></td>
<td>
<p>Canopy height (m)</p>
</td></tr>
<tr><td><code id="Gb.Choudhury_+3A_zr">zr</code></td>
<td>
<p>Instrument (reference) height (m)</p>
</td></tr>
<tr><td><code id="Gb.Choudhury_+3A_d">d</code></td>
<td>
<p>Zero-plane displacement height (-), can be calculated using <code>roughness.parameters</code></p>
</td></tr>
<tr><td><code id="Gb.Choudhury_+3A_z0m">z0m</code></td>
<td>
<p>Roughness length for momentum (m). If not provided, calculated from <code>roughness.parameters</code> 
within <code>wind.profile</code></p>
</td></tr>
<tr><td><code id="Gb.Choudhury_+3A_stab_formulation">stab_formulation</code></td>
<td>
<p>Stability correction function used (If <code>stab_correction = TRUE</code>).
Either <code>"Dyer_1970"</code> or <code>"Businger_1971"</code>.</p>
</td></tr>
<tr><td><code id="Gb.Choudhury_+3A_sc">Sc</code></td>
<td>
<p>Optional: Schmidt number of additional quantities to be calculated</p>
</td></tr>
<tr><td><code id="Gb.Choudhury_+3A_sc_name">Sc_name</code></td>
<td>
<p>Optional: Name of the additonal quantities, has to be of same length than 
<code>Sc_name</code></p>
</td></tr>
<tr><td><code id="Gb.Choudhury_+3A_constants">constants</code></td>
<td>
<p>k - von-Karman constant <br />
Sc_CO2 - Schmidt number for CO2 <br /> 
Pr - Prandtl number (if <code>Sc</code> is provided)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Boundary layer conductance according to Choudhury &amp; Monteith 1988 is
given by:
</p>
<p style="text-align: center;"><code class="reqn">Gb_h = LAI((2a/\alpha)*sqrt(u(h)/w)*(1-exp(-\alpha/2)))</code>
</p>

<p>where u(zh) is the wind speed at the canopy surface, approximated from
measured wind speed at sensor height zr and a wind extinction coefficient <code class="reqn">\alpha</code>:
</p>
<p style="text-align: center;"><code class="reqn">u(zh) = u(zr) / (exp(\alpha(zr/zh -1)))</code>
</p>
<p>.
</p>
<p><code class="reqn">\alpha</code> is modeled as an empirical relation to LAI (McNaughton &amp; van den Hurk 1995):
</p>
<p style="text-align: center;"><code class="reqn">\alpha = 4.39 - 3.97*exp(-0.258*LAI)</code>
</p>

<p>Gb (=1/Rb) for water vapor and heat are assumed to be equal in this package.
Gb for other quantities x is calculated as (Hicks et al. 1987):
</p>
<p style="text-align: center;"><code class="reqn">Gb_x = Gb / (Sc_x / Pr)^0.67</code>
</p>

<p>where Sc_x is the Schmidt number of quantity x, and Pr is the Prandtl number (0.71).
</p>


<h3>Value</h3>

<p>A data frame with the following columns:
</p>
<table role = "presentation">
<tr><td><code>Gb_h</code></td>
<td>
<p>Boundary layer conductance for heat transfer (m s-1)</p>
</td></tr>
<tr><td><code>Rb_h</code></td>
<td>
<p>Boundary layer resistance for heat transfer (s m-1)</p>
</td></tr>
<tr><td><code>kB_h</code></td>
<td>
<p>kB-1 parameter for heat transfer</p>
</td></tr>
<tr><td><code>Gb_Sc_name</code></td>
<td>
<p>Boundary layer conductance for <code>Sc_name</code> (m s-1). Only added if <code>Sc_name</code> and 
<code>Sc_name</code> are provided</p>
</td></tr>
</table>


<h3>Note</h3>

<p>If the roughness length for momentum (<code>z0m</code>) is not provided as input, it is estimated 
from the function <code>roughness.parameters</code> within <code>wind.profile</code>. This function
estimates a single <code>z0m</code> value for the entire time period! If a varying <code>z0m</code> value 
(e.g. across seasons or years) is required, <code>z0m</code> should be provided as input argument.
</p>


<h3>References</h3>

<p>Choudhury, B. J., Monteith J.L., 1988: A four-layer model for the heat
budget of homogeneous land surfaces. Q. J. R. Meteorol. Soc. 114, 373-398.
</p>
<p>McNaughton, K. G., Van den Hurk, B.J.J.M., 1995: A 'Lagrangian' revision of
the resistors in the two-layer model for calculating the energy budget of a
plant canopy. Boundary-Layer Meteorology 74, 261-288.
</p>
<p>Hicks, B.B., Baldocchi, D.D., Meyers, T.P., Hosker, J.R., Matt, D.R., 1987:
A preliminary multiple resistance routine for deriving dry deposition velocities
from measured quantities. Water, Air, and Soil Pollution 36, 311-330.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Gb.Thom">Gb.Thom</a></code>, <code><a href="#topic+Gb.Su">Gb.Su</a></code>, <code><a href="#topic+aerodynamic.conductance">aerodynamic.conductance</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## bulk canopy boundary layer resistance for a closed canopy (LAI=5) 
## with large leaves (leafwdith=0.1)            
df &lt;- data.frame(Tair=25,pressure=100,wind=c(3,4,5),ustar=c(0.5,0.6,0.65),H=c(200,230,250))    
Gb.Choudhury(data=df,leafwidth=0.1,LAI=5,zh=25,d=17.5,zr=40)

## same conditions, but smaller leaves (leafwidth=0.01)
Gb.Choudhury(data=df,leafwidth=0.01,LAI=5,zh=25,d=17.5,zr=40) 

</code></pre>

<hr>
<h2 id='Gb.Su'>Boundary Layer Conductance according to Su et al. 2001</h2><span id='topic+Gb.Su'></span>

<h3>Description</h3>

<p>A physically based formulation for the canopy boundary layer conductance
to heat transfer according to Su et al. 2001.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Gb.Su(
  data,
  Tair = "Tair",
  pressure = "pressure",
  ustar = "ustar",
  wind = "wind",
  H = "H",
  zh,
  zr,
  d,
  z0m = NULL,
  Dl,
  fc = NULL,
  LAI = NULL,
  N = 2,
  Cd = 0.2,
  hs = 0.01,
  stab_formulation = c("Dyer_1970", "Businger_1971"),
  Sc = NULL,
  Sc_name = NULL,
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Gb.Su_+3A_data">data</code></td>
<td>
<p>Data.frame or matrix containing all required variables</p>
</td></tr>
<tr><td><code id="Gb.Su_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (degC)</p>
</td></tr>
<tr><td><code id="Gb.Su_+3A_pressure">pressure</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
<tr><td><code id="Gb.Su_+3A_ustar">ustar</code></td>
<td>
<p>Friction velocity (m s-1)</p>
</td></tr>
<tr><td><code id="Gb.Su_+3A_wind">wind</code></td>
<td>
<p>Wind speed (m s-1)</p>
</td></tr>
<tr><td><code id="Gb.Su_+3A_h">H</code></td>
<td>
<p>Sensible heat flux (W m-2)</p>
</td></tr>
<tr><td><code id="Gb.Su_+3A_zh">zh</code></td>
<td>
<p>Canopy height (m)</p>
</td></tr>
<tr><td><code id="Gb.Su_+3A_zr">zr</code></td>
<td>
<p>Reference height (m)</p>
</td></tr>
<tr><td><code id="Gb.Su_+3A_d">d</code></td>
<td>
<p>Zero-plane displacement height (-), can be calculated using <code>roughness.parameters</code></p>
</td></tr>
<tr><td><code id="Gb.Su_+3A_z0m">z0m</code></td>
<td>
<p>Roughness length for momentum (m). If not provided, calculated from <code>roughness.parameters</code> 
within <code>wind.profile</code></p>
</td></tr>
<tr><td><code id="Gb.Su_+3A_dl">Dl</code></td>
<td>
<p>Leaf characteristic dimension (m)</p>
</td></tr>
<tr><td><code id="Gb.Su_+3A_fc">fc</code></td>
<td>
<p>Fractional vegetation cover [0-1] (if not provided, calculated from LAI)</p>
</td></tr>
<tr><td><code id="Gb.Su_+3A_lai">LAI</code></td>
<td>
<p>One-sided leaf area index (-)</p>
</td></tr>
<tr><td><code id="Gb.Su_+3A_n">N</code></td>
<td>
<p>Number of leaf sides participating in heat exchange (defaults to 2)</p>
</td></tr>
<tr><td><code id="Gb.Su_+3A_cd">Cd</code></td>
<td>
<p>Foliage drag coefficient (-)</p>
</td></tr>
<tr><td><code id="Gb.Su_+3A_hs">hs</code></td>
<td>
<p>Roughness height of the soil (m)</p>
</td></tr>
<tr><td><code id="Gb.Su_+3A_stab_formulation">stab_formulation</code></td>
<td>
<p>Stability correction function used (If <code>stab_correction = TRUE</code>).
Either <code>"Dyer_1970"</code> or <code>"Businger_1971"</code>.</p>
</td></tr>
<tr><td><code id="Gb.Su_+3A_sc">Sc</code></td>
<td>
<p>Optional: Schmidt number of additional quantities to be calculated</p>
</td></tr>
<tr><td><code id="Gb.Su_+3A_sc_name">Sc_name</code></td>
<td>
<p>Optional: Name of the additional quantities, has to be of same length than 
<code>Sc_name</code></p>
</td></tr>
<tr><td><code id="Gb.Su_+3A_constants">constants</code></td>
<td>
<p>Kelvin - conversion degree Celsius to Kelvin <br />
pressure0 - reference atmospheric pressure at sea level (Pa) <br />
Tair0 - reference air temperature (K) <br />
Sc_CO2 - Schmidt number for CO2 <br /> 
Pr - Prandtl number (if <code>Sc</code> is provided)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The formulation is based on the kB-1 model developed by Massman 1999. 
Su et al. 2001 derived the following approximation:
</p>
<p style="text-align: center;"><code class="reqn">kB-1 = (k Cd fc^2) / (4Ct ustar/u(zh)) + kBs-1(1 - fc)^2</code>
</p>

<p>If fc (fractional vegetation cover) is missing, it is estimated from LAI:
</p>
<p style="text-align: center;"><code class="reqn">fc = 1 - exp(-LAI/2)</code>
</p>

<p>The wind speed at the top of the canopy is calculated using function
<code><a href="#topic+wind.profile">wind.profile</a></code>.
</p>
<p>Ct is the heat transfer coefficient of the leaf (Massman 1999):
</p>
<p style="text-align: center;"><code class="reqn">Ct = Pr^-2/3 Reh^-1/2 N</code>
</p>

<p>where Pr is the Prandtl number (set to 0.71), and Reh is the Reynolds number for leaves:
</p>
<p style="text-align: center;"><code class="reqn">Reh = Dl wind(zh) / v</code>
</p>

<p>kBs-1, the kB-1 value for bare soil surface, is calculated according 
to Su et al. 2001:
</p>
<p style="text-align: center;"><code class="reqn">kBs^-1 = 2.46(Re)^0.25 - ln(7.4)</code>
</p>

<p>Gb (=1/Rb) for water vapor and heat are assumed to be equal in this package.
Gb for other quantities x is calculated as (Hicks et al. 1987):
</p>
<p style="text-align: center;"><code class="reqn">Gb_x = Gb / (Sc_x / Pr)^0.67</code>
</p>

<p>where Sc_x is the Schmidt number of quantity x, and Pr is the Prandtl number (0.71).
</p>


<h3>Value</h3>

<p>A data.frame with the following columns:
</p>
<table role = "presentation">
<tr><td><code>Gb_h</code></td>
<td>
<p>Boundary layer conductance for heat transfer (m s-1)</p>
</td></tr>
<tr><td><code>Rb_h</code></td>
<td>
<p>Boundary layer resistance for heat transfer (s m-1)</p>
</td></tr>
<tr><td><code>kB_h</code></td>
<td>
<p>kB-1 parameter for heat transfer</p>
</td></tr>
<tr><td><code>Gb_Sc_name</code></td>
<td>
<p>Boundary layer conductance for <code>Sc_name</code> (m s-1). Only added if <code>Sc_name</code> and 
<code>Sc_name</code> are provided</p>
</td></tr>
</table>


<h3>Note</h3>

<p>If the roughness length for momentum (<code>z0m</code>) is not provided as input, it is estimated 
from the function <code>roughness.parameters</code> within <code>wind.profile</code>. This function
estimates a single <code>z0m</code> value for the entire time period! If a varying <code>z0m</code> value 
(e.g. across seasons or years) is required, <code>z0m</code> should be provided as input argument.
</p>


<h3>References</h3>

<p>Su, Z., Schmugge, T., Kustas, W. &amp; Massman, W., 2001: An evaluation of
two models for estimation of the roughness height for heat transfer between
the land surface and the atmosphere. Journal of Applied Meteorology 40, 1933-1951.
</p>
<p>Massman, W., 1999: A model study of kB H- 1 for vegetated surfaces using
'localized near-field' Lagrangian theory. Journal of Hydrology 223, 27-43.
</p>
<p>Hicks, B.B., Baldocchi, D.D., Meyers, T.P., Hosker, J.R., Matt, D.R., 1987:
A preliminary multiple resistance routine for deriving dry deposition velocities
from measured quantities. Water, Air, and Soil Pollution 36, 311-330.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Gb.Thom">Gb.Thom</a></code>, <code><a href="#topic+Gb.Choudhury">Gb.Choudhury</a></code>, <code><a href="#topic+aerodynamic.conductance">aerodynamic.conductance</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Canopy boundary layer resistance (and kB-1 parameter) for a set of meteorological conditions,
# a leaf characteristic dimension of 1cm, and an LAI of 5
df &lt;- data.frame(Tair=25,pressure=100,wind=c(3,4,5),ustar=c(0.5,0.6,0.65),H=c(200,230,250)) 
Gb.Su(data=df,zh=25,zr=40,d=17.5,Dl=0.01,LAI=5)

# the same meteorological conditions, but larger leaves
Gb.Su(data=df,zh=25,zr=40,d=17.5,Dl=0.1,LAI=5)

# same conditions, large leaves, and sparse canopy cover (LAI = 1.5)
Gb.Su(data=df,zh=25,zr=40,d=17.5,Dl=0.1,LAI=1.5)

</code></pre>

<hr>
<h2 id='Gb.Thom'>Boundary Layer Conductance according to Thom 1972</h2><span id='topic+Gb.Thom'></span>

<h3>Description</h3>

<p>An empirical formulation for the canopy boundary layer conductance 
for heat transfer based on a simple ustar dependency.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Gb.Thom(ustar, Sc = NULL, Sc_name = NULL, constants = bigleaf.constants())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Gb.Thom_+3A_ustar">ustar</code></td>
<td>
<p>Friction velocity (m s-1)</p>
</td></tr>
<tr><td><code id="Gb.Thom_+3A_sc">Sc</code></td>
<td>
<p>Optional: Schmidt number of additional quantities to be calculated</p>
</td></tr>
<tr><td><code id="Gb.Thom_+3A_sc_name">Sc_name</code></td>
<td>
<p>Optional: Name of the additional quantities, has to be of same length than 
<code>Sc_name</code></p>
</td></tr>
<tr><td><code id="Gb.Thom_+3A_constants">constants</code></td>
<td>
<p>k - von-Karman constant <br />
Sc_CO2 - Schmidt number for CO2 <br /> 
Pr - Prandtl number (if <code>Sc</code> is provided)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The empirical equation for Rb suggested by Thom 1972 is:
</p>
<p style="text-align: center;"><code class="reqn">Rb = 6.2ustar^-0.67</code>
</p>

<p>Gb (=1/Rb) for water vapor and heat are assumed to be equal in this package.
Gb for other quantities x is calculated as (Hicks et al. 1987):
</p>
<p style="text-align: center;"><code class="reqn">Gb_x = Gb / (Sc_x / Pr)^0.67</code>
</p>

<p>where Sc_x is the Schmidt number of quantity x, and Pr is the Prandtl number (0.71).
</p>


<h3>Value</h3>

<p>a data.frame with the following columns:
</p>
<table role = "presentation">
<tr><td><code>Gb_h</code></td>
<td>
<p>Boundary layer conductance for heat transfer (m s-1)</p>
</td></tr>
<tr><td><code>Rb_h</code></td>
<td>
<p>Boundary layer resistance for heat transfer (s m-1)</p>
</td></tr>
<tr><td><code>kB_h</code></td>
<td>
<p>kB-1 parameter for heat transfer</p>
</td></tr>
<tr><td><code>Gb_Sc_name</code></td>
<td>
<p>Boundary layer conductance for <code>Sc_name</code> (m s-1). Only added if <code>Sc_name</code> and 
<code>Sc_name</code> are provided</p>
</td></tr>
</table>


<h3>References</h3>

<p>Thom, A., 1972: Momentum, mass and heat exchange of vegetation.
Quarterly Journal of the Royal Meteorological Society 98, 124-134.
</p>
<p>Hicks, B.B., Baldocchi, D.D., Meyers, T.P., Hosker, J.R., Matt, D.R., 1987:
A preliminary multiple resistance routine for deriving dry deposition velocities
from measured quantities. Water, Air, and Soil Pollution 36, 311-330.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Gb.Choudhury">Gb.Choudhury</a></code>, <code><a href="#topic+Gb.Su">Gb.Su</a></code>, <code><a href="#topic+aerodynamic.conductance">aerodynamic.conductance</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>Gb.Thom(seq(0.1,1.4,0.1))

## calculate Gb for SO2 as well
Gb.Thom(seq(0.1,1.4,0.1),Sc=1.25,Sc_name="SO2")

</code></pre>

<hr>
<h2 id='intercellular.CO2'>Bulk Intercellular CO2 Concentration</h2><span id='topic+intercellular.CO2'></span>

<h3>Description</h3>

<p>Bulk canopy intercellular CO2 concentration (Ci) calculated based on Fick's law
given surface conductance (Gs), gross primary productivity (GPP) and 
atmospheric CO2 concentration (Ca).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>intercellular.CO2(
  data,
  Ca = "Ca",
  GPP = "GPP",
  Gs = "Gs_mol",
  Rleaf = NULL,
  missing.Rleaf.as.NA = FALSE,
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="intercellular.CO2_+3A_data">data</code></td>
<td>
<p>Data.Frame or matrix with all required columns</p>
</td></tr>
<tr><td><code id="intercellular.CO2_+3A_ca">Ca</code></td>
<td>
<p>Atmospheric or surface CO2 concentration (umol mol-1)</p>
</td></tr>
<tr><td><code id="intercellular.CO2_+3A_gpp">GPP</code></td>
<td>
<p>Gross primary productivity (umol CO2 m-2 s-1)</p>
</td></tr>
<tr><td><code id="intercellular.CO2_+3A_gs">Gs</code></td>
<td>
<p>Surface conductance to water vapor (mol m-2 s-1)</p>
</td></tr>
<tr><td><code id="intercellular.CO2_+3A_rleaf">Rleaf</code></td>
<td>
<p>Ecosystem respiration stemming from leaves (umol CO2 m-2 s-1); defaults to 0</p>
</td></tr>
<tr><td><code id="intercellular.CO2_+3A_missing.rleaf.as.na">missing.Rleaf.as.NA</code></td>
<td>
<p>if Rleaf is provided, should missing values be treated as <code>NA</code> (<code>TRUE</code>)
or set to 0 (<code>FALSE</code>, the default)?</p>
</td></tr>
<tr><td><code id="intercellular.CO2_+3A_constants">constants</code></td>
<td>
<p>DwDc - Ratio of the molecular diffusivities for water vapor and CO2 (-)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Bulk intercellular CO2 concentration (Ci) is given by:
</p>
<p style="text-align: center;"><code class="reqn">Ci = Ca - (GPP - Rleaf)/(Gs/1.6)</code>
</p>

<p>where Gs/1.6 (mol m-2 s-1) represents the surface conductance to CO2.
Note that Gs is required in mol m-2 s-1 for water vapor. Gs is converted to
its value for CO2 internally.
Ca can either be atmospheric CO2 concentration (as measured), or surface
CO2 concentration as calculated from <code><a href="#topic+surface.CO2">surface.CO2</a></code>.
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>Ci -</code></td>
<td>
<p>Bulk canopy intercellular CO2 concentration (umol mol-1)</p>
</td></tr>
</table>


<h3>Note</h3>

<p>The equation is based on Fick's law of diffusion and is equivalent to the
often used equation at leaf level (ci = ca - An/gs).
Note that GPP and Gs have a different interpretation than An and gs.
Gs comprises non-physiological contributions (i.e. physical evaporation)
and is confounded by physical factors (e.g. energy balance non-closure).
GPP does not account for dark respiration and is further subject to uncertainties
in the NEE partitioning algorithm used. Leaf respiration can be provided,
but it is usually not known at ecosystem level (as a consequence, Ci is likely to be 
slightly underestimated)
This function should be used with care and the resulting Ci might not be
readily comparable to its leaf-level analogue and/or physiological meaningful.
</p>


<h3>References</h3>

<p>Kosugi Y. et al., 2013: Determination of the gas exchange phenology in an
evergreen coniferous forest from 7 years of eddy covariance flux data using
an extended big-leaf analysis. Ecol Res 28, 373-385.
</p>
<p>Keenan T., Sabate S., Gracia C., 2010: The importance of mesophyll conductance in
regulating forest ecosystem productivity during drought periods. Global Change Biology
16, 1019-1034.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># calculate bulk canopy Ci of a productive ecosystem
intercellular.CO2(Ca=400,GPP=40,Gs=0.7)
 
# note the sign convention for NEE

</code></pre>

<hr>
<h2 id='isothermal.Rn'>Isothermal Net Radiation</h2><span id='topic+isothermal.Rn'></span>

<h3>Description</h3>

<p>Calculates the isothermal net radiation, i.e. the net radiation 
that the surface would receive if it had the same temperature than
the air.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>isothermal.Rn(
  data,
  Rn = "Rn",
  Tair = "Tair",
  Tsurf = "Tsurf",
  emissivity,
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="isothermal.Rn_+3A_data">data</code></td>
<td>
<p>Data.frame or matrix containing all required variables</p>
</td></tr>
<tr><td><code id="isothermal.Rn_+3A_rn">Rn</code></td>
<td>
<p>Net radiation (W m-2)</p>
</td></tr>
<tr><td><code id="isothermal.Rn_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (degC)</p>
</td></tr>
<tr><td><code id="isothermal.Rn_+3A_tsurf">Tsurf</code></td>
<td>
<p>Surface temperature (degC)</p>
</td></tr>
<tr><td><code id="isothermal.Rn_+3A_emissivity">emissivity</code></td>
<td>
<p>Emissivity of the surface (-)</p>
</td></tr>
<tr><td><code id="isothermal.Rn_+3A_constants">constants</code></td>
<td>
<p>sigma - Stefan-Boltzmann constant (W m-2 K-4) <br />
Kelvin - conversion degree Celsius to Kelvin</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The isothermal net radiation (Rni) is given by:
</p>
<p style="text-align: center;"><code class="reqn">Rni = Rn + \epsilon * \sigma * (Tsurf^4 - Tair^4)</code>
</p>

<p>where <code class="reqn">\epsilon</code> is the emissivity of the surface. Tsurf and Tair
are in Kelvin.
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>Rni -</code></td>
<td>
<p>isothermal net radiation (W m-2)</p>
</td></tr>
</table>


<h3>References</h3>

<p>Jones, H. 2014: Plants and Microclimate. 3rd edition, Cambridge
University Press.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># calculate isothermal net radiation of a surface that is 2degC warmer than the air.
isothermal.Rn(Rn=400,Tair=25,Tsurf=27,emissivity=0.98) 

</code></pre>

<hr>
<h2 id='kg.to.mol'>Conversion between Mass and Molar Units</h2><span id='topic+kg.to.mol'></span>

<h3>Description</h3>

<p>Converts mass units of a substance to the corresponding molar units
and vice versa.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>kg.to.mol(mass, molarMass = bigleaf.constants()$H2Omol)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="kg.to.mol_+3A_mass">mass</code></td>
<td>
<p>Numeric vector of mass in kg</p>
</td></tr>
<tr><td><code id="kg.to.mol_+3A_molarmass">molarMass</code></td>
<td>
<p>Numeric vector of molar mass of the substance (kg mol-1)
e.g. as provided by <code><a href="#topic+bigleaf.constants">bigleaf.constants</a></code>()$H2Omol
Default is molar mass of Water.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Numeric vector of amount of substance in mol.
</p>

<hr>
<h2 id='kinematic.viscosity'>Kinematic Viscosity of Air</h2><span id='topic+kinematic.viscosity'></span>

<h3>Description</h3>

<p>calculates the kinematic viscosity of air.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>kinematic.viscosity(Tair, pressure, constants = bigleaf.constants())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="kinematic.viscosity_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (deg C)</p>
</td></tr>
<tr><td><code id="kinematic.viscosity_+3A_pressure">pressure</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
<tr><td><code id="kinematic.viscosity_+3A_constants">constants</code></td>
<td>
<p>Kelvin - conversion degree Celsius to Kelvin <br />
pressure0 - reference atmospheric pressure at sea level (Pa) <br />
Tair0 - reference air temperature (K) <br />
kPa2Pa - conversion kilopascal (kPa) to pascal (Pa)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>where v is the kinematic viscosity of the air (m2 s-1), 
given by (Massman 1999b):
</p>
<p style="text-align: center;"><code class="reqn">v = 1.327 * 10^-5(pressure0/pressure)(Tair/Tair0)^1.81</code>
</p>



<h3>Value</h3>

<table role = "presentation">
<tr><td><code>v -</code></td>
<td>
<p>kinematic viscosity of air (m2 s-1)</p>
</td></tr>
</table>


<h3>References</h3>

<p>Massman, W.J., 1999b: Molecular diffusivities of Hg vapor in air, 
O2 and N2 near STP and the kinematic viscosity and thermal diffusivity
of air near STP. Atmospheric Environment 33, 453-457.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>kinematic.viscosity(25,100)    

</code></pre>

<hr>
<h2 id='latent.heat.vaporization'>Latent Heat of Vaporization</h2><span id='topic+latent.heat.vaporization'></span>

<h3>Description</h3>

<p>Latent heat of vaporization as a function of air temperature.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>latent.heat.vaporization(Tair)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="latent.heat.vaporization_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (deg C)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The following formula is used:
</p>
<p style="text-align: center;"><code class="reqn">\lambda = (2.501 - 0.00237*Tair)10^6</code>
</p>



<h3>Value</h3>

<p><code class="reqn">\lambda</code> - Latent heat of vaporization (J kg-1)
</p>


<h3>References</h3>

<p>Stull, B., 1988: An Introduction to Boundary Layer Meteorology (p.641)
Kluwer Academic Publishers, Dordrecht, Netherlands
</p>
<p>Foken, T, 2008: Micrometeorology. Springer, Berlin, Germany.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>latent.heat.vaporization(seq(5,45,5))             
            
</code></pre>

<hr>
<h2 id='LE.to.ET'>Conversion between Latent Heat Flux and Evapotranspiration</h2><span id='topic+LE.to.ET'></span><span id='topic+ET.to.LE'></span>

<h3>Description</h3>

<p>converts evaporative water flux from mass (ET=evapotranspiration)
to energy (LE=latent heat flux) units, or vice versa.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>LE.to.ET(LE, Tair)

ET.to.LE(ET, Tair)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="LE.to.ET_+3A_le">LE</code></td>
<td>
<p>Latent heat flux (W m-2)</p>
</td></tr>
<tr><td><code id="LE.to.ET_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (deg C)</p>
</td></tr>
<tr><td><code id="LE.to.ET_+3A_et">ET</code></td>
<td>
<p>Evapotranspiration (kg m-2 s-1)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The conversions are given by:
</p>
<p style="text-align: center;"><code class="reqn">ET = LE/\lambda</code>
</p>

<p style="text-align: center;"><code class="reqn">LE = \lambda ET</code>
</p>

<p>where <code class="reqn">\lambda</code> is the latent heat of vaporization (J kg-1) as calculated by
<code><a href="#topic+latent.heat.vaporization">latent.heat.vaporization</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># LE of 200 Wm-2 and air temperature of 25degC
LE.to.ET(200,25)

</code></pre>

<hr>
<h2 id='light.response'>Ecosystem Light Response</h2><span id='topic+light.response'></span>

<h3>Description</h3>

<p>calculates GPP_ref at a reference (usually saturating) PPFD and 
ecosystem quantum yield (alpha) using a rectangular light response curve.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>light.response(
  data,
  NEE = "NEE",
  Reco = "Reco",
  PPFD = "PPFD",
  PPFD_ref = 2000,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="light.response_+3A_data">data</code></td>
<td>
<p>Data.frame or matrix containing all required columns</p>
</td></tr>
<tr><td><code id="light.response_+3A_nee">NEE</code></td>
<td>
<p>Net ecosystem exchange (umol CO2 m-2 s-1)</p>
</td></tr>
<tr><td><code id="light.response_+3A_reco">Reco</code></td>
<td>
<p>Ecosystem respiration (umol CO2 m-2 s-1)</p>
</td></tr>
<tr><td><code id="light.response_+3A_ppfd">PPFD</code></td>
<td>
<p>Photosynthetic photon flux density (umol m-2 s-1)</p>
</td></tr>
<tr><td><code id="light.response_+3A_ppfd_ref">PPFD_ref</code></td>
<td>
<p>Reference PPFD (umol m-2 s-1) for which GPP_ref is estimated.
Default is 2000 umol m-2 s-1.</p>
</td></tr>
<tr><td><code id="light.response_+3A_...">...</code></td>
<td>
<p>Additional arguments to <code><a href="stats.html#topic+nls">nls</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>A rectangular light response curve is fitted to NEE data. The curve
takes the form as described in Falge et al. 2001:
</p>
<p style="text-align: center;"><code class="reqn">-NEE = \alpha PPFD / (1 - (PPFD / PPFD_ref) + \alpha 
                         PPFD / GPP_ref) - Reco</code>
</p>

<p>where <code class="reqn">\alpha</code> is the ecosystem quantum yield (umol CO2 m-2 s-1) (umol quanta m-2 s-1)-1, 
and GPP_ref is the GPP at the reference PPFD (usually at saturating light). <code class="reqn">\alpha</code> 
represents the slope of the light response curve, and is a measure for the light use
efficiency of the canopy. 
</p>
<p>The advantage of this equation over the standard rectangular light response
curve is that GPP_ref at PPFD_ref is more readily interpretable
as it constitutes a value observed in the ecosystem, in contrast to 
GPP_ref (mostly named 'beta') in the standard model that occurs at infinite light.
<code>PPFD_ref</code> defaults to 2000 umol m-2 s-1, but other values can be used. For 
further details refer to Falge et al. 2001.
</p>


<h3>Value</h3>

<p>A <code>nls</code> model object containing estimates (+/- SE) for alpha and GPP_ref.
</p>


<h3>Note</h3>

<p>Note the sign convention. Negative NEE indicates that carbon is taken up
by the ecosystem. Reco has to be 0 or larger.
</p>


<h3>References</h3>

<p>Falge E., et al. 2001: Gap filling strategies for defensible annual
sums of net ecosystem exchange. Agricultural and Forest Meteorology 107,
43-69.
</p>
<p>Gilmanov T.G., et al. 2003: Gross primary production and light response
parameters of four Southern Plains ecosystems estimated using long-term
CO2-flux tower measurements. Global Biogeochemical Cycles 17, 1071.
</p>
<p>Reichstein M., Stoy P.C., Desai A.R., Lasslop G., Richardson A. 2012: 
Partitioning of net fluxes. In: Eddy Covariance. A practical guide to
measurement and data analysis. Aubinet M., Vesala T., Papale D. (Eds.).
Springer.
</p>

<hr>
<h2 id='light.use.efficiency'>Light-Use Efficiency (LUE)</h2><span id='topic+light.use.efficiency'></span>

<h3>Description</h3>

<p>Amount of carbon fixed (GPP) per incoming light.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>light.use.efficiency(GPP, PPFD)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="light.use.efficiency_+3A_gpp">GPP</code></td>
<td>
<p>Gross ecosystem productivity (umol CO2 m-2 s-1)</p>
</td></tr>
<tr><td><code id="light.use.efficiency_+3A_ppfd">PPFD</code></td>
<td>
<p>Photosynthetic photon flux density (umol quanta m-2 s-1)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Light use efficiency is calculated as
</p>
<p style="text-align: center;"><code class="reqn">LUE = sum(GPP)/sum(PPFD)</code>
</p>

<p>where both GPP and PPFD are in umol m-2 s-1. A more meaningful 
(as directly comparable across ecosystems) approach is to take 
absorbed PPFD rather than incoming PPFD as used here.
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>LUE -</code></td>
<td>
<p>Light use efficiency (-)</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+energy.use.efficiency">energy.use.efficiency</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>light.use.efficiency(GPP=20,PPFD=1500)

</code></pre>

<hr>
<h2 id='longwave.conductance'>Longwave Radiative Transfer Conductance of the Canopy</h2><span id='topic+longwave.conductance'></span>

<h3>Description</h3>

<p>Longwave Radiative Transfer Conductance of the Canopy
</p>


<h3>Usage</h3>

<pre><code class='language-R'>longwave.conductance(Tair, LAI, constants = bigleaf.constants())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="longwave.conductance_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (deg C)</p>
</td></tr>
<tr><td><code id="longwave.conductance_+3A_lai">LAI</code></td>
<td>
<p>Leaf area index (m2 m-2)</p>
</td></tr>
<tr><td><code id="longwave.conductance_+3A_constants">constants</code></td>
<td>
<p>Kelvin - conversion degree Celsius to Kelvin <br />
sigma - Stefan-Boltzmann constant (W m-2 K-4) <br />
cp - specific heat of air for constant pressure (J K-1 kg-1)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>the following formula is used (Martin, 1989):
</p>
<p style="text-align: center;"><code class="reqn">Gr = 4 \sigma Tair^3 LAI / cp</code>
</p>



<h3>Value</h3>

<table role = "presentation">
<tr><td><code>Gr -</code></td>
<td>
<p>longwave radiative transfer conductance of the canopy (m s-1)</p>
</td></tr>
</table>


<h3>References</h3>

<p>Martin P., 1989: The significance of radiative coupling between
vegetation and the atmosphere. Agricultural and Forest Meteorology 49, 45-53.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>longwave.conductance(25,seq(1,8,1))            
                 
</code></pre>

<hr>
<h2 id='Monin.Obukhov.length'>Monin-Obukhov Length</h2><span id='topic+Monin.Obukhov.length'></span>

<h3>Description</h3>

<p>calculates the Monin-Obukhov length.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Monin.Obukhov.length(
  data,
  Tair = "Tair",
  pressure = "pressure",
  ustar = "ustar",
  H = "H",
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Monin.Obukhov.length_+3A_data">data</code></td>
<td>
<p>Data.frame or matrix containing all required variables</p>
</td></tr>
<tr><td><code id="Monin.Obukhov.length_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (deg C)</p>
</td></tr>
<tr><td><code id="Monin.Obukhov.length_+3A_pressure">pressure</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
<tr><td><code id="Monin.Obukhov.length_+3A_ustar">ustar</code></td>
<td>
<p>Friction velocity (m s-1)</p>
</td></tr>
<tr><td><code id="Monin.Obukhov.length_+3A_h">H</code></td>
<td>
<p>Sensible heat flux (W m-2)</p>
</td></tr>
<tr><td><code id="Monin.Obukhov.length_+3A_constants">constants</code></td>
<td>
<p>Kelvin - conversion degree Celsius to Kelvin <br />
cp - specific heat of air for constant pressure (J K-1 kg-1) <br />
k - von Karman constant (-) <br />
g - gravitational acceleration (m s-2)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The Monin-Obukhov length (L) is given by:
</p>
<p style="text-align: center;"><code class="reqn">L = - (\rho * cp * ustar^3 * Tair) / (k * g * H)</code>
</p>

<p>where <code class="reqn">rho</code> is air density (kg m-3).
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>L -</code></td>
<td>
<p>Monin-Obukhov length (m)</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Note that L gets very small for very low ustar values with implications
for subsequent functions using L as input. It is recommended to filter
data and exclude low ustar values (ustar &lt; ~0.2) beforehand.
</p>


<h3>References</h3>

<p>Foken, T, 2008: Micrometeorology. Springer, Berlin, Germany.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+stability.parameter">stability.parameter</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>Monin.Obukhov.length(Tair=25,pressure=100,ustar=seq(0.2,1,0.1),H=seq(40,200,20))

</code></pre>

<hr>
<h2 id='ms.to.mol'>Conversion between Conductance Units</h2><span id='topic+ms.to.mol'></span><span id='topic+mol.to.ms'></span>

<h3>Description</h3>

<p>Converts conductances from mass (m s-1)
to molar units (mol m-2 s-1), or vice versa.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ms.to.mol(G_ms, Tair, pressure, constants = bigleaf.constants())

mol.to.ms(G_mol, Tair, pressure, constants = bigleaf.constants())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ms.to.mol_+3A_g_ms">G_ms</code></td>
<td>
<p>Conductance (m s-1)</p>
</td></tr>
<tr><td><code id="ms.to.mol_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (deg C)</p>
</td></tr>
<tr><td><code id="ms.to.mol_+3A_pressure">pressure</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
<tr><td><code id="ms.to.mol_+3A_constants">constants</code></td>
<td>
<p>Kelvin - conversion degree Celsius to Kelvin <br />
Rgas - universal gas constant (J mol-1 K-1) <br />
kPa2Pa - conversion kilopascal (kPa) to pascal (Pa)</p>
</td></tr>
<tr><td><code id="ms.to.mol_+3A_g_mol">G_mol</code></td>
<td>
<p>Conductance (mol m-2 s-1)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The conversions are given by:
</p>
<p style="text-align: center;"><code class="reqn">G_mol = G_ms * pressure / (Rgas * Tair)</code>
</p>

<p style="text-align: center;"><code class="reqn">G_ms = G_mol * (Rgas * Tair) / pressure</code>
</p>

<p>where Tair is in Kelvin and pressure in Pa (converted from kPa internally)
</p>


<h3>References</h3>

<p>Jones, H.G. 1992. Plants and microclimate: a quantitative approach to environmental plant physiology.
2nd Edition., Cambridge University Press, Cambridge. 428 p
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ms.to.mol(0.005,25,100)

</code></pre>

<hr>
<h2 id='optimum.temperature'>Optimum temperature of Gross Primary Productivity</h2><span id='topic+optimum.temperature'></span>

<h3>Description</h3>

<p>Calculates the relationship between Gross Primary Productivity (GPP) and Air Temperature (Tair) 
using boundary line analysis and derives the thermal optima.  This function can also be used to find the 
boundary line relationship and optima of other variables such as NPP and NEP.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>optimum.temperature(
  data,
  GPP = "GPP",
  Tair = "Tair",
  BLine = 0.9,
  Obs_filter = 30
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="optimum.temperature_+3A_data">data</code></td>
<td>
<p>Dataframe containing the Gross Primary Productivity and Air Temperature observations</p>
</td></tr>
<tr><td><code id="optimum.temperature_+3A_gpp">GPP</code></td>
<td>
<p>Name of column (in quotations, eg. &quot;GPP&quot;) containing the Gross Primary Productivity observations (umol CO2 m-2 s-1).</p>
</td></tr>
<tr><td><code id="optimum.temperature_+3A_tair">Tair</code></td>
<td>
<p>Name of column (in quotations, eg. &quot;Tair&quot;) containing the air temperature (degrees celcius) observations.</p>
</td></tr>
<tr><td><code id="optimum.temperature_+3A_bline">BLine</code></td>
<td>
<p>Quantile at which to place the boundary line in format &quot;0.XX&quot;.  Defaults to 0.90.</p>
</td></tr>
<tr><td><code id="optimum.temperature_+3A_obs_filter">Obs_filter</code></td>
<td>
<p>Filter to remove air temperature bins with an insufficient number of observations. Defaults to 30.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function works by first binning GPP and air temperature observations to 1 degree temperature bins and then
deriving the relationship between GPP and air temperature at a defined quantile using boundary line analysis. 
Observations are binned using a rounding function, so that each bin is centered on the degree integer value 
(eg. bin 18 contains values between 17.5 and 18.49). The boundary line is usually placed at the upper boundary 
of the distribution (see Webb 1972) however this functional allows the user to select any quantile,
with the default of 0.9 selected for use with eddy covariance flux observations due to the high 
level of noise in these data (see Bennett et al, 2021). After binning observations, the function removes 
temperature bins with fewer observations than the default of 30 (this value can also be user defined).  
It then calculates the smoothed curve between GPP and air temperature using the loess function and derives 
the thermal optima of GPP (Topt). Topt is defined as the temperature bin at which GPP reaches its maximum
along the smoothed boundary line.
</p>


<h3>Value</h3>

<p>A list containing the following objects:
</p>

<ol>
<li><p>df.bl: A four column dataframe:
</p>

<ul>
<li><p>Tair_bin: air temperature bins in 1 degree increments
</p>
</li>
<li><p>GPP_Bline: Value of GPP at the BLine
</p>
</li>
<li><p>n_obs: number of observations in the air temperature bin
</p>
</li>
<li><p>GPP_Bline_smooth: Value of GPP at the smoothed Bline
</p>
</li></ul>

</li>
<li><p>opt.temp: A named vector with two elements:
</p>

<ul>
<li><p>Topt: Thermal optima of GPP - the air temperature bin with maximum GPP along the smoothed Bline
</p>
</li>
<li><p>GPP_bl: The boundary line GPP observation at Topt
</p>
</li></ul>

</li></ol>



<h3>References</h3>

<p>Bennett A. et al., 2021: Thermal optima of gross primary productivity are closely aligned with mean air temperatures 
across Australian wooded ecosystems. Global Change Biology 32(3), 280-293
</p>
<p>Webb, R. A. 1972. Use of the Boundary Line in the analysis of biological data. Journal of Horticultural Science 47, 309-319
</p>


<h3>Examples</h3>

<pre><code class='language-R'> # Locate the relationship between GPP and air temperature using default values 
 # for BLine and observation filter.

 Gpp_ta &lt;- optimum.temperature(data=AT_Neu_Jul_2010, GPP="GPP", Tair="Tair")
 
 # Locate the relationship between GPP and air temperature at the 50th percentile, 
 # filtering temperature bins with fewer than 10 observations
 
 Gpp_ta &lt;- optimum.temperature(data=AT_Neu_Jul_2010, 
                               GPP="GPP", Tair="Tair", BLine=0.50, Obs_filter=10)
 
</code></pre>

<hr>
<h2 id='photosynthetic.capacity'>Bulk Canopy Photosynthetic Capacity (Vcmax and Jmax)</h2><span id='topic+photosynthetic.capacity'></span>

<h3>Description</h3>

<p>Bulk canopy maximum carboxylation rate (Vcmax25), and maximum electron
transport rate (Jmax25) at 25 degrees Celsius from bulk intercellular 
CO2 concentration using the Farquhar et al. 1980 model for C3 photosynthesis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>photosynthetic.capacity(
  data,
  C3 = TRUE,
  Temp,
  GPP = "GPP",
  Ci,
  PPFD = "PPFD",
  PPFD_j = c(200, 500),
  PPFD_c = 1000,
  Rleaf = NULL,
  Oi = 0.21,
  Kc25 = 404.9,
  Ko25 = 278.4,
  Gam25 = 42.75,
  Kc_Ha = 79.43,
  Ko_Ha = 36.38,
  Gam_Ha = 37.83,
  Vcmax_Ha = 65.33,
  Vcmax_Hd = 200,
  Vcmax_dS = 0.635,
  Jmax_Ha = 43.9,
  Jmax_Hd = 200,
  Jmax_dS = 0.64,
  Theta = 0.7,
  alpha_canopy = 0.8,
  missing.Rleaf.as.NA = FALSE,
  Ci_C4 = 100,
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="photosynthetic.capacity_+3A_data">data</code></td>
<td>
<p>Data.Frame or matrix with all required columns</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_c3">C3</code></td>
<td>
<p>C3 vegetation (<code>TRUE</code>, the default) or C4 vegetation (<code>FALSE</code>)?</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_temp">Temp</code></td>
<td>
<p>Surface (or air) temperature (degC)</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_gpp">GPP</code></td>
<td>
<p>Gross primary productivity (umol m-2 s-1)</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_ci">Ci</code></td>
<td>
<p>Bulk canopy intercellular CO2 concentration (umol mol-1)</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_ppfd">PPFD</code></td>
<td>
<p>Photosynthetic photon flux density (umol m-2 s-1)</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_ppfd_j">PPFD_j</code></td>
<td>
<p>PPFD threshold, below which the canopy is considered to 
be RuBP regeneration limited. Defaults to 500 umol m-2 s-1.</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_ppfd_c">PPFD_c</code></td>
<td>
<p>PPFD threshold, above which the canopy is considered to 
be Rubisco limited. Defaults to 1000 umol m-2 s-1.</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_rleaf">Rleaf</code></td>
<td>
<p>Ecosystem respiration stemming from leaves (umol CO2 m-2 s-1); defaults to 0</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_oi">Oi</code></td>
<td>
<p>Intercellular O2 concentration (mol mol-1)</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_kc25">Kc25</code></td>
<td>
<p>Michaelis-Menten constant for CO2 at 25 degC (umol mol-1)</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_ko25">Ko25</code></td>
<td>
<p>Michaelis-Menten constant for O2 at 25 degC (mmol mol-1)</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_gam25">Gam25</code></td>
<td>
<p>Photorespiratory CO2 compensation point ('Gamma star') 
at 25 degC (umol mol-1)</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_kc_ha">Kc_Ha</code></td>
<td>
<p>Activation energy for Kc (kJ mol-1)</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_ko_ha">Ko_Ha</code></td>
<td>
<p>Activation energy for Ko (kJ mol-1)</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_gam_ha">Gam_Ha</code></td>
<td>
<p>Activation energy for Gam (kJ mol-1)</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_vcmax_ha">Vcmax_Ha</code></td>
<td>
<p>Activation energy for Vcmax (kJ mol-1)</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_vcmax_hd">Vcmax_Hd</code></td>
<td>
<p>Deactivation energy for Vcmax (kJ mol-1)</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_vcmax_ds">Vcmax_dS</code></td>
<td>
<p>Entropy term for Vcmax (kJ mol-1 K-1)</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_jmax_ha">Jmax_Ha</code></td>
<td>
<p>Activation energy for Jmax (kJ mol-1)</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_jmax_hd">Jmax_Hd</code></td>
<td>
<p>Deactivation energy for Jmax (kJ mol-1)</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_jmax_ds">Jmax_dS</code></td>
<td>
<p>Entropy term for Jmax (kJ mol-1 K-1)</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_theta">Theta</code></td>
<td>
<p>Curvature term in the light response function of J (-)</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_alpha_canopy">alpha_canopy</code></td>
<td>
<p>Canopy absorptance (-)</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_missing.rleaf.as.na">missing.Rleaf.as.NA</code></td>
<td>
<p>if Rleaf is provided, should missing values be treated as <code>NA</code> (<code>TRUE</code>)
or set to 0 (<code>FALSE</code>, the default)?</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_ci_c4">Ci_C4</code></td>
<td>
<p>intercellular CO2 concentration below which photosynthesis
is considered to be CO2-limited (umol mol-1), ignored
if <code>C3 = TRUE</code>.</p>
</td></tr>
<tr><td><code id="photosynthetic.capacity_+3A_constants">constants</code></td>
<td>
<p>Kelvin - conversion degree Celsius to Kelvin <br />
Rgas - universal gas constant (J mol-1 K-1) <br />
kJ2J - conversion kilojoule (kJ) to joule (J) <br />
J2kJ - conversion joule (J) to kilojoule (kJ) <br />
se_median - conversion standard error (SE) of the mean to SE of the median</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The maximum carboxylation rate at 25degC (Vcmax25) and the maximum electron
transport rate at 25degC (Jmax25), which characterize photosynthetic capacity,
are calculated as at leaf level. 
The required variables Gs and Ci can be calculated from 
<code><a href="#topic+surface.conductance">surface.conductance</a></code> and <code><a href="#topic+intercellular.CO2">intercellular.CO2</a></code>, respectively.
</p>
<p>Gas exchange parameters are taken from Bernacchi et al. 2001 (apparent values, which
assume an infinite mesophyll conductance). Negative and very low Ci values 
(the threshold is set to Ci &lt; 80umol mol-1 at the moment) are filtered out.
</p>
<p>Vcmax is calculated from the photosynthesis model by Farquhar et al. 1980.
If net photosynthesis is Rubisco-limited (RuBP-saturated carboxylation
rate, i.e. light has to be (near-)saturating):
</p>
<p style="text-align: center;"><code class="reqn">Vcmax = (GPP * (Ci + Kc*(1.0 + Oi/Ko))) / (Ci - Gam)</code>
</p>

<p>where Kc and Ko are the Michaelis-Menten constants for CO2 and O2 (mmol mol-1),
respectively, Oi is the O2 concentration, and Gam is the photorespiratory CO2
compensation point (umol mol-1).
Under low-light conditions, the electron transport rate J is calculated from
the RuBP regeneration-limited photosynthesis rate:
</p>
<p style="text-align: center;"><code class="reqn">J = (GPP * (4.0 * Ci + 8.0 * Gam) / (Ci - Gam)</code>
</p>

<p>In this function, bulk canopy photosynthesis is assumed to be Rubisco/RuBP-regeneration
limited, if incoming PPFD is above/below a specified threshold or range. These ranges
are determined by the parameters <code>PPFD_j</code> and <code>PPFD_c</code>. If, for example,
<code>PPFD_j = c(100,400)</code>, all conditions with a PPFD between 100 and 400 are assumed
to be in the RuBP-regeneration (i.e. light-limited) photosynthesis domain. The electron
transport rate J is then only calculated for periods that meet this criterion.
</p>
<p>Jmax is calculated from J and absorbed irradiance:
</p>
<p style="text-align: center;"><code class="reqn">J = (APPFD_PSII + Jmax - sqrt((APPFD_PSII + Jmax)^2 - 
                    4.0 * Theta * APPFD_PSII * Jmax)) / (2.0 * Theta)
                </code>
</p>

<p>where APPFD_PSII is the absorbed PPFD by photosystem II (PS II), 
and Theta is a curvature parameter. APPFD_PSII is calculated as
</p>
<p style="text-align: center;"><code class="reqn">PPFD * alpha_canopy * 0.85 * beta</code>
</p>

<p>where alpha_canopy is canopy-scale absorptance, 0.85 is a correction factor,
and beta is the fraction of photons absorbed by PS II (assumed 0.5).
alpha_canopy accounts for non-absorbing components of the ecosystem such as
stems or soil, and is very likely ecosystem-specific. This parameter is relatively
sensitive for the determination of Jmax25 at some sites.
</p>
<p>Vcmax and Jmax at canopy level are assumed to follow the same temperature response
as at leaf level. Hence, the respective parameter k at 25degC (k25) is calculated as 
(see e.g. Kattge &amp; Knorr 2007):
</p>
<p style="text-align: center;"><code class="reqn">k25 = k / 
                       ( exp(Ha * (Temp - Tref) / (Tref * Rgas * Temp)) *
                       (1 + exp((Tref * dS - Hd) / (Tref * Rgas))) /
                       (1 + exp((Temp * dS - Hd) / (Temp * Rgas)))
                       )
                 </code>
</p>

<p>where Ha is the activation energy (kJ mol-1), Hd is the deactivation energy (kJ mol-1),
and dS is the entropy term (kJ mol-1 K-1) of the respective parameter. Tref is set
to 298.15 K.
</p>
<p>For C4 photosynthesis, the simplified model by von Caemmerer 2000 is used.
For light-saturated photosynthesis, Vcmax is given by:
</p>
<p style="text-align: center;"><code class="reqn">Vcmax = GPP</code>
</p>

<p>Note that in addition to the range <code>PPFD_c</code>, the range <code>Ci_C4</code>
discards all periods with low Ci, in which photosynthesis is likely to
be CO2-limited (see von Caemmerer 2000 for details).
</p>
<p>In the light-limited case, J is calculated as:
</p>
<p style="text-align: center;"><code class="reqn">J = 3 * GPPj / (1 - 0.5) </code>
</p>

<p>The calculation of Jmax25 and Vcmax25 is identical to C3 photosynthesis
as described above.
</p>


<h3>Value</h3>

<p>a data.frame with the following columns:
</p>
<table role = "presentation">
<tr><td><code>Vcmax25</code></td>
<td>
<p>maximum bulk canopy carboxylation rate at 25degC (umol m-2 (ground) s-1)</p>
</td></tr>
<tr><td><code>Jmax25</code></td>
<td>
<p>maximum bulk canopy electron transport rate at 25degC (umol m-2 (ground) s-1)</p>
</td></tr>
</table>


<h3>Note</h3>

<p>The critical assumption is that bulk canopy photosynthesis is limited by
one of the two limitation states. Incoming PPFD is assumed to determine
the limitation states. Note however that the ranges (<code>PPFD_j</code> and <code>PPFD_c</code>)
are likely ecosystem-specific. E.g. dense canopies presumably require higher
<code>PPFD_c</code> thresholds than open canopies. A threshold of 500 umol m-2 s-1 PPFD
for Rubisco-limited photosynthesis was assumed a reasonable working assumption (see Kosugi et al. 2013).
Here, <code>PPFD_c</code> defaults to 1000 umol m-2 s-1. Note that even under very high/low irradiances,
not all photosynthetically active plant material of an ecosystem will be in the same
limitation state. Note that parameters describing bulk canopy photosynthetic capacity are not directly 
comparable to their leaf-level counterparts, as the former integrate over the entire canopy
depth (i.e. are given per ground area, and not per leaf area).
In general, the function should be used with care!
</p>


<h3>References</h3>

<p>Lloyd J. et al., 1995: A simple calibrated model of Amazon rainforest productivity
based on leaf biochemical properties. Plant, Cell and Environment 18, 1129-1145.
</p>
<p>Rayment M.B., Loustau D., Jarvis P.G., 2002: Photosynthesis and respiration
of black spruce at three organizational scales: shoot, branch and canopy.
Tree Physiology 22, 219-229.
</p>
<p>Kosugi Y. et al., 2013: Determination of the gas exchange phenology in an
evergreen coniferous forest from 7 years of eddy covariance flux data using
an extended big-leaf analysis. Ecol Res 28, 373-385. 
</p>
<p>Ueyama M. et al, 2016: Optimization of a biochemical model with eddy covariance
measurements in black spruce forests of Alaska for estimating CO2 fertilization
effects. Agricultural and Forest Meteorology 222, 98-111.
</p>
<p>Bernacchi C.J., Singsaas E.L., Pimentel C., Portis JR A.R., Long S.P., 2001:
Improved temperature response functions for models of Rubisco-limited
photosynthesis. Plant, Cell and Environment 24, 253-259. 
</p>
<p>Bernacchi C.J., Pimentel C., Long S.P., 2003: In vivo temperature response
functions of parameters required to model RuBP-limited photosynthesis.
Plant, Cell and Environment 26, 1419-1430.
</p>
<p>von Caemmerer, 2000: Biochemical models of leaf photosynthesis. Techniques
in plant sciences No. 2. CSIRO Publishing, Collingwood VIC, Australia.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+intercellular.CO2">intercellular.CO2</a></code>, <code><a href="#topic+Arrhenius.temp.response">Arrhenius.temp.response</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>DE_Tha_Jun_2014_2 &lt;- filter.data(DE_Tha_Jun_2014,quality.control=FALSE,
                                 vars.qc=c("Tair","precip","VPD","H","LE"),
                                 filter.growseas=FALSE,filter.precip=TRUE,
                                 filter.vars=c("Tair","PPFD","ustar","LE"),
                                 filter.vals.min=c(5,200,0.2,0),
                                 filter.vals.max=c(NA,NA,NA,NA),NA.as.invalid=TRUE,
                                 quality.ext="_qc",good.quality=c(0,1),
                                 missing.qc.as.bad=TRUE,GPP="GPP",doy="doy",
                                 year="year",tGPP=0.5,ws=15,min.int=5,precip="precip",
                                 tprecip=0.1,precip.hours=24,records.per.hour=2)

# calculate Ga
Ga &lt;- aerodynamic.conductance(DE_Tha_Jun_2014_2,Rb_model="Thom_1972")[,"Ga_h"]

# calculate Gs from the the inverted PM equation
Gs_PM &lt;- surface.conductance(DE_Tha_Jun_2014_2,Tair="Tair",pressure="pressure",
                             Rn="Rn",G="G",S=NULL,VPD="VPD",Ga=Ga,
                             formulation="Penman-Monteith")[,"Gs_mol"]

# calculate Ci 
Ci &lt;- intercellular.CO2(DE_Tha_Jun_2014_2,Ca="Ca",GPP="GPP",Gs=Gs_PM) 

# calculate Vcmax25 and Jmax25
photosynthetic.capacity(DE_Tha_Jun_2014_2,Temp="Tair",Ci=Ci,PPFD_j=c(200,500),PPFD_c=1000)

</code></pre>

<hr>
<h2 id='potential.ET'>Potential Evapotranspiration</h2><span id='topic+potential.ET'></span>

<h3>Description</h3>

<p>Potential evapotranspiration according to Priestley &amp; Taylor 1972 or
the Penman-Monteith equation with a prescribed surface conductance.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>potential.ET(
  data,
  Tair = "Tair",
  pressure = "pressure",
  Rn = "Rn",
  G = NULL,
  S = NULL,
  VPD = "VPD",
  Ga = "Ga_h",
  approach = c("Priestley-Taylor", "Penman-Monteith"),
  alpha = 1.26,
  Gs_pot = 0.6,
  missing.G.as.NA = FALSE,
  missing.S.as.NA = FALSE,
  Esat.formula = c("Sonntag_1990", "Alduchov_1996", "Allen_1998"),
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="potential.ET_+3A_data">data</code></td>
<td>
<p>Data.frame or matrix containing all required variables; optional</p>
</td></tr>
<tr><td><code id="potential.ET_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (degC)</p>
</td></tr>
<tr><td><code id="potential.ET_+3A_pressure">pressure</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
<tr><td><code id="potential.ET_+3A_rn">Rn</code></td>
<td>
<p>Net radiation (W m-2)</p>
</td></tr>
<tr><td><code id="potential.ET_+3A_g">G</code></td>
<td>
<p>Ground heat flux (W m-2); optional</p>
</td></tr>
<tr><td><code id="potential.ET_+3A_s">S</code></td>
<td>
<p>Sum of all storage fluxes (W m-2); optional</p>
</td></tr>
<tr><td><code id="potential.ET_+3A_vpd">VPD</code></td>
<td>
<p>Vapor pressure deficit (kPa); only used if <code>approach = "Penman-Monteith"</code>.</p>
</td></tr>
<tr><td><code id="potential.ET_+3A_ga">Ga</code></td>
<td>
<p>Aerodynamic conductance to heat/water vapor (m s-1); only used if <code>approach = "Penman-Monteith"</code>.</p>
</td></tr>
<tr><td><code id="potential.ET_+3A_approach">approach</code></td>
<td>
<p>Approach used. Either <code>"Priestley-Taylor"</code> (default), or <code>"Penman-Monteith"</code>.</p>
</td></tr>
<tr><td><code id="potential.ET_+3A_alpha">alpha</code></td>
<td>
<p>Priestley-Taylor coefficient; only used if <code>approach = "Priestley-Taylor"</code>.</p>
</td></tr>
<tr><td><code id="potential.ET_+3A_gs_pot">Gs_pot</code></td>
<td>
<p>Potential/maximum surface conductance (mol m-2 s-1); defaults to 0.6 mol m-2 s-1;
only used if <code>approach = "Penman-Monteith"</code>.</p>
</td></tr>
<tr><td><code id="potential.ET_+3A_missing.g.as.na">missing.G.as.NA</code></td>
<td>
<p>if <code>TRUE</code>, missing G are treated as <code>NA</code>s, otherwise set to 0.</p>
</td></tr>
<tr><td><code id="potential.ET_+3A_missing.s.as.na">missing.S.as.NA</code></td>
<td>
<p>if <code>TRUE</code>, missing S are treated as <code>NA</code>s, otherwise set to 0.</p>
</td></tr>
<tr><td><code id="potential.ET_+3A_esat.formula">Esat.formula</code></td>
<td>
<p>Optional: formula to be used for the calculation of esat and the slope of esat.
One of <code>"Sonntag_1990"</code> (Default), <code>"Alduchov_1996"</code>, or <code>"Allen_1998"</code>.
See <code><a href="#topic+Esat.slope">Esat.slope</a></code>.</p>
</td></tr>
<tr><td><code id="potential.ET_+3A_constants">constants</code></td>
<td>
<p>cp - specific heat of air for constant pressure (J K-1 kg-1) <br />
eps - ratio of the molecular weight of water vapor to dry air <br />
Pa2kPa - conversion pascal (Pa) to kilopascal (kPa) <br />
Rd - gas constant of dry air (J kg-1 K-1) (only used if <code>approach = "Penman-Monteith"</code>) <br />
Rgas - universal gas constant (J mol-1 K-1) (only used if <code>approach = "Penman-Monteith"</code>) <br />
Kelvin - conversion degree Celsius to Kelvin (only used if <code>approach = "Penman-Monteith"</code>) <br /></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Potential evapotranspiration is calculated according to Priestley &amp; Taylor, 1972
if <code>approach = "Priestley-Taylor"</code> (the default):
</p>
<p style="text-align: center;"><code class="reqn">LE_pot,PT = (\alpha * \Delta * (Rn - G - S)) / (\Delta + \gamma)</code>
</p>

<p><code class="reqn">\alpha</code> is the Priestley-Taylor coefficient, <code class="reqn">\Delta</code> is the slope 
of the saturation vapor pressure curve (kPa K-1), and <code class="reqn">\gamma</code> is the 
psychrometric constant (kPa K-1).
if <code>approach = "Penman-Monteith"</code>, potential evapotranspiration is calculated according
to the Penman-Monteith equation:
</p>
<p style="text-align: center;"><code class="reqn">LE_pot,PM = (\Delta * (Rn - G - S) + \rho * cp * VPD * Ga) / (\Delta + \gamma * (1 + Ga/Gs_pot)</code>
</p>

<p>where <code class="reqn">\Delta</code> is the slope of the saturation vapor pressure curve (kPa K-1),
<code class="reqn">\rho</code> is the air density (kg m-3), and <code class="reqn">\gamma</code> is the psychrometric constant (kPa K-1).
The value of <code>Gs_pot</code> is typically a maximum value of Gs observed at the site, e.g. the 90th
percentile of Gs within the growing season.
</p>


<h3>Value</h3>

<p>a data.frame with the following columns:
</p>
<table role = "presentation">
<tr><td><code>ET_pot</code></td>
<td>
<p>Potential evapotranspiration (kg m-2 s-1)</p>
</td></tr>
<tr><td><code>LE_pot</code></td>
<td>
<p>Potential latent heat flux (W m-2)</p>
</td></tr>
</table>


<h3>Note</h3>

<p>If the first argument <code>data</code> is provided (either a matrix or a data.frame),
the following variables can be provided as character (in which case they are interpreted as
the column name of <code>data</code>) or as numeric vectors, in which case they are taken
directly for the calculations. If <code>data</code> is not provided, all input variables have to be
numeric vectors.
</p>


<h3>References</h3>

<p>Priestley, C.H.B., Taylor, R.J., 1972: On the assessment of surface heat flux
and evaporation using large-scale parameters. Monthly Weather Review 100, 81-92.  
</p>
<p>Allen, R.G., Pereira L.S., Raes D., Smith M., 1998: Crop evapotranspiration -
Guidelines for computing crop water requirements - FAO Irrigation and drainage
paper 56.
</p>
<p>Novick, K.A., et al. 2016: The increasing importance of atmospheric demand
for ecosystem water and carbon fluxes. Nature Climate Change 6, 1023 - 1027.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+surface.conductance">surface.conductance</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Calculate potential ET of a surface that receives a net radiation of 500 Wm-2
# using Priestley-Taylor:
potential.ET(Tair=30,pressure=100,Rn=500,alpha=1.26,approach="Priestley-Taylor")    

# Calculate potential ET for a surface with known Gs (0.5 mol m-2 s-1) and Ga (0.1 m s-1)
# using Penman-Monteith:
LE_pot_PM &lt;- potential.ET(Gs_pot=0.5,Tair=20,pressure=100,VPD=2,Ga=0.1,Rn=400,
                          approach="Penman-Monteith")[,"LE_pot"]
LE_pot_PM

# now cross-check with the inverted equation
surface.conductance(Tair=20,pressure=100,VPD=2,Ga=0.1,Rn=400,LE=LE_pot_PM)
</code></pre>

<hr>
<h2 id='potential.radiation'>Potential radiation</h2><span id='topic+potential.radiation'></span>

<h3>Description</h3>

<p>Compute potential radiation for given geolocation and day of year.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>potential.radiation(doy, hour, latDeg, longDeg, timezone, useSolartime = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="potential.radiation_+3A_doy">doy</code></td>
<td>
<p>Integer vector with day of year (start at 1), same length as <code>hour</code> or length 1.</p>
</td></tr>
<tr><td><code id="potential.radiation_+3A_hour">hour</code></td>
<td>
<p>Numeric vector with daytime as decimal hour of local time zone</p>
</td></tr>
<tr><td><code id="potential.radiation_+3A_latdeg">latDeg</code></td>
<td>
<p>Latitude (decimal degrees)</p>
</td></tr>
<tr><td><code id="potential.radiation_+3A_longdeg">longDeg</code></td>
<td>
<p>Longitude (decimal degrees)</p>
</td></tr>
<tr><td><code id="potential.radiation_+3A_timezone">timezone</code></td>
<td>
<p>Time zone (hours)</p>
</td></tr>
<tr><td><code id="potential.radiation_+3A_usesolartime">useSolartime</code></td>
<td>
<p>by default corrects hour (given in local winter time)
for latitude to solar time (where noon is exactly at 12:00).
Set this to <code>FALSE</code> to directly use local winter time.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of potential radiation (W m-2)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>hour &lt;- seq(5, 18, by = 0.1)
potRadApparentLocal &lt;- potential.radiation(
  160, hour, 39.94, -5.77, timezone = +1)
potRadTimezone &lt;- potential.radiation(
  160, hour, 39.94, -5.77, timezone = +1, useSolartime = FALSE)
plot(potRadApparentLocal ~ hour, type = 'l'
  , ylab = 'potential radiation (W m-2)')
lines(potRadTimezone ~  hour, col = "blue")
abline(v = 12, col = "blue", lty = "dotted")
legend("bottomright", legend = c("solar time", "local winter time")
, col = c("black", "blue"), inset = 0.05, lty = 1)
</code></pre>

<hr>
<h2 id='pressure.from.elevation'>Atmospheric Pressure from Hypsometric Equation</h2><span id='topic+pressure.from.elevation'></span>

<h3>Description</h3>

<p>An estimate of mean pressure at a given elevation as predicted by the
hypsometric equation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pressure.from.elevation(
  elev,
  Tair,
  VPD = NULL,
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pressure.from.elevation_+3A_elev">elev</code></td>
<td>
<p>Elevation a.s.l. (m)</p>
</td></tr>
<tr><td><code id="pressure.from.elevation_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (deg C)</p>
</td></tr>
<tr><td><code id="pressure.from.elevation_+3A_vpd">VPD</code></td>
<td>
<p>Vapor pressure deficit (kPa); optional</p>
</td></tr>
<tr><td><code id="pressure.from.elevation_+3A_constants">constants</code></td>
<td>
<p>Kelvin- conversion degC to Kelvin <br />
pressure0 - reference atmospheric pressure at sea level (Pa) <br />
Rd - gas constant of dry air (J kg-1 K-1) <br />
g -  gravitational acceleration (m s-2) <br />
Pa2kPa - conversion pascal (Pa) to kilopascal (kPa)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Atmospheric pressure is approximated by the hypsometric equation:
</p>
<p style="text-align: center;"><code class="reqn">pressure = pressure_0 / (exp(g * elevation / (Rd Temp)))</code>
</p>



<h3>Value</h3>

<table role = "presentation">
<tr><td><code>pressure -</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
</table>


<h3>Note</h3>

<p>The hypsometric equation gives an estimate of the standard pressure
at a given altitude. 
If VPD is provided, humidity correction is applied and the
virtual temperature instead of air temperature is used. VPD is 
internally converted to specific humidity.
</p>


<h3>References</h3>

<p>Stull B., 1988: An Introduction to Boundary Layer Meteorology.
Kluwer Academic Publishers, Dordrecht, Netherlands.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># mean pressure at 500m altitude at 25 deg C and VPD of 1 kPa
pressure.from.elevation(500,Tair=25,VPD=1)

</code></pre>

<hr>
<h2 id='psychrometric.constant'>Psychrometric Constant</h2><span id='topic+psychrometric.constant'></span>

<h3>Description</h3>

<p>Calculates the psychrometric 'constant'.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>psychrometric.constant(Tair, pressure, constants = bigleaf.constants())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="psychrometric.constant_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (deg C)</p>
</td></tr>
<tr><td><code id="psychrometric.constant_+3A_pressure">pressure</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
<tr><td><code id="psychrometric.constant_+3A_constants">constants</code></td>
<td>
<p>cp - specific heat of air for constant pressure (J K-1 kg-1) <br />
eps - ratio of the molecular weight of water vapor to dry air (-)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The psychrometric constant (<code class="reqn">\gamma</code>) is given as:
</p>
<p style="text-align: center;"><code class="reqn">\gamma = cp * pressure / (eps * \lambda)</code>
</p>

<p>where <code class="reqn">\lambda</code> is the latent heat of vaporization (J kg-1), 
as calculated from <code><a href="#topic+latent.heat.vaporization">latent.heat.vaporization</a></code>.
</p>


<h3>Value</h3>

<p><code class="reqn">\gamma</code> - the psychrometric constant (kPa K-1)
</p>


<h3>References</h3>

<p>Monteith J.L., Unsworth M.H., 2008: Principles of Environmental Physics.
3rd Edition. Academic Press, London.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>psychrometric.constant(seq(5,45,5),100)

</code></pre>

<hr>
<h2 id='radiometric.surface.temp'>Radiometric Surface Temperature</h2><span id='topic+radiometric.surface.temp'></span>

<h3>Description</h3>

<p>Radiometric surface temperature from longwave radiation
measurements.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>radiometric.surface.temp(
  data,
  LW_up = "LW_up",
  LW_down = "LW_down",
  emissivity,
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="radiometric.surface.temp_+3A_data">data</code></td>
<td>
<p>Data.frame or matrix containing all required input variables</p>
</td></tr>
<tr><td><code id="radiometric.surface.temp_+3A_lw_up">LW_up</code></td>
<td>
<p>Longwave upward radiation (W m-2)</p>
</td></tr>
<tr><td><code id="radiometric.surface.temp_+3A_lw_down">LW_down</code></td>
<td>
<p>Longwave downward radiation (W m-2)</p>
</td></tr>
<tr><td><code id="radiometric.surface.temp_+3A_emissivity">emissivity</code></td>
<td>
<p>Emissivity of the surface (-)</p>
</td></tr>
<tr><td><code id="radiometric.surface.temp_+3A_constants">constants</code></td>
<td>
<p>sigma - Stefan-Boltzmann constant (W m-2 K-4) <br />
Kelvin - conversion degree Celsius to Kelvin</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Radiometric surface temperature (Trad) is calculated as:
</p>
<p style="text-align: center;"><code class="reqn">Trad = ((LW_up - (1 - \epsilon)*LW_down) / (\sigma \epsilon))^(1/4)</code>
</p>



<h3>Value</h3>

<p>a data.frame with the following columns:
</p>
<table role = "presentation">
<tr><td><code>Trad_K</code></td>
<td>
<p>Radiometric surface temperature (K)</p>
</td></tr> </table>
<p><br />
</p>
<table role = "presentation">
<tr><td><code>Trad_degC</code></td>
<td>
<p>Radiometric surface temperature (degC)</p>
</td></tr>
</table>


<h3>References</h3>

<p>Wang, W., Liang, S., Meyers, T. 2008: Validating MODIS land surface
temperature products using long-term nighttime ground measurements.
Remote Sensing of Environment 112, 623-635.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># determine radiometric surface temperature for the site DE-Tha in June 2014 
# assuming an emissivity of 0.98.
# (Note that variable 'LW_down' was only included for the DE-Tha example dataset
# and not for the others due restrictions on file size) 
Trad &lt;- radiometric.surface.temp(DE_Tha_Jun_2014,emissivity=0.98)
summary(Trad)

</code></pre>

<hr>
<h2 id='reference.ET'>Reference Evapotranspiration</h2><span id='topic+reference.ET'></span>

<h3>Description</h3>

<p>Reference evapotranspiration calculated from the Penman-Monteith
equation with a prescribed surface conductance.
This function is deprecated. Use potential.ET(...,approach=&quot;Penman-Monteith&quot;) instead.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>reference.ET(
  data,
  Gs_ref = 0.0143,
  Tair = "Tair",
  pressure = "pressure",
  VPD = "VPD",
  Rn = "Rn",
  Ga = "Ga_h",
  G = NULL,
  S = NULL,
  missing.G.as.NA = FALSE,
  missing.S.as.NA = FALSE,
  Esat.formula = c("Sonntag_1990", "Alduchov_1996", "Allen_1998"),
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="reference.ET_+3A_data">data</code></td>
<td>
<p>Data.frame or matrix containing all required variables; optional</p>
</td></tr>
<tr><td><code id="reference.ET_+3A_gs_ref">Gs_ref</code></td>
<td>
<p>Reference surface conductance (m s-1); defaults to 0.0143 m s-1.</p>
</td></tr>
<tr><td><code id="reference.ET_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (degC)</p>
</td></tr>
<tr><td><code id="reference.ET_+3A_pressure">pressure</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
<tr><td><code id="reference.ET_+3A_vpd">VPD</code></td>
<td>
<p>Vapor pressure deficit (kPa)</p>
</td></tr>
<tr><td><code id="reference.ET_+3A_rn">Rn</code></td>
<td>
<p>Net radiation (W m-2)</p>
</td></tr>
<tr><td><code id="reference.ET_+3A_ga">Ga</code></td>
<td>
<p>Aerodynamic conductance to heat/water vapor (m s-1)</p>
</td></tr>
<tr><td><code id="reference.ET_+3A_g">G</code></td>
<td>
<p>Ground heat flux (W m-2); optional</p>
</td></tr>
<tr><td><code id="reference.ET_+3A_s">S</code></td>
<td>
<p>Sum of all storage fluxes (W m-2); optional</p>
</td></tr>
<tr><td><code id="reference.ET_+3A_missing.g.as.na">missing.G.as.NA</code></td>
<td>
<p>if <code>TRUE</code>, missing G are treated as <code>NA</code>s, otherwise set to 0.</p>
</td></tr>
<tr><td><code id="reference.ET_+3A_missing.s.as.na">missing.S.as.NA</code></td>
<td>
<p>if <code>TRUE</code>, missing S are treated as <code>NA</code>s, otherwise set to 0.</p>
</td></tr>
<tr><td><code id="reference.ET_+3A_esat.formula">Esat.formula</code></td>
<td>
<p>Optional: formula to be used for the calculation of esat and the slope of esat.
One of <code>"Sonntag_1990"</code> (Default), <code>"Alduchov_1996"</code>, or <code>"Allen_1998"</code>.
See <code><a href="#topic+Esat.slope">Esat.slope</a></code>.</p>
</td></tr>
<tr><td><code id="reference.ET_+3A_constants">constants</code></td>
<td>
<p>cp - specific heat of air for constant pressure (J K-1 kg-1) <br />
eps - ratio of the molecular weight of water vapor to dry air <br />
Rd - gas constant of dry air (J kg-1 K-1) (only if <code>approach = "Penman-Monteith"</code>) <br />
Rgas - universal gas constant (J mol-1 K-1) (only if <code>approach = "Penman-Monteith"</code>) <br />
Kelvin - conversion degree Celsius to Kelvin (only if <code>approach = "Penman-Monteith"</code>) <br /></p>
</td></tr>
</table>

<hr>
<h2 id='Reynolds.Number'>Roughness Reynolds Number</h2><span id='topic+Reynolds.Number'></span>

<h3>Description</h3>

<p>calculates the Roughness Reynolds Number.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Reynolds.Number(Tair, pressure, ustar, z0m, constants = bigleaf.constants())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Reynolds.Number_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (deg C)</p>
</td></tr>
<tr><td><code id="Reynolds.Number_+3A_pressure">pressure</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
<tr><td><code id="Reynolds.Number_+3A_ustar">ustar</code></td>
<td>
<p>Friction velocity (m s-1)</p>
</td></tr>
<tr><td><code id="Reynolds.Number_+3A_z0m">z0m</code></td>
<td>
<p>Roughness length (m)</p>
</td></tr>
<tr><td><code id="Reynolds.Number_+3A_constants">constants</code></td>
<td>
<p>Kelvin - conversion degree Celsius to Kelvin <br />
pressure0 - reference atmospheric pressure at sea level (Pa) <br />
Tair0 - reference air temperature (K)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The Roughness Reynolds Number is calculated as in Massman 1999a:
</p>
<p style="text-align: center;"><code class="reqn">Re = z0m * ustar / v</code>
</p>

<p>where <code>v</code> is the kinematic viscosity (m2 s-1).
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>Re -</code></td>
<td>
<p>Roughness Reynolds Number (-)</p>
</td></tr>
</table>


<h3>References</h3>

<p>Massman, W.J., 1999a: A model study of kB H- 1 for vegetated surfaces using
'localized near-field' Lagrangian theory. Journal of Hydrology 223, 27-43.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>Reynolds.Number(25,100,0.5,z0m=0.5)                             

</code></pre>

<hr>
<h2 id='Rg.to.PPFD'>Conversions between Global Radiation and Photosynthetic Photon Flux Density</h2><span id='topic+Rg.to.PPFD'></span><span id='topic+PPFD.to.Rg'></span>

<h3>Description</h3>

<p>Converts radiation from W m-2 to umol m-2 s-1 and vice versa.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Rg.to.PPFD(Rg, J_to_mol = 4.6, frac_PAR = 0.5)

PPFD.to.Rg(PPFD, J_to_mol = 4.6, frac_PAR = 0.5)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Rg.to.PPFD_+3A_rg">Rg</code></td>
<td>
<p>Global radiation = incoming short-wave radiation at the surface (W m-2)</p>
</td></tr>
<tr><td><code id="Rg.to.PPFD_+3A_j_to_mol">J_to_mol</code></td>
<td>
<p>Conversion factor from J m-2 s-1 (= W m-2) to umol (quanta) m-2 s-1</p>
</td></tr>
<tr><td><code id="Rg.to.PPFD_+3A_frac_par">frac_PAR</code></td>
<td>
<p>Fraction of incoming solar irradiance that is photosynthetically
active radiation (PAR); defaults to 0.5</p>
</td></tr>
<tr><td><code id="Rg.to.PPFD_+3A_ppfd">PPFD</code></td>
<td>
<p>Photosynthetic photon flux density (umol m-2 s-1)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The conversion is given by:
</p>
<p style="text-align: center;"><code class="reqn">PPFD = Rg * frac_PAR * J_to_mol</code>
</p>

<p>by default, the combined conversion factor (<code>frac_PAR * J_to_mol</code>) is 2.3
</p>


<h3>Examples</h3>

<pre><code class='language-R'># convert a measured incoming short-wave radiation of 500 Wm-2 to
# PPFD in umol m-2 s-1 and backwards
Rg.to.PPFD(500)
PPFD.to.Rg(1150)

</code></pre>

<hr>
<h2 id='roughness.length.heat'>Roughness length for heat</h2><span id='topic+roughness.length.heat'></span>

<h3>Description</h3>

<p>Roughness length for heat (thermal roughness length, z0h) from the 
kB-1 parameter and roughness length for momentum (z0m).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>roughness.length.heat(z0m, kB_h)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="roughness.length.heat_+3A_z0m">z0m</code></td>
<td>
<p>Roughness length for momentum (m)</p>
</td></tr>
<tr><td><code id="roughness.length.heat_+3A_kb_h">kB_h</code></td>
<td>
<p>kB-1 parameter for heat transfer</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The roughness length for heat (z0h) can be calculated from the 
following relationship (e.g. Verma 1989):
</p>
<p style="text-align: center;"><code class="reqn">kB_h = ln(z0m/z0h)</code>
</p>
 
<p>it follows:
</p>
<p style="text-align: center;"><code class="reqn">z0h = z0m / exp(kB_h)</code>
</p>



<h3>Value</h3>

<p>Roughness length for heat, z0h (m)
</p>


<h3>Note</h3>

<p>If unknown, <code>z0m</code> can be calculated from <code><a href="#topic+roughness.parameters">roughness.parameters</a></code>.
<code>kB_h</code> can be calculated from <code><a href="#topic+Gb.Thom">Gb.Thom</a></code>, <code><a href="#topic+Gb.Choudhury">Gb.Choudhury</a></code>, <code><a href="#topic+Gb.Su">Gb.Su</a></code>
or <code><a href="#topic+aerodynamic.conductance">aerodynamic.conductance</a></code>.
</p>


<h3>References</h3>

<p>Verma, S., 1989: Aerodynamic resistances to transfers of heat, mass and momentum.
In: Estimation of areal evapotranspiration, IAHS Pub, 177, 13-20.
</p>
<p>Rigden, A., Li, D., Salvucci, G., 2018: Dependence of thermal roughness length on friction 
velocity across land cover types: A synthesis analysis using AmeriFlux data. Agricultural 
and Forest Meteorology 249, 512-519.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>roughness.length.heat(2,2.5)

</code></pre>

<hr>
<h2 id='roughness.parameters'>Roughness Parameters</h2><span id='topic+roughness.parameters'></span>

<h3>Description</h3>

<p>A simple approximation of the two roughness parameters displacement height (d)
and roughness length for momentum (z0m).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>roughness.parameters(
  method = c("canopy_height", "canopy_height&amp;LAI", "wind_profile"),
  zh,
  frac_d = 0.7,
  frac_z0m = 0.1,
  LAI,
  zr,
  cd = 0.2,
  hs = 0.01,
  data,
  Tair = "Tair",
  pressure = "pressure",
  wind = "wind",
  ustar = "ustar",
  H = "H",
  d = NULL,
  z0m = NULL,
  stab_roughness = TRUE,
  stab_formulation = c("Dyer_1970", "Businger_1971"),
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="roughness.parameters_+3A_method">method</code></td>
<td>
<p>Method to use, one of <code>"canopy_height","canopy_height&amp;LAI","wind_profile"</code> <br />
NOTE: if <code>method = "canopy_height"</code>, only the following three arguments
are used. If <code>method = "canopy_height&amp;LAI"</code>, only <code>zh, LAI, cd</code>, 
and <code>hs</code> are required.</p>
</td></tr>
<tr><td><code id="roughness.parameters_+3A_zh">zh</code></td>
<td>
<p>Vegetation height (m)</p>
</td></tr>
<tr><td><code id="roughness.parameters_+3A_frac_d">frac_d</code></td>
<td>
<p>Fraction of displacement height on canopy height (-)</p>
</td></tr>
<tr><td><code id="roughness.parameters_+3A_frac_z0m">frac_z0m</code></td>
<td>
<p>Fraction of roughness length on canopy height (-)</p>
</td></tr>
<tr><td><code id="roughness.parameters_+3A_lai">LAI</code></td>
<td>
<p>Leaf area index (-)</p>
</td></tr>
<tr><td><code id="roughness.parameters_+3A_zr">zr</code></td>
<td>
<p>Instrument (reference) height (m)</p>
</td></tr>
<tr><td><code id="roughness.parameters_+3A_cd">cd</code></td>
<td>
<p>Mean drag coefficient for individual leaves. Defaults to 0.2. 
Only needed if <code>method = "canopy_height&amp;LAI"</code>.</p>
</td></tr>
<tr><td><code id="roughness.parameters_+3A_hs">hs</code></td>
<td>
<p>roughness length of the soil surface (m). Only needed if <code>method = "canopy_height&amp;LAI"</code>
The following arguments are only needed if <code>method = "wind_profile"</code>!</p>
</td></tr>
<tr><td><code id="roughness.parameters_+3A_data">data</code></td>
<td>
<p>Data.frame or matrix containing all required variables</p>
</td></tr>
<tr><td><code id="roughness.parameters_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (deg C)</p>
</td></tr>
<tr><td><code id="roughness.parameters_+3A_pressure">pressure</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
<tr><td><code id="roughness.parameters_+3A_wind">wind</code></td>
<td>
<p>Wind speed at height zr (m s-1)</p>
</td></tr>
<tr><td><code id="roughness.parameters_+3A_ustar">ustar</code></td>
<td>
<p>Friction velocity (m s-1)</p>
</td></tr>
<tr><td><code id="roughness.parameters_+3A_h">H</code></td>
<td>
<p>Sensible heat flux (W m-2)</p>
</td></tr>
<tr><td><code id="roughness.parameters_+3A_d">d</code></td>
<td>
<p>Zero-plane displacement height (m); optional</p>
</td></tr>
<tr><td><code id="roughness.parameters_+3A_z0m">z0m</code></td>
<td>
<p>Roughness length for momentum (m); optional</p>
</td></tr>
<tr><td><code id="roughness.parameters_+3A_stab_roughness">stab_roughness</code></td>
<td>
<p>Should stability correction be considered? Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="roughness.parameters_+3A_stab_formulation">stab_formulation</code></td>
<td>
<p>Stability correction function used (If <code>stab_correction = TRUE</code>).
Either <code>"Dyer_1970"</code> or <code>"Businger_1971"</code>.</p>
</td></tr>
<tr><td><code id="roughness.parameters_+3A_constants">constants</code></td>
<td>
<p>k - von-Karman constant (-) <br />
Kelvin - conversion degree Celsius to Kelvin <br />
cp - specific heat of air for constant pressure (J K-1 kg-1) <br />
g - gravitational acceleration (m s-2) <br />
se_median - conversion standard error (SE) of the mean to SE of the median</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The two main roughness parameters, the displacement height (d)
and the roughness length for momentum (z0m) can be estimated from simple
empirical relationships with canopy height (zh). If <code>method = "canopy_height"</code>,
the following formulas are used:  
</p>
<p style="text-align: center;"><code class="reqn">d = frac_d * zh</code>
</p>

<p style="text-align: center;"><code class="reqn">z0m = frac_z0m * zh</code>
</p>

<p>where frac_d defaults to 0.7 and frac_z0m to 0.1.
</p>
<p>Alternatively, d and z0m can be estimated from both canopy height and LAI
(If <code>method = "canopy_height&amp;LAI"</code>).
Based on data from Shaw &amp; Pereira 1982, Choudhury &amp; Monteith 1988 proposed 
the following semi-empirical relations:
</p>
<p style="text-align: center;"><code class="reqn">X = cd * LAI</code>
</p>

<p style="text-align: center;"><code class="reqn">d = 1.1 * zh * ln(1 + X^(1/4))</code>
</p>
 
<p style="text-align: center;"><code class="reqn">z0m = hs + 0.3 * zh * X^(1/2)   for 0 &lt;= X &lt;= 0.2</code>
</p>

<p style="text-align: center;"><code class="reqn">z0m = hs * zh * (1 - d/zh)   for 0.2 &lt; X</code>
</p>
 
<p>If <code>method = "wind_profile"</code>, z0m is estimated by solving
the wind speed profile for z0m:
</p>
<p style="text-align: center;"><code class="reqn">z0m = median((zr - d) * exp(-k*wind / ustar - psi_m)</code>
</p>

<p>By default, d in this equation is fixed to 0.7*zh, but can be set to any
other value. psi_m is 0 if <code>stab_roughness = FALSE</code>.
</p>


<h3>Value</h3>

<p>a data.frame with the following columns:
</p>
<table role = "presentation">
<tr><td><code>d</code></td>
<td>
<p>Zero-plane displacement height (m)</p>
</td></tr>
<tr><td><code>z0m</code></td>
<td>
<p>Roughness length for momentum (m)</p>
</td></tr>
<tr><td><code>z0m_se</code></td>
<td>
<p>Only if <code>method = wind_profile</code>: Standard Error of the median for z0m (m)</p>
</td></tr>
</table>


<h3>References</h3>

<p>Choudhury, B. J., Monteith J.L., 1988: A four-layer model for the heat
budget of homogeneous land surfaces. Q. J. R. Meteorol. Soc. 114, 373-398.
</p>
<p>Shaw, R. H., Pereira, A., 1982: Aerodynamic roughness of a plant canopy: 
a numerical experiment. Agricultural Meteorology, 26, 51-65.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+wind.profile">wind.profile</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># estimate d and z0m from canopy height for a dense (LAI=5) and open (LAI=2) canopy
roughness.parameters(method="canopy_height&amp;LAI",zh=25,LAI=5)
roughness.parameters(method="canopy_height&amp;LAI",zh=25,LAI=2)   
   
# fix d to 0.7*zh and estimate z0m from the wind profile
df &lt;- data.frame(Tair=c(25,25,25),pressure=100,wind=c(3,4,5),ustar=c(0.5,0.6,0.65),H=200)
roughness.parameters(method="wind_profile",zh=25,zr=40,frac_d=0.7,data=df)

# assume d = 0.8*zh
roughness.parameters(method="wind_profile",zh=25,zr=40,frac_d=0.8,data=df) 

</code></pre>

<hr>
<h2 id='stability.correction'>Integrated Stability Correction Functions for Heat and Momentum</h2><span id='topic+stability.correction'></span>

<h3>Description</h3>

<p>dimensionless stability functions needed to correct deviations
from the exponential wind profile under non-neutral conditions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stability.correction(zeta, formulation = c("Dyer_1970", "Businger_1971"))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="stability.correction_+3A_zeta">zeta</code></td>
<td>
<p>Stability parameter zeta (-)</p>
</td></tr>
<tr><td><code id="stability.correction_+3A_formulation">formulation</code></td>
<td>
<p>Formulation for the stability function. Either <code>"Dyer_1970"</code>, 
or <code>"Businger_1971"</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The functions give the integrated form of the universal functions. They
depend on the value of the stability parameter <code class="reqn">\zeta</code>,
which can be calculated from the function <code><a href="#topic+stability.parameter">stability.parameter</a></code>.
The integration of the universal functions is:
</p>
<p style="text-align: center;"><code class="reqn">\psi = -x * zeta</code>
</p>
 
<p>for stable atmospheric conditions (<code class="reqn">\zeta</code> &gt;= 0), and
</p>
<p style="text-align: center;"><code class="reqn">\psi = 2 * log( (1 + y) / 2) </code>
</p>

<p>for unstable atmospheric conditions (<code class="reqn">\zeta</code> &lt; 0).
</p>
<p>The different formulations differ in their value of x and y.
</p>


<h3>Value</h3>

<p>a data.frame with the following columns:
</p>
<table role = "presentation">
<tr><td><code>psi_h</code></td>
<td>
<p>the value of the stability function for heat and water vapor (-)</p>
</td></tr>
<tr><td><code>psi_m</code></td>
<td>
<p>the value of the stability function for momentum (-)</p>
</td></tr>
</table>


<h3>References</h3>

<p>Dyer, A.J., 1974: A review of flux-profile relationships. 
Boundary-Layer Meteorology 7, 363-372.
</p>
<p>Dyer, A. J., Hicks, B.B., 1970: Flux-Gradient relationships in the
constant flux layer. Quart. J. R. Meteorol. Soc. 96, 715-721.
</p>
<p>Businger, J.A., Wyngaard, J. C., Izumi, I., Bradley, E. F., 1971:
Flux-Profile relationships in the atmospheric surface layer. 
J. Atmospheric Sci. 28, 181-189.
</p>
<p>Paulson, C.A., 1970: The mathematical representation of wind speed
and temperature profiles in the unstable atmospheric surface layer.
Journal of Applied Meteorology 9, 857-861.
</p>
<p>Foken, T, 2008: Micrometeorology. Springer, Berlin, Germany.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>zeta &lt;- seq(-2,0.5,0.05)
stability.correction(zeta)
stability.correction(zeta,formulation="Businger_1971")                          
            
</code></pre>

<hr>
<h2 id='stability.parameter'>Stability Parameter &quot;zeta&quot;</h2><span id='topic+stability.parameter'></span>

<h3>Description</h3>

<p>calculates &quot;zeta&quot;, a parameter characterizing stratification in 
the lower atmosphere.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stability.parameter(
  data,
  Tair = "Tair",
  pressure = "pressure",
  ustar = "ustar",
  H = "H",
  zr,
  d,
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="stability.parameter_+3A_data">data</code></td>
<td>
<p>Data.frame or matrix containing all required variables</p>
</td></tr>
<tr><td><code id="stability.parameter_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (degC)</p>
</td></tr>
<tr><td><code id="stability.parameter_+3A_pressure">pressure</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
<tr><td><code id="stability.parameter_+3A_ustar">ustar</code></td>
<td>
<p>Friction velocity (m s-1)</p>
</td></tr>
<tr><td><code id="stability.parameter_+3A_h">H</code></td>
<td>
<p>Sensible heat flux (W m-2)</p>
</td></tr>
<tr><td><code id="stability.parameter_+3A_zr">zr</code></td>
<td>
<p>Instrument (reference) height (m)</p>
</td></tr>
<tr><td><code id="stability.parameter_+3A_d">d</code></td>
<td>
<p>Zero-plane displacement height (m)</p>
</td></tr>
<tr><td><code id="stability.parameter_+3A_constants">constants</code></td>
<td>
<p>Kelvin - conversion degree Celsius to Kelvin <br />
cp - specific heat of air for constant pressure (J K-1 kg-1) <br />
k - von Karman constant (-) <br />
g - gravitational acceleration (m s-2)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The stability parameter <code class="reqn">\zeta</code> is given by:
</p>
<p style="text-align: center;"><code class="reqn">\zeta = (zr - d) / L</code>
</p>

<p>where L is the Monin-Obukhov length (m), calculated from the function
<code><a href="#topic+Monin.Obukhov.length">Monin.Obukhov.length</a></code>. The displacement height d can 
be estimated from the function <code><a href="#topic+roughness.parameters">roughness.parameters</a></code>.
</p>


<h3>Value</h3>

<p><code class="reqn">\zeta</code> - stability parameter zeta (-)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>df &lt;- data.frame(Tair=25,pressure=100,ustar=seq(0.2,1,0.1),H=seq(40,200,20))
stability.parameter(df,zr=40,d=15)

</code></pre>

<hr>
<h2 id='stomatal.sensitivity'>Stomatal Sensitivity to VPD</h2><span id='topic+stomatal.sensitivity'></span>

<h3>Description</h3>

<p>Sensitivity of surface conductance to vapor pressure deficit.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stomatal.sensitivity(data, Gs = "Gs_mol", VPD = "VPD", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="stomatal.sensitivity_+3A_data">data</code></td>
<td>
<p>Data.frame or matrix containing all required columns</p>
</td></tr>
<tr><td><code id="stomatal.sensitivity_+3A_gs">Gs</code></td>
<td>
<p>Surface conductance to water vapor (mol m-2 s-1)</p>
</td></tr>
<tr><td><code id="stomatal.sensitivity_+3A_vpd">VPD</code></td>
<td>
<p>Vapor pressure deficit (kPa)</p>
</td></tr>
<tr><td><code id="stomatal.sensitivity_+3A_...">...</code></td>
<td>
<p>Additional arguments to <code><a href="stats.html#topic+nls">nls</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function fits the following equation (Oren et al. 1999):
</p>
<p style="text-align: center;"><code class="reqn">Gs = -m ln(VPD) + b</code>
</p>

<p>where b is the reference surface conductance (Gs) at VPD=1kPa (in mol m-2 s-1),
and m is the sensitivity parameter of Gs to VPD (in mol m-2 s-1 log(kPa)-1).
The two parameters b and m are fitted using <code><a href="stats.html#topic+nls">nls</a></code>.
VPD can be the one directly measured at instrument height, or the
one at the surface, as returned by <code><a href="#topic+surface.conditions">surface.conditions</a></code>.
</p>


<h3>Value</h3>

<p>A <code>nls</code> model object containing (amongst others) estimates for the mean
and standard errors of the parameters m and b.
</p>


<h3>References</h3>

<p>Oren R., et al. 1999: Survey and synthesis of intra- and interspecific
variation in stomatal sensitivity to vapour pressure deficit. Plant,
Cell &amp; Environment 22, 1515-1526. 
</p>
<p>Novick K.A., et al. 2016: The increasing importance of atmospheric demand
for ecosystem water and carbon fluxes. Nature Climate Change 6, 1023 - 1027.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+surface.conductance">surface.conductance</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## calculate Ga, Gs, and the stomatal sensitivity to VPD for the site FR-Pue in
## May 2012. Data are filtered for daytime, sufficiently high ustar, etc.
FR_Pue_May_2012_2 &lt;- filter.data(FR_Pue_May_2012,quality.control=TRUE,
                                 vars.qc=c("Tair","precip","H","LE"),
                                 filter.growseas=FALSE,filter.precip=TRUE,
                                 filter.vars=c("Tair","PPFD","ustar","VPD"),
                                 filter.vals.min=c(5,200,0.2,0.3),
                                 filter.vals.max=c(NA,NA,NA,NA),
                                 NA.as.invalid=TRUE,quality.ext="_qc",
                                 good.quality=c(0,1),missing.qc.as.bad=TRUE,
                                 precip="precip",tprecip=0.1,precip.hours=24,
                                 records.per.hour=2)
Ga &lt;- aerodynamic.conductance(FR_Pue_May_2012_2)
Gs &lt;- surface.conductance(FR_Pue_May_2012_2,Ga=Ga[,"Ga_h"])
stomatal.sensitivity(FR_Pue_May_2012_2,Gs=Gs[,"Gs_mol"],VPD="VPD")

</code></pre>

<hr>
<h2 id='stomatal.slope'>Stomatal Slope Parameter &quot;g1&quot;</h2><span id='topic+stomatal.slope'></span>

<h3>Description</h3>

<p>Estimation of the intrinsic WUE metric &quot;g1&quot; (stomatal slope) 
from nonlinear regression.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stomatal.slope(
  data,
  Tair = "Tair",
  pressure = "pressure",
  GPP = "GPP",
  Gs = "Gs_mol",
  VPD = "VPD",
  Ca = "Ca",
  Rleaf = NULL,
  model = c("USO", "Ball&amp;Berry", "Leuning"),
  robust.nls = FALSE,
  nmin = 40,
  fitg0 = FALSE,
  g0 = 0,
  fitD0 = FALSE,
  D0 = 1.5,
  Gamma = 50,
  missing.Rleaf.as.NA = FALSE,
  constants = bigleaf.constants(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="stomatal.slope_+3A_data">data</code></td>
<td>
<p>Data.frame or matrix containing all required columns</p>
</td></tr>
<tr><td><code id="stomatal.slope_+3A_tair">Tair</code></td>
<td>
<p>Air (or surface) temperature (deg C)</p>
</td></tr>
<tr><td><code id="stomatal.slope_+3A_pressure">pressure</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
<tr><td><code id="stomatal.slope_+3A_gpp">GPP</code></td>
<td>
<p>Gross primary productivity (umol CO2 m-2 s-1)</p>
</td></tr>
<tr><td><code id="stomatal.slope_+3A_gs">Gs</code></td>
<td>
<p>Surface conductance to water vapor (mol m-2 s-1)</p>
</td></tr>
<tr><td><code id="stomatal.slope_+3A_vpd">VPD</code></td>
<td>
<p>Vapor pressure deficit (kPa)</p>
</td></tr>
<tr><td><code id="stomatal.slope_+3A_ca">Ca</code></td>
<td>
<p>Atmospheric CO2 concentration (air or surface) (umol mol-1)</p>
</td></tr>
<tr><td><code id="stomatal.slope_+3A_rleaf">Rleaf</code></td>
<td>
<p>Ecosystem respiration stemming from leaves (umol CO2 m-2 s-1); defaults to 0</p>
</td></tr>
<tr><td><code id="stomatal.slope_+3A_model">model</code></td>
<td>
<p>Stomatal model used. One of <code>"USO","Ball&amp;Berry","Leuning"</code>.</p>
</td></tr>
<tr><td><code id="stomatal.slope_+3A_robust.nls">robust.nls</code></td>
<td>
<p>Use robust nonlinear regression (<code><a href="robustbase.html#topic+nlrob">nlrob</a></code>)? Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="stomatal.slope_+3A_nmin">nmin</code></td>
<td>
<p>Minimum number of data required to perform the fit; defaults to 40.</p>
</td></tr>
<tr><td><code id="stomatal.slope_+3A_fitg0">fitg0</code></td>
<td>
<p>Should g0 and g1 be fitted simultaneously?</p>
</td></tr>
<tr><td><code id="stomatal.slope_+3A_g0">g0</code></td>
<td>
<p>Minimum stomatal conductance (mol m-2 s-1); ignored if <code>fitg0 = TRUE</code>.</p>
</td></tr>
<tr><td><code id="stomatal.slope_+3A_fitd0">fitD0</code></td>
<td>
<p>Should D0 be fitted along with g1 (and g0 if <code>fitg0 = TRUE</code>)?; only used if <code>model = "Leuning"</code>.</p>
</td></tr>
<tr><td><code id="stomatal.slope_+3A_d0">D0</code></td>
<td>
<p>Stomatal sensitivity parameter to VPD; only used if <code>model = "Leuning"</code> and <code>fitD0 = FALSE</code>.</p>
</td></tr>
<tr><td><code id="stomatal.slope_+3A_gamma">Gamma</code></td>
<td>
<p>Canopy CO2 compensation point (umol mol-1); only used if <code>model = "Leuning"</code>. 
Can be a constant or a variable. Defaults to 50 umol mol-1.</p>
</td></tr>
<tr><td><code id="stomatal.slope_+3A_missing.rleaf.as.na">missing.Rleaf.as.NA</code></td>
<td>
<p>if Rleaf is provided, should missing values be treated as <code>NA</code> (<code>TRUE</code>)
or set to 0 (<code>FALSE</code>, the default)?</p>
</td></tr>
<tr><td><code id="stomatal.slope_+3A_constants">constants</code></td>
<td>
<p>Kelvin - conversion degree Celsius to Kelvin <br />
Rgas - universal gas constant (J mol-1 K-1) <br />
DwDc - Ratio of the molecular diffusivities for water vapor and CO2</p>
</td></tr>
<tr><td><code id="stomatal.slope_+3A_...">...</code></td>
<td>
<p>Additional arguments to <code><a href="stats.html#topic+nls">nls</a></code> or <code><a href="robustbase.html#topic+nlrob">nlrob</a></code> if <code>robust.nls = TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>All stomatal models were developed at leaf-level, but its parameters 
can also be estimated at ecosystem level (but be aware of caveats).
</p>
<p>The unified stomatal optimization (USO) model is given by (Medlyn et al. 2011):
</p>
<p style="text-align: center;"><code class="reqn">gs = g0 + 1.6*(1.0 + g1/sqrt(VPD)) * An/ca</code>
</p>

<p>The semi-empirical model by Ball et al. 1987 is defined as:
</p>
<p style="text-align: center;"><code class="reqn">gs = g0 + g1* ((An * rH) / ca)</code>
</p>

<p>Leuning 1995 suggested a revised version of the Ball&amp;Berry model:
</p>
<p style="text-align: center;"><code class="reqn">gs = g0 + g1*An / ((ca - \Gamma) * (1 + VPD/D0))</code>
</p>

<p>where <code class="reqn">\Gamma</code> is by default assumed to be constant, but likely varies with temperature and among
plant species. 
The equations above are valid at leaf-level. At ecosystem level, An is replaced by GPP (or GPP - Rleaf,
where Rleaf is leaf respiration), and gs (stomatal conductance) by Gs (surface conductance). 
The parameters in the models are estimated using nonlinear regression (<code><a href="stats.html#topic+nls">nls</a></code>) if
<code>robust.nls = FALSE</code> and weighted nonlinear regression if <code>robust.nls = TRUE</code>.
The weights are calculated from <code><a href="robustbase.html#topic+nlrob">nlrob</a></code>, and <code><a href="stats.html#topic+nls">nls</a></code>
is used for the actual fitting.
Alternatively to measured VPD and Ca (i.e. conditions at instrument height), conditions at 
the big-leaf surface can be provided. Those can be calculated using <code><a href="#topic+surface.conditions">surface.conditions</a></code>.
</p>


<h3>Value</h3>

<p>A <code>nls</code> model object, containing information on the fitted parameters, their uncertainty range,
model fit, etc.
</p>


<h3>References</h3>

<p>Medlyn B.E., et al., 2011: Reconciling the optimal and empirical approaches to
modelling stomatal conductance. Global Change Biology 17, 2134-2144.
</p>
<p>Ball T.J., Woodrow I.E., Berry J.A. 1987: A model predicting stomatal conductance
and its contribution to the control of photosynthesis under different environmental conditions.
In: Progress in Photosynthesis Research, edited by J.Biggins, pp. 221-224, Martinus Nijhoff Publishers,
Dordrecht, Netherlands.
</p>
<p>Leuning R., 1995: A critical appraisal of a combined stomatal-photosynthesis
model for C3 plants. Plant, Cell and Environment 18, 339-355.
</p>
<p>Knauer, J. et al., 2018: Towards physiologically meaningful water-use efficiency estimates
from eddy covariance data. Global Change Biology 24, 694-710.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+surface.conductance">surface.conductance</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## filter data to ensure that Gs is a meaningful proxy to canopy conductance (Gc)
DE_Tha_Jun_2014_2 &lt;- filter.data(DE_Tha_Jun_2014,quality.control=FALSE,
                                 vars.qc=c("Tair","precip","VPD","H","LE"),
                                 filter.growseas=FALSE,filter.precip=TRUE,
                                 filter.vars=c("Tair","PPFD","ustar","LE"),
                                 filter.vals.min=c(5,200,0.2,0),
                                 filter.vals.max=c(NA,NA,NA,NA),NA.as.invalid=TRUE,
                                 quality.ext="_qc",good.quality=c(0,1),
                                 missing.qc.as.bad=TRUE,GPP="GPP",doy="doy",
                                 year="year",tGPP=0.5,ws=15,min.int=5,precip="precip",
                                 tprecip=0.1,precip.hours=24,records.per.hour=2)

# calculate Gs from the the inverted PM equation
Ga &lt;- aerodynamic.conductance(DE_Tha_Jun_2014_2,Rb_model="Thom_1972")[,"Ga_h"]

# if G and/or S are available, don't forget to indicate (they are ignored by default).
Gs_PM &lt;- surface.conductance(DE_Tha_Jun_2014_2,Tair="Tair",pressure="pressure",
                             Rn="Rn",G="G",S=NULL,VPD="VPD",Ga=Ga,
                             formulation="Penman-Monteith")[,"Gs_mol"]
                             
### Estimate the stomatal slope parameter g1 using the USO model
mod_USO &lt;- stomatal.slope(DE_Tha_Jun_2014_2,model="USO",GPP="GPP",Gs=Gs_PM,
                          robust.nls=FALSE,nmin=40,fitg0=FALSE)
                          
### Use robust regression to minimize influence of outliers in Gs                           
mod_USO &lt;- stomatal.slope(DE_Tha_Jun_2014_2,model="USO",GPP="GPP",Gs=Gs_PM,
                          robust.nls=TRUE,nmin=40,fitg0=FALSE)

### Estimate the same parameter from the Ball&amp;Berry model and prescribe g0
mod_BB &lt;- stomatal.slope(DE_Tha_Jun_2014_2,model="Ball&amp;Berry",GPP="GPP",
                         robust.nls=FALSE,Gs=Gs_PM,g0=0.01,nmin=40,fitg0=FALSE)

## same for the Leuning model, but this time estimate both g1 and g0 (but fix D0)
mod_Leu &lt;- stomatal.slope(DE_Tha_Jun_2014_2,model="Leuning",GPP="GPP",Gs=Gs_PM,
                          robust.nls=FALSE,nmin=40,fitg0=FALSE,D0=1.5,fitD0=FALSE)

</code></pre>

<hr>
<h2 id='surface.CO2'>CO2 Concentration at the Canopy Surface</h2><span id='topic+surface.CO2'></span>

<h3>Description</h3>

<p>the CO2 concentration at the canopy surface derived from net ecosystem
CO2 exchange and measured atmospheric CO2 concentration.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>surface.CO2(Ca, NEE, Ga_CO2, Tair, pressure)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="surface.CO2_+3A_ca">Ca</code></td>
<td>
<p>Atmospheric CO2 concentration (umol mol-1)</p>
</td></tr>
<tr><td><code id="surface.CO2_+3A_nee">NEE</code></td>
<td>
<p>Net ecosystem exchange (umol CO2 m-2 s-1)</p>
</td></tr>
<tr><td><code id="surface.CO2_+3A_ga_co2">Ga_CO2</code></td>
<td>
<p>Aerodynamic conductance for CO2 (m s-1)</p>
</td></tr>
<tr><td><code id="surface.CO2_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (degC)</p>
</td></tr>
<tr><td><code id="surface.CO2_+3A_pressure">pressure</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>CO2 concentration at the canopy surface is calculated as:
</p>
<p style="text-align: center;"><code class="reqn">Ca_surf = Ca + NEE / Ga_CO2</code>
</p>

<p>Note that this equation can be used for any gas measured (with NEE
replaced by the net exchange of the respective gas and Ga_CO2 by the Ga of 
that gas).
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>Ca_surf -</code></td>
<td>
<p>CO2 concentration at the canopy surface (umol mol-1)</p>
</td></tr>
</table>


<h3>Note</h3>

<p>the following sign convention is employed: negative values of NEE denote
net CO2 uptake by the ecosystem.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>surface.CO2(Ca=400,NEE=-30,Ga_CO2=0.05,Tair=25,pressure=100)

</code></pre>

<hr>
<h2 id='surface.conditions'>Big-Leaf Surface Conditions</h2><span id='topic+surface.conditions'></span>

<h3>Description</h3>

<p>Calculates meteorological conditions at the big-leaf surface
by inverting bulk transfer equations for water, energy, and carbon
fluxes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>surface.conditions(
  data,
  Tair = "Tair",
  pressure = "pressure",
  LE = "LE",
  H = "H",
  VPD = "VPD",
  Ga = "Ga_h",
  calc.surface.CO2 = FALSE,
  Ca = "Ca",
  Ga_CO2 = "Ga_CO2",
  NEE = "NEE",
  Esat.formula = c("Sonntag_1990", "Alduchov_1996", "Allen_1998"),
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="surface.conditions_+3A_data">data</code></td>
<td>
<p>Data.frame or matrix containing all required input variables</p>
</td></tr>
<tr><td><code id="surface.conditions_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (deg C)</p>
</td></tr>
<tr><td><code id="surface.conditions_+3A_pressure">pressure</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
<tr><td><code id="surface.conditions_+3A_le">LE</code></td>
<td>
<p>Latent heat flux (W m-2)</p>
</td></tr>
<tr><td><code id="surface.conditions_+3A_h">H</code></td>
<td>
<p>Sensible heat flux (W m-2)</p>
</td></tr>
<tr><td><code id="surface.conditions_+3A_vpd">VPD</code></td>
<td>
<p>Vapor pressure deficit (kPa)</p>
</td></tr>
<tr><td><code id="surface.conditions_+3A_ga">Ga</code></td>
<td>
<p>Aerodynamic conductance for heat/water vapor (m s-1)</p>
</td></tr>
<tr><td><code id="surface.conditions_+3A_calc.surface.co2">calc.surface.CO2</code></td>
<td>
<p>Calculate surface CO2 concentration? Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="surface.conditions_+3A_ca">Ca</code></td>
<td>
<p>Atmospheric CO2 concentration (mol mol-1). Required if <code>calc.surface.CO2 = TRUE</code>.</p>
</td></tr>
<tr><td><code id="surface.conditions_+3A_ga_co2">Ga_CO2</code></td>
<td>
<p>Aerodynamic conductance for CO2 (m s-1). Required if <code>calc.surface.CO2 = TRUE</code>.</p>
</td></tr>
<tr><td><code id="surface.conditions_+3A_nee">NEE</code></td>
<td>
<p>Net ecosystem exchange (umol m-2 s-1). Required if <code>calc.surface.CO2 = TRUE</code>.</p>
</td></tr>
<tr><td><code id="surface.conditions_+3A_esat.formula">Esat.formula</code></td>
<td>
<p>Optional: formula to be used for the calculation of esat and the slope of esat.
One of <code>"Sonntag_1990"</code> (Default), <code>"Alduchov_1996"</code>, or <code>"Allen_1998"</code>.
See <code><a href="#topic+Esat.slope">Esat.slope</a></code>.</p>
</td></tr>
<tr><td><code id="surface.conditions_+3A_constants">constants</code></td>
<td>
<p>cp - specific heat of air for constant pressure (J K-1 kg-1) <br /> 
eps - ratio of the molecular weight of water vapor to dry air (-) <br />
Pa2kPa - conversion pascal (Pa) to kilopascal (kPa)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Canopy surface temperature and humidity are calculated by inverting bulk transfer equations of
sensible and latent heat, respectively. 'Canopy surface' in this case refers to 
the surface of the big-leaf (i.e. at height d + z0h; the apparent sink of sensible heat and water vapor).
Aerodynamic canopy surface temperature is given by:
</p>
<p style="text-align: center;"><code class="reqn">Tsurf = Tair + H / (\rho * cp * Ga)</code>
</p>

<p>where <code class="reqn">\rho</code> is air density (kg m-3). 
Vapor pressure at the canopy surface is:
</p>
<p style="text-align: center;"><code class="reqn">esurf = e + (LE * \gamma)/(Ga * \rho * cp)</code>
</p>

<p>where <code class="reqn">\gamma</code> is the psychrometric constant (kPa K-1).
Vapor pressure deficit (VPD) at the canopy surface is calculated as:
</p>
<p style="text-align: center;"><code class="reqn">VPD_surf = Esat_surf - esurf</code>
</p>

<p>CO2 concentration at the canopy surface is given by:
</p>
<p style="text-align: center;"><code class="reqn">Ca_surf = Ca + NEE / Ga_CO2</code>
</p>

<p>Note that Ga is assumed to be equal for water vapor and sensible heat.
Ga is further assumed to be the inverse of the sum of the turbulent part
and the canopy boundary layer conductance (1/Ga = 1/Ga_m + 1/Gb; 
see <code><a href="#topic+aerodynamic.conductance">aerodynamic.conductance</a></code>). Ga_CO2, the aerodynamic conductance
for CO2 is also calculated by <code><a href="#topic+aerodynamic.conductance">aerodynamic.conductance</a></code>.
If Ga is replaced by Ga_m (i.e. only the turbulent conductance part), 
the results of the functions represent conditions outside the canopy
boundary layer, i.e. in the canopy airspace.
</p>


<h3>Value</h3>

<p>a data.frame with the following columns:
</p>
<table role = "presentation">
<tr><td><code>Tsurf</code></td>
<td>
<p>Surface temperature (deg C)</p>
</td></tr> </table>
<p><br />
</p>
<table role = "presentation">
<tr><td><code>esat_surf</code></td>
<td>
<p>Saturation vapor pressure at the surface (kPa)</p>
</td></tr> </table>
<p><br />
</p>
<table role = "presentation">
<tr><td><code>esurf</code></td>
<td>
<p>vapor pressure at the surface (kPa)</p>
</td></tr> </table>
<p><br />
</p>
<table role = "presentation">
<tr><td><code>VPD_surf</code></td>
<td>
<p>vapor pressure deficit at the surface (kPa)</p>
</td></tr> </table>
<p><br />
</p>
<table role = "presentation">
<tr><td><code>qsurf</code></td>
<td>
<p>specific humidity at the surface (kg kg-1)</p>
</td></tr> </table>
<p><br />
</p>
<table role = "presentation">
<tr><td><code>rH_surf</code></td>
<td>
<p>relative humidity at the surface (-)</p>
</td></tr> </table>
<p><br />
</p>
<table role = "presentation">
<tr><td><code>Ca_surf</code></td>
<td>
<p>CO2 concentration at the surface (umol mol-1)</p>
</td></tr>
</table>


<h3>Note</h3>

<p>The following sign convention for NEE is employed (relevant if 
<code>calc.surface.CO2 = TRUE</code>): 
negative values of NEE denote net CO2 uptake by the ecosystem.
</p>


<h3>References</h3>

<p>Knauer, J. et al., 2018: Towards physiologically meaningful water-use efficiency estimates
from eddy covariance data. Global Change Biology 24, 694-710.
</p>
<p>Blanken, P.D. &amp; Black, T.A., 2004: The canopy conductance of a boreal aspen forest,
Prince Albert National Park, Canada. Hydrological Processes 18, 1561-1578.
</p>
<p>Shuttleworth, W. J., Wallace, J.S., 1985: Evaporation from sparse crops-
an energy combination theory. Quart. J. R. Met. Soc. 111, 839-855.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># calculate surface temperature, water vapor, VPD etc. at the surface
# for a given temperature and turbulent fluxes, and under different 
# aerodynamic conductance.
surface.conditions(Tair=25,pressure=100,LE=100,H=200,VPD=1.2,Ga=c(0.02,0.05,0.1)) 
         
# now calculate also surface CO2 concentration
surface.conditions(Tair=25,pressure=100,LE=100,H=200,VPD=1.2,Ga=c(0.02,0.05,0.1),
                   Ca=400,Ga_CO2=c(0.02,0.05,0.1),NEE=-20,calc.surface.CO2=TRUE)
                   
</code></pre>

<hr>
<h2 id='surface.conductance'>Surface Conductance to Water Vapor</h2><span id='topic+surface.conductance'></span>

<h3>Description</h3>

<p>Calculates surface conductance to water vapor from the inverted Penman-Monteith
equation (by default) or from a simple flux-gradient approach.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>surface.conductance(
  data,
  Tair = "Tair",
  pressure = "pressure",
  Rn = "Rn",
  G = NULL,
  S = NULL,
  VPD = "VPD",
  LE = "LE",
  Ga = "Ga_h",
  missing.G.as.NA = FALSE,
  missing.S.as.NA = FALSE,
  formulation = c("Penman-Monteith", "Flux-Gradient"),
  Esat.formula = c("Sonntag_1990", "Alduchov_1996", "Allen_1998"),
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="surface.conductance_+3A_data">data</code></td>
<td>
<p>Data.frame or matrix containing all required input variables</p>
</td></tr>
<tr><td><code id="surface.conductance_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (deg C)</p>
</td></tr>
<tr><td><code id="surface.conductance_+3A_pressure">pressure</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
<tr><td><code id="surface.conductance_+3A_rn">Rn</code></td>
<td>
<p>Net radiation (W m-2)</p>
</td></tr>
<tr><td><code id="surface.conductance_+3A_g">G</code></td>
<td>
<p>Ground heat flux (W m-2); optional</p>
</td></tr>
<tr><td><code id="surface.conductance_+3A_s">S</code></td>
<td>
<p>Sum of all storage fluxes (W m-2); optional</p>
</td></tr>
<tr><td><code id="surface.conductance_+3A_vpd">VPD</code></td>
<td>
<p>Vapor pressure deficit (kPa)</p>
</td></tr>
<tr><td><code id="surface.conductance_+3A_le">LE</code></td>
<td>
<p>Latent heat flux (W m-2)</p>
</td></tr>
<tr><td><code id="surface.conductance_+3A_ga">Ga</code></td>
<td>
<p>Aerodynamic conductance to heat/water vapor (m s-1)</p>
</td></tr>
<tr><td><code id="surface.conductance_+3A_missing.g.as.na">missing.G.as.NA</code></td>
<td>
<p>if <code>TRUE</code>, missing G are treated as <code>NA</code>s, otherwise they are set to 0.
Only used if <code>formulation = "Penman-Monteith"</code>.</p>
</td></tr>
<tr><td><code id="surface.conductance_+3A_missing.s.as.na">missing.S.as.NA</code></td>
<td>
<p>if <code>TRUE</code>, missing S are treated as <code>NA</code>s, otherwise they are set to 0. 
Only used if <code>formulation = "Penman-Monteith"</code>.</p>
</td></tr>
<tr><td><code id="surface.conductance_+3A_formulation">formulation</code></td>
<td>
<p>Formulation used. Either <code>"Penman-Monteith"</code> (the default) 
using the inverted Penman-Monteith equation, or <code>"Flux-Gradient"</code>,
for a simple flux-gradient approach requiring ET, pressure, and VPD only.</p>
</td></tr>
<tr><td><code id="surface.conductance_+3A_esat.formula">Esat.formula</code></td>
<td>
<p>Optional: formula to be used for the calculation of esat and the slope of esat.
One of <code>"Sonntag_1990"</code> (Default), <code>"Alduchov_1996"</code>, or <code>"Allen_1998"</code>. 
Only used if <code>formulation = "Penman-Monteith"</code>. See <code><a href="#topic+Esat.slope">Esat.slope</a></code>.</p>
</td></tr>
<tr><td><code id="surface.conductance_+3A_constants">constants</code></td>
<td>
<p>cp - specific heat of air for constant pressure (J K-1 kg-1) <br />
eps - ratio of the molecular weight of water vapor to dry air (-) <br />
Rd - gas constant of dry air (J kg-1 K-1) <br />
Rgas - universal gas constant (J mol-1 K-1) <br />
Kelvin - conversion degree Celsius to Kelvin <br />
Mw - molar mass of water vapor (kg mol-1) <br />
Pa2kPa - conversion pascal (Pa) to kilopascal (kPa)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>formulation = "Penman-Monteith"</code> (the default), surface conductance (Gs) in m s-1 
is calculated from the inverted Penman-Monteith equation:
</p>
<p style="text-align: center;"><code class="reqn">Gs = ( LE * Ga * \gamma ) / ( \Delta * A + \rho * cp * Ga * VPD - LE * ( \Delta + \gamma ) )</code>
</p>

<p>Where <code class="reqn">\gamma</code> is the psychrometric constant (kPa K-1), <code class="reqn">\Delta</code> is the slope of the 
saturation vapor pressure curve (kPa K-1), and <code class="reqn">\rho</code> is air density (kg m-3).
Available energy (A) is defined as A = Rn - G - S. If G and/or S are not provided, A = Rn.
</p>
<p>By default, any missing data in G and S are set to 0. If <code>missing.S.as.NA = TRUE</code>
or <code>missing.S.as.NA = TRUE</code>, Gs will give <code>NA</code> for these timesteps.
</p>
<p>If <code>formulation="Flux-Gradient"</code>, Gs (in mol m-2 s-1) is calculated from VPD and ET only:
</p>
<p style="text-align: center;"><code class="reqn">Gs = ET/pressure * VPD</code>
</p>

<p>where ET is in mol m-2 s-1. Note that this formulation assumes fully coupled conditions (i.e. Ga = inf).
This formulation is equivalent to the inverted form of Eq.6 in McNaughton &amp; Black 1973:
</p>
<p style="text-align: center;"><code class="reqn">Gs = LE * \gamma / (\rho * cp * VPD)</code>
</p>

<p>which gives Gs in m s-1. Note that Gs &gt; Gc (canopy conductance) under conditions 
when a significant fraction of ET comes from interception or soil evaporation. 
</p>
<p>If <code>pressure</code> is not available, it can be approximated by elevation using the 
function <code><a href="#topic+pressure.from.elevation">pressure.from.elevation</a></code>
</p>


<h3>Value</h3>

<p>a dataframe with the following columns: 
</p>
<table role = "presentation">
<tr><td><code>Gs_ms</code></td>
<td>
<p>Surface conductance in m s-1</p>
</td></tr>
<tr><td><code>Gs_mol</code></td>
<td>
<p>Surface conductance in mol m-2 s-1</p>
</td></tr>
</table>


<h3>References</h3>

<p>Monteith, J., 1965: Evaporation and environment. In Fogg, G. E. (Ed.),
The state and movement of water in living organisms (pp.205-234).
19th Symp. Soc. Exp. Biol., Cambridge University Press, Cambridge
</p>
<p>McNaughton, K.G., Black, T.A., 1973: A study of evapotranspiration
from a Douglas Fir forest using the energy balance approach. Water
Resources Research 9, 1579-1590.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## filter data to ensure that Gs is a meaningful proxy to canopy conductance (Gc)
DE_Tha_Jun_2014_2 &lt;- filter.data(DE_Tha_Jun_2014,quality.control=FALSE,
                                 vars.qc=c("Tair","precip","VPD","H","LE"),
                                 filter.growseas=FALSE,filter.precip=TRUE,
                                 filter.vars=c("Tair","PPFD","ustar","LE"),
                                 filter.vals.min=c(5,200,0.2,0),
                                 filter.vals.max=c(NA,NA,NA,NA),NA.as.invalid=TRUE,
                                 quality.ext="_qc",good.quality=c(0,1),
                                 missing.qc.as.bad=TRUE,GPP="GPP",doy="doy",
                                 year="year",tGPP=0.5,ws=15,min.int=5,precip="precip",
                                 tprecip=0.1,precip.hours=24,records.per.hour=2)

# calculate Gs based on a simple gradient approach
Gs_gradient &lt;- surface.conductance(DE_Tha_Jun_2014_2,Tair="Tair",pressure="pressure",
                                   VPD="VPD",formulation="Flux-Gradient")
summary(Gs_gradient)

# calculate Gs from the the inverted PM equation (now Rn, and Ga are needed),
# using a simple estimate of Ga based on Thom 1972
Ga &lt;- aerodynamic.conductance(DE_Tha_Jun_2014_2,Rb_model="Thom_1972")[,"Ga_h"]

# if G and/or S are available, don't forget to indicate (they are ignored by default).
# Note that Ga is not added to the data.frame 'DE_Tha_Jun_2014'
Gs_PM &lt;- surface.conductance(DE_Tha_Jun_2014_2,Tair="Tair",pressure="pressure",
                             Rn="Rn",G="G",S=NULL,VPD="VPD",Ga=Ga,
                             formulation="Penman-Monteith")
summary(Gs_PM)

                              
# now add Ga to the data.frame 'DE_Tha_Jun_2014' and repeat
DE_Tha_Jun_2014_2$Ga &lt;- Ga
Gs_PM2 &lt;- surface.conductance(DE_Tha_Jun_2014_2,Tair="Tair",pressure="pressure",
                              Rn="Rn",G="G",S=NULL,VPD="VPD",Ga="Ga",
                              formulation="Penman-Monteith")
# note the difference to the previous version (Ga="Ga")
summary(Gs_PM2)

</code></pre>

<hr>
<h2 id='umolCO2.to.gC'>Conversion between Mass and Molar Units of Carbon and CO2</h2><span id='topic+umolCO2.to.gC'></span><span id='topic+gC.to.umolCO2'></span>

<h3>Description</h3>

<p>Converts CO2 quantities from umol CO2 m-2 s-1 to g C m-2 d-1 and vice versa.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>umolCO2.to.gC(CO2_flux, constants = bigleaf.constants())

gC.to.umolCO2(C_flux, constants = bigleaf.constants())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="umolCO2.to.gC_+3A_co2_flux">CO2_flux</code></td>
<td>
<p>CO2 flux (umol CO2 m-2 s-1)</p>
</td></tr>
<tr><td><code id="umolCO2.to.gC_+3A_constants">constants</code></td>
<td>
<p>Cmol - molar mass of carbon (kg mol-1) <br />
umol2mol - conversion micromole (umol) to mol (mol) <br />
mol2umol - conversion mole (mol) to micromole (umol)  <br />
kg2g - conversion kilogram (kg) to gram (g) <br />
g2kg - conversion gram (g) to kilogram (kg) <br />
days2seconds - seconds per day</p>
</td></tr>
<tr><td><code id="umolCO2.to.gC_+3A_c_flux">C_flux</code></td>
<td>
<p>Carbon (C) flux (gC m-2 d-1)</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>umolCO2.to.gC(20)  # gC m-2 d-1

</code></pre>

<hr>
<h2 id='virtual.temp'>Virtual Temperature</h2><span id='topic+virtual.temp'></span>

<h3>Description</h3>

<p>Virtual temperature, defined as the temperature at which dry air would have the same
density as moist air at its actual temperature.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>virtual.temp(
  Tair,
  pressure,
  VPD,
  Esat.formula = c("Sonntag_1990", "Alduchov_1996", "Allen_1998"),
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="virtual.temp_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (deg C)</p>
</td></tr>
<tr><td><code id="virtual.temp_+3A_pressure">pressure</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
<tr><td><code id="virtual.temp_+3A_vpd">VPD</code></td>
<td>
<p>Vapor pressure deficit (kPa)</p>
</td></tr>
<tr><td><code id="virtual.temp_+3A_esat.formula">Esat.formula</code></td>
<td>
<p>Optional: formula to be used for the calculation of esat and the slope of esat. 
One of <code>"Sonntag_1990"</code> (Default), <code>"Alduchov_1996"</code>, or <code>"Allen_1998"</code>.
See <code><a href="#topic+Esat.slope">Esat.slope</a></code>.</p>
</td></tr>
<tr><td><code id="virtual.temp_+3A_constants">constants</code></td>
<td>
<p>Kelvin - conversion degree Celsius to Kelvin <br />
eps - ratio of the molecular weight of water vapor to dry air (-)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>the virtual temperature is given by:
</p>
<p style="text-align: center;"><code class="reqn">Tv = Tair / (1 - (1 - eps) e/pressure)</code>
</p>

<p>where Tair is in Kelvin (converted internally). Likewise, VPD is converted 
to actual vapor pressure (e in kPa) with <code><a href="#topic+VPD.to.e">VPD.to.e</a></code> internally.
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>Tv -</code></td>
<td>
<p>virtual temperature (deg C)</p>
</td></tr>
</table>


<h3>References</h3>

<p>Monteith J.L., Unsworth M.H., 2008: Principles of Environmental Physics.
3rd edition. Academic Press, London.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>virtual.temp(25,100,1.5)                        
              
</code></pre>

<hr>
<h2 id='VPD.to.rH'>Conversions between Humidity Measures</h2><span id='topic+VPD.to.rH'></span><span id='topic+rH.to.VPD'></span><span id='topic+e.to.rH'></span><span id='topic+VPD.to.e'></span><span id='topic+e.to.VPD'></span><span id='topic+e.to.q'></span><span id='topic+q.to.e'></span><span id='topic+q.to.VPD'></span><span id='topic+VPD.to.q'></span>

<h3>Description</h3>

<p>Conversion between vapor pressure (e), vapor pressure deficit (VPD),
specific humidity (q), and relative humidity (rH).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>VPD.to.rH(
  VPD,
  Tair,
  Esat.formula = c("Sonntag_1990", "Alduchov_1996", "Allen_1998"),
  constants = bigleaf.constants()
)

rH.to.VPD(
  rH,
  Tair,
  Esat.formula = c("Sonntag_1990", "Alduchov_1996", "Allen_1998"),
  constants = bigleaf.constants()
)

e.to.rH(
  e,
  Tair,
  Esat.formula = c("Sonntag_1990", "Alduchov_1996", "Allen_1998"),
  constants = bigleaf.constants()
)

VPD.to.e(
  VPD,
  Tair,
  Esat.formula = c("Sonntag_1990", "Alduchov_1996", "Allen_1998"),
  constants = bigleaf.constants()
)

e.to.VPD(
  e,
  Tair,
  Esat.formula = c("Sonntag_1990", "Alduchov_1996", "Allen_1998"),
  constants = bigleaf.constants()
)

e.to.q(e, pressure, constants = bigleaf.constants())

q.to.e(q, pressure, constants = bigleaf.constants())

q.to.VPD(
  q,
  Tair,
  pressure,
  Esat.formula = c("Sonntag_1990", "Alduchov_1996", "Allen_1998"),
  constants = bigleaf.constants()
)

VPD.to.q(
  VPD,
  Tair,
  pressure,
  Esat.formula = c("Sonntag_1990", "Alduchov_1996", "Allen_1998"),
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="VPD.to.rH_+3A_vpd">VPD</code></td>
<td>
<p>Vapor pressure deficit (kPa)</p>
</td></tr>
<tr><td><code id="VPD.to.rH_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (deg C)</p>
</td></tr>
<tr><td><code id="VPD.to.rH_+3A_esat.formula">Esat.formula</code></td>
<td>
<p>Optional: formula to be used for the calculation of esat and the slope of esat.
One of <code>"Sonntag_1990"</code> (Default), <code>"Alduchov_1996"</code>, or <code>"Allen_1998"</code>.
See <code><a href="#topic+Esat.slope">Esat.slope</a></code>.</p>
</td></tr>
<tr><td><code id="VPD.to.rH_+3A_constants">constants</code></td>
<td>
<p>eps - ratio of the molecular weight of water vapor to dry air (-) <br />
Pa2kPa - conversion pascal (Pa) to kilopascal (kPa)</p>
</td></tr>
<tr><td><code id="VPD.to.rH_+3A_rh">rH</code></td>
<td>
<p>Relative humidity (-)</p>
</td></tr>
<tr><td><code id="VPD.to.rH_+3A_e">e</code></td>
<td>
<p>Vapor pressure (kPa)</p>
</td></tr>
<tr><td><code id="VPD.to.rH_+3A_pressure">pressure</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
<tr><td><code id="VPD.to.rH_+3A_q">q</code></td>
<td>
<p>Specific humidity (kg kg-1)</p>
</td></tr>
</table>


<h3>References</h3>

<p>Foken, T, 2008: Micrometeorology. Springer, Berlin, Germany.
</p>

<hr>
<h2 id='wetbulb.solver'>Solver Function for Wet-Bulb Temperature</h2><span id='topic+wetbulb.solver'></span>

<h3>Description</h3>

<p>Solver function used in wetbulb.temp()
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wetbulb.solver(
  ea,
  Tair,
  gamma,
  accuracy,
  Esat.formula,
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="wetbulb.solver_+3A_ea">ea</code></td>
<td>
<p>Air vapor pressure (kPa)</p>
</td></tr>
<tr><td><code id="wetbulb.solver_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (degC)</p>
</td></tr>
<tr><td><code id="wetbulb.solver_+3A_gamma">gamma</code></td>
<td>
<p>Psychrometric constant (kPa K-1)</p>
</td></tr>
<tr><td><code id="wetbulb.solver_+3A_accuracy">accuracy</code></td>
<td>
<p>Accuracy of the result (degC)</p>
</td></tr>
<tr><td><code id="wetbulb.solver_+3A_esat.formula">Esat.formula</code></td>
<td>
<p>Optional: formula to be used for the calculation of esat and the slope of esat.
One of <code>"Sonntag_1990"</code> (Default), <code>"Alduchov_1996"</code>, or <code>"Allen_1998"</code>.
See <code><a href="#topic+Esat.slope">Esat.slope</a></code>.</p>
</td></tr>
<tr><td><code id="wetbulb.solver_+3A_constants">constants</code></td>
<td>
<p>Pa2kPa - conversion pascal (Pa) to kilopascal (kPa)
Le067 - Lewis number for water vapor to the power of 0.67</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Arguments <code>accuracy</code> and <code>Esat.formula</code> are passed to this function by wetbulb.temp().
</p>

<hr>
<h2 id='wetbulb.temp'>Wet-Bulb Temperature</h2><span id='topic+wetbulb.temp'></span>

<h3>Description</h3>

<p>calculates the wet bulb temperature, i.e. the temperature
that the air would have if it was saturated.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wetbulb.temp(
  Tair,
  pressure,
  VPD,
  accuracy = 0.001,
  Esat.formula = c("Sonntag_1990", "Alduchov_1996", "Allen_1998"),
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="wetbulb.temp_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (deg C)</p>
</td></tr>
<tr><td><code id="wetbulb.temp_+3A_pressure">pressure</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
<tr><td><code id="wetbulb.temp_+3A_vpd">VPD</code></td>
<td>
<p>Vapor pressure deficit (kPa)</p>
</td></tr>
<tr><td><code id="wetbulb.temp_+3A_accuracy">accuracy</code></td>
<td>
<p>Accuracy of the result (deg C)</p>
</td></tr>
<tr><td><code id="wetbulb.temp_+3A_esat.formula">Esat.formula</code></td>
<td>
<p>Optional: formula to be used for the calculation of esat and the slope of esat.
One of <code>"Sonntag_1990"</code> (Default), <code>"Alduchov_1996"</code>, or <code>"Allen_1998"</code>.
See <code><a href="#topic+Esat.slope">Esat.slope</a></code>.</p>
</td></tr>
<tr><td><code id="wetbulb.temp_+3A_constants">constants</code></td>
<td>
<p>cp - specific heat of air for constant pressure (J K-1 kg-1) <br />
eps - ratio of the molecular weight of water vapor to dry air (-) <br />
Pa2kPa - conversion pascal (Pa) to kilopascal (kPa)
Le067 - Lewis number for water vapor to the power of 0.67</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Wet-bulb temperature (Tw) is calculated from the following expression:
</p>
<p style="text-align: center;"><code class="reqn">e = Esat(Tw) - Le067 * gamma * (Tair - Tw)</code>
</p>

<p>The equation is solved for Tw using <code><a href="stats.html#topic+optimize">optimize</a></code>.
Actual vapor pressure e (kPa) is calculated from VPD using the function <code><a href="#topic+VPD.to.e">VPD.to.e</a></code>.
The psychrometric constant gamma (kPa K-1) is calculated from <code><a href="#topic+psychrometric.constant">psychrometric.constant</a></code>.
Le067 is the Lewis number for water vapor to the power of 0.67 and represents the ratio of
aerodynamic resistance to water vapor and heat. Le067 * gamma is sometimes referred to as the 
'modified psychrometric constant (gamma*).
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>Tw -</code></td>
<td>
<p>wet-bulb temperature (degC)</p>
</td></tr>
</table>


<h3>References</h3>

<p>Monteith J.L., Unsworth M.H., 2013: Principles of Environmental Physics. Plants, Animals, and the Atmosphere.
4th edition. Academic Press.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>wetbulb.temp(Tair=c(20,25),pressure=100,VPD=c(1,1.6))             
       
</code></pre>

<hr>
<h2 id='wind.profile'>Wind Speed at a Given Height in the Surface Layer</h2><span id='topic+wind.profile'></span>

<h3>Description</h3>

<p>Wind speed at a given height above the canopy estimated from single-level
measurements of wind speed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wind.profile(
  data,
  z,
  Tair = "Tair",
  pressure = "pressure",
  ustar = "ustar",
  H = "H",
  wind = "wind",
  zr,
  zh,
  d = NULL,
  frac_d = 0.7,
  z0m = NULL,
  frac_z0m = NULL,
  estimate_z0m = TRUE,
  stab_correction = TRUE,
  stab_formulation = c("Dyer_1970", "Businger_1971"),
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="wind.profile_+3A_data">data</code></td>
<td>
<p>Data.frame or matrix containing all required variables</p>
</td></tr>
<tr><td><code id="wind.profile_+3A_z">z</code></td>
<td>
<p>Height above ground for which wind speed is calculated.</p>
</td></tr>
<tr><td><code id="wind.profile_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (deg C)</p>
</td></tr>
<tr><td><code id="wind.profile_+3A_pressure">pressure</code></td>
<td>
<p>Atmospheric pressure (kPa)</p>
</td></tr>
<tr><td><code id="wind.profile_+3A_ustar">ustar</code></td>
<td>
<p>Friction velocity (m s-1)</p>
</td></tr>
<tr><td><code id="wind.profile_+3A_h">H</code></td>
<td>
<p>Sensible heat flux (W m-2)</p>
</td></tr>
<tr><td><code id="wind.profile_+3A_wind">wind</code></td>
<td>
<p>Wind speed at height zr (m s-1); only used if <code>stab_correction = TRUE</code></p>
</td></tr>
<tr><td><code id="wind.profile_+3A_zr">zr</code></td>
<td>
<p>Instrument (reference) height (m)</p>
</td></tr>
<tr><td><code id="wind.profile_+3A_zh">zh</code></td>
<td>
<p>Canopy height (m)</p>
</td></tr>
<tr><td><code id="wind.profile_+3A_d">d</code></td>
<td>
<p>Zero-plane displacement height (-)</p>
</td></tr>
<tr><td><code id="wind.profile_+3A_frac_d">frac_d</code></td>
<td>
<p>Fraction of displacement height on canopy height (-);
only used if <code>d</code> is not available</p>
</td></tr>
<tr><td><code id="wind.profile_+3A_z0m">z0m</code></td>
<td>
<p>Roughness length (m), optional; only used if <code>stab_correction = FALSE</code> (default=0.1)</p>
</td></tr>
<tr><td><code id="wind.profile_+3A_frac_z0m">frac_z0m</code></td>
<td>
<p>Fraction of roughness length on canopy height (-), optional; only used if <code>z0m</code> is not provided.
Default is 0.1.</p>
</td></tr>
<tr><td><code id="wind.profile_+3A_estimate_z0m">estimate_z0m</code></td>
<td>
<p>Should <code>z0m</code> be estimated from the logarithmic wind profile? If <code>TRUE</code> (the default),
arguments <code>z0m</code> and <code>frac_z0m</code> are ignored.
See <code><a href="#topic+roughness.parameters">roughness.parameters</a></code> for details.</p>
</td></tr>
<tr><td><code id="wind.profile_+3A_stab_correction">stab_correction</code></td>
<td>
<p>Should stability correction be applied? Defaults to <code>TRUE</code></p>
</td></tr>
<tr><td><code id="wind.profile_+3A_stab_formulation">stab_formulation</code></td>
<td>
<p>Stability correction function used (If <code>stab_correction = TRUE</code>).
Either <code>"Dyer_1970"</code> or <code>"Businger_1971"</code>.</p>
</td></tr>
<tr><td><code id="wind.profile_+3A_constants">constants</code></td>
<td>
<p>k - von-Karman constant (-) <br />
Kelvin - conversion degree Celsius to Kelvin <br />
cp - specific heat of air for constant pressure (J K-1 kg-1) <br />
g - gravitational acceleration (m s-2)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The underlying assumption is the existence of a logarithmic wind profile
above the height d + z0m (the height at which wind speed mathematically reaches zero
according to the Monin-Obukhov similarity theory).
In this case, the wind speed at a given height z is given by:
</p>
<p style="text-align: center;"><code class="reqn">u(z) = (ustar/k) * (ln((z - d) / z0m) - \psi{m}</code>
</p>

<p>The roughness parameters zero-plane displacement height (d) and roughness length (z0m)
can be approximated from <code><a href="#topic+roughness.parameters">roughness.parameters</a></code>. <code class="reqn">\psi{m}</code> is omitted
if <code>stab_correction = FALSE</code> (not recommended). If <code>estimate_z0m = TRUE</code>,
z0m is first estimated from the wind profile equation and then used in the equation
above for the calculation of <code>u(z)</code> (see e.g. Newman &amp; Klein 2014).
</p>


<h3>Value</h3>

<p>A vector of wind speed at heights <code>z</code>.
</p>


<h3>Note</h3>

<p>Note that this equation is only valid for z &gt;= d + z0m, and it is not 
meaningful to calculate values closely above d + z0m. All values in <code>heights</code>
smaller than d + z0m will return 0.
</p>


<h3>References</h3>

<p>Monteith, J.L., Unsworth, M.H., 2008: Principles of Environmental Physics.
3rd edition. Academic Press, London. 
</p>
<p>Newman, J.F., Klein, P.M., 2014: The impacts of atmospheric stability on
the accuracy of wind speed extrapolation methods. Resources 3, 81-105.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+roughness.parameters">roughness.parameters</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>heights &lt;- seq(18,40,2)  # heights above ground for which to calculate wind speed
df &lt;- data.frame(Tair=25,pressure=100,wind=c(3,4,5),ustar=c(0.5,0.6,0.65),H=c(200,230,250)) 
ws &lt;- sapply(heights,function(x) wind.profile(df,z=x,zr=40,zh=25,d=16))
colnames(ws) &lt;- paste0(heights,"m")

</code></pre>

<hr>
<h2 id='WUE.metrics'>Water-Use Efficiency Metrics</h2><span id='topic+WUE.metrics'></span>

<h3>Description</h3>

<p>Calculation of various water use efficiency (WUE) metrics.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>WUE.metrics(
  data,
  GPP = "GPP",
  NEE = "NEE",
  LE = "LE",
  VPD = "VPD",
  Tair = "Tair",
  constants = bigleaf.constants()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="WUE.metrics_+3A_data">data</code></td>
<td>
<p>Data.frame or matrix containing all required variables</p>
</td></tr>
<tr><td><code id="WUE.metrics_+3A_gpp">GPP</code></td>
<td>
<p>Gross primary productivity (umol CO2 m-2 s-1)</p>
</td></tr>
<tr><td><code id="WUE.metrics_+3A_nee">NEE</code></td>
<td>
<p>Net ecosystem exchange (umol CO2 m-2 s-1)</p>
</td></tr>
<tr><td><code id="WUE.metrics_+3A_le">LE</code></td>
<td>
<p>Latent heat flux (W m-2)</p>
</td></tr>
<tr><td><code id="WUE.metrics_+3A_vpd">VPD</code></td>
<td>
<p>Vapor pressure deficit (kPa)</p>
</td></tr>
<tr><td><code id="WUE.metrics_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (deg C)</p>
</td></tr>
<tr><td><code id="WUE.metrics_+3A_constants">constants</code></td>
<td>
<p>Cmol - molar mass of carbon (kg mol-1) <br />
umol2mol - conversion micromole (umol) to mole (mol) <br />
kg2g - conversion kilogram (kg) to gram (g)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>the following metrics are calculated:
</p>
<p>Water-use efficiency (WUE):
</p>
<p style="text-align: center;"><code class="reqn">WUE = GPP / ET</code>
</p>

<p>Water-use efficiency based on NEE (WUE_NEE):
</p>
<p style="text-align: center;"><code class="reqn">WUE_NEE = NEE / ET</code>
</p>

<p>Inherent water-use efficiency (IWUE; Beer et al. 2009):
</p>
<p style="text-align: center;"><code class="reqn">IWUE = (GPP * VPD) / ET</code>
</p>

<p>Underlying water-use efficiency (uWUE; Zhou et al. 2014):
</p>
<p style="text-align: center;"><code class="reqn">uWUE= (GPP * sqrt(VPD)) / ET</code>
</p>

<p>All metrics are calculated based on the median of all values. E.g.
WUE = median(GPP/ET,na.rm=TRUE)
</p>


<h3>Value</h3>

<p>a named vector with the following elements:
</p>
<table role = "presentation">
<tr><td><code>WUE</code></td>
<td>
<p>Water-use efficiency (gC (kg H20)-1)</p>
</td></tr>
<tr><td><code>WUE_NEE</code></td>
<td>
<p>Water-use efficiency based on NEE (gC (kg H20)-1)</p>
</td></tr>
<tr><td><code>IWUE</code></td>
<td>
<p>Inherent water-use efficiency (gC kPa (kg H20)-1)</p>
</td></tr>
<tr><td><code>uWUE</code></td>
<td>
<p>Underlying water-use efficiency (gC kPa^0.5 (kg H20)-1)</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Units for VPD can also be hPa. Units change accordingly.
WUE_NEE is calculated based on the absolute value of NEE (the sign convention does not matter here).
</p>


<h3>References</h3>

<p>Beer, C., et al., 2009: Temporal and among-site variability of inherent
water use efficiency at the ecosystem level. Global Biogeochemical Cycles 23, GB2018.
</p>
<p>Zhou, S., et al., 2014: The effect of vapor pressure deficit on water
use efficiency at the sub-daily time scale. Geophysical Research Letters 41.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+stomatal.slope">stomatal.slope</a></code> for a measure of intrinsic WUE
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## filter data for dry periods and daytime at DE-Tha in June 2014
DE_Tha_Jun_2014_2 &lt;- filter.data(DE_Tha_Jun_2014,quality.control=FALSE,
                                 vars.qc=c("Tair","precip","VPD","H","LE"),
                                 filter.growseas=FALSE,filter.precip=TRUE,
                                 filter.vars=c("Tair","PPFD","ustar"),
                                 filter.vals.min=c(5,200,0.2),
                                 filter.vals.max=c(NA,NA,NA),NA.as.invalid=TRUE,
                                 quality.ext="_qc",good.quality=c(0,1),
                                 missing.qc.as.bad=TRUE,GPP="GPP",doy="doy",
                                 year="year",tGPP=0.5,ws=15,min.int=5,precip="precip",
                                 tprecip=0.1,precip.hours=24,records.per.hour=2)

## calculate WUE metrics in the filtered periods
WUE.metrics(DE_Tha_Jun_2014_2)
                        
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
