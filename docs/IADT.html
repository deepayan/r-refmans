<!DOCTYPE html><html><head><title>Help for package IADT</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {IADT}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#IADT-package'><p>Interaction Difference Test for Prediction Models</p></a></li>
<li><a href='#pdpEst_mpfr'><p>Partial dependence plot with specific numerical precision</p></a></li>
<li><a href='#testIAD_mpfr'><p>Model-agnostic interaction difference test for prediction models</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Version:</td>
<td>1.2.1</td>
</tr>
<tr>
<td>Title:</td>
<td>Interaction Difference Test for Prediction Models</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-05-14</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides functions to conduct a model-agnostic asymptotic hypothesis test for the identification of interaction effects in black-box machine learning models. The null hypothesis assumes that a given set of covariates does not contribute to interaction effects in the prediction model. The test statistic is based on the difference of variances of partial dependence functions (Friedman (2008) &lt;<a href="https://doi.org/10.1214%2F07-AOAS148">doi:10.1214/07-AOAS148</a>&gt; and Welchowski (2022) &lt;<a href="https://doi.org/10.1007%2Fs13253-021-00479-7">doi:10.1007/s13253-021-00479-7</a>&gt;) with respect to the original black-box predictions and the predictions under the null hypothesis. The hypothesis test can be applied to any black-box prediction model, and the null hypothesis of the test can be flexibly specified according to the research question of interest. Furthermore, the test is computationally fast to apply as the null distribution does not require resampling or refitting black-box prediction models.</td>
</tr>
<tr>
<td>Depends:</td>
<td>Rmpfr</td>
</tr>
<tr>
<td>Imports:</td>
<td>methods, mgcv, Rdpack, mvnfast</td>
</tr>
<tr>
<td>RdMacros:</td>
<td>Rdpack</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-05-14 09:00:24 UTC; welchow</td>
</tr>
<tr>
<td>Author:</td>
<td>Thomas Welchowski <a href="https://orcid.org/0000-0003-2940-647X"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Thomas Welchowski &lt;welchow@imbie.meb.uni-bonn.de&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-05-14 09:30:16 UTC</td>
</tr>
</table>
<hr>
<h2 id='IADT-package'>Interaction Difference Test for Prediction Models</h2><span id='topic+IADT-package'></span>

<h3>Description</h3>

<p>Provides functions to conduct a model-agnostic asymptotic 
hypothesis test for the identification of interaction effects in 
black-box machine learning models. The null hypothesis assumes that a given 
set of covariates does not contribute to interaction effects in the prediction 
model. The test statistic is based on the difference of variances of 
partial dependence functions with respect to the original 
black-box predictions and the predictions under the null hypothesis. 
The hypothesis test can be applied to any black-box prediction model, 
and the null hypothesis of the test can be flexibly specified according 
to the research question of interest. Furthermore, the test is computationally 
fast to apply as the null distribution does not require resampling or 
refitting black-box prediction models.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;"> Package: </td><td style="text-align: left;"> IADT </td>
</tr>
<tr>
 <td style="text-align: left;"> Type: </td><td style="text-align: left;"> Package </td>
</tr>
<tr>
 <td style="text-align: left;"> Version:
</td><td style="text-align: left;"> 1.2.1 </td>
</tr>
<tr>
 <td style="text-align: left;"> Date: </td><td style="text-align: left;"> 2024-05-14 </td>
</tr>
<tr>
 <td style="text-align: left;"> License: </td><td style="text-align: left;"> GPL-3 </td>
</tr>
<tr>
 <td style="text-align: left;"> </td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Thomas Welchowski <a href="mailto:welchow@imbie.meb.uni-bonn.de">welchow@imbie.meb.uni-bonn.de</a>
</p>


<h3>References</h3>

<p>Welchowski T, Maloney KO, Mitchell R, Schmid M (2022).
&ldquo;Techniques to Improve Ecological Interpretability of Black-Box  Machine Learning Models.&rdquo;
<em>JABES</em>, <b>27</b>, 175-197. <br /><br />
Friedman JH, Popescu BE (2008).
&ldquo;Predictive learning via rule ensembles.&rdquo;
<em>The Annals of Applied Statistics</em>, <b>2</b>(3), 916-954.
</p>

<hr>
<h2 id='pdpEst_mpfr'>Partial dependence plot with specific numerical precision</h2><span id='topic+pdpEst_mpfr'></span>

<h3>Description</h3>

<p>Estimates the partial dependence plot (PDP) curve given specified numerical 
precision.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pdpEst_mpfr(
  colInd,
  object,
  predictfun,
  X,
  centering = FALSE,
  outputVector = TRUE,
  newX = NULL,
  nCores = 1,
  precBits = 53 * 2
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pdpEst_mpfr_+3A_colind">colInd</code></td>
<td>
<p>Index of columns of covariates to specify the null hypothesis 
set <em>s</em> (integer vector).</p>
</td></tr>
<tr><td><code id="pdpEst_mpfr_+3A_object">object</code></td>
<td>
<p>Prediction model object (class flexible).</p>
</td></tr>
<tr><td><code id="pdpEst_mpfr_+3A_predictfun">predictfun</code></td>
<td>
<p>Prediction function to be evaluated (class function). The
prediction function needs to be specified with two arguments 
<em>predictfun(object, X)</em>. The argument <em>object</em> is the prediction 
model and <em>X</em> the data on which the partial dependence functions
are evaluated.</p>
</td></tr>
<tr><td><code id="pdpEst_mpfr_+3A_x">X</code></td>
<td>
<p>Data on that the partial dependence function is evaluated 
(class matrix or data.frame). The structure of the data depends on the 
specified argument <em>predictfun</em>.</p>
</td></tr>
<tr><td><code id="pdpEst_mpfr_+3A_centering">centering</code></td>
<td>
<p>Should the resulting values be mean centered? 
(logical scalar). Default corresponds to output original values.</p>
</td></tr>
<tr><td><code id="pdpEst_mpfr_+3A_outputvector">outputVector</code></td>
<td>
<p>Should be only the partial dependence function returned</p>
</td></tr>
<tr><td><code id="pdpEst_mpfr_+3A_newx">newX</code></td>
<td>
<p>Test data set (class &quot;data.frame&quot;)</p>
</td></tr>
<tr><td><code id="pdpEst_mpfr_+3A_ncores">nCores</code></td>
<td>
<p>Number of cores used in standard parallel computation
setup based on R <em>parallel</em> package. The default value of one uses 
serial processing across observations.</p>
</td></tr>
<tr><td><code id="pdpEst_mpfr_+3A_precbits">precBits</code></td>
<td>
<p>Numerical precision that are used in computation after the 
calculation of the predictions from the estimated model. Default is defined 
to be double the amount of the 53 Bits usually used in R.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Vector of estimated the PDP curve values for each sample in <em>X</em>.
</p>


<h3>Author(s)</h3>

<p>Thomas Welchowski <a href="mailto:welchow@imbie.meb.uni-bonn.de">welchow@imbie.meb.uni-bonn.de</a>
</p>


<h3>References</h3>

<p>Friedman JH, Popescu BE (2008).
&ldquo;Predictive learning via rule ensembles.&rdquo;
<em>The Annals of Applied Statistics</em>, <b>2</b>(3), 916-954.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+testIAD_mpfr">testIAD_mpfr</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#####################
# Simulation example

# Simulate covariates from multivariate standard normal distribution
set.seed(-72498)
library(mvnfast)
X &lt;- mvnfast::rmvn(n=1e2, mu=rep(0, 2), sigma=diag(2))

# Response generation
y &lt;- X[, 1]^2 + rnorm(n=1e2, mean=0, sd=0.5)
trainDat &lt;- data.frame(X, y=y)

# Estimate generalized additive model
library(mgcv)
gamFit &lt;- gam(formula=y~s(X1)+s(X2), data=trainDat, 
family=gaussian())

# Estimate PDP function
pdpEst1 &lt;- pdpEst_mpfr(colInd=1, object=gamFit, 
predictfun=function(object, X){
predict(object=object, newdata=X, type="response")
}, X=trainDat, 
centering=FALSE, nCores=1, precBits=53*2)

# Convert to standard precision and order in sequence of observations
pdpEst1 &lt;- as.numeric(pdpEst1)
ordInd &lt;- order(X[, 1])
pdpEst1 &lt;- pdpEst1[ordInd]

# Plot: PDP curve vs. true effect
plot(x=X[ordInd, 1], y=pdpEst1, type="l")
lines(x=X[ordInd, 1], y=X[ordInd, 1]^2, lty=2, col="red")
# -&gt; Both curves are similiar

</code></pre>

<hr>
<h2 id='testIAD_mpfr'>Model-agnostic interaction difference test for prediction models</h2><span id='topic+testIAD_mpfr'></span>

<h3>Description</h3>

<p>Tests if a given set <em>s</em> of covariates contributes to interaction
effects in the prediction model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>testIAD_mpfr(
  colInd,
  object,
  predictfun,
  X,
  newX = NULL,
  y = NULL,
  alternative = "twoSided",
  centering = FALSE,
  nCoresPDP = 1,
  precBits = 53 * 2
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="testIAD_mpfr_+3A_colind">colInd</code></td>
<td>
<p>Index of columns of covariates to specify the null hypothesis 
set <em>s</em> (integer vector).</p>
</td></tr>
<tr><td><code id="testIAD_mpfr_+3A_object">object</code></td>
<td>
<p>Prediction model object (class flexible).</p>
</td></tr>
<tr><td><code id="testIAD_mpfr_+3A_predictfun">predictfun</code></td>
<td>
<p>Prediction function to be evaluated (class function). The
prediction function needs to be specified with two arguments 
<em>predictfun(object, X)</em>. The argument <em>object</em> is the prediction 
model and <em>X</em> the data on which the partial dependence functions
are evaluated.</p>
</td></tr>
<tr><td><code id="testIAD_mpfr_+3A_x">X</code></td>
<td>
<p>Data on that the partial dependence function is evaluated 
(class matrix or data.frame). The structure of the data depends on the 
specified argument <em>predictfun</em>.</p>
</td></tr>
<tr><td><code id="testIAD_mpfr_+3A_newx">newX</code></td>
<td>
<p>Test data set, which is used in the evaluation of the partial
dependence functions (class &quot;matrix&quot; or &quot;data.frame&quot;). Default value NULL evaluates
the interaction test on training data <em>X</em>.</p>
</td></tr>
<tr><td><code id="testIAD_mpfr_+3A_y">y</code></td>
<td>
<p>Response (numeric vector). Default value NULL means that the 
statistic is not based on response information.</p>
</td></tr>
<tr><td><code id="testIAD_mpfr_+3A_alternative">alternative</code></td>
<td>
<p>Should the hypothesis be tested two-sided <em>alternative=&quot;twoSided&quot;</em>,
greater <em>alternative=&quot;greater&quot;</em> or less <em>alternative=&quot;less&quot;</em> (character vector)? 
Default is &quot;twoSided&quot;.</p>
</td></tr>
<tr><td><code id="testIAD_mpfr_+3A_centering">centering</code></td>
<td>
<p>Should the resulting values be mean centered? 
(logical scalar). Default corresponds to output original values.</p>
</td></tr>
<tr><td><code id="testIAD_mpfr_+3A_ncorespdp">nCoresPDP</code></td>
<td>
<p>Number of cores used in standard parallel computation
setup based on R <em>parallel</em> package to compute partial 
dependence function. 
The default value of one uses serial processing across observations.</p>
</td></tr>
<tr><td><code id="testIAD_mpfr_+3A_precbits">precBits</code></td>
<td>
<p>Numerical precision that are used in computation after the 
calculation of the predictions from the estimated model. Default is defined 
to be double the amount of the 53 Bits usually used in R.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data set used to evaluate the interaction test coulbe be training 
or test data. The proof of the asymptotic distribution only works in case of
test data. Therefore we recommend usage of test data for evaluation. Two types 
of hypothesis are recommended:
</p>

<ul>
<li> <p>Model interactions: Model does not have interaction effects between 
covariates in set <em>s</em> and 
between other covariates and those of set <em>s</em>. Argument <em>colInd</em> specifies 
the set s and argument <em>alternative</em> should be set to &quot;twoSided&quot;.
</p>
</li>
<li> <p>MSE improvement: Do interactions between between covariates in set <em>s</em> and 
between other covariates and those of set <em>s</em> descrease MSE?
Argument <em>alternative</em> should be set to &quot;less&quot;.
</p>
</li></ul>



<h3>Value</h3>

<p>List with following entries:
</p>

<ul>
<li> <p>testStat: Test statistic based on one-sample Gaussian test.
</p>
</li>
<li> <p>pValue: P-value based on asymptotic normal distribution.
</p>
</li>
<li> <p>IAD_f_terms: If <em>y=NULL</em> then the terms used to calculate the
variance of the predictions with possible interaction effects 
in set <em>s</em> are returned. If <em>y!=NULL</em>, then the terms of the MSE of the prediction model 
with interactions is returned.
</p>
</li>
<li> <p>IAD_f: If <em>y=NULL</em> then the variance of the predictions with possible interaction effects 
in set <em>s</em> is returned. If <em>y!=NULL</em>, then the MSE of the prediction model 
with possible interactions is returned.
</p>
</li>
<li> <p>IAD_PD_terms: If <em>y=NULL</em> then the terms used to calculate the 
variance of predictions under the null hypothesis
of no interaction effects in set <em>s</em> are returned. If <em>y!=NULL</em>, 
then the terms used to calculate the MSE of the prediction model are returned.
under the null hypothesis of no interaction effects are returned.
</p>
</li>
<li> <p>IAD_PD: If <em>y=NULL</em> then the variance of predictions under the null hypothesis
of no interaction effects of set <em>s</em> is returned. If <em>y!=NULL</em>, 
then the MSE of the prediction model is returned.
</p>
</li>
<li> <p>z3 Terms used to calculate the the interaction difference.
under the null hypothesis of no interaction effects is returned.
</p>
</li>
<li> <p>IAD: Interaction difference calculated as mean of the terms <em>z3</em>.
</p>
</li></ul>



<h3>Note</h3>

<p>Numerical precision does have influence on Type I error
percentages. Under the null hypothesis values of the test statistic can be
very small near zero. To lessen the impact of random rounding errors increased
numerical precision is important.
</p>


<h3>Author(s)</h3>

<p>Thomas Welchowski <a href="mailto:welchow@imbie.meb.uni-bonn.de">welchow@imbie.meb.uni-bonn.de</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pdpEst_mpfr">pdpEst_mpfr</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#####################
# Simulation example
#####################

library(mvnfast)
library(mgcv)

############################################################################
# H0: Covariate X1 does not contribute to interaction effects in the 
# prediction model.

# Train data
# Simulate covariates from multivariate standard normal distribution
set.seed(-72498)
nSize &lt;- 100
X &lt;- mvnfast::rmvn(n=nSize, mu=rep(0, 2), sigma=diag(2))

# Response generation
y &lt;- X[, 1]^2 + rnorm(n=nSize, mean=0, sd=0.25)

# Complete data frame
trainDat &lt;- data.frame(X, y=y)

# Test data
# Simulate covariates from multivariate standard normal distribution
testX &lt;- mvnfast::rmvn(n=nSize, mu=rep(0, 2), sigma=diag(2))

# Response generation
testY &lt;- testX[, 1]^2 + rnorm(n=nSize, mean=0, sd=0.25)
testDat &lt;- data.frame(testX, y=testY)

# Estimate generalized additive model with training data
library(mgcv)
gamFit &lt;- gam(formula=y~s(X1)+s(X2), data=trainDat,
              family=gaussian())

# Test interaction
testIAD_mpfr1 &lt;- testIAD_mpfr(colInd=1, object=gamFit,
                              predictfun=function(object, X){
                                predict(object=object, newdata=X, type="response")
                              }, X=testDat)
testIAD_mpfr1$pValue
# -&gt; H0 is not rejected with alpha=0.05

###############################################################
# H1: X1 does contribute to at least one interaction effect
# in the prediction model.

# Train data
# Simulate covariates from multivariate standard normal distribution
set.seed(-72498)
nSize &lt;- 150
X &lt;- mvnfast::rmvn(n=nSize, mu=rep(0, 2), sigma=diag(2))

# Response generation
y &lt;- X[, 1]^2 * X[, 2] + rnorm(n=nSize, mean=0, sd=0.25)

# Complete data frame
trainDat &lt;- data.frame(X, y=y)

# Test data
# Simulate covariates from multivariate standard normal distribution
testX &lt;- mvnfast::rmvn(n=nSize, mu=rep(0, 2), sigma=diag(2))

# Response generation
testY &lt;- testX[, 1]^2 * testX[, 2] + rnorm(n=nSize, mean=0, sd=0.25)
testDat &lt;- data.frame(testX, y=testY)

# Estimate generalized additive model with training data
library(mgcv)
gamFit &lt;- gam(formula=y~s(X1, X2, k=25), data=trainDat,
              family=gaussian())

# Test interaction
testIAD_mpfr1 &lt;- testIAD_mpfr(colInd=1, object=gamFit,
                              predictfun=function(object, X){
                                predict(object=object, newdata=X, type="response")
                              }, X=testDat)
testIAD_mpfr1$pValue
# -&gt; H0 is rejected with alpha=0.05

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
