<!DOCTYPE html><html><head><title>Help for package fluoSurv</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {fluoSurv}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#estimate.LT'><p>Estimation of time to death</p></a></li>
<li><a href='#estimate.offset'><p>Estimate variance in signal</p></a></li>
<li><a href='#extract.well'><p>Extract data for a single well</p></a></li>
<li><a href='#fluoSurv'><p>fluoSurv: A package for estimating insect survival data from spectrophotometry measurements</p></a></li>
<li><a href='#galleria'><p>Fluorescence data measured on <em>Galleria mellonella</em></p></a></li>
<li><a href='#read.kinetic'><p>Reads a kinetic file, as produced by a Biotek plate reader.</p></a></li>
<li><a href='#setup'><p>An injection experimental setup</p></a></li>
<li><a href='#when.threshold'><p>Computes when fluorescence exceeds a given threshold value</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Estimate Insect Survival from Fluorescence Data</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.0</td>
</tr>
<tr>
<td>Author:</td>
<td>Jean-Baptiste Ferdy &lt;jean-baptiste.ferdy@univ-tlse3.fr&gt;</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jean-Baptiste Ferdy &lt;jean-baptiste.ferdy@univ-tlse3.fr&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Use spectrophotometry measurements performed on insects as a way to infer pathogens 
      virulence. Insect movements cause fluctuations in fluorescence signal, and functions are 
      provided to estimate when the insect has died as the moment when variance in autofluorescence 
      signal drops to zero. The package provides functions to obtain this estimate together with 
      functions to import spectrophotometry data from a Biotek microplate reader. Details of the method 
      are given in Parthuisot et al. (2018) &lt;<a href="https://doi.org/10.1101%2F297929">doi:10.1101/297929</a>&gt;.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.1.0)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>survival</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>6.0.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2018-04-10 11:57:15 UTC; jbf</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2018-04-10 13:41:28 UTC</td>
</tr>
</table>
<hr>
<h2 id='estimate.LT'>Estimation of time to death</h2><span id='topic+estimate.LT'></span>

<h3>Description</h3>

<p>Estimation of time to death
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate.LT(y, t, threshold.value = NULL, offset.dead = NULL,
  offset.alive = NULL, verbose = F, ndeps = 0.01)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estimate.LT_+3A_y">y</code></td>
<td>
<p>The signal to analize</p>
</td></tr>
<tr><td><code id="estimate.LT_+3A_t">t</code></td>
<td>
<p>The time values</p>
</td></tr>
<tr><td><code id="estimate.LT_+3A_threshold.value">threshold.value</code></td>
<td>
<p>Detection threshold below which signal is considered as pure noise</p>
</td></tr>
<tr><td><code id="estimate.LT_+3A_offset.dead">offset.dead</code></td>
<td>
<p>Offset derived from variance in signal in dead insects</p>
</td></tr>
<tr><td><code id="estimate.LT_+3A_offset.alive">offset.alive</code></td>
<td>
<p>Offset derived from variance in signal in living insects</p>
</td></tr>
<tr><td><code id="estimate.LT_+3A_verbose">verbose</code></td>
<td>
<p>If true additionnal informations on computations are displayed</p>
</td></tr>
<tr><td><code id="estimate.LT_+3A_ndeps">ndeps</code></td>
<td>
<p>Step size used in optim to estimate parameters</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The model adjusted in this procedure assumes that random variance in signal drops after insect death,
because insect has ceased to move. The time value at which this drop occurs can therefore be used as
an estimate of lethal time. First guess of variance estimates can be provided as offset.dead (for dead
insects) or offset.alive (for living insects).
</p>


<h3>Value</h3>

<p>A vector with TL estimate for the given sample, corresponding log-likelihood and number of values used in the computation.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
##Loading data
data("galleria")
## dataset may contain NA if microplate reader has been stoped before the programmed
## end of the experiment
d &lt;- subset(galleria,!is.na(value))
l  &lt;- lapply(split(d,d$well),extract.well)

data(setup)
setup &lt;- setup[match(setup$well,names(l)),]

## Computes rough estimates of variance in autofluorescence signal for dead and living insects
## These values serve as initial guess to fit the model.
offset.alive &lt;- estimate.offset(l,"1_330_405",min.t=1,max.t=5)
    # all insects are assumed to be alive during the
    # first five hours that follow injection

offset.dead &lt;- estimate.offset(l[which(setup$dead==1)],"1_330_405",min.t=72-5)
    # insects that were dead at the end of the experiment are
    # assumed to have died earlier than 5 hours before then
    # end of the experiment


## LT estimation or for a single well
## Check out well D9, to see what happens when an insect stayed alive.
well &lt;- "A3"
plot(log(value_1_485_535,10)~t_1_485_535,type="l",col="green",ylim=c(2,5),data=l[[well]])
points(log(value_1_330_405,10)~t_1_330_405,type="l",col="gray",data=l[[well]])
    # Rough estimate obtained using no offsets
est1 &lt;- with(l[[well]], estimate.LT(value_1_330_405,t_1_330_405,threshold.value=3))
abline(v=est1[["LT"]],lty=2,col="red")
    # Much better estimate obtained using offset for dead insects
est2 &lt;- with(l[[well]], estimate.LT(value_1_330_405,t_1_330_405,
                                         offset.dead = offset.dead,threshold.value=3))
abline(v=est2["LT"],lty=3,col="red")
    # Using offset.alive does not change anything to the estimate for well A3
    # It may help for insect that have a larger variance in signal than others even after death
est3 &lt;- with(l[[well]], estimate.LT(value_1_330_405,t_1_330_405,
                                         offset.dead = offset.dead,
                                         offset.alive = offset.alive,threshold.value=3))
abline(v=est3["LT"],col="red")
    # Detection of significant GFP fluorescence (i.e. log fluorescence exceed
    # by 5% the maximum value observed during the first five hours)
with(l[[well]],abline(v=when.threshold(t_1_485_535,log(value_1_485_535,10),
                                                            threshold=0.1),col="green"))


##LT estimation for all wells
if(FALSE) { #example takes time! Set to TRUE if you want to run it
   res &lt;- sapply(l,function(x) estimate.LT(x$value_1_330_405,x$t_1_330_405,
                                               threshold.value=2,offset.dead=offset.dead,
                                               offset.alive=offset.alive))
  res &lt;- as.data.frame(t(res))
##Adds LT estimates to the experimental setup data.frame
  setup &lt;- cbind(setup,res[match(setup$well,rownames(res)),])
## Time of injection is added to LT, so that LT really corresponds to time post injection
  time &lt;- with(setup,strptime(as.character(time_injection),format="%H:%M:%S"))
  time &lt;- as.numeric((max(time)-time)/(60^2))
  setup$LT &lt;- setup$LT+time


## Survival curves by dilution of bacterial culture injected
  library(survival)
  plot(survfit(Surv(LT,dead)~dilution,data=setup),
     lwd=c(3:1,1),lty=c(1,1,1,2),
     xlab="hours post injection",ylab="proportion of surviving insects")
  abline(h=0.5,col="red")
  legend("topright",lwd=c(1,3:1),lty=c(2,1,1,1),legend=c("LB",10^(3:1)))

## When does scepticemia start?
  res &lt;- sapply(l,function(x) when.threshold(x$t_1_485_535,log(x$value_1_485_535,10),
                                                                    threshold=0.1))
  setup$T_gfp &lt;- res[match(setup$well,names(res))]
  setup$T_gfp &lt;- setup$T_gfp + time

## Relation between time of death and moment when scepticemia is detected.
## Only points where scepticemia has been detected are represented here.
  plot(LT~T_gfp,data=setup,col=ifelse(dead,1,2),pch=as.numeric(dilution))
  abline(0,1)
  with(setup,legend("topleft",legend=levels(dilution),pch=1:4))
  # Most insects have died after scepticemia has started.
  }

</code></pre>

<hr>
<h2 id='estimate.offset'>Estimate variance in signal</h2><span id='topic+estimate.offset'></span>

<h3>Description</h3>

<p>Estimate variance in signal
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate.offset(l, var, min.t = NULL, max.t = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estimate.offset_+3A_l">l</code></td>
<td>
<p>A list object with each element being measurement for a sample</p>
</td></tr>
<tr><td><code id="estimate.offset_+3A_var">var</code></td>
<td>
<p>A character string corresponding to the name of the signal used to estimate lethal time</p>
</td></tr>
<tr><td><code id="estimate.offset_+3A_min.t">min.t</code></td>
<td>
<p>The time after which signal will be used to compute offset</p>
</td></tr>
<tr><td><code id="estimate.offset_+3A_max.t">max.t</code></td>
<td>
<p>The time before which signal will be used to compute offset</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A value that can be used as an offset in <cite>estimate.LT</cite>
</p>

<hr>
<h2 id='extract.well'>Extract data for a single well</h2><span id='topic+extract.well'></span>

<h3>Description</h3>

<p>Extract data for a single well
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract.well(data)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract.well_+3A_data">data</code></td>
<td>
<p>A <code>data.frame</code> containing fluorescence measurements for the 96 wells
of a plate and several time values. See <cite>read.kinetics</cite> for a way to obtain such
a <code>data.frame</code> from data files produced by a Biotech plate-reader.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The number of measurements might differ between wavelengths. In the Biotek reader used here, this can happen if fluorescence value exceeds the maximum value of 10^6. <code>NA</code> are then added to the <code>data.frame</code>.
</p>


<h3>Value</h3>

<p>A <code>data.frame</code>
</p>

<hr>
<h2 id='fluoSurv'>fluoSurv: A package for estimating insect survival data from spectrophotometry measurements</h2><span id='topic+fluoSurv'></span><span id='topic+fluoSurv-package'></span>

<h3>Description</h3>

<p>The fluoSurv package provides functions to import fluorescence data as exported from a BioTek
microplate reader and functions to estimate insect survival from these fluorescence data.
</p>


<h3>The function to import data</h3>

<p><a href="#topic+read.kinetic">read.kinetic</a>
</p>


<h3>The function to estimate survival</h3>

<p><a href="#topic+estimate.LT">estimate.LT</a>
</p>

<hr>
<h2 id='galleria'>Fluorescence data measured on <em>Galleria mellonella</em></h2><span id='topic+galleria'></span>

<h3>Description</h3>

<p>A dataset containing fluoresence measurements produced by a BioTek microplate
reader. Measurements are taken from 96 larvae of <em>Galleria mellonella</em> which
have been injected with a culture of the bacterium <em>Xenorhabdus nematophila</em>.
</p>


<h3>Format</h3>

<p>A data frame with 382944 rows and 8 variables:
</p>

<dl>
<dt>well</dt><dd><p>Well name.</p>
</dd>
<dt>value</dt><dd><p>Intensity measurement.</p>
</dd>
<dt>t</dt><dd><p>Time.</p>
</dd>
<dt>num</dt><dd><p>Is the insect dead at the end of the experiment?</p>
</dd>
<dt>read</dt><dd><p>Read number, usually 1. This number will be greater than one when a combination of excitation and emission wavelengths is measured several times, with different gains.</p>
</dd>
<dt>exc</dt><dd><p>Excitation wavelength.</p>
</dd>
<dt>em</dt><dd><p>Emission wavelength.</p>
</dd>
<dt>ID_read</dt><dd><p>ID of the read. Combines read number and wavelengths to produce a unique ID for each set of fluorescence measurement. For example, if GFP fluoerscence has been measured with two different gains, the two measurements will be 1_485_535 and 2_485_535.</p>
</dd>
</dl>

<hr>
<h2 id='read.kinetic'>Reads a kinetic file, as produced by a Biotek plate reader.</h2><span id='topic+read.kinetic'></span>

<h3>Description</h3>

<p>Reads a kinetic file, as produced by a Biotek plate reader.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read.kinetic(name, path = NULL, readTime = TRUE, saveData = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="read.kinetic_+3A_name">name</code></td>
<td>
<p>The name of the file to be read</p>
</td></tr>
<tr><td><code id="read.kinetic_+3A_path">path</code></td>
<td>
<p>The path where the file is to be found</p>
</td></tr>
<tr><td><code id="read.kinetic_+3A_readtime">readTime</code></td>
<td>
<p>Should time data be read?</p>
</td></tr>
<tr><td><code id="read.kinetic_+3A_savedata">saveData</code></td>
<td>
<p>Should the resulting <code>data.frame</code> be saved?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a <code>data.frame</code> if <code>saveData</code> is set to <code>FALSE</code>.
If <code>saveData</code> is set to <code>TRUE</code>, the <code>data.frame</code> is saved and the
file name is returned.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## reads data. Warning: files are large, and this operation takes time!
d &lt;- read.kinetic("kinetics_xenorhabdus_galleria.txt",
                     path=system.file('extdata', package = 'fluoSurv'),
                     saveData=FALSE)
str(d)

## saveData should rather be set to TRUE so that converted data are saved
## in a csv file and can be re-used later on.

</code></pre>

<hr>
<h2 id='setup'>An injection experimental setup</h2><span id='topic+setup'></span>

<h3>Description</h3>

<p>A dataset containing the description of an experimental setup where
96 larvae of <em>Galleria mellonella</em> have been injected with a culture
of the bacterium <em>Xenorhabdus nematophila</em>.
</p>


<h3>Format</h3>

<p>A data frame with 96 rows and 4 variables:
</p>

<dl>
<dt>well</dt><dd><p>Well name.</p>
</dd>
<dt>dilution</dt><dd><p>Dilution factor (log-transformed) of the injected culture. 1 therefore means 10 fold dilution, while LB corresponds to negative control where insects have been injected with sterile LB culture medium.</p>
</dd>
<dt>time_injection</dt><dd><p>Time of the injection.</p>
</dd>
<dt>dead</dt><dd><p>Is the insect dead at the end of the experiment?</p>
</dd>
</dl>

<hr>
<h2 id='when.threshold'>Computes when fluorescence exceeds a given threshold value</h2><span id='topic+when.threshold'></span>

<h3>Description</h3>

<p>Computes when fluorescence exceeds a given threshold value
</p>


<h3>Usage</h3>

<pre><code class='language-R'>when.threshold(t, x, min.t = 5, threshold = 0.1, n = 50)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="when.threshold_+3A_t">t</code></td>
<td>
<p>The time value</p>
</td></tr>
<tr><td><code id="when.threshold_+3A_x">x</code></td>
<td>
<p>The fluorescence value</p>
</td></tr>
<tr><td><code id="when.threshold_+3A_min.t">min.t</code></td>
<td>
<p>The time value after which threshold value is searched</p>
</td></tr>
<tr><td><code id="when.threshold_+3A_threshold">threshold</code></td>
<td>
<p>Threshold value, as a proportion above the maximum intensity value observed before min.t</p>
</td></tr>
<tr><td><code id="when.threshold_+3A_n">n</code></td>
<td>
<p>Width of the moving average window used to smooth signal</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
data(galleria)
d &lt;- subset(galleria,!is.na(value))
l  &lt;- lapply(split(d,d$well),extract.well)   #complete kinetics for each well

with(l[["A3"]],plot(t_2_485_535,log(value_2_485_535,10),type="l"))
with(l[["A3"]],abline(v=when.threshold(t_2_485_535,value_2_485_535)))

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
