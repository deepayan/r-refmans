<!DOCTYPE html><html lang="en"><head><title>Help for package psc</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {psc}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#psc-package'><p>psc: Personalised Synthetic Controls</p></a></li>
<li><a href='#acc'><p>acc</p></a></li>
<li><a href='#bin.mod'><p>Example model for a survival outcome</p></a></li>
<li><a href='#coef.psc'><p>Returns the coefficeint estimate of a psc object.</p></a></li>
<li><a href='#cont.mod'><p>Example model for a survival outcome</p></a></li>
<li><a href='#count.mod'><p>Example model for a survival outcome</p></a></li>
<li><a href='#data'><p>Example Dataset of patients with aHCC receiving Lenvetanib</p></a></li>
<li><a href='#data_match'><p>A function to ensure that data from the cfm and data cohort are compatible</p></a></li>
<li><a href='#dataComb'><p>A generic function for cleaning data ready for analysis</p></a></li>
<li><a href='#dataComb.flexsurvreg'><p>Function for cleaning the data of a model with class 'flexsurvreg'</p></a></li>
<li><a href='#dataComb.glm'><p>Function for cleaning the data of a model with class 'flexsurvreg'</p></a></li>
<li><a href='#dataSumm'><p>A function which provides basic summary information of a matrix x</p></a></li>
<li><a href='#initParm'><p>Fucntion for estimating initial parameter values  'flexsurvreg'</p></a></li>
<li><a href='#initParm.flexsurvreg'><p>Fucntion for estimating initial parameter values  'flexsurvreg'</p></a></li>
<li><a href='#initParm.glm'><p>Fucntion for estimating initial parameter values  'flexsurvreg'</p></a></li>
<li><a href='#lik.flexsurvreg'><p>Likelihood function for a psc model of class 'flexsurvreg'</p></a></li>
<li><a href='#lik.flexsurvreg.mtc'><p>Likelihood function for a psc model of class 'flexsurv' with multiple</p>
treatment comparisons</a></li>
<li><a href='#lik.glm'><p>Likelihood function for a psc model of class 'glm'</p></a></li>
<li><a href='#lik.glm.mtc'><p>Likelihood function for a psc model of class 'glm' with multiple</p>
treatment comparisons</a></li>
<li><a href='#linPred'><p>Estimates the linear predictor of a psc object</p></a></li>
<li><a href='#modelExtract'><p>A generic function for extracting model information</p></a></li>
<li><a href='#modelExtract.flexsurvreg'><p>A generic function for extracting model information</p></a></li>
<li><a href='#modelExtract.glm'><p>A generic function for extracting model information</p></a></li>
<li><a href='#modp'><p>modp</p></a></li>
<li><a href='#plot.psc'><p>Function for Plotting PSC objects</p></a></li>
<li><a href='#plot.psc.binary'><p>Function for Plotting PSC objects</p></a></li>
<li><a href='#plot.psc.cont'><p>Function for Plotting PSC objects</p></a></li>
<li><a href='#plot.psc.count'><p>Function for Plotting PSC objects</p>
#' A function which illsutrates the predicted response under the counter factual
model and the observed response under the experimental treatment(s).</a></li>
<li><a href='#plot.psc.flexsurvreg'><p>Function for Plotting PSC objects</p></a></li>
<li><a href='#print.psc'><p>Personalised Synthetic Controls - print</p></a></li>
<li><a href='#psc.object'><p>Fitted <code>psc</code> object</p></a></li>
<li><a href='#pscEst'><p>Function for performing estimation procedures in 'pscfit'</p></a></li>
<li><a href='#pscEst.flexsurvreg'><p>Function for estimating initial parameter values  'flexsurvreg'</p></a></li>
<li><a href='#pscEst.glm'><p>Function for estimating initial parameter values  'flexsurvreg'</p></a></li>
<li><a href='#pscfit'><p>Personalised Synthetic Controls model fit</p></a></li>
<li><a href='#pscSumm'><p>Personalised Synthetic Controls - summary</p></a></li>
<li><a href='#summary.psc'><p>Personalised Synthetic Controls - summary</p></a></li>
<li><a href='#surv_fpm'><p>A function to obtain survival estimates from a flexible parametric model</p></a></li>
<li><a href='#surv.mod'><p>Example model for a survival outcome</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Personalised Synthetic Controls</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1.0</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Richard Jackson &lt;richJ23@liverpool.ac.uk&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Allows the comparison of data cohorts (DC) against a Counter Factual Model (CFM) and measures the difference in terms of an efficacy parameter.  Allows the application of Personalised Synthetic Controls.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/richjjackson/psc/">https://github.com/richjjackson/psc/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/richJJackson/psc/issues">https://github.com/richJJackson/psc/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>mvtnorm, survival, enrichwith, stats, flexsurv, ggplot2,
survminer</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, devtools</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-12-12 20:55:30 UTC; richardjackson</td>
</tr>
<tr>
<td>Author:</td>
<td>Richard Jackson <a href="https://orcid.org/0000-0002-7814-5088"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [cre, aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-12-12 21:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='psc-package'>psc: Personalised Synthetic Controls</h2><span id='topic+psc'></span><span id='topic+psc-package'></span>

<h3>Description</h3>

<p>Allows the comparison of data cohorts (DC) against a Counter Factual Model (CFM) and measures the difference in terms of an efficacy parameter. Allows the application of Personalised Synthetic Controls.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Richard Jackson <a href="mailto:richJ23@liverpool.ac.uk">richJ23@liverpool.ac.uk</a> (<a href="https://orcid.org/0000-0002-7814-5088">ORCID</a>)
</p>


<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/richjjackson/psc/">https://github.com/richjjackson/psc/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/richJJackson/psc/issues">https://github.com/richJJackson/psc/issues</a>
</p>
</li></ul>


<hr>
<h2 id='acc'>acc</h2><span id='topic+acc'></span>

<h3>Description</h3>

<p>Function to accept (or not) a proposed solution used as part of the MCMC procedure
</p>


<h3>Usage</h3>

<pre><code class='language-R'>acc(old, new)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="acc_+3A_old">old</code></td>
<td>
<p>a numeric value</p>
</td></tr>
<tr><td><code id="acc_+3A_new">new</code></td>
<td>
<p>a numeric value</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A function for the evaluation of two likelihoods as part of the MCMC procedure
</p>


<h3>Value</h3>

<p>returns the an evaluation of old/new &gt; U where U is a draw from the uniform distribution
</p>

<hr>
<h2 id='bin.mod'>Example model for a survival outcome</h2><span id='topic+bin.mod'></span>

<h3>Description</h3>

<p>A generated model with a binary endpoint and a logistic link function.  Data
for the model were synthetically generated and are based on a dataset to
evaulate the use of Sorafenib in HCC akin to the PROSASH model
(see ?psc::surv.mod for more details)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bin.mod
</code></pre>


<h3>Format</h3>

<p>A model of class 'glm':
</p>

<dl>
<dt>vi</dt><dd><p>vascular invasion</p>
</dd>
<dt>ecog</dt><dd><p>ECOG performance Status</p>
</dd>
<dt>logafp</dt><dd><p>AFP - log scale</p>
</dd>
<dt>alb</dt><dd><p>albumin</p>
</dd>
<dt>logcreat</dt><dd><p>Creatinine - log scale</p>
</dd>
<dt>allmets</dt><dd><p>metastesis</p>
</dd>
</dl>



<h3>Source</h3>

<p>simulated
</p>

<hr>
<h2 id='coef.psc'>Returns the coefficeint estimate of a psc object.</h2><span id='topic+coef.psc'></span>

<h3>Description</h3>

<p>Returns basic measures of the posterior distribution obtained from the
pscfit.R function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'psc'
coef(object, ..., level = 0.05)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="coef.psc_+3A_object">object</code></td>
<td>
<p>a 'psc' object</p>
</td></tr>
<tr><td><code id="coef.psc_+3A_...">...</code></td>
<td>
<p>not used</p>
</td></tr>
<tr><td><code id="coef.psc_+3A_level">level</code></td>
<td>
<p>the level at which credibility intervals are assessed, defaults to 0.05</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The summary of the posterior distribution for the efficacy parameter in terms of the median and 95
</p>

<hr>
<h2 id='cont.mod'>Example model for a survival outcome</h2><span id='topic+cont.mod'></span>

<h3>Description</h3>

<p>A generated model with a continuous data endpoint and a identity link function.
Data for the model were synthetically generated and are based on a dataset to
evaulate the use of Sorafenib in HCC akin to the PROSASH model
(see ?psc::surv.mod for more details)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cont.mod
</code></pre>


<h3>Format</h3>

<p>A model of class 'glm':
</p>

<dl>
<dt>ecog</dt><dd><p>ECOG performance Status</p>
</dd>
<dt>logafp</dt><dd><p>AFP - log scale</p>
</dd>
<dt>alb</dt><dd><p>albumin</p>
</dd>
<dt>logcreat</dt><dd><p>Creatinine - log scale</p>
</dd>
</dl>



<h3>Source</h3>

<p>simulated
</p>

<hr>
<h2 id='count.mod'>Example model for a survival outcome</h2><span id='topic+count.mod'></span>

<h3>Description</h3>

<p>A generated model with a count data endpoint and a log link function.
Data for the model were synthetically generated and are based on a dataset to
evaulate the use of Sorafenib in HCC akin to the PROSASH model
(see ?psc::surv.mod for more details)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>count.mod
</code></pre>


<h3>Format</h3>

<p>A model of class 'glm':
</p>

<dl>
<dt>ecog</dt><dd><p>ECOG performance Status</p>
</dd>
<dt>logafp</dt><dd><p>AFP - log scale</p>
</dd>
<dt>alb</dt><dd><p>albumin</p>
</dd>
<dt>logcreat</dt><dd><p>Creatinine - log scale</p>
</dd>
</dl>



<h3>Source</h3>

<p>simulated
</p>

<hr>
<h2 id='data'>Example Dataset of patients with aHCC receiving Lenvetanib</h2><span id='topic+data'></span>

<h3>Description</h3>

<p>A dataset containing 100 simulated patients.  Data are based on the data used
to generate PROSASH survival model -see ?psc::surv.mod for more detials.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data
</code></pre>


<h3>Format</h3>

<p>A model of class 'flezsurvreg':
</p>

<dl>
<dt>gamma</dt><dd><p>cumulative baseline hazard parameters</p>
</dd>
<dt>vi</dt><dd><p>vascular invasion</p>
</dd>
<dt>age60</dt><dd><p>patient age (centred at 60)</p>
</dd>
<dt>ecog</dt><dd><p>ECOG performance Status</p>
</dd>
<dt>logafp</dt><dd><p>AFP - log scale</p>
</dd>
<dt>alb</dt><dd><p>albumin</p>
</dd>
<dt>logcreat</dt><dd><p>Creatinine - log scale</p>
</dd>
<dt>allmets</dt><dd><p>metastesis</p>
</dd>
<dt>ageVasInv</dt><dd><p>centred age nested within vascular invasion</p>
</dd>
<dt>time</dt><dd><p>survival time</p>
</dd>
<dt>cen</dt><dd><p>censoring indicator</p>
</dd>
<dt>os</dt><dd><p>survival time</p>
</dd>
<dt>count</dt><dd><p>exapmple outcome for count data</p>
</dd>
<dt>trt</dt><dd><p>exapmple identifier for mulitple treatment comparisons</p>
</dd>
<dt>aet</dt><dd><p>Aetiology</p>
</dd>
</dl>



<h3>Source</h3>

<p>simulated
</p>

<hr>
<h2 id='data_match'>A function to ensure that data from the cfm and data cohort are compatible</h2><span id='topic+data_match'></span>

<h3>Description</h3>

<p>The purpose of this function is to run a series of checks to ensure that the
data included in the data cohort is comparable to the counter-factual model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data_match(cfm.data, dc.data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="data_match_+3A_cfm.data">cfm.data</code></td>
<td>
<p>a model object supplied to pscfit</p>
</td></tr>
<tr><td><code id="data_match_+3A_dc.data">dc.data</code></td>
<td>
<p>a dataset including covariates to match the CFM</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a dataset which is checked and compatible with the CFM
</p>

<hr>
<h2 id='dataComb'>A generic function for cleaning data ready for analysis</h2><span id='topic+dataComb'></span>

<h3>Description</h3>

<p>A generic function for cleaning data ready for analysis
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dataComb(CFM, DC, id = NULL, trt = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dataComb_+3A_cfm">CFM</code></td>
<td>
<p>a model object supplied to pscfit</p>
</td></tr>
<tr><td><code id="dataComb_+3A_dc">DC</code></td>
<td>
<p>a dataset including covariates to match the CFM</p>
</td></tr>
<tr><td><code id="dataComb_+3A_id">id</code></td>
<td>
<p>to specify which observations in the data cohort should be evaluated.  Defualts to 'NULL' i.e all observations</p>
</td></tr>
<tr><td><code id="dataComb_+3A_trt">trt</code></td>
<td>
<p>used to specify multiple treatment effects. Defaults to NULL</p>
</td></tr>
</table>


<h3>Value</h3>

<p>datComb returns a list containing objects which detial the components of both the
Counter Factual Model (CFM) and the Data Cohort (DC) the required exported components
of the model and a cleaned data cohort.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>bin.mod &lt;- psc::bin.mod
data &lt;- psc::data
dc &lt;- dataComb(bin.mod,data)
</code></pre>

<hr>
<h2 id='dataComb.flexsurvreg'>Function for cleaning the data of a model with class 'flexsurvreg'</h2><span id='topic+dataComb.flexsurvreg'></span>

<h3>Description</h3>

<p>The purpose of this function is to prepare the dataset and the counter-factual
model for estimation and is the first step pf the pscfit.R process. The output
is a complete-case dataset where the data names match the variables used in the CFM.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'flexsurvreg'
dataComb(CFM, DC, id = NULL, trt = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dataComb.flexsurvreg_+3A_cfm">CFM</code></td>
<td>
<p>a model object supplied to pscfit</p>
</td></tr>
<tr><td><code id="dataComb.flexsurvreg_+3A_dc">DC</code></td>
<td>
<p>a dataset including covariates to match the CFM</p>
</td></tr>
<tr><td><code id="dataComb.flexsurvreg_+3A_id">id</code></td>
<td>
<p>a vector specifiying whether a subset of the dataset should be selected.
Defaults to 'NULL' e.g. all data points included</p>
</td></tr>
<tr><td><code id="dataComb.flexsurvreg_+3A_trt">trt</code></td>
<td>
<p>An optional additional vector denoting treatment allocations for multiple treatment comparisons.  Defaults to 'NULL'</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list containing objects which specifiy the required exported components
of the model and a cleaned data cohort.
Attributes include </p>

<ul>
<li><p>'model.type' specifying the class of model to be used as the CFM 
</p>
</li>
<li><p>'model_extract' sepcifying the model componets required for estimation
</p>
</li>
<li><p>'cov' a cleaned dataset of covariates
</p>
</li>
<li><p>'outcome' a cleaned dataset containing the outcomes
</p>
</li></ul>


<hr>
<h2 id='dataComb.glm'>Function for cleaning the data of a model with class 'flexsurvreg'</h2><span id='topic+dataComb.glm'></span>

<h3>Description</h3>

<p>The purpose of this function is to prepare the dataset and the counter-factual
model for estimation and is the first step pf the pscfit.R process. The output
is a complete-case dataset where the data names match the variables used in the CFM.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'glm'
dataComb(CFM, DC, id = NULL, trt = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dataComb.glm_+3A_cfm">CFM</code></td>
<td>
<p>a model object supplied to pscfit</p>
</td></tr>
<tr><td><code id="dataComb.glm_+3A_dc">DC</code></td>
<td>
<p>a dataset including covariates to match the CFM</p>
</td></tr>
<tr><td><code id="dataComb.glm_+3A_id">id</code></td>
<td>
<p>to specify which observations in the data cohort should be evaluated.
Defualts to 'NULL' i.e all observations</p>
</td></tr>
<tr><td><code id="dataComb.glm_+3A_trt">trt</code></td>
<td>
<p>used to specify multiple treatment effects. Defaults to NULL</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list containing objects which specifiy the required exported components
of the model and a cleaned data cohort.  Attirbutes of the 'cleaned' object include:
Attributes include </p>

<ul>
<li><p>'model.type' specifying the class of model to be used as the CFM 
</p>
</li>
<li><p>'model_extract' sepcifying the model componets required for estimation
</p>
</li>
<li><p>'cov' a cleaned dataset of covariates
</p>
</li>
<li><p>'outcome' a cleaned dataset containing the outcomes
</p>
</li></ul>


<hr>
<h2 id='dataSumm'>A function which provides basic summary information of a matrix x</h2><span id='topic+dataSumm'></span>

<h3>Description</h3>

<p>A function which provides basic summaries of data provided within a data frame
of covariets.  Summaries are in the form of frequencies of counts and associated
percentages for categorical data and median (IQR) for continuous data.
Intended for use with the pscCFM.R function to define the setting in which a
model has been generated
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dataSumm(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dataSumm_+3A_x">x</code></td>
<td>
<p>a matrix of covariates</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Categorical/Character data are summarised by a table and Continuous
data are summarised as median (IQR)
</p>

<hr>
<h2 id='initParm'>Fucntion for estimating initial parameter values  'flexsurvreg'</h2><span id='topic+initParm'></span>

<h3>Description</h3>

<p>A generic function for estimating the initial parameters for estimation as part
of the pscfti.R function.  Parameter estimates are obtained using standard
optomisation methods provided by the 'optim' set of functions.  For a single
parameter a Brent method is applied.  For mutliple treatment comparisons the
'BFGS' method is applied.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>initParm(CFM, DC_clean, trt)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="initParm_+3A_cfm">CFM</code></td>
<td>
<p>A counter-factual model</p>
</td></tr>
<tr><td><code id="initParm_+3A_dc_clean">DC_clean</code></td>
<td>
<p>a cleaned dataset obsect obtained using dataComb.flexsurvreg</p>
</td></tr>
<tr><td><code id="initParm_+3A_trt">trt</code></td>
<td>
<p>An optional additional vector denoting treatment allocations for multiple treatment comparisons.  Defaults to 'NULL'</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function takes the liklihood for a 'flexsurvreg' model and uses 'optim'
to fit the likelihood.
</p>


<h3>Value</h3>

<p>an 'optim' output giving the parameter values to be supplied as a
starting value for the mcmc routine.
</p>

<hr>
<h2 id='initParm.flexsurvreg'>Fucntion for estimating initial parameter values  'flexsurvreg'</h2><span id='topic+initParm.flexsurvreg'></span>

<h3>Description</h3>

<p>Fucntion for estimating initial parameter values  'flexsurvreg'
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'flexsurvreg'
initParm(CFM, DC_clean, trt = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="initParm.flexsurvreg_+3A_cfm">CFM</code></td>
<td>
<p>A counter-factual model</p>
</td></tr>
<tr><td><code id="initParm.flexsurvreg_+3A_dc_clean">DC_clean</code></td>
<td>
<p>a cleaned dataset obsect obtained using dataComb.flexsurvreg</p>
</td></tr>
<tr><td><code id="initParm.flexsurvreg_+3A_trt">trt</code></td>
<td>
<p>An optional additional vector denoting treatment allocations for multiple treatment comparisons.  Defaults to 'NULL'</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function takes the liklihood for a 'flexsurvreg' model and uses 'optim'
to fit the likelihood.
</p>


<h3>Value</h3>

<p>an 'optim' output giving the parameter values to be supplied as a
starting value for the mcmc routine.
</p>

<hr>
<h2 id='initParm.glm'>Fucntion for estimating initial parameter values  'flexsurvreg'</h2><span id='topic+initParm.glm'></span>

<h3>Description</h3>

<p>Fucntion for estimating initial parameter values  'flexsurvreg'
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'glm'
initParm(CFM, DC_clean, trt = trt)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="initParm.glm_+3A_cfm">CFM</code></td>
<td>
<p>A counter-factual model</p>
</td></tr>
<tr><td><code id="initParm.glm_+3A_dc_clean">DC_clean</code></td>
<td>
<p>a cleaned dataset obsect obtained using dataComb.flexsurvreg</p>
</td></tr>
<tr><td><code id="initParm.glm_+3A_trt">trt</code></td>
<td>
<p>An optional additional vector denoting treatment allocations for multiple treatment comparisons.  Defaults to 'NULL'</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function takes the liklihood for a 'flexsurvreg' model and uses 'optim'
to fit the likelihood.
</p>


<h3>Value</h3>

<p>an 'optim' output giving the parameter values to be supplied as a
starting value for the mcmc routine.
</p>

<hr>
<h2 id='lik.flexsurvreg'>Likelihood function for a psc model of class 'flexsurvreg'</h2><span id='topic+lik.flexsurvreg'></span>

<h3>Description</h3>

<p>A function which defines the likelihood for a PSC model where the Counter
Factual Model (CFM) takes the form of a 'flexsurvreg' object and an efficacy
parameter (<code class="reqn">\beta</code>) is being estimated.  For more details on fitting please see
?pscfit and ?pscEst
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lik.flexsurvreg(beta, DC_clean)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="lik.flexsurvreg_+3A_beta">beta</code></td>
<td>
<p>a parameter to be estimate</p>
</td></tr>
<tr><td><code id="lik.flexsurvreg_+3A_dc_clean">DC_clean</code></td>
<td>
<p>a cleaned dataset including covariates to match the CFM</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A likelihood function for use by pscfit for a model of class
'flexsurvreg'
</p>

<hr>
<h2 id='lik.flexsurvreg.mtc'>Likelihood function for a psc model of class 'flexsurv' with multiple
treatment comparisons</h2><span id='topic+lik.flexsurvreg.mtc'></span>

<h3>Description</h3>

<p>A function which defines the likelihood for a PSC model where the Counter
Factual Model (CFM) takes the form of a 'flexsurvreg' object and a mulitple efficacy
parameters (<code class="reqn">\beta</code>) is being estimated.  For more details on fitting please see
?pscfit and ?pscEst
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lik.flexsurvreg.mtc(beta, DC_clean)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="lik.flexsurvreg.mtc_+3A_beta">beta</code></td>
<td>
<p>a parameter to be estimate</p>
</td></tr>
<tr><td><code id="lik.flexsurvreg.mtc_+3A_dc_clean">DC_clean</code></td>
<td>
<p>a cleaned dataset including covariates to match the CFM</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A likelihood function for use by pscfit for a model of class 'flexsurvreg'
where multiple treatment comparisons are required
</p>

<hr>
<h2 id='lik.glm'>Likelihood function for a psc model of class 'glm'</h2><span id='topic+lik.glm'></span>

<h3>Description</h3>

<p>A function which defines the likelihood for a PSC model where the Counter
Factual Model (CFM) takes the form of a 'glm' object and an efficacy
parameter (<code class="reqn">\beta</code>) is being estimated.  For more details on fitting please see
?pscfit and ?pscEst
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lik.glm(beta, DC_clean)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="lik.glm_+3A_beta">beta</code></td>
<td>
<p>a parameter to be estimate</p>
</td></tr>
<tr><td><code id="lik.glm_+3A_dc_clean">DC_clean</code></td>
<td>
<p>a cleaned dataset including covariates to match the CFM</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A likelihood function for use by pscfit for a model of class
'glm'
</p>

<hr>
<h2 id='lik.glm.mtc'>Likelihood function for a psc model of class 'glm' with multiple
treatment comparisons</h2><span id='topic+lik.glm.mtc'></span>

<h3>Description</h3>

<p>A function which defines the likelihood for a PSC model where the Counter
Factual Model (CFM) takes the form of a 'glm' object and a mulitple efficacy
parameters (<code class="reqn">\beta</code>) is being estimated.  For more details on fitting please see
?pscfit and ?pscEst
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lik.glm.mtc(beta, DC_clean)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="lik.glm.mtc_+3A_beta">beta</code></td>
<td>
<p>a parameter to be estimate</p>
</td></tr>
<tr><td><code id="lik.glm.mtc_+3A_dc_clean">DC_clean</code></td>
<td>
<p>a cleaned dataset including covariates to match the CFM</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A likelihood function for use by pscfit for a model of class 'flexsurvreg'
where multiple treatment comparisons are required
</p>

<hr>
<h2 id='linPred'>Estimates the linear predictor of a psc object</h2><span id='topic+linPred'></span>

<h3>Description</h3>

<p>A function which created a linear predictor from a model and an external
dataset.  If required, linear predictors will be provided on the response
scale.  For a survival outcome, this will take the form of median survival
estimates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>linPred(DC_clean, resp = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="linPred_+3A_dc_clean">DC_clean</code></td>
<td>
<p>a cleaned data obhject created using dataComb()</p>
</td></tr>
<tr><td><code id="linPred_+3A_resp">resp</code></td>
<td>
<p>detailing whether the linear predictor shoudl be returned on the natural or response level.  Defaults to the natural scale (resp=F)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A function which combines the data from the data cohort against the model parameters of the PSC
</p>


<h3>Value</h3>

<p>Extracts the linear predictor from a object containing both a counter factual model and a data cohort which is created using the dataComb() fucntion.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(psc)
library(survival)
surv.mod &lt;- psc::surv.mod
data &lt;- psc::data
dc &lt;- dataComb(surv.mod,data)
lp &lt;- linPred(dc)
</code></pre>

<hr>
<h2 id='modelExtract'>A generic function for extracting model information</h2><span id='topic+modelExtract'></span>

<h3>Description</h3>

<p>A generic function for extracting model information
</p>


<h3>Usage</h3>

<pre><code class='language-R'>modelExtract(CFM)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="modelExtract_+3A_cfm">CFM</code></td>
<td>
<p>a model of class either 'glm' or 'flexsurvreg'</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A function for extracting the model information required for using pscfit
</p>


<h3>Value</h3>

<p>a list of extracted model components
</p>

<hr>
<h2 id='modelExtract.flexsurvreg'>A generic function for extracting model information</h2><span id='topic+modelExtract.flexsurvreg'></span>

<h3>Description</h3>

<p>This function extracts model information for use with the pscfit.R function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'flexsurvreg'
modelExtract(CFM)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="modelExtract.flexsurvreg_+3A_cfm">CFM</code></td>
<td>
<p>a model of class 'flexsurvreg'</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A function for extracting the model information required for using pscfit
</p>


<h3>Value</h3>

<p>a list of extracted model components.  Included are
</p>

<ul>
<li><p>model.frame a dataset of the covareits used to create the model
</p>
</li>
<li><p>cov_co: covariate coefficients
</p>
</li>
<li><p>sig: variance-covariance matrix
</p>
</li>
<li><p>haz_co: hazard parameter coefficients
</p>
</li>
<li><p>k: number of knots
</p>
</li>
<li><p>knots: knot position
</p>
</li>
<li><p>lam: lambda parameter
</p>
</li>
<li><p>form: model formula
</p>
</li></ul>


<hr>
<h2 id='modelExtract.glm'>A generic function for extracting model information</h2><span id='topic+modelExtract.glm'></span>

<h3>Description</h3>

<p>A generic function for extracting model information
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'glm'
modelExtract(CFM)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="modelExtract.glm_+3A_cfm">CFM</code></td>
<td>
<p>a model of class 'glm'</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A function for extracting the model information required for using pscfit
</p>


<h3>Value</h3>

<p>a list of extracted model components.  Included are
</p>

<ul>
<li><p>model.frame a dataset of the covareits used to create the model
</p>
</li>
<li><p>cov_co: covariate coefficients
</p>
</li>
<li><p>sig: variance-covariance matrix
</p>
</li>
<li><p>form: model formula
</p>
</li>
<li><p>family: model family
</p>
</li>
<li><p>out.nm: outcome covariates names
</p>
</li></ul>


<hr>
<h2 id='modp'>modp</h2><span id='topic+modp'></span>

<h3>Description</h3>

<p>A function which rrturns either the input value (if positive) or zero (if
negative)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>modp(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="modp_+3A_x">x</code></td>
<td>
<p>a numberic vector</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A fucntion which returns a version of x with negative values replacd with 0
</p>


<h3>Value</h3>

<p>a numeric vector with negative values replaced with 0
</p>

<hr>
<h2 id='plot.psc'>Function for Plotting PSC objects</h2><span id='topic+plot.psc'></span>

<h3>Description</h3>

<p>A function which illsutrates the predicted response under the Counter Factual
Model (CFM) and the observed response under the experimental treatment(s).
Form of the output will depend on the form of the CFM used
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'psc'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.psc_+3A_x">x</code></td>
<td>
<p>an object of class 'psc'</p>
</td></tr>
<tr><td><code id="plot.psc_+3A_...">...</code></td>
<td>
<p>not used</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function plots the expected response of the control treatment
along with the observe response rates of the experimental arms
</p>


<h3>Value</h3>

<p>a survival plot corresponding to the psc fit
</p>


<h3>Examples</h3>

<pre><code class='language-R'>bin.mod &lt;- psc::bin.mod
data &lt;- psc::data
bin.psc &lt;- pscfit(bin.mod,data,nsim=3000)
plot(bin.psc)
</code></pre>

<hr>
<h2 id='plot.psc.binary'>Function for Plotting PSC objects</h2><span id='topic+plot.psc.binary'></span>

<h3>Description</h3>

<p>A function which illsutrates the predicted response under the counter factual
model and the observed response under the experimental treatment(s).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'psc.binary'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.psc.binary_+3A_x">x</code></td>
<td>
<p>an object of class 'psc'</p>
</td></tr>
<tr><td><code id="plot.psc.binary_+3A_...">...</code></td>
<td>
<p>not used</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function plots the expected response of the control treatment
along with the observe response rates of the experimental arms
</p>


<h3>Value</h3>

<p>a survival plot corresponding to the psc fit
</p>


<h3>Examples</h3>

<pre><code class='language-R'>bin.mod &lt;- psc::bin.mod
data &lt;- psc::data
bin.psc &lt;- pscfit(bin.mod,data,nsim=3000)
plot(bin.psc)
</code></pre>

<hr>
<h2 id='plot.psc.cont'>Function for Plotting PSC objects</h2><span id='topic+plot.psc.cont'></span>

<h3>Description</h3>

<p>A function which illsutrates the predicted response under the counter factual
model and the observed response under the experimental treatment(s).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'psc.cont'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.psc.cont_+3A_x">x</code></td>
<td>
<p>an object of class 'psc'</p>
</td></tr>
<tr><td><code id="plot.psc.cont_+3A_...">...</code></td>
<td>
<p>not used</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function plots the expected response of the control treatment
along with the observe response rates of the experimental arms
</p>


<h3>Value</h3>

<p>a survival plot corresponding to the psc fit
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cont.mod &lt;- psc::cont.mod
data &lt;- psc::data
cont.psc &lt;- pscfit(cont.mod,data,nsim=3000)
plot(cont.psc)
</code></pre>

<hr>
<h2 id='plot.psc.count'>Function for Plotting PSC objects
#' A function which illsutrates the predicted response under the counter factual
model and the observed response under the experimental treatment(s).</h2><span id='topic+plot.psc.count'></span>

<h3>Description</h3>

<p>Function for Plotting PSC objects
#' A function which illsutrates the predicted response under the counter factual
model and the observed response under the experimental treatment(s).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'psc.count'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.psc.count_+3A_x">x</code></td>
<td>
<p>an object of class 'psc'</p>
</td></tr>
<tr><td><code id="plot.psc.count_+3A_...">...</code></td>
<td>
<p>not used</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function plots the expected response of the control treatment
along with the observe response rates of the experimental arms
</p>


<h3>Value</h3>

<p>a survival plot corresponding to the psc fit
</p>


<h3>Examples</h3>

<pre><code class='language-R'>count.mod &lt;- psc::count.mod
data &lt;- psc::data
count.psc &lt;- pscfit(count.mod,data,nsim=3000)
plot(count.psc)
</code></pre>

<hr>
<h2 id='plot.psc.flexsurvreg'>Function for Plotting PSC objects</h2><span id='topic+plot.psc.flexsurvreg'></span>

<h3>Description</h3>

<p>Function for Plotting PSC objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'psc.flexsurvreg'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.psc.flexsurvreg_+3A_x">x</code></td>
<td>
<p>an object of class 'psc'</p>
</td></tr>
<tr><td><code id="plot.psc.flexsurvreg_+3A_...">...</code></td>
<td>
<p>not used</p>
</td></tr>
</table>


<h3>Details</h3>

<p>making use of 'ggsurvplot' in the survminer package, this function
plots the expected survival funtion for the 'control' treatment estimated
from the CFM along with the Kaplan Meier estimates of the observed events
</p>


<h3>Value</h3>

<p>a survival plot corresponding to the psc fit
</p>

<hr>
<h2 id='print.psc'>Personalised Synthetic Controls - print</h2><span id='topic+print.psc'></span>

<h3>Description</h3>

<p>Personalised Synthetic Controls - print
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'psc'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.psc_+3A_x">x</code></td>
<td>
<p>an object of class 'psc'</p>
</td></tr>
<tr><td><code id="print.psc_+3A_...">...</code></td>
<td>
<p>not used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>printing psc results
</p>

<hr>
<h2 id='psc.object'>Fitted <code>psc</code> object</h2><span id='topic+psc.object'></span>

<h3>Description</h3>

<p>An object returned by the <code>pscfit</code> function, inheriting from class
<code>psc</code> and representing a fitted personlised synthetic control model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>psc.object
</code></pre>


<h3>Format</h3>

<p>An object of class <code>NULL</code> of length 0.
</p>


<h3>Author(s)</h3>

<p>Richard Jasckson (<a href="mailto:richj23@liverpool.ac.uk">richj23@liverpool.ac.uk</a>)
</p>

<hr>
<h2 id='pscEst'>Function for performing estimation procedures in 'pscfit'</h2><span id='topic+pscEst'></span>

<h3>Description</h3>

<p>Function for performing estimation procedures in 'pscfit'
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pscEst(CFM, DC_clean, nsim, start, trt)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pscEst_+3A_cfm">CFM</code></td>
<td>
<p>a model object supplied to pscfit</p>
</td></tr>
<tr><td><code id="pscEst_+3A_dc_clean">DC_clean</code></td>
<td>
<p>a cleaned dataset ontained using dataComb().</p>
</td></tr>
<tr><td><code id="pscEst_+3A_nsim">nsim</code></td>
<td>
<p>the number of MCMC simulations to run</p>
</td></tr>
<tr><td><code id="pscEst_+3A_start">start</code></td>
<td>
<p>the stating value for</p>
</td></tr>
<tr><td><code id="pscEst_+3A_trt">trt</code></td>
<td>
<p>an optional vector denoting treatment allocations where mulitple
treatment comparisons are bieng made</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Define the set of model parameters <code class="reqn">B</code> to contain <code class="reqn">\Gamma</code> which summarize
the parameters of the CFM. Prior distributions are defined for B using a
multivariate normal distribution <code class="reqn">\pi (B) \sim MVN(\mu ,\Sigma)</code> where <code class="reqn">\mu|</code>
is the vector of coefficient estimates from the validated model and <code class="reqn">\Sigma</code>
is the variance-covariance matrix. This information is taken directly from the
outputs of the parametric model and no further elicitation is required.
The prior distirbution for the efficacy parameter (<code class="reqn">\pi{(\beta)}</code>) is set
as an uniformative <code class="reqn">N(0,1000)</code>.
</p>
<p>Ultimately the aim is to estimate the posterior distribution for <code class="reqn">\beta</code> conditional
on the distribution of B and the observed data.  A full form for the posterior
distribution is then given as
</p>
<p style="text-align: center;"><code class="reqn">P(\beta \vert B,D) \propto L(D \vert B,\beta) \pi(B) \pi(\beta)</code>
</p>

<p>Please see 'pscfit' for more details on liklihood formation.
</p>
<p>For each iteration of the MCMC procedure, the following algorithm is performed </p>

<ol>
<li><p>Set and indicator s=1, and define an initial state based on prior
hyperparameters for <code class="reqn">\pi(B)</code>  and <code class="reqn">\pi(\beta)</code> such that <code class="reqn">b_s = \mu and \tau_s=0</code>
</p>
</li>
<li><p>Update <code class="reqn">s = s+1</code> and draw model parameters <code class="reqn">b_s</code> from <code class="reqn">\pi(B)</code> and an draw a
proposal estimate of <code class="reqn">\beta</code> from some target distribution
</p>
</li>
<li><p>Estimate <code class="reqn">\Gamma_(i,S)=\nu^T x_i</code> where <code class="reqn">\nu</code> is the subset of parameters from <code class="reqn">b_s</code>
which relate to the model covariates and define 2 new likelihood functions
<code class="reqn">\Theta_(s,1)=L(D \vert B=b_s,\beta=\tau_(s-1) )</code> &amp; <code class="reqn">\Theta_(s,2)= L(D \vert B=b_s,\beta=\tau_s)</code>
</p>
</li>
<li><p>Draw a single value <code class="reqn">\psi</code> from a Uniform (0,1) distribution and estimate
the condition <code class="reqn">\omega=  \Theta_(s,1)/\Theta_(s,2)</code>. If <code class="reqn">\omega &gt; \psi</code> then accept <code class="reqn">\tau_s</code> as belonging
to the posterior distribution <code class="reqn">P(\beta \vert B,D)</code> otherwise retain <code class="reqn">\tau_(s-1)</code>
</p>
</li>
<li><p>Repeat steps 2 – 4 for the required number of iterations
</p>
</li></ol>

<p>The result of the algorithm is a posterior distribution for the log hazard ratio,
<code class="reqn">\beta</code>, captures the variability in B through the defined priors <code class="reqn">\pi{(\beta)}</code>.
</p>


<h3>Value</h3>

<p>A matrix containing the draws form the posterior distribution
</p>

<hr>
<h2 id='pscEst.flexsurvreg'>Function for estimating initial parameter values  'flexsurvreg'</h2><span id='topic+pscEst.flexsurvreg'></span>

<h3>Description</h3>

<p>A function which performs the Bayesian MCMC estimation procedure for
estimating the efficacy parameter (<code class="reqn">\beta</code>) using personalised sunthetic
controls methodology.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'flexsurvreg'
pscEst(CFM, DC_clean, nsim, start, trt = trt)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pscEst.flexsurvreg_+3A_cfm">CFM</code></td>
<td>
<p>a model object supplied to pscfit</p>
</td></tr>
<tr><td><code id="pscEst.flexsurvreg_+3A_dc_clean">DC_clean</code></td>
<td>
<p>a cleaned dataset ontained using dataComb().</p>
</td></tr>
<tr><td><code id="pscEst.flexsurvreg_+3A_nsim">nsim</code></td>
<td>
<p>the number of MCMC simulations to run</p>
</td></tr>
<tr><td><code id="pscEst.flexsurvreg_+3A_start">start</code></td>
<td>
<p>the stating value for</p>
</td></tr>
<tr><td><code id="pscEst.flexsurvreg_+3A_trt">trt</code></td>
<td>
<p>an optional vector denoting treatment allocations where multiple
treatment comparisons are being made</p>
</td></tr>
</table>


<h3>Details</h3>

<p>An MCMC routine for fitting a psc model
</p>


<h3>Value</h3>

<p>A matrix containing the draws form the posterior distribution
</p>

<hr>
<h2 id='pscEst.glm'>Function for estimating initial parameter values  'flexsurvreg'</h2><span id='topic+pscEst.glm'></span>

<h3>Description</h3>

<p>A function which performs the Bayesian MCMC estimation procedure for
estimating the efficacy parameter (<code class="reqn">\beta</code>) using personalised sunthetic
controls methodology.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'glm'
pscEst(CFM, DC_clean, nsim, start, trt = trt)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pscEst.glm_+3A_cfm">CFM</code></td>
<td>
<p>a model object supplied to pscfit</p>
</td></tr>
<tr><td><code id="pscEst.glm_+3A_dc_clean">DC_clean</code></td>
<td>
<p>a cleaned dataset ontained using dataComb().</p>
</td></tr>
<tr><td><code id="pscEst.glm_+3A_nsim">nsim</code></td>
<td>
<p>the number of MCMC simulations to run</p>
</td></tr>
<tr><td><code id="pscEst.glm_+3A_start">start</code></td>
<td>
<p>the stating value for</p>
</td></tr>
<tr><td><code id="pscEst.glm_+3A_trt">trt</code></td>
<td>
<p>an optional vector denoting treatment allocations where multiple
treatment comparisons are being made</p>
</td></tr>
</table>


<h3>Details</h3>

<p>An MCMC routine for fitting a psc model
</p>


<h3>Value</h3>

<p>a matrix containing the draws form the posterior distribution
</p>

<hr>
<h2 id='pscfit'>Personalised Synthetic Controls model fit</h2><span id='topic+pscfit'></span>

<h3>Description</h3>

<p>Function which allows comparison of a data cohort against a parametric Counter Factual Model (CFM).
The function allows models of the type 'flexsurvreg' and 'glm' to be supplied.
The function performs by calculating the linear predictor as a combination of
the CFM and the dataset supplied and then selects a likelihood
based on the type of model specified.  Likelihood is estimated using a Baysian MCMC
procedure wherebey the parameters of the CFM acts as informative priors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pscfit(CFM, DC, nsim = 5000, id = NULL, trt = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pscfit_+3A_cfm">CFM</code></td>
<td>
<p>An R model object of class 'glm' or 'flexsurvspline'</p>
</td></tr>
<tr><td><code id="pscfit_+3A_dc">DC</code></td>
<td>
<p>A dataset including columns to match to covariates in the model</p>
</td></tr>
<tr><td><code id="pscfit_+3A_nsim">nsim</code></td>
<td>
<p>The number of simulations for the MCMC routine</p>
</td></tr>
<tr><td><code id="pscfit_+3A_id">id</code></td>
<td>
<p>Numeric vector stating which patient(s) from the dataset should be included in the analysis.
Defaults to all patients</p>
</td></tr>
<tr><td><code id="pscfit_+3A_trt">trt</code></td>
<td>
<p>An optional vector denoting treatment allocations for multiple treatment comparisons.  Defaults to NULL.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Model currently supports estimation of more than one treatment (using the
'trt') option and esitmation restricted to sub-groups of the data cohort
(using the 'id' option.
</p>
<p>the <code>pscfit</code> function compares a dataset ('DC') against a parametric model.
This is done by selecting a likelihood which is identified by the type of CFM that is supplied.
At present, two types of model are supported, a flexible parmaeteric survival model of type 'flexsurvreg'
and a geleneralised linear model of type 'glm'.
</p>
<p>Where the CFM is of type 'flexsurvreg' the likeihood supplied is of the form:
</p>
<p style="text-align: center;"><code class="reqn">L(D \vert \Lambda, \Gamma_i) = \prod^{n}_{i=1} f(t_i \vert  \Lambda, \Gamma_i)^{c_i}
  S(t_i|\Lambda, \Gamma_i)^{(1-c_i)}</code>
</p>

<p>Where <code class="reqn">\Lambda</code> defines the cumulative baseline hazard function,
<code class="reqn">\Gamma</code> is the linear predictor and <code class="reqn">t</code> and <code class="reqn">c</code> are the
event time and indicator variables.
</p>
<p>Where the CFM is of the type 'glm' the likelihood supplied is of the form:
</p>
<p style="text-align: center;"><code class="reqn">L(x \vert \Gamma_i) = \prod^{n}_{i=1} b(x \vert \Gamma_i) \exp{\{\Gamma_i^T t(x)
   - c(\Gamma_i)\} } </code>
</p>

<p>Where <code class="reqn">b(.)</code>, <code class="reqn">t(.)</code> and <code class="reqn">c(.)</code> represent the functions of the
exponential family. In both cases, <code class="reqn">\Gamma</code> is defined as:
</p>
<p style="text-align: center;"><code class="reqn">\Gamma = \gamma x + \beta</code>
</p>

<p>Where <code class="reqn">\gamma</code> are the model coefficients supplied by the CFM and <code class="reqn">\beta</code>
is the parameter set to measure the difference between the CFM and the DC.
</p>
<p>Estimation is performed using a Bayesian MCMC procedure.  Prior distributions
for <code class="reqn">\Gamma</code> (&amp; <code class="reqn">\Lambda</code>) are derived directly from the model
coefficients (mean and variance covariance matrix) or the CFM. A bespoke MCMC
routine is performed to estimate <code class="reqn">\beta</code>.  Please see '?mcmc' for more detials.
</p>
<p>For the standard example where the DC contains information from only a single
treatment, trt need not be specified.  Where comparisons between the CFM and
multiple treatments are require, a covariate of treamtne allocations must be
specified sperately (using the 'trt' option).
</p>


<h3>Value</h3>

<p>a object of class 'psc' with attributes model.type, the cleaned Dataset and the
posterior distribution of the fitted model
</p>
<p>Attributes include </p>

<ul>
<li> <p>A 'cleaned' dataset including extracted components of the CFM and the
cleaned DC included in the procedure
</p>
</li>
<li> <p>An object defining the class of model (and therefore the procedure
applied - see above)
</p>
</li>
<li> <p>A matrix containing the draws of the posterior distributions
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>library(psc)
library(survival)
data("surv.mod")
data("data")
surv.psc &lt;- pscfit(surv.mod,data)
</code></pre>

<hr>
<h2 id='pscSumm'>Personalised Synthetic Controls - summary</h2><span id='topic+pscSumm'></span>

<h3>Description</h3>

<p>A function which provides a summary of a DC_clean object.
To be used either in conjunction with dataComb.R or summary.psc.R
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pscSumm(DC_clean)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pscSumm_+3A_dc_clean">DC_clean</code></td>
<td>
<p>a cleaned dataset ontained using dataComb().</p>
</td></tr>
</table>


<h3>Value</h3>

<p>psc summary results including an estimate of the linear predictor
combing the data and the model, an estimate of patient level response and
summary statistics of the average responses for the sythenthic and observed
populations
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(psc)
library(survival)
data("surv.mod")
data("data")
dc &lt;- dataComb(surv.mod,data)
pscSumm(dc)
</code></pre>

<hr>
<h2 id='summary.psc'>Personalised Synthetic Controls - summary</h2><span id='topic+summary.psc'></span>

<h3>Description</h3>

<p>A generic function to provide a summary of a 'psc' object obtained from
pscfit.R
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'psc'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.psc_+3A_object">object</code></td>
<td>
<p>an object of class 'psc'</p>
</td></tr>
<tr><td><code id="summary.psc_+3A_...">...</code></td>
<td>
<p>not used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A summary of a psc object obtained using pscSumm and a copy of the pscfit object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(psc)
library(survival)
data("surv.mod")
data("data")
psc.ob &lt;- pscfit(surv.mod,data)
summary(psc.ob)
</code></pre>

<hr>
<h2 id='surv_fpm'>A function to obtain survival estimates from a flexible parametric model</h2><span id='topic+surv_fpm'></span>

<h3>Description</h3>

<p>This function provides basic survival estimates from a flexible parametric survival
model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>surv_fpm(DC_clean, beta = 0, s = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="surv_fpm_+3A_dc_clean">DC_clean</code></td>
<td>
<p>a cleaned dataset ontained using dataComb().</p>
</td></tr>
<tr><td><code id="surv_fpm_+3A_beta">beta</code></td>
<td>
<p>a parameter to determine if the survival probabilities should be
adjusted by some (log) hazard ratio.  Defaults to beta=0, i.e. no adjustment.</p>
</td></tr>
<tr><td><code id="surv_fpm_+3A_s">s</code></td>
<td>
<p>if specified will return the time at which some threshold is passed
(e.g. s=0.5 for median survival time)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A fucntion which extracts survival probabilities from a flexsurvreg object
</p>


<h3>Value</h3>

<p>a list of times and assoicated survival probabilities
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(psc)
library(survival)
data("surv.mod")
data("data")
dc &lt;- dataComb(surv.mod,data)
s_est &lt;- surv_fpm(dc)
</code></pre>

<hr>
<h2 id='surv.mod'>Example model for a survival outcome</h2><span id='topic+surv.mod'></span>

<h3>Description</h3>

<p>A generated model with a survival endpoint and a cuymulative hazard function
estimated using flexible parametric splines. Data for the model were
synthetically generated and are based on a dataset to
evaulate the use of Sorafenib in HCC akin to the PROSASH model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>surv.mod
</code></pre>


<h3>Format</h3>

<p>A model of class 'flezsurvreg':
</p>

<dl>
<dt>gamma</dt><dd><p>cumulative baseline hazard parameters</p>
</dd>
<dt>vi</dt><dd><p>vascular invasion</p>
</dd>
<dt>age60</dt><dd><p>patient age (centred at 60)</p>
</dd>
<dt>ecog</dt><dd><p>ECOG performance Status</p>
</dd>
<dt>logafp</dt><dd><p>AFP - log scale</p>
</dd>
<dt>alb</dt><dd><p>albumin</p>
</dd>
<dt>logcreat</dt><dd><p>Creatinine - log scale</p>
</dd>
<dt>allmets</dt><dd><p>metastesis</p>
</dd>
<dt>ageVasInv</dt><dd><p>centred age nested within vascular invasion</p>
</dd>
<dt>time</dt><dd><p>survival time</p>
</dd>
<dt>cen</dt><dd><p>censoring indicator</p>
</dd>
<dt>os</dt><dd><p>survival time</p>
</dd>
<dt>count</dt><dd><p>exapmple outcome for count data</p>
</dd>
<dt>trt</dt><dd><p>exapmple identifier for mulitple treatment comparisons</p>
</dd>
<dt>aet</dt><dd><p>Aetiology</p>
</dd>
</dl>



<h3>Source</h3>

<p>simulated
</p>


<h3>References</h3>

<p>Using prognostic and predictive clinical features to make
personalised survival prediction in advanced hepatocellular carcinoma patients
undergoing sorafenib treatment. Berhane S, et al., Br J Cancer. 2019 Jul;121(2):117-124
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
