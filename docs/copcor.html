<!DOCTYPE html><html lang="en"><head><title>Help for package copcor</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {copcor}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#copcor'><p>copcor</p></a></li>
<li><a href='#cove.boost.collapse.strata'>
<p>Collapse sample strata for COVE boost correlates study</p></a></li>
<li><a href='#plotting'>
<p>Plotting Helper Functions</p></a></li>
<li><a href='#predictCompetingRisk'><p>Cumulative Incidence Function (CIF) Under Competing Risk</p></a></li>
<li><a href='#utils'>
<p>Utility Functions</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>Version:</td>
<td>2024.7-31</td>
</tr>
<tr>
<td>Title:</td>
<td>Correlates of Protection and Correlates of Risk Functions</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.6), kyotil</td>
</tr>
<tr>
<td>Imports:</td>
<td>methods</td>
</tr>
<tr>
<td>Suggests:</td>
<td>RUnit, R.rsp, survival</td>
</tr>
<tr>
<td>Description:</td>
<td>Correlates of protection (CoP) and correlates of risk (CoR) study the immune biomarkers associated with an infectious disease outcome, e.g. COVID or HIV-1 infection. This package contains shared functions for analyzing CoP and CoR, including bootstrapping procedures, competing risk estimation, and bootstrapping marginalized risks.</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>R.rsp</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-07-31 22:09:58 UTC; Youyi</td>
</tr>
<tr>
<td>Author:</td>
<td>Youyi Fong [cre],
  Yiwen He [aut],
  Chenchen Yu [aut],
  Bhavesh Borate [aut],
  Peter Gilbert [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Youyi Fong &lt;youyifong@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-07-31 22:30:31 UTC</td>
</tr>
</table>
<hr>
<h2 id='copcor'>copcor</h2><span id='topic+copcor'></span>

<h3>Description</h3>

<p>Functions used in the study of correlates of protection and correlates of risk.
</p>
<p>See the Index link below for a list of available functions.
</p>

<hr>
<h2 id='cove.boost.collapse.strata'>
Collapse sample strata for COVE boost correlates study
</h2><span id='topic+cove.boost.collapse.strata'></span>

<h3>Description</h3>

<p>Collapse sample strata for COVE boost correlates study
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
cove.boost.collapse.strata (dat.b, n.demo)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cove.boost.collapse.strata_+3A_dat.b">dat.b</code></td>
<td>
<p>data frame
</p>
</td></tr>
<tr><td><code id="cove.boost.collapse.strata_+3A_n.demo">n.demo</code></td>
<td>

<p>number of demographics strata, e.g. 6 for COVE correlates
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is used by both correlates_processing repo and correlates_reporting3 repo
</p>


<h3>Value</h3>

<p>dat.b, whose Wstratum has been updated
</p>

<hr>
<h2 id='plotting'>
Plotting Helper Functions</h2><span id='topic+draw.x.axis.cor'></span><span id='topic+get.xlim'></span>

<h3>Description</h3>

<p>Functions for plotting.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
draw.x.axis.cor(xlim, llox, llox.label, for.ggplot=FALSE)
get.xlim(dat, marker, lloxs) 

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plotting_+3A_xlim">xlim</code></td>
<td>
<p>xlim
</p>
</td></tr>
<tr><td><code id="plotting_+3A_llox">llox</code></td>
<td>
<p>lower limit
</p>
</td></tr>
<tr><td><code id="plotting_+3A_llox.label">llox.label</code></td>
<td>
<p>label for lower limit
</p>
</td></tr>
<tr><td><code id="plotting_+3A_for.ggplot">for.ggplot</code></td>
<td>
<p>Boolean    </p>
</td></tr>
<tr><td><code id="plotting_+3A_dat">dat</code></td>
<td>
<p>data frame</p>
</td></tr>
<tr><td><code id="plotting_+3A_marker">marker</code></td>
<td>
<p>name of the biomarker variable</p>
</td></tr>
<tr><td><code id="plotting_+3A_lloxs">lloxs</code></td>
<td>
<p>list of lloxs</p>
</td></tr>
</table>


<h3>Details</h3>

<p>draw.x.axis.cor is used by both cor_coxph and cor_threshold
</p>


<h3>Value</h3>

<p>real
</p>

<hr>
<h2 id='predictCompetingRisk'>Cumulative Incidence Function (CIF) Under Competing Risk</h2><span id='topic+pcr2'></span><span id='topic+predictCompetingRisk2'></span><span id='topic+pcr'></span><span id='topic+predictCompetingRisk'></span>

<h3>Description</h3>

<p>Offers two approaches (Approach 2 is recommended, pcr2 is just an alias for predictCompetingRisk2). Weights are allowed in the optional arguments.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predictCompetingRisk2(formula.list, data, t0, newdata = data, ...)
pcr2(formula.list, data, t0, newdata=data, ...)

predictCompetingRisk(formula, formula.all, data, t0, newdata=data, stype=2, ctype=2, ...)
pcr(formula, formula.all, data, t0, newdata=data, stype=2, ctype=2, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predictCompetingRisk_+3A_formula.list">formula.list</code></td>
<td>

<p>list of formulae for cause-specific failures. Assume the first cause to be the cause of interest
</p>
</td></tr>
<tr><td><code id="predictCompetingRisk_+3A_formula">formula</code></td>
<td>

<p>formula for the cause-specific failure
</p>
</td></tr>
<tr><td><code id="predictCompetingRisk_+3A_formula.all">formula.all</code></td>
<td>

<p>formula for all-cause failure
</p>
</td></tr>
<tr><td><code id="predictCompetingRisk_+3A_data">data</code></td>
<td>

<p>data frame
</p>
</td></tr>
<tr><td><code id="predictCompetingRisk_+3A_t0">t0</code></td>
<td>

<p>the time till which cumulative incidence function is computed
</p>
</td></tr>
<tr><td><code id="predictCompetingRisk_+3A_newdata">newdata</code></td>
<td>

<p>new data for making prediction, default to the data for fitting the models
</p>
</td></tr>
<tr><td><code id="predictCompetingRisk_+3A_stype">stype</code></td>
<td>

<p>computation of the survival curve, 1=direct, 2= exponenial of the cumulative hazard. Default 2, which is the default of basehaz and predict.coxph
</p>
</td></tr>
<tr><td><code id="predictCompetingRisk_+3A_ctype">ctype</code></td>
<td>

<p>whether the cumulative hazard computation should have a correction for ties, 1=no, 2=yes. Default 2, which is the default of basehaz and predict.coxph
</p>
</td></tr>
<tr><td><code id="predictCompetingRisk_+3A_...">...</code></td>
<td>

<p>optional arguments that are passed to coxph, the most import of which is weights
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Approach 2, predictCompetingRisk2, fits cause-specific Cox models to each cause to compute cumulative incidence function for the cause of interest under competing risk. 
</p>
<p>When there is only one cause, CIF is conceptually 1 - surival prob.(https://www.publichealth.columbia.edu/research/population-health-methods/competing-risk-analysis)
</p>
<p>The function is implemented in R with matrix operation. Because looping through time points and subjects is vectorized, it is quite fast (faster than riskRegression in limited testing, which implements in C, but pcr uses more memory.)
</p>
<p>One way to check the implementation of this function is to compare its results with the results of predict.coxph when there is only one cause. The tests in the examples code below show
that when the risk is small (e.g. shorter followup time), the CIF computed by this function and the 1-survival estimated via 1-exp(-H) by predict.coxph, where H is cumulative hazard, are close to each other.
But when the risk is high, the difference between the two are more noticeable. These results make sense because, e.g., 
</p>
<p>If t0 = the first time failure point, CIF = h1 = H1 ~ 1-exp(-H1) 
If t0 = the second time point, 
</p>
<p>CIF = H1 + exp(-H1) * h2               (by def)
</p>
<p>~ H1 + exp(-H1)(1 - exp(-h2))
</p>
<p>= H1 + exp(-H1) - exp(-H2)
</p>
<p>~ 1 - exp(-H2)
</p>
<p>Approach 1, predictCompetingRisk, fits a cause-specific Cox model and a all-cause Cox model to compute cumulative incidence function for the cause of interest under competing risk.
</p>
<p>The difference between predictCompetingRisk and predictCompetingRisk2 is that instead of fitting a model to the overall failure, a model is fit for each cause, including the cause of interest. 
The overall survival is computed by adding together the cumulative hazard from individual causes.
</p>
<p>The second approach is recommended because it is more stable.
</p>


<h3>Value</h3>

<p>A vector of real numbers as the risk till t0 for each subject in newdata
</p>


<h3>References</h3>

<p>riskRegression: Predicting the Risk of an Event using Cox Regression Models by Brice Ozenne, Anne Lyngholm Sorensen, Thomas Scheike, Christian Torp-Pedersen, Thomas Alexander Gerds
https://journal.r-project.org/archive/2017/RJ-2017-062/RJ-2017-062.pdf
Thanks to Professor Gerds for helpful discussion.
</p>
<p>Competing Risk Analysis
Columbia Public Health
https://www.publichealth.columbia.edu/research/population-health-methods/competing-risk-analysis
</p>
<p>Introduction to the Analysis of Survival Data in the Presence of Competing Risks
Peter C Austin, Douglas S Lee, Jason P Fine
https://www.ahajournals.org/doi/full/10.1161/CIRCULATIONAHA.115.017719
</p>


<h3>See Also</h3>

<p><code><a href="#topic+predictCompetingRisk">predictCompetingRisk</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

library(survival) 

# prepare a dataset with competing risk
lung1=lung[order(lung$time),]
lung1$status=lung1$status-1
lung1$status[1:50]=2
with(lung1, table(status))
lung1$status.1=ifelse(lung1$status==1,1,0)
lung1$status.2=ifelse(lung1$status==2,1,0)
lung1$status.a=ifelse(lung1$status==0,0,1)
lung1$wt=rep(1, nrow(lung1))


###############################################################################
# predictCompetingRisk2

t0=1000
formula.list=list(
    Surv(time, status.1) ~ age,
    Surv(time, status.2) ~ age
)

cif.2=pcr2(formula.list, lung1, t0)

fit=coxph(formula.list[[1]], lung1)
newdata=lung1
newdata$time=t0
coxpred = 1 - exp(-predict(fit, newdata=newdata, type="expected"))

plot(cif.2, coxpred)


# dealing with weights
lung1$wt=c(rep(2,50), rep(1, nrow(lung1)-50))
cif=predictCompetingRisk2(formula.list, lung1, t0, weights=lung1$wt)


###############################################################################
# predictCompetingRisk

t0=1000
form  =Surv(time, status.1) ~ age
form.a=Surv(time, status.a) ~ age
cif=predictCompetingRisk(form, form.a, lung1, t0, newdata=lung1, weights=lung1$wt, stype=2,ctype=2)

# more validation code 

# when there is no covariate and one cause, CIF = 1 - KM estimate of survival prob

lung1=lung[order(lung$time),]
lung1$status=lung1$status-1
with(lung1, table(status))
lung1$status.1=ifelse(lung1$status==1,1,0)
lung1$status.a=ifelse(lung1$status==0,0,1)
lung1$wt=rep(1, nrow(lung1))

# stype=2 is surv=prod limit
fitKM &lt;- survfit(Surv(time, status.1) ~ 1, data=lung1, stype=1, ctype=2)
cbind(summary(fitKM)$cumhaz, exp(-summary(fitKM)$cumhaz), summary(fitKM)$surv)[1:2,]
#[1,] 0.004385965 0.9956236 0.9956140
#[2,] 0.017660474 0.9824946 0.9824561
cif=predictCompetingRisk(Surv(time, status.1) ~ 1, Surv(time, status.1) ~ 1, lung1, t0=11, 
    newdata=lung1[1,,drop=FALSE], weights=lung1$wt, stype=1, ctype=2)
cif # 0.01754386
1-cif # 0.9824561 = summary(fitKM)$surv at t=11


# when there are covariates and one cause, CIF and 1-exp(-H) are close to each other 
# when H is small but not close when H is large
form  =Surv(time, status.1) ~ age
form.a=Surv(time, status.a) ~ age

oldpar &lt;- par(mfrow = c(1,2))
for (t0 in c(12,1000)) {
    fit=coxph(form, lung1, weights=lung1$wt)
    lung2=lung1; lung2$time=t0
    r=predict(fit, type="expected", newdata=lung2)
    message(head(basehaz(fit, centered=TRUE)))
    cif=predictCompetingRisk(form, form.a, lung1, t0, newdata=lung1, weights=lung1$wt, stype=2, 
        ctype=2)
    plot(cif, 1-exp(-r), xlab="Cumulative incidence function", 
        ylab="Expected number of events from predict.coxph", main=paste0("t0: ", t0))
    abline(0,1)
    message(head(cbind(cif, "1-exp(-r)"=1-exp(-r))))
}
par(oldpar)




</code></pre>

<hr>
<h2 id='utils'>
Utility Functions
</h2><span id='topic+marker.name.to.assay'></span>

<h3>Description</h3>

<p>Helpful functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
marker.name.to.assay (a)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="utils_+3A_a">a</code></td>
<td>
<p>assay name
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function ...
</p>


<h3>Value</h3>

<p>string
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
