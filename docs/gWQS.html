<!DOCTYPE html><html><head><title>Help for package gWQS</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {gWQS}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#gwqs'><p>Fitting Weighted Quantile Sum regression models</p></a></li>
<li><a href='#gwqs_barplot'><p>Plots and tables functions</p></a></li>
<li><a href='#summary.gwqs'><p>Methods for gwqs objects</p></a></li>
<li><a href='#tiwqs_data'><p>Measurement of 38 nutrients (NHANES dataset)</p></a></li>
<li><a href='#wqs_data'><p>Exposure concentrations of 34 PCB (simulated dataset)</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Generalized Weighted Quantile Sum Regression</td>
</tr>
<tr>
<td>Version:</td>
<td>3.0.5</td>
</tr>
<tr>
<td>Description:</td>
<td>Fits Weighted Quantile Sum (WQS) regression  (Carrico et al. (2014) &lt;<a href="https://doi.org/10.1007%2Fs13253-014-0180-3">doi:10.1007/s13253-014-0180-3</a>&gt;), a random subset implementation of WQS (Curtin et al. (2019) &lt;<a href="https://doi.org/10.1080%2F03610918.2019.1577971">doi:10.1080/03610918.2019.1577971</a>&gt;), a repeated holdout validation WQS (Tanner et al. (2019) &lt;<a href="https://doi.org/10.1016%2Fj.mex.2019.11.008">doi:10.1016/j.mex.2019.11.008</a>&gt;) and a WQS with 2 indices (Renzetti et al. (2023) &lt;<a href="https://doi.org/10.3389%2Ffpubh.2023.1289579">doi:10.3389/fpubh.2023.1289579</a>&gt;) for continuous, binomial, multinomial, Poisson, quasi-Poisson and negative binomial outcomes.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Imports:</td>
<td>ggplot2, stats, broom, rlist, MASS, reshape2, plotROC, knitr,
kableExtra, nnet, future, future.apply, pscl, ggrepel, cowplot,
Matrix, car, utils, bookdown</td>
</tr>
<tr>
<td>Suggests:</td>
<td>markdown</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-11-16 17:41:15 UTC; stefanorenzetti</td>
</tr>
<tr>
<td>Author:</td>
<td>Stefano Renzetti [aut, cre],
  Paul Curtin [aut],
  Allan C Just [ctb],
  Ghalib Bello [ctb],
  Chris Gennings [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Stefano Renzetti &lt;stefano.renzetti88@gmail.com&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-11-16 22:20:06 UTC</td>
</tr>
</table>
<hr>
<h2 id='gwqs'>Fitting Weighted Quantile Sum regression models</h2><span id='topic+gwqs'></span><span id='topic+gwqs_multinom'></span><span id='topic+gwqsrh'></span>

<h3>Description</h3>

<p>Fits Weighted Quantile Sum (WQS) regression  (Carrico et al. (2014) <a href="https://doi.org/10.1007/s13253-014-0180-3">doi:10.1007/s13253-014-0180-3</a>),
a random subset implementation of WQS (Curtin et al. (2019) <a href="https://doi.org/10.1080/03610918.2019.1577971">doi:10.1080/03610918.2019.1577971</a>),
a repeated holdout validation WQS (Tanner et al. (2019) <a href="https://doi.org/10.1016/j.mex.2019.11.008">doi:10.1016/j.mex.2019.11.008</a>) and a WQS with
2 indices (Renzetti et al. (2023) <a href="https://doi.org/10.3389/fpubh.2023.1289579">doi:10.3389/fpubh.2023.1289579</a>) for continuous, binomial,
multinomial, Poisson, quasi-Poisson and negative binomial outcomes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gwqs(formula, data, na.action, weights, mix_name, stratified, rh = 1, b = 100,
             b1_pos = TRUE, bint_cont_pos = NULL, bint_cat_pos = NULL, b_constr = FALSE,
             zero_infl = FALSE, q = 4, validation = 0.6, validation_rows = NULL,
             family = gaussian, signal = c("t2", "t3", "one", "abst", "expt"),
             rs = FALSE, n_vars = NULL,
             zilink = c("logit", "probit", "cloglog", "cauchit", "log"), seed = NULL,
             wp = NULL, wn = NULL, plan_strategy = "sequential", lambda = 0,
             optim.method = c("BFGS", "Nelder-Mead", "CG", "SANN"),
             control = list(trace = FALSE, maxit = 2000, reltol = 1e-9),
             b1_constr = NULL, ...)

gwqs_multinom(formula, data, na.action, weights, mix_name, stratified, rh = 1, b = 100,
                      b1_pos = c(TRUE, TRUE), b_constr = FALSE, q = 4,
                      validation = 0.6, validation_rows = NULL,
                      signal = c("t2", "t3", "one", "abst", "expt"),
                      rs = FALSE, n_vars = NULL,
                      zilink = c("logit", "probit", "cloglog", "cauchit", "log"),
                      seed = NULL, wp = NULL, wn = NULL, plan_strategy = "sequential",
                      lambda = 0, optim.method = c("BFGS", "Nelder-Mead", "CG", "SANN"),
                      control = list(trace = FALSE, maxit = 2000, reltol = 1e-9),
                      b1_constr = NULL, ...)

gwqsrh(formula, data, na.action, weights, mix_name, stratified, rh = 1, b = 100,
               b1_pos = TRUE, bint_cont_pos = NULL, bint_cat_pos = NULL, b_constr = FALSE,
               zero_infl = FALSE, q = 4, validation = 0.6, validation_rows = NULL,
               family = gaussian, signal = c("t2", "t3", "one", "abst", "expt"),
               rs = FALSE, n_vars = NULL,
               zilink = c("logit", "probit", "cloglog", "cauchit", "log"), seed = NULL,
               wp = NULL, wn = NULL, plan_strategy = "sequential", lambda = 0,
               optim.method = c("BFGS", "Nelder-Mead", "CG", "SANN"),
               control = list(trace = FALSE, maxit = 2000, reltol = 1e-9), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gwqs_+3A_formula">formula</code></td>
<td>
<p>An object of class <code>formula</code> specifying the relationship to be tested. The <code>wqs</code>
term must be included in <code>formula</code>, e.g. <code>y ~ wqs + ...</code>. To test for an interaction term with
a continuous variable <code>a</code> or for a quadratic term we can specify the <code>formula</code> as below:
<code>y ~ wqs*a + ...</code> and <code>y ~ wqs + I(wqs^2) + ...</code>, respectively.</p>
</td></tr>
<tr><td><code id="gwqs_+3A_data">data</code></td>
<td>
<p>The <code>data.frame</code> containing the variables to be included in the model.</p>
</td></tr>
<tr><td><code id="gwqs_+3A_na.action">na.action</code></td>
<td>
<p><code><a href="stats.html#topic+model.frame">model.frame</a></code>. <code>na.omit</code> is the default.</p>
</td></tr>
<tr><td><code id="gwqs_+3A_weights">weights</code></td>
<td>
<p>An optional term containing the name of the variable in the dataset representing the weights
to be used in the fitting process. Should be <code>NULL</code> or the variable name.</p>
</td></tr>
<tr><td><code id="gwqs_+3A_mix_name">mix_name</code></td>
<td>
<p>A character vector listing the variables contributing to a mixture effect.</p>
</td></tr>
<tr><td><code id="gwqs_+3A_stratified">stratified</code></td>
<td>
<p>The character name of the variable for which you want to stratify for.
It has to be a <code>factor</code>.</p>
</td></tr>
<tr><td><code id="gwqs_+3A_rh">rh</code></td>
<td>
<p>Number of repeated holdout validations.</p>
</td></tr>
<tr><td><code id="gwqs_+3A_b">b</code></td>
<td>
<p>Number of bootstrap samples used in parameter estimation. No bootstrap will be performed if b = 1.</p>
</td></tr>
<tr><td><code id="gwqs_+3A_b1_pos">b1_pos</code></td>
<td>
<p>A logical value that determines whether weights are derived from models where the beta
values were positive (<code>TRUE</code>) or negative (<code>FALSE</code>).</p>
</td></tr>
<tr><td><code id="gwqs_+3A_bint_cont_pos">bint_cont_pos</code></td>
<td>
<p>A logical value that determines whether weights are derived from models where the
beta parameter of the interaction term between the WQS index and a continuous variable were
positive (<code>TRUE</code>) or negative (<code>FALSE</code>).</p>
</td></tr>
<tr><td><code id="gwqs_+3A_bint_cat_pos">bint_cat_pos</code></td>
<td>
<p>A logical value or a vector of logical values that determines whether weights are
derived from models where the slopes of the WQS index for each level (other than the reference one)
of the interacting categorical variable were positive (<code>TRUE</code>) or negative (<code>FALSE</code>).</p>
</td></tr>
<tr><td><code id="gwqs_+3A_b_constr">b_constr</code></td>
<td>
<p>A logial value that determines whether to apply positive (if <code>b1_pos = TRUE</code>) or
negative (if <code>b1_pos = FALSE</code>) constraints in the optimization function for the weight estimation.</p>
</td></tr>
<tr><td><code id="gwqs_+3A_zero_infl">zero_infl</code></td>
<td>
<p>A logical value (<code>TRUE</code> or <code>FALSE</code>) that allows to fit a zero inflated
model in case <code>family = "poisson"</code> or <code>family = "negbin"</code>.</p>
</td></tr>
<tr><td><code id="gwqs_+3A_q">q</code></td>
<td>
<p>An <code>integer</code> to specify how mixture variables will be ranked, e.g. in quartiles
(<code>q = 4</code>), deciles (<code>q = 10</code>), or percentiles (<code>q = 100</code>). If <code>q = NULL</code> then
the values of the mixture variables are taken (these must be standardized).</p>
</td></tr>
<tr><td><code id="gwqs_+3A_validation">validation</code></td>
<td>
<p>Percentage of the dataset to be used to validate the model. If
<code>validation = 0</code> then the test dataset is used as validation dataset too.</p>
</td></tr>
<tr><td><code id="gwqs_+3A_validation_rows">validation_rows</code></td>
<td>
<p>A list of a single (if rh=1) or multiple vectors containing the rows to be
considered in the validation step. When &quot;validation_rows=NULL&quot; (default) the function randomly choose
the observations to be considered in the validation step.</p>
</td></tr>
<tr><td><code id="gwqs_+3A_family">family</code></td>
<td>
<p>A character value that allows to decide for the glm: <code>gaussian</code> for linear regression,
<code>binomial</code> for logistic regression, <code>poisson</code> for Poisson regression,
<code>quasipoisson</code> for quasi-Poisson regression, <code>"negbin"</code> for negative binomial regression.</p>
</td></tr>
<tr><td><code id="gwqs_+3A_signal">signal</code></td>
<td>
<p>Character identifying the signal function to be used when the average weights
are estimated. It can take values from <code>"one"</code> to apply the identity, <code>"abst"</code> to apply
the absolute value of the t-statistic, <code>"t2"</code> to apply the squared value of the t-statistic,
<code>"expt"</code> to apply the exponential of the t-statistic as signal function.</p>
</td></tr>
<tr><td><code id="gwqs_+3A_rs">rs</code></td>
<td>
<p>A logic value. If <code>rs = FALSE</code> then the bootstrap implementation of WQS is performed.
If <code>rs = TRUE</code> then the random subset implementation of WQS is applied (see the &quot;Details&quot; and the
vignette for further information).</p>
</td></tr>
<tr><td><code id="gwqs_+3A_n_vars">n_vars</code></td>
<td>
<p>The number of mixture components to be included at each random subset step.
If <code>rs = TRUE</code> and <code>n_vars = NULL</code> then the square root of the number of elements
in the mixture is taken.</p>
</td></tr>
<tr><td><code id="gwqs_+3A_zilink">zilink</code></td>
<td>
<p>Character specification of link function in the binary zero-inflation model
(you can choose among <code>"logit", "probit", "cloglog", "cauchit", "log"</code>).</p>
</td></tr>
<tr><td><code id="gwqs_+3A_seed">seed</code></td>
<td>
<p>An <code>integer</code> value to fix the seed, if it is equal to <code>NULL</code> no seed is chosen.</p>
</td></tr>
<tr><td><code id="gwqs_+3A_wp">wp</code>, <code id="gwqs_+3A_wn">wn</code></td>
<td>
<p>An optional set of starting weights for the positive (<code>wp</code>) and negative (<code>wn</code>) directions
to be passed to the optimization function. The default is <code>wp = NULL, wn = NULL</code> to let the <code>gwqs</code> function
set the starting values.</p>
</td></tr>
<tr><td><code id="gwqs_+3A_plan_strategy">plan_strategy</code></td>
<td>
<p>A character value that allows to choose the evaluation strategies for the
<code>plan</code> function. You can choose among &quot;sequential&quot;, &quot;transparent&quot;, &quot;multisession&quot;, &quot;multicore&quot;,
&quot;multiprocess&quot;, &quot;cluster&quot; and &quot;remote&quot; (see <code><a href="future.html#topic+plan">plan</a></code> help page for more details).</p>
</td></tr>
<tr><td><code id="gwqs_+3A_lambda">lambda</code></td>
<td>
<p>The value of the penalization term used to shrink towards 0 the weights that are not
truly associated with the outcome (see the &quot;Details&quot; and the vignette for further information).</p>
</td></tr>
<tr><td><code id="gwqs_+3A_optim.method">optim.method</code></td>
<td>
<p>A character identifying the method to be used by the <code><a href="stats.html#topic+optim">optim</a></code> function
(you can choose among <code>"BFGS", "Nelder-Mead", "CG", "SANN"</code>, <code>"BFGS"</code> is the default).
See <code><a href="stats.html#topic+optim">optim</a></code> for details.</p>
</td></tr>
<tr><td><code id="gwqs_+3A_control">control</code></td>
<td>
<p>The control list of optimization parameters. See <code><a href="stats.html#topic+optim">optim</a></code> for details.</p>
</td></tr>
<tr><td><code id="gwqs_+3A_b1_constr">b1_constr</code></td>
<td>
<p>The argument is deprecated, use 'b_constr' instead.</p>
</td></tr>
<tr><td><code id="gwqs_+3A_...">...</code></td>
<td>
<p>Additional arguments to be passed to the function</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>gWQS</code> uses the <code>glm</code> function in the <b>stats</b> package to fit the linear, logistic,
the Poisson and the quasi-Poisson regression, while the <code>glm.nb</code> function from the <b>MASS</b>
package is used to fit the negative binomial regression respectively. The <code>nlm</code> function from
the <b>stats</b> package was used to optimize the log-likelihood of the multinomial regression.<br />
</p>
<p>The <code><a href="stats.html#topic+optim">optim</a></code> optimization function is used to estimate the weights at each
bootstrap step.<br />
</p>
<p>The <code>seed</code> argument specifies a fixed seed through the <code><a href="base.html#topic+set.seed">set.seed</a></code> function.<br />
</p>
<p>The <code>rs</code> term allows to choose the type of methodology between the bootstrap implementation
(WQSBS) or the random subset implementation (WQSRS) of the WQS. The first method performs <code>b</code>
bootstrapped samples to estimate the weights while the second creates <code>b</code> randomly-selected
subset of the total predictor set. For further details please see the vignette
(&quot;How to use gWQS package&quot;) and the references below.
</p>


<h3>Value</h3>

<p><code>gwqs</code> return the results of the WQS regression as well as many other objects and datasets.
</p>
<table>
<tr><td><code>fit</code></td>
<td>
<p>The object that summarizes the output of the WQS model, reflecting a
linear, logistic, multinomial, Poisson, quasi-Poisson or negative binomial regression
depending on how the <code>family</code> parameter was specified.
The summary function can be used to call and print fit data (not for multinomial regression).</p>
</td></tr>
<tr><td><code>final_weights</code></td>
<td>
<p><code>data.frame</code> containing the final weights associated to each chemical.</p>
</td></tr>
<tr><td><code>conv</code></td>
<td>
<p>Indicates whether the solver has converged (0) or not (1 or 2).</p>
</td></tr>
<tr><td><code>bres</code></td>
<td>
<p>Matrix of estimated weights, mixture effect parameter estimates and the associated
standard errors, statistics and p-values estimated for each bootstrap iteration.</p>
</td></tr>
<tr><td><code>wqs</code></td>
<td>
<p>Vector containing the wqs index for each subject.</p>
</td></tr>
<tr><td><code>pwqs</code></td>
<td>
<p>Vector containing the positive wqs index for each subject.</p>
</td></tr>
<tr><td><code>nwqs</code></td>
<td>
<p>Vector containing the negative wqs index for each subject.</p>
</td></tr>
<tr><td><code>qi</code></td>
<td>
<p>List of the cutoffs used to divide in quantiles the variables in the mixture</p>
</td></tr>
<tr><td><code>bindex</code></td>
<td>
<p>List of vectors containing the <code>rownames</code> of the subjects included in each
bootstrap dataset.</p>
</td></tr>
<tr><td><code>y_wqs_df</code></td>
<td>
<p><code>data.frame</code> containing the dependent variable values adjusted for the
residuals of a fitted model adjusted for covariates (original values when <code>family = binomial</code>
or <code>"multinomial"</code>) and the wqs index estimated values.</p>
</td></tr>
<tr><td><code>family</code></td>
<td>
<p>The family specified.</p>
</td></tr>
<tr><td><code>call</code></td>
<td>
<p>The matched call.</p>
</td></tr>
<tr><td><code>formula</code></td>
<td>
<p>The formula supplied.</p>
</td></tr>
<tr><td><code>mix_name</code></td>
<td>
<p>The vector of variable names used to identify the elements in the mixture.</p>
</td></tr>
<tr><td><code>q</code></td>
<td>
<p>The method used to rank varibales included in the mixture.</p>
</td></tr>
<tr><td><code>n_levels</code></td>
<td>
<p>The number of levels of the of the dependent variable when a multinomial regression is ran.</p>
</td></tr>
<tr><td><code>zero_infl</code></td>
<td>
<p>If a zero inflated model was ran (<code>TRUE</code>) or not (<code>FALE</code>)</p>
</td></tr>
<tr><td><code>zilink</code></td>
<td>
<p>The chosen link function when a zero inflated model was ran.</p>
</td></tr>
<tr><td><code>dwqs</code></td>
<td>
<p>A logical value whether two indices were included (<code>TRUE</code>) in the model or not (<code>FALSE</code>).</p>
</td></tr>
<tr><td><code>levelnames</code></td>
<td>
<p>The name of each level when a multinomial regression is ran.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>The data used in the WQS analysis.</p>
</td></tr>
<tr><td><code>objfn_values</code></td>
<td>
<p>The vector of the b values of the objective function corresponding to the optima values</p>
</td></tr>
<tr><td><code>optim_messages</code></td>
<td>
<p>The vector of character strings giving any additional information returned by the
optimizer, or NULL.</p>
</td></tr>
<tr><td><code>gwqslist</code></td>
<td>
<p>List of the output from the <code>rh</code> WQS models.</p>
</td></tr>
<tr><td><code>coefmat</code></td>
<td>
<p>Matrix containing the parameter estimates from each repeated holdout WQS model.</p>
</td></tr>
<tr><td><code>wmat</code></td>
<td>
<p>Matrix containing the weight estimates from each repeated holdout WQS model.</p>
</td></tr>
<tr><td><code>rh</code></td>
<td>
<p>The number of repeated holdout performed.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Stefano Renzetti, Paul Curtin, Allan C Just, Ghalib Bello, Chris Gennings
</p>


<h3>References</h3>

<p>Carrico C, Gennings C, Wheeler D, Factor-Litvak P. Characterization of a weighted quantile sum
regression for highly correlated data in a risk analysis setting. J Biol Agricul Environ Stat.
2014:1-21. ISSN: 1085-7117. <a href="https://doi.org/10.1007/s13253-014-0180-3">doi:10.1007/s13253-014-0180-3</a>.<br />
</p>
<p>Curtin P, Kellogg J, Cech N, Gennings C (2021). A random subset implementation of weighted quantile
sum (WQSRS) regression for analysis of high-dimensional mixtures, Communications in Statistics -
Simulation and Computation, 50:4, 1119-1134. <a href="https://doi.org/10.1080/03610918.2019.1577971">doi:10.1080/03610918.2019.1577971</a>.<br />
</p>
<p>Tanner EM, Bornehag CG, Gennings C. Repeated holdout validation for weighted quantile sum regression.
MethodsX. 2019 Nov 22;6:2855-2860. <a href="https://doi.org/10.1016/j.mex.2019.11.008">doi:10.1016/j.mex.2019.11.008</a>. PMID: 31871919; PMCID: PMC6911906.<br />
</p>
<p>Renzetti S, Gennings C and Calza S (2023) A weighted quantile sum regression with penalized weights
and two indices. Front Public Health 11:1151821. <a href="https://doi.org/10.3389/fpubh.2023.1151821">doi:10.3389/fpubh.2023.1151821</a>.<br />
</p>


<h3>See Also</h3>

<p><a href="stats.html#topic+glm">glm</a>, <a href="MASS.html#topic+glm.nb">glm.nb</a>, <a href="nnet.html#topic+multinom">multinom</a>, <a href="pscl.html#topic+zeroinfl">zeroinfl</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># we save the names of the mixture variables in the variable "toxic_chems"
toxic_chems = names(wqs_data)[1:34]

# To run a linear model and save the results in the variable "results". This linear model
# (family = gaussian) will rank/standardize variables in quartiles (q = 4), perform a
# 40/60 split of the data for training/validation (validation = 0.6), and estimate weights
# over 2 bootstrap samples (b = 2; in practical applications at least 100 bootstraps
# should be used). Weights will be derived from mixture effect parameters that are positive
# (b1_pos = TRUE). A unique seed was specified (seed = 2016) so this model will be
# reproducible, and plots describing the variable weights and linear relationship will be
# generated as output (plots = TRUE). In the end tables describing the weights values and
# the model parameters with the respectively statistics are generated in the plots window
# (tables = TRUE):
results = gwqs(yLBX ~ wqs, mix_name = toxic_chems, data = wqs_data, q = 4, validation = 0.6,
               b = 2, b1_pos = TRUE, b_constr = FALSE, family = gaussian, seed = 2016)

# to test the significance of the covariates
summary(results)

</code></pre>

<hr>
<h2 id='gwqs_barplot'>Plots and tables functions</h2><span id='topic+gwqs_barplot'></span><span id='topic+gwqs_scatterplot'></span><span id='topic+gwqs_fitted_vs_resid'></span><span id='topic+gwqs_levels_scatterplot'></span><span id='topic+gwqs_ROC'></span><span id='topic+gwqs_boxplot'></span><span id='topic+gwqs_summary_tab'></span><span id='topic+gwqs_weights_tab'></span><span id='topic+selectdatavars'></span><span id='topic+gwqs_rank'></span>

<h3>Description</h3>

<p>Functions that allow to generate plots and tables helping in visualizing and summarise Weighted Quantile Sum (WQS) regression results.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gwqs_barplot(object, tau, ...)

gwqs_scatterplot(object, ...)

gwqs_fitted_vs_resid(object, sumtype = c("norm", "perc"), ...)

gwqs_levels_scatterplot(object, ...)

gwqs_ROC(object, newdata, sumtype = c("norm", "perc"), ...)

gwqs_boxplot(object, tau, ...)

gwqs_summary_tab(object, sumtype = c("norm", "perc"), ...)

gwqs_weights_tab(object, ...)

selectdatavars(data, na.action, formula, mix_name, ...)

gwqs_rank(data, mix_name, q)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gwqs_barplot_+3A_object">object</code></td>
<td>
<p>An object of class &quot;gwqs&quot; as returned by <a href="#topic+gwqs">gwqs</a>.</p>
</td></tr>
<tr><td><code id="gwqs_barplot_+3A_tau">tau</code></td>
<td>
<p>A number identifying the cutoff for the significant weights. Is tau is missing then reciprocal of
the number of elements in the mixture is considered. To avoid printing the threshold line set <code>tau = NULL</code>.</p>
</td></tr>
<tr><td><code id="gwqs_barplot_+3A_...">...</code></td>
<td>
<p>Further arguments to be passed.</p>
</td></tr>
<tr><td><code id="gwqs_barplot_+3A_sumtype">sumtype</code></td>
<td>
<p>Type of summary statistic to be used: &quot;norm&quot; takes the mean of the estimated parameters on the
validation sets and the 95
as the parameters estimates and the 2.5, 97.5 percentiles as CI. This option is only available for objects of
class <code>gwqsrh</code>.</p>
</td></tr>
<tr><td><code id="gwqs_barplot_+3A_newdata">newdata</code></td>
<td>
<p>A data frame in which to look for variables with which to predict and generate the
ROC curve.</p>
</td></tr>
<tr><td><code id="gwqs_barplot_+3A_data">data</code></td>
<td>
<p>Dataset from which you want to select the variables you are interested in.</p>
</td></tr>
<tr><td><code id="gwqs_barplot_+3A_na.action">na.action</code></td>
<td>
<p>Allows to choose what action has to be taken to deal with NAs.</p>
</td></tr>
<tr><td><code id="gwqs_barplot_+3A_formula">formula</code></td>
<td>
<p>Formula used in the model to specify the dependent and independent variables.</p>
</td></tr>
<tr><td><code id="gwqs_barplot_+3A_mix_name">mix_name</code></td>
<td>
<p>Vector containing element names included in the mixture.</p>
</td></tr>
<tr><td><code id="gwqs_barplot_+3A_q">q</code></td>
<td>
<p>An <code>integer</code> to specify how mixture variables will be ranked, e.g. in quartiles
(<code>q = 4</code>), deciles (<code>q = 10</code>), or percentiles (<code>q = 100</code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>gwqs_barplot</code>, <code>gwqs_scatterplot</code>, <code>gwqs_fitted_vs_resid</code>, <code>gwqs_levels_scatterplot</code>,
<code>gwqs_ROC</code> and <code>gwqs_boxplot</code> functions produce five figures through the <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code> function.
</p>
<p>The <code>gwqs_summary_tab</code> and <code>gwqs_weights_tab</code> functions produce two tables in the viewr pane
through the use of the <code><a href="knitr.html#topic+kable">kable</a></code> and <code><a href="kableExtra.html#topic+kable_styling">kable_styling</a></code> functions.
</p>
<p>The <code>gwqs_barplot</code>, <code>gwqs_scatterplot</code> plots are available for all family types while
<code>gwqs_fitted_vs_resid</code> is not available when <code>family = binomial</code> or <code>"multinomial"</code>.
<code>gwqs_levels_scatterplot</code> plot is only available when <code>family = "multinomial"</code> and <code>gwqs_ROC</code>
when <code>family = binomial</code>. The <code>gwqs_boxplot</code> can be used when the parameter <code>rh</code> within
the <code>gwqs</code> function is set greater than 1.
</p>
<p>The <code>gwqs_rank</code> function allows to split the variables selected through the vector <code>mix_name</code>
in quantiles (depending by the value assigned to <code>q</code>).
</p>


<h3>Value</h3>

<p>All the plot functions print the output in the Plots pane while the table functions print
the output in the Viewer pane.
</p>
<table>
<tr><td><code>Qm</code></td>
<td>
<p>The matrix containing the quantiled variables of the elements included in the mixture.</p>
</td></tr>
<tr><td><code>qi</code></td>
<td>
<p>A list of vectors containing the cut points used to determine the quantiled variables.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Stefano Renzetti, Paul Curtin, Allan C Just, Ghalib Bello, Chris Gennings
</p>


<h3>Examples</h3>

<pre><code class='language-R'>toxic_chems = names(wqs_data)[1:34]
results = gwqs(yLBX ~ wqs, mix_name = toxic_chems, data = wqs_data, q = 4, validation = 0.6,
               b = 2, b1_pos = TRUE, b_constr = FALSE, family = gaussian)

# barplot
gwqs_barplot(results)

# scatterplot
gwqs_scatterplot(results)

# fitted values vs rediduals scatterplot
gwqs_fitted_vs_resid(results)

</code></pre>

<hr>
<h2 id='summary.gwqs'>Methods for gwqs objects</h2><span id='topic+summary.gwqs'></span><span id='topic+print.gwqs'></span><span id='topic+print.summary.gwqs'></span><span id='topic+predict.gwqs'></span><span id='topic+coef.gwqs'></span><span id='topic+vcov.gwqs'></span><span id='topic+fitted.gwqs'></span><span id='topic+residuals.gwqs'></span>

<h3>Description</h3>

<p>Methods for extracting information from fitted Weighted Quantile Sum (WQS) regression model objects
of class &quot;gwqs&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'gwqs'
summary(object, sumtype = c("norm", "perc"), ...)

## S3 method for class 'gwqs'
print(x, digits = max(3L, getOption("digits") - 3L), ...)

## S3 method for class 'summary.gwqs'
print(x, digits = max(3L, getOption("digits") - 3L), ...)

## S3 method for class 'gwqs'
predict(
  object,
  newdata,
  sumtype = c("norm", "perc"),
  type = c("link", "response", "prob", "count", "zero", "class", "probs", "terms"),
  ...
)

## S3 method for class 'gwqs'
coef(object, sumtype = c("norm", "perc"), ...)

## S3 method for class 'gwqs'
vcov(object, model = c("full", "count", "zero"), ...)

## S3 method for class 'gwqs'
fitted(
  object,
  sumtype = c("norm", "perc"),
  type = c("link", "response", "prob", "count", "zero", "class", "probs", "terms"),
  ...
)

## S3 method for class 'gwqs'
residuals(
  object,
  sumtype = c("norm", "perc"),
  type = c("deviance", "pearson", "working", "response", "partial"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.gwqs_+3A_object">object</code>, <code id="summary.gwqs_+3A_x">x</code></td>
<td>
<p>An object of class &quot;gwqs&quot; as returned by <a href="#topic+gwqs">gwqs</a>.</p>
</td></tr>
<tr><td><code id="summary.gwqs_+3A_sumtype">sumtype</code></td>
<td>
<p>Type of summary statistic to be used: &quot;norm&quot; takes the mean of the estimated parameters on the
validation sets and the 95
as the parameters estimates and the 2.5, 97.5 percentiles as CI. This option is only available for objects of
class <code>gwqsrh</code>.</p>
</td></tr>
<tr><td><code id="summary.gwqs_+3A_...">...</code></td>
<td>
<p>Further arguments to be passed.</p>
</td></tr>
<tr><td><code id="summary.gwqs_+3A_digits">digits</code></td>
<td>
<p>The number of significant digits to use when printing.</p>
</td></tr>
<tr><td><code id="summary.gwqs_+3A_newdata">newdata</code></td>
<td>
<p>Optionally, a data frame in which to look for variables with which to predict.
If omitted, the original observations are used.</p>
</td></tr>
<tr><td><code id="summary.gwqs_+3A_type">type</code></td>
<td>
<p>Character specifying the type of predictions, fitted values or residuals, respectively.
For details see below.</p>
</td></tr>
<tr><td><code id="summary.gwqs_+3A_model">model</code></td>
<td>
<p>Character specifying for which component of the model the varance-covariance matrix
should be extracted when zero_infl = TRUE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A set of standard extractor functions for fitted model objects is available for objects of class &quot;gwqs&quot;,
including methods to the generic functions print and summary which print the estimated coefficients
along with some further information. As usual, the summary method returns an object of class
&quot;summary.gwqs&quot; containing the relevant summary statistics which can subsequently be printed using the
associated print method.
</p>
<p>The methods for <a href="stats.html#topic+coef">coef</a> and <a href="stats.html#topic+vcov">vcov</a> by default return a single vector of
coefficients (a matrix when family = &quot;multinomial&quot;) and their associated covariance matrix, respectively.
By setting the model argument, the estimates for the corresponding model components can be extracted.
</p>
<p>Both the <a href="stats.html#topic+fitted">fitted</a> and <a href="stats.html#topic+predict">predict</a> methods can compute fitted responses. The latter
sets the default on the scale of the linear predictors; the alternative &quot;response&quot; is on the scale of the
response variable. Thus for a default binomial model the default predictions are of log-odds
(probabilities on logit scale) and type = &quot;response&quot; gives the predicted probabilities. Type can be equal
to &quot;prob&quot;, &quot;count&quot; or &quot;zero&quot; when zero_infl = T to estimate the predicted density (i.e., probabilities for
the observed counts), the predicted mean from the count component (without zero inflation) and the
predicted probability for the zero component. Type = &quot;class&quot; allow to predict the dependent variable
categories when family = &quot;multinomial&quot;. The &quot;terms&quot; option returns a matrix giving the fitted values of
each term in the model formula on the linear predictor scale.
</p>
<p>The <a href="stats.html#topic+residuals">residuals</a> method allows to extracts model residuals from the objects of class &quot;gwqs&quot;.
</p>


<h3>Value</h3>

<p>All these methods return the classic output as for the corresponding glm, glm.nb, multinom and
zeroinfl classes. Only the predict method gives a different output made of the following values.
</p>
<table>
<tr><td><code>df_pred</code></td>
<td>
<p>A data.frame containing the dependent varible and the predicted values.</p>
</td></tr>
<tr><td><code>Q</code></td>
<td>
<p>The matrix containing the new dataset quantiled variables of the elements included in the mixture.</p>
</td></tr>
<tr><td><code>qi</code></td>
<td>
<p>A list of vectors containing the cut points used to determine the quantiled variables.</p>
</td></tr>
<tr><td><code>wqs</code></td>
<td>
<p>The vetor containing the wqs index built on the new dataset.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Stefano Renzetti, Paul Curtin, Allan C Just, Ghalib Bello, Chris Gennings
</p>


<h3>Examples</h3>

<pre><code class='language-R'>toxic_chems = names(wqs_data)[1:34]
set.seed(1234)
rws &lt;- sample(1:500, 150)
results = gwqs(yLBX ~ wqs, mix_name = toxic_chems, data = wqs_data[-rws,], q = 4, validation = 0.6,
               b = 2, b1_pos = TRUE, b_constr = FALSE, family = gaussian)

# to test the significance of the covariates
summary(results)

# extract regression coefficients
coef(results)

# estimate variance-covariance matrix
vcov(results)

# estimate fitted values
fitted(results)

# estimate regression residuals
residuals(results)

# estimate predicted values on the left part of wqs_data
pred_res &lt;- predict(results, wqs_data[rws,])
pred_res$df_pred

</code></pre>

<hr>
<h2 id='tiwqs_data'>Measurement of 38 nutrients (NHANES dataset)</h2><span id='topic+tiwqs_data'></span>

<h3>Description</h3>

<p>We created the 'tiwqs_data' dataset to show how apply the two-indices WQS (2iWQS).
These data reflect 38 nutrients measured in 5960 subjects participating in the NHANES study
(2011-2012, 2013-2014, 2015-2016 cycles). Nutrients were estimated from the dietary intake
data that considered the types and amounts of foods and beverages consumed during the 24-hour
period prior to the interview. Two interviews were performed: the first one was collected
in-person while the second interview was collected by telephone 3 to 10 days later. In this
study we averaged the two nutrients when both evaluations were considered as usual food
consumption (only one measurement was included in the analysis if the other one was not usual
while the observation was dropped if both evaluations were not usual) and we added the dietary
supplement intake when applicable.
Additionally, BMI as both a continuous variable ('bmxbmi') and categorical variable ('bmi_cat')
was included as outcome variable.
A total of 10 covariates can also be found in the dataset
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(tiwqs_data)
</code></pre>


<h3>Format</h3>

<p>A data frame with 5960 rows and 50 variables
</p>

<hr>
<h2 id='wqs_data'>Exposure concentrations of 34 PCB (simulated dataset)</h2><span id='topic+wqs_data'></span>

<h3>Description</h3>

<p>We created the 'wqs_data' dataset to show how to use this function. These data reflect
59 exposure concentrations simulated from a distribution of 34 PCB exposures and
25 phthalate biomarkers measured in subjects participating in the NHANES study (2001-2002).
Additionally, 8 outcome measures were simulated applying different distributions and fixed
beta coefficients to the predictors. In particular 'y' and 'yLBX' were simulated from
a normal distribution, 'ybin' and 'ybinLBX' from a binomial distribution, 'ymultinom' and
'ymultinomLBX' from a multinomial distribution and 'ycount' and 'ycountLBX' from a Poisson
distribution.
The regression coefficients used to generate the outcomes 'yLBX', 'ybinLBX' and
'ycountLBX' were set to:<br />
LBX105LA = 0.3<br />
LBX138LA = 0.6<br />
LBX157LA = 0.2<br />
LBXD02LA = 0.45<br />
LBXD04LA = 0.15<br />
LBXF06LA = 0.3<br />
LBXF07LA = 0.45<br />
then the following terms were added to generate the variables 'y', 'ybin' and
'ycount':<br />
URXMC1 = 0.15<br />
URXMOH = 0.45<br />
URXP02 = 0.2<br />
URXP10 = 0.3<br />
URXUCR = 0.2<br />
All the remaining coefficients were set to 0.<br />
The coefficients to generate 'ymultinomLBX' were set as below:<br />
level B:<br />
LBX138LA = 0.8<br />
LBXD04LA = 0.2<br />
level C:<br />
LBX105LA = 0.4<br />
LBX157LA = 0.3<br />
LBXD02LA = 0.6<br />
LBXF06LA = 0.4<br />
LBXF07LA = 0.6<br />
and the following terms were added for 'ymultinom':<br />
level B:<br />
URXMC1 = 0.2<br />
URXP02 = 0.3<br />
URXP10 = 0.4<br />
URXUCR = 0.3<br />
level C:<br />
URXMOH = 0.6<br />
The 'sex' variable was also simulated to allow to adjust for a covariate in the model.
This dataset can thus be used to test the 'gWQS' package by analyzing the mixed effect
of the 59 simulated PCBs on the continuous, binary or count outcomes, with adjustments
for covariates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wqs_data
</code></pre>


<h3>Format</h3>

<p>A data frame with 500 rows and 68 variables
</p>


<h3>Details</h3>


<dl>
<dt>y</dt><dd><p>continuous outcome generated considerig all the predictors</p>
</dd>
<dt>yLBX</dt><dd><p>continuous outcome generated considerig only PCBs</p>
</dd>
<dt>ybin</dt><dd><p>binary outcome generated considerig all the predictors</p>
</dd>
<dt>ybinLBX</dt><dd><p>binary outcome generated considerig only PCBs</p>
</dd>
<dt>ymultinom</dt><dd><p>multinomial outcome generated considerig all the predictors</p>
</dd>
<dt>ymultinomLBX</dt><dd><p>multinomial outcome generated considerig only PCBs</p>
</dd>
<dt>ycount</dt><dd><p>count outcome generated considerig all the predictors</p>
</dd>
<dt>ycountLBX</dt><dd><p>count outcome generated considerig only PCBs</p>
</dd>
<dt>sex</dt><dd><p>covariate, gender of the subject</p>
</dd>
<dt>LBX</dt><dd><p>34 exposure concentrations of PCB</p>
</dd>
<dt>URX</dt><dd><p>25 exposure concentrations of phthalates</p>
</dd>
</dl>
<p>...

</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
