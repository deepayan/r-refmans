<!DOCTYPE html><html lang="en"><head><title>Help for package DeclareDesign</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {DeclareDesign}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#DeclareDesign'><p>DeclareDesign package</p></a></li>
<li><a href='#cite_design'><p>Obtain the preferred citation for a design</p></a></li>
<li><a href='#clone_dot_edit_env'><p>Override environment via shim</p></a></li>
<li><a href='#compare_diagnoses'><p>Compare Diagnoses</p></a></li>
<li><a href='#compare_functions'><p>Compare two designs</p></a></li>
<li><a href='#declare_assignment'><p>Declare Data Strategy: Assignment</p></a></li>
<li><a href='#declare_design'><p>Declare a design</p></a></li>
<li><a href='#declare_estimator'><p>Declare estimator</p></a></li>
<li><a href='#declare_inquiry'><p>Declare inquiry</p></a></li>
<li><a href='#declare_measurement'><p>Declare measurement procedure</p></a></li>
<li><a href='#declare_model'><p>Declare the size and features of the population</p></a></li>
<li><a href='#declare_population'><p>Declare the size and features of the population</p></a></li>
<li><a href='#declare_potential_outcomes'><p>Declare potential outcomes</p></a></li>
<li><a href='#declare_reveal'><p>Declare a reveal outcomes step</p></a></li>
<li><a href='#declare_sampling'><p>Declare sampling procedure</p></a></li>
<li><a href='#declare_step'><p>Declare a custom step</p></a></li>
<li><a href='#declare_test'><p>Declare test</p></a></li>
<li><a href='#DeclareDesign-deprecated'><p>Deprecated functions in package <span class="pkg">DeclareDesign</span>.</p></a></li>
<li><a href='#diagnosand_handler'><p>Declare diagnosands</p></a></li>
<li><a href='#diagnose_design'><p>Diagnose the design</p></a></li>
<li><a href='#diagnosis_helpers'><p>Explore your design diagnosis</p></a></li>
<li><a href='#draw_functions'><p>Draw data, estimates, and inquiries from a design</p></a></li>
<li><a href='#expand_conditions'><p>Expand assignment conditions</p></a></li>
<li><a href='#expand_design'><p>Declare a design via a designer</p></a></li>
<li><a href='#get_functions'><p>Get estimates, inquiries, assignment vectors, or samples from a design given data</p></a></li>
<li><a href='#modify_design'><p>Modify a design after the fact</p></a></li>
<li><a href='#pop.var'><p>Population variance function</p></a></li>
<li><a href='#post_design'><p>Explore your design</p></a></li>
<li><a href='#redesign'><p>Redesign</p></a></li>
<li><a href='#reexports'><p>Objects exported from other packages</p></a></li>
<li><a href='#reshape_diagnosis'><p>Clean up a diagnosis object for printing</p></a></li>
<li><a href='#run_design'><p>Run a design one time</p></a></li>
<li><a href='#set_citation'><p>Set the citation of a design</p></a></li>
<li><a href='#set_diagnosands'><p>Set the diagnosands for a design</p></a></li>
<li><a href='#simulate_design'><p>Simulate a design</p></a></li>
<li><a href='#tidy_try'><p>Tidy Model Results and Filter to Relevant Coefficients</p></a></li>
<li><a href='#tidy.diagnosis'><p>Tidy diagnosis</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Declare and Diagnose Research Designs</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.10</td>
</tr>
<tr>
<td>Description:</td>
<td>Researchers can characterize and learn about the properties of
    research designs before implementation using 'DeclareDesign'. Ex ante
    declaration and diagnosis of designs can help researchers clarify the 
    strengths and limitations of their designs and to improve their 
    properties, and can help readers evaluate a research strategy prior
    to implementation and without access to results. It can also make it
    easier for designs to be shared, replicated, and critiqued.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0), randomizr (&ge; 0.20.0), fabricatr (&ge; 0.10.0),
estimatr (&ge; 0.20.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>rlang, generics, methods</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://declaredesign.org/r/declaredesign/">https://declaredesign.org/r/declaredesign/</a>,
<a href="https://github.com/DeclareDesign/DeclareDesign">https://github.com/DeclareDesign/DeclareDesign</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/DeclareDesign/DeclareDesign/issues">https://github.com/DeclareDesign/DeclareDesign/issues</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat, knitr, rmarkdown, AER, diffobj, dplyr, data.table,
tibble, ggplot2, future, future.apply, broom, MASS, Matching,
betareg, biglm, gam, sf, reshape2, DesignLibrary, coin,
marginaleffects, psych</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-04-20 01:17:51 UTC; blair</td>
</tr>
<tr>
<td>Author:</td>
<td>Graeme Blair <a href="https://orcid.org/0000-0001-9164-2102"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Jasper Cooper <a href="https://orcid.org/0000-0002-8639-3188"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Alexander Coppock <a href="https://orcid.org/0000-0002-5733-2386"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Macartan Humphreys
    <a href="https://orcid.org/0000-0001-7029-2326"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Neal Fultz [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Graeme Blair &lt;graeme.blair@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-04-21 20:52:45 UTC</td>
</tr>
</table>
<hr>
<h2 id='DeclareDesign'>DeclareDesign package</h2><span id='topic+DeclareDesign-package'></span><span id='topic+DeclareDesign'></span>

<h3>Description</h3>

<p>The four main types of functions are to declare a step, to combine steps into designs,
and to manipulate designs and designers (functions that return designs).
</p>


<h3>Design Steps</h3>


<dl>
<dt><code><a href="#topic+declare_model">declare_model</a></code></dt><dd><p>Model step</p>
</dd>
<dt><code><a href="#topic+declare_inquiry">declare_inquiry</a></code></dt><dd><p>Inquiry step</p>
</dd>
<dt><code><a href="#topic+declare_sampling">declare_sampling</a></code></dt><dd><p>Data strategy step (sampling)</p>
</dd>
<dt><code><a href="#topic+declare_assignment">declare_assignment</a></code></dt><dd><p>Data strategy step (assignment)</p>
</dd>
<dt><code><a href="#topic+declare_measurement">declare_measurement</a></code></dt><dd><p>Data strategy step (measurement)</p>
</dd>
<dt><code><a href="#topic+declare_estimator">declare_estimator</a></code></dt><dd><p>Answer strategy step (Estimator)</p>
</dd>
<dt><code><a href="#topic+declare_test">declare_test</a></code></dt><dd><p>Answer strategy step (Testing function)</p>
</dd>
</dl>



<h3>Design Objects</h3>


<dl>
<dt>+</dt><dd><p>Add steps to create a design</p>
</dd>
<dt><code><a href="#topic+redesign">redesign</a></code></dt><dd><p>Change design parameters</p>
</dd>
<dt><code><a href="#topic+draw_data">draw_data</a></code></dt><dd><p>Draw a simulated dataset</p>
</dd>
<dt><code><a href="#topic+run_design">run_design</a></code></dt><dd><p>Draw one set of inquiry values and estimates</p>
</dd>
<dt><code><a href="#topic+diagnose_design">diagnose_design</a></code></dt><dd><p>Diagnose a design</p>
</dd>
<dt><code><a href="#topic+cite_design">cite_design</a></code></dt><dd><p>Cite a design</p>
</dd>
</dl>



<h3>Design Editing</h3>


<dl>
<dt><code><a href="#topic+modify_design">modify_design</a></code></dt><dd><p>Add, delete or replace a step</p>
</dd>
<dt><code><a href="#topic+redesign">redesign</a></code></dt><dd><p>Modify local variables within a design (advanced)</p>
</dd>
</dl>



<h3>Designers</h3>


<dl>
<dt><code><a href="#topic+expand_design">expand_design</a></code></dt><dd><p>Generate designs from a designer</p>
</dd>
<dt>designs</dt><dd><p>See also the <code>DesignLibrary</code> package for designers to use</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Graeme Blair <a href="mailto:graeme.blair@gmail.com">graeme.blair@gmail.com</a> (<a href="https://orcid.org/0000-0001-9164-2102">ORCID</a>)
</p>
<p>Authors:
</p>

<ul>
<li><p> Jasper Cooper <a href="mailto:jaspercooper@gmail.com">jaspercooper@gmail.com</a> (<a href="https://orcid.org/0000-0002-8639-3188">ORCID</a>)
</p>
</li>
<li><p> Alexander Coppock <a href="mailto:acoppock@gmail.com">acoppock@gmail.com</a> (<a href="https://orcid.org/0000-0002-5733-2386">ORCID</a>)
</p>
</li>
<li><p> Macartan Humphreys <a href="mailto:macartan@gmail.com">macartan@gmail.com</a> (<a href="https://orcid.org/0000-0001-7029-2326">ORCID</a>)
</p>
</li>
<li><p> Neal Fultz <a href="mailto:nfultz@gmail.com">nfultz@gmail.com</a>
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://declaredesign.org/r/declaredesign/">https://declaredesign.org/r/declaredesign/</a>
</p>
</li>
<li> <p><a href="https://github.com/DeclareDesign/DeclareDesign">https://github.com/DeclareDesign/DeclareDesign</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/DeclareDesign/DeclareDesign/issues">https://github.com/DeclareDesign/DeclareDesign/issues</a>
</p>
</li></ul>


<hr>
<h2 id='cite_design'>Obtain the preferred citation for a design</h2><span id='topic+cite_design'></span>

<h3>Description</h3>

<p>Obtain the preferred citation for a design
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cite_design(design, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cite_design_+3A_design">design</code></td>
<td>
<p>a design object created using the + operator</p>
</td></tr>
<tr><td><code id="cite_design_+3A_...">...</code></td>
<td>
<p>options for printing the citation if it is a BibTeX entry</p>
</td></tr>
</table>

<hr>
<h2 id='clone_dot_edit_env'>Override environment via shim</h2><span id='topic+clone_dot_edit_env'></span><span id='topic+clone_step_edit'></span><span id='topic+clone_design_edit'></span>

<h3>Description</h3>

<p>Override environment via shim
</p>


<h3>Usage</h3>

<pre><code class='language-R'>clone_dot_edit_env(dot, ..., to_replace = list(...))

clone_step_edit(step, ..., to_replace = list(...))

clone_design_edit(design, ..., to_replace = list(...))
</code></pre>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
here_i_am &lt;- "foo"
dot &lt;- quo(here_i_am)
dot2 &lt;- DeclareDesign:::clone_dot_edit_env(dot, here_i_am = "some_message", xyxyx = "bar")
rlang::eval_tidy(dot)
rlang::eval_tidy(dot2)

## End(Not run)
## Not run: 
N &lt;- 50

pop50 &lt;- declare_model(N=N, noise=rnorm(N))
nrow(pop50())

pop100 &lt;- DeclareDesign:::clone_step_edit(pop50, N=100)
nrow(pop100())
nrow(pop50())


## End(Not run)
</code></pre>

<hr>
<h2 id='compare_diagnoses'>Compare Diagnoses</h2><span id='topic+compare_diagnoses'></span>

<h3>Description</h3>

<p>Diagnose and compare designs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compare_diagnoses(
  design1,
  design2,
  sims = 500,
  bootstrap_sims = 100,
  merge_by_estimator = TRUE,
  alpha = 0.05
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compare_diagnoses_+3A_design1">design1</code></td>
<td>
<p>A design or a diagnosis.</p>
</td></tr>
<tr><td><code id="compare_diagnoses_+3A_design2">design2</code></td>
<td>
<p>A design or a diagnosis.</p>
</td></tr>
<tr><td><code id="compare_diagnoses_+3A_sims">sims</code></td>
<td>
<p>The number of simulations, defaulting to 1000. <code>sims</code> may also be a vector indicating the number of simulations for each step in a design, as described for <code><a href="#topic+simulate_design">simulate_design</a></code>. Used for both designs.</p>
</td></tr>
<tr><td><code id="compare_diagnoses_+3A_bootstrap_sims">bootstrap_sims</code></td>
<td>
<p>Number of bootstrap replicates for the diagnosands to obtain the standard errors of the diagnosands, defaulting to <code>1000</code>. Set to <code>FALSE</code> to turn off bootstrapping. Used for both designs. Must be greater or equal to 100.</p>
</td></tr>
<tr><td><code id="compare_diagnoses_+3A_merge_by_estimator">merge_by_estimator</code></td>
<td>
<p>A logical. Whether to include <code>estimator</code> in the set of columns used for merging. Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="compare_diagnoses_+3A_alpha">alpha</code></td>
<td>
<p>The significance level, 0.05 by default.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function <code>compare_diagnoses</code> runs a many-to-many merge matching by <code>inquiry</code> and <code>term</code> (if present). If  <code>merge_by_estimator</code> equals <code>TRUE</code>, <code>estimator</code> is also included in the merging condition. Any diagnosand that is not included in both designs will be dropped from the merge.
</p>


<h3>Value</h3>

<p>A list with a <code>data.frame</code> of compared diagnoses and both diagnoses.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>design_a &lt;- 
  declare_model(N  = 100, 
                U = rnorm(N),
                Y_Z_0 = U,
                Y_Z_1 = U + rnorm(N, mean = 2, sd = 2)) +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_assignment(Z = complete_ra(N, prob = 0.5)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) +
  declare_estimator(Y ~ Z, inquiry = "ATE")

design_b &lt;- replace_step(
  design_a, step = "assignment", 
  declare_assignment(Z = complete_ra(N, prob = 0.3)) )

comparison &lt;- compare_diagnoses(design_a, design_b, sims = 40)

</code></pre>

<hr>
<h2 id='compare_functions'>Compare two designs</h2><span id='topic+compare_functions'></span><span id='topic+compare_designs'></span><span id='topic+compare_design_code'></span><span id='topic+compare_design_summaries'></span><span id='topic+compare_design_data'></span><span id='topic+compare_design_estimates'></span><span id='topic+compare_design_inquiries'></span>

<h3>Description</h3>

<p>Compare two designs
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compare_designs(
  design1,
  design2,
  format = "ansi8",
  pager = "off",
  context = -1L,
  rmd = FALSE
)

compare_design_code(
  design1,
  design2,
  format = "ansi256",
  mode = "sidebyside",
  pager = "off",
  context = -1L,
  rmd = FALSE
)

compare_design_summaries(
  design1,
  design2,
  format = "ansi256",
  mode = "sidebyside",
  pager = "off",
  context = -1L,
  rmd = FALSE
)

compare_design_data(
  design1,
  design2,
  format = "ansi256",
  mode = "sidebyside",
  pager = "off",
  context = -1L,
  rmd = FALSE
)

compare_design_estimates(
  design1,
  design2,
  format = "ansi256",
  mode = "auto",
  pager = "off",
  context = -1L,
  rmd = FALSE
)

compare_design_inquiries(
  design1,
  design2,
  format = "ansi256",
  mode = "sidebyside",
  pager = "off",
  context = -1L,
  rmd = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compare_functions_+3A_design1">design1</code></td>
<td>
<p>A design object, typically created using the + operator</p>
</td></tr>
<tr><td><code id="compare_functions_+3A_design2">design2</code></td>
<td>
<p>A design object, typically created using the + operator</p>
</td></tr>
<tr><td><code id="compare_functions_+3A_format">format</code></td>
<td>
<p>Format (in console or HTML) options from <code>diffobj::diffChr</code></p>
</td></tr>
<tr><td><code id="compare_functions_+3A_pager">pager</code></td>
<td>
<p>Pager option from <code>diffobj::diffChr</code></p>
</td></tr>
<tr><td><code id="compare_functions_+3A_context">context</code></td>
<td>
<p>Context option from <code>diffobj::diffChr</code> which sets the number of lines around differences that are printed. By default, all lines of the two objects are shown. To show only the lines that are different, set <code>context = 0</code>; to get one line around differences for context, set to 1.</p>
</td></tr>
<tr><td><code id="compare_functions_+3A_rmd">rmd</code></td>
<td>
<p>Set to <code>TRUE</code> use in Rmarkdown HTML output. NB: will not work with LaTeX, Word, or other .Rmd outputs.</p>
</td></tr>
<tr><td><code id="compare_functions_+3A_mode">mode</code></td>
<td>
<p>Mode options from <code>diffobj::diffChr</code></p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
design1 &lt;- declare_model(N = 100, u = rnorm(N), potential_outcomes(Y ~ Z + u)) +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_sampling(S = complete_rs(N, n = 75)) +
  declare_assignment(Z = complete_ra(N, m = 50)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) +
  declare_estimator(Y ~ Z, inquiry = "ATE")

  design2 &lt;- declare_model(N = 200, U = rnorm(N),
                         potential_outcomes(Y ~ 0.5*Z + U)) +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_sampling(S = complete_rs(N, n = 100)) +
  declare_assignment(Z = complete_ra(N, m = 25)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) +
  declare_estimator(Y ~ Z, .method = lm_robust, inquiry = "ATE")
 
 if (require("diffobj")) {
 
   compare_designs(design1, design2)
   compare_design_code(design1, design2)
   compare_design_summaries(design1, design2)
   compare_design_data(design1, design2)
   compare_design_estimates(design1, design2)
   compare_design_inquiries(design1, design2)
 
 }

</code></pre>

<hr>
<h2 id='declare_assignment'>Declare Data Strategy: Assignment</h2><span id='topic+declare_assignment'></span><span id='topic+assignment_handler'></span>

<h3>Description</h3>

<p>Declare Data Strategy: Assignment
</p>


<h3>Usage</h3>

<pre><code class='language-R'>declare_assignment(..., handler = assignment_handler, label = NULL)

assignment_handler(data, ..., legacy = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="declare_assignment_+3A_...">...</code></td>
<td>
<p>arguments to be captured, and later passed to the handler</p>
</td></tr>
<tr><td><code id="declare_assignment_+3A_handler">handler</code></td>
<td>
<p>a tidy-in, tidy-out function</p>
</td></tr>
<tr><td><code id="declare_assignment_+3A_label">label</code></td>
<td>
<p>a string describing the step</p>
</td></tr>
<tr><td><code id="declare_assignment_+3A_data">data</code></td>
<td>
<p>A data.frame.</p>
</td></tr>
<tr><td><code id="declare_assignment_+3A_legacy">legacy</code></td>
<td>
<p>Use the legacy randomizr functionality. This will be disabled in future; please use legacy = FALSE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A function that takes a data.frame as an argument and returns a data.frame with assignment columns appended.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># declare_assignment in use
## Two-arm randomized experiment
design &lt;-
  declare_model(
    N = 500,
    X = rep(c(0, 1), each = N / 2),
    U = rnorm(N, sd = 0.25),
    potential_outcomes(Y ~ 0.2 * Z + X + U)
  ) +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_sampling(S = complete_rs(N = N, n = 200)) +
  declare_assignment(Z = complete_ra(N = N, m = 100)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) +
  declare_estimator(Y ~ Z, inquiry = "ATE")
  
run_design(design)

# Set up population to assign
model &lt;- declare_model(
  villages = add_level(
    N = 30, 
    N_households = sample(c(50:100), N, replace = TRUE)
  ),
  households = add_level(
    N = N_households, 
    N_members = sample(c(1, 2, 3, 4), N, 
                       prob = c(0.2, 0.3, 0.25, 0.25), replace = TRUE)
  ),
  individuals = add_level(
    N = N_members, 
    age = sample(18:90, N, replace = TRUE),
    gender = rbinom(n = N, size = 1, prob = .5)
  )
)

# Assignment procedures
## Complete random assignment
design &lt;-
  model +
  declare_assignment(Z = complete_ra(N = N, m = 1000))
  
head(draw_data(design))

## Cluster random assignment
design &lt;-
  model +
  declare_assignment(Z = cluster_ra(clusters = villages,
                                    n = 15))
                                    
head(draw_data(design))

## Block and cluster random assignment
design &lt;-
  model +
  declare_assignment(Z  = block_and_cluster_ra(
    blocks = villages,
    clusters = households,
    block_m = rep(20, 30)
  ))

head(draw_data(design))

## Block random assignment
design &lt;-
  model +
  declare_assignment(Z = block_ra(blocks = gender, m = 100))
  
head(draw_data(design))

## Block random assignment using probabilities
design &lt;-
  model +
  declare_assignment(Z = block_ra(blocks = gender,
                                  block_prob = c(1 / 3, 2 / 3)))

head(draw_data(design))

## Factorial assignment
design &lt;-
  model +
  declare_assignment(Z1 = complete_ra(N = N, m = 100),
                     Z2 = block_ra(blocks = Z1))

head(draw_data(design))

## Assignment using functions outside of randomizr
design &lt;-
  model +
  declare_assignment(Z = rbinom(n = N, size = 1, prob = 0.35))

head(draw_data(design))

</code></pre>

<hr>
<h2 id='declare_design'>Declare a design</h2><span id='topic+declare_design'></span><span id='topic++2B.dd'></span>

<h3>Description</h3>

<p>Declare a design
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'dd'
lhs + rhs
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="declare_design_+3A_lhs">lhs</code></td>
<td>
<p>A step in a research design, beginning with a function that defines the model. Steps are evaluated sequentially. With the exception of the first step, all steps must be functions that take a <code>data.frame</code> as an argument and return a <code>data.frame</code>. Steps are declared using the <code>declare_</code> functions, i.e., <code><a href="#topic+declare_model">declare_model</a></code>, <code><a href="#topic+declare_inquiry">declare_inquiry</a></code>, <code><a href="#topic+declare_sampling">declare_sampling</a></code>, <code><a href="#topic+declare_assignment">declare_assignment</a></code>, <code><a href="#topic+declare_measurement">declare_measurement</a></code>, <code><a href="#topic+declare_estimator">declare_estimator</a></code>, and <code><a href="#topic+declare_test">declare_test</a></code>.</p>
</td></tr>
<tr><td><code id="declare_design_+3A_rhs">rhs</code></td>
<td>
<p>A second step in a research design</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a design
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
design &lt;-
  declare_model(
    N = 500, 
    U = rnorm(N),
    potential_outcomes(Y ~ Z + U)
  ) +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_sampling(S = complete_rs(N, n = 250)) +
  declare_assignment(Z = complete_ra(N, m = 25)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) +
  declare_estimator(Y ~ Z, inquiry = "ATE") 

dat &lt;- draw_data(design)
head(dat)

run_design(design)

# You may wish to have a design with only one step:

design &lt;- declare_model(N = 500, noise = rnorm(N)) + NULL

dat &lt;- draw_data(design)
head(dat)

</code></pre>

<hr>
<h2 id='declare_estimator'>Declare estimator</h2><span id='topic+declare_estimator'></span><span id='topic+declare_estimators'></span><span id='topic+label_estimator'></span><span id='topic+method_handler'></span>

<h3>Description</h3>

<p>Declares an estimator which generates estimates and associated statistics.
</p>
<p>Use of <code>declare_test</code> is identical to use of <code><a href="#topic+declare_estimator">declare_estimator</a></code>. Use <code>declare_test</code> for hypothesis testing with no specific inquiry in mind; use <code>declare_estimator</code> for hypothesis testing when you can link each estimate to an inquiry. For example, <code>declare_test</code> could be used for a K-S test of distributional equality and <code>declare_estimator</code> for a difference-in-means estimate of an average treatment effect.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>declare_estimator(
  ...,
  handler = label_estimator(method_handler),
  label = "estimator"
)

declare_estimators(
  ...,
  handler = label_estimator(method_handler),
  label = "estimator"
)

label_estimator(fn)

method_handler(
  data,
  ...,
  .method = estimatr::lm_robust,
  .summary = tidy_try,
  model,
  model_summary,
  term = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="declare_estimator_+3A_...">...</code></td>
<td>
<p>arguments to be captured, and later passed to the handler</p>
</td></tr>
<tr><td><code id="declare_estimator_+3A_handler">handler</code></td>
<td>
<p>a tidy-in, tidy-out function</p>
</td></tr>
<tr><td><code id="declare_estimator_+3A_label">label</code></td>
<td>
<p>a string describing the step</p>
</td></tr>
<tr><td><code id="declare_estimator_+3A_fn">fn</code></td>
<td>
<p>A function that takes a data.frame as an argument and returns a data.frame with the estimates, summary statistics (i.e., standard error, p-value, and confidence interval), and a term column for labeling coefficient estimates.</p>
</td></tr>
<tr><td><code id="declare_estimator_+3A_data">data</code></td>
<td>
<p>a data.frame</p>
</td></tr>
<tr><td><code id="declare_estimator_+3A_.method">.method</code></td>
<td>
<p>A method function, e.g. lm or glm. By default, the method is the <code>lm_robust</code> function from the estimatr package, which fits OLS regression and calculates robust and cluster-robust standard errors.</p>
</td></tr>
<tr><td><code id="declare_estimator_+3A_.summary">.summary</code></td>
<td>
<p>A method-in data-out function to extract coefficient estimates or method summary statistics, such as <code><a href="#topic+tidy">tidy</a></code> or <code>glance</code>. By default, the <code>DeclareDesign</code> method summary function <code><a href="#topic+tidy_try">tidy_try</a></code> is used, which first attempts to use the available tidy method for the method object sent to <code>method</code>, then if not attempts to summarize coefficients using the <code>coef(summary())</code> and <code>confint</code> methods. If these do not exist for the method object, it fails.</p>
</td></tr>
<tr><td><code id="declare_estimator_+3A_model">model</code></td>
<td>
<p>Deprecated argument. Use <code>.method</code> instead.</p>
</td></tr>
<tr><td><code id="declare_estimator_+3A_model_summary">model_summary</code></td>
<td>
<p>Deprecated argument. Use <code>.summary</code> instead.</p>
</td></tr>
<tr><td><code id="declare_estimator_+3A_term">term</code></td>
<td>
<p>Symbols or literal character vector of term that represent quantities of interest, i.e. Z. If FALSE, return the first non-intercept term; if TRUE return all term. To escape non-standard-evaluation use <code>!!</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>declare_estimator</code> is designed to handle two main ways of generating parameter estimates from data.
</p>
<p>In <code>declare_estimator</code>, you can optionally provide the name of an inquiry or an objected created by <code><a href="#topic+declare_inquiry">declare_inquiry</a></code> to connect your estimate(s) to inquiry(s).
</p>
<p>The first is through <code>label_estimator(method_handler)</code>, which is the default value of the <code>handler</code> argument. Users can use standard method functions like lm, glm, or iv_robust. The methods are summarized using the function passed to the <code>summary</code> argument. This will usually be a &quot;tidier&quot; like <code>broom::tidy</code>. The default <code>summary</code> function is <code>tidy_try</code>, which applies a tidy method if available, and if not, tries to make one on the fly.
</p>
<p>An example of this approach is:
</p>
<p><code>declare_estimator(Y ~ Z + X, .method = lm_robust, .summary = tidy, term = "Z", inquiry = "ATE")</code>
</p>
<p>The second approach is using a custom data-in, data-out function, usually first passed to <code>label_estimator</code>. The reason to pass the custom function to <code>label_estimator</code> first is to enable clean labeling and linking to inquiries.
</p>
<p>An example of this approach is:
</p>
<p><code>
my_fun &lt;- function(data){ with(data, median(Y[Z == 1]) - median(Y[Z == 0])) }
</code>
</p>
<p><code>
declare_estimator(handler = label_estimator(my_fun), inquiry = "ATE")
</code>
</p>
<p><code>label_estimator</code> takes a data-in-data out function to <code>fn</code>, and returns a data-in-data-out function that first runs the provided estimation function <code>fn</code> and then appends a label for the estimator and, if an inquiry is provided, a label for the inquiry.
</p>


<h3>Value</h3>

<p>A function that accepts a data.frame as an argument and returns a data.frame containing the value of the estimator and associated statistics.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Setup for examples
design &lt;-
  declare_model(
    N = 500,
    gender = rbinom(N, 1, 0.5),
    U = rnorm(N, sd = 0.25),
    potential_outcomes(Y ~ rbinom(
      N, 1, prob = pnorm(0.2 * Z + 0.2 * gender + 0.1 * Z * gender + U)
    ))
  ) +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_sampling(S = complete_rs(N = N, n = 200)) +
  declare_assignment(Z = complete_ra(N = N, m = 100)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z))
  
run_design(design)

# default estimator is lm_robust with tidy summary
design_0 &lt;-
  design +
  declare_estimator(Y ~ Z, inquiry = "ATE")

run_design(design_0)

# Linear regression using lm_robust and tidy summary
design_1 &lt;-
  design +
  declare_estimator(
    formula = Y ~ Z,
    .method = lm_robust,
    .summary = tidy,
    term = "Z",
    inquiry = "ATE",
    label = "lm_no_controls"
  )

run_design(design_1)

# Use glance summary function to view model fit statistics
design_2 &lt;-
  design +
  declare_estimator(.method = lm_robust,
                    formula = Y ~ Z,
                    .summary = glance)

run_design(design_2)

# Use declare_estimator to implement custom answer strategies
my_estimator &lt;- function(data) {
  data.frame(estimate = mean(data$Y))
}

design_3 &lt;-
  design +
  declare_inquiry(Y_bar = mean(Y)) +
  declare_estimator(handler = label_estimator(my_estimator),
                    label = "mean",
                    inquiry = "Y_bar")

run_design(design_3)

# Use `term` to select particular coefficients
design_4 &lt;-
  design +
  declare_inquiry(difference_in_cates = mean(Y_Z_1[gender == 1] - Y_Z_0[gender == 1]) -
                    mean(Y_Z_1[gender == 0] - Y_Z_0[gender == 0])) +
  declare_estimator(Y ~ Z * gender,
                    term = "Z:gender",
                    inquiry = "difference_in_cates",
                    .method = lm_robust)

run_design(design_4)

if(require("broom")) {

  # Use glm from base R
  design_5 &lt;-
    design +
    declare_estimator(Y ~ Z + gender,
                      family = "gaussian",
                      inquiry = "ATE",
                      .method = glm)
  
  run_design(design_5)
  
  # If we use logit, we'll need to estimate the average marginal effect with
  # marginaleffects::avg_slopes. We wrap this up in a function we'll pass to 
  # .summary.
  
  if(require("marginaleffects")) {
  
    library(marginaleffects) # for predictions
    library(broom) # for tidy
    
    tidy_avg_slopes &lt;- function(x) {
      tidy(avg_slopes(x))
    }
    
    design_6 &lt;-
      design +
      declare_estimator(
        Y ~ Z + gender,
        .method = glm,
        family = binomial("logit"),
        .summary = tidy_avg_slopes,
        term = "Z"
      )
    
    run_design(design_6)
    
    # Multiple estimators for one inquiry
    
    design_7 &lt;-
      design +
      declare_estimator(Y ~ Z,
                        .method = lm_robust,
                        inquiry = "ATE",
                        label = "OLS") +
      declare_estimator(
        Y ~ Z + gender,
        .method = glm,
        family = binomial("logit"),
        .summary = tidy_avg_slopes,
        inquiry = "ATE",
        term = "Z",
        label = "logit"
      )
    
    run_design(design_7)
    
  }

}
</code></pre>

<hr>
<h2 id='declare_inquiry'>Declare inquiry</h2><span id='topic+declare_inquiry'></span><span id='topic+declare_inquiries'></span><span id='topic+declare_estimand'></span><span id='topic+declare_estimands'></span><span id='topic+inquiry_handler'></span>

<h3>Description</h3>

<p>Declares inquiries, or the inferential target of interest. Conceptually very close to &quot;estimand&quot; or &quot;quantity of interest&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>declare_inquiry(..., handler = inquiry_handler, label = "inquiry")

declare_inquiries(..., handler = inquiry_handler, label = "inquiry")

declare_estimand(...)

declare_estimands(...)

inquiry_handler(data, ..., subset = NULL, term = FALSE, label)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="declare_inquiry_+3A_...">...</code></td>
<td>
<p>arguments to be captured, and later passed to the handler</p>
</td></tr>
<tr><td><code id="declare_inquiry_+3A_handler">handler</code></td>
<td>
<p>a tidy-in, tidy-out function</p>
</td></tr>
<tr><td><code id="declare_inquiry_+3A_label">label</code></td>
<td>
<p>a string describing the step</p>
</td></tr>
<tr><td><code id="declare_inquiry_+3A_data">data</code></td>
<td>
<p>a data.frame</p>
</td></tr>
<tr><td><code id="declare_inquiry_+3A_subset">subset</code></td>
<td>
<p>a subset expression</p>
</td></tr>
<tr><td><code id="declare_inquiry_+3A_term">term</code></td>
<td>
<p>TRUE/FALSE</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For the default diagnosands, the return value of the handler should have <code>inquiry</code> and <code>estimand</code> columns.
</p>
<p>If term is TRUE, the names of ... will be returned in a <code>term</code> column,
and <code>inquiry</code> will contain the step label. This can be used as
an additional dimension for use in diagnosis.
</p>


<h3>Value</h3>

<p>a function, I(), that accepts a data.frame as an argument and returns a data.frame containing the value of the inquiry,  a^m.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

# Set up a design for use in examples:
## Two-arm randomized experiment
design &lt;-
  declare_model(
    N = 500,
    X = rep(c(0, 1), each = N / 2),
    U = rnorm(N, sd = 0.25),
    potential_outcomes(Y ~ 0.2 * Z + X + U)
  ) +
  declare_assignment(Z = complete_ra(N = N, m = 250)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z))
  
head(draw_data(design))

# Some common inquiries
design +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0))

design +
  declare_inquiry(difference_in_var = var(Y_Z_1) - var(Y_Z_0))

design +
  declare_inquiry(mean_Y = mean(Y))

# Inquiries among a subset
design +
  declare_inquiry(ATT = mean(Y_Z_1 - Y_Z_0),
                  subset = (Z == 1))

design +
  declare_inquiry(CATE = mean(Y_Z_1 - Y_Z_0),
                  subset = X == 1)
                  
# equivalently
design +
  declare_inquiry(CATE = mean(Y_Z_1[X == 1] - Y_Z_0[X == 1]))

# Add inquiries to a design along with estimators that
# reference them
diff_in_variances &lt;-
  function(data) {
    data.frame(estimate = with(data, var(Y[Z == 1]) - var(Y[Z == 0])))
  }

design_1 &lt;-
  design +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0),
                  difference_in_var = var(Y_Z_1) - var(Y_Z_0)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) +
  declare_estimator(Y ~ Z, 
                    inquiry = "ATE",
                    label = "DIM") +
  declare_estimator(handler =
                      label_estimator(diff_in_variances),
                    inquiry = "difference_in_var",
                    label = "DIV")

run_design(design_1)

# Two inquiries using one estimator

design_2 &lt;-
  design +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_inquiry(ATT = mean(Y_Z_1 - Y_Z_0), subset = (Z == 1)) +
  declare_estimator(Y ~ Z, inquiry = c("ATE", "ATT"))

run_design(design_2)

# Two inquiries using different coefficients from one estimator

design_3 &lt;-
  design +
  declare_inquiry(intercept = mean(Y_Z_0),
                  slope = mean(Y_Z_1 - Y_Z_0)) +
  declare_estimator(
    Y ~ Z,
    .method = lm_robust,
    term = TRUE,
    inquiry = c("intercept", "slope")
  )

run_design(design_3)


# declare_inquiries usage
design_4 &lt;- design +
  declare_inquiries(
    ATE = mean(Y_Z_1[X == 1] - Y_Z_0[X == 1]),
    CATE_X0 = mean(Y_Z_1[X == 0] - Y_Z_0[X == 0]),
    CATE_X1 = mean(Y_Z_1[X == 1] - Y_Z_0[X == 1]),
    Difference_in_CATEs = CATE_X1 - CATE_X0,
    mean_Y = mean(Y))
    
run_design(design_4)


</code></pre>

<hr>
<h2 id='declare_measurement'>Declare measurement procedure</h2><span id='topic+declare_measurement'></span><span id='topic+measurement_handler'></span>

<h3>Description</h3>

<p>This function adds measured data columns that can be functions of unmeasured data columns.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>declare_measurement(..., handler = measurement_handler, label = NULL)

measurement_handler(data, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="declare_measurement_+3A_...">...</code></td>
<td>
<p>arguments to be captured, and later passed to the handler</p>
</td></tr>
<tr><td><code id="declare_measurement_+3A_handler">handler</code></td>
<td>
<p>a tidy-in, tidy-out function</p>
</td></tr>
<tr><td><code id="declare_measurement_+3A_label">label</code></td>
<td>
<p>a string describing the step</p>
</td></tr>
<tr><td><code id="declare_measurement_+3A_data">data</code></td>
<td>
<p>A data.frame.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It is also possible to include measured variables in your declare_model call or to add variables using declare_step. However, putting latent variables in declare_model and variables-as-measured in declare_measurement helps communicate which parts of your research design are in M and which parts are in D.
</p>


<h3>Value</h3>

<p>A function that returns a data.frame.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# declare_measurement in use
## Two-arm randomized experiment
design &lt;-
  declare_model(
    N = 500,
    X = rep(c(0, 1), each = N / 2),
    U = rnorm(N, sd = 0.25),
    potential_outcomes(Y ~ 0.2 * Z + X + U)
  ) +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_sampling(S = complete_rs(N = N, n = 200)) +
  declare_assignment(Z = complete_ra(N = N, m = 100)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) +
  declare_estimator(Y ~ Z, inquiry = "ATE")
  
run_design(design)

# Reveal potential outcomes according to treatment assignment
design &lt;-
  declare_model(N = 100,
                potential_outcomes(Y ~ rbinom(
                  N, size = 1, prob = 0.1 * Z + 0.5
                ))) +
  declare_assignment(Z = complete_ra(N, m = 50)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z))
  
head(draw_data(design))

# Generate observed measurement from a latent value
design &lt;- 
  declare_model(N = 100, latent = runif(N)) +
  declare_measurement(observed = rbinom(N, 1, prob = latent))
  
head(draw_data(design))

if(require("psych")) {

  # Index creation
  
  library(psych)
  
  design &lt;-
    declare_model(
      N = 500,
      X = rep(c(0, 1), each = N / 2),
      Y_1 = 0.2 * X + rnorm(N, sd = 0.25),
      Y_2 = 0.3 * X + 0.5 * rnorm(N, sd = 0.50),
      Y_3 = 0.1 * X + 0.4 * rnorm(N, sd = 0.75)) +
    declare_measurement(
      index = fa(
        r = cbind(Y_1, Y_2, Y_3),
        nfactors = 1,
        rotate = "varimax"
      )$scores
    )
  
  draw_data(design)
}
</code></pre>

<hr>
<h2 id='declare_model'>Declare the size and features of the population</h2><span id='topic+declare_model'></span>

<h3>Description</h3>

<p>Declare the size and features of the population
</p>


<h3>Usage</h3>

<pre><code class='language-R'>declare_model(..., handler = fabricate, label = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="declare_model_+3A_...">...</code></td>
<td>
<p>arguments to be captured, and later passed to the handler</p>
</td></tr>
<tr><td><code id="declare_model_+3A_handler">handler</code></td>
<td>
<p>a tidy-in, tidy-out function</p>
</td></tr>
<tr><td><code id="declare_model_+3A_label">label</code></td>
<td>
<p>a string describing the step</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A function that returns a data.frame.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># declare_model is usually used when concatenating
# design elements with `+`

## Example: Two-arm randomized experiment
design &lt;-
  declare_model(
    N = 500,
    X = rep(c(0, 1), each = N / 2),
    U = rnorm(N, sd = 0.25),
    potential_outcomes(Y ~ 0.2 * Z + X + U)
  ) +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_assignment(Z = complete_ra(N = N, m = 250)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) +
  declare_estimator(Y ~ Z, inquiry = "ATE")

# declare_model returns a function:
M &lt;- declare_model(N = 100)
M()

# Declare a population from existing data
M &lt;- declare_model(data = mtcars)
M()

# Resample from existing data
M &lt;- declare_model(N = 100, data = mtcars, handler = resample_data)
M()

# Declare a model with covariates: 
# observed covariates X1 and X2 and 
# unobserved heterogeneity U that each affect 
# outcome Y
M &lt;- declare_model(
  N = 100,
  U = rnorm(N),
  X1 = rbinom(N, size = 1, prob = 0.5),
  X2 = X1 + rnorm(N),
  Y = 0.1 * X1 + 0.2 * X2 + 0.1 * X1 * X2 + U
)
M()

if(require("MASS")) {

  # We can draw correlated variables using draw_multivariate
  M &lt;-
  declare_model(
    draw_multivariate(c(X1, X2) ~ MASS::mvrnorm(
      n = 1000,
      mu = c(0, 0),
      Sigma = matrix(c(1, 0.3, 0.3, 1), nrow = 2)
    )))
  M()
  
}

# Declare potential outcomes model dependent on assignment Z
## Manually
M &lt;- 
  declare_model(N = 100, 
                Y_Z_0 = rbinom(N, size = 1, prob = 0.5),
                Y_Z_1 = rbinom(N, size = 1, prob = 0.6)
  )
M()

## Using potential_outcomes
M &lt;- 
  declare_model(N = 100, 
                potential_outcomes(Y ~ rbinom(N, size = 1, prob = 0.1 * Z + 0.5))
  )
M()
 
## we can draw from a distribution of effect sizes 
M &lt;-
  declare_model(
    N = 100, 
    tau = runif(1, min = 0, max = 1), 
    U = rnorm(N), 
    potential_outcomes(Y ~ tau * Z + U)
  )
M()

## we can simulate treatment-by-covariate effect heterogeneity:
M &lt;- 
  declare_model(
    N = 100, 
    U = rnorm(N), 
    X = rbinom(N, 1, prob = 0.5),
    potential_outcomes(Y ~  0.3 * Z + 0.2*X + 0.1*Z*X + U)
  )
M()

## potential outcomes can respond to two treatments:
M &lt;- declare_model(
  N = 6,
  U = rnorm(N),
  potential_outcomes(Y ~ Z1 + Z2 + U, 
                     conditions = list(Z1 = c(0, 1), Z2 = c(0, 1))))

M()

# Declare a two-level hierarchical population
# containing varying numbers of individuals within
# households and an age variable defined at the individual
# level
M &lt;- declare_model(
  households = add_level(
    N = 100, 
    N_members = sample(c(1, 2, 3, 4), N, 
                       prob = c(0.2, 0.3, 0.25, 0.25), 
                       replace = TRUE)
  ),
  individuals = add_level(
    N = N_members, 
    age = sample(18:90, N, replace = TRUE)
  )
)
M()

## Panel data have a more complex structure:
M &lt;- 
  declare_model(
    countries = add_level(
      N = 196, 
      country_shock = rnorm(N)
    ),
    years = add_level(
      N = 100, 
      time_trend = 1:N,
      year_shock = runif(N, 1, 10), 
      nest = FALSE
    ),
    observation = cross_levels(
      by = join_using(countries, years),
      observation_shock = rnorm(N),
      Y = 0.01 * time_trend + country_shock + year_shock + observation_shock 
    )
  )
M()

# Declare a population using a custom function
# the default handler is fabricatr::fabricate,
# but you can supply any function that returns a data.frame
my_model_function &lt;- function(N) {
  data.frame(u = rnorm(N))
}

M &lt;- declare_model(N = 10, handler = my_model_function)
M()

</code></pre>

<hr>
<h2 id='declare_population'>Declare the size and features of the population</h2><span id='topic+declare_population'></span>

<h3>Description</h3>

<p>Deprecated. Please use declare_model instead.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>declare_population(..., handler = fabricate, label = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="declare_population_+3A_...">...</code></td>
<td>
<p>arguments to be captured, and later passed to the handler</p>
</td></tr>
<tr><td><code id="declare_population_+3A_handler">handler</code></td>
<td>
<p>a tidy-in, tidy-out function</p>
</td></tr>
<tr><td><code id="declare_population_+3A_label">label</code></td>
<td>
<p>a string describing the step</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A potential outcomes declaration, which is a function that returns a data.frame.
</p>

<hr>
<h2 id='declare_potential_outcomes'>Declare potential outcomes</h2><span id='topic+declare_potential_outcomes'></span><span id='topic+potential_outcomes_internal.formula'></span><span id='topic+potential_outcomes_internal.NULL'></span>

<h3>Description</h3>

<p>Deprecated. Please use the potential_outcomes function within a declare_model declaration.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>declare_potential_outcomes(
  ...,
  handler = potential_outcomes_handler,
  label = NULL
)

potential_outcomes_internal.formula(
  formula,
  conditions = c(0, 1),
  assignment_variables = "Z",
  data,
  level = NULL,
  label = outcome_variable
)

potential_outcomes_internal.NULL(
  formula = stop("Not provided"),
  ...,
  data,
  level = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="declare_potential_outcomes_+3A_...">...</code></td>
<td>
<p>arguments to be captured, and later passed to the handler</p>
</td></tr>
<tr><td><code id="declare_potential_outcomes_+3A_handler">handler</code></td>
<td>
<p>a tidy-in, tidy-out function</p>
</td></tr>
<tr><td><code id="declare_potential_outcomes_+3A_label">label</code></td>
<td>
<p>a string describing the step</p>
</td></tr>
<tr><td><code id="declare_potential_outcomes_+3A_formula">formula</code></td>
<td>
<p>a formula to calculate potential outcomes as functions of assignment variables.</p>
</td></tr>
<tr><td><code id="declare_potential_outcomes_+3A_conditions">conditions</code></td>
<td>
<p>see <code><a href="#topic+expand_conditions">expand_conditions</a></code>. Provide values (e.g. <code>conditions = 1:4</code>) for a single assignment variable. If multiple assignment variables, provide named list (e.g. <code>conditions = list(Z1 = 0:1, Z2 = 0:1)</code>). Defaults to 0:1 if no conditions provided.</p>
</td></tr>
<tr><td><code id="declare_potential_outcomes_+3A_assignment_variables">assignment_variables</code></td>
<td>
<p>The name of the assignment variable. Generally not required as names are taken from <code>conditions</code>.</p>
</td></tr>
<tr><td><code id="declare_potential_outcomes_+3A_data">data</code></td>
<td>
<p>a data.frame</p>
</td></tr>
<tr><td><code id="declare_potential_outcomes_+3A_level">level</code></td>
<td>
<p>a character specifying a level of hierarchy for fabricate to calculate at</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a function that returns a data.frame
</p>

<hr>
<h2 id='declare_reveal'>Declare a reveal outcomes step</h2><span id='topic+declare_reveal'></span><span id='topic+declare_reveal_handler'></span>

<h3>Description</h3>

<p>Deprecated. Please use the <code>reveal_outcomes</code> function within a <code>declare_measurement</code> declaration.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>declare_reveal(..., handler = declare_reveal_handler, label = NULL)

declare_reveal_handler(
  data = NULL,
  outcome_variables = Y,
  assignment_variables = Z,
  attrition_variables = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="declare_reveal_+3A_...">...</code></td>
<td>
<p>arguments to be captured, and later passed to the handler</p>
</td></tr>
<tr><td><code id="declare_reveal_+3A_handler">handler</code></td>
<td>
<p>a tidy-in, tidy-out function</p>
</td></tr>
<tr><td><code id="declare_reveal_+3A_label">label</code></td>
<td>
<p>a string describing the step</p>
</td></tr>
<tr><td><code id="declare_reveal_+3A_data">data</code></td>
<td>
<p>A data.frame containing columns for assignment and potential outcomes.</p>
</td></tr>
<tr><td><code id="declare_reveal_+3A_outcome_variables">outcome_variables</code></td>
<td>
<p>The outcome prefix(es) of the potential outcomes.</p>
</td></tr>
<tr><td><code id="declare_reveal_+3A_assignment_variables">assignment_variables</code></td>
<td>
<p>Unquoted name(s) of the assignment variable(s).</p>
</td></tr>
<tr><td><code id="declare_reveal_+3A_attrition_variables">attrition_variables</code></td>
<td>
<p>Unquoted name of the attrition variable.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Potential outcomes declarations indicate what outcomes would obtain for different possible values of assignment variables. 
But realized outcomes need to be &quot;revealed.&quot; 
<code>declare_reveal</code> generates these realized outcomes using information on 
potential outcomes  (for instance generated via <code>declare_potential_outcomes</code>)  and the relevant 
assignment variables (for example created by <code>declare_assignment</code>). 
Revelation steps are usefully included after declaration of all assignments of conditions required to determine the realized outcome.
If a revelation is not declared, DeclareDesign will try to guess appropriate revelations. Explicit revelation is recommended however.
</p>
<p><code>declare_reveal</code> declares how outcomes should be realized.  
A &quot;revelation&quot; uses the random assignment to pluck out the correct potential outcomes (Gerber and Green 2012, Chapter 2).
Revelation requires that every named outcome variable is a function of every named assignment variable within a step. Thus if multiple outcome variables depend on different assignment variables, multiple revelations are needed.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
design &lt;- 
  declare_model(
    N = 100, 
    U = rnorm(N), 
    Y_Z_0 = U, 
    Y_Z_1 = U + rnorm(N, mean = 2, sd = 2)
  ) + 
  declare_assignment(Z = complete_ra(N, m = 50)) + 
  declare_measurement(Y = reveal_outcomes(Y ~ Z))
  
head(draw_data(design))

# Declaring multiple assignment variables or multiple outcome variables

design   &lt;- 
  declare_model(
    N = 10,
    potential_outcomes(Y1 ~ Z),
    potential_outcomes(Y2 ~ 1 + 2 * Z),
    potential_outcomes(Y3 ~ 1 - X * Z, conditions = list(X = 0:1, Z = 0:1))
  ) + 
  declare_assignment(Z = complete_ra(N)) + 
  declare_assignment(X = complete_ra(N)) + 
  declare_measurement(Y1 = reveal_outcomes(Y1 ~ Z), 
                      Y2 = reveal_outcomes(Y2 ~ Z),
                      Y3 = reveal_outcomes(Y3 ~ X + Z))
                      
head(draw_data(design))

design &lt;- 
  declare_model(
    N = 100, 
    age = sample(18:95, N, replace = TRUE),
    potential_outcomes(Y ~ .25 * Z + .01 * age * Z),
    potential_outcomes(R ~ rbinom(n = N, size = 1, prob = pnorm(Y_Z_0)))
  ) + 
  declare_assignment(Z = complete_ra(N, m = 25))
  declare_measurement(R = reveal_outcomes(R ~ Z),
                      Y = reveal_outcomes(Y ~ Z),
                      Y = ifelse(R == 1, Y, NA))
                      
head(draw_data(design))
</code></pre>

<hr>
<h2 id='declare_sampling'>Declare sampling procedure</h2><span id='topic+declare_sampling'></span><span id='topic+sampling_handler'></span>

<h3>Description</h3>

<p>Declare sampling procedure
</p>


<h3>Usage</h3>

<pre><code class='language-R'>declare_sampling(..., handler = sampling_handler, label = NULL)

sampling_handler(data, ..., legacy = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="declare_sampling_+3A_...">...</code></td>
<td>
<p>arguments to be captured, and later passed to the handler</p>
</td></tr>
<tr><td><code id="declare_sampling_+3A_handler">handler</code></td>
<td>
<p>a tidy-in, tidy-out function</p>
</td></tr>
<tr><td><code id="declare_sampling_+3A_label">label</code></td>
<td>
<p>a string describing the step</p>
</td></tr>
<tr><td><code id="declare_sampling_+3A_data">data</code></td>
<td>
<p>A data.frame.</p>
</td></tr>
<tr><td><code id="declare_sampling_+3A_legacy">legacy</code></td>
<td>
<p>Use the legacy randomizr functionality. This will be disabled in future; please use legacy = FALSE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A sampling declaration, which is a function that takes a data.frame as an argument and returns a data.frame subsetted to sampled observations and (optionally) augmented with inclusion probabilities and other quantities.
</p>


<h3>Examples</h3>

<pre><code class='language-R'> 
# declare_sampling in use
## Two-arm randomized experiment
design &lt;-
  declare_model(
    N = 500,
    X = rep(c(0, 1), each = N / 2),
    U = rnorm(N, sd = 0.25),
    potential_outcomes(Y ~ 0.2 * Z + X + U)
  ) +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_sampling(S = complete_rs(N = N, n = 200)) +
  declare_assignment(Z = complete_ra(N = N, m = 100)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) +
  declare_estimator(Y ~ Z, inquiry = "ATE")
  
run_design(design)

# Set up population to sample from
model &lt;- declare_model(
  villages = add_level(
    N = 30, 
    N_households = sample(c(50:100), N, replace = TRUE)
  ),
  households = add_level(
    N = N_households, 
    N_members = sample(c(1, 2, 3, 4), N, 
                       prob = c(0.2, 0.3, 0.25, 0.25), replace = TRUE)
  ),
  individuals = add_level(
    N = N_members, 
    age = sample(18:90, N, replace = TRUE),
    gender = rbinom(n = N, size = 1, prob = .5)
  )
)

# Sampling procedures
## Complete random sampling
design &lt;- model +
  declare_sampling(S = complete_rs(N = N, n = 1000))
  
head(draw_data(design))

## Cluster random sampling
design &lt;- model +
  declare_sampling(S = cluster_rs(clusters = villages, 
                                  n = 15))

head(draw_data(design))

## Strata and cluster random sampling
design &lt;- model +
  declare_sampling(S  = strata_and_cluster_rs(
    strata = villages,
    clusters = households,
    strata_n = rep(20, 30)))
    
head(draw_data(design))

## Stratified random sampling
design &lt;- model +
  declare_sampling(S = strata_rs(strata = gender, n = 100))

head(draw_data(design))

</code></pre>

<hr>
<h2 id='declare_step'>Declare a custom step</h2><span id='topic+declare_step'></span>

<h3>Description</h3>

<p>With declare_step, you can include any function that takes data as one of its arguments and returns data in a design declaration. The first argument is always a &quot;handler&quot;, which is the name of the data-in, data-out function.
For handy data manipulations use <code>declare_step(fabricate, ...)</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>declare_step(
  ...,
  handler = function(data, ...f, ...) ...f(data, ...),
  label = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="declare_step_+3A_...">...</code></td>
<td>
<p>arguments to be captured, and later passed to the handler</p>
</td></tr>
<tr><td><code id="declare_step_+3A_handler">handler</code></td>
<td>
<p>a tidy-in, tidy-out function</p>
</td></tr>
<tr><td><code id="declare_step_+3A_label">label</code></td>
<td>
<p>a string describing the step</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A function that returns a data.frame.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
population &lt;- declare_model(N = 5, noise = rnorm(N))
manipulate &lt;- declare_step(fabricate, noise_squared = noise^2, zero = 0)

design &lt;- population + manipulate
draw_data(design)

</code></pre>

<hr>
<h2 id='declare_test'>Declare test</h2><span id='topic+declare_test'></span><span id='topic+label_test'></span>

<h3>Description</h3>

<p>Declares an test which generates a test statistic and associated inferential statistics. 
</p>
<p>Use of <code>declare_test</code> is identical to use of <code><a href="#topic+declare_estimator">declare_estimator</a></code>. Use <code>declare_test</code> for hypothesis testing with no specific inquiry in mind; use <code>declare_estimator</code> for hypothesis testing when you can link each estimate to an inquiry. For example, <code>declare_test</code> could be used for a K-S test of distributional equality and <code>declare_estimator</code> for a difference-in-means estimate of an average treatment effect.
</p>
<p>See <code><a href="#topic+declare_estimator">declare_estimator</a></code> help for an explanation of how to use <code>method_handler</code>, which is used identically in both <code>declare_estimator</code> and <code>declare_test</code>. The main difference between <code>declare_estimator</code> and <code>declare_test</code> is that <code>declare_test</code> does not link with an explicit inquiry.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>declare_test(..., handler = label_test(method_handler), label = "test")

label_test(fn)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="declare_test_+3A_...">...</code></td>
<td>
<p>arguments to be captured, and later passed to the handler</p>
</td></tr>
<tr><td><code id="declare_test_+3A_handler">handler</code></td>
<td>
<p>a tidy-in, tidy-out function</p>
</td></tr>
<tr><td><code id="declare_test_+3A_label">label</code></td>
<td>
<p>a string describing the step</p>
</td></tr>
<tr><td><code id="declare_test_+3A_fn">fn</code></td>
<td>
<p>A function that takes a data.frame as an argument and returns a data.frame with test statistics as columns.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>label_test</code> takes a data-in-data out function to <code>fn</code>, and returns a data-in-data-out function that first runs the provided test function <code>fn</code> and then appends a label for the test.
</p>


<h3>Value</h3>

<p>A function that accepts a data.frame as an argument and returns a data.frame containing the value of the test statistic and other inferential statistics.
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+declare_estimator">declare_estimator</a></code> for documentation of the <code>method_handler</code> function.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Balance test F test

balance_test_design &lt;-
  declare_model(
    N = 100, 
    cov1 = rnorm(N), 
    cov2 = rnorm(N), 
    cov3 = rnorm(N)
  ) +
  declare_assignment(Z = complete_ra(N, prob = 0.2)) +
  declare_test(Z ~ cov1 + cov2 + cov3, .method = lm_robust, .summary = glance)
  
## Not run: 
diagnosis &lt;- diagnose_design(
  design = balance_test_design,
  diagnosands = declare_diagnosands(
  false_positive_rate = mean(p.value &lt;= 0.05))
)

## End(Not run)

# K-S test of distributional equality

ks_test &lt;- function(data) {
  test &lt;- with(data, ks.test(x = Y[Z == 1], y = Y[Z == 0]))
  data.frame(statistic = test$statistic, p.value = test$p.value)
}

distributional_equality_design &lt;-
  declare_model(
    N = 100, 
    Y_Z_1 = rnorm(N), 
    Y_Z_0 = rnorm(N, sd = 1.5)
  ) + 
  declare_assignment(Z = complete_ra(N, prob = 0.5)) + 
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) + 
  declare_test(handler = label_test(ks_test), label = "ks-test")
  
## Not run: 
diagnosis &lt;- diagnose_design(
  design = distributional_equality_design,
  diagnosands = declare_diagnosands(power = mean(p.value &lt;= 0.05))
) 

## End(Not run)

# Thanks to Jake Bowers for this example

if(require("coin")) {

  library(coin) 
  
  our_ttest &lt;- function(data) {
    res &lt;- coin::oneway_test(
      outcome ~ factor(Xclus),
      data = data,
      distribution = "asymptotic"
    )
    data.frame(p.value = pvalue(res)[[1]])
  }
  
  ttest_design &lt;- 
    declare_model(
      N = 100, 
      Xclus = rbinom(n = N, size = 1, prob = 0.2), 
      outcome = 3 + rnorm(N)) +
    declare_test(handler = label_test(our_ttest), label = "t-test")
    
  ## Not run: 
  diagnosis &lt;- diagnose_design(
    design = ttest_design,
    diagnosands = declare_diagnosands(
      false_positive_rate = mean(p.value &lt;= 0.05))
  )
  
## End(Not run)
  
}

</code></pre>

<hr>
<h2 id='DeclareDesign-deprecated'>Deprecated functions in package <span class="pkg">DeclareDesign</span>.</h2><span id='topic+DeclareDesign-deprecated'></span><span id='topic+tidy_estimator'></span><span id='topic+model_handler'></span>

<h3>Description</h3>

<p>The functions listed below are deprecated and will be defunct in
the near future. When possible, alternative functions with similar
functionality are also mentioned. Help pages for deprecated functions are
available at <code>help("-deprecated")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tidy_estimator(estimator_function)

model_handler(...)
</code></pre>


<h3><code>tidy_estimator</code></h3>

<p>For <code>tidy_estimator</code>, use <code><a href="#topic+label_estimator">label_estimator</a></code>.
</p>


<h3><code>model_handler</code></h3>

<p>For <code>model_handler</code>, use <code><a href="#topic+method_handler">method_handler</a></code>.
</p>

<hr>
<h2 id='diagnosand_handler'>Declare diagnosands</h2><span id='topic+diagnosand_handler'></span><span id='topic+declare_diagnosands'></span>

<h3>Description</h3>

<p>Declare diagnosands
</p>


<h3>Usage</h3>

<pre><code class='language-R'>diagnosand_handler(data, ..., subset = NULL, alpha = 0.05, label)

declare_diagnosands(..., handler = diagnosand_handler, label = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="diagnosand_handler_+3A_data">data</code></td>
<td>
<p>A data.frame.</p>
</td></tr>
<tr><td><code id="diagnosand_handler_+3A_...">...</code></td>
<td>
<p>A set of new diagnosands.</p>
</td></tr>
<tr><td><code id="diagnosand_handler_+3A_subset">subset</code></td>
<td>
<p>A subset of the simulations data frame within which to calculate diagnosands e.g. <code>subset = p.value &lt; .05</code>.</p>
</td></tr>
<tr><td><code id="diagnosand_handler_+3A_alpha">alpha</code></td>
<td>
<p>Alpha significance level. Defaults to <code>.05</code>.</p>
</td></tr>
<tr><td><code id="diagnosand_handler_+3A_label">label</code></td>
<td>
<p>Label for the set of diagnosands.</p>
</td></tr>
<tr><td><code id="diagnosand_handler_+3A_handler">handler</code></td>
<td>
<p>a tidy-in, tidy-out function</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If term is TRUE, the names of ... will be returned in a <code>term</code> column, and <code>inquiry</code>
will contain the step label. This can be used as an additional dimension for use in diagnosis.
</p>
<p>Diagnosands summarize the simulations generated by <code><a href="#topic+diagnose_design">diagnose_design</a></code> or <code><a href="#topic+simulate_design">simulate_design</a></code>. Typically, the columns of the resulting simulations data.frame include the following variables: estimate, std.error, p.value, conf.low, conf.high, and inquiry. Many diagnosands will be a function of these variables.
</p>


<h3>Value</h3>

<p>a function that returns a data.frame
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Two-arm randomized experiment
design &lt;-
  declare_model(
    N = 500,
    gender = rbinom(N, 1, 0.5),
    X = rep(c(0, 1), each = N / 2),
    U = rnorm(N, sd = 0.25),
    potential_outcomes(Y ~ 0.2 * Z + X + U)
  ) +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_sampling(S = complete_rs(N = N, n = 200)) +
  declare_assignment(Z = complete_ra(N = N, m = 100)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) +
  declare_estimator(Y ~ Z, inquiry = "ATE")

## Not run: 
# using built-in defaults:
diagnosis &lt;- diagnose_design(design)
diagnosis

# You can choose your own diagnosands instead of the defaults:

my_diagnosands &lt;-
  declare_diagnosands(median_bias = median(estimate - estimand))

## You can set diagnosands within the diagnose_design function
## using the 'diagnosands =' argument
diagnosis &lt;- diagnose_design(design, diagnosands = my_diagnosands)
diagnosis

## You can also set diagnosands with set_diagnosands 
design &lt;- set_diagnosands(design, diagnosands = my_diagnosands)
diagnosis &lt;- diagnose_design(design)
diagnosis

# If you do not specify diagnosands in diagnose_design, 
#   the function default_diagnosands() is used, 
#   which is reproduced below.

alpha &lt;- 0.05

default_diagnosands &lt;- 
  declare_diagnosands(
    mean_estimand = mean(estimand),
    mean_estimate = mean(estimate),
    bias = mean(estimate - estimand),
    sd_estimate = sqrt(pop.var(estimate)),
    rmse = sqrt(mean((estimate - estimand) ^ 2)),
    power = mean(p.value &lt;= alpha),
    coverage = mean(estimand &lt;= conf.high &amp; estimand &gt;= conf.low)
  )
  
diagnose_design(
  design,
  diagnosands = default_diagnosands
)

# A longer list of potentially useful diagnosands might include:

extended_diagnosands &lt;- 
  declare_diagnosands(
    mean_estimand = mean(estimand),
    mean_estimate = mean(estimate),
    bias = mean(estimate - estimand),
    sd_estimate = sd(estimate),
    rmse = sqrt(mean((estimate - estimand) ^ 2)),
    power = mean(p.value &lt;= alpha),
    coverage = mean(estimand &lt;= conf.high &amp; estimand &gt;= conf.low),
    mean_se = mean(std.error),
    type_s_rate = mean((sign(estimate) != sign(estimand))[p.value &lt;= alpha]),
    exaggeration_ratio = mean((estimate/estimand)[p.value &lt;= alpha]),
    var_estimate = pop.var(estimate),
    mean_var_hat = mean(std.error^2),
    prop_pos_sig = mean(estimate &gt; 0 &amp; p.value &lt;= alpha),
    mean_ci_length = mean(conf.high - conf.low)
  )
  
diagnose_design(
  design,
  diagnosands = extended_diagnosands
)

## End(Not run)
</code></pre>

<hr>
<h2 id='diagnose_design'>Diagnose the design</h2><span id='topic+diagnose_design'></span><span id='topic+diagnose_designs'></span><span id='topic+vars'></span>

<h3>Description</h3>

<p>Generates diagnosands from a design or simulations of a design. Speed gains can be achieved by running diagnose_design in parallel, see Examples.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>diagnose_design(
  ...,
  diagnosands = NULL,
  sims = 500,
  bootstrap_sims = 100,
  future.seed = requireNamespace("future", quietly = TRUE),
  make_groups = NULL,
  add_grouping_variables = NULL
)

diagnose_designs(
  ...,
  diagnosands = NULL,
  sims = 500,
  bootstrap_sims = 100,
  future.seed = requireNamespace("future", quietly = TRUE),
  make_groups = NULL,
  add_grouping_variables = NULL
)

vars(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="diagnose_design_+3A_...">...</code></td>
<td>
<p>A design or set of designs typically created using the + operator, or a <code>data.frame</code> of simulations, typically created by <code><a href="#topic+simulate_design">simulate_design</a></code>.</p>
</td></tr>
<tr><td><code id="diagnose_design_+3A_diagnosands">diagnosands</code></td>
<td>
<p>A set of diagnosands created by <code><a href="#topic+declare_diagnosands">declare_diagnosands</a></code>. By default, these include bias, root mean-squared error, power, frequentist coverage, the mean and standard deviation of the estimate(s), the &quot;type S&quot; error rate (Gelman and Carlin 2014), and the mean of the inquiry(s).</p>
</td></tr>
<tr><td><code id="diagnose_design_+3A_sims">sims</code></td>
<td>
<p>The number of simulations, defaulting to 500. sims may also be a vector indicating the number of simulations for each step in a design, as described for <code><a href="#topic+simulate_design">simulate_design</a></code></p>
</td></tr>
<tr><td><code id="diagnose_design_+3A_bootstrap_sims">bootstrap_sims</code></td>
<td>
<p>Number of bootstrap replicates for the diagnosands to obtain the standard errors of the diagnosands, defaulting to <code>100</code>. Set to FALSE to turn off bootstrapping.</p>
</td></tr>
<tr><td><code id="diagnose_design_+3A_future.seed">future.seed</code></td>
<td>
<p>Option for parallel diagnosis via the function future_lapply. A logical or an integer (of length one or seven), or a list of length(X) with pre-generated random seeds. By default, this is set to TRUE if the <code>future</code> and <code>future.apply</code> packages are installed, and FALSE if not. For details, see ?future_lapply.</p>
</td></tr>
<tr><td><code id="diagnose_design_+3A_make_groups">make_groups</code></td>
<td>
<p>Add group variables within which diagnosand values will be calculated. New variables can be created or variables already in the simulations data frame selected. Type name-value pairs within the function <code>vars</code>, i.e. <code>vars(significant = p.value &lt;= 0.05)</code>.</p>
</td></tr>
<tr><td><code id="diagnose_design_+3A_add_grouping_variables">add_grouping_variables</code></td>
<td>
<p>Deprecated. Please use make_groups instead. Variables used to generate groups of simulations for diagnosis. Added to default list: c(&quot;design&quot;, &quot;estimand_label&quot;, &quot;estimator&quot;, &quot;outcome&quot;, &quot;term&quot;)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If the diagnosand function contains a <code>group_by</code> attribute, it will be used to split-apply-combine diagnosands rather than the intersecting column names.
</p>
<p>If <code>sims</code> is named, or longer than one element, a fan-out strategy is created and used instead.
</p>
<p>If the packages <code>future</code> and <code>future.apply</code> are installed, you can set <code><a href="future.html#topic+plan">plan</a></code> to run multiple simulations in parallel.
</p>


<h3>Value</h3>

<p>a list with a data frame of simulations, a data frame of diagnosands, a vector of diagnosand names, and if calculated, a data frame of bootstrap replicates.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Two-arm randomized experiment
n &lt;- 500

design &lt;-
  declare_model(
    N = 1000,
    gender = rbinom(N, 1, 0.5),
    X = rep(c(0, 1), each = N / 2),
    U = rnorm(N, sd = 0.25),
    potential_outcomes(Y ~ 0.2 * Z + X + U)
  ) +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_sampling(S = complete_rs(N = N, n = n)) +
  declare_assignment(Z = complete_ra(N = N, m = n/2)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) +
  declare_estimator(Y ~ Z, inquiry = "ATE")

## Not run: 
# Diagnose design using default diagnosands
diagnosis &lt;- diagnose_design(design)
diagnosis

# Use tidy to produce data.frame with bootstrapped standard 
# errors and confidence intervals for each diagnosand
diagnosis_df &lt;- tidy(diagnosis)
diagnosis_df

# Use sims argument to change the number of simulations used 
# to calculate diagnosands, and bootstrap_sims to change how
# many bootstraps are uses to calculate standard errors.
diagnosis &lt;- diagnose_design(design,
                             sims = 100,
                             bootstrap_sims = 100)
tidy(diagnosis)

# You may also run diagnose_design in parallel using 
#   the future package on a personal computer with multiple
#   cores or on high performance computing clusters. 

library(future)
options(parallelly.fork.enable = TRUE) # required for use in RStudio
plan(multicore) # note other plans are possible, see future

diagnose_design(design)

# Select specific diagnosands
reshape_diagnosis(diagnosis, select = "Power")

# Use your own diagnosands
my_diagnosands &lt;-
  declare_diagnosands(median_bias = median(estimate - estimand),
                      absolute_error = mean(abs(estimate - estimand)))

diagnosis &lt;- diagnose_design(design, diagnosands = my_diagnosands)
diagnosis

get_diagnosands(diagnosis)

get_simulations(diagnosis)

# Diagnose using an existing data frame of simulations
simulations &lt;- simulate_design(design, sims = 100)
diagnosis   &lt;- diagnose_design(simulations_df = simulations)
diagnosis


## End(Not run)

# If you do not specify diagnosands, the function default_diagnosands() is used, 
#   which is reproduced below.

alpha &lt;- 0.05

default_diagnosands &lt;- 
  declare_diagnosands(
    mean_estimand = mean(estimand),
    mean_estimate = mean(estimate),
    bias = mean(estimate - estimand),
    sd_estimate = sqrt(pop.var(estimate)),
    rmse = sqrt(mean((estimate - estimand) ^ 2)),
    power = mean(p.value &lt;= alpha),
    coverage = mean(estimand &lt;= conf.high &amp; estimand &gt;= conf.low)
  )
  
diagnose_design(
  design, 
  diagnosands = default_diagnosands
)

# A longer list of useful diagnosands might include:

extended_diagnosands &lt;- 
  declare_diagnosands(
    mean_estimand = mean(estimand),
    mean_estimate = mean(estimate),
    bias = mean(estimate - estimand),
    sd_estimate = sd(estimate),
    rmse = sqrt(mean((estimate - estimand) ^ 2)),
    power = mean(p.value &lt;= alpha),
    coverage = mean(estimand &lt;= conf.high &amp; estimand &gt;= conf.low),
    mean_se = mean(std.error),
    type_s_rate = mean((sign(estimate) != sign(estimand))[p.value &lt;= alpha]),
    exaggeration_ratio = mean((estimate/estimand)[p.value &lt;= alpha]),
    var_estimate = pop.var(estimate),
    mean_var_hat = mean(std.error^2),
    prop_pos_sig = mean(estimate &gt; 0 &amp; p.value &lt;= alpha),
    mean_ci_length = mean(conf.high - conf.low)
  )
  
## Not run: 
diagnose_design(
  design, 
  diagnosands = extended_diagnosands
)

# Adding a group for within group diagnosis:
diagnosis &lt;- diagnose_design(design, 
                             make_groups = vars(significant = p.value &lt;= 0.05),
)
diagnosis

n &lt;- 500
design &lt;-
  declare_model(
    N = 1000,
    gender = rbinom(N, 1, 0.5),
    X = rep(c(0, 1), each = N / 2),
    U = rnorm(N, sd = 0.25),
    potential_outcomes(Y ~ rnorm(1) * Z + X + U)
  ) +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_sampling(S = complete_rs(N = N, n = n)) +
  declare_assignment(Z = complete_ra(N = N, m = n/2)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) +
  declare_estimator(Y ~ Z, inquiry = "ATE")

diagnosis &lt;- diagnose_design(design, 
                             make_groups = 
                               vars(effect_size = 
                                      cut(estimand, quantile(estimand, (0:4)/4), 
                                          include.lowest = TRUE)),
)
diagnosis

# redesign can be used in conjunction with diagnose_designs
# to optimize the design for specific diagnosands
design_vary_N &lt;- redesign(design, n = c(100, 500, 900))
diagnose_designs(design_vary_N)

# Calculate and plot the power of a design over a range of 
# effect sizes
design &lt;-
  declare_model(
    N = 200,
    U = rnorm(N),
    potential_outcomes(Y ~ runif(1, 0.0, 0.5) * Z + U)
  ) +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_assignment(Z = complete_ra(N)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) +
  declare_estimator(Y ~ Z, inquiry = "ATE") 

library(tidyverse)

simulations_df &lt;- 
  diagnose_design(design) |&gt; 
  get_simulations() |&gt; 
  mutate(significant = if_else(p.value &lt;= 0.05, 1, 0))

ggplot(simulations_df) + 
  stat_smooth(
    aes(estimand, significant), 
    method = 'loess', 
    color = "#3564ED", 
    fill = "#72B4F3", 
    formula = 'y ~ x'
  ) +
  geom_hline(
  yintercept = 0.8, color = "#C6227F", linetype = "dashed") +
  annotate("text", x = 0, y = 0.85, 
    label = "Conventional power threshold = 0.8", 
    hjust = 0, color = "#C6227F") + 
  scale_y_continuous(breaks = seq(0, 1, 0.2)) +
  coord_cartesian(ylim = c(0, 1)) +
  theme(legend.position = "none") +
  labs(x = "Model parameter: true effect size",
       y = "Diagnosand: statistical power") +
  theme_minimal()

## End(Not run)

</code></pre>

<hr>
<h2 id='diagnosis_helpers'>Explore your design diagnosis</h2><span id='topic+diagnosis_helpers'></span><span id='topic+get_diagnosands'></span><span id='topic+get_simulations'></span>

<h3>Description</h3>

<p>Explore your design diagnosis
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_diagnosands(diagnosis)

get_simulations(diagnosis)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="diagnosis_helpers_+3A_diagnosis">diagnosis</code></td>
<td>
<p>A design diagnosis created by <code><a href="#topic+diagnose_design">diagnose_design</a></code>.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
# Two-arm randomized experiment
design &lt;-
  declare_model(
    N = 500,
    gender = rbinom(N, 1, 0.5),
    X = rep(c(0, 1), each = N / 2),
    U = rnorm(N, sd = 0.25),
    potential_outcomes(Y ~ 0.2 * Z + X + U)
  ) +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_sampling(S = complete_rs(N = N, n = 200)) +
  declare_assignment(Z = complete_ra(N = N, m = 100)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) +
  declare_estimator(Y ~ Z, inquiry = "ATE")

## Not run: 
# Diagnose design using default diagnosands
diagnosis &lt;- diagnose_design(design)
diagnosis

# Use get_diagnosands to explore diagnosands:
get_diagnosands(diagnosis)

# Use get_simulations to explore simulations
get_simulations(diagnosis)

# Exploring user-defined diagnosis your own diagnosands
my_diagnosands &lt;-
  declare_diagnosands(median_bias = median(estimate - estimand),
                      absolute_error = mean(abs(estimate - estimand)))

diagnosis &lt;- diagnose_design(design, diagnosands = my_diagnosands)
diagnosis

tidy(diagnosis)

reshape_diagnosis(diagnosis)

get_diagnosands(diagnosis)

get_simulations(diagnosis)


## End(Not run)

</code></pre>

<hr>
<h2 id='draw_functions'>Draw data, estimates, and inquiries from a design</h2><span id='topic+draw_functions'></span><span id='topic+draw_data'></span><span id='topic+draw_estimand'></span><span id='topic+draw_estimands'></span><span id='topic+draw_estimates'></span>

<h3>Description</h3>

<p>Draw data, estimates, and inquiries from a design
</p>


<h3>Usage</h3>

<pre><code class='language-R'>draw_data(design, data = NULL, start = 1, end = length(design))

draw_estimand(...)

draw_estimands(...)

draw_estimates(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="draw_functions_+3A_design">design</code></td>
<td>
<p>A design object, typically created using the + operator</p>
</td></tr>
<tr><td><code id="draw_functions_+3A_data">data</code></td>
<td>
<p>A data.frame object with sufficient information to get the data, estimates, inquiries, an assignment vector, or a sample.</p>
</td></tr>
<tr><td><code id="draw_functions_+3A_start">start</code></td>
<td>
<p>(Defaults to 1) a scalar indicating which step in the design to begin with. By default all data steps are drawn, from step 1 to the last step of the design.</p>
</td></tr>
<tr><td><code id="draw_functions_+3A_end">end</code></td>
<td>
<p>(Defaults to <code>length(design)</code>) a scalar indicating which step in the design to finish drawing data by.</p>
</td></tr>
<tr><td><code id="draw_functions_+3A_...">...</code></td>
<td>
<p>A design or set of designs typically created using the + operator</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
# Two-arm randomized experiment
design &lt;-
  declare_model(
    N = 500,
    gender = rbinom(N, 1, 0.5),
    X = rep(c(0, 1), each = N / 2),
    U = rnorm(N, sd = 0.25),
    potential_outcomes(Y ~ 0.2 * Z + X + U)
  ) +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_sampling(S = complete_rs(N = N, n = 200)) +
  declare_assignment(Z = complete_ra(N = N, m = 100)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) +
  declare_estimator(Y ~ Z, inquiry = "ATE")

# Use draw_data to create a dataset using a design
dat &lt;- draw_data(design)

# Use end argument to draw data up to a certain design component
dat_no_sampling &lt;- draw_data(design, end = 3)

# Use draw_estimands to extract value of inquiry
draw_estimands(design)

# Use draw_estimates to extract value of estimator
draw_estimates(design)

</code></pre>

<hr>
<h2 id='expand_conditions'>Expand assignment conditions</h2><span id='topic+expand_conditions'></span>

<h3>Description</h3>

<p>Internal helper to eagerly build assignment conditions for potential outcomes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expand_conditions(
  formula,
  conditions = c(0, 1),
  assignment_variables = "Z",
  data,
  level = NULL,
  label = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="expand_conditions_+3A_conditions">conditions</code></td>
<td>
<p>the conditions</p>
</td></tr>
<tr><td><code id="expand_conditions_+3A_assignment_variables">assignment_variables</code></td>
<td>
<p>the name of assignment variables, if conditions is not already named.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If conditions is a data.frame, it is returned unchanged
</p>
<p>Otherwise, if conditions is a list, it is passed to expand.grid for expansion to a data.frame
</p>
<p>Otherwise, if condition is something else, box it in a list with assignment_variables for names,
and pass that to expand.grid.
</p>


<h3>Value</h3>

<p>a data.frame of potential outcome conditions
</p>

<hr>
<h2 id='expand_design'>Declare a design via a designer</h2><span id='topic+expand_design'></span>

<h3>Description</h3>

<p><code>expand_design</code> easily generates a set of design from a designer function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expand_design(designer, ..., expand = TRUE, prefix = "design")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="expand_design_+3A_designer">designer</code></td>
<td>
<p>a function which yields a design</p>
</td></tr>
<tr><td><code id="expand_design_+3A_...">...</code></td>
<td>
<p>Options sent to the designer</p>
</td></tr>
<tr><td><code id="expand_design_+3A_expand">expand</code></td>
<td>
<p>boolean - if true, form the crossproduct of the ..., otherwise recycle them</p>
</td></tr>
<tr><td><code id="expand_design_+3A_prefix">prefix</code></td>
<td>
<p>prefix for the names of the designs, i.e. if you create two designs they would be named prefix_1, prefix_2</p>
</td></tr>
</table>


<h3>Value</h3>

<p>if set of designs is size one, the design, otherwise a 'by'-list of designs. Designs are given a parameters attribute with the values of parameters assigned by expand_design.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 

# in conjunction with DesignLibrary

library(DesignLibrary)

designs &lt;- expand_design(multi_arm_designer, outcome_means = list(c(3,2,4), c(1,4,1)))

diagnose_design(designs)

# with a custom designer function

designer &lt;- function(N) {
  design &lt;- 
    declare_model(
      N = N, 
      U = rnorm(N),
      potential_outcomes(Y ~ 0.20 * Z + U)
    ) + 
    declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) + 
    declare_assignment(Z = complete_ra(N, m = N/2)) + 
    declare_measurement(Y = reveal_outcomes(Y ~ Z)) + 
    declare_estimator(Y ~ Z, inquiry = "ATE")
  return(design)
}

# returns list of eight designs
designs &lt;- expand_design(designer, N = seq(30, 100, 10))

# diagnose a list of designs created by expand_design or redesign
diagnosis &lt;- diagnose_design(designs, sims = 50)

# returns a single design
large_design &lt;- expand_design(designer, N = 200)

diagnose_large_design &lt;- diagnose_design(large_design, sims = 50)


## End(Not run)

</code></pre>

<hr>
<h2 id='get_functions'>Get estimates, inquiries, assignment vectors, or samples from a design given data</h2><span id='topic+get_functions'></span><span id='topic+get_estimates'></span>

<h3>Description</h3>

<p>Get estimates, inquiries, assignment vectors, or samples from a design given data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_estimates(design, data = NULL, start = 1, end = length(design))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_functions_+3A_design">design</code></td>
<td>
<p>A design object, typically created using the + operator</p>
</td></tr>
<tr><td><code id="get_functions_+3A_data">data</code></td>
<td>
<p>A data.frame object with sufficient information to get the data, estimates, inquiries, an assignment vector, or a sample.</p>
</td></tr>
<tr><td><code id="get_functions_+3A_start">start</code></td>
<td>
<p>(Defaults to 1) a scalar indicating which step in the design to begin with. By default all data steps are drawn, from step 1 to the last step of the design.</p>
</td></tr>
<tr><td><code id="get_functions_+3A_end">end</code></td>
<td>
<p>(Defaults to <code>length(design)</code>) a scalar indicating which step in the design to finish with.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
design &lt;- 
  declare_model(
    N = 100, 
    U = rnorm(N),
    potential_outcomes(Y ~ Z + U)
  ) +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_sampling(S = complete_rs(N, n = 75)) +
  declare_assignment(Z = complete_ra(N, m = 50)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) +
  declare_estimator(Y ~ Z, inquiry = "ATE")

dat &lt;- draw_data(design)

draw_data(design, data = dat, start = 2)

get_estimates(design, data = dat)

</code></pre>

<hr>
<h2 id='modify_design'>Modify a design after the fact</h2><span id='topic+modify_design'></span><span id='topic+insert_step'></span><span id='topic+delete_step'></span><span id='topic+replace_step'></span>

<h3>Description</h3>

<p>Insert, delete and replace steps in an (already declared) design object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>insert_step(design, new_step, before, after)

delete_step(design, step)

replace_step(design, step, new_step)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="modify_design_+3A_design">design</code></td>
<td>
<p>A design object, usually created using the + operator, <code><a href="#topic+expand_design">expand_design</a></code>, or the design library.</p>
</td></tr>
<tr><td><code id="modify_design_+3A_new_step">new_step</code></td>
<td>
<p>The new step; Either a function or a partial call.</p>
</td></tr>
<tr><td><code id="modify_design_+3A_before">before</code></td>
<td>
<p>The step before which to add steps.</p>
</td></tr>
<tr><td><code id="modify_design_+3A_after">after</code></td>
<td>
<p>The step after which to add steps.</p>
</td></tr>
<tr><td><code id="modify_design_+3A_step">step</code></td>
<td>
<p>The quoted label of the step to be deleted or replaced.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code><a href="#topic+modify_design">modify_design</a></code> for details.
</p>


<h3>Value</h3>

<p>A new design object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 my_model &lt;- 
   declare_model(
     N = 100, 
     U = rnorm(N),
     Y_Z_0 = U,
     Y_Z_1 = U + rnorm(N, mean = 2, sd = 2)
   )

 my_assignment &lt;- declare_assignment(Z = complete_ra(N, m = 50))
 my_assignment_2 &lt;- declare_assignment(Z = complete_ra(N, m = 25))

 design &lt;- my_model + my_assignment

 draw_data(design)
 
 design_modified &lt;- replace_step(design, 2, my_assignment_2)
 
 draw_data(design)
 
 ## Not run: 
 
 design &lt;- 
   declare_model(
     N = 100,
     U = rnorm(N),
     potential_outcomes(Y ~ 0.20 * Z + U)
   ) + 
     declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) + 
     declare_assignment(Z = complete_ra(N, m = N/2)) + 
     declare_measurement(Y = reveal_outcomes(Y ~ Z)) + 
     declare_estimator(Y ~ Z, inquiry = "ATE")
 
 insert_step(design, declare_sampling(S = complete_rs(N, n = 50)),
             after = 1)

 # If you are using a design created by a designer, for example from
 #   the DesignLibrary package, you will not have access to the step
 #   objects. Instead, you can always use the label of the step.
 
 design &lt;- DesignLibrary::two_arm_designer()
 
 # get the labels for the steps
 names(design)
 
 insert_step(design, 
   declare_sampling(S = complete_rs(N, n = 50)),
   after = "potential_outcomes")
   
 
## End(Not run)


design &lt;- 
  declare_model(
    N = 100,
    U = rnorm(N),
    potential_outcomes(Y ~ 0.20 * Z + U)
  ) + 
    declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) + 
    declare_assignment(Z = complete_ra(N, m = N/2)) + 
    declare_measurement(Y = reveal_outcomes(Y ~ Z)) + 
    declare_estimator(Y ~ Z, inquiry = "ATE")
delete_step(design, step = 5)


design &lt;- 
  declare_model(
    N = 100,
    U = rnorm(N),
    potential_outcomes(Y ~ 0.20 * Z + U)
  ) + 
    declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) + 
    declare_assignment(Z = complete_ra(N, m = N/2)) + 
    declare_measurement(Y = reveal_outcomes(Y ~ Z)) + 
    declare_estimator(Y ~ Z, inquiry = "ATE")

replace_step(
  design, 
  step = 3, 
  new_step = declare_assignment(Z = simple_ra(N, prob = 0.5)))
</code></pre>

<hr>
<h2 id='pop.var'>Population variance function</h2><span id='topic+pop.var'></span>

<h3>Description</h3>

<p>Population variance function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pop.var(x, na.rm = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pop.var_+3A_x">x</code></td>
<td>
<p>a numeric vector, matrix or data frame.</p>
</td></tr>
<tr><td><code id="pop.var_+3A_na.rm">na.rm</code></td>
<td>
<p>logical. Should missing values be removed?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>numeric scalar of the population variance
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
x &lt;- 1:4
var(x) # divides by (n-1)
pop.var(x) # divides by n


</code></pre>

<hr>
<h2 id='post_design'>Explore your design</h2><span id='topic+post_design'></span><span id='topic+print_code'></span><span id='topic+print.design'></span><span id='topic+summary.design'></span>

<h3>Description</h3>

<p>Explore your design
</p>
<p>Print code to recreate a design
</p>


<h3>Usage</h3>

<pre><code class='language-R'>print_code(design)

## S3 method for class 'design'
print(x, verbose = FALSE, ...)

## S3 method for class 'design'
summary(object, verbose = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="post_design_+3A_design">design</code></td>
<td>
<p>A design object, typically created using the + operator</p>
</td></tr>
<tr><td><code id="post_design_+3A_x">x</code></td>
<td>
<p>a design object, typically created using the + operator</p>
</td></tr>
<tr><td><code id="post_design_+3A_verbose">verbose</code></td>
<td>
<p>an indicator for printing a long summary of the design, defaults to <code>TRUE</code></p>
</td></tr>
<tr><td><code id="post_design_+3A_...">...</code></td>
<td>
<p>optional arguments to be sent to summary function</p>
</td></tr>
<tr><td><code id="post_design_+3A_object">object</code></td>
<td>
<p>a design object created using the + operator</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
# Two-arm randomized experiment
design &lt;-
  declare_model(
    N = 500,
    gender = rbinom(N, 1, 0.5),
    X = rep(c(0, 1), each = N / 2),
    U = rnorm(N, sd = 0.25),
    potential_outcomes(Y ~ 0.2 * Z + X + U)
  ) +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_sampling(S = complete_rs(N = N, n = 200)) +
  declare_assignment(Z = complete_ra(N = N, m = 100)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) +
  declare_estimator(Y ~ Z, inquiry = "ATE")

# Use draw_data to create a dataset using a design
dat &lt;- draw_data(design)

draw_data(design, data = dat, start = 2)

# Apply get_estimates
get_estimates(design, data = dat)


# Two-arm randomized experiment
design &lt;-
  declare_model(
    N = 500,
    gender = rbinom(N, 1, 0.5),
    X = rep(c(0, 1), each = N / 2),
    U = rnorm(N, sd = 0.25),
    potential_outcomes(Y ~ 0.2 * Z + X + U)
  ) +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_sampling(S = complete_rs(N = N, n = 200)) +
  declare_assignment(Z = complete_ra(N = N, m = 100)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) +
  declare_estimator(Y ~ Z, inquiry = "ATE")

print_code(design)

summary(design)


design &lt;- 
  declare_model(
    N = 500, 
    noise = rnorm(N),
    Y_Z_0 = noise, 
    Y_Z_1 = noise + rnorm(N, mean = 2, sd = 2)
  ) + 
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) + 
  declare_sampling(S = complete_rs(N, n = 250)) + 
  declare_assignment(Z = complete_ra(N, m = 25)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) + 
  declare_estimator(Y ~ Z, inquiry = "ATE") 

summary(design)
</code></pre>

<hr>
<h2 id='redesign'>Redesign</h2><span id='topic+redesign'></span>

<h3>Description</h3>

<p><code>redesign</code> quickly generates a design from an existing one by resetting symbols used in design handler parameters in a step's environment (Advanced).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>redesign(design, ..., expand = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="redesign_+3A_design">design</code></td>
<td>
<p>An object of class design.</p>
</td></tr>
<tr><td><code id="redesign_+3A_...">...</code></td>
<td>
<p>Arguments to redesign e.g., <code>n = 100.</code> If redesigning multiple arguments, they must be specified as a named list.</p>
</td></tr>
<tr><td><code id="redesign_+3A_expand">expand</code></td>
<td>
<p>If TRUE, redesign using the crossproduct of <code>...</code>, otherwise recycle them.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Warning: <code>redesign</code> will edit any symbol in your design, but if the symbol you attempt to change does not exist in a step's environment no changes will be made and no error or warning will be issued. 
</p>
<p>Please note that <code>redesign</code> functionality is experimental and may be changed in future versions.
</p>


<h3>Value</h3>

<p>A design, or, in the case of multiple values being passed onto <code>...</code>, a 'by'-list of designs.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Two-arm randomized experiment
n &lt;- 500

design &lt;-
  declare_model(
    N = 1000,
    gender = rbinom(N, 1, 0.5),
    X = rep(c(0, 1), each = N / 2),
    U = rnorm(N, sd = 0.25),
    potential_outcomes(Y ~ 0.2 * Z + X + U)
  ) +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_sampling(S = complete_rs(N = N, n = n)) +
  declare_assignment(Z = complete_ra(N = N, m = n/2)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) +
  declare_estimator(Y ~ Z, inquiry = "ATE")

# Use redesign to return a single modified design
modified_design &lt;- redesign(design, n = 200)

# Use redesign to return a series of modified designs
## Sample size is varied while the rest of the design remains
## constant
design_vary_N &lt;- redesign(design, n = c(100, 500, 900))

## Not run: 
# redesign can be used in conjunction with diagnose_designs
# to optimize the design for specific diagnosands
diagnose_designs(design_vary_N)

## End(Not run)

# When redesigning with arguments that are vectors,
# use list() in redesign, with each list item
# representing a design you wish to create

prob_each &lt;- c(.1, .5, .4)

population &lt;- declare_model(N = 1000)
assignment &lt;- declare_assignment(
  Z = complete_ra(prob_each = prob_each), 
  legacy = FALSE)

design &lt;- population + assignment

## returns two designs

designs_vary_prob_each &lt;- redesign(
  design,
  prob_each = list(c(.2, .5, .3), c(0, .5, .5)))

# To illustrate what does and does not get edited by redesign, 
# consider the following three designs. In the first two, argument
# X is called from the step's environment; in the third it is not.
# Using redesign will alter the role of X in the first two designs
# but not the third one.

X &lt;- 3
f &lt;- function(b, X) b*X
g &lt;- function(b) b*X

design1 &lt;- declare_model(N = 1, A = X)       + NULL
design2 &lt;- declare_model(N = 1, A = f(2, X)) + NULL
design3 &lt;- declare_model(N = 1, A = g(2))    + NULL

draw_data(design1)
draw_data(design2)
draw_data(design3)

draw_data(redesign(design1, X=0))
draw_data(redesign(design2, X=0))
draw_data(redesign(design3, X=0))

</code></pre>

<hr>
<h2 id='reexports'>Objects exported from other packages</h2><span id='topic+reexports'></span><span id='topic+tidy'></span>

<h3>Description</h3>

<p>These objects are imported from other packages. Follow the links
below to see their documentation.
</p>

<dl>
<dt>generics</dt><dd><p><code><a href="generics.html#topic+tidy">tidy</a></code>, <code><a href="generics.html#topic+tidy">tidy</a></code></p>
</dd>
</dl>

<hr>
<h2 id='reshape_diagnosis'>Clean up a diagnosis object for printing</h2><span id='topic+reshape_diagnosis'></span>

<h3>Description</h3>

<p>Take a diagnosis object and returns a pretty output table. If diagnosands are bootstrapped, se's are put in parentheses on a second line and rounded to <code>digits</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>reshape_diagnosis(diagnosis, digits = 2, select = NULL, exclude = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="reshape_diagnosis_+3A_diagnosis">diagnosis</code></td>
<td>
<p>A diagnosis object generated by <code>diagnose_design</code>.</p>
</td></tr>
<tr><td><code id="reshape_diagnosis_+3A_digits">digits</code></td>
<td>
<p>Number of digits.</p>
</td></tr>
<tr><td><code id="reshape_diagnosis_+3A_select">select</code></td>
<td>
<p>List of columns to include in output. Defaults to all.</p>
</td></tr>
<tr><td><code id="reshape_diagnosis_+3A_exclude">exclude</code></td>
<td>
<p>Set of columns to exclude from output. Defaults to none.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A formatted text table with bootstrapped standard errors in parentheses.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Two-arm randomized experiment
design &lt;-
  declare_model(
    N = 500,
    gender = rbinom(N, 1, 0.5),
    X = rep(c(0, 1), each = N / 2),
    U = rnorm(N, sd = 0.25),
    potential_outcomes(Y ~ 0.2 * Z + X + U)
  ) +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_sampling(S = complete_rs(N = N, n = 200)) +
  declare_assignment(Z = complete_ra(N = N, m = 100)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) +
  declare_estimator(Y ~ Z, inquiry = "ATE")

## Not run: 
# Diagnose design using default diagnosands
diagnosis &lt;- diagnose_design(design)
diagnosis

# Return diagnosis output table
reshape_diagnosis(diagnosis)

# Return table with subset of diagnosands
reshape_diagnosis(diagnosis, select = c("Bias", "Power"))

# With user-defined diagnosands
my_diagnosands &lt;-
  declare_diagnosands(median_bias = median(estimate - estimand),
                      absolute_error = mean(abs(estimate - estimand)))

diagnosis &lt;- diagnose_design(design, diagnosands = my_diagnosands)
diagnosis

reshape_diagnosis(diagnosis)

reshape_diagnosis(diagnosis, select = "Absolute Error")

# Alternative: Use tidy to produce data.frame with results of 
# diagnosis including bootstrapped standard errors and 
# confidence intervals for each diagnosand
diagnosis_df &lt;- tidy(diagnosis)
diagnosis_df


## End(Not run)
</code></pre>

<hr>
<h2 id='run_design'>Run a design one time</h2><span id='topic+run_design'></span>

<h3>Description</h3>

<p>Run a design one time
</p>


<h3>Usage</h3>

<pre><code class='language-R'>run_design(design)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="run_design_+3A_design">design</code></td>
<td>
<p>a DeclareDesign object</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
# Two-arm randomized experiment
design &lt;-
  declare_model(
    N = 500,
    gender = rbinom(N, 1, 0.5),
    X = rep(c(0, 1), each = N / 2),
    U = rnorm(N, sd = 0.25),
    potential_outcomes(Y ~ 0.2 * Z + X + U)
  ) +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_sampling(S = complete_rs(N = N, n = 200)) +
  declare_assignment(Z = complete_ra(N = N, m = 100)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) +
  declare_estimator(Y ~ Z, inquiry = "ATE")

# Use run_design to run a design object
run_design(design)

</code></pre>

<hr>
<h2 id='set_citation'>Set the citation of a design</h2><span id='topic+set_citation'></span>

<h3>Description</h3>

<p>Set the citation of a design
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_citation(
  design,
  title = NULL,
  author = NULL,
  year = NULL,
  description = "Unpublished research design declaration",
  citation = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_citation_+3A_design">design</code></td>
<td>
<p>A design typically created using the + operator</p>
</td></tr>
<tr><td><code id="set_citation_+3A_title">title</code></td>
<td>
<p>The title of the design, as a character string.</p>
</td></tr>
<tr><td><code id="set_citation_+3A_author">author</code></td>
<td>
<p>The author(s) of the design, as a character string.</p>
</td></tr>
<tr><td><code id="set_citation_+3A_year">year</code></td>
<td>
<p>The year of the design, as a character string.</p>
</td></tr>
<tr><td><code id="set_citation_+3A_description">description</code></td>
<td>
<p>A description of the design in words, as a character string.</p>
</td></tr>
<tr><td><code id="set_citation_+3A_citation">citation</code></td>
<td>
<p>(optional) The preferred citation for the design, as a character string, in which case title, author, year, and description may be left unspecified.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a design object with a citation attribute
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Setup for example
design &lt;-
  declare_model(data = sleep) +
  declare_sampling(S = complete_rs(N, n = 10))

# Set citation using set_citation
design &lt;-
  set_citation(design,
               author = "Lovelace, Ada",
               title = "Notes",
               year = 1953,
               description = 
                 "This is a text description of a design")

# View citation information using cite_design
cite_design(design)

</code></pre>

<hr>
<h2 id='set_diagnosands'>Set the diagnosands for a design</h2><span id='topic+set_diagnosands'></span>

<h3>Description</h3>

<p>A researcher often has a set of diagnosands in mind to appropriately assess the quality of a design. <code>set_diagnosands</code> sets the default diagnosands for a design, so that later readers can assess the design on the same terms as the original author. Readers can also use <code>diagnose_design</code> to diagnose the design using any other set of diagnosands.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_diagnosands(x, diagnosands = default_diagnosands)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_diagnosands_+3A_x">x</code></td>
<td>
<p>A design typically created using the + operator, or a simulations data.frame created by <code>simulate_design</code>.</p>
</td></tr>
<tr><td><code id="set_diagnosands_+3A_diagnosands">diagnosands</code></td>
<td>
<p>A set of diagnosands created by <code><a href="#topic+declare_diagnosands">declare_diagnosands</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>a design object with a diagnosand attribute
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Two-arm randomized experiment
design &lt;-
  declare_model(
    N = 500,
    gender = rbinom(N, 1, 0.5),
    X = rep(c(0, 1), each = N / 2),
    U = rnorm(N, sd = 0.25),
    potential_outcomes(Y ~ 0.2 * Z + X + U)
  ) +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_sampling(S = complete_rs(N = N, n = 200)) +
  declare_assignment(Z = complete_ra(N = N, m = 100)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) +
  declare_estimator(Y ~ Z, inquiry = "ATE")

# You can choose your own diagnosands instead of the defaults:

my_diagnosands &lt;-
  declare_diagnosands(median_bias = median(estimate - estimand))

## Not run: 
## You can set diagnosands with set_diagnosands 
design &lt;- set_diagnosands(design, diagnosands = my_diagnosands)
diagnosis &lt;- diagnose_design(design)
diagnosis

## Using set_diagnosands to diagnose simulated data
simulations_df &lt;- simulate_design(design)

simulations_df &lt;- set_diagnosands(simulations_df, my_diagnosands)

diagnose_design(simulations_df)

# If you do not specify diagnosands in diagnose_design, 
#   the function default_diagnosands() is used, 
#   which is reproduced below.

alpha &lt;- 0.05

default_diagnosands &lt;- 
  declare_diagnosands(
    mean_estimand = mean(estimand),
    mean_estimate = mean(estimate),
    bias = mean(estimate - estimand),
    sd_estimate = sqrt(pop.var(estimate)),
    rmse = sqrt(mean((estimate - estimand) ^ 2)),
    power = mean(p.value &lt;= alpha),
    coverage = mean(estimand &lt;= conf.high &amp; estimand &gt;= conf.low)
  )
  
diagnose_design(
  simulations_df,
  diagnosands = default_diagnosands
)

# A longer list of potentially useful diagnosands might include:

extended_diagnosands &lt;- 
  declare_diagnosands(
    mean_estimand = mean(estimand),
    mean_estimate = mean(estimate),
    bias = mean(estimate - estimand),
    sd_estimate = sd(estimate),
    rmse = sqrt(mean((estimate - estimand) ^ 2)),
    power = mean(p.value &lt;= alpha),
    coverage = mean(estimand &lt;= conf.high &amp; estimand &gt;= conf.low),
    mean_se = mean(std.error),
    type_s_rate = mean((sign(estimate) != sign(estimand))[p.value &lt;= alpha]),
    exaggeration_ratio = mean((estimate/estimand)[p.value &lt;= alpha]),
    var_estimate = pop.var(estimate),
    mean_var_hat = mean(std.error^2),
    prop_pos_sig = mean(estimate &gt; 0 &amp; p.value &lt;= alpha),
    mean_ci_length = mean(conf.high - conf.low)
  )
  
diagnose_design(
  simulations_df,
  diagnosands = extended_diagnosands
)


## End(Not run)
</code></pre>

<hr>
<h2 id='simulate_design'>Simulate a design</h2><span id='topic+simulate_design'></span><span id='topic+simulate_designs'></span>

<h3>Description</h3>

<p>Runs many simulations of a design and returns a simulations data.frame. Speed gains can be achieved by running simulate_design in parallel, see Examples.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simulate_design(
  ...,
  sims = 500,
  future.seed = requireNamespace("future", quietly = TRUE)
)

simulate_designs(
  ...,
  sims = 500,
  future.seed = requireNamespace("future", quietly = TRUE)
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="simulate_design_+3A_...">...</code></td>
<td>
<p>A design created using the + operator, or a set of designs. You can also provide a single list of designs, for example one created by <code><a href="#topic+expand_design">expand_design</a></code>.</p>
</td></tr>
<tr><td><code id="simulate_design_+3A_sims">sims</code></td>
<td>
<p>The number of simulations, defaulting to 500. If sims is a vector of the form c(10, 1, 2, 1) then different steps of a design will be simulated different numbers of times.</p>
</td></tr>
<tr><td><code id="simulate_design_+3A_future.seed">future.seed</code></td>
<td>
<p>Option for parallel diagnosis via the function future_lapply. A logical or an integer (of length one or seven), or a list of length(X) with pre-generated random seeds. By default, this is set to TRUE if the <code>future</code> and <code>future.apply</code> packages are installed, and FALSE if not. For details, see ?future_lapply.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Different steps of a design may each be simulated different a number of times, as specified by sims. In this case simulations are grouped into &quot;fans&quot;. The nested 
structure of simulations is recorded in the dataset using a set of variables named &quot;step_x_draw.&quot; For example if sims = c(2,1,1,3) is passed to simulate_design, then there
will be two distinct draws of step 1, indicated in variable &quot;step_1_draw&quot; (with values 1 and 2) and there will be three draws for step 4 within each of the step 1 draws, recorded in &quot;step_4_draw&quot; (with values 1 to 6).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Two-arm randomized experiment
design &lt;-
  declare_model(
    N = 500,
    gender = rbinom(N, 1, 0.5),
    X = rep(c(0, 1), each = N / 2),
    U = rnorm(N, sd = 0.25),
    potential_outcomes(Y ~ 0.2 * Z + X + U)
  ) +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_sampling(S = complete_rs(N = N, n = 200)) +
  declare_assignment(Z = complete_ra(N = N, m = 100)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) +
  declare_estimator(Y ~ Z, inquiry = "ATE")

## Not run: 
# Simulate design
simulations &lt;- simulate_design(design, sims = 100)
simulations

# Diagnose design using simulations
diagnosis &lt;- diagnose_design(simulations_df = simulations)
diagnosis

# Simulate one part of the design for a fixed population
# (The 100 simulates different assignments)
head(simulate_design(design, sims = c(1, 1, 1, 100, 1, 1)))

# You may also run simulate_design in parallel using 
#   the future package on a personal computer with multiple
#   cores or on high performance computing clusters. 

library(future)
options(parallelly.fork.enable = TRUE) # required for use in RStudio
plan(multicore) # note other plans are possible, see future

simulate_design(design, sims = 500)


## End(Not run)

</code></pre>

<hr>
<h2 id='tidy_try'>Tidy Model Results and Filter to Relevant Coefficients</h2><span id='topic+tidy_try'></span>

<h3>Description</h3>

<p>Tidy function that returns a tidy data.frame of model results and allows filtering to relevant coefficients. The function will attempt to tidy model objects even when they do not have a tidy method available. For best results, first load the broom package via <code>library(broom)</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tidy_try(fit, term = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tidy_try_+3A_fit">fit</code></td>
<td>
<p>A model fit, as returned by a modeling function like lm, glm, or estimatr::lm_robust.</p>
</td></tr>
<tr><td><code id="tidy_try_+3A_term">term</code></td>
<td>
<p>A character vector of the terms that represent quantities of interest, i.e., &quot;Z&quot;. If FALSE, return the first non-intercept term; if TRUE return all terms.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame with coefficient estimates and associated statistics.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
fit &lt;- lm(mpg ~ hp + disp + cyl, data = mtcars)

tidy_try(fit)

</code></pre>

<hr>
<h2 id='tidy.diagnosis'>Tidy diagnosis</h2><span id='topic+tidy.diagnosis'></span>

<h3>Description</h3>

<p>Tidy diagnosis
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'diagnosis'
tidy(x, conf.int = TRUE, conf.level = 0.95, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tidy.diagnosis_+3A_x">x</code></td>
<td>
<p>A diagnosis object generated by <code>diagnose_design</code>.</p>
</td></tr>
<tr><td><code id="tidy.diagnosis_+3A_conf.int">conf.int</code></td>
<td>
<p>Logical indicating whether or not to include a
confidence interval in the tidied output. Defaults to TRUE.</p>
</td></tr>
<tr><td><code id="tidy.diagnosis_+3A_conf.level">conf.level</code></td>
<td>
<p>The confidence level to use for the confidence
interval if conf.int = TRUE. Must be strictly greater than 0 and less
than 1. Defaults to 0.95, which corresponds to a 95 percent confidence
interval.</p>
</td></tr>
<tr><td><code id="tidy.diagnosis_+3A_...">...</code></td>
<td>
<p>extra arguments (not used)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame with columns for diagnosand names, estimated diagnosand values, 
bootstrapped standard errors and confidence intervals
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
effect_size &lt;- 0.1
design &lt;-
  declare_model(
    N = 100,
    U = rnorm(N),
    X = rnorm(N),
    potential_outcomes(Y ~ effect_size * Z + X + U)
  ) +
  declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) +
  declare_assignment(Z = complete_ra(N)) +
  declare_measurement(Y = reveal_outcomes(Y ~ Z)) +
  declare_estimator(Y ~ Z, inquiry = "ATE", label = "unadjusted") + 
  declare_estimator(Y ~ Z + X, inquiry = "ATE", label = "adjusted")

diagnosis &lt;- diagnose_design(design, sims = 100)

tidy(diagnosis)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
