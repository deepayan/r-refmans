<!DOCTYPE html><html lang="en"><head><title>Help for package agriutilities</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {agriutilities}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#+25+26gt+3B+25'><p>Pipe operator</p></a></li>
<li><a href='#check_connectivity'><p>Check connectivity between trials</p></a></li>
<li><a href='#check_design_met'><p>Check Experimental Design</p></a></li>
<li><a href='#covcor_heat'><p>Correlation Covariance Heatmap</p></a></li>
<li><a href='#extract_rcov'><p>Extract Residual Variance-Covariance from ASReml-R</p></a></li>
<li><a href='#extract_vcov'><p>Extract Variance-Covariance from ASReml-R</p></a></li>
<li><a href='#fa_summary'><p>Factor Analytic Summary</p></a></li>
<li><a href='#gg_cor'><p>Triangular Correlation Plot</p></a></li>
<li><a href='#h_cullis'><p>Cullis heritability for lme4 models</p></a></li>
<li><a href='#h_cullis_spt'><p>Calculate Cullis heritabilities from SpATS objects</p></a></li>
<li><a href='#heritability_fa'><p>Heritability for Factor Analytic Models in ASReml-R</p></a></li>
<li><a href='#ic_reml_asr'><p>Find the AIC and BIC for a set of models fitted using asreml</p></a></li>
<li><a href='#ic_reml_spt'><p>Find the AIC and BIC for a model fitted using SpATS</p></a></li>
<li><a href='#met_analysis'><p>Multi-Environmental Trial Analysis</p></a></li>
<li><a href='#parameters_gg'><p>Genetic Gain Parameters</p></a></li>
<li><a href='#plot.checkAgri'><p>Plot an object of class <code>checkAgri</code></p></a></li>
<li><a href='#plot.metAgri'><p>Plot an object of class <code>metAgri</code></p></a></li>
<li><a href='#plot.smaAgri'><p>Plot an object of class <code>smaAgri</code></p></a></li>
<li><a href='#print.checkAgri'><p>Print an object of class <code>checkAgri</code></p></a></li>
<li><a href='#print.metAgri'><p>Print an object of class <code>metAgri</code></p></a></li>
<li><a href='#print.smaAgri'><p>Print an object of class <code>smaAgri</code></p></a></li>
<li><a href='#single_trial_analysis'><p>Single Trial Analysis</p></a></li>
<li><a href='#stability'><p>Stability Coefficients</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Utilities for Data Analysis in Agriculture</td>
</tr>
<tr>
<td>Version:</td>
<td>1.2.1</td>
</tr>
<tr>
<td>Description:</td>
<td>Utilities designed to make the analysis of field trials easier and
 more accessible for everyone working in plant breeding. It provides a simple
 and intuitive interface for conducting single and multi-environmental trial
 analysis, with minimal coding required. Whether you're a beginner or an
 experienced user, 'agriutilities' will help you quickly and easily carry out
 complex analyses with confidence. With built-in functions for fitting Linear
 Mixed Models, 'agriutilities' is the ideal choice for anyone who wants to save
 time and focus on interpreting their results.
 Some of the functions require the R package 'asreml' for the 'ASReml' software,
 this can be obtained upon purchase from 'VSN' international <a href="https://vsni.co.uk/software/asreml-r/">https://vsni.co.uk/software/asreml-r/</a>.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Imports:</td>
<td>ggplot2, psych, dplyr, tidyr, lme4, Matrix, ggpubr, lmerTest,
data.table, stats, magrittr, emmeans, ggrepel, tibble, rlang,
statgenSTA, SpATS</td>
</tr>
<tr>
<td>Enhances:</td>
<td>asreml</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/AparicioJohan/agriutilities">https://github.com/AparicioJohan/agriutilities</a>,
<a href="https://apariciojohan.github.io/agriutilities/">https://apariciojohan.github.io/agriutilities/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/AparicioJohan/agriutilities/issues">https://github.com/AparicioJohan/agriutilities/issues</a></td>
</tr>
<tr>
<td>ByteCompile:</td>
<td>TRUE</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, lattice, cluster, rmarkdown, agridat, gt</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-01-17 19:48:53 UTC; johan</td>
</tr>
<tr>
<td>Author:</td>
<td>Johan Aparicio [aut, cre],
  Alexia Bornhorst [aut],
  The Alliance of Bioversity International and CIAT [cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Johan Aparicio &lt;johanstevenapa@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-01-17 23:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='+25+26gt+3B+25'>Pipe operator</h2><span id='topic++25+3E+25'></span>

<h3>Description</h3>

<p>See <code>magrittr::<a href="magrittr.html#topic+pipe">%&gt;%</a></code> for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lhs %&gt;% rhs
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="+2B25+2B26gt+2B3B+2B25_+3A_lhs">lhs</code></td>
<td>
<p>A value or the magrittr placeholder.</p>
</td></tr>
<tr><td><code id="+2B25+2B26gt+2B3B+2B25_+3A_rhs">rhs</code></td>
<td>
<p>A function call using the magrittr semantics.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The result of calling 'rhs(lhs)'.
</p>

<hr>
<h2 id='check_connectivity'>Check connectivity between trials</h2><span id='topic+check_connectivity'></span>

<h3>Description</h3>

<p>Check connectivity between trials
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_connectivity(
  data = NULL,
  genotype = "line",
  trial = "Experiment",
  response = NULL,
  all = FALSE,
  return_matrix = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_connectivity_+3A_data">data</code></td>
<td>
<p>A data.frame in a wide format.</p>
</td></tr>
<tr><td><code id="check_connectivity_+3A_genotype">genotype</code></td>
<td>
<p>A character string indicating the column in data that
contains genotypes.</p>
</td></tr>
<tr><td><code id="check_connectivity_+3A_trial">trial</code></td>
<td>
<p>A character string indicating the column in data that contains
trials.</p>
</td></tr>
<tr><td><code id="check_connectivity_+3A_response">response</code></td>
<td>
<p>A character string specifying the trait.</p>
</td></tr>
<tr><td><code id="check_connectivity_+3A_all">all</code></td>
<td>
<p>Whether or not print all the table.</p>
</td></tr>
<tr><td><code id="check_connectivity_+3A_return_matrix">return_matrix</code></td>
<td>
<p>A logical value indicating if the user wants to return
a (n_trial x n_trial) matrix with the amount of genotypes shared between each
pair of trial. (<code>FALSE</code> by default)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame with the genotype connectivity. If return_matrix is
<code>TRUE</code>, it will return a n_trial x n_trial matrix with the amount of
genotypes shared between each pair of trial.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(agridat)
library(agriutilities)
data(besag.met)
dat &lt;- besag.met
head(
  check_connectivity(
    data = dat,
    genotype = "gen",
    trial = "county",
    response = "yield",
    all = TRUE,
    return_matrix = FALSE
  )
)
</code></pre>

<hr>
<h2 id='check_design_met'>Check Experimental Design</h2><span id='topic+check_design_met'></span>

<h3>Description</h3>

<p>This function helps to identify the experimental design of each
trial, filters the data and then provide a summary for the traits and the
experimental design. This works as a quality check before we fit any model.
Returns an object of class <code>checkAgri</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_design_met(
  data = NULL,
  genotype = NULL,
  trial = NULL,
  traits = NULL,
  rep = NULL,
  block = NULL,
  row = NULL,
  col = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_design_met_+3A_data">data</code></td>
<td>
<p>A data.frame in a wide format.</p>
</td></tr>
<tr><td><code id="check_design_met_+3A_genotype">genotype</code></td>
<td>
<p>A character string indicating the column in data that
contains genotypes.</p>
</td></tr>
<tr><td><code id="check_design_met_+3A_trial">trial</code></td>
<td>
<p>A character string indicating the column in data that contains
trials.</p>
</td></tr>
<tr><td><code id="check_design_met_+3A_traits">traits</code></td>
<td>
<p>A character vector specifying the traits for which the models
should be fitted.</p>
</td></tr>
<tr><td><code id="check_design_met_+3A_rep">rep</code></td>
<td>
<p>A character string indicating the column in data that contains
replicates.</p>
</td></tr>
<tr><td><code id="check_design_met_+3A_block">block</code></td>
<td>
<p>A character string indicating the column in data that contains
sub blocks.</p>
</td></tr>
<tr><td><code id="check_design_met_+3A_row">row</code></td>
<td>
<p>A character string indicating the column in data that contains the
row coordinates.</p>
</td></tr>
<tr><td><code id="check_design_met_+3A_col">col</code></td>
<td>
<p>A character string indicating the column in data that contains the
column coordinates.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>checkAgri</code>, with a list of:
</p>
<table role = "presentation">
<tr><td><code>summ_traits</code></td>
<td>
<p>A data.frame containing a summary of the traits.</p>
</td></tr>
<tr><td><code>exp_design_resum</code></td>
<td>
<p>A data.frame containing a summary of the experimental
design.</p>
</td></tr>
<tr><td><code>filter</code></td>
<td>
<p>A list by trait containing the filtered trials.</p>
</td></tr>
<tr><td><code>exp_design_list</code></td>
<td>
<p>A data.frame containing the experimental design of
each trial.</p>
</td></tr>
<tr><td><code>check_connectivity</code></td>
<td>
<p>A data.frame with the genotype connectivity.</p>
</td></tr>
<tr><td><code>connectivity_matrix</code></td>
<td>
<p>A matrix with the amount of genotypes shared
between each pair of trial.</p>
</td></tr>
<tr><td><code>data_design</code></td>
<td>
<p>A data frame containing the data used with two additional
columns, one realted to the experimental design and a sequential number (id)</p>
</td></tr>
<tr><td><code>inputs</code></td>
<td>
<p>A list containing the character string that indicates the
column in data that contains the genotype, trial, traits, rep, block, row
and col.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>library(agridat)
library(agriutilities)
data(besag.met)
dat &lt;- besag.met
results &lt;- check_design_met(
  data = dat,
  genotype = "gen",
  trial = "county",
  traits = c("yield"),
  rep = "rep",
  block = "block",
  col = "col",
  row = "row"
)
print(results)
plot(results, type = "connectivity")
plot(results, type = "missing")
</code></pre>

<hr>
<h2 id='covcor_heat'>Correlation Covariance Heatmap</h2><span id='topic+covcor_heat'></span>

<h3>Description</h3>

<p>Correlation Covariance Heatmap
</p>


<h3>Usage</h3>

<pre><code class='language-R'>covcor_heat(
  matrix,
  corr = TRUE,
  size = 4,
  digits = 3,
  legend = c(0.6, 0.7),
  upper_tri = FALSE,
  reorder = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="covcor_heat_+3A_matrix">matrix</code></td>
<td>
<p>A numeric matrix.</p>
</td></tr>
<tr><td><code id="covcor_heat_+3A_corr">corr</code></td>
<td>
<p>A logical value indicating if the matrix is in a scaled form
(<code>TRUE</code> by default, correlation matrix)</p>
</td></tr>
<tr><td><code id="covcor_heat_+3A_size">size</code></td>
<td>
<p>A numeric value to define the letter size.</p>
</td></tr>
<tr><td><code id="covcor_heat_+3A_digits">digits</code></td>
<td>
<p>A numeric integer to define the number of digits to plot.</p>
</td></tr>
<tr><td><code id="covcor_heat_+3A_legend">legend</code></td>
<td>
<p>the position of legends (&quot;none&quot;, &quot;left&quot;, &quot;right&quot;, &quot;bottom&quot;,
&quot;top&quot;, or two-element numeric vector)</p>
</td></tr>
<tr><td><code id="covcor_heat_+3A_upper_tri">upper_tri</code></td>
<td>
<p>A logical value to plot the Lower or Upper Triangular Part of
the matrix. FALSE by default.</p>
</td></tr>
<tr><td><code id="covcor_heat_+3A_reorder">reorder</code></td>
<td>
<p>A logical value to reorder by a Hierarchical Clustering. FALSE
by default.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggplot object showing the upper triangular elements of the matrix.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(agriutilities)
data(iris)
M &lt;- cor(iris[, -5])
covcor_heat(matrix = M, corr = TRUE)
</code></pre>

<hr>
<h2 id='extract_rcov'>Extract Residual Variance-Covariance from ASReml-R</h2><span id='topic+extract_rcov'></span>

<h3>Description</h3>

<p>This function is specially useful for extracting residual variance covariance
matrices from ASReml-R when running repeated measurements analysis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_rcov(model = NULL, time = NULL, plot = NULL, vc_error = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="extract_rcov_+3A_model">model</code></td>
<td>
<p>An asreml object.</p>
</td></tr>
<tr><td><code id="extract_rcov_+3A_time">time</code></td>
<td>
<p>An optional character string indicating the &quot;Time&quot;. By default the function
identifies this parameter.</p>
</td></tr>
<tr><td><code id="extract_rcov_+3A_plot">plot</code></td>
<td>
<p>An optional character string indicating the &quot;PlotID&quot;. By default the function
identifies this parameter.</p>
</td></tr>
<tr><td><code id="extract_rcov_+3A_vc_error">vc_error</code></td>
<td>
<p>An optional character string indicating the variance covariance.
It can be &quot;corv&quot;, &quot;corh&quot;, &quot;corgh&quot;, &quot;us&quot;, &quot;expv&quot;, &quot;exph&quot;, &quot;ar1v&quot;, &quot;ar1h&quot; or &quot;ante&quot;.
By using NULL the function tries to guess which was the variance-covariance used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The expected residual variance covariance structure must be of the form:
'~id(Plot):corv(Time)', where 'Plot' is a unique identifier of each experimental unit,
and 'Time', represents the variable that contains the time when
the experimental units were measured. This form also requires that the levels of
the factor Time are nested in the levels of the factor Plot. If it is not in that form
you can sort the dataset by using the following  command 'arrange(grassUV, Plant, Time)'.
</p>


<h3>Value</h3>

<p>An object with a list of:
</p>
<table role = "presentation">
<tr><td><code>corr_mat</code></td>
<td>
<p>A matrix with the residual correlation between time points.</p>
</td></tr>
<tr><td><code>vcov_mat</code></td>
<td>
<p>A matrix of the estimated residual variance-covariance between time points.</p>
</td></tr>
<tr><td><code>vc</code></td>
<td>
<p>A character string indicating the variance-covariance fitted.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(ggpubr)
library(agriutilities)
library(tidyverse)
library(asreml)

head(grassUV)
str(grassUV)

# Exploration -------------------------------------------------------------

grassUV %&gt;%
  ggplot(
    aes(x = Time, y = y, group = Plant, color = Plant)
  ) +
  geom_point() +
  geom_line() +
  facet_wrap(~Tmt) +
  theme_minimal(base_size = 15)

tmp &lt;- grassUV %&gt;%
  group_by(Time, Plant) %&gt;%
  summarise(mean = mean(y, na.rm = TRUE)) %&gt;%
  spread(Time, mean) %&gt;%
  column_to_rownames("Plant")

gg_cor(tmp, label_size = 5)

tmp %&gt;%
  cor(use = "pairwise.complete.obs") %&gt;%
  as.data.frame() %&gt;%
  rownames_to_column(var = "Time") %&gt;%
  gather("DAP2", "corr", -1) %&gt;%
  type.convert(as.is = FALSE) %&gt;%
  mutate(corr = ifelse(Time &lt; DAP2, NA, corr)) %&gt;%
  mutate(DAP2 = as.factor(DAP2)) %&gt;%
  ggplot(
    aes(x = Time, y = corr, group = DAP2, color = DAP2)
  ) +
  geom_point() +
  geom_line() +
  theme_minimal(base_size = 15) +
  color_palette(palette = "jco") +
  labs(color = "Time", y = "Pearson Correlation")

# Modeling ----------------------------------------------------------------

# Identity variance model.
model_0 &lt;- asreml(
  fixed = y ~ Time + Tmt + Tmt:Time,
  residual = ~ id(Plant):idv(Time),
  data = grassUV
)

# Simple correlation model; homogeneous variance form.
model_1 &lt;- asreml(
  fixed = y ~ Time + Tmt + Tmt:Time,
  residual = ~ id(Plant):corv(Time),
  data = grassUV
)

# Exponential (or power) model; homogeneous variance form.
model_2 &lt;- asreml(
  fixed = y ~ Time + Tmt + Tmt:Time,
  residual = ~ id(Plant):expv(Time),
  data = grassUV
)

# Exponential (or power) model; heterogeneous variance form.
model_3 &lt;- asreml(
  fixed = y ~ Time + Tmt + Tmt:Time,
  residual = ~ id(Plant):exph(Time),
  data = grassUV
)

# Antedependence variance model of order 1
model_4 &lt;- asreml(
  fixed = y ~ Time + Tmt + Tmt:Time,
  residual = ~ id(Plant):ante(Time),
  data = grassUV
)

# Autoregressive model of order 1; homogeneous variance form.
model_5 &lt;- asreml(
  fixed = y ~ Time + Tmt + Tmt:Time,
  residual = ~ id(Plant):ar1v(Time),
  data = grassUV
)

# Autoregressive model of order 1; heterogeneous variance form.
model_6 &lt;- asreml(
  fixed = y ~ Time + Tmt + Tmt:Time,
  residual = ~ id(Plant):ar1h(Time),
  data = grassUV
)

# Unstructured variance model.
model_7 &lt;- asreml(
  fixed = y ~ Time + Tmt + Tmt:Time,
  residual = ~ id(Plant):us(Time),
  data = grassUV
)

# Model Comparison --------------------------------------------------------

models &lt;- list(
  "id" = model_0,
  "cor" = model_1,
  "exp" = model_2,
  "exph" = model_3,
  "ante" = model_4,
  "ar1" = model_5,
  "ar1h" = model_6,
  "us" = model_7
)

summary_models &lt;- data.frame(
  model = names(models),
  aic = unlist(lapply(models, \(x) summary(x)$aic)),
  bic = unlist(lapply(models, \(x) summary(x)$bic)),
  loglik = unlist(lapply(models, \(x) summary(x)$loglik)),
  nedf = unlist(lapply(models, \(x) summary(x)$nedf)),
  param = unlist(lapply(models, \(x) attr(summary(x)$aic, "param"))),
  row.names = NULL
)

summary_models %&gt;%
  ggplot(
    aes(x = reorder(model, -bic), y = bic, group = 1)
  ) +
  geom_point(size = 2) +
  geom_text(aes(x = model, y = bic + 5, label = param)) +
  geom_line() +
  theme_minimal(base_size = 15) +
  labs(x = NULL)

# Extracting Variance Covariance Matrix -----------------------------------

extract_rcov(model_4)

covcor_heat(
  matrix = extract_rcov(model_1)$corr,
  legend = "none",
  size = 5
) + ggtitle(label = "Uniform Correlation (corv)")
covcor_heat(
  matrix = extract_rcov(model_2)$corr,
  legend = "none",
  size = 5
) + ggtitle(label = "Exponetial (expv)")

## End(Not run)
</code></pre>

<hr>
<h2 id='extract_vcov'>Extract Variance-Covariance from ASReml-R</h2><span id='topic+extract_vcov'></span>

<h3>Description</h3>

<p>Extract Variance-Covariance from ASReml-R
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_vcov(model = NULL, gen = "genotype", env = "trial", vc_model = "corv")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="extract_vcov_+3A_model">model</code></td>
<td>
<p>ASReml object</p>
</td></tr>
<tr><td><code id="extract_vcov_+3A_gen">gen</code></td>
<td>
<p>A character string indicating the column in data that contains
genotypes.</p>
</td></tr>
<tr><td><code id="extract_vcov_+3A_env">env</code></td>
<td>
<p>A character string indicating the column in data that contains
environments or trials.</p>
</td></tr>
<tr><td><code id="extract_vcov_+3A_vc_model">vc_model</code></td>
<td>
<p>A character string indicating the variance-covariance fitted.
Can be 'diag', 'corv', 'corh', 'corgv', 'fa1', 'fa2', 'fa3', 'fa4', 'corgh',
'us' or 'rr2'.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object with a list of:
</p>
<table role = "presentation">
<tr><td><code>VCOV</code></td>
<td>
<p>A matrix of the estimated variance-covariance between trials.</p>
</td></tr>
<tr><td><code>CORR</code></td>
<td>
<p>A n_trial x n_trial matrix with the correlation between trials.</p>
</td></tr>
<tr><td><code>vc_model</code></td>
<td>
<p>A character string indicating the variance-covariance fitted.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(agridat)
library(agriutilities)

data(besag.met)
dat &lt;- besag.met
results &lt;- check_design_met(
  data = dat,
  genotype = "gen",
  trial = "county",
  traits = c("yield"),
  rep = "rep",
  block = "block",
  col = "col",
  row = "row"
)
out &lt;- single_trial_analysis(results, progress = FALSE)
met_results &lt;- met_analysis(out, progress = FALSE)
extract_vcov(
  model = met_results$met_models$yield,
  vc_model = "us"
)

## End(Not run)
</code></pre>

<hr>
<h2 id='fa_summary'>Factor Analytic Summary</h2><span id='topic+fa_summary'></span>

<h3>Description</h3>

<p>Factor Analytic Summary
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fa_summary(
  model = NULL,
  trial = "trial",
  genotype = "genotype",
  BLUEs_trial = NULL,
  mult_fa1 = -1,
  mult_fa2 = 1,
  filter_score = 1.5,
  k_biplot = 1,
  size_label_var = 2,
  alpha_label_var = 0.2,
  size_label_ind = 2,
  alpha_label_ind = 0.8,
  size_arrow = 0.2,
  alpha_arrow = 0.2,
  base_size = 12
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fa_summary_+3A_model">model</code></td>
<td>
<p>Factor Analytic Model (ASReml object)</p>
</td></tr>
<tr><td><code id="fa_summary_+3A_trial">trial</code></td>
<td>
<p>A character string indicating the column in data that contains
trials.</p>
</td></tr>
<tr><td><code id="fa_summary_+3A_genotype">genotype</code></td>
<td>
<p>A character string indicating the column in data that
contains genotypes.</p>
</td></tr>
<tr><td><code id="fa_summary_+3A_blues_trial">BLUEs_trial</code></td>
<td>
<p>A data.frame containing BLUEs for each trial.</p>
</td></tr>
<tr><td><code id="fa_summary_+3A_mult_fa1">mult_fa1</code></td>
<td>
<p>A constant to multiply the first loading. Must be 1 or -1.
(-1 by default)</p>
</td></tr>
<tr><td><code id="fa_summary_+3A_mult_fa2">mult_fa2</code></td>
<td>
<p>A constant to multiply the second loading. Must be 1 or -1.
(1 by default)</p>
</td></tr>
<tr><td><code id="fa_summary_+3A_filter_score">filter_score</code></td>
<td>
<p>A numeric value to filter genotypes by the distance from
the origin.</p>
</td></tr>
<tr><td><code id="fa_summary_+3A_k_biplot">k_biplot</code></td>
<td>
<p>A numeric value to multiply the scores in the biplot.</p>
</td></tr>
<tr><td><code id="fa_summary_+3A_size_label_var">size_label_var</code></td>
<td>
<p>A numeric value to define the label size for the
variables.</p>
</td></tr>
<tr><td><code id="fa_summary_+3A_alpha_label_var">alpha_label_var</code></td>
<td>
<p>A numeric value between (0,1) to define the label for
the variables.</p>
</td></tr>
<tr><td><code id="fa_summary_+3A_size_label_ind">size_label_ind</code></td>
<td>
<p>A numeric value to define the label size for the
individuals.</p>
</td></tr>
<tr><td><code id="fa_summary_+3A_alpha_label_ind">alpha_label_ind</code></td>
<td>
<p>A numeric value between (0,1) to define the label for
the individuals.</p>
</td></tr>
<tr><td><code id="fa_summary_+3A_size_arrow">size_arrow</code></td>
<td>
<p>A numeric value to define the arrow size.</p>
</td></tr>
<tr><td><code id="fa_summary_+3A_alpha_arrow">alpha_arrow</code></td>
<td>
<p>A numeric value between (0,1) to define the arrow.</p>
</td></tr>
<tr><td><code id="fa_summary_+3A_base_size">base_size</code></td>
<td>
<p>A numeric value to define the base size.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object with a list of:
</p>
<table role = "presentation">
<tr><td><code>loadings</code></td>
<td>
<p>A data.frame containing the first and second loading for each
trial.</p>
</td></tr>
<tr><td><code>loading_star</code></td>
<td>
<p>A data.frame containing the first and second loading
rotated for each trial.</p>
</td></tr>
<tr><td><code>Gvar</code></td>
<td>
<p>A matrix of the estimated variance-covariance between trials.</p>
</td></tr>
<tr><td><code>Cmat</code></td>
<td>
<p>A matrix of the correlation between trials.</p>
</td></tr>
<tr><td><code>summary_loading</code></td>
<td>
<p>A data.frame containing a summary of the loadings.</p>
</td></tr>
<tr><td><code>paf_site</code></td>
<td>
<p>A data.frame containing the percentage of variance explained
for each component and for each trial.</p>
</td></tr>
<tr><td><code>var_tot</code></td>
<td>
<p>A numeric value of the total variance.</p>
</td></tr>
<tr><td><code>scores</code></td>
<td>
<p>A data.frame containing the scores for each genotype.</p>
</td></tr>
<tr><td><code>plots</code></td>
<td>
<p>A list with different plots. Includes a plot for the loadings,
biplot, biplot_scaled and loadings_c.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(agridat)
library(agriutilities)
data(besag.met)
dat &lt;- besag.met
results &lt;- check_design_met(
  data = dat,
  genotype = "gen",
  trial = "county",
  traits = c("yield"),
  rep = "rep",
  block = "block",
  col = "col",
  row = "row"
)
out &lt;- single_trial_analysis(results, progress = FALSE)
met_results &lt;- met_analysis(out, vcov = "fa2", progress = FALSE)

pp &lt;- met_results$trial_effects
model &lt;- met_results$met_models$yield
fa_summary(
  model = model,
  trial = "trial",
  genotype = "genotype",
  BLUEs_trial = pp,
  mult_fa1 = -1,
  mult_fa2 = -1,
  filter_score = 1,
  k_biplot = 10,
  size_label_var = 3,
  alpha_label_var = 0.5,
  size_label_ind = 3,
  alpha_label_ind = 0.8,
  size_arrow = 0.2,
  alpha_arrow = 0.1
)

## End(Not run)
</code></pre>

<hr>
<h2 id='gg_cor'>Triangular Correlation Plot</h2><span id='topic+gg_cor'></span>

<h3>Description</h3>

<p>Return a ggplot object to plot a triangular correlation figure
between 2 or more variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gg_cor(
  data,
  colours = c("#db4437", "white", "#4285f4"),
  blackLabs = c(-0.7, 0.7),
  show_signif = TRUE,
  p_breaks = c(0, 0.001, 0.01, 0.05, Inf),
  p_labels = c("***", "**", "*", "ns"),
  show_diagonal = FALSE,
  diag = NULL,
  return_table = FALSE,
  return_n = FALSE,
  adjusted = TRUE,
  label_size = 3,
  method = "pearson"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gg_cor_+3A_data">data</code></td>
<td>
<p>A data.frame with numerical columns for each variable to be
compared.</p>
</td></tr>
<tr><td><code id="gg_cor_+3A_colours">colours</code></td>
<td>
<p>A vector of size three with the colors to be used for values
-1, 0 and 1.</p>
</td></tr>
<tr><td><code id="gg_cor_+3A_blacklabs">blackLabs</code></td>
<td>
<p>A numeric vector of size two, with min and max correlation
coefficient.</p>
</td></tr>
<tr><td><code id="gg_cor_+3A_show_signif">show_signif</code></td>
<td>
<p>Logical scalar. Display significance values ?</p>
</td></tr>
<tr><td><code id="gg_cor_+3A_p_breaks">p_breaks</code></td>
<td>
<p>Passed to function 'cut'. Either a numeric vector of two or
more unique cut points or a single number (greater than or equal to 2) giving
the number of intervals into which x is to be cut.</p>
</td></tr>
<tr><td><code id="gg_cor_+3A_p_labels">p_labels</code></td>
<td>
<p>Passed to function 'cut'. labels for the levels of the
resulting category. By default, labels are constructed using &quot;(a,b]&quot; interval
notation. If <code>p_labels = FALSE</code>, simple integer codes are returned
instead of a factor.</p>
</td></tr>
<tr><td><code id="gg_cor_+3A_show_diagonal">show_diagonal</code></td>
<td>
<p>Logical scalar. Display main diagonal values ?</p>
</td></tr>
<tr><td><code id="gg_cor_+3A_diag">diag</code></td>
<td>
<p>A named vector of labels to display in the main diagonal. The
names are used to place each value in the corresponding coordinates of the
diagonal. Hence, these names must be the same as the colnames of data.</p>
</td></tr>
<tr><td><code id="gg_cor_+3A_return_table">return_table</code></td>
<td>
<p>Return the table to display instead of a ggplot object.</p>
</td></tr>
<tr><td><code id="gg_cor_+3A_return_n">return_n</code></td>
<td>
<p>Return plot with shared information.</p>
</td></tr>
<tr><td><code id="gg_cor_+3A_adjusted">adjusted</code></td>
<td>
<p>Use the adjusted p values for multiple testing instead of
raw coeffs. <code>TRUE</code> by default.</p>
</td></tr>
<tr><td><code id="gg_cor_+3A_label_size">label_size</code></td>
<td>
<p>Numeric value indicating the label size. 3 by default.</p>
</td></tr>
<tr><td><code id="gg_cor_+3A_method">method</code></td>
<td>
<p>method=&quot;pearson&quot; is the default value.
The alternatives to be passed to cor are &quot;spearman&quot; and &quot;kendall&quot;.
These last two are much slower, particularly for big data sets.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggplot object containing a triangular correlation figure with all
numeric variables in data. If return_table is <code>TRUE</code>, the table used to
produce the figure is returned instead.
</p>


<h3>Author(s)</h3>

<p>Daniel Ariza, Johan Aparicio.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(agriutilities)
data(iris)
gg_cor(
  data = iris,
  colours = c("#db4437", "white", "#4285f4"),
  label_size = 6
)
</code></pre>

<hr>
<h2 id='h_cullis'>Cullis heritability for lme4 models</h2><span id='topic+h_cullis'></span>

<h3>Description</h3>

<p>Cullis heritability for lme4 models
</p>


<h3>Usage</h3>

<pre><code class='language-R'>h_cullis(model, genotype, re_MME = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="h_cullis_+3A_model">model</code></td>
<td>
<p>Object of class <code>lmer</code>.</p>
</td></tr>
<tr><td><code id="h_cullis_+3A_genotype">genotype</code></td>
<td>
<p>A character string indicating the column in data that
contains genotypes.</p>
</td></tr>
<tr><td><code id="h_cullis_+3A_re_mme">re_MME</code></td>
<td>
<p>A logical value to ask if we want to reconstruct the mixed models
equations to estimate the Cullis heritability. (<code>FALSE</code> by default)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numerical value of the Cullis heritability estimate. If
<code>re_MME</code> is <code>TRUE</code>, a list with matrices of the mixed models
equations is returned.
</p>


<h3>Author(s)</h3>

<p>Paul Schmidt, Johan Aparicio.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(lme4)
library(agridat)
library(agriutilities)
dat &lt;- john.alpha
g.ran &lt;- lmer(
  formula = yield ~ rep + (1 | gen) + (1 | rep:block),
  data = dat
)
h_cullis(model = g.ran, genotype = "gen")

</code></pre>

<hr>
<h2 id='h_cullis_spt'>Calculate Cullis heritabilities from SpATS objects</h2><span id='topic+h_cullis_spt'></span>

<h3>Description</h3>

<p>Calculate Cullis heritabilities from SpATS objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>h_cullis_spt(model)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="h_cullis_spt_+3A_model">model</code></td>
<td>
<p>an object of class SpATS as produced by SpATS()</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame.  The data frame has the following components
</p>

<ul>
<li> <p><code>trait</code> : Character string with the trait being analyzed
</p>
</li>
<li> <p><code>H2Cullis</code> : Generalized heritability proposed by Cullis (2006)
</p>
</li>
<li> <p><code>H2Oakey</code> :  Generalized heritability proposed by Oakey (2006)
</p>
</li>
<li> <p><code>reBLUP_avg</code> : Average BLUP reliability
</p>
</li>
<li> <p><code>vdBLUP_avg</code> : Average pairwise prediction error variance of genotype effects
</p>
</li>
<li> <p><code>PEV_avg</code> : Average predictive error variance (PEV) of genotype effects
</p>
</li>
<li> <p><code>var_G</code> : Genotypic Variance
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Johan Aparicio
</p>


<h3>References</h3>

<p>Cullis, B. R., Smith, A. B., &amp; Coombes, N. E. (2006).
On the design of early generation variety trials with correlated data.
Journal of agricultural, biological, and environmental statistics, 11, 381-393.
</p>
<p>Oakey, H., A. Verbyla, W. Pitchford, B. Cullis, and H. Kuchel (2006).
Joint modeling of additive and non-additive genetic line effects in single
field trials. Theoretical and Applied Genetics, 113, 809 - 819.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(SpATS)
library(agriutilities)
data(wheatdata)
wheatdata$R &lt;- as.factor(wheatdata$row)
wheatdata$C &lt;- as.factor(wheatdata$col)

m1 &lt;- SpATS(
  response = "yield",
  spatial = ~ PSANOVA(col, row, nseg = c(10, 20), nest.div = 2),
  genotype = "geno",
  genotype.as.random = TRUE,
  fixed = ~ colcode + rowcode,
  random = ~ R + C,
  data = wheatdata,
  control = list(tolerance = 1e-03, monitoring = 0)
)

h_cullis_spt(m1)

</code></pre>

<hr>
<h2 id='heritability_fa'>Heritability for Factor Analytic Models in ASReml-R</h2><span id='topic+heritability_fa'></span>

<h3>Description</h3>

<p>Heritability for Factor Analytic Models in ASReml-R
</p>


<h3>Usage</h3>

<pre><code class='language-R'>heritability_fa(
  model_fa = NULL,
  genotype = "line",
  env = "loc",
  vc_model = c("fa2"),
  diag = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="heritability_fa_+3A_model_fa">model_fa</code></td>
<td>
<p>Factor Analytic ASReml model</p>
</td></tr>
<tr><td><code id="heritability_fa_+3A_genotype">genotype</code></td>
<td>
<p>A character string indicating the column in data that
contains genotypes.</p>
</td></tr>
<tr><td><code id="heritability_fa_+3A_env">env</code></td>
<td>
<p>A character string indicating the column in data that contains
environments or trials.</p>
</td></tr>
<tr><td><code id="heritability_fa_+3A_vc_model">vc_model</code></td>
<td>
<p>A character string indicating the variance-covariance
structure. Can be &quot;fa1&quot;, &quot;fa2&quot;, &quot;fa3&quot;, &quot;fa4&quot; or &quot;us&quot;.</p>
</td></tr>
<tr><td><code id="heritability_fa_+3A_diag">diag</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code> depending on the user if they want to
take the elements on the diagonal of the variance-covariance matrix or the
elements out of the diagonal to estimate the heritability. <code>FALSE</code> by
default.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object with a list of:
</p>
<table role = "presentation">
<tr><td><code>h2_cullis</code></td>
<td>
<p>A numerical value of the Cullis heritability estimate.</p>
</td></tr>
<tr><td><code>h2_se</code></td>
<td>
<p>A numerical value of the Cullis heritability estimate based on
the standard error.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(agridat)
library(agriutilities)
data(besag.met)
dat &lt;- besag.met
results &lt;- check_design_met(
  data = dat,
  genotype = "gen",
  trial = "county",
  traits = c("yield"),
  rep = "rep",
  block = "block",
  col = "col",
  row = "row"
)
out &lt;- single_trial_analysis(results, progress = FALSE)
met_results &lt;- met_analysis(out, progress = FALSE)
model &lt;- met_results$met_models$yield
heritability_fa(
   model_fa = model,
   genotype = "genotype",
   env = "trial",
   vc_model = "us"
 )

## End(Not run)
</code></pre>

<hr>
<h2 id='ic_reml_asr'>Find the AIC and BIC for a set of models fitted using asreml</h2><span id='topic+ic_reml_asr'></span>

<h3>Description</h3>

<p>The function is a wrapper for 'icREML' function described
in Verbyla (2019).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ic_reml_asr(fm, scale = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ic_reml_asr_+3A_fm">fm</code></td>
<td>
<p>A <code>list</code> of asreml fitted model objects</p>
</td></tr>
<tr><td><code id="ic_reml_asr_+3A_scale">scale</code></td>
<td>
<p>A scalar to scale the variance matrix of the estimated
fixed effects (to ensure numerical stability of a log-determinant).
Default value is 1.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame.  The data frame has the following components
</p>

<ul>
<li> <p><code>model</code> : the names of the models
</p>
</li>
<li> <p><code>loglik</code> : the full log-likelihood for each model
</p>
</li>
<li> <p><code>p</code> :  the number of fixed effects parameters for each model
</p>
</li>
<li> <p><code>q</code> : the number of (non-zero) variance parameters for each model.
</p>
</li>
<li> <p><code>b</code> : the number of variance parameters that are fixed or on the
boundary.  These parameters are not counted in the AIC or BIC.
</p>
</li>
<li> <p><code>AIC</code> : the AIC for each model
</p>
</li>
<li> <p><code>BIC</code> : the BIC for each model
</p>
</li>
<li> <p><code>logdet</code> : the log-determinant used in adjusting the residual
log-likelihood for each model
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Ari Verbyla (averbyla at avdataanalytics.com.au)
</p>


<h3>References</h3>

<p>Verbyla, A. P. (2019). A note on model selection using information
criteria for general linear models estimated using REML. Australian &amp;
New Zealand Journal of Statistics, 61(1), 39-50.
</p>

<hr>
<h2 id='ic_reml_spt'>Find the AIC and BIC for a model fitted using SpATS</h2><span id='topic+ic_reml_spt'></span>

<h3>Description</h3>

<p>This function calculates the AIC and BIC for a model fitted in
SpATS following the methodology proposed by Verbyla (2019).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ic_reml_spt(model, scale = 1, k = 2, label = "spats")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ic_reml_spt_+3A_model">model</code></td>
<td>
<p>A model fitted using SpATS.</p>
</td></tr>
<tr><td><code id="ic_reml_spt_+3A_scale">scale</code></td>
<td>
<p>A scalar to scale the variance matrix of the estimated
fixed effects (to ensure numerical stability of a log-determinant).
Default value is 1.</p>
</td></tr>
<tr><td><code id="ic_reml_spt_+3A_k">k</code></td>
<td>
<p>An integer value to round ratios when identifying boundary variance
parameters. Default value is 2.</p>
</td></tr>
<tr><td><code id="ic_reml_spt_+3A_label">label</code></td>
<td>
<p>A string to label the model. Default value is &quot;spats&quot;.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame.  The data frame has the following components
</p>

<ul>
<li> <p><code>model</code> : the name of the models
</p>
</li>
<li> <p><code>loglik</code> : the full log-likelihood for each model
</p>
</li>
<li> <p><code>p</code> :  the number of fixed effects parameters for each model
</p>
</li>
<li> <p><code>q</code> : the number of (non-zero) variance parameters for each model.
</p>
</li>
<li> <p><code>b</code> : the number of variance parameters that are fixed or on the
boundary.  These parameters are not counted in the AIC or BIC.
</p>
</li>
<li> <p><code>AIC</code> : the AIC for each model
</p>
</li>
<li> <p><code>BIC</code> : the BIC for each model
</p>
</li>
<li> <p><code>logdet</code> : the log-determinant used in adjusting the residual
log-likelihood for each model
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Johan Aparicio
</p>


<h3>References</h3>

<p>Verbyla, A. P. (2019). A note on model selection using information
criteria for general linear models estimated using REML. Australian &amp;
New Zealand Journal of Statistics, 61(1), 39-50.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(SpATS)
library(agriutilities)
data(wheatdata)
wheatdata$R &lt;- as.factor(wheatdata$row)
wheatdata$C &lt;- as.factor(wheatdata$col)

m1 &lt;- SpATS(
  response = "yield",
  spatial = ~ PSANOVA(col, row, nseg = c(10, 20), nest.div = 2),
  genotype = "geno",
  genotype.as.random = TRUE,
  fixed = ~ colcode + rowcode,
  random = ~ R + C,
  data = wheatdata,
  control = list(tolerance = 1e-03, monitoring = 0)
)

m2 &lt;- SpATS(
  response = "yield",
  spatial = ~ PSANOVA(col, row, nseg = c(10, 20), nest.div = 2),
  genotype = "geno",
  genotype.as.random = TRUE,
  fixed = ~colcode,
  random = ~ R + C,
  data = wheatdata,
  control = list(tolerance = 1e-03, monitoring = 0)
)

rbind.data.frame(
  ic_reml_spt(m1, label = "colcode_rowcode"),
  ic_reml_spt(m2, label = "colcode_no_rowcode")
)

rbind.data.frame(
  h_cullis_spt(m1),
  h_cullis_spt(m2)
)

</code></pre>

<hr>
<h2 id='met_analysis'>Multi-Environmental Trial Analysis</h2><span id='topic+met_analysis'></span>

<h3>Description</h3>

<p>The results of the <code>single_trial_analysis()</code> function are
used in <code>met_analysis()</code> to fit multi-environmental trial models.
Returns an object of class <code>metAgri</code>, with a list of trial effects,
BLUPs, heritability, variance components, stability and the models fitted.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>met_analysis(
  sma_output = NULL,
  h2_filter = 0.2,
  workspace = "1gb",
  vcov = NULL,
  filter_traits = NULL,
  remove_trials = NULL,
  progress = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="met_analysis_+3A_sma_output">sma_output</code></td>
<td>
<p>Object of class <code>smaAgri</code> resulting of executing
<code>single_trial_analysis()</code> function.</p>
</td></tr>
<tr><td><code id="met_analysis_+3A_h2_filter">h2_filter</code></td>
<td>
<p>Numeric value to filter trials with poor heritability.
0.2 by default.</p>
</td></tr>
<tr><td><code id="met_analysis_+3A_workspace">workspace</code></td>
<td>
<p>Sets the workspace for the core <code>REML</code> routines in the
form of a number optionally followed directly by a valid measurement unit.
&quot;128mb&quot; by default.</p>
</td></tr>
<tr><td><code id="met_analysis_+3A_vcov">vcov</code></td>
<td>
<p>A character string specifying the Variance-Covariance structure
to be fitted. Can be &quot;fa2&quot;, &quot;fa1&quot;, &quot;us&quot;, &quot;corh&quot; or &quot;corv&quot;. If <code>NULL</code> the
function will try to fit an &quot;us&quot; Variance-Covariance and if it fails, it will
try with &quot;fa2&quot; and then with &quot;fa1&quot;.</p>
</td></tr>
<tr><td><code id="met_analysis_+3A_filter_traits">filter_traits</code></td>
<td>
<p>A character vector with traits to filter. <code>NULL</code> by
default.</p>
</td></tr>
<tr><td><code id="met_analysis_+3A_remove_trials">remove_trials</code></td>
<td>
<p>A character vector with trials to remove. <code>NULL</code> by
default.</p>
</td></tr>
<tr><td><code id="met_analysis_+3A_progress">progress</code></td>
<td>
<p>Should the progress of the modeling be printed.
If <code>TRUE</code>, for every trait a line is output indicating that the model is
being fitted.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>metAgri</code>, with a list of:
</p>
<table role = "presentation">
<tr><td><code>trial_effects</code></td>
<td>
<p>A data.frame containing Trial BLUEs.</p>
</td></tr>
<tr><td><code>overall_BLUPs</code></td>
<td>
<p>A data.frame containing Genotypic BLUPs across trials,
by trait.</p>
</td></tr>
<tr><td><code>BLUPs_GxE</code></td>
<td>
<p>A data.frame containing Genotypic BLUPs by trial/trait.</p>
</td></tr>
<tr><td><code>VCOV</code></td>
<td>
<p>A list by trait contanining the variance-covariance fitted.</p>
</td></tr>
<tr><td><code>stability</code></td>
<td>
<p>A data.frame containing several Stability coefficients
resulting of executing the function <code>stability()</code>.</p>
</td></tr>
<tr><td><code>heritability</code></td>
<td>
<p>A data.frame containing overall heritabilities by trait.</p>
</td></tr>
<tr><td><code>met_models</code></td>
<td>
<p>A list by trait containing the fitted models.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(agridat)
library(agriutilities)
data(besag.met)
dat &lt;- besag.met
results &lt;- check_design_met(
  data = dat,
  genotype = "gen",
  trial = "county",
  traits = c("yield"),
  rep = "rep",
  block = "block",
  col = "col",
  row = "row"
)
out &lt;- single_trial_analysis(results, progress = FALSE)
met_results &lt;- met_analysis(out, progress = FALSE)
print(met_results)
covcor_heat(matrix = met_results$VCOV$yield$CORR)

## End(Not run)
</code></pre>

<hr>
<h2 id='parameters_gg'>Genetic Gain Parameters</h2><span id='topic+parameters_gg'></span>

<h3>Description</h3>

<p>Genetic Gain Parameters
</p>


<h3>Usage</h3>

<pre><code class='language-R'>parameters_gg(model, trait = "trait")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="parameters_gg_+3A_model">model</code></td>
<td>
<p>Linear regression model (<code>lm</code> object)</p>
</td></tr>
<tr><td><code id="parameters_gg_+3A_trait">trait</code></td>
<td>
<p>A character string indicating the column in data that contains
trials.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame with some parameters from the linear regression (Slope,
se_Slope, Intercept, r2, Pr(&gt;F)) and the percentage of Genetic Gain.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(ggplot2)
library(agridat)
library(magrittr)
library(agriutilities)

data(baker.barley.uniformity)
dat &lt;- baker.barley.uniformity
head(dat)

model &lt;- lm(yield ~ year, dat)

dat %&gt;%
  na.omit() %&gt;%
  ggplot(
    aes(x = year, y = yield)
  ) +
  geom_point() +
  geom_smooth(method = "lm") +
  theme_bw()

parameters_gg(model = model, trait = "yield")

</code></pre>

<hr>
<h2 id='plot.checkAgri'>Plot an object of class <code>checkAgri</code></h2><span id='topic+plot.checkAgri'></span>

<h3>Description</h3>

<p>Create several plots for an object of class <code>checkAgri</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'checkAgri'
plot(
  x,
  type = c("connectivity", "missing", "boxplot"),
  axis_size = 15,
  text_size = 5,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.checkAgri_+3A_x">x</code></td>
<td>
<p>An object inheriting from class <code>checkAgri</code> resulting of
executing the function <code>check_design_met()</code></p>
</td></tr>
<tr><td><code id="plot.checkAgri_+3A_type">type</code></td>
<td>
<p>A character string specifiying the type of plot. &quot;connectivity&quot;,
&quot;missing&quot; or &quot;boxplot&quot;.</p>
</td></tr>
<tr><td><code id="plot.checkAgri_+3A_axis_size">axis_size</code></td>
<td>
<p>Numeric input to define the axis size.</p>
</td></tr>
<tr><td><code id="plot.checkAgri_+3A_text_size">text_size</code></td>
<td>
<p>Numeric input to define the text size.</p>
</td></tr>
<tr><td><code id="plot.checkAgri_+3A_...">...</code></td>
<td>
<p>Further graphical parameters. For future improvements.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggplot object.
</p>


<h3>Author(s)</h3>

<p>Johan Aparicio [aut]
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(agridat)
library(agriutilities)
data(besag.met)
dat &lt;- besag.met
results &lt;- check_design_met(
  data = dat,
  genotype = "gen",
  trial = "county",
  traits = c("yield"),
  rep = "rep",
  block = "block",
  col = "col",
  row = "row"
)
plot(results, type = "missing")
plot(results, type = "boxplot")

</code></pre>

<hr>
<h2 id='plot.metAgri'>Plot an object of class <code>metAgri</code></h2><span id='topic+plot.metAgri'></span>

<h3>Description</h3>

<p>Create several plots for an object of class <code>metAgri</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'metAgri'
plot(
  x,
  type = c("correlation", "covariance", "multi_traits"),
  filter_traits = NULL,
  text_size = 4,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.metAgri_+3A_x">x</code></td>
<td>
<p>An object inheriting from class <code>metAgri</code> resulting of
executing the function <code>met_analysis()</code></p>
</td></tr>
<tr><td><code id="plot.metAgri_+3A_type">type</code></td>
<td>
<p>A character string specifying the type of plot. &quot;correlation&quot;,
&quot;covariance&quot; or &quot;multi_traits&quot;</p>
</td></tr>
<tr><td><code id="plot.metAgri_+3A_filter_traits">filter_traits</code></td>
<td>
<p>An optional character vector to filter traits.</p>
</td></tr>
<tr><td><code id="plot.metAgri_+3A_text_size">text_size</code></td>
<td>
<p>Numeric input to define the text size.</p>
</td></tr>
<tr><td><code id="plot.metAgri_+3A_...">...</code></td>
<td>
<p>Further graphical parameters passed to <code>covcor_heat()</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggplot object.
</p>


<h3>Author(s)</h3>

<p>Johan Aparicio [aut]
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(agridat)
library(agriutilities)
data(besag.met)
dat &lt;- besag.met
results &lt;- check_design_met(
  data = dat,
  genotype = "gen",
  trial = "county",
  traits = c("yield"),
  rep = "rep",
  block = "block",
  col = "col",
  row = "row"
)
out &lt;- single_trial_analysis(results, progress = FALSE)
met_results &lt;- met_analysis(out, progress = FALSE)
print(met_results)
plot(met_results, type = "correlation")
plot(met_results, type = "covariance")

## End(Not run)
</code></pre>

<hr>
<h2 id='plot.smaAgri'>Plot an object of class <code>smaAgri</code></h2><span id='topic+plot.smaAgri'></span>

<h3>Description</h3>

<p>Create several plots for an object of class <code>smaAgri</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'smaAgri'
plot(
  x,
  type = c("summary", "correlation", "spatial"),
  filter_traits = NULL,
  nudge_y_cv = 3,
  nudge_y_h2 = 0.07,
  horizontal = FALSE,
  theme_size = 15,
  axis_size = 8,
  text_size = 4,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.smaAgri_+3A_x">x</code></td>
<td>
<p>An object inheriting from class <code>smaAgri</code> resulting of
executing the function <code>single_trial_analysis()</code></p>
</td></tr>
<tr><td><code id="plot.smaAgri_+3A_type">type</code></td>
<td>
<p>A character string specifiying the type of plot. &quot;summary&quot;,
&quot;correlation&quot; or &quot;spatial&quot;.</p>
</td></tr>
<tr><td><code id="plot.smaAgri_+3A_filter_traits">filter_traits</code></td>
<td>
<p>An optional character vector to filter traits.</p>
</td></tr>
<tr><td><code id="plot.smaAgri_+3A_nudge_y_cv">nudge_y_cv</code></td>
<td>
<p>Vertical adjustment to nudge labels by when plotting CV
bars. Only works if the argument type is &quot;summary&quot;. 3 by default.</p>
</td></tr>
<tr><td><code id="plot.smaAgri_+3A_nudge_y_h2">nudge_y_h2</code></td>
<td>
<p>Vertical adjustment to nudge labels by when plotting h2
bars. Only works if the argument type is &quot;summary&quot;. 0.07 by default.</p>
</td></tr>
<tr><td><code id="plot.smaAgri_+3A_horizontal">horizontal</code></td>
<td>
<p>If <code>FALSE</code>, the default, the labels are plotted
vertically. If <code>TRUE</code>, the labels are plotted horizontally.</p>
</td></tr>
<tr><td><code id="plot.smaAgri_+3A_theme_size">theme_size</code></td>
<td>
<p>Base font size, given in pts. 15 by default.</p>
</td></tr>
<tr><td><code id="plot.smaAgri_+3A_axis_size">axis_size</code></td>
<td>
<p>Numeric input to define the axis size.</p>
</td></tr>
<tr><td><code id="plot.smaAgri_+3A_text_size">text_size</code></td>
<td>
<p>Numeric input to define the text size.</p>
</td></tr>
<tr><td><code id="plot.smaAgri_+3A_...">...</code></td>
<td>
<p>Further graphical parameters. For future improvements.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggplot object.
</p>


<h3>Author(s)</h3>

<p>Johan Aparicio [aut]
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(agridat)
library(agriutilities)
data(besag.met)
dat &lt;- besag.met
results &lt;- check_design_met(
  data = dat,
  genotype = "gen",
  trial = "county",
  traits = c("yield"),
  rep = "rep",
  block = "block",
  col = "col",
  row = "row"
)
out &lt;- single_trial_analysis(results, progress = FALSE)
print(out)
plot(out, type = "summary", horizontal = TRUE)
plot(out, type = "correlation")
plot(out, type = "spatial")

</code></pre>

<hr>
<h2 id='print.checkAgri'>Print an object of class <code>checkAgri</code></h2><span id='topic+print.checkAgri'></span>

<h3>Description</h3>

<p>Prints information about <code>check_design_met()</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'checkAgri'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.checkAgri_+3A_x">x</code></td>
<td>
<p>An object fitted with the function <code>check_design_met()</code>.</p>
</td></tr>
<tr><td><code id="print.checkAgri_+3A_...">...</code></td>
<td>
<p>Options used by the tibble package to format the output. See
'tibble::print()' for more details.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an object inheriting from class <code>checkAgri</code>.
</p>


<h3>Author(s)</h3>

<p>Johan Aparicio [aut]
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(agridat)
library(agriutilities)
data(besag.met)
dat &lt;- besag.met
results &lt;- check_design_met(
  data = dat,
  genotype = "gen",
  trial = "county",
  traits = c("yield"),
  rep = "rep",
  block = "block",
  col = "col",
  row = "row"
)
print(results)
</code></pre>

<hr>
<h2 id='print.metAgri'>Print an object of class <code>metAgri</code></h2><span id='topic+print.metAgri'></span>

<h3>Description</h3>

<p>Prints information about <code>met_analysis()</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'metAgri'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.metAgri_+3A_x">x</code></td>
<td>
<p>An object fitted with the function <code>met_analysis()</code>.</p>
</td></tr>
<tr><td><code id="print.metAgri_+3A_...">...</code></td>
<td>
<p>Options used by the tibble package to format the output. See
'tibble::print()' for more details.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an object inheriting from class <code>metAgri</code>.
</p>


<h3>Author(s)</h3>

<p>Johan Aparicio [aut]
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(agridat)
library(agriutilities)
data(besag.met)
dat &lt;- besag.met
results &lt;- check_design_met(
  data = dat,
  genotype = "gen",
  trial = "county",
  traits = c("yield"),
  rep = "rep",
  block = "block",
  col = "col",
  row = "row"
)
out &lt;- single_trial_analysis(results, progress = FALSE)
met_results &lt;- met_analysis(out, progress = FALSE)
print(met_results)

## End(Not run)
</code></pre>

<hr>
<h2 id='print.smaAgri'>Print an object of class <code>smaAgri</code></h2><span id='topic+print.smaAgri'></span>

<h3>Description</h3>

<p>Prints information about <code>single_trial_analysis</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'smaAgri'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.smaAgri_+3A_x">x</code></td>
<td>
<p>An object fitted with the function <code>single_trial_analysis()</code>.</p>
</td></tr>
<tr><td><code id="print.smaAgri_+3A_...">...</code></td>
<td>
<p>Options used by the tibble package to format the output. See
'tibble::print()' for more details.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an object inheriting from class <code>smaAgri</code>.
</p>


<h3>Author(s)</h3>

<p>Johan Aparicio [aut]
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(agridat)
library(agriutilities)
data(besag.met)
dat &lt;- besag.met
results &lt;- check_design_met(
  data = dat,
  genotype = "gen",
  trial = "county",
  traits = c("yield"),
  rep = "rep",
  block = "block",
  col = "col",
  row = "row"
)
out &lt;- single_trial_analysis(results, progress = FALSE)
print(out)

</code></pre>

<hr>
<h2 id='single_trial_analysis'>Single Trial Analysis</h2><span id='topic+single_trial_analysis'></span>

<h3>Description</h3>

<p>The results of the <code>check_design_met()</code> function are used in
<code>single_trial_analysis()</code> to fit single trial models. This function can
fit, Completely Randomized Designs (CRD), Randomized Complete Block Designs
(RCBD), Resolvable Incomplete Block Designs (res-IBD), Non-Resolvable
Row-Column Designs (Row-Col) and Resolvable Row-Column Designs (res-Row-Col).
</p>
<p>Returns an object of class <code>smaAgri</code>, with a list of trial summary,
BLUEs, BLUPs, heritability, variance components, potential extreme
observations, residuals,
the models fitted and the data used.
This function will generate the required output to be used in the two-stage
analysis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>single_trial_analysis(
  results = NULL,
  progress = TRUE,
  engine = "asreml",
  remove_outliers = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="single_trial_analysis_+3A_results">results</code></td>
<td>
<p>Object of class <code>checkAgri</code> resulting of executing
<code>check_design_met()</code> function.</p>
</td></tr>
<tr><td><code id="single_trial_analysis_+3A_progress">progress</code></td>
<td>
<p>Should the progress of the modeling be printed.
If <code>TRUE</code>, for every trial a line is output indicating the traits fitted
for the particular trial.</p>
</td></tr>
<tr><td><code id="single_trial_analysis_+3A_engine">engine</code></td>
<td>
<p>A character string specifying the name of the mixed modeling
engine to use, either <code>lme4</code> or <code>asreml</code>. For spatial designs,
<code>SpATS</code> is always used, for other designs <code>asreml</code> as a default.</p>
</td></tr>
<tr><td><code id="single_trial_analysis_+3A_remove_outliers">remove_outliers</code></td>
<td>
<p>Should outliers be removed? <code>FALSE</code> by default.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>smaAgri</code>, with a list of:
</p>
<table role = "presentation">
<tr><td><code>fitted_models</code></td>
<td>
<p>A list containing the fitted models. (Both models, the
one with Genotype as Random and the one with Genotype as Fixed)</p>
</td></tr>
<tr><td><code>resum_fitted_model</code></td>
<td>
<p>A data.frame containing a summary of the fitted
models.</p>
</td></tr>
<tr><td><code>outliers</code></td>
<td>
<p>A data.frame containing extreme observations. If
<code>remove_outliers</code> is <code>TRUE</code>, this data.frame will contain the
observations removed.</p>
</td></tr>
<tr><td><code>blues_blups</code></td>
<td>
<p>A data.frame containing BLUPs/BLUEs for all the genotypes
in each trial.</p>
</td></tr>
<tr><td><code>std_residuals</code></td>
<td>
<p>A data.frame containing the standardized residuals for
the model with genotype as random component.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>A data.frame containing the data used. If <code>remove_outliers</code>
is <code>TRUE</code>, data will have missing values for the outliers detected.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
library(agridat)
library(agriutilities)
data(besag.met)
dat &lt;- besag.met
results &lt;- check_design_met(
  data = dat,
  genotype = "gen",
  trial = "county",
  traits = c("yield"),
  rep = "rep",
  block = "block",
  col = "col",
  row = "row"
)
out &lt;- single_trial_analysis(results, progress = FALSE)
print(out)

</code></pre>

<hr>
<h2 id='stability'>Stability Coefficients</h2><span id='topic+stability'></span>

<h3>Description</h3>

<p>Stability Coefficients
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stability(
  predictions = NULL,
  genotype = NULL,
  trial = NULL,
  response = NULL,
  best = "max"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="stability_+3A_predictions">predictions</code></td>
<td>
<p>A data.frame with one value per GxE combination.</p>
</td></tr>
<tr><td><code id="stability_+3A_genotype">genotype</code></td>
<td>
<p>A character string indicating the column in predictions that
contains genotypes.</p>
</td></tr>
<tr><td><code id="stability_+3A_trial">trial</code></td>
<td>
<p>A character string indicating the column in predictions that
contains trials.</p>
</td></tr>
<tr><td><code id="stability_+3A_response">response</code></td>
<td>
<p>A character string specifying the response variable.</p>
</td></tr>
<tr><td><code id="stability_+3A_best">best</code></td>
<td>
<p>A character string specifying how to define the best genotype
by numeric value (&quot;min&quot;, &quot;max&quot;). &quot;max&quot; by default.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame with several stability measures.
&quot;superiority&quot; (cultivar-superiority measure), &quot;static&quot; (Shukla's stability
variance) and &quot;wricke&quot; (Wricke's ecovalence).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(agridat)
library(agriutilities)

data(besag.met)
dat &lt;- besag.met
results &lt;- check_design_met(
  data = dat,
  genotype = "gen",
  trial = "county",
  traits = c("yield"),
  rep = "rep",
  block = "block",
  col = "col",
  row = "row"
)
out &lt;- single_trial_analysis(results, progress = FALSE)
met_results &lt;- met_analysis(out, progress = FALSE)

head(
  stability(
    predictions = met_results$BLUPs_GxE,
    genotype = "genotype",
    trial = "trial",
    response = "predicted.value"
  )
)

## End(Not run)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
