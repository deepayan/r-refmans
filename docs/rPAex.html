<!DOCTYPE html><html><head><title>Help for package rPAex</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {rPAex}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#borderPoint'>
<p>Border in the experimental units</p></a></li>
<li><a href='#cassava'><p> Cassava crop</p></a></li>
<li><a href='#cropTime'>
<p>Spectral evolution of cassava cultivation</p></a></li>
<li><a href='#designRaster'>
<p>Experimental Design on a Raster Image</p></a></li>
<li><a href='#EUsPoint'><p>Generates the matrix Q of a particular experimental unit</p></a></li>
<li><a href='#fixedPoint'>
<p>Orientation, Position and Length of the Experimental Unit</p></a></li>
<li><a href='#fourPoint'><p>Generating the Fourth Point of the Study Plot</p></a></li>
<li><a href='#imageField'><p>Matching Pixels With Field Book</p></a></li>
<li><a href='#movePlot'><p>Rotation and Translation of the Plot Position</p></a></li>
<li><a href='#rPAex'>
<p>Automatic Detection of Experimental Unit in Precision Agriculture</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Automatic Detection of Experimental Unit in Precision
Agriculture</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.5</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-11-01</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Felipe de Mendiburu &lt;fmendiburu@lamolina.edu.pe&gt;</td>
</tr>
<tr>
<td>Imports:</td>
<td>terra, agricolae</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Description:</td>
<td>A part of precision agriculture is linked to the spectral image obtained from the cameras. With the image information of the agricultural experiment, the included functions facilitate the collection of spectral data associated with the experimental units. Some designs generated in R are linked to the images, which allows the use of the information of each pixel of the image in the experimental unit and the treatment. Tables and images are generated for the analysis of the precision agriculture experiment during the entire vegetative period of the crop.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL]</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-11-01 22:18:45 UTC; felipe</td>
</tr>
<tr>
<td>Author:</td>
<td>Felipe de Mendiburu [aut, cre],
  David Mauricio [aut],
  Rodrigo Morales [aut],
  Roberto Quiroz [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-11-02 01:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='borderPoint'>
Border in the experimental units
</h2><span id='topic+borderPoint'></span>

<h3>Description</h3>

<p>Generates the spectral information of the edge of the EUs for analysis of the border effect, it requires the spectral image, the distance of the border and the segmentation of the EUs generated by imageField. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>borderPoint(r,Rbook,distance,plotting=TRUE,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="borderPoint_+3A_r">r</code></td>
<td>
<p>spectral image</p>
</td></tr>
<tr><td><code id="borderPoint_+3A_rbook">Rbook</code></td>
<td>
<p>Object generated by imageField</p>
</td></tr>
<tr><td><code id="borderPoint_+3A_distance">distance</code></td>
<td>
<p>distance defining the border of the exterior to the experimental plot</p>
</td></tr>
<tr><td><code id="borderPoint_+3A_plotting">plotting</code></td>
<td>
<p>Logic value to display the image of the border effect around the EUs</p>
</td></tr>
<tr><td><code id="borderPoint_+3A_...">...</code></td>
<td>
<p>plot parameter to document the image as main, axis, etc</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Set the border in terms of distance in units measured in the field
</p>


<h3>Value</h3>

<table>
<tr><td><code>Qborder</code></td>
<td>
<p>Border bounds matrix</p>
</td></tr> 
<tr><td><code>border</code></td>
<td>
<p>dataframe spectral border and that is expressed in the image.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Felipe de Mendiburu
</p>


<h3>See Also</h3>

<p><code><a href="#topic+cassava">cassava</a></code>, <code><a href="#topic+fourPoint">fourPoint</a></code>, <code><a href="#topic+imageField">imageField</a></code> 
</p>


<h3>Examples</h3>

<pre><code class='language-R'># use cassava crop information
library(rPAex)
data(cassava)
r &lt;- terra::rast(cassava,type="xyz")
# cassava area
# Apply: x11()
terra::image(r,axes=FALSE)
# p &lt;- locator(3) to generate 3 points in the area
p&lt;-list(x=c(287689.4, 287702.8, 287706.2),y=c(8664210, 8664214, 8664179))
# Generate the fourth points of the area
q&lt;-fourPoint(p)
op&lt;-par(mfrow=c(1,3),mar=c(0,0,0,0))
terra::image(r,axes=FALSE)
text(287693.3,8664215,"Image crop",cex=1.5)
r &lt;- terra::rast(cassava,type="xyz")
# cassava area
# Apply: p &lt;- locator(3) to generate 3 points in the area

p&lt;-list(x=c(287689.4, 287702.8, 287706.2),y=c(8664210, 8664214, 8664179))
# Generate the fourth points of the area
q&lt;-fourPoint(p)
op&lt;-par(mfrow=c(1,3),mar=c(0,0,0,0))
terra::image(r,axes=FALSE)
text(287693.3,8664215,"Image crop",cex=1.5)
# The area is divided into 3x2 plots of 11x6 meters per experimental unit
Rbook&lt;-imageField(r,q,3,2,11,6,plotting=TRUE)
out&lt;-borderPoint(r,Rbook,distance=1,axes=FALSE)
text(287693.4, 8664214, "Border",cex=1.5)
# NDVI in border
ndvi&lt;-with(out$Border, (L1-L2)/(L1+L2))
# NDVI &gt; 0.5 more probability of vegetation
plt&lt;-out$Border[ndvi&gt;0.5,1:2]
w&lt;-terra::rast(out$Border)
text(287693.3,8664215,"Border",cex=1,5)
terra::image(w,axes=FALSE)
text(287693.3,8664215,"Vegetation",cex=1.5)
points(plt,cex=0.2,col=colors()[51],pch=20)
par(op)
</code></pre>

<hr>
<h2 id='cassava'> Cassava crop</h2><span id='topic+cassava'></span>

<h3>Description</h3>

<p>The image of the cassava crop corresponds to flight 11 recorded by the drone on February 26, 2015 at the International Potato Center, with a multispectral camera. The cultivation area includes 6 plots of 11 x 6 meters. Due to the size of the images, only image 11 was used in rPAex.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("cassava")</code></pre>


<h3>Format</h3>

<p>A data frame with 262056 observations on the following 5 variables.
</p>

<dl>
<dt><code>x</code></dt><dd><p>coordinate X, a numeric vector</p>
</dd>
<dt><code>y</code></dt><dd><p>coordinate Y, a numeric vector</p>
</dd>
<dt><code>L1</code></dt><dd><p>Near-Infrared Light (NIR), a numeric vector </p>
</dd>
<dt><code>L2</code></dt><dd><p>Red band, a numeric vector</p>
</dd>
<dt><code>L3</code></dt><dd><p>Green band, a numeric vector</p>
</dd>
</dl>



<h3>Details</h3>

<p>The cassava crop data was built with the TTC_0559_georeferenced.tif image (Loayza, 2018) and the terra package (Hijmans, 2023). 
</p>


<h3>Source</h3>

<p>International Potato Center. CIP - Lima Peru. Dataverse CIP.
</p>


<h3>References</h3>

<p>Loayza, Hildo; Silva, Luis; Palacios, Susan; Balcazar, Mario; Quiroz, Roberto, 2018, &quot;Dataset for: Modelling crops using high resolution multispectral images&quot;, &lt;doi: 10.21223/P3/UVWVLA&gt;, International Potato Center, V1 <br />
Hijmans R (2023). _terra: Spatial Data Analysis. https://CRAN.R-project.org/package=terra
</p>


<h3>See Also</h3>

<p><code><a href="#topic+cropTime">cropTime</a></code>, <code><a href="#topic+EUsPoint">EUsPoint</a></code>, <code><a href="#topic+imageField">imageField</a></code>, <code><a href="#topic+borderPoint">borderPoint</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>library(rPAex)
# Generation of cassava data
# download the TTC_0559_georeferenced.tif image from CIP DATAVERSE repository
# library(terra)
# img = "TTC_0559_georeferenced.tif" 
# r&lt;-rast(img)
# e = ext(287688, 287709, 8664174, 8664217)
# rc = crop(r, e)
# terra::image(rc) # Image cassava
# to use locator(), fourPoint() and imageField() to generate the cassava data
data(cassava)
# Contains 262056 pixels of 5 centimeters each with multispectral data
r&lt;-terra::rast(cassava,type="xyz")
terra::image(r) # Image cassava
</code></pre>

<hr>
<h2 id='cropTime'>
Spectral evolution of cassava cultivation
</h2><span id='topic+cropTime'></span>

<h3>Description</h3>

<p>Spectral data of the cassava crop during its development, of the 38 spectral images of the data repository of the International Potato Center, plot number 3 of 6 cultivated, is described in 9 moments of its development, obtaining near-infrared, red responses and green
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("cropTime")</code></pre>


<h3>Format</h3>

<p>A data frame with 172263 observations on the following 6 variables.
</p>

<dl>
<dt><code>Flight</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>x</code></dt><dd><p>coordinate X, a numeric vector</p>
</dd>
<dt><code>y</code></dt><dd><p>coordinate Y, a numeric vector</p>
</dd>
<dt><code>L1</code></dt><dd><p>Near-Infrared Light (NIR), a numeric vector </p>
</dd>
<dt><code>L2</code></dt><dd><p>Red band, a numeric vector</p>
</dd>
<dt><code>L3</code></dt><dd><p>Green band, a numeric vector</p>
</dd>
</dl>



<h3>Details</h3>

<p>The images were read with the rast function (Hijmans, 2023), plot 3 was located and the information of the 38 images was obtained with the rPAex imageField function. Due to the size of the images, only 9 images were used as part of the rPAex data. The images were captured with a Remotely Piloted Aircraft System (RPAS), the system included an OKtokoter platform and an multiespectral camera (MicroADC-Tetracam). The multiespectral images are composed of information in the NIR, Red and Green bands. The images were acquired at 95 meteres average flight altitude. drone flight date, began on December 18, 2014, and ended on November 4, 2015 (Loayza, 2018). The cropTime data table was built from the &quot;tif&quot; images and the terra package (Himans, 2023). The R code instructions for reading the images were similar to the &quot;cassava data&quot; construction, in which the rPAex function imageField() was added, to then select plot-3 of 9 images separated in time.
</p>


<h3>Source</h3>

<p>International Potato Center. CIP - Lima Peru. Dataverse CIP.
</p>


<h3>References</h3>

<p>Loayza, Hildo; Silva, Luis; Palacios, Susan; Balcazar, Mario; Quiroz, Roberto, 2018, 
&quot;Dataset for: Modelling crops using high resolution multispectral images&quot;, 
doi: 10.21223/P3/UVWVLA, International Potato Center, V1
</p>
<p>Hijmans R (2023). _terra: Spatial Data Analysis_. https://CRAN.R-project.org/package=terra.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+cassava">cassava</a></code>, <code><a href="#topic+EUsPoint">EUsPoint</a></code>, <code><a href="#topic+imageField">imageField</a></code>,
<code><a href="#topic+borderPoint">borderPoint</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>library(rPAex)
data(cropTime)
ndvi&lt;-with(cropTime,(L1-L2)/(L1+L2))
ndviTime&lt;-data.frame(cropTime,ndvi)
fly&lt;-c(1,  2,  6, 11, 20, 23, 30, 36, 38)
dates&lt;-c("2014-12-18","2015-01-06","2015-01-29","2015-02-26","2015-04-22",
         "2015-05-15", "2015-07-03","2015-08-13","2015-08-28")
#x11()
op&lt;-par(mfrow=c(3,3),mar=c(0,0,1,0),cex=0.8)
for(i in 1:9){
  P&lt;-ndviTime[ndviTime$Flight==fly[i],]
  P$ndvi&lt;-(P$L1-P$L2)/(P$L1+P$L2)
  I&lt;-terra::rast(P[,c(2,3,7)],type="xyz")
  terra::image(I,col= hcl.colors(12, "Greens 3", rev = TRUE),axes=FALSE, 
  main=paste("fligth:", fly[i]))
}
par(op)
</code></pre>

<hr>
<h2 id='designRaster'>
Experimental Design on a Raster Image
</h2><span id='topic+designRaster'></span>

<h3>Description</h3>

<p>It uses a design generated by the agricolae package in a raster image.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>designRaster(R,book)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="designRaster_+3A_r">R</code></td>
<td>
<p>output object imageField</p>
</td></tr>
<tr><td><code id="designRaster_+3A_book">book</code></td>
<td>
<p>function output field book design.* agricolae</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The R object contains the following information: pixel coordinates and image layer information.
</p>
<p>The outDesign object is generated by the design functions of the agricolae package
</p>


<h3>Value</h3>

<table>
<tr><td><code>design</code></td>
<td>
<p>The matrix R of the image with the experimental design information</p>
</td></tr>
<tr><td><code>rasterField</code></td>
<td>
<p>the R matrix of the image with the information of the bands and 
the characteristics of the experimental design</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Felipe de Mendiburu
</p>


<h3>References</h3>

 
<p>Felipe de Mendiburu (2019). agricolae: Statistical Procedures for 
Agricultural Research. R package version 1.3-1. http://tarwi.lamolina.edu.pe/~fmendiburu\
</p>
<p>Kwanchai A. Gomez, Arturo A. Gomez (1984). Statistical Procedures for Agricultural Research. 
John Wiley &amp; Sons, new York.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+imageField">imageField</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># alpha design with 12 treatments
library(rPAex)
# r = simulated raster image data
prg1 &lt;- system.file("examples/Ex-01.R", package="rPAex")
source(prg1)
r&lt;-data1()

# Alpha design, r-raster image 
trt&lt;-1:12
t &lt;- length(trt)
# size block k
k&lt;-3
# Blocks s
s&lt;-t/k
# replications r =2
outdesign&lt;- agricolae::design.alpha(trt,k=3,r=2,serie=1)
r1&lt;-subset(outdesign$book, replication==1)
r2&lt;-subset(outdesign$book, replication==2)
#--------
#x11()
op&lt;-par(mar=c(2,2,3,2),cex=0.8)
terra::image(r,main="alpha design in the image 
with the distribution of treatments",col=col2rgb(10),axes=FALSE)
axis(1); axis(2,seq(0,100,20))
#P&lt;-locator(3)
p1&lt;-list(x=c(4.27, 35.42, 47.49),y=c(68.12, 70.82, 23.63))
q1&lt;-fourPoint(p1)
p2&lt;-list(x=c(50.27, 81.42, 93.49),y=c(68.12, 70.82, 23.63))
q2&lt;-fourPoint(p2)
polygon(q1,lwd=3,lty=2,border=colors()[51])
polygon(q2,lwd=3,lty=2,border=colors()[51])
R1&lt;-imageField(r, Q=q1, ny=4, nx=3, dy=10, dx=9,col=colors()[18])
R2&lt;-imageField(r, Q=q2, ny=4, nx=3, dy=10, dx=9,col=colors()[18])
q1&lt;-designRaster(R=R1$Qbase,book=r1)$design
q2&lt;-designRaster(R=R2$Qbase,book=r2)$design
text(q1[,6],q1[,7],q1[,4])
text(q2[,6],q2[,7],q2[,4])
par(op)
</code></pre>

<hr>
<h2 id='EUsPoint'>Generates the matrix Q of a particular experimental unit</h2><span id='topic+EUsPoint'></span>

<h3>Description</h3>

<p>The Q matrix is formed by 4 points that limits the Experimental unit, this matrix is used by the imageField function to generate the units, by obtaining the Q matrix of an unit, it is possible to generate subplots of the units.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  EUsPoint(Rbook,EU)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="EUsPoint_+3A_rbook">Rbook</code></td>
<td>
<p>object imagenField</p>
</td></tr>
<tr><td><code id="EUsPoint_+3A_eu">EU</code></td>
<td>
<p>constant. number of experimental unit</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>Q</code></td>
<td>
<p>matrix, four points</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+imageField">imageField</a></code>, <code><a href="#topic+cassava">cassava</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  library(rPAex)
  data(cassava)
  s &lt;- terra::rast(cassava,type="xyz")
  # Use image and locator(2)
  #x11()
  op&lt;-par(mar=c(2,2,3,2),cex=0.8)
  # terra::image(s)
  # p&lt;-locator(2)
  # e&lt;-terra::ext(unlist(p))
  e &lt;- terra::ext(287691.9, 287708.6, 8664188, 8664203)
  r &lt;- terra::crop(s,e)
  #-----
  # Define the border of the plot
  # p&lt;-locator(3)
  p&lt;-list(x=c(287698.21, 287700.99, 287702.39), y=c(8664200.68, 8664201.57,8664190.63))
  q&lt;-fourPoint(p)
  #-----
  # Define a subarea of 11x3 units by 1x0.9 meters
  ny&lt;-11; nx&lt;-3; dy=1; dx=0.9
  terra::image(r,main="Cassava crop\nnear infrared image",bty="l")
  Rbook&lt;-imageField(r, q, ny, nx, dy, dx, plotting = TRUE, border="blue",lwd=1)
  # identify unit 11 with the spectral information
  Q&lt;-EUsPoint(Rbook,EU=11) 
  polygon(Q,col="black")
  pol &lt;- terra::vect(Q, "polygons")
  R &lt;- terra::extract(r, pol, xy = TRUE)
  head(R)
  par(op)
</code></pre>

<hr>
<h2 id='fixedPoint'>
Orientation, Position and Length of the Experimental Unit
</h2><span id='topic+fixedPoint'></span>

<h3>Description</h3>

<p>Generates a number of equidistant spatial points in an area. Fixed a couple of points in the image and the number of segments included, the function determines the position of the segments according to the length of the segment. The function relates the real dimension of the segment measurement to the image dimension. The function is useful for sizing plot sizes in the field, it also facilitates the generation of experimental units in the field.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fixedPoint(start, end, segments, length)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fixedPoint_+3A_start">start</code></td>
<td>
<p> Starting point
</p>
</td></tr>
<tr><td><code id="fixedPoint_+3A_end">end</code></td>
<td>

<p>Point at the end
</p>
</td></tr>
<tr><td><code id="fixedPoint_+3A_segments">segments</code></td>
<td>

<p>Number of segments
</p>
</td></tr>
<tr><td><code id="fixedPoint_+3A_length">length</code></td>
<td>

<p>Segment length
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is used by imageField.
</p>


<h3>Value</h3>

<table>
<tr><td><code>xy</code></td>
<td>
<p>Data vector with the coordinate of the points </p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+imageField">imageField</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(rPAex)
prg1 &lt;- system.file("examples/Ex-01.R", package="rPAex")
source(prg1)
r&lt;-data1()
#x11()
op&lt;-par(mar=c(2,2,4,2),cex=0.8)
terra::image(r,col=col2rgb(10),main="Orientation, position and length of the experimental
 unit\nstart = P1, end = P2, segments=4 and segment length = 10",bty="l")
P&lt;-list(x=c(20,80),y=c(40,80)) # or P&lt;-locator(2)
P&lt;-cbind(x=P$x,y=P$y)
Q&lt;-fixedPoint(start = P[1,],end = P[2,],4,length = 10)
x &lt;- Q[,1]; y &lt;- Q[,2]
s &lt;- seq(length(x)-1)  # one shorter than data
segments(x[s], y[s], x[s+1], y[s+1], col= c(1,0),lwd=2) 
# Description:
text(Q,cex=2,col="red")
text(20,80,"Total length   = 72.11 units")
text(20,70,"total segments = 4")
text(60,40,"   Free space  = 10.7037 units")
text(60,30,"Segment length = 10 units")
text(50,10,"fixedPoint(start ,end ,segments = 4,length = 10)")
text(20,35,"start",cex=1.5)
text(80,75,"end",cex=1.5)
par(op)
</code></pre>

<hr>
<h2 id='fourPoint'>Generating the Fourth Point of the Study Plot</h2><span id='topic+fourPoint'></span>

<h3>Description</h3>

<p>Generate the fourth reference point of the plot according to three defined geo-referential points. This function is important for the correct use of all the functions of the rPAex package. In the image the plot is a parallelogram, the first assigned point must be located in the upper left and continue the second point in the upper right side and the third point in the lower right, always in a clockwise direction.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fourPoint(P)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fourPoint_+3A_p">P</code></td>
<td>
<p>the three points list</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>P</code></td>
<td>
<p>matrix, four points</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+imageField">imageField</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(rPAex)
prg1 &lt;- system.file("examples/Ex-01.R", package="rPAex")
source(prg1)
r&lt;-data1()
# x11()
op&lt;-par(mar=c(2,2,4,2),cex=0.8)
terra::image(r,main="Generating the fourth point of the study plot",col=col2rgb(10),
xlim=c(20,101), ylim=c(0,101),axes=FALSE)
# p&lt;-locator(3)
p&lt;-list(x=c(40, 88, 80) , y=c(83, 82, 19))
q&lt;-fourPoint(p)
polygon(q,lty=2,lwd=2)
text(q,cex=2)
points(q[4,1],q[4,2],cex=6,col=2,lwd=2)
d&lt;-dist(q)
text(64,86,round(d[1],1),cex=1.5)
text(90,52,round(d[3],1),cex=1.5)
text(29,53,round(d[4],1),cex=1.5)
text(58,15,round(d[6],1),cex=1.5)
par(op)
# x11()
op &lt;-par(mar=c(2,2,4,2),cex=0.8)
# An irregular area, use 4 points with p&lt;-locator(4) and apply q&lt;-fourPoint(p) to form the matrix
terra::image(r,bty="l",main="An irregular area")
#p&lt;-locator(4)
p&lt;-list(x=c(40, 88, 80, 29) , y=c(83, 82, 19, 20))
q&lt;-fourPoint(p)
d&lt;-dist(q)
polygon(q)
text(64,86,round(d[1],1),cex=1.5)
text(90,52,round(d[3],1),cex=1.5)
text(29,53,round(d[4],1),cex=1.5)
text(56,15,round(d[6],1),cex=1.5)
nx&lt;-2;ny&lt;-3 
dy=d[3]/ny;dx=d[1]/nx
# EU area= dx*dy
out&lt;-imageField(r,q,ny,nx,dy,dx)
par(op) 
# number of pixels per EU
table(out$Qbase$EU)
</code></pre>

<hr>
<h2 id='imageField'>Matching Pixels With Field Book</h2><span id='topic+imageField'></span>

<h3>Description</h3>

<p>The function uses the raster image of all bands. It generates the limits of the unit and extracts the values of each pixel of the plot n x m units (n, m = 1,2, ...). The function requires the dimensions of the unit observed and the number of units per row (width) and column (length). The result is a table with image information and the characteristics of the experimental unit.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>imageField(r, Q, ny, nx, dy, dx,  start=1, plotting = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="imageField_+3A_r">r</code></td>
<td>
<p>raster image</p>
</td></tr>
<tr><td><code id="imageField_+3A_q">Q</code></td>
<td>
<p>References points of de area</p>
</td></tr>
<tr><td><code id="imageField_+3A_ny">ny</code></td>
<td>
<p>Number of experimental units along the plot (y axis)</p>
</td></tr>
<tr><td><code id="imageField_+3A_nx">nx</code></td>
<td>
<p>Number of experimental units across the plot (x axis)</p>
</td></tr>
<tr><td><code id="imageField_+3A_dy">dy</code></td>
<td>
<p>Wide of unit plots</p>
</td></tr>
<tr><td><code id="imageField_+3A_dx">dx</code></td>
<td>
<p>Length of unit plots</p>
</td></tr>
<tr><td><code id="imageField_+3A_start">start</code></td>
<td>
<p>Number of the first experimental unit</p>
</td></tr>
<tr><td><code id="imageField_+3A_plotting">plotting</code></td>
<td>
<p>Overlap the units in the area, TRUE or FALSE</p>
</td></tr>
<tr><td><code id="imageField_+3A_...">...</code></td>
<td>
<p>Other parameters the plot</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>parameters</code></td>
<td>
<p>Parameters of experimental design in precision agriculture</p>
</td></tr>
<tr><td><code>Qbase</code></td>
<td>
<p>Image data frame with location in field</p>
</td></tr>
<tr><td><code>coordinates.EU</code></td>
<td>
<p>The limits of each experimental unit</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+EUsPoint">EUsPoint</a></code>, <code><a href="#topic+fixedPoint">fixedPoint</a></code>, 
<code><a href="#topic+fourPoint">fourPoint</a></code>, <code><a href="#topic+designRaster">designRaster</a></code>, <code><a href="#topic+cassava">cassava</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(rPAex)
data(cassava)
r &lt;- terra::rast(cassava, type="xyz")
# x11()
# terra::image(r)
# p&lt;-locator(2)
# e&lt;-terra::ext(unlist(p))
e &lt;- terra::ext(287691.9, 287708.6, 8664188, 8664203)
rc &lt;- terra::crop(r,e)
# Selection of experimental units, p1 and p2 in terra::image(r)
p1&lt;-list(x=c(287698.34, 287701.14, 287702.33), 
         y=c(8664200.89, 8664201.65, 8664190.67))
p2&lt;-list(x=c(287701.56, 287704.37, 287705.24),
	 y=c(8664198.68, 8664199.44, 8664191.46))        
q1&lt;-fourPoint(p1)
q2&lt;-fourPoint(p2)
# dimension of the experimental unit
dy=1; dx=0.9
op&lt;-par(mar=c(0,0,3,0))
terra::image(rc,main="Selection of experimental units\nCassava crop",axes=FALSE)
img1&lt;-imageField(rc, q1, ny=11, nx=3, dy, dx, plotting = TRUE, border="blue",lwd=1)
img2&lt;-imageField(rc, q2, ny=8, nx=3, dy, dx, start=34,plotting = TRUE, border="blue",lwd=1)
# Spectral data of selected units
R&lt;-rbind(img1$Qbase,img2$Qbase)
head(R)
Q&lt;-agricolae::tapply.stat(R[,2:3],R[,1],mean)
text(Q[,2],Q[,3],Q[,1],cex=1)
par(op)
</code></pre>

<hr>
<h2 id='movePlot'>Rotation and Translation of the Plot Position
</h2><span id='topic+movePlot'></span>

<h3>Description</h3>

<p>The coordinates of the plot generated with the locate() and fourPoint() functions define the experimental units with the field dimensions, In the successive images in time, these may have some difference in position and it is necessary to adapt the experimental units to obtain exactly the information within the unit.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>movePlot(Q,q)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="movePlot_+3A_q">Q</code></td>
<td>
<p>matrix. Four points of the plot as described by the fourPoint function</p>
</td></tr>
<tr><td><code id="movePlot_+3A_q">q</code></td>
<td>
<p>matrix or list. Two points, the first one sets the position and the second the orientation </p>
</td></tr>
</table>


<h3>Details</h3>

<p>The matrix Q has the points organized according to the fourPoint function. To know the numbering in the plane, execute text(Q). The first must be the upper left and numbered clockwise.
</p>


<h3>Value</h3>

<table>
<tr><td><code>q</code></td>
<td>
<p>matrix. Four points of the new plot as described by the fourPoint function</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Felipe de Mendiburu
</p>


<h3>See Also</h3>

 <p><code><a href="#topic+imageField">imageField</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(rPAex)
op&lt;-par(mfrow=c(1,3),mar=c(0,0,0,0))
# Coordinates during initial flight
plot(0,0,xlim=c(0.08,0.9),ylim=c(0.1,0.9),axes=FALSE)
# x11(); p0&lt;-locator(3)
p0&lt;-list(x=c(0.20, 0.64, 0.81),y=c(0.71, 0.83, 0.40)) 
Q0&lt;-fourPoint(p0)
dp&lt;-dist(Q0)
text(Q0[,1],Q0[,2],paste("(",Q0[,1],",",Q0[,2], ")",sep=""),cex=1.2)
polygon(Q0,border="blue",lwd=1.5)
centro&lt;-apply(Q0,2,mean)
areaEU&lt;-round(dp[1]*dp[2],4)
text(centro[1],centro[2],paste("Area=",areaEU),col="blue")
text(0.50,0.2,"old plot",cex=1.5)
#-------
# Change of coordinates effect of flight, correction to initial flight
plot(0,0,xlim=c(0.08,0.9),ylim=c(0.1,0.9),axes=FALSE)
polygon(Q0,border="blue",lwd=1.5)
text(Q0,cex=1.5)
# x11(); s &lt;-locator(3)
s&lt;-list(x=c(0.2,0.62),y=c(0.71,0.73))
Qs&lt;-movePlot(Q0,s)
centro&lt;-apply(Qs,2,mean)
polygon(Qs,border="red",lty=2,lwd=1.5)
text(Qs,cex=1.5)
text(centro[1],centro[2]+0.05,paste("Area=",areaEU),col="red")
text(centro[1],0.9,"Change position\n of the new images",cex=1.5)
text(0.50,0.2,"change position",cex=1.5)
#--------
# correction result
plot(0,0,xlim=c(0.08,0.9),ylim=c(0.1,0.9),axes=FALSE)
polygon(Qs,border="red",lwd=1.5)
text(Qs,cex=1.5)
text(centro[1],centro[2],paste("Area=",areaEU),col="red")
text(0.50,0.2,"new plot",cex=1.5)
par(op)
</code></pre>

<hr>
<h2 id='rPAex'>
Automatic Detection of Experimental Unit in Precision Agriculture
</h2><span id='topic+rPAex-package'></span><span id='topic+rPAex'></span>

<h3>Description</h3>

<p>The package contains functions to manage images obtained by remote sensing of the experimental fields. In the field the characteristics of the plot are defined (number of units per row and column and dimensions in meters or other dimension measures). The program uses the information to generate the limits and record the content of the different layers, as well as the coordinates of the pixels and 
the identification of the observation units in the field. It also allows to extract the experimental designs generated in agricolae package and distribute the treatments in the image according to the distribution of the generated plan. The images used in the examples were obtained from the repository of (Loayza et al. 2018) International Potato Center, V1.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> rPAex</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.0.5</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2023-11-01</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Professor Felipe de Mendiburu<br />
Systems Engineer.<br />
Universidad Nacional de Ingenieria Lima-Peru.<br />
Professor Applied Statistics<br />
Universidad Nacional Agraria La Molina, Lima-Peru.<br />
</p>
<p>Professor David Mauricio.<br />
Department of Computer Science.<br />
Universidad Nacional Mayor de San Marcos, Lima-Peru<br />
</p>
<p>Rodrigo A. Morales A. PhD <br />
Phytopathologist-Sustainable Agriculture <br />
Agricultural Research Institute of Panama (IDIAP)
</p>
<p>Professor Roberto Quiroz.<br />
Centro Agronomico Tropical de Investigacion.<br />
CATIE.<br />
</p>


<h3>References</h3>

 
<p>Loayza, Hildo; Silva, Luis; Palacios, Susan; Balcazar, Mario; Quiroz, Roberto, 2018, 
&quot;Dataset for: Modelling crops using high resolution multispectral images&quot;, doi: 10.21223/P3/UVWVLA, International Potato Center, V1.
</p>
<p>M. Montalvo, G. Pajares, J. M. Guerrero, J. Romeo, M. Guijarro, A. Ribeiro, J. J. Ruz, and J. Cruz. Automatic detection of crop rows in maize fields with high weeds pressure. Expert Systems with Applications, 39(15):11889-11897, 2012.
</p>
<p>X. Zhang, X. Li, B. Zhang, J. Zhou, G. Tian, Y. Xiong, and B. Gu. Automated robust crop-row detection in maize fields based on position clustering algorithm and shortest path method. Computers and electronics in agriculture, 154:165-175, 2018.
</p>
<p>F. de Mendiburu. A statistical analisys tool for agricultural research. Masters thesis, 
Universidad Nacional de Ingenieria. Lima-Peru, 8 2009. Degree in systems engineering.
</p>
<p>Richards, J. A. Remote sensing digital image analysis: An introduction. 2012
</p>


<h3>See Also</h3>

<p><code><a href="#topic+EUsPoint">EUsPoint</a></code>, <code><a href="#topic+fixedPoint">fixedPoint</a></code>, <code><a href="#topic+fourPoint">fourPoint</a></code>, 
<code><a href="#topic+imageField">imageField</a></code>, <code><a href="#topic+borderPoint">borderPoint</a></code>, <code><a href="#topic+designRaster">designRaster</a></code>, 
<code><a href="#topic+movePlot">movePlot</a></code>,<code><a href="#topic+cassava">cassava</a></code>,<code><a href="#topic+cropTime">cropTime</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simple examples of the most important functions
library(rPAex)
# Graeco - latin square design
T1&lt;-c("a","b","c","d")
T2&lt;-c("v","w","x","y")
outdesign &lt;- agricolae::design.graeco(T1,T2,serie=1)
book&lt;-outdesign$book
prg1 &lt;- system.file("examples/Ex-01.R", package="rPAex")
source(prg1)
r&lt;-data1()
# x11()
op&lt;-par(mar=c(2,2,4,2),cex=0.9)
terra::image(r,main="Graeco - latin square design\n
Treatments T1 (a, b, c, d) and T2 (v, w, x, y)",col=col2rgb(2),axes=FALSE,xlim=c(0,101))
axis(1);axis(2)
# 3 points are set in the image, to generate the experimental area
# P&lt;-locator(3)
P&lt;-list(x=c(20,90,80),y=c(80,90,20))
# and complete the fourth point to close the polygon.
Q&lt;-fourPoint(P)
polygon(Q,lwd=3)
R&lt;-imageField(r, Q, ny=4, nx=4, dy=12, dx=12,col=colors()[18])
q&lt;-designRaster(R$Qbase,book)$design
text(q[,6],q[,7]+2,q[,1])
text(q[,6],q[,7]-2,paste(q[,4],q[,5],sep=" - "))
par(op)
# An irregular area, use 4 points with p&lt;-locator(4) and apply q&lt;-fourPoint(p) to form the matrix
# x11()
op&lt;-par(mar=c(2,2,2,2),cex=0.9)
terra::image(r,xlim=c(20,100),ylim=c(10,100),axes=FALSE,main="An irregular area",col=col2rgb(3))
axis(1);axis(2)
# p&lt;-locator(4)
p&lt;-list(x=c(40, 88, 80, 29) , y=c(83, 82, 19, 20))
q&lt;-fourPoint(p)
dist(q)
dx=10;dy=12
nx&lt;-4; ny&lt;-5
S&lt;-imageField(r,q,ny,nx,dy,dx,col=colors()[20])
points(q,cex=4,pch=20,col="white")
text(q,cex=1.5)
M&lt;-agricolae::tapply.stat(S$Qbase[,2:3],S$Qbase$EU)
# identifying EU
text(M[,2],M[,3],M[,1],cex=1)
par(op)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
