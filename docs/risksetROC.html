<!DOCTYPE html><html><head><title>Help for package risksetROC</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {risksetROC}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#CoxWeights'><p>Incident/Dynamic (I/D) ROC curve, AUC and integrated AUC (iAUC)</p>
estimation of censored survival data</a></li>
<li><a href='#IntegrateAUC'><p>Incident/Dynamic (I/D) ROC curve, AUC and integrated AUC (iAUC)</p>
estimation of censored survival data</a></li>
<li><a href='#KM.plot'><p>Incident/Dynamic (I/D) ROC curve, AUC and integrated AUC (iAUC)</p>
estimation of censored survival data</a></li>
<li><a href='#llCoxReg'><p>Incident/Dynamic (I/D) ROC curve, AUC and integrated AUC (iAUC)</p>
estimation of censored survival data</a></li>
<li><a href='#pbc'><p>Incident/Dynamic (I/D) ROC curve, AUC and integrated AUC (iAUC)</p>
estimation of censored survival data</a></li>
<li><a href='#riskset'><p>Incident/Dynamic (I/D) ROC curve, AUC and integrated AUC (iAUC)</p>
estimation of censored survival data</a></li>
<li><a href='#risksetAUC'><p>Incident/Dynamic (I/D) ROC curve, AUC and integrated AUC (iAUC)</p>
estimation of censored survival data</a></li>
<li><a href='#risksetROC'><p>Incident/Dynamic (I/D) ROC curve, AUC and integrated AUC (iAUC)</p>
estimation of censored survival data</a></li>
<li><a href='#SchoenSmooth'><p>Incident/Dynamic (I/D) ROC curve, AUC and integrated AUC (iAUC)</p>
estimation of censored survival data</a></li>
<li><a href='#weightedKM'><p>Incident/Dynamic (I/D) ROC curve, AUC and integrated AUC (iAUC)</p>
estimation of censored survival data</a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Version:</td>
<td>1.0.4.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2012-04-13</td>
</tr>
<tr>
<td>Title:</td>
<td>Riskset ROC Curve Estimation from Censored Survival Data</td>
</tr>
<tr>
<td>Author:</td>
<td>Patrick J. Heagerty &lt;heagerty@u.washington.edu&gt;, packaging by
        Paramita Saha-Chaudhuri &lt;paramita.sahachaudhuri.work@gmail.com&gt;</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Paramita Saha-Chaudhuri
&lt;paramita.sahachaudhuri.work@gmail.com&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10), survival, MASS</td>
</tr>
<tr>
<td>Description:</td>
<td>Compute time-dependent Incident/dynamic accuracy measures
        (ROC curve, AUC, integrated AUC )from censored survival data
        under proportional or non-proportional hazard assumption of
        Heagerty &amp; Zheng (Biometrics, Vol 61 No 1, 2005, PP 92-105).</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-06-13 08:07:45 UTC; hornik</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-06-13 08:14:56 UTC</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
</table>
<hr>
<h2 id='CoxWeights'>Incident/Dynamic (I/D) ROC curve, AUC and integrated AUC (iAUC)
estimation of censored survival data</h2><span id='topic+CoxWeights'></span>

<h3>Description</h3>

<p>This function estimates of TP and FP based on a Cox
model as discussed in Heagerty and Zheng, 2005, for incident/dynamic
ROC curve. TP is estimated as Equation (1) and FP is estimated as
Equation (2) of the paper.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CoxWeights(marker, Stime, status, predict.time, entry)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CoxWeights_+3A_marker">marker</code></td>
<td>
<p>estimated linear predictor from a set of covariates. Note
that this linear predictor can be obtained from any model.</p>
</td></tr>
<tr><td><code id="CoxWeights_+3A_stime">Stime</code></td>
<td>
<p>For right censored data, this is the follow up time. For
left truncated data, this is the ending time for the interval.</p>
</td></tr>
<tr><td><code id="CoxWeights_+3A_status">status</code></td>
<td>
<p>Indicator of status, 1 if death or event, 0 otherwise.</p>
</td></tr>
<tr><td><code id="CoxWeights_+3A_predict.time">predict.time</code></td>
<td>
<p>Time point of the ROC curve.</p>
</td></tr>
<tr><td><code id="CoxWeights_+3A_entry">entry</code></td>
<td>
<p>For left truncated data, this is the entry time of
the interval. The default is set to NULL for right censored
data.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Suppose we have censored survival data (right censored or both
left-truncated and right censored data) along with a
marker value and  we want to see how well the marker predicts the 
survival time for the subjects in the dataset using Incident/dynamic
definition of ROC curve. In particular,
suppose we have survival times in days and  we want to see how well the
marker predicts the one-year survival (predict.time=365 days). This
function CoxWeights(), returns the unique marker values, TP (True
Positive), FP (False Positive)  and AUC (Area under (ROC) curve)
corresponding to the  time point of interest (predict.time). Note that
the linear predictor <em>marker</em> can be obtained from any model,
specifically, the survival model may be based on either a PH
or a time-varying Cox model.
</p>


<h3>Value</h3>

<p>Returns a list of the following items:
</p>
<table>
<tr><td><code>eta</code></td>
<td>
<p>unique marker values for calculation of TP and FP</p>
</td></tr>
<tr><td><code>TP</code></td>
<td>
<p>True Positive values corresponding to unique marker values</p>
</td></tr>
<tr><td><code>FP</code></td>
<td>
<p>False Positive values corresponding to unique marker values</p>
</td></tr>
<tr><td><code>AUC</code></td>
<td>
<p>Area Under (ROC) Curve at time predict.time</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Patrick J. Heagerty </p>


<h3>References</h3>

<p>Heagerty, P.J., Zheng Y. (2005)
Survival Model Predictive Accuracy and ROC curves
<em>Biometrics</em>, <b>61</b>, 92 &ndash; 105</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(MASS)
data(VA)
survival.time &lt;- VA$stime
survival.status &lt;- VA$status
score &lt;- VA$Karn
cell.type &lt;- factor(VA$cell )
tx &lt;- as.integer( VA$treat==1 )
age &lt;- VA$age
survival.status[VA$stime &gt; 500 ] &lt;- 0
survival.time[VA$stime &gt; 500 ] &lt;- 500
library(survival)
fit0 &lt;- coxph( Surv(survival.time,survival.status)
        ~ score + cell.type + tx + age, na.action=na.omit )
summary(fit0)
eta &lt;- fit0$linear.predictor
AUC &lt;- NULL
out &lt;- CoxWeights(marker=eta, Stime=survival.time, status=survival.status,
predict.time=30)
## to see how well the marker predicts one-month survival
AUC &lt;- out$AUC
</code></pre>

<hr>
<h2 id='IntegrateAUC'>Incident/Dynamic (I/D) ROC curve, AUC and integrated AUC (iAUC)
estimation of censored survival data</h2><span id='topic+IntegrateAUC'></span>

<h3>Description</h3>

<p>This function integrates AUC using weights
<code class="reqn">w(t) = 2*f(t)*S(t)</code>
as discussed in Heagerty and Zheng, 2005.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>IntegrateAUC(AUC, utimes, St, tmax, weight="rescale")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="IntegrateAUC_+3A_auc">AUC</code></td>
<td>
<p>Area under ROC curve at utimes</p>
</td></tr>
<tr><td><code id="IntegrateAUC_+3A_utimes">utimes</code></td>
<td>
<p>Unique event times for subjects</p>
</td></tr>
<tr><td><code id="IntegrateAUC_+3A_st">St</code></td>
<td>
<p>Estimated survival probability at utimes</p>
</td></tr>
<tr><td><code id="IntegrateAUC_+3A_tmax">tmax</code></td>
<td>
<p>Maximum time length to be considered</p>
</td></tr>
<tr><td><code id="IntegrateAUC_+3A_weight">weight</code></td>
<td>
<p>Either of &quot;rescale&quot; or &quot;conditional&quot;</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function estimates time-dependent concordance
measure </p>
<p style="text-align: center;"><code class="reqn">P(M_i&gt;M_j|T_i&lt;t, T_i&lt;tmax, T_j&gt;t)</code>
</p>
<p> as discussed in the
paper from AUC and weights derived from 
the survival time distribution. The concordance measure is estimated
under the assumption that smaller of the two event times happened
before time <em>tmax</em>. The resulting measure is an weighted sum of
estimated AUC at each unique failure time where weights are
proportional to <code class="reqn">2*f(t)*S(t)</code>, and T is failure time of interest. 
If weight=&quot;rescale&quot;, then the weights are rescaled so that the sum of
the weights is one. If weight=&quot;conditional&quot;, it is assumed that both
the events happened before <em>tmax</em>.
</p>


<h3>Value</h3>

<p>Returns the following item:
</p>
<table>
<tr><td><code>iAUC</code></td>
<td>
<p>Integrated AUC using w(t) as above as weights</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Patrick J. Heagerty </p>


<h3>References</h3>

<p>Heagerty, P.J., Zheng Y. (2005)
Survival Model Predictive Accuracy and ROC curves
<em>Biometrics</em>, <b>61</b>, 92 &ndash; 105</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(MASS)
data(VA)
survival.time &lt;- VA$stime
survival.status &lt;- VA$status
score &lt;- VA$Karn
cell.type &lt;- factor(VA$cell )
tx &lt;- as.integer( VA$treat==1 )
age &lt;- VA$age
survival.status[VA$stime &gt; 500 ] &lt;- 0
survival.time[VA$stime &gt; 500 ] &lt;- 500
library(survival)
## first find the estimated survival probabilities at unique failure times
surv.prob &lt;- unique(survfit(Surv(survival.time,survival.status)~1)$surv)
fit0 &lt;- coxph( Surv(survival.time,survival.status)
        ~ score + cell.type + tx + age, na.action=na.omit )
eta &lt;- fit0$linear.predictor
model.score &lt;- eta

utimes &lt;- unique( survival.time[ survival.status == 1 ] )
utimes &lt;- utimes[ order(utimes) ]

## find AUC at unique failure times
AUC &lt;- rep( NA, length(utimes) )
for( j in 1:length(utimes) )
{
out &lt;- CoxWeights( eta, survival.time, survival.status,utimes[j])
AUC[j] &lt;- out$AUC
}
## integrated AUC to get concordance measure
iAUC &lt;- IntegrateAUC( AUC, utimes, surv.prob, tmax=365 )
</code></pre>

<hr>
<h2 id='KM.plot'>Incident/Dynamic (I/D) ROC curve, AUC and integrated AUC (iAUC)
estimation of censored survival data</h2><span id='topic+KM.plot'></span>

<h3>Description</h3>

<p>This function creates Kaplan-Meier plot.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>KM.plot(Stime, survival, max.T=NULL, lty=NULL, all=TRUE, ...) 
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="KM.plot_+3A_stime">Stime</code></td>
<td>
<p>unique ordered event times</p>
</td></tr>
<tr><td><code id="KM.plot_+3A_survival">survival</code></td>
<td>
<p>estimates of survival probabilities at <em>Stime</em></p>
</td></tr>
<tr><td><code id="KM.plot_+3A_max.t">max.T</code></td>
<td>
<p>maximum time to be considered for plotting, default is
NULL which plots survival till  max(Stime)+1 units</p>
</td></tr>
<tr><td><code id="KM.plot_+3A_lty">lty</code></td>
<td>
<p>line type</p>
</td></tr>
<tr><td><code id="KM.plot_+3A_all">all</code></td>
<td>
<p>TRUE or FALSE, default is TRUE</p>
</td></tr>
<tr><td><code id="KM.plot_+3A_...">...</code></td>
<td>
<p>additional plot arguments</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function creates Kaplan-Meier plot. If <em>all=TRUE</em>, then this
creates a new plot. If <em>all=FALSE</em>, it adds line to an existing plot and
hence must be called after a plot() or similar call. 
</p>


<h3>Author(s)</h3>

<p>Patrick J. Heagerty </p>


<h3>References</h3>

<p>Heagerty, P.J., Zheng Y. (2005)
Survival Model Predictive Accuracy and ROC curves
<em>Biometrics</em>, <b>61</b>, 92 &ndash; 105</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(pbc)
## considering only randomized patients
pbc1 &lt;- pbc[1:312,]
## create new censoring variable combine 0,1 as 0, 2 as 1
survival.status &lt;- ifelse( pbc1$status==2, 1, 0)
survival.time &lt;- pbc1$fudays
kout &lt;- weightedKM(Stime=survival.time, status=survival.status)
KM.plot(kout$time,kout$survival)
</code></pre>

<hr>
<h2 id='llCoxReg'>Incident/Dynamic (I/D) ROC curve, AUC and integrated AUC (iAUC)
estimation of censored survival data</h2><span id='topic+llCoxReg'></span>

<h3>Description</h3>

<p>This function estimates the time-varying parameter estimate
<code class="reqn">\beta(t)</code> of non-proportional 
hazard model using local-linear Cox regression as discussed in
Heagerty and Zheng, 2005. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>llCoxReg(Stime, entry=NULL, status, marker, span=0.40, p=1, window="asymmetric") 
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="llCoxReg_+3A_stime">Stime</code></td>
<td>
<p>For right censored data, this is the follow up time. For
left truncated data, this is the ending time for the interval.</p>
</td></tr>  
<tr><td><code id="llCoxReg_+3A_entry">entry</code></td>
<td>
<p>For left truncated data, this is the entry time of
the interval. The default is set to NULL for right censored
data.</p>
</td></tr>  
<tr><td><code id="llCoxReg_+3A_status">status</code></td>
<td>
<p>Survival status.</p>
</td></tr>
<tr><td><code id="llCoxReg_+3A_marker">marker</code></td>
<td>
<p>Marker value.</p>
</td></tr>
<tr><td><code id="llCoxReg_+3A_span">span</code></td>
<td>
<p>bandwidth parameter that controls the size of a local
neighborhood.</p>
</td></tr> 
<tr><td><code id="llCoxReg_+3A_p">p</code></td>
<td>
<p>1 if only the time-varying coefficient is of interest
and 2  if the derivative of time-varying coefficient is also of interest,
default is 1</p>
</td></tr> 
<tr><td><code id="llCoxReg_+3A_window">window</code></td>
<td>
<p>Either of &quot;asymmetric&quot; or &quot;symmetric&quot;, default is asymmetric.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function calculates the parameter estimate <code class="reqn">\beta(t)</code>
of non-proportional hazard model using local-linear Cox regression as
discussed in Heagerty and Zheng, 2005. This estimation is based on a
time-dependent Cox  model (Cai and Sun, 2003). For <em>p=1</em>, the
return item <em>beta</em> has two columns, the first column is the
time-varying parameter estimate, while the second column is the
derivative. However, if the derivative of the time-varying parameter
is of interest, then we suggest to use <em>p=2</em>. In this case,
<em>beta</em> has four columns, the first two columns are the same when
<em>p=1</em>, while the last two columns estimates the coefficients of
squared marker value and its derivative.
</p>


<h3>Value</h3>

<p>Returns a list of following items:
</p>
<table>
<tr><td><code>time</code></td>
<td>
<p>unique failure times</p>
</td></tr>
<tr><td><code>beta</code></td>
<td>
<p>estimate of time-varying parameter <code class="reqn">\beta(t)</code> at each
unique failure time. </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Patrick J. Heagerty </p>


<h3>References</h3>

<p>Heagerty, P.J., Zheng Y. (2005)
Survival Model Predictive Accuracy and ROC curves
<em>Biometrics</em>, <b>61</b>, 92 &ndash; 105</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(pbc)
## considering only randomized patients
pbc1 &lt;- pbc[1:312,]
## create new censoring variable combine 0,1 as 0, 2 as 1
survival.status &lt;- ifelse( pbc1$status==2, 1, 0)
survival.time &lt;- pbc1$fudays
pbc1$status1 &lt;- survival.status
fit &lt;- coxph( Surv(fudays,status1) ~ log(bili) +
                                     log(protime) +
                                     edema +
                                     albumin +
                                     age,
              data=pbc1 )
eta5 &lt;- fit$linear.predictors
x &lt;- eta5
nobs &lt;- length(survival.time[survival.status==1])
span &lt;- 1.0*(nobs^(-0.2))

## Not run: 
bfnx1 &lt;- llCoxReg(Stime=survival.time, status=survival.status, marker=x,
                   span=span, p=1)
plot(bfnx1$time, bfnx1$beta[,1], type="l", xlab="Time", ylab="beta(t)")

## End(Not run)
</code></pre>

<hr>
<h2 id='pbc'>Incident/Dynamic (I/D) ROC curve, AUC and integrated AUC (iAUC)
estimation of censored survival data</h2><span id='topic+pbc'></span>

<h3>Description</h3>

<p>This is Mayo PBC data as obtained from the website:
http://lib.stat.cmu.edu/datasets/pbc 
</p>


<h3>Format</h3>

<p>A data frame with 418 observations and 20 variables:
id (patient id), 
fudays (follow-up days, number of days between registration and
the earlier of death, transplantation, or study analysis time in July,
1986), 
status (survival status),
drug (1 = D-penicillamine, 2 = placebo)
age (age in days),
sex (0 = male, 1 = female),
ascites (presence of asictes: 0=no 1=yes),
hepatom (presence of hepatomegaly: 0=no 1=yes),
spiders (presence of spiders: 0=no 1=yes),
edema (presence of edema:  0=no edema and no diuretic therapy for edema;
.5 = edema present without diuretics, or edema resolved by diuretics;
1 = edema despite diuretic therapy),
bili (serum bilirubin in mg/dl),
chol (serum cholesterol in mg/dl),
albumin (albumin in gm/dl),
copper (urine copper in ug/day),
alkphos (alkaline phosphatase in U/liter),
sgot (SGOT in U/ml),
trig (triglicerides in mg/dl),
platelet (platelets per cubic ml / 1000),
protime (prothrombin time in seconds),
stage (histologic stage of disease)
</p>


<h3>Author(s)</h3>

<p>Patrick J. Heagerty </p>


<h3>References</h3>

<p>Heagerty, P.J., Zheng Y. (2005)
Survival Model Predictive Accuracy and ROC curves
<em>Biometrics</em>, <b>61</b>, 92 &ndash; 105</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(MASS)
data(VA)
## need to order the data in ascending order of survival time
new.VA=VA[order(VA$stime),]
risket.VA=riskset(new.VA)

</code></pre>

<hr>
<h2 id='riskset'>Incident/Dynamic (I/D) ROC curve, AUC and integrated AUC (iAUC)
estimation of censored survival data</h2><span id='topic+riskset'></span>

<h3>Description</h3>

<p>This function creates risk set at each unique failure time from a
survival data set.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>riskset(dat, entry=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="riskset_+3A_dat">dat</code></td>
<td>
<p>survival dataset with at least three variables:
survival.times, survival.status and marker, in that order. The
survival data set may have additional variables. In case of interval
censored data, the first four columns are: entry time, exit time,
status at exit and marker </p>
</td></tr>
<tr><td><code id="riskset_+3A_entry">entry</code></td>
<td>
<p>default is FALSE indicating right censored data. TRUE if
left truncated data</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function creates risk set at each unique failure time from
a survival data set and is needed for llCoxReg(). The function can
handle both right censored and interval censored data.
</p>


<h3>Value</h3>

<p>Returns a new data set with columns as follows: start, finish,
newStatus and other variables from the original dataset except
survival time and status. The first two columns correspond to the
start and end of time intervals considered and the newStatus
corresponds to the survival status of the patient corresponding to
this interval, i.e. the status is 1 if the patient had event during
this interval (start, finish] and 0 otherwise. Note that the survival time need to be
in ascending order.
</p>


<h3>Author(s)</h3>

<p>Patrick J. Heagerty </p>


<h3>References</h3>

<p>Heagerty, P.J., Zheng Y. (2005)
Survival Model Predictive Accuracy and ROC curves
<em>Biometrics</em>, <b>61</b>, 92 &ndash; 105</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(MASS)
data(VA)
## need to order the data in ascending order of survival time
new.VA=VA[order(VA$stime),]
risket.VA=riskset(new.VA)

</code></pre>

<hr>
<h2 id='risksetAUC'>Incident/Dynamic (I/D) ROC curve, AUC and integrated AUC (iAUC)
estimation of censored survival data</h2><span id='topic+risksetAUC'></span>

<h3>Description</h3>

<p>This function creates risksetAUC from a survival data set
</p>


<h3>Usage</h3>

<pre><code class='language-R'>risksetAUC(Stime, entry=NULL, status, marker, method="Cox",
                       span=NULL, order=1, window="asymmetric",
                       tmax, weight="rescale", plot=TRUE, type="l",
                       xlab="Time", ylab="AUC", ...)  
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="risksetAUC_+3A_stime">Stime</code></td>
<td>
<p>For right censored data, this is the follow up time. For
left truncated data, this is the ending time for the interval.</p>
</td></tr>  
<tr><td><code id="risksetAUC_+3A_entry">entry</code></td>
<td>
<p>For left truncated data, this is the entry time of
the interval. The default is set to NULL for right censored
data.</p>
</td></tr>     
<tr><td><code id="risksetAUC_+3A_status">status</code></td>
<td>
<p>survival status, 1 if had an event and 0 otherwise</p>
</td></tr>
<tr><td><code id="risksetAUC_+3A_marker">marker</code></td>
<td>
<p>marker</p>
</td></tr>
<tr><td><code id="risksetAUC_+3A_method">method</code></td>
<td>
<p>either of &quot;Cox&quot;, &quot;LocalCox&quot; and &quot;Schoenfeld&quot;, default is &quot;Cox&quot;</p>
</td></tr>
<tr><td><code id="risksetAUC_+3A_span">span</code></td>
<td>
<p>bandwidth parameter that controls the size of a local
neighborhood, needed for <em>method=&quot;LocalCox&quot;</em> or
<em>method=&quot;Schoenfeld&quot;</em></p>
</td></tr> 
<tr><td><code id="risksetAUC_+3A_order">order</code></td>
<td>
<p>0 or 1, locally mean if 0 and local linear if 1, needed
for method=&quot;Schoenfeld&quot;, default is 1</p>
</td></tr>
<tr><td><code id="risksetAUC_+3A_window">window</code></td>
<td>
<p>either of &quot;asymmetric&quot; or &quot;symmetric&quot;, default is
asymmetric, needed for method=&quot;LocalCox&quot;</p>
</td></tr>
<tr><td><code id="risksetAUC_+3A_tmax">tmax</code></td>
<td>
<p>maximum time to be considered for calculation of AUC</p>
</td></tr>
<tr><td><code id="risksetAUC_+3A_weight">weight</code></td>
<td>
<p>either of &quot;rescale&quot; or &quot;conditional&quot;. If
<em>weight=&quot;rescale&quot;</em>, then weights are rescaled so that the sum
is unity. If <em>weight=&quot;conditional&quot;</em> both the event times are
assumed to be less than <em>tmax</em></p>
</td></tr>
<tr><td><code id="risksetAUC_+3A_plot">plot</code></td>
<td>
<p>TRUE or FALSE, default is TRUE</p>
</td></tr>
<tr><td><code id="risksetAUC_+3A_type">type</code></td>
<td>
<p>default is &quot;l&quot;, can be either of &quot;p&quot; for points, &quot;l&quot; for
line, &quot;b&quot; for both</p>
</td></tr>
<tr><td><code id="risksetAUC_+3A_xlab">xlab</code></td>
<td>
<p>label for x-axis</p>
</td></tr>
<tr><td><code id="risksetAUC_+3A_ylab">ylab</code></td>
<td>
<p>label for y-axis</p>
</td></tr>
<tr><td><code id="risksetAUC_+3A_...">...</code></td>
<td>
<p>additional plot arguments</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function creates and plots AUC based on incident/dynamic
definition of Heagerty, et. al. based on a survival data and marker
values. If proportional hazard is assumed then method=&quot;Cox&quot; can be
used. In case of non-proportional hazard, either of &quot;LocalCox&quot; or
&quot;Schoenfeld&quot; can be used. These two methods differ in how the
smoothing is done. If <em>plot=&quot;TRUE&quot;</em> then the AUC curve is plotted
against time (till <em>tmax+1</em>). Additional plot arguments can be
supplied. 
</p>


<h3>Value</h3>

<p>Returns a list of the following items:
</p>
<table>
<tr><td><code>utimes</code></td>
<td>
<p>ordered unique failure times</p>
</td></tr>
<tr><td><code>St</code></td>
<td>
<p>estimated survival probability at utimes</p>
</td></tr>
<tr><td><code>AUC</code></td>
<td>
<p>Area under ROC curve at utimes</p>
</td></tr>
<tr><td><code>Cindex</code></td>
<td>
<p>Cindex</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Paramita Saha</p>


<h3>References</h3>

<p>Heagerty, P.J., Zheng Y. (2005)
Survival Model Predictive Accuracy and ROC curves
<em>Biometrics</em>, <b>61</b>, 92 &ndash; 105</p>


<h3>See Also</h3>

<p>IntegrateAUC(), weightedKM(), llCoxReg(), SchoenSmooth(),
CoxWeights()</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(MASS)
data(VA)
survival.time=VA$stime
survival.status=VA$status
score &lt;- VA$Karn
cell.type &lt;- factor(VA$cell)
tx &lt;- as.integer( VA$treat==1 )
age &lt;- VA$age
survival.status[survival.time&gt;500 ] &lt;- 0
survival.time[survival.time&gt;500 ] &lt;- 500
fit0 &lt;- coxph( Surv(survival.time,survival.status)
        ~ score + cell.type + tx + age, na.action=na.omit )
eta &lt;- fit0$linear.predictor
tmax=365
AUC.CC=risksetAUC(Stime=survival.time,
       status=survival.status, marker=eta, method="Cox", tmax=tmax); 

</code></pre>

<hr>
<h2 id='risksetROC'>Incident/Dynamic (I/D) ROC curve, AUC and integrated AUC (iAUC)
estimation of censored survival data</h2><span id='topic+risksetROC'></span>

<h3>Description</h3>

<p>This function creates risksetROC from a survival data set
</p>


<h3>Usage</h3>

<pre><code class='language-R'>risksetROC(Stime, entry=NULL, status, marker, predict.time, method="Cox",
                       span=NULL, order=1, window="asymmetric", prop=0.5,
                       plot=TRUE, type="l", xlab="FP", ylab="TP",
                       ...)  
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="risksetROC_+3A_stime">Stime</code></td>
<td>
<p>For right censored data, this is the follow up time. For
left truncated data, this is the ending time for the interval.</p>
</td></tr>  
<tr><td><code id="risksetROC_+3A_entry">entry</code></td>
<td>
<p>For left truncated data, this is the entry time of
the interval. The default is set to NULL for right censored
data.</p>
</td></tr>    
<tr><td><code id="risksetROC_+3A_status">status</code></td>
<td>
<p>survival status, 1 if had an event and 0 otherwise</p>
</td></tr>
<tr><td><code id="risksetROC_+3A_marker">marker</code></td>
<td>
<p>marker</p>
</td></tr>
<tr><td><code id="risksetROC_+3A_predict.time">predict.time</code></td>
<td>
<p>time point of interest</p>
</td></tr>
<tr><td><code id="risksetROC_+3A_method">method</code></td>
<td>
<p>either of &quot;Cox&quot;, &quot;LocalCox&quot; and &quot;Schoenfeld&quot;, default is &quot;Cox&quot;</p>
</td></tr>
<tr><td><code id="risksetROC_+3A_span">span</code></td>
<td>
<p>bandwidth parameter that controls the size of a local
neighborhood, needed for <em>method=&quot;LocalCox&quot;</em> or
<em>method=&quot;Schoenfeld&quot;</em></p>
</td></tr> 
<tr><td><code id="risksetROC_+3A_order">order</code></td>
<td>
<p>0 or 1, locally mean if 0 and local linear if 1, needed
for method=&quot;Schoenfeld&quot;, default is 1</p>
</td></tr>
<tr><td><code id="risksetROC_+3A_window">window</code></td>
<td>
<p>either of &quot;asymmetric&quot; or &quot;symmetric&quot;, default is
asymmetric, needed for method=&quot;LocalCox&quot;</p>
</td></tr>
<tr><td><code id="risksetROC_+3A_prop">prop</code></td>
<td>
<p>what proportion of the time-interval to consider when
doing a local Cox fitting at <em>predict.time</em>, needed for <em>method=&quot;LocalCox&quot;</em>,
default is 0.5.</p>
</td></tr>
<tr><td><code id="risksetROC_+3A_plot">plot</code></td>
<td>
<p>TRUE or FALSE, default is TRUE</p>
</td></tr>
<tr><td><code id="risksetROC_+3A_type">type</code></td>
<td>
<p>default is &quot;l&quot;, can be either of &quot;p&quot; for points, &quot;l&quot; for
line, &quot;b&quot; for both</p>
</td></tr>
<tr><td><code id="risksetROC_+3A_xlab">xlab</code></td>
<td>
<p>label for x-axis</p>
</td></tr>
<tr><td><code id="risksetROC_+3A_ylab">ylab</code></td>
<td>
<p>label for y-axis</p>
</td></tr>
<tr><td><code id="risksetROC_+3A_...">...</code></td>
<td>
<p>additional plot arguments</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function creates and plots ROC based on incident/dynamic
definition 
of Heagerty, et. al. based on a survival data and marker values. If
proportional hazard is assumed then method=&quot;Cox&quot; can be used. In case
of non-proportional hazard, either of &quot;LocalCox&quot; or &quot;Schoenfeld&quot; can
be used. These two methods differ in how the smoothing is done. If
<em>plot=&quot;TRUE&quot;</em> then the ROC curve is plotted with the diagonal
line. Additional plot arguments can be supplied.
</p>


<h3>Value</h3>

<p>Returns a list of the following items:
</p>
<table>
<tr><td><code>eta</code></td>
<td>
<p>unique marker values for calculation of TP and FP</p>
</td></tr>
<tr><td><code>TP</code></td>
<td>
<p>True Positive values corresponding to unique marker values</p>
</td></tr>
<tr><td><code>FP</code></td>
<td>
<p>False Positive values corresponding to unique marker values</p>
</td></tr>
<tr><td><code>AUC</code></td>
<td>
<p>Area Under (ROC) Curve at time predict.time</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Paramita Saha</p>


<h3>References</h3>

<p>Heagerty, P.J., Zheng Y. (2005)
Survival Model Predictive Accuracy and ROC curves
<em>Biometrics</em>, <b>61</b>, 92 &ndash; 105</p>


<h3>See Also</h3>

<p>llCoxReg(), SchoenSmooth(), CoxWeights()</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(MASS)
data(VA)
survival.time=VA$stime
survival.status=VA$status
score &lt;- VA$Karn
cell.type &lt;- factor(VA$cell)
tx &lt;- as.integer( VA$treat==1 )
age &lt;- VA$age
survival.status[survival.time&gt;500 ] &lt;- 0
survival.time[survival.time&gt;500 ] &lt;- 500
fit0 &lt;- coxph( Surv(survival.time,survival.status)
        ~ score + cell.type + tx + age, na.action=na.omit )
eta &lt;- fit0$linear.predictor

ROC.CC30=risksetROC(Stime=survival.time, status=survival.status,
                    marker=eta, predict.time=30, method="Cox",
                    main="ROC Curve", lty=2, col="red") 
</code></pre>

<hr>
<h2 id='SchoenSmooth'>Incident/Dynamic (I/D) ROC curve, AUC and integrated AUC (iAUC)
estimation of censored survival data</h2><span id='topic+SchoenSmooth'></span>

<h3>Description</h3>

<p>This function smooths the Schoenfeld residuals using
Epanechnikov's optimal kernel.  
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SchoenSmooth(fit, Stime, status, span=0.40, order=0, entry=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SchoenSmooth_+3A_fit">fit</code></td>
<td>
<p>the result of fitting a Cox regression model, using the
coxph function</p>
</td></tr>
<tr><td><code id="SchoenSmooth_+3A_stime">Stime</code></td>
<td>
<p>Survival times in case of right censored data and exit
time for left truncated data</p>
</td></tr>
<tr><td><code id="SchoenSmooth_+3A_status">status</code></td>
<td>
<p>Survival status</p>
</td></tr>
<tr><td><code id="SchoenSmooth_+3A_span">span</code></td>
<td>
<p>bandwidth parameter that controls the size of a local
neighborhood</p>
</td></tr>
<tr><td><code id="SchoenSmooth_+3A_order">order</code></td>
<td>
<p>0 or 1, locally mean if 0 and local linear if 1</p>
</td></tr>
<tr><td><code id="SchoenSmooth_+3A_entry">entry</code></td>
<td>
<p>entry time when left censored data is considered, default
is NULL for only right censored data</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function smooths the Schoenfeld residuals to get an
estimate of time-varying effect of the marker using
Epanechnikov's optimal kernel using either local mean or local
linear smoother. 
</p>


<h3>Value</h3>

<p>Returns a list of following items:
</p>
<table>
<tr><td><code>time</code></td>
<td>
<p>failure times</p>
</td></tr>
<tr><td><code>beta</code></td>
<td>
<p>estimate of time-varying parameter <code class="reqn">\beta(t)</code> at each
unique failure time. </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Patrick J. Heagerty </p>


<h3>References</h3>

<p>Heagerty, P.J., Zheng Y. (2005)
Survival Model Predictive Accuracy and ROC curves
<em>Biometrics</em>, <b>61</b>, 92 &ndash; 105</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(pbc)
## considering only randomized patients
pbc1 &lt;- pbc[1:312,]
## create new censoring variable combine 0,1 as 0, 2 as 1
survival.status &lt;- ifelse( pbc1$status==2, 1, 0)
survival.time &lt;- pbc1$fudays
pbc1$status1 &lt;- survival.status
fit &lt;- coxph( Surv(fudays,status1) ~ log(bili) +
                                     log(protime) +
                                     edema +
                                     albumin +
                                     age,
              data=pbc1 )
eta5 &lt;- fit$linear.predictors
x &lt;- eta5
nobs &lt;- length(survival.time[survival.status==1])
span &lt;- 1.5*(nobs^(-0.2))
fitCox5 &lt;- coxph( Surv(survival.time,survival.status) ~ x )
bfnx1.1 &lt;- SchoenSmooth( fit=fitCox5, Stime=survival.time, status=survival.status,
                       span=span, order=1)
bfnx1.0 &lt;- SchoenSmooth( fit=fitCox5, Stime=survival.time, status=survival.status,
                       span=span, order=0)
plot(bfnx1.1$time, bfnx1.1$beta, type="l", xlab="Time", ylab="beta(t)")
lines(bfnx1.0$time, bfnx1.0$beta, lty=3)
</code></pre>

<hr>
<h2 id='weightedKM'>Incident/Dynamic (I/D) ROC curve, AUC and integrated AUC (iAUC)
estimation of censored survival data</h2><span id='topic+weightedKM'></span>

<h3>Description</h3>

<p>This function estimates S(t) where sampling weights are
permitted.  
</p>


<h3>Usage</h3>

<pre><code class='language-R'>weightedKM(Stime, status, wt=NULL, entry=NULL) 
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="weightedKM_+3A_stime">Stime</code></td>
<td>
<p>Survival times when right censored data is considered. In
case of interval censored data this is the end point for the time
interval.</p>
</td></tr>
<tr><td><code id="weightedKM_+3A_status">status</code></td>
<td>
<p>Survival status</p>
</td></tr>
<tr><td><code id="weightedKM_+3A_wt">wt</code></td>
<td>
<p>weight, default is unweighted</p>
</td></tr>
<tr><td><code id="weightedKM_+3A_entry">entry</code></td>
<td>
<p>entry times in case of interval censored data, default is
<em>NULL</em> when right censored data is considered</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function obtains survival function estimate where sampling
weights are permitted.
</p>


<h3>Value</h3>

<p>Returns a list of following items:
</p>
<table>
<tr><td><code>time</code></td>
<td>
<p>ordered unique failure times</p>
</td></tr>
<tr><td><code>survival</code></td>
<td>
<p>survival estimate at the unique failure times</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Patrick J. Heagerty </p>


<h3>References</h3>

<p>Heagerty, P.J., Zheng Y. (2005)
Survival Model Predictive Accuracy and ROC curves
<em>Biometrics</em>, <b>61</b>, 92 &ndash; 105</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(pbc)
## considering only randomized patients
pbc1 &lt;- pbc[1:312,]
## create new censoring variable combine 0,1 as 0, 2 as 1
survival.status &lt;- ifelse( pbc1$status==2, 1, 0)
survival.time &lt;- pbc1$fudays
kout &lt;- weightedKM(Stime=survival.time, status=survival.status)
KM.plot(kout$time,kout$survival)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
