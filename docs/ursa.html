<!DOCTYPE html><html lang="en"><head><title>Help for package ursa</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ursa}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#ursa-package'>
<p>Overview</p></a></li>
<li><a href='#allocate'>
<p>Rasterization of point data into grid cells</p></a></li>
<li><a href='#as_stars'>
<p>Raster coercion to <code>`stars`</code></p></a></li>
<li><a href='#as.array'>
<p>Export raster object to multidimensional array</p></a></li>
<li><a href='#as.data.frame'>
<p>Convert raster image to a data frame</p></a></li>
<li><a href='#as.integer'>
<p>Transform values to type integer</p></a></li>
<li><a href='#as.matrix'>
<p>Convert raster image to a matrix</p></a></li>
<li><a href='#as.raster'>
<p>Export raster object to a colored representation.</p></a></li>
<li><a href='#as.Raster'>
<p>Coercion to package 'raster' objects</p></a></li>
<li><a href='#as.table'>
<p>Frequency of unique values</p></a></li>
<li><a href='#as.ursa'>
<p>Create raster image from R objects or GDAL raster files.</p></a></li>
<li><a href='#band_group'>
<p>Extract certain statistics of each band.</p></a></li>
<li><a href='#band_stat'>
<p>Computes statistics for each band of raster.</p></a></li>
<li><a href='#bandname'>
<p>Band names for raster image.</p></a></li>
<li><a href='#blank'>
<p>Does any band contain no information?</p></a></li>
<li><a href='#c'>
<p>Combine bands into raster brick.</p></a></li>
<li><a href='#chunk'>
<p>Get indices for partial image reading/writing</p></a></li>
<li><a href='#close'>
<p>Close connections for files with data</p></a></li>
<li><a href='#codec'>
<p>Reduce and restore dimenstions for sparse data matrix</p></a></li>
<li><a href='#colorize'>
<p>Create color table</p></a></li>
<li><a href='#colortable'>
<p>Color Tables of raster images.</p></a></li>
<li><a href='#commonGeneric'>
<p>Some generic functions for <code>ursaRaster</code> class.</p></a></li>
<li><a href='#compose_close'>
<p>Finish plotting</p></a></li>
<li><a href='#compose_design'>
<p>Organize multi-panel layout with images and color bars.</p></a></li>
<li><a href='#compose_legend'>
<p>Plot colorbars or marginal texts.</p></a></li>
<li><a href='#compose_open'>
<p>Start displaying</p></a></li>
<li><a href='#compose_panel'>
<p>Plot raster images and decorations on the multipanel layout.</p></a></li>
<li><a href='#compose_plot'>
<p>Plot layout of images and color bars.</p></a></li>
<li><a href='#create_envi'>
<p>Create ENVI or GDAL files on disk</p></a></li>
<li><a href='#cubehelix'>
<p>Generate &quot;cubehelix&quot; palette.</p></a></li>
<li><a href='#dim'>
<p>Dimension of multiband raster image</p></a></li>
<li><a href='#discolor'>
<p>Destroy color table for raster images.</p></a></li>
<li><a href='#display'>
<p>Plot raster image(s) in the PNG format.</p></a></li>
<li><a href='#display_brick'>
<p>Plot multi-band homogenous raster image in the PNG format.</p></a></li>
<li><a href='#display_rgb'>
<p>Plot RGB (RGBA) color composition in the PNG format.</p></a></li>
<li><a href='#display_stack'>
<p>Plot multi-band heterogenous raster images in the PNG format.</p></a></li>
<li><a href='#envi_files'>
<p>ENVI File Manipulation</p></a></li>
<li><a href='#Extract'>
<p>Extract portion of raster images</p></a></li>
<li><a href='#focal_extrem'>
<p>Extremal spatial filter for image</p></a></li>
<li><a href='#focal_mean'>
<p>Low-pass spatial filter for image.</p></a></li>
<li><a href='#focal_median'>
<p>Median spatial filter for image</p></a></li>
<li><a href='#focal_special'>
<p>Custom spatial filtering for image</p></a></li>
<li><a href='#get_earthdata'>
<p>Retrive data from Global Imagery Browse Services (GIBS) using API for Developers</p></a></li>
<li><a href='#glance'>
<p>Command line utility for spatial view of raster or vector GIS file.</p></a></li>
<li><a href='#global+20operator'>
<p>Extract certains statistics for whole image</p></a></li>
<li><a href='#groupGeneric'>
<p>Group Generic Functions for raster image</p></a></li>
<li><a href='#head'>
<p>Extract first and last bands of raster image</p></a></li>
<li><a href='#hist'>
<p>Histogram of raster image</p></a></li>
<li><a href='#identify'>
<p>Get value and coordinates from location</p></a></li>
<li><a href='#ignorevalue'>
<p>Extract and assign &lsquo;nodata&rsquo; value of raster images.</p></a></li>
<li><a href='#is.na'>
<p>&lsquo;No data&rsquo; values for raster images.</p></a></li>
<li><a href='#legend_align'>
<p>Align caption position for legend</p></a></li>
<li><a href='#legend_colorbar'>
<p>Plot colorbar</p></a></li>
<li><a href='#legend_mtext'>
<p>Write marginal text</p></a></li>
<li><a href='#local_group'>
<p>Create single-band raster using statistics of multi-bands raster.</p></a></li>
<li><a href='#local_stat'>
<p>Bundle of statistics, which is applied to each cell of multi-band image.</p></a></li>
<li><a href='#na.omit'>
<p>Drop bands which don't have data.</p></a></li>
<li><a href='#nband'>
<p>Get number of bands of raster image.</p></a></li>
<li><a href='#open_envi'>
<p>open_envi file</p></a></li>
<li><a href='#open_gdal'>
<p>Open GDAL file</p></a></li>
<li><a href='#panel_annotation'>
<p>Add label or annotation to the image panel.</p></a></li>
<li><a href='#panel_coastline'>
<p>Add coastline to the image panel.</p></a></li>
<li><a href='#panel_contour'>
<p>Add colored contour to the image panel</p></a></li>
<li><a href='#panel_decor'>
<p>Add auxiliary elements to the plotting panel.</p></a></li>
<li><a href='#panel_graticule'>
<p>Add latitude/longitude or metric grid to the image panel.</p></a></li>
<li><a href='#panel_new'>
<p>Start plotting on the new image panel</p></a></li>
<li><a href='#panel_plot'>
<p>Add graphical elements to the image panel</p></a></li>
<li><a href='#panel_raster'>
<p>Add raster to the image panel</p></a></li>
<li><a href='#panel_scalebar'>
<p>Add scale bar to the image panel</p></a></li>
<li><a href='#panel_shading'>
<p>Shaded overlay by image mask</p></a></li>
<li><a href='#pixelsize'>
<p>The actual size of each grid cell with considerable distortion in area of map projection.</p></a></li>
<li><a href='#plot'>
<p>Simple display of raster images</p></a></li>
<li><a href='#polygonize'>
<p>Raster to vector (polygon) conversion.</p></a></li>
<li><a href='#read_envi'>
<p>Read ENVI .hdr Labelled Raster file to memory</p></a></li>
<li><a href='#read_gdal'>
<p>Read GDAL supported raster files.</p></a></li>
<li><a href='#reclass'>
<p>Reclassify specific values of image</p></a></li>
<li><a href='#regrid'>
<p>Change raster image resolution and extent</p></a></li>
<li><a href='#rep'>
<p>Replicate bands of raster image.</p></a></li>
<li><a href='#Replace'>
<p>assign values to the portion of raster images</p></a></li>
<li><a href='#seq'>
<p>Sequence Generation for raster image and coordinate grid</p></a></li>
<li><a href='#session'>
<p>Get and set sessional parameters for grid, CRS, external software for open PNG files.</p></a></li>
<li><a href='#sort'>
<p>Sort multiband raster by band names.</p></a></li>
<li><a href='#spatial_engine'>
<p>Wrapper functions for manipulation with non-raster spatial objects</p></a></li>
<li><a href='#spatial_levelsplit'>
<p>Drops spatial object with overlapped geometry to spatial object with non-overlapped geometry.</p></a></li>
<li><a href='#spatial_read'>
<p>Wrapper functions for reading spatial objects.</p></a></li>
<li><a href='#spatial_write'>
<p>Wrapper functions for writing spatial objects.</p></a></li>
<li><a href='#summary'>
<p>Summary of raster image.</p></a></li>
<li><a href='#temporal_interpolate'>
<p>Fill gaps across bands using moving mean window</p></a></li>
<li><a href='#temporal_mean'>
<p>Smooth value across bands using moving mean window</p></a></li>
<li><a href='#trackline'>
<p>Create segmented line from points' sequence</p></a></li>
<li><a href='#ursa'>
<p>Get and set properties of raster image.</p></a></li>
<li><a href='#ursa_cache'>
<p>Cache management of ursa package</p></a></li>
<li><a href='#ursa_crop'>
<p>Crop 'no data' margins.</p></a></li>
<li><a href='#ursa_crs'>
<p>Extract and assign projection of raster images.</p></a></li>
<li><a href='#ursa_dummy'>
<p>Generate raster image for examples.</p></a></li>
<li><a href='#ursa_grid'>
<p>Extract and assign spatial parameters of raster images.</p></a></li>
<li><a href='#ursa_info'>
<p>Print metadata for raster image.</p></a></li>
<li><a href='#ursa_new'>
<p>Create raster image in memory</p></a></li>
<li><a href='#ursaConnection'>
<p>Connection of raster objects.</p></a></li>
<li><a href='#ursaCRS'>
<p>Coordinate Reference System (CRS) for raster images.</p></a></li>
<li><a href='#ursaGrid'>
<p>Spatial parameters of raster images.</p></a></li>
<li><a href='#ursaProgressBar'>
<p>Progress bar</p></a></li>
<li><a href='#ursaRaster'>
<p>Definition of <code>ursaRaster</code> class.</p></a></li>
<li><a href='#ursaStack'>
<p>List of raster images.</p></a></li>
<li><a href='#ursaValue'>
<p>Values of raster images.</p></a></li>
<li><a href='#whiteboxing'>
<p>Wrapper to WhiteboxTools</p></a></li>
<li><a href='#write_envi'>
<p>Write raster image to ENVI .hdr Labelled Raster file.</p></a></li>
<li><a href='#write_gdal'>
<p>Write raster image to GDAL file(s)</p></a></li>
<li><a href='#zonal_stat'>
<p>Zonal statistics for raster maps</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Non-Interactive Spatial Tools for Raster Processing and
Visualization</td>
</tr>
<tr>
<td>Version:</td>
<td>3.11.4</td>
</tr>
<tr>
<td>Author:</td>
<td>Nikita Platonov <a href="https://orcid.org/0000-0001-7196-7882"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Nikita Platonov &lt;platonov@sev-in.ru&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>S3 classes and methods for manipulation with georeferenced raster data: reading/writing, processing, multi-panel visualization.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/nplatonov/ursa">https://github.com/nplatonov/ursa</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/nplatonov/ursa/issues">https://github.com/nplatonov/ursa/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.1.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>utils, graphics, grDevices, stats, sf (&ge; 0.6-1)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>jsonlite, proj4, raster, ncdf4, locfit, knitr, rmarkdown,
tcltk, sp, methods, fasterize, IRdisplay, caTools, shiny,
tools, png, jpeg, webp, htmlwidgets, htmltools, leaflet,
leafem, leafpop, RColorBrewer, ragg, widgetframe, geojsonsf (&ge;
2.0.0), leaflet.providers, magick, terra, stars, vapour,
gdalraster, sys, RSQLite, whitebox</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>ByteCompile:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-02-20 07:36:11 UTC; pl</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-02-20 08:20:01 UTC</td>
</tr>
</table>
<hr>
<h2 id='ursa-package'> 
Overview
</h2><span id='topic+ursa-package'></span><span id='topic+ursula'></span><span id='topic+about'></span><span id='topic+index'></span>

<h3>Description</h3>

<p>Have a great work with <span class="pkg">ursa</span>!
</p>


<h3>Details</h3>

<p>See table of content.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>

<hr>
<h2 id='allocate'>
Rasterization of point data into grid cells
</h2><span id='topic+allocate'></span>

<h3>Description</h3>

<p><code>allocate</code> takes <code>x</code> and <code>y</code> coordinates and values from data frame, which is describing point spatial data, and puts them into cells of raster. The certain function (either mean value, sum of values, number of points) is applied for &gt;0 points inside of the exact cell borders.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>allocate(vec, coords = c("x", "y"), nodata = NA, attr = ".+",
         fun = c("mean", "sum", "sd", "n"), cellsize = NA, resetGrid = FALSE,
         verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="allocate_+3A_vec">vec</code></td>
<td>

<p><code>data.frame</code>. At least <code>x</code> and <code>y</code> should be in <code>colnames(vec)</code>. Is is allowed to use <code><a href="sp.html#topic+SpatialPoints">&quot;SpatialPointsDataFrame&quot;</a></code> from package <b>sp</b>. The &quot;on the fly&quot; reprojection is not supported.
</p>
</td></tr>
<tr><td><code id="allocate_+3A_coords">coords</code></td>
<td>

<p>Character of length 2. Colums names, which contain coordinates of data points. Raster bands are not produced for specified columns. For misreference of coordinate columns, the attempt to find more appropriate coordinate columns is taken.
</p>
</td></tr>
<tr><td><code id="allocate_+3A_fun">fun</code></td>
<td>

<p>Character keyword of function, which is applied to value of points, which are dropped into the same cell. Valid values are <code>"mean"</code> (mean value), <code>"sum"</code> (sum of values), <code>"sd"</code> (standard deviation), <code>"n"</code> (number of points).
</p>
</td></tr>
<tr><td><code id="allocate_+3A_nodata">nodata</code></td>
<td>

<p>Numeric of length 1. This value used to mark <code>NA</code> values in the writing to file.
</p>
</td></tr>
<tr><td><code id="allocate_+3A_attr">attr</code></td>
<td>

<p>Pattern in the format of <a href="base.html#topic+regex">regular expressions</a>, which is used to select required columns in data frame. By default (<code>".*"</code>) all columns are used.
</p>
</td></tr>
<tr><td><code id="allocate_+3A_cellsize">cellsize</code></td>
<td>

<p>Numeric. Desired size of cell in the raster grid. Used only when source data are not in regular grid. Default is <code>NA</code>; cell size is determined automatically to exclude case of points overlapping.
</p>
</td></tr>
<tr><td><code id="allocate_+3A_resetgrid">resetGrid</code></td>
<td>

<p>Logical. If <code>TRUE</code> then existing base grid (from <code><a href="#topic+session">session_grid()</a></code>) will be overwritten. Otherwise using of current grid will be attempted.
</p>
</td></tr>
<tr><td><code id="allocate_+3A_verbose">verbose</code></td>
<td>

<p>Logical. Some output in console. Primarily for debug purposes.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Here <code>fun</code> differs from <span class="rlang"><b>R</b></span>-styled <code>fun</code> in such functions as <code><a href="base.html#topic+lapply">*apply</a></code>, <code><a href="stats.html#topic+aggregate">aggregate</a></code>.
</p>
<p>It was refused &ldquo;rasterize&rdquo; for function name to distinguish with <code><a href="raster.html#topic+rasterize">rasterize</a></code> in the package <span class="pkg">raster</span>
</p>


<h3>Value</h3>

<p>Object of class <code>ursaRaster</code>
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
g1 &lt;- session_grid(regrid(session_grid(),mul=1/10))
n &lt;- 1000
x &lt;- with(g1,runif(n,min=minx,max=maxx))
y &lt;- with(g1,runif(n,min=miny,max=maxy))
z &lt;- with(g1,runif(n,min=0,max=10))
da &lt;- data.frame(x=x,y=y,value=z)
res &lt;- c(mean=allocate(da,fun="mean")
        ,mean_=NA
        ,sum=allocate(da,fun="sum")
        ,count=allocate(da,fun="n"))
res["mean_"]=res["sum"]/res["count"]
print(res)
</code></pre>

<hr>
<h2 id='as_stars'>
Raster coercion to <code>`stars`</code>
</h2><span id='topic+as_stars'></span>

<h3>Description</h3>

<p>Coercion from raster <code>ursaRaster</code> object to raster <code>stars</code> object defined in package <span class="pkg">stars</span>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as_stars(obj)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as_stars_+3A_obj">obj</code></td>
<td>

<p>Object of class <code>ursaRaster</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Simple coercion to <code>stars</code> object of package <span class="pkg">stars</span>. Currently, color tables and attribution tables are not supported.
</p>


<h3>Value</h3>

<p>Object of class <code>stars</code> for argument of class <code>ursaRaster</code>. Otherwise, <code>NULL</code>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- ursa_dummy(3)
x &lt;- as_stars(a)
class(x)
if (requireNamespace("stars")) {
   print(x)
   b &lt;- as_ursa(x)
   print(a)
   print(b)
}
</code></pre>

<hr>
<h2 id='as.array'>
Export raster object to multidimensional array
</h2><span id='topic+as.array.ursaRaster'></span><span id='topic+.as.array'></span>

<h3>Description</h3>

<p>In the <code>ursaRaster</code> object the 3-dimensional image data are presented in 2-dimensional matrix. <code>as.array</code> transforms internal 2-dimensional data to the usual 3-dimansional data. <code>as.matrix</code> just extracts image data in internal 2-dimensional format.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaRaster'
as.array(x, ...)

## non-public
.as.array(x, drop = FALSE, flip = FALSE, permute = FALSE, dim = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as.array_+3A_...">...</code></td>
<td>

<p>Arguments, which are passed to <code>.as.array</code>.
</p>
</td></tr>
<tr><td><code id="as.array_+3A_x">x</code></td>
<td>

<p><code>ursaRaster</code> object
</p>
</td></tr>
<tr><td><code id="as.array_+3A_drop">drop</code></td>
<td>

<p>Logical. If <code>drop=TRUE</code> then single-band images are presented without third dimension.
</p>
</td></tr>
<tr><td><code id="as.array_+3A_permute">permute</code></td>
<td>

<p>Logical. If <code>permute=FALSE</code> then returned array has dimension <em>(samples, lines, bands)</em>. If <code>permute=TRUE</code> then returned array has dimension <em>(lines, samples, bands)</em>.
</p>
</td></tr>
<tr><td><code id="as.array_+3A_flip">flip</code></td>
<td>

<p>Logical. If <code>flip=TRUE</code> then vertical flip (reverse coordinates for dimension #2) is applied for output image. 
</p>
</td></tr>
<tr><td><code id="as.array_+3A_dim">dim</code></td>
<td>

<p>Logical. If <code>dim=TRUE</code> then array's dimension is returned.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Use <code>permute=TRUE</code> to create an object of class <code><a href="grDevices.html#topic+as.raster">raster</a></code>: <code>as.raster(as.array(...))</code>
</p>
<p>The spatial reference system is lost.
</p>


<h3>Value</h3>

<p>If <code>dim=FALSE</code> then <code>as.array</code> returns object of class <code><a href="base.html#topic+array">array</a></code>.<br />
If <code>dim=TRUE</code> then <code>as.array</code> returns dimension of array.
<br />
<code>as.matrix</code> returns object of class <code><a href="base.html#topic+matrix">matrix</a></code>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+classRaster_as.raster">as.raster</a></code> is a function to direct export to the object of class <code><a href="grDevices.html#topic+as.raster">raster</a></code>.
<br />
<code><a href="#topic+classRaster_as.matrix">as.matrix</a></code> with argument/value <code>coords=TRUE</code> and <code><a href="#topic+classRaster_as.data.frame">as.data.frame</a></code> for object of class <code>ursaRaster</code> keep spatial reference system.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- pixelsize()
a &lt;- (a-global_min(a))/(global_max(a)-global_min(a))
b &lt;- c(entire=a,half=a/2,double=a*2)
str(m &lt;- as.matrix(b))
str(d1 &lt;- as.array(b))
str(d2 &lt;- as.array(b[1],drop=FALSE))
str(d3 &lt;- as.array(b[1],drop=TRUE))
contour(d3)
filled.contour(d3)
d4 &lt;- as.array(b,perm=TRUE)/global_max(b)
d4[is.na(d4)] &lt;- 0
str(d4 &lt;- as.raster(d4))
plot(d4)
</code></pre>

<hr>
<h2 id='as.data.frame'>
Convert raster image to a data frame
</h2><span id='topic+as.data.frame.ursaRaster'></span><span id='topic+.as.data.frame'></span>

<h3>Description</h3>

<p><code>as.data.frame</code> reorganizes <code>ursaRaster</code> object into data frame, where first two columns (<code>x</code> and <code>y</code>) are coordinates of cells, and the rest columns are cell values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaRaster'
as.data.frame(x, ...)

# non-public
.as.data.frame(obj, band = FALSE, id = FALSE, na.rm = TRUE, all.na = FALSE,
               col.names = NULL)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as.data.frame_+3A_x">x</code>, <code id="as.data.frame_+3A_obj">obj</code></td>
<td>

<p>Object of class <code>ursaRaster</code>
</p>
</td></tr>
<tr><td><code id="as.data.frame_+3A_...">...</code></td>
<td>
<p>Set of arguments, which are recognized via their names (using <a href="base.html#topic+regex">regular expressions</a>) and classes. Passed to non-public <code>.as.data.frame</code>.
</p>

<table>
<tr>
 <td style="text-align: left;">
         <strong>Pattern</strong> (<code>as.data.frame</code>) </td><td style="text-align: left;"> <strong>Argument</strong> (<code>.as.data.frame</code>) </td><td style="text-align: left;"> <strong>Description</strong>
         </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>band</code> </td><td style="text-align: left;"> <code>band</code> </td><td style="text-align: left;"> <em>See below</em>.
         </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>id</code> </td><td style="text-align: left;"> <code>id</code> </td><td style="text-align: left;"> <em>See below</em>.
         </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>na\\.rm</code> </td><td style="text-align: left;"> <code>na.rm</code> </td><td style="text-align: left;"> <em>See below</em>.
         </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>all\\.na</code> </td><td style="text-align: left;"> <code>all.na</code> </td><td style="text-align: left;"> <em>See below</em>.
         </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>col(\\.)*name(s)*</code> </td><td style="text-align: left;"> <code>col.names</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>

</table>

</td></tr>
<tr><td><code id="as.data.frame_+3A_band">band</code></td>
<td>

<p>Logical. If <code>band=FALSE</code> then each band is presented by separate column in the data frame. If <code>band=TRUE</code> then band name is presented as a <code><a href="base.html#topic+factor">factor</a></code> in the column <code>$band</code>, and values are written in the column <code>$z</code>. If <code>band=TRUE</code> then number of rows is 
</p>
</td></tr>
<tr><td><code id="as.data.frame_+3A_id">id</code></td>
<td>

<p>Logical. If <code>band=FALSE</code> then is ignored. If <code>id=TRUE</code> then addiditional columns <code>$id</code> will contain unique cell number in the source raster.
</p>
</td></tr>
<tr><td><code id="as.data.frame_+3A_na.rm">na.rm</code></td>
<td>

<p>Logical. If <code>na.rm=FALSE</code> then number of rows for data frame is equal to number of cells of spatial grid of raster. If <code>na.rm=TRUE</code> then cells with 'no data' values for all (<code>all.na=FALSE</code>) or any (<code>all.na=TRUE</code>) bands are omitted.
</p>
</td></tr>
<tr><td><code id="as.data.frame_+3A_all.na">all.na</code></td>
<td>

<p>Logical. If <code>na.rm=FALSE</code> then ignored. If number of rows for data frame is equal to number of cells of spatial grid of raster. If <code>na.rm=TRUE</code> then cells with 'no data' values for all bands are omitted.
</p>
</td></tr>
<tr><td><code id="as.data.frame_+3A_col.names">col.names</code></td>
<td>

<p>Character vector or <code>NULL</code>. Names for columns of data frame. If <code>NULL</code>, then column names are generated from band names. Default is <code>NULL</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The structure of voxel is kept. The number of rows for <code>band=TRUE</code> is equal to the number of rows for <code>band=FALSE</code> multiplied to number of bands. To extract all numeric data with destroying of voxel, you may use followed code:<br /><code>subset(as.data.frame(obj,band=TRUE),!is.na(z))</code>.
</p>


<h3>Value</h3>

<p>Data frame.
</p>
<p>If <code>band=TRUE</code> then
</p>
<table role = "presentation">
<tr><td><code>x</code></td>
<td>
<p>Horizontal coordinate of cell's midpoint</p>
</td></tr>
<tr><td><code>y</code></td>
<td>
<p>Vertical coordinate of cell's midpoint</p>
</td></tr>
<tr><td><code>z</code></td>
<td>
<p>Value</p>
</td></tr>
<tr><td><code>band</code></td>
<td>
<p>Band as a <code><a href="base.html#topic+factor">factor</a></code></p>
</td></tr>
<tr><td><code>id</code></td>
<td>
<p><em>Optional</em>. Unique number for <code>(x,y)</code> coordinate.</p>
</td></tr>
</table>
<p>If <code>band=FALSE</code> then
</p>
<table role = "presentation">
<tr><td><code>x</code></td>
<td>
<p>Horizontal coordinate of cell's midpoint</p>
</td></tr>
<tr><td><code>y</code></td>
<td>
<p>Vertical coordinate of cell's midpoint</p>
</td></tr>
<tr><td><code>...</code></td>
<td>
<p>Additional columns. Names of columns are names of bands. Values of columns are values of corresponded bands.</p>
</td></tr>
</table>
<p>If <code>ursaRaster</code> is projected, then data frame has additional attribute <code>attr(...,"proj")</code> with value of PROJ.4 string.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
session_grid(regrid(res=50000,lim=c(-1200100,-1400800,1600900,1800200)))
a0 &lt;- ursa_dummy(nband=3,min=0,max=100)
a0[a0&lt;30 | a0&gt;70] &lt;- NA
names(a0) &lt;- c("x","y","z")
print(a0)
b0 &lt;- as.data.frame(a0)
session_grid(NULL)
a1 &lt;- as.ursa(b0)
print(a1-a0)
session_grid(NULL)
session_grid(regrid(res=5800000))
set.seed(352)
a2 &lt;- as.integer(ursa_dummy(nband=2,min=0,max=100))
a2[a2&gt;50] &lt;- NA
print(a2)
print(b1 &lt;- as.data.frame(a2,na.rm=FALSE))
print(b2 &lt;- as.data.frame(a2,na.rm=TRUE))
print(b3 &lt;- as.data.frame(a2,all.na=TRUE))
print(b4 &lt;- as.data.frame(a2,band=TRUE,na.rm=FALSE))
print(b5 &lt;- as.data.frame(a2,band=TRUE,all.na=FALSE))
print(b6 &lt;- as.data.frame(a2,band=TRUE,all.na=TRUE))
print(b7 &lt;- as.data.frame(a2,band=TRUE,all.na=TRUE,id=TRUE))
</code></pre>

<hr>
<h2 id='as.integer'>
Transform values to type integer 
</h2><span id='topic+as.integer'></span><span id='topic+as.integer.ursaRaster'></span>

<h3>Description</h3>

<p><code>as.integer</code> for object of class <code>ursaRaster</code> truncates decimal part of image values and then converts to type <code><a href="base.html#topic+integer">integer</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaRaster'
as.integer(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as.integer_+3A_x">x</code></td>
<td>

<p><code>ursaRaster</code> object
</p>
</td></tr>
<tr><td><code id="as.integer_+3A_...">...</code></td>
<td>

<p>Other arguments which passed to function <code><a href="base.html#topic+integer">as.integer</a></code> of package <span class="pkg">base</span>.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Object of class <code>ursaRaster</code> where <code><a href="base.html#topic+mode">storage.mode</a></code> of values is <code>integer</code>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- pixelsize()
a &lt;- a-min(a)+0.5
str(ursa_value(a))
print(storage.mode(a$value))
b &lt;- as.integer(a)
str(ursa_value(b))
print(storage.mode(b$value))
</code></pre>

<hr>
<h2 id='as.matrix'>
Convert raster image to a matrix
</h2><span id='topic+as.matrix.ursaRaster'></span><span id='topic++5B+5B.ursaRaster'></span>

<h3>Description</h3>

<p><code>as.matrix(coords=TRUE)</code> prepares a list from the first band of <code>ursaRaster</code>, which is suitable as input parameter for functions <code><a href="graphics.html#topic+image">image</a></code>, <code><a href="graphics.html#topic+contour">contour</a></code> and <code><a href="graphics.html#topic+filled.contour">filled.contour</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaRaster'
as.matrix(x, ...)
## S3 method for class 'ursaRaster'
x[[i]]

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as.matrix_+3A_x">x</code></td>
<td>

<p>Object of class <code>ursaRaster</code>
</p>
</td></tr>
<tr><td><code id="as.matrix_+3A_...">...</code></td>
<td>
<p>Set of arguments, which are recognized via their names (using <a href="base.html#topic+regex">regular expressions</a>) and classes.
</p>

<dl>
<dt><code>(coord(s)*|crd|^$)</code></dt><dd>
<p>Logical If <code>TRUE</code> then <code><a href="base.html#topic+list">list</a></code> is created with <code>x</code>, <code>y</code>, <code>z</code> components, where component <code>$z</code> contains matrix, components <code>$x</code> and <code>$y</code> are coordinates for elements if matrix. 
</p>
</dd>
</dl>

</td></tr>
<tr><td><code id="as.matrix_+3A_i">i</code></td>
<td>

<p>Positive integer or character of lentg. If integer, then band index. If character, then band name. If missing, then first band (value <code>1L</code>) is used.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Item <code>colortable</code> is mainly for internal usage, e. g., for mapping. Item <code>proj</code> is useful for convertion back to <code>ursaRaster</code> object by calling <code><a href="#topic+ursa_as">as.ursa</a></code> function.
</p>
<p>Extract operator <code>x[[i]]</code> is a wrapper for <code>as.matrix(x[i],coords=TRUE)</code>
</p>


<h3>Value</h3>

<p>Depending of argument <code>coords</code>.
</p>
<p>If <code>coords=FALSE</code>, then it is a two-dimensional matrix <code>c(samples*lines, bands)</code>, <a href="base.html#topic+class">unclassed</a> from <code>ursaValue</code> class.
</p>
<p>If <code>coords=TRUE</code>, then it is a list:
</p>
<table role = "presentation">
<tr><td><code>x</code></td>
<td>
<p>Numeric. Midpoints of cells on horizontal axis</p>
</td></tr>
<tr><td><code>y</code></td>
<td>
<p>Numeric. Midpoints of cells on vertical axis</p>
</td></tr>
<tr><td><code>z</code></td>
<td>
<p>Numeric. Matrix of values</p>
</td></tr>
<tr><td><code>attr(*</code>, <code>"proj")</code></td>
<td>
<p>PROJ.4 string for grid, defined by <code>x</code> and <code>y</code></p>
</td></tr>
<tr><td><code>attr(*</code>, <code>"colortable")</code></td>
<td>
<p>Optional. Object of class <code><a href="#topic+classColorTable">ursaColorTable</a></code>. Missing if raster has no color table.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- ursa_dummy(nband=3,min=0,max=100)
a &lt;- a[a&gt;=20 &amp; a&lt;=80]
ignorevalue(a) &lt;- 121
str(ursa_value(a[2]))
str(as.matrix(a[2]))
b1 &lt;- a[[2]]
str(b1)
image(b1,asp=1)
b2 &lt;- as.matrix(a[2:3],coords=TRUE)
print(c('theSame?'=identical(b1,b2)))
a2 &lt;- as.ursa(b2)
res &lt;- c(src=a[2],exported_then_imported=a2,diff=a[2]-a2)
print(res)
</code></pre>

<hr>
<h2 id='as.raster'>
Export raster object to a colored representation.
</h2><span id='topic+as.raster.ursaRaster'></span>

<h3>Description</h3>

<p><code>as.raster</code> transforms object of class <code>ursaRaster</code> to the object of class <code><a href="grDevices.html#topic+as.raster">raster</a></code> (package <span class="pkg">grDevices</span>)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaRaster'
as.raster(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as.raster_+3A_x">x</code></td>
<td>

<p><code>ursaRaster</code> object
</p>
</td></tr>
<tr><td><code id="as.raster_+3A_...">...</code></td>
<td>
<p>Set of arguments, which are recognized via their names (using <a href="base.html#topic+regex">regular expressions</a>) and classes:
</p>

<dl>
<dt><code>max</code></dt><dd><p>number giving the maximum of the color values range. Passed to function <code><a href="grDevices.html#topic+as.raster">as.raster</a></code> for S3 class 'array'. Default is 255.</p>
</dd>
</dl>

</td></tr>
</table>


<h3>Value</h3>

<p>A <code><a href="grDevices.html#topic+as.raster">raster</a></code> object. It is a matrix. The values of matrix are colors.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+classRaster_as.array">as.array</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
session_grid(regrid(mul=1/2))
a &lt;- ursa_dummy(4,min=0,max=255)
a[a&lt;70] &lt;- NA
compose_open(layout=c(1,4),legend=NULL)
for (i in seq(4)) {
   panel_new()
   panel_plot(as.raster(a[seq(i)]),interpolate=FALSE)
   panel_annotation(paste("Number of channels:",i))
}
compose_close()

op &lt;- par(mfrow=c(2,2),mar=rep(0.5,4))
plot(as.raster(a[1:1]),interpolate=FALSE)
plot(as.raster(a[1:2]),interpolate=FALSE)
plot(as.raster(a[1:3]),interpolate=FALSE)
plot(as.raster(a[1:4]),interpolate=FALSE)
par(op)
</code></pre>

<hr>
<h2 id='as.Raster'>
Coercion to package 'raster' objects
</h2><span id='topic+as.Raster'></span><span id='topic+as.Raster.ursaRaster'></span><span id='topic+as.Raster.ursaBrick'></span><span id='topic+as.Raster.list'></span><span id='topic+as.Raster.ursaStack'></span><span id='topic+as.Raster.NULL'></span>

<h3>Description</h3>

<p><code>as.Raster</code> converts singe-band <code>ursaRaster</code> object to <em>raster</em>, multi-band <code>ursaRaster</code> object to <em>brick</em> and list of <code>ursaRaster</code> objects to <em>stack</em>. S4 classes &ldquo;raster&rdquo;, &ldquo;brick&rdquo;, and &ldquo;stack&rdquo; are defined in package <span class="pkg">raster</span>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as.Raster(obj)

## S3 method for class 'ursaRaster'
as.Raster(obj)

## S3 method for class 'list'
as.Raster(obj)

## S3 method for class 'ursaStack'
as.Raster(obj)

## S3 method for class 'NULL'
as.Raster(obj)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as.Raster_+3A_obj">obj</code></td>
<td>

<p>Object of class <code>ursaRaster</code> or list of <code>ursaRaster</code> objects
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Package <span class="pkg">raster</span> is required for conversions. 
</p>
<p>The uppercase <code style="white-space: pre;">&#8288;as.&#8288;</code><b><code style="white-space: pre;">&#8288;R&#8288;</code></b><code style="white-space: pre;">&#8288;aster&#8288;</code> is important, because <code><a href="#topic+classRaster_as.raster">as.raster</a></code> is used in internal functions for coercion to object of class <code><a href="grDevices.html#topic+as.raster">raster</a></code>.
</p>
<p>Single-banded <code>ursaRaster</code> object (with or without colortable) is coerced to <code><a href="raster.html#topic+raster">RasterLayer</a></code>. Colortables are kept.
<br />
Multi-banded <code>ursaRaster</code> object is coerced to <code><a href="raster.html#topic+raster">RasterBrick</a></code>. Colortables are destroyed.
<br />
Multi-layered object (list of <code>ursaRaster</code> objects) is coerced to <code><a href="raster.html#topic+raster">RasterStack</a></code>. Colortables are destroyed.
<br />
</p>


<h3>Value</h3>

<p>Either <code><a href="raster.html#topic+raster">RasterLayer</a></code>, <code><a href="raster.html#topic+brick">RasterBrick</a></code>, or <code><a href="raster.html#topic+stack">RasterStack</a></code> object.
</p>
<p>If package <span class="pkg">raster</span> is not installed then return value is <code>NULL</code>
</p>


<h3>Note</h3>

<p>Package <span class="pkg">raster</span> is marked as &quot;Suggested&quot;.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'> ## test is skipped: raster's loading time is close to CRAN allowable test time
session_grid(NULL)
if (requireNamespace("raster")) {
   usedCRS &lt;- ursa:::.crsForceProj4()
   ursa:::.crsForceProj4(TRUE) ## required for CRS comparison
   session_grid(regrid(mul=1/4))
   msk &lt;- ursa_dummy(1,min=0,max=100)&gt;40
   a1 &lt;- ursa_dummy(1,min=200,max=500)[msk]
   a2 &lt;- colorize(a1,ramp=FALSE,interval=FALSE,lazyload=FALSE)
   a3 &lt;- as.integer(ursa_dummy(3,min=0,max=255.99))
   a4 &lt;- ursa_stack(a3[msk])
   if (isLayer &lt;- TRUE) {
      print(a1)
      r1 &lt;- as.Raster(a1)
      message(as.character(class(r1)))
      print(r1)
      print(raster::spplot(r1))
      b1 &lt;- as.ursa(r1)
      print(c(exported=a1,imported=b1,failed=b1-a1))
      print(c(theSameValue=identical(ursa_value(a1),ursa_value(b1))
             ,theSameGrid=identical(ursa_grid(a1),ursa_grid(b1))))
   }
   if (isLayerColortable &lt;- TRUE) {
      r2 &lt;- as.Raster(a2)
      message(as.character(class(r2)))
      print(r2)
      print(raster::spplot(r2))
      b2 &lt;- as.ursa(r2)
      print(c(theSameValue=identical(ursa_value(a2),ursa_value(b2))
             ,theSameGrid=identical(ursa_grid(a2),ursa_grid(b2))))
   }
   if (isBrickOrRGB &lt;- TRUE) {
      r3 &lt;- as.Raster(a3)
      message(as.character(class(r3)))
      print(r3)
      print(raster::spplot(r3))
      raster::plotRGB(r3)
      b3 &lt;- as.ursa(r3)
      print(c(theSameValue=identical(ursa_value(a3),ursa_value(b3))
             ,theSameGrid=identical(ursa_grid(a3),ursa_grid(b3))))
   }
   if (isStack &lt;- TRUE) {
      r4 &lt;- as.Raster(a4)
      message(as.character(class(r4)))
      print(r4)
      print(raster::spplot(r4))
      b4 &lt;- as.ursa(r4)
      print(c(theSameValue=identical(ursa_value(a4),ursa_value(b4))
             ,theSameGrid=identical(ursa_grid(a4),ursa_grid(b4))))
   }
   ursa:::.crsForceProj4(usedCRS)
}

</code></pre>

<hr>
<h2 id='as.table'>
Frequency of unique values
</h2><span id='topic+as.table'></span><span id='topic+as.table.ursaRaster'></span><span id='topic+ursa_table'></span>

<h3>Description</h3>

<p><code>as.table</code> is an implementation of function <code><a href="base.html#topic+table">base::table</a></code> for values of raster image.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaRaster'
as.table(x, ...)

ursa_table(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as.table_+3A_x">x</code></td>
<td>

<p><code>ursaRaster</code> object.
</p>
</td></tr>
<tr><td><code id="as.table_+3A_...">...</code></td>
<td>

<p>Other arguments which passed to function <code><a href="base.html#topic+table">table</a></code> of package <span class="pkg">base</span>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>ursaRaster</code> has a <code><a href="#topic+classColorTable">colortable</a></code>, then values are replaced by names of categories.
</p>
<p><code>ursa_table</code> is synonym to method <code>as.table</code> for class <code>`ursaRaster`</code>.
</p>


<h3>Value</h3>

<p>Object of class <code><a href="base.html#topic+table">table</a></code>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- colorize(pixelsize(),nbreak=4)
t1 &lt;- as.table(a)
print(t1)
str(t1)
ursa_colortable(a) &lt;- NULL
t2 &lt;- as.table(a)
print(t2)
</code></pre>

<hr>
<h2 id='as.ursa'>
Create raster image from R objects or GDAL raster files.
</h2><span id='topic+as.ursa'></span><span id='topic+as_ursa'></span>

<h3>Description</h3>

<p><code>as.ursa</code> converts <span class="rlang"><b>R</b></span> <span class="pkg">base</span> objects <code><a href="base.html#topic+matrix">matrix</a></code>, <code><a href="base.html#topic+array">array</a></code>, <code><a href="base.html#topic+numeric">numeric</a></code>, <code><a href="base.html#topic+data.frame">data.frame</a></code> <code><a href="base.html#topic+list">list</a></code>, <span class="pkg">sp</span> objects <code><a href="sp.html#topic+SpatialGridDataFrame">SpatialGridDataFrame</a></code>, <code><a href="sp.html#topic+SpatialGridDataFrame">SpatialPixelsDataFrame</a></code> and <code><a href="sp.html#topic+SpatialPoints">SpatialPointsDataFrame</a></code>, <span class="pkg">raster</span> objects <code><a href="raster.html#topic+raster">raster</a></code>, <code><a href="raster.html#topic+stack">stack</a></code> and <code><a href="raster.html#topic+brick">brick</a></code>, and GDAL raster files (using functions from <span class="pkg">rgdal</span> package) to <code>ursaRaster</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as.ursa(obj, ...)
as_ursa(obj, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as.ursa_+3A_obj">obj</code></td>
<td>

<p><span class="rlang"><b>R</b></span> object for coercion
</p>
</td></tr>
<tr><td><code id="as.ursa_+3A_...">...</code></td>
<td>

<p>Depending on class of <code>obj</code>, arguments are passed to repsective functions.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>as_ursa</code> is a synonym to <code>as.ursa</code>.
</p>
<p>This is a high-level function to create <code>ursaRaster</code> objects. The follwed classes of <span class="rlang"><b>R</b></span> objects are implemented:
</p>

<table>
<tr>
 <td style="text-align: left;">
   &lsquo;Data Class&rsquo; </td><td style="text-align: left;"> &lsquo;Appropriate method&rsquo;</td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="base.html#topic+array">array</a></code> </td><td style="text-align: left;"> <code><a href="#topic+ursa_new">ursa_new</a></code></td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="base.html#topic+matrix">matrix</a></code> </td><td style="text-align: left;"> <code><a href="#topic+ursa_new">ursa_new</a></code></td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="base.html#topic+numeric">numeric</a></code> </td><td style="text-align: left;"> <code><a href="#topic+ursa_new">ursa_new</a></code></td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="base.html#topic+data.frame">data.frame</a></code> </td><td style="text-align: left;"> <code><a href="#topic+allocate">allocate</a></code></td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="sp.html#topic+SpatialPoints">SpatialPointsDataFrame</a></code> (<span class="pkg">sp</span>)</td><td style="text-align: left;"> <code><a href="#topic+allocate">allocate</a></code></td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="sp.html#topic+SpatialGridDataFrame">SpatialPixelsDataFrame</a></code> (<span class="pkg">sp</span>)</td><td style="text-align: left;"> <code><a href="#topic+allocate">allocate</a></code></td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="sp.html#topic+SpatialGridDataFrame">SpatialGridDataFrame</a></code> (<span class="pkg">sp</span>)</td><td style="text-align: left;"> <code><a href="#topic+ursa_new">ursa_new</a></code></td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="#topic+classStack">list</a></code> of <code>ursaRaster</code> objects </td><td style="text-align: left;"> <code><a href="#topic+classStack">unlist</a></code></td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="sf.html#topic+gdal">list</a></code> returned by <code><a href="sf.html#topic+gdal">sf::gdal_read</a></code> </td><td style="text-align: left;"> <code><a href="#topic+ursa_new">ursa_new</a></code></td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="base.html#topic+list">list</a></code> <em>(general)</em> </td><td style="text-align: left;"> Items <code>$x</code> and <code>$y</code> are required, If lengths of <code>$x</code> and <code>$y</code> are equal to dim of data, then <code><a href="#topic+allocate">allocate</a></code>, else: 1) <a href="#topic+classGrid">raster grid</a> is defined from <code>$x</code> and <code>$y</code>, 2) <code><a href="#topic+ursa_new">ursa_new</a></code> is called.</td>
</tr>
<tr>
 <td style="text-align: left;">
   <code>ggmap</code> (<span class="pkg">ggmap</span>) </td><td style="text-align: left;"> <code><a href="#topic+ursa_new">ursa_new</a></code>.</td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="raster.html#topic+raster">raster</a></code> (<span class="pkg">raster</span>)</td><td style="text-align: left;"> <code><a href="#topic+ursa_new">ursa_new</a></code>.</td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="raster.html#topic+brick">brick</a></code> (<span class="pkg">raster</span>)</td><td style="text-align: left;"> <code><a href="#topic+ursa_new">ursa_new</a></code>.</td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="raster.html#topic+stack">stack</a></code> (<span class="pkg">raster</span>)</td><td style="text-align: left;"> <code><a href="#topic+ursa_new">ursa_new</a></code>.</td>
</tr>
<tr>
 <td style="text-align: left;">
   <code>bitmap</code> (<span class="pkg">magick</span>)</td><td style="text-align: left;"> <code><a href="#topic+ursa_new">ursa_new</a></code>.</td>
</tr>
<tr>
 <td style="text-align: left;">
   <code><a href="base.html#topic+character">character</a></code> (GDAL supported file name) </td><td style="text-align: left;"> <code><a href="#topic+conn.read_gdal">read_gdal</a></code>.
</td>
</tr>

</table>

<p>Generally, <code><a href="#topic+allocate">allocate</a></code> is used for objects with non-regular grid, and <code><a href="#topic+ursa_new">ursa_new</a></code> is used for regular grids. The <a href="#topic+classGrid">raster grid</a> is defined from object properties or from <a href="#topic+session">sessional grid</a>.
</p>
<p>Color tables are supported for GDAL file names and <span class="pkg">raster</span> objects (raster, brick, stack).
</p>
<p>For ENVI *.hdr Labelled Raster Files there are alternatives:
</p>

<ol>
<li><p> Read object with GDAL (<code><a href="#topic+conn.read_gdal">read_gdal</a></code>);
</p>
</li>
<li><p> Read object without GDAL (<code><a href="#topic+conn.read_envi">read_envi</a></code>).
</p>
</li></ol>



<h3>Value</h3>

<p>Object of class <code>ursaRaster</code>
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a1 &lt;- as.ursa(volcano)
print(a1)
display(a1)

session_grid(NULL)
b &lt;- ursa_dummy(mul=1/16,bandname=format(Sys.Date()+seq(3)-1,"%A"))
print(b)

c1 &lt;- b[[1]] ## equal to 'c1 &lt;- as.matrix(b[1],coords=TRUE)'
str(c1)
b1a &lt;- as.ursa(c1)
print(c(original=b[1],imported=b1a))
print(c(projection.b1a=ursa_proj(b1a)))
session_grid(NULL)
b1b &lt;- as.ursa(c1$z)
print(b1b)
print(c(projection.b1b=ursa_proj(b1b)))

c2 &lt;- as.data.frame(b)
str(c2)
session_grid(NULL)
b2a &lt;- as.ursa(c2)
print(b2a)

session_grid(NULL)
attr(c2,"crs") &lt;- NULL
b2b &lt;- as.ursa(c2)
print(b2b)
print(ursa_grid(b2b))

c3 &lt;- unclass(as.matrix(b,coords=TRUE))
str(c3)
session_grid(b)
b3a &lt;- as.ursa(c3)
print(b3a)
print(ursa_grid(b3a))
session_grid(NULL)
b3b &lt;- as.ursa(c3)
print(b3b)
print(ursa_grid(b3b))

c4 &lt;- as.array(b)
str(c4)
session_grid(b)
b4a &lt;- as.ursa(c4)
print(b4a)
print(ursa_grid(b4a))
session_grid(NULL)
b4b &lt;- as.ursa(c4)
print(b4b)
print(ursa_grid(b4b))

n &lt;- 20
c5 &lt;- data.frame(y=runif(n,min=1000000,max=5000000)
                ,x=runif(n,min=-3000000,max=1000000)
                ,value=runif(n,min=0,max=10))
print(head(c5))
session_grid(b)
b5a &lt;- as.ursa(c5)
print(b5a)
 ## to avoid over-timing during tests -- begin
   display(b5a)
 ## to avoid over-timing during tests -- end
session_grid(NULL)
b5b &lt;- as.ursa(c5)
print(b5b)
 ## to avoid over-timing during tests -- begin
   display(b5b)
 ## to avoid over-timing during tests -- end

# b6 &lt;- as.ursa(system.file("pictures/erdas_spnad83.tif",package="rgdal"))
b6 &lt;- as.ursa(system.file("tif/geomatrix.tif",package="sf"))
print(b6)
display(b6,pal=c("black","white"),coast=FALSE,col="orange")

 ## package 'raster' is required -- begin
if (requireNamespace("raster")) {
   r &lt;- raster::brick(system.file("external/rlogo.gri",package="raster"))
   print(r)
   b7 &lt;- as.ursa(r)
   ursa_proj(b7) &lt;- ""
   print(b7)
   display_rgb(b7)
}
 ## package 'raster' is required -- end
</code></pre>

<hr>
<h2 id='band_group'>
Extract certain statistics of each band.
</h2><span id='topic+band_mean'></span><span id='topic+band_sd'></span><span id='topic+band_sum'></span><span id='topic+band_min'></span><span id='topic+band_max'></span><span id='topic+band_n'></span><span id='topic+band_nNA'></span><span id='topic+band_quantile'></span>

<h3>Description</h3>

<p>Function from this <code>band.*</code> list returns required statistics for each band.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>band_mean(obj)
band_sd(obj)
band_sum(obj)
band_min(obj)
band_max(obj)
band_n(obj)
band_nNA(obj)
band_quantile(obj, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="band_group_+3A_obj">obj</code></td>
<td>

<p>Object of class <code>ursaRaster</code>.
</p>
</td></tr>
<tr><td><code id="band_group_+3A_...">...</code></td>
<td>

<p>Arguments, which are passed to generic <code><a href="stats.html#topic+quantile">quantile</a></code> function, e.g. <code>probs</code>, <code>type</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li> <p><code>band_mean</code> returns mean value.
</p>
</li>
<li> <p><code>band_sd</code> returns value of standard deviation with <code>n-1</code> denominator.
</p>
</li>
<li> <p><code>band_sum</code> returns sum of values.
</p>
</li>
<li> <p><code>band_min</code> returns minimal value.
</p>
</li>
<li> <p><code>band_max</code> returns maximal value.
</p>
</li>
<li> <p><code>band_n</code> returns number of non-<code>NA</code> pixels.
</p>
</li>
<li> <p><code>band_nNA</code> returns number of <code>NA</code> pixels.
</p>
</li>
<li> <p><code>band_quantile</code> returns matrix of quantiles.
</p>
</li></ul>



<h3>Value</h3>

<p>Named vector of numerical or integer values. Band names are used for naming.
</p>


<h3>Note</h3>

<p>Currently, implementation is not optimal, because firstly bundle of statistics is computed using <a href="#topic+Ops.band_stat">band_stat</a> function, and then required statistics is extracted.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Ops.band_stat">band_stat</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- ursa_dummy()
print(a)
print(a&lt;80)
print(class(a))
a[a&lt;80]
a[a&lt;80] &lt;- NA
b1 &lt;- band_stat(a)
print(b1)
b2.n &lt;- band_n(a)
str(b2.n)
b2.mean &lt;- band_mean(a)
print(b1$mean)
print(b2.mean)
print(b1$mean-b2.mean)
print(band_quantile(a))
</code></pre>

<hr>
<h2 id='band_stat'>
Computes statistics for each band of raster.
</h2><span id='topic+band_stat'></span>

<h3>Description</h3>

<p>For each band of <code>ursaRaster</code> object, <code>band_stat</code> returns certain statistics (mean, sd, sum, min, max, number of non-<code>NA</code> pixels, number of <code>NA</code> pixels). Regarding to each band, it is <em>global</em> operations of map algebra.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>band_stat(x, grid = FALSE, raw = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="band_stat_+3A_x">x</code></td>
<td>

<p>Object of class <code>ursaRaster</code>.
</p>
</td></tr>
<tr><td><code id="band_stat_+3A_grid">grid</code></td>
<td>

<p>Logical. If <code>TRUE</code> then metadata are returned instead of statistics. Default is <code>FALSE</code>
</p>
</td></tr>
<tr><td><code id="band_stat_+3A_raw">raw</code></td>
<td>

<p>Logical. For the case of raster values are categories, if <code>raw=TRUE</code>, then function returns statistics of categories; if <code>raw=FALSE</code> and names of categories can be transformed to numerical values, then function returns statistics for decategorized values. Default is <code>FALSE</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If raster values are not in memory or <code>grid=TRUE</code> then <code><a href="#topic+ursa_info">ursa_info</a></code> is returned.
</p>
<p>Generic function <code><a href="#topic+classRaster">print</a></code> for object of class <code>ursaRaster</code> uses returned value of <code>band_stat</code> function with formatted columns.
</p>
<p>Statistics is computed for omitted <code>NA</code> values.
</p>


<h3>Value</h3>

<p><code><a href="base.html#topic+data.frame">data.frame</a></code>. Row names are indices of bands. Column names are:
</p>
<table role = "presentation">
<tr><td><code>name</code></td>
<td>
<p>Band name.</p>
</td></tr>
<tr><td><code>mean</code></td>
<td>
<p>Mean value.</p>
</td></tr>
<tr><td><code>sd</code></td>
<td>
<p>Value of standard deviation with <code>n-1</code> denomination.</p>
</td></tr>
<tr><td><code>sum</code></td>
<td>
<p>Sum of values.</p>
</td></tr>
<tr><td><code>min</code></td>
<td>
<p>Minimal value.</p>
</td></tr>
<tr><td><code>min</code></td>
<td>
<p>Maximal value.</p>
</td></tr>
<tr><td><code>n</code></td>
<td>
<p>Number of non-<code>NA</code> pixels.</p>
</td></tr>
<tr><td><code>nNA</code></td>
<td>
<p>Number of <code>NA</code> pixels.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>See Also</h3>

<p>Columns extraction from returned data frame is in the group of <code><a href="#topic+Ops.band_group">band.*</a></code> functions.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
s &lt;- substr(as.character(sessionInfo()),1,48)
a &lt;- reclass(ursa_dummy(mul=1/2,bandname=s),ramp=FALSE)
band_stat(a,grid=TRUE)
b2 &lt;- band_stat(a)
b3 &lt;- band_stat(a,raw=TRUE)
str(b2)
str(b3)
print(b2)
print(a) ## 'print.ursaRaster' uses 'band_stat'
print(a,raw=TRUE)
</code></pre>

<hr>
<h2 id='bandname'>
Band names for raster image.
</h2><span id='topic+bandname'></span><span id='topic+bandname+3C-'></span><span id='topic+names.ursaRaster'></span><span id='topic+names+3C-.ursaRaster'></span>

<h3>Description</h3>

<p><code>bandname</code> (<code>names</code>) returns names of bands for object of class <code>ursaRaster</code> or existing ENVI labelled *.hdr file.
<code>bandname&lt;-</code> (<code>names&lt;-</code>) sets names of bands for object of class <code>ursaRaster</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bandname(x)
bandname(x) &lt;- value

## S3 method for class 'ursaRaster'
names(x)

## S3 replacement method for class 'ursaRaster'
names(x) &lt;- value
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="bandname_+3A_x">x</code></td>
<td>

<p>Object of class <code>ursaRaster</code>. In the <code>bandname</code> function it is allowed to specify character &lsquo;<span class="file">ENVI labelled *.hdr</span>&rsquo; file name.
</p>
</td></tr>
<tr><td><code id="bandname_+3A_value">value</code></td>
<td>

<p>Character of length the same length of number of bands of <code>x</code>
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>names</code> is a synonym for <code>bandname</code>. <code>names&lt;-</code> is a synonym for <code>bandname&lt;-</code>
</p>


<h3>Value</h3>

<p>For <code>bandname</code> and <code>names</code>, character vector.
</p>
<p>For <code>bandname&lt;-</code> and <code>names&lt;-</code>, updated object of class <code>ursaRaster</code>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+classRaster_length">nband</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a1 &lt;- pixelsize()
a2 &lt;- c("Band 1"=a1,Band2=a1/2,sqrt=sqrt(a1),NA)
print(a2)
print(bandname(a2))
bandname(a2)[1:2] &lt;- c("Original","Half")
print(a2)
print(bandname(a2))
</code></pre>

<hr>
<h2 id='blank'>
Does any band contain no information?
</h2><span id='topic+band_blank'></span><span id='topic+ursa_blank'></span>

<h3>Description</h3>

<p>Set of functions for checking is any or all bands have no data, and for retrieving indices for non-data bands.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>band_blank(obj, ref = c("any", "0", "NA"), verbose = FALSE)
ursa_blank(obj, ref)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="blank_+3A_obj">obj</code></td>
<td>

<p>Object of class <code>ursaRaster</code>
</p>
</td></tr>
<tr><td><code id="blank_+3A_ref">ref</code></td>
<td>

<p>Character. Definition criteria, what is blank mean. If value <code>"0"</code>, then blank is detected, if all values are 0. If value <code>"NA"</code>, then blank is detected, if all values are <code>NA</code>. Default value is <code>"NA"</code>: both <code>NA</code> and <code>0</code> are flags of blank. Non-character values are coerced to character.
</p>
</td></tr>
<tr><td><code id="blank_+3A_verbose">verbose</code></td>
<td>

<p>Logical. Value <code>TRUE</code> provides progress bar. Default is <code>FALSE</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It is defined locally that if all values of band are <code>NA</code> or 0 (see description to argument <code>ref</code>), then such band is blank. The fact is <code><a href="#topic+ursa_new">ursa_new</a></code> create new object in memory with default values <code>NA</code>, but <code><a href="#topic+conn.create_any">create_envi</a></code> writes zeros to disk quick. It is decided to consider both these cases as blank. Function <code>band_blank</code> checks blanks for each band of image. If all bands are blank then function <code>ursa_blank</code> returns <code>TRUE</code>.
</p>


<h3>Value</h3>

<p>Function <code>ursa_blank</code> returns logical value of length 1.
</p>
<p>Function <code>band_blank</code> returns logical value of length <code><a href="#topic+classRaster_length">nband(obj)</a></code>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+classRaster_is.na">is.na</a></code> returns object of class <code>ursaRaster</code>; it is mask of cells, which have <code>NA</code> value.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- ursa_new(bandname=c("first","second","third","fourth"))
ursa_value(a,"first") &lt;- 0 ## 'a[1] &lt;- 1' works, but it is slow
print(ursa_blank(a))
a[3] &lt;- pixelsize()
a[4] &lt;- a[3]&gt;625
print(a)
print(band_blank(a))
print(which(band_blank(a)))
print(ursa_blank(a))
</code></pre>

<hr>
<h2 id='c'>
Combine bands into raster brick.
</h2><span id='topic+c.ursaRaster'></span>

<h3>Description</h3>

<p>This function is an instrument for appending bands or for reorganizing bands.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaRaster'
c(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="c_+3A_...">...</code></td>
<td>

<p>Objects of class <code>ursaRaster</code> or coerced to class <code>ursaRaster</code>. First argument should be the object of class <code>ursaRaster</code>. The objects in the sequence can be named.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>You may use this function to assign new bandname for single-band raster: <code>objDst &lt;- c('Relative density'=objSrc)</code>
</p>
<p>Use also 'Extract' operator <code><a href="#topic+classRaster.Extract">[ ]</a></code> to reorganize band sequence.
</p>
<p>The returned object can be interpreted as a <strong><em>brick</em></strong> in the notation of package <span class="pkg">raster</span>. To produce <strong><em>stack</em></strong> just call <code><a href="base.html#topic+list">list</a></code> or <code><a href="#topic+classStack">ursa_stack</a></code>.
</p>


<h3>Value</h3>

<p><code>ursaRaster</code> object.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+classStack">ursa_brick</a></code> converts list of <code>ursaRaster</code> objects (<strong><em>stack</em></strong>) to a singe multiband <code>ursaRaster</code> object (<strong><em>brick</em></strong>).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
session_grid(regrid(mul=1/16))
a1 &lt;- ursa_dummy(nband=2)
names(a1) &lt;-  weekdays(Sys.Date()+seq(length(a1))-1)
a2 &lt;- ursa_dummy(nband=2)
names(a2) &lt;- names(a1)
print(a1)
print(a2)
a3 &lt;- a1[1]
print(names(a3))
a4 &lt;- c(today=a3)
print(names(a4))
print(b1 &lt;- c(a1,a2))
print(b2 &lt;- c(a1=a1))
print(b3 &lt;- c(a1=a1,a2=a2))
print(b5 &lt;- c(a1=a1,a2=a2[1]))
print(b4 &lt;- c(a1,'(tomorrow)'=a1[2])) ## raster append
print(b6 &lt;- c(a1,50))
</code></pre>

<hr>
<h2 id='chunk'>
Get indices for partial image reading/writing
</h2><span id='topic+chunk_band'></span><span id='topic+chunk_line'></span><span id='topic+chunk_expand'></span>

<h3>Description</h3>

<p>In the case of 'Cannot allocate vector of size ...' error message <code>chunk_band</code> returns list of bands indices, which are suitable for allocation in memory at once, <code>chunk_line</code> returns list of lines (rows) indices, which are suitable for allocation in memory at once. <code>chunk_expand</code> is used to expand lines indices and can by applied in focal functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chunk_band(obj, mem = 100, mul = 1)
chunk_line(obj, mem = 100, mul = 1)
chunk_expand(ind, size = 3)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="chunk_+3A_obj">obj</code></td>
<td>

<p>Object of class <code>ursaRaster</code>
</p>
</td></tr>
<tr><td><code id="chunk_+3A_mem">mem</code></td>
<td>

<p>Numeric. Memory size in GB, which is suitable for allocation.
</p>
</td></tr>
<tr><td><code id="chunk_+3A_mul">mul</code></td>
<td>

<p>Numeric. Expansion or reduction factor (multiplier) of default value of memory allocation.
</p>
</td></tr>
<tr><td><code id="chunk_+3A_ind">ind</code></td>
<td>

<p>Integer. Line indices.
</p>
</td></tr>
<tr><td><code id="chunk_+3A_size">size</code></td>
<td>

<p>Integer. Size of focal window.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>chunk_band</code> returns list with sequences of bands
</p>
<p><code>chunk_line</code> returns list with sequences of lines
</p>
<p><code>chunk_expand</code> returns list:
</p>
<table role = "presentation">
<tr><td><code>src</code></td>
<td>
<p>expanded set if line indices</p>
</td></tr>
<tr><td><code>dst</code></td>
<td>
<p>matching of source indices in the expanded set</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'> ## 1. Prepare data
 session_grid(NULL)
 fname &lt;- ursa:::.maketmp(2)
 a &lt;- create_envi(fname[1],nband=3,ignorevalue=-99)
 for (i in seq(nband(a)))
   a[i] &lt;- pixelsize()^(1/i)
 close(a)
 rm(a)
 
 ## 2. Read 
 a &lt;- open_envi(fname[1])
 chB &lt;- chunk_band(a,2)
 str(chB)
 for (i in chB)
    print(a[i])
 chL &lt;- chunk_line(a,2.5)
 str(chL)
 for (j in chL)
    print(a[,j])
 
 ## 3. Filtering with partial reading
 b &lt;- create_envi(a,fname[2])
 fsize &lt;- 15
 for (j in chL) {
    k &lt;- chunk_expand(j,fsize)
    b[,j] &lt;- focal_mean(a[,k$src],size=fsize)[,k$dst]
 }
 d1 &lt;- b[]
 
 ##  4. Filtering in memory
 d2 &lt;- focal_mean(a[],size=fsize)
 close(a,b)
 envi_remove(fname)
 print(d1-d2)
 print(round(d1-d2,4))
</code></pre>

<hr>
<h2 id='close'>
Close connections for files with data
</h2><span id='topic+close.ursaRaster'></span><span id='topic+close_envi'></span>

<h3>Description</h3>

<p><code>close()</code> for <code>ursaRaster</code> object closes connection for opened file using inheritted function <code><a href="base.html#topic+connections">base::close</a></code>. Function <code>close_envi()</code> closes opened connection for ENVI binary file. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaRaster'
close(...)

close_envi(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="close_+3A_...">...</code></td>
<td>

<p>Object or sequence of objects of class <code>ursaRaster</code>.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>NULL</code>
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="base.html#topic+connections">close</a></code> of <span class="pkg">base</span> package
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- create_envi()
fname &lt;- a$con$fname
message(paste("Created file",dQuote(basename(fname)),"will be deleted."))
print(dir(pattern=basename(envi_list(fname))))
close(a)
invisible(envi_remove(fname))
</code></pre>

<hr>
<h2 id='codec'>
Reduce and restore dimenstions for sparse data matrix
</h2><span id='topic+compress'></span><span id='topic+decompress'></span>

<h3>Description</h3>

<p><code>compress</code> reduces dimension of source image matrix and assigns indices. <code>decompress</code> uses indices for expansion of reduced image matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>decompress(obj)
compress(obj)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="codec_+3A_obj">obj</code></td>
<td>

<p>Object of class <code>ursaRaster</code>
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>After masking, vectorization of lines, points and small polygons image matrix is often sparse.
Compressing (<code>compress</code>) is an option to reduce object size in memory. Decompressing (<code>decompress</code>) restore original data matrix.
</p>


<h3>Value</h3>

<p>Object of class <code>ursaRaster</code>
</p>


<h3>Note</h3>

<p>Currently, usage of compressed image matrix is limited. Spatial filtering (e.g. <code><a href="#topic+Ops.focal_mean">focal_mean</a></code>) does not operate with compressed data.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
b &lt;- as.data.frame(pixelsize())
b &lt;- subset(b,x&gt;1000000 &amp; x&lt;2000000 &amp; y&gt;3000000 &amp; y&lt;4000000)
a1 &lt;- as.ursa(b)
print(a1)
print(object.size(a1))
a2 &lt;- compress(a1)
print(a2)
print(object.size(a2))
a3 &lt;- decompress(a2)
print(a3)
print(object.size(a3))
print(identical(a1,a3))
</code></pre>

<hr>
<h2 id='colorize'>
Create color table
</h2><span id='topic+colorize'></span><span id='topic+palettize'></span>

<h3>Description</h3>

<p><code>colorize</code> assigns color table to raster image.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>colorize(obj, value = NULL, breakvalue = NULL, name = NULL, pal = NULL, inv = NA,
         stretch = c("default", "linear", "equal", "mean", "positive",
                     "negative", "zero", "diff", "category", "julian",
                     "date", "time", "slope", "conc", "sd", "significance",
                     "bathy", "grayscale", "greyscale"),
         minvalue = NA, maxvalue = NA, byvalue = NA, ltail = NA, rtail = NA, tail = NA,
         ncolor = NA, nbreak = NA, interval = NA_integer_, ramp = FALSE, byte = FALSE,
         lazyload = TRUE, reset = FALSE, origin = "1970-01-01" ,format = "",
         alpha = "", colortable = NULL, verbose = FALSE, ...)
                          
palettize(...) ## wrapper for non-spatial vectors
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="colorize_+3A_obj">obj</code></td>
<td>

<p><code>ursaRaster</code> object or one-dimension numeric or character vector.
</p>
</td></tr>
<tr><td><code id="colorize_+3A_value">value</code></td>
<td>

<p>Numeric. Values to be assigned to categories.
</p>
</td></tr>
<tr><td><code id="colorize_+3A_breakvalue">breakvalue</code></td>
<td>

<p>Numeric. Values to be assigned to intervals.
</p>
</td></tr>
<tr><td><code id="colorize_+3A_name">name</code></td>
<td>

<p>Character. Names of categories.
</p>
</td></tr>



<tr><td><code id="colorize_+3A_pal">pal</code></td>
<td>

<p>Function or character. If function then value should corresponded to function, which creates a vector of colors. If character then values should correponded to <span class="rlang"><b>R</b></span> color names or hexadecimal string of the form &quot;#RRGGBB&quot; or &quot;#RRGGBBAA&quot;.
</p>
</td></tr>



<tr><td><code id="colorize_+3A_inv">inv</code></td>
<td>

<p>Logical. Invert sequence of colors.
</p>
</td></tr>
<tr><td><code id="colorize_+3A_stretch">stretch</code></td>
<td>

<p>Character. Either kind of value transformation (<code>"linear", "equal"</code>) or pre-defined options with palette specification (<code>"positive", "data", "significance"</code>, etc)
</p>
</td></tr>
<tr><td><code id="colorize_+3A_minvalue">minvalue</code></td>
<td>

<p>Numeric. Lower range limit.
</p>
</td></tr>
<tr><td><code id="colorize_+3A_maxvalue">maxvalue</code></td>
<td>

<p>Numeric. Upper range limit.
</p>
</td></tr>
<tr><td><code id="colorize_+3A_byvalue">byvalue</code></td>
<td>

<p>Numeric. Increment of the sequence from <code>minvalue</code> to <code>maxvalue</code>.
</p>
</td></tr>
<tr><td><code id="colorize_+3A_ltail">ltail</code></td>
<td>

<p>Numeric. Partition of omitted values at left tail.
</p>
</td></tr>
<tr><td><code id="colorize_+3A_rtail">rtail</code></td>
<td>

<p>Numeric. Partition of omitted values at right tail.
</p>
</td></tr>
<tr><td><code id="colorize_+3A_tail">tail</code></td>
<td>

<p>Numeric. Partition of omitted values at both tail. If length of <code>tail</code> is 2 then left and right tails may differ.
</p>
</td></tr>
<tr><td><code id="colorize_+3A_ncolor">ncolor</code></td>
<td>

<p>Numeric or interer. Number of desired colors (or categories).
</p>
</td></tr>
<tr><td><code id="colorize_+3A_nbreak">nbreak</code></td>
<td>

<p>Numeric or interer. Number of desired separators between colors.
</p>
</td></tr>



<tr><td><code id="colorize_+3A_interval">interval</code></td>
<td>

<p>Integer or logical. Logical is coerced to integer. How to underwrite categories? Value <code>0L</code> means that for numeric data each color gradation corresponds to intervals but named as a single value (e.g., middle between low and high values). Value <code>1L</code> means that values correspond to separators of color gradation. Value <code>2L</code> is experimental for scales with zero. Default is <code>NA</code>: <code>interval=0L</code> for <code>ramp=TRUE</code> and <code>interval=1L</code> for <code>ramp=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="colorize_+3A_ramp">ramp</code></td>
<td>

<p>Logical. Is color ramp required?
</p>
</td></tr>
<tr><td><code id="colorize_+3A_byte">byte</code></td>
<td>

<p>Logical. Forcing to produce color table for storage in byte format (not more than 255 colors). Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="colorize_+3A_lazyload">lazyload</code></td>
<td>

<p>Logical. If <code>FALSE</code> then raster is reclassified to categories. If <code>TRUE</code> then color table is created without any change to source raster and raster value just postponed for change. Default is <code>TRUE</code>.
</p>
</td></tr>
<tr><td><code id="colorize_+3A_reset">reset</code></td>
<td>

<p>Logical. If <code>TRUE</code> and source raster has color table, then this color table is destroyed, and new one is created. Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="colorize_+3A_origin">origin</code></td>
<td>

<p>Character. Origin for <code>stretch="date"</code> (passed to function <code><a href="base.html#topic+as.Date">as.Date</a></code>) and <code>stretch="time"</code> (passed to function <code><a href="base.html#topic+as.POSIXlt">as.POSIXct</a></code>). See desription of <code>orogin</code> in respective functions. Default is &quot;1970-01-01&quot;.
</p>
</td></tr>
<tr><td><code id="colorize_+3A_format">format</code></td>
<td>

<p>Character. Format date/time objects for arguments <code>stretch</code> with values &quot;date&quot;, &quot;time&quot;, or &quot;julian&quot;. Default is &quot;&quot; (character of length 0).
</p>
</td></tr>
<tr><td><code id="colorize_+3A_alpha">alpha</code></td>
<td>

<p>Character or numeric. The characteristics of transparency. If character, then hexadecimal values between &quot;00&quot; and &quot;FF&quot; are allowed, and then coerced to numeric value between 0 and 255. If numeric, and <code style="white-space: pre;">&#8288;0 &lt;= alpha &lt;= 1&#8288;</code>, then <code>alpha</code> is multiplied to 255. <code>alpha=0</code> means full transparency,  <code>alpha=255</code> means full opacity. Default is &quot;&quot;; if palette has no alpha channel, then <code>alpha</code> is assign to <code>"FF"</code>.
</p>
</td></tr>
<tr><td><code id="colorize_+3A_colortable">colortable</code></td>
<td>

<p>Object of class <code>ursaColorTable</code> or object of class <code>ursaRaster</code> with color table. Reference color table. Is specified, then all other arguments are ignored, expexted <code>lazyload</code>. Default is <code>NULL</code> (unspecified).
</p>
</td></tr>
<tr><td><code id="colorize_+3A_verbose">verbose</code></td>
<td>

<p>Logical. Some output in console. Primarily for debug purposes.
</p>
</td></tr>
<tr><td><code id="colorize_+3A_...">...</code></td>
<td>

<p>For <code>colorize()</code>: If <code>pal</code> is a function, and argument names are in the format &quot;<code>pal.*</code>&quot; then prefix &quot;<code>pal.</code>&quot; is omitted, and the rest part is used for argument names, which are passed to <code>pal</code> function.
</p>
<p>For <code>palettize()</code>: Arguments, which are passed to <code>colorize()</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>palettize</code> is a wrapper <code>ursa_colortable(colorize(...))</code> to return color table for one-dimensional numeric or character vector.
</p>
<p><code>colortable</code> is designed to prepare pretty thematic maps.
</p>
<p>Color rampimg (<code>ramp=TRUE</code>) is not quick in computatons and has no effective labelling. It is intoduced to visualize non-thematic maps, and it is assumed that labeling can be omitted for such maps.
</p>
<p>The labelling implementation is based on some improvements of <code><a href="base.html#topic+pretty">pretty</a></code> function. The notation of intervals is mixed by brackets and comparative symbols, for example: <code>"&lt;=1.5","(1.5,2.5]","(2.5,3.5]","&gt;3.5"</code>
</p>
<p>Reserved values for <code>interval</code>:
</p>

<ul>
<li><p><code>0L</code> or <code>FALSE</code> - no interlavs. Values are interpreted as category, even if they are in non-nominal scale
</p>
</li>
<li><p><code>1L</code> or <code>TRUE</code> - each category corresponds to interval. The low limit of lowest category is <code>-Inf</code>. The high limit of highest category is <code>+Inf</code>
</p>
</li>
<li><p><code>2L</code> - different implementation of <code>interval=1</code>. In some cases may relult more pretty labeling.

</p>
<p>If <code>breaks</code> is numerical vector and <code>colors</code> has zero length, then it is assumed interal scaling, and <code>interval=1L</code> is assigned to unspecified <code>interval</code>
</p>
<p>Finite values of extreme intervals are neccessary sometimes, however this option is not implemented currently
</p>
</li></ul>

<p>Keywords for <code>stretch</code> to create pre-defined color tables:
</p>

<ul>
<li><p><code>"positive"</code> - lower limit is 0. Palette is &quot;Oranges&quot;
</p>
</li>
<li><p><code>"negative"</code> - higher limit is 0. Palette is &quot;Purples&quot;
</p>
</li>
<li><p><code>"grayscale", "greyscale"</code> - palette is &quot;Greys&quot;. Usually used for raw satellite images.
</p>
</li>
<li><p><code>"mean"</code> - designed for common thematic maps and for averaged map across set of maps. Palette is &quot;Spectral&quot;
</p>
</li>
<li><p><code>"sd"</code> - designed for spatial mapping of standard deviation across set of maps. Palette is &quot;YlGnBu&quot;
</p>
</li>
<li><p><code>"diff"</code> - diverge palette &quot;RdBu&quot;. Absolute values of lower and upper limits are equal, zero is in the middle of palette. Designed for anomaly maps.
</p>
</li>
<li><p><code>"slope"</code> - is similar to <code>diff</code> but without extreme colors, which are reserved for contouring of statistically significant areas.
</p>
</li>
<li><p><code>"significance"</code> - desiged to illustrate statistically significant areas of slope.
The realisation is <code>colortable(obj, value=c(-0.999, -0.99, -0.95, -0.9, -0.5, +0.5, +0.9, +0.95, +0.99, +0.999), interval=1L, palname="RdBu")</code>
</p>
</li>
<li><p><code>"category"</code> - Values are interpreted in nominal scale. Palette is based on random colors from &quot;Pairs&quot; palette.
</p>
</li>
<li><p><code>"conc"</code> - designed for visualization of sea ice concentration data, which have lower limit 0 and higher limit 100. Palette is &quot;Blues&quot;
</p>
</li>
<li><p><code>"bathy"</code> - designed for ocean depth (bathymetry) maps. Internally <code>colorize(obj, stretch="equal",interval=1L, palname="Blues", inv=TRUE)</code> is used to detect the crossing from shelf waters to deep water basin. Better practice is to do second step with manual specification of <code>value</code> argument.
</p>
</li>
<li><p><code>"internal"</code> - continuous colors, designed for conversion to greyscale with keeping of intensities.
</p>
</li>
<li><p><code>"default"</code> - allowing to detect stretch by intuition, without any strong mathematical criteria
</p>
</li></ul>

<p>It is allowed manual correction of labels using followed code example:
<code>names(ursa_colortable(x)) &lt;- c("a&lt;=0","0&lt;a&lt;=1","a&gt;1")</code>
</p>


<h3>Value</h3>

<p>Object of class <code>ursaRaster</code> with named character vector of item <code>$colortable</code>
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+classColorTable">ursa_colortable</a></code>, 
<code><a href="#topic+classColorTable">ursa_colortable&lt;-</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- pixelsize()-350
print(a)
b1 &lt;- colorize(a,ramp=FALSE)
print(ursa_colortable(b1))
b2 &lt;- colorize(a,interval=1,stretch="positive",ramp=FALSE)
print(ursa_colortable(b2))
b3 &lt;- colorize(a,interval=2,stretch="positive",ramp=FALSE)
print(ursa_colortable(b3))
b4 &lt;- colorize(a,value=c(150,250),interval=1)
print(ursa_colortable(b4))
names(ursa_colortable(b4)) &lt;- c("x&lt;=150","150&lt;x&lt;=250","x&gt;250")
print(ursa_colortable(b4))
display(b4)
</code></pre>

<hr>
<h2 id='colortable'>
Color Tables of raster images.
</h2><span id='topic+class-ursaColorTable'></span><span id='topic+ursa_colortable'></span><span id='topic+ursa_colortable+3C-'></span><span id='topic+print.ursaColorTable'></span><span id='topic++5B.ursaColorTable'></span><span id='topic+names.ursaColorTable'></span><span id='topic+names+3C-.ursaColorTable'></span><span id='topic+ursa_colorindex'></span><span id='topic+ursa_color'></span>

<h3>Description</h3>

<p>Manipulation with color tables of raster images.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaColorTable'
print(x, ...)

## S3 method for class 'ursaColorTable'
x[i]


ursa_colortable(x)

ursa_colortable(x) &lt;- value

ursa_colorindex(ct)
   
ursa_color(ct, ...)

## S3 method for class 'ursaColorTable'
names(x)

## S3 replacement method for class 'ursaColorTable'
names(x) &lt;- value

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="colortable_+3A_x">x</code></td>
<td>

<p><code>ursaRaster</code> object. Extended for numeric (integer or real) of character vector.
</p>
</td></tr>
<tr><td><code id="colortable_+3A_ct">ct</code></td>
<td>

<p><code>ursaColorTable</code> object with or without indexing.
</p>
</td></tr>
<tr><td><code id="colortable_+3A_value">value</code></td>
<td>

<p>Named character vector. In Replacement functions:
</p>
<p>For <code>ursa_colortable()</code>: values are colors in &ldquo;#RRGGBB&rdquo; notation or <span class="rlang"><b>R</b></span> color names (<code><a href="grDevices.html#topic+colors">colors</a></code>). <code>names(value)</code> are names of categories.
</p>
<p>For <code>names()</code>: values are names of categories. If length of names is <code>n-1</code>, where <code>n</code> is length of colors, then intervaling is assumed, and <code>value</code> are assign to interval breaks.
</p>
</td></tr>
<tr><td><code id="colortable_+3A_i">i</code></td>
<td>

<p>Integer vector. Indices specifying elements to extract part (subset) of color table.
</p>
</td></tr>
<tr><td><code id="colortable_+3A_...">...</code></td>
<td>

<p>In <code>print()</code>, passing to generic <code><a href="base.html#topic+print">print</a></code>. Currently not used.
<br />
In <code>ursa_colortable()</code>, passing to generic <code><a href="base.html#topic+print">print</a></code>. Currently not used.
<br />
In <code>ursa_color()</code>, passing to <code><a href="#topic+colorize">colorize</a></code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The example of the class structure</p>
<pre>
Class 'ursaColorTable'  Named chr [1:4] "#313695" "#BCE1EE" "#FDBE70" "#A50026"
  ..- attr(*, "names")= chr [1:4] "&lt;= 450" "(450;550]" "(550;650]" "&gt; 650"
</pre>
<p>It is recommended to use <code>ursa_colortable</code> and <code>ursa_colortable&lt;-</code> instead of <code>colortable</code> and <code>colortable&lt;-</code>. <code>ursa_colortable</code> and <code>colortable</code> are synonyms. <code>ursa_colortable&lt;-</code> and <code>colortable&lt;-</code> are synonyms too. Package <span class="pkg">raster</span> contains <code><a href="raster.html#topic+colortable">colortable</a></code> and <code><a href="raster.html#topic+colortable">colortable&lt;-</a></code> functions. <code>colortable</code> and <code>colortable&lt;-</code> will be remove from this package if the case of frequent joint use of both packages.
</p>
<p>If color tables describe continuous and non-intersecting intervals, then <code>print</code> gives additional line of extracted breaks.
</p>


<h3>Value</h3>

<p><code>ursa_colortable</code> returns value of <code>$colortable</code> element if <code>ursaRaster</code> object.
</p>
<p><code>ursa_colortable&lt;-</code> returns <code>ursaRaster</code> object with modified <code>$colortable</code> element.
</p>
<p>Class of <code>$colortable</code> element is &ldquo;ursaColorTable&rdquo;. This is named character vector, where names are categories, and values are &ldquo;#RRGGBB&rdquo; or <span class="rlang"><b>R</b></span> color names. 
</p>
<p><em>Extract</em> function <code>[]</code> for <code>ursaColorTable</code> object returns object of class <code>ursaColorTable</code>.
</p>
<p><em>Extract</em> function <code>names</code> for <code>ursaColorTable</code> object returns character vector (names of categories).
</p>
<p><em>Replace</em> function <code>names&lt;-</code> for <code>ursaColorTable</code> object returns <code>ursaColorTable</code> with changed names of categories.
</p>
<p><code>ursa_colorindex</code> returns index (if presents) for <code>ursaColorTable</code> object.
</p>
<p><code>ursa_color</code> returns character vector of colors in hex format.
</p>
<p>Color tables are written to ENVI header file.
</p>


<h3>Warning</h3>

<p>If colors are specified as <span class="rlang"><b>R</b></span> color names, then slow down may appear.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+colorize">colorize</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
print(methods(class="ursaColorTable"))

a &lt;- pixelsize()
print(a)
b1 &lt;- colorize(a,value=c(400,500,600,700),interval=FALSE)
b2 &lt;- colorize(a,value=c(450,550,650)    ,interval=TRUE)
display(list(b1,b2))
print(is.ursa(a,"colortable"))
print(is.ursa(b1,"colortable"))
print(is.ursa(b2,"colortable"))
print(ursa_colortable(a))
print(ursa_colortable(b1))
print(ursa_colortable(b2))
ursa_colortable(b2) &lt;- c("Low"="darkolivegreen1"
                        ,"Moderate"="darkolivegreen2"
                        ,"High"="darkolivegreen3"
                        ,"undefined"="darkolivegreen4")
print(ursa_colortable(b2))
names(ursa_colortable(b2))[4] &lt;- "Polar"
print(ursa_colortable(b2))
display(b2)

lab &lt;- sample(c("A","B","C"),9,replace=TRUE)
lab
ct &lt;- ursa_color(lab)
names(ct) &lt;- lab
ct
</code></pre>

<hr>
<h2 id='commonGeneric'>
Some generic functions for <code>ursaRaster</code> class.
</h2><span id='topic+commonGeneric'></span><span id='topic+duplicated.ursaRaster'></span><span id='topic+diff.ursaRaster'></span>

<h3>Description</h3>

<p>Set of generic functions, implemented for objects of <code>ursaRaster</code> class.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaRaster'
duplicated(x, incomparables = FALSE, MARGIN = 2, fromLast = FALSE, ...)

## S3 method for class 'ursaRaster'
diff(x, lag = 1, differences = 1, ...)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="commonGeneric_+3A_x">x</code></td>
<td>

<p>Object of <code>ursaRaster</code> class
</p>
</td></tr>
<tr><td><code id="commonGeneric_+3A_incomparables">incomparables</code></td>
<td>

<p>Passed to S3 method <code>duplicated</code> for class <code>matrix</code>.
</p>
</td></tr>
<tr><td><code id="commonGeneric_+3A_margin">MARGIN</code></td>
<td>

<p>Overwitten to value <code>2</code>. Passed to S3 method <code>duplicated</code> for class <code>matrix</code>.
</p>
</td></tr>
<tr><td><code id="commonGeneric_+3A_fromlast">fromLast</code></td>
<td>

<p>Passed to S3 method <code>duplicated</code> for class <code>matrix</code>.
</p>
</td></tr>
<tr><td><code id="commonGeneric_+3A_lag">lag</code></td>
<td>

<p>Passed to default S3 method <code>diff</code>.
</p>
</td></tr>
<tr><td><code id="commonGeneric_+3A_differences">differences</code></td>
<td>

<p>Passed to default S3 method <code>diff</code>.
</p>
</td></tr>
<tr><td><code id="commonGeneric_+3A_...">...</code></td>
<td>

<p>Other arguments, which are passed to the respective S3 method.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>duplicated()</code>: logical of length equal to number of bands.
</p>
<p><code>diff()</code>: <code>ursaRaster</code> object.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="base.html#topic+diff">duplicated</a></code>, <code><a href="base.html#topic+diff">diff</a></code>,
</p>


<h3>Examples</h3>

<pre><code class='language-R'>a &lt;- ursa_dummy(5)
a[3] &lt;- a[2]
a
duplicated(a)
diff(a)
</code></pre>

<hr>
<h2 id='compose_close'>
Finish plotting
</h2><span id='topic+compose_close'></span><span id='topic+.compose_close'></span>

<h3>Description</h3>

<p>Function <code>compose_close</code> does followed tasks: 1) completes all unfinsished actions before shutting down graphical device, 2) cuts extra margins, and 3) opens resulted PNG file in the associated viewer.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compose_close(...)

## non-public
.compose_close(kind = c("crop2", "crop", "nocrop"),
               border = 5, bpp = 0, execute = TRUE, verbose = FALSE)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compose_close_+3A_...">...</code></td>
<td>
<p>Set of arguments, which are recognized via their names and classes, and then passed to <code>.compose_close</code>:
</p>

<table>
<tr>
 <td style="text-align: left;">
      <strong>Pattern</strong> (<code>compose_close</code>) </td><td style="text-align: left;"> <strong>Argument</strong> (<code>.compose_close</code>)
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(^$|crop|kind)</code> </td><td style="text-align: left;"> <code>kind</code>
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(border|frame)</code> </td><td style="text-align: left;"> <code>border</code>
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>bpp</code> </td><td style="text-align: left;"> <code>bpp</code>
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(render|execute|view|open)</code> </td><td style="text-align: left;"> <code>execute</code>
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>verb(ose)*</code> </td><td style="text-align: left;"> <code>verbose</code>
      </td>
</tr>

</table>

</td></tr>
<tr><td><code id="compose_close_+3A_kind">kind</code></td>
<td>
<p>Character keyword for cutting of excess white spaces. If <code>kind="nocrop"</code> then there is no cut. If <code>kind="crop"</code> then only outer margins are cutted. If <code>kind="crop2"</code> then all outer margins and inner white spaces (<em>e.g.</em>, between color bar panel and text caption) are cutted.</p>
</td></tr>
<tr><td><code id="compose_close_+3A_border">border</code></td>
<td>
<p>Non-negative integer. Number of pixels for margins, which are not cropped. Default is <code>5L</code>.</p>
</td></tr>
<tr><td><code id="compose_close_+3A_bpp">bpp</code></td>
<td>
<p>Integer. Bits per pixel for output PNG file. Valid values are <code>0L</code>, <code>8L</code>, <code>24L</code>. If <code>bpp=0L</code>, then <code>8</code> bpp is used for <code>"windows"</code> type of PNG device, and <code>24</code> bpp is used for  <code>"cairo"</code> type of PNG device. The type of device is specified in <code><a href="#topic+compose_open">compose_open</a></code> function.</p>
</td></tr>
<tr><td><code id="compose_close_+3A_execute">execute</code></td>
<td>
<p>Logical. Should created PNG file be opened in the associated external program for viewing graphical files? Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="compose_close_+3A_verbose">verbose</code></td>
<td>
<p>Logical. Value <code>TRUE</code> provides some additional information on console. Default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The cut manipulations (<code>crop="crop"</code> or <code>crop="crop2"</code>) are implemented using <code><a href="png.html#topic+readPNG">readPNG</a></code> and <code><a href="png.html#topic+writePNG">writePNG</a></code> functions of package <span class="pkg">png</span>. These fuctions have limitations in the memory allocation.
</p>
<p>Function <code>compose_close</code> clears all internal graphical options, specified during <code><a href="#topic+compose_open">compose_open</a></code> executing.
</p>
<p>Some parameters are specified in <code><a href="#topic+compose_open">compose_open</a></code>: weather output PNG file will be removed after opening (logical <code>delafter</code>), or what is the time of waiting for file opening and next removing (numerical <code>wait</code> in seconds).
</p>


<h3>Value</h3>

<p>Function returns <code>NULL</code> value.
</p>


<h3>Warning</h3>

<p>Currenty, <code>execute=TRUE</code> is implemented for Windows platform only using construction <code style="white-space: pre;">&#8288;R CMD open \emph{fileout}&#8288;</code>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- ursa_dummy(nband=6,min=0,max=255,mul=1/4)

## exam 1
compose_open()
compose_close()

## exam 2
compose_open(a)
compose_close()

## exam 3
compose_open("rgb",fileout="tmp1")
compose_plot(a[1:3])
compose_close(execute=FALSE)
Sys.sleep(1)
a &lt;- dir(pattern="tmp1.png")
print(a)
file.remove(a)
</code></pre>

<hr>
<h2 id='compose_design'>
Organize multi-panel layout with images and color bars.
</h2><span id='topic+compose_design'></span><span id='topic+ursaLayout'></span>

<h3>Description</h3>

<p><code>compose_design</code> prepares scheme for layout of images and color bars.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compose_design(...)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compose_design_+3A_...">...</code></td>
<td>
<p>Set of arguments, which are recognized via their names and classes:
</p>

<dl>
<dt><code>obj</code></dt><dd><p>Object of class <code>ursaRaster</code> or list of objects of class <code>ursaRaster</code> or <code>NULL</code>. Default is <code>NULL</code>. Used to detect panel layout and coordinate reference system.</p>
</dd>
<dt><code>layout</code></dt><dd><p>Integer of length 2, integer of length 1, two-dimensional matrix or <code>NA</code>. Layout matrix has dimensions<code>c(nr, nc)</code>, where <code>nr</code> is number of rows, and <code>nc</code> is number of columns.  If <code>layout</code> is positive integer of length 1, then sequense of this value unfolds to layout matrix using argument <code>ratio</code>. If <code>layout=NA</code> then layout matrix is recognized internally using number of bands of <code>obj</code> and argument <code>ratio</code>. If <code>layout=NA</code> and <code>obj=NULL</code> then matrix <code>c(1,1)</code> is used.</p>
</dd>
<dt><code>byrow</code></dt><dd><p>Logical. The order of filling of layout matrix. Default is <code>TRUE</code>. If <code>byrow=TRUE</code> then matrix is filled by rows (from top row, consequently from left element to right element, then next row). If <code>byrow=FALSE</code> then matrix is filled by columns.</p>
</dd>
<dt><code>skip</code></dt><dd><p>Positive integer of variable length. Default in <code>NULL</code> (length is zero). Indices of panels in the layout matrix, which are not used.</p>
</dd>
<dt><code>legend</code></dt><dd><p>The descripition of rules how color bars (legends) or panel captions are located in the layout. It is the list of embedded lists of two elements, which describe the color bars position in the layout. of Default is <code>NA</code>, it means using of internal rules. If <code>legend=NULL</code> then no plotting of color bars. If <code>legend</code> is positive integer in the range <code>1L:4L</code>, then sinlge color bar is used and legend's side is corresponded to margins of <span class="rlang"><b>R</b></span> graphic system.</p>
</dd>
<dt><code>side</code></dt><dd><p>Positive integer <code>1L</code>, <code>2L</code>, <code>3L</code>, or <code>4L</code>. Default is <code>NA</code>. Simplification of color bar position in the case that single color bar is used. The value is corresponded to margins of <span class="rlang"><b>R</b></span> graphic system. The synonym of integer value of <code>legend</code>.</p>
</dd>
<dt><code>ratio</code></dt><dd><p>Positive numeric. The desired ratio of layout sides (width per height). If <code>layout=NA</code> then the dimensions of layout matrix are defined internally to get the given ratio of layout's width per height. The default is <code>(16+1)/(9+1)</code> in the assumtion of optimal filling on the usual 16:9 screens.</p>
</dd>
<dt><code>fixed</code></dt><dd><p>Logical. If <code>TRUE</code> then it is assuming that layout will have the same proportions as sessional grid sizes (rows and columns). For this case, argument <code>ratio</code> is reassigned as a desired ratio (width per height) for single panel. Default is <code>FALSE</code>.</p>
</dd>
</dl>

</td></tr>
</table>


<h3>Details</h3>

<p>Function <code>compose_design</code> extracts and validates required arguments from a list of parameters (three-dots construct) and passes them to internal function <code>.compose_design</code>.
</p>
<p>Argument <code>legend</code> is a <code><a href="base.html#topic+list">list</a></code> or coerced to a <code><a href="base.html#topic+list">list</a></code>. The length of this list is equal to number of color bars; each item describes certain color bar. This desctiption is a list again with two elements, which desribes the position of color bar in relation to main panels of images.
</p>
<p>If argument <code>legend</code> is in interval <code>1L:4L</code> then it is interpreted as argument <code>side</code> in functions <code><a href="graphics.html#topic+axis">axis</a></code>, <code><a href="graphics.html#topic+mtext">mtext</a></code>.  Argument <code>side</code> in function <code>compose_design</code> plays the same role. It is introduced for consistency with <span class="rlang"><b>R</b></span> graphic system.
</p>
<p>In the one of example below (See <cite>Examples</cite> section) the layout with dimension of two rows by three columns is considered (<code>layout=c(2,3)</code>). The dimension of resulting layout matrix is <code>c(7,9)</code>, where 7=<strong>2</strong>*2+3, and 9=<strong>3</strong>*2+3.
</p>
<pre>
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9]
[1,]    0    0    0    0    0    0    0    0    0
[2,]    0    0    0    0    0    0    0    0    0
[3,]    0    0    1    0    2    0    3    0    0
[4,]    0    0    0    0    0    0    0    0    0
[5,]    0    0    4    0    5    0    6    0    0
[6,]    0    0    0    0    0    0    0    0    0
[7,]    0    0    0    0    0    0    0    0    0
</pre>
<p>The complicated color bar structure is specified via <span class="rlang"><b>R</b></span>'s <code><a href="base.html#topic+list">list</a></code> function: </p>
<pre>
&gt;   leg &lt;- list("7"=list(row=1,col=0),"8"=list(2,"left")
+              ,"9"=list("full","right"),"10"=list("top","full")
+              ,"11"=list(99,1:2),"12"=list("bottom",3))
&gt; str(leg)
 $ 7 :List of 2
  ..$ row: num 1
  ..$ col: num 0
 $ 8 :List of 2
  ..$ : num 2
  ..$ : chr "left"
 $ 9 :List of 2
  ..$ : chr "full"
  ..$ : chr "right"
 $ 10:List of 2
  ..$ : chr "top"
  ..$ : chr "full"
 $ 11:List of 2
  ..$ : num 99
  ..$ : int [1:2] 1 2
 $ 12:List of 2
  ..$ : chr "bottom"
  ..$ : num 3
</pre>
<p>Here, six color bars are specified. It is a list of six lists (sub-lists). First item of sub-list is row number, and the second one is column number. Integers can be replaces by character keywords.
</p>
<p>For row-position, <code>"top"</code> means <code>0L</code> (less than first row), <code>"bottom"</code> means large integer value (greater than last row, currently, <code>99L</code>), <code>"first"</code> means <code>1L</code>, <code>"last"</code> means number of last row (<code>2L</code> in this example), <code>"full"</code> means whole range from first to last rows (<code>1L:2L</code> in this example). Values <code>"top"</code> and <code>"bottom"</code> are used for horizontal color bars (last three sub-lists), and the rest for vertical color bars (first three sub-lists).
</p>
<p>For column-position, <code>"left"</code> means <code>0L</code> (less then first column), <code>"bottom"</code> means large integer value (greater than last column, currently, <code>99L</code>), <code>"first"</code> means first column (<code>1L</code>), <code>"last"</code> means last column (<code>3L</code> in this example), <code>"full"</code> means whole range from first to last columns ((<code>1L:3L</code> in this example)). Values <code>"left"</code> and <code>"right"</code> are used for vertical color bars, and the rest are for horizontal ones.
</p>
<p>The resulting layout is a sparse matrix with zero values for each even row and each column. These zeros plays role of white space between panels in the plotted layout. In our example, values <code>1L:6L</code> are corresponded to six map panels, and values <code>7L:12L</code> are corresponded to six narrow panels of color bars (legends). </p>
<pre>
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9]
[1,]    0    0   10    0   10    0   10    0    0
[2,]    0    0    0    0    0    0    0    0    0
[3,]    7    0    1    0    2    0    3    0    9
[4,]    0    0    0    0    0    0    0    0    0
[5,]    8    0    4    0    5    0    6    0    9
[6,]    0    0    0    0    0    0    0    0    0
[7,]    0    0   11    0   11    0   12    0    0
</pre>
<p><img src="../help/figures/composedesign.png" alt="Caption" />
</p>


<h3>Value</h3>

<p>It is a list of class <code>ursaLayout</code>.
</p>
<table role = "presentation">
<tr><td><code>layout</code></td>
<td>
<p>Integer matrix with dimension <code>c(2*nr+3, 2*nc+3)</code>, where <code>nr</code> and <code>nc</code> are number of rows and colunms of the layout matrix. The layout matrix of image panels is surrounded by colorbar panels. The original layout matrix is expanded by adding zero columns and rows. In the new matrix each even column has zero values, and each even row has zero values.</p>
</td></tr>
<tr><td><code>image</code></td>
<td>
<p>Nonnegative integer. Number of panels with images.</p>
</td></tr>
<tr><td><code>dim</code></td>
<td>
<p>Nonnegative integer of length two. Number of rows and number of columns for panel layout.</p>
</td></tr>
<tr><td><code>legend</code></td>
<td>
<p>Nonnegative integer. Number of panels with color bars (legends).</p>
</td></tr>
</table>
<p>The returned value is passed to function <code><a href="#topic+compose_open">compose_open</a></code> and further is kept in the <code><a href="base.html#topic+options">options</a></code> until calling of <code><a href="#topic+compose_close">compose_close</a></code>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- ursa_dummy(nband=5,min=1,max=200,mul=1/8)
b &lt;- list(colorize(a[1:3],pal.rich=240,pal.rotate=0)
         ,colorize(sqrt(a[4:5]),pal.rich=-15,pal.rotate=0,stretch="equal"))

cl1 &lt;- compose_design(layout=c(2,3),byrow=TRUE,legend=NULL)
print(cl1)
compose_open(cl1)
compose_close()

cl2 &lt;- compose_design(layout=c(2,3),byrow=FALSE,legend="left")
print(cl2$layout)
compose_open(cl2)
compose_close()

cl3 &lt;- compose_design(a,side=2)
print(cl3)
compose_open(cl3)
compose_close()

cl4 &lt;- compose_design(b)
print(cl4)
 ## to avoid over-time during example check -- begin
   compose_open(cl4)
   compose_plot(b,decor=FALSE,las=2)
   compose_close("nocrop")
 ## to avoid over-time during example check -- end

cl5 &lt;- compose_design(b,byrow=FALSE,skip=3
                     ,legend=list(list("full","left"),list(1:2,"right")))
compose_open(cl5)
compose_plot(b,decor=FALSE)
compose_close("nocrop")

leg &lt;- list(list(1,0),list(2,"left")
           ,list("full","right"),list("top","full")
           ,list(99,1:2),list("bottom",3))
str(leg)
cl6 &lt;- compose_design(layout=c(2,3),skip=NA,legend=leg)
print(cl6)
compose_open(cl6,scale=3,pointsize=16)
compose_close("nocrop")

cl7 &lt;- compose_design(layout=matrix(c(1,1,3,2,2,0),nrow=2,byrow=TRUE))
print(cl7)
compose_open(cl7)
compose_close()
</code></pre>

<hr>
<h2 id='compose_legend'>
Plot colorbars or marginal texts.
</h2><span id='topic+compose_legend'></span>

<h3>Description</h3>

<p><code>compose_legend</code> recognizes color tables and characters among arguments and passes them to suitable functions for plotting on margins outside of panel area.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compose_legend(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compose_legend_+3A_...">...</code></td>
<td>

<p>If first argument is a list, then either <code>ursaColorTable</code> or <code><a href="base.html#topic+character">character</a></code> objects are detected in this list. <code>ursaColorTable</code> can be extracted from <code>ursaRaster</code> (if presents). Other objects are coerced to character.
</p>
<p>If first argument is <code>ursaColorTable</code> or <code>ursaRaster</code> with color tables, then other arguments are interpreted as color tables. If coercion to color table is impossible, the coersion is to <code>character</code>.
</p>
<p><code><a href="#topic+legend_colorbar">legend_colorbar</a></code> is called for objects of class <code>ursaColorTable</code>.
<code><a href="#topic+legend_mtext">legend_mtext</a></code> is called for objects of class <code>ursaColorTable</code>. If first argument is a list, then other arguments are passed to respective function calls.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Named list in the first argument is allowed or named vectors are allowed if first argument is not a list. For <code><a href="#topic+legend_colorbar">legend_colorbar</a></code> name of object can be used as an argument <code>units</code>.
</p>
<p>This function is designed to make plot on moderate level of usage with the followed construction:</p>
<pre>
compose_open(...)
compose_panel(...)
compose_legend(...)
compose_close(...)
</pre>
<p>Function <code><a href="#topic+compose_panel">compose_panel</a></code> returns list of color tables of plotted rasters, and followed sequence is available:</p>
<pre>
ct &lt;- compose_panel(a)
compose_legend(ct) # or, if 'a' has color tables, then 'compose_legend(a)'
</pre>


<h3>Value</h3>

<p><code>NULL</code>
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+legend_colorbar">legend_colorbar</a></code>
</p>
<p><code><a href="#topic+legend_mtext">legend_mtext</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
b &lt;- lapply(as.list(ursa_dummy(2)),colorize)
cd &lt;- compose_design(layout=c(1,2),legend=list(list(1,"left"),list(1,"right")
                                              ,list("top","full"),list("bottom",1)))
for (i in 1:4) {
   compose_open(cd,dev=i==1)
   ct &lt;- compose_panel(b,decor=FALSE)
   if (i==2)
      compose_legend(ct)
   else if (i==3)
      compose_legend(ct[[1]],'Tomorrow'=b[[2]]
                    ,top="This is example of legend composition"
                    ,format(Sys.Date(),"(c) %Y"))
   else if (i==4)
      compose_legend(c(ct,"top","bottom"),units=c("left","right"))
   compose_close()
}
</code></pre>

<hr>
<h2 id='compose_open'>
Start displaying
</h2><span id='topic+compose_open'></span>

<h3>Description</h3>

<p><code>compose_open</code> create plot layout and open PNG graphic device.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compose_open(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compose_open_+3A_...">...</code></td>
<td>
<p>Set of arguments, which are recognized via their names and classes:
</p>

<dl>
<dt><code>mosaic</code></dt><dd><p>Layout matrix or reference object to produce layout matrix. It is permitted to do not use name for this argument. Multiple types of argument are allowed: 1) object of class <code>ursaRaster</code>, 2) <code><a href="base.html#topic+list">list</a></code> of <code>ursaRaster</code> objects (raster stack), 3) object of class <code>ursaLayout</code> from function <code><a href="#topic+compose_design">compose_design</a></code>, 4) character keyword or 5) missing. Default is <code>NA</code>.</p>
</dd>
<dt><code>fileout</code></dt><dd><p>Character. Name for created output file. Supported PNG (*.png), JPEG (*.jpg), WEBP (*.webp) and SVG (*.svg) extensions. Missed extension assumes PNG. If absent (<code>""</code>) then temporal file is created and removed in <code>wait</code> seconds after opening in the associated external viewer. Default is absent (<code>""</code>).</p>
</dd>
<dt><code>dpi</code></dt><dd><p>Positive integer. Dots (or pixels) per inch (DPI). The nominal resolution of created output (default PNG) file. Default is <code>96L</code>. The same as <code>res</code> argument in the <code><a href="grDevices.html#topic+png">png</a></code> function.</p>
</dd>
<dt><code>pointsize</code></dt><dd><p>Positive integer. The pointsize of plotted text as it is applied in the <code><a href="grDevices.html#topic+png">png</a></code> function. Default is <code>NA</code>. If <code>pointsize=NA</code> then it is taken value <code>16L</code> multiplied to relative DPI (<code>dpi/96</code>). In the case of unspecified <code>scale</code> and <code>pointsize</code> the size of text is defined internally.</p>
</dd>
<dt><code>scale</code></dt><dd><p>Positive numeric or character. The scale factor applied to dimensions of original raster. Default is <code>NA</code>. If <code>scale</code> is unspecified (<code>scale=NA</code>), then <code>scale</code> is defined internally for <em>intuitively</em> better fitting in HD, FHD displays (single-panelled layout 900x700). If <code>scale</code> is character (e.g., <code>"8000000"</code>, <code>"1:8000000"</code>) then dimensions of image panels are defined using &quot;one centimeter of map is corresponded to 8000000 centimeres of site&quot; rule.</p>
</dd>
<dt><code>width</code></dt><dd><p>Positive numeric or character. The desired width of each panel of multipanel layout. If <code>width</code> is numeric, then units are pixels. If <code>width</code> is character (e.g., <code>"12.5"</code>, <code>"12.5 cm"</code>, <code>"12.5cm"</code>) then units are centimeters in agreement with <code>dpi</code> argument. Default is <code>NA</code>. If <code>width</code> is unspecified (<code>width=NA</code>) then value <code>900</code> is used for single panelled layout.</p>
</dd>
<dt><code>height</code></dt><dd><p>Positive numeric or character. The desired height of each panel of multipanel layout. If <code>height</code> is numeric, then units are pixels. If <code>height</code> is character (e.g., <code>"9.6"</code>, <code>"9.6 cm"</code>, <code>"9.6cm"</code>) then units are centimeters in agreement with <code>dpi</code> argument. Default is <code>NA</code>. If <code>height</code> is unspecified (<code>height=NA</code>) then value <code>700</code> is used for single panelled layout.</p>
</dd>
<dt><code>colorbar</code> or <code>colorbarwidth</code></dt><dd><p>Positive numeric. Scale factor to increase (<code>colorbar&gt;1</code>) or decrease (<code>colorbar&lt;1</code>) width (the shortest dimension) of color bars (legends). Default value (<code>NA</code>) means 2.8% of image panel width.</p>
</dd>
<dt><code>indent</code> or <code>space</code> or <code>offset</code>.</dt><dd><p>Positive numeric. Scale factor to increase (<code>space&gt;1</code>) or decrease (<code>space&lt;1</code>) the white space between image panels and between image and color bar panels. Default value (<code>NA</code>) means 0.8% of image panel width.</p>
</dd>
<dt><code>box</code></dt><dd><p>Logical. If <code>TRUE</code> then boundary box is plotted around image panels and color bar panels. It is a transparent rectangle with black border. Default is <code>TRUE</code>.</p>
</dd>
<dt><code>delafter</code></dt><dd><p>Logical. If <code>TRUE</code> then created PNG file will be deleted after viewing. Default is <code>FALSE</code> for specified file names and <code>TRUE</code> for unspecified (temporal) file names. It is implemented as file removing after opening in the external PNG viewer.</p>
</dd>
<dt><code>wait</code></dt><dd><p>Positive numeric. Seconds between PNG file opening in the associated program and file removing. It make sense only if <code>delafter=TRUE</code>. Default is <code>1.0</code> (one second).</p>
</dd>
<dt><code>device</code> or <code>type</code></dt><dd><p>Character keyword, either <code>"cairo"</code>, <code>"windows"</code> or <code>"CairoPNG"</code> for OS Windows, and either <code>"cairo"</code>, <code>"cairo-png"</code>, <code>"Xlib"</code> or <code>"quartz"</code> for other OSes. Should be plotting be done using cairographics or Windows GDI? The same as <code>type</code> argument in the <code><a href="grDevices.html#topic+png">png</a></code> function, excepting <code>"CairoPNG"</code>, which is handed by <span class="pkg">Cairo</span> package. Default is <code>"cairo"</code>.</p>
</dd>
<dt><code>antialias</code></dt><dd><p>Character keyword, either <code>"none"</code> or <code>"default"</code>. Defines the effect on fonts. The same as <code>antialias</code> argument in the <code><a href="grDevices.html#topic+png">png</a></code> function. Default is <code>"default"</code>.</p>
</dd>
<dt><code>font</code> or <code>family</code></dt><dd><p>A length-one character vector. Specifies the font family. The same as <code>family</code> argument in the <code><a href="grDevices.html#topic+png">png</a></code> function. Default is <code>"sans"</code> for <code>device="windows"</code> and <code>"Tahoma"</code> for <code>device="cairo"</code>.</p>
</dd>
<dt><code>bg</code> or <code>background</code></dt><dd><p>Character. The background color in PNG file. Passed as argument <code>bg</code> to <code><a href="grDevices.html#topic+png">png</a></code> function. Default is <code>"white"</code></p>
</dd>
<dt><code>retina</code></dt><dd><p>Positive numeric. Scale coefficent for retina displays. Default is taken from <code>getOption("ursaRetina")</code>; if it missed, then <code>1</code>.</p>
</dd>
<dt><code>dev</code></dt><dd><p>Logical. If <code>TRUE</code> then this <strong>dev</strong>eloper tool shows created layout without any the followed plot functions from this package are ignored. Default is <code>FALSE</code></p>
</dd>
<dt><code>verbose</code></dt><dd><p>Logical. Shows additional output information in console. Default is <code>FALSE</code>.</p>
</dd>
<dt><code>...</code></dt><dd><p>Arguments, which can be passed to <code><a href="#topic+compose_design">compose_design</a></code> function.</p>
</dd>
</dl>

</td></tr>
</table>


<h3>Details</h3>

<p>Other usage of <code>compose_open(...,dev=TRUE)</code> is </p>
<pre>
   compose_open(...,dev=FALSE)
   compose_close()</pre>
<p>The reason to use <code><a href="#topic+compose_design">compose_design</a></code> function  before <code>compose_open</code> is to reduce number of arguments in the case of complicated layout matrix and non-standard settings.
</p>
<p><code>compose_open</code> passes arguments to <code><a href="grDevices.html#topic+png">png</a></code> function.
</p>
<p>If character values are specified for arguments <code>width</code>, <code>height</code> or <code>scale</code>, then layout development is oriented to produce PNG file, which will be used as a paper copy. Character values for <code>width</code> and <code>height</code> are in centimeters. Character value <em><code style="white-space: pre;">&#8288;V&#8288;</code></em> or <code style="white-space: pre;">&#8288;1:&#8288;</code><em><code style="white-space: pre;">&#8288;V&#8288;</code></em> of <code>scale</code> defines scale <code style="white-space: pre;">&#8288;1/&#8288;</code><em><code style="white-space: pre;">&#8288;V&#8288;</code></em>.
</p>
<p>The Cairo device (<code>device="cairo"</code>) is more quick on MS Windows computers. However Windows GDI may produce less depth of colors (even 8 BPP) in the case of no font antialiasing. Usage of Windows GDI (<code>device="windows"</code>) is a way to produce illustations for scientific journals with strict requirements of mininal line width, font size, <em>etc</em>.
</p>
<p>The PNG layout reserves extra margins for captions of color bars. These margins are filled by white spaces. The cropping of layout applies to created PNG file using read-write functions of package <span class="pkg">png</span>. Only white (<code>"white"</code>, <code>"#FFFFFF"</code>) or transparent (<code>"transparent"</code>) colors are regognized as white spaces. Therefore, specification of <code>bg!="white"</code> or <code>bg!="transparent"</code> breaks PNG image cropping.
</p>
<p>It is noted that Cyrillics is supported on Windows GDI (<code>device="windows"</code>) and is not supported on Cairo (<code>device="cairo"</code>) types of PNG device on MS Windows platform.
</p>
<p>Argument <code>retina</code> is ignored for leaflet-compatible tiling.
</p>


<h3>Value</h3>

<p>Name of created PNG file.
</p>
<p>If <code>dev=TRUE</code> then output on console is layout matrix.
</p>
<p>The set of required parameters for plotting are kept until function <code><a href="#topic+compose_close">compose_close</a></code> call via <code><a href="base.html#topic+options">options</a></code>.
</p>
<table role = "presentation">
<tr><td><code>ursaPngAuto</code></td>
<td>
<p>For developers. Indicator of high-level functions for internal use (manual set; value is <code>TRUE</code>). Or, can be missed.</p>
</td></tr>
<tr><td><code>ursaPngBox</code></td>
<td>
<p>Argument <code>box</code>. If TRUE then <code><a href="graphics.html#topic+box">box</a></code> is called for each panel of layout at the end of plotting.</p>
</td></tr>
<tr><td><code>ursaPngDelafter</code></td>
<td>
<p>Argument <code>delafter</code>. Applied in the function <code><a href="#topic+compose_close">compose_close</a></code>.</p>
</td></tr>
<tr><td><code>ursaPngDevice</code></td>
<td>
<p>Argument <code>device</code>. Applied for effective plottting of rasters and checking the ability for final reducing color depth from 24 to 8 bpp.</p>
</td></tr>
<tr><td><code>ursaPngDpi</code></td>
<td>
<p>Argument <code>dpi</code>. Currently used for verbose only.</p>
</td></tr>
<tr><td><code>ursaPngFamily</code></td>
<td>
<p>Applied for text plotting in annotations and legends.</p>
</td></tr>
<tr><td><code>ursaPngFigure</code></td>
<td>
<p>Set <code>0L</code>. Specifies number of current panel in layout matrix. Used to detect term for applying <code>$ursaPngBox</code> option.</p>
</td></tr>
<tr><td><code>ursaPngFileout</code></td>
<td>
<p>Name of created PNG file.</p>
</td></tr>
<tr><td><code>ursaPngLayout</code></td>
<td>
<p>Layout matrix, the object of class <code><a href="#topic+compose_design">ursaLayout</a></code>.</p>
</td></tr>
<tr><td><code>ursaPngPaperScale</code></td>
<td>
<p>Numeric. Used for scalebar representation on the paper-based maps. If value <code>0</code>, then scalebar is display-based. If value is greater <code>0</code> then the scale is exact. If value is <code>-1</code> then the resonable rounding is used for scale displaying.</p>
</td></tr>
<tr><td><code>ursaPngPlot</code></td>
<td>
<p>The opposite to argument <code>dev</code>. If <code>$ursaPngPlot</code> is <code>FALSE</code> then any plotting functions of this package are ignored.</p>
</td></tr>
<tr><td><code>ursaPngScale</code></td>
<td>
<p>The actual value of argument <code>scale</code>, specified during function call or stated internally.</p>
</td></tr>
<tr><td><code>ursaPngShadow</code></td>
<td>
<p>Set <code>""</code>. Used for shadowing of the part of color bars in the case of semi-transparent land or ocean filling mask in the <code><a href="#topic+panel_coastline">panel_coastline</a></code> function.</p>
</td></tr>
<tr><td><code>ursaPngSkipLegend</code></td>
<td>
<p>Integer vector of non-negative length. Defines list of images panels, for which the color bars are not displayed.</p>
</td></tr>
<tr><td><code>ursaPngWaitBeforeRemove</code></td>
<td>
<p>Argument <code>wait</code>. Applied in the function <code><a href="#topic+compose_close">compose_close</a></code> for temporal PNG file.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
b &lt;- ursa_dummy(nband=4,min=0,max=50,mul=1/4,elements=16)
p &lt;- list(colorize(b[1:2],pal.rich=240,pal.rotate=0)
         ,colorize(sqrt(b[3:4]),pal.rich=-15,pal.rotate=0,stretch="equal"))
p
 
## exam #01
compose_open(width=950,dpi=150,pointsize=16,legend=NULL,dev=TRUE)

## exam #02
compose_open(pointsize=8,dpi=150,scale="1:130000000")
compose_plot(colorize(b[1]),scalebar=TRUE,coast=FALSE)
compose_close()

## exam #03
cl &lt;- compose_design(layout=c(2,4)
                    ,legend=list(list("top","full"),list("bottom",1:3)))
compose_open(cl,dev=TRUE)

## exam #04
cl &lt;- compose_design(p,layout=c(2,3),skip=c(2,4,6))
compose_open(cl,dev=TRUE)

## exam #05
cl &lt;- compose_design(p,side=3)
compose_open(cl,dev=FALSE,bg="transparent")
compose_close()
</code></pre>

<hr>
<h2 id='compose_panel'>
Plot raster images and decorations on the multipanel layout.
</h2><span id='topic+compose_panel'></span>

<h3>Description</h3>

<p><code>compose_panel</code> divides the multi-band raster image (<em>brick</em>) or layers of raster images (<em>stack</em>) on the sequence of single-band images and plots each image on the separate panel of layout. Panel plotting is finalized by adding of decoration (gridlines, coastline, annotation, scalebar).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compose_panel(..., silent = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compose_panel_+3A_...">...</code></td>
<td>
<p>Set of arguments, which are passed to <code><a href="#topic+panel_new">panel_new</a></code>, <code><a href="#topic+panel_raster">panel_raster</a></code>, <code><a href="#topic+panel_coastline">panel_coastline</a></code>, <code><a href="#topic+panel_graticule">panel_graticule</a></code>, <code><a href="#topic+panel_annotation">panel_annotation</a></code>, <code><a href="#topic+panel_scalebar">panel_scalebar</a></code>.
</p>
</td></tr>
<tr><td><code id="compose_panel_+3A_silent">silent</code></td>
<td>
<p>Logical. Value <code>TRUE</code> cancels progress bar. Default is <code>FALSE</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For each panel of layout the sequence of called functions is permanent:<br /><code><a href="#topic+panel_new">panel_new</a></code> - - &gt; <code><a href="#topic+panel_raster">panel_raster</a></code> - - &gt; <code><a href="#topic+panel_coastline">panel_coastline</a></code> - - &gt; <code><a href="#topic+panel_graticule">panel_graticule</a></code> - - &gt; <code><a href="#topic+panel_annotation">panel_annotation</a></code> - -&gt; <code><a href="#topic+panel_scalebar">panel_scalebar</a></code>.
</p>
<p>If this order is undesirable, then call these functions in the required sequence.
</p>


<h3>Value</h3>

<p><code>NULL</code>
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+compose_plot">compose_plot</a></code>, <code><a href="#topic+compose_legend">compose_legend</a></code>
</p>
<p><code><a href="#topic+panel_new">panel_new</a></code>, <code><a href="#topic+panel_raster">panel_raster</a></code>, <code><a href="#topic+panel_coastline">panel_coastline</a></code>, <code><a href="#topic+panel_graticule">panel_graticule</a></code>, <code><a href="#topic+panel_annotation">panel_annotation</a></code>, <code><a href="#topic+panel_scalebar">panel_scalebar</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- ursa_dummy(6)
b1 &lt;- list(maxi=a[1:4]*1e2,mini=a[5:6]/1e2)
print(b1)
b2 &lt;- lapply(b1,function(x) colorize(x,nbreak=ifelse(global_mean(x)&lt;100,5,NA)))
compose_open(b2,byrow=FALSE
            ,legend=list(list("bottom",1:2),list("bottom",3),list("left")))
ct &lt;- compose_panel(b2,scalebar=2,coastline=3:4,gridline=5:6,gridline.margin=5
                   ,annotation.text=as.character(seq(6)))
compose_legend(ct)
legend_mtext(as.expression(substitute(italic("Colorbars are on the bottom"))))
compose_close()
</code></pre>

<hr>
<h2 id='compose_plot'>
Plot layout of images and color bars.
</h2><span id='topic+compose_plot'></span>

<h3>Description</h3>

<p><code>compose_plot</code> plots images (raster brick or raster stack) and corresponding color bars according to given rectangular layout.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compose_plot(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compose_plot_+3A_...">...</code></td>
<td>
<p>Set of arguments, which are passed to <code><a href="#topic+compose_panel">compose_panel</a></code> and <code><a href="#topic+compose_panel">compose_legend</a></code>
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function merges to functions. The first one plots image layout and returns list of color tables. The second one plots legend (colorbars) based on returned color tables. Simplified description is:</p>
<pre>
ct &lt;- compose_panel(...)
compose_legend(ct,...)
</pre>
<p>These two functions are separated to allow use additional plotting on image panel after primary plot of raster and decorations before panel change or legend plot.
</p>


<h3>Value</h3>

<p>This function returns <code>NULL</code> value.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+compose_panel">compose_panel</a></code><br />
<code><a href="#topic+compose_panel">compose_legend</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- ursa_dummy(nband=6,min=0,max=255,mul=1/4)
if (example1 &lt;- TRUE) {
   b1 &lt;- ursa_brick(a)
  # b1 &lt;- colorize(b1,stretch="positive",ramp=FALSE)
   compose_open(b1)
   compose_plot(b1,grid=FALSE,coast=FALSE,scale=FALSE,trim=1
               ,stretch="positive",ramp=!FALSE)
   compose_close()
}
if (example2 &lt;- TRUE) {
   b2 &lt;- ursa_stack(a)
   compose_open(b2)
   compose_plot(b2,grid=FALSE,coast=FALSE,labels=5,trim=2,las=0)
   compose_close()
}
</code></pre>

<hr>
<h2 id='create_envi'>
Create ENVI or GDAL files on disk
</h2><span id='topic+create_envi'></span><span id='topic+create_gdal'></span>

<h3>Description</h3>

<p><code>create_envi</code> creates ENVI binary and header files on disk. ENVI binary file is filled by blank (zero) values.
<br />
<code>create_gdal</code> is just an entry for GDAL wrapper; currently via internal ENVI implementation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_gdal(x, ...)

create_envi(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="create_envi_+3A_x">x</code></td>
<td>

<p>Filename, or any refenerce object to help assign properties of new ENVI file. Can be missed.
</p>
</td></tr>
<tr><td><code id="create_envi_+3A_...">...</code></td>
<td>

<p>Use <code>name = value</code> sequence. Properties of new ENVI file are extracted from keywords in 'name' and data types of 'value'.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Prior <span class="pkg">ursa</span> version &lt; 3.10, <code>create_gdal()</code> used classes and methods from package <span class="pkg">rgdal</span>. Currenty, alternatives are not found for complete replacement of <span class="pkg">rgdal</span>. At the present, ENVI binary and header are created, firstly, and <code><a href="#topic+classRaster_close">close()</a></code> transforms to desired GDAL format, finally.
</p>
<p><code>create_envi</code> and <code>create_gdal</code> use parameters of grid (boundary box, cell size, projection) from reference object of class <code>ursaRaster</code> in argument <code>x</code> or calls <code><a href="#topic+session">session_grid</a></code>. You may specify values of GDAL or ENVI binary file later using <code><a href="#topic+classRaster.Replace">[&lt;-</a></code>. If <code>x</code> is object of class <code>ursaRaster</code> then metadata parameters (interleave, data type, ignore value, etc) are inherited. 
</p>
<p>Keywords:
</p>

<ul>
<li><p><code>fname</code> - character. File name for created GDAL or ENVI file.
<br /><br /> <em>For</em> <code>create_envi</code> <em>only</em>: If <code>compress</code> of <code>connections</code> is not specified then example for &ldquo;fileout&rdquo; file name:
</p>

<ul>
<li><p>&quot;fileout&quot; - If external 'gzip' is found then &quot;fileout.envigz&quot; is created else &quot;fileout.envi&quot;
</p>
</li>
<li><p>&quot;fileout.envi&quot; - &quot;fileout.envi&quot; is created without any compression.
</p>
</li>
<li><p>&quot;fileout.&quot; - &quot;fileout&quot; is created without any compression.
</p>
</li>
<li><p>&quot;fileout.bin&quot; - &quot;fileout.bin&quot; is created without any compression.
</p>
</li>
<li><p>&quot;fileout.img&quot; - &quot;fileout.img&quot; is created without any compression.
</p>
</li>
<li><p>&quot;fileout.dat&quot; - &quot;fileout.dat&quot; is created without any compression.
</p>
</li></ul>


</li>
<li><p><code>driver</code> - character. <em>For</em> <code>create_gdal</code> <em>only</em>. Which GDAL driver is used.
</p>
</li>
<li><p><code>layername</code> - character of length&gt;=1. Layernames (&lsquo;Band name&rsquo; in ENVI header file)
</p>
</li>
<li><p><code>bandname</code> - character of length&gt;=1. Layernames (&lsquo;Band name&rsquo; in ENVI header file)
</p>
</li>
<li><p><code>name</code> - character of length&gt;=1. Layernames (&lsquo;Band name&rsquo; in ENVI header file)
</p>
</li>
<li><p><code>nodata</code> - integer or numeric. Value in GDAL or ENVI binary file, which is interpretted as <code>NA</code> in <span class="rlang"><b>R</b></span>
</p>
</li>
<li><p><code>ignore</code> - integer or numeric. Value in GDAL or ENVI binary file, which is interpretted as <code>NA</code> in <span class="rlang"><b>R</b></span>
</p>
</li>
<li><p><code>ignorevalue</code> - integer or numeric. Value in GDAL or ENVI binary file, which is interpretted as <code>NA</code> in <span class="rlang"><b>R</b></span>
</p>
</li>
<li><p><code>bg</code> - integer or numeric. Value in GDAL or ENVI binary file, which is interpretted as <code>NA</code> in <span class="rlang"><b>R</b></span>
</p>
</li>
<li><p><code>connection</code> - character. <em>For</em> <code>create_envi</code> <em>only</em>. <code><a href="base.html#topic+connections">connections</a></code> for ENVI binary file.
<br /><br /> Valid values are:
</p>

<ul>
<li><p>&quot;gz&quot; - connection is &quot;gzfile&quot;
</p>
</li>
<li><p>&quot;bz&quot; - connection is &quot;bzfile&quot;
</p>
</li>
<li><p>&quot;xz&quot; - connection is &quot;xzfile&quot;
</p>
</li>
<li><p>&quot;file&quot; - connection is &quot;file&quot;
</p>
</li></ul>

</li>
<li><p><code>interleave</code> - character. Interleave. Valid values are &quot;bsq&quot;, &quot;bil&quot;, &quot;bip&quot;. For <code>create_gdal</code> and <code>driver="GTiff"</code> valid values are &quot;bsq&quot; and &quot;bil&quot;.
</p>
</li>
<li><p><code>datatype</code> - character or integer (numeric). Data type.
<br /><br /> Valid values are:
</p>

<ul>
<li><p>1, &quot;byte&quot;, &quot;Byte&quot;, &quot;UInt8&quot; = Byte: 8-bit unsigned integer
</p>
</li>
<li><p>2, &quot;integer&quot;, &quot;Int16&quot; = Integer: 16-bit signed integer
</p>
</li>
<li><p>3, &quot;Int32&quot; = Long: 32-bit signed integer
</p>
</li>
<li><p>4, &quot;real&quot;, &quot;float&quot;, &quot;Float32&quot; = Floating-point: 32-bit single-precision
</p>
</li>
<li><p>5, &quot;Float64&quot; = Double-precision: 64-bit double-precision floating-point
</p>
</li>
<li><p>11, &quot;UInt8&quot; = Byte: 8-bit signed integer. <b>Not in specification.</b> Only for use with this package.
</p>
</li>
<li><p>12, &quot;UInt16&quot; = Integer: 16-bit unsigned integer
</p>
</li>
<li><p>13, &quot;UInt32&quot; = Long: 32-bit unsigned integer
</p>
</li></ul>

<p>Specification <a href="https://envi.geoscene.cn/help/Subsystems/envi/Content/ExploreImagery/ENVIHeaderFiles.htm">https://envi.geoscene.cn/help/Subsystems/envi/Content/ExploreImagery/ENVIHeaderFiles.htm</a> is used.

</p>
</li>
<li><p><code>byteorder</code> - numeric (integer). Byte order.
</p>
</li>
<li><p><code>bands</code> - numeric( integer). Number of bands/layers
</p>
</li>
<li><p><code>nband</code> - numeric( integer). Number of bands/layers
</p>
</li>
<li><p><code>nlayer</code> - numeric( integer). Number of bands/layers
</p>
</li>
<li><p><code>layers</code> - numeric( integer). Number of bands/layers
</p>
</li>
<li><p><code>compress</code> - integer (numeric) or logical. <em>For</em> <code>create_envi</code> <em>only</em>. Should ENVI binary file be compressed after closing connection.
</p>
</li>
<li><p><code>wkt</code> - integer (numeric) or logical. Forced adding &lsquo;coordinate system string&rsquo; to ENVI header file
</p>
</li>
<li><p><code>ext</code> - character. <em>For</em> <code>create_envi</code> <em>only</em>. Extension of ENVI binary file. For extensions not in <code>c("envi","bin","dat","img")</code> list
</p>
</li></ul>

<p>If file name is unknown, then random file name is used with informing via <code>message()</code>. 
</p>


<h3>Value</h3>

<p>Object of class <code>ursaRaster</code> with opened connection of GDAL or ENVI binary file.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a></p>


<h3>See Also</h3>

<p><code><a href="#topic+ursa_new">ursa_new</a></code> creates object of class <code>ursaRaster</code> in memory and allows to assign values at once.
</p>
<p>Use <code><a href="#topic+session">session_grid</a></code> to check or specify parameters of grid before calling <code>create_envi</code>.
</p>
<p>Use <code><a href="#topic+classRaster.Replace">[&lt;-</a></code> to assign values to ENVI binary file after calling <code>create_envi</code>.
</p>
<p>Use <code><a href="#topic+classRaster_close">close</a></code> (or <code><a href="#topic+classRaster_close">close_envi</a></code>) to close <code><a href="base.html#topic+connections">connections</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- create_envi()
fname &lt;- a$con$fname
dir(pattern=basename(envi_list(fname)))
close(a)
invisible(envi_remove(fname))

a &lt;- create_envi("exam1",layername=paste("Band",1:5)
                ,ignorevalue=99,datatype="Int16",interleave="bil")
ursa_info(a)
print(a[])
close(a)
invisible(envi_remove("exam1"))
</code></pre>

<hr>
<h2 id='cubehelix'>
Generate &quot;cubehelix&quot; palette.
</h2><span id='topic+cubehelix'></span>

<h3>Description</h3>

<p><code>cubehelix</code> returns set of RGB colours, which are  screen display of intensity images
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cubehelix(n, value = numeric(), weak = NA, rich = NA, rotate = NA, hue = NA, gamma = 1,
          dark = NA, light = NA, bright = NA, inv = NA, verbose = NA)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cubehelix_+3A_n">n</code></td>
<td>

<p>Positive integer. Length of returned color vector. If <code>n</code> is <a href="base.html#topic+missing">missing</a> and length of <code>value</code> is positive, then length of <code>value</code>. If missing <code>n</code> and empty <code>value</code>, then <code>n=256</code>.
</p>
</td></tr>
<tr><td><code id="cubehelix_+3A_value">value</code></td>
<td>

<p>Numeric vector of values, which are associated with a palette. If both positive and negative values are in this vector, then divergence color palette is returned. Default in numeric of length zero (unspecified).
</p>
</td></tr>
<tr><td><code id="cubehelix_+3A_weak">weak</code></td>
<td>

<p>Numeric. The angle (in degrees) of the helix for color with <code>light</code> intensity. If both <code>rich</code> and <code>weak</code> are specified, the <code>rotate</code> is defined as difference between <code>rich</code> and <code>weak</code>. If all <code>weak</code>, <code>rich</code> and <code>rotate</code> are unspecified, then random values are used. Default is <code>NA</code> (unspecified).
</p>
</td></tr>
<tr><td><code id="cubehelix_+3A_rich">rich</code></td>
<td>

<p>Numeric. The angle (in degrees) of the helix for color with <code>dark</code> intensity. If both <code>rich</code> and <code>weak</code> are specified, the <code>rotate</code> is defined as difference between <code>rich</code> and <code>weak</code>. If all <code>weak</code>, <code>rich</code> and <code>rotate</code> are unspecified, then random values are used. Default is <code>NA</code> (unspecified).
</p>
</td></tr>
<tr><td><code id="cubehelix_+3A_rotate">rotate</code></td>
<td>

<p>Numeric. The angle of rotation (in degrees) of the helix over the scale; can be negative. If <code>rotate</code> and <code>weak</code> are specified, then <code>rich</code> is defined as sum of <code>weak</code> and <code>rotate</code>. If <code>rotate</code> and <code>rich</code> are specified, then <code>weak</code> is defined as difference between <code>rotate</code> and <code>weak</code>. If all <code>weak</code>, <code>rich</code> and <code>rotate</code> are unspecified, then random values are used. Default is <code>NA</code> (unspecified).
</p>
</td></tr>
<tr><td><code id="cubehelix_+3A_hue">hue</code></td>
<td>

<p>Non-negative numeric. Saturation of color. <code>hue=0</code> gives pure greyscale. If unspecified, then random value in interval [0.9, 1.5] is used. Default is <code>NA</code> (unspecified).
</p>
</td></tr>
<tr><td><code id="cubehelix_+3A_gamma">gamma</code></td>
<td>

<p>Numeric. Power of intensity. Intensity is between <code>dark</code> and <code>light</code>, which are normalized to interval [0, 1]. <code>gamma</code> changes normalized intensity to intensity<code>^gamma</code>. Default is 1.
</p>
</td></tr>
<tr><td><code id="cubehelix_+3A_dark">dark</code></td>
<td>

<p>Positive numeric in interval between 0 and 255. The intensity of the darkest color in the palette. For light backgrounds default is 63. For dark backgrounds default is 14 (inverse order with <code>light</code>).
</p>
</td></tr>
<tr><td><code id="cubehelix_+3A_light">light</code></td>
<td>

<p>Positive numeric in interval between 0 and 255. The intensity of the lightest color in the palette. For light backgrounds default is 241, for dark backgrounds default is 192 (inverse order with <code>dark</code>).
</p>
</td></tr>
<tr><td><code id="cubehelix_+3A_bright">bright</code></td>
<td>

<p>Positive numeric in interval between 0 and 255. Value for equal intensity for <code>dark</code> and <code>light</code> in the palette. Applied only for both <code>dark=NA</code> and <code>light=NA</code>.
</p>
</td></tr>
<tr><td><code id="cubehelix_+3A_inv">inv</code></td>
<td>

<p>Logical. Inversion of color intensity. If <code>TRUE</code> then color vector is <a href="base.html#topic+rev">reversed</a> before return. Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="cubehelix_+3A_verbose">verbose</code></td>
<td>

<p>Logical. Value <code>TRUE</code> provides information about cube helix on console. Default is <code>NA</code>, which is interpreted as <code>FALSE</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is modified source code of function <code>cubeHelix()</code> from package <span class="pkg">rje</span> under GPL&gt;=2 license.
</p>
<p>The palette design is oriented that figures can be printed on white paper. Under this assumption, light color is for small values, and dark color is for big values. In some computer vision and GIS software black background is used, and in this case light color for big values, and dark color of small values looks more naturally. For some thematic maps big values are light, and small values are small (for example, sea ice concentration: open water is blue, close ice is white). RGB and Grayscale remote sensing and photo imagery use light colors for strong signal, and dark colors for weak signal.
</p>
<p>Light background is default for figure (specified by argument <code>background</code> in function <code><a href="#topic+compose_open">compose_open</a></code>).
</p>
<p>The palette divergency can be defined only if <code>value</code> is specified. If all values are positive, or all values are negative, then returned palette is not drivergent. For divergent palettes the helix sequence is continuous.
</p>
<p>If <code>dark</code> and <code>lihgt</code> are unspecified, the color contrast bewteen <code>dark</code> and <code>light</code> drops on reducing number of colors in returned vector.
</p>


<h3>Value</h3>

<p>Vector of RGB color specification.
</p>


<h3>Acknowledgements</h3>

<p>Dave Green, Robin Evans
</p>


<h3>Author(s)</h3>

<p>Dave Green
</p>
<p>Robin Evans 
</p>
<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>References</h3>

<p><a href="https://people.phy.cam.ac.uk/dag9/CUBEHELIX/">Dave Green's &lsquo;cubehelix&rsquo; colour scheme.</a>
</p>
<p>Green, D. A., 2011, &lsquo;A colour scheme for the display of astronomical intensity images&rsquo;, Bulletin of the Astronomical Society of India, 39, 289. http://astron-soc.in/bulletin/11June/289392011.pdf <a href="https://arxiv.org/pdf/1108.5083">(pre-print at 'arxiv.org')</a>
</p>
<p><code>rje::cubeHelix()</code>; <span class="pkg">rje</span> at CRAN: <a href="https://CRAN.R-project.org/package=rje">https://CRAN.R-project.org/package=rje</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
set.seed(352)
session_grid(regrid(mul=1/16))
a &lt;- ursa_dummy(3,min=0,max=255)
b4 &lt;- b3 &lt;- b2 &lt;- b1 &lt;- vector("list",length(a))
for (i in seq_along(b1)) {
   b1[[i]] &lt;- colorize(a[i],pal=cubehelix(11,weak=45*i,rotate=+270),ncolor=11)
   b2[[i]] &lt;- colorize(a[i],pal=cubehelix(11,weak=45*i,rotate=-270),ncolor=11)
   b3[[i]] &lt;- colorize(a[i]-127,pal=cubehelix)
   hue &lt;- sample(seq(2)-1,1)
   s &lt;- ifelse(hue==0,NA,runif(1,min=91,max=223))
   b4[[i]] &lt;- colorize(a[i]-127,pal=cubehelix,pal.hue=hue,pal.dark=s,pal.light=s)
}
display(c(b1,b2),layout=c(2,NA),decor=FALSE)
display(c(b3,b4),layout=c(2,NA),decor=FALSE)
</code></pre>

<hr>
<h2 id='dim'>
Dimension of multiband raster image
</h2><span id='topic+dim.ursaRaster'></span><span id='topic+dim+3C-.ursaRaster'></span>

<h3>Description</h3>

<p>Retrieve the dimension of an object of class <code>ursaRaster</code>. The replacement function is dummy; it doesn't change raster dimension.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaRaster'
dim(x)
## S3 replacement method for class 'ursaRaster'
dim(x) &lt;- value
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dim_+3A_x">x</code></td>
<td>

<p>Object of class <code>ursaRaster</code>
</p>
</td></tr>
<tr><td><code id="dim_+3A_value">value</code></td>
<td>

<p>Any. Ignored
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Use extract operator <code><a href="#topic+classRaster.Extract">[]</a></code> and combine function <code><a href="#topic+classRaster_c">c</a></code> to change third (e.g., temporal) dimension of raster.<br />
Use <code><a href="#topic+regrid">regrid</a></code> function to change grid parameters and to resize/resample raster into new grid.
</p>


<h3>Value</h3>

<p>The 'Extract' function <code>dim</code> returns named integer vector of length three: 1) number of lines/rows, 2) number of samples/columns, 3) number of bands/channels/layers.<br />
The 'Replacement' function <code>dim&lt;-</code> returns <code>ursaRaster</code> object without changes.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
session_grid(regrid(mul=1/16))
a &lt;- ursa_dummy(nband=3)
ursa_info(a)
print(dim(a))
dim(a) &lt;- c(25,00,34)
print(dim(a))
b &lt;- create_envi("tmp1",bandname=letters[1:5],compress=FALSE)
print(dim(b))
close(b)
envi_remove("tmp1")
</code></pre>

<hr>
<h2 id='discolor'>
Destroy color table for raster images.
</h2><span id='topic+discolor'></span>

<h3>Description</h3>

<p>If raster's categories are integer or numeric, then raster values are restored from names of categories. Otherwise only category names are dropped.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>discolor(obj, nodata = NA)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="discolor_+3A_obj">obj</code></td>
<td>

<p>Object of class <code>ursaRaster</code>
</p>
</td></tr>
<tr><td><code id="discolor_+3A_nodata">nodata</code></td>
<td>

<p>Numeric. Flag value for &quot;no-data&quot;. If <code>NA</code>, then no-data values are missed. Default is <code>NA</code>.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Object of class <code>ursaRaster</code> without color table.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- colorize(pixelsize(),ncolor=7)
print(ursa_colortable(a))
print(a)
b &lt;- discolor(a)
print(ursa_colortable(b))
print(b)
</code></pre>

<hr>
<h2 id='display'>
Plot raster image(s) in the PNG format.
</h2><span id='topic+display'></span>

<h3>Description</h3>

<p>High-level function to create multi-panel layout of images and to display with decoration (gridlines, coastlines, scalebar, colorbars) in the PNG format. It is an aggregator of low-level functions for typical plotting.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>display(obj, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="display_+3A_obj">obj</code></td>
<td>

<p>Object of class <code>ursaRaster</code> or <code><a href="base.html#topic+list">list</a></code> of <code>ursaRaster</code> objects.
</p>
</td></tr>
<tr><td><code id="display_+3A_...">...</code></td>
<td>

<p>Passed to either <code><a href="#topic+display_brick">display_brick</a></code> or <code><a href="#topic+display_stack">display_stack</a></code> or <code><a href="#topic+display_rgb">display_rgb</a></code> functions and further to hierarchy of plotting functions:
</p>

<ul>
<li> <p><code><a href="#topic+compose_open">compose_open</a></code>
</p>

<ul>
<li> <p><code><a href="#topic+compose_design">compose_design</a></code>
</p>
</li></ul>

</li>
<li> <p><code><a href="#topic+compose_plot">compose_plot</a></code>
</p>

<ul>
<li> <p><code><a href="#topic+panel_new">panel_new</a></code>
</p>
</li>
<li> <p><code><a href="#topic+panel_raster">panel_raster</a></code>
</p>
</li>
<li> <p><code><a href="#topic+panel_decor">panel_decor</a></code>
</p>

<ul>
<li> <p><code><a href="#topic+panel_graticule">panel_graticule</a></code>
</p>
</li>
<li> <p><code><a href="#topic+panel_coastline">panel_coastline</a></code>
</p>
</li>
<li> <p><code><a href="#topic+panel_scalebar">panel_scalebar</a></code>
</p>
</li>
<li> <p><code><a href="#topic+panel_annotation">panel_annotation</a></code>
</p>
</li></ul>

</li>
<li> <p><code><a href="#topic+compose_legend">compose_legend</a></code>
</p>
</li></ul>

</li>
<li> <p><code><a href="#topic+compose_close">compose_close</a></code>
</p>
</li></ul>

</td></tr>
</table>


<h3>Details</h3>

<p>If argument <code>obj</code> is missing (e.g, calling <code>display()</code> without parameters) then plotting the sessional CRS with blank image.
</p>
<p>If argument <code>obj</code> is <code><a href="base.html#topic+list">list</a></code> of <code>ursaRaster</code> objects (or object of class <code>ursaStack</code>) then <code><a href="#topic+display_stack">display_stack</a></code> is called.
</p>
<p>If argument <code>obj</code> is object of class <code>ursaRaster</code> and has 3 or 4 bands and values in each band are <code><a href="base.html#topic+integer">integer</a></code> and in interval between 0 and 255, then <code><a href="#topic+display_rgb">display_rgb</a></code> is called.
</p>
<p>If argument <code>obj</code> is object of class <code>ursaRaster</code> then firstly internal test is applied to detect either image's bands contains homogeneous information (raster brick) or heterogeneous information (raster stack). Then either <code><a href="#topic+display_brick">display_brick</a></code> or <code><a href="#topic+display_stack">display_stack</a></code> is called. This test is rough due to unknown data origin. It is supposed to adjust kind of plotting by means of direct specification of <code><a href="#topic+display_brick">display_brick</a></code> or <code><a href="#topic+display_stack">display_stack</a></code>.
</p>


<h3>Value</h3>

<p>Returned value from either <code><a href="#topic+display_brick">display_brick</a></code> or <code><a href="#topic+display_stack">display_stack</a></code> or <code><a href="#topic+display_rgb">display_rgb</a></code> functions.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+display_brick">display_brick</a></code>, <code><a href="#topic+display_stack">display_stack</a></code>, <code><a href="#topic+display_rgb">display_rgb</a></code>
</p>
<p><span class="rlang"><b>R</b></span>-styled plotting:  <code><a href="#topic+classRaster_plot">plot</a></code>, <code><a href="#topic+classRaster_plot">image</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
set.seed(500)
a.brick &lt;- a.stack &lt;- ursa_dummy(nband=3,min=0,max=255,mul=1/16)
a.stack[2] &lt;- a.stack[2]/10
a.stack[3] &lt;- sqrt(a.stack[3])
a.rgb &lt;- as.integer(round(a.brick))
print(a.brick)
print(a.stack)
print(a.rgb)
display(a.brick,decor=FALSE)
display(a.stack,decor=FALSE)
display(a.rgb)
</code></pre>

<hr>
<h2 id='display_brick'>
Plot multi-band homogenous raster image in the PNG format.
</h2><span id='topic+display_brick'></span><span id='topic+display_homo'></span>

<h3>Description</h3>

<p>Raster image is forced to be interpreted as homogenuous (having the same units). It implies creating multi-panel layout with multiple colorbars. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>display_brick(obj, ...)
display_homo(obj, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="display_brick_+3A_obj">obj</code></td>
<td>

<p>Object of class <code>ursaRaster</code> or <code><a href="base.html#topic+list">list</a></code> of <code>ursaRaster</code> objects.
</p>
</td></tr>
<tr><td><code id="display_brick_+3A_...">...</code></td>
<td>

<p>Passed to hierarchy of plotting functions:
</p>

<ul>
<li> <p><code><a href="#topic+compose_open">compose_open</a></code>
</p>

<ul>
<li> <p><code><a href="#topic+compose_design">compose_design</a></code>
</p>
</li></ul>

</li>
<li> <p><code><a href="#topic+compose_plot">compose_plot</a></code>
</p>

<ul>
<li> <p><code><a href="#topic+panel_new">panel_new</a></code>
</p>
</li>
<li> <p><code><a href="#topic+panel_raster">panel_raster</a></code>
</p>
</li>
<li> <p><code><a href="#topic+panel_decor">panel_decor</a></code>
</p>

<ul>
<li> <p><code><a href="#topic+panel_graticule">panel_graticule</a></code>
</p>
</li>
<li> <p><code><a href="#topic+panel_coastline">panel_coastline</a></code>
</p>
</li>
<li> <p><code><a href="#topic+panel_scalebar">panel_scalebar</a></code>
</p>
</li>
<li> <p><code><a href="#topic+panel_annotation">panel_annotation</a></code>
</p>
</li></ul>

</li>
<li> <p><code><a href="#topic+compose_legend">compose_legend</a></code>
</p>
</li></ul>

</li>
<li> <p><code><a href="#topic+compose_close">compose_close</a></code>
</p>
</li></ul>

</td></tr>
</table>


<h3>Details</h3>

<p>If argument <code>obj</code> is <code><a href="base.html#topic+list">list</a></code> of <code>ursaRaster</code> objects (or object of class <code>ursaStack</code>) then <code>obj</code> is coerced to class <code>ursaRaster</code> ('stack' is coerced to 'brick').
</p>
<p><code>display_homo</code> is a synonym to <code>display_brick</code>. It is introduced to emphasize the plotting of homogenous object.
</p>


<h3>Value</h3>

<p>Function returns <code>NULL</code> value.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+display">display</a></code>, <code><a href="#topic+display_stack">display_stack</a></code>, <code><a href="#topic+display_rgb">display_rgb</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- ursa_dummy(nband=3,min=0,max=250)
a[2] &lt;- -a[1]
a[3] &lt;- sqrt(a[1])
a2 &lt;- ursa_stack(a) 
print(a2)
display(a2) # likely 'display_stack' will be called
display_brick(a2,stretch="eq",labels=c(-150,-100,0,10,12,20,100,150))
</code></pre>

<hr>
<h2 id='display_rgb'>
Plot RGB (RGBA) color composition in the PNG format.
</h2><span id='topic+display_rgb'></span>

<h3>Description</h3>

<p>Raster images are forced to be interpreted as color composition with 3 (RGB) or 4 (RGBA) channels. Values should be in the range between 0 and 255.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>display_rgb(obj, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="display_rgb_+3A_obj">obj</code></td>
<td>

<p>Object of class <code>ursaRaster</code> or <code><a href="base.html#topic+list">list</a></code> of <code>ursaRaster</code> objects.
</p>
</td></tr>
<tr><td><code id="display_rgb_+3A_...">...</code></td>
<td>

<p>Passed to hierarchy of plotting functions:
</p>

<ul>
<li> <p><code><a href="#topic+compose_open">compose_open</a></code>
</p>

<ul>
<li> <p><code><a href="#topic+compose_design">compose_design</a></code>
</p>
</li></ul>

</li>
<li> <p><code><a href="#topic+compose_plot">compose_plot</a></code>
</p>

<ul>
<li> <p><code><a href="#topic+panel_new">panel_new</a></code>
</p>
</li>
<li> <p><code><a href="#topic+panel_raster">panel_raster</a></code>
</p>
</li>
<li> <p><code><a href="#topic+panel_decor">panel_decor</a></code>
</p>

<ul>
<li> <p><code><a href="#topic+panel_graticule">panel_graticule</a></code>
</p>
</li>
<li> <p><code><a href="#topic+panel_coastline">panel_coastline</a></code>
</p>
</li>
<li> <p><code><a href="#topic+panel_scalebar">panel_scalebar</a></code>
</p>
</li></ul>

</li></ul>

</li>
<li> <p><code><a href="#topic+compose_close">compose_close</a></code>
</p>
</li></ul>

</td></tr>
</table>


<h3>Details</h3>

<p>If argument <code>obj</code> is <code><a href="base.html#topic+list">list</a></code> of <code>ursaRaster</code> objects (or object of class <code>ursaStack</code>) then <code>obj</code> is coerced to class <code>ursaRaster</code> ('stack' is coerced to 'brick').
</p>
<p>Colorbar is not plotted.
</p>
<p>By default, the created PNG has 24 bits per pixel. This is equal to parameter <code>bpp=24</code> (<code><a href="#topic+compose_close">compose_close</a></code>). It is allow to specify other value, e.g., <code>display_rgb(a,bpp=8)</code>.
</p>
<p>By default, labels of gridlines are located in bottom and left sides of the panel with raster. This is equal to parameter <code>margin=c(TRUE,TRUE,FALSE,FALSE)</code> (<code><a href="#topic+panel_graticule">panel_graticule</a></code>). It is allow to specify other value, e.g., <code>display_rgb(a,margin=T)</code>.
</p>
<p>Currently, for color compositions the argument <code>useRaster</code> (<code><a href="#topic+panel_raster">panel_raster</a></code>) is introduced to fix possible coordinate mismatch for Cairo-devices, but have never used.
</p>


<h3>Value</h3>

<p>Function returns <code>NULL</code> value.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+display">display</a></code>, <code><a href="#topic+display_brick">display_brick</a></code>, <code><a href="#topic+display_stack">display_stack</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- ursa_dummy(nband=3)
display_rgb(a)
</code></pre>

<hr>
<h2 id='display_stack'>
Plot multi-band heterogenous raster images in the PNG format.
</h2><span id='topic+display_stack'></span><span id='topic+display_hetero'></span>

<h3>Description</h3>

<p>Raster images are forced to be interpreted as heterogenuous (having the different units). It implies creating multi-panel layout with multiple colorbars.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>display_stack(obj, ...)
display_hetero(obj, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="display_stack_+3A_obj">obj</code></td>
<td>

<p>Object of class <code>ursaRaster</code> or <code><a href="base.html#topic+list">list</a></code> of <code>ursaRaster</code> objects.
</p>
</td></tr>
<tr><td><code id="display_stack_+3A_...">...</code></td>
<td>

<p>Passed to hierarchy of plotting functions:
</p>

<ul>
<li> <p><code><a href="#topic+compose_open">compose_open</a></code>
</p>

<ul>
<li> <p><code><a href="#topic+compose_design">compose_design</a></code>
</p>
</li></ul>

</li>
<li> <p><code><a href="#topic+compose_plot">compose_plot</a></code>
</p>

<ul>
<li> <p><code><a href="#topic+compose_panel">compose_panel</a></code>
</p>

<ul>
<li> <p><code><a href="#topic+panel_new">panel_new</a></code>
</p>
</li>
<li> <p><code><a href="#topic+panel_raster">panel_raster</a></code>
</p>
</li>
<li> <p><code><a href="#topic+panel_decor">panel_decor</a></code>
</p>

<ul>
<li> <p><code><a href="#topic+panel_graticule">panel_graticule</a></code>
</p>
</li>
<li> <p><code><a href="#topic+panel_coastline">panel_coastline</a></code>
</p>
</li>
<li> <p><code><a href="#topic+panel_scalebar">panel_scalebar</a></code>
</p>
</li></ul>

</li>
<li> <p><code><a href="#topic+panel_annotation">panel_annotation</a></code>
</p>
</li></ul>

</li>
<li> <p><code><a href="#topic+compose_legend">compose_legend</a></code>
</p>

<ul>
<li> <p><code><a href="#topic+legend_colorbar">legend_colorbar</a></code>
</p>
</li></ul>

</li></ul>

</li>
<li> <p><code><a href="#topic+compose_close">compose_close</a></code>
</p>
</li></ul>

</td></tr>
</table>


<h3>Details</h3>

<p>If argument <code>obj</code> is object of class <code>ursaRaster</code> then <code>obj</code> is coerced to <code><a href="base.html#topic+list">list</a></code> of <code>ursaRaster</code> objects ('brick' is coerced to 'stack').
</p>
<p>The plot layout is either two-columns or two-rows. Extent of coordinate grid has a form of rectangle. The layout selection depends on ratio of rectangle's sides. For single-column design use parameter <code>layout=c(NA,1L)</code>. e.g., <code>display_brick(a,layout=c(NA,1))</code>, for single-row design use parameter <code>layout=c(1,NA)</code>. The same is for forcing of two-columns (<code>layout=c(NA,2L)</code>) and two-rows layouts (<code>layout=c(2L,NA)</code>). Other layouts are not applicable for multiple colorbars.
</p>
<p><code>display_hetero</code> is a synonym to <code>display_stack</code>. It is introduced to emphasize the plotting of complex object with heterogeneous elements, for example, having different units.
</p>


<h3>Value</h3>

<p>Function returns <code>NULL</code> value.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+display">display</a></code>, <code><a href="#topic+display_brick">display_brick</a></code>, <code><a href="#topic+display_rgb">display_rgb</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- ursa_dummy(nband=3)
display_stack(a)
</code></pre>

<hr>
<h2 id='envi_files'>
ENVI File Manipulation 
</h2><span id='topic+envi_exists'></span><span id='topic+envi_list'></span><span id='topic+envi_copy'></span><span id='topic+envi_rename'></span><span id='topic+envi_remove'></span><span id='topic+ursa_exists'></span>

<h3>Description</h3>

<p>Management of ENVI files similar to functions of OS file manager.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>envi_exists(pattern = ".+", path = ".", all.files = FALSE, full.names = TRUE,
           recursive = FALSE, ignore.case = TRUE, exact = FALSE)
envi_list(pattern = ".+", path = ".", all.files = FALSE, full.names = recursive,
          recursive = FALSE, ignore.case = TRUE, exact = FALSE)
envi_remove(pattern = ".+", path = ".", all.files = FALSE, full.names = recursive,
            recursive = FALSE, ignore.case = TRUE, verbose = FALSE)
envi_copy(src, dst, overwrite = TRUE)
envi_rename(src, dst, overwrite = TRUE)

ursa_exists(fname)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="envi_files_+3A_pattern">pattern</code></td>
<td>

<p>Either filename (like <code><a href="base.html#topic+basename">basename</a></code> function) or mask in format of regular expressions or full path name.
</p>
</td></tr>
<tr><td><code id="envi_files_+3A_path">path</code></td>
<td>

<p>Either path name (like <code><a href="base.html#topic+basename">dirname</a></code> function) or ignored if <code>pattern</code> describes full path.
</p>
</td></tr>
<tr><td><code id="envi_files_+3A_all.files">all.files</code></td>
<td>

<p>A logical value. If FALSE, only the names of visible files are returned. If TRUE, all file names will be returned. Similar to <code>all.files</code> argument in <code><a href="base.html#topic+list.files">list.files</a></code> function
</p>
</td></tr>
<tr><td><code id="envi_files_+3A_full.names">full.names</code></td>
<td>

<p>A logical value. If TRUE, the directory path is prepended to the file names to give a relative file path. If FALSE, the file names (rather than paths) are returned. Similar to <code>full.names</code> argument in <code><a href="base.html#topic+list.files">list.files</a></code> function
</p>
</td></tr>
<tr><td><code id="envi_files_+3A_recursive">recursive</code></td>
<td>

<p>Logical. Should the listing recurse into directories? Similar to <code>recursive</code> argument in <code><a href="base.html#topic+list.files">list.files</a></code> function
</p>
</td></tr>
<tr><td><code id="envi_files_+3A_ignore.case">ignore.case</code></td>
<td>

<p>Logical. Should pattern-matching be case-insensitive? Similar to <code>ignore.case</code> argument in <code><a href="base.html#topic+list.files">list.files</a></code> function
</p>
</td></tr>
<tr><td><code id="envi_files_+3A_exact">exact</code></td>
<td>

<p>Logical. Attempt to cancel regular expressions.
</p>
</td></tr>
<tr><td><code id="envi_files_+3A_verbose">verbose</code></td>
<td>

<p>Logical. <code>TRUE</code> provides some additional information on console.
</p>
</td></tr>
<tr><td><code id="envi_files_+3A_src">src</code></td>
<td>

<p>Strings of length 1 or more. Name or directory name or path of source ENVI files.
</p>
</td></tr>
<tr><td><code id="envi_files_+3A_dst">dst</code></td>
<td>

<p>Strings of length 1 or more. Name or directory name path of destination ENVI files. Length is assuming to be equal to length of <code>src</code>
</p>
</td></tr>
<tr><td><code id="envi_files_+3A_overwrite">overwrite</code></td>
<td>

<p>Logical. <code>TRUE</code> overwrites destinations ENVI files. <code>FALSE</code> does nothing if destinaton ENVI file exists.
</p>
</td></tr>
<tr><td><code id="envi_files_+3A_fname">fname</code></td>
<td>

<p>Character. Full file name or file pattern with file path.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Functions do not view content of any files. The major identifier of ENVI files in file system is ENVI header (*.hdr) file. Binary file is searching along 1) original *.envi, *.bin, *.img, *.dat extensions, 2) externally packing *.gz. *.bz2, *.xz extensions, or 3) packed by this package *.envigz, *.bingz extensions. Functions <code>envi_copy()</code> and <code>envi_rename()</code> keeps original extension of ENVI binary file; use <code><a href="base.html#topic+files">file.rename</a></code> to rename ENVI binary file.
</p>


<h3>Value</h3>

<p><code>envi_exists()</code> returns integer number of found ENVI files.
</p>
<p><code>envi_list()</code> returns character vector of found ENVI files.
</p>
<p><code>envi_remove()</code> returns character vector of deleted ENVI files.
</p>
<p><code>envi_copy()</code> returns 0L.
</p>
<p><code>envi_rename()</code> returns value of <code><a href="base.html#topic+files">file.rename</a></code>, which is applied to objects in file system.
</p>
<p><code>ursa_exists()</code> returs <code>TRUE</code> if any *.tif, *.tiff, *.bin, *.hfa file is found.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a></p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
wd &lt;- setwd(tempdir())
a1 &lt;- create_envi("tmp1.envi")
a2 &lt;- create_envi("tmp2.")
close(a1,a2)
envi_list()
envi_copy("tmp1","tmp3")
envi_copy("tmp2","tmp4")
envi_list()
envi_rename("tmp3","tmp5")
envi_list()
envi_exists("nofilewithsuchname")
envi_exists("tmp[34]")
envi_remove(".+")
envi_list()
setwd(wd)
</code></pre>

<hr>
<h2 id='Extract'>
Extract portion of raster images
</h2><span id='topic+Extract'></span><span id='topic+Subset'></span><span id='topic++5B.ursaRaster'></span>

<h3>Description</h3>

<p>This operator is used to get single band or subset of bands from multi-band <code>ursaRaster</code> object. Another purpose is get portions of data including data reading from files.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaRaster'
x[i, j, ..., drop = FALSE]
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Extract_+3A_x">x</code></td>
<td>

<p><code>ursaRaster</code> object
</p>
</td></tr>
<tr><td><code id="Extract_+3A_i">i</code></td>
<td>

<p>Integer or character. If integer, then band index, specifying bands to extract. If character, either list of band names or character sting for <code><a href="base.html#topic+grep">regular expression</a></code> to match band index. In the <em>(spatial, temporal)</em> interpretation of <code>ursaRaster</code> object <code>j</code> points to <em>temporal</em> component.
</p>
</td></tr>
<tr><td><code id="Extract_+3A_j">j</code></td>
<td>

<p>Integer. Line index, specifying lines to extract.
</p>
</td></tr>
<tr><td><code id="Extract_+3A_...">...</code></td>
<td>

<p>Mentioned for consistence with internal generic function <code><a href="base.html#topic+Extract">[</a></code>.
<br />
Use <code>regexp=FALSE</code> for matching by <code><a href="base.html#topic+match">match</a></code>, and <code>regexp=TRUE</code> for matching by Perl-compatible regexps case insensitive <code><a href="base.html#topic+grep">grep</a></code>. Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="Extract_+3A_drop">drop</code></td>
<td>

<p>Not used. For consistence with generic function.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Operator <code style="white-space: pre;">&#8288;\sQuote{[}&#8288;</code> is high-level implementation for data reading. If <code>x$value</code> item is not applicable, then value of <code>ursaRaster</code> is not in memory. In this case the controlled by <code>i</code> and <code>j</code> portion is read to memory. If both <code>i</code> and <code>j</code> are missing, then <code>x[]</code> reads all values from file.
</p>
<p><code>x[,j]</code> is appropriate for time series analysis and processing in the case bands have relation to <em>temporal</em> observation. Use <code><a href="#topic+regrid">regrid</a></code> for geographical subset and cropping.
</p>


<h3>Value</h3>

<p><code>ursaRaster</code> object with extracter bands. Values (<code>$value</code> item) are in memory.
</p>


<h3>Warning</h3>

<p>It is not allowed to read simultaneously portion of bands and portion of lines from file, <em>e.g.</em>,
</p>
<pre>
   x &lt;- open_envi(fname)
   y &lt;- x[2:3,10:20]
   close(x)
</pre>
<p>Such brunch is not implemented in code. You use one of the followed tricks:
</p>
<pre>
   x &lt;- open_envi(fname)
   y &lt;- x[2:3][,20:30]
   close(x)
</pre>
<p>or
</p>
<pre>
   x &lt;- open_envi(fname)
   y &lt;- x[,20:30][2:3]
   close(x)
</pre>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
## Prepare
session_grid(regrid(mul=1/8))
a &lt;- pixelsize()
w &lt;- c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"
      ,"MondayAgain")
b &lt;- rep(a/mean(a),length(w))+seq(length(w))-1
bandname(b) &lt;- w
nr &lt;- ursa_rows(b)
bottom &lt;- (as.integer(nr/2)):nr
write_envi(b,"tmp1",compress=FALSE,interleave="bil")

## Extract
print(b["Monday",regexp=TRUE])
print(b["Monday",regexp=FALSE])
print(b["s"])
print(b["^s"])
d1 &lt;- b[6,bottom]
rm(b)

## Read from file
b &lt;- open_envi("tmp1")
print(b[])
print(b[-c(6:8)])
d2 &lt;- b[,bottom][6] ## don't use b[6,bottom]
close(b)
envi_remove("tmp1")

## Compare
print(d1)
print(d2)
</code></pre>

<hr>
<h2 id='focal_extrem'>
Extremal spatial filter for image
</h2><span id='topic+focal_extrem'></span><span id='topic+focal_min'></span><span id='topic+focal_max'></span>

<h3>Description</h3>

<p>For each band and for each cell, depending of specification, function finds either minimal or maximal value inside of square window. <em>Focal</em> operation of map algebra.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>focal_extrem(x, kind = c("min", "max"), size = 3, cover = 1e-06, 
            fillNA = FALSE, saveMargin = TRUE, verbose = 0L)
focal_min(x, size = 3, cover = 1e-06, fillNA = FALSE, saveMargin = TRUE, verbose = 0L)
focal_max(x, size = 3, cover = 1e-06, fillNA = FALSE, saveMargin = TRUE, verbose = 0L)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="focal_extrem_+3A_x">x</code></td>
<td>

<p>Object of class <code>ursaRaster</code>.
</p>
</td></tr>
<tr><td><code id="focal_extrem_+3A_kind">kind</code></td>
<td>

<p>Character. What kind of extremum is required. Allowed values <code>"min"</code> or <code>"max"</code>.
</p>
</td></tr>
<tr><td><code id="focal_extrem_+3A_size">size</code></td>
<td>

<p>Positive numeric. Odd values (3, 5, 7, ...) are allowed, but if other value is specified, then it expanded to the next odd value not less than original value. Default is <code>3L</code>.
</p>
</td></tr>
<tr><td><code id="focal_extrem_+3A_cover">cover</code></td>
<td>

<p>Numeric. <code>0&lt;=cover&lt;=1</code>. Quota for <code>NA</code> values in the focal window in relation to the squared size of the focal window. Quota exceeding leads to recording <code>NA</code> value in the cell. Default is <code>cover=1e-6</code>.
</p>
</td></tr>
<tr><td><code id="focal_extrem_+3A_fillna">fillNA</code></td>
<td>

<p>Logical. If <code>TRUE</code> then only <code>NA</code> values of source image can be changed, and non-<code>NA</code> values of source image are kept without changes. It may provide less reducing of spatial resolution in the task of spatial interpolation. Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="focal_extrem_+3A_savemargin">saveMargin</code></td>
<td>

<p>Logical. If <code>TRUE</code> then adaptive window size is used for cells, where original window goes over image boundary. If <code>FALSE</code> then image is expanded to the half size of focal window by <code>NA</code> values and argument <code>cover</code> is applied to this expanded part. Default is <code>TRUE</code>.
</p>
</td></tr>
<tr><td><code id="focal_extrem_+3A_verbose">verbose</code></td>
<td>

<p>Integer of <code>0L</code>, <code>1L</code>, or <code>2L</code>, or logical, which is coerced to integer. The level of verbosity. Values <code>&gt;0</code> provide some additional information on console, <code>verbose=1L</code> is less detailed, <code>verbose=2L</code> is more detailed. Default is <code>0L</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>focal_min(x,...)</code> is a wrapper to <code>focal_extrem(x,"min",...)</code>
<br />
<code>focal_max(x,...)</code> is a wrapper to <code>focal_extrem(x,"max",...)</code>
</p>


<h3>Value</h3>

<p>Object of class <code>ursaRaster</code> with the same number of bands as in input raster.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p>Other focal operations: <code><a href="#topic+Ops.focal_mean">focal_mean</a></code>, <code><a href="#topic+Ops.focal_median">focal_median</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- ursa_dummy(nband=2,mul=1/8,elements=32)
a[a&lt;80] &lt;- NA
b.min &lt;- focal_extrem(a,"min",size=4,cover=0.5,verbose=1L)
b.max &lt;- focal_extrem(a,"max",size=4,cover=0.5,verbose=1L)
print(list(src=a,min=b.min,max=b.max,dif=b.max-b.min))
</code></pre>

<hr>
<h2 id='focal_mean'>
Low-pass spatial filter for image.
</h2><span id='topic+focal_mean'></span>

<h3>Description</h3>

<p>Low-pass filtering by a square window in the image processing. <em>Focal</em> operation of map algebra. Weight of pixels is proportional to cell area inside of focal window.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>focal_mean(x, size = 3.0, cover = 1e-06, fillNA = FALSE, saveMargin = TRUE
          ,noNA = TRUE, verbose = 0L)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="focal_mean_+3A_x">x</code></td>
<td>

<p>Object of class <code>ursaRaster</code>.
</p>
</td></tr>
<tr><td><code id="focal_mean_+3A_size">size</code></td>
<td>

<p>Positive numeric. Size of square focal window. Fractional values are allowed. If <code>size</code> is not odd (3, 5, 7, ...), then window size is expanded to the nearest odd value not less than original value, and pixels on border are taken with the weight, which is proportional to the cell area inside of original size. Default <code>size=3</code>.
</p>
</td></tr>
<tr><td><code id="focal_mean_+3A_cover">cover</code></td>
<td>

<p>Numeric. <code>0&lt;=cover&lt;=1</code>. Quota for <code>NA</code> values in the focal window in relation to all values. Values are taken with the weight proportional of cell areas inside of focal window. Quota exceeding leads to recording <code>NA</code> value in the cell. Default is <code>cover=1e-6</code>.
</p>
</td></tr>
<tr><td><code id="focal_mean_+3A_fillna">fillNA</code></td>
<td>

<p>Logical. If <code>TRUE</code> then only <code>NA</code> values of source image can be changed, and non-<code>NA</code> values of source image are kept without changes. It may provide less reducing of spatial resolution in the task of spatial interpolation. Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="focal_mean_+3A_savemargin">saveMargin</code></td>
<td>

<p>Logical. If <code>TRUE</code> then adaptive window size is used for cells, where original window goes over image boundary. If <code>FALSE</code> then image is expanded to the half size of focal window by <code>NA</code> values and argument <code>cover</code> is applied to this expanded part. Default is <code>TRUE</code>.
</p>
</td></tr>
<tr><td><code id="focal_mean_+3A_nona">noNA</code></td>
<td>

<p>Logical. If <code>TRUE</code> then <code>NA</code> values are transformed to numerical constant, which is interpreted as &quot;no data&quot; value. Filter without <code>NA</code> values has more perfomance, and generally filter with pre- and post-transformations of <code>NA</code> values have more perfomance too. Default is <code>TRUE</code>.
</p>
</td></tr>
<tr><td><code id="focal_mean_+3A_verbose">verbose</code></td>
<td>

<p>Integer of <code>0L</code>, <code>1L</code>, or <code>2L</code>, or logical, which is coerced to integer. The level of verbosity. Values <code>&gt;0</code> provide some additional information on console, <code>verbose=1L</code> is less detailed, <code>verbose=2L</code> is more detailed. Default is <code>0L</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The reference is always central pixel, even if window size is even.
</p>
<p>If <code>size=3</code> then multiplicator is <code>3^(-2)</code> and elements have equal weights:
</p>
<pre>
     [,1] [,2] [,3]
[1,]    1    1    1
[2,]    1    1    1
[3,]    1    1    1
</pre>
<p>If <code>size=2</code> then multiplicator is <code>2^(-2)</code> and weights of elements are:
</p>
<pre>
     [,1] [,2] [,3]
[1,] 0.25 0.50 0.25
[2,] 0.50 1.00 0.50
[3,] 0.25 0.50 0.25
</pre>
<p>If <code>size=3.4</code> then multiplicator is <code>3.4^(-2)</code> and weights of elements are:
</p>
<pre>
     [,1] [,2] [,3] [,4] [,5]
[1,] 0.04 0.20 0.20 0.20 0.04
[2,] 0.20 1.00 1.00 1.00 0.20
[3,] 0.20 1.00 1.00 1.00 0.20
[4,] 0.20 1.00 1.00 1.00 0.20
[5,] 0.04 0.20 0.20 0.20 0.04
</pre>


<h3>Value</h3>

<p>Object of class <code>ursaRaster</code> with the same number of bands as in input raster.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- ursa_dummy(nband=1,mul=1/8,elements=0)
a[a&lt;80] &lt;- NA
print(a)
b1 &lt;- focal_mean(a,size=6,cover=0.5,saveMargin=FALSE)
b2 &lt;- focal_mean(a,size=6,cover=0.5,saveMargin=TRUE)
b3 &lt;- focal_mean(a,size=6,cover=0.5,saveMargin=TRUE,fillNA=TRUE)
print(b3-a)
display(c(a,b1,b2,b3),blank.angle=c(-45,45),blank.density=20)
</code></pre>

<hr>
<h2 id='focal_median'>
Median spatial filter for image
</h2><span id='topic+focal_median'></span>

<h3>Description</h3>

<p>For each band and for each cell, function finds median value inside of square window. <em>Focal</em> operation of map algebra.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>focal_median(x, size = 3, cover = 1e-06, fillNA = FALSE, saveMargin = TRUE, verbose = 0L)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="focal_median_+3A_x">x</code></td>
<td>

<p>Object of class <code>ursaRaster</code>.
</p>
</td></tr>
<tr><td><code id="focal_median_+3A_size">size</code></td>
<td>

<p>Positive numeric. Odd values (3, 5, 7, ...) are allowed, but if other value is specified, then it expanded to the next odd value not less than original value. Default is <code>3L</code>.
</p>
</td></tr>
<tr><td><code id="focal_median_+3A_cover">cover</code></td>
<td>

<p>Numeric. <code>0&lt;=cover&lt;=1</code>. Quota for <code>NA</code> values in the focal window in relation to the squared size of the focal window. Quota exceeding leads to recording <code>NA</code> value in the cell. Default is <code>cover=1e-6</code>.
</p>
</td></tr>
<tr><td><code id="focal_median_+3A_fillna">fillNA</code></td>
<td>

<p>Logical. If <code>TRUE</code> then only <code>NA</code> values of source image can be changed, and non-<code>NA</code> values of source image are kept without changes. It may provide less reducing of spatial resolution in the task of spatial interpolation. Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="focal_median_+3A_savemargin">saveMargin</code></td>
<td>

<p>Logical. If <code>TRUE</code> then adaptive window size is used for cells, where original window goes over image boundary. If <code>FALSE</code> then image is expanded to the half size of focal window by <code>NA</code> values and argument <code>cover</code> is applied to this expanded part. Default is <code>TRUE</code>.
</p>
</td></tr>
<tr><td><code id="focal_median_+3A_verbose">verbose</code></td>
<td>

<p>Integer of <code>0L</code>, <code>1L</code>, or <code>2L</code>, or logical, which is coerced to integer. The level of verbosity. Values <code>&gt;0</code> provide some additional information on console, <code>verbose=1L</code> is less detailed, <code>verbose=2L</code> is more detailed. Default is <code>0L</code>.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Object of class <code>ursaRaster</code> with the same number of bands as in input raster.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p>Other focal operations: <code><a href="#topic+Ops.focal_mean">focal_mean</a></code>, <code><a href="#topic+Ops.focal_extrem">focal_extrem</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- ursa_dummy(1,mul=1/8,elements=0,bandname="src")
a[a&lt;80] &lt;- NA
bF &lt;- c(fillNA.F=focal_median(a[1],size=5,cover=0.5,fillNA=FALSE))
bT &lt;- c(fillNA.T=focal_median(a[1],size=5,cover=0.5,fillNA=TRUE))
print(c(diff=bT-bF))
d &lt;- c(a,bF,bT)
print(d)
display(d)
</code></pre>

<hr>
<h2 id='focal_special'>
Custom spatial filtering for image
</h2><span id='topic+focal_special'></span>

<h3>Description</h3>

<p>For each band and for each cell, function calculates value using specific matrix of square window. <em>Focal</em> operation of map algebra.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>focal_special(x, type = c("custom", "gaussian", "laplacian", "osisaf",
                          "hires", "correl", "LoG", "sobel", "sobelG"),
             fmask = NULL, size = 3, alpha = 0.5, sigma = (size-1)/4,
             cover = 1 - 1e-06, fillNA = FALSE, saveMargin = FALSE, verbose = 0L)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="focal_special_+3A_x">x</code></td>
<td>

<p>Object of class <code>ursaRaster</code>.
</p>
</td></tr>
<tr><td><code id="focal_special_+3A_type">type</code></td>
<td>

<p>Character, which is checked by <code><a href="base.html#topic+match.arg">match.arg</a></code>.
</p>
</td></tr>
<tr><td><code id="focal_special_+3A_fmask">fmask</code></td>
<td>

<p>Numeric square matrix. Filter mask. If <code>NULL</code> then <code>matrix(1,ncol=1)</code> is used. Default is <code>NULL</code>.
</p>
</td></tr>
<tr><td><code id="focal_special_+3A_size">size</code></td>
<td>

<p>Numeric. Diameter of circuled filter mask. Coerced to the nearest odd value not less than original value.
</p>
</td></tr>
<tr><td><code id="focal_special_+3A_alpha">alpha</code></td>
<td>

<p>Nimeric. Parameter <code>alpha</code> for &quot;Laplacian&quot;, &quot;LoG&quot;, &quot;hires&quot;, &quot;correl&quot; filters. Ignored for others. Default is <code>0.5</code>.
</p>
</td></tr>
<tr><td><code id="focal_special_+3A_sigma">sigma</code></td>
<td>

<p>Numeric. Parameter <code>sigma</code> for &quot;Gaussian&quot;, &quot;LoG&quot; filters. Ignored for others. Default is <code>0.5</code>.
</p>
</td></tr>
<tr><td><code id="focal_special_+3A_cover">cover</code></td>
<td>

<p>Numeric. <code>0&lt;=cover&lt;=1</code>. Quota for <code>NA</code> values in the focal window in relation to the squared size of the focal window. Quota exceeding leads to recording <code>NA</code> value in the cell. Default is <code>cover=1-1e-6</code>.
</p>
</td></tr>
<tr><td><code id="focal_special_+3A_fillna">fillNA</code></td>
<td>

<p>Logical. If <code>TRUE</code> then only <code>NA</code> values of source image can be changed, and non-<code>NA</code> values of source image are kept without changes. It may provide less reducing of spatial resolution in the task of spatial interpolation. Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="focal_special_+3A_savemargin">saveMargin</code></td>
<td>

<p>Logical. If <code>TRUE</code> then adaptive window size is used for cells, where original window goes over image boundary. If <code>FALSE</code> then image is expanded to the half size of focal window by <code>NA</code> values and argument <code>cover</code> is applied to this expanded part. Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="focal_special_+3A_verbose">verbose</code></td>
<td>

<p>Integer of <code>0L</code>, <code>1L</code>, or <code>2L</code>, or logical, which is coerced to integer. The level of verbosity. Values <code>&gt;0</code> provide some additional information on console, <code>verbose=1L</code> is less detailed, <code>verbose=2L</code> is more detailed. Default is <code>0L</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Developed under impression from Matlab's &quot;fspecial&quot;.
</p>
 
<ul>
<li><p><code>type="custom"</code><br />
Filter mask (argument <code>fmask</code>) should be specified manually.
</p>
</li>
<li><p><code>type="gaussian"</code><br />
Gaussian filter. For cascade filtering (sequence of increasing or decreasing window <code>size</code>) <code>sigma=(size-1)/4</code> produces the same distribution density relative to window size. If <code>sigma</code> is high but not <code>Inf</code> then it is low-pass filter with diameter=<code>size</code> of circular focal window.
</p>
</li>
<li><p><code>type="laplacian"</code><br />
Laplacian filter. Only <code>size=3</code> makes sence. Any <code>size</code> is coerced to <code>size=3</code>.
</p>
</li>
<li><p><code>type="osisaf"</code><br />
Filter for edge detection. Only <code>size=5</code> makes sence. Any <code>size</code> is coerced to <code>size=5</code>. <em>TODO (pl): reference</em> </p>
<pre>
       -0.0625 -0.0625 -0.0625 -0.0625 -0.0625
       -0.0625  0.1250  0.1250  0.1250 -0.0625
       -0.0625  0.1250  0.0000  0.1250 -0.0625
       -0.0625  0.1250  0.1250  0.1250 -0.0625
       -0.0625 -0.0625 -0.0625 -0.0625 -0.0625</pre>
</li>
<li><p><code>type="hires"</code><br />
Filter for unsharping. Only <code>size=3</code> makes sence. Any <code>size</code> is coerced to <code>size=3</code>.</p>
<pre>
      -alpha   alpha-1 -alpha
       alpha-1 alpha+5  alpha-1
      -alpha   alpha-1 -alpha</pre>
</li>
<li><p><code>type="correl"</code><br />
Filter for contrast increasing. Only <code>size=3</code> makes sence. Any <code>size</code> is coerced to <code>size=3</code>.</p>
<pre>
                 alpha^2    -alpha*(1+alpha^2)               alpha^2
      -alpha*(1+alpha^2)         (1+alpha^2)^2    -alpha*(1+alpha^2)
                 alpha^2    -alpha*(1+alpha^2)               alpha^2</pre>
</li>
<li><p><code>type="LoG"</code><br />
Laplacian of Gaussian. Filter for edge detection. <code>sigma</code> is used, <code>alpha</code> is ignored.
</p>
</li>
<li><p><code>type="sobel"</code><br />
Two-directional Sobel filtering. Only <code>size=3</code> makes sence. Any <code>size</code> is coerced to <code>size=3</code>.
</p>
</li>
<li><p><code>type="sobelG"</code><br />
Sobel gradient. Only <code>size=3</code> makes sence. Any <code>size</code> is coerced to <code>size=3</code>.
</p>
</li></ul>



<h3>Value</h3>

<p>Object of class <code>ursaRaster</code> with the same number of bands as in input raster.
</p>


<h3>Warning</h3>

<p>Laplacian of Gaussian filter (<code>type="LoG"</code>) is not implemented clearly due to applying continuous-valued formula to discrete matrix.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>References</h3>

<p><em>TODO(pl): at least reference to 'osisaf'.</em>
</p>


<h3>See Also</h3>

<p>Other focal operations: <code><a href="#topic+Ops.focal_mean">focal_mean</a></code>, <code><a href="#topic+Ops.focal_median">focal_median</a></code>, <code><a href="#topic+Ops.focal_extrem">focal_extrem</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
v &lt;- round(runif(8,min=-1,max=1),3)
customFilter &lt;- matrix(c(v[1:4],-sum(v),v[5:8]),ncol=3)
a &lt;- ursa_dummy(1,mul=4/8,elements=32)
tpList &lt;- eval(formals("focal_special")$type)
res &lt;- c(src=a,as.ursa(bandname=tpList))
for (tp in tpList) {
   message(tp)
   res[tp] &lt;- focal_special(a,tp,fmask=customFilter,size=11,sigma=1,alpha=0.8
                           ,saveMargin=0,verbose=2L)
}
print(res)
display(res,decor=FALSE)
</code></pre>

<hr>
<h2 id='get_earthdata'>
Retrive data from Global Imagery Browse Services (GIBS) using API for Developers
</h2><span id='topic+get_earthdata'></span>

<h3>Description</h3>

<p><code>get_earthdata</code> allows retrieving georeferences optical satellite images of low and moderate spatial resolution (up to 250m per cell) using GIBS API for Developers.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_earthdata(bbox = NA, res = c("2km", "1km", "500m", "250m"),
              date = NA, product = "", geocode = "",
              expand = 1.05, border = 0, display = FALSE,
              cache = NA, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_earthdata_+3A_bbox">bbox</code></td>
<td>

<p>Numeric of length 4 or character. Spatial extent in the notation <code>c(minx,miny,maxx,maxy)</code>. Can be in utits of meters or degrees. If all absolute values are less than 360, then units are in degrees and projection is EPSG:3857, else units are in meters and projection is EPSG:3413. If <code>bbox=NULL</code>, then function return list of available products. If <code>bbox=NA</code> then boundary box is attempted for taking from session grid. If character, then boundary box is taken from geocoding. Default is region of Vaigach Island.
</p>
</td></tr>
<tr><td><code id="get_earthdata_+3A_res">res</code></td>
<td>

<p>Character or numeric. Parameter, which is responsible for dimension of output raster image. If character, then zoom is selected using keyword list <code>c("2km", "1km", "500m", "250m")</code> for EPSG:3413. If <code>res&lt;10</code> then it is interpreted as zoom for Web Map Tile Service (WMTS). If <code>res&gt;100</code> then <code>res</code> is interpreted as preffered image dimension. If <code>res=NA</code> then <code>res=480L</code>.
</p>
</td></tr>
<tr><td><code id="get_earthdata_+3A_date">date</code></td>
<td>

<p>Character or <code>"Date"</code> object. Date for image retrieving. Default is <code>Sys.Date()-1L</code>.
</p>
</td></tr>
<tr><td><code id="get_earthdata_+3A_product">product</code></td>
<td>

<p>Character of integer. Data product form GIBS. Currently only MODIS-oriented (corrected reflectance) products are available:
</p>

<ol>
<li><p> &quot;MODIS_Aqua_CorrectedReflectance_Bands721&quot;
</p>
</li>
<li><p> &quot;MODIS_Terra_CorrectedReflectance_Bands721&quot;
</p>
</li>
<li><p> &quot;MODIS_Aqua_CorrectedReflectance_TrueColor&quot;
</p>
</li>
<li><p> &quot;MODIS_Terra_CorrectedReflectance_TrueColor&quot;
</p>
</li>
<li><p> &quot;VIIRS_SNPP_CorrectedReflectance_TrueColor&quot;
</p>
</li>
<li><p> &quot;Coastlines&quot;
</p>
</li></ol>

<p>Please check actual list by calling <code>get_earthdata(bbox=NULL)</code>.
</p>
<p>If numeric, then index of item among available products. <a href="base.html#topic+regex">Regular expressions</a> can be used to simplify value of product, e.g., case-insensitive &quot;aqua 721&quot;, &quot;terra truecolor&quot;, &quot;suomi&quot;, &quot;SNNP&quot;.
</p>
</td></tr>
<tr><td><code id="get_earthdata_+3A_geocode">geocode</code></td>
<td>

<p>Character. Keyword for geocode service. Valid values are <code>"google"</code>, <code>"nominatim"</code>. Default is <code>""</code>; several services are considered in the case of failure.
</p>
</td></tr>
<tr><td><code id="get_earthdata_+3A_expand">expand</code></td>
<td>

<p>Numeric. Multiplier for plotting panel zoom in relation to extent of plotting geometry. Ignored if geocoding is not applied. Default is <code>1.05</code>.
</p>
</td></tr>
<tr><td><code id="get_earthdata_+3A_border">border</code></td>
<td>

<p>Integer. Value in pixels of fixed margins around plotting geometry. Ignored if geocoding is not applied. Default is <code>0L</code>.
</p>
</td></tr>
<tr><td><code id="get_earthdata_+3A_display">display</code></td>
<td>

<p>Logical. Value <code>TRUE</code> forces to display image instead of return it. Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="get_earthdata_+3A_cache">cache</code></td>
<td>

<p>Logical. Is cache used? Default is <code>NA</code>, which is interpreted as <code>TRUE</code> for any requested date excepting not late time of today (approximately 17:00 UTC).
</p>
</td></tr>
<tr><td><code id="get_earthdata_+3A_verbose">verbose</code></td>
<td>

<p>Logical. Value <code>TRUE</code> may provide some additional information on console. Default is <code>FALSE</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Argument <code>method="libcurl"</code> is used in function <code><a href="utils.html#topic+download.file">download.file</a></code> for tile downloading. Please check <code><a href="base.html#topic+capabilities">capabilities</a>("libcurl")</code>.
</p>
<p>Valid zoom values (e. g., specified via <code>res</code> argument) are 3:6 for EPSG:3413 and 0:8 for EPSG:3587.
</p>
<p>Longitude 180 degrees has a seam in EPSG:3857 (e.g., see <code>bbox=c(170,68,-170,73)</code> and <code>bbox=c(-1600000,1308000,-1370000,1570000)</code> for Wrangel Island. If region crosses longitude 180 degrees in EPSG:3857, then the prior day is taken for Western Hemisphere.
</p>


<h3>Value</h3>

<p>If <code>bbox=NULL</code>, then character vector of available products.
</p>
<p>If <code>display=FALSE</code> then object of class <code>ursaRaster</code> with RGBA image.
</p>
<p>If <code>display=TRUE</code> then returned value of <code><a href="#topic+display_brick">display_brick</a></code>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>References</h3>

<p><a href="https://wiki.earthdata.nasa.gov/display/GIBS/GIBS+API+for+Developers">GIBS API for Developers</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
pr &lt;- get_earthdata()
print(pr,quote=FALSE)

 ## internet connection is required -- begin
a1 &lt;- get_earthdata(bbox=c(2000000,400000,2300000,700000))
display(a1)

 ## internet connection is required -- end
a2 &lt;- get_earthdata(product=2
                  # ,date=Sys.Date()-7L ## empty tiles for winter polar regions
                   ,date=as.Date(format(Sys.Date()-365L,"%Y-06-15"))
                   ,res=7,bbox=c(57.8,69.4,62.3,70.8))
display(a2)

</code></pre>

<hr>
<h2 id='glance'>
Command line utility for spatial view of raster or vector GIS file.
</h2><span id='topic+glance'></span><span id='topic+.glance'></span>

<h3>Description</h3>

<p><code>glance</code> is a parser of command line arguments for non-public function <code>.glance</code>, which creates multi-panel plots for each attribute of vector file or for each band of raster file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>glance(...)

# non-public
.glance(dsn, layer = ".*", grid = NULL, field = ".+", size = NA, expand = 1,
        border = 27, lat0 = NA, lon0 = NA, resetProj = FALSE, resetGrid = FALSE, 
        style = "auto", feature = c("auto", "field", "geometry"), alpha = NA,
        basemap.order = c("after", "before"), basemap.alpha = NA,
        engine = c("native", "sp", "sf"), geocode = "", place="",
        area = c("bounding", "point", "shape"), zoom = NA, gdal_rasterize = FALSE,
        silent = FALSE, verbose = FALSE, ...)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="glance_+3A_dsn">dsn</code></td>
<td>

<p>Character or object of either <code>ursaRaster</code>, <code>Spatial</code>, or <code>sf</code> classes. If character, then data source name (interpretation varies by driver - for some drivers, dsn is a file name, but may also be a folder, or contain the name and access credentials of a database).
</p>
</td></tr>
<tr><td><code id="glance_+3A_layer">layer</code></td>
<td>

<p>Character or integer. If integer, then layer index. If character, then pattern (<a href="base.html#topic+regex">regular expressions</a>) to recognize layer by name. Only one layer selection is allowed. If selected more then one layer, the error message contains indices and names of layers. Usually, datasets (e. g., &quot;ESRI Shapefile&quot;) have only one layer. Default is <code>".*"</code>; interpreted as all layers.
</p>
</td></tr>
<tr><td><code id="glance_+3A_grid">grid</code></td>
<td>

<p>Object of class <code>ursaGrid</code> or NULL. Reference CRS and boundary box for visualization. If <code>NULL</code>, then CRS and boundary box are zoomed to layer. Default is <code>NULL</code>.
</p>
</td></tr>
<tr><td><code id="glance_+3A_field">field</code></td>
<td>

<p>Character. Pattern for field (attribute, column,...) selection by name using <a href="base.html#topic+regex">regular expressions</a>. Multiple selection is allowed. Default is <code>".+"</code>; all fields.
</p>
</td></tr>
<tr><td><code id="glance_+3A_size">size</code></td>
<td>

<p>Integer of length 1 or 2 or character of length 1. Size of plotting panel in pixels. If character, then parsed to integer of length 1 or 2. Length 2 is used only for web cartography. If length 1, then <code>size</code> defines width of panel, and height is defined automatically. If integer, then width of panel for plotting in pixels. Default is <code>NA</code>; for web cartogrpaphy value of maximal size of static maps, and <code>640</code> for other cases.
</p>
</td></tr>
<tr><td><code id="glance_+3A_expand">expand</code></td>
<td>

<p>Numeric. Multiplier for plotting panel zoom in relation to extent of plotting geometry. Default is <code>1.0</code>.
</p>
</td></tr>
<tr><td><code id="glance_+3A_border">border</code></td>
<td>

<p>Integer. Value in pixels of fixed margins around plotting geometry. Default is <code>27L</code>.
</p>
</td></tr>
<tr><td><code id="glance_+3A_lat0">lat0</code></td>
<td>

<p>Numeric. Parallel os zero distortion. If <code>NA</code>, then parallel os zero distortion is determined from object geometry. Actual for <code>"+proj=stere"</code> projections. Default is <code>NA</code>.
</p>
</td></tr>
<tr><td><code id="glance_+3A_lon0">lon0</code></td>
<td>

<p>Numeric. Central meridian, which have vertical direction on the plot. If <code>NA</code>, then central meridian is determined from object geometry. Default is <code>NA</code>.
</p>
</td></tr>
<tr><td><code id="glance_+3A_resetproj">resetProj</code></td>
<td>

<p>Logical. Value <code>TRUE</code> overwrites projection of vector file. Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="glance_+3A_resetgrid">resetGrid</code></td>
<td>

<p>Logical. If <code>TRUE</code>, then <a href="#topic+session">session grid</a> is ignored, and new session grid is assigned from input file. If <code>FALSE</code>, then input file is nested in the session grid.
</p>
</td></tr>
<tr><td><code id="glance_+3A_style">style</code></td>
<td>

<p>Character. Either projection class or source of web-catrogrpaphy for basemap. Specified by a sentence of words separated by spaces.
</p>

<ul>
<li><p> Projection class <br />
Valid values are <code>"stere"</code>, <code>"laea"</code>, <code>"merc"</code>, <code>"longlat"</code>. Default is keyword <code>"auto"</code>; use object projection, if this projection differs from projection class <code>"+longlat"</code>, otherwise, projection (<code>"stere"</code> or <code>"merc"</code>) is determined internally.
</p>
</li>
<li><p> Web cartography.
</p>

<ul>
<li><p> Static map<br />
Valid values are <code>"google"</code>, <code>"openstreetmap"</code>, <code>"sputnikmap"</code>. Static maps have priority over tile services. however additional word <code>"static"</code> can be specified in the sentence, e.g., <code>"openstreetmap static"</code> or <code>"static google"</code>. Additional parameters for request to web-script can be added in the sentence in the form <code>"argument1=value1 [argument2=value2]"</code>, e.g., <code>style="google static maptype=terrain language=ru-RU scale=2"</code>.
</p>
</li>
<li><p> Tile service<br />
Supported tile services can be returned by calling of non-public function <code>ursa:::.tileService()</code> without arguments. Valid values are <code>"mapnik"</code>, <code>"cycle"</code>, <code>"transport"</code>, <code>"mapsurfer"</code>, <code>"sputnik"</code>, <code>"thunderforest"</code>, <code>"carto"</code>, <code>"kosmosnimki"</code>, etc. 
</p>
</li></ul>

<p>By default, if data has no data fields (e. g., geometry only), then basemap is drawn in color, else in grayscale. Adding word <code>"color"</code> (or <code>"colour"</code>) to the sentence forces to use colored basemap. Adding word <code>"gray"</code> (or <code>"grey"</code>, <code>"greyscale"</code>, <code>"grayscale"</code>) to the sentence forces to use colored basemap.
</p>
<p>The order of words in the sentence is any.
</p>
</li></ul>

<p>Keywords <code>"google"</code>, <code>"openstreetmap"</code> force to use &quot;Google Static Map&quot; or &quot;OpenStreetMap static map images&quot; for basemap; the resulted projection has class <code>"+proj=merc"</code>.
</p>
</td></tr>
<tr><td><code id="glance_+3A_feature">feature</code></td>
<td>

<p>Character. Appearance of visualization. If <code>"field"</code> then data of each field is plotted on separate panel (number of panels is equal to number of columns in attribute table). If <code>"geometry"</code> then each feature is plotted on separate panel (number of panels is equal to number of rows in attribute table). Default is <code>"auto"</code>; if intersects of features are found, then <code>"geometry"</code> is used, else <code>"field"</code>.
</p>
</td></tr>
<tr><td><code id="glance_+3A_basemap.order">basemap.order</code></td>
<td>

<p>Character. The order of basemap layer rendering in the case of web-cartography basemap.If <code>"before"</code>, then basemap is plotted before object plot. If <code>"after"</code>, then basemap is plotted over object. 
</p>
</td></tr>
<tr><td><code id="glance_+3A_basemap.alpha">basemap.alpha</code></td>
<td>

<p>Character. The saturation of basemap in the case of web-cartography basemap. Default is <code>NA</code>; <code>basemap.alpha=0.5</code> for <code>basemap.order="before"</code> and <code>basemap.alpha=0.35</code> for <code>basemap.order="after"</code>.
</p>
</td></tr>
<tr><td><code id="glance_+3A_alpha">alpha</code></td>
<td>

<p>Character. The opacity of plotted object. Default is <code>NA</code>; 0.75 for <code>basemap.order="before"</code> in web-cartogrpaphy style, <code>1.00</code> - in all other cases.
</p>
</td></tr>
<tr><td><code id="glance_+3A_engine">engine</code></td>
<td>

<p>Character keyword. Forcing to vector files processing by functions from package <span class="pkg">sp</span> (<code>engine="sp"</code>) or package <span class="pkg">sf</span> (<code>engine="sf"</code>, if <span class="pkg">sf</span> is installed). Default is <code>"native"</code>; if <code>dsn</code> is <code>Spatial</code> object or if <span class="pkg">sf</span> is not installed, then <code>"sp"</code> is used.
</p>
</td></tr>
<tr><td><code id="glance_+3A_geocode">geocode</code></td>
<td>

<p>Character. Keyword for geocode service. Valid values are <code>"google"</code>, <code>"nominatim"</code>. If <code>dsn</code> is character and file <code>dsn</code> not found, then trying to interpret <code>dsn</code> as a request to geocode service. The output is only basemap of web cartogrpaphy. Default is <code>""</code>; several services are considered in the case of failure. Is <code>style</code> is not specified, then &quot;Google Static Map&quot; is used for <code>geocode="google"</code>, and &quot;OpenStreetMap static map images&quot; for <code>geocode="nominatim"</code>.
</p>
</td></tr>
<tr><td><code id="glance_+3A_place">place</code></td>
<td>

<p>Character. Type of geographical object (river, island) in the geocoding request. If <code>geocode</code> service is <code>"nominatim"</code>, then <code>place</code> is searched among attributes &quot;class&quot; and &quot;type&quot;. Default is <code>""</code>; any object is acceptable.
</p>
</td></tr>
<tr><td><code id="glance_+3A_area">area</code></td>
<td>

<p>Character. Keyword of spatial class of geocoded object. <code>"bounding"</code> is used for boundary box; <code>"point"</code> is used for point. Default value is extracted by <code>match.arg(area)</code>.
</p>
</td></tr>
<tr><td><code id="glance_+3A_zoom">zoom</code></td>
<td>

<p>Positive integer or character. Zooming if web-cartography is applied for basemap. If integer, then value of zoom for tile services and staticmap. If character, then <code>"0"</code> means zoom by default (defined internally), <code>"+1"</code> means increment on 1 of default zoom, <code>"+2"</code> means zoom increment on 2, <code>"-1"</code> means zoom decrement on 1, <code>"-2"</code> means zoom decrement on 2, <em>etc</em>. Default is <code>NA</code>; zoom is defined internally.
</p>
</td></tr>
<tr><td><code id="glance_+3A_gdal_rasterize">gdal_rasterize</code></td>
<td>

<p>Logical. If <code>TRUE</code> and GDAL utilities are in the system search path, then overlay for panels is formed via rastetization of vector file. GDAL utility &quot;gdal_rasterize&quot; is used. Note, that GDAL (system level) is optional for this package. Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="glance_+3A_silent">silent</code></td>
<td>

<p>Logical. Value <code>TRUE</code> cancels progress bar. Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="glance_+3A_verbose">verbose</code></td>
<td>

<p>Logical. Logical. Value <code>TRUE</code> may provide some additional information on console. Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="glance_+3A_...">...</code></td>
<td>

<p><code>glance</code>: Arguments, which are passed to <code>.glance</code> or to <code><a href="#topic+display">display</a></code>.
<br /><code>.glance</code>: Arguments, which are passed to static maps API, <code><a href="#topic+colorize">colorize</a></code>, <code><a href="#topic+display">display</a></code>, <em>etc</em>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Command line usage implies set of arguments using pair: argument <em><code style="white-space: pre;">&#8288;name&#8288;</code></em> and argument <em><code style="white-space: pre;">&#8288;value&#8288;</code></em>. and values in the format &quot;<em><code style="white-space: pre;">&#8288;[name1=]value1 [name2]=value2&#8288;</code></em>&quot;. No spaces around <em><code style="white-space: pre;">&#8288;=&#8288;</code></em> (equal symbol). Argument <em><code style="white-space: pre;">&#8288;name&#8288;</code></em> can be omitted, symbol <em><code style="white-space: pre;">&#8288;=&#8288;</code></em> is omitted too. If argument <em><code style="white-space: pre;">&#8288;value&#8288;</code></em> has spaces, then argument value should be surrounded by double quotes (<code>fname="my test.shp"</code>). If argument <em><code style="white-space: pre;">&#8288;value&#8288;</code></em> is matched to <span class="rlang"><b>R</b></span> function, then such value should be surrounded by single quotes (<code>layer='density'</code>).
</p>
<p>Command line usage example: <code>Rscript -e ursa::glance() 'final_more_than_032.sqlite' attr="select" resetProj=TRUE expand=1.5</code>
</p>
<p>For OS Windows, bat-file can be created for raster and vector file association:
<code>Rscript -e ursa::glance() %*</code>
</p>
<p>Command line usage implies external software for PNG view <code><a href="#topic+session">session_pngviewer</a>(TRUE)</code>.
</p>


<h3>Value</h3>

<p><code>glance</code> returns integer: <code>0L</code> - successful, <code>10L</code> - call without arguments.
</p>


<h3>Note</h3>

<p>Package <span class="pkg">sp</span> is 'Suggested' for package <span class="pkg">ursa</span>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
f &lt;- system.file("shape/nc.shp",package="sf")
glance(f,style="merc",field="(NAME|AREA|COUNT)")
cmd &lt;- paste("Rscript --vanilla -e ursa::glance()",paste0("\"",f,"\"")
            ,"style=\"merc\"","field=\"74$\"")
cat(" --------- Try in command line: -----------\n")
message(cmd)
cat(" ----------- end of quoting ---------------\n")

## windows: figure will be opened using *.png file association 
try(system(cmd,wait=FALSE))


a &lt;- data.frame(lat=c(70.734,71.657),lon=c(178.577,-177.38),place="Wrangel Island")
if (requireNamespace("sp")) {
   sp::coordinates(a) &lt;- ~lon+lat
   sp::proj4string(a) &lt;- "EPSG:4326"
} else {
   a &lt;- sf::st_as_sf(a,coords=c("lon","lat"),crs=4326)
}

## internet connection is required
glance(a,style="Esri.Satellite",border=0)


## internet connection is required
glance(a,style="opentopomap grey",border=0)


## internet connection is required
glance("Svalbard 9170",resetGrid=TRUE)

</code></pre>

<hr>
<h2 id='global+20operator'>
Extract certains statistics for whole image
</h2><span id='topic+global_mean'></span><span id='topic+global_median'></span><span id='topic+global_sd'></span><span id='topic+global_sum'></span><span id='topic+global_min'></span><span id='topic+global_max'></span><span id='topic+global_n'></span><span id='topic+global_nNA'></span><span id='topic+global_range'></span><span id='topic+global_quantile'></span>

<h3>Description</h3>

<p>Function from this <code style="white-space: pre;">&#8288;global.&#8288;</code><em><code style="white-space: pre;">&#8288;FUN&#8288;</code></em> list returns required statistics <em>FUN</em> for the whole image.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>global_mean(x, ursa = FALSE, ...)
global_median(x, ursa = FALSE, ...)
global_sd(x, ursa = FALSE, ...)
global_sum(x, ursa = FALSE, ...)
global_min(x, ursa = FALSE, ...)
global_max(x, ursa = FALSE, ...)
global_n(x, ursa = FALSE, ...)
global_nNA(x, ursa = FALSE, ...)
global_range(x, ursa = FALSE, ...)
global_quantile(x, ursa = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="global+2B20operator_+3A_x">x</code></td>
<td>

<p>Object of class <code>ursaRaster</code>.
</p>
</td></tr>
<tr><td><code id="global+2B20operator_+3A_ursa">ursa</code></td>
<td>

<p>Logical. The class of returned value. If <code>FALSE</code> then numeric vector of length one is returned (for <code>global_range</code> vector has length two). If <code>TRUE</code> then returned value is single-band raster image (two-bands image for <code>global_range</code>) with constant value for all cells (blank image). Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="global+2B20operator_+3A_...">...</code></td>
<td>

<p>Arguments in function <code style="white-space: pre;">&#8288;global.&#8288;</code><em><code style="white-space: pre;">&#8288;FUN&#8288;</code></em> which are passed to function <em><code style="white-space: pre;">&#8288;FUN&#8288;</code></em>. 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For any function <code style="white-space: pre;">&#8288;global&#8288;</code>.<em><code style="white-space: pre;">&#8288;FUN&#8288;</code></em>, if argument <code>na.rm</code> is not in <code>...</code>, then <em><code style="white-space: pre;">&#8288;FUN&#8288;</code></em> is called with forced <code>na.rm=TRUE</code>.
</p>
<p><code style="white-space: pre;">&#8288;global_range\emph{list of arguments}&#8288;</code> is implemented as <code style="white-space: pre;">&#8288;c(global_min(&#8288;</code><em><code style="white-space: pre;">&#8288;list of arguments&#8288;</code></em><code style="white-space: pre;">&#8288;), global_max(&#8288;</code><em><code style="white-space: pre;">&#8288;list of arguments&#8288;</code></em><code style="white-space: pre;">&#8288;))&#8288;</code> with the same list of arguments.
</p>
<p>Alternative method to get global statistics is function applying directly to the raster value. For example, <code>sd(ursa_value(x,na.rm=TRUE))</code>. This way is also appropriate for missing global functions: for example, <code>var(ursa_value(x,na.rm=TRUE))</code>.
</p>


<h3>Value</h3>

<p>If <code>ursa=FALSE</code> then <code><a href="base.html#topic+numeric">numeric</a></code>.
<br />
If <code>ursa=TRUE</code> then object of class <code><a href="#topic+classRaster">ursaRaster</a></code>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- ursa_dummy(2,min=-40,max=80)
a[a&lt;0] &lt;- NA
print(a)
a.mean &lt;- global_mean(a)
a.sd &lt;- global_sd(a)
a.sum &lt;- global_sum(a)
a.min &lt;- global_min(a)
a.max &lt;- global_max(a)
a.median &lt;- global_median(a)
print(c(mean=a.mean,sd=a.sd,sum=a.sum,min=a.min,max=a.max,median=a.median))
v.max &lt;- max(ursa_value(a),na.rm=TRUE)
print(c('global_max()'=a.max,'max(ursa_value())'=v.max,dif=a.max-v.max))
r.max &lt;- global_max(a,ursa=TRUE)
print(r.max)
b &lt;- c(a,'appended scalar value'=a.max)
print(b)
print(global_quantile(a))
</code></pre>

<hr>
<h2 id='groupGeneric'>
Group Generic Functions for raster image
</h2><span id='topic+groupGeneric'></span><span id='topic+groupGeneric.ursaRaster'></span><span id='topic+Math.ursaRaster'></span><span id='topic+Ops.ursaRaster'></span><span id='topic+Summary.ursaRaster'></span><span id='topic+Complex.ursaRaster'></span>

<h3>Description</h3>

<p>These functions implement arithmetical and logical operations, mathematical functions for objects of class <code>ursaRaster</code> as well as group generic functions from package <span class="pkg">base</span> do similar for S3 class. These are <strong><em>local</em></strong> operations in the raster algebra (map algebra).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaRaster'
Ops(e1, e2 = NULL)

## S3 method for class 'ursaRaster'
Math(x, ...)

## S3 method for class 'ursaRaster'
Complex(z)

## S3 method for class 'ursaRaster'
Summary(..., na.rm = FALSE)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="groupGeneric_+3A_x">x</code></td>
<td>

<p><code>ursaRaster</code> object
</p>
</td></tr>
<tr><td><code id="groupGeneric_+3A_e1">e1</code></td>
<td>

<p><code>ursaRaster</code> object
</p>
</td></tr>
<tr><td><code id="groupGeneric_+3A_e2">e2</code></td>
<td>

<p>Numeric of length 1, matrix, array, or <code>ursaRaster</code> object.
</p>
</td></tr>
<tr><td><code id="groupGeneric_+3A_na.rm">na.rm</code></td>
<td>

<p>Logical. If <code>na.rm=TRUE</code> then no-data values are omitted.
</p>
</td></tr>
<tr><td><code id="groupGeneric_+3A_z">z</code></td>
<td>

<p>Any.
</p>
</td></tr>
<tr><td><code id="groupGeneric_+3A_...">...</code></td>
<td>

<p>For group <em><a href="base.html#topic+groupGeneric">Math</a></em> - further arguments passed to methods. See description for generic.
</p>
<p>For group <em><a href="base.html#topic+groupGeneric">Summary</a></em> - set of arguments, which are recognized via their names (using <a href="base.html#topic+regex">regular expressions</a>), position and classes.
</p>

<dl>
<dt>.*</dt><dd>
<p>Position 1. Object of class <code>ursaRaster</code>.
</p>
</dd>
<dt><code>cov|cvr</code></dt><dd>
<p>Position &gt;1. Numeric between 0 and 1. If proportion of bands with no data for given location exceeds <code>cover</code> then output value is <code>NA</code> (no data). Default is <code>0.5-1e-3</code>.
</p>
</dd>
<dt><code>w</code></dt><dd>
<p>Position &gt;1. Numeric of length number of bands or <code>NULL</code>. Band weights for weighted mean. Default is <code>NULL</code>; all bands have equal weights.
</p>
</dd>
<dt><code>name</code></dt><dd>
<p>Position &gt;1. Character of length 1. Band name for output raster. Default is <code>""</code>; band name is assigned automatically.
</p>
</dd>
<dt><code>verb(ose)*</code></dt><dd>
<p>Position &gt;1. Logical. <code>verbose=TRUE</code> provides some additional information on console. Default is <code>FALSE</code>.
</p>
</dd>
</dl>

</td></tr>
</table>


<h3>Details</h3>

<p>The groups are <code style="white-space: pre;">&#8288;'Summary'&#8288;</code>, <code style="white-space: pre;">&#8288;'Ops'&#8288;</code>, <code style="white-space: pre;">&#8288;'Math'&#8288;</code>, and <code style="white-space: pre;">&#8288;'Complex&#8288;</code>'. See &ldquo;Details&rdquo; section in the <a href="base.html#topic+groupGeneric">S3 Generic Functions</a> help page.
</p>
<p>The group <code style="white-space: pre;">&#8288;'Complex'&#8288;</code> is unsupported.
</p>
<p>The groups <code style="white-space: pre;">&#8288;'Math'&#8288;</code> and <code style="white-space: pre;">&#8288;'Summary'&#8288;</code> are implemented completely.
</p>
<p>The group <code style="white-space: pre;">&#8288;'Ops'&#8288;</code> has some features.
</p>

<ul>
<li><p>Logical operators <code style="white-space: pre;">&#8288;"&lt;"&#8288;</code>, <code style="white-space: pre;">&#8288;"&gt;"&#8288;</code>, <code style="white-space: pre;">&#8288;"&lt;="&#8288;</code>, <code style="white-space: pre;">&#8288;"&gt;="&#8288;</code>, <code style="white-space: pre;">&#8288;"=="&#8288;</code>, <code style="white-space: pre;">&#8288;\"!="&#8288;</code> return <code>'NA'</code> for value <code>FALSE</code> and <code>'1'</code> for value <code>TRUE</code> to organize cells' masking.
</p>
</li>
<li><p>Unary operator <code style="white-space: pre;">&#8288;"!"&#8288;</code> is equal to binary operator operators <code style="white-space: pre;">&#8288;"!="&#8288;</code>, where the second argument is scalar value <code>0</code> (zero).
</p>
</li></ul>

<p>The operators of groups <code style="white-space: pre;">&#8288;'Math'&#8288;</code> and <code style="white-space: pre;">&#8288;'Ops'&#8288;</code> destroy <a href="#topic+classColorTable">color tables</a>.
</p>
<p>For group <code style="white-space: pre;">&#8288;'Summary'&#8288;</code> the realization of local operators of map algebra is possible via <code><a href="base.html#topic+apply">apply</a></code> function:<br />
<code>apply(ursa_value(obj),1,function(x) {y &lt;- sd(x)+1;y})</code><br />
or<br />
<code>as.ursa(apply(obj,1:2,function(x) {y &lt;- sd(x)+1;y}))</code>
</p>


<h3>Value</h3>

<p>Operators of groups <code style="white-space: pre;">&#8288;'Complex'&#8288;</code> return <code><a href="base.html#topic+stop">stop</a></code>
<br />
Operators of groups <code style="white-space: pre;">&#8288;'Math'&#8288;</code>, <code style="white-space: pre;">&#8288;'Ops'&#8288;</code>, <code style="white-space: pre;">&#8288;'Summary'&#8288;</code> return object of class <code>ursaRaster</code>
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>See Also</h3>

<p>Other S3 generic function for local operations of map algebra are <code><a href="#topic+Ops.local_stat">mean</a></code>, <code><a href="#topic+Ops.local_stat">median</a></code>.
<br />
Standard deviation (local) and certain local operations can be extracted using <code><a href="#topic+Ops.local_stat">local_stat</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
session_grid(regrid(mul=1/4))
a1 &lt;- ursa_dummy(nband=3,min=-5*pi,max=5*pi)
print(a1)

try(print(complex1 &lt;- Re(a1)))

print(math1 &lt;- a2 &lt;- round(a1))
print(math1 &lt;- sin(a1))
print(math2 &lt;- floor(a1))
print(math3 &lt;- ceiling(a1))
print(math4 &lt;- cumsum(a1)) ## does this have a sense for rasters?

print(ops1 &lt;- a1-2*rev(a1)+mean(a1))
print(mean(ops1)) ## vanishing
a2 &lt;- ursa_new(value=c(1,2,4),bandname=c("single","double","quadruple"))
print(a2)
print(ops2 &lt;- a2[1]==a2[2])
print(ops3 &lt;- a2[1]==a2[2]/2)
print(ops4 &lt;- a1&gt;0)
print(a1[a1&gt;0])

print(sum1 &lt;- sum(a1))
print(sum2 &lt;- range(a1))
</code></pre>

<hr>
<h2 id='head'>
Extract first and last bands of raster image
</h2><span id='topic+head.ursaRaster'></span><span id='topic+tail.ursaRaster'></span><span id='topic+series'></span>

<h3>Description</h3>

<p>Functions to extract first bands (<code>head</code>), last bands (<code>tail</code>) and first+last bands (<code>series</code>) of raster image.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaRaster'
head(x, n = 3L, ...)

## S3 method for class 'ursaRaster'
tail(x, n = 3L, ...)

series(x, n = 3L, s=170, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="head_+3A_x">x</code></td>
<td>

<p>Object of class <code>ursaRaster</code>
</p>
</td></tr>
<tr><td><code id="head_+3A_n">n</code></td>
<td>

<p>Positive integer. Number of extracted bands.
</p>
</td></tr>
<tr><td><code id="head_+3A_s">s</code></td>
<td>

<p>Positive numeric. Maximal size of memory in MB for extracted raster image in the assumption that class of values is <code><a href="base.html#topic+numeric">numeric</a></code>.
</p>
</td></tr>
<tr><td><code id="head_+3A_...">...</code></td>
<td>

<p>Not used.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function <code>series</code> combines consequtive calling <code>head(x); tail(x)</code> with checking the size of extracted part of raster image. If size exceeds specified value of the argument <code>s</code>, then number of extracted bands <code>n</code> is decreased.
</p>


<h3>Value</h3>

<p>Object of class <code>ursaRaster</code>
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
session_grid(regrid(mul=1/8))
a &lt;- ursa_dummy(nband=101)
print(head(a))
print(tail(a))
print(series(a,2))
print(series(a[1:5]))
</code></pre>

<hr>
<h2 id='hist'>
Histogram of raster image
</h2><span id='topic+ursa_hist'></span><span id='topic+hist.ursaRaster'></span><span id='topic+histogram'></span>

<h3>Description</h3>

<p>Two functions for manipulation with histograms. In function <code>hist</code> values of <code>ursaRaster</code> objects are passed to generic function <code><a href="graphics.html#topic+hist">hist</a></code>, which allows compute and optionally plot histograms. Other function, <code>histogram</code>, plots histogram in the graphical device <code><a href="grDevices.html#topic+png">png</a></code> directly.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaRaster'
hist(x, ...)

ursa_hist(obj, width = 800, height = 600, ...)
histogram(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hist_+3A_obj">obj</code>, <code id="hist_+3A_x">x</code></td>
<td>

<p>Object of class <code>ursaRaster</code>
</p>
</td></tr>
<tr><td><code id="hist_+3A_width">width</code></td>
<td>

<p>Positive integer. Width of histogram's panel.
</p>
</td></tr>
<tr><td><code id="hist_+3A_height">height</code></td>
<td>

<p>Positive integer. Height of histogram's panel.
</p>
</td></tr>
<tr><td><code id="hist_+3A_...">...</code></td>
<td>

<p>Other arguments, which are passed to <code><a href="#topic+colorize">colorize</a></code> and <code><a href="#topic+compose_open">compose_open</a></code> functions.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>histogram</code> is synonym of <code>ursa_hist</code>.
</p>
<p>Function <code>hist</code> for <code>ursaRaster</code> object is defined as <code>hist(ursa_value(obj),...)</code>.
<br />
In the function <code>histogram</code> each bin corresponds to category. The image splitting to categories is realized via <code><a href="#topic+colorize">colorize</a></code> function. The panel of plotting is constucted using artificial coordinate system without geographical projection. The purpose of <code><a href="#topic+compose_open">compose_open</a></code> function is prepare layout for plotting raster images; in the case of histogram, the purpose of this function is prepare layout for plotting histogram
</p>


<h3>Value</h3>

<p>Function <code>histogram</code> returns <code>0L</code>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+colorize">colorize</a></code> is used to define histogram bins.
<br />
<code><a href="#topic+compose_open">compose_open</a></code> prepares panel for histogram plotting.
<br />
<code><a href="graphics.html#topic+hist">hist</a></code> computes and plots histograms.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- pixelsize()
hist(a)
histogram(a,breaks=21)
</code></pre>

<hr>
<h2 id='identify'>
Get value and coordinates from location
</h2><span id='topic+value_xy'></span><span id='topic+value_cr'></span><span id='topic+value_ll'></span><span id='topic+coord_xy'></span><span id='topic+coord_cr'></span>

<h3>Description</h3>

<p>Functions to extract values of raster image from given location, specified by coordinates in raster projection, by cell position or by geogpaphical coordinates. Additional utils to convert cell position and planar coordinates mutually.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>value_xy(obj, ...)

value_ll(obj, ...)

value_cr(obj, ...)

coord_xy(obj, ...)

coord_cr(obj, ...)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="identify_+3A_obj">obj</code></td>
<td>

<p>Object of class <code>ursaRaster</code>.
</p>
</td></tr>
<tr><td><code id="identify_+3A_...">...</code></td>
<td>
<p>the set of arguments, which are recognized via their names (using <a href="base.html#topic+regex">regular expressions</a>) and classes:
</p>

<table>
<tr>
 <td style="text-align: left;">
          <em>Matched pattern</em> </td><td style="text-align: left;"> <em>Function</em> </td><td style="text-align: left;"> <em>Used name</em>
          
          </td>
</tr>
<tr>
 <td style="text-align: left;"><code>ind</code> </td><td style="text-align: left;"> <code>*_*</code> </td><td style="text-align: left;"> <code>ind</code> </td><td style="text-align: left;">
          Index (positive <code>integer</code>) in internal value storage.
          </td>
</tr>
<tr>
 <td style="text-align: left;"><code>^c</code> </td><td style="text-align: left;"> <code>*_cr</code> </td><td style="text-align: left;"> <code>col</code> </td><td style="text-align: left;">
          Integer of non-zero length. Index of column/sample Length of column and row indices should be the same for creating set of two-dimension coordinates.</td>
</tr>
<tr>
 <td style="text-align: left;">
          </td>
</tr>
<tr>
 <td style="text-align: left;"><code>^r</code> </td><td style="text-align: left;"> <code>*_cr</code> </td><td style="text-align: left;"> <code>row</code> </td><td style="text-align: left;">
          Integer of non-zero length. Index of row/line. Length of column and row indices should be the same for creating set of two-dimension coordinates.
          </td>
</tr>
<tr>
 <td style="text-align: left;"><code>^x</code> </td><td style="text-align: left;"> <code>*_xy</code> </td><td style="text-align: left;"> <code>x</code> </td><td style="text-align: left;">
          Numeric of non-zero length. X-axis coordinate in grid of <code>obj</code>. The length of X-axis and Y-axis coordinates should be the same for creating set of two-dimension coordinates.
          </td>
</tr>
<tr>
 <td style="text-align: left;"><code>^y</code> </td><td style="text-align: left;"> <code>*_xy</code> </td><td style="text-align: left;"> <code>y</code> </td><td style="text-align: left;">
          Numeric of non-zero length. Y-axis coordinate in grid of <code>obj</code>. The length of X-axis and Y-axis coordinates should be the same for creating set of two-dimension coordinates.
          </td>
</tr>
<tr>
 <td style="text-align: left;"><code>^lon</code> </td><td style="text-align: left;"> <code>value_ll</code> </td><td style="text-align: left;"> <code>lon</code>  </td><td style="text-align: left;">
          Longitude. The length of longitudes and latitudes should be the same for creating set of two-dimension coordinates.
          </td>
</tr>
<tr>
 <td style="text-align: left;"><code>^lat</code> </td><td style="text-align: left;"> <code>value_ll</code> </td><td style="text-align: left;"> <code>lat</code> </td><td style="text-align: left;">
          Latitude. The length of longitudes and latitudes should be the same for creating set of two-dimension coordinates.
      </td>
</tr>

</table>

</td></tr>
</table>


<h3>Details</h3>

<p><code>value_xy</code> returns values for location, which is specified by planar coordinates (x, y).<br />
<code>value_cr</code> returns values for location, which is specified by cell posisition (column, row) relative to upper-left corner of image .<br />
<code>value_ll</code> returns values for location, which is specified by longitude and latitude (long, lat).
</p>
<p><code>coord_xy</code> transforms planar coordinates (x, y) to cell position (column, row).<br />
<code>coord_cr</code> transforms cell position (column, row) to planar coordinates (x, y).
</p>
<p>It is required to use a couple of coordinate vectors: <code>(x, y)</code>, <code>(c, r)</code> or <code>(lon, lat)</code> of the same length. The unary argument is interpreted as index in internal value storage.
</p>
<p>Position in column/row coordinates starts from upper-lever corner. The cell of upper-level corner has (1, 1) coordinates (in <span class="rlang"><b>R</b></span> indices starts from <code>1L</code>), whereas in some GIS the same corner cell has (0, 0) coordinates.
</p>
<p>The column names of returned matrix are character format of index in internal value storage. This index can be specify in any function as argument <code>ind</code> instead of coordinates (planar, geographical, cell position).
</p>


<h3>Value</h3>

<p>For <code>value.*</code> numeric matrix of raster values. Band values for specific coordinates are by column. Set of specific coordinates are by row. <code><a href="base.html#topic+colnames">rownames</a></code> are band names, and <code><a href="base.html#topic+colnames">colnames</a></code> are index in internal value storage.
</p>
<p>For <code>coord.*</code> numeric matrix of coordinates with a vector of couple coordinates, one coordinate per one row. <code><a href="base.html#topic+colnames">rownames</a></code> are returned coordinates, and <code><a href="base.html#topic+colnames">colnames</a></code> are index in internal value storage.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
set.seed(352)
a &lt;- as.integer(ursa_dummy(3,min=0,max=999))
ind &lt;- which(ursa_value(a[1])==890)
print(ind)
msk &lt;- a[1]==890
am &lt;- a[msk]
b &lt;- as.data.frame(am)
b$jx &lt;- b$x+runif(nrow(b),min=-1000,max=1000)
b$jy &lt;- b$y+runif(nrow(b),min=-1000,max=1000)
print(b)
cr1 &lt;- coord_xy(a,x=b$jx,y=b$jy)
cr2 &lt;- coord_xy(a,y=b$y,x=b$x)
cr3 &lt;- coord_xy(a,ind=ind)
print(cr1)
print(list('cr1 and cr2'=all.equal(cr1,cr2)
          ,'cr2 and cr3'=all.equal(cr2,cr3)
          ,'cr3 and cr1'=all.equal(cr3,cr1)))
xy1 &lt;- coord_cr(a,c=cr1["c",],r=cr1["r",])
print(xy1)
print(list('in x'=identical(unname(xy1["x",]),b[,"x",drop=TRUE])
          ,'in y'=identical(unname(xy1["y",]),b[,"y",drop=TRUE])))
val1 &lt;- value_xy(a,x=b$jx,y=b$jy)
val2 &lt;- value_xy(a,x=b$x,y=b$y)
val3 &lt;- value_cr(a,ind=ind)
val4 &lt;- value_cr(a,c=cr1["c",],r=cr1["r",])
print(val1)
print(list('val1 and val2'=all.equal(val1,val2)
       ,'val2 and val3'=all.equal(val2,val3)
       ,'val3 and val4'=all.equal(val3,val4)
       ,'val4 and val1'=all.equal(val4,val1)))
ps &lt;- pixelsize()
v &lt;- value_ll(ps,lon=180,lat=70)
print(c('True scale'=v/with(ursa_grid(ps),1e-6*resx*resy)))
</code></pre>

<hr>
<h2 id='ignorevalue'>
Extract and assign &lsquo;nodata&rsquo; value of raster images.
</h2><span id='topic+ignorevalue'></span><span id='topic+ignorevalue+3C-'></span><span id='topic+ursa_nodata'></span><span id='topic+ursa_nodata+3C-'></span>

<h3>Description</h3>

<p>Ignored values (<em>aka</em> 'nodata') are implemented via <code>NA</code> values, and are optional for raster images in memory. However, to avoid ambiguity for data storage, it is desirable to specify ignored value. &ldquo;ENVI .hdr Labelled Raster&rdquo; supports &lsquo;nodata&rsquo; by means of &ldquo;data ignore value&rdquo; field in the header file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ignorevalue(obj)
ursa_nodata(obj)

ignorevalue(obj) &lt;- value
ursa_nodata(obj) &lt;- value
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ignorevalue_+3A_obj">obj</code></td>
<td>

<p><code>ursaRaster</code> object.
</p>
</td></tr>
<tr><td><code id="ignorevalue_+3A_value">value</code></td>
<td>

<p>Integer of numeric of length one. Ignored (&lsquo;nodata&rsquo;) value.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>ursa_nodata</code> is synonym to <code>ignorevalue</code> for both <em>Extract</em> and <em>Replace</em> methods.
</p>
<p>The &lsquo;nodata&rsquo; value of raster image <code>obj</code> is specified in the item <code>obj$con$nodata</code>.
</p>
<p>If values of raster image are in memory then <em>replace</em> function <code>ignorevalue&lt;-</code> also changes &lsquo;nodata&rsquo; values to <code>NA</code> values.
</p>


<h3>Value</h3>

<p><em>Extract</em> function <code>ignorevalue</code> returns value of <code>$con$nodata</code> item of <code>ursaRaster</code> object.
</p>
<p><em>Replace</em> function <code>ignorevalue&lt;-</code> returns <code>ursaRaster</code> with modified <code>$con$nodata</code> item.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- round(ursa_dummy(nband=1,min=0.500001,max=4.499999))
print(a)
print(as.table(a))
print(ignorevalue(a))
ignorevalue(a) &lt;- NA
print(as.table(a))
print(ignorevalue(a))
ignorevalue(a) &lt;- 4
print(as.table(a))
print(ignorevalue(a))
print(a)
</code></pre>

<hr>
<h2 id='is.na'>
&lsquo;No data&rsquo; values for raster images.
</h2><span id='topic+is.na.ursaRaster'></span><span id='topic+is.infinite.ursaRaster'></span><span id='topic+is.nan.ursaRaster'></span><span id='topic+is.na+3C-.ursaRaster'></span>

<h3>Description</h3>

<p>The &quot;Extract&quot; function <code>is.na</code> creates mask for each band. In this mask value <code>1L</code> corresponds to <code>NA</code> value in the source image, and value <code>NA</code> corresponds non-missing values in the source image. The &quot;Replacement&quot; function <code>is.na&lt;-</code> assigns numerical value for cells with &lsquo;no data&rsquo; value.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaRaster'
is.na(x)

## S3 method for class 'ursaRaster'
is.infinite(x)

## S3 method for class 'ursaRaster'
is.nan(x)

## S3 replacement method for class 'ursaRaster'
is.na(x) &lt;- value
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="is.na_+3A_x">x</code></td>
<td>

<p>Object of class <code>ursaRaster</code>
</p>
</td></tr>
<tr><td><code id="is.na_+3A_value">value</code></td>
<td>

<p>Numeric.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>These functions are corresponded to <em><strong>local</strong></em> operators of map algebra.
</p>


<h3>Value</h3>

<p>&quot;Extract&quot; functions <code>is.na</code>, <code>is.infinite</code>, <code>is.nan</code> return object of class <code>ursaRaster</code>.
</p>
<p>&quot;Replacement&quot; function <code>is.na&lt;-</code> modifies object of class <code>ursaRaster</code>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
session_grid(regrid(mul=1/4))
a &lt;- ursa_dummy(nband=2,min=0,max=100)
print(a)
print(is.na(a))
a2 &lt;- ursa_new(nband=2)
print(a2)
print(is.na(a2))
a3 &lt;- a
a3[a3&lt;30 | a3&gt;70] &lt;- NA
print(a3)
print(is.na(a3))
is.na(a3) &lt;- 200
print(a3)
</code></pre>

<hr>
<h2 id='legend_align'>
Align caption position for legend
</h2><span id='topic+legend_align'></span>

<h3>Description</h3>

<p>When multiple panels on the same axis, the different order of values or different units of values may provoke different shifting of values and caption from panels. <code>legend_align</code> repairs it by the taking names of classes of the required rasters. The function output is for argument <code>aling</code> of <code><a href="#topic+legend_colorbar">legend_colorbar</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>legend_align(obj)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="legend_align_+3A_obj">obj</code></td>
<td>

<p>Object of class <code>ursaColorTable</code>, or object of class <code>ursaRaster</code>, or list of <code>ursaColorTable</code> or <code>ursaRaster</code> objects.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function is defined as:</p>
<pre>
   c(unlist(sapply(obj,function(x) names(ursa_colortable(x)))))</pre>


<h3>Value</h3>

<p>Character vector.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+legend_colorbar">legend_colorbar</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- ursa_dummy(5,mul=1/4,min=-150,max=200)
a[1] &lt;- a[1]*100
a[2] &lt;- -a[2]*10
a[3] &lt;- a[3]/10
a[4] &lt;- a[4]/1000
b &lt;- lapply(a,colorize)
la.top &lt;- legend_align(b[c(1,2)])
la.left &lt;- legend_align(c(b[[1]],b[[3]]))
la.bottom &lt;- legend_align(b[c(3,4)])
la.right &lt;- legend_align(b[c(2,4)])
leg &lt;- vector("list",12)
leg[[1]] &lt;- list("top",2)
leg[[2]] &lt;- list("top",3)
leg[[3]] &lt;- list("bottom",1)
leg[[4]] &lt;- list("bottom",2)
leg[[5]] &lt;- list(2,"left")
leg[[6]] &lt;- list(1,"right")
leg[[7]] &lt;- list(3,"left")
leg[[8]] &lt;- list(2,"right")
leg[[9]] &lt;- list("top",1)
leg[[10]] &lt;- list("bottom",3)
leg[[11]] &lt;- list(1,"left")
leg[[12]] &lt;- list(3,"right")
cl &lt;- compose_design(layout=c(3,3),legend=leg,byrow=TRUE,skip=5)
print(cl)
compose_open(cl)
ct &lt;- compose_panel(b[c(5,1,2,1,4,3,4,5)],decor=FALSE)
L &lt;- 2
Tr &lt;- 2
legend_colorbar(b[1],trim=Tr,las=L,align=la.top,units="top aligned ---&gt;")
legend_colorbar(b[2],trim=Tr,las=L,align=la.top,units="&lt;--- top aligned")
legend_colorbar(b[3],trim=Tr,las=L,align=la.bottom,units="bottom aligned ---&gt;")
legend_colorbar(b[4],trim=Tr,las=L,align=la.bottom,units="&lt;--- bottom aligned")
legend_colorbar(b[1],trim=Tr,las=L,align=la.left,units="&lt;--- left aligned")
legend_colorbar(b[2],trim=Tr,las=L,align=la.right,units="&lt;--- right aligned")
legend_colorbar(b[3],trim=Tr,las=L,align=la.left,units="left aligned ---&gt;")
legend_colorbar(b[4],trim=Tr,las=L,align=la.right,units="right aligned ---&gt;")
legend_colorbar(b[5],trim=Tr,las=L,units=" *** not aligned ***")
legend_colorbar(b[5],trim=Tr,las=L,units=" *** not aligned ***")
legend_colorbar(b[5],trim=Tr,las=L,units=" *** not aligned ***")
legend_colorbar(b[5],trim=Tr,las=L,units=" *** not aligned ***")
compose_close()
</code></pre>

<hr>
<h2 id='legend_colorbar'>
Plot colorbar
</h2><span id='topic+legend_colorbar'></span><span id='topic+.legend_colorbar'></span>

<h3>Description</h3>

<p>Functions draw single color bar outside of maps panels. <code>legend_colorbar</code> (without prefix dot) is a wrapper for non-public <code>.legend_colorbar</code> (with prefix dot)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>legend_colorbar(...)

## non-public
.legend_colorbar(ct, units = "", labels = NA, align = NULL, shift = 1, cex = 1,
                 adj = NA, las = 1, forceLabel = FALSE, lomar = 0, himar = 0,
                 turn = FALSE, useRaster = NA, trim = 0L, abbrev = 24L,
                 opacity = NA, verbose = FALSE)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="legend_colorbar_+3A_...">...</code></td>
<td>
<p>Set of arguments, which are recognized via their names (using <a href="base.html#topic+regex">regular expressions</a>) and classes.  Passed to non-public <code>.legend_colorbar</code>, excepting argument <code>colorbar</code>:
</p>

<table>
<tr>
 <td style="text-align: left;">
      <em>Matched pattern</em> (<code>legend_colorbar</code>) </td><td style="text-align: left;"> <em>Argument</em> (<code>.legend_colorbar</code>) </td><td style="text-align: left;"> <em>Description</em>
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>colorbar</code> </td><td style="text-align: left;"> </td><td style="text-align: left;"> Prefix for indirect use (e.g., in <code><a href="#topic+display">display</a></code>). Separated by a dot <code>"."</code>, e.g., <code>colorbar.units="mbar"</code>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(ct)*</code> </td><td style="text-align: left;"> <code>ct</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>unit(s)*</code> </td><td style="text-align: left;"> <code>units</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>labels</code> </td><td style="text-align: left;"> <code>labels</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>align</code> </td><td style="text-align: left;"> <code>align</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>shift</code> </td><td style="text-align: left;"> <code>shift</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>cex</code> </td><td style="text-align: left;"> <code>cex</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>adj</code> </td><td style="text-align: left;"> <code>adj</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>las</code> </td><td style="text-align: left;"> <code>las</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>forceLabel</code> </td><td style="text-align: left;"> <code>forceLabel</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>lomar</code> </td><td style="text-align: left;"> <code>lomar</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>himar</code> </td><td style="text-align: left;"> <code>himar</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>turn</code> </td><td style="text-align: left;"> <code>turn</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>useRaster</code> </td><td style="text-align: left;"> <code>useRaster</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>trim</code> </td><td style="text-align: left;"> <code>trim</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>abbrev</code> </td><td style="text-align: left;"> <code>abbrev</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>opacity</code> </td><td style="text-align: left;"> <code>opacity</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>verb(ose)*</code> </td><td style="text-align: left;"> <code>verbose</code> </td><td style="text-align: left;"> <em>See below</em>.
   </td>
</tr>

</table>

</td></tr>
<tr><td><code id="legend_colorbar_+3A_ct">ct</code></td>
<td>

<p><code>ursaRaster</code> object with color table or object of class <code>ursaColorTable</code>. First argument in <code>legend_colorbar</code>; name can be omitted.
</p>
</td></tr>
<tr><td><code id="legend_colorbar_+3A_units">units</code></td>
<td>

<p>Argument of class <code>character</code> or <code>expression</code> with matching name <code>"unit(s)*"</code> in <code>legend_colorbar</code>. Text, which is used as a caption for color bars. If <code>character</code> then caption is displayed in bold. Default is <code>""</code>: no caption.
</p>
</td></tr>
<tr><td><code id="legend_colorbar_+3A_labels">labels</code></td>
<td>

<p>Argument of class <code>integer</code> or <code>character</code> with matching name <code>"labels"</code> in <code>legend_colorbar</code>. If <code>labels</code> is vector of length 1, then it is number of labels at the color bar, else vector of specified values. Default is <code>NA</code>: it means 11 labels for numerical values and 31 labels for categorical values, but this number can be reduced for perpendicular orientation to the axes to prevent label overlapping.</p>
</td></tr>
<tr><td><code id="legend_colorbar_+3A_align">align</code></td>
<td>

<p>Argument of class <code>numeric</code> with matching name <code>"align"</code> in <code>legend_colorbar</code>. The indent for right alignment of labels. May be useful, if two or more color bars are located on the same side, but with different units and order of values. Can be specified by the string of maximal length or via <code><a href="#topic+legend_align">legend_align</a></code>. Default is <code>NULL</code>: right alignment of each color bar is independent.</p>
</td></tr>
<tr><td><code id="legend_colorbar_+3A_shift">shift</code></td>
<td>

<p>Argument of class <code>numeric</code> with matching name <code>"shift"</code> in <code>legend_colorbar</code>. Multiplier for manual correction of labels alignment in the case when automatical alignment is poor. Default is <code>1</code>: no changes. If <code>shift&lt;1</code> then labels are shifted to the left. If <code>shift&gt;1</code> then labels are shifted to the right.</p>
</td></tr>
<tr><td><code id="legend_colorbar_+3A_cex">cex</code></td>
<td>

<p>Argument of class <code>numeric</code> with matching name <code>"cex"</code> in <code>legend_colorbar</code>. A numerical value giving the amount by which labels should be magnified relative to the default. Default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="legend_colorbar_+3A_adj">adj</code></td>
<td>

<p>Argument of class <code>numeric</code> with matching name <code>"adj"</code> in <code>legend_colorbar</code>. Adjustment for labels. For labels parallel to the axes, <code>adj=0</code> means left or bottom alignment, and <code>adj=1</code> means right or top alignment. Default is <code>NA</code>: for labels parallel to the axes <code>adj=0.5</code>, for labels perpendicular to the axis <code>adj=1</code> for numeric and <code>adj=0</code> for character.</p>
</td></tr>
<tr><td><code id="legend_colorbar_+3A_las">las</code></td>
<td>

<p>Argument of values <code>0, 1, 2, 3</code> with matching name <code>"adj"</code> in <code>legend_colorbar</code>. The correspondence between directions of axis and labels. The same definition as for <code><a href="graphics.html#topic+par">par(las=)</a></code>. Default is <code>1L</code>.</p>
</td></tr>
<tr><td><code id="legend_colorbar_+3A_forcelabel">forceLabel</code></td>
<td>

<p>Argument of class <code>logical</code> with matching name <code>"forceLabel"</code> in <code>legend_colorbar</code>. If <code>TRUE</code> then all labels are plotted regardless their possible overlapping.</p>
</td></tr>
<tr><td><code id="legend_colorbar_+3A_lomar">lomar</code></td>
<td>

<p>Argument of class <code>numeric</code>, non-negative, with matching name <code>"lomar"</code> in <code>legend_colorbar</code>.Relative shifting of the lower (left or bottom) position of colorbar. Default is <code>0</code>: the lower position is corresponded to the limit of panel(s). Positive value decreases length of colorbar.</p>
</td></tr>
<tr><td><code id="legend_colorbar_+3A_himar">himar</code></td>
<td>

<p>Argument of class <code>numeric</code>, non-negative, with matching name <code>"himar"</code> in <code>legend_colorbar</code>. Relative shifting of the higher (right or bottom) position of colorbar. Default is <code>0</code>: the higher position is corresponded to the limit of panel(s). Positive value decreases length of colorbar.</p>
</td></tr>
<tr><td><code id="legend_colorbar_+3A_turn">turn</code></td>
<td>

<p>Argument of class <code>logical</code> with matching name <code>"turn"</code> in <code>legend_colorbar</code>. Default is <code>FALSE</code>: lower value is on left or bottom, higher value is on right or top. If <code>turn=TRUE</code>, then opposite order.</p>
</td></tr>
<tr><td><code id="legend_colorbar_+3A_useraster">useRaster</code></td>
<td>

<p>Argument of class <code>logical</code> with matching name <code>"useRaster"</code> in <code>legend_colorbar</code>. Passed as argument <code>useRaster</code> to function <code><a href="graphics.html#topic+image">image</a></code>. Default is <code>NA</code>, which is interpreted as <code>TRUE</code> for &quot;cairo&quot; graphical device and as <code>FALSE</code> for &quot;windows&quot; graphical device (see description of argument <code>type</code> in <code><a href="grDevices.html#topic+png">png</a></code>).</p>
</td></tr>
<tr><td><code id="legend_colorbar_+3A_trim">trim</code></td>
<td>

<p>Argument of values <code>0L, 1L, 2L</code> with matching name <code>"trim"</code> in <code>legend_colorbar</code>. Determines behaviour for plotting marginal labels. If <code>0L</code>, then marginal labels are displayed as is. If <code>1L</code>, then marginal labels are shifted inside of color bar to prevent their outcrop to the panel(s) limits. If <code>2L</code> then outctopped labels are not displayed.</p>
</td></tr>
<tr><td><code id="legend_colorbar_+3A_abbrev">abbrev</code></td>
<td>

<p>Argument of class <code>integer</code> or <code>logical</code> with matching name <code>"abbrev"</code> in <code>legend_colorbar</code>. <code>TRUE</code> is interpreted as default value. <code>FALSE</code> is interpreted as <code>0L</code>. If positive, then labels are abbreviated, and this argument is passed as argument <code>minlength</code> to function <code><a href="base.html#topic+abbreviate">abbreviate</a></code>: <code>abbreviate(label, minlength=abbrev, strict=TRUE)</code>. If abbreviation is failed (e.g., non-ASCII symbols), the <code><a href="base.html#topic+subset">subset</a></code> is applied. 
</p>
</td></tr>
<tr><td><code id="legend_colorbar_+3A_opacity">opacity</code></td>
<td>

<p>Argument of class <code>integer</code> or <code>logical</code> with matching name <code>"abbrev"</code> in <code>legend_colorbar</code>. Responses for shading of color bar. If <code>FALSE</code> or <code>0</code>, then no shading. If <code>TRUE</code> or <code>1</code>, then shading is forced. Default is <code>NA</code>; if semi-transparence is detected, then shading is applied.
</p>
</td></tr>
<tr><td><code id="legend_colorbar_+3A_verbose">verbose</code></td>
<td>
<p>Argument of class <code>logical</code> with matching name <code>"verb(ose)*"</code> in <code>legend_colorbar</code>. Value <code>TRUE</code> may provide some additional information on console. Default is <code>FALSE</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>units</code> are <code>expression</code>, then possible way for formatting is:</p>
<pre>
units=as.expression(substitute(bold(degree*C)))
</pre>


<h3>Value</h3>

<p><code>NULL</code>
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
display(ursa_dummy(1),units="Required 99 labels; displayed less"
        ,colorbar.labels=99,las=3,gridline.trim=FALSE,colorbar.trim=1L)
cname &lt;- c("Apple","Orange","Cherry","Blueberry","Strawberry","Currant")
a &lt;- ursa_dummy(4)
b &lt;- list(colorize(a[1],value=seq(50,200,length=length(cname))
                  ,name=cname)#,stretch="category")
         ,colorize(a[2]*10,ramp=FALSE),colorize(a[3]*100),colorize(a[4]/10))
la &lt;- legend_align(b[3:4])
leg &lt;- vector("list",10)
leg[[1]] &lt;- list(1,"left")
leg[[2]] &lt;- list(1,"right")
for (i in seq(4)) {
   leg[[i+2]] &lt;- list("top",i)
   leg[[i+6]] &lt;- list("bottom",i)
}
compose_open(layout=c(1,4),legend=leg,scale=NA,dev=FALSE) # use 'dev=TRUE' to check layout
compose_panel(b)
legend_colorbar(b[[1]],lomar=20,himar=0) ## "left"
legend_colorbar(b[[4]],labels=c(6,7.5,12,15,20)
               ,units="Manual set of labels") ## "right"
legend_colorbar(b[[1]],las=2,adj=0.5,turn=TRUE,lomar=6,himar=6
               ,units="Central adjustment; inverse order") ## ("top",1)
legend_colorbar(b[[2]],cex=0.9
               ,units="Horizontal labels can be overlapped") ## ("top",2)
legend_colorbar(b[[3]],las=3,align=la
               ,units="Increased width, but aligned --&gt;") ## ("top",3)
legend_colorbar(b[[4]],las=3,align=la,labels=3
               ,units="&lt;-- Reduced width, but aligned") ## ("top",4)
legend_colorbar(b[[1]],las=2,adj=0,shift=0.9,turn=FALSE,lomar=2,himar=10
               ,units="Left adjustement. Non-optimal; shifted") ## ("bottom",1)
legend_colorbar(b[[2]],las=3,adj=0
               ,units="But right adj. is default for numeric") ## ("bottom",2)
legend_colorbar(b[[3]],labels=99,las=3,trim=2L
               ,units="Required 99 labels, but displayed less") ## ("bottom",3)
legend_colorbar('Caption from named item'=b[[4]],labels=99) ## ("bottom",4)
compose_close()
</code></pre>

<hr>
<h2 id='legend_mtext'>
Write marginal text
</h2><span id='topic+legend_mtext'></span><span id='topic+.legend_mtext'></span>

<h3>Description</h3>

<p>Functions write text outside of maps panels. <code>legend_mtext</code> (without prefix dot) is a wrapper for non-public <code>.legend_mtext</code> (with prefix dot).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>legend_mtext(...)

## non-public
.legend_mtext(text = "Annotation", cex = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="legend_mtext_+3A_...">...</code></td>
<td>
<p>Set of arguments, which are recognized via their names (using <a href="base.html#topic+regex">regular expressions</a>) and classes.  Passed to non-public <code>.legend_mtext</code>, excepting argument <code>mtext</code>:
</p>

<dl>
<dt><code>mtext</code></dt><dd><p>Prefix for indirect use (e.g., in <code><a href="#topic+compose_legend">compose_legend</a></code>). Separated by a dot <code>"."</code>, e.g., <code>mtext.cex=0.85</code>.</p>
</dd>
</dl>


<table>
<tr>
 <td style="text-align: left;">
      <em>Matched pattern</em> (<code>legend_colorbar</code>) </td><td style="text-align: left;"> <em>Argument</em> (<code>.legend_colorbar</code>) </td><td style="text-align: left;"> <em>Description</em>
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>mtext</code> </td><td style="text-align: left;"> </td><td style="text-align: left;"> Prefix for indirect use (e.g., in <code><a href="#topic+compose_legend">compose_legend</a></code>). Separated by a dot <code>"."</code>, e.g., <code>mtext.cex=0.85</code>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>text</code> </td><td style="text-align: left;"> <code>text</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>cex</code> </td><td style="text-align: left;"> <code>cex</code> </td><td style="text-align: left;"> <em>See below</em>.
   </td>
</tr>

</table>

</td></tr>
<tr><td><code id="legend_mtext_+3A_text">text</code></td>
<td>

<p>Argument of class <code>character</code> or <code>expression</code> with matching name <code>"text"</code> (or without name) in <code>legend_mtext</code>. Text, which is displayed. If <code>character</code> then text is displayed in bold. Default is <code>"Title/subtitle"</code>.
</p>
</td></tr>
<tr><td><code id="legend_mtext_+3A_cex">cex</code></td>
<td>

<p>Argument of class <code>numeric</code> with matching name <code>"cex"</code> in <code>legend_mtext</code>. A numerical value giving the amount by which labels should be magnified relative to the default. Default is <code>1</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>text</code> is <code>expression</code>, then possible way for formatting is:</p>
<pre>
text=as.expression(substitute(bold(italic("Omega powered by alpha is ",Omega^alpha))))</pre>


<h3>Value</h3>

<p>Returned value of function <code><a href="graphics.html#topic+mtext">mtext</a></code> from package <span class="pkg">graphics</span>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+compose_legend">compose_legend</a></code><br />
<code><a href="#topic+legend_colorbar">legend_colorbar</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- ursa_dummy(1,min=-10,max=+30)
compose_open(legend=list("right","top","bottom","left"))
panel_new()
ct &lt;- panel_raster(a)
legend_colorbar(ct)#,units=as.expression(substitute(bold(degree*C))))
legend_mtext("Characters are in bold")
legend_mtext(as.expression(substitute(italic(
            paste("Units can be interpreted as",~degree*C)))),cex=0.7)
legend_mtext(text=as.expression(substitute(italic(paste("Omega powered by alpha is"
                                                       ,~~Omega^alpha)))))
compose_close(execute=!FALSE)
</code></pre>

<hr>
<h2 id='local_group'>
Create single-band raster using statistics of multi-bands raster.
</h2><span id='topic+local_mean'></span><span id='topic+local_sum'></span><span id='topic+local_median'></span><span id='topic+local_quantile'></span><span id='topic+local_min'></span><span id='topic+local_max'></span><span id='topic+local_sd'></span><span id='topic+local_var'></span><span id='topic+local_all'></span><span id='topic+local_any'></span><span id='topic+local_length'></span><span id='topic+mean.ursaRaster'></span><span id='topic+median.ursaRaster'></span><span id='topic+quantile.ursaRaster'></span><span id='topic+.average'></span>

<h3>Description</h3>

<p>Local operations (mean value, sum of values, median, minimum, maximum) of map algebra for multi-bands <code>ursaRaster</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>local_mean(x, cover = 0.5 - 1e-3, weight = NULL, verbose = FALSE, bandname = "mean")
local_sum(x, cover = 0.5 - 1e-3, weight = NULL, verbose = FALSE, bandname = "sum")
local_median(x, cover = 0.5 - 1e-3, verbose = FALSE)
local_min(x, cover = 0.5 - 1e-3, verbose = FALSE)
local_max(x, cover = 0.5 - 1e-3, verbose = FALSE)
local_sd(x, cover = 0.5 - 1e-3, verbose = FALSE)
local_var(x, cover = 0.5 - 1e-3, verbose = FALSE)
local_quantile(x, probs = seq(0, 1, 0.25), type = 7, cover = 0.5 - 1e-3, verbose = FALSE)

## S3 method for class 'ursaRaster'
mean(x, ...)

## S3 method for class 'ursaRaster'
median(x, ...)

## S3 method for class 'ursaRaster'
quantile(x, ...)

# non public
.average(x, cover = 0.5 - 1e-3, weight = NULL, sum = FALSE, verbose = FALSE)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="local_group_+3A_x">x</code></td>
<td>

<p><code>ursaRaster</code> object. In function <code>local_mean</code> and <code>local_sum</code> it is allowed to specify array with 3 dimensions (col, row, band) or (row, col, band)
</p>
</td></tr>
<tr><td><code id="local_group_+3A_cover">cover</code></td>
<td>

<p>Numeric. <code>0&lt;=cover&lt;=1</code> or <code>&gt;1</code>. Quota for <code>NA</code> values in the location for all bands. Quota exceeding leads to recording <code>NA</code> value in the created map. If <code>code&gt;1</code> then number of bands. If <code>0&lt;=cover&lt;=1</code> then proportion <code>cover</code> to number of bands.
</p>
</td></tr>
<tr><td><code id="local_group_+3A_weight">weight</code></td>
<td>

<p>Positive numeric of length equal to number of bands. For <code>local_mean</code> and <code>local_sum</code> only. If specified, then weighted mean or sum are applied. The prior normalization is not required.
</p>
</td></tr>
<tr><td><code id="local_group_+3A_sum">sum</code></td>
<td>

<p>Logical. For <code>.average</code> only. If <code>sum=TRUE</code> then fuction returns sum of values else mean value.
</p>
</td></tr>
<tr><td><code id="local_group_+3A_probs">probs</code></td>
<td>

<p>Numeric. For <code>local_quantile</code> only. Argument <code>probs</code>, which is passed as argument <code>probs</code> to generic function <code><a href="stats.html#topic+quantile">quantile</a>()</code>.
</p>
</td></tr>
<tr><td><code id="local_group_+3A_type">type</code></td>
<td>

<p>Numeric. For <code>local_quantile</code> only. Argument <code>type</code>, which is passed as argument <code>probs</code> to generic function <code><a href="stats.html#topic+quantile">quantile</a>()</code>.
</p>
</td></tr>
<tr><td><code id="local_group_+3A_verbose">verbose</code></td>
<td>

<p>Logical. If <code>verbose=TRUE</code> then some output appears in console. Used for debug and benchark.
</p>
</td></tr>
<tr><td><code id="local_group_+3A_bandname">bandname</code></td>
<td>

<p>Character. Band name for created single-band image.
</p>
</td></tr>
<tr><td><code id="local_group_+3A_...">...</code></td>
<td>

<p>Function <code>mean</code> - arguments, which are passed to <code>local_mean()</code>.
<br />
Function <code>median</code> - arguments, which are passed to <code>local_median()</code>.
<br />
Function <code>quantile</code> - arguments, which are passed to <code>local_quantile()</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If for valid output cell value it is required to have at least <code>m</code> values not marked as <code>NA</code>, specify quota as <code>cover=m/nband(x)</code>.
</p>
<p><code>local_mean</code> and <code>local_sum</code> are wrapper to non-public function <code>.average</code>.
</p>
<p>Generic functions <code>mean</code>, <code>median</code>, <code>sd</code> for <code>ursaRaster</code> class are implemented via <code>local_mean</code>, <code>local_median</code>, <code>local_sd</code>, respectively. 
</p>


<h3>Value</h3>

<p>Double-band <code>ursaRaster</code> object for <code>local_range()</code>.
<br />
Multi-band <code>ursaRaster</code> object for <code>local_quantile()</code>.
<br />
Otherwise, single-band <code>ursaRaster</code> object. 
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>See Also</h3>

<p>If bands are interpreted as time series, apply <code><a href="#topic+Ops.local_stat">local_stat</a></code>
</p>
<p>Mean value for image brick <code><a href="#topic+Ops.global_group">global_mean</a></code>
</p>
<p>Mean value for each band <code><a href="#topic+Ops.band_group">band_mean</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
b &lt;- ursa_dummy(nband=7,min=0,max=100,mul=1/16)
b[b&lt;40] &lt;- NA
print(b)
res &lt;- c('mean'=mean(b),'local_mean'=local_mean(b)
        ,'sum0'=local_sum(b,cover=0),'sum1'=local_sum(b,cover=1))
print(res)

display(b)
display(res)

</code></pre>

<hr>
<h2 id='local_stat'>
Bundle of statistics, which is applied to each cell of multi-band image.
</h2><span id='topic+local_stat'></span>

<h3>Description</h3>

<p>If bands of <code>ursaRaster</code> object are interpreted as observations in time, then <code>local_stat</code> returns some parameters for time-series analysis. This is a <b>local</b> operation of map algebra.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>local_stat(obj, time = NULL, cover = 1e-06, smooth = FALSE, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="local_stat_+3A_obj">obj</code></td>
<td>

<p>Object of class <code>ursaRaster</code>
</p>
</td></tr>
<tr><td><code id="local_stat_+3A_time">time</code></td>
<td>

<p>Numeric or <code>NULL</code>. If <code>NULL</code> then regression parameters are for regular time-series using position of band in the brick (or, <code>time=seq(obj)</code>). If numeric, then length of <code>time</code> should be equal to number of bands of <code>obj</code>, and <code>time</code> is used to set irregularity for time-series.
</p>
</td></tr>
<tr><td><code id="local_stat_+3A_cover">cover</code></td>
<td>

<p>Numeric. <code>0&lt;=cover&lt;=1</code> or <code>&gt;1</code>. Quota for <code>NA</code> values in the location for all bands. Quota exceeding leads to recording <code>NA</code> value in the cell of created band. If <code>code&gt;1</code> then number of bands. If <code>0&lt;=cover&lt;=1</code> then proportion <code>cover</code> to number of bands. Default is <code>1e-6</code>.
</p>
</td></tr>
<tr><td><code id="local_stat_+3A_smooth">smooth</code></td>
<td>

<p>Logical. If <code>TRUE</code> then <a href="#topic+Ops.focal_median">median</a> focal smoothing is applying to created 'slope' band; it is more suitable for visualization. Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="local_stat_+3A_verbose">verbose</code></td>
<td>

<p>Logical. Value <code>TRUE</code> provides some additional information on console. Default is <code>FALSE</code>.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Object of class <code>ursaRaster</code> with bands:
</p>
<table role = "presentation">
<tr><td><code>mean</code></td>
<td>
<p>Mean value in each cell across all bands of source raster.</p>
</td></tr>
<tr><td><code>sd</code></td>
<td>
<p>Standard deviation in each cell across all bands of source raster.  Denominator is <code>n</code>. </p>
</td></tr>
<tr><td><code>sum</code></td>
<td>
<p>Sum value in each cell across all bands of source raster.</p>
</td></tr>
<tr><td><code>min</code></td>
<td>
<p>Minimal value in each cell across all bands of source raster.</p>
</td></tr>
<tr><td><code>max</code></td>
<td>
<p>Maximal value in each cell across all bands of source raster.</p>
</td></tr>
<tr><td><code>n</code></td>
<td>
<p>Number of non-<code>NA</code> values in each cell across all bands of source raster (number of observations).</p>
</td></tr>
<tr><td><code>slope</code></td>
<td>
<p>Slope value in each cell across all bands of source raster.</p>
</td></tr>
<tr><td><code>slopeS</code></td>
<td>
<p>Significance of slope value taken with a sign of slope.</p>
</td></tr>
<tr><td><code>RSS</code></td>
<td>
<p>Resisual sum of squares.</p>
</td></tr>
<tr><td><code>ESS</code></td>
<td>
<p>Explained sum of squares.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><em><a href="#topic+Ops.local_group">Local</a></em> statistics of map algebra, 
<a href="#topic+classRaster_GroupGeneric">Group</a> generics for objects of class <code>ursaRaster</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
set.seed(353)
session_grid(regrid(mul=1/8))
a &lt;- ursa_dummy(nband=15)
a[a&lt;60] &lt;- NA
cvr &lt;- 12
b &lt;- local_stat(a,cover=cvr)
print(b)
c.mean &lt;- c('&lt;bundle&gt; mean'=b["mean"]
           ,'local_mean'=local_mean(a,cover=cvr)
           ,'&lt;generic&gt; mean'=mean(a,cover=cvr))
c.max &lt;- c('&lt;bundle&gt; max'=b["max"]
          ,'local_max'=local_max(a,cover=cvr)
          ,'&lt;generic&gt; max'=max(a,cover=cvr))
print(c.mean)
print(c.max)
cmp &lt;- c(mean=b["mean"]-local_mean(a,cover=cvr)
        ,sd=b["sd"]-local_sd(a,cover=cvr))
print(round(cmp,12))
d &lt;- as.list(b)
d[["slopeS"]] &lt;- colorize(d[["slopeS"]],stretch="signif")
display(d,blank.density=20,blank.angle=c(-45,45))
</code></pre>

<hr>
<h2 id='na.omit'>
Drop bands which don't have data.
</h2><span id='topic+na.omit.ursaRaster'></span>

<h3>Description</h3>

<p>The bands with <a href="#topic+ursa_blank">band_blank</a> images, are omitted.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaRaster'
na.omit(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="na.omit_+3A_object">object</code></td>
<td>

<p>Object of class <code>ursaRaster</code>.
</p>
</td></tr>
<tr><td><code id="na.omit_+3A_...">...</code></td>
<td>

<p>Ignored. For consistence with definition of generic function.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Object of class <code>ursaRaster</code>, which has no bands without any data.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ursa_blank">band_blank</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
session_grid(regrid(mul=1/4))
a &lt;- ursa_new(value=1:3)
print(a)
a[2] &lt;- NA
print(a)
a2 &lt;- na.omit(a)
print(a2)
</code></pre>

<hr>
<h2 id='nband'>
Get number of bands of raster image.
</h2><span id='topic+nband'></span><span id='topic+length.ursaRaster'></span>

<h3>Description</h3>

<p><code>nband</code> (<code>length</code>) returns number of bands (<em>layers</em>, if appropriate in terminology) of <code>ursaRaster</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nband(x)

## S3 method for class 'ursaRaster'
length(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="nband_+3A_x">x</code></td>
<td>

<p>Object of class <code>ursaRaster</code>
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>length</code> for <code>ursaRaster</code> object is a synonym for <code>nband</code>.
</p>


<h3>Value</h3>

<p>Positive integer of length 1.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+classRaster_names">bandname</a></code> (<code><a href="#topic+classRaster_names">names</a></code> for <code>ursaRaster</code> object).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a1 &lt;- pixelsize()
print(a1)
print(nband(a1))
a2 &lt;- c("Band 1"=a1,Band2=a1/2,sqrt=sqrt(a1),NA)
print(a2)
print(nband(a2))
</code></pre>

<hr>
<h2 id='open_envi'>
open_envi file
</h2><span id='topic+open_envi'></span>

<h3>Description</h3>

<p><code>open_envi</code> creates object of <code>ursaRaster</code> class, reads ENVI header file and prepares <code><a href="base.html#topic+connections">connections</a></code> for ENVI binary file
</p>


<h3>Usage</h3>

<pre><code class='language-R'>open_envi(fname, resetGrid = FALSE, headerOnly = FALSE, decompress = !headerOnly,
          cache = 0L, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="open_envi_+3A_fname">fname</code></td>
<td>

<p>Filename; full-name or short-name
</p>
</td></tr>
<tr><td><code id="open_envi_+3A_resetgrid">resetGrid</code></td>
<td>

<p>Logical. If <code>TRUE</code> then existing base grid (from <code><a href="#topic+session">session_grid</a></code>) will be overwritten. Otherwise the spatial subsetting will be attempted.
</p>
</td></tr>
<tr><td><code id="open_envi_+3A_headeronly">headerOnly</code></td>
<td>

<p>Logical. If <code>TRUE</code> then only reading of ENVI header file without creating connection to binary data; there is no necessary to decompress packed binary in this case. Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="open_envi_+3A_decompress">decompress</code></td>
<td>

<p>If ENVI binary file is compressed and you have not to use ENVI values then put <code>decompress=FALSE</code> to avoid useless operation
</p>
</td></tr>
<tr><td><code id="open_envi_+3A_cache">cache</code></td>
<td>

<p>Integer. Using cache for compressed files. If <code>0L</code> then cache is not used. If <code>1L</code>, then cache is used. Any value, which is differed from <code>0L</code> and <code>1L</code>, resets cache. Default is <code>0L</code>.
</p>
</td></tr>
<tr><td><code id="open_envi_+3A_...">...</code></td>
<td>

<p>If input file does not exists then these additional arguments will be passed to <code><a href="#topic+conn.create_any">create_envi</a></code> function.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>open_envi</code> try to find ENVI files (binary and header) and open them. If unsuccessful then function passes <code>...</code>-arguments to <code><a href="#topic+conn.create_any">create_envi</a></code> function
</p>


<h3>Value</h3>

<p>Returns object of class <code>ursaRaster</code>. Values from ENVI binary are not in memory yet.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a></p>


<h3>See Also</h3>

<p><code><a href="#topic+classRaster_close">close</a></code>, <code><a href="#topic+conn.create_any">create_envi</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- pixelsize()
write_envi(a,"example")
a &lt;- open_envi("example")
dir(pattern="^example.*")
ursa_info(a)
close(a)
rm(a)
envi_remove("example")

## additional arguments are enough to create new ENVI file
dir(pattern="^example.*")
a &lt;- open_envi("example",layername=paste0("test",1:3))
ursa_info(a)
dir(pattern="^example.*")
close(a)
envi_remove("example")
</code></pre>

<hr>
<h2 id='open_gdal'>
Open GDAL file
</h2><span id='topic+open_gdal'></span><span id='topic+ursa_open'></span>

<h3>Description</h3>

<p><code>open_gdal</code> creates object of <code>ursaRaster</code> class, and prepares <code><a href="base.html#topic+connections">connections</a></code> for data reading.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>open_gdal(fname, engine=c("native", "sf", "gdalraster", "vapour"), verbose = FALSE)

ursa_open(fname, verbose = FALSE)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="open_gdal_+3A_fname">fname</code></td>
<td>

<p>Character. Filename; full-name or short-name.
</p>
</td></tr>
<tr><td><code id="open_gdal_+3A_engine">engine</code></td>
<td>

<p>Character. Functionality of which package is used for reading data. This is experimental list, which future depends on evolution of reviewed packages and their availability for partial reading of multiband rasters.
</p>
</td></tr>
<tr><td><code id="open_gdal_+3A_verbose">verbose</code></td>
<td>

<p>Logical. <code>verbose=TRUE</code> provides some additional information on console. Default is <code>FALSE</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>ursa_open</code> is a synonym to <code>open_gdal</code>. <em>Generally, both function names are abridged version of <code style="white-space: pre;">&#8288;ursa_open_dgal&#8288;</code></em>.
</p>
<p><code>open_gdal</code> doesn't read data. Data can be read later using <em><a href="#topic+classRaster.Extract">Extract</a></em> operator <code><a href="#topic+classRaster.Extract">[</a></code>.
</p>
<p>If argument <code>fname</code> is <a href="https://gdal.org/en/latest/drivers/raster/envi.html">ENVI .hdr Labelled Raster</a> then either <code>open_gdal</code> or <code><a href="#topic+conn.open_envi">open_envi</a></code> can be used. The former provides external implementation for data reading via GDAL in <span class="pkg">rgdal</span> package.
</p>


<h3>Value</h3>

<p>Returns object of class <code>ursaRaster</code>. Values are not in memory.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+classRaster_close">close</a></code>, <code><a href="#topic+conn.open_envi">open_envi</a></code>, <code><a href="#topic+conn.read_gdal">read_gdal</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
# fname1 &lt;- system.file("pictures/cea.tif",package="rgdal")
fname1 &lt;- system.file("tif/geomatrix.tif",package="sf")
message(fname1)
a1 &lt;- open_gdal(fname1)
print(a1)
print(a1[])
close(a1)
# fname2 &lt;- system.file("pictures/test_envi_class.envi",package="rgdal")
fname2 &lt;- tempfile(fileext=".")
a &lt;- ursa_dummy(1,resetGrid=TRUE)
b &lt;- colorize(a[a&gt;91],stretch="equal",name=format(Sys.Date()+seq(0,6),"%A %d"))
write_envi(b,fname2)
message(fname2)
b1 &lt;- open_gdal(fname2)
b2 &lt;- open_envi(fname2)
print(b1)
print(b2)
print(c('The same grid?'=identical(ursa_grid(b1),ursa_grid(b2))
       ,'The same data?'=identical(ursa_value(b1[]),ursa_value(b2[]))))
close(b1,b2)
envi_remove(fname2)
</code></pre>

<hr>
<h2 id='panel_annotation'>
Add label or annotation to the image panel.
</h2><span id='topic+panel_annotation'></span><span id='topic+.panel_annotation'></span>

<h3>Description</h3>

<p><code>panel_annotation</code> puts an annotation (text label) on the panel with raster image without anchors to any layer. Can be used as captions to image panels.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>panel_annotation(...)

# non-public
.panel_annotation(label = expression(), position = "bottomright",
                  lon = NA, lat = NA, x = NA, y = NA, cex = 1.0, adjust = 0.5,
                  fg = "#000000", bg = "#FFFFFF1F", buffer = 1, fill = "#FFFFFF7F",
                  font = par("family"), vertical = FALSE, alpha = 1,
                  interpolate = FALSE, resample = FALSE, verbose = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="panel_annotation_+3A_...">...</code></td>
<td>
<p>Set of arguments, which are recognized via their names (using <a href="base.html#topic+regex">regular expressions</a>) and classes:
</p>

<table>
<tr>
 <td style="text-align: left;">
      <em>Matched pattern</em> (<code>panel_annotation</code>) </td><td style="text-align: left;"> <em>Argument</em> (<code>.panel_annotation</code>) </td><td style="text-align: left;"> <em>Description</em>
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>((caption|ann(otation)*)</code> </td><td style="text-align: left;"> </td><td style="text-align: left;"> Logical or integer. Responsible for should annotation be displayed or not. If logical and <code>TRUE</code> then annotations are plotted on all panel of layout. If logical and <code>FALSE</code> then annotation is not displayed. If argument is a vector of positive integers, then annotations are plotted only in the specified panels, which sequence is defined in <code><a href="#topic+compose_design">compose_design</a></code> function and returned from <code>getOption("ursaPngLayout")$layout</code>. Default is <code>TRUE</code>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(label|text)</code> </td><td style="text-align: left;"> <code>label</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>pos(ition)*</code> </td><td style="text-align: left;"> <code>pos</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>lon(gitude)*</code> </td><td style="text-align: left;"> <code>lon</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>lat(itude)*</code> </td><td style="text-align: left;"> <code>lat</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>x$</code> </td><td style="text-align: left;"> <code>x</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>y$</code> </td><td style="text-align: left;"> <code>y</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>cex</code> </td><td style="text-align: left;"> <code>cex</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>adj(ust)*</code> </td><td style="text-align: left;"> <code>adjust</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>fg</code> </td><td style="text-align: left;"> <code>fg</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>bg</code> </td><td style="text-align: left;"> <code>bg</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>buf(fer)*</code> </td><td style="text-align: left;"> <code>buffer</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>fill</code> </td><td style="text-align: left;"> <code>fill</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>font</code> </td><td style="text-align: left;"> <code>font</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>vert(ical)*</code> </td><td style="text-align: left;"> <code>vertical</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(alpha|transp(aren(cy)*)*)</code> </td><td style="text-align: left;"> <code>alpha</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>interp(olate)*</code> </td><td style="text-align: left;"> <code>interpolate</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>resample</code> </td><td style="text-align: left;"> <code>resample</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>verb(ose)*</code> </td><td style="text-align: left;"> <code>verbose</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>

</table>

</td></tr>
<tr><td><code id="panel_annotation_+3A_label">label</code></td>
<td>
<p>Character, <a href="grDevices.html#topic+plotmath">expression</a>, or objects of classes <code>array</code> or <code>matrix</code>. Text, symbols or logo for displaying on image panel. Multi-row characters are allowed with delimiter <code>"\n"</code>. Default is <code>expression()</code>.</p>
</td></tr>
<tr><td><code id="panel_annotation_+3A_position">position</code></td>
<td>
<p>Character keyword or numeric of length 2 in the interval [0,1]. Defines the location of scale bar. If character, then one of the &quot;bottomleft&quot;, &quot;bottomright&quot;, &quot;topleft&quot;, &quot;topright&quot;, &quot;left&quot;, &quot;right&quot;, &quot;bottom&quot;, &quot;top&quot;, or &quot;center&quot;. If numeric then relative position on panel is defined using shift on horizontal and vertical axes from origin in the bottom-left corner. Default is <code>"bottomright"</code>.</p>
</td></tr>
<tr><td><code id="panel_annotation_+3A_lon">lon</code></td>
<td>
<p>Numeric. Longitude for center of annotation's position. Default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="panel_annotation_+3A_lat">lat</code></td>
<td>
<p>Numeric. Latitude for center of annotation's position. Default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="panel_annotation_+3A_x">x</code></td>
<td>
<p>Numeric. The horizontal coordinate of the annotation's position in the units of image grid. Default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="panel_annotation_+3A_y">y</code></td>
<td>
<p>Numeric. The vertical coordinate of the annotation's position in the units of image grid. Default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="panel_annotation_+3A_cex">cex</code></td>
<td>
<p>Positive numeric. The relative font size for annotation's label. Default is <code>1</code>. See description of argument <code>cex</code> in <a href="graphics.html#topic+text">text</a> function.</p>
</td></tr>
<tr><td><code id="panel_annotation_+3A_adjust">adjust</code></td>
<td>
<p>One or two values in [0, 1]. Specifies the horizontal (and optionally vertical) adjustment of the labels. See description of argument <code>adj</code> in <a href="graphics.html#topic+text">text</a> function.</p>
</td></tr>
<tr><td><code id="panel_annotation_+3A_fg">fg</code></td>
<td>
<p>Character. Color name or code for label (texts and symbols). Default is <code>"#000000"</code> (black). </p>
</td></tr>
<tr><td><code id="panel_annotation_+3A_bg">bg</code></td>
<td>
<p>Character. Color name or code for thin buffer around label's elements. Default is <code>NA</code>, which is interpreted as <code>"transparent"</code> for <em>captions</em> and as <code>"#FFFFFF1F"</code> for <em>annotations</em>.</p>
</td></tr>
<tr><td><code id="panel_annotation_+3A_buffer">buffer</code></td>
<td>
<p>Numeric. The relative width of buffer around label's elements. Default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="panel_annotation_+3A_fill">fill</code></td>
<td>
<p>Character. Color name or code for circumscribed rectangle around labels. Default is <code>NA</code>, which is interpreted as <code>"#FFFFFF7F"</code> for <em>captions</em> and as <code>"transparent"</code> for <em>annotations</em>.</p>
</td></tr>
<tr><td><code id="panel_annotation_+3A_font">font</code></td>
<td>
<p>Character. Font family. Default is <code>getOption("ursaPngFamily")</code>, which is specified by argument <code>font</code> (or <code>family</code>) in <code>compose_open()</code>.</p>
</td></tr>
<tr><td><code id="panel_annotation_+3A_vertical">vertical</code></td>
<td>
<p>Logical or numeric. Vertical or inclined orientation of label. If <code>FALSE</code>, then horizontal labeling. If <code>numeric</code> then <code>vertical</code> defines text direction in degrees. Limitation: value <code>1</code> is interpreted as <code>TRUE</code>. Default is <code>FALSE</code>, which means horizontal text direction.</p>
</td></tr>
<tr><td><code id="panel_annotation_+3A_interpolate">interpolate</code></td>
<td>
<p>Logical. Passed as argument <code>interpolate</code> to function <code><a href="graphics.html#topic+rasterImage">rasterImage</a></code> for logo annotation.</p>
</td></tr>
<tr><td><code id="panel_annotation_+3A_resample">resample</code></td>
<td>
<p>Logical or numeric. Passed as argument <code>resample</code> to function <code><a href="#topic+regrid">regrid</a></code> for logo annotation. Default is <code>FALSE</code>. If <code>TRUE</code> , then resized logo is drawn smoothly.</p>
</td></tr>
<tr><td><code id="panel_annotation_+3A_alpha">alpha</code></td>
<td>
<p>Numeric or character. Level of transparency for logos. If numeric, the either <code style="white-space: pre;">&#8288;0 &lt;= alpha &lt;= 1&#8288;</code> or <code>0 &lt;= alpha &lt;= 255</code>. If character, then one byte of hexadecimal value <code style="white-space: pre;">&#8288;"00" &lt;= alpha &lt;= "FF"&#8288;</code>. Default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="panel_annotation_+3A_verbose">verbose</code></td>
<td>
<p>Logical. Value <code>TRUE</code> may provide some additional information on console. Default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is based on function <a href="graphics.html#topic+text">text</a> with adding some decoration elements. For low-level plotting use <a href="#topic+panel_plot">layout.text</a> function, which is equal to function <a href="graphics.html#topic+text">text</a> with additional control of image panels.
</p>
<p>Since the most of character keywords of <code>position</code> have relation to the boundary of image panel, such annotation is assigned as a <em>caption</em> for image panel. Default decoration is shadowed background rectangle, which is implemented by function <a href="graphics.html#topic+rect">rect</a>.
</p>
<p>If location is defined by two-dimensional vector (either relative position inside of image boundaries (<code>pos</code> is numeric of length two), or pair <code>lon</code>, <code>lat</code>, or pair <code>x</code>, <code>y</code>), then such labeling is assigned as an <em>annotation</em>. Default decoration is thin buffer around symbols. The implementaion is via application of function function <a href="graphics.html#topic+text">text</a> for small diplacements around original position.
</p>
<p>The priority of arguments (from higher to lower): 1) pair <code>lon</code>, <code>lat</code>, 2) pair <code>x</code>, <code>y</code>, 3) two-dimensional numeric of <code>pos</code>, 4) character keyword of <code>pos</code>. However, the default annotation is interpreted as a caption.
</p>


<h3>Value</h3>

<p>This function returns <code>NULL</code> value.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
## exam no.1 -- direct use
compose_open(layout=c(2,3),legend=NULL,device="cairo")
for (i in seq(6)) {
   panel_new()
   panel_annotation(label=LETTERS,cex=1.5)
   panel_annotation(pos=c(0.7,0.2)
                    ,label=paste("panel",paste("no.",i),sep="\n"))
   if (i==1)
      panel_annotation(pos="center")
}
compose_close()

## exam no.2 -- indirect use
display(pixelsize(),scale=2
       ,ann.label="FJL",ann.lon=52,ann.lat=80,ann.buffer=1
       ,ann.bg="#8F6FFF2F",ann.fill="#FFFF7F9F",ann.font="courier")
</code></pre>

<hr>
<h2 id='panel_coastline'>
Add coastline to the image panel.
</h2><span id='topic+panel_coastline'></span><span id='topic+compose_coastline'></span><span id='topic+update_coastline'></span><span id='topic+.panel_coastline'></span><span id='topic+.compose_coastline'></span>

<h3>Description</h3>

<p><code>panel_coastline</code> puts a coastline to the active panel of layout with optional land shadowing. The package provides data for coastline.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compose_coastline(...)

panel_coastline(...)

update_coastline(merge = TRUE)

# not public
.compose_coastline(obj = NULL, panel = 0, col = NA, fill = "transparent",
                    detail = NA, density = NA, angle = NA, land = FALSE,
                    lwd = 0.5, lty = 1, fail180 = NA, verbose = FALSE)

# not public
.panel_coastline(obj, verbose = FALSE)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="panel_coastline_+3A_...">...</code></td>
<td>
<p>Set of arguments, which are recognized via their names (using <a href="base.html#topic+regex">regular expressions</a>) and classes:
</p>

<table>
<tr>
 <td style="text-align: left;">
          <em>Matched pattern</em> </td><td style="text-align: left;"> <em>Used name</em> </td><td style="text-align: left;"> <em>Description</em>
          </td>
</tr>
<tr>
 <td style="text-align: left;"><code>coast(line)*</code> </td><td style="text-align: left;">  </td><td style="text-align: left;">
          Logical or integer. Responsible for should coastline be displayed or not. If integer, the indicates panel index for coastline displaying. If <code>TRUE</code> then coastline is plotted. If <code>FALSE</code> then coastline is not displayed. Default is <code>TRUE</code>.
          </td>
</tr>
<tr>
 <td style="text-align: left;"><code>(obj)*</code> </td><td style="text-align: left;"> <code>obj</code> </td><td style="text-align: left;"> <em>See below.</em>
          </td>
</tr>
<tr>
 <td style="text-align: left;"><code>panel</code> </td><td style="text-align: left;"> <code>panel</code> </td><td style="text-align: left;"> <em>See below.</em>
          </td>
</tr>
<tr>
 <td style="text-align: left;"><code>fill</code> </td><td style="text-align: left;"> <code>fill</code> </td><td style="text-align: left;"> <em>See below.</em>
          </td>
</tr>
<tr>
 <td style="text-align: left;"><code>detail</code> </td><td style="text-align: left;"> <code>detail</code> </td><td style="text-align: left;"> <em>See below.</em>
          </td>
</tr>
<tr>
 <td style="text-align: left;"><code>density</code> </td><td style="text-align: left;"> <code>density</code> </td><td style="text-align: left;"> <em>See below.</em>
          </td>
</tr>
<tr>
 <td style="text-align: left;"><code>angle</code> </td><td style="text-align: left;"> <code>angle</code> </td><td style="text-align: left;"> <em>See below.</em>
          </td>
</tr>
<tr>
 <td style="text-align: left;"><code>land</code> </td><td style="text-align: left;"> <code>land</code> </td><td style="text-align: left;"> <em>See below.</em>
          </td>
</tr>
<tr>
 <td style="text-align: left;"><code>lwd</code> </td><td style="text-align: left;"> <code>lwd</code> </td><td style="text-align: left;"> <em>See below.</em>
          </td>
</tr>
<tr>
 <td style="text-align: left;"><code>lty</code> </td><td style="text-align: left;"> <code>lty</code> </td><td style="text-align: left;"> <em>See below.</em>
          </td>
</tr>
<tr>
 <td style="text-align: left;"><code>fail180</code> </td><td style="text-align: left;"> <code>fail180</code> </td><td style="text-align: left;"> <em>See below.</em>
          </td>
</tr>
<tr>
 <td style="text-align: left;"><code>verb(ose)*</code> </td><td style="text-align: left;"> <code>verbose</code> </td><td style="text-align: left;"> <em>See below.</em>
      </td>
</tr>

</table>

</td></tr>
<tr><td><code id="panel_coastline_+3A_obj">obj</code></td>
<td>
<p>Objects of the one of the classes <code><a href="sp.html#topic+Spatial-class">Spatial</a></code>, <code><a href="sf.html#topic+sfc">sfc</a></code>, <code>ursaCoastLine</code>. The last one is internal structure, which is returned by function <code>.compose_coastline</code>.</p>
</td></tr>
<tr><td><code id="panel_coastline_+3A_panel">panel</code></td>
<td>
<p>Integer vector. Panel for which coastline will be displayed. <code>0L</code> means that coastline will bw displayed for all panels. Default is <code>0L</code>.</p>
</td></tr>
<tr><td><code id="panel_coastline_+3A_col">col</code></td>
<td>
<p>Character. Color code/name for coastline. Default is <code>"grey60"</code>.</p>
</td></tr>
<tr><td><code id="panel_coastline_+3A_fill">fill</code></td>
<td>
<p>Character. Color code/name for land masking/shadowing. Default is <code>"transapent"</code>.</p>
</td></tr>
<tr><td><code id="panel_coastline_+3A_detail">detail</code></td>
<td>
<p>Character keyword. The categorical spatial resolution for coastline. Valid values are <code>"l"</code> (low), <code>"m"</code> (medium), <code>"h"</code> (high), <code>"f"</code> (full). If value is <code>NA</code>, then coasline resolution is selected internally. Default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="panel_coastline_+3A_density">density</code></td>
<td>
<p>Numeric. The density of shading lines for land masking/shadowing. If <code>NA</code> then no shading lines are drawn. Default is <code>NA</code>. See <code>density</code> in <code><a href="graphics.html#topic+polygon">polygon</a></code>.</p>
</td></tr>
<tr><td><code id="panel_coastline_+3A_angle">angle</code></td>
<td>
<p>Numeric. The slope of shading lines, given as an angle in degrees (counter-clockwise). If <code>NA</code> then no shading lines are drawn. Default is <code>NA</code>. See <code>angle</code> in <code><a href="graphics.html#topic+polygon">polygon</a></code>.</p>
</td></tr>
<tr><td><code id="panel_coastline_+3A_land">land</code></td>
<td>
<p>Logical. If <code>TRUE</code> then map's accent is to land, and ocean is masked/shadowed. If <code>FALSE</code> then map's accent is to ocean, and land is masked/shadowed. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="panel_coastline_+3A_lwd">lwd</code></td>
<td>
<p>Positive numeric. Width of coastline. Default is <code>1</code>. See <code>lwd</code> in <code><a href="graphics.html#topic+par">par</a></code>.</p>
</td></tr>
<tr><td><code id="panel_coastline_+3A_lty">lty</code></td>
<td>
<p>Positive integer. Type (pattern) of coastline. Default is <code>1L</code> (solid). See <code>lty</code> in <code><a href="graphics.html#topic+par">par</a></code>.</p>
</td></tr>
<tr><td><code id="panel_coastline_+3A_fail180">fail180</code></td>
<td>
<p>Logical. Patch for correct plotof polygons crossing 180 degree longitude. <code>NA</code> means than decision is taken intuitively. <code>TRUE</code> forces to implement crossing og 180 degree longitude. <code>FALSE</code> forces to not implement crossing og 180 degree longitude. Default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="panel_coastline_+3A_verbose">verbose</code></td>
<td>
<p>Logical. Value <code>TRUE</code> may provide some additional information on console. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="panel_coastline_+3A_merge">merge</code></td>
<td>
<p>Logical. Ingored.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>compose_coastline</code> forms an obect of class <code>ursaCoastLine</code>. <code>panel_coastline</code> displays object of class <code>ursaCoastLine</code>. It is expected higher performance for multi-panel plotting.
</p>
<p>If <code>obj</code> is <code>NULL</code>, then internal data is used. This data is based on simplified polygons of <a href="https://osmdata.openstreetmap.de/data/land-polygons.html">OpenStreetMap-derived data</a>. Source data is <a href="https://osmdata.openstreetmap.de/info/license.html">licensed</a> under the Open Data Commons Open Database License (ODbL). The crossing longitude 180 degrees polygons are merged. Removing of small polygons and simplifying of polygons geometry is applied for three levels of details (<code>"l"</code> - low, <code>"i"</code> - interim, <code>"h"</code> - high). For the full (<code>"f"</code>) level of details data simplification is not applied.
</p>
<p>Coastline data are taken from directory, which is specified by <code>getOption("ursaRequisite")</code> with default value <code>system.file("requisite",package="ursa")</code>. Package contains data of <code>"l"</code> (low) details level in the file <code>system.file("requisite/coast-l.rds",package="ursa")</code>. Data of higher levels can be added using <code>update_coastline()</code> function. It is required to specify user's requisite path using <code>options(ursaRequisite=path/to/user/files)</code> before loading <span class="pkg">ursa</span>, e.g. in the user's <code>~/.Rprofile</code> file. Otherwise, there is a chance that data can not be updated due to 'permission deny' of the system directories. Package <span class="pkg">sf</span> and some it's suggestions are required for data update.
</p>
<p>If <code>detail=NA</code> then the spatial resolution is selected using CRS boundary and resolution using intuitive approach. If package's database cannot supply required details, then lower resolution is used.
</p>
<p>Source coastline data in EPSG:4326 are transformed to CRS projection, extracted using <code><a href="#topic+session">session_grid</a></code> function. Coastlines with optional filling of either land or ocean area is interpreted as polygons. If filling is solid (there is no transparency or shading lines (numerical values of arguments <code>density</code> and <code>angle</code>), then coastline plotting is imlemented via <code><a href="graphics.html#topic+polypath">polypath</a></code> function, otherwise  <code><a href="graphics.html#topic+polygon">polygon</a></code> function.
</p>


<h3>Value</h3>

<p><code>panel_coastline</code> returns <code>NULL</code>
</p>
<p><code>compose_coastline</code> returns of object of class <code>ursaCoastLine</code>. It is a list:
</p>
<table role = "presentation">
<tr><td><code>coast_xy</code></td>
<td>
<p>Two-column matix of coordinates in the sessional projection. The polygons are separated by <code>c(NA,NA)</code> rows.</p>
</td></tr>
<tr><td><code>panel</code></td>
<td>
<p>Integer. Panel for coastline displaying. If <code>0L</code>, then coastline is displayed on each panel.</p>
</td></tr>
<tr><td><code>col</code></td>
<td>
<p>See description of argument <code>col</code>.</p>
</td></tr>
<tr><td><code>fill</code></td>
<td>
<p>See description of argument <code>fill</code>.</p>
</td></tr>
<tr><td><code>shadow</code></td>
<td>
<p>If filling is semi-transparent, then it is &quot;alpha&quot; of filling color (argument <code>fill</code>).</p>
</td></tr>
<tr><td><code>land</code></td>
<td>
<p>See description of argument <code>land</code>.</p>
</td></tr>
<tr><td><code>density</code></td>
<td>
<p>See description of argument <code>density</code>.</p>
</td></tr>
<tr><td><code>angle</code></td>
<td>
<p>See description of argument <code>angle</code>.</p>
</td></tr>
<tr><td><code>lwd</code></td>
<td>
<p>See description of argument <code>lwd</code>.</p>
</td></tr>
<tr><td><code>lty</code></td>
<td>
<p>See description of argument <code>lty</code>.</p>
</td></tr>
</table>


<h3>License</h3>

<p>Coastal data (land polygons) is distributed under ODbL.
</p>


<h3>Note</h3>

<p>In the versions &lt;=3.7-19 package <span class="pkg">ursa</span> contained land polygons based on union of &quot;GSHHS_l_L1.shp&quot; and &quot;GSHHS_l_L5.shp&quot; data from Self-consistent Hierarchical High-resolution Geography Database (<a href="https://www.soest.hawaii.edu/pwessel/gshhg/">GSHHG</a>), Version 2.3.3 (01 November 2014), distributed under the Lesser GNU Public License, Version 3 (29 June 2007). 
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- pixelsize()
p1 &lt;- colorize(a[a&gt;500],ramp=FALSE,interval=TRUE)
p2 &lt;- colorize(a,ramp=FALSE,pal=colorRampPalette(c("grey40","grey100"))
              ,verbose=!TRUE,interval=TRUE)
compose_open(layout=c(2,2),legend=list(list(1,"right"),list(2,"left")))
for (i in 1:4) {
   panel_new(col=ifelse(i==2,"white",NA))
   if (i %in% c(3,4))
      panel_raster(p1)
   else if (i %in% 2)
      panel_raster(p2)
   if (i==1)
      panel_coastline()
   panel_coastline(coast=4,col="#007F00",fill="lightgreen",land=TRUE)
   panel_coastline(coast=3,col="#0000003F",fill="#0000003F")
   panel_coastline(coast=2,col="black",fill="black",density=20
                   ,angle=c(-45,45),lwd=0.25,detail="l")
  # panel_graticule(decor=4)
   panel_annotation(text=as.character(i))
   if (i==1)
      panel_annotation(pos=c(1,1),text="default")
   else if (i==2)
      panel_annotation(pos=c(0,1),text="greyscale")
   else if (i==3)
      panel_annotation(pos=c(1,1),text="land is shadowed")
   else if (i==4)
      panel_annotation(pos=c(0,1),text="ocean is masked")
}
compose_legend(p2,p1)
compose_close()
</code></pre>

<hr>
<h2 id='panel_contour'>
Add colored contour to the image panel
</h2><span id='topic+panel_contour'></span>

<h3>Description</h3>

<p>An instrument to overlay multiple rasters on the same image panel. Contour is derived from one band of raster image. The colors (and respective colorbar in legend) is an alternative to contour labeling.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>panel_contour(obj, type = "", ...)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="panel_contour_+3A_obj">obj</code></td>
<td>
<p>Object of class <code>ursaRaster</code> or <code>NULL</code>. Raster band for contouring. If <code>NULL</code> then contour is not displayed. Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="panel_contour_+3A_type">type</code></td>
<td>
<p>Character. Keyword list to descibe characteristics of contour, which is interpreted using <a href="base.html#topic+regex">regular expressions</a>.<br /><code>"label"</code> specifies displaying labels on contour lines. <br /><code>"line"</code> specifies displaying contour lines.<br /><code>"colo(u)*r"</code> specifies displaying colored contour lines. <br /><code>"fill"</code> specifies displaying filled contour lines.<br /> Keywords can be combined in a single character, e.g., <code>"fill label"</code> specifies displaying filled contours with labels.</p>
</td></tr>
<tr><td><code id="panel_contour_+3A_...">...</code></td>
<td>
<p>Set of arguments, which are recognized via their names (using <a href="base.html#topic+regex">regular expressions</a>) and classes:
</p>

<dl>
<dt><code>bg</code></dt><dd><p>Character. Color name or code for contour border. Used for contrast increasing. Semi-transparency and transparency (<code>"transparent"</code>) are allowed. Default is <code>"black"</code>.</p>
</dd>
<dt><code>lwd(\\.fg)*</code></dt><dd><p>Positive numeric. Width of contour line. Default is <code>1</code>.</p>
</dd>
<dt><code>lwd\\.bg</code></dt><dd><p>Poistive numeric. Width of the back of contour line. For  bordering shoould exceed foreground width (argument <code>lwd</code>). Default is <code>lwd*1.5</code>.</p>
</dd>
<dt><code>lty</code></dt><dd><p>Numeric of character. Line type for contour. Default is <code>1</code>.</p>
</dd>
<dt><code>(lab)*cex</code></dt><dd><p>Numeric. Character expansion factor for labels. Default is <code>0.85</code>.</p>
</dd>
<dt><code>method</code></dt><dd><p>Character. Argument, which is passed to <code><a href="graphics.html#topic+contour">contour</a></code>. Default is <code>"flattest"</code>.</p>
</dd>
<dt><code>expand</code></dt><dd><p>Numeric. Scale factor (<code>&gt;=1</code>) to artificial increasing contour details by means of smoothing of increased image size. Not applicable for images with <a href="#topic+classColorTable">color tables</a>. Default is <code>NA</code>; smoothing is determined intuitively.</p>
</dd>
<dt><code>before</code></dt><dd><p>Logical. Should image reclassification be done before smoothing? Default is <code>FALSE</code> for categorical images and <code>TRUE</code> for numerical images.</p>
</dd>
<dt><code>cover</code></dt><dd><p>Numeric. Argument, which is passed to <code><a href="#topic+regrid">regrid</a></code> to control <code>NA</code> values during smoothing. Default is <code>NA</code>; connected to default value of argument <code>cover</code> in function <code><a href="#topic+regrid">regrid</a></code>.</p>
</dd>
<dt><code>short</code></dt><dd><p>Positive integer. Minimal number of points in segments for displaying. Prevents displaying very short segments in the case of high-detailed image. Default is <code>0</code>: all segments are displayed.</p>
</dd>
<dt><code>verb(ose)*</code></dt><dd><p>Logical. Value <code>TRUE</code> may provide some additional information on console. Default is <code>FALSE</code>.</p>
</dd>
</dl>
<p>Other arguments are used in the functuion <code><a href="#topic+colorize">colorize</a></code> to produce color tables.

</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function <code><a href="grDevices.html#topic+contourLines">contourLines</a></code> is used for contouring.
</p>
<p>The color table of input raster image is kept. The output panel have one element left, because contours are borders between areas of the same color. It is recommended to use only gradient palettes.
</p>
<p>The color table is forced not to be ramp (argument <code>ramp=FALSE</code> in the function <code><a href="#topic+colorize">colorize</a></code>) to prevent extra density of contour lines.
</p>
<p>The color table is forced to be interval (argument <code>interval=1L</code> in the function <code><a href="#topic+colorize">colorize</a></code>) to prevent lost of elements in the palette.
</p>


<h3>Value</h3>

<p>Object of class <code>ursaColorTable</code>, which then should be used as an input argument for the colorbar legend (function <code><a href="#topic+legend_colorbar">legend_colorbar</a></code>). If there is no argument of class <code>ursaRaster</code> then function returns <code>NULL</code> value.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="grDevices.html#topic+contourLines">contourLines</a></code>
</p>
<p><code><a href="graphics.html#topic+contour">contour</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- pixelsize()
refval &lt;- seq(450,650,by=25)
val &lt;- refval[seq(refval) %% 2 == 1]
ref &lt;- colorize(a,breakvalue=refval,pal.rich=45,pal.rotate=0)
p1 &lt;- colorize(a,breakvalue=val,pal.rich=135,pal.rotate=0)
p2 &lt;- colorize(a,value=val,pal.rich=-15,pal.rotate=0)
p3 &lt;- colorize(a,value=refval)

if (exam1 &lt;- TRUE) {
   compose_open(legend=list(list(1,"left"),list(1,"right")),scale=2)
   panel_new()
  # ct1 &lt;- panel_raster(ref)
  # ct2 &lt;- panel_contour(p2,"colored line",palname="Greens",lwd=15,lwd.bg=0)
   ct2 &lt;- panel_contour(p2,"colored line",pal.rich=240,pal.rotate=0,lwd.fg=15,lwd.bg=0)
  # panel_contour(ref,lwd=0)
  # mysource("contour.R")
  # mycontour(.panel_contour(a),lwd=0)
   if (exists("ct1"))
      compose_legend(ct1,units="raster")
   if (exists("ct2"))
      compose_legend(ct2,units="contour")
   compose_close(bpp=8)
}

if (exam2 &lt;- TRUE) {
   compose_open(layout=c(2,2),byrow=FALSE
               ,legend=list(list(1,"left"),list("bottom",1)
                           ,list(1,"right"),list("top",2)
                           ,list(2,"right"),list("bottom",2)))
   panel_new()
   panel_raster(ref)
   panel_contour(a)
   panel_new()
   ct0 &lt;- panel_contour(a,"color",value=val,pal.rich=240,pal.rotate=0,lwd=11,lwd.bg=12)
   panel_contour(a)
   panel_annotation(text="no colortable")
   panel_new()
   panel_raster(p1)
   ct1 &lt;- panel_contour(p1,"color",lwd=11,lwd.bg=2)
   panel_contour(a)
   panel_annotation(text="colortable:category")
   panel_new()
   panel_raster(p2)
   ct2 &lt;- panel_contour(p2,"color",lwd=11,lwd.bg=2)
   panel_contour(a)#,cex=0.5)
   panel_annotation(text="colortable:interval")
   compose_legend(ref,units="reference")
   compose_legend(ct0,units="contour")
   compose_legend(p1,units="raster")
   compose_legend(ct1,units="contour")
   compose_legend(p2,units="raster")
   compose_legend(ct2,units="contour")
   compose_close()
}

if (exam3 &lt;- TRUE) {
   s &lt;- 29
   session_grid(NULL)
   a &lt;- as.ursa(volcano)
   if (FALSE) {
      display(a)
      a2 &lt;- regrid(a,mul=s,cascade=TRUE,verbose=TRUE)
      display(a2)
      session_grid(a)
   }
   compose_open() ## device="windows")
   panel_new()
   ct1 &lt;- panel_raster(a,ramp=FALSE,interval=TRUE)
   ct2 &lt;- panel_contour(a,"label")
   rm(ct2)
   panel_decor()
   if (exists("ct2"))
      legend_colorbar(ct2)
   else if (exists("ct1"))
      legend_colorbar(ct1)
   compose_close()
}

</code></pre>

<hr>
<h2 id='panel_decor'>
Add auxiliary elements to the plotting panel.
</h2><span id='topic+panel_decor'></span>

<h3>Description</h3>

<p><code>panel_decor</code> adds over plot sequentially the followed elements: coastline, gridline, scalebar. Unlike <code>panel_decor</code>, function <code>layout.grid</code> does not add scalebar.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>panel_decor(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="panel_decor_+3A_...">...</code></td>
<td>

<p>Passed to sequence of plotting functions:
</p>

<ul>
<li> <p><code><a href="#topic+panel_graticule">panel_graticule</a></code>. To distinguish the same argument names in different functions it is provided to use prefix &ldquo;<code>grid.*</code>&rdquo;, e.g., <code>grid.col="grey40"</code>.
</p>
</li>
<li> <p><code><a href="#topic+panel_coastline">panel_coastline</a></code>. To distinguish the same argument names in different functions it is provided to use prefix &ldquo;<code>coast.*</code>&rdquo;, e.g., <code>coast.col="grey60"</code>.
</p>
</li>
<li> <p><em>(not applicable for <code>layout.grid</code>)</em> <code><a href="#topic+panel_scalebar">panel_scalebar</a></code>. To distinguish the same argument names in different functions it is provided to use prefix &ldquo;<code>scalebar.*</code>&rdquo;, e.g., <code>scalebar.col="black"</code>.
</p>
</li></ul>

</td></tr>
</table>


<h3>Details</h3>

<p>The sequence of elements is constant. To change order, use direct calling of <code><a href="#topic+panel_graticule">panel_graticule</a></code>, <code><a href="#topic+panel_coastline">panel_coastline</a></code>, <code><a href="#topic+panel_scalebar">panel_scalebar</a></code> in any sequence.
</p>
<p>Sometimes, for rasters with <code>NA</code> values the followed sequence may be used: </p>
<pre>
panel_coastline(col="transparent",fill="grey80")
panel_raster(a)
panel_coastline(col="grey40")</pre>


<h3>Value</h3>

<p><code>panel_decor</code> returns <code>NULL</code> value.<br />
<code>layout.grid</code> returns <code>NULL</code> value.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sebin.ru">platonov@sebin.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- ursa_dummy(nband=1,min=0,max=100)
a[a&lt;30] &lt;- NA
compose_open()
panel_new()
ct &lt;- panel_raster(a)
panel_decor(graticule.col="green4",graticule.lwd=2,scalebar.col="brown")
compose_legend(ct)
compose_close()
</code></pre>

<hr>
<h2 id='panel_graticule'>
Add latitude/longitude or metric grid to the image panel.
</h2><span id='topic+panel_graticule'></span><span id='topic+compose_graticule'></span><span id='topic+.panel_graticule'></span><span id='topic+.compose_graticule'></span>

<h3>Description</h3>

<p><code>panel_graticule</code> puts a grid on the panel with raster image. If CRS is georeferenced then grid is generated from longitudes and latitudes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>panel_graticule(...)

compose_graticule(...)

# non-public
.compose_graticule(panel = 0L, col = "grey70", border = "grey70", lon = NA, lat = NA,
                lwd = 0.5, lty = 2, marginalia = rep(FALSE, 4), trim = FALSE,
                language = NA_character_, cex = 0.75, verbose = FALSE)

# non-public
.panel_graticule(obj, marginalia = rep(TRUE, 4), verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="panel_graticule_+3A_...">...</code></td>
<td>
<p>Set of arguments, which are recognized via their names (using <a href="base.html#topic+regex">regular expressions</a>) and classes:
</p>

<table>
<tr>
 <td style="text-align: left;">
          <em>Matched pattern</em> </td><td style="text-align: left;"> <em>Used argument</em> </td><td style="text-align: left;"> <em>Description</em>
          </td>
</tr>
<tr>
 <td style="text-align: left;"><code>(graticule|grid(line)*)</code> </td><td style="text-align: left;">  </td><td style="text-align: left;"> Logical. Responsible for should grid lines be displayed or not. If <code>TRUE</code> then grid lines are plotted. If <code>FALSE</code> then grid lines are not displayed. Default is <code>TRUE</code>.
          </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>^(graticule|grid(line)*)$</code> </td><td style="text-align: left;"> <code>panel</code> </td><td style="text-align: left;"> <em>See below</em>.
          </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(graticule|grid(line)\.)*col</code> </td><td style="text-align: left;"> <code>col</code> </td><td style="text-align: left;"> <em>See below</em>. Default value in <code>compose_graticule</code> depends on panel background color, <code>"#0000002F"</code> for ligth panel background, and <code>"#FFFFFF4F"</code> for dark panel background.
          </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(graticule|grid(line)\.)*border</code> </td><td style="text-align: left;"> <code>border</code> </td><td style="text-align: left;"> <em>See below</em>. Default value in <code>compose_graticule</code> depends on figure background color, <code>"#0000002F"</code> for ligth figure background, and <code>"#FFFFFF4F"</code> for dark figure background.
          </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(graticule|grid(line)\.)*lon</code> </td><td style="text-align: left;"> <code>lon</code> </td><td style="text-align: left;"> <em>See below</em>.
          </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(graticule|grid(line)\.)*lat</code> </td><td style="text-align: left;"> <code>lat</code> </td><td style="text-align: left;"> <em>See below</em>.
          </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(graticule|grid(line)\.)*lwd</code> </td><td style="text-align: left;"> <code>lwd</code> </td><td style="text-align: left;"> <em>See below</em>.
          </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(graticule|grid(line)\.)*lty</code> </td><td style="text-align: left;"> <code>lty</code> </td><td style="text-align: left;"> <em>See below</em>.
          </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(decor|margin(alia)*)</code> </td><td style="text-align: left;"> <code>marginalia</code> </td><td style="text-align: left;"> <em>See below</em>. <code>.compose_graticule</code> and <code>.panel_graticule</code> don't validate correctness of this parameter.
          </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>((graticule|grid(line)\.)*trim</code> </td><td style="text-align: left;"> <code>trim</code> </td><td style="text-align: left;"> <em>See below</em>.
          </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(graticule|grid(line)\.)*language</code> </td><td style="text-align: left;"> <code>language</code> </td><td style="text-align: left;"> <em>See below</em>.
          </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(graticule|grid(line)\.)*verb(ose)*</code> </td><td style="text-align: left;"> <code>verbose</code> </td><td style="text-align: left;"> <em>See below</em>.
      </td>
</tr>

</table>

</td></tr>
<tr><td><code id="panel_graticule_+3A_obj">obj</code></td>
<td>
<p>Objects of the class <code>ursaGridLine</code>. It is internal structure, which is returned by function <code>.compose_graticule</code>.</p>
</td></tr>
<tr><td><code id="panel_graticule_+3A_panel">panel</code></td>
<td>
<p>Integer vector. Panel for which coastline will be displayed. <code>0L</code> means that coastline will bw displayed for all panels. Default is <code>0L</code>.</p>
</td></tr>
<tr><td><code id="panel_graticule_+3A_col">col</code></td>
<td>
<p>Character. Color code/name for grid lines. Default is <code style="white-space: pre;">&#8288;"grey70"&#8288;</code>.</p>
</td></tr>
<tr><td><code id="panel_graticule_+3A_border">border</code></td>
<td>
<p>Character. Color code/name for marginal labels and ticks. Default is <code style="white-space: pre;">&#8288;"grey70"&#8288;</code>. </p>
</td></tr>
<tr><td><code id="panel_graticule_+3A_lon">lon</code></td>
<td>
<p>Numeric vector. Set of longitudes for grid. If <code>NA</code> then set of logitudes is formed internally. Default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="panel_graticule_+3A_lat">lat</code></td>
<td>
<p>Numeric vector. Set of latitudes for grid. If <code>NA</code> then set of latidudes is formed internally. Default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="panel_graticule_+3A_lwd">lwd</code></td>
<td>
<p>Positive numeric. Width of grid line. Default is <code>0.5</code>. See <code>lwd</code> in <code><a href="graphics.html#topic+par">par</a></code>.</p>
</td></tr>
<tr><td><code id="panel_graticule_+3A_lty">lty</code></td>
<td>
<p>Positive integer. Type (pattern) of grid line. Default is <code>2</code> (dashed). See <code>lty</code> in <code><a href="graphics.html#topic+par">par</a></code>.</p>
</td></tr>
<tr><td><code id="panel_graticule_+3A_marginalia">marginalia</code></td>
<td>
<p>Logical or integer vectors. Responsible for whether longitudes and latitudes (or metric coordinates) be labelled on the frame of panel with raster image. If logical and <code>TRUE</code>, then labels will be displatyed on each open side of panel. If logical and <code>FALSE</code> then labels will not be displayed. If logical of length 4, then labels will be displayed on specific side, where side index is <code>c(bottom, left, top, right)</code> (see description for marginal parameters in <code><a href="graphics.html#topic+par">par</a></code>). If argument is a vector of positive integers, then labels for grid lines are plotted only for the specified panels, which sequence is defined in <code><a href="#topic+compose_design">compose_design</a></code> function and returned from <code>getOption("ursaPngLayout")$layout</code>. Default is <code>c(TRUE,TRUE,TRUE,TRUE)</code>.</p>
</td></tr>
<tr><td><code id="panel_graticule_+3A_language">language</code></td>
<td>
<p>Character. Language for longitude and latitude captions. If <code>"ru"</code> then captions are in Russian else in English. Default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="panel_graticule_+3A_trim">trim</code></td>
<td>
<p>Logical. If grid lines are labelled then <code>trim=TRUE</code> prevents crossing the labels on neighbor perpendicular sides.</p>
</td></tr>
<tr><td><code id="panel_graticule_+3A_cex">cex</code></td>
<td>
<p>Positive numeric. The relative font size for grid lines' labels. Make sence in the case of labels plotting. Default is <code>0.75</code>.</p>
</td></tr>
<tr><td><code id="panel_graticule_+3A_verbose">verbose</code></td>
<td>
<p>Logical. Value <code>TRUE</code> may provide some additional information on console. Default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If not <code>language="ru"</code> but environmental variable <code>LANGUAGE=ru</code> then labels are in Russian (cyrillics).
</p>
<p>Argument <code>gridline</code> (or, <code>grid</code>) is introduced for unconditional calling of <code>panel_graticule</code> inside of high-level functions.
</p>
<p>Grid lines can be controlled in high-level plot functions (<em>e.g.</em>, <code><a href="#topic+display">display</a></code>, <code><a href="#topic+compose_plot">compose_plot</a></code>, <code><a href="#topic+display_stack">display_stack</a></code>, <code><a href="#topic+display_brick">display_brick</a></code>, <code><a href="#topic+display_rgb">display_rgb</a></code>, <em>etc</em>.). To prevent displaying grid lines, use argument <code>gridline=FALSE</code> (or <code>grid=FALSE</code>). To display grid lines, use argument <code>gridline=TRUE</code> (or <code>grid=TRUE</code>) and prefix <code>grid(line)*</code> (<code>gridline.*</code> or <code>grid.*</code>) for grid lines' parameters, <em>e.g.</em>, <code>gridline.verb=TRUE</code>, <code>grid.col="black"</code>. If prefix is omitted then arguments with the same names affect in other functions in the part of high-level function.
</p>
<p>If grid lines are formed internally, then desirable number of lines for each direction is 3. The design of line density is based on intuition, providing pretty labelling.
</p>
<p>If CRS is georeferenced then grid lines are corresponded to longitudes and latitudes. Integer minutes are used to illustate fractional values of degrees. If precision of minutes is insufficient, then integer values of seconds are introduced. The fractional values of seconds are not used.
</p>
<p>Labels are located at the points, where grid lines cross plot margin. Labels are not overlapped along the same side. To prevent overlapping along the same side, labels are shifted or omitted. Argument <code>trim=TRUE</code> prevents overlapping labels from neighbor sides via hidding.
</p>


<h3>Value</h3>

<p>Function returns <code>NULL</code> value.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
 ## Changing of environmental variables is out of CRAN Policy 
## Not run: Sys.setenv(LANGUAGE="ru")


# example no.1
cl &lt;- compose_design(layout=c(2,2),legend=NULL)
session_grid(regrid(lim=3.2*1e6*c(-1,-1,1,1)))
compose_open(cl)
for (i in 1:4) {
   panel_new()
   panel_coastline()
   panel_graticule(decor=TRUE,trim=i %in% c(2:4))
   panel_annotation(text=as.character(i))
   panel_scalebar(scalebar=i==3)
}
compose_close()

# example no.2
session_grid(regrid(lim=1e6*c(-0.5,0.5,1.5,2.5)))
compose_open(layout=c(2,2),legend=NULL,skip=4)
for (i in seq(getOption("ursaPngLayout")$image)) {
   panel_new()
   panel_coastline()
   if (i==1)
      panel_graticule()
   else if (i==2)
      panel_graticule(decor=TRUE,lon=seq(0,360,by=40)[-1],lat=seq(-90,90,by=10))
   else if (i==3)
      panel_graticule(decor=TRUE,lon=seq(0,360,by=20)[-1],lat=seq(-90,90,by=5)
                     ,trim=TRUE)
   else if (i==4)
      panel_graticule(gridline=FALSE)
   panel_scalebar(scalebar=1)
   panel_annotation(text=as.character(i))
}
compose_close()

# example no.3 -- indirect usage
session_grid(NULL)
display(pixelsize(),decor=TRUE,grid.col="green3",coast.col="darkgreen",side=2)

 ## Changing of environmental variables is out of CRAN Policy 
## Not run: Sys.setenv(LANGUAGE="") # reset environmental variable

</code></pre>

<hr>
<h2 id='panel_new'>
Start plotting on the new image panel
</h2><span id='topic+panel_new'></span><span id='topic+.panel_new'></span>

<h3>Description</h3>

<p><code>panel_new</code> finishes plotting on previuos image panel and starts plotting on next image panel.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>panel_new(...)

# non-public
.panel_new(col = "chessboard", alpha = NA, density = NA, angle = NA,
           lwd = 1, lty = 1, asp = NA, mar = rep(0, 4), grid = NULL, verbose = FALSE)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="panel_new_+3A_...">...</code></td>
<td>
<p>Set of arguments, which are recognized via their names (using <a href="base.html#topic+regex">regular expressions</a>) and classes. Passed to non-public <code>.panel_new</code>. Optional prefix <code>"blank"</code> is used for indirect use. Separated by a dot <code>"."</code>, e.g., <code>blank.fill="transparent"</code>.
</p>

<table>
<tr>
 <td style="text-align: left;">
         <strong>Pattern</strong> (<code>panel_new</code>) </td><td style="text-align: left;"> <strong>Argument</strong> (<code>.panel_new</code>) </td><td style="text-align: left;"> <strong>Description</strong>
         </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(blank\\.)*(^$|bg|fill)</code> </td><td style="text-align: left;"> <code>col</code> </td><td style="text-align: left;"> <var>See below.</var> Keyword <code>"chessboard"</code> is used by default to produce original background texture. However argument <code>col</code> has other default value.
         </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(blank\\.)*aphpa</code> </td><td style="text-align: left;"> <code>alpha</code> </td><td style="text-align: left;"> <var>See below.</var>
         </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(blank\\.)*density</code> </td><td style="text-align: left;"> <code>density</code> </td><td style="text-align: left;"> <var>See below.</var>
         </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(blank\\.)*angle</code> </td><td style="text-align: left;"> <code>angle</code> </td><td style="text-align: left;"> <var>See below.</var>
         </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(blank\\.)*lwd</code> </td><td style="text-align: left;"> <code>lwd</code> </td><td style="text-align: left;"> <var>See below.</var>
         </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(blank\\.)*lty</code> </td><td style="text-align: left;"> <code>lty</code> </td><td style="text-align: left;"> <var>See below.</var>
         </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(blank\\.)*asp</code> </td><td style="text-align: left;"> <code>asp</code> </td><td style="text-align: left;"> <var>See below.</var>
         </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(blank\\.)*mar</code> </td><td style="text-align: left;"> <code>mar</code> </td><td style="text-align: left;"> <var>See below.</var>
         </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(blank\\.)*grid</code> </td><td style="text-align: left;"> <code>grid</code> </td><td style="text-align: left;"> <var>See below.</var>
         </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(blank\\.)*verb(ose)*</code> </td><td style="text-align: left;"> <code>verbose</code> </td><td style="text-align: left;"> <var>See below.</var>
         
      </td>
</tr>

</table>

</td></tr>
<tr><td><code id="panel_new_+3A_col">col</code></td>
<td>
<p>Character. Color code/name for panel filling/shadowing. Default is <code>"chessboard"</code> (lightened background for controlling transparency) for georeferenced images, and <code>"grey90"</code> for non-projected images.</p>
</td></tr>
<tr><td><code id="panel_new_+3A_alpha">alpha</code></td>
<td>
<p>Numeric, <code style="white-space: pre;">&#8288;0 &lt;= alpha &lt;= 1&#8288;</code>. Level of transparency. Default is <code>1</code>, without transparency.</p>
</td></tr>
<tr><td><code id="panel_new_+3A_density">density</code></td>
<td>
<p>Numeric. The density of shading lines for fill/shadowing. If <code>NA</code> then no shading lines are drawn. Default is <code>NA</code>. See <code>density</code> in <code><a href="graphics.html#topic+rect">rect</a></code>.</p>
</td></tr>
<tr><td><code id="panel_new_+3A_angle">angle</code></td>
<td>
<p>Numeric. The slope of shading lines, given as an angle in degrees (counter-clockwise). If <code>NA</code> then no shading lines are drawn. Default is <code>NA</code>. See <code>angle</code> in <code><a href="graphics.html#topic+rect">rect</a></code>.</p>
</td></tr>
<tr><td><code id="panel_new_+3A_lwd">lwd</code></td>
<td>
<p>Positive numeric. Width of coastline. Default is <code>1</code>. See <code>lwd</code> in <code><a href="graphics.html#topic+rect">rect</a></code>.</p>
</td></tr>
<tr><td><code id="panel_new_+3A_lty">lty</code></td>
<td>
<p>Character or positive integer. Type (pattern) of coastline. Default is <code>1L</code> (solid). See <code>lty</code> in <code><a href="graphics.html#topic+rect">rect</a></code>.</p>
</td></tr>
<tr><td><code id="panel_new_+3A_asp">asp</code></td>
<td>
<p>Positive numeric. The <em>y/x</em> aspect ration. Default is <code>1</code>. See <code>asp</code> in <code><a href="graphics.html#topic+plot.window">plot.window</a></code>.</p>
</td></tr>
<tr><td><code id="panel_new_+3A_mar">mar</code></td>
<td>
<p>Positive numeric of length 4. Plot margins. Default is <code>rep(0,4L)</code>. See <code>mar</code> in <code><a href="graphics.html#topic+par">par</a></code>.</p>
</td></tr>
<tr><td><code id="panel_new_+3A_grid">grid</code></td>
<td>
<p>Object of class <code>ursaGrid</code> or converted to it, to define spatial extent and projection for this panel. Default is <code>NULL</code>, which repeats previous state.</p>
</td></tr>
<tr><td><code id="panel_new_+3A_verbose">verbose</code></td>
<td>
<p>Logical. Value <code>TRUE</code> may provide some additional information on console. Default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Prefix <code>blank</code> is introduced for manipulations with <code>panel_new</code> inside of high-level functions (e.g., <code><a href="#topic+display">display</a></code>). Prefix skipping is the subject for confict with functions, which use the same name of arguments.
</p>
<p>It is required to call <code>panel_new</code> for every image panel. First calling starts plotting on the first panel. Second and next callings change image panels.
</p>
<p>The panel sequence is set in function <code><a href="#topic+compose_design">compose_design</a></code>, which is called directly or indirectly from <code><a href="#topic+compose_open">compose_open</a></code>, and keeps in the options (access via <code>getOption("ursaPngLayout")$layout</code>).
</p>
<p>Image background is formed via consecutive call of functions <code><a href="graphics.html#topic+plot.default">plot</a>(...,type="n")</code>, and <code><a href="graphics.html#topic+rect">rect</a>(...)</code>.
</p>


<h3>Value</h3>

<p>Function returns <code>NULL</code> value.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
# example no.1 -- direct use
compose_open(layout=c(1,3),legend=NULL)
panel_new()
panel_annotation(label="Default + Empty")
panel_new(col="#0000FF3F",density=15,angle=45,lwd=3)
panel_decor()
panel_annotation(label="Settings + Grid")
panel_new("#FFFF0040",grid=regrid(expand=0.5))
panel_decor()
panel_annotation(label="Another spatial extent")
compose_close()

# example no.2 -- indirect use
a &lt;- pixelsize()
a &lt;- a[a&gt;560]
display(a,blank.col="#0000FF3F",blank.density=15,blank.angle=45,blank.lwd=3
       ,coast.fill="#007F005F",coast.density=20,coast.angle=c(-30,60))
</code></pre>

<hr>
<h2 id='panel_plot'>
Add graphical elements to the image panel
</h2><span id='topic+panel_plot'></span><span id='topic+panel_box'></span><span id='topic+panel_lines'></span><span id='topic+panel_points'></span><span id='topic+panel_text'></span><span id='topic+panel_abline'></span><span id='topic+panel_polygon'></span><span id='topic+panel_segments'></span>

<h3>Description</h3>

<p>Standard fuctions for plotting from package <span class="pkg">graphics</span> are used for manual adding elements to current plot. Theses series of functions used that standard instruments with additional controling the acceptability of plotting.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>panel_plot(obj,...)

panel_box(...)
panel_lines(...)
panel_points(...)
panel_text(...)
panel_abline(...)
panel_polygon(...)
panel_segments(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="panel_plot_+3A_obj">obj</code></td>
<td>
<p><span class="rlang"><b>R</b></span> object.</p>
</td></tr>
<tr><td><code id="panel_plot_+3A_...">...</code></td>
<td>

<p>In <code>panel_plot</code> arguments are passed to function <code><a href="graphics.html#topic+plot.default">plot</a></code>.<br />
In <code>panel_box</code> arguments are passed to function <code><a href="graphics.html#topic+box">box</a></code>.<br />
In <code>panel_lines</code> arguments are passed to function <code><a href="graphics.html#topic+lines">lines</a></code>.<br />
In <code>panel_points</code> arguments are passed to function <code><a href="graphics.html#topic+points">points</a></code>.<br />
In <code>panel_text</code> arguments are passed to function <code><a href="graphics.html#topic+text">text</a></code>.<br />
In <code>panel_abline</code> arguments are passed to function <code><a href="graphics.html#topic+abline">abline</a></code>.<br />
In <code>panel_polygon</code> arguments are passed to function <code><a href="graphics.html#topic+polygon">polygon</a></code>.<br />
In <code>panel_segments</code> arguments are passed to function <code><a href="graphics.html#topic+segments">segments</a></code>.<br />
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If unable to get value <code>TRUE</code> from <code>getOption("ursaPngPlot")</code> then plotting is disable, and any function from this series returns <code>NULL</code>.
</p>
<p>Generally, for spatial objects argument <code>add=TRUE</code> is used in <code>panel_plot</code>.
</p>


<h3>Value</h3>

<p>For spatial objects (simple features from <span class="pkg">sf</span> or spatial abstract classes from <span class="pkg">sp</span>) function <code>panel_plot</code> returns object of class <code>ursaLegend</code>. It is a list with items, which can be used to as arguments of <code><a href="graphics.html#topic+legend">legend()</a></code>. This is intermediate step for experimental feature (not ready) to display colorbars on plot panel. For other objects function <code>panel_plot</code> returns value of function <code><a href="graphics.html#topic+plot.default">plot</a></code>.
</p>
<p>Function <code>panel_box</code> returns value of function <code><a href="graphics.html#topic+box">box</a></code>.<br />
Function <code>panel_lines</code> returns value of function <code><a href="graphics.html#topic+lines">lines</a></code>.<br />
Function <code>panel_points</code> returns value of function <code><a href="graphics.html#topic+points">points</a></code>.<br />
Function <code>panel_text</code> returns value of function <code><a href="graphics.html#topic+text">text</a></code>.<br />
Function <code>panel_abline</code> returns value of function <code><a href="graphics.html#topic+abline">abline</a></code>.<br />
Function <code>panel_polygon</code> returns value of function <code><a href="graphics.html#topic+polygon">polygon</a></code>.<br />
Function <code>panel_segments</code> returns value of function <code><a href="graphics.html#topic+segments">segments</a></code>.<br />
</p>


<h3>Note</h3>

<p>For plotted elements it is possible to create legend for colors using color bars. No shapes kind and size, no line widths.
</p>
<p>To convert object <code>x</code> of class <code>ursaLegend</code> to object of class <code>ursaColorTable</code> please use <code>ursa_colortable(x)</code>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+panel_contour">panel_contour</a></code>
</p>
<p>Package <span class="pkg">graphics</span> (<code>help(package="graphics")</code>) and functions <code><a href="graphics.html#topic+plot.default">plot</a></code>, <code><a href="graphics.html#topic+box">box</a></code>, <code><a href="graphics.html#topic+lines">lines</a></code>, <code><a href="graphics.html#topic+points">points</a></code>, <code><a href="graphics.html#topic+text">text</a></code>, <code><a href="graphics.html#topic+abline">abline</a></code>, <code><a href="graphics.html#topic+polygon">polygon</a></code>, <code><a href="graphics.html#topic+segments">segments</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
# require(rgdal) ## 'rgdal' is retired
a &lt;- pixelsize()
g1 &lt;- session_grid()
n &lt;- 12L
k &lt;- 5L
x &lt;- with(g1,runif(n,min=minx,max=maxx))
y &lt;- with(g1,runif(n,min=miny,max=maxy))
panel_plot(x,y) ## plots nothing, because 'compose_open(...,dev=F)' is not called yet
shpname &lt;- tempfile(fileext=".shp")
layername &lt;- gsub("\\.shp$","",basename(shpname))
if (requireNamespace("sp")) {
   sl &lt;- lapply(seq(k),function(id){
      x &lt;- sort(with(g1,runif(n,min=minx,max=maxx)))
      y &lt;- sort(with(g1,runif(n,min=miny,max=maxy)))
      sp::Lines(sp::Line(cbind(x,y)),ID=id)
   })
   sl &lt;- sp::SpatialLines(sl,proj4string=sp::CRS(ursa_proj(g1)))#,id=length(sl))
   lab &lt;- t(sapply(sp::coordinates(sl),function(xy) xy[[1]][round(n/2),]))
   lab &lt;- as.data.frame(cbind(lab,z=seq(k)))
   sl &lt;- sp::SpatialLinesDataFrame(sl
                 ,data=data.frame(ID=runif(k,min=5,max=9),desc=LETTERS[seq(k)]))
   print(sl@data)
   ct &lt;- colorize(sl@data$ID)#,name=sldf@data$desc)
   try(writeOGR(sl,dirname(shpname),layername,driver="ESRI Shapefile")) ## 'rgdal' is retired
   spatial_write(sl,shpname)
} else if (requireNamespace("sf")) {
   sl &lt;- lapply(seq(k),function(id) {
      x &lt;- sort(with(g1,runif(n,min=minx,max=maxx)))
      y &lt;- sort(with(g1,runif(n,min=miny,max=maxy)))
      sf::st_linestring(cbind(x,y))
   })
   sl &lt;- sf::st_sfc(sl,crs=as.character(ursa_crs(g1)))
   sl &lt;- sf::st_sf(ID=runif(k,min=5,max=9),desc=LETTERS[seq(k)],geometry=sl)
   print(spatial_data(sl))
   lab &lt;- do.call("rbind",lapply(sf::st_geometry(sl),colMeans))
   lab &lt;- as.data.frame(cbind(lab,z=seq(k)))
   ct &lt;- colorize(sl$ID)
   sf::st_write(sl,shpname)
}
compose_open(layout=c(1,2),legend=list(list("bottom",2)))
panel_new()
panel_decor()
panel_lines(x,y,col="orange")
panel_points(x,y,cex=5,pch=21,col="transparent",bg="#00FF005F")
panel_points(0,0,pch=3)
panel_text(0,0,"North\nPole",pos=4,cex=1.5,family="Courier New",font=3)
panel_new()
panel_decor()
if (exists("sl"))
   panel_plot(sl,lwd=4,col="grey20")
if ((exists("ct"))&amp;&amp;(file.exists(shpname)))
   panel_plot(shpname,lwd=3,col=ct$colortable[ct$index])
if (exists("lab"))
   panel_points(lab$x,lab$y,pch=as.character(lab$z),cex=2)
if (exists("ct"))
   compose_legend(ct$colortable)
compose_close()
file.remove(dir(path=dirname(shpname)
               ,pattern=paste0(layername,"\\.(cpg|dbf|prj|shp|shx)")
               ,full.names=TRUE))
</code></pre>

<hr>
<h2 id='panel_raster'>
Add raster to the image panel
</h2><span id='topic+panel_raster'></span><span id='topic+.panel_raster'></span>

<h3>Description</h3>

<p>If specified image has 3 or 4 bands, then color composite is plotted on image panel, else the image is plotted regarding to its color table.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>panel_raster(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="panel_raster_+3A_...">...</code></td>
<td>
<p>Set of arguments, which are recognized via their names (using <a href="base.html#topic+regex">regular expressions</a>) and classes.
<br /> 1. Passed to <code><a href="#topic+colorize">colorize</a></code>.
<br /> 2. interpreted in this function:
</p>

<dl>
<dt><code>"(^$|obj)"</code> <var>as</var> <code>obj</code></dt><dd><p>Object of class <code>ursaRaster</code>. Raster band for plotting. Multiple bands are allowed if then can be interpreted as RGB or RGBA.</p>
</dd>
<dt><code>"useRaster"</code>  <var>as</var> <code>useRaster</code></dt><dd><p>Logical. If <code>TRUE</code> then a bitmap raster is used to plot the image instead of polygons. See argument <code>useRaster</code> in function <code><a href="graphics.html#topic+image">image</a></code>. Default depends on PNG device (<code>getOption("ursaPngDevice")</code>, which is set up in <code><a href="#topic+compose_open">compose_open</a></code>); it is <code>TRUE</code> for <code>"cairo"</code> device, and <code>FALSE</code> for <code>"windows"</code> device.</p>
</dd>
<dt><code>"interp(olate)*"</code> <var>as</var> <code>interpolate</code></dt><dd><p>Logical. Passed as argument <code>interpolate</code> to function <code><a href="graphics.html#topic+rasterImage">rasterImage</a></code>.</p>
</dd>
<dt><code>"(alpha|transp(aren(cy)*)*)"</code> <var>as</var> <code>alpha</code></dt><dd><p>Numeric or character. Level of transparency. If numeric, the either <code style="white-space: pre;">&#8288;0 &lt;= alpha &lt;= 1&#8288;</code> or <code>0 &lt;= alpha &lt;= 255</code>. If character, then one byte of hexadecimal value <code style="white-space: pre;">&#8288;"00" &lt;= alpha &lt;= "FF"&#8288;</code>. If <code>NA</code>, then transparency is used from colortable, else transparency of colortable is overwritten by <code>alpha</code>. Default is <code>NA</code>.</p>
</dd>
<dt><code>"verb(ose)*"</code> <var>as</var> <code>verbose</code></dt><dd><p>Logical. Value <code>TRUE</code> may provide some additional information on console. Default is <code>FALSE</code>.</p>
</dd>
</dl>

</td></tr>
</table>


<h3>Details</h3>

<p>If <code>obj</code> is list of raster images, then <code>panel_raster</code> is applied to each item of list, and colortable of last item is returned.
</p>
<p>If <code>obj</code> has 3 or 4 bands then <code>obj</code> is interpreted as RGB(A) image.
</p>
<p>Function attempts to speed up plotting by reduce image matrix for big rasters.
</p>


<h3>Value</h3>

<p>If argument <code>obj</code> has strictly one band, then function returns <a href="#topic+classColorTable">color table</a> - object of class <code>ursaColorTable</code>, which can be used as an input argument for the colorbar legend (function <code><a href="#topic+legend_colorbar">legend_colorbar</a></code>). Otherwise function returns <code>NULL</code> value.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
# example no.1 -- direct use
session_grid(regrid(mul=1/32))
dima &lt;- with(session_grid(),c(columns,rows,3))
a &lt;- ursa_new(value=array(runif(prod(dima),min=127,max=255),dim=dima))
p &lt;- colorize(a,pal=c("black","white"),ramp=TRUE,value=0:256)
compose_open(layout=c(2,3),skip=4,legend=list(list("top","full"),list("bottom",2:3)))
for (i in seq(6)) {
   panel_new()
   if (i&lt;4)
      panel_raster(p[i])
   else
      panel_raster(a,interpolate=i==5)
   panel_decor(col="black",coast=FALSE)
   panel_annotation(c("red","green","blue"
                    ,"interpolate=FALSE","interpolate=TRUE"))
}
legend_colorbar(p,label=seq(0,256,by=16),units="channels")
legend_mtext("color composite")
compose_close()

# example no.2 -- indirect use
ps &lt;- pixelsize(NULL)
display(ps,raster.verb=TRUE)

# example no.3 -- color table for legend
session_grid(NULL)
compose_open()
panel_new()
ct &lt;- panel_raster(ps,pal=terrain.colors)
panel_decor()
compose_legend(ct)
compose_close()

</code></pre>

<hr>
<h2 id='panel_scalebar'>
Add scale bar to the image panel
</h2><span id='topic+panel_scalebar'></span><span id='topic+.panel_scalebar'></span>

<h3>Description</h3>

<p><code>panel_scalebar</code> puts a scale bar ('box' style) on the panel with raster image.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>panel_scalebar(...)

# non-public
.panel_scalebar(position = "bottomleft", w = NA, cex = 0.85,
                col = "#0000002F", bg = "transparent", fill = "#FFFFFF2F",
                language=NA, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="panel_scalebar_+3A_...">...</code></td>
<td>
<p>Set of arguments, which are recognized via their names (using <a href="base.html#topic+regex">regular expressions</a>) and classes. Passed to non-public <code>.panel_scalebar</code>, excepting argument <code>scalebar</code>:
</p>

<table>
<tr>
 <td style="text-align: left;">
            <strong>Pattern</strong> (<code>panel_scalebar</code>) </td><td style="text-align: left;"> <strong>Argument</strong> (<code>.panel_scalebar</code>) </td><td style="text-align: left;"> <strong>Description</strong>
            </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(scalebar|ruler|decor)</code> </td><td style="text-align: left;">  </td><td style="text-align: left;"> Logical or integer. Responsible for should scale bar be displayed or not. If logical and <code>TRUE</code> then scale bars are plotted on all panel of layout. If logical and <code>FALSE</code> then scale bars are not displayed. If argument is a vector of positive integers, then scale bars are plotted only in the specified panels, which sequence is defined in <code><a href="#topic+compose_design">compose_design</a></code> function and returned from <code>getOption("ursaPngLayout")$layout</code>. Default is <code>TRUE</code>.
            </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(scalebar\\.)*pos(ition)*</code> </td><td style="text-align: left;"> <code>position</code> </td><td style="text-align: left;"> <em>See below</em>.
            </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(scalebar\\.)*w</code> </td><td style="text-align: left;"> <code>w</code> </td><td style="text-align: left;"> <em>See below</em>.
            </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(scalebar\\.)*cex</code> </td><td style="text-align: left;"> <code>cex</code> </td><td style="text-align: left;"> <em>See below</em>.
            </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(scalebar\\.)*col</code> </td><td style="text-align: left;"> <code>col</code> </td><td style="text-align: left;"> <em>See below</em>.
            </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(scalebar\\.)*fill</code> </td><td style="text-align: left;"> <code>fill</code> </td><td style="text-align: left;"> <em>See below</em>.
            </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(scalebar\\.)*bg</code> </td><td style="text-align: left;"> <code>bg</code> </td><td style="text-align: left;"> <em>See below</em>.
            </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(scalebar\\.)*language</code> </td><td style="text-align: left;"> <code>language</code> </td><td style="text-align: left;"> <em>See below</em>.
            </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(scalebar\\.)*verb(ose)*</code> </td><td style="text-align: left;"> <code>verbose</code> </td><td style="text-align: left;"> <em>See below</em>.
         </td>
</tr>

</table>

</td></tr>
<tr><td><code id="panel_scalebar_+3A_position">position</code></td>
<td>
<p>Character keyword or numeric of length 2 in the interval [0,1]. Defines the location of scale bar. If character, then one of the &quot;bottomleft&quot;, &quot;bottomright&quot;, &quot;topleft&quot;, &quot;topright&quot;, &quot;left&quot;, &quot;right&quot;, &quot;bottom&quot;, &quot;top&quot;, or &quot;center&quot;. If numeric then relative position on panel is defined using shift on horizontal and vertical axes from origin in the bottom-left corner. Default is <code>"bottomleft"</code>.</p>
</td></tr>
<tr><td><code id="panel_scalebar_+3A_w">w</code></td>
<td>
<p>Positive numeric. The length <em>in km</em> of scalebar's right segment. If <code>w=NA</code> then length of segment is defined automatically. Default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="panel_scalebar_+3A_cex">cex</code></td>
<td>
<p>Positive numeric. The relative font size for scalebar's labels. Default is <code>0.85</code>.</p>
</td></tr>
<tr><td><code id="panel_scalebar_+3A_col">col</code></td>
<td>
<p>Character. Primary fill color for scalebar box and scalebar labels. Default is <code>"#0000002F"</code>.</p>
</td></tr>
<tr><td><code id="panel_scalebar_+3A_fill">fill</code></td>
<td>
<p>Character. Secondary fill color for scalebar box. Default is <code style="white-space: pre;">&#8288;"#FFFFFF2F"&#8288;</code>.</p>
</td></tr>
<tr><td><code id="panel_scalebar_+3A_bg">bg</code></td>
<td>
<p>Character. Background color for the area of scalebar box and labels. Default is <code>"transparent"</code>.</p>
</td></tr>
<tr><td><code id="panel_scalebar_+3A_language">language</code></td>
<td>
<p>Character. Language for longitude and latitude captions. If <code>"ru"</code> then captions are in Russian else in English. Default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="panel_scalebar_+3A_verbose">verbose</code></td>
<td>
<p>Logical. Value <code>TRUE</code> may provide some additional information on console. Default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The scalebar has 2 left segments and 2 right segments. Left and right segments are separated by 0. The length of left segments is a half of length of right segments.
</p>
<p>Argument <code>scalebar</code> (or, synonym, <code>ruler</code>) is introduced for unconditional calling of <code>panel_scalebar</code> inside of high-level functions.
</p>
<p>Default <code>x=0</code> and <code>y=0</code> define the <code style="white-space: pre;">&#8288;"bottomleft"&#8288;</code> position of scale bar.
</p>
<p>If argument <code>scale</code> in the function <code><a href="#topic+compose_open">compose_open</a></code> is character, then the length of one segment is exactly 1 cm, and the total length of scalebar is 3 cm.
</p>
<p>If not <code>language="ru"</code> but environmental variable <code>LANGUAGE=ru</code> then labels are in Russian (cyrillics).
</p>
<p>The length distortions is taken into account for transverse Mercator (<code>"+proj=tmerc"</code>) projection regarding to location of scalebar.
</p>
<p>Scalebar (single occurence) can be controlled in high-level plot functions (<em>e.g.</em>, <code><a href="#topic+display">display</a></code>, <code><a href="#topic+compose_plot">compose_plot</a></code>, <code><a href="#topic+display_stack">display_stack</a></code>, <code><a href="#topic+display_brick">display_brick</a></code>, <code><a href="#topic+display_rgb">display_rgb</a></code>, <em>etc</em>.). 
</p>
<p>To plot scalebar, use argument <code>scalebar=TRUE</code> and prefix <code>(ruler|scalebar)</code> (<code>scalebar.*</code> or <code>ruler.*</code>) for scalebar's parameters, <em>e.g.</em>, <code>scalebar.pos="bottomright"</code>, <code>scalebar.cex=0.9</code>.
</p>
<p>Scalebar is not displayed for longlat projection (<code>"+proj=longlat"</code>), where units are degrees.
</p>


<h3>Value</h3>

<p>This function returns <code>NULL</code> value.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
# example no.1 -- direct usage
   a &lt;- colorize(pixelsize())
   compose_open(a)
   panel_new()
   panel_raster(a)
   panel_graticule()
   panel_coastline()
   panel_scalebar()
   compose_close()

# example no.2 -- indirect usage
   display_rgb(ursa_dummy(nband=3,min=0,max=255),coastline=FALSE
              ,scalebar=TRUE,scalebar.col="white",scalebar.fill="black")

# example no.3 -- for paper copy
   a &lt;- colorize(pixelsize(),breakvalue=seq(400,650,by=50),pal=c("gray90","gray30"))
   compose_open(scale="1:95000000",dpi=150,device="cairo",family="serif")
   compose_plot(a,units=expression(km^2)
               ,graticule=TRUE,coastline=FALSE,scalebar=TRUE,scalebar.pos=c(1,1))
   compose_close(bpp=8)

# example no.4 -- length distortion in the Transverse Mercator projection

   a1 &lt;- regrid(setbound=c(10,65,71,83),dim=c(100,100),crs=4326)
   a2 &lt;- polygonize(ursa_bbox(a1))
   a3 &lt;- spatial_transform(a2,3857)
   a4 &lt;- regrid(setbound=spatial_bbox(a3),res=20000,crs=spatial_crs(a3))
   compose_open(legend=NULL)
   panel_new("white")
   panel_coastline(fill="#00000010",detail="l")
  # panel_graticule()
   for (p in c("bottom","center","top"))
      panel_scalebar(pos=p,w=500)
   compose_close()

</code></pre>

<hr>
<h2 id='panel_shading'>
Shaded overlay by image mask
</h2><span id='topic+panel_shading'></span>

<h3>Description</h3>

<p>This specific function is designed to illustrate linear slope and areas of statistically significant slope on the same panel, however can be used commonly for shading by raster mask.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>panel_shading(obj, level = NA, col = NULL, density = 25, angle = c( -45, 45),
                  lwd = 1, lty = 1, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="panel_shading_+3A_obj">obj</code></td>
<td>

<p>Object of class <code>ursaRaster</code>. 
</p>
</td></tr>
<tr><td><code id="panel_shading_+3A_level">level</code></td>
<td>

<p>Positive numeric. Threshold for <code>obj</code> reclassification <code>{ obj&lt;(-level) | obj&gt;(+level) }</code>. If <code>NULL</code> then mask is created from non-<code>NA</code> values of <code>obj</code>. Default is <code>NULL</code>.
</p>
</td></tr>
<tr><td><code id="panel_shading_+3A_col">col</code></td>
<td>

<p><code>ursaColorTable</code> (<code>ursaRaster</code> with color table) or <code>character</code>. Color for shading lines (grid). If object of class <code>ursaColorTable</code>.<br />
Two colors on the limits of color vector are extracted to separate source values <code>&lt;=(-level)</code> and <code>&gt;=(+level)</code>.
</p>
</td></tr>
<tr><td><code id="panel_shading_+3A_density">density</code></td>
<td>

<p>Numeric. The density of shading lines, in lines per inch. Default is <code>25</code>. See description of argument <code>density</code> in function <code><a href="graphics.html#topic+polygon">polygon</a></code>.
</p>
</td></tr>
<tr><td><code id="panel_shading_+3A_angle">angle</code></td>
<td>

<p>Numeric. The slope of shading lines, given as an angle in degrees (counter-clockwise). Default is vector of length two <code>c(-45,45)</code>. See description of argument <code>angle</code> in <code><a href="graphics.html#topic+polygon">polygon</a></code> function.
</p>
</td></tr>
<tr><td><code id="panel_shading_+3A_lwd">lwd</code></td>
<td>

<p>Numeric. Line width for shading. Default is <code>1</code>. See description of <code>lwd</code> in <code><a href="graphics.html#topic+par">par</a></code> function
</p>
</td></tr>
<tr><td><code id="panel_shading_+3A_lty">lty</code></td>
<td>

<p>Numeric or character. Line type for shading. Default is <code>1</code>. See description of <code>lty</code> in <code><a href="graphics.html#topic+par">par</a></code> function.
</p>
</td></tr>
<tr><td><code id="panel_shading_+3A_verbose">verbose</code></td>
<td>

<p>Logical. If <code>TRUE</code> then progresss bar is appeared. Default is <code>TRUE</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Values of input <code>obj</code> is reclassified to raster mask: { values<code>&lt;=(-level)</code> OR values<code>&gt;=(+level)</code> }. For common use, select appropriate <code>level</code> and, if necessary, reclassify <code>obj</code> prior.
</p>
<p>Color limits are extracted using <code><a href="base.html#topic+range">range</a></code> function.
</p>
<p>Raster images can be used for colored shading using <code>alpha</code> argument of <code><a href="#topic+panel_raster">panel_raster</a></code> function, e.g. <code>panel_raster(a,alpha=3/4)</code>
</p>


<h3>Value</h3>

<p><code>NULL</code>
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
if (first.example &lt;- TRUE) {
   session_grid(NULL)
   session_grid(regrid(mul=1/8))
   ps &lt;- pixelsize()
   compose_open()
   ct &lt;- compose_panel()
   panel_shading(ps&gt;1.1*global_mean(ps),angle=90)
   compose_legend(ct)
   compose_close()
}
if (second.example &lt;- TRUE) {
   session_grid(NULL)
   a &lt;- ursa_dummy(nband=15,mul=1/8)
   b &lt;- local_stat(a)
   compose_open()
   lev &lt;- 0.90
   d &lt;- as.matrix(b["slopeS"],coords=TRUE)
   e &lt;- contourLines(d,levels=c(-lev,lev))
   p &lt;- list(significance.raw=colorize(b["slopeS"])
            ,significance.formatted=colorize(b["slopeS"],stretch="significance")
            ,slope=colorize(b["slope"]))
   p &lt;- c(p,rep(p[3],3))
   names(p)[c(3,4,5)] &lt;- c("Slope and shaded significance"
                          ,"Slope and contoured significance"
                          ,"Slope and 'contourLines'")
   compose_open(p,layout=c(2,NA),byrow=FALSE)
   compose_panel(p[1])
   compose_panel(p[2])
   compose_panel(p[3])
   panel_shading(b["slopeS"],level=lev)
   compose_panel(p[4])
   panel_contour(b["slopeS"],value=c(-lev,lev))
   compose_panel(p[5])
   lapply(e,panel_polygon)
   compose_panel(p[6])
   ct &lt;- panel_contour(b["slopeS"],"color"
                      ,value=c(-0.99,-0.95,-0.9,-0.5,0.5,0.9,0.95,0.99))
   compose_legend(c(head(p,-1),'(Colorbar for contours)'=list(ct)),las=3)
   compose_close()
}
</code></pre>

<hr>
<h2 id='pixelsize'>
The actual size of each grid cell with considerable distortion in area of map projection.
</h2><span id='topic+pixelsize'></span>

<h3>Description</h3>

<p>This function helps to calculate size of pixels in the unit of area (squared km) for zonal statistics with taking into account distortion in area for classes of projections.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pixelsize(obj, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pixelsize_+3A_obj">obj</code></td>
<td>

<p>Either <code>ursaRaster</code> object or <code>ursaGrid</code> object or <code>NULL</code> or <code><a href="base.html#topic+missing">missing</a></code>.
</p>
</td></tr>
<tr><td><code id="pixelsize_+3A_verbose">verbose</code></td>
<td>

<p>Logical. Value <code>TRUE</code> may provide some additional information on console. Default is <code>FALSE</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>pixelsize()</code> is applied to coordinate reference system (grid) of <code>ursaRaster</code> object or to <a href="#topic+classGrid">raster grid</a> directly. If argument <code>obj</code> is <a href="base.html#topic+missing">missed</a>, then <a href="#topic+session">session grid</a> is used.
</p>
<p>Currently, only <em>Stereographic</em> (<code>"+stere"</code> in PROJ.4 notation), <em>Mercator</em> (<code>"+merc"</code>), and <em>Lambert Azimuthal Equal Area</em> (<code>"+laea"</code>) classes of map projections are implemented, though the last one (LAEA) has no distortion in area.
</p>


<h3>Value</h3>

<p>Object of class <code>ursaRaster</code>, single-band. If size of cell is more than <code>10e5</code> square meters, then the unit is squared kilometers (band name is &quot;Pixel Size (sq.km)&quot;) else squared meters (band name is &quot;Pixel Size (sq.m)&quot;).
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
pixelsize()

 ## internet connection is required; access was tested on 2018-06-04
invisible({
   dpath &lt;- file.path("ftp://sidads.colorado.edu/pub/DATASETS"
                     ,"nsidc0081_nrt_nasateam_seaice/north")
   dst &lt;- tempfile(fileext=".bin")
   isOK &lt;- FALSE
   d3 &lt;- Sys.Date()
   for (i in seq(5)) {
      src &lt;- file.path(dpath,format(d3,"nt_%Y%m%d_f18_nrt_n.bin"))
      a &lt;- try(download.file(src,dst,mode="wb"))
      if ((is.integer(a))&amp;&amp;(a==0)) {
         isOK &lt;- TRUE
         break
      }
      d3 &lt;- d3-1
   }
   if (isOK) {
      g1 &lt;- regrid(bbox=c(-385,-535,375,585)*1e4,res=25*1e3
                  ,crs=paste("+proj=stere +lat_0=90 +lat_ts=70 +lon_0=-45"
                            ,"+k=1 +x_0=0 +y_0=0 +a=6378273 +b=6356889.449"
                            ,"+units=m +no_defs"))
      session_grid(g1)
      b &lt;- readBin(dst,integer(),size=1L,n=136492L,signed=FALSE)
      ice &lt;- ursa_new(value=tail(b,-300))
      ice[ice&gt;251] &lt;- NA ## keep Pole
      ice[ice==251] &lt;- 250 ## consider 100% ice at Pole
      ice &lt;- ice/2.5 ## uncategorize
      ice[ice&lt;15] &lt;- 0 ## not ice, if less 15%
      ice[ice&gt;0] &lt;- 100
      extent1 &lt;- band_sum(ice*1e-2*ursa(ice,"cell")^2*1e-6)*1e-6
      extent2 &lt;- band_sum(ice*1e-2*pixelsize(ice))*1e-6
      message(paste("Near real-time Arctic sea ice extent (NASA Team algorithm, NSIDC)"))
      message(sprintf("   Direct area calculation:         %5.2f*1e6 km^2.",extent1))
      message(sprintf("   Distortion in area is corrected: %5.2f*1e6 km^2.",extent2))
   }
   else
      message("It is failed to get sea ice concentration data.")
})

</code></pre>

<hr>
<h2 id='plot'>
Simple display of raster images
</h2><span id='topic+plot.ursaRaster'></span><span id='topic+image.ursaRaster'></span>

<h3>Description</h3>

<p>Function <code>image</code> for <code>ursaRaster</code> object calls generic function <code><a href="graphics.html#topic+image">image</a></code>.
<br />
Function <code>plot</code> for <code>ursaRaster</code> object calls function <code><a href="graphics.html#topic+filled.contour">filled.contour</a></code>.
<br />
<a href="#topic+classColorTable">Color tables</a> are supported.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaRaster'
plot(x, ...)

## S3 method for class 'ursaRaster'
image(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_+3A_x">x</code></td>
<td>

<p>Object of class <code>ursaRaster</code>
</p>
</td></tr>
<tr><td><code id="plot_+3A_...">...</code></td>
<td>

<p>Other parameters. Are passed to or <code><a href="graphics.html#topic+filled.contour">filled.contour</a></code> or to generic function <code><a href="graphics.html#topic+image">image</a></code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Usage of both these functions is justified for low-level control of plotting. It is recommended to use high-level function <code><a href="#topic+display">display</a></code>. It is flexible and power instrument for raster images visualization.
</p>
<p>Function <code><a href="#topic+classStack">as.list</a></code> for <code>ursaRaster</code> object transforms single band of raster image to a suitable object for plotting via function <code><a href="graphics.html#topic+image">image</a></code> from package <span class="pkg">graphics</span>
</p>


<h3>Value</h3>

<p>Returned value from <code><a href="graphics.html#topic+image">image</a></code> or <code><a href="graphics.html#topic+filled.contour">filled.contour</a></code> (both functions are in the package <span class="pkg">graphics</span>)
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+display">display</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- pixelsize()
plot(a,asp=1)
image(a,asp=1)
b &lt;- colorize(a,ncolor=15)
plot(b,asp=1)
image(b,asp=1)
</code></pre>

<hr>
<h2 id='polygonize'>
Raster to vector (polygon) conversion.
</h2><span id='topic+polygonize'></span>

<h3>Description</h3>

<p>Representing each raster cell as a polygon. In comparison to common GIS raster to vector conversion, where neighbor cells with the same value are combined to the single polygon, the number of output polygons is equal to number of non-<code>NA</code> values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>polygonize(obj, fname, engine = c("native", "sf"), verbose = NA, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="polygonize_+3A_obj">obj</code></td>
<td>

<p>Object of class <code>ursaRaster</code>.
</p>
</td></tr>
<tr><td><code id="polygonize_+3A_fname">fname</code></td>
<td>

<p>Missing or character. If specified, then ESRI Shapefile is created. Default is <a href="base.html#topic+missing">missing</a>.
</p>
</td></tr>
<tr><td><code id="polygonize_+3A_engine">engine</code></td>
<td>

<p>Character keyword from list <code>c("native", "sf")</code>. Define package with tools for creating spatial data. If suggested packaged <span class="pkg">&quot;sp&quot;</span> is loaded or can be loaded from default location, then <code>"sp"</code> is added to this list. If <code>engine="sf"</code>, then functions from package <span class="pkg">sf</span> are used. If <code>engine="sp"</code>, then functions from package <span class="pkg">sp</span> are used. If <code>engine="native"</code>, then appropriate package is used based on loaded namespaces before.
</p>
</td></tr>
<tr><td><code id="polygonize_+3A_verbose">verbose</code></td>
<td>

<p>Logical. If <code>TRUE</code> then convertion is attended by progress bar. Default is <code>NA</code>; it means <code>TRUE</code> for <code>engine="sp"</code> and <code>FALSE</code> for <code>engine="sp"</code>.
</p>
</td></tr>
<tr><td><code id="polygonize_+3A_...">...</code></td>
<td>

<p>Additional arguments, which are passed to internal function for writing ESRI Shapefile.
</p>

<dl>
<dt><code>compress</code></dt><dd><p>Logical. Should output ESRI Shapefile files be compressed by zip? Default is <code>FALSE</code>.</p>
</dd>
</dl>

</td></tr>
</table>


<h3>Details</h3>

<p>Some GIS software (e.g., QGIS) has broad tools for display vector data. Excepting choroplets, it is assumed that visualization of each cell separately is more attractive than displaying of polygons with different forms, which are produced, for example, by GDAL convertion utillity <a href="https://gdal.org/en/latest/programs/gdal_polygonize.html">gdal_polygonize.py</a>.
</p>


<h3>Value</h3>

<p>If missing <code>fname</code> and tools from <span class="pkg">sp</span> then object of class &quot;SpatialPolygonsDataFrame&quot; (package <span class="pkg">sp</span>).
If missing <code>fname</code> and tools from <span class="pkg">sf</span> then object of class &quot;sf&quot; with geometry of class &quot;sfc_POLYGON&quot; (package <span class="pkg">sf</span>).
<br />
If <code>fname</code> is specified, then <code>NULL</code>.
</p>


<h3>Note</h3>

<p>Implementation is very slow even for moderate image size. Use progress bar (<code>verbose=TRUE</code>) to control this process.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- ursa_dummy(mul=1/16)
a &lt;- a[a&gt;100]
print(a)
print(band_mean(a))
b2 &lt;- polygonize(a,engine=ifelse(requireNamespace("sp"),"sp","sf"))
print(class(b2))
print(colMeans(spatial_data(b2),na.rm=TRUE))
str(e1 &lt;- spatial_bbox(a))
str(e2 &lt;- spatial_bbox(b2))
print(as.numeric(e1))
print(as.numeric(e2))
</code></pre>

<hr>
<h2 id='read_envi'>
Read ENVI .hdr Labelled Raster file to memory
</h2><span id='topic+read_envi'></span>

<h3>Description</h3>

<p>Reads all or several bands of ENVI .hdr Labelled Raster file from disk to memory.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_envi(fname, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="read_envi_+3A_fname">fname</code></td>
<td>

<p>Character. Filename for ENVI .hdr Labelled Raster file.
</p>
</td></tr>
<tr><td><code id="read_envi_+3A_...">...</code></td>
<td>

<p>For <code>read_envi</code>: Set of arguments, which are recognized via their names (using <a href="base.html#topic+regex">regular expressions</a>) and classes. In the case of grids mismatch some arguments (e.g., <code>resample</code>) are passed to <code><a href="#topic+regrid">regrid</a></code> function.
</p>

<dl>
<dt><code>(subset)*</code></dt><dd><p><em>Name can be omitted.</em> Integer or character. If integer, then indices of bands, either positive or negative. Positive indices are for included bands, negative indices for omitted bands. If character, then either sequence of band names or regex string. By default (<code>subset=NULL</code>), function reads all bands.</p>
</dd>
<dt><code>(ref)*</code></dt><dd><p><em>Name can be omitted.</em> <code>ursaRaster</code> or <code>ursaGrid</code> object. Reference grid for raster image resizing. By default (<code>ref=NULL</code>) there is no resizing.</p>
</dd>
<dt><code>(nodata|ignorevalue)</code></dt><dd><p>Numeric. Value, which is ignored. By default (<code>nodata=NaN</code>) igrore value is taken from ENVI metadata (*.hdr or *.aux.xml).</p>
</dd>
<dt><code>reset(Grid)*</code></dt><dd><p>Logical. If <code>TRUE</code>, then <a href="#topic+session">session grid</a> is ignored, and new session grid is assigned from input file. If <code>FALSE</code>, then input file is nested in the session grid.</p>
</dd>
<dt><code>cache</code></dt><dd><p>Integer. Using cache for compressed files. <code>0L</code> - do not use cache, <code>1L</code> - use cache; any other value resets cache. Default is <code>FALSE</code>.</p>
</dd>
<dt><code>verb(ose)*</code></dt><dd><p>Logical. Value <code>TRUE</code> may provide some additional information on console. Default is <code>FALSE</code>.</p>
</dd>
</dl>

</td></tr>
</table>


<h3>Details</h3>

<p>Function <code>read_envi</code> is designed to one-time reading (from disk to memory) ENVI .hdr Labelled Raster file. For multiple access to disk (by chunks), use followed construction: </p>
<pre>
a &lt;- open_envi(fname)
d1 &lt;- a[condition_1]
d2 &lt;- a[condition_2]
...
close(a)
</pre>
<p>In this case, the connection keeps open. The gain is more effective for compressed binary files.
</p>


<h3>Value</h3>

<p>Object of class <code>ursaRaster</code>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+conn.open_envi">open_envi</a></code>, <em><a href="#topic+classRaster.Extract">Extract</a></em> method <code><a href="#topic+classRaster.Extract">[</a></code> for <code>ursaRaster</code> object, <code><a href="#topic+classRaster_close">close_envi</a></code>.
</p>
<p><code><a href="#topic+conn.read_gdal">read_gdal</a></code> uses GDAL (<span class="pkg">rgdal</span>) to read ENVI .hdr Labelled Raster file.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
fname &lt;- tempfile()
a &lt;- ursa_dummy()
bandname(a) &lt;- c("first","second","third")
write_envi(a,fname,compress=FALSE)

print(read_envi(fname))
print(read_envi(fname,c(1,3)))
print(read_envi(fname,-c(1,3)))
print(read_envi(fname,c("first","third")))
print(read_envi(fname,"iR"))

print(session_grid())
g &lt;- regrid(session_grid(),mul=1/2.3)
b &lt;- read_envi(fname,ref=g)
print(session_grid())
print(b)

envi_remove(fname)
</code></pre>

<hr>
<h2 id='read_gdal'>
Read GDAL supported raster files.
</h2><span id='topic+read_gdal'></span><span id='topic+ursa_read'></span>

<h3>Description</h3>

<p><code>read_gdal</code> creates <code>ursaRaster</code> object from GDAL supported raster files using functions from packages with low-level raster reading.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_gdal(fname, resetGrid = TRUE, band = NULL,
          engine = c("native", "sf"),
          verbose = FALSE, ...)

ursa_read(fname, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="read_gdal_+3A_fname">fname</code></td>
<td>

<p>Character. GDAL supported raster file name.
</p>
</td></tr>
<tr><td><code id="read_gdal_+3A_resetgrid">resetGrid</code></td>
<td>

<p>Logical. If <code>TRUE</code> then new sessional grid is based on opened raster image. Default is <code>TRUE</code>
</p>
</td></tr>
<tr><td><code id="read_gdal_+3A_band">band</code></td>
<td>

<p>Character (<a href="base.html#topic+regex">regular expression</a>) or integer.
</p>
</td></tr>
<tr><td><code id="read_gdal_+3A_engine">engine</code></td>
<td>

<p>Character. Functionality of which package is used for reading data. This is experimental list, which future depends on evolution of reviewed packages and their availability for partial reading of multiband rasters.
</p>
</td></tr>
<tr><td><code id="read_gdal_+3A_verbose">verbose</code></td>
<td>

<p>Logical. Value <code>TRUE</code> may provide some additional information on console. Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="read_gdal_+3A_...">...</code></td>
<td>

<p>Ignored.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>ursa_read</code> is simplified implementation of <code>gdal_read</code>.
</p>
<p>The composite GDAL formats (e.g., <a href="https://gdal.org/en/latest/drivers/raster/netcdf.html">NetCDF: Network Common Data Format</a>, <a href="https://gdal.org/en/latest/drivers/raster/hdf5.html">HDF5: Hierarchical Data Format Release 5</a>) are likely unsupported.
</p>
<p><code>read_gdal</code> uses functions from other other packages. It's a wrapper.
</p>
<p>Category names and color tables are supported.
</p>


<h3>Value</h3>

<p>Object of class <code><a href="#topic+classRaster">ursaRaster</a></code>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ursa_as">as.ursa</a></code> is an alternative call for GDAL raster files import.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)

# rgdal::gdalDrivers()
if (requireNamespace("sf"))
   print(sf::st_drivers())
if (file.exists(Fin1 &lt;- system.file("gdal/gdalicon.png",package="sf"))) {
   a1 &lt;- read_gdal(Fin1)
   print(a1)
   display(a1)
}
Fin2 &lt;- tempfile(fileext=".")
a &lt;- ursa_dummy(1,resetGrid=TRUE)
b &lt;- colorize(a[a&gt;91],stretch="equal",name=format(Sys.Date()+seq(0,6),"%A %d"))
write_envi(b,Fin2)
b1 &lt;- read_gdal(Fin2)
b2 &lt;- read_envi(Fin2,resetGrid=TRUE)
envi_remove(Fin2)
print(c('same colortable?'=identical(ursa_colortable(b1),ursa_colortable(b2))))
print(ursa_colortable(b1))
print(as.table(b1))
print(c('same values?'=identical(ursa_value(b1),ursa_value(b2))))
print(c('same grid?'=identical(ursa_grid(b1),ursa_grid(b2))))
if (requireNamespace("sf")) {
   p1 &lt;- sf::st_crs(ursa_crs(b1))
   p2 &lt;- sf::st_crs(ursa_crs(b2))
   print(c('same proj4string for CRS?'=identical(p1$proj4string,p2$proj4string)))
   print(c('same WKT for CRS?'=identical(p1$Wkt,p2$Wkt)))
   ursa_crs(b1) &lt;- ursa_crs(b2)
   print(c('after same CRS, same grid?'=identical(ursa_grid(b1),ursa_grid(b2))))
}
display(b1,detail="l")
</code></pre>

<hr>
<h2 id='reclass'>
Reclassify specific values of image
</h2><span id='topic+reclass'></span>

<h3>Description</h3>

<p>This is look-up table reclassification: the destination value is found for each source value.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>reclass(obj, dst = NULL, src = NULL, sparse = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="reclass_+3A_obj">obj</code></td>
<td>

<p>Object of class <code>ursaRaster</code> or <code>ursaColorTable</code>.
</p>
</td></tr>
<tr><td><code id="reclass_+3A_dst">dst</code></td>
<td>

<p>Object of class <code>ursaRaster</code>, or object of class <code>ursaColorTable</code>, or numeric vector. If numeric, then the desired destination set of values, else reference object for reclassification; this object should have numerical values of categories.
</p>
</td></tr>
<tr><td><code id="reclass_+3A_src">src</code></td>
<td>

<p>Numerical vector, but allowed using with numerical vector of <code>dst</code> and <code>length(src)==length(dst)</code>. Source set of values.
</p>
</td></tr>
<tr><td><code id="reclass_+3A_sparse">sparse</code></td>
<td>

<p>Logical. If image has a lot of <code>NA</code> values then <code>sparse=TRUE</code> may speed up transformation. Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="reclass_+3A_...">...</code></td>
<td>

<p>Other arguments are used for classification in the function <code><a href="#topic+colorize">colorize</a></code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>dst</code> is numeric vector, then the source value have to be specific, without any ranges. It is required the equality lengths of <code>src</code> and <code>dst</code>. If image has <a href="#topic+classColorTable">color table</a> then function tries reconstruct <code>dst</code> from names of <a href="#topic+classColorTable">categories</a>.
</p>
<p>This function can be used for data compression for storage, e.g. for distribution or interchange.
</p>


<h3>Value</h3>

<p>If <code>obj</code> is object of class <code>ursaColorTable</code> then numeric vector of categories' centers.
</p>
<p>If <code>dst</code> is numeric, then object of class <code>ursaRaster</code> without <a href="#topic+classColorTable">color table</a>.
</p>
<p>If <code>dst</code> is <code>ursaColorTable</code> then object of class <code>ursaRaster</code> (<code>NA</code> values) in <a href="#topic+classColorTable">color table</a>.
</p>
<p>If <code>dst</code> is <code>NULL</code> then object of class <code>ursaRaster</code> with empty color names (<code>NA</code> values) in <a href="#topic+classColorTable">color table</a>.
</p>


<h3>Note</h3>

<p>There were no a lot of tests how GIS software reads &quot;ENVI .hdr Labelled Raster&quot; files with color tables without color values (only <em>categories</em>). At least, <a href="https://gdal.org/en/latest/drivers/raster/envi.html">GDAL</a> recognizes categories (<a href="https://gdal.org/en/latest/programs/gdalinfo.html"><code>gdalinfo</code></a> utility).
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p>The reclassification from interval source values to specific destination values is used in <code><a href="#topic+colorize">colorize</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
# example no.1 manual classification
a &lt;- as.ursa(round(matrix(runif(100,min=0.5,max=3.5),ncol=10)))
print(as.table(a))
b &lt;- reclass(a,src=c(3,1,2),dst=round(runif(3),2))
print(as.table(b))
print(c(src=a,dst=b))

# example no.2 -- similarity to other object
session_grid(NULL)
a &lt;- ursa_dummy(nband=2,min=-1,max=1)
print(a)
b1 &lt;- colorize(a[1],value=seq(-1,1,length=21),pal.rich=240,pal.rotate=0)
b2 &lt;- reclass(a[2],b1)
b3 &lt;- reclass(a[2],ursa_colortable(b2))
b &lt;- c(b1,b2,b3)
print(reclass(b))

# example no.3 -- compression with data lost
a &lt;- pixelsize(NULL)
b &lt;- reclass(a,byte=TRUE,tail=0) ## try 'byte=FALSE'
a2 &lt;- reclass(b)
res &lt;- c(source=a,as_category=a2,difference=a-a2)
print(res)
message(paste("RMS error: ",format(sqrt(band_sum(res[3]^2)/band_n(res[3])))))
prefix &lt;- names(res)[1:2]
fname &lt;- file.path(tempdir(),paste0(prefix,".envi"))
s &lt;- data.frame(object.size=sapply(list(a,b),object.size))
rownames(s) &lt;- prefix
print(s)
write_envi(a,fname[1])
write_envi(b,fname[2])
f &lt;- file.info(dir(path=tempdir()
                  ,pattern=paste0("(",prefix,")\\.(envi|hdr)",sep="|")
                  ,full.names=TRUE))[,"size",drop=FALSE]
colnames(f) &lt;- "file.size"
print(f)
envi_remove(fname)
</code></pre>

<hr>
<h2 id='regrid'>
Change raster image resolution and extent
</h2><span id='topic+regrid'></span><span id='topic+.regrid'></span>

<h3>Description</h3>

<p>General function to change parameters of cells under the same geographical projection. It is implemented via raster resampling to the new grid.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>regrid(x, ...)

## non-public
.regrid(grid = NULL, mul = NA, res = NA, resx = NA, resy = NA, setbound = NA,
        columns = NA, rows = NA, dim = NA, bbox = NA, expand = NA,
        minx = NA, miny = NA, maxx = NA, maxy = NA, cut = NA, proj4 = NA, crs = NA,
        border = 0, zero = c("keep", "node", "center"), raster = FALSE, tolerance = NA,
        zoom = NA, adjust = c(0.5, 0.5), verbose = FALSE, ...)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="regrid_+3A_x">x</code></td>
<td>

<p>Object of class <code>ursaRaster</code>.
</p>
</td></tr>
<tr><td><code id="regrid_+3A_...">...</code></td>
<td>

<ol>
<li><p> Arguments, which are passed to non-public <code>.regrid</code> to define parameters of new grid.
</p>
</li>
<li><p> Set of arguments, which are recognized via their names (using <a href="base.html#topic+regex">regular expressions</a>) and classes:
</p>

<dl>
<dt><code>^reset(Grid)*</code></dt><dd><p>Logical. Whether new grid will be defined as a sessional parameter? If <code>TRUE</code> then returned raster defines new sessional grid. If <code>FALSE</code> then session grid is not changed. Default is <code>TRUE</code>.</p>
</dd>
<dt><code>resample</code></dt><dd><p>Logical or positive numeric. The range of aggregation in the units of cell area. If <code>0</code> or <code>FALSE</code> then &quot;nearest neighbor&quot; value is used. The <code>resample&gt;0</code> defines the side of rectangular area in proportion to cell size; and aggregation of adjacent cells is weighted in proportion to overlapping parts of cells. Default is <code>1</code> (or, equally, <code>TRUE</code>); it means that value of output cell is weighted mean of values of overlapped input cells in proportion of overlapping of output cell by input cells.</p>
</dd>
<dt><code>cover</code></dt><dd><p>Positive numeric in the range <code>[0, 1]</code>. The maximal fraction of <code>NA</code> values in adjusted input cells for the rule to write <code>NA</code> value to the output cell. Default is <code>0.499</code>.</p>
</dd>
<dt><code>cascade</code></dt><dd><p>Logical. Option to get more smooth results. If <code>TRUE</code> and <code>resample&gt;2</code> then <code>resize</code> function is applied sequentially with argument <code>resample&lt;=2</code>.</p>
</dd>
<dt><code>verb(ose)*</code></dt><dd><p>Logical. Value <code>TRUE</code> may provide some additional information on console. Default is <code>FALSE</code>.</p>
</dd>
</dl>

</li></ol>

</td></tr>
<tr><td><code id="regrid_+3A_grid">grid</code></td>
<td>

<p>Reference <code><a href="#topic+classGrid">ursaGrid</a></code> or <code>ursaRaster</code> object. If missing then reference grid is obtained from sessional grid <code>session_grid()</code>
</p>
</td></tr>
<tr><td><code id="regrid_+3A_mul">mul</code></td>
<td>

<p><code>numeric</code> of length 1. Multiplication for changing image size by means of changing of cell size (<code>1/mul</code>). <code>mul&gt;1</code> decreases cell size, <code>mul&lt;1</code> increases cell size
</p>
</td></tr>
<tr><td><code id="regrid_+3A_res">res</code></td>
<td>

<p><code>numeric</code> of length 1 or 2. New grid size by horizontal and vertical axes. If length is 1 then the same grid size for both axes.
</p>
</td></tr>
<tr><td><code id="regrid_+3A_resx">resx</code></td>
<td>

<p>Positive <code>numeric</code> of length 1. New grid size by horizontal axis.
</p>
</td></tr>
<tr><td><code id="regrid_+3A_resy">resy</code></td>
<td>

<p>Positive <code>numeric</code> of length 1. New grid size by vertical axis.
</p>
</td></tr>
<tr><td><code id="regrid_+3A_setbound">setbound</code></td>
<td>

<p><code>numeric</code> of length 4. Change units of spatial extension and define new spatial extension (boundary box) in the notation <code>c(minx,miny,maxx,maxy)</code>. 
</p>
</td></tr>
<tr><td><code id="regrid_+3A_columns">columns</code></td>
<td>

<p>Positive <code>integer</code> of length 1. Number of columns/samples in the case of definition of new spatial extension (<code>setbound</code> is non-<code>NA</code>).
</p>
</td></tr>
<tr><td><code id="regrid_+3A_rows">rows</code></td>
<td>

<p>Positive <code>integer</code> of length 1. Number of rows/lines in the case of definition of new spatial extension (<code>setbound</code> is non-<code>NA</code>).
</p>
</td></tr>
<tr><td><code id="regrid_+3A_dim">dim</code></td>
<td>

<p>Positive <code>integer</code> of length 2. Dimenstion of raster image in the notation <code>c(rows, columns)</code> (or, <code>c(lines, samples)</code>) in the case of definition of new spatial extension (<code>setbound</code> is non-<code>NA</code>).
</p>
</td></tr>
<tr><td><code id="regrid_+3A_bbox">bbox</code></td>
<td>

<p><code>numeric</code> of length 4. New spatial extension (boundary box) in the notation <code>c(minx,miny,maxx,maxy)</code> in the same units of existing spatial extension.
</p>
</td></tr>
<tr><td><code id="regrid_+3A_minx">minx</code></td>
<td>

<p><code>numeric</code> of length 1. New value for left boundary.
</p>
</td></tr>
<tr><td><code id="regrid_+3A_miny">miny</code></td>
<td>

<p><code>numeric</code> of length 1. New value for bottom boundary.
</p>
</td></tr>
<tr><td><code id="regrid_+3A_maxx">maxx</code></td>
<td>

<p><code>numeric</code> of length 1. New value for right boundary.
</p>
</td></tr>
<tr><td><code id="regrid_+3A_maxy">maxy</code></td>
<td>

<p><code>numeric</code> of length 1. New value for top boundary.
</p>
</td></tr>
<tr><td><code id="regrid_+3A_cut">cut</code></td>
<td>

<p><code>numeric</code> of length 4. Vector (left, bottom, right, top) in CRS units for extent expand.
</p>
</td></tr>
<tr><td><code id="regrid_+3A_border">border</code></td>
<td>

<p><code>numeric</code> of length 1 or 4. If length 4, then vector (bottom, left, top, right) in cells for extent expand. If length &lt;4, then value is repeated for length 4.
</p>
</td></tr>
<tr><td><code id="regrid_+3A_proj4">proj4</code></td>
<td>

<p><code>character</code> of length 1. New projection string in the PROJ.4 notation
</p>
</td></tr>
<tr><td><code id="regrid_+3A_crs">crs</code></td>
<td>

<p><code>character</code> of length 1. The synonym to <code>proj4</code>.
</p>
</td></tr>
<tr><td><code id="regrid_+3A_expand">expand</code></td>
<td>

<p><code>numeric</code> of length 1. Multiplier of boundary box.
</p>
</td></tr>
<tr><td><code id="regrid_+3A_raster">raster</code></td>
<td>

<p><code>logical</code>. Should return blank <code>ursaRaster</code> object instead of <code><a href="#topic+classGrid">ursaGrid</a></code> object? See &lsquo;Value&rsquo; section
</p>
</td></tr>
<tr><td><code id="regrid_+3A_zero">zero</code></td>
<td>

<p><code>character</code>. Define central cell position relative to zero coordinates. If value is &quot;keep&quot;, then central cell position is without changes. If value is &quot;node&quot;, then zero coordinates are on the crossing of cell borders. If value is &quot;center&quot;, then zero coordinates are in the center of central cell. <em>Currently is not implemented. If grid is consistent, then value &quot;keep&quot; is used, else &quot;node&quot;</em>.
</p>
</td></tr>
<tr><td><code id="regrid_+3A_tolerance">tolerance</code></td>
<td>

<p><code>numeric</code>. Threshold for comparison float point numerics. Required for internal check of grid consistence. Default is <code>NA</code>; value <code>.Machine$double.eps</code> multiplied on maximal value of coordinates is used.
</p>
</td></tr>
<tr><td><code id="regrid_+3A_zoom">zoom</code></td>
<td>

<p><code>numeric</code>. Tweak for simultaneous change of <code>expand</code> and <code>mul</code>: <code>expand=zoom</code>, <code>mul=1/zoom</code>. Default is <code>NA</code>.
</p>
</td></tr>
<tr><td><code id="regrid_+3A_adjust">adjust</code></td>
<td>

<p><code>numeric</code> of length 2. Dragging horizontal and vertical expansion for argument <code>expand</code>. Value <code>0.0</code> means expansion to the left or to the bottom. Value <code>1.0</code> means expansion to the right or to the top. Value <code>0.5</code> means equal horizontal or vertical expansion. Default is <code>c(0.5,0.5)</code>.
</p>
</td></tr>
<tr><td><code id="regrid_+3A_verbose">verbose</code></td>
<td>

<p>Reporting via <code>message</code> about violation and restoration of coordinate grid regilarity after non-consistence usage of parameters.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Generally, argument <code>resample</code> sets a rectangular region. The area of this region is in proportion to area of output cell. Argument <code>resample</code> is the value of this proportion. Each cell is interpreted as a set of adjoining rectangular figures. The value of output cells is a weighted mean of that input cells, which fall into rectangular region. The weights are defined as an partial area inside of rectangular region.
</p>
<p>Function implements &quot;nearest neighbor&quot; resampling method if argument <code>resample=0</code> (or, <code>resample=FALSE</code>). If <code>resample=1</code> (or, <code>resample=TRUE</code>) and both input and output rasters have the same cell size, then resampling method is &quot;bilinear interpolation&quot;.
</p>
<p>Expand raster <code>x</code> to 3 times with cell repeating: <code>regrid(x,mul=3,resample=FALSE) ## nearest neighbor</code>;<br />
Expand raster <code>x</code> to 3 times with cell aggregation: <code>regrid(x,mul=3,resample=TRUE) ## bilinear interpolation</code>;<br />
Contract raster <code>x</code> to 3 times without cell aggregation: <code>regrid(x,mul=1/3,resample=FALSE) ## nearest neighbor</code>;<br />
Contract raster <code>x</code> to 3 times with cell aggregation: <code>regrid(x,mul=1/3,resample=TRUE) ## weighted mean</code>;<br />
Low-pass filtering by <code>3 x 3</code> window size: <code>regrid(x,resample=3*3) ##</code> see <code><a href="#topic+Ops.focal_mean">focal_mean</a></code>
</p>
<p>However, simple contraction <code>regrid(x,mul=1/2,resample=FALSE)</code> is implemented as contration with aggregation (<code>regrid(x,mul=1/2,resample=FALSE)</code>), because centers or output cells are located in the nodes (crossing of boundaries of input cells).
</p>
<p>It seems that for categorical rasters parameter <code>resample=0</code> is more suitable, because nearest neigboring does not introduce new values to output raster, excepting coincidence of input cells' nodes and output cell centers.
</p>
<p>Usage of <code>proj4</code> argument specifies only desirable PROJ.4 string and does not do reprojection.
</p>
<p>The violation of grid regualarity is due to columns and rows of image should be integer. The restoration of grid regularity is realized by spatial extension (boundary box) expansion.
</p>


<h3>Value</h3>

<p><code>regrid</code> returns object of class <code>ursaRaster</code>.
</p>
<p>Return value of non-public function <code>.regrid</code> depends on logical value of <code>raster</code> argument. If <code>raster=FALSE</code> then <code>.regrid</code> returns new grid without any change of sessional grid. If <code>raster=TRUE</code> then <code>.regrid</code> returns blank image and changes sessional grid.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+regrid">regrid</a></code>, <code><a href="#topic+Ops.focal_mean">focal_mean</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
print(g1 &lt;- session_grid())
print(g2 &lt;- regrid(g1,mul=2))
print(g3 &lt;- regrid(g1,res=50000,lim=c(-1200000,-1400000,1600000,1800000)))
print(g4 &lt;- regrid(g1,res=50000,lim=c(-1200100,-1400900,1600900,1800100),verbose=TRUE))
print(g5 &lt;- regrid(g1,mul=1/4))
print(g6 &lt;- regrid(g1,mul=1/4,cut=c(-1,-2,3,4)*25000))
print(g7 &lt;- regrid(g1,mul=1/4,expand=1.05))
print(session_grid()) ## equal to 'g1'
print(a &lt;- regrid(g1,mul=1/4,border=3,raster=TRUE))
print(session_grid()) ## not equal to 'g1'

session_grid(NULL)
'.makeRaster' &lt;- function(nc=6,nr=8) {
   as.ursa(t(matrix(runif(nc*nr,min=0,max=255),ncol=nc,nrow=nr)))
}
session_grid(NULL)
a &lt;- .makeRaster(12,18)
expand &lt;- 1/3
a1 &lt;- regrid(regrid(a,mul=expand,resample=FALSE),a,resample=FALSE)
a2 &lt;- regrid(regrid(a,mul=expand,resample=TRUE),a,resample=FALSE)
b &lt;- c('source'=a,'contract'=a1,'aggregation'=a2)
print(b)
display_brick(b,grid=TRUE
             ,grid.lon=(seq(ncol(a)*expand+1)-1)/expand
             ,grid.lat=(seq(nrow(a)*expand+1)-1)/expand)
session_grid(NULL)
a &lt;- .makeRaster(6,8)
expand &lt;- 3
b &lt;- c("source"=regrid(a,mul=expand,resample=FALSE,resetGrid=FALSE)
      ,"simple"=regrid(a,mul=expand,cascade=TRUE,resetGrid=FALSE)
      ,"cascaded"=regrid(a,mul=expand,cascade=FALSE,resetGrid=FALSE))
print(b)
display_brick(b)
session_grid(a)
eps &lt;- 1e-4
r &lt;- c(0,expand^(-2)-eps,expand^(-2)+eps,1,expand^0.5
      ,(expand+2/3)^2-eps,(expand+2/3)^2+eps,99)
g2 &lt;- regrid(mul=expand)
session_grid(g2)
b &lt;- ursa_new(bandname=sprintf("Resample=%.4f",r))
for (i in seq(b))
   b[i] &lt;- regrid(a,g2,resample=r[i])
print(b)
display_brick(b,layout=c(2,NA)
             ,grid=TRUE,grid.lon=seq(ncol(a)+1)-1,grid.lat=seq(nrow(a)+1)-1)
</code></pre>

<hr>
<h2 id='rep'>
Replicate bands of raster image.
</h2><span id='topic+rep'></span><span id='topic+rep.ursaRaster'></span>

<h3>Description</h3>

<p><code>rep</code> for object of class <code>ursaRaster</code> creates new <code>ursaRaster</code> objects with repitition of original band sequence.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaRaster'
rep(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rep_+3A_x">x</code></td>
<td>

<p>Object of class <code>ursaRaster</code>
</p>
</td></tr>
<tr><td><code id="rep_+3A_...">...</code></td>
<td>

<p>Further arguments to be passed to or from other methods. Keywords:
</p>

<dl>
<dt><code>times</code></dt><dd><p>Positive integer. Number of times to repeat each band.</p>
</dd>
</dl>

<p>If argument has no name, then <code>times</code> is assumpted.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Object of class <code>ursaRaster</code>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+classRaster_c">c</a></code> for <code>ursaRaster</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
session_grid(regrid(mul=1/4))
a &lt;- ursa_dummy(nband=3)
print(a)
b1 &lt;- rep(a,by=2)
print(b1)
b2 &lt;- rep(a,length=5)
print(b2)
b3 &lt;- rep(a[3],3)
print(b3)
</code></pre>

<hr>
<h2 id='Replace'>
assign values to the portion of raster images
</h2><span id='topic+Replace'></span><span id='topic+Assign'></span><span id='topic++5B+3C-'></span><span id='topic++5B+3C-.ursaRaster'></span>

<h3>Description</h3>

<p>This operator is used to set or replace values in portion of bands or lines in <code>ursaRaster</code> object in memory or data writing to file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 replacement method for class 'ursaRaster'
x[i, j, ...] &lt;- value
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Replace_+3A_x">x</code></td>
<td>

<p><code>ursaRaster</code> object
</p>
</td></tr>
<tr><td><code id="Replace_+3A_i">i</code></td>
<td>

<p>Integer or character. If integer, then band index, specifying bands to replace. If character, either list of band names or character sting for <code><a href="base.html#topic+grep">regular expression</a></code> to match band index. In the <em>(spatial, temporal)</em> interpretation of <code>ursaRaster</code> object <code>j</code> points to <em>temporal</em> component.
</p>
</td></tr>
<tr><td><code id="Replace_+3A_j">j</code></td>
<td>

<p>Mentioned for consistence with internal generic function <code><a href="base.html#topic+Extract">[&lt;-</a></code>.
</p>
</td></tr>
<tr><td><code id="Replace_+3A_...">...</code></td>
<td>

<p>Mentioned for consistence with internal generic function <code><a href="base.html#topic+Extract">[&lt;-</a></code>.
<br />
Use <code>regexp=FALSE</code> for matching by <code><a href="base.html#topic+match">match</a></code>, and <code>regexp=TRUE</code> for matching by Perl-compatible regexps case insensitive <code><a href="base.html#topic+grep">grep</a></code>. Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="Replace_+3A_value">value</code></td>
<td>

<p><code>ursaRaster</code> object or numeric (scalar, <code><a href="base.html#topic+matrix">matrix</a></code>, <code><a href="base.html#topic+array">array</a></code>). The latter is coerced to internal matrix of <code>$value</code> item of <code>ursaRaster</code> object.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Operator <code style="white-space: pre;">&#8288;\sQuote{[&lt;-}&#8288;</code> is high-level implementation for data writing. If <code>x$value</code> item is not applicable, then value of <code>ursaRaster</code> is not in memory. In this case the controlled by <code>i</code> and <code>j</code> portion is written to file. If both <code>i</code> and <code>j</code> are missing, then <code>x[] &lt;- value</code> writes values to file wholly.
</p>
<p>It is not implemented the simultaneously writing to file portion of bands and portion of lines.
</p>
<p>Files (currently, ENVI Binary) are opened for reading and writing.
</p>


<h3>Value</h3>

<p>If values of <code>ursaRaster</code> object are in memory, then modified <code>ursaRaster</code> object with replaced bands or lines.
<br />
If values of <code>ursaRaster</code> object are not applicable, then <code>ursaRaster</code> object <em>as is</em>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+classRaster.Extract">Extract</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
## Prepare
session_grid(regrid(mul=1/4))
a &lt;- pixelsize()
w &lt;- c("first","second","third","fourth","fifth","sixth")
b1 &lt;- rep(a/mean(a),length(w))+seq(length(w))-1
bandname(b1) &lt;- w
nr &lt;- ursa_rows(b1)
bottom &lt;- (as.integer(nr/2)):nr
write_envi(b1,"tmp1",compress=FALSE,interleave="bil")
b2 &lt;- b1
print(b1)

## Replace
b2[1] &lt;- 10+b1["second"]
b2[2] &lt;- 20
try({
   data(volcano)
   b2[3] &lt;- 30+volcano
}) ## error: unable to coerce
b2["fourth"] &lt;- 40+as.matrix(b1[3])
b2[5] &lt;- 50+as.array(b1[4])
set.seed(352)
try(b2["six"] &lt;- 60+6+runif(5,min=-1,max=1)) ## Data structures mismatching
print(b2)
print(object.size(b2))

## Write
b3 &lt;- create_envi(b2,"tmp2")
print(object.size(b3))
for (i in chunk_line(b3,0.04))
{
   b3[,i] &lt;- b2[,i]+100
   if (5 %in% i)
      print(object.size(b3))
}
close(b3)
print(object.size(b3))
b4 &lt;- read_envi("tmp2")
print(b4)
envi_remove("tmp[12]")
</code></pre>

<hr>
<h2 id='seq'>
Sequence Generation for raster image and coordinate grid
</h2><span id='topic+seq.ursaRaster'></span><span id='topic+seq.ursaGrid'></span><span id='topic+ursa_seqx'></span><span id='topic+ursa_seqy'></span><span id='topic+ursa_seqc'></span><span id='topic+ursa_seqr'></span>

<h3>Description</h3>

<p>Set of functions to generate regular sequences of bands, x-/y-cordinates and columns/rows.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaRaster'
seq(...)

## S3 method for class 'ursaGrid'
seq(...)

ursa_seqx(obj)
ursa_seqy(obj)
ursa_seqc(obj)
ursa_seqr(obj)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="seq_+3A_...">...</code></td>
<td>
<p>Set of arguments, which are recognized via their names (using <a href="base.html#topic+regex">regular expressions</a>), position and classes.
</p>

<dl>
<dt><code>.*</code></dt><dd><p>First argument (position 1). Object of classes <code>ursaRaster</code>, <code>ursaGrid</code>.</p>
</dd>
<dt><code>.*</code></dt><dd><p>Second argument (position &gt;1). One-character name. Valid values are in the list <code>c("z","x","y","c","r","lines","samples")</code>. <code>"c"</code> (<code>"samples"</code>) and <code>"r"</code> (<code>"lines"</code>) specify to generate cell sequence in the horizontal and vertical directions from bottom-left corner, whereas <code>"z"</code> specifies to generate sequence of bands. <code>x</code> and <code>"y"</code> return cell midpoints in spatial dimension.</p>
</dd>
</dl>

</td></tr>
<tr><td><code id="seq_+3A_obj">obj</code></td>
<td>

<p>Object of classes <code>ursaRaster</code>, <code>ursaGrid</code>. Missing <code>obj</code> is allowed; in this case the session grid is considered.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>All ordinal sequences (<code style="white-space: pre;">&#8288;axis&#8288;</code> is <code style="white-space: pre;">&#8288;\dQuote{c}&#8288;</code>, <code style="white-space: pre;">&#8288;\dQuote{r}&#8288;</code>, <code style="white-space: pre;">&#8288;\dQuote{z}&#8288;</code>) start from <code>1L</code>.
</p>
<p><code style="white-space: pre;">&#8288;axis=\dQuote{z}&#8288;</code> is ignored in the function <code>seq</code> for <code>ursaGrid</code> object. The returned value is <code>1L</code>.
</p>
<p><code>seq(obj)</code> for <code>ursaRaster</code> objects is suitable for using in cycles across bands.
</p>


<h3>Value</h3>

<p>Functions <code>ursa_seqx</code> and <code>seq(obj, "x")</code> return x-coordinates of cell midpoints.
<br />
Functions <code>ursa_seqy</code> and <code>seq(obj, "y")</code> return y-coordinates of cell midpoints.
<br />
Functions <code>ursa_seqc</code>, <code>seq(obj, "samples")</code> and <code>seq(obj, "c")</code> return sequence of cells in horizontal direction.
<br />
Functions <code>ursa_seqr</code>, <code>seq(obj, "lines")</code> and <code>seq(obj, "r")</code> return sequence of cells in vertical direction.
<br />
Functions <code>seq(obj)</code> and <code>seq(obj, "z")</code> for <code>ursaRaster</code> object returns sequence of bands.
<br />
Function <code>seq(obj)</code> and <code>seq(obj, "z")</code> for <code>ursaGrid</code> object returns <code>1L</code>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
session_grid(regrid(mul=1/16))
print(session_grid())
a &lt;- ursa_dummy(nband=5)
print(a)
print(seq(a))
print(seq(a,"c"))
print(seq(a,"x"))
print(ursa_seqx())
</code></pre>

<hr>
<h2 id='session'>
Get and set sessional parameters for grid, CRS, external software for open PNG files.
</h2><span id='topic+session_grid'></span><span id='topic+session_proj'></span><span id='topic+session_proj4'></span><span id='topic+session_crs'></span><span id='topic+session_cellsize'></span><span id='topic+session_bbox'></span><span id='topic+session_dim'></span><span id='topic+session_pngviewer'></span><span id='topic+session_tempdir'></span><span id='topic+session_use_experimental_functions'></span>

<h3>Description</h3>

<p><code>session_grid</code> without arguments returns current grid properties. <code>session_grid</code> with arguments specifies grid, which is used by functions of this package, e.g., for plotting, for opened and created raster images during current session.
</p>
<p><code>session_pngviwer</code> is used to permit external software to open PNG files.
</p>
<p><code>session_tempdir</code> specifies directory for temporal files in some cases.
</p>
<p><code>session_use_experimental_functions</code> allows to use undocumented (experimental) functions.
</p>
<p>Group of functions <code>session_proj4</code>, <code>session_crs</code>, <code>session_cellsize</code>, <code>session_bbox</code> extracts certain properties of sessional grid.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>session_grid(obj, ...)
session_proj4()
session_crs()
session_cellsize()
session_bbox()
session_dim()

session_pngviewer(allow = NA)
session_tempdir(dst = character())
session_use_experimental_functions()

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="session_+3A_obj">obj</code></td>
<td>
<p>Either missing, or <code>NULL</code>, or file name, or object of class <code>ursaRaster</code>, or object of class <code><a href="#topic+classGrid">ursaGrid</a></code>, or spatial object (simple features (<span class="pkg">sf</span>), spatial abstracts (<span class="pkg">sp</span>)).</p>
</td></tr>
<tr><td><code id="session_+3A_allow">allow</code></td>
<td>
<p>Logical. If <code>TRUE</code> then it is allowed to use external software for viewing PNG files. <code>NA</code> is interpreted as <code>TRUE</code> in the case of &quot;Rscript&quot; usage, and interpreted as <code>FALSE</code> in the case of interactive session or &quot;R CMD BATCH&quot; usage. Default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="session_+3A_dst">dst</code></td>
<td>
<p>Character. Directory name for temporal files. Empty character or non-character is interpreted as <code><a href="base.html#topic+getwd">getwd()</a></code> in the case of &quot;Rscript&quot; usage, and interpreted as <code><a href="base.html#topic+tempfile">tempdir()</a></code> in the case of interactive session or &quot;R CMD BATCH&quot; usage. Default is <code>character()</code> (empty character).</p>
</td></tr>
<tr><td><code id="session_+3A_...">...</code></td>
<td>
<p>Optional arguments passing to <code><a href="#topic+regrid">regrid</a></code> at first.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>session_grid</code> deals with option &ldquo;ursaSessionGrid&rdquo;: <code>options(ursaSessionGrid=...)</code> or <code>getOption("ursaSessionGrid")</code>.
</p>
<p>Usage <code>session_grid()</code> without arguments return value of &ldquo;ursaSessionGrid&rdquo; option via calling <code>getOption("ursaSessionGrid")</code>. If <code>is.null(getOption("ursaSessionGrid"))</code> then <code>session_grid()</code> returns default CRS.
</p>
<p>Usage <code>session_grid(NULL)</code> resets &ldquo;ursaSessionGrid&rdquo; option via calling <code>options(ursaSessionGrid=NULL)</code>.
</p>
<p>The sequential calling </p>
<pre>
session_grid(NULL)
session_grid()
</pre><p> returns default CRS. For checking that the option has been reset successfully, use <code>getOption("ursaSessionGrid")</code> after <code>session_grid(NULL)</code>
</p>
<p><code>session_proj4</code> and <code>session_crs</code> are synonyms.
</p>


<h3>Value</h3>

<p>Object of class <code><a href="#topic+classGrid">ursaGrid</a></code>. It is a list.
Default values are grid parameters of NSIDC polar stereo gridded data of Northern hemispere with nominal gridded resolution 25 km.
(<a href="https://nsidc.org/data/user-resources/help-center/guide-nsidcs-polar-stereographic-projection">https://nsidc.org/data/user-resources/help-center/guide-nsidcs-polar-stereographic-projection</a>)
</p>
<pre>
List of 9
 $ columns: int 304
 $ rows   : int 448
 $ resx   : num 25000
 $ resy   : num 25000
 $ minx   : num -3850000
 $ maxx   : num 3750000
 $ miny   : num -5350000
 $ maxy   : num 5850000
 $ proj4  : chr "+proj=stere +lat_0=90 +lat_ts=70.0 +lon_0=-45.0 +k=1
                 +x_0=0.0 +y_0=0.0 +a=6378273.000 +b=6356889.449 +units=m +no_defs"
 - attr(*, "class")= chr "ursaGrid"
NULL
</pre>
<p><code>session_proj4</code> and <code>session_crs</code> return item <code>proj4</code>.
</p>
<p><code>session_cellsize</code> returns squared root from multiplication of cell dimension: <code>sqrt(resx*resy)</code>.
</p>
<p><code>session_pngviewer</code> returns value of <code>getOption("ursaAllowPngViewer")</code>.
</p>
<p><code>session_bbox</code> returns named numeric of length 4: minimal x-coodrinate (<code>xmin</code>), minimal y-coordinate (<code>ymin</code>), maximal x-coordinate  (<code>xmax</code>), maximal y-coordinate  (<code>ymax</code>).
</p>
<p><code>session_dim</code> returns named integer of length 2: number of rows (<code>lines</code>) and number of columns (<code>samples</code>).
</p>
<p><code>session_use_experimental_functions</code> added some non-public functions to current namespaces and returns invisile list of function names.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a></p>


<h3>See Also</h3>

<p>Class <code><a href="#topic+classGrid">ursaGrid</a></code>. Use <code><a href="#topic+regrid">regrid</a></code> to partial grid changing.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
getOption("ursaSessionGrid") ## NULL
(g1 &lt;- session_grid()) ## default
g1$resx &lt;- g1$resy &lt;- 12500
g1$columns &lt;- as.integer(with(g1,(maxx-minx)/resx))
g1$rows &lt;- as.integer(with(g1,(maxy-miny)/resy))
session_grid(g1)
session_grid(NULL)
a &lt;- ursa_new(value=3)
session_grid(a)

print(session_pngviewer())
</code></pre>

<hr>
<h2 id='sort'>
Sort multiband raster by band names.
</h2><span id='topic+sort'></span><span id='topic+sort.ursaRaster'></span>

<h3>Description</h3>

<p>Changing order of bands based on sorting of band names.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaRaster'
sort(x, decreasing = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sort_+3A_x">x</code></td>
<td>

<p>Object of class <code>ursaRaster</code>
</p>
</td></tr>
<tr><td><code id="sort_+3A_decreasing">decreasing</code></td>
<td>

<p>Logical. Should the sort be increasing or decreasing? Not available for partial sorting. Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="sort_+3A_...">...</code></td>
<td>

<p>Other arguments, which are passed to S3 method for sorting characters.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function <code>sort()</code> for <code>ursaRaster</code> assumes bands reordering based on character band names.
</p>


<h3>Value</h3>

<p>Object of class <code>ursaRaster</code>
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>a &lt;- ursa_dummy(nband=7L)
a
sort(a)
sort(a,decreasing=TRUE)
</code></pre>

<hr>
<h2 id='spatial_engine'>
Wrapper functions for manipulation with non-raster spatial objects
</h2><span id='topic+spatial_engine'></span><span id='topic+spatial_crs'></span><span id='topic+spatial_crs+3C-'></span><span id='topic+spatial_proj'></span><span id='topic+spatial_proj+3C-'></span><span id='topic+spatial_proj4'></span><span id='topic+spatial_proj4+3C-'></span><span id='topic+spatial_bbox'></span><span id='topic+spatial_bbox+3C-'></span><span id='topic+spatial_data'></span><span id='topic+spatial_data+3C-'></span><span id='topic+spatial_geometry'></span><span id='topic+spatial_geometry+3C-'></span><span id='topic+spatial_geotype'></span><span id='topic+spatial_shape'></span><span id='topic+spatial_transform'></span><span id='topic+spatial_coordinates'></span><span id='topic+spatial_fields'></span><span id='topic+spatial_fields+3C-'></span><span id='topic+spatial_colnames'></span><span id='topic+spatial_colnames+3C-'></span><span id='topic+spatial_area'></span><span id='topic+spatial_length'></span><span id='topic+spatial_dim'></span><span id='topic+spatial_count'></span><span id='topic+spatial_nrow'></span><span id='topic+spatial_ncol'></span><span id='topic+spatial_filelist'></span><span id='topic+spatial_dir'></span><span id='topic+spatial_basename'></span><span id='topic+spatial_pattern'></span><span id='topic+is_spatial'></span><span id='topic+is_spatial_points'></span><span id='topic+is_spatial_lines'></span><span id='topic+is_spatial_polygons'></span><span id='topic+spatial_intersection'></span><span id='topic+spatial_symdifference'></span><span id='topic+spatial_difference'></span><span id='topic+spatial_union'></span><span id='topic+spatial_buffer'></span><span id='topic+spatial_trim'></span><span id='topic+spatial_valid'></span><span id='topic+spatial_grid'></span><span id='topic+spatial_centroid'></span><span id='topic+spatial_bind'></span><span id='topic+spatial_crop'></span>

<h3>Description</h3>

<p>These wrappers return iniform properties or do consimilar manipulations for spatial objects of different types: simple features (package <span class="pkg">sf</span>) and abstract class Spatial (package <span class="pkg">sp</span>). Appropriate functionality (<em>&ldquo;engine&rdquo;</em>) of respective packages is used. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spatial_engine(obj, verbose = FALSE)

spatial_crs(obj, verbose = FALSE)
spatial_proj(obj, verbose = FALSE)
spatial_proj4(obj, verbose = FALSE)

spatial_crs(obj, verbose = FALSE) &lt;- value
spatial_proj(obj, verbose = FALSE) &lt;- value
spatial_proj4(obj, verbose = FALSE) &lt;- value

spatial_bbox(obj, verbose = FALSE)
spatial_bbox(obj, verbose = FALSE) &lt;- value

spatial_data(obj, subset= ".+", drop = NA, verbose = FALSE)
spatial_data(obj, verbose = FALSE) &lt;- value

spatial_geometry(obj, verbose = FALSE)
spatial_geometry(obj, verbose = FALSE) &lt;- value

spatial_geotype(obj, each = FALSE, verbose = FALSE)
spatial_shape(obj, each = FALSE, verbose = FALSE)

spatial_transform(obj, crs, verbose = FALSE, ...)

spatial_coordinates(obj, verbose = FALSE)
spatial_centroid(obj, verbose = FALSE)

spatial_fields(obj, verbose = FALSE)
spatial_colnames(obj, verbose = FALSE)

spatial_fields(obj, verbose = FALSE) &lt;- value
spatial_colnames(obj, verbose = FALSE) &lt;- value

spatial_area(obj, verbose = FALSE)

spatial_dim(obj, verbose = FALSE)

spatial_count(obj, verbose = FALSE)

spatial_nrow(obj, verbose = FALSE)
spatial_ncol(obj, verbose = FALSE)

spatial_filelist(path = ".", pattern = NA, full.names = TRUE, recursive = FALSE,
                 ignore.case = TRUE)
spatial_dir(path = ".", pattern = NA, full.names = TRUE, recursive = FALSE,
            ignore.case = TRUE)

spatial_basename(fname)
spatial_pattern(fname)

is_spatial(obj, verbose = FALSE)

is_spatial_points(obj, verbose = FALSE)
is_spatial_lines(obj, verbose = FALSE)
is_spatial_polygons(obj, verbose = FALSE)

spatial_intersection(x, y,
                     geometry=c("default", "polygons", "lines", "points", "all"),
                     verbose = FALSE)
spatial_symdifference(x, y, verbose = FALSE)
spatial_difference(x, y, verbose = FALSE)
spatial_union(x, y, byid=NA, verbose = FALSE)
spatial_crop(x, y)

spatial_buffer(obj, dist = 0, quadsegs = 30L, verbose = FALSE)

spatial_trim(obj)

spatial_valid(obj, each = FALSE, reason = FALSE, verbose = FALSE)

spatial_grid(obj)

spatial_bind(...)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="spatial_engine_+3A_obj">obj</code></td>
<td>

<p>Simple feature (package <span class="pkg">sf</span>) or Spatial abstract class (package <span class="pkg">sp</span>) for all functions, excepting <code>spatial_geometry&lt;-</code>. Data frame for <em>Replace</em> function <code>spatial_geometry&lt;-</code>.
</p>
</td></tr>
<tr><td><code id="spatial_engine_+3A_x">x</code>, <code id="spatial_engine_+3A_y">y</code></td>
<td>

<p>Objects of simple feature (package <span class="pkg">sf</span>) class or Spatial abstract class (package <span class="pkg">sp</span>). Spatial abstracts are not applicable for <code>spatial_crop()</code>.
</p>
</td></tr>
<tr><td><code id="spatial_engine_+3A_crs">crs</code></td>
<td>

<p>Projection EPSG code or projection PROJ.4 string.
</p>
</td></tr>
<tr><td><code id="spatial_engine_+3A_subset">subset</code></td>
<td>

<p>Pattern to field names (colnames) of attribute table (data frame) for subbsetting using <code><a href="base.html#topic+grep">regular expressions</a></code>. By default, all fields are secected.
</p>
</td></tr>
<tr><td><code id="spatial_engine_+3A_drop">drop</code></td>
<td>

<p>Logical. Dropping column of data frame. If <code>TRUE</code>, then vector of data is returned. If <code>FALSE</code>, then structure of data is kept. Default is <code>NA</code>, which is interpreted as <code>TRUE</code> for single column and as <code>FALSE</code> for multiple columns.
</p>
</td></tr>
<tr><td><code id="spatial_engine_+3A_value">value</code></td>
<td>

<p>Value for property assignment in <em>replacement</em> functions. Either numeric EPSG code or character PROJ.4 string for <code>spatial_crs&lt;-</code> and <code>spatial_proj4&lt;-</code>. Spatial object or geometry of spatial object for <code>spatial_geometry&lt;-</code>.
</p>
</td></tr>
<tr><td><code id="spatial_engine_+3A_path">path</code></td>
<td>

<p>See description of argument <code>path</code> in function <code><a href="base.html#topic+list.files">dir</a></code>.
</p>
</td></tr>
<tr><td><code id="spatial_engine_+3A_pattern">pattern</code></td>
<td>

<p>See description of argument <code>pattern</code> in function <code><a href="base.html#topic+list.files">dir</a></code>.
</p>
</td></tr>
<tr><td><code id="spatial_engine_+3A_full.names">full.names</code></td>
<td>

<p>See description of argument <code>full.names</code> in function <code><a href="base.html#topic+list.files">dir</a></code>.
</p>
</td></tr>
<tr><td><code id="spatial_engine_+3A_recursive">recursive</code></td>
<td>

<p>See description of argument <code>recirsive</code> in function <code><a href="base.html#topic+list.files">dir</a></code>.
</p>
</td></tr>
<tr><td><code id="spatial_engine_+3A_ignore.case">ignore.case</code></td>
<td>

<p>See description of argument <code>ignore.case</code> in function <code><a href="base.html#topic+list.files">dir</a></code>.
</p>
</td></tr>
<tr><td><code id="spatial_engine_+3A_quadsegs">quadsegs</code></td>
<td>

<p>Integer. Number of segments per quadrant (fourth of a circle), for all or per-feature. See description
for <code>nQuadSegs</code> argument of <code><a href="sf.html#topic+geos_unary">st_buffer</a></code>.
</p>
</td></tr>
<tr><td><code id="spatial_engine_+3A_dist">dist</code></td>
<td>

<p>Numeric. Buffer distance for all, or for each of the elements. See description
for <code>dist</code> argument of <code><a href="sf.html#topic+geos_unary">st_buffer</a></code>.
</p>
</td></tr>
<tr><td><code id="spatial_engine_+3A_byid">byid</code></td>
<td>

<p>Logical. For <code>spatial_union</code> function, <code>TRUE</code> does unite of each feature; <code>FALSE</code> returns a single feature that is the geometric union of the set of features; default <code>NA</code> is coerced to <code>FALSE</code> for unary operation (missing <code>y</code>) and to <code>TRUE</code> for binary operation.
</p>
</td></tr>
<tr><td><code id="spatial_engine_+3A_fname">fname</code></td>
<td>

<p>Character. Filename (source or packed) of spatial data.
</p>
</td></tr>
<tr><td><code id="spatial_engine_+3A_each">each</code></td>
<td>

<p>Logical. Whether result will be returned for each record (<code>TRUE</code>) or generalized (<code>FALSE</code>). Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="spatial_engine_+3A_geometry">geometry</code></td>
<td>

<p>Character. Desired output geometry for <code>engine="sf"</code>. If <code>"default"</code> then output geometry is defined internally (e.g., <code>"polygons"</code> for polygons intersection). If <code>"all"</code> then no output subsetting. Default is <code>"default"</code>.
</p>
</td></tr>
<tr><td><code id="spatial_engine_+3A_reason">reason</code></td>
<td>

<p>Logical. If <code>TRUE</code>, then the reason for validity (&quot;Valid Geomerty&quot;) or invalidity is returned. If <code>FALSE</code>, then logical value of validity is returned. Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="spatial_engine_+3A_verbose">verbose</code></td>
<td>

<p>Logical. Value <code>TRUE</code> provides information on console. Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="spatial_engine_+3A_...">...</code></td>
<td>

<p>1) Spatial objects for function <code>spatial_bind</code>; 2) Further arguments in function <code>spatial_transform</code> passed to <code>sf::st_transform</code> or to <code>sp::spTransform</code>.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>spatial_engine</code> returns package name (character string <code>"sf"</code> or <code>"sp"</code>), which functionality is used for manipulation with spatial object <code>obj</code>.
</p>
<p><code>spatial_crs</code> and <code>spatial_proj4</code> are synonyms, The <em>Extract</em> functions return projection string in the PROJ.4 notation; the <em>Replace</em> functions change projection property of the object.
</p>
<p><code>spatial_bbox</code> (<em>Extract</em> function) returns numeric vector of length 4 with names &quot;xmin&quot;, &quot;ymin&quot;, &quot;xmax&quot; and &quot;ymax&quot;.
</p>
<p><code>spatial_bbox&lt;-</code> (<em>Replace</em> function) assigns boundary bbox to the object; it is valid only for objects of Spatial abstract class (package <span class="pkg">sp</span>).
</p>
<p><code>spatial_data</code> (<em>Extract</em> function) returns attribute table only, without geometry. Subsetting fields can be specified by argument <code>subset</code> using regular expressions. If <code>drop=TRUE</code> and selected single column then vector is returned instead of data frame.
</p>
<p><code>spatial_data&lt;-</code> (<em>Replace</em> function) adds spatial data to the object geomerty. Source data (if presents) are droped.
</p>
<p><code>spatial_geometry</code> (<em>Extract</em> function) returns only geometry, which format is depended on class of <code>obj</code>.
</p>
<p><code>spatial_geometry&lt;-</code> (<em>Replace</em> function) addes geometry to the object.
</p>
<p><code>spatial_transform</code> does a transformation of spatial coordinates to the new CRS and returns object of the same class as class of <code>obj</code>.
</p>
<p><code>spatial_geotype</code> and <code>spatial_shape</code> are synonyms; each returns type of spatial data: &quot;POINT&quot;, &quot;LINESTRING&quot;, &quot;POLYGON&quot;, &quot;MULTIPOLYGON&quot;, ....
</p>
<p><code>spatial_coordinates</code> returns simplified matrix or list of coordinates of original object.
</p>
<p><em>Extract</em> functions <code>spatial_fields</code> and <code>spatial_columns</code> return column names of spatial attributive table. <code>spatial_columns</code> is synonym to <code>spatial_fields</code>.
</p>
<p><em>Replace</em> functions <code>spatial_fields&lt;-</code> and <code>spatial_columns&lt;-</code> change column names of spatial attributive table. <code>spatial_columns&lt;-</code> is synonym to <code>spatial_fields&lt;-</code>.
</p>
<p><code>spatial_area</code> is valid for polygonal geometry. It returns area of polygons.
</p>
<p><code>spatial_length</code> is valid for linear geometry. It returns length of lines.
</p>
<p><code>spatial_dim</code> gets dimension of spatial coordinates; it returns either <code>2L</code> (XY) or <code>3L</code> (XYZ).
</p>
<p><code>spatial_count</code> returns number of items of object geometry.
</p>
<p><code>spatial_nrow</code> and <code>spatial_ncol</code> return number of rows and number of columns of attributive table.
</p>
<p><code>spatial_filelist</code> and its synonym <code>spatial_dir</code> return list of files with file extensions, which are associated with certain GIS vector formats. The function's basis is <code><a href="base.html#topic+list.files">dir</a></code>.
</p>
<p><code>spatial_basename</code> returns basename (without extension) of file <code>fname</code> of spatial object.
</p>
<p><code>spatial_pattern</code> returns pattern of <code>spatial_basename</code> for using in <a href="base.html#topic+regex">regular expressions</a>.
</p>
<p><code>is_spatial</code> returns logical value does the object belong to the class of spatial data.
</p>
<p><code>is_spatial_points</code> returns logical value does the object have point geometry.
</p>
<p><code>is_spatial_lines</code> returns logical value does the object have (multi)linestring geometry.
</p>
<p><code>is_spatial_polygons</code> returns logical value does the object have (multi)polygonal geometry.
</p>
<p><code>spatial_intersection</code> returns intersection of two spatial objects.
</p>
<p><code>spatial_difference</code> returns difference of two spatial objects.
</p>
<p><code>spatial_symdifference</code> returns symmetric difference of two spatial objects.
</p>
<p><code>spatial_buffer</code> returns buffered spatial object.
</p>
<p><code>spatial_union</code> returns combined geometry without internal boundaries.
</p>
<p><code>spatial_crop</code> returns cropped geometry of first spatial object by second spatial object of boundary box derived from spatial object.
</p>
<p><code>spatial_trim</code> returns spatial object without extra attributes added by <span class="pkg">ursa</span> package.
</p>
<p><code>spatial_grid</code> generates suitable spatial grid from input vector and returns object of class <code>ursaGrid</code>.
</p>
<p><code>spatial_centroid</code> returns spatial centroid.
</p>
<p><code>spatial_bind</code> returns spatial object concatenated from input spatial objects.
</p>


<h3>Acknowledgements </h3>

<p>The great improvement for development of functions for manipulation with spatial objects has been reached during work in series of projects (2015-2018) for design of marine protected areas in the Arctic.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>References</h3>

<p>Classes and methods in packages <span class="pkg"><a href="sf.html#topic+st">sf</a></span> and <span class="pkg"><a href="sp.html#topic+00sp">sp</a></span> help.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
n &lt;- 1e2
x &lt;- runif(n,min=25,max=65)
y &lt;- runif(n,min=55,max=65)
z &lt;- runif(n,min=1,max=10)
da &lt;- data.frame(x=x,y=y,z=z)
if (requireNamespace("sp")) {
   da.sp &lt;- da
   sp::coordinates(da.sp) &lt;- ~x+y
   sp::proj4string(da.sp) &lt;- "+init=epsg:4326"
   print(spatial_bbox(da.sp))
   print(spatial_crs(da.sp))
}
if (requireNamespace("sf")) {
   da.sf &lt;- sf::st_as_sf(da,coords=c("x","y"),crs=4326)
   print(spatial_bbox(da.sf))
   print(spatial_crs(da.sf))
}
</code></pre>

<hr>
<h2 id='spatial_levelsplit'>
Drops spatial object with overlapped geometry to spatial object with non-overlapped geometry.
</h2><span id='topic+spatial_levelsplit'></span>

<h3>Description</h3>

<p>Contour (levels after kernel utilization distribution, isochrones and other isolines) polygonizations produces set of polygon layers, which geometry is overlapped. Plot of such polygons may cause the invisibility the less polygon behind the larger polygon. This function makes consequent geometries. Simplifuied, concentrated circles are dropped to non-overlapped rings.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spatial_levelsplit(obj, sep = " - ")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="spatial_levelsplit_+3A_obj">obj</code></td>
<td>

<p>Spatial object, either simple features (package <span class="pkg">sf</span>) or abstract class Spatial (package <span class="pkg">sp</span>)
</p>
</td></tr>
<tr><td><code id="spatial_levelsplit_+3A_sep">sep</code></td>
<td>

<p>Separator between concatenation of two values
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Spatial object, which class is the same as class of <code>obj</code>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>palette("Set3")
radius &lt;- seq(1,length.out=5,by=1)*200
ct &lt;- ursa_colortable(colorize(radius,alpha=0.5,pal=sample(palette(),length(radius))))
origin &lt;- sf::st_sfc(sf::st_point(c(lon=139.2,lat=36.6)),crs=4326)
origin &lt;- spatial_transform(origin,"EPSG:6671")
isopoly &lt;- do.call(spatial_bind,lapply(radius*1e3,function(r) spatial_buffer(origin,r)))
spatial_data(isopoly) &lt;- data.frame(radius=radius)
isointerval &lt;- spatial_levelsplit(isopoly)
isointerval$radius
ct2 &lt;- ursa_colortable(colorize(isointerval$radius,pal=unname(ct)))
session_grid(isopoly,border=20)
compose_open(2,legend=list("left","right"))
compose_panel(isopoly,col=ct
             ,annotation.text="Semi-transparent colors are overlapped")
compose_panel(isointerval,col=ct2
             ,annotation.text="Not overlapped rings")
compose_legend(list(ct,ct2))
compose_close()
</code></pre>

<hr>
<h2 id='spatial_read'>
Wrapper functions for reading spatial objects.
</h2><span id='topic+spatial_read'></span>

<h3>Description</h3>

<p>Read either simple features (package <span class="pkg">sf</span>)
from disk using appropriate functionality (<em>&ldquo;engine&rdquo;</em>) of respective packages is used. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spatial_read(dsn, engine = c("native", "sf"))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="spatial_read_+3A_dsn">dsn</code></td>
<td>

<p>Character. File name of spatial object (vector GIS).
</p>
</td></tr>
<tr><td><code id="spatial_read_+3A_engine">engine</code></td>
<td>

<p>Character. Functionality of which package is used for reading data. If value is <code>"sf"</code>, then package <span class="pkg">sf</span> is used and simple features are returned. If value is <code>"geojsonsf"</code>, GDAL driver is GeoJSON and package <span class="pkg">geojsonsf</span> can be loaded, then package <span class="pkg">geojsonsf</span> is used and simple features are returned. If value is <code>"sp"</code> and package <span class="pkg">sp</span> can be loaded, then Spatial abstracts (package <span class="pkg">sp</span>) are returned. 
If value is <code>"native"</code> then engine selection depends on has suggested package <span class="pkg">sf</span> been installed and is there possibility to use <span class="pkg">geosonjf</span> for GeoJSON driver.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Currently, list of arguments of this funtion is simplified and can be expanded.
</p>


<h3>Value</h3>

<p>Depending of used engine, either simple features (package <span class="pkg">sf</span>) or Spatial abstracts (<span class="pkg">sp</span>). 
</p>


<h3>Note</h3>

<p>For GeoJSON files in the case <code>engine="geojsonsf"</code> reading is faster and the order of fields can be rearranged.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="sf.html#topic+st_read">read_sf</a></code>
</p>
<p><code><a href="#topic+spatial_write">spatial_write</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
n &lt;- 1e2
x &lt;- runif(n,min=25,max=65)
y &lt;- runif(n,min=55,max=65)
z &lt;- runif(n,min=1,max=10)
da &lt;- data.frame(x=x,y=y,z=z)
if (requireNamespace("sf",quietly=TRUE)) {
   obj1 &lt;- sf::st_as_sf(da,coords=c("x","y"),crs=4326)
   print(series(obj1))
   fname1 &lt;- file.path(tempdir(),"res1.shp")
   print(fname1)
   spatial_write(obj1,fname1)
   res1 &lt;- spatial_read(fname1,engine="sf")
   print(series(res1))
}
print(spatial_dir(tempdir()))
</code></pre>

<hr>
<h2 id='spatial_write'>
Wrapper functions for writing spatial objects.
</h2><span id='topic+spatial_write'></span>

<h3>Description</h3>

<p>Write spatial object to disk. If spatial object is Simple Features, then appropriate functions from package <span class="pkg">sf</span> are used.
If spatial objest are abstract of class Spatial (package <span class="pkg">sp</span>) then preliminarly transformation to Simple Features is performed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spatial_write(obj, fname, layer, driver = NA, compress = "", verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="spatial_write_+3A_obj">obj</code></td>
<td>

<p>Spatial object:
Either
Simple Features (<span class="pkg">sf</span>)
or Spatial Abstract (<span class="pkg">sp</span>).
<a href="base.html#topic+list">List</a> of spatial objects can be used.
</p>
</td></tr>
<tr><td><code id="spatial_write_+3A_fname">fname</code></td>
<td>

<p>Character. File name with or without extension. If extension is missed, then argument <code>driver</code> must be specified.
</p>
</td></tr>
<tr><td><code id="spatial_write_+3A_layer">layer</code></td>
<td>

<p>Character. Layer name. If missed, then basename of <code>fname</code> is used.
</p>
</td></tr>
<tr><td><code id="spatial_write_+3A_driver">driver</code></td>
<td>

<p>Character. Driver for specification of output file format. Default is <code>NA</code>; value is determined from extension of <code>fname</code>.
</p>
</td></tr>
<tr><td><code id="spatial_write_+3A_compress">compress</code></td>
<td>

<p>Character or logical. Will output file or list of files be packed after writing and what archive format will be used. Available character values are <code>""</code> (default; no compression), <code>"gz"</code>, <code>"gzip"</code>, <code>"bz2"</code>, <code>"bzip2"</code>, <code>"zip"</code>, <code>"xz"</code>. If logical and <code>TRUE</code>, then &quot;zip&quot; is used for <code>driver</code> &quot;ESRI Shapefile&quot; and &quot;gzip&quot; otherwise. If logical and <code>FALSE</code>, then no compression.
</p>
</td></tr>
<tr><td><code id="spatial_write_+3A_verbose">verbose</code></td>
<td>

<p>Logical. Value <code>TRUE</code> provides information on console. Default is <code>FALSE</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Based on <code><a href="sf.html#topic+st_write">sf::st_write</a></code>
function with additonal options: compressing of output file(s), coordinates trasforming (to longitudes and latitudes for <code>driver="GeoJSON"</code>), creating multi-layer destination (for <code>driver="SQLite"</code>).
</p>


<h3>Value</h3>

<p>invisible <code>NULL</code>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="sf.html#topic+st_write">write_sf</a></code>
</p>
<p><code><a href="#topic+spatial_read">spatial_read</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
n &lt;- 1e2
x &lt;- runif(n,min=25,max=65)
y &lt;- runif(n,min=55,max=65)
z &lt;- runif(n,min=1,max=10)
da &lt;- data.frame(x=x,y=y,z=z)
if (requireNamespace("sf",quietly=TRUE)) {
   obj1 &lt;- sf::st_as_sf(da,coords=c("x","y"),crs=4326)
   print(series(obj1))
   fname1 &lt;- file.path(tempdir(),"res1.shp")
   print(fname1)
   spatial_write(obj1,fname1)
   res1 &lt;- spatial_read(fname1,engine="sf")
   print(series(res1))
}
print(spatial_dir(tempdir()))
</code></pre>

<hr>
<h2 id='summary'>
Summary of raster image.
</h2><span id='topic+summary.ursaRaster'></span><span id='topic+summary.ursaNumeric'></span><span id='topic+summary.ursaCategory'></span>

<h3>Description</h3>

<p>Function <code>summary</code> for <code>ursaRaster</code> object produces summaries for each band.
<br />
Function <code>summary</code> for <code>ursaValue</code> object produces summaries for all values of raster image regardless of bands. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaRaster'
summary(object, ...)

## S3 method for class 'ursaNumeric'
summary(object, ...)

## S3 method for class 'ursaCategory'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary_+3A_object">object</code></td>
<td>

<p>Object of classes <code>ursaRaster</code>, <code>ursaNumeric</code>, or <code>ursaCategory</code>
</p>
</td></tr>
<tr><td><code id="summary_+3A_...">...</code></td>
<td>

<p>Additional arguments affecting the summary produced.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>summary</code> for <code>ursaRaster</code> object applies <code><a href="base.html#topic+summary">summary</a></code> to each column of two-dimensions value matrix and collating the results.
<br />
<code>summary</code> for <code>ursaValue</code> object drops dimensions and applies <code><a href="base.html#topic+summary">summary</a></code> to a vector.
</p>


<h3>Value</h3>

<p><code>summary</code> for <code>ursaRaster</code> object returns value of function <code><a href="base.html#topic+summary">summary.matrix</a></code>.
<br />
<code>summary</code> for <code>ursaValue</code> object returns object of class <code style="white-space: pre;">&#8288;\dQuote{summaryDefault}&#8288;</code>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="base.html#topic+summary">summary</a></code> in package <span class="pkg">base</span>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
session_grid(regrid(mul=1/4))
a &lt;- ursa_dummy(nband=3)
print(summary(a))
print(summary(ursa_value(a)))
print(a)
</code></pre>

<hr>
<h2 id='temporal_interpolate'>
Fill gaps across bands using moving mean window
</h2><span id='topic+temporal_interpolate'></span>

<h3>Description</h3>

<p><code>temporal_interpolate</code> is applicable for multiband raster image, where bands are regular timestamps or period. For each cell (<em>local</em> operation of map algebra), <code>NA</code> value is replaced by averaging of two closest values (one value before, one value later) inside of moving window.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>temporal_interpolate(obj, win = 7, cover = 0, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="temporal_interpolate_+3A_obj">obj</code></td>
<td>

<p>Object of class <code>ursaRaster</code> or <code><a href="base.html#topic+matrix">matrix</a></code>, where spatial locations are by rows and temporal observations are by columns.
</p>
</td></tr>
<tr><td><code id="temporal_interpolate_+3A_win">win</code></td>
<td>

<p>Positive integer. Size of moving window. Required odd value; otherwise is coerced to the closest odd integer.
</p>
</td></tr>
<tr><td><code id="temporal_interpolate_+3A_cover">cover</code></td>
<td>

<p><em><b>Not applicable</b></em>. For consistence call with <code><a href="#topic+temporal_mean">temporal_mean</a></code>.
</p>
</td></tr>
<tr><td><code id="temporal_interpolate_+3A_verbose">verbose</code></td>
<td>

<p>Logical. <code>TRUE</code> provides some additional information on console. Default is FALSE.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function uses weighted averaging depending of proximity of found non-<code>NA</code> values. For example, if <code>ind</code> is temporal index of <code>NA</code> value in the center of movind window, <code>indL=ind-2</code> is temporal index of the closest early value <code>valL</code>, and <code>indR=ind+1</code> is temporal index of the closest late value <code>valR</code>, then result is <code style="white-space: pre;">&#8288;val &lt;- (1/3) * valL + (2/3) * valR&#8288;</code>.
</p>


<h3>Value</h3>

<p><code>ursaRaster</code> object, if <code>obj</code> is object of class <code>ursaRaster</code>.
</p>
<p><code>matrix</code> object, if <code>obj</code> is a matrix.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+temporal_mean">temporal_mean</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
n &lt;- 45 # bands
m &lt;- 3 # sample size
k &lt;- median(seq(n))+seq(m)-(m %/% 2)-1 ## sample subset
s &lt;- 5 # window size
a &lt;- round(ursa_dummy(n,min=-60,max=60,elements=15,mul=1/8))
a[a&lt;(-40)] &lt;- NA
b &lt;- temporal_interpolate(a,7)
p1 &lt;- colorize(a,lazy=TRUE)
p2 &lt;- colorize(b,lazy=TRUE,colortable=p1)
display(list('Source'=p1[k],'Gaps are filled'=p2[k]),layout=c(2,NA)
       ,legend=list(list(1,"right"),list(2,"right")),decor=FALSE)
</code></pre>

<hr>
<h2 id='temporal_mean'>
Smooth value across bands using moving mean window
</h2><span id='topic+temporal_mean'></span>

<h3>Description</h3>

<p><code>temporal_mean</code> is applicable for multiband raster image, where bands are regular timestamps or period. For each cell (<em>local</em> operation of map algebra), the values are averaged using moving window.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>temporal_mean(obj, win = 7, cover = 0, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="temporal_mean_+3A_obj">obj</code></td>
<td>

<p>Object of class <code>ursaRaster</code> or matrix, where spatial locations are by rows and temporal observations are by columns.
</p>
</td></tr>
<tr><td><code id="temporal_mean_+3A_win">win</code></td>
<td>

<p>Positive integer. Size of moving window. Required odd value; otherwise is coerced to the closest odd integer.
</p>
</td></tr>
<tr><td><code id="temporal_mean_+3A_cover">cover</code></td>
<td>

<p>Numeric in the interval <code>0 &lt;= cover &lt;= 1</code> or positive numeric &gt;1. The required amount of non-<code>NA</code> elements in window to do a filtering. Otherwise, <code>NA</code> value is in output cell. If <code>cover&lt;=1</code> then amount is relative to window size. Default is <code>0</code>: <code>NA</code> values are produced only if all elements in window have <code>NA</code> value.
</p>
</td></tr>
<tr><td><code id="temporal_mean_+3A_verbose">verbose</code></td>
<td>

<p>Logical. <code>TRUE</code> provides some additional information on console. Default is FALSE.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>temporal_mean</code> is similar to function <code>runmean(x=obj, k=win, endrule="mean")</code> from package <span class="pkg">caTools</span>.
</p>


<h3>Value</h3>

<p><code>ursaRaster</code> object, if <code>obj</code> is object of class <code>ursaRaster</code>.
</p>
<p><code>matrix</code> object, if <code>obj</code> is a matrix.
</p>


<h3>Advanced</h3>

<p><code>temporal_mean</code> is only smoothing of time-series. For time-series analysis and processing it is suggested to apply lower-level approach.
</p>
<p><code><a href="#topic+classRaster_as.matrix">as.matrix</a></code> (for <code>ursaRaster</code> object with argument <code>coords=FALSE</code>) or <code><a href="#topic+classValue">ursa_value</a></code> return matrix with spatial component by rows and temporal component by columns. It is possible to use <code><a href="base.html#topic+apply">apply</a></code> with argument <code>MARGIN=1</code> to this matrix. If <code>apply</code> returns matrix <code>Y</code>, then this matrix can be coerced to <code>ursaRaster</code> object by calling <code><a href="#topic+ursa_as">as.ursa</a></code> with argument <code>t(Y)</code>. </p>
<pre>
      X &lt;- as.matrix(obj)
      Y &lt;- apply(X, 1, function(x) {y &lt;- do_something_return_matrix(x); y})
      res &lt;- as.ursa(t(Y))
   </pre>
<p>For example, package <span class="pkg">caTools</span> provides some functions for manipulation with moving window.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>References</h3>

<p>Package <span class="pkg">caTools</span> <a href="https://CRAN.R-project.org/package=caTools">https://CRAN.R-project.org/package=caTools</a>
</p>


<h3>See Also</h3>

<p><code><a href="caTools.html#topic+runmean">caTools::runmean</a></code> (click if package <span class="pkg">caTools</span> is installed)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
set.seed(352)
n &lt;- 45 # bands
m &lt;- 3 # sample size
k &lt;- median(seq(n))+seq(m)-(m %/% 2)-1 ## sample subset
s &lt;- 5 # window size
a &lt;- round(ursa_dummy(n,min=-60,max=60,elements=15,mul=1/8))

 ## namespace of package 'caTools' is required
if (requireNamespace("caTools")) {
   b1 &lt;- as.ursa(t(apply(as.matrix(a),1,caTools::runmean,k=s,endrule="mean")))
   b2 &lt;- temporal_mean(a,s)
   print(b1[k])
   print(b2[k])
   print(c('identical?'=all.equal(ursa_value(b1),ursa_value(b2))))
}

a[a&lt;(-40)] &lt;- NA
va &lt;- as.matrix(a) # or 'ursa_value(a)'
b3 &lt;- temporal_mean(a,s,cover=3/4,verbose=TRUE)
b4 &lt;- as.ursa(temporal_mean(as.matrix(va),s,cover=3/4,verbose=TRUE))
p &lt;- list('Before moving window'=a[k]
         ,'After moving window'=b3[k]
         ,'\'temporal_mean\' to matrix'=b4[k])
print(p)
print(c('identical?'=all.equal(ursa_value(b3),ursa_value(b4))))
display(p[1:2],legend=list(list(1,"right"),list(2,"right")),decor=FALSE)
</code></pre>

<hr>
<h2 id='trackline'>
Create segmented line from points' sequence
</h2><span id='topic+trackline'></span>

<h3>Description</h3>

<p>Connect sequence of points (locations) by direct lines (tracks)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trackline(obj, by=NULL, connect=c("united", "consequent"), gentle=FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="trackline_+3A_obj">obj</code></td>
<td>

<p>Simple feature (package <span class="pkg">sf</span>) or Spatial abstract class (package <span class="pkg">sp</span>) with POINTS spatial geometry.
</p>
</td></tr>
<tr><td><code id="trackline_+3A_by">by</code></td>
<td>

<p>Either field name or <code>NULL</code>. If specified, then value <code>"united"</code> is applied for argument <code>connect</code>, returned spatial object is splitted regarding values of <code>by</code> with linked single-column attribute table with specified field. Default is <code>NULL</code>.
</p>
</td></tr>
<tr><td><code id="trackline_+3A_connect">connect</code></td>
<td>

<p>Structure of output segments; either sequence of single segments (<code>"consequent"</code>) or single multi-segment (<code>"united"</code>).
</p>
</td></tr>
<tr><td><code id="trackline_+3A_gentle">gentle</code></td>
<td>

<p>Logical. Value <code>TRUE</code> directs repetition of binded columns of data table. Value <code>FALSE</code> omits duplicated column values. Default is <code>FALSE</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function generates <code>n-1</code> segments from <code>n</code> input points. Data (attribute table) is trasfered to output object with excluding of first row.
</p>
<p><code>gentle=TRUE</code> may be useful to keep geterogenic data structure for spatial binding (<code><a href="#topic+spatial_bind">spatial_bind</a></code>).
</p>


<h3>Value</h3>

<p>Simple feature (package <span class="pkg">sf</span>) or Spatial abstract class (package <span class="pkg">sp</span>) with LINESTRING spatial geometry.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
n &lt;- 15
lon &lt;- rev(sort(runif(n,min=40,max=60)))
lat &lt;- sort(runif(n,min=30,max=50))
pt &lt;- data.frame(lon=lon,lat=lat,value=seq(n))
if (requireNamespace("sp")) {
   sp::coordinates(pt) &lt;- c("lon","lat")
   sp::proj4string(pt) &lt;- "EPSG:4326"
} else {
   pt &lt;- sf::st_as_sf(pt,coords=c("lon","lat"),crs="WGS84")
}
ct &lt;- ursa_colortable(colorize(pt$value))
tr &lt;- trackline(pt,connect="consequent")
#opW &lt;- options(warn=0)
session_grid(pt,expand=1.1)
compose_open(2)
panel_new()
panel_plot(pt,col=ct)
panel_decor()
panel_new()
panel_plot(tr,col=ct,lwd=3)
panel_decor()
compose_legend(ct,unit="step number")
compose_close()
</code></pre>

<hr>
<h2 id='ursa'>
Get and set properties of raster image.
</h2><span id='topic+ursa'></span><span id='topic+ursa+3C-'></span>

<h3>Description</h3>

<p>For package description see.
</p>
<p><code>ursa</code> is a wrapper to initialize object of class <code>ursaRaster</code>, to get and to set properties for this object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ursa(obj, attr, ...)
ursa(obj, attr, ...) &lt;- value
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ursa_+3A_obj">obj</code></td>
<td>

<p>Any numeric structure (scalar, matrix, array) for initializing. Object of class <code>ursaRaster</code> for extracting and assigning properties.
</p>
</td></tr>
<tr><td><code id="ursa_+3A_attr">attr</code></td>
<td>

<p>Character. Name of property.
</p>
</td></tr>
<tr><td><code id="ursa_+3A_...">...</code></td>
<td>

<p>Arguments, which are passed for properties specification. 
</p>
</td></tr>
<tr><td><code id="ursa_+3A_value">value</code></td>
<td>

<p>Value for property assignment.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Initializing function <code>ursa</code> with missing argument <code>attr</code> is a wrapper for function <code>as.ursa</code>.
</p>

<table>
<tr>
 <td style="text-align: left;">
<em>Matched pattern</em> </td><td style="text-align: left;"> <em>Replace method?</em> </td><td style="text-align: left;"> <em>Description of property</em> </td><td style="text-align: left;"> <em>Implementation</em>
</td>
</tr>
<tr>
 <td style="text-align: left;"><code>"grid"</code> </td><td style="text-align: left;"> Yes </td><td style="text-align: left;"> Raster grid (extent, projection, cellsize) </td><td style="text-align: left;"> <code><a href="#topic+ursa_grid">ursa_grid</a></code>
</td>
</tr>
<tr>
 <td style="text-align: left;"><code>"(proj|crs)"</code> </td><td style="text-align: left;"> Yes </td><td style="text-align: left;"> Coordinate reference system </td><td style="text-align: left;"> <code><a href="#topic+ursa_proj">ursa_proj</a></code>
</td>
</tr>
<tr>
 <td style="text-align: left;"><code>"val"</code> </td><td style="text-align: left;"> Yes </td><td style="text-align: left;"> Raster value in the internal storage format </td><td style="text-align: left;"> <code><a href="#topic+classValue">ursa_value</a></code>
</td>
</tr>
<tr>
 <td style="text-align: left;"><code>"(colort|ct)"</code> </td><td style="text-align: left;"> Yes </td><td style="text-align: left;"> Color table </td><td style="text-align: left;"> <code><a href="#topic+classColorTable">ursa_colortable</a></code>
</td>
</tr>
<tr>
 <td style="text-align: left;"><code>"(categ|class)"</code> </td><td style="text-align: left;"> Yes </td><td style="text-align: left;"> Names of categories </td><td style="text-align: left;"> <code>names(ursa_colortable(obj))</code>
</td>
</tr>
<tr>
 <td style="text-align: left;"><code>"name"</code> </td><td style="text-align: left;"> Yes </td><td style="text-align: left;"> Band names </td><td style="text-align: left;"> <code><a href="#topic+classRaster_names">names</a></code>
</td>
</tr>
<tr>
 <td style="text-align: left;"><code>"(nodata|ignorevalue|bg)"</code> </td><td style="text-align: left;"> Yes </td><td style="text-align: left;"> Value, which is interpreted as <code>NA</code>. </td><td style="text-align: left;"> <code><a href="#topic+ignorevalue">ignorevalue</a></code>
</td>
</tr>
<tr>
 <td style="text-align: left;"><code>"^table$"</code> </td><td style="text-align: left;"> No </td><td style="text-align: left;"> Frequency of unique values </td><td style="text-align: left;"> <code><a href="#topic+classRaster_as.table">as.table</a></code>
</td>
</tr>
<tr>
 <td style="text-align: left;"><code>"cell"</code> </td><td style="text-align: left;"> No </td><td style="text-align: left;"> <em>Squared</em> cell size </td><td style="text-align: left;"> <code>with(ursa_grid(obj),sqrt(resx*resy))</code>
</td>
</tr>
<tr>
 <td style="text-align: left;"><code>"^dim$"</code> </td><td style="text-align: left;"> No </td><td style="text-align: left;"> Dimension of raster image </td><td style="text-align: left;"> <code><a href="#topic+classRaster_dim">dim</a></code>
</td>
</tr>
<tr>
 <td style="text-align: left;"><code>"(extent|bbox)"</code> </td><td style="text-align: left;"> No </td><td style="text-align: left;"> Spatial extent of raster image </td><td style="text-align: left;"> <code>with(ursa_grid(obj),c(xmin=minx,ymin=miny,xmax=maxx,ymax=maxy))</code>
</td>
</tr>
<tr>
 <td style="text-align: left;"><code>"(nrow|rows|lines)"</code> </td><td style="text-align: left;"> No </td><td style="text-align: left;"> Number of rows of raster image </td><td style="text-align: left;"> <code>ursa_grid(obj)$rows</code>
</td>
</tr>
<tr>
 <td style="text-align: left;"><code>"(ncol|columns|samples)"</code> </td><td style="text-align: left;"> No </td><td style="text-align: left;"> Number of columns of raster image </td><td style="text-align: left;"> <code>ursa_grid(obj)$columns</code>
</td>
</tr>
<tr>
 <td style="text-align: left;"><code>"con"</code> </td><td style="text-align: left;"> No </td><td style="text-align: left;"> <strong>str</strong>ucture of connection </td><td style="text-align: left;"> <code>obj$con</code>
</td>
</tr>
<tr>
 <td style="text-align: left;"><code>"(info|meta(data)*)"</code> </td><td style="text-align: left;"> No </td><td style="text-align: left;"> Metadata, brief info </td><td style="text-align: left;"> <code><a href="#topic+ursa_info">ursa_info</a></code>
</td>
</tr>
<tr>
 <td style="text-align: left;"><code>"^file(name)*"</code> </td><td style="text-align: left;"> No </td><td style="text-align: left;"> Connection name (filename) </td><td style="text-align: left;"> <code>obj$con$fname</code>
</td>
</tr>

</table>

<p>Argument ... is used to specify band index or band pattern in <code>ursa(obj,"value",...)</code>
</p>


<h3>Value</h3>

<p>Inititalizing function <code>ursa</code> (missing <code>attr</code>) returns object of class <code>ursaRaster</code>.
</p>
<p><em>Extract</em> function <code>ursa</code> returns object of respective property.
</p>
<p><em>Replace</em> function <code>ursa&lt;-</code> returns object 
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ursa_as">as.ursa</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>a1 &lt;- ursa(volcano)
print(a1)
 ## to avoid over-timing during tests -- begin
   display(a1)
 ## to avoid over-timing during tests -- end

a2 &lt;- ursa(volcano,flip=TRUE)
print(a2)
 ## to avoid over-timing during tests -- begin
   display(a2)
 ## to avoid over-timing during tests -- end 

a3 &lt;- ursa(volcano,permute=TRUE)
print(a3)
 ## to avoid over-timing during tests -- begin
   display(a3)
 ## to avoid over-timing during tests -- end

a4 &lt;- ursa(volcano,flip=TRUE,permute=TRUE)
print(a4)
 ## to avoid over-timing during tests -- begin
   display(a4)
 ## to avoid over-timing during tests -- end

dima &lt;- c(200,300,4)
b1 &lt;- ursa(array(runif(prod(dima)),dim=dima))
print(b1)
display_brick(b1,scale=1,pal.rotate=0,pal.hue=0,decor=FALSE)
session_grid(NULL)

c1 &lt;- ursa(seq(3))
print(c1)
c2 &lt;- ursa(seq(3),bands=3)
print(c2)

c3 &lt;- ursa(value=FALSE)
str(ursa(c3,"value"))

c4 &lt;- ursa(bands=2,nodata=-99L)
print(c4)
print(ursa(c4,"nodata"))

c5 &lt;- ursa(bandname=format(Sys.Date()+seq(7)-1,"%A"))
ursa(c5,"value") &lt;- rev(seq(nband(c5)))
c5 &lt;- colorize(c5)
ct &lt;- ursa(c5,"colortable")
print(c5)

v &lt;- ursa(c5[3:5],"value")
str(v)
v &lt;- c(v)
str(v)
c6 &lt;- ursa(v,colortable=ct)
print(c6)
print(ursa(c6,"colortable"))
</code></pre>

<hr>
<h2 id='ursa_cache'>
Cache management of ursa package
</h2><span id='topic+ursa_cache'></span>

<h3>Description</h3>

<p>This help topic is about how cache is managed in the package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ursa_cache()
</code></pre>


<h3>Details</h3>

<p>Users, who want to keep cache files between R sessions, should define <a href="base.html#topic+options">option</a> with name <code>ursaCacheDir</code> and value of the path for storage of cache files. This setting can be specified if <code>~/.Rprofile</code> file, or be in your code. If you specify permanent cache directory as sub-directory of <code><a href="base.html#topic+tempfile">tempdir()</a></code> (see example), it will be removed after finishing of R session.
</p>


<h3>Value</h3>

<p>NULL
</p>


<h3>Note</h3>

<p>There is no neccessary to call this function. It just defines this help topic.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'> ## internet connection is required
options(ursaCacheDir=file.path(tempdir(),".ursaCacheDir"))
print(c(tempdir=tempdir(),ursaCacheDir=getOption("ursaCacheDir")))
glance("Mount Eden",place="park")
dir(getOption("ursaCacheDir"))
</code></pre>

<hr>
<h2 id='ursa_crop'>
Crop 'no data' margins.
</h2><span id='topic+ursa_crop'></span>

<h3>Description</h3>

<p>Function <code>ursa_crop</code>
makes such spatial subset of source raster image, where margins of 'no data' values are absent or have specified width.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
ursa_crop(obj, condition, border = 0, expand = 1, resetGrid = TRUE, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ursa_crop_+3A_obj">obj</code></td>
<td>

<p>Object of class <code>ursaRaster</code>
</p>
</td></tr>
<tr><td><code id="ursa_crop_+3A_condition">condition</code></td>
<td>

<p>Object of class <code>ursaRaster</code> or <code><a href="base.html#topic+missing">missing</a></code>. The condition for cutting. If &lsquo;missing&rsquo; then condition is defined from <code>obj</code>.
</p>
</td></tr>
<tr><td><code id="ursa_crop_+3A_border">border</code></td>
<td>

<p>Integer of length 1, 2 or 4. Desired margins for geographical subset. Units are cells (pixels).
</p>
</td></tr>
<tr><td><code id="ursa_crop_+3A_expand">expand</code></td>
<td>

<p>Numeric of length 1, 2 or 4. Desired boundary expansion for geographical subset. Units is ratio (relative to 1). Default is 1.
</p>
</td></tr>
<tr><td><code id="ursa_crop_+3A_resetgrid">resetGrid</code></td>
<td>

<p>Logical. If <code>resetGrid=TRUE</code> then sessional grid parameters is established from grid parameters of created raster. If <code>resetGrid=FALSE</code> then sessional grid parameters keep without change. Defailu is <code>TRUE</code>.
</p>
</td></tr>
<tr><td><code id="ursa_crop_+3A_verbose">verbose</code></td>
<td>

<p>Logical. <code>TRUE</code> provides some additional information on console.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function calls <code><a href="#topic+regrid">regrid</a></code> with passing values of arguments <code>resetGrid</code> and <code>verbose</code> without changes.
</p>
<p>Bordering (argument <code>border</code>) is applied before expansion (argument <code>expand</code>).
</p>
<p>This function is an instrument for data compression for spatial matrices with wide margins of 'no data' value. It keeps spatial structure (pixel's neighborhood) in the internal data storage. Otherwise, <code><a href="#topic+codec">compress</a></code> reduces object size using spatial indexing with dropping of spatial structure.
</p>


<h3>Value</h3>

<p>Object of class <code>ursaRaster</code>
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
'printCR' &lt;- function(obj) print(with(ursa_grid(obj),c(c=columns,r=rows)))
g0 &lt;- session_grid()
a &lt;- pixelsize()
th &lt;- with(ursa_grid(a),resx*resy*1e-6)
a0 &lt;- a[a&gt;th*0.9]
print(session_grid())
printCR(a0)
print(a0)
a1 &lt;- ursa_crop(a0,resetGrid=TRUE)
print(session_grid())
printCR(a1)
print(a1)
a2 &lt;- ursa_crop(a0,resetGrid=FALSE)
print(session_grid())
printCR(a2)
print(a2)
a3 &lt;- a[a&gt;=th*0.85 &amp; a&lt;=th*1.01]
b1 &lt;- ursa_dummy(nband=3,min=0,max=255)
print(b1)
b2 &lt;- ursa_crop(b1[a3&gt;0],border=10)
print(b2)
printCR(b2)
b2[is.na(b2)] &lt;- 255
display_rgb(b2)
b3 &lt;- ursa_crop(b1,a3,border=0)
print(b3)
printCR(b3)
</code></pre>

<hr>
<h2 id='ursa_crs'>
Extract and assign projection of raster images.
</h2><span id='topic+ursa_crs'></span><span id='topic+ursa_proj'></span><span id='topic+ursa_proj4'></span><span id='topic+ursa_crs+3C-'></span><span id='topic+ursa_proj+3C-'></span><span id='topic+ursa_proj4+3C-'></span>

<h3>Description</h3>

<p>Functions manipulate with <code>$crs</code> item of the <code><a href="#topic+classGrid">ursaGrid</a></code> object, which is embedded in the <code><a href="#topic+classRaster">ursaRaster</a></code> object (<code>obj$grid$crs</code>). Projection is specified in PROJ.4 notation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ursa_crs(obj)
ursa_crs(obj, keepGrid = FALSE) &lt;- value
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ursa_crs_+3A_obj">obj</code></td>
<td>

<p><code>ursaRaster</code> object. It is allowed <code>ursaGrid</code> object for <code>ursa_proj</code> <em>(Extract)</em> function.
</p>
</td></tr>
<tr><td><code id="ursa_crs_+3A_keepgrid">keepGrid</code></td>
<td>

<p>Logical. Should sessional grid be changed after assignment. Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="ursa_crs_+3A_value">value</code></td>
<td>

<p>Character sting in PROJ.4 format.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Boath <em>Extract</em> and <em>Replace</em> functions <code>ursa_proj()</code> and <code>ursa_proj4()</code> are synonyms for <code>ursa_crs</code>.
</p>


<h3>Value</h3>

<p><em>Extract</em> function <code>ursa_crs</code> returns character value of <code>$grid$crs</code> item of <code>ursaRaster</code> object.
</p>
<p><em>Replace</em> function <code>ursa_crs&lt;-</code> returns <code>ursaRaster</code> with modified <code>$grid$crs</code> item.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- ursa_dummy(nband=1)
print(ursa_crs(a))
p4s &lt;- "+init=epsg:3576"
ursa_crs(a) &lt;- p4s
print(ursa_crs(a))
fname &lt;- tempfile()
write_envi(a,fname)
a2 &lt;- read_envi(fname,resetGrid=TRUE)
print(ursa_crs(a2))
# try(print(rgdal::CRSargs(sp::CRS(p4s)))) ## 'rgdal' is retired
envi_remove(fname)
</code></pre>

<hr>
<h2 id='ursa_dummy'>
Generate raster image for examples.
</h2><span id='topic+ursa_dummy'></span>

<h3>Description</h3>

<p><code>ursa_dummy</code> returns georeferenced raster image with required number of bands. The value of such image has no sence in reality, but are suitable for <span class="rlang"><b>R</b></span>'s examples.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ursa_dummy(nband = 3L, minvalue = 0, maxvalue = 255, mul = 1, elements = 8L,
           bandname = NULL, nodata = TRUE, resetGrid=FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ursa_dummy_+3A_nband">nband</code></td>
<td>

<p>Positive integer. Number of bands. Default is 3L.
</p>
</td></tr>
<tr><td><code id="ursa_dummy_+3A_minvalue">minvalue</code></td>
<td>

<p>Numeric of length 1. Minimal value for raster image. Default is <code>0</code>.
</p>
</td></tr>
<tr><td><code id="ursa_dummy_+3A_maxvalue">maxvalue</code></td>
<td>

<p>Numeric of length 1. Maximal value for raster image. Default is <code>255</code>.
</p>
</td></tr>
<tr><td><code id="ursa_dummy_+3A_mul">mul</code></td>
<td>

<p>Positive numeric. The scaling of the existing <a href="#topic+session">session grid</a>. Value <code>1</code> means the actual pixel size. Value <code>&lt;1</code> decreases image size by increasing cell size. Value <code>&gt;1</code> decreases image size by increasing cell size. Default is <code>1</code>.
</p>
</td></tr>
<tr><td><code id="ursa_dummy_+3A_elements">elements</code></td>
<td>

<p>Positive integer. Maximal dimension of matrix, which is proportional to <a href="#topic+session">session grid</a>. If <code>elements</code> has small value then the resulting image is smooth, like low-resolution image. The <code>elements</code> has big value, then the resulting image is like white noise.
</p>
</td></tr>
<tr><td><code id="ursa_dummy_+3A_bandname">bandname</code></td>
<td>

<p>Character vector or <code>NULL</code>. Band names for created raster image. If <code>NULL</code>, then band names are generated autimatically. Default is <code>NULL</code>.
</p>
</td></tr>
<tr><td><code id="ursa_dummy_+3A_nodata">nodata</code></td>
<td>

<p>Numerical or logical. Set value, which is interpreted as 'no-data' flag. If logical and <code>FALSE</code> then no no-data flag is assigned. If logical and <code>TRUE</code> then value of no-data flag is generated automatically. If numeric, then no-data is assigned to value of this argument. Default is <code>TRUE</code>.
</p>
</td></tr>
<tr><td><code id="ursa_dummy_+3A_resetgrid">resetGrid</code></td>
<td>
<p>Logical. Whether the grid will be reset to default before raster generation? If <code>FALSE</code> then raster is generated in the sessional grid. If <code>TRUE</code> then default parameters are used for raster and session. Default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Currently, the values are generated using <code><a href="stats.html#topic+Uniform">runif</a></code>.
</p>
<p>The value <code>mul&lt;1</code> speeds up raster generation.
</p>


<h3>Value</h3>

<p>Object of class <code>ursaRaster</code>
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a1 &lt;- as.integer(ursa_dummy(nband=1,mul=1/16,elements=1e3))  ## white noise
 ## to avoid over-time during example check -- begin
   display(a1,legend=NULL)
 ## to avoid over-time during example check -- end
a2 &lt;- ursa_dummy()
print(a2)
display_brick(a2,decor=FALSE)
display_stack(a2,decor=FALSE)
display_rgb(a2,decor=FALSE)
</code></pre>

<hr>
<h2 id='ursa_grid'>
Extract and assign spatial parameters of raster images.
</h2><span id='topic+ursa_grid'></span><span id='topic+ursa_grid+3C-'></span><span id='topic+ursa_ncol'></span><span id='topic+ursa_nrow'></span><span id='topic+ursa_columns'></span><span id='topic+ursa_rows'></span><span id='topic+ursa_samples'></span><span id='topic+ursa_lines'></span><span id='topic+ursa_extent'></span><span id='topic+ursa_bbox'></span><span id='topic+consistent_grid'></span>

<h3>Description</h3>

<p>Raster image (<code>ursaRaster</code>) contains embedded spatial parameters (<code><a href="#topic+classGrid">ursaGrid</a></code>) in item <code>$grid</code>. These functions manipulate with item <code>$grid</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ursa_grid(obj)
ursa_grid(obj) &lt;- value

ursa_ncol(obj)
ursa_nrow(obj)
ursa_columns(obj)
ursa_rows(obj)
ursa_samples(obj)
ursa_lines(obj)

ursa_extent(obj)
ursa_bbox(obj)

consistent_grid(obj, ref, expand = 1, border = rep(0, 4), verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ursa_grid_+3A_obj">obj</code></td>
<td>

<p><code>ursaRaster</code> object. For <code>ursa_grid</code> function <code><a href="base.html#topic+list">list</a></code> of <code>ursaRaster</code> objects is allowed.
</p>
</td></tr>
<tr><td><code id="ursa_grid_+3A_value">value</code></td>
<td>

<p><code><a href="#topic+classGrid">ursaGrid</a></code> object.
</p>
</td></tr>
<tr><td><code id="ursa_grid_+3A_ref">ref</code></td>
<td>

<p><code><a href="#topic+classGrid">ursaGrid</a></code> reference object.
</p>
</td></tr>
<tr><td><code id="ursa_grid_+3A_expand">expand</code></td>
<td>

<p>Podsitive numeric. Multiplier of boundary box.
</p>
</td></tr>
<tr><td><code id="ursa_grid_+3A_border">border</code></td>
<td>

<p><code>integer</code> of length 1 or 4. If length 4, then vector (bottom, left, top, right) in cells for extent expand. If length &lt;4, then value is repeated for length 4. Passed to <code><a href="#topic+regrid">regrid()</a></code>.
</p>
</td></tr>
<tr><td><code id="ursa_grid_+3A_verbose">verbose</code></td>
<td>

<p>Logical. Some output in console. Primarily for debug purposes.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>ursa_grid&lt;-</code> may used to minor corrections of spatial parameters. Howevert, it seems that this function is not claimed in practice.
</p>
<p><code>ursa_ncol</code>, <code>ursa_columns</code>, <code>ursa_samples</code> are synonyms for extracting number of columns/samples.
</p>
<p><code>ursa_nrow</code>, <code>ursa_rows</code>, <code>ursa_lines</code> are synonyms for extracting number of rows/lines.
</p>
<p><code>ursa_extent</code>, <code>ursa_bbox</code>, are synonyms for extracting boundary box (spatial extent).
</p>
<p><code>consistent_grid</code> trasforms dimension (<code>ursa_nrow()</code> by <code>ursa_ncol()</code>) <code>obj</code>-grid to dimension of <code>ref</code>-grid. This helpful for multipanel plotting if objects have different boundary boxes.
</p>


<h3>Value</h3>

<p><code>ursa_grid</code> return value of <code>$grid</code> item of <code>ursaRaster</code> object.
</p>
<p><code>ursa_grid&lt;-</code> return <code>ursaRaster</code> with modified <code>$grid</code> item.
</p>
<p><code>ursa_ncol</code>, <code>ursa_columns</code>, <code>ursa_samples</code> return integer of length 1.
</p>
<p><code>ursa_nrow</code>, <code>ursa_rows</code>, <code>ursa_lines</code> return integer of length 1.
</p>
<p><code>ursa_extent</code>, <code>ursa_bbox</code> return numeric of length 4 (xmin, ymin, xmax, ymax).
</p>
<p><code>ursa_consistent</code> returns <code><a href="#topic+classGrid">ursaGrid</a></code> object.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- pixelsize()
print(ursa_grid(a))
ursa_grid(a)$crs &lt;- gsub("\\.0+","",ursa_grid(a)$crs)
print(ursa_grid(a))
</code></pre>

<hr>
<h2 id='ursa_info'>
Print metadata for raster image.
</h2><span id='topic+ursa_info'></span>

<h3>Description</h3>

<p>Function shows information about raster CRS, data type, storage mode, nodata value, structure of band names.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ursa_info(obj, detail = NA, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ursa_info_+3A_obj">obj</code></td>
<td>

<p><code>ursaRaster</code> object
</p>
</td></tr>
<tr><td><code id="ursa_info_+3A_detail">detail</code></td>
<td>

<p><em>Not used. Reserved for potential detail levels</em>
</p>
</td></tr>
<tr><td><code id="ursa_info_+3A_...">...</code></td>
<td>

<p>Arguments, which are passed to <code><a href="utils.html#topic+str">str</a></code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>ursa_info</code> generates a list and then shows structure of this list via function <code><a href="utils.html#topic+str">str</a></code>.
</p>


<h3>Value</h3>

<p>Object of <em>temporal</em> class <code>ursaMetadata</code> is a list with items:
</p>
<table role = "presentation">
<tr><td><code>columns</code></td>
<td>
<p>Number of columns (samples)</p>
</td></tr>
<tr><td><code>rows</code></td>
<td>
<p>Number of rows (lines)</p>
</td></tr>
<tr><td><code>resx</code></td>
<td>
<p>Grid cell size by horizontal axis</p>
</td></tr>
<tr><td><code>resy</code></td>
<td>
<p>Grid cell size by vertical axis</p>
</td></tr>
<tr><td><code>minx</code></td>
<td>
<p>Left margin of boundary box</p>
</td></tr>
<tr><td><code>maxx</code></td>
<td>
<p>Right margin of boundary box</p>
</td></tr>
<tr><td><code>miny</code></td>
<td>
<p>Bottom margin of boundary box</p>
</td></tr>
<tr><td><code>maxy</code></td>
<td>
<p>Top margin of boundary box</p>
</td></tr>
<tr><td><code>proj4</code></td>
<td>
<p>PROJ.4 string</p>
</td></tr>
<tr><td><code>nodata</code></td>
<td>
<p><em>Optional</em>. Value, which is interpreted as <code>NA</code></p>
</td></tr>
<tr><td><code>datatype</code></td>
<td>
<p><em>Optional</em>. If data are on disk, then integer code of data type.</p>
</td></tr>
<tr><td><code>interleave</code></td>
<td>
<p><em>Optional</em>. If data are on disk, then abbreviation of bands interleave.</p>
</td></tr>
<tr><td><code>mode</code></td>
<td>
<p>Character of length 2: <code><a href="base.html#topic+mode">storage mode</a></code> and <code><a href="base.html#topic+class">class</a></code> of value. If data has not been read, then class is <code>"logical"</code>. If data is not in memory, then storage mode is <code>"raw"</code>.</p>
</td></tr>
<tr><td><code>bandname</code></td>
<td>
<p>Band names.</p>
</td></tr>
<tr><td><code>colortable</code></td>
<td>
<p><em>Optional</em>. Structure of <a href="#topic+classColorTable">color table</a>.</p>
</td></tr>
</table>
<p>Function returns <code>NULL</code>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="utils.html#topic+str">str</a></code><br />
<code><a href="#topic+classRaster">print.ursaRaster</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- as.integer(round(ursa_dummy(nband=3)))

print(a) ## print data
ursa_info(a,digits=1) ## print metadata

fname &lt;- tempfile()
write_envi(a,fname,compress=FALSE)
b1 &lt;- open_envi(fname)
ursa_info(b1)
close(b1)
b2 &lt;- read_envi(fname)
ursa_info(b2)

# print ENVI header
sapply(c(" -------------- begin --------------",readLines(paste0(fname,".hdr"))
        ," --------------- end ---------------"),message)

envi_remove(fname)
</code></pre>

<hr>
<h2 id='ursa_new'>
Create raster image in memory
</h2><span id='topic+ursa_new'></span>

<h3>Description</h3>

<p><code>ursa_new</code> creates object of class <code>ursaRaster</code> in memory using <a href="#topic+session">session grid parameters</a> or properties of input object (<code><a href="base.html#topic+matrix">matrix</a></code> or <code><a href="base.html#topic+array">array</a></code>). By option, <a href="#topic+classRaster_names">band names</a> and <a href="#topic+ignorevalue">ignore values</a> are specified.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ursa_new(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ursa_new_+3A_...">...</code></td>
<td>
<p>Set of arguments, which are recognized via their names (using <a href="base.html#topic+regex">regular expressions</a>) and classes:
</p>

<dl>
<dt><code>value</code></dt><dd><p>Pattern is <code>"(|^value)"</code>. Admissible classes are (<code><a href="base.html#topic+matrix">matrix</a></code>, <code><a href="base.html#topic+array">array</a></code>,<code><a href="base.html#topic+numeric">numeric</a></code>,<code><a href="base.html#topic+logical">logical</a></code>. Values to fill image. Array or matrix defines raster grid. If <code>value=FALSE</code> (logical), then created raster image has no values. By default, <code>value=NA</code>, the created raster image is filled by blank values (<code>NA</code>).</p>
</dd>
<dt><code>nband</code></dt><dd><p>Positive integer. Number of bands. Default is <code>1L</code>.</p>
</dd>
<dt><code>bandname</code></dt><dd><p>Character. Band names. Default is <code>NULL</code>. If specified, then <code>nband</code> is ignored, and the number of bands is equal to length of <code>bandname</code> character vector.</p>
</dd>
<dt><code>ignorevalue</code></dt><dd><p>Integer or numeric. Value in ENVI binary file, which is interpretted as <code>NA</code> in <span class="rlang"><b>R</b></span>.</p>
</dd>
<dt><code>datatype</code></dt><dd><p>Positive integer <code>c(1L, 2L, 3L, 4L, 5L, 11L, 12L, 13L)</code> or character. Data type (integer, floating-point) and byte length. See details for argument <code>datatype</code> of function <code><a href="#topic+conn.create_any">create_envi</a></code>. Required for writing raster to ENVI binart file. Optional for rasters in memory. Default is <code>NA</code>: data type is defined internally.</p>
</dd>
<dt><code>colortable</code></dt><dd><p>Object of class <code><a href="#topic+classColorTable">ursaColorTable</a></code>. Color table for raster. Default is <code>NULL</code>: color table is absent</p>
</dd>
<dt><code>permute</code></dt><dd><p>Logical. Should dimensions of input matrix be changed. Default is <code>FALSE</code>.</p>
</dd>
<dt><code>flip</code></dt><dd><p>Logical. Vertical flip for input matrix. Default is <code>FALSE</code>: no flip.</p>
</dd>
<dt><code>crs</code></dt><dd><p>Character or object of class <code>ursaGrid</code>. The reference grid for raster's cells. Default is <code>NULL</code>: the grid is defined ether from matrix/array structure or from <a href="#topic+session">sessional parameters</a>.</p>
</dd>
<dt><code>verb(ose)*</code></dt><dd><p>Logical. Value <code>TRUE</code> may provide some additional information on console. Default is <code>FALSE</code>.</p>
</dd>
</dl>

</td></tr>
</table>


<h3>Details</h3>

<p><code>ursa_new</code> creates <code>ursaRaster</code> object in memory. To manipulate with raster chunks use the followed construction: </p>
<pre>
a &lt;- create_envi(fname,...)
a[condition_1] &lt;- value
print(a[condition_2]
...
close(a)
</pre>
<p><code>ursa_new</code> is designed to create blank raster images. Use <code><a href="#topic+ursa_as">as.ursa</a></code> for conversion <span class="rlang"><b>R</b></span> objects to <code>ursaRaster</code>.
</p>


<h3>Value</h3>

<p>Object of class <code>ursaRaster</code>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ursa_as">as.ursa</a></code>, <code><a href="#topic+conn.create_any">create_envi</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a1 &lt;- ursa_new(volcano)
print(a1)
 ## to avoid over-timing during tests -- begin
   display(a1)
 ## to avoid over-timing during tests -- end

a2 &lt;- ursa_new(volcano,flip=TRUE)
print(a2)
 ## to avoid over-timing during tests -- begin
   display(a2)
 ## to avoid over-timing during tests -- end

a3 &lt;- ursa_new(volcano,permute=TRUE)
print(a3)
 ## to avoid over-timing during tests -- begin
   display(a3)
 ## to avoid over-timing during tests -- end

dima &lt;- c(200,300,4)
b1 &lt;- as.ursa(array(runif(prod(dima)),dim=dima))
print(b1)
display_brick(b1,scale=1,pal=c("white","black"),decor=FALSE)

session_grid(NULL)

c1 &lt;- ursa_new(seq(3))
print(c1)
c2 &lt;- ursa_new(seq(3),bands=3)
print(c2)

c3 &lt;- ursa_new(value=FALSE)
str(ursa_value(c3))

c4 &lt;- ursa_new(bands=2,nodata=-99L)
print(c4)
print(ignorevalue(c4))

c5 &lt;- ursa_new(bandname=format(Sys.Date()+seq(7)-1,"%A"))
ursa_value(c5) &lt;- rev(seq(nband(c5)))
c5 &lt;- colorize(c5)
ct &lt;- ursa_colortable(c5)
print(c5)

v &lt;- ursa_value(c5[3:5])
str(v)
v &lt;- c(v)
str(v)
c6 &lt;- ursa_new(v,colortable=ct)
print(c6)
print(ursa_colortable(c6))
</code></pre>

<hr>
<h2 id='ursaConnection'>
Connection of raster objects.
</h2><span id='topic+class-ursaConnection'></span><span id='topic+print.ursaConnection'></span><span id='topic+seek.ursaConnection'></span>

<h3>Description</h3>

<p>Class <code>ursaConnection</code> is a part of class <code>ursaRaster</code>. It defines storage of raster images and manipulations with reading and writing.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaConnection'
print(x, ...)

## S3 method for class 'ursaConnection'
seek(con, where = NA, origin = "start", rw = "", ...)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ursaConnection_+3A_x">x</code></td>
<td>

<p><code>ursaConnection</code> object in function <code>print</code>.
</p>
</td></tr>
<tr><td><code id="ursaConnection_+3A_con">con</code></td>
<td>

<p><code>ursaConnection</code> object in function <code>seek</code>.
</p>
</td></tr>
<tr><td><code id="ursaConnection_+3A_where">where</code></td>
<td>

<p>Passed to <code><a href="base.html#topic+seek">seek</a></code> for class <code>connection</code>.
</p>
</td></tr>
<tr><td><code id="ursaConnection_+3A_origin">origin</code></td>
<td>

<p>Passed to <code><a href="base.html#topic+seek">seek</a></code> for class <code>connection</code>.
</p>
</td></tr>
<tr><td><code id="ursaConnection_+3A_rw">rw</code></td>
<td>

<p>Passed to <code><a href="base.html#topic+seek">seek</a></code> for class <code>connection</code>.
</p>
</td></tr>
<tr><td><code id="ursaConnection_+3A_...">...</code></td>
<td>

<p><code>print</code>: Further arguments passed to generic functions <code><a href="base.html#topic+print">print</a></code> and <code><a href="utils.html#topic+str">str</a></code>.<br />
<code>seek</code>: Further arguments passed to function <code><a href="base.html#topic+seek">seek</a></code> for class <code>connection</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>ursaConnection</code> get item <code>$con</code> from <code>ursaRaster</code> object.
</p>
<p>Functions <code>print</code> and <code>is.con</code> are for developers rather than users.
</p>
<p>Non-public function <code>.con.skeleton()</code> is used to generate the blank <code>ursaConnection</code> object. This approach provides unified sequence of list's items:
</p>


<h3>Value</h3>

<p><code>ursaConnection</code> is a list. The most of names have a relation to specification of <a href="https://envi.geoscene.cn/help/Subsystems/envi/Content/ExploreImagery/ENVIHeaderFiles.htm">ENVI Header Files</a>. Items:
</p>
<table role = "presentation">
<tr><td><code>driver</code></td>
<td>
<p>Character. Keyword of supported image formats. Allowed &quot;ENVI&quot; or &quot;GDAL&quot;.</p>
</td></tr>
<tr><td><code>samples</code></td>
<td>
<p>Integer. Number of image columns (samples)</p>
</td></tr>
<tr><td><code>lines</code></td>
<td>
<p>Integer. Number of image rows (lines)</p>
</td></tr>
<tr><td><code>bands</code></td>
<td>
<p>Integer. Number of image bands (channels, layers)</p>
</td></tr>
<tr><td><code>datatype</code></td>
<td>
<p>Integer. Keyword for data type (4 - 32-bit floating point, 2 - 16-bit signed integer, <em>etc</em>)</p>
</td></tr>
<tr><td><code>interleave</code></td>
<td>
<p>Character <code>"bsq"</code>, <code>"bil"</code>, <code>"bip"</code>. Data interleave - streams of bytes in storage.</p>
</td></tr>
<tr><td><code>byteorder</code></td>
<td>
<p>Integer, 0 or 1. The order of bytes. <code>byteorder=0</code> less significant byte first, <code>byteorder=1</code> most significant byte first</p>
</td></tr>
<tr><td><code>endian</code></td>
<td>
<p>Character. See <code style="white-space: pre;">&#8288;\dQuote{endian}&#8288;</code> argument in <code><a href="base.html#topic+readBin">readBin</a></code> and <code><a href="base.html#topic+readBin">writeBin</a></code></p>
</td></tr>
<tr><td><code>swap</code></td>
<td>
<p>Integer 0 or 1. Passed to C-funcions <code>fread</code> and <code>fwrite</code></p>
</td></tr>
<tr><td><code>signed</code></td>
<td>
<p>Logical. Derived from <code>$datatype</code></p>
</td></tr>
<tr><td><code>offset</code></td>
<td>
<p>Integer. Header offset in binary file. Default is 0.</p>
</td></tr>
<tr><td><code>wkt</code></td>
<td>
<p>Logical. In ENVI Header files <code>wkt=TRUE</code> forced to use &ldquo;coordinate system string&rdquo; field instead of &ldquo;projection info&rdquo; field</p>
</td></tr>
<tr><td><code>nodata</code></td>
<td>
<p>Numeric. Replacement <code>NA</code> values in the storage.</p>
</td></tr>
<tr><td><code>mode</code></td>
<td>
<p>Character. <code><a href="base.html#topic+mode">storage.mode</a></code> of data</p>
</td></tr>
<tr><td><code>sizeof</code></td>
<td>
<p>Integer, positive. Size in bytes for stored values. Extracted from <code>$datatype</code></p>
</td></tr>
<tr><td><code>indexC</code></td>
<td>
<p>Integer vector. Sample indices in spatial cropping.</p>
</td></tr>
<tr><td><code>indexR</code></td>
<td>
<p>Integer vector. Line indices in spatial cropping.</p>
</td></tr>
<tr><td><code>indexZ</code></td>
<td>
<p>Integer vector. Band indices</p>
</td></tr>
<tr><td><code>posC</code></td>
<td>
<p>Integer vector. Sample indices in partial reading.</p>
</td></tr>
<tr><td><code>posR</code></td>
<td>
<p>Integer vector. Line indices in partial reading.</p>
</td></tr>
<tr><td><code>posZ</code></td>
<td>
<p>Integer vector. Band indices in spatial crottping or partial reading.</p>
</td></tr>
<tr><td><code>fname</code></td>
<td>
<p>Character. File name. If <code>driver=ENVI</code>, then full path for ENVI binary file.</p>
</td></tr>
<tr><td><code>connection</code></td>
<td>
<p>Character. See <code><a href="base.html#topic+connections">connections</a></code></p>
</td></tr>
<tr><td><code>compress</code></td>
<td>
<p>Signed integer. <code>0L</code> no compressing, <code>-1L</code> comressed file plus decompressed file,<code>-2L</code> decompressed file, <code>1L</code> - file will be compressed. </p>
</td></tr>
<tr><td><code>seek</code></td>
<td>
<p>Logical. Does connection support <code><a href="base.html#topic+seek">seek</a></code>?</p>
</td></tr>
<tr><td><code>handle</code></td>
<td>
<p><code><a href="base.html#topic+connections">connections</a></code> in fact</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ursa_000">ursa</a>(obj,"con")</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
print(methods(class="ursaConnection"))

a &lt;- pixelsize()
write_envi(rep(a,5),"tmp1",compress=FALSE)
## change spatial domain for cropping example
g &lt;- session_grid(regrid(lim=c(-1200000,-1400000,1600000,1800000)))
print(g)
b &lt;- open_envi("tmp1")
d &lt;- b[,30:70]
print(ursa(d[2:3],"con"))
close(b)
envi_remove("tmp1")
</code></pre>

<hr>
<h2 id='ursaCRS'>
Coordinate Reference System (CRS) for raster images.
</h2><span id='topic+class-ursaCRS'></span><span id='topic+print.ursaCRS'></span><span id='topic+str.ursaCRS'></span>

<h3>Description</h3>

<p>Class <code>ursaCRS</code> is a part of class <code>ursaGrid</code>. It defines map projection.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaCRS'
print(x, ...)
## S3 method for class 'ursaCRS'
str(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ursaCRS_+3A_x">x</code></td>
<td>

<p><code>ursaCRS</code> object in function <code>print</code>.
</p>
</td></tr>
<tr><td><code id="ursaCRS_+3A_object">object</code></td>
<td>

<p><code>ursaCRS</code> object in function <code>str</code>.
</p>
</td></tr>
<tr><td><code id="ursaCRS_+3A_...">...</code></td>
<td>

<p>Further arguments passed to generic functions <code><a href="base.html#topic+print">print</a></code>, and <code><a href="utils.html#topic+str">str</a></code>.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Functions print information about CRS and return invisible <code>NULL</code> value. 
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- ursa_dummy()
crs &lt;- ursa_crs(a)
print(c('Is proj4string used?'=p4 &lt;- isTRUE(getOption("ursaProj4Legacy"))))
print(crs)
str(crs)
op &lt;- options(ursaProj4Legacy=!p4)
print(c('Is proj4string used?'=p4 &lt;- isTRUE(getOption("ursaProj4Legacy"))))
session_grid(NULL)
a &lt;- ursa_dummy()
crs &lt;- ursa_crs(a)
print(crs)
str(crs)
options(op)
</code></pre>

<hr>
<h2 id='ursaGrid'>
Spatial parameters of raster images.
</h2><span id='topic+class-ursaGrid'></span><span id='topic+str.ursaGrid'></span><span id='topic+print.ursaGrid'></span><span id='topic+dim.ursaGrid'></span><span id='topic+as.data.frame.ursaGrid'></span>

<h3>Description</h3>

<p>Class <code>ursaGrid</code> is a part of class <code>ursaRaster</code>. It defines spatial locations of image.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
## S3 method for class 'ursaGrid'
print(x, ...)

## S3 method for class 'ursaGrid'
str(object, ...)

## S3 method for class 'ursaGrid'
dim(x)

## S3 method for class 'ursaGrid'
as.data.frame(x, row.names = NULL, optional = FALSE, ...)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ursaGrid_+3A_x">x</code></td>
<td>

<p><code>ursaGrid</code> object in functions <code>print</code>, <code>dim</code> and <code>as.data.frmame</code>.
</p>
</td></tr>
<tr><td><code id="ursaGrid_+3A_object">object</code></td>
<td>

<p><code>ursaGrid</code> object in function <code>str</code>.
</p>
</td></tr>
<tr><td><code id="ursaGrid_+3A_row.names">row.names</code></td>
<td>

<p>Ignored. Argument, which is passed to generic function <code><a href="base.html#topic+as.data.frame">as.data.frame</a></code>.
</p>
</td></tr>
<tr><td><code id="ursaGrid_+3A_optional">optional</code></td>
<td>

<p>Ignored. Argument, which is passed to generic function <code><a href="base.html#topic+as.data.frame">as.data.frame</a></code>.
</p>
</td></tr>
<tr><td><code id="ursaGrid_+3A_...">...</code></td>
<td>

<p>Further arguments passed to generic functions <code><a href="base.html#topic+as.data.frame">as.data.frame</a></code>, <code><a href="base.html#topic+print">print</a></code>, and <code><a href="utils.html#topic+str">str</a></code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The blank <code>ursaGrid</code> object is generated by calling of <code>ursa_grid()</code> without arguments. These approaches provide unified sequence of list's items: </p>
<pre>
List of 9
 $ columns: int NA
 $ rows   : int NA
 $ resx   : num NA
 $ resy   : num NA
 $ minx   : num NA
 $ maxx   : num NA
 $ miny   : num NA
 $ maxy   : num NA
 $ proj4  : chr ""
 - attr(*, "class")= chr "ursaGrid"
NULL
</pre>


<h3>Value</h3>

<p>Object of class <code>ursaGrid</code> is a list with items:
</p>
<table role = "presentation">
<tr><td><code>columns</code></td>
<td>
<p>Number of columns (samples)</p>
</td></tr>
<tr><td><code>rows</code></td>
<td>
<p>Number of rows (lines)</p>
</td></tr>
<tr><td><code>resx</code></td>
<td>
<p>Grid cell size by horizontal axis</p>
</td></tr>
<tr><td><code>resy</code></td>
<td>
<p>Grid cell size by vertical axis</p>
</td></tr>
<tr><td><code>minx</code></td>
<td>
<p>Left margin of boundary box</p>
</td></tr>
<tr><td><code>maxx</code></td>
<td>
<p>Right margin of boundary box</p>
</td></tr>
<tr><td><code>miny</code></td>
<td>
<p>Bottom margin of boundary box</p>
</td></tr>
<tr><td><code>maxy</code></td>
<td>
<p>Top margin of boundary box</p>
</td></tr>
<tr><td><code>proj4</code></td>
<td>
<p>PROJ.4 string</p>
</td></tr>
</table>
<p>Function <code>dim</code> for object of class <code>ursaGrid</code> returns named vector of length 2: number of rows (<code>"lines"</code>) and number of elements in a row (<code>"samples"</code>)
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+regrid">regrid</a></code>, <code><a href="#topic+session">session_grid</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
print(methods(class="ursaGrid"))

a &lt;- pixelsize()
g &lt;- ursa_grid(a)
print(is.ursa(a,"grid"))
print(is.ursa(g,"grid"))
print(g)
</code></pre>

<hr>
<h2 id='ursaProgressBar'>
Progress bar
</h2><span id='topic+ursaProgressBar'></span><span id='topic+setUrsaProgressBar'></span><span id='topic+close.ursaProgressBar'></span>

<h3>Description</h3>

<p>Informative progress bars with dispaying elapsed and remained time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ursaProgressBar(kind = c("tk", "txt"),title = .argv0(),
                label = "", min = 0, max = 1, initial = min, width = NA,
                style = 1, tail = FALSE, silent = FALSE)

setUrsaProgressBar(pb, value, title = NULL, label = NULL)

## S3 method for class 'ursaProgressBar'
close(con, ...)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ursaProgressBar_+3A_kind">kind</code></td>
<td>

<p>Character. Type or progress bar. Valid values are <code>"tk"</code> to display progress bar in tcl/tk window and <code>"txt"</code> to display progress bar in terminal mode. Default is <code>"tk"</code>.
</p>
</td></tr>
<tr><td><code id="ursaProgressBar_+3A_style">style</code></td>
<td>

<p>See description for the same argument in <code><a href="utils.html#topic+txtProgressBar">txtProgressBar</a></code>.
</p>
</td></tr>
<tr><td><code id="ursaProgressBar_+3A_width">width</code></td>
<td>

<p>See description for the same argument in <code><a href="tcltk.html#topic+tkProgressBar">tkProgressBar</a></code>.
</p>
</td></tr>
<tr><td><code id="ursaProgressBar_+3A_title">title</code>, <code id="ursaProgressBar_+3A_label">label</code>, <code id="ursaProgressBar_+3A_min">min</code>, <code id="ursaProgressBar_+3A_max">max</code>, <code id="ursaProgressBar_+3A_initial">initial</code>, <code id="ursaProgressBar_+3A_value">value</code>, <code id="ursaProgressBar_+3A_pb">pb</code></td>
<td>

<p>See description for the same arguments in <code><a href="tcltk.html#topic+tkProgressBar">tkProgressBar</a></code> and <code><a href="utils.html#topic+txtProgressBar">txtProgressBar</a></code>.
</p>
</td></tr>
<tr><td><code id="ursaProgressBar_+3A_con">con</code>, <code id="ursaProgressBar_+3A_...">...</code></td>
<td>

<p>See description for the same arguments in <code><a href="base.html#topic+connections">close</a></code>.
</p>
</td></tr>
<tr><td><code id="ursaProgressBar_+3A_tail">tail</code></td>
<td>

<p>Logical. Behaviour of progress bar appearing. If <code>TRUE</code> then progress bar will be used after progress step (e.g., at the end of routine). Default is <code>FALSE</code> (before progress step).
</p>
</td></tr>
<tr><td><code id="ursaProgressBar_+3A_silent">silent</code></td>
<td>

<p>Logical. If <code>TRUE</code> then progress bar will not appeared; it can be useful for conditional scripting. Default is <code>FALSE</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Wrapper to one of
<code><a href="utils.html#topic+txtProgressBar">txtProgressBar</a></code>,
<code><a href="tcltk.html#topic+tkProgressBar">tkProgressBar</a></code>
. 
</p>
<p>Visualization of progress bar is updates each 0.5 seconds, it is effective for multiple short-term iterations.
</p>
<p>Progress bars should be closed by calling of appropriate method of generic function <code><a href="base.html#topic+connections">close</a></code> depending of class of reference progress bar.
</p>


<h3>Value</h3>

<p><code>ursaProgressBar</code> returns object of reference progress bar.
</p>


<h3>Note</h3>

<p>Function name in style <em>camelCase</em> for consistence with other progress bar functions in <span class="rlang"><b>R</b></span>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="utils.html#topic+txtProgressBar">txtProgressBar</a></code>
<code><a href="tcltk.html#topic+tkProgressBar">tkProgressBar</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
n1 &lt;- 3
n2 &lt;- 83
p &lt;- 0.0011
#require(tcltk)
pb &lt;- ursaProgressBar(min=0,max=n1,title="first",tail=TRUE)
for (i in seq(n1)) {
   pb2 &lt;- ursaProgressBar(min=0,max=n2,title="second")
   for (i in seq(n2)) {
      setUrsaProgressBar(pb2)
      Sys.sleep(p)
   }
   close(pb2)
   setUrsaProgressBar(pb)
}
close(pb)
</code></pre>

<hr>
<h2 id='ursaRaster'>
Definition of <code>ursaRaster</code> class.
</h2><span id='topic+class-ursaRaster'></span><span id='topic+is.ursa'></span><span id='topic+is_ursa'></span><span id='topic+print.ursaRaster'></span><span id='topic+str.ursaRaster'></span>

<h3>Description</h3>

<p><code>ursaRaster</code> is S3 class for manipulation with georeferred raster images. See &lsquo;Value&rsquo; <var>section</var>.
<br /><code>is.ursa</code> checks inhering to class <code>ursaRaster</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaRaster'
print(x, digits = NA, grid = FALSE, raw = FALSE, caption = FALSE, ...)

## S3 method for class 'ursaRaster'
str(object,...)

is.ursa(obj, ref = NULL)
is_ursa(obj, ref = NULL)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ursaRaster_+3A_x">x</code>, <code id="ursaRaster_+3A_object">object</code></td>
<td>

<p><code>ursaRaster</code> object.
</p>
</td></tr>
<tr><td><code id="ursaRaster_+3A_obj">obj</code></td>
<td>

<p>Any.
</p>
</td></tr>
<tr><td><code id="ursaRaster_+3A_digits">digits</code></td>
<td>

<p>Passed to <code><a href="base.html#topic+format">format</a></code> function
</p>
</td></tr>
<tr><td><code id="ursaRaster_+3A_grid">grid</code></td>
<td>

<p>Logical. If <code>grid=TRUE</code> then returns simplified metadata.
</p>
</td></tr>
<tr><td><code id="ursaRaster_+3A_raw">raw</code></td>
<td>

<p>Logical. If <code>FALSE</code> and values are categories, then attempting to restore numeric values from categorical names is before calculating of statistics. If <code>TRUE</code> then values for statistics are used as is. Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="ursaRaster_+3A_caption">caption</code></td>
<td>

<p>Logical of character. Print title or other identificational info. If logical and <code>TRUE</code> then print variable name or character representation of expression. If non-zero length character, then print this value. If <code>FALSE</code> (<em>default</em>) or zero-length character, then no header for printing.
</p>
</td></tr>
<tr><td><code id="ursaRaster_+3A_...">...</code></td>
<td>

<p>Passed to <code><a href="base.html#topic+format">format</a></code> function
</p>
</td></tr>
<tr><td><code id="ursaRaster_+3A_ref">ref</code></td>
<td>

<p>Character or <code>NULL</code>. If character, then checking of <code>ursaRaster</code> sub-class(es):
</p>

<table>
<tr>
 <td style="text-align: left;">
   <strong>Pattern</strong> </td><td style="text-align: left;"> <strong>Description</strong>
   </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>NULL</code> </td><td style="text-align: left;"> <code><a href="#topic+classRaster">ursaRaster</a></code>
   </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(raster|brick|ursa)</code> </td><td style="text-align: left;"> <code><a href="#topic+classRaster">ursaRaster</a></code>
   </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>grid</code> </td><td style="text-align: left;"> <code><a href="#topic+classGrid">ursaGrid</a></code>
   </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>(ct|color|table)</code> </td><td style="text-align: left;"> <code><a href="#topic+classColorTable">ursaColorTable</a></code>
   </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>stack</code> </td><td style="text-align: left;"> <code><a href="#topic+classStack">ursaStack</a></code>
   </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>con</code> </td><td style="text-align: left;"> <code><a href="#topic+classConnection">ursaConnection</a></code>
   </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>val</code> </td><td style="text-align: left;"> <code><a href="#topic+classValue">ursaNumeric</a></code> OR <code><a href="#topic+classValue">ursaCategory</a></code>
   </td>
</tr>
<tr>
 <td style="text-align: left;"> <code>cat</code> </td><td style="text-align: left;"> <code><a href="#topic+classValue">ursaCategory</a></code>
</td>
</tr>

</table>

</td></tr>
</table>


<h3>Details</h3>

<p><code>is.ursa()</code> is designed mainly for developers to check arguments' class in function's call. <code>is_ursa</code> is a synonym to <code>is.ursa</code>.
<br />
Stucture of <code>ursaRaster</code> class is generated by non-public <code>.raster.skeleton()</code> function.
</p>


<h3>Value</h3>

<p><code>ursaRaster</code> is <span class="rlang"><b>R</b></span>'s S3 class. It is a list with items:
</p>
<table role = "presentation">
<tr><td><code>grid</code></td>
<td>
<p>Geospatial properties. <code><a href="#topic+classGrid">ursaGrid</a></code> object</p>
</td></tr>
<tr><td><code>con</code></td>
<td>
<p>Connection properties.<code><a href="#topic+classConnection">ursaConnection</a></code> object</p>
</td></tr>
<tr><td><code>value</code></td>
<td>
<p>2-dimensional numerical or integer matrix of classes <code><a href="#topic+classValue">ursaValue</a></code> in <em>(spatial, temporal)</em> specification formed from <em>(samples*lines, bands)</em>. If data are not in memory, then <code>NA</code>.</p>
</td></tr>
<tr><td><code>dim</code></td>
<td>
<p>Dimension of <code>$value</code>. If bands are interpreted as observations in time, then it is <em>spatial</em> by <em>temporal</em> dimension of data. Even data are not in memory, <code>dim</code> is a dimension of whole data.</p>
</td></tr>
<tr><td><code>name</code></td>
<td>
<p>Band names</p>
</td></tr>
<tr><td><code>colortable</code></td>
<td>
<p>Color table. <code><a href="#topic+classColorTable">ursaColorTable</a></code> object</p>
</td></tr>
</table>
<p><code>is.ursa(x)</code> returns <code>TRUE</code>, if class of <code>x</code> is <code>ursaRaster</code>
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
print(methods(class="ursaRaster"))

a &lt;- pixelsize()
print(a)
print(a,grid=TRUE)
s &lt;- substr(as.character(sessionInfo()),1,48)
b &lt;- rep(a,length(s))
bandname(b) &lt;- s
print(b)

require(datasets)
data(volcano)
print(is.ursa(a))
print(is.ursa(volcano))
print(is.ursa(as.ursa(volcano)))
</code></pre>

<hr>
<h2 id='ursaStack'>
List of raster images.
</h2><span id='topic+class-ursaStack'></span><span id='topic+ursa_stack'></span><span id='topic+ursa_brick'></span><span id='topic+ursa_apply'></span><span id='topic+ursaStack'></span><span id='topic+as.list.ursaRaster'></span><span id='topic+unlist.ursaStack'></span>

<h3>Description</h3>

<p>Functions to create list (layers) of multiband raster images (<em>stack</em> in the notation of <span class="pkg">raster</span> package) and to coerce list of images to single multiband image (<em>brick</em> in the notation of <span class="pkg">raster</span> package).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
ursa_stack(...)

ursa_brick(obj)

ursa_apply(obj, FUN, ...)

## S3 method for class 'ursaRaster'
as.list(x, ...)

## S3 method for class 'ursaStack'
unlist(x, recursive, use.names)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ursaStack_+3A_obj">obj</code>, <code id="ursaStack_+3A_x">x</code></td>
<td>

<p>Object of class <code>ursaRaster</code> or list of <code>ursaRaster</code> objects. In function <code>ursa_apply</code> argument &quot;<code>X</code>&quot;, which is passed to function <code><a href="base.html#topic+lapply">lapply</a></code>.
</p>
</td></tr>
<tr><td><code id="ursaStack_+3A_fun">FUN</code></td>
<td>

<p>Argument &quot;<code>FUN</code>&quot;, which is passed to function <code><a href="base.html#topic+lapply">lapply</a></code>.
</p>
</td></tr>
<tr><td><code id="ursaStack_+3A_recursive">recursive</code></td>
<td>

<p>Not used. For consistency with generic function <code><a href="base.html#topic+unlist">unlist</a></code>.
</p>
</td></tr>
<tr><td><code id="ursaStack_+3A_use.names">use.names</code></td>
<td>

<p>Not used. For consistency with generic function <code><a href="base.html#topic+unlist">unlist</a></code>.
</p>
</td></tr>
<tr><td><code id="ursaStack_+3A_...">...</code></td>
<td>
<p>Denending of functions:<br />
</p>

<table>
<tr>
 <td style="text-align: left;">
   <code>ursa_stack</code>, <code>as.list</code> </td><td style="text-align: left;"></td>
</tr>
<tr>
 <td style="text-align: left;"></td><td style="text-align: left;"> List of <code>ursaRaster</code> objects</td>
</tr>
<tr>
 <td style="text-align: left;">
   <code>ursa_apply</code> </td><td style="text-align: left;"></td>
</tr>
<tr>
 <td style="text-align: left;"></td><td style="text-align: left;"> Arguments "<code>...</code>", which are passed to function <code><a href="base.html#topic+lapply">lapply</a></code>.
   </td>
</tr>

</table>

</td></tr>
</table>


<h3>Details</h3>

<p><code>as.list</code> (of <code>ursaRaster</code> object(s)), <code>ursa_stack</code> create list of <code>ursaRaster</code> objects, where items of list are sinle-band images. If <code>x</code> is <code>ursaRaster</code> object, then <code>list(x)</code> create a list of length one, which item is multiband image.
</p>
<p><code>unlist</code> (for list of <code>ursaRaster</code> objects), <code>ursa_brick</code> create single multiband <code>ursaRaster</code> object. There is an alternative way for unlisting the list of <code>ursaRaster</code>: <code><a href="#topic+ursa_as">as.ursa</a></code>.
</p>
<p>Raster <em>stack</em> is a way to group bands, for example, by units (degree Celsium, meters).<br />
Raster <em>brick</em> is a way to combine versalite images to the single multiband image, for example, for saving in file.
</p>


<h3>Value</h3>

<p><code>ursa_stack</code>, <code>as.list</code> return object of class <code>ursaStack</code>. It is a list, with class &quot;ursaStack&quot; attribute.
</p>
<p><code>unlist</code> (for list of <code>ursaRaster</code> objects), <code>ursa_brick</code> return object of class <code>ursaRaster</code>.
</p>
<p><code>ursa_apply</code> returns object of class <code>ursaStack</code>, if result is list of <code>ursaRaster</code> objects, otherwise returns general <code><a href="base.html#topic+list">list</a></code>.
</p>


<h3>Warning </h3>

<p>There is no any verifications, that <a href="#topic+classGrid">grids</a> of <code>ursaRaster</code> objects are the same.
</p>


<h3>Note</h3>

<p>Generic <code><a href="base.html#topic+unlist">unlist</a>(x)</code> deals only with class of <code>x</code>, but doesn't take into account class of objects in list (e. g., <code>x[[1]]</code>). So, there is no effective way to use only <code><a href="base.html#topic+list">list</a></code>/<code><a href="base.html#topic+unlist">unlist</a></code> for <code>ursaRaster</code> objects to do a conversion between raster <em>brick</em> and <em>stack</em>.
Generic <code><a href="base.html#topic+unlist">unlist</a>(x)</code> deals only with class of <code>x</code>, but doesn't take into account class of objects in list (e. g., <code>x[[1]]</code>). So, there is no effective way to use only <code><a href="base.html#topic+list">list</a></code>/<code><a href="base.html#topic+unlist">unlist</a></code> for <code>ursaRaster</code> objects to do a conversion between raster <em>brick</em> and <em>stack</em>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov
</p>


<h3>References</h3>

<p><a href="https://CRAN.R-project.org/package=raster">https://CRAN.R-project.org/package=raster</a>
</p>


<h3>See Also</h3>

<p><code><a href="base.html#topic+lapply">lapply</a></code> <code><a href="base.html#topic+list">list</a></code> <code><a href="base.html#topic+unlist">unlist</a></code>
</p>
<p><code><a href="#topic+classRaster_c">c</a></code> for <code>ursaRaster</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
a &lt;- ursa_dummy(3)
print(a)
b1 &lt;- ursa_stack(a[1:2],colorize(a[3],ramp=FALSE))
print(b1)
b2 &lt;- as.list(a)
print(b2)
b3 &lt;- list(a[1],a[2:3])
print(b3)
b31 &lt;- lapply(b3,colorize,ramp=FALSE)
print(b31)
b32 &lt;- ursa_apply(b3,colorize,ramp=FALSE,rev=TRUE)
print(b32)
s311 &lt;- ursa_apply(b31,ursa_colortable)
print(s311)
s21 &lt;- lapply(b2,global_mean)
print(s21)
s22 &lt;- sapply(b2,global_mean)
print(s22)
s31 &lt;- lapply(b3,global_mean)
print(s31)
s32 &lt;- sapply(b3,global_mean)
print(s32)
c1 &lt;- unlist(b1)
print(c1)
c2 &lt;- unlist(b2)
print(c2)
c3 &lt;- unlist(b3)
print(if (is.ursa(c3)) c3 else "broken object")
d3 &lt;- as.ursa(b3)
print(if (is.ursa(d3)) d3 else "broken object")
</code></pre>

<hr>
<h2 id='ursaValue'>
Values of raster images.
</h2><span id='topic+class-ursaValue'></span><span id='topic+class-ursaNumeric'></span><span id='topic+class-ursaCategory'></span><span id='topic+print.ursaCategory'></span><span id='topic+print.ursaNumeric'></span><span id='topic+ursa_value'></span><span id='topic+ursa_value+3C-'></span>

<h3>Description</h3>

<p>Class <code>ursaValue</code> is a part of class <code>ursaRaster</code>. It contains values of image. In the case of numeric values, the exterior class is <code>ursaNumeric</code>. In the case of categorical values, the exterior class is <code>ursaCategory</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ursaCategory'
print(x, ...)

## S3 method for class 'ursaNumeric'
print(x, ...)

ursa_value(obj, band)
ursa_value(obj, band) &lt;- value
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ursaValue_+3A_x">x</code></td>
<td>

<p>Object of the one of classes <code>ursaNumeric</code> or <code>ursaCategory</code>
</p>
</td></tr>
<tr><td><code id="ursaValue_+3A_...">...</code></td>
<td>

<p>Further arguments passed to generic functions <code><a href="base.html#topic+print">print</a></code> and <code><a href="utils.html#topic+str">str</a></code>.
</p>
</td></tr>
<tr><td><code id="ursaValue_+3A_obj">obj</code></td>
<td>

<p>Object of class <code>ursaRaster</code>
</p>
</td></tr>
<tr><td><code id="ursaValue_+3A_band">band</code></td>
<td>

<p>Optional. Vector of band numbers (positive integer) or band names (character).
</p>
</td></tr>
<tr><td><code id="ursaValue_+3A_value">value</code></td>
<td>

<p>Numeric or integer scalar, vector, or matrix. Coerced to dimenstion of <code>ursaValue</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Try to use high-level assignment using replacement <code><a href="#topic+classRaster.Replace">[&lt;-</a></code> operator for class <code>ursaRaster</code>. However, if you don't get desired result, you can downgrade the level of your code.
</p>


<h3>Value</h3>

<p>Object of class <code>ursaNumeric</code> is a numerical matrix. Object of class <code>ursaCategory</code> is an integer matrix. Dimensions of this matrix:
</p>
<table role = "presentation">
<tr><td><code>dim(...)[1]</code></td>
<td>
<p>Spatial domain; the length is muliplications of lines (rows) and samples (columns)</p>
</td></tr>
<tr><td><code>dim(...)[2]</code></td>
<td>
<p>Band or temporal domain; the length is number of bands</p>
</td></tr>
</table>
<p>It is allowed to use scalar value <code>NA</code> in the case when values are not in memory. In this case the class is <code>ursaValue</code>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p>Extract <code><a href="#topic+classRaster.Extract">[</a></code> and replacement <code><a href="#topic+classRaster.Replace">[&lt;-</a></code> methods for class <code>ursaRaster</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
session_grid(regrid(mul=1/4))
a1 &lt;- create_envi("exam1.envi",bandname=c("today","tomorrow"))
str(ursa_value(a1))
close(a1)
envi_remove("exam1")
a2 &lt;- ursa_dummy(nband=4,min=1,max=99)
str(ursa_value(a2),digits=3)
a3 &lt;- as.integer(a2)
str(ursa_value(a3))
str(ursa_value(a3,2))
print(ursa_value(a3))
print(a3)
ursa_value(a3,"Band 2") &lt;- 199
ursa_value(a3)[,3] &lt;- 299
a3[4] &lt;- 399
print(a3)
ursa_value(a3[1:3]) &lt;- ursa_value(a3[4])
print(a3)
ursa_value(a3[1:3]) &lt;- -c(1:3)
print(a3)
</code></pre>

<hr>
<h2 id='whiteboxing'>
Wrapper to WhiteboxTools
</h2><span id='topic+whiteboxing'></span>

<h3>Description</h3>

<p>Wrapper to tools from <span class="pkg">&quot;whitebox&quot;</span> package to manipulate with <code>ursaRaster</code> objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>whiteboxing(tool_name, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="whiteboxing_+3A_tool_name">tool_name</code></td>
<td>

<p>Either tool name of Whitebox or function name from <span class="pkg"><a href="whitebox.html#topic+whitebox">whitebox</a></span>.
</p>
</td></tr>
<tr><td><code id="whiteboxing_+3A_...">...</code></td>
<td>

<p>List of parameters.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Wrapper to function <code><a href="whitebox.html#topic+wbt_run_tool">wbt_run_tool</a></code>.
</p>
<p><code>ursaRaster</code> object <code>foo</code> can be passed via parameter <code>input=foo</code> instead of GeoTIFF file name.
</p>


<h3>Value</h3>

<p>If argument <code>output</code> is missed or <code>output=FALSE</code>, then object of class <code>ursaRaster</code>. Otherwise, output GeoTIFF file name.
</p>


<h3>Note</h3>

<p>Internally, for piping support, first character argument without <code>*.tif</code> suffix is interpreted as <code>tool_name</code>. First unnamed character argument with <code>*.tif</code> suffix or <code>ursaRaster</code> object is interpreted as input.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><a href="https://github.com/jblindsay/whitebox-tools/releases/">WhiteboxTools</a>
<span class="pkg"><a href="whitebox.html#topic+whitebox">whitebox</a></span>  
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if ((requireNamespace("whitebox"))&amp;&amp;(isTRUE(whitebox::wbt_init()))) {
   dem &lt;- whitebox::sample_dem_data()
   a1 &lt;- c(DEM=read_gdal(dem))
   a2 &lt;- whiteboxing("BreachDepressions",input=a1)
   b &lt;- list(value=c(a1,a2),difference=c(diff=a1-a2))
   print(b)
   display(b,layout=c(2,NA),legend=list(list("first","left"),list("last","left")))
   if (getRversion()&gt;="4.1.0") {
      a5 &lt;- dem |&gt;
         whiteboxing("feature_preserving_smoothing",filter=9) |&gt;
         whiteboxing("breach_depressions") |&gt;
         print()
   }
}
</code></pre>

<hr>
<h2 id='write_envi'>
Write raster image to ENVI .hdr Labelled Raster file.
</h2><span id='topic+write_envi'></span>

<h3>Description</h3>

<p><code>write_envi</code> writes in-memory object of class <code>ursaRaster</code> to disk in the ENVI .hdr Labelled Raster file format.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_envi(obj, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="write_envi_+3A_obj">obj</code></td>
<td>

<p>Object of class <code>ursaRaster</code>.
</p>
</td></tr>
<tr><td><code id="write_envi_+3A_...">...</code></td>
<td>

<p>Arguments, which are passed to <code><a href="#topic+conn.create_any">create_envi</a></code>. Usually, only file name (character) is required. If <a href="base.html#topic+missing">missing</a>, then occasional name is assigned.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>write_envi</code> implements writing the whole <code>ursaRaster</code> object to disk. For multiple access to disk (by chunks), use followed construction: </p>
<pre>
a &lt;- create_envi(fname)
a[condition_1] &lt;- value1
a[condition_2] &lt;- value2
...
close(a)
</pre>


<h3>Value</h3>

<p>Integer code of ENVI data type. See values of the &ldquo;data type&rdquo; field in description of the <a href="https://envi.geoscene.cn/help/Subsystems/envi/Content/ExploreImagery/ENVIHeaderFiles.htm">ENVI Header Format</a>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sev-in.ru">platonov@sev-in.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+conn.create_any">create_envi</a></code>, <em><a href="#topic+classRaster.Replace">Replace</a></em> method <code><a href="#topic+classRaster.Replace">[&lt;-</a></code> for <code>ursaRaster</code> object, <code><a href="#topic+classRaster_close">close_envi</a></code> (<code><a href="#topic+classRaster_close">close</a></code> for <code>ursaRaster</code> object).
</p>
<p><code><a href="#topic+conn.write_gdal">write_gdal</a>(...,driver="ENVI")</code> uses GDAL (<span class="pkg">rgdal</span>) for writing <code>ursaRaster</code> object to the ENVI .hdr Labelled Raster file.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
dir.create(tmpWD &lt;- file.path(tempdir(),"certain"))
wd &lt;- setwd(tmpWD)
print(c('temp dir'=session_tempdir(),'working dir'=getwd()))
list1a &lt;- envi_list(session_tempdir())
list1b &lt;- envi_list()
fname &lt;- tempfile(tmpdir=".")
a &lt;- ursa_dummy()
bandname(a) &lt;- c("first","second","third")
write_envi(a)
write_envi(a,fname)
list2a &lt;- envi_list(session_tempdir())
list2b &lt;- envi_list()
fname1 &lt;- list2a[!(list2a %in% list1a)]
fname2 &lt;- list2b[!(list2b %in% list1b)]
print(c('in temp dir'=fname1,'in working dir'=fname2))
a2 &lt;- open_envi(fname1)
print(a2)
close(a2)
envi_remove(c(fname1,fname2))
setwd(wd)
</code></pre>

<hr>
<h2 id='write_gdal'>
Write raster image to GDAL file(s)
</h2><span id='topic+write_gdal'></span><span id='topic+ursa_write'></span>

<h3>Description</h3>

<p><code>write_gdal</code> writes in-memory object of class <code>ursaRaster</code> to disk using GDAL from <span class="pkg">rgdal</span> package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_gdal(obj, ...)
ursa_write(obj, fname, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="write_gdal_+3A_obj">obj</code></td>
<td>

<p>Object of class <code>ursaRaster</code>.
</p>
</td></tr>
<tr><td><code id="write_gdal_+3A_...">...</code></td>
<td>

<p>Arguments, which are passed to <code><a href="#topic+conn.create_any">create_gdal</a></code>. Usually, only file name with extension (character) is required. If extension is &quot;.envi&quot;, then GDAL driver &quot;ENVI&quot; is used. If extension is &quot;.tif&quot;, then GDAL driver &quot;GTiff&quot; is used. If extension is &quot;.img&quot;, then GDAL driver &quot;HFA&quot; is used. If extension is &quot;.jpg&quot; or &quot;*.jpeg&quot;, then GDAL driver &quot;JPEG&quot; is used. If extension is &quot;.bmp&quot;, then GDAL driver &quot;BMP&quot; is used. If extension is &quot;.png&quot;, then GDAL driver &quot;PNG&quot; is used. Additionally, argument <code>driver</code> should be specified. If argument <code>...</code> is <a href="base.html#topic+missing">missing</a>, then occasional name is assigned.
</p>
<p>For GDAL formats it is creation options <code>"-co"</code>, e. g., <code>compress="LZW",tiled="NO"</code> are interpeted as <code>-co "COMPRESS=LZW" -co "TILED=NO"</code>.
</p>
<p>For GDAL formats <code>options=</code> (named list <code>list(foo="bar1", foo2="bar2")</code>, named characters <code>c(foo="bar1", foo2="bar2")</code>, characters in format <code>"foo1=bar1 foo2=bar2"</code>) is interpeted as creation options (<code>-co</code>) explicitly. 
</p>
<p>For GDAL formats <code>driver=</code> is interpeted as driver short name (<code>-fo</code>) explicitly.
</p>
</td></tr>
<tr><td><code id="write_gdal_+3A_fname">fname</code></td>
<td>

<p>Character. File name with extension.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>ursa_write</code> is simplified call of <code>write_gdal</code>.
</p>
<p><code>write_gdal</code> implements writing the whole <code>ursaRaster</code> object to disk. For multiple access to disk (by chunks), use followed <em><a href="#topic+classRaster.Replace">Replace</a></em> construction: </p>
<pre>
a &lt;- create_gdal(fname)
a[condition_1] &lt;- value1
a[condition_2] &lt;- value2
...
close(a)
</pre>


<h3>Value</h3>

<p>Integer code of ENVI data type. See values of the &ldquo;data type&rdquo; field in description of the <a href="https://envi.geoscene.cn/help/Subsystems/envi/Content/ExploreImagery/ENVIHeaderFiles.htm">ENVI Header Format</a>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+conn.create_any">create_gdal</a></code>, <em><a href="#topic+classRaster.Replace">Replace</a></em> method <code><a href="#topic+classRaster.Replace">[&lt;-</a></code> for <code>ursaRaster</code> object, <code><a href="#topic+classRaster_close">close</a></code> method for <code>ursaRaster</code> object.
</p>
<p><code><a href="#topic+conn.write_envi">write_envi</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
ftemp &lt;- tempfile(pattern="",fileext="")
fpath &lt;- dirname(ftemp)
fname &lt;- basename(ftemp)
a &lt;- round(ursa_dummy(1,min=0,max=255,nodata=NA))
write_envi(a,file.path(fpath,paste0(fname,"_1",".envi")))
write_gdal(a,file.path(fpath,paste0(fname,"_2")))
write_gdal(a,file.path(fpath,paste0(fname,"_3",".tif")))
write_gdal(a,file.path(fpath,paste0(fname,"_4")),driver="EHdr")
flist &lt;- dir(path=fpath,pattern=fname,full.names=TRUE)
file.remove(flist)
blist &lt;- basename(flist)
res &lt;- NULL
for (i in seq(4))
   res &lt;- c(res,paste(grep(paste0("_",i),blist,value=TRUE),collapse=" "))
print(res)
</code></pre>

<hr>
<h2 id='zonal_stat'>
Zonal statistics for raster maps
</h2><span id='topic+zonal_stat'></span><span id='topic+aggregate.ursaRaster'></span>

<h3>Description</h3>

<p>'Zonal' operator of map algebra. Applied to raster images.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>zonal_stat(x, by, FUN, table = FALSE)

## S3 method for class 'ursaRaster'
aggregate(x, by, FUN, table = FALSE, ...)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="zonal_stat_+3A_x">x</code></td>
<td>

<p><code>ursaRaster</code> object. Image for analysis.
</p>
</td></tr>
<tr><td><code id="zonal_stat_+3A_by">by</code></td>
<td>

<p><code>ursaRaster</code> object. Image of grouping elements.
</p>
</td></tr>
<tr><td><code id="zonal_stat_+3A_fun">FUN</code></td>
<td>

<p>a function to compute the summary statistics which can be applied to all data subsets.
</p>
</td></tr>
<tr><td><code id="zonal_stat_+3A_table">table</code></td>
<td>

<p>Logical. If <code>table=TRUE</code> then summary statistics for each group is returned. The statistics is defined by <code>FUN</code>. If <code>stat=FALSE</code> then result is presented as <code>ursaRaster</code> object.
</p>
</td></tr>
<tr><td><code id="zonal_stat_+3A_...">...</code></td>
<td>

<p>Other arguments which passed to function <code><a href="stats.html#topic+aggregate">aggregate</a></code> of package <span class="pkg">stats</span>
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>zonal_stat</code> is a wrapper of <code>aggregate(x,by,FUN,table=FALSE,na.rm=TRUE)</code>
</p>
<p>You can use multichannel image (argument <code>x</code>) for analysis.
</p>
<p>You can use multichannel raster image for group elements (argument <code>by</code>)
</p>


<h3>Value</h3>

<p>If <code>table=FALSE</code> then <code>ursaRaster</code> object of summarized statistics.
<br />
If <code>table=TRUE</code> then <code>data.frame</code>.
</p>


<h3>Author(s)</h3>

<p>Nikita Platonov <a href="mailto:platonov@sevin.ru">platonov@sevin.ru</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>session_grid(NULL)
session_grid(regrid(mul=1/2))
a &lt;- pixelsize()
val &lt;- c(normal=a,half=a/2)
gr &lt;- c(group=colorize(a,nbreak=1,lazyload=FALSE))#+0
print(as.table(gr))
##~ display(gr)
ra &lt;- round(aggregate(val,gr,mean),4)
print(ra)
print(as.table(ra[1]))
print(as.table(ra[2]))
da &lt;- aggregate(val,gr,table=TRUE,mean)
n &lt;- aggregate(a,gr,table=TRUE,length)[,2,drop=FALSE]
da &lt;- cbind(da,n=unname(n))
gr2 &lt;- c(group2=colorize(a,nbreak=6,lazyload=FALSE))#+0
mgr &lt;- list(gr,gr2)
da2 &lt;- aggregate(val[1],mgr,table=TRUE,mean)
print(da2)
da3 &lt;- aggregate(val,mgr,table=TRUE,mean)
print(da3)
ra3 &lt;- aggregate(val,mgr,table=FALSE,mean) ## not implemented for rasters
print(ra3)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
