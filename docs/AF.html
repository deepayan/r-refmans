<!DOCTYPE html><html><head><title>Help for package AF</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {AF}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#AF.cc'><p>Attributable fraction for mached and non-matched case-control sampling designs. NOTE! Deprecated function. Use <code>AFglm</code> (for unmatched case-control studies) or <code>AFclogit</code> (for matched case-control studies).</p></a></li>
<li><a href='#AF.ch'><p>Attributable fraction function for cohort sampling designs with time-to-event outcomes. NOTE! Deprecated function. Use <code>AFcoxph</code>.</p></a></li>
<li><a href='#AF.cs'><p>Attributable fraction for cross-sectional sampling designs. NOTE! Deprecated function. Use <code>AFglm</code>.</p></a></li>
<li><a href='#AFclogit'><p>Attributable fraction estimation based on a conditional logistic regression model as a <code>clogit</code> object (commonly used for matched case-control sampling designs).</p></a></li>
<li><a href='#AFcoxph'><p>Attributable fraction function based on a Cox Proportional Hazard regression model as a <code>coxph</code> object (commonly used for cohort sampling designs with time-to-event outcomes).</p></a></li>
<li><a href='#AFglm'><p>Attributable fraction estimation based on a logistic regression model from a <code>glm</code> object (commonly used for cross-sectional or case-control sampling designs).</p></a></li>
<li><a href='#AFivglm'><p>Attributable fraction function based on Instrumental Variables (IV) regression as an <code>ivglm</code> object in the <code>ivtools</code> package.</p></a></li>
<li><a href='#AFparfrailty'><p>Attributable fraction function based on a Weibull gamma-frailty model as a <code>parfrailty</code> object (commonly used for cohort sampling family designs with time-to-event outcomes).</p></a></li>
<li><a href='#clslowbwt'><p>Birthweight data clustered on the mother.</p></a></li>
<li><a href='#plot.AF'><p>Plot function for objects of class &quot;<code>AF</code>&quot; from the function <code>AFcoxph</code> or <code>AFparfrailty</code>.</p></a></li>
<li><a href='#rott2'><p>Cohort study on breast cancer patients from the Netherlands.</p></a></li>
<li><a href='#singapore'><p>Case-control study on oesophageal cancer in Chinese Singapore men.</p></a></li>
<li><a href='#summary.AF'><p>Summary function for objects of class &quot;<code>AF</code>&quot;.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Model-Based Estimation of Confounder-Adjusted Attributable
Fractions</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.5</td>
</tr>
<tr>
<td>Author:</td>
<td>Elisabeth Dahlqwist and Arvid Sjolander</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Elisabeth Dahlqwist &lt;elisabeth.dahlqwist88@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Estimates the attributable fraction in different sampling designs
    adjusted for measured confounders using logistic regression (cross-sectional
    and case-control designs), conditional logistic regression (matched case-control
    design), Cox proportional hazard regression (cohort design with time-to-
    event outcome), gamma-frailty model with a Weibull baseline hazard and instrumental variables analysis.
    An exploration of the AF with a genetic exposure can be found in the package 'AFheritability' Dahlqwist E et al. (2019) &lt;<a href="https://doi.org/10.1007%2Fs00439-019-02006-8">doi:10.1007/s00439-019-02006-8</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Depends:</td>
<td>stats, base, graphics, survival, drgee, stdReg, R (&ge; 3.5.0),
data.table, ivtools</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>6.1.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2019-05-20 08:21:41 UTC; elidah</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2019-05-20 18:00:10 UTC</td>
</tr>
</table>
<hr>
<h2 id='AF.cc'>Attributable fraction for mached and non-matched case-control sampling designs. NOTE! Deprecated function. Use <code><a href="#topic+AFglm">AFglm</a></code> (for unmatched case-control studies) or <code><a href="#topic+AFclogit">AFclogit</a></code> (for matched case-control studies).</h2><span id='topic+AF.cc'></span>

<h3>Description</h3>

<p><code>AF.cc</code> estimates the model-based adjusted attributable fraction for data from matched and non-matched case-control sampling designs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>AF.cc(formula, data, exposure, clusterid, matched = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="AF.cc_+3A_formula">formula</code></td>
<td>
<p>an object of class &quot;<code>formula</code>&quot; (or one that can be coerced to that class): a symbolic description of the model used for confounder adjustment. The exposure and confounders should be specified as independent (right-hand side) variables. The outcome should be specified as dependent (left-hand side) variable. The formula is used to object a logistic regression by <code><a href="stats.html#topic+glm">glm</a></code> for non-matched case-control and conditional logistic regression by <code><a href="drgee.html#topic+gee">gee</a></code> (in package <code><a href="drgee.html#topic+drgee">drgee</a></code>) for matched case-control.</p>
</td></tr>
<tr><td><code id="AF.cc_+3A_data">data</code></td>
<td>
<p>an optional data frame, list or environment (or object coercible by <code>as.data.frame</code> to a data frame) containing the variables in the model. If not found in <code>data</code>, the variables are taken from environment (<code>formula</code>), typically the environment from which the function is called.</p>
</td></tr>
<tr><td><code id="AF.cc_+3A_exposure">exposure</code></td>
<td>
<p>the name of the exposure variable as a string. The exposure must be binary (0/1) where unexposed is coded as 0.</p>
</td></tr>
<tr><td><code id="AF.cc_+3A_clusterid">clusterid</code></td>
<td>
<p>the name of the cluster identifier variable as a string, if data are clustered (e.g. matched).</p>
</td></tr>
<tr><td><code id="AF.cc_+3A_matched">matched</code></td>
<td>
<p>a logical that specifies if the sampling design is matched (TRUE) or non-matched (FALSE) case-control. Default setting is non-matched (<code>matched = FALSE</code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>Af.cc</code> estimates the attributable fraction for a binary outcome <code>Y</code>
under the hypothetical scenario where a binary exposure <code>X</code> is eliminated from the population.
The estimate is adjusted for confounders <code>Z</code> by logistic regression for unmatched case-control (<code><a href="stats.html#topic+glm">glm</a></code>) and conditional logistic regression for matched case-control (<code><a href="drgee.html#topic+gee">gee</a></code>).
The estimation assumes that the outcome is rare so that the risk ratio can be approximated by the odds ratio, for details see Bruzzi et. al.
Let the AF be defined as
</p>
<p style="text-align: center;"><code class="reqn">AF = 1 - \frac{Pr(Y_0=1)}{Pr(Y = 1)}</code>
</p>

<p>where <code class="reqn">Pr(Y_0=1)</code> denotes the counterfactual probability of the outcome if
the exposure would have been eliminated from the population. If <code>Z</code> is sufficient for confounding control then the probability <code class="reqn">Pr(Y_0=1)</code> can be expressed as
</p>
<p style="text-align: center;"><code class="reqn">Pr(Y_0=1)=E_Z\{Pr(Y=1\mid{X}=0,Z)\}.</code>
</p>

<p>Using Bayes' theorem this implies that the AF can be expressed as
</p>
<p style="text-align: center;"><code class="reqn">AF = 1-\frac{E_Z\{Pr(Y=1\mid X=0,Z)\}}{Pr(Y=1)}=1-E_Z\{RR^{-X}(Z)\mid{Y = 1}\}</code>
</p>

<p>where <code class="reqn">RR(Z)</code> is the risk ratio </p>
<p style="text-align: center;"><code class="reqn">\frac{Pr(Y=1\mid{X=1,Z})}{Pr(Y=1\mid{X=0,Z})}.</code>
</p>

<p>Moreover, the risk ratio can be approximated by the odds ratio if the outcome is rare. Thus,
</p>
<p style="text-align: center;"><code class="reqn"> AF \approx 1 - E_Z\{OR^{-X}(Z)\mid{Y = 1}\}.</code>
</p>

<p>The odds ratio is estimated by logistic regression or conditional logistic regression.
If <code>clusterid</code> is supplied, then a clustered sandwich formula is used in all variance calculations.
</p>


<h3>Value</h3>

<table>
<tr><td><code>AF.est</code></td>
<td>
<p>estimated attributable fraction.</p>
</td></tr>
<tr><td><code>AF.var</code></td>
<td>
<p>estimated variance of <code>AF.est</code>. The variance is obtained by combining the delta methods with the sandwich formula.</p>
</td></tr>
<tr><td><code>log.or</code></td>
<td>
<p>a vector of the estimated log odds ratio for every individual. <code>log.or</code> contains the estimated coefficient for the exposure variable <code>X</code> for every level of the confounder <code>Z</code> as specified by the user in the formula. If the model to be estimated is
</p>
<p style="text-align: center;"><code class="reqn">logit\{Pr(Y=1|X,Z)\} = \alpha+\beta{X}+\gamma{Z}</code>
</p>

<p>then <code>log.or</code> is the estimate of <code class="reqn">\beta</code>.
If the model to be estimated is
</p>
<p style="text-align: center;"><code class="reqn">logit\{Pr(Y=1|X,Z)\}=\alpha+\beta{X}+\gamma{Z}+\psi{XZ}</code>
</p>

<p>then <code>log.odds</code> is the estimate of
<code class="reqn">\beta + \psi{Z}</code>.</p>
</td></tr>
<tr><td><code>object</code></td>
<td>
<p>the fitted model. Fitted using logistic regression, <code><a href="stats.html#topic+glm">glm</a></code>, for non-matched case-control and conditional logistic regression, <code><a href="drgee.html#topic+gee">gee</a></code>, for matched case-control.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Elisabeth Dahlqwist, Arvid Sjölander
</p>


<h3>References</h3>

<p>Bruzzi, P., Green, S. B., Byar, D., Brinton, L. A., and Schairer, C. (1985). Estimating the population attributable risk for multiple risk factors using case-control data. <em>American Journal of Epidemiology</em> <b>122</b>, 904-914.
</p>


<h3>See Also</h3>

<p>The new and more general version of the function: <code><a href="#topic+AFglm">AFglm</a></code> for non-matched and <code><a href="#topic+AFclogit">AFclogit</a></code> for matched case-control sampling designs. <code><a href="stats.html#topic+glm">glm</a></code> and <code><a href="drgee.html#topic+gee">gee</a></code> used for fitting the logistic regression model (for non-matched case-control) and the conditional logistic regression model (for matched case-control).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>expit &lt;- function(x) 1 / (1 + exp( - x))
NN &lt;- 1000000
n &lt;- 500

# Example 1: non matched case-control
# Simulate a sample from a non matched case-control sampling design
# Make the outcome a rare event by setting the intercept to -6
intercept &lt;- -6
Z &lt;- rnorm(n = NN)
X &lt;- rbinom(n = NN, size = 1, prob = expit(Z))
Y &lt;- rbinom(n = NN, size = 1, prob = expit(intercept + X + Z))
population &lt;- data.frame(Z, X, Y)
Case &lt;- which(population$Y == 1)
Control &lt;- which(population$Y == 0)
# Sample cases and controls from the population
case &lt;- sample(Case, n)
control &lt;- sample(Control, n)
data &lt;- population[c(case, control), ]

# Estimation of the attributable fraction
AF.cc_est &lt;- AF.cc(formula = Y ~ X + Z + X * Z, data = data, exposure = "X")
summary(AF.cc_est)

# Example 2: matched case-control
# Duplicate observations in order to create a matched data sample
# Create an unobserved confounder U common for each pair of individuals
U  &lt;- rnorm(n = NN)
Z1 &lt;- rnorm(n = NN)
Z2 &lt;- rnorm(n = NN)
X1 &lt;- rbinom(n = NN, size = 1, prob = expit(U + Z1))
X2 &lt;- rbinom(n = NN, size = 1, prob = expit(U + Z2))
Y1 &lt;- rbinom(n = NN, size = 1, prob = expit(intercept + U + Z1 + X1))
Y2 &lt;- rbinom(n = NN, size = 1, prob = expit(intercept + U + Z2 + X2))
# Select discordant pairs
discordant &lt;- which(Y1!=Y2)
id &lt;- rep(1:n, 2)
# Sample from discordant pairs
incl &lt;- sample(x = discordant, size = n, replace = TRUE)
data &lt;- data.frame(id = id, Y = c(Y1[incl], Y2[incl]), X = c(X1[incl], X2[incl]),
                   Z = c(Z1[incl], Z2[incl]))

# Estimation of the attributable fraction
AF.cc_match &lt;- AF.cc(formula = Y ~ X + Z + X * Z, data = data,
                         exposure = "X", clusterid = "id", matched = TRUE)
summary(AF.cc_match)
</code></pre>

<hr>
<h2 id='AF.ch'>Attributable fraction function for cohort sampling designs with time-to-event outcomes. NOTE! Deprecated function. Use <code><a href="#topic+AFcoxph">AFcoxph</a></code>.</h2><span id='topic+AF.ch'></span>

<h3>Description</h3>

<p><code>AF.ch</code> estimates the model-based adjusted attributable fraction function for data from cohort sampling designs with time-to-event outcomes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>AF.ch(formula, data, exposure, ties = "breslow", times, clusterid)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="AF.ch_+3A_formula">formula</code></td>
<td>
<p>a formula object, with the response on the left of a ~ operator, and the terms on the right. The response must be a survival object as returned by the <code>Surv</code> function (<code><a href="survival.html#topic+Surv">Surv</a></code>). The exposure and confounders should be specified as independent (right-hand side) variables. The time-to-event outcome should be specified by the survival object. The formula is used to fit a Cox proportional hazards model.</p>
</td></tr>
<tr><td><code id="AF.ch_+3A_data">data</code></td>
<td>
<p>an optional data frame, list or environment (or object coercible by <code>as.data.frame</code> to a data frame) containing the variables in the model. If not found in data, the variables are taken from environment (<code>formula</code>), typically the environment from which the function is called.</p>
</td></tr>
<tr><td><code id="AF.ch_+3A_exposure">exposure</code></td>
<td>
<p>the name of the exposure variable as a string. The exposure must be binary (0/1) where unexposed is coded as 0.</p>
</td></tr>
<tr><td><code id="AF.ch_+3A_ties">ties</code></td>
<td>
<p>a character string specifying the method for tie handling. If there are no tied death times all the methods are equivalent. Uses the Breslow method by default.</p>
</td></tr>
<tr><td><code id="AF.ch_+3A_times">times</code></td>
<td>
<p>a scalar or vector of time points specified by the user for which the attributable fraction function is estimated. If not specified the observed death times will be used.</p>
</td></tr>
<tr><td><code id="AF.ch_+3A_clusterid">clusterid</code></td>
<td>
<p>the name of the cluster identifier variable as a string, if data are clustered.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>Af.ch</code> estimates the attributable fraction for a time-to-event outcome
under the hypothetical scenario where a binary exposure <code>X</code> is eliminated from the population. The estimate is adjusted for confounders <code>Z</code>
by the Cox proportional hazards model (<code><a href="survival.html#topic+coxph">coxph</a></code>). Let the AF function be defined as
</p>
<p style="text-align: center;"><code class="reqn">AF=1-\frac{\{1-S_0(t)\}}{\{1-S(t)\}}</code>
</p>

<p>where <code class="reqn">S_0(t)</code> denotes the counterfactual survival function for the event if
the exposure would have been eliminated from the population at baseline and <code class="reqn">S(t)</code> denotes the factual survival function.
If <code>Z</code> is sufficient for confounding control, then <code class="reqn">S_0(t)</code> can be expressed as <code class="reqn">E_Z\{S(t\mid{X=0,Z })\}</code>.
The function uses Cox proportional hazards regression to estimate <code class="reqn">S(t\mid{X=0,Z})</code>, and the marginal sample distribution of <code>Z</code>
to approximate the outer expectation (Sjölander and Vansteelandt, 2014).  If <code>clusterid</code> is supplied, then a clustered sandwich formula is used in all variance calculations.
</p>


<h3>Value</h3>

<table>
<tr><td><code>AF.est</code></td>
<td>
<p>estimated attributable fraction function for every time point specified by <code>times</code>.</p>
</td></tr>
<tr><td><code>AF.var</code></td>
<td>
<p>estimated variance of <code>AF.est</code>. The variance is obtained by combining the delta methods with the sandwich formula.</p>
</td></tr>
<tr><td><code>S.est</code></td>
<td>
<p>estimated factual survival function; <code class="reqn">S(t)</code>.</p>
</td></tr>
<tr><td><code>S.var</code></td>
<td>
<p>estimated variance of <code>S.est</code>. The variance is obtained by the sandwich formula.</p>
</td></tr>
<tr><td><code>S0.est</code></td>
<td>
<p>estimated counterfactual survival function if exposure would be eliminated; <code class="reqn">S_0(t)</code>.</p>
</td></tr>
<tr><td><code>S0.var</code></td>
<td>
<p>estimated variance of <code>S0.est</code>. The variance is obtained by the sandwich formula.</p>
</td></tr>
<tr><td><code>object</code></td>
<td>
<p>the fitted model. Fitted using Cox proportional hazard, <code><a href="survival.html#topic+coxph">coxph</a></code>.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Elisabeth Dahlqwist, Arvid Sjölander
</p>


<h3>References</h3>

<p>Chen, L., Lin, D. Y., and Zeng, D. (2010). Attributable fraction functions for censored event times. <em>Biometrika</em> <b>97</b>, 713-726.
</p>
<p>Sjölander, A. and Vansteelandt, S. (2014). Doubly robust estimation of attributable fractions in survival analysis. <em>Statistical Methods in Medical Research</em>. doi: 10.1177/0962280214564003.
</p>


<h3>See Also</h3>

<p>The new and more general version of the function: <code><a href="#topic+AFcoxph">AFcoxph</a></code>. <code><a href="survival.html#topic+coxph">coxph</a></code> and <code><a href="survival.html#topic+Surv">Surv</a></code> used for fitting the Cox proportional hazards model.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulate a sample from a cohort sampling design with time-to-event outcome
expit &lt;- function(x) 1 / (1 + exp( - x))
n &lt;- 500
time &lt;- c(seq(from = 0.2, to = 1, by = 0.2))
Z &lt;- rnorm(n = n)
X &lt;- rbinom(n = n, size = 1, prob = expit(Z))
Tim &lt;- rexp(n = n, rate = exp(X + Z))
C &lt;- rexp(n = n, rate = exp(X + Z))
Tobs &lt;- pmin(Tim, C)
D &lt;- as.numeric(Tobs &lt; C)
#Ties created by rounding
Tobs &lt;- round(Tobs, digits = 2)

# Example 1: non clustered data from a cohort sampling design with time-to-event outcomes
data &lt;- data.frame(Tobs, D, X,  Z)

# Estimation of the attributable fraction
AF.ch_est &lt;- AF.ch(formula = Surv(Tobs, D) ~ X + Z + X * Z, data = data,
                   exposure = "X", times = time)
summary(AF.ch_est)

# Example 2: clustered data from a cohort sampling design with time-to-event outcomes
# Duplicate observations in order to create clustered data
id &lt;- rep(1:n, 2)
data &lt;- data.frame(Tobs = c(Tobs, Tobs), D = c(D, D), X = c(X, X), Z = c(Z, Z), id = id)

# Estimation of the attributable fraction
AF.ch_clust &lt;- AF.ch(formula = Surv(Tobs, D) ~ X + Z + X * Z, data = data,
                         exposure = "X", times = time, clusterid = "id")
summary(AF.ch_clust)
plot(AF.ch_clust, CI = TRUE)
</code></pre>

<hr>
<h2 id='AF.cs'>Attributable fraction for cross-sectional sampling designs. NOTE! Deprecated function. Use <code><a href="#topic+AFglm">AFglm</a></code>.</h2><span id='topic+AF.cs'></span>

<h3>Description</h3>

<p><code>AF.cs</code> estimates the model-based adjusted attributable fraction for data from cross-sectional sampling designs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>AF.cs(formula, data, exposure, clusterid)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="AF.cs_+3A_formula">formula</code></td>
<td>
<p>an object of class &quot;<code><a href="stats.html#topic+formula">formula</a></code>&quot; (or one that can be coerced to that class): a symbolic description of the model used for adjusting for confounders. The exposure and confounders should be specified as independent (right-hand side) variables. The outcome should be specified as dependent (left-hand side) variable. The formula is used to object a logistic regression by <code><a href="stats.html#topic+glm">glm</a></code>.</p>
</td></tr>
<tr><td><code id="AF.cs_+3A_data">data</code></td>
<td>
<p>an optional data frame, list or environment (or object coercible by <code>as.data.frame</code> to a data frame) containing the variables in the model. If not found in data, the variables are taken from environment (<code>formula</code>), typically the environment from which the function is called.</p>
</td></tr>
<tr><td><code id="AF.cs_+3A_exposure">exposure</code></td>
<td>
<p>the name of the exposure variable as a string. The exposure must be binary (0/1) where unexposed is coded as 0.</p>
</td></tr>
<tr><td><code id="AF.cs_+3A_clusterid">clusterid</code></td>
<td>
<p>the name of the cluster identifier variable as a string, if data are clustered.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>Af.cs</code> estimates the attributable fraction for a binary outcome <code>Y</code>
under the hypothetical scenario where a binary exposure <code>X</code> is eliminated from the population.
The estimate is adjusted for confounders <code>Z</code> by logistic regression (<code><a href="stats.html#topic+glm">glm</a></code>).
Let the AF be defined as
</p>
<p style="text-align: center;"><code class="reqn">AF=1-\frac{Pr(Y_0=1)}{Pr(Y=1)}</code>
</p>

<p>where <code class="reqn">Pr(Y_0=1)</code> denotes the counterfactual probability of the outcome if
the exposure would have been eliminated from the population and <code class="reqn">Pr(Y = 1)</code> denotes the factual probability of the outcome.
If <code>Z</code> is sufficient for confounding control, then <code class="reqn">Pr(Y_0=1)</code> can be expressed as
<code class="reqn">E_Z\{Pr(Y=1\mid{X=0,Z})\}.</code>
The function uses logistic regression to estimate <code class="reqn">Pr(Y=1\mid{X=0,Z})</code>, and the marginal sample distribution of <code>Z</code>
to approximate the outer expectation (Sjölander and Vansteelandt, 2012).
If <code>clusterid</code> is supplied, then a clustered sandwich formula is used in all variance calculations.
</p>


<h3>Value</h3>

<table>
<tr><td><code>AF.est</code></td>
<td>
<p>estimated attributable fraction.</p>
</td></tr>
<tr><td><code>AF.var</code></td>
<td>
<p>estimated variance of <code>AF.est</code>. The variance is obtained by combining the delta method with the sandwich formula.</p>
</td></tr>
<tr><td><code>P.est</code></td>
<td>
<p>estimated factual proportion of cases; <code class="reqn">Pr(Y=1)</code>.</p>
</td></tr>
<tr><td><code>P.var</code></td>
<td>
<p>estimated variance of <code>P.est</code>. The variance is obtained by the sandwich formula.</p>
</td></tr>
<tr><td><code>P0.est</code></td>
<td>
<p>estimated counterfactual proportion of cases if exposure would be eliminated; <code class="reqn">Pr(Y_0=1)</code>.</p>
</td></tr>
<tr><td><code>P0.var</code></td>
<td>
<p>estimated variance of <code>P0.est</code>. The variance is obtained by the sandwich formula.</p>
</td></tr>
<tr><td><code>object</code></td>
<td>
<p>the fitted model. Fitted using logistic regression, <code><a href="stats.html#topic+glm">glm</a></code>.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Elisabeth Dahlqwist, Arvid Sjölander
</p>


<h3>References</h3>

<p>Greenland, S. and Drescher, K. (1993). Maximum Likelihood Estimation of the Attributable Fraction from logistic Models. <em>Biometrics</em> <b>49</b>, 865-872.
</p>
<p>Sjölander, A. and Vansteelandt, S. (2011). Doubly robust estimation of attributable fractions. <em>Biostatistics</em> <b>12</b>, 112-121.
</p>


<h3>See Also</h3>

<p>The new and more general version of the function: <code><a href="#topic+AFglm">AFglm</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulate a cross-sectional sample
expit &lt;- function(x) 1 / (1 + exp( - x))
n &lt;- 1000
Z &lt;- rnorm(n = n)
X &lt;- rbinom(n = n, size = 1, prob = expit(Z))
Y &lt;- rbinom(n = n, size = 1, prob = expit(Z + X))

# Example 1: non clustered data from a cross-sectional sampling design
data &lt;- data.frame(Y, X, Z)

# Estimation of the attributable fraction
AF.cs_est &lt;- AF.cs(formula = Y ~ X + Z + X * Z, data = data, exposure = "X")
summary(AF.cs_est)

# Example 2: clustered data from a cross-sectional sampling design
# Duplicate observations in order to create clustered data
id &lt;- rep(1:n, 2)
data &lt;- data.frame(id = id, Y = c(Y, Y), X = c(X, X), Z = c(Z, Z))

# Estimation of the attributable fraction
AF.cs_clust &lt;- AF.cs(formula = Y ~ X + Z + X * Z, data = data,
                         exposure = "X", clusterid = "id")
summary(AF.cs_clust)
</code></pre>

<hr>
<h2 id='AFclogit'>Attributable fraction estimation based on a conditional logistic regression model as a <code>clogit</code> object (commonly used for matched case-control sampling designs).</h2><span id='topic+AFclogit'></span>

<h3>Description</h3>

<p><code>AFclogit</code> estimates the model-based adjusted attributable fraction from a conditional logistic regression model in form of a <code><a href="survival.html#topic+clogit">clogit</a></code> object. This model is model is commonly used for data from matched case-control sampling designs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>AFclogit(object, data, exposure, clusterid)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="AFclogit_+3A_object">object</code></td>
<td>
<p>a fitted conditional logistic regression model object of class &quot;<code><a href="survival.html#topic+clogit">clogit</a></code>&quot;.</p>
</td></tr>
<tr><td><code id="AFclogit_+3A_data">data</code></td>
<td>
<p>an optional data frame, list or environment (or object coercible by <code>as.data.frame</code> to a data frame) containing the variables in the model. If not found in <code>data</code>, the variables are taken from environment (<code>formula</code>), typically the environment from which the function is called.</p>
</td></tr>
<tr><td><code id="AFclogit_+3A_exposure">exposure</code></td>
<td>
<p>the name of the exposure variable as a string. The exposure must be binary (0/1) where unexposed is coded as 0.</p>
</td></tr>
<tr><td><code id="AFclogit_+3A_clusterid">clusterid</code></td>
<td>
<p>the name of the cluster identifier variable as a string. Because conditional logistic regression is only used for clustered data, this argument must be supplied.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>AFclogit</code> estimates the attributable fraction for a binary outcome <code>Y</code>
under the hypothetical scenario where a binary exposure <code>X</code> is eliminated from the population.
The estimate is adjusted for confounders <code>Z</code> by conditional logistic regression.
The estimation assumes that the outcome is rare so that the risk ratio can be approximated by the odds ratio, for details see Bruzzi et. al.
Let the AF be defined as
</p>
<p style="text-align: center;"><code class="reqn">AF = 1 - \frac{Pr(Y_0=1)}{Pr(Y = 1)}</code>
</p>

<p>where <code class="reqn">Pr(Y_0=1)</code> denotes the counterfactual probability of the outcome if
the exposure would have been eliminated from the population. If <code>Z</code> is sufficient for confounding control then the probability <code class="reqn">Pr(Y_0=1)</code> can be expressed as
</p>
<p style="text-align: center;"><code class="reqn">Pr(Y_0=1)=E_Z\{Pr(Y=1\mid{X}=0,Z)\}.</code>
</p>

<p>Using Bayes' theorem this implies that the AF can be expressed as
</p>
<p style="text-align: center;"><code class="reqn">AF = 1-\frac{E_Z\{Pr(Y=1\mid X=0,Z)\}}{Pr(Y=1)}=1-E_Z\{RR^{-X}(Z)\mid{Y = 1}\}</code>
</p>

<p>where <code class="reqn">RR(Z)</code> is the risk ratio </p>
<p style="text-align: center;"><code class="reqn">\frac{Pr(Y=1\mid{X=1,Z})}{Pr(Y=1\mid{X=0,Z})}.</code>
</p>

<p>Moreover, the risk ratio can be approximated by the odds ratio if the outcome is rare. Thus,
</p>
<p style="text-align: center;"><code class="reqn"> AF \approx 1 - E_Z\{OR^{-X}(Z)\mid{Y = 1}\}.</code>
</p>

<p>The odds ratio is estimated by conditional logistic regression.
The function <code><a href="drgee.html#topic+gee">gee</a></code> in the <code>drgee</code> package is used to get the score contributions for each cluster and the hessian.
A clustered sandwich formula is used in the variance calculation.
</p>


<h3>Value</h3>

<table>
<tr><td><code>AF.est</code></td>
<td>
<p>estimated attributable fraction.</p>
</td></tr>
<tr><td><code>AF.var</code></td>
<td>
<p>estimated variance of <code>AF.est</code>. The variance is obtained by combining the delta methods with the sandwich formula.</p>
</td></tr>
<tr><td><code>log.or</code></td>
<td>
<p>a vector of the estimated log odds ratio for every individual. <code>log.or</code> contains the estimated coefficient for the exposure variable <code>X</code> for every level of the confounder <code>Z</code> as specified by the user in the formula. If the model to be estimated is
</p>
<p style="text-align: center;"><code class="reqn">logit\{Pr(Y=1|X,Z)\} = \alpha+\beta{X}+\gamma{Z}</code>
</p>

<p>then <code>log.or</code> is the estimate of <code class="reqn">\beta</code>.
If the model to be estimated is
</p>
<p style="text-align: center;"><code class="reqn">logit\{Pr(Y=1|X,Z)\}=\alpha+\beta{X}+\gamma{Z}+\psi{XZ}</code>
</p>

<p>then <code>log.odds</code> is the estimate of
<code class="reqn">\beta + \psi{Z}</code>.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Elisabeth Dahlqwist, Arvid Sjölander
</p>


<h3>References</h3>

<p>Bruzzi, P., Green, S. B., Byar, D., Brinton, L. A., and Schairer, C. (1985). Estimating the population attributable risk for multiple risk factors using case-control data. <em>American Journal of Epidemiology</em> <b>122</b>, 904-914.
</p>


<h3>See Also</h3>

<p><code><a href="survival.html#topic+clogit">clogit</a></code> used for fitting the conditional logistic regression model for matched case-control designs. For non-matched case-control designs see <code><a href="#topic+AFglm">AFglm</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>expit &lt;- function(x) 1 / (1 + exp( - x))
NN &lt;- 1000000
n &lt;- 500

# Example 1: matched case-control
# Duplicate observations in order to create a matched data sample
# Create an unobserved confounder U common for each pair of individuals
intercept &lt;- -6
U  &lt;- rnorm(n = NN)
Z1 &lt;- rnorm(n = NN)
Z2 &lt;- rnorm(n = NN)
X1 &lt;- rbinom(n = NN, size = 1, prob = expit(U + Z1))
X2 &lt;- rbinom(n = NN, size = 1, prob = expit(U + Z2))
Y1 &lt;- rbinom(n = NN, size = 1, prob = expit(intercept + U + Z1 + X1))
Y2 &lt;- rbinom(n = NN, size = 1, prob = expit(intercept + U + Z2 + X2))
# Select discordant pairs
discordant &lt;- which(Y1!=Y2)
id &lt;- rep(1:n, 2)
# Sample from discordant pairs
incl &lt;- sample(x = discordant, size = n, replace = TRUE)
data &lt;- data.frame(id = id, Y = c(Y1[incl], Y2[incl]), X = c(X1[incl], X2[incl]),
                   Z = c(Z1[incl], Z2[incl]))

# Fit a clogit object
fit &lt;- clogit(formula = Y ~ X + Z + X * Z + strata(id), data = data)

# Estimate the attributable fraction from the fitted conditional logistic regression
AFclogit_est &lt;- AFclogit(fit, data, exposure = "X", clusterid="id")
summary(AFclogit_est)
</code></pre>

<hr>
<h2 id='AFcoxph'>Attributable fraction function based on a Cox Proportional Hazard regression model as a <code>coxph</code> object (commonly used for cohort sampling designs with time-to-event outcomes).</h2><span id='topic+AFcoxph'></span>

<h3>Description</h3>

<p><code>AFcoxph</code> estimates the model-based adjusted attributable fraction function from a Cox Proportional Hazard regression model in form of a  <code><a href="survival.html#topic+coxph">coxph</a></code> object. This model is commonly used for data from cohort sampling designs with time-to-event outcomes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>AFcoxph(object, data, exposure, times, clusterid)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="AFcoxph_+3A_object">object</code></td>
<td>
<p>a fitted Cox Proportional Hazard regression model object of class &quot;<code><a href="survival.html#topic+coxph">coxph</a></code>&quot;. Method for handling ties must be breslow since this is assumed in the calculation of the standard errors. No special terms such as <code>cluster</code>, <code>strata</code> and <code>tt</code> is allowed in the formula for the fitted object.</p>
</td></tr>
<tr><td><code id="AFcoxph_+3A_data">data</code></td>
<td>
<p>an optional data frame, list or environment (or object coercible by <code>as.data.frame</code> to a data frame) containing the variables in the model. If not found in data, the variables are taken from environment (<code>formula</code>), typically the environment from which the function is called.</p>
</td></tr>
<tr><td><code id="AFcoxph_+3A_exposure">exposure</code></td>
<td>
<p>the name of the exposure variable as a string. The exposure must be binary (0/1) where unexposed is coded as 0.</p>
</td></tr>
<tr><td><code id="AFcoxph_+3A_times">times</code></td>
<td>
<p>a scalar or vector of time points specified by the user for which the attributable fraction function is estimated. If not specified the observed event times will be used.</p>
</td></tr>
<tr><td><code id="AFcoxph_+3A_clusterid">clusterid</code></td>
<td>
<p>the name of the cluster identifier variable as a string, if data are clustered. Cluster robust standard errors will be calculated.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>AFcoxph</code> estimates the attributable fraction for a time-to-event outcome
under the hypothetical scenario where a binary exposure <code>X</code> is eliminated from the population. The estimate is adjusted for confounders <code>Z</code>
by the Cox proportional hazards model (<code><a href="survival.html#topic+coxph">coxph</a></code>). Let the AF function be defined as
</p>
<p style="text-align: center;"><code class="reqn">AF=1-\frac{\{1-S_0(t)\}}{\{1-S(t)\}}</code>
</p>

<p>where <code class="reqn">S_0(t)</code> denotes the counterfactual survival function for the event if
the exposure would have been eliminated from the population at baseline and <code class="reqn">S(t)</code> denotes the factual survival function.
If <code>Z</code> is sufficient for confounding control, then <code class="reqn">S_0(t)</code> can be expressed as <code class="reqn">E_Z\{S(t\mid{X=0,Z })\}</code>.
The function uses a fitted Cox proportional hazards regression to estimate <code class="reqn">S(t\mid{X=0,Z})</code>, and the marginal sample distribution of <code>Z</code>
to approximate the outer expectation (Sjölander and Vansteelandt, 2014).  If <code>clusterid</code> is supplied, then a clustered sandwich formula is used in all variance calculations.
</p>


<h3>Value</h3>

<table>
<tr><td><code>AF.est</code></td>
<td>
<p>estimated attributable fraction function for every time point specified by <code>times</code>.</p>
</td></tr>
<tr><td><code>AF.var</code></td>
<td>
<p>estimated variance of <code>AF.est</code>. The variance is obtained by combining the delta methods with the sandwich formula.</p>
</td></tr>
<tr><td><code>S.est</code></td>
<td>
<p>estimated factual survival function; <code class="reqn">S(t)</code>.</p>
</td></tr>
<tr><td><code>S.var</code></td>
<td>
<p>estimated variance of <code>S.est</code>. The variance is obtained by the sandwich formula.</p>
</td></tr>
<tr><td><code>S0.est</code></td>
<td>
<p>estimated counterfactual survival function if exposure would be eliminated; <code class="reqn">S_0(t)</code>.</p>
</td></tr>
<tr><td><code>S0.var</code></td>
<td>
<p>estimated variance of <code>S0.est</code>. The variance is obtained by the sandwich formula.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Elisabeth Dahlqwist, Arvid Sjölander
</p>


<h3>References</h3>

<p>Chen, L., Lin, D. Y., and Zeng, D. (2010). Attributable fraction functions for censored event times. <em>Biometrika</em> <b>97</b>, 713-726.
</p>
<p>Sjölander, A. and Vansteelandt, S. (2014). Doubly robust estimation of attributable fractions in survival analysis. <em>Statistical Methods in Medical Research</em>. doi: 10.1177/0962280214564003.
</p>


<h3>See Also</h3>

<p><code><a href="survival.html#topic+coxph">coxph</a></code> and <code><a href="survival.html#topic+Surv">Surv</a></code> used for fitting the Cox proportional hazards model.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulate a sample from a cohort sampling design with time-to-event outcome
expit &lt;- function(x) 1 / (1 + exp( - x))
n &lt;- 500
time &lt;- c(seq(from = 0.2, to = 1, by = 0.2))
Z &lt;- rnorm(n = n)
X &lt;- rbinom(n = n, size = 1, prob = expit(Z))
Tim &lt;- rexp(n = n, rate = exp(X + Z))
C &lt;- rexp(n = n, rate = exp(X + Z))
Tobs &lt;- pmin(Tim, C)
D &lt;- as.numeric(Tobs &lt; C)
#Ties created by rounding
Tobs &lt;- round(Tobs, digits = 2)

# Example 1: non clustered data from a cohort sampling design with time-to-event outcomes
data &lt;- data.frame(Tobs, D, X,  Z)

# Fit a Cox PH regression model
fit &lt;- coxph(formula = Surv(Tobs, D) ~ X + Z + X * Z, data = data, ties="breslow")

# Estimate the attributable fraction from the fitted Cox PH regression model
AFcoxph_est &lt;- AFcoxph(fit, data=data, exposure ="X", times = time)
summary(AFcoxph_est)

# Example 2: clustered data from a cohort sampling design with time-to-event outcomes
# Duplicate observations in order to create clustered data
id &lt;- rep(1:n, 2)
data &lt;- data.frame(Tobs = c(Tobs, Tobs), D = c(D, D), X = c(X, X), Z = c(Z, Z), id = id)

# Fit a Cox PH regression model
fit &lt;- coxph(formula = Surv(Tobs, D) ~ X + Z + X * Z, data = data, ties="breslow")

# Estimate the attributable fraction from the fitted Cox PH regression model
AFcoxph_clust &lt;- AFcoxph(object = fit, data = data,
                         exposure = "X", times = time, clusterid = "id")
summary(AFcoxph_clust)
plot(AFcoxph_clust, CI = TRUE)

# Estimate the attributable fraction from the fitted Cox PH regression model, time unspecified
AFcoxph_clust_no_time &lt;- AFcoxph(object = fit, data = data,
                         exposure = "X", clusterid = "id")
summary(AFcoxph_clust_no_time)
plot(AFcoxph_clust, CI = TRUE)
</code></pre>

<hr>
<h2 id='AFglm'>Attributable fraction estimation based on a logistic regression model from a <code>glm</code> object (commonly used for cross-sectional or case-control sampling designs).</h2><span id='topic+AFglm'></span>

<h3>Description</h3>

<p><code>AFglm</code> estimates the model-based adjusted attributable fraction for data from a logistic regression model in the form of a <code><a href="stats.html#topic+glm">glm</a></code> object. This model is commonly used for data from a cross-sectional or non-matched case-control sampling design.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>AFglm(object, data, exposure, clusterid, case.control = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="AFglm_+3A_object">object</code></td>
<td>
<p>a fitted logistic regression model object of class &quot;<code><a href="stats.html#topic+glm">glm</a></code>&quot;.</p>
</td></tr>
<tr><td><code id="AFglm_+3A_data">data</code></td>
<td>
<p>an optional data frame, list or environment (or object coercible by <code>as.data.frame</code> to a data frame) containing the variables in the model. If not found in data, the variables are taken from environment (<code>formula</code>), typically the environment from which the function is called.</p>
</td></tr>
<tr><td><code id="AFglm_+3A_exposure">exposure</code></td>
<td>
<p>the name of the exposure variable as a string. The exposure must be binary (0/1) where unexposed is coded as 0.</p>
</td></tr>
<tr><td><code id="AFglm_+3A_clusterid">clusterid</code></td>
<td>
<p>the name of the cluster identifier variable as a string, if data are clustered. Cluster robust standard errors will be calculated.</p>
</td></tr>
<tr><td><code id="AFglm_+3A_case.control">case.control</code></td>
<td>
<p>can be set to <code>TRUE</code> if the data is from a non-matched case control study. By default <code>case.control</code> is set to <code>FALSE</code> which is used for cross-sectional sampling designs.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>AFglm</code> estimates the attributable fraction for a binary outcome <code>Y</code>
under the hypothetical scenario where a binary exposure <code>X</code> is eliminated from the population.
The estimate is adjusted for confounders <code>Z</code> by logistic regression using the (<code><a href="stats.html#topic+glm">glm</a></code>) function.
The estimation strategy is different for cross-sectional and case-control sampling designs even if the underlying logististic regression model is the same.
For cross-sectional sampling designs the AF can be defined as
</p>
<p style="text-align: center;"><code class="reqn">AF=1-\frac{Pr(Y_0=1)}{Pr(Y=1)}</code>
</p>

<p>where <code class="reqn">Pr(Y_0=1)</code> denotes the counterfactual probability of the outcome if
the exposure would have been eliminated from the population and <code class="reqn">Pr(Y = 1)</code> denotes the factual probability of the outcome.
If <code>Z</code> is sufficient for confounding control, then <code class="reqn">Pr(Y_0=1)</code> can be expressed as
<code class="reqn">E_Z\{Pr(Y=1\mid{X=0,Z})\}.</code>
The function uses logistic regression to estimate <code class="reqn">Pr(Y=1\mid{X=0,Z})</code>, and the marginal sample distribution of <code>Z</code>
to approximate the outer expectation (Sjölander and Vansteelandt, 2012).
For case-control sampling designs the outcome prevalence is fixed by sampling design and absolute probabilities (<code>P.est</code> and <code>P0.est</code>) can not be estimated.
Instead adjusted log odds ratios (<code>log.or</code>) are estimated for each individual.
This is done by setting <code>case.control</code> to <code>TRUE</code>. It is then assumed that the outcome is rare so that the risk ratio can be approximated by the odds ratio.
For case-control sampling designs the AF be defined as (Bruzzi et. al)
</p>
<p style="text-align: center;"><code class="reqn">AF = 1 - \frac{Pr(Y_0=1)}{Pr(Y = 1)}</code>
</p>

<p>where <code class="reqn">Pr(Y_0=1)</code> denotes the counterfactual probability of the outcome if
the exposure would have been eliminated from the population. If <code>Z</code> is sufficient for confounding control then the probability <code class="reqn">Pr(Y_0=1)</code> can be expressed as
</p>
<p style="text-align: center;"><code class="reqn">Pr(Y_0=1)=E_Z\{Pr(Y=1\mid{X}=0,Z)\}.</code>
</p>

<p>Using Bayes' theorem this implies that the AF can be expressed as
</p>
<p style="text-align: center;"><code class="reqn">AF = 1-\frac{E_Z\{Pr(Y=1\mid X=0,Z)\}}{Pr(Y=1)}=1-E_Z\{RR^{-X}(Z)\mid{Y = 1}\}</code>
</p>

<p>where <code class="reqn">RR(Z)</code> is the risk ratio </p>
<p style="text-align: center;"><code class="reqn">\frac{Pr(Y=1\mid{X=1,Z})}{Pr(Y=1\mid{X=0,Z})}.</code>
</p>

<p>Moreover, the risk ratio can be approximated by the odds ratio if the outcome is rare. Thus,
</p>
<p style="text-align: center;"><code class="reqn"> AF \approx 1 - E_Z\{OR^{-X}(Z)\mid{Y = 1}\}.</code>
</p>

<p>If <code>clusterid</code> is supplied, then a clustered sandwich formula is used in all variance calculations.
</p>


<h3>Value</h3>

<table>
<tr><td><code>AF.est</code></td>
<td>
<p>estimated attributable fraction.</p>
</td></tr>
<tr><td><code>AF.var</code></td>
<td>
<p>estimated variance of <code>AF.est</code>. The variance is obtained by combining the delta method with the sandwich formula.</p>
</td></tr>
<tr><td><code>P.est</code></td>
<td>
<p>estimated factual proportion of cases; <code class="reqn">Pr(Y=1)</code>. Returned by default when <code>case.control = FALSE</code>.</p>
</td></tr>
<tr><td><code>P.var</code></td>
<td>
<p>estimated variance of <code>P.est</code>. The variance is obtained by the sandwich formula. Returned by default when <code>case.control = FALSE</code>.</p>
</td></tr>
<tr><td><code>P0.est</code></td>
<td>
<p>estimated counterfactual proportion of cases if exposure would be eliminated; <code class="reqn">Pr(Y_0=1)</code>. Returned by default when <code>case.control = FALSE</code>.</p>
</td></tr>
<tr><td><code>P0.var</code></td>
<td>
<p>estimated variance of <code>P0.est</code>. The variance is obtained by the sandwich formula. Returned by default when <code>case.control = FALSE</code>.</p>
</td></tr>
<tr><td><code>log.or</code></td>
<td>
<p>a vector of the estimated log odds ratio for every individual. <code>log.or</code> contains the estimated coefficient for the exposure variable <code>X</code> for every level of the confounder <code>Z</code> as specified by the user in the formula. If the model to be estimated is
</p>
<p style="text-align: center;"><code class="reqn">logit\{Pr(Y=1|X,Z)\} = \alpha+\beta{X}+\gamma{Z}</code>
</p>

<p>then <code>log.or</code> is the estimate of <code class="reqn">\beta</code>.
If the model to be estimated is
</p>
<p style="text-align: center;"><code class="reqn">logit\{Pr(Y=1|X,Z)\}=\alpha+\beta{X}+\gamma{Z}+\psi{XZ}</code>
</p>

<p>then <code>log.odds</code> is the estimate of
<code class="reqn">\beta + \psi{Z}</code>. Only returned if argument <code>case.control</code> is set to <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Elisabeth Dahlqwist, Arvid Sjölander
</p>


<h3>References</h3>

<p>Bruzzi, P., Green, S. B., Byar, D., Brinton, L. A., and Schairer, C. (1985). Estimating the population attributable risk for multiple risk factors using case-control data. <em>American Journal of Epidemiology</em> <b>122</b>, 904-914.
</p>
<p>Greenland, S. and Drescher, K. (1993). Maximum Likelihood Estimation of the Attributable Fraction from logistic Models. <em>Biometrics</em> <b>49</b>, 865-872.
</p>
<p>Sjölander, A. and Vansteelandt, S. (2011). Doubly robust estimation of attributable fractions. <em>Biostatistics</em> <b>12</b>, 112-121.
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+glm">glm</a></code> used for fitting the logistic regression model. For conditional logistic regression (commonly for data from a matched case-control sampling design) see <code><a href="#topic+AFclogit">AFclogit</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulate a cross-sectional sample

expit &lt;- function(x) 1 / (1 + exp( - x))
n &lt;- 1000
Z &lt;- rnorm(n = n)
X &lt;- rbinom(n = n, size = 1, prob = expit(Z))
Y &lt;- rbinom(n = n, size = 1, prob = expit(Z + X))

# Example 1: non clustered data from a cross-sectional sampling design
data &lt;- data.frame(Y, X, Z)

# Fit a glm object
fit &lt;- glm(formula = Y ~ X + Z + X * Z, family = binomial, data = data)

# Estimate the attributable fraction from the fitted logistic regression
AFglm_est &lt;- AFglm(object = fit, data = data, exposure = "X")
summary(AFglm_est)

# Example 2: clustered data from a cross-sectional sampling design
# Duplicate observations in order to create clustered data
id &lt;- rep(1:n, 2)
data &lt;- data.frame(id = id, Y = c(Y, Y), X = c(X, X), Z = c(Z, Z))

# Fit a glm object
fit &lt;- glm(formula = Y ~ X + Z + X * Z, family = binomial, data = data)

# Estimate the attributable fraction from the fitted logistic regression
AFglm_clust &lt;- AFglm(object = fit, data = data,
                         exposure = "X", clusterid = "id")
summary(AFglm_clust)


# Example 3: non matched case-control
# Simulate a sample from a non matched case-control sampling design
# Make the outcome a rare event by setting the intercept to -6

expit &lt;- function(x) 1 / (1 + exp( - x))
NN &lt;- 1000000
n &lt;- 500
intercept &lt;- -6
Z &lt;- rnorm(n = NN)
X &lt;- rbinom(n = NN, size = 1, prob = expit(Z))
Y &lt;- rbinom(n = NN, size = 1, prob = expit(intercept + X + Z))
population &lt;- data.frame(Z, X, Y)
Case &lt;- which(population$Y == 1)
Control &lt;- which(population$Y == 0)
# Sample cases and controls from the population
case &lt;- sample(Case, n)
control &lt;- sample(Control, n)
data &lt;- population[c(case, control), ]

# Fit a glm object
fit &lt;- glm(formula = Y ~ X + Z + X * Z, family = binomial, data = data)

# Estimate the attributable fraction from the fitted logistic regression
AFglm_est_cc &lt;- AFglm(object = fit, data = data, exposure = "X", case.control = TRUE)
summary(AFglm_est_cc)
</code></pre>

<hr>
<h2 id='AFivglm'>Attributable fraction function based on Instrumental Variables (IV) regression as an <code><a href="ivtools.html#topic+ivglm">ivglm</a></code> object in the <code>ivtools</code> package.</h2><span id='topic+AFivglm'></span>

<h3>Description</h3>

<p><code>AFivglm</code> estimates the model-based adjusted attributable fraction from a Instrumental Variable regression from a <code><a href="ivtools.html#topic+ivglm">ivglm</a></code> object. The IV regression can be estimated by either G-estimation or Two Stage estimation for a binary exposure and outcome.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>AFivglm(object, data)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="AFivglm_+3A_object">object</code></td>
<td>
<p>a fitted Instrumental Variable regression of class &quot;<code><a href="ivtools.html#topic+ivglm">ivglm</a></code>&quot;.</p>
</td></tr>
<tr><td><code id="AFivglm_+3A_data">data</code></td>
<td>
<p>an optional data frame, list or environment (or object coercible by <code>as.data.frame</code> to a data frame) containing the variables in the model. If not found in data, the variables are taken from environment (<code>formula</code>), typically the environment from which the function is called.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>AFivglm</code> estimates the attributable fraction for an IV regression
under the hypothetical scenario where a binary exposure <code>X</code> is eliminated from the population.
The estimate can be adjusted for IV-outcome confounders <code>L</code> in the <code><a href="ivtools.html#topic+ivglm">ivglm</a></code> function. 
Let the AF function be defined as
</p>
<p style="text-align: center;"><code class="reqn">AF=1-\frac{Pr(Y_0=1)}{Pr(Y=1)}</code>
</p>

<p>where <code class="reqn">Pr(Y_0=1)</code> denotes the counterfactual outcome prevalence had everyone been unexposed and <code class="reqn">Pr(Y=1)</code> denotes the factual outcome prevalence.
If the instrument <code>Z</code> is valid, conditional on covariates <code>L</code>, i.e. fulfills the IV assumptions 1) the IV should have a (preferably strong) association with
the exposure, 2) the effect of the IV on the outcome should only go through the exposure and 3) the IV-outcome association should be unconfounded
(Imbens and Angrist, 1994) then <code class="reqn">Pr(Y_0=1)</code> can be estimated.
</p>


<h3>Value</h3>

<table>
<tr><td><code>AF.est</code></td>
<td>
<p>estimated attributable fraction.</p>
</td></tr>
<tr><td><code>AF.var</code></td>
<td>
<p>estimated variance of <code>AF.est</code>. The variance is obtained by combining the delta methods with the sandwich formula.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Elisabeth Dahlqwist, Arvid Sjölander
</p>


<h3>References</h3>

<p>Dahlqwist E., Kutalik Z., Sjölander, A. (2019). Using Instrumental Variables to estimate the attributable fraction. <em>Manuscript</em>.
</p>


<h3>See Also</h3>

<p><code><a href="ivtools.html#topic+ivglm">ivglm</a></code> used for fitting the causal risk ratio or odds ratio using the G-estimator or Two stage estimator.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Example 1
set.seed(2)
n &lt;- 5000
## parameter a0 determines the outcome prevalence
a0 &lt;- -4
psi.true &lt;- 1
l &lt;- rbinom(n, 1, 0.5)
u &lt;- rbinom(n, 1, 0.5)
z &lt;- rbinom(n, 1, plogis(a0))
x &lt;- rbinom(n, 1, plogis(a0+3*z+ u))
y &lt;- rbinom(n, 1, exp(a0+psi.true*x+u))
d &lt;- data.frame(z,u,x,y,l)
## Outcome prevalence 
mean(d$y)

####### G-estimation
## log CRR
fitz.l &lt;- glm(z~1, family=binomial, data=d)
gest_log &lt;- ivglm(estmethod="g", X="x", Y="y",
                  fitZ.L=fitz.l, data=d, link="log")
AFgestlog &lt;- AFivglm(gest_log, data=d)
summary(AFgestlog)

## log COR
## Associational model, saturated
fit_y &lt;- glm(y~x+z+x*z, family="binomial", data=d)
## Estimations of COR and AF
gest_logit &lt;- ivglm(estmethod="g", X="x", Y="y",
                    fitZ.L=fitz.l, fitY.LZX=fit_y,
                    data=d, link="logit")
AFgestlogit &lt;- AFivglm(gest_logit, data = d)
summary(AFgestlogit)

####### TS estimation
## log CRR
# First stage
fitx &lt;- glm(x ~ z, family=binomial, data=d)
# Second stage
fity &lt;- glm(y ~ x, family=poisson, data=d)
## Estimations of CRR and AF
TSlog &lt;- ivglm(estmethod="ts", X="x", Y="y",
               fitY.LX=fity, fitX.LZ=fitx, data=d, link="log")
AFtslog &lt;- AFivglm(TSlog, data=d)
summary(AFtslog)

## log COR
# First stage
fitx_logit &lt;- glm(x ~ z, family=binomial, data=d)
# Second stage
fity_logit &lt;- glm(y ~ x, family=binomial, data=d)
## Estimations of COR and AF
TSlogit &lt;- ivglm(estmethod="ts", X="x", Y="y",
                 fitY.LX=fity_logit, fitX.LZ=fitx_logit,
                  data=d, link="logit")
AFtslogit &lt;- AFivglm(TSlogit, data=d)
summary(AFtslogit)

## Example 2: IV-outcome confounding by L
####### G-estimation
## log CRR
fitz.l &lt;- glm(z~l, family=binomial, data=d)
gest_log &lt;- ivglm(estmethod="g", X="x", Y="y",
                  fitZ.L=fitz.l, data=d, link="log")
AFgestlog &lt;- AFivglm(gest_log, data=d)
summary(AFgestlog)

## log COR
## Associational model
fit_y &lt;- glm(y~x+z+l+x*z+x*l+z*l, family="binomial", data=d)
## Estimations of COR and AF
gest_logit &lt;- ivglm(estmethod="g", X="x", Y="y",
                    fitZ.L=fitz.l, fitY.LZX=fit_y,
                    data=d, link="logit")
AFgestlogit &lt;- AFivglm(gest_logit, data = d)
summary(AFgestlogit)

####### TS estimation
## log CRR
# First stage
fitx &lt;- glm(x ~ z+l, family=binomial, data=d)
# Second stage
fity &lt;- glm(y ~ x+l, family=poisson, data=d)
## Estimations of CRR and AF
TSlog &lt;- ivglm(estmethod="ts", X="x", Y="y",
               fitY.LX=fity, fitX.LZ=fitx, data=d,
               link="log")
AFtslog &lt;- AFivglm(TSlog, data=d)
summary(AFtslog)

## log COR
# First stage
fitx_logit &lt;- glm(x ~ z+l, family=binomial, data=d)
# Second stage
fity_logit &lt;- glm(y ~ x+l, family=binomial, data=d)
## Estimations of COR and AF
TSlogit &lt;- ivglm(estmethod="ts", X="x", Y="y",
                 fitY.LX=fity_logit, fitX.LZ=fitx_logit,
                 data=d, link="logit")
AFtslogit &lt;- AFivglm(TSlogit, data=d)
summary(AFtslogit)
</code></pre>

<hr>
<h2 id='AFparfrailty'>Attributable fraction function based on a Weibull gamma-frailty model as a <code><a href="stdReg.html#topic+parfrailty">parfrailty</a></code> object (commonly used for cohort sampling family designs with time-to-event outcomes).</h2><span id='topic+AFparfrailty'></span>

<h3>Description</h3>

<p><code>AFparfrailty</code> estimates the model-based adjusted attributable fraction function from a shared Weibull gamma-frailty model in form of a  <code><a href="stdReg.html#topic+parfrailty">parfrailty</a></code> object. This model is commonly used for data from cohort sampling familty designs with time-to-event outcomes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>AFparfrailty(object, data, exposure, times, clusterid)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="AFparfrailty_+3A_object">object</code></td>
<td>
<p>a fitted Weibull gamma-parfrailty object of class &quot;<code><a href="stdReg.html#topic+parfrailty">parfrailty</a></code>&quot;.</p>
</td></tr>
<tr><td><code id="AFparfrailty_+3A_data">data</code></td>
<td>
<p>an optional data frame, list or environment (or object coercible by <code>as.data.frame</code> to a data frame) containing the variables in the model. If not found in data, the variables are taken from environment (<code>formula</code>), typically the environment from which the function is called.</p>
</td></tr>
<tr><td><code id="AFparfrailty_+3A_exposure">exposure</code></td>
<td>
<p>the name of the exposure variable as a string. The exposure must be binary (0/1) where unexposed is coded as 0.</p>
</td></tr>
<tr><td><code id="AFparfrailty_+3A_times">times</code></td>
<td>
<p>a scalar or vector of time points specified by the user for which the attributable fraction function is estimated. If not specified the observed death times will be used.</p>
</td></tr>
<tr><td><code id="AFparfrailty_+3A_clusterid">clusterid</code></td>
<td>
<p>the name of the cluster identifier variable as a string, if data are clustered.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>AFparfrailty</code> estimates the attributable fraction for a time-to-event outcome
under the hypothetical scenario where a binary exposure <code>X</code> is eliminated from the population.
The estimate is adjusted for confounders <code>Z</code> by the shared frailty model (<code><a href="stdReg.html#topic+parfrailty">parfrailty</a></code>).
The baseline hazard is assumed to follow a Weibull distribution and the unobserved shared frailty effects <code>U</code> are assumed to be gamma distributed.
Let the AF function be defined as
</p>
<p style="text-align: center;"><code class="reqn">AF=1-\frac{\{1-S_0(t)\}}{\{1-S(t)\}}</code>
</p>

<p>where <code class="reqn">S_0(t)</code> denotes the counterfactual survival function for the event if
the exposure would have been eliminated from the population at baseline and <code class="reqn">S(t)</code> denotes the factual survival function.
If <code>Z</code> and <code>U</code> are sufficient for confounding control, then <code class="reqn">S_0(t)</code> can be expressed as <code class="reqn">E_Z\{S(t\mid{X=0,Z })\}</code>.
The function uses a fitted Weibull gamma-frailty model to estimate <code class="reqn">S(t\mid{X=0,Z})</code>, and the marginal sample distribution of <code>Z</code>
to approximate the outer expectation. A clustered sandwich formula is used in all variance calculations.
</p>


<h3>Value</h3>

<table>
<tr><td><code>AF.est</code></td>
<td>
<p>estimated attributable fraction function for every time point specified by <code>times</code>.</p>
</td></tr>
<tr><td><code>AF.var</code></td>
<td>
<p>estimated variance of <code>AF.est</code>. The variance is obtained by combining the delta methods with the sandwich formula.</p>
</td></tr>
<tr><td><code>S.est</code></td>
<td>
<p>estimated factual survival function; <code class="reqn">S(t)</code>.</p>
</td></tr>
<tr><td><code>S.var</code></td>
<td>
<p>estimated variance of <code>S.est</code>. The variance is obtained by the sandwich formula.</p>
</td></tr>
<tr><td><code>S0.est</code></td>
<td>
<p>estimated counterfactual survival function if exposure would be eliminated; <code class="reqn">S_0(t)</code>.</p>
</td></tr>
<tr><td><code>S0.var</code></td>
<td>
<p>estimated variance of <code>S0.est</code>. The variance is obtained by the sandwich formula.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Elisabeth Dahlqwist, Arvid Sjölander
</p>


<h3>See Also</h3>

<p><code><a href="stdReg.html#topic+parfrailty">parfrailty</a></code> used for fitting the Weibull gamma-frailty and <code><a href="stdReg.html#topic+stdParfrailty">stdParfrailty</a></code> used for standardization of a <code>parfrailty</code> object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Example 1: clustered data with frailty U
expit &lt;- function(x) 1 / (1 + exp( - x))
n &lt;- 100
m &lt;- 2
alpha &lt;- 1.5
eta &lt;- 1
phi &lt;- 0.5
beta &lt;- 1
id &lt;- rep(1:n,each=m)
U &lt;- rep(rgamma(n, shape = 1 / phi, scale = phi), each = m)
Z &lt;- rnorm(n * m)
X &lt;- rbinom(n * m, size = 1, prob = expit(Z))
# Reparametrize scale as in rweibull function
weibull.scale &lt;- alpha / (U * exp(beta * X)) ^ (1 / eta)
t &lt;- rweibull(n * m, shape = eta, scale = weibull.scale)

# Right censoring
c &lt;- runif(n * m, 0, 10)
delta &lt;- as.numeric(t &lt; c)
t &lt;- pmin(t, c)

data &lt;- data.frame(t, delta, X, Z, id)

# Fit a parfrailty object
library(stdReg)
fit &lt;- parfrailty(formula = Surv(t, delta) ~ X + Z + X * Z, data = data, clusterid = "id")
summary(fit)

# Estimate the attributable fraction from the fitted frailty model

time &lt;- c(seq(from = 0.2, to = 1, by = 0.2))

AFparfrailty_est &lt;- AFparfrailty(object = fit, data = data, exposure = "X",
                                  times = time, clusterid = "id")
summary(AFparfrailty_est)
plot(AFparfrailty_est, CI = TRUE, ylim=c(0.1,0.7))
</code></pre>

<hr>
<h2 id='clslowbwt'>Birthweight data clustered on the mother.</h2><span id='topic+clslowbwt'></span>

<h3>Description</h3>

<p>This dataset is borrowed from &quot;An introduction to Stata for health reserachers&quot; (Juul and Frydenberg, 2010).
The dataset contains data on 189 mothers who have given birth to one or several children. In total, the dataset contains data on 487 births.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(clslowbwt)
</code></pre>


<h3>Format</h3>

<p>The dataset is structured so that each row corresponds to one birth/child. It contains the following variables: 
</p>

<dl>
<dt>id</dt><dd><p>the identification number of the mother.</p>
</dd>
<dt>birth</dt><dd><p>the number of the birth, i.e. &quot;1&quot; for the mother's first birth, &quot;2&quot; for the mother's second birth etc.</p>
</dd>
<dt>smoke</dt><dd><p>a categorical variable indicating if the mother is a smoker or not with levels &quot;<code>0. No</code>&quot; and &quot;<code>1. Yes</code>&quot;.</p>
</dd>
<dt>race</dt><dd><p>the race of the mother with levels &quot;<code>1. White</code>&quot;, &quot;<code>2. Black</code>&quot; or &quot;<code>3. Other</code>&quot;.</p>
</dd>
<dt>age</dt><dd><p>the age of the mother at childbirth.</p>
</dd>
<dt>lwt</dt><dd><p>weight of the mother at last menstruational period (in pounds).</p>
</dd>
<dt>bwt</dt><dd><p>birthweight of the newborn.</p>
</dd>
<dt>low</dt><dd><p>a categorical variable indicating if the newborn is categorized as a low birthweight baby (&lt;2500 grams) or not with levels &quot;<code>0. No</code>&quot; and &quot;<code>1. Yes</code>&quot;.</p>
</dd>
<dt>smoker</dt><dd><p>a numeric indicator if the mother is a smoker or not. Recoded version of the variable &quot;<code>smoke</code>&quot; where &quot;<code>0.No</code>&quot; is recoded as &quot;0&quot; and &quot;<code>1.Yes</code>&quot; is recoded as &quot;1&quot;.</p>
</dd>
<dt>lbw</dt><dd><p>a numeric indicator of whether the newborn is categorized as a low birthweight baby (&lt;2500 grams) or not. Recoded version of the variable &quot;<code>low</code>&quot; where &quot;<code>0.No</code>&quot; is recoded as &quot;0&quot; and &quot;<code>1.Yes</code>&quot; is recoded as &quot;1&quot;.</p>
</dd>
</dl>

<p><strong>The following changes have been made to the original data in Juul &amp; Frydenberg (2010):</strong>
</p>
<p>- The variable &quot;<code>low</code>&quot; is recoded into the numeric indicator variable &quot;<code>lbw</code>&quot;: 
</p>
<p><code>clslowbwt$lbw &lt;- as.numeric(clslowbwt$low == "1. Yes")</code>
</p>
<p>- The variable &quot;<code>smoke</code>&quot; is recoded into the numeric indicator variable &quot;<code>smoker</code>&quot;: 
</p>
<p><code>clslowbwt$smoker &lt;- as.numeric(clslowbwt$smoke == "1. Yes")</code></p>


<h3>References</h3>

<p>Juul, Svend &amp; Frydenberg, Morten (2010). <em>An introduction to Stata for health researchers</em>, Texas, Stata press, 2010 (Third edition).
</p>
<p><a href="http://www.stata-press.com/data/ishr3.html">http://www.stata-press.com/data/ishr3.html</a>
</p>

<hr>
<h2 id='plot.AF'>Plot function for objects of class &quot;<code>AF</code>&quot; from the function <code>AFcoxph</code> or <code>AFparfrailty</code>.</h2><span id='topic+plot.AF'></span>

<h3>Description</h3>

<p>Creates a simple scatterplot for the AF function with time sequence (specified by the user as <code>times</code> in the <code><a href="#topic+AFcoxph">AFcoxph</a></code> function) on the x-axis and the AF function estimate on the y-axis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'AF'
plot(x, CI = TRUE, confidence.level, CI.transform, xlab,
  main, ylim, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.AF_+3A_x">x</code></td>
<td>
<p>an object of class <code>AF</code> from the <code><a href="#topic+AFcoxph">AFcoxph</a></code> or <code><a href="#topic+AFparfrailty">AFparfrailty</a></code> function.</p>
</td></tr>
<tr><td><code id="plot.AF_+3A_ci">CI</code></td>
<td>
<p>if TRUE confidence intervals are estimated and ploted in the graph.</p>
</td></tr>
<tr><td><code id="plot.AF_+3A_confidence.level">confidence.level</code></td>
<td>
<p>user-specified confidence level for the confidence intervals. If not specified it defaults to 95 percent. Should be specified in decimals such as 0.95 for 95 percent.</p>
</td></tr>
<tr><td><code id="plot.AF_+3A_ci.transform">CI.transform</code></td>
<td>
<p>user-specified transformation of the Wald confidence interval(s). Options are <code>untransformed</code>, <code>log</code> and <code>logit</code>. If not specified untransformed will be calculated.</p>
</td></tr>
<tr><td><code id="plot.AF_+3A_xlab">xlab</code></td>
<td>
<p>label on the x-axis. If not specified the label <em>&quot;Time&quot;</em> will be displayed.</p>
</td></tr>
<tr><td><code id="plot.AF_+3A_main">main</code></td>
<td>
<p>main title of the plot. If not specified the lable <em>&quot;Estimate of the attributable fraction function&quot;</em> will be displayed.</p>
</td></tr>
<tr><td><code id="plot.AF_+3A_ylim">ylim</code></td>
<td>
<p>limits on the y-axis of the plot. If not specified the minimum value of the lower bound of the confidence interval will be used as the minimal value and the maximum value of the upper bound of the confidence interval will be used as the maximum of y-axis of the plot.</p>
</td></tr>
<tr><td><code id="plot.AF_+3A_...">...</code></td>
<td>
<p>further arguments to be passed to the plot function. See <code><a href="graphics.html#topic+plot">plot</a></code>.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Elisabeth Dahlqwist, Arvid Sjölander
</p>

<hr>
<h2 id='rott2'>Cohort study on breast cancer patients from the Netherlands.</h2><span id='topic+rott2'></span>

<h3>Description</h3>

<p>This dataset is borrowed from
&quot;Flexible parametric survival analysis using Stata: beyond the Cox model&quot; (Roystone and Lambert, 2011).
It contains follow-up data on 2982 woman with breast cancer who have gone through breast surgery.
The women are followed from the time of surgery until death, relapse or censoring.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(rott2)
</code></pre>


<h3>Format</h3>

<p>The dataset <code>rott2</code> contains the following variables:
</p>

<dl>
<dt>pid</dt><dd><p>patient ID number.</p>
</dd>
<dt>year</dt><dd><p>year of breast surgery (i.e. year of enrollment into the study), between the years 1978-1993.</p>
</dd>
<dt>rf</dt><dd><p>relapse free interval measured in months.</p>
</dd>
<dt>rfi</dt><dd><p>relapse indicator.</p>
</dd>
<dt>m</dt><dd><p>metastasis free.</p>
</dd>
<dt>mfi</dt><dd><p>metastasis status.</p>
</dd>
<dt>os</dt><dd><p>overall survival</p>
</dd>
<dt>osi</dt><dd><p>overall survival indicator</p>
</dd>
<dt>age</dt><dd><p>age at surgery measured in years.</p>
</dd>
<dt>meno</dt><dd><p>menopausal status with levels &quot;<code>pre</code>&quot; and &quot;<code>post</code>&quot;.</p>
</dd>
<dt>size</dt><dd><p>tumor size in three classes: <code>&lt;=20mm, &gt;20-50mmm</code> and <code>&gt;50mm</code>.</p>
</dd>
<dt>grade</dt><dd><p>differentiation grade with levels 2 or 3.</p>
</dd>
<dt>pr</dt><dd><p>progesterone receptors, fmol/l.</p>
</dd>
<dt>er</dt><dd><p>oestrogen receptors, fmol/l.</p>
</dd>
<dt>nodes</dt><dd><p>the number of positive lymph nodes.</p>
</dd>
<dt>hormon</dt><dd><p>hormonal therapy with levels &quot;<code>no</code>&quot; and &quot;<code>yes</code>&quot;.</p>
</dd>
<dt>chemo</dt><dd><p>categorical variable indicating whether the patient recieved chemotheraphy or not, with levels &quot;<code>no</code>&quot; and &quot;<code>yes</code>&quot;.</p>
</dd>
<dt>recent</dt><dd><p>a numeric indicator of whether the tumor was discovered recently with levels &quot;<code>1978-87</code>&quot; and &quot;<code>1988-93</code>&quot;.</p>
</dd>
<dt>no.chemo</dt><dd><p>a numerical indicator of whether the patient did not recieved chemotherapy. Recoded version of &quot;<code>chemo</code>&quot; where &quot;<code>yes</code>&quot; is recoded as 0 and &quot;<code>no</code>&quot; is recoded as 1.</p>
</dd>
</dl>

<p><strong>The following changes have been made to the original data in Roystone and Lambert (2011):</strong>
</p>
<p>- The variable &quot;<code>chemo</code>&quot; is recoded into the numeric indicator variable &quot;<code>no.chemo</code>&quot;:
</p>
<p><code>rott22$no.chemo &lt;- as.numeric(rott2$chemo == "no")</code>
</p>
<p>The follwing variables have been removed from the original dataset: <code>enodes, pr_1, enodes_1, _st, _d, _t, _t0</code>
since they are recodings of some existing variables which are not used in this analysis.</p>


<h3>References</h3>

<p>Royston, Patrick &amp; Lambert, Paul. C (2011). <em>Flexible parametric survival analysis using Stata: beyond the Cox model</em>. College Station, Texas, U.S, Stata press.
</p>
<p><a href="http://www.stata-press.com/data/fpsaus.html">http://www.stata-press.com/data/fpsaus.html</a>
</p>

<hr>
<h2 id='singapore'>Case-control study on oesophageal cancer in Chinese Singapore men.</h2><span id='topic+singapore'></span>

<h3>Description</h3>

<p>This dataset is borrowed from &quot;Aetiological factors in oesophageal cancer in Singapore Chinese&quot; by De Jong UW, Breslow N, Hong JG, Sridharan M, Shanmugaratnam K (1974).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(singapore)
</code></pre>


<h3>Format</h3>

<p>The dataset contains the following variables:
</p>

<dl>
<dt>Age</dt><dd><p>age of the patient.</p>
</dd> 
<dt>Dial</dt><dd><p>dialect group where 1 represent &quot;<code>Hokhien/Teochew</code>&quot; and 0 represent &quot;<code>Cantonese/Other</code>&quot;.</p>
</dd>
<dt>Samsu</dt><dd><p>a numeric indicator of whether the patient consumes Samsu wine or not.</p>
</dd>
<dt>Cigs</dt><dd><p>number of cigarettes smoked per day.</p>
</dd>
<dt>Bev</dt><dd><p>number of beverage at &quot;burning hot&quot; temperatures ranging between 0 to 3 different drinks per day.</p>
</dd>
<dt>Everhotbev</dt><dd><p>a numeric indicator of whether the patients ever drinks &quot;burning hot beverage&quot; or not. Recoded from the variable &quot;<code>Bev</code>&quot;.</p>
</dd>
<dt>Set</dt><dd><p>matched set identification number.</p>
</dd>
<dt>CC</dt><dd><p>a numeric variable where 1 represent if the patient is a case, 2 represent if the patient is a control from the same ward as the case and 3 represent if the patient is control from orthopedic hospital.</p>
</dd>
<dt>Oesophagealcancer</dt><dd><p>a numeric indicator variable of whether the patient is a case of oesophageal cancer or not.</p>
</dd> 
</dl>

<p><strong>The following changes have been made to the data from the original data in De Jong UW (1974):</strong>
</p>
<p>- The variable &quot;<code>Bev</code>&quot; is recoded into the numeric indicator variable &quot;<code>Everhotbev</code>&quot;:
</p>
<p><code>singapore$Everhotbev &lt;- ifelse(singapore$Bev &gt;= 1, 1, 0)</code></p>


<h3>References</h3>

<p>De Jong UW, Breslow N, Hong JG, Sridharan M, Shanmugaratnam K. (1974). Aetiological factors in oesophageal cancer in Singapore Chinese. <em>Int J Cancer</em> Mar 15;13(3), 291-303.
</p>
<p><a href="http://faculty.washington.edu/heagerty/Courses/b513/WEB2002/datasets.html">http://faculty.washington.edu/heagerty/Courses/b513/WEB2002/datasets.html</a>
</p>

<hr>
<h2 id='summary.AF'>Summary function for objects of class &quot;<code>AF</code>&quot;.</h2><span id='topic+summary.AF'></span>

<h3>Description</h3>

<p>Gives a summary of the AF estimate(s) including z-value, p-value and confidence interval(s).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'AF'
summary(object, digits = max(3L, getOption("digits") - 3L),
  confidence.level, CI.transform, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.AF_+3A_object">object</code></td>
<td>
<p>an object of class <code>AF</code> from <code><a href="#topic+AFglm">AFglm</a></code>, <code><a href="#topic+AFcoxph">AFcoxph</a></code>, <code><a href="#topic+AFclogit">AFclogit</a></code>, <code><a href="#topic+AFparfrailty">AFparfrailty</a></code> or <code><a href="#topic+AFivglm">AFivglm</a></code> functions.</p>
</td></tr>
<tr><td><code id="summary.AF_+3A_digits">digits</code></td>
<td>
<p>maximum number of digits.</p>
</td></tr>
<tr><td><code id="summary.AF_+3A_confidence.level">confidence.level</code></td>
<td>
<p>user-specified confidence level for the confidence intervals. If not specified it defaults to 95 percent. Should be specified in decimals such as 0.95 for 95 percent.</p>
</td></tr>
<tr><td><code id="summary.AF_+3A_ci.transform">CI.transform</code></td>
<td>
<p>user-specified transformation of the Wald confidence interval(s). Options are <code>untransformed</code>, <code>log</code> and <code>logit</code>. If not specified untransformed will be calculated.</p>
</td></tr>
<tr><td><code id="summary.AF_+3A_...">...</code></td>
<td>
<p>further arguments to be passed to the summary function. See <code><a href="base.html#topic+summary">summary</a></code>.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Elisabeth Dahlqwist, Arvid Sjölander
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
