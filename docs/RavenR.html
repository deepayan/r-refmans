<!DOCTYPE html><html><head><title>Help for package RavenR</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {RavenR}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#RavenR-package'><p>RavenR</p></a></li>
<li><a href='#+25+26gt+3B+25'><p>Pipe operator</p>
</p>
<p>See <code>magrittr::%&gt;%</code> for details.</p></a></li>
<li><a href='#+25notin+25'><p>%notin% operator</p></a></li>
<li><a href='#cmax'><p>cmax</p></a></li>
<li><a href='#rvn_annual_peak'><p>Annual Peak Comparison</p></a></li>
<li><a href='#rvn_annual_peak_error'><p>Annual Peak Errors</p></a></li>
<li><a href='#rvn_annual_peak_event'><p>Annual Peak Event Comparison</p></a></li>
<li><a href='#rvn_annual_peak_event_error'><p>Annual Peak Event Errors</p></a></li>
<li><a href='#rvn_annual_peak_timing_error'><p>Annual Peak Timing Errors</p></a></li>
<li><a href='#rvn_annual_quantiles'><p>Calculates Yearly Median, Upper and Lower Quantiles of Flow</p></a></li>
<li><a href='#rvn_annual_quantiles_plot'><p>Plot of Annual Median, Upper and Lower Quantiles of Flow</p></a></li>
<li><a href='#rvn_annual_volume'><p>Annual Volume Comparison</p></a></li>
<li><a href='#rvn_apply_wyearly'><p>Apply function for water year</p></a></li>
<li><a href='#rvn_apply_wyearly_which_max_xts'><p>which.max over water year periods</p></a></li>
<li><a href='#rvn_budyko_plot'><p>Budkyo Plot</p></a></li>
<li><a href='#rvn_calc_runoff_coeff'><p>Generate runoff coefficients upstream of gauges</p></a></li>
<li><a href='#rvn_cum_plot_flow'><p>Cumulative Plot of model flows</p></a></li>
<li><a href='#rvn_custom_data'><p>Custom Output Data from Raven</p></a></li>
<li><a href='#rvn_custom_output_plot'><p>Plot Raven Custom Output</p></a></li>
<li><a href='#rvn_custom_read'><p>Read Raven Custom Output files</p></a></li>
<li><a href='#rvn_df_to_Raven_table'><p>Sets up tables for writing to Raven input files</p></a></li>
<li><a href='#rvn_dist_lonlat'><p>Calculate distance from long/lat</p></a></li>
<li><a href='#rvn_download'><p>Downloads Raven</p></a></li>
<li><a href='#rvn_exhaustive_mb_read'><p>Read in Raven Exhaustive Mass Balance file</p></a></li>
<li><a href='#rvn_fdc_plot'><p>Plots summary of watershed forcing functions</p></a></li>
<li><a href='#rvn_flow_residuals'><p>Residuals of model flows</p></a></li>
<li><a href='#rvn_flow_scatterplot'><p>Scatterplot of model flows</p></a></li>
<li><a href='#rvn_flow_spaghetti'><p>Flow Spaghetti Plot</p></a></li>
<li><a href='#rvn_forcing_data'><p>Forcings Data from Raven</p></a></li>
<li><a href='#rvn_forcings_plot'><p>Plots summary of watershed forcing functions</p></a></li>
<li><a href='#rvn_forcings_read'><p>Read in Raven ForcingFunctions file</p></a></li>
<li><a href='#rvn_fortify_xts'><p>Fortify xts object to specific format</p></a></li>
<li><a href='#rvn_gen_obsweights'><p>Create weights time series for calibration/diagnostic evaluation</p></a></li>
<li><a href='#rvn_get_prd'><p>Check period input</p></a></li>
<li><a href='#rvn_hyd_dygraph'><p>Read in Raven Hydrograph file</p></a></li>
<li><a href='#rvn_hyd_extract'><p>Extract function for Raven Hydrograph object</p></a></li>
<li><a href='#rvn_hyd_plot'><p>Create Hydrograph Plot</p></a></li>
<li><a href='#rvn_hyd_read'><p>Read in Raven Hydrograph file</p></a></li>
<li><a href='#rvn_hydrograph_data'><p>Hydrograph Data from Raven</p></a></li>
<li><a href='#rvn_met_interpolate'><p>Interpolate meteorological data using IDW</p></a></li>
<li><a href='#rvn_met_recordplot'><p>EC Climate Gauge Record Overlap Visualization</p></a></li>
<li><a href='#rvn_month_names'><p>Months in the Year vector</p></a></li>
<li><a href='#rvn_monthly_vbias'><p>Monthly Volume Bias</p></a></li>
<li><a href='#rvn_num_days'><p>Number of Days between two dates</p></a></li>
<li><a href='#rvn_num_days_month'><p>Number of Days in Month</p></a></li>
<li><a href='#rvn_res_dygraph'><p>Plot Raven reservoir/lake stage time series using dygraph</p></a></li>
<li><a href='#rvn_res_extract'><p>Extract function for Raven Reservoir object</p></a></li>
<li><a href='#rvn_res_plot'><p>Plot Reservoir Stage</p></a></li>
<li><a href='#rvn_res_read'><p>Read in Raven ReservoirStages file</p></a></li>
<li><a href='#rvn_run'><p>Run Raven Executable</p></a></li>
<li><a href='#rvn_rvc_from_custom_output'><p>Generate RVC file from Custom Output CSVs</p></a></li>
<li><a href='#rvn_rvc_res'><p>Create initial conditions file for Reservoirs</p></a></li>
<li><a href='#rvn_rvc_write'><p>Write Raven Initial Condition (rvc) file</p></a></li>
<li><a href='#rvn_rvh_blankHRUdf'><p>Generate Blank Raven HRU DataFrame</p></a></li>
<li><a href='#rvn_rvh_blankSBdf'><p>Generate Blank Raven SubBasin DataFrame</p></a></li>
<li><a href='#rvn_rvh_cleanhrus'><p>Clean HRU data table.</p></a></li>
<li><a href='#rvn_rvh_overwrite'><p>Write/Overwrite Raven rvh file</p></a></li>
<li><a href='#rvn_rvh_query'><p>Queries RVH object for subbasins and HRUs of interest</p></a></li>
<li><a href='#rvn_rvh_read'><p>Read Raven .rvh (watershed discretization) file</p></a></li>
<li><a href='#rvn_rvh_subbasin_network_plot'><p>Basic Raven subbasin network plot</p></a></li>
<li><a href='#rvn_rvh_subbasin_visnetwork_plot'><p>Plot subbasin network using visNetwork</p></a></li>
<li><a href='#rvn_rvh_summarize'><p>Summarize RVH object</p></a></li>
<li><a href='#rvn_rvh_write_subbasingroup'><p>Write a subbasin group to Raven RVH format</p></a></li>
<li><a href='#rvn_rvi_connections'><p>Generate Hydrological process connections list</p></a></li>
<li><a href='#rvn_rvi_getparams'><p>Retrieve Parameter Information from RVI file Algorithms</p></a></li>
<li><a href='#rvn_rvi_process_diagrammer'><p>Plot Raven hydrologic process network using DiagrammeR</p></a></li>
<li><a href='#rvn_rvi_process_ggplot'><p>Plot Raven hydrologic process network</p></a></li>
<li><a href='#rvn_rvi_read'><p>Read Raven .rvi (watershed discretization) file</p></a></li>
<li><a href='#rvn_rvi_write_template'><p>Write Raven rvi file based on model configuration templates</p></a></li>
<li><a href='#rvn_rvp_fill_template'><p>Rewrite template rvp file with values</p></a></li>
<li><a href='#rvn_rvt_mappings_data'><p>Rvt Mappings Data</p></a></li>
<li><a href='#rvn_rvt_read'><p>Read .rvt (Raven time series) file</p></a></li>
<li><a href='#rvn_rvt_tidyhydat'><p>EC Streamgauge File Conversion from tidyhydat</p></a></li>
<li><a href='#rvn_rvt_write'><p>Write Raven rvt file from Time Series</p></a></li>
<li><a href='#rvn_rvt_write_met'><p>EC Climate Station File Conversion</p></a></li>
<li><a href='#rvn_stringpad'><p>Pads string with spaces, either right or left justified</p></a></li>
<li><a href='#rvn_substrLeft'><p>substring from the Left</p></a></li>
<li><a href='#rvn_substrMLeft'><p>substring minus characters from the Left</p></a></li>
<li><a href='#rvn_substrMRight'><p>substring minus characters from the Right</p></a></li>
<li><a href='#rvn_substrRight'><p>substring from the Right</p></a></li>
<li><a href='#rvn_theme_RavenR'><p>RavenR ggplot theme</p></a></li>
<li><a href='#rvn_tidyhydat_sample'><p>tidyhydat sample data for RavenR package</p></a></li>
<li><a href='#rvn_ts_infill'><p>Infill discontinuous time series with blank values</p></a></li>
<li><a href='#rvn_watershed_data'><p>Watershed Storage Data from Raven</p></a></li>
<li><a href='#rvn_watershed_read'><p>Read in Raven WatershedStorage file</p></a></li>
<li><a href='#rvn_watershedmeb_read'><p>Read in Raven WatershedMassEnergyBalance file</p></a></li>
<li><a href='#rvn_weathercan_metadata_sample'><p>weathercan sample metadata for RavenR package</p></a></li>
<li><a href='#rvn_weathercan_sample'><p>weathercan sample data for RavenR package</p></a></li>
<li><a href='#rvn_which_max_xts'><p>which.max for xts objects</p></a></li>
<li><a href='#rvn_write_Raven_header'><p>Write common Raven file header</p></a></li>
<li><a href='#rvn_write_Raven_label'><p>Writes common Raven labeled line to file, with optional value (appends)</p></a></li>
<li><a href='#rvn_write_Raven_newfile'><p>Opens/Creates a new file, writes common file header.</p></a></li>
<li><a href='#rvn_write_Raven_table'><p>Writes a nicely formatted tables of Raven attributes/parameters</p></a></li>
<li><a href='#rvn_wyear_indices'><p>Water Year Indices</p></a></li>
<li><a href='#rvn_xts_plot'><p>Create plot from xts data</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Raven Hydrological Modelling Framework R Support and Analysis</td>
</tr>
<tr>
<td>Version:</td>
<td>2.2.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-10-28</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Robert Chlumsky &lt;rchlumsk@uwaterloo.ca&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Utilities for processing input and output files associated with the Raven Hydrological Modelling Framework. Includes various plotting functions, model diagnostics, reading output files into extensible time series format, and support for writing Raven input files. 
    The 'RavenR' package is also archived at Chlumsky et al. (2020) &lt;<a href="https://doi.org/10.5281%2Fzenodo.4248183">doi:10.5281/zenodo.4248183</a>&gt;.
    The Raven Hydrologic Modelling Framework method can be referenced with Craig et al. (2020) &lt;<a href="https://doi.org/10.1016%2Fj.envsoft.2020.104728">doi:10.1016/j.envsoft.2020.104728</a>&gt;.</td>
</tr>
<tr>
<td>Note:</td>
<td>Package is in active development; please report errors and
suggestions to rchlumsk@uwaterloo.ca.</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/rchlumsk/RavenR/issues">https://github.com/rchlumsk/RavenR/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.6.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>colorspace, cowplot, crayon, DiagrammeR, dplyr, dygraphs,
gdata, ggplot2, igraph, lubridate, magrittr, purrr, Rcpp,
RCurl, scales, stats, stringr, tidyr, utils, visNetwork, xts,
zoo</td>
</tr>
<tr>
<td>Suggests:</td>
<td>devtools, DiagrammeRsvg, knitr, rmarkdown, rsvg</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/rchlumsk/RavenR">https://github.com/rchlumsk/RavenR</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>TRUE</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.2</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-10-28 20:25:29 UTC; rchlumsk</td>
</tr>
<tr>
<td>Author:</td>
<td>Robert Chlumsky <a href="https://orcid.org/0000-0002-1303-5064"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [cre, aut],
  James Craig <a href="https://orcid.org/0000-0003-2715-7166"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [ctb,
    aut],
  Leland Scantlebury [ctb, aut],
  Simon Lin [ctb, aut],
  Sarah Grass [ctb, aut],
  Genevieve Brown [ctb, aut],
  Rezgar Arabzadeh [ctb, aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-10-28 21:02:50 UTC</td>
</tr>
</table>
<hr>
<h2 id='RavenR-package'>RavenR</h2><span id='topic+RavenR-package'></span>

<h3>Description</h3>

<p>Contains functions to perform pre- and post-processing of RavenR files.
</p>


<h3>Details</h3>

<p>This package provides a number of types of useful functions, including:
</p>

<ul>
<li><p>reading in <strong>Raven output files</strong> (including ForcingFunctions, Hydrographs, etc.)
</p>
</li>
<li><p>processing some file types into <strong>Raven format</strong>
</p>
</li>
<li><p>flow-based <strong>diagnostics</strong> and plot functions
</p>
</li>
<li><p>other useful plotting functions (e.g. rvi process plot, spaghetti plot, dyGraphs, network plots)
</p>
</li>
<li><p>useful utilities for time series and hydrologic functions (e.g. rvn_apply_wyearly)
</p>
</li></ul>



<h3>See Also</h3>

<p>The package on <a href="https://cran.r-project.org/package=RavenR">CRAN</a> and
the development version on <a href="https://github.com/rchlumsk/RavenR">GitHub</a>.
See also <a href="http://www.civil.uwaterloo.ca/jrcraig/">James R.
Craig's research page</a> for software downloads, including the
<a href="http://raven.uwaterloo.ca/">Raven webpage</a>.
</p>

<hr>
<h2 id='+25+26gt+3B+25'>Pipe operator
See <code>magrittr::<a href="magrittr.html#topic+pipe">%&gt;%</a></code> for details.</h2><span id='topic++25+3E+25'></span>

<h3>Description</h3>

<p>Pipe operator
</p>
<p>See <code>magrittr::<a href="magrittr.html#topic+pipe">%&gt;%</a></code> for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lhs %&gt;% rhs
</code></pre>

<hr>
<h2 id='+25notin+25'>%notin% operator</h2><span id='topic++25notin+25'></span>

<h3>Description</h3>

<p>Syntax for the opposite of %in%
</p>


<h3>Usage</h3>

<pre><code class='language-R'>x %notin% table
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="+2B25notin+2B25_+3A_x">x</code></td>
<td>
<p>values to be matched</p>
</td></tr>
<tr><td><code id="+2B25notin+2B25_+3A_table">table</code></td>
<td>
<p>the values to be matched against</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>seq(1,5,1) %notin% seq(3,7,1)

</code></pre>

<hr>
<h2 id='cmax'>cmax</h2><span id='topic+cmax'></span>

<h3>Description</h3>

<p>Applies the base::max function across columns.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cmax(x, na.rm = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cmax_+3A_x">x</code></td>
<td>
<p>object to apply the max function to</p>
</td></tr>
<tr><td><code id="cmax_+3A_na.rm">na.rm</code></td>
<td>
<p>whether to remove na values from the calculation</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It applies the base::max function over
columns, which is advantageous for calculating the max within a column
rather than the max of the whole data frame. The default base::max will not work
properly for data frames and other structures in applying over columns or different periods.
</p>
<p>This function was included for usage with the apply.&lt;period&gt; and <code><a href="#topic+rvn_apply_wyearly">rvn_apply_wyearly</a></code>
function, as the base::max function does not work properly across columns.
</p>


<h3>Value</h3>

<p>x with the max value in each column determined
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_apply_wyearly">rvn_apply_wyearly</a></code> where this function can be applied for the water year,
and the xts functions such as <code><a href="xts.html#topic+apply.yearly">apply.yearly</a></code> and <code><a href="xts.html#topic+apply.monthly">apply.monthly</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(rvn_hydrograph_data)
cmax(rvn_hydrograph_data$hyd$Sub43_obs, na.rm=TRUE)

rvn_apply_wyearly(rvn_hydrograph_data$hyd, cmax, na.rm=TRUE)

</code></pre>

<hr>
<h2 id='rvn_annual_peak'>Annual Peak Comparison</h2><span id='topic+rvn_annual_peak'></span>

<h3>Description</h3>

<p>rvn_annual_peak creates a plot of the annual observed and simulated peaks, based on the water year.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_annual_peak(
  sim,
  obs,
  mm = 9,
  dd = 30,
  add_line = TRUE,
  add_r2 = FALSE,
  add_eqn = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_annual_peak_+3A_sim">sim</code></td>
<td>
<p>time series object of simulated flows</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_+3A_obs">obs</code></td>
<td>
<p>time series object of observed flows</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_+3A_mm">mm</code></td>
<td>
<p>month of water year ending (default 9)</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_+3A_dd">dd</code></td>
<td>
<p>day of water year ending (default 30)</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_+3A_add_line">add_line</code></td>
<td>
<p>optionally adds a 1:1 line to the plot for reference (default <code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_+3A_add_r2">add_r2</code></td>
<td>
<p>optionally computes the R2 and adds to plot (default <code>FALSE</code>)</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_+3A_add_eqn">add_eqn</code></td>
<td>
<p>optionally adds the equation for a linear regression line through the origin (default <code>FALSE</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Creates a scatterplot of the annual observed and simulated
peaks, calculated for each available water year of data
within the two series provided. The default start of the water year
is October 1st, but may be adjusted through function parameters. Note that the
calculation uses the peak magnitude of simulated and observed series in each water year, without
considering the timing of the events in each series.
</p>
<p>The sim and obs should be of time series (xts) format and are assumed to be
of the same length and time period. The flow series are assumed to be daily
flows with units of m3/s.
</p>
<p>The R2 diagnostic is calculated for a fit with no intercept, consistent with the provided
1:1 line (in a perfect fit the points are identical, and intercept is automatically zero).
</p>
<p>Note that a plot title is purposely omitted in order to allow the automatic
generation of plot titles.
</p>


<h3>Value</h3>

<p>returns a list with peak data in a data frame, and a ggplot object
</p>
<table>
<tr><td><code>df_peak</code></td>
<td>
<p>data frame of the calculated peaks</p>
</td></tr>
<tr><td><code>p1</code></td>
<td>
<p>ggplot object with plotted annual peaks</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_annual_volume">rvn_annual_volume</a></code> to create a scatterplot of annual flow
volumes <code><a href="#topic+rvn_annual_peak_event">rvn_annual_peak_event</a></code> to consider the timing of peak
events.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# load sample hydrograph data, two years worth of sim/obs
data(rvn_hydrograph_data)
sim &lt;- rvn_hydrograph_data$hyd$Sub36
obs &lt;- rvn_hydrograph_data$hyd$Sub36_obs

# create a plot of annual peaks with default options
peak1 &lt;- rvn_annual_peak(sim, obs)
peak1$df_peak
peak1$p1

# plot with r2 and regression equation
peak_df &lt;- rvn_annual_peak(sim, obs, add_r2=TRUE, add_eqn=TRUE)
peak_df$p1

</code></pre>

<hr>
<h2 id='rvn_annual_peak_error'>Annual Peak Errors</h2><span id='topic+rvn_annual_peak_error'></span>

<h3>Description</h3>

<p>rvn_annual_peak_error creates a plot of the annual observed and simulated peak
percent errors, based on the water year.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_annual_peak_error(
  sim,
  obs,
  mm = 9,
  dd = 30,
  add_line = TRUE,
  add_labels = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_annual_peak_error_+3A_sim">sim</code></td>
<td>
<p>time series object of simulated flows</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_error_+3A_obs">obs</code></td>
<td>
<p>time series object of observed flows</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_error_+3A_mm">mm</code></td>
<td>
<p>month of water year (default 9)</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_error_+3A_dd">dd</code></td>
<td>
<p>day of water year (default 30)</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_error_+3A_add_line">add_line</code></td>
<td>
<p>optionally adds a 1:1 line to the plot for reference
(default <code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_error_+3A_add_labels">add_labels</code></td>
<td>
<p>optionally adds labels for overpredict/underpredict on
right side axis (default <code>TRUE</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Creates a plot of the percent errors in simulated peaks for
each water year. The peaks are calculated as the magnitude of the largest
event in each water year. Note that the rvn_annual_peak_error function is first
used to obtain the peaks in each year, then the percent errors are
calculated.
</p>
<p>The percent errors are calculated as (QPsim-QPobs)/QPobs*100, where QP is
the peak flow event.
</p>
<p>The sim and obs should be of time series (xts) format and are assumed to be
of the same length and time period. The flow series are assumed to be daily
flows with units of m3/s.
</p>
<p>The add_labels will add the labels of 'overprediction' and 'underprediction'
to the right hand side axis if set to TRUE. This is useful in interpreting
the plots.
</p>
<p>Note that a plot title is purposely omitted in order to allow the automatic
generation of plot titles.
</p>


<h3>Value</h3>

<p>returns a list with peak errors in a data frame, and a ggplot object
</p>
<table>
<tr><td><code>df_peak_error</code></td>
<td>
<p>data frame of the calculated peak errors</p>
</td></tr>
<tr><td><code>p1</code></td>
<td>
<p>ggplot object with plotted annual peak errors</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_annual_peak_event">rvn_annual_peak_event</a></code> to consider the timing of peak
events <code><a href="#topic+rvn_annual_peak_event_error">rvn_annual_peak_event_error</a></code> to calculate errors in peak
events.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
system.file("extdata","run1_Hydrographs.csv", package="RavenR") %&gt;%
rvn_hyd_read(.) %&gt;%
rvn_hyd_extract(subs="Sub36",.) -&gt;
hyd_data

sim &lt;- hyd_data$sim
obs &lt;- hyd_data$obs

# create a plot of annual peak errors with default options
peak1 &lt;- rvn_annual_peak_error(sim, obs)
peak1$df_peak_error
peak1$p1

# plot directly and without labels
rvn_annual_peak_error(sim, obs, add_line=TRUE, add_labels=FALSE)

</code></pre>

<hr>
<h2 id='rvn_annual_peak_event'>Annual Peak Event Comparison</h2><span id='topic+rvn_annual_peak_event'></span>

<h3>Description</h3>

<p>rvn_annual_peak_event creates a plot of the annual observed and simulated peaks,
based on the water year.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_annual_peak_event(
  sim,
  obs,
  mm = 9,
  dd = 30,
  add_line = TRUE,
  add_r2 = FALSE,
  add_eqn = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_annual_peak_event_+3A_sim">sim</code></td>
<td>
<p>time series object of simulated flows</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_event_+3A_obs">obs</code></td>
<td>
<p>time series object of observed flows</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_event_+3A_mm">mm</code></td>
<td>
<p>month of water year (default 9)</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_event_+3A_dd">dd</code></td>
<td>
<p>day of water year (default 30)</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_event_+3A_add_line">add_line</code></td>
<td>
<p>optionally adds a 1:1 line to the plot for reference
(default <code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_event_+3A_add_r2">add_r2</code></td>
<td>
<p>optionally computes the R2 and adds to plot (default <code>FALSE</code>)</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_event_+3A_add_eqn">add_eqn</code></td>
<td>
<p>optionally adds the equation for a linear regression line through the origin (default <code>FALSE</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Creates a scatterplot of the annual observed and simulated
peaks, calculated for each available water year of data
within the two series provided; note that the difference between this and
the annual.peak function is that here the peak event simulated for the same
day as the peak event in observed data is used, instead of the largest
recorded simulated event. In some sense this captures the timing of the
event, i.e. the peak event must be simulated on the same day as the observed
peak to be captured well.
</p>
<p>The sim and obs should be of time series (xts) format and are assumed to be
of the same length and time period. The flow series are assumed to be daily
flows with units of m3/s.
</p>
<p>The R2 diagnostic is calculated for a fit with no intercept (in a perfect
fit the points are identical, and intercept is automatically zero).
</p>
<p>Note that a plot title is purposely omitted in order to allow the automatic
generation of plot titles.
</p>


<h3>Value</h3>

<p>returns a list with peak data in a data frame, and a ggplot object
</p>
<table>
<tr><td><code>df_peak_event</code></td>
<td>
<p>data frame of the calculated peak events</p>
</td></tr>
<tr><td><code>p1</code></td>
<td>
<p>ggplot object with plotted annual peaks</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_annual_peak">rvn_annual_peak</a></code> to create a scatterplot of annual peaks
(consider the magnitude of peaks only)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# load sample hydrograph data, two years worth of sim/obs
data(rvn_hydrograph_data)
sim &lt;- rvn_hydrograph_data$hyd$Sub36
obs &lt;- rvn_hydrograph_data$hyd$Sub36_obs

# create a plot of annual peak events with default options
peak1 &lt;- rvn_annual_peak_event(sim, obs)
peak1$df_peak_event
peak1$p1

</code></pre>

<hr>
<h2 id='rvn_annual_peak_event_error'>Annual Peak Event Errors</h2><span id='topic+rvn_annual_peak_event_error'></span>

<h3>Description</h3>

<p>rvn_annual_peak_event_error creates a plot of the annual observed and simulated
peak event errors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_annual_peak_event_error(
  sim,
  obs,
  mm = 9,
  dd = 30,
  add_line = TRUE,
  add_labels = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_annual_peak_event_error_+3A_sim">sim</code></td>
<td>
<p>time series object of simulated flows</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_event_error_+3A_obs">obs</code></td>
<td>
<p>time series object of observed flows</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_event_error_+3A_mm">mm</code></td>
<td>
<p>month of water year (default 9)</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_event_error_+3A_dd">dd</code></td>
<td>
<p>day of water year (default 30)</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_event_error_+3A_add_line">add_line</code></td>
<td>
<p>optionally adds a 1:1 line to the plot for reference
(default <code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_event_error_+3A_add_labels">add_labels</code></td>
<td>
<p>optionally adds labels for overpredict/underpredict on
right side axis (default <code>TRUE</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Creates a plot of the percent errors in simulated peak events
for each water year. The peaks are calculated as using flows from the same
day as the peak event in the observed series, i.e. the timing of the peak is
considered here. Note that the rvn_annual_peak_event function is first used to
obtain the peaks in each year, then the percent errors are calculated.
</p>
<p>The percent errors are calculated as (QP_sim-QP_obs)/QP_obs*100, where QP is
the peak flow event.
</p>
<p>The sim and obs should be of time series (xts) format and are assumed to be
of the same length and time period. The flow series are assumed to be daily
flows with units of m3/s.
</p>
<p>The add_labels will add the labels of 'overprediction' and 'underprediction'
to the right hand side axis if set to TRUE. This is useful in interpreting
the plots.
</p>
<p>Note that a plot title is purposely omitted in order to allow the automatic
generation of plot titles.
</p>


<h3>Value</h3>

<p>returns a list with peak event error data in a data frame, and a ggplot object
</p>
<table>
<tr><td><code>df_peak_event_error</code></td>
<td>
<p>data frame of the calculated peak event errors</p>
</td></tr>
<tr><td><code>p1</code></td>
<td>
<p>ggplot object with plotted annual peak event errors</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_annual_peak">rvn_annual_peak</a></code> to consider just the magnitude of each
year's peak <code><a href="#topic+rvn_annual_peak_error">rvn_annual_peak_error</a></code> to calculate errors in peaks
</p>


<h3>Examples</h3>

<pre><code class='language-R'># load sample hydrograph data, two years worth of sim/obs
data(rvn_hydrograph_data)
sim &lt;- rvn_hydrograph_data$hyd$Sub36
obs &lt;- rvn_hydrograph_data$hyd$Sub36_obs

# create a plot of peak annual errors with default options
peak1 &lt;- rvn_annual_peak_event_error(sim, obs)
peak1$df_peak_event_error
peak1$p1

</code></pre>

<hr>
<h2 id='rvn_annual_peak_timing_error'>Annual Peak Timing Errors</h2><span id='topic+rvn_annual_peak_timing_error'></span>

<h3>Description</h3>

<p>rvn_annual_peak_timing_error creates a plot of the annual observed and simulated
peak timing errors, based on the water year.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_annual_peak_timing_error(
  sim,
  obs,
  mm = 9,
  dd = 30,
  add_line = TRUE,
  add_labels = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_annual_peak_timing_error_+3A_sim">sim</code></td>
<td>
<p>time series object of simulated flows</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_timing_error_+3A_obs">obs</code></td>
<td>
<p>time series object of observed flows</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_timing_error_+3A_mm">mm</code></td>
<td>
<p>month of water year (default 9)</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_timing_error_+3A_dd">dd</code></td>
<td>
<p>day of water year (default 30)</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_timing_error_+3A_add_line">add_line</code></td>
<td>
<p>optionally adds a 1:1 line to the plot for reference
(default <code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="rvn_annual_peak_timing_error_+3A_add_labels">add_labels</code></td>
<td>
<p>optionally adds labels for early peak/late peaks on right
side axis (default <code>TRUE</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Creates a plot of the peak timing errors in simulated peaks
for each water year. The difference in days between the simulated peak and
observed peak are plotted (and/or returned in the data frame) for the water
year. This diagnostic is useful in determining how accurate the timing of
peak predictions is. Note that a large error in the number of days between
simulated and observed peaks indicates that the model predicted a larger
event at a different time of year, i.e. overestimated a different event or
underestimated the actual peak event, relative to the observed flow series.
</p>
<p>The sim and obs should be of time series (xts) format and are assumed to be
of the same length and time period. The flow series are assumed to be daily
flows with units of m3/s. Note that a plot title is purposely omitted in
order to allow the automatic generation of plot titles.
</p>
<p>The add_labels will add the labels of 'early peak' and 'late peak' to the
right hand side axis if set to TRUE. This is useful in interpreting the
plots. Note that values in this metric of less than zero indicate an early
prediction of the peak, and positive values mean a late prediction of the
peak (since the values are calculated as day index of simulated peak - day
index of observed peak).
</p>


<h3>Value</h3>

<p>returns a list with peak timing errors in a data frame, and a ggplot object
</p>
<table>
<tr><td><code>df_peak_timing_error</code></td>
<td>
<p>data frame of the calculated peak timing errors</p>
</td></tr>
<tr><td><code>p1</code></td>
<td>
<p>ggplot object with plotted annual peak errors</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_annual_peak_event">rvn_annual_peak_event</a></code> to consider the timing of peak
events <code><a href="#topic+rvn_annual_peak_event_error">rvn_annual_peak_event_error</a></code> to calculate errors in peak
events
</p>


<h3>Examples</h3>

<pre><code class='language-R'># load sample hydrograph data, two years worth of sim/obs
data(rvn_hydrograph_data)
sim &lt;- rvn_hydrograph_data$hyd$Sub36
obs &lt;- rvn_hydrograph_data$hyd$Sub36_obs

# create a plot of peak timing errors with defaults
peak1 &lt;- rvn_annual_peak_timing_error(sim, obs, add_line=TRUE)
peak1$df_peak_timing_error
peak1$p1

# plot directly and without labels
rvn_annual_peak_timing_error(sim, obs, add_line=TRUE, add_labels=FALSE)


</code></pre>

<hr>
<h2 id='rvn_annual_quantiles'>Calculates Yearly Median, Upper and Lower Quantiles of Flow</h2><span id='topic+rvn_annual_quantiles'></span>

<h3>Description</h3>

<p>Calculate the quantiles for each day of the year based on the supplied time series.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_annual_quantiles(
  hgdata,
  prd = NULL,
  Qlower = 0.1,
  Qupper = 0.9,
  water_year = TRUE,
  mm = 9
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_annual_quantiles_+3A_hgdata">hgdata</code></td>
<td>
<p>Time series object of observed or simulated flows</p>
</td></tr>
<tr><td><code id="rvn_annual_quantiles_+3A_prd">prd</code></td>
<td>
<p>time period for subset in character format &quot;YYYY-MM-DD/YYYY-MM-DD&quot;</p>
</td></tr>
<tr><td><code id="rvn_annual_quantiles_+3A_qlower">Qlower</code></td>
<td>
<p>Decimal percentage of lower quantile value (default 0.1)</p>
</td></tr>
<tr><td><code id="rvn_annual_quantiles_+3A_qupper">Qupper</code></td>
<td>
<p>Decimal percentage of upper quantile value (default 0.9)</p>
</td></tr>
<tr><td><code id="rvn_annual_quantiles_+3A_water_year">water_year</code></td>
<td>
<p>boolean on whether to sort quantiles by water year start date (default <code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="rvn_annual_quantiles_+3A_mm">mm</code></td>
<td>
<p>month of water year ending (default 9)</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>qdat</code></td>
<td>
<p>Time series object of monthly median and quantile values</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Leland Scantlebury, <a href="mailto:leland@scantle.com">leland@scantle.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>system.file("extdata","run1_Hydrographs.csv", package="RavenR") %&gt;%
rvn_hyd_read(.) %&gt;%
rvn_hyd_extract(subs="Sub36",.) -&gt;
hyd_data

# Calculate quantiles for the simulated hydrograph
qdat &lt;- rvn_annual_quantiles(hyd_data$sim)
head(qdat)

</code></pre>

<hr>
<h2 id='rvn_annual_quantiles_plot'>Plot of Annual Median, Upper and Lower Quantiles of Flow</h2><span id='topic+rvn_annual_quantiles_plot'></span>

<h3>Description</h3>

<p>Creates a plot of the annual flow quantiles provided by the <code><a href="#topic+rvn_annual_quantiles">rvn_annual_quantiles</a></code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_annual_quantiles_plot(
  qdat,
  mediancolor = "black",
  ribboncolor = "grey60",
  ribbonalpha = 0.5,
  explot = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_annual_quantiles_plot_+3A_qdat">qdat</code></td>
<td>
<p>Time series object generated by <code><a href="#topic+rvn_annual_quantiles">rvn_annual_quantiles</a></code></p>
</td></tr>
<tr><td><code id="rvn_annual_quantiles_plot_+3A_mediancolor">mediancolor</code></td>
<td>
<p>Color for the median line</p>
</td></tr>
<tr><td><code id="rvn_annual_quantiles_plot_+3A_ribboncolor">ribboncolor</code></td>
<td>
<p>Color for the lower/upper quantile ribbon</p>
</td></tr>
<tr><td><code id="rvn_annual_quantiles_plot_+3A_ribbonalpha">ribbonalpha</code></td>
<td>
<p>Transparency of lower/upper quantile ribbon</p>
</td></tr>
<tr><td><code id="rvn_annual_quantiles_plot_+3A_explot">explot</code></td>
<td>
<p>Existing ggplot object to which median line and quantile ribbon should be added</p>
</td></tr>
</table>


<h3>Value</h3>

<p>p1 ggplot object of quantiles plot
</p>


<h3>Author(s)</h3>

<p>Leland Scantlebury, <a href="mailto:leland@scantle.com">leland@scantle.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>system.file("extdata","run1_Hydrographs.csv", package="RavenR") %&gt;%
rvn_hyd_read(.) %&gt;%
rvn_hyd_extract(subs="Sub36",.) -&gt;
hyd_data

# Calculate quantiles for the simulated hydrograph
qdat &lt;- rvn_annual_quantiles(hyd_data$sim)
head(qdat)

# Plot
p &lt;- rvn_annual_quantiles_plot(qdat)
p  # view plot

# Add a second hydrograph to compare
qdat_sim &lt;- rvn_annual_quantiles(hyd_data$sim)

p1 &lt;- rvn_annual_quantiles_plot(qdat_sim, mediancolor = 'blue', ribboncolor = 'red', explot = p)
p1 # view plot

</code></pre>

<hr>
<h2 id='rvn_annual_volume'>Annual Volume Comparison</h2><span id='topic+rvn_annual_volume'></span>

<h3>Description</h3>

<p>Creates a plot of the annual observed and simulated volumes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_annual_volume(
  sim,
  obs,
  mm = 9,
  dd = 30,
  add_line = TRUE,
  add_r2 = FALSE,
  add_eqn = FALSE,
  add_labels = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_annual_volume_+3A_sim">sim</code></td>
<td>
<p>time series object of simulated flows</p>
</td></tr>
<tr><td><code id="rvn_annual_volume_+3A_obs">obs</code></td>
<td>
<p>time series object of observed flows</p>
</td></tr>
<tr><td><code id="rvn_annual_volume_+3A_mm">mm</code></td>
<td>
<p>month of water year ending (default 9)</p>
</td></tr>
<tr><td><code id="rvn_annual_volume_+3A_dd">dd</code></td>
<td>
<p>day of water year ending (default 30)</p>
</td></tr>
<tr><td><code id="rvn_annual_volume_+3A_add_line">add_line</code></td>
<td>
<p>optionally adds a 1:1 line to the plot for reference (default <code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="rvn_annual_volume_+3A_add_r2">add_r2</code></td>
<td>
<p>optionally computes the R2 and adds to plot (default <code>FALSE</code>)</p>
</td></tr>
<tr><td><code id="rvn_annual_volume_+3A_add_eqn">add_eqn</code></td>
<td>
<p>optionally adds the equation for a linear regression line through the origin (default <code>FALSE</code>)</p>
</td></tr>
<tr><td><code id="rvn_annual_volume_+3A_add_labels">add_labels</code></td>
<td>
<p>optionally adds year-ending labels to each point on plot using geom_text (default <code>FALSE</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Creates a scatterplot of the annual observed and simulated
volumes, calculated for each available water year of data within the two series provided.
The sim and obs should be of time
series (xts) format and are assumed to be of the same length and time
period. Note that missing values in the observed series will impact the
volume estimation, and it is recommended that the NA values are filled in
prior to use of this function.
</p>
<p>The R2 diagnostic is calculated for a fit with no intercept (in a perfect
fit the points are identical, and intercept is automatically zero).
</p>
<p>Note that a plot title is purposely omitted in order to allow the automatic
generation of plot titles.
</p>


<h3>Value</h3>

<p>returns a list with annual volume data in a data frame, and a ggplot object
</p>
<table>
<tr><td><code>df_volume</code></td>
<td>
<p>data frame of the calculated annual volumes</p>
</td></tr>
<tr><td><code>p1</code></td>
<td>
<p>ggplot object with plotted annual volumes</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_flow_scatterplot">rvn_flow_scatterplot</a></code> to create a scatterplot of flow
values
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# load sample hydrograph data, two years worth of sim/obs
data(rvn_hydrograph_data)
sim &lt;- rvn_hydrograph_data$hyd$Sub36
obs &lt;- rvn_hydrograph_data$hyd$Sub36_obs

# create a plot of the annual volumes with defaults
rvn_annual_volume(sim,obs)

# create a plot of the annual volumes with r2
rvn_annual_volume(sim,obs,add_r2=TRUE, add_eqn=TRUE)

# create a plot of the annual volumes with year-ending labels
rvn_annual_volume(sim,obs, add_labels=TRUE)

# calculate annual volumes for different water years (e.g. ending Oct 31)
vv &lt;- rvn_annual_volume(sim, obs, mm=10, dd=31)
vv$df.volume
vv$p1

</code></pre>

<hr>
<h2 id='rvn_apply_wyearly'>Apply function for water year</h2><span id='topic+rvn_apply_wyearly'></span>

<h3>Description</h3>

<p>rvn_apply_wyearly calculates a function FUN for the periods defined by the water
year, similar to other functions of the form apply.&lt;time period&gt;, for
example apply.daily, apply.monthly, etc.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_apply_wyearly(x, FUN, ..., mm = 9, dd = 30)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_apply_wyearly_+3A_x">x</code></td>
<td>
<p>xts vector to calculate FUN for</p>
</td></tr>
<tr><td><code id="rvn_apply_wyearly_+3A_fun">FUN</code></td>
<td>
<p>the function to be applied</p>
</td></tr>
<tr><td><code id="rvn_apply_wyearly_+3A_...">...</code></td>
<td>
<p>optional arguments to FUN</p>
</td></tr>
<tr><td><code id="rvn_apply_wyearly_+3A_mm">mm</code></td>
<td>
<p>month of water year ending (default 9)</p>
</td></tr>
<tr><td><code id="rvn_apply_wyearly_+3A_dd">dd</code></td>
<td>
<p>day of water year ending (default 30)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The default water year start is
October 1st, but may be adjusted with the mm and dd arguments. The values for
mm and dd indicate the end of the water year period (i.e. mm=9 and dd=30 indicates
a new water year on Oct 1).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_wyear_indices">rvn_wyear_indices</a></code> for obtaining endpoints in the water year
</p>


<h3>Examples</h3>

<pre><code class='language-R'># use sample forcing data (or use forcings_read to read in ForcingFunctions.csv)
data(rvn_forcing_data)

# apply mean as FUN to daily average temperature
rvn_apply_wyearly(rvn_forcing_data$forcings$temp_daily_ave,mean,na.rm=TRUE)

# apply mean as FUN to all forcings
rvn_apply_wyearly(rvn_forcing_data$forcings,mean,na.rm=TRUE)

# apply maximum via RavenR::cmax as FUN to all forcings (takes the max in each column)
## note that the base::max will not work properly here
rvn_apply_wyearly(rvn_forcing_data$forcings,cmax,na.rm=TRUE)

# apply to Australian water year (July 1)
rvn_apply_wyearly(rvn_forcing_data$forcings,cmax,na.rm=TRUE, mm=6, dd=30)

</code></pre>

<hr>
<h2 id='rvn_apply_wyearly_which_max_xts'>which.max over water year periods</h2><span id='topic+rvn_apply_wyearly_which_max_xts'></span>

<h3>Description</h3>

<p>Applies the which.max function within each
water year period, and returns the corresponding max values and dates in an xts format.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_apply_wyearly_which_max_xts(x, mm = 9, dd = 30)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_apply_wyearly_which_max_xts_+3A_x">x</code></td>
<td>
<p>xts object</p>
</td></tr>
<tr><td><code id="rvn_apply_wyearly_which_max_xts_+3A_mm">mm</code></td>
<td>
<p>month of water year ending (default 9)</p>
</td></tr>
<tr><td><code id="rvn_apply_wyearly_which_max_xts_+3A_dd">dd</code></td>
<td>
<p>day of water year (default 30)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>xts object with max values and corresponding dates
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(rvn_hydrograph_data)

# obtain peak observed flows in each water year period
rvn_apply_wyearly_which_max_xts(rvn_hydrograph_data$hyd$Sub43_obs)

# will return a warning with no result if multiple columns supplied
rvn_apply_wyearly_which_max_xts(rvn_hydrograph_data$hyd)

</code></pre>

<hr>
<h2 id='rvn_budyko_plot'>Budkyo Plot</h2><span id='topic+rvn_budyko_plot'></span>

<h3>Description</h3>

<p>rvn_budyko_plot creates a Budyko plot, adding supplied data points if provided.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_budyko_plot(
  x = NULL,
  x_indices = NULL,
  limiting_labels = FALSE,
  budyko_curve = FALSE,
  mm = 9,
  dd = 30
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_budyko_plot_+3A_x">x</code></td>
<td>
<p>extensible time series object of PET, AET, and PRECIP (optional)</p>
</td></tr>
<tr><td><code id="rvn_budyko_plot_+3A_x_indices">x_indices</code></td>
<td>
<p>extensible time series object of annual ARIDITY and EVAPORATION indices (optional)</p>
</td></tr>
<tr><td><code id="rvn_budyko_plot_+3A_limiting_labels">limiting_labels</code></td>
<td>
<p>boolean whether to vertical line at x=1 and labels for 'Energy Limited' and 'Water Limited' to plot</p>
</td></tr>
<tr><td><code id="rvn_budyko_plot_+3A_budyko_curve">budyko_curve</code></td>
<td>
<p>boolean whether to add curve to plot</p>
</td></tr>
<tr><td><code id="rvn_budyko_plot_+3A_mm">mm</code></td>
<td>
<p>month of water year ending (default 9)</p>
</td></tr>
<tr><td><code id="rvn_budyko_plot_+3A_dd">dd</code></td>
<td>
<p>day of water year ending (default 30)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Creates a blank Budyko curve plot if no data is provided. Labels may optionally
be added to the plot with <code>limiting_labels=TRUE</code> to indicate where in the
curve the energy-limited and water-limited limits are. The original Budyko curve
may also be added with <code>budyko_curve=TRUE</code>.
</p>
<p>Data may be provided and plotted in the graph as well. If data is provided, it can be provided as:
- x: an xts object with PRECIP, AET, and PET columns
- x_indices: an xts object with indices calculated for each year, columns named ARIDITY and EVAPORATIVE
</p>


<h3>Value</h3>

<table>
<tr><td><code>p1</code></td>
<td>
<p>returns Budyko plot as ggplot object</p>
</td></tr>
</table>


<h3>References</h3>

<p>Budyko, M.I. (1974), Climate and Life, Academic Press, New York.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_watershedmeb_read">rvn_watershedmeb_read</a></code> for reading in the WatershedMassEnergyBalance.csv file, and
<code><a href="#topic+rvn_apply_wyearly">rvn_apply_wyearly</a></code> to apply functions over the water year.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# return blank Budyko plot
rvn_budyko_plot()

# return blank plot with labels and curve added
rvn_budyko_plot(limiting_labels=TRUE, budyko_curve=TRUE)

# plot sample data on Budyko plot (two years of data)
wstor &lt;- system.file("extdata","run1_WatershedStorage.csv", package="RavenR") %&gt;%
           rvn_watershed_read()
ff &lt;- system.file("extdata","run1_ForcingFunctions.csv", package="RavenR") %&gt;%
           rvn_forcings_read()

library(xts)
precip &lt;- ff$forcings$rain+ff$forcings$snow
pet &lt;- ff$forcings$PET
aet &lt;- diff.xts(x=wstor$watershed_storage$Cum..Losses.to.Atmosphere..mm.,
          k=1, na.pad=TRUE)
aet[1] &lt;- 0

x &lt;- merge.xts(precip,pet,aet)
names(x) &lt;- c("precip","pet","aet")
rvn_budyko_plot(x=x, budyko_curve=TRUE)

</code></pre>

<hr>
<h2 id='rvn_calc_runoff_coeff'>Generate runoff coefficients upstream of gauges</h2><span id='topic+rvn_calc_runoff_coeff'></span>

<h3>Description</h3>

<p>Uses the rvh, custom precipitation, and hydrograph information to determine runoff coefficients.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_calc_runoff_coeff(
  rvhfile,
  custfile = "PRECIP_Daily_Average_BySubbasin.csv",
  hydfile = "Hydrographs.csv",
  correct = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_calc_runoff_coeff_+3A_rvhfile">rvhfile</code></td>
<td>
<p>file path to Raven rvh file</p>
</td></tr>
<tr><td><code id="rvn_calc_runoff_coeff_+3A_custfile">custfile</code></td>
<td>
<p>file path to Raven-generated custom output precip-by-subbasin file</p>
</td></tr>
<tr><td><code id="rvn_calc_runoff_coeff_+3A_hydfile">hydfile</code></td>
<td>
<p>file path to Raven-generated hydrographs file</p>
</td></tr>
<tr><td><code id="rvn_calc_runoff_coeff_+3A_correct">correct</code></td>
<td>
<p>(optional) if <code>TRUE</code>, tries to correct runoff coefficient for missing data (assumes missing~0 flow)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Reads model.rvh file and daily avg subbasin precip file (usually PRECIP_Daily_Average_BySubbasin.csv)
and generates data frame describing runoff coefficients of gauged basins and observation data coverage.
Uses precipitation from entire model run history.
Only determines runoff coefficient from available data - prone to overestimation with poor observation coverage.
</p>


<h3>Value</h3>

<p>data frame with runoff coefficients of gauged basins
</p>


<h3>Author(s)</h3>

<p>James R. Craig, University of Waterloo
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_rvh_read">rvn_rvh_read</a></code> for reading and processing Raven rvh file
</p>


<h3>Examples</h3>

<pre><code class='language-R'> myrvh &lt;- system.file("extdata","Nith.rvh", package="RavenR")
 mycust &lt;- system.file("extdata", "run1_PRECIP_Daily_Average_BySubbasin.csv", package="RavenR")
 myhyd &lt;- system.file("extdata", "run1_Hydrographs.csv", package="RavenR")

 rcs &lt;- rvn_calc_runoff_coeff(myrvh, mycust, myhyd, correct=TRUE)
 rcs

 # create a bar plot
 runcoefs &lt;- subset(rcs,select=c(runoff_coeff_sim,runoff_coeff_obs))

 bp &lt;- barplot(t(as.matrix(runcoefs)),
  main="Runoff Coefficient Comparison (w/ rough data coverage correction)",
  ylab = "Runoff coeff", ylim=c(0,1),beside=TRUE,
  col=c("blue","deepskyblue"),legend.text=c("sim","obs"),las=2)

</code></pre>

<hr>
<h2 id='rvn_cum_plot_flow'>Cumulative Plot of model flows</h2><span id='topic+rvn_cum_plot_flow'></span>

<h3>Description</h3>

<p>rvn_cum_plot_flow creates a cumulative flow plot of the simulated flows;
optionally includes an observed and/or inflow series as well. Useful in
diagnotic analysis of model outputs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_cum_plot_flow(sim = NULL, obs = NULL, inflow = NULL, mm = 9, dd = 30)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_cum_plot_flow_+3A_sim">sim</code></td>
<td>
<p>time series object of simulated flows</p>
</td></tr>
<tr><td><code id="rvn_cum_plot_flow_+3A_obs">obs</code></td>
<td>
<p>optionally supply an inflow series to plot as well</p>
</td></tr>
<tr><td><code id="rvn_cum_plot_flow_+3A_inflow">inflow</code></td>
<td>
<p>optionally supply an inflow series to plot as well</p>
</td></tr>
<tr><td><code id="rvn_cum_plot_flow_+3A_mm">mm</code></td>
<td>
<p>month of water year ending (default 9)</p>
</td></tr>
<tr><td><code id="rvn_cum_plot_flow_+3A_dd">dd</code></td>
<td>
<p>day of water year ending (default 30)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Plots the simulated series in all cases, and will include
the observed and inflow plots if they are supplied.
</p>
<p>The sim and obs should be of time series (xts) format. The flow series are
assumed to be daily flows with units of m3/s.
</p>
<p>Note that a plot title is purposely omitted in order to allow the automatic
generation of plot titles.
</p>
<p>Note that the cumsum function does not have an na.rm=T argument, thus if
there are any NA values in the water year of data for any provided series,
the values beyond an NA value will be calculated as NA. It is up to the user
to handle NA values appropriately fill in or replace NA values based on the
type of data supplied. For flow series, linear interpolation for small periods
of missing values may be appropriate.
</p>


<h3>Value</h3>

<table>
<tr><td><code>TRUE</code></td>
<td>
<p>return <code>TRUE</code> if the function is executed properly</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_flow_scatterplot">rvn_flow_scatterplot</a></code> for creating flow scatterplots
</p>
<p><code><a href="#topic+rvn_cum_plot_flow">rvn_cum_plot_flow</a></code> for creating generic cumulative function plotting
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# load sample hydrograph data, two years worth of sim/obs
data(rvn_hydrograph_data)
sim &lt;- rvn_hydrograph_data$hyd$Sub36
obs &lt;- rvn_hydrograph_data$hyd$Sub36_obs

# plot cumulative flow for sim and obs
rvn_cum_plot_flow(sim,obs)

# plot cumulative flows for specific period
prd &lt;- "2003-10-01/2004-10-01"
rvn_cum_plot_flow(sim[prd],obs[prd])

</code></pre>

<hr>
<h2 id='rvn_custom_data'>Custom Output Data from Raven</h2><span id='topic+rvn_custom_data'></span>

<h3>Description</h3>

<p>A dataset formatted to the xts package, read in by the <code><a href="#topic+rvn_custom_read">rvn_custom_read</a></code> function.
The dataset contains average SNOW for each HRU in the Nith river model, available
for download in the Raven Tutorials (linked below).
</p>
<p>Note that this data set cannot be used with <code><a href="#topic+rvn_custom_output_plot">rvn_custom_output_plot</a></code> as the file name
information is not available in this data format. Please refer to the example in the plotting function
to use the sample data file directly, which includes the filename information.
</p>
<p>The Nith River model can be downloaded from the Raven Tutorials (tutorial #2)
<a href="http://www.civil.uwaterloo.ca/jrcraig/Raven/Downloads.html">http://www.civil.uwaterloo.ca/jrcraig/Raven/Downloads.html</a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_custom_data
</code></pre>


<h3>Format</h3>

<p>A data frame with 730 rows, containg data for 32 HRUs from 2002-10-01 to 2004-09-29
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_custom_read">rvn_custom_read</a></code> for reading in custom output files
</p>
<p><code><a href="#topic+rvn_custom_output_plot">rvn_custom_output_plot</a></code> for plotting custom output
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Preview data
head(rvn_custom_data)

</code></pre>

<hr>
<h2 id='rvn_custom_output_plot'>Plot Raven Custom Output</h2><span id='topic+rvn_custom_output_plot'></span>

<h3>Description</h3>

<p>rvn_custom_output_plot is used to plot the custom output from Raven
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_custom_output_plot(cust, IDs = NULL, prd = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_custom_output_plot_+3A_cust">cust</code></td>
<td>
<p>custom output object from custom.read</p>
</td></tr>
<tr><td><code id="rvn_custom_output_plot_+3A_ids">IDs</code></td>
<td>
<p>(optional) array of HRU IDs, subbasin IDs, HRU Group names/IDs to
include in plots</p>
</td></tr>
<tr><td><code id="rvn_custom_output_plot_+3A_prd">prd</code></td>
<td>
<p>(optional) period to use in plotting</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The custom output should be first read in using the rvn_custom_read function. Note that in this case the
plot title is included, generated from the information in the filename. This plot title may be changed with
ggplot2 commands.
</p>


<h3>Value</h3>

<table>
<tr><td><code>TRUE</code></td>
<td>
<p>return <code>TRUE</code> if the function is executed properly</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_custom_output_plot">rvn_custom_output_plot</a></code> for plotting custom output
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# read in custom output from sample data
ff &lt;- system.file("extdata/run1_SNOW_Daily_Average_ByHRU.csv", package="RavenR")
mycustomdata &lt;- rvn_custom_read(ff)

# plot custom data (first 10 HRUs)
rvn_custom_output_plot(mycustomdata, IDs=seq(1,10), prd="2002-10-01/2003-06-01")

</code></pre>

<hr>
<h2 id='rvn_custom_read'>Read Raven Custom Output files</h2><span id='topic+rvn_custom_read'></span>

<h3>Description</h3>

<p>rvn_custom_read is used to read any Raven custom output file
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_custom_read(ff = NA, no_runname = FALSE, tzone = "UTC")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_custom_read_+3A_ff">ff</code></td>
<td>
<p>full file path to the custom output file</p>
</td></tr>
<tr><td><code id="rvn_custom_read_+3A_no_runname">no_runname</code></td>
<td>
<p>boolean for whether a runName is supplied, important for
parsing the filename</p>
</td></tr>
<tr><td><code id="rvn_custom_read_+3A_tzone">tzone</code></td>
<td>
<p>string indicating the timezone of the data in ff</p>
</td></tr>
</table>


<h3>Details</h3>

<p>rvn_custom_read parses the filename and predicts the file format accordingly, so
it is important to use the unmodified file names for this function. The use
(or not) of a runname is accounted for.
</p>
<p>The returned object is a time series object (xts format), which can be used
to easily plot the time series data. The otpions of the custom output are
included in the rav.obj attributes.
</p>
<p>The timezone is provided by the tzone argument as &quot;UTC&quot; by default, and should be adjusted by
the user to the local time zone as needed, based on the model run.
</p>


<h3>Value</h3>

<table>
<tr><td><code>custom_out</code></td>
<td>
<p>data frame with the custom output data stored as xts
object</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_custom_output_plot">rvn_custom_output_plot</a></code> for plotting custom output
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# find sample rvh file for Nith subwatershed
ff &lt;- system.file("extdata","run1_SNOW_Daily_Average_ByHRU.csv", package="RavenR")

# extract and plot custom data
mycustomdata &lt;- rvn_custom_read(ff)
summary(mycustomdata[,1:5])
plot(mycustomdata[,5],main='Daily Average SNOW - HRU 5')

</code></pre>

<hr>
<h2 id='rvn_df_to_Raven_table'>Sets up tables for writing to Raven input files</h2><span id='topic+rvn_df_to_Raven_table'></span>

<h3>Description</h3>

<p>Sets up tables for writing to Raven input files
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_df_to_Raven_table(attributes, units, df, id_col = TRUE, parameters = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_df_to_Raven_table_+3A_attributes">attributes</code></td>
<td>
<p>array of strings containing attribute/parameter names</p>
</td></tr>
<tr><td><code id="rvn_df_to_Raven_table_+3A_units">units</code></td>
<td>
<p>array of strings with the corresponding units</p>
</td></tr>
<tr><td><code id="rvn_df_to_Raven_table_+3A_df">df</code></td>
<td>
<p>data frame of values corresponding to attributes/parameters</p>
</td></tr>
<tr><td><code id="rvn_df_to_Raven_table_+3A_id_col">id_col</code></td>
<td>
<p>True/False of whether an numeric id column is the first column in the table
and, in common Raven fashion, does not have a corresponding attribute (default: True)</p>
</td></tr>
<tr><td><code id="rvn_df_to_Raven_table_+3A_parameters">parameters</code></td>
<td>
<p>bool, when adding attribues/parameter tag, should ':Parameters' be used instead of ':Attributes'?</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>outdf</code></td>
<td>
<p>data.frame object</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Leland Scantlebury, <a href="mailto:leland@scantle.com">leland@scantle.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>soil_classes &lt;- data.frame('Attributes' = c('DEFAULT','ALTERNATIVE'),
                           'SAND'      = c(0.4316, 0.3000),
                           'CLAY'      = c(0.1684, 0.4000),
                           'SILT'      = c(0.4000, 0.3000),
                           'ORGANIC'   = c(0.0000, 0.0000))
attributes &lt;- c('%SAND','%CLAY','%SILT','%ORGANIC')
units &lt;-  rep('none',4)
soil_classes &lt;- rvn_df_to_Raven_table(attributes, units, soil_classes)
print(soil_classes)

</code></pre>

<hr>
<h2 id='rvn_dist_lonlat'>Calculate distance from long/lat</h2><span id='topic+rvn_dist_lonlat'></span>

<h3>Description</h3>

<p>Calculates distance between points based on a set of long/lat coordinates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_dist_lonlat(p1, p2, method = "haversine", r = 6378137)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_dist_lonlat_+3A_p1">p1</code></td>
<td>
<p>longitude/latitude of point(s); can be a vector of two numbers, or a matrix of 2 columns (long/lat).</p>
</td></tr>
<tr><td><code id="rvn_dist_lonlat_+3A_p2">p2</code></td>
<td>
<p>second point in same format as <code>p1</code></p>
</td></tr>
<tr><td><code id="rvn_dist_lonlat_+3A_method">method</code></td>
<td>
<p>calculation method as either <code>haversine</code> (default) or vincentysphere</p>
</td></tr>
<tr><td><code id="rvn_dist_lonlat_+3A_r">r</code></td>
<td>
<p>radius of the Earth in metres (default 6378137)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Calculates distance in metres based on the longitude and latitude of two or more sets of points.
</p>
<p>The function uses either the Haversine or Vincenty Sphere methods to calculate the distances.
</p>


<h3>Value</h3>

<p>a vector of calculated distances (length of vector based on input)
</p>


<h3>Note</h3>

<p>Function is based on modifications from the <a href="https://cran.r-project.org/package=geosphere">geosphere package</a>
scripts for <code>distHaversine</code> and <code>distVincentySphere</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># calculate distance from Engineering 2 (p1) to Graduate House (p2) at the University of Waterloo
p1 &lt;- c(-80.5402891965711,43.47088594350457)
p2 &lt;- c(-80.54096577853629,43.46976096704924)
rvn_dist_lonlat(p1, p2)

# distance from University of Waterloo to Windsor
p2 &lt;- c(-83.02099905916948,42.283371378771555)
rvn_dist_lonlat(p1, p2)

</code></pre>

<hr>
<h2 id='rvn_download'>Downloads Raven</h2><span id='topic+rvn_download'></span>

<h3>Description</h3>

<p>Downloads Raven executable from the <a href="http://raven.uwaterloo.ca/Downloads.html">Raven webpage</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_download(version = NA, NetCDF = FALSE, check = FALSE, copy_path = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_download_+3A_version">version</code></td>
<td>
<p>(optional) Character: The version of Raven to be downloaded. If not provided, the latest version will be downloaded.</p>
</td></tr>
<tr><td><code id="rvn_download_+3A_netcdf">NetCDF</code></td>
<td>
<p>(logical) whether to download the NetCDF-enabled version of Raven (default <code>FALSE</code>)</p>
</td></tr>
<tr><td><code id="rvn_download_+3A_check">check</code></td>
<td>
<p>(logical) if <code>TRUE</code>, function will only check whether 'Raven.exe' has been downloaded to the RavenR folder</p>
</td></tr>
<tr><td><code id="rvn_download_+3A_copy_path">copy_path</code></td>
<td>
<p>(character) path to an existing 'Raven.exe' file. If provided, this file will be copied to the appropriate folder and the download will be skipped.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Files are downloaded from the Raven webpage (<a href="http://raven.uwaterloo.ca/Downloads.html">http://raven.uwaterloo.ca/Downloads.html</a>) and placed
in a temporary directory while the executable is extracted. This helps prevent any unwanted files being
saved on your system outside of temporary directories if the function is interrupted. The executable is placed in the
RavenR/extdata directory, wherever RavenR is installed on your system.
</p>
<p>Note that if you are not on a Windows operating system, you may need to compile Raven for your system rather than
</p>
<p>Any existing Raven.exe file in your RavenR/extdata folder will be overwritten with a newly downloaded executable w
with this function.
</p>
<p>The 'copy_path' argument may be useful for non-Windows users that are not able to use the pre-compiled Raven downloads.
If the path to an existing Raven.exe file (i.e. one compiled locally) is provided, this will copy the specified file to the
appropriate location and skip the download, which will allow the user to use the locally compiled Raven.exe with the 'rvn_run'
function.
</p>
<p>Reinstalling the RavenR package removes the previous files in the RavenR/ folder on your system, so this command
will need to be re-run if RavenR is re-installed.
</p>
<p>Once downloaded, the Raven.exe file can be found with <code>system.file("extdata", "Raven.exe", package="RavenR")</code>
</p>


<h3>Value</h3>

<p>Returns <code>TRUE</code> if executed successfully
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_run">rvn_run</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# check if Raven.exe has previously been downloaded
rvn_download(check=TRUE)

## Not run: 
## NOT RUN (downloads executable)

# download latest without netcdf support
rvn_download()

# download specific version with netcdf support
rvn_download(version="3.0.4",NetCDF=TRUE)

# find file path to Raven.exe
system.file("extdata", "Raven.exe", package="RavenR")

## End(Not run)

</code></pre>

<hr>
<h2 id='rvn_exhaustive_mb_read'>Read in Raven Exhaustive Mass Balance file</h2><span id='topic+rvn_exhaustive_mb_read'></span>

<h3>Description</h3>

<p>rvn_exhaustive_mb_read is used to read in the ExhaustiveMassBalance.csv file produced by
the modelling Framework Raven.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_exhaustive_mb_read(ff = NA, join_categories = TRUE, tzone = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_exhaustive_mb_read_+3A_ff">ff</code></td>
<td>
<p>full file path to the ExhaustiveMassBalance.csv file</p>
</td></tr>
<tr><td><code id="rvn_exhaustive_mb_read_+3A_join_categories">join_categories</code></td>
<td>
<p>boolean whether add to the category tag as a column
name prefix in exhaustivemb output (default <code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="rvn_exhaustive_mb_read_+3A_tzone">tzone</code></td>
<td>
<p>string indicating the timezone of the data in ff</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Expects a full file path to the ExhaustiveMassBalance.csv file,
then reads in the file using read.csv. The main advantage of this function is
renaming the columns to nicer names and extracting the units into something
that is much easier to read.
</p>
<p>ff is the full file path of the ExhaustiveMassBalance.csv file. If the file is
located in the current working directory, then simply the name of the file
is sufficient.
</p>
<p>tzone is a string indicating the timezone of the supplied file. The
timezone provided is coded into the resulting data frame using the as.POSIXct
function. If no timezone is provided, this is left as an empty string, and is
determined by the function as the current time zone.
</p>


<h3>Value</h3>

<table>
<tr><td><code>exhaustivemb</code></td>
<td>
<p>data frame from the file with standardized
names</p>
</td></tr> <tr><td><code>units</code></td>
<td>
<p>vector corresponding to units of each column</p>
</td></tr>
<tr><td><code>categories</code></td>
<td>
<p>vector corresponding to the storage category of each column</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_hyd_read">rvn_hyd_read</a></code> for reading in the Hydrographs.csv file, and
<code><a href="#topic+rvn_exhaustive_mb_read">rvn_exhaustive_mb_read</a></code> for reading in the
WatershedMassEnergyBalance.csv file
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Read in exhaustive MB file, create plot
ff &lt;- system.file("extdata","run1_ExhaustiveMassBalance.csv", package="RavenR")
embd &lt;- rvn_exhaustive_mb_read(ff)

# Preview data
head(embd$exhaustive_mb)

# Plot data
plot(embd$exhaustive_mb$SURFACE_WATER.Infiltration,
     main="Cumulative Surface Water Infiltration")
</code></pre>

<hr>
<h2 id='rvn_fdc_plot'>Plots summary of watershed forcing functions</h2><span id='topic+rvn_fdc_plot'></span>

<h3>Description</h3>

<p>rvn_fdc_plot generation a flow duration curve plot.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_fdc_plot(sim = NULL, obs = NULL, prd = NULL, seasonal = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_fdc_plot_+3A_sim">sim</code></td>
<td>
<p>simulated hydrograph xts time series</p>
</td></tr>
<tr><td><code id="rvn_fdc_plot_+3A_obs">obs</code></td>
<td>
<p>(optional) observed hydrograph xts time series</p>
</td></tr>
<tr><td><code id="rvn_fdc_plot_+3A_prd">prd</code></td>
<td>
<p>(optional) time period over which the plot is generated</p>
</td></tr>
<tr><td><code id="rvn_fdc_plot_+3A_seasonal">seasonal</code></td>
<td>
<p>(optional) boolean whether to add the winter and summer FDC</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Creates a flow duration curve using the rvn_hyd_extract obejct for
a given basin. The hydrograph object passed should be the output from the
rvn_hyd_extract function, which has attributes for sim and obs; if the obs is
NULL, only the sim FDC will be plotted.
</p>
<p>If the seasonal argument is included, the winter and summer FDC lines will
be included on the plot as well.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_hyd_read">rvn_hyd_read</a></code> for reading in the Hydrographs.csv file, and
<code><a href="#topic+rvn_hyd_extract">rvn_hyd_extract</a></code> for extracting basin flow information from a
rvn_hyd_read object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# load sample hydrograph data, two years worth of sim/obs
ff &lt;- system.file("extdata/run1_Hydrographs.csv", package="RavenR")
run1 &lt;- rvn_hyd_read(ff)
sim &lt;- run1$hyd$Sub36
obs &lt;- run1$hyd$Sub36_obs

# create FDC plot, sim only
rvn_fdc_plot(sim)

 # create seasonal FDC plot with sim and obs data
rvn_fdc_plot(sim,obs,seasonal=TRUE)

</code></pre>

<hr>
<h2 id='rvn_flow_residuals'>Residuals of model flows</h2><span id='topic+rvn_flow_residuals'></span>

<h3>Description</h3>

<p>rvn_flow_residuals creates a residuals time series for flow values. Useful in
diagnotic analysis of model outputs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_flow_residuals(
  sim = NULL,
  obs = NULL,
  ma_smooth = 3,
  add_line = FALSE,
  winter_shading = FALSE,
  wsdates = c(12, 1, 3, 31)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_flow_residuals_+3A_sim">sim</code></td>
<td>
<p>time series object of simulated flows</p>
</td></tr>
<tr><td><code id="rvn_flow_residuals_+3A_obs">obs</code></td>
<td>
<p>time series object of observed flows</p>
</td></tr>
<tr><td><code id="rvn_flow_residuals_+3A_ma_smooth">ma_smooth</code></td>
<td>
<p>optional length of rolling average to smooth residuals with
(default 3)</p>
</td></tr>
<tr><td><code id="rvn_flow_residuals_+3A_add_line">add_line</code></td>
<td>
<p>optionally adds a horizontal line to the plot for reference
(default <code>FALSE</code>)</p>
</td></tr>
<tr><td><code id="rvn_flow_residuals_+3A_winter_shading">winter_shading</code></td>
<td>
<p>optionally adds a light blue shading to winter months
(default <code>FALSE</code>)</p>
</td></tr>
<tr><td><code id="rvn_flow_residuals_+3A_wsdates">wsdates</code></td>
<td>
<p>integer vector of winter shading period dates (see details)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Creates a residuals time series plot for flow values, with the
option to smooth out the values using the rollmean function in zoo. The
winter months are optionally shaded in the time series; winter period is
defined as December 1st to March 31st.
</p>
<p>The residuals are calculated as sim - obs.
</p>
<p>The sim and obs should be of time series (xts) format. The flow series are
assumed to be daily flows with units of m3/s.
</p>
<p>Note that a plot title is purposely omitted in order to allow the automatic
generation of plot titles.
</p>
<p>The winter_shading argument will add a transparent grey shading for the
specified period by wsdates in each year that is plotted.
</p>
<p>wsdates is formatted as c(winter start month, winter start day, winter end month, winter end day).
</p>


<h3>Value</h3>

<table>
<tr><td><code>resids</code></td>
<td>
<p>residual time series</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_flow_scatterplot">rvn_flow_scatterplot</a></code> to create a scatterplot of flow
values
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# load sample hydrograph data, two years worth of sim/obs
ff &lt;- system.file("extdata/run1_Hydrographs.csv", package="RavenR")
run1 &lt;- rvn_hyd_read(ff)
sim &lt;- run1$hyd$Sub36
obs &lt;- run1$hyd$Sub36_obs

# default with moving average smoothing shading of winter months
rvn_flow_residuals(sim,obs)$plot

# plot with more smoothing than the default 3
rvn_flow_residuals(sim, obs, ma_smooth=10)$plot

# with zero line and winter shading
rvn_flow_residuals(sim,obs, add_line=TRUE, winter_shading = TRUE)$plot

# change winter shading to Nov 1 - April 30
rvn_flow_residuals(sim,obs, add_line=TRUE,
  winter_shading = TRUE, wsdates=c(11,1,4,30))$plot

</code></pre>

<hr>
<h2 id='rvn_flow_scatterplot'>Scatterplot of model flows</h2><span id='topic+rvn_flow_scatterplot'></span>

<h3>Description</h3>

<p>rvn_flow_scatterplot creates a scatterplot of the simulated and observed flows.
Useful in diagnotic analysis of model outputs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_flow_scatterplot(
  sim,
  obs,
  add_line = TRUE,
  add_r2 = FALSE,
  add_eqn = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_flow_scatterplot_+3A_sim">sim</code></td>
<td>
<p>time series object of simulated flows</p>
</td></tr>
<tr><td><code id="rvn_flow_scatterplot_+3A_obs">obs</code></td>
<td>
<p>time series object of observed flows</p>
</td></tr>
<tr><td><code id="rvn_flow_scatterplot_+3A_add_line">add_line</code></td>
<td>
<p>optionally adds a 1:1 line to the plot for reference (default <code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="rvn_flow_scatterplot_+3A_add_r2">add_r2</code></td>
<td>
<p>optionally computes the R2 and adds to plot (default <code>FALSE</code>)</p>
</td></tr>
<tr><td><code id="rvn_flow_scatterplot_+3A_add_eqn">add_eqn</code></td>
<td>
<p>optionally adds the equation for a linear regression line (default <code>FALSE</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Creates a scatterplot of flows.
</p>
<p>The sim and obs should be of time series (xts) format. The flow series are
assumed to be daily flows with units of m3/s.
</p>
<p>The R2 diagnostic is calculated for a fit with no intercept (in a perfect
fit the points are identical, and intercept is automatically zero). The R2
is calculated with the NA values removed
</p>
<p>Note that a plot title is purposely omitted in order to allow the automatic
generation of plot titles.
</p>


<h3>Value</h3>

<table>
<tr><td><code>TRUE</code></td>
<td>
<p>return <code>TRUE</code> if the function is executed properly</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_forcings_read">rvn_forcings_read</a></code> for reading in the ForcingFunctions
file
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# load sample hydrograph data, two years worth of sim/obs
data(rvn_hydrograph_data)
sim &lt;- rvn_hydrograph_data$hyd$Sub36
obs &lt;- rvn_hydrograph_data$hyd$Sub36_ob

# plot the flow scatterplot, produce an R2 metric
rvn_flow_scatterplot(sim,obs,add_r2=TRUE)

# plot again with a regression equation
rvn_flow_scatterplot(sim,obs,add_r2=TRUE,add_eqn=TRUE)

</code></pre>

<hr>
<h2 id='rvn_flow_spaghetti'>Flow Spaghetti Plot</h2><span id='topic+rvn_flow_spaghetti'></span>

<h3>Description</h3>

<p>rvn_flow_spaghetti creates a spaghetti plot of the flow series provided.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_flow_spaghetti(flow)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_flow_spaghetti_+3A_flow">flow</code></td>
<td>
<p>time series object of simulated flows</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Creates a spaghetti plot of the annual flow series in each
year of data provided. The flows are plotted for each water year of data
available, set as October 1st.
</p>
<p>Note that the plotting to the day of year is approximate in order to
simplify the plotting of leap years and non-leap years. The years are
plotted including day 366 and starting on day 274, regardless of whether it
is a leap year or not. This is likely without consequence in seeing the
trends between water years, however the user is warned of this deficiency.
</p>
<p>The flow series provided should be of time series (xts) format.
</p>
<p>Note that a plot title is purposely omitted in order to allow the automatic
generation of plot titles.
</p>


<h3>Value</h3>

<table>
<tr><td><code>TRUE</code></td>
<td>
<p>return <code>TRUE</code> if the function is executed properly</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_flow_scatterplot">rvn_flow_scatterplot</a></code> to create a scatterplot of flow
values
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# load sample hydrograph data, two years worth of sim/obs
data(rvn_hydrograph_data)

# create spaghetti plot of simulated flows
rvn_flow_spaghetti(rvn_hydrograph_data$hyd$Sub36)

# create spaghetti plot of observed flows
rvn_flow_spaghetti(rvn_hydrograph_data$hyd$Sub36_obs)

</code></pre>

<hr>
<h2 id='rvn_forcing_data'>Forcings Data from Raven</h2><span id='topic+rvn_forcing_data'></span>

<h3>Description</h3>

<p>A dataset formatted to the xts package, read in by the forcings.read function.
The dataset contains the typical columns from the Raven outputted
ForcingFunctions.csv file, available for download in the Raven
Tutorials (linked below).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_forcing_data
</code></pre>


<h3>Format</h3>

<p>rvn_forcing_data is a data frame with two object
</p>

<dl>
<dt>forcings</dt><dd><p>various forcing functions and related output from Raven model</p>
</dd>
<dt>units</dt><dd><p>units associated with each variable in forcings</p>
</dd>
</dl>

<p>rvn_forcing_data$forcings is an xts (time series) object with 731 rows and
21 variables, containing data from 2002-10-01 to 2004-09-30. The details of
each forcing function can be found in the Raven Manual
</p>

<ul>
<li><p>day_angle
</p>
</li>
<li><p>rain
</p>
</li>
<li><p>snow
</p>
</li>
<li><p>temp
</p>
</li>
<li><p>temp_daily_min
</p>
</li>
<li><p>temp_daily_max
</p>
</li>
<li><p>temp_daily_ave
</p>
</li>
<li><p>temp_monthly_min
</p>
</li>
<li><p>temp_monthly_max
</p>
</li>
<li><p>air_dens
</p>
</li>
<li><p>air_pres
</p>
</li>
<li><p>rel_hum
</p>
</li>
<li><p>cloud_cover
</p>
</li>
<li><p>ET_radiation
</p>
</li>
<li><p>SW_radiation
</p>
</li>
<li><p>LW_radiation
</p>
</li>
<li><p>wind_vel
</p>
</li>
<li><p>PET
</p>
</li>
<li><p>OW_PET
</p>
</li>
<li><p>daily_correction
</p>
</li>
<li><p>potential_melt
</p>
</li></ul>

<p>The Nith River model can be downloaded from the Raven Tutorials (tutorial #2)
<a href="http://www.civil.uwaterloo.ca/jrcraig/Raven/Downloads.html">http://www.civil.uwaterloo.ca/jrcraig/Raven/Downloads.html</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_forcings_read">rvn_forcings_read</a></code> for reading in forcing functions output files
</p>
<p><code><a href="#topic+rvn_forcings_plot">rvn_forcings_plot</a></code> for plotting forcing functions in a convenient way
</p>

<hr>
<h2 id='rvn_forcings_plot'>Plots summary of watershed forcing functions</h2><span id='topic+rvn_forcings_plot'></span>

<h3>Description</h3>

<p>rvn_forcings_plot generates a set of 5 plots (precip,temperature,PET,radiation,
and potential melt), which summarize the watershed-averaged forcings. Returns a list with the individual plots.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_forcings_plot(forcings, prd = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_forcings_plot_+3A_forcings">forcings</code></td>
<td>
<p>forcings attribute from forcings.read function</p>
</td></tr>
<tr><td><code id="rvn_forcings_plot_+3A_prd">prd</code></td>
<td>
<p>(optional) time period over which the plots are generated</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Creates multiple plots from a ForcingFunctions.csv file
structure generating using RavenR's forcings.read function
</p>


<h3>Value</h3>

<p>forcing_plots list of ggplot objects of individual forcing plots and the combined plot
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_forcings_read">rvn_forcings_read</a></code> for the function used to read in the
forcings function data
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# read in sample forcings data
data("rvn_forcing_data")
fdata &lt;- rvn_forcing_data$forcings

# plot forcings data
p1 &lt;- rvn_forcings_plot(fdata)
p1$Precipitation
p1$AllForcings

# plot subset of forcing data for 2002-2003 water year
prd &lt;- "2002-10-01/2003-09-30"
rvn_forcings_plot(fdata,prd)$AllForcings

# add Legend back to plot (using ggplot2::theme)
library(ggplot2)
rvn_forcings_plot(fdata,prd)$Temperature+
theme(legend.position='top')

</code></pre>

<hr>
<h2 id='rvn_forcings_read'>Read in Raven ForcingFunctions file</h2><span id='topic+rvn_forcings_read'></span>

<h3>Description</h3>

<p>rvn_forcings_read is used to read in the ForcingFunctions.csv file produced by
the modelling Framework Raven.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_forcings_read(ff = NA, tzone = "UTC")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_forcings_read_+3A_ff">ff</code></td>
<td>
<p>full file path to the ForcingFunctions.csv file</p>
</td></tr>
<tr><td><code id="rvn_forcings_read_+3A_tzone">tzone</code></td>
<td>
<p>string indicating the timezone of the data in ff</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Expects a full file path to the ForcingFunctions.csv file,
then reads in the file using read.csv. The main advantage of this functon is
renaming the columns to nicer names and extracting the units into something
much easier to read.
</p>
<p>ff is the full file path of the ForcingFunctions.csv file. If the file is
located in the current working directory, then simply the name of the file
is sufficient.
</p>
<p>The timezone is provided by the tzone argument as &quot;UTC&quot; by default, and should be adjusted by
the user to the local time zone as needed, based on the model run.
</p>


<h3>Value</h3>

<table>
<tr><td><code>forcings</code></td>
<td>
<p>data frame from the file with standardized names</p>
</td></tr>
<tr><td><code>units</code></td>
<td>
<p>vector corresponding to units of each column</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_hyd_read">rvn_hyd_read</a></code> for reading in the Hydrographs.csv file
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# read in sample forcings data
ff &lt;- system.file("extdata","run1_ForcingFunctions.csv", package="RavenR")
myforcings &lt;- rvn_forcings_read(ff)

# check data (first 5 columns for brevity)
head(myforcings$forcings[,1:5])
summary(myforcings$forcings[,1:5])

</code></pre>

<hr>
<h2 id='rvn_fortify_xts'>Fortify xts object to specific format</h2><span id='topic+rvn_fortify_xts'></span>

<h3>Description</h3>

<p>Applies the fortify function to an xts object and updates the Index character
column to a date column called 'Date'.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_fortify_xts(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_fortify_xts_+3A_x">x</code></td>
<td>
<p>xts formatted object to fortify to tibble</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Useful in preparing data to plotting or other tidy-style analysis.
This function is used internally in many RavenR plotting functions.
</p>


<h3>Value</h3>

<p>tibble format of the xts data
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ff &lt;- system.file("extdata","run1_Hydrographs.csv", package="RavenR")
hyd &lt;- rvn_hyd_read(ff)$hyd
hyd_fortified &lt;- rvn_fortify_xts(hyd)
head(hyd_fortified)

</code></pre>

<hr>
<h2 id='rvn_gen_obsweights'>Create weights time series for calibration/diagnostic evaluation</h2><span id='topic+rvn_gen_obsweights'></span>

<h3>Description</h3>

<p>Creates an observation data weights time series based upon dates stored in
an xts time series and criterion given by the user
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_gen_obsweights(
  ts,
  criterion = "BETWEEN",
  startdate = "1785-10-05",
  enddate = "2500-01-01"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_gen_obsweights_+3A_ts">ts</code></td>
<td>
<p>xts time series</p>
</td></tr>
<tr><td><code id="rvn_gen_obsweights_+3A_criterion">criterion</code></td>
<td>
<p>criterion used to determine weighted vs. non-weighted dates
one of 'BEFORE', 'AFTER', 'BETWEEN', 'BETWEEN_CYCLIC'</p>
</td></tr>
<tr><td><code id="rvn_gen_obsweights_+3A_startdate">startdate</code></td>
<td>
<p>Date indicating start of time period (for 'BETWEEN' or
'AFTER' criterion) or start of annual cyclic period (for 'BETWEEN_CYCLIC'). In
the latter case, only the julian day of the startdate matters.</p>
</td></tr>
<tr><td><code id="rvn_gen_obsweights_+3A_enddate">enddate</code></td>
<td>
<p>Date indicating end of time period (for 'BETWEEN' or
'BEFORE' criterion) or end of annual cyclic period (for 'BETWEEN_CYCLIC'). In
the latter case, only the julian day of the enddate matters.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>for criterion ='BEFORE', all timestamps prior to the enddate have a
weight of 1, 0 otherwise <br />
for criterion ='AFTER', all timestamps after the startdate have a
weight of 1, 0 otherwise <br />
for criterion ='BETWEEN', all timestamps after the startdate and before
the enddate have a weight of 1, 0 otherwise <br />
for criterion ='BETWEEN_CYCLIC', all julian days after the startdate and before
the enddate have a weight of 1, 0 otherwise; if startdate is more than enddate,
then the opposite is true, e.g, for startdate=&quot;2002-11-01&quot; and enddate &quot;2002-01-31&quot;,
only November, December and January timestamps have a weight of 1
</p>


<h3>Value</h3>

<p>wtsreturns numeric vector of weights
</p>


<h3>Author(s)</h3>

<p>James R. Craig, University of Waterloo
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_rvt_write">rvn_rvt_write</a></code> to write the weights to an rvt file
</p>


<h3>Examples</h3>

<pre><code class='language-R'> # locate hydrograph sample csv data from RavenR package
 ff &lt;- system.file("extdata","run1_Hydrographs.csv", package="RavenR")

 # read in Raven Hydrographs file, store into mydata
 mydata &lt;- rvn_hyd_read(ff, tzone="EST")

 # generate rvt file using just observations from Subbasin ID 36
 flows &lt;- rvn_ts_infill(mydata$hyd$Sub36_obs)

 # weight March-October flows:
 wts &lt;- rvn_gen_obsweights(flows,criterion = "BETWEEN_CYCLIC",
   startdate="2000-03-01", enddate="2003-11-01")

 # and only after March 2003:
 wts2 &lt;- rvn_gen_obsweights(flows,criterion = "AFTER",
   startdate="2003-03-01")
 wts2 &lt;- wts2*wts # product merges weights

 # show weights over time
 plot(wts2)

</code></pre>

<hr>
<h2 id='rvn_get_prd'>Check period input</h2><span id='topic+rvn_get_prd'></span>

<h3>Description</h3>

<p>Checks a period argument either as
a character or against an xts object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_get_prd(x = NULL, prd = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_get_prd_+3A_x">x</code></td>
<td>
<p>xts object</p>
</td></tr>
<tr><td><code id="rvn_get_prd_+3A_prd">prd</code></td>
<td>
<p>period argument in format YYYY-MM-DD/YYYY-MM-DD as a character</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function may take some combination of an xts object, a character string or both.
</p>
<p>If a character is provided, the consistency of the character string against the YYYY-MM-DD/YYYY-MM-DD format
is checked. If an xts object is provided, the period for that xts object is returned. If both
are provided to the function, both checks are made and the consistency of the character period
against the xts object is performed. In any case, a period character string is returned.
</p>


<h3>Value</h3>

<p>prd argument with warnings provided if needed
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_theme_RavenR">rvn_theme_RavenR</a></code> provides a theme for the RavenR package
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(rvn_hydrograph_data)

# check if string is a valid prd argument
rvn_get_prd(prd="2000-10-01/2002-09-30")
# rvn_get_prd(prd="2000-10-01/2002-24-30") # returns error

# get full valid prd argument for xts object
rvn_get_prd(rvn_hydrograph_data$hyd$Sub43_obs)

# check prd argument against xts object
rvn_get_prd(rvn_hydrograph_data$hyd$Sub43_obs, "2020-01-01/2020-02-01")
# rvn_get_prd(rvn_hydrograph_data$hyd$Sub43_obs, "2002-24-01/2020-02-01") # returns error
# rvn_get_prd(rvn_hydrograph_data$hyd$Sub43_obs, "20-24-01/2020-02-01")   # returns error


</code></pre>

<hr>
<h2 id='rvn_hyd_dygraph'>Read in Raven Hydrograph file</h2><span id='topic+rvn_hyd_dygraph'></span>

<h3>Description</h3>

<p>rvn_hyd_dygraph plots modeled vs observed hydrographs when supplied with hydrograph data
structure read using <code><a href="#topic+rvn_hyd_read">rvn_hyd_read</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_hyd_dygraph(
  hy,
  timezone = "UTC",
  basins = "",
  main = NULL,
  figheight = 400
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_hyd_dygraph_+3A_hy">hy</code></td>
<td>
<p>hydrograph data structure generated by <code><a href="#topic+rvn_hyd_read">rvn_hyd_read</a></code> routine</p>
</td></tr>
<tr><td><code id="rvn_hyd_dygraph_+3A_timezone">timezone</code></td>
<td>
<p>data timezone; defaults to UTC</p>
</td></tr>
<tr><td><code id="rvn_hyd_dygraph_+3A_basins">basins</code></td>
<td>
<p>list of subbasin names from hydrograph file. Each subbasin creates separate dygraph plots</p>
</td></tr>
<tr><td><code id="rvn_hyd_dygraph_+3A_main">main</code></td>
<td>
<p>dygraph title to override the default (applied to all dygraphs)</p>
</td></tr>
<tr><td><code id="rvn_hyd_dygraph_+3A_figheight">figheight</code></td>
<td>
<p>height of figure, in pixels</p>
</td></tr>
</table>


<h3>Value</h3>

<p>res a list of plot handles to dygraph plots
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# read in RavenR sample hydrographs data
hy &lt;- rvn_hydrograph_data

# view contents for subbasin 36 as dyGraph
dyplots &lt;- rvn_hyd_dygraph(hy,basins="Sub36")
dyplots

rvn_hyd_dygraph(hy,basins="Sub36", main="test title")

# view contents for all basins in hydrograph data
rvn_hyd_dygraph(hy)

</code></pre>

<hr>
<h2 id='rvn_hyd_extract'>Extract function for Raven Hydrograph object</h2><span id='topic+rvn_hyd_extract'></span>

<h3>Description</h3>

<p>rvn_hyd_extract is used for extracting data from the Raven hydrograph object.
Works for objects passed from rvn_hyd_read function (which reads the
Hydrographs.csv file produced by the modelling framework Raven).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_hyd_extract(subs = NA, hyd = NA, prd = NULL, rename_cols = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_hyd_extract_+3A_subs">subs</code></td>
<td>
<p>column name for plotting/extracting</p>
</td></tr>
<tr><td><code id="rvn_hyd_extract_+3A_hyd">hyd</code></td>
<td>
<p>full hydrograph data frame (including units) produced by hyd.read</p>
</td></tr>
<tr><td><code id="rvn_hyd_extract_+3A_prd">prd</code></td>
<td>
<p>time period for plotting, as string. See details</p>
</td></tr>
<tr><td><code id="rvn_hyd_extract_+3A_rename_cols">rename_cols</code></td>
<td>
<p>boolean for whether to rename columns to generic terms (sim, obs, etc.) or leave
column names as they appear in hyd</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Extracts the modelled and observed data from a Raven
hydrograph object by name reference. It is also easy to create plots of
modelled and observed data using this function. The simulated and observed
files are outputted regardless of whether a plot is created, for the
specified period.
</p>
<p>The subs input is the name of the column desired for use; the most common
use of this will be for subbasin outflows, where the names will be of the
form &quot;subXX&quot;, for example &quot;sub24&quot;.
</p>
<p>The hyd object is the full hydrograph object (hyd and units in one data
frame) created by the hyd.read function. Both the hyd and units are
required, since the units are placed onto the plots if one is created. This
is useful to at least see the units of the plotted variable, even if the
plot is later modified.
</p>
<p>The prd input is used to specify a period for the plot and/or the data
output. The period should be specified as a string start and end date, of
the format &quot;YYYY-MM-DD/YYYY-MM-DD&quot;, for example, &quot;2006-10-01/2010-10-01&quot;. If
no period is supplied, the entire time series will be used.
</p>


<h3>Value</h3>

<p>returns an xts object with sim, obs, inflow, and obs_inflow time series (if available)
</p>
<table>
<tr><td><code>sim</code></td>
<td>
<p>model simulation for specified column and period</p>
</td></tr>
<tr><td><code>obs</code></td>
<td>
<p>observed data for specified column and period</p>
</td></tr>
<tr><td><code>inflow</code></td>
<td>
<p>inflow simulation for specified column and period</p>
</td></tr>
<tr><td><code>obs_inflow</code></td>
<td>
<p>observed inflow simulation for specified column and period</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_hyd_read">rvn_hyd_read</a></code> for reading in the Hydrographs.csv file and
creating the object required in this function.
<code><a href="#topic+rvn_hyd_plot">rvn_hyd_plot</a></code> for conveniently plotting the output object contents onto the same figure.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># read in hydrograph sample csv data from RavenR package
ff &lt;- system.file("extdata","run1_Hydrographs.csv", package="RavenR")

# read in Raven Hydrographs file, store into myhyd
myhyd &lt;- rvn_hyd_read(ff)

# no plot or observed data, specified period
flow_36 &lt;- rvn_hyd_extract(subs="Sub36",myhyd)

attributes(flow_36)

# extract simulated and observed flows
sim &lt;- flow_36$sim
obs &lt;- flow_36$obs

# extract precipitation forcings
myprecip &lt;- rvn_hyd_extract(subs="precip",hyd=myhyd)
myprecip &lt;- myprecip$sim

# plot all components using rvn_hyd_plot
rvn_hyd_plot(sim,obs,precip=myprecip)

</code></pre>

<hr>
<h2 id='rvn_hyd_plot'>Create Hydrograph Plot</h2><span id='topic+rvn_hyd_plot'></span>

<h3>Description</h3>

<p>rvn_hyd_plot creates a hydrograph plot object for the supplied flow series, or
equivalently a stage plot for reservoir stages.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_hyd_plot(
  sim = NULL,
  obs = NULL,
  inflow = NULL,
  precip = NULL,
  prd = NULL,
  winter_shading = FALSE,
  wsdates = c(12, 1, 3, 31)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_hyd_plot_+3A_sim">sim</code></td>
<td>
<p>time series object of simulated flows</p>
</td></tr>
<tr><td><code id="rvn_hyd_plot_+3A_obs">obs</code></td>
<td>
<p>time series object of observed flows</p>
</td></tr>
<tr><td><code id="rvn_hyd_plot_+3A_inflow">inflow</code></td>
<td>
<p>time series object of inflows to subbasin</p>
</td></tr>
<tr><td><code id="rvn_hyd_plot_+3A_precip">precip</code></td>
<td>
<p>time series object of precipitation</p>
</td></tr>
<tr><td><code id="rvn_hyd_plot_+3A_prd">prd</code></td>
<td>
<p>period to use in plotting</p>
</td></tr>
<tr><td><code id="rvn_hyd_plot_+3A_winter_shading">winter_shading</code></td>
<td>
<p>optionally adds shading for winter months (default <code>FALSE</code>)</p>
</td></tr>
<tr><td><code id="rvn_hyd_plot_+3A_wsdates">wsdates</code></td>
<td>
<p>integer vector of winter shading period dates (see details)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Creates a hydrograph plot using the supplied time series; any
series not supplied will not be plotted. If the precip time series is
supplied, the secondary y axis will be used to plot the precip time series.
</p>
<p>The function assumes that the supplied time series have the same length and
duration in time. If this is not true, then the defined period or period
calculated from the first available flow series will be used to determine
the plotting limits in time. If the data is used directly from Raven output,
this is not a concern. The supplied time series should be in xts format,
which again can be obtained directly by using the hyd.extract function.
</p>
<p>The winter_shading argument will add a transparent grey shading for the
specified period by wsdates in each year that is plotted.
</p>
<p>wsdates is formatted as c(winter start month, winter start day, winter end month, winter end day).
</p>
<p>Note that a plot title is purposely omitted in order to allow the automatic
generation of plot titles.
</p>


<h3>Value</h3>

<table>
<tr><td><code>p1</code></td>
<td>
<p>returns ggplot plot object</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_flow_spaghetti">rvn_flow_spaghetti</a></code> to create a spaghetti plot of annual
flow series
</p>
<p><code><a href="#topic+rvn_hyd_extract">rvn_hyd_extract</a></code> to extract time series from Raven objects
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# load sample hydrograph data, two years worth of sim/obs
ff &lt;- system.file("extdata","run1_Hydrographs.csv", package="RavenR")
run1 &lt;- rvn_hyd_read(ff)
sim &lt;- run1$hyd$Sub36
obs &lt;- run1$hyd$Sub36_obs
precip &lt;- run1$hyd$precip

# create a nice hydrograph
rvn_hyd_plot(sim,obs)

# create a hydrograph with precip as well;
rvn_hyd_plot(sim,obs,precip=precip)

# create a hydrograph with precip as well for a specific subperiod
prd &lt;- "2003-10-01/2004-10-01"
rvn_hyd_plot(sim,obs,precip=precip,prd=prd)

# add the winter shading
rvn_hyd_plot(sim,obs,precip=precip,prd=prd, winter_shading=TRUE)

# change winter shading dates (Nov 1st to April 15th)
rvn_hyd_plot(sim,obs,precip=precip,prd=prd, winter_shading=TRUE, wsdates=c(11,1,4,15))

</code></pre>

<hr>
<h2 id='rvn_hyd_read'>Read in Raven Hydrograph file</h2><span id='topic+rvn_hyd_read'></span>

<h3>Description</h3>

<p>rvn_hyd_read is used to read in the Hydrographs.csv file produced by the
modelling Framework Raven.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_hyd_read(ff = NA, tzone = "UTC")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_hyd_read_+3A_ff">ff</code></td>
<td>
<p>full file path to the Hydrographs.csv file</p>
</td></tr>
<tr><td><code id="rvn_hyd_read_+3A_tzone">tzone</code></td>
<td>
<p>string indicating the timezone of the data in ff (default &quot;UTC&quot;)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Expects a full file path to the Hydrographs.csv file, then
reads in the file using fread. The main advantage of this function is
renaming the columns to nicer names and extracting the units into something
much easier to read.
</p>
<p>This function is also built to support the <code><a href="#topic+rvn_hyd_extract">rvn_hyd_extract</a></code> function, which uses
the object created here for extracting by reference to the columns named
here, for example sub24.
</p>
<p>ff is the full file path of the Hydrographs.csv file. If the file is located
in the current working directory, then simply the name of the file is
sufficient.
</p>
<p>tzone is a string indicating the timezone of the supplied Hydrographs file. The
timezone provided is coded into the resulting hyd data frame using the as.POSIXct
function. The timezone is provided as &quot;UTC&quot; by default, and should be adjusted by
the user to the local time zone as needed, based on the model run.
</p>


<h3>Value</h3>

<table>
<tr><td><code>hyd</code></td>
<td>
<p>data frame from the file with standardized names</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_hyd_extract">rvn_hyd_extract</a></code> for extraction tools related to the
rvn_hyd_read output file
</p>


<h3>Examples</h3>

<pre><code class='language-R'># read in hydrograph sample csv data from RavenR package
ff &lt;- system.file("extdata","run1_Hydrographs.csv", package="RavenR")

# read in Raven Hydrographs file, store into myhyd
myhyd &lt;- rvn_hyd_read(ff)

# view contents
head(myhyd$hyd)
myhyd$units

</code></pre>

<hr>
<h2 id='rvn_hydrograph_data'>Hydrograph Data from Raven</h2><span id='topic+rvn_hydrograph_data'></span>

<h3>Description</h3>

<p>A dataset formatted to the xts package, read in by the hyd.read function.
The dataset contains the typical columns from the Raven outputted
Hydrographs.csv file, available for download in the Raven Tutorials
(linked below).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_hydrograph_data
</code></pre>


<h3>Format</h3>

<p>rvn_hydrograph_data is a data frame with two object
</p>

<dl>
<dt>hyd</dt><dd><p>simulated and observed flows from Raven model</p>
</dd>
<dt>units</dt><dd><p>units associated with each variable in hyd</p>
</dd>
<dt>obs.flag</dt><dd><p>flag for each column indicating whether it is observed data or not</p>
</dd>
</dl>

<p>rvn_hydrograph_data$hyd is an xts (time series) object with 731 rows and
5 variables, with data from 2002-10-01 to 2004-09-30. More details on
the Hydrographs.csv output can be found in the Raven manual.
</p>

<ul>
<li><p>precip - precipitation time series
</p>
</li>
<li><p>Sub36 - outflows from subbasin 36 in Nith model
</p>
</li>
<li><p>Sub36_obs - observed outflows from subbasin 36
</p>
</li>
<li><p>Sub43 - outflows from subbasin 43 in Nith model
</p>
</li>
<li><p>Sub43_obs - observed outflows from subbasin 43
</p>
</li></ul>

<p>The Nith River model can be downloaded from the Raven Tutorials (tutorial #2)
<a href="http://raven.uwaterloo.ca/Downloads.html">http://raven.uwaterloo.ca/Downloads.html</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_custom_read">rvn_custom_read</a></code> for reading in custom output files
</p>
<p><code><a href="#topic+rvn_custom_output_plot">rvn_custom_output_plot</a></code> for plotting custom output
</p>

<hr>
<h2 id='rvn_met_interpolate'>Interpolate meteorological data using IDW</h2><span id='topic+rvn_met_interpolate'></span>

<h3>Description</h3>

<p>Interpolates/infills missing meteorological data by
using an inverse-distance weighting scheme to infill using data from nearby
meteorological stations; issues where maximum temperature is less than minimum
temperature can also be resolved.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_met_interpolate(
  weather_data = NULL,
  cc = c("max_temp", "min_temp", "total_precip"),
  key_stn_ids = NULL,
  ppexp = 2,
  fix_interp_temp = TRUE,
  fix_base_temp = FALSE,
  min_dist = 100
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_met_interpolate_+3A_weather_data">weather_data</code></td>
<td>
<p>data frame of input meteorological data from multiple stations</p>
</td></tr>
<tr><td><code id="rvn_met_interpolate_+3A_cc">cc</code></td>
<td>
<p>columns from weather_data to infill missing values in</p>
</td></tr>
<tr><td><code id="rvn_met_interpolate_+3A_key_stn_ids">key_stn_ids</code></td>
<td>
<p>station IDs in which to perform the interpolation</p>
</td></tr>
<tr><td><code id="rvn_met_interpolate_+3A_ppexp">ppexp</code></td>
<td>
<p>exponent to use in inverse distance weighting calculation (default 2)</p>
</td></tr>
<tr><td><code id="rvn_met_interpolate_+3A_fix_interp_temp">fix_interp_temp</code></td>
<td>
<p>function will swap interpolated min and max temp if appropriate</p>
</td></tr>
<tr><td><code id="rvn_met_interpolate_+3A_fix_base_temp">fix_base_temp</code></td>
<td>
<p>function will swap any min and max temp if appropriate</p>
</td></tr>
<tr><td><code id="rvn_met_interpolate_+3A_min_dist">min_dist</code></td>
<td>
<p>minimum distance used in IDW to avoid issues with stations of different IDs but exact same coordinates (default 100m)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function takes a meteorological data set with multiple station data in one data frame and
interpolates the missing values for key stations, for the specified meteorological variables to interpolate.
</p>
<p>The format of the weather_data input is consistent with that from the <code>weathercan::weather_dl</code>
function, which is the recommended tool to gather this input (see the examples).
</p>
<p>This function does not guarantee to infill all missing values, since this depends on the availability of data
at other locations when it lacks at a given station, although a warning is issued if
missing values remain following the interpolation. If this is encountered, it may be prudent to consider
including additional stations in the available data for interpolation and/or applying alternative
interpolation schemes in conjunction with <code>rvn_met_interpolate</code>.
</p>
<p>This function does not (currently) perform checks for the quality of the supplied or infilled data,
such as checking for maximum temperature less than minimum temperature, unreasonable precipitation values, etc.
</p>
<p>The key_stn_ids indicates which stations should have their missing values interpolated. It is likely that
the user will require more data to perform a proper interpolation than the user cares to have gauge
records at, i.e. some stations are only provided for the purposes of infilling missing data at other stations.
Since the interpolation of all stations provided can become computationally expensive, the user can
specify which stations they want to interpolate data for with the key_stn_ids parameter. Station IDs that
are not within the key_stn_ids (if not NULL) will still be used, but not themselves infilled.
</p>
<p>fix_interp_temp is a boolean for the function to swap any max_temp and min_temp fields where the maximum
temperature is less than the minimum temperature, a common fix in messy environmental data. This function
will only apply if the columns <code>max_temp</code> and <code>min_temp</code> are present, and will only apply to the
interpolated fields. By default this is enabled, and automatic fixes to interpolated data will be done;
supplied data where the max temp is less than min temp will not be fixed unless fix_base_temp is enabled.
</p>
<p>The distance calculation, estimating the distance between stations, is performed using the
<code><a href="#topic+rvn_dist_lonlat">rvn_dist_lonlat</a></code> function, which is based on the <code>geosphere</code> package. The min_dist is
included to provide a minimum distance used in IDW, and avoid issues with stations of different names and IDs but
the same coordinates. This can occur when stations upgrade or are reinstated at a later time in the same location,
which would otherwise result in a div/0 error in the IDW calculation.
</p>


<h3>Value</h3>

<table>
<tr><td><code>new_wd</code></td>
<td>
<p>infilled meteorological data set</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_rvt_write_met">rvn_rvt_write_met</a></code> for writing meteorological data sets to rvt format.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
## NOT RUN (downloads data + long runtime)

# example to create infilled data sets

library(weathercan)
stn &lt;- weathercan::stations_search(name="Glen allan", interval = "day")
dl_stn &lt;- stn
all_stns &lt;- weathercan::stations_search(coords=c(stn$lat, stn$lon), dist=40,
          interval="day", starts_latest = 2002,
          ends_earliest = 2010)

# download data with weathercan::weather_dl()
weather_data &lt;- weather_dl(station_ids = all_stns$station_id,
                            start = "2002-10-01",
                            end = "2005-10-01",
                            interval="day")

# define first three as key stations of interest for infilling
dl_stn &lt;- all_stns[1:3,]

# confirm missing data in key columns
key_cols &lt;- c("min_temp","max_temp","total_precip")
length(which(is.na(weather_data[,key_cols])))

# perform interpolation for key stns (3) using all stations downloaded (5)
new_wd &lt;- rvn_met_interpolate(weather_data = weather_data,
                               key_stn_ids = dl_stn$station_id,
                               cc = key_cols)

# no warning - confirm no missing values in key columns
length(which(is.na(new_wd[,key_cols])))

## End(Not run)

</code></pre>

<hr>
<h2 id='rvn_met_recordplot'>EC Climate Gauge Record Overlap Visualization</h2><span id='topic+rvn_met_recordplot'></span>

<h3>Description</h3>

<p>This function plots the length of Environment Canada climate station records,
accessed via the <span class="pkg">weathercan</span> package, to identify periods in which multiple
station records overlap.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_met_recordplot(
  metadata = NULL,
  stndata = NULL,
  variables = NULL,
  colorby = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_met_recordplot_+3A_metadata">metadata</code></td>
<td>
<p>tibble of the station meta-data from <code>weathercan::stations_search()</code></p>
</td></tr>
<tr><td><code id="rvn_met_recordplot_+3A_stndata">stndata</code></td>
<td>
<p>tibble of the station data from <code>weathercan::weather_dl()</code></p>
</td></tr>
<tr><td><code id="rvn_met_recordplot_+3A_variables">variables</code></td>
<td>
<p>if using <code>weathercan::weather_dl()</code>, column names for variables of interest (currently only accepts 1 per call)</p>
</td></tr>
<tr><td><code id="rvn_met_recordplot_+3A_colorby">colorby</code></td>
<td>
<p>column name by which to color station records. Set to 'elev' (elevation) by default. Can be set to
&quot;dist&quot; (distance from coordinates of interest) if supplying <code>weathercan::stations_search</code> results.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Accepts outputs from either the <code>stations_search()</code> or <code>weather_dl()</code> functions
from the <span class="pkg">weathercan</span> package and extracts the start and end dates of the record
from each station for plotting.
</p>
<p>Station records are plotted chronologically on a timeline, and can be colored
according to either the station's elevation (default, works for both types of inputs)
or the station's distance from a point of interest (works only when supplying
<code>stations_search()</code> results as metadata input).
</p>
<p>The timeline plot is accompanied by a bar plot counting the number of stations with
available data year by year.
</p>
<p>Large differences in elevation between stations may point towards consideration for
the effect of lapse rates on climate forcings driving a model response.
</p>


<h3>Value</h3>

<p>returns a 2x1 plot object containing 2 ggplot objects
</p>
<table>
<tr><td><code>top:</code></td>
<td>
<p>A chronological horizontal bar plot depicting each station's record period</p>
</td></tr>
<tr><td><code>bottom:</code></td>
<td>
<p>A vertical bar plot depicting the number of station records available each year</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'># load metadata from RavenR sample data
data(rvn_weathercan_metadata_sample)

## code that would be used to download metadata using weathercan
# library(weathercan)
#
# metadata = stations_search(coords=c(50.109,-120.787),
#    dist=150, # EC stations 150 km of Merritt, BC
#   interval='day'
# )
# metadata = metadata[metadata$start&gt;=2000,] # subset stations with recent data
# metadata = metadata[1:3,] # take only the first 3 stations for brevity

# plot line colours by station elevation
rvn_met_recordplot(metadata=rvn_weathercan_metadata_sample, colorby='elev')

# plot line colours by distance to specified co-ordinates
rvn_met_recordplot(metadata=rvn_weathercan_metadata_sample, colorby='distance')

## load sample weathercan::weather_dl() with single station
data(rvn_weathercan_sample)

# compare records for a specific variable
rvn_met_recordplot(stndata=rvn_weathercan_sample, variables = "total_precip")

</code></pre>

<hr>
<h2 id='rvn_month_names'>Months in the Year vector</h2><span id='topic+rvn_month_names'></span>

<h3>Description</h3>

<p>Return a character vector of months in the year
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_month_names(short = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_month_names_+3A_short">short</code></td>
<td>
<p>boolean to return shortened form of months</p>
</td></tr>
</table>


<h3>Value</h3>

<p>character array of month names
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_num_days">rvn_num_days</a></code> for calculating the number of days in a
month
</p>


<h3>Examples</h3>

<pre><code class='language-R'>rvn_month_names()
rvn_month_names(FALSE)

</code></pre>

<hr>
<h2 id='rvn_monthly_vbias'>Monthly Volume Bias</h2><span id='topic+rvn_monthly_vbias'></span>

<h3>Description</h3>

<p>Creates a plot of the monthly volume biases in the simulated
flow series.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_monthly_vbias(
  sim,
  obs,
  add_line = TRUE,
  normalize = TRUE,
  add_labels = TRUE,
  incomplete_month = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_monthly_vbias_+3A_sim">sim</code></td>
<td>
<p>time series object of simulated flows</p>
</td></tr>
<tr><td><code id="rvn_monthly_vbias_+3A_obs">obs</code></td>
<td>
<p>time series object of observed flows</p>
</td></tr>
<tr><td><code id="rvn_monthly_vbias_+3A_add_line">add_line</code></td>
<td>
<p>optionally adds a horizontal line to the plot for reference
(default <code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="rvn_monthly_vbias_+3A_normalize">normalize</code></td>
<td>
<p>option to normalize the biases and report as percent error
(default <code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="rvn_monthly_vbias_+3A_add_labels">add_labels</code></td>
<td>
<p>optionally adds labels for early peak/late peaks on right
side axis (default <code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="rvn_monthly_vbias_+3A_incomplete_month">incomplete_month</code></td>
<td>
<p>whether to include months with missing days in the summation
(default <code>FALSE</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Calculates the monthly volume biases and optionally creates a
plot of them. The monthly volume biases are averaged across all years of
data. If normalized, the biases are calculated as:
</p>
<p>(Vi_sim - Vi_obs)/Vi_obs*100
</p>
<p>to be expressed as a percent error.
</p>
<p>The sim and obs should be of time series (xts) format and are assumed to be
of the same length and time period. The flow series are assumed to be daily
flows with units of m3/s. Note that a plot title is purposely omitted in
order to allow the automatic generation of plot titles.
</p>
<p>The add_labels will add the labels of 'overestimated' and 'underestimated'
to the right hand side axis if set to <code>TRUE</code>. This is useful in interpreting
the plots. Note that the biases are calculated as sim_Volume - obs_Volume,
which means that negative values mean the volume is underestimated, and
positive values mean the volume is overestimated.
</p>


<h3>Value</h3>

<table>
<tr><td><code>mvbias</code></td>
<td>
<p>monthly volume biases</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_annual_volume">rvn_annual_volume</a></code> to create a scatterplot of annual flow
volumes
</p>


<h3>Examples</h3>

<pre><code class='language-R'># load sample hydrograph data, two years worth of sim/obs
data(rvn_hydrograph_data)
sim &lt;- rvn_hydrograph_data$hyd$Sub36
obs &lt;- rvn_hydrograph_data$hyd$Sub36_obs

# check the monthly volume bias; normalizes by default
rvn_monthly_vbias(sim, obs)

# check unnormalzied monthly volume biases; see the larger volumes in certain periods
rvn_monthly_vbias(sim,obs,normalize = FALSE)

</code></pre>

<hr>
<h2 id='rvn_num_days'>Number of Days between two dates</h2><span id='topic+rvn_num_days'></span>

<h3>Description</h3>

<p>Calculate the number of days between two provided dates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_num_days(date1, date2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_num_days_+3A_date1">date1</code></td>
<td>
<p>first day, date format</p>
</td></tr>
<tr><td><code id="rvn_num_days_+3A_date2">date2</code></td>
<td>
<p>second day, date format</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This method handles leap years if they exist between the specified dates.
</p>


<h3>Value</h3>

<table>
<tr><td><code>int</code></td>
<td>
<p>number of days between the two days</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_num_days_month">rvn_num_days_month</a></code> for calculating the number of days in a
month
</p>


<h3>Examples</h3>

<pre><code class='language-R'>rvn_num_days(as.Date("2017-02-05"),as.Date("2017-02-12"))
# 7

</code></pre>

<hr>
<h2 id='rvn_num_days_month'>Number of Days in Month</h2><span id='topic+rvn_num_days_month'></span>

<h3>Description</h3>

<p>Calculates the number of days in the month
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_num_days_month(date)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_num_days_month_+3A_date">date</code></td>
<td>
<p>object in date format</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This method includes leap years if they exist in the specified month.
</p>


<h3>Value</h3>

<table>
<tr><td><code>int</code></td>
<td>
<p>number of days in the month</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_num_days">rvn_num_days</a></code> for calculating the number of days between
two dates
</p>
<p>See original code on post in Stack Overflow
<a href="http://stackoverflow.com/questions/6243088/find-out-the-number-of-days-of-a-month-in-rfind">
the number of days in a month</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
rvn_num_days_month(as.Date("2016-02-05"))
# 29

rvn_num_days_month(as.Date("2017-01-17"))
# 31

</code></pre>

<hr>
<h2 id='rvn_res_dygraph'>Plot Raven reservoir/lake stage time series using dygraph</h2><span id='topic+rvn_res_dygraph'></span>

<h3>Description</h3>

<p>rvn_res_dygraph plots modeled vs observed stage plots when supplied with reservoir stage data
structure read using <code><a href="#topic+rvn_res_read">rvn_res_read</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_res_dygraph(resdata, timezone = "UTC", basins = "", figheight = 400)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_res_dygraph_+3A_resdata">resdata</code></td>
<td>
<p>reservoir stage time series data structure generated by <code><a href="#topic+rvn_res_read">rvn_res_read</a></code> routine</p>
</td></tr>
<tr><td><code id="rvn_res_dygraph_+3A_timezone">timezone</code></td>
<td>
<p>data timezone; defaults to UTC</p>
</td></tr>
<tr><td><code id="rvn_res_dygraph_+3A_basins">basins</code></td>
<td>
<p>list of subbasin names from reservoir file. Each subbasin creates separate dygraph plots</p>
</td></tr>
<tr><td><code id="rvn_res_dygraph_+3A_figheight">figheight</code></td>
<td>
<p>height of figure, in pixels</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list of plot handles to dygraph plots
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_hyd_dygraph">rvn_hyd_dygraph</a></code> to generate dygraphs for hydrograph series
</p>


<h3>Examples</h3>

<pre><code class='language-R'># read in Raven Reservoir Stages file
ff &lt;- system.file("extdata","ReservoirStages.csv", package="RavenR")
resdata &lt;- rvn_res_read(ff)

# view contents for all subbasins as dyGraph
dyplots &lt;- rvn_res_dygraph(resdata)
dyplots[[1]]
dyplots[[2]]

</code></pre>

<hr>
<h2 id='rvn_res_extract'>Extract function for Raven Reservoir object</h2><span id='topic+rvn_res_extract'></span>

<h3>Description</h3>

<p>rvn_res_extract is used for extracting data from the Raven reservoir object.
Works for objects from <code><a href="#topic+rvn_res_read">rvn_res_read</a></code> function (for reading in the ReservoirStages.csv
file).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_res_extract(subs = NA, res = NA, prd = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_res_extract_+3A_subs">subs</code></td>
<td>
<p>column name for plotting/extracting</p>
</td></tr>
<tr><td><code id="rvn_res_extract_+3A_res">res</code></td>
<td>
<p>full reservoir data frame (including units) produced by res.read</p>
</td></tr>
<tr><td><code id="rvn_res_extract_+3A_prd">prd</code></td>
<td>
<p>time period for plotting, as string. See details</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Extracts the modelled and observed data from a Raven
reservoir object by name reference. It is also easy to create plots of
modelled and observed data using this function. The simulated and observed
files are outputted regardless of whether a plot is created, for the
specified period.
</p>
<p>The subs input is the name of the column desired for use; the most common
use of this will be for subbasins, where the names will be of the form
&quot;subXX&quot;, for example &quot;sub24&quot;.
</p>
<p>The res object is the full reservoir object (res and units in one data
frame) created by the res.read function. Both the res and units are
required, since the units are placed onto the plots if one is created. This
is useful to at least see the units of the plotted variable, even if the
plot is later modified.
</p>
<p>The prd input is used to specify a period for the plot and/or the data
output. The period should be specified as a string start and end date, of
the format &quot;YYYY-MM-DD/YYYY-MM-DD&quot;, for example, &quot;2006-10-01/2010-10-01&quot;. If
no period is supplied, the entire time series will be used.
</p>


<h3>Value</h3>

<table>
<tr><td><code>sim</code></td>
<td>
<p>model simulation for specified column and period</p>
</td></tr>
<tr><td><code>obs</code></td>
<td>
<p>observed data for specified column and period</p>
</td></tr>
<tr><td><code>inflow</code></td>
<td>
<p>inflow simulation for specified column and period</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_res_read">rvn_res_read</a></code> for reading in the Reservoirs.csv file and
creating the object required in this function. <code><a href="#topic+rvn_res_plot">rvn_res_plot</a></code> for
plotting the extracted stage time series
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
ff &lt;- system.file("extdata","ReservoirStages.csv", package="RavenR")

# Read in Raven Reservoirs file, store into myres
myres &lt;- rvn_res_read(ff)

# Extract stage using this function
stage36 &lt;- rvn_res_extract(subs="sub36",res=myres,prd="2002-10-01/2003-10-01")
summary(stage36)
summary(stage36$sim)

# Example for precipitation
precip &lt;- rvn_res_extract(subs="precip",res=myres)

</code></pre>

<hr>
<h2 id='rvn_res_plot'>Plot Reservoir Stage</h2><span id='topic+rvn_res_plot'></span>

<h3>Description</h3>

<p>Creates a reservoir stage plot for the supplied stage series.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_res_plot(
  sim = NULL,
  obs = NULL,
  precip = NULL,
  prd = NULL,
  winter_shading = FALSE,
  wsdates = c(12, 1, 3, 31)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_res_plot_+3A_sim">sim</code></td>
<td>
<p>time series object of simulated stage</p>
</td></tr>
<tr><td><code id="rvn_res_plot_+3A_obs">obs</code></td>
<td>
<p>time series object of observed stage</p>
</td></tr>
<tr><td><code id="rvn_res_plot_+3A_precip">precip</code></td>
<td>
<p>time series object of precipitation</p>
</td></tr>
<tr><td><code id="rvn_res_plot_+3A_prd">prd</code></td>
<td>
<p>period to use in plotting</p>
</td></tr>
<tr><td><code id="rvn_res_plot_+3A_winter_shading">winter_shading</code></td>
<td>
<p>optionally adds shading for winter months (default <code>FALSE</code>)</p>
</td></tr>
<tr><td><code id="rvn_res_plot_+3A_wsdates">wsdates</code></td>
<td>
<p>integer vector of winter shading period dates (see details)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Creates a reservoir stage plot using the supplied time series;
any series not supplied will not be plotted. If the precip time series is
supplied, the secondary y axis will be used to plot the precip time series.
</p>
<p>The function assumes that the supplied time series have the same length and
duration in time. If this is not true, then the defined period or period
calculated from the first available stage series will be used to determine
the plotting limits in time. If the data is used directly from Raven output,
this is not a concern. The supplied time series should be in xts format,
which again can be obtained directly by using the <code><a href="#topic+rvn_res_extract">rvn_res_extract</a></code> function.
</p>
<p>The winter_shading argument will add a transparent grey shading for the
December 1st to March 31st period in each year that is plotted (or other
period specified by wsdates).
</p>
<p>wsdates is formatted as c(winter start month, winter start day, winter end month, winter end day).
</p>


<h3>Value</h3>

<table>
<tr><td><code>p1</code></td>
<td>
<p>returns ggplot plot object</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_hyd_read">rvn_hyd_read</a></code> for reading in the Hydrographs.csv file, and
<code><a href="#topic+rvn_res_extract">rvn_res_extract</a></code> to extract time series from Raven objects
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# read in sample reservoir file
ff &lt;- system.file("extdata","ReservoirStages.csv", package="RavenR")
rvn_res_read(ff) %&gt;%
rvn_res_extract(subs="sub36", res=.) -&gt; mystage
sim &lt;- mystage$sim
obs &lt;- mystage$obs
precip &lt;- rvn_res_read(ff)$res$precip

# create a nice reservoir stage plot
rvn_res_plot(sim,obs)

# create a reservoir stage plot with precip as well
rvn_res_plot(sim,obs,precip=precip)

# create a reservoir stage plot with precip as well for a specific subperiod
prd &lt;- "2003-10-01/2005-10-01"
rvn_res_plot(sim,obs,precip=precip,prd=prd)

# add winter shading
rvn_res_plot(sim,obs,precip=precip, winter_shading=TRUE)

</code></pre>

<hr>
<h2 id='rvn_res_read'>Read in Raven ReservoirStages file</h2><span id='topic+rvn_res_read'></span>

<h3>Description</h3>

<p>Reads in the ReservoirStages.csv file produced by Raven.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_res_read(ff = NA, tzone = "UTC")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_res_read_+3A_ff">ff</code></td>
<td>
<p>full file path to the ReservoirStages.csv file</p>
</td></tr>
<tr><td><code id="rvn_res_read_+3A_tzone">tzone</code></td>
<td>
<p>string indicating the timezone of the data in ff</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Expects a full file path to the ReservoirStages.csv file, then
reads in the file using read.csv. The main advantage of this function is
renaming the columns to nicer names and extracting the units into something
much easier to read.
</p>
<p>This function is also built to support the <code><a href="#topic+rvn_res_extract">rvn_res_extract</a></code> function, which uses
the object created here for extracting by reference to the columns named
here, for example sub24.
</p>
<p>ff is the full file path of the ReservoirStages.csv file. If the file is
located in the current working directory, then simply the name of the file
is sufficient.
</p>
<p>The timezone is provided by the tzone argument as &quot;UTC&quot; by default, and should be adjusted by
the user to the local time zone as needed, based on the model run.
</p>


<h3>Value</h3>

<table>
<tr><td><code>res</code></td>
<td>
<p>data frame from the file with standardized names</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_res_extract">rvn_res_extract</a></code> for extraction tools related to the
rvn_res_read output file
</p>


<h3>Examples</h3>

<pre><code class='language-R'># create full file path
ff &lt;- system.file("extdata","ReservoirStages.csv", package="RavenR")

# read in the Reservoir file
myres &lt;- rvn_res_read(ff)

# view contents
head(myres$res)
myres$units

</code></pre>

<hr>
<h2 id='rvn_run'>Run Raven Executable</h2><span id='topic+rvn_run'></span>

<h3>Description</h3>

<p>Invokes shell to execute a Raven model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_run(
  fileprefix = NULL,
  indir = getwd(),
  ravenexe = NULL,
  outdir = NULL,
  rvc = NULL,
  rvt = NULL,
  rvp = NULL,
  rvh = NULL,
  showoutput = FALSE,
  rvi_options = NULL,
  run_chmod = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_run_+3A_fileprefix">fileprefix</code></td>
<td>
<p>file prefix for main Raven input files.</p>
</td></tr>
<tr><td><code id="rvn_run_+3A_indir">indir</code></td>
<td>
<p>string path for Raven input files</p>
</td></tr>
<tr><td><code id="rvn_run_+3A_ravenexe">ravenexe</code></td>
<td>
<p>file path to Raven executable</p>
</td></tr>
<tr><td><code id="rvn_run_+3A_outdir">outdir</code></td>
<td>
<p>string path for Raven output files (optional)</p>
</td></tr>
<tr><td><code id="rvn_run_+3A_rvc">rvc</code></td>
<td>
<p>file path to specific rvc file (optional)</p>
</td></tr>
<tr><td><code id="rvn_run_+3A_rvt">rvt</code></td>
<td>
<p>file path to specific rvt file (optional)</p>
</td></tr>
<tr><td><code id="rvn_run_+3A_rvp">rvp</code></td>
<td>
<p>file path to specific rvp file (optional)</p>
</td></tr>
<tr><td><code id="rvn_run_+3A_rvh">rvh</code></td>
<td>
<p>file path to specific rvh file (optional)</p>
</td></tr>
<tr><td><code id="rvn_run_+3A_showoutput">showoutput</code></td>
<td>
<p>boolean whether to show output in console (passed to show.output.on.console within system) (default FALSE)</p>
</td></tr>
<tr><td><code id="rvn_run_+3A_rvi_options">rvi_options</code></td>
<td>
<p>string vector of additional options to add to rvi file temporarily for run</p>
</td></tr>
<tr><td><code id="rvn_run_+3A_run_chmod">run_chmod</code></td>
<td>
<p>runs a chmod system call to the provided executable ('chmod +x') (default <code>FALSE</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Uses the <code><a href="base.html#topic+shell">shell</a></code> command to run the Raven.exe command.
</p>
<p>If the <code>fileprefix</code> is not supplied, the function will detect the rvi file automatically and
use that in the run (if exactly one rvi file exists in the directory).
</p>
<p>The <code>indir</code> path must point to the main Raven input files, if they are not in the working directory.
</p>
<p>The <code>ravenexe</code> must point to the Raven.exe file; if not supplied it will look for it in the RavenR/extdata
path that is saved to when using <code><a href="#topic+rvn_download">rvn_download</a></code>.
</p>
<p><code>rvi_options</code> can include a vector of any additional commands to add to the rvi file prior to execution. Any
commands are added temporarily, and the rvi file is restored following the Raven run. The original rvi file
is backed up as a copy in case of an interruption of the function or other error to prevent loss of data.
The rvi commands provided are checked against a list of known rvi commands and a warning is issued
if an unrecognized command is provided, but all commands provided are nonetheless written to the temporary
rvi file as provided. All rvi commands should include the colon prefix to the command (e.g. &quot;:SilentMode&quot; not &quot;SilentMode&quot;),
as this is not added automatically.
</p>
<p>Note that this function may not work in all servers, as some more specific setups when invoking the <code>system</code>
command may be required. In addition, errors may occur if the Raven.exe file does not have permission to execute. This
can be rectified with the <code>run_chmod</code> parameter set to <code>TRUE</code>
</p>


<h3>Value</h3>

<p>Returns output code from the system command when running Raven
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_download">rvn_download</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
## NOT RUN (data download + runs Raven.exe)
url&lt;-"http://raven.uwaterloo.ca/files/RavenTutorialFiles.zip"
temploc &lt;- tempdir()
destfile&lt;-paste(temploc,"/RavenTutorialFiles.zip",sep="")
download.file(url,destfile)
destdir&lt;-paste(temploc,"/RavenTutorialFiles",sep="")
dir.create(destdir)
unzip(zipfile=destfile,exdir=destdir)
file.remove(destfile)

## check that Raven.exe is downloaded
if (!rvn_download(check=TRUE)) {rvn_download()}

# Irondequoit example
rvn_run(indir=paste(destdir,"/Irond",sep=""),
        showoutput=TRUE)

# run in Silent Mode (rvi option)
rvn_run(indir=paste(destdir,"/Irond",sep=""),
        showoutput=TRUE,
        rvi_options=c(":SilentMode"))

## End(Not run)

</code></pre>

<hr>
<h2 id='rvn_rvc_from_custom_output'>Generate RVC file from Custom Output CSVs</h2><span id='topic+rvn_rvc_from_custom_output'></span>

<h3>Description</h3>

<p>Creates an initial conditions rvc file that specifies the initial state
using the information from the supplied custom output file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_rvc_from_custom_output(filename, custfiles, FUN, init_date = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_rvc_from_custom_output_+3A_filename">filename</code></td>
<td>
<p>filepath of rvc file to be created (with .rvc extension)</p>
</td></tr>
<tr><td><code id="rvn_rvc_from_custom_output_+3A_custfiles">custfiles</code></td>
<td>
<p>array of filepaths to Raven Custom Output files (must be ByHRU)</p>
</td></tr>
<tr><td><code id="rvn_rvc_from_custom_output_+3A_fun">FUN</code></td>
<td>
<p>the aggregation function to be applied to state variables (e.g. mean, passed to sapply)</p>
</td></tr>
<tr><td><code id="rvn_rvc_from_custom_output_+3A_init_date">init_date</code></td>
<td>
<p>datetime of model start (optional, can be calculated from Custom Output files)</p>
</td></tr>
<tr><td><code id="rvn_rvc_from_custom_output_+3A_...">...</code></td>
<td>
<p>optional arguments passed to <code><a href="#topic+rvn_rvc_write">rvn_rvc_write</a></code> (e.g. author, description)</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>TRUE</code></td>
<td>
<p>if executed successfully</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Leland Scantlebury
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Create array of custom output file(s)
custout &lt;- c(system.file("extdata","run1_SNOW_Daily_Average_ByHRU.csv",package = "RavenR"))

# Create rvc file of mean snow for each HRU
rvn_rvc_from_custom_output(filename = file.path(tempdir(), "Blank.rvc"),
                           custfiles = custout,
                           FUN = mean)
</code></pre>

<hr>
<h2 id='rvn_rvc_res'>Create initial conditions file for Reservoirs</h2><span id='topic+rvn_rvc_res'></span>

<h3>Description</h3>

<p>Write an initial conditions (rvc) format file for Raven,
with the calculated reservoir stages written in.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_rvc_res(ff, initial_percent = 0, output = "initial_res_conditions.rvc")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_rvc_res_+3A_ff">ff</code></td>
<td>
<p>full file path to the reservoir information file</p>
</td></tr>
<tr><td><code id="rvn_rvc_res_+3A_initial_percent">initial_percent</code></td>
<td>
<p>an optional double for percentage of maximum stage to
use as initial condition; default 0.0</p>
</td></tr>
<tr><td><code id="rvn_rvc_res_+3A_output">output</code></td>
<td>
<p>file rvc lines are written to (default: initial_res_conditions.rvc)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Writes an initial conditions format file for Raven
with the relevant initial reservoir stages. This file can be used directly
as the model rvc file, or one may copy and paste the information into a
separate rvc file for use (i.e. if there is other information to be included
in the model rvc file).
</p>
<p>The supplied file in ff should be a csv file consistent with the format from the
Raven-generated ReservoirStages.csv file. External observations of reservoirs may be used
given that the csv file follows the same format.
</p>
<p>The initial_percent must be between 0 and 1, so that the
initial stage is not less than the dry stage or greater than the maximum.
</p>


<h3>Value</h3>

<table>
<tr><td><code>TRUE</code></td>
<td>
<p>return <code>TRUE</code> if the function is executed properly</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_res_read">rvn_res_read</a></code> for reading in the ReservoirStages.csv file
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ff &lt;- system.file("extdata","ReservoirStages.csv", package="RavenR")

# set initial conditions at 40% capacity, view file
tf &lt;- file.path(tempdir(), "modelname.rvc")
rvn_rvc_res(ff, initial_percent=0.4, output=tf)
readLines(tf)

</code></pre>

<hr>
<h2 id='rvn_rvc_write'>Write Raven Initial Condition (rvc) file</h2><span id='topic+rvn_rvc_write'></span>

<h3>Description</h3>

<p>Given initial conditions for state variables at HRUs, generates a rvc file
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_rvc_write(
  filename,
  initHRU,
  init_date,
  description = "Generated by RavenR rvn_rvc_write",
  author = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_rvc_write_+3A_filename">filename</code></td>
<td>
<p>filepath of rvc file to write to (with .rvc extension)</p>
</td></tr>
<tr><td><code id="rvn_rvc_write_+3A_inithru">initHRU</code></td>
<td>
<p>dataframe of initial conditions for state variables (columns) for each HRU (rows).
columns must be valid SV names and there must be an explicit column of HRU ids named 'HRU'.</p>
</td></tr>
<tr><td><code id="rvn_rvc_write_+3A_init_date">init_date</code></td>
<td>
<p>datetime of model start</p>
</td></tr>
<tr><td><code id="rvn_rvc_write_+3A_description">description</code></td>
<td>
<p>(optional) Description added after file header</p>
</td></tr>
<tr><td><code id="rvn_rvc_write_+3A_author">author</code></td>
<td>
<p>(optional) Name of author, to be printed in file header.</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>TRUE</code></td>
<td>
<p>return <code>TRUE</code> if the function is executed properly</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Leland Scantlebury
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_rvc_res">rvn_rvc_res</a></code>
<code><a href="#topic+rvn_rvc_from_custom_output">rvn_rvc_from_custom_output</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Create an initial condition HRU table where SOIL[0] is 0.5mm for all HRUs
# Check.names is set to FALSE to allow for brackets in the column name
initHRU &lt;- data.frame('HRU'=1:10, 'SOIL[0]'=0.5, check.names=FALSE)
model_start = as.Date('2001-10-01')

# Generate RVC file
rvn_rvc_write(filename = file.path(tempdir(), "New.rvc"),
              initHRU = initHRU,
              init_date = model_start,
              author = 'Harry Potter')
</code></pre>

<hr>
<h2 id='rvn_rvh_blankHRUdf'>Generate Blank Raven HRU DataFrame</h2><span id='topic+rvn_rvh_blankHRUdf'></span>

<h3>Description</h3>

<p>Used to generate a blank HRU table that can be filled in by the user. Compatible
with <code><a href="#topic+rvn_rvh_write">rvn_rvh_write</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_rvh_blankHRUdf(nHRUs = 1, subbasinIDs = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_rvh_blankHRUdf_+3A_nhrus">nHRUs</code></td>
<td>
<p>Number of HRUs, used to determine number of rows in table (default = 1)</p>
</td></tr>
<tr><td><code id="rvn_rvh_blankHRUdf_+3A_subbasinids">subbasinIDs</code></td>
<td>
<p>Subbasins that HRUs belong to (default = all equal 1)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note that if the length of the subbasinIDs vector is greater than the number of HRUs (nHRUs)
specified, this will create a table with HRUs belonging to multiple subbasins, which is not feasible.
A warning will be issued that the table will need to be modified for hydrologic consistency.
</p>


<h3>Value</h3>

<p>data.frame of blank HRU properties to be filled in by user
</p>


<h3>Author(s)</h3>

<p>Leland Scantlebury
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_rvh_blankSBdf">rvn_rvh_blankSBdf</a></code> to generate blank subbasin data frame
</p>


<h3>Examples</h3>

<pre><code class='language-R'>HRUtable &lt;- rvn_rvh_blankHRUdf(nHRUs = 3, subbasinIDs=c(1,1,2))
HRUtable

# fewer nHRUs than subbasinIDs specified
rvn_rvh_blankHRUdf(nHRUs = 1, subbasinIDs=c(1,2))

</code></pre>

<hr>
<h2 id='rvn_rvh_blankSBdf'>Generate Blank Raven SubBasin DataFrame</h2><span id='topic+rvn_rvh_blankSBdf'></span>

<h3>Description</h3>

<p>Generates a blank data frame for Raven subbasin properties. Compatible with <code><a href="#topic+rvn_rvh_write">rvn_rvh_write</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_rvh_blankSBdf(nSubBasins = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_rvh_blankSBdf_+3A_nsubbasins">nSubBasins</code></td>
<td>
<p>Number of SubBasins in model, used to determine number of rows in table (default = 1)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The subbasin names are provided as 'sub00x', where x is the basin ID. The padding is determined
from the number of subbasins. The downstream IDs are generated to assume a linear downstream progression,
with an outlet at the terminal subbasin ID, which can be modified after the data frame is created.
</p>


<h3>Value</h3>

<p>data.frame of blank SubBasin properties to be filled in by user
</p>


<h3>Author(s)</h3>

<p>Leland Scantlebury
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_rvh_blankHRUdf">rvn_rvh_blankHRUdf</a></code> to generate blank HRU data frame
</p>


<h3>Examples</h3>

<pre><code class='language-R'>SBtable &lt;- rvn_rvh_blankSBdf(nSubBasins = 3)
SBtable

</code></pre>

<hr>
<h2 id='rvn_rvh_cleanhrus'>Clean HRU data table.</h2><span id='topic+rvn_rvh_cleanhrus'></span>

<h3>Description</h3>

<p>Takes <code><a href="#topic+rvn_rvh_read">rvn_rvh_read</a></code>-generated HRUtable and SBTable and returns cleaned HRUtable
with (hopefully) fewer HRUs
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_rvh_cleanhrus(
  HRUtab,
  SBtab,
  area_tol = 0.01,
  merge = FALSE,
  elev_tol = 50,
  slope_tol = 4,
  aspect_tol = 20,
  ProtectedHRUs = c(),
  LockedHRUs = c(),
  LockedSubbasins = c()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_rvh_cleanhrus_+3A_hrutab">HRUtab</code></td>
<td>
<p>table of HRUs generated (typically) by <code><a href="#topic+rvn_rvh_read">rvn_rvh_read</a></code></p>
</td></tr>
<tr><td><code id="rvn_rvh_cleanhrus_+3A_sbtab">SBtab</code></td>
<td>
<p>table of Subbasins generated (typically) by <code><a href="#topic+rvn_rvh_read">rvn_rvh_read</a></code></p>
</td></tr>
<tr><td><code id="rvn_rvh_cleanhrus_+3A_area_tol">area_tol</code></td>
<td>
<p>percentage of watershed area beneath which HRUs should be removed (e.g.,
default value of 0.01 would indicate anything smaller than 1 percent of watershed extent should be removed)</p>
</td></tr>
<tr><td><code id="rvn_rvh_cleanhrus_+3A_merge">merge</code></td>
<td>
<p>TRUE if similar HRUs are to be merged (this can be slow for large models)</p>
</td></tr>
<tr><td><code id="rvn_rvh_cleanhrus_+3A_elev_tol">elev_tol</code></td>
<td>
<p>elevation difference (in metres) considered similar. only used if <code>merge=TRUE</code></p>
</td></tr>
<tr><td><code id="rvn_rvh_cleanhrus_+3A_slope_tol">slope_tol</code></td>
<td>
<p>slope difference (in degrees) considered similar. only used if <code>merge=TRUE</code></p>
</td></tr>
<tr><td><code id="rvn_rvh_cleanhrus_+3A_aspect_tol">aspect_tol</code></td>
<td>
<p>slope difference (in degrees) considered similar. only used if <code>merge=TRUE</code></p>
</td></tr>
<tr><td><code id="rvn_rvh_cleanhrus_+3A_protectedhrus">ProtectedHRUs</code></td>
<td>
<p>vector of HRU IDs that are sacrosanct (not to be removed, but may still increase in area)</p>
</td></tr>
<tr><td><code id="rvn_rvh_cleanhrus_+3A_lockedhrus">LockedHRUs</code></td>
<td>
<p>vector of HRU IDs that are locked (not to be modified)</p>
</td></tr>
<tr><td><code id="rvn_rvh_cleanhrus_+3A_lockedsubbasins">LockedSubbasins</code></td>
<td>
<p>vector of subbasin IDs that are locked (not to be modified).</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>rvn_rvh_cleanhrus</code> removes HRUs in two ways:
</p>
<p>1. it removes all HRUs smaller than the area_tol percentage of total area. Adjacent HRUs in the
subbasin are expanded by the lost area to keep the same relative coverage.
</p>
<p>2. it consolidates similar HRUs within the same subbasin (those with same land cover,
vegetation, soil profile and similar slope, aspect, and elevation)
</p>
<p>The ProtectedHRUs allows the specification of HRUs that should not be removed, even if they
would otherwise be merged or removed. These HRUs may still increase in size as other HRUs are
consolidated.
</p>
<p>The LockedHRUs allows for the specification of HRUs that will not change (removed or increase
in size), which may be useful for specific land types such as glaciers or water bodies. It is
possible that locking HRUs may prevent the script from resizing remaining HRUs within a subbasin,
in which case a warning is issued to the user that the area has changed. If this is the case, it
is suggested to reduce the area threshold to try and prevent this issue, or consider simply locking some
subbasins.
</p>
<p>Note that merging can be a computationally expensive process, and for this reason is set as <code>FALSE</code> by default.
</p>


<h3>Value</h3>

<table>
<tr><td><code>hru_table</code></td>
<td>
<p>cleaned HRU table as a dataframe</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>James R. Craig, University of Waterloo
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_rvh_read">rvn_rvh_read</a></code> for the function used to read in the HRU and Subbasin data, and
<code><a href="#topic+rvn_rvh_write">rvn_rvh_write</a></code> to write rvh information to file.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# read in example rvh file
nith &lt;- system.file("extdata","Nith.rvh",package = "RavenR")
rvh &lt;- rvn_rvh_read(nith)

# number of HRUs in existing configuration
nrow(rvh$HRUtable)

# clean contents (in this case, remove all HRUs covering less than 5% of the total area)
newHRUs &lt;- rvn_rvh_cleanhrus(rvh$HRUtable,rvh$SBtable,area_tol = 0.05, merge=TRUE)

# clean contents but locking urban areas (two HRUs locked)
newHRUs &lt;- rvn_rvh_cleanhrus(rvh$HRUtable,rvh$SBtable,area_tol = 0.05, merge=TRUE,
   LockedHRUs=rvh$HRUtable[rvh$HRUtable$LandUse=="URBAN", "ID"])

</code></pre>

<hr>
<h2 id='rvn_rvh_overwrite'>Write/Overwrite Raven rvh file</h2><span id='topic+rvn_rvh_overwrite'></span><span id='topic+rvn_rvh_write'></span>

<h3>Description</h3>

<p>Given an HRU and SubBasin dataframe, writes to the specified .rvh file. In the case of rvn_rvh_overwrite,
just the :SubBasins-:EndSubBasins and :HRUs-:EndHRUs blocks are re-written, retaining all other content.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_rvh_overwrite(filename, SBtable, HRUtable, basefile)

rvn_rvh_write(
  filename,
  SBtable = NULL,
  HRUtable = NULL,
  description = "Generated by RavenR rvn_rvh_write",
  author = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_rvh_overwrite_+3A_filename">filename</code></td>
<td>
<p>filepath of rvh file to write to (with .rvh extension)</p>
</td></tr>
<tr><td><code id="rvn_rvh_overwrite_+3A_sbtable">SBtable</code></td>
<td>
<p>Valid subbasin dataframe with required columns &quot;SBID&quot;, &quot;Name&quot;, &quot;Downstream_ID&quot;, &quot;Profile&quot;,
&quot;ReachLength&quot;, and &quot;Gauged&quot;. Can have additional columns.</p>
</td></tr>
<tr><td><code id="rvn_rvh_overwrite_+3A_hrutable">HRUtable</code></td>
<td>
<p>Valid HRU dataframe with required columns 'ID', 'Area', 'Elevation', 'Latitude', 'Longitude',
'SBID', 'LandUse', 'Vegetation', 'SoilProfile', 'Aquifer', 'Terrain', 'Slope', and 'Aspect'. Can have additional columns.</p>
</td></tr>
<tr><td><code id="rvn_rvh_overwrite_+3A_basefile">basefile</code></td>
<td>
<p>original rvh file to overwrite (only used with rvn_rvh_overwrite)</p>
</td></tr>
<tr><td><code id="rvn_rvh_overwrite_+3A_description">description</code></td>
<td>
<p>(optional) Description added after file header</p>
</td></tr>
<tr><td><code id="rvn_rvh_overwrite_+3A_author">author</code></td>
<td>
<p>(optional) Name of author, to be printed in file header.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>rvn_rvh_write</code> is typically used to create a 'clean' .rvh file.
</p>
<p><code><a href="#topic+rvn_rvh_overwrite">rvn_rvh_overwrite</a></code> is usually used after reading an original .rvh file and
processing the HRU and SubBasin tables, using (e.g., <code><a href="#topic+rvn_rvh_cleanhrus">rvn_rvh_cleanhrus</a></code>). This may also be used
to preserve commands in the rvh file such as reservoir information, comments outside of the
subbasin and HRU blocks, RedirectToFile commands, etc.
</p>
<p>Note that if using the rvn_rvh_overwrite function and the filename and basefile arguments are the same, the
original file will be overwritten while preserving lines outside of the subbasin and HRU blocks.
</p>
<p>If using <code>rvn_rvh_write</code>, the SBtable or HRUtable parameters may be omitted and provided as <code>NULL</code>.
In these cases, those sections will not be written in the rvh file. This may be useful in cases where one wishes to
separate the SubBasins and HRUs in different files.
</p>


<h3>Value</h3>

<table>
<tr><td><code>TRUE</code></td>
<td>
<p>returns <code>TRUE</code> if function runs properly</p>
</td></tr>
</table>


<h3>Functions</h3>


<ul>
<li> <p><code>rvn_rvh_overwrite</code>: Overwrite contents of original .rvh file
</p>
</li></ul>


<h3>Author(s)</h3>

<p>James R. Craig, University of Waterloo
</p>
<p>Leland Scantlebury
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_rvh_read">rvn_rvh_read</a></code> for the function used to read in the HRU and SubBasin data
<code><a href="#topic+rvn_rvh_cleanhrus">rvn_rvh_cleanhrus</a></code> for the function used to process HRU dataframe<br />
For generating blank SubBasin and HRU tables, see: <code><a href="#topic+rvn_rvh_blankSBdf">rvn_rvh_blankSBdf</a></code> and <code><a href="#topic+rvn_rvh_blankHRUdf">rvn_rvh_blankHRUdf</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Example: write a blank rvh file
## create some blank tables
sbs_data &lt;- rvn_rvh_blankSBdf(nSubBasins = 1)
hru_data &lt;- rvn_rvh_blankHRUdf(nHRUs = 3)

# write to rvh file
rvn_rvh_write(file.path(tempdir(), "Blank.rvh"),
              SBtable = sbs_data,
              HRUtable = hru_data,
              description = "Example output - Blank Watershed Discretization File",
              author = "Raven Development Team")

# Example: Read in an rvh, clean its contents and write back to new file
nith &lt;- system.file("extdata","Nith.rvh",package = "RavenR")
rvh &lt;- rvn_rvh_read(nith)

# remove HRUs covering less than 5% of the total area
rvh$HRUtable &lt;- rvn_rvh_cleanhrus(rvh$HRUtable, rvh$SBtable, area_tol = 0.05)


# write the Subbasin and HRU tables to new file using rvn_rvh_write:
rvn_rvh_write(filename=file.path(tempdir(), "Nith_cleaned_write.rvh"),
             SBtable = rvh$SBtable,
             HRUtable = rvh$HRUtable)

# write to new file, while preserving all unedited information using rvn_rvh_overwrite:
rvn_rvh_overwrite(filename=file.path(tempdir(), "Nith_cleaned_overwrite.rvh"),
                  basefile=nith,
                  SBtable = rvh$SBtable,
                  HRUtable = rvh$HRUtable)

</code></pre>

<hr>
<h2 id='rvn_rvh_query'>Queries RVH object for subbasins and HRUs of interest</h2><span id='topic+rvn_rvh_query'></span>

<h3>Description</h3>

<p>Queries the RVH object for subbasins or HRUs that are upstream of, downstream of,
or the opposite of those conditions, for a given subbasin ID.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_rvh_query(rvh = NULL, subbasinID = NULL, condition = "upstream_of")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_rvh_query_+3A_rvh">rvh</code></td>
<td>
<p>rvh object as returned by <code><a href="#topic+rvn_rvh_read">rvn_rvh_read</a></code></p>
</td></tr>
<tr><td><code id="rvn_rvh_query_+3A_subbasinid">subbasinID</code></td>
<td>
<p>subbasinID of basin of interest, as character or integer</p>
</td></tr>
<tr><td><code id="rvn_rvh_query_+3A_condition">condition</code></td>
<td>
<p>condition applied to the query</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Based on the definition of subbasins by their outlets in Raven, it is assumed here that 'upstream' includes
the specified subbasin (i.e. everything upstream of subbasin X includes subbasin X as well), and 'downstream'
of subbasin X does not include subbasin X. This is different from the default behaviour of <code>igraph</code>, which
includes the specified subbasin in either query.
</p>


<h3>Value</h3>

<p>rvhrvh object in same format, but queried to condition and all features (SBtable, HRUtable, SBnetwork) updated.
</p>


<h3>Note</h3>

<p>Raven has capabilities for creating subbasin and HRU groups that meet certain criteria as well, consider
reviewing the ':PopulateSubbasinGroup', ':PopulateHRUGroup', and other commands in Section A.3.2 of the
Raven User's Manual.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_rvh_write">rvn_rvh_write</a></code> to write contents of the generated (and usually modified HRU and SubBasin tables)
<code><a href="#topic+rvn_rvh_read">rvn_rvh_read</a></code> to read a Raven RVH file into R
</p>


<h3>Examples</h3>

<pre><code class='language-R'># load example rvh file
nith &lt;- system.file("extdata","Nith.rvh",package = "RavenR")
rvh &lt;- rvn_rvh_read(nith)

# plot full watershed with igraph library
plot(rvh$SBnetwork)

# query all subbasins upstream of basin 39, plot
rvh_upstream_of_39 &lt;- rvn_rvh_query(rvh, subbasinID=39, condition="upstream_of")
plot(rvh_upstream_of_39$SBnetwork)

# query of HRUs downstream of basin 39
rvn_rvh_query(rvh, subbasinID=39, condition="downstream_of")$SBtable

</code></pre>

<hr>
<h2 id='rvn_rvh_read'>Read Raven .rvh (watershed discretization) file</h2><span id='topic+rvn_rvh_read'></span>

<h3>Description</h3>

<p>This routine reads in a valid Raven watershed discretization (.rvh) file and returns the
information about HRUs and Subbasins as data tables. It also returns a subbasin igraph
network object which describes stream network connectivity and adds additional HRU-derived
subbasin characteristics such as total upstream area and dominant land/vegetation classes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_rvh_read(ff)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_rvh_read_+3A_ff">ff</code></td>
<td>
<p>the filepath of the .rvh file (with .rvh extension included).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The supplied file should not be comma-delimited with a trailing comma. The function also
does not like tabs in the rvh file, the file should be untabified first.
This function uses the igraph library to build the networks and compute the total upstream area.
The .rvh file can have arbitrary contents outside of the :HRUs-:EndHRUs and :SubBasins-:EndSubBasins
command blocks.
</p>
<p>Partial rvh files may be provided to this function (i.e. with only :SubBasin or :HRUs blocks but not the other),
however, some calculations and the calculation of the <code>SBnetwork</code> output will not be completed. Omitted
structures (e.g. <code>SBtable</code>) will be returned as <code>NULL</code> if the section is not found in the rvh file directly.
Note that this function does not look for additional files specified with <code>:RedirectToFile</code> commands.
</p>
<p>The ff argument can be a relative path name or absolute one.
</p>
<p>The TotalUpstreamArea is the total drainage area upstream of the given subbasin outlet. With this calculation,
headerwater subbasins will have a total upstream area equal to their own subbasin area.
</p>


<h3>Value</h3>

<p>Returns a list including:
</p>
<table>
<tr><td><code>SBtable</code></td>
<td>
<p>a data table of Subbasin characteristics indexed by Subbasin ID (SBID). Includes
the following data columns from the .rvh file : SBID, Name, Downstream_ID, Profile, ReachLength,
Gauged. The rvn_rvh_read() functions supplements this with additional columns: Area, Elevation, AvgLatit,
AvgLongit, AvgSlope, AvgAspect, DomLU, DomLUArea, DomLUFrac, DomVeg, DomVegArea, DomVegFrac.
Elevation, AvgLatit, AvgLongit, AvgSlope, and AvgAspect are the area-weighted averages from all
constituent HRUs. DomLU is the dominant land use name, DomLUArea is the area (in km2) of the
dominant land use and DomLUArea is the percentage of the basin covered with DomLU; same applies to DomVeg.</p>
</td></tr>
<tr><td><code>HRUtable</code></td>
<td>
<p>a data table of HRU characteristics, with land use and vegetation classes as factors.
Contains identical information as found in the :HRUs-:EndHRUs block of the .rvh file: ID, Area,
Elevation, Latitude, Longitude, SBID, LandUse,Vegetation, SoilProfile, Aquifer, Terrain, Slope,
and Aspect.</p>
</td></tr>
<tr><td><code>SBnetwork</code></td>
<td>
<p>an igraph network graph network describing subbasin stream network connectivity,
with nodes indexed by SBID.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>James R. Craig, University of Waterloo
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_rvh_write">rvn_rvh_write</a></code> to write contents of the generated (and usually modified HRU and SubBasin tables)
<code><a href="#topic+rvn_rvh_subbasin_network_plot">rvn_rvh_subbasin_network_plot</a></code> to plot the subbasin network
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  # load example rvh file
  nith &lt;- system.file("extdata","Nith.rvh",package = "RavenR")
  rvh &lt;- rvn_rvh_read(nith)

  # number of HRUs
  nrow(rvh$HRUtable)

  # total watershed area
  sum(rvh$HRUtable$Area)

  # sub-table of headwater basins (upstream area = subbasin area)
  rvh$SBtable$SBID[rvh$SBtable$Area == rvh$SBtable$TotalUpstreamArea]

  # sub-table of Urban HRUs
  subset(rvh$HRUtable, LandUse == "URBAN")

  # get total area upstream of subbasin containing outlet
  upstr &lt;- cumsum(rvh$SBtable$Area)
  upstr[rvh$SBtable$Downstream_ID == -1]

  # show upstream areas for each subbasin
  rvh$SBtable[,c("SBID","TotalUpstreamArea")]

  # plot network diagram using igraph library
  igraph::plot.igraph(rvh$SBnetwork)

</code></pre>

<hr>
<h2 id='rvn_rvh_subbasin_network_plot'>Basic Raven subbasin network plot</h2><span id='topic+rvn_rvh_subbasin_network_plot'></span>

<h3>Description</h3>

<p>Generates a plot of the subbasin network from rvh file information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_rvh_subbasin_network_plot(SBtable, labeled = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_rvh_subbasin_network_plot_+3A_sbtable">SBtable</code></td>
<td>
<p>a valid table of Raven subbasins, obtained from <code><a href="#topic+rvn_rvh_read">rvn_rvh_read</a></code></p>
</td></tr>
<tr><td><code id="rvn_rvh_subbasin_network_plot_+3A_labeled">labeled</code></td>
<td>
<p>TRUE if the nodes are labeled with the SubBasin ID, SBID</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Takes the information gathered from an .rvh file via the function <code><a href="#topic+rvn_rvh_read">rvn_rvh_read</a></code> and
generates a plot object of the subbasin network,
where nodes are located at SubBasin lat-long centroids, and
edge widths of the network correspond to contributing upstream area.
</p>
<p>The plot is generated using the ggplot2 library, with dependencies on igraph for handling
network information.
</p>


<h3>Value</h3>

<table>
<tr><td><code>p1</code></td>
<td>
<p>ggplot object of subbasin network plot</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>James R. Craig, University of Waterloo
</p>


<h3>Examples</h3>

<pre><code class='language-R'># read in rvh file
rvh &lt;- rvn_rvh_read(system.file("extdata","Nith.rvh", package="RavenR"))

# create network plot of watershed structure from rvh file
rvn_rvh_subbasin_network_plot(rvh$SBtable)

# include labels
rvn_rvh_subbasin_network_plot(rvh$SBtable, labeled=TRUE)

</code></pre>

<hr>
<h2 id='rvn_rvh_subbasin_visnetwork_plot'>Plot subbasin network using visNetwork</h2><span id='topic+rvn_rvh_subbasin_visnetwork_plot'></span>

<h3>Description</h3>

<p>Takes an <code>rvh</code> object generated using <code>rvn_rvh_read</code>
and returns the connections information of subbasins as an interactive visNetwork graph.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_rvh_subbasin_visnetwork_plot(rvh, groupBy = "Gauged")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_rvh_subbasin_visnetwork_plot_+3A_rvh">rvh</code></td>
<td>
<p>an <code>rvh</code> object, provided by <code>rvn_rvh_read</code></p>
</td></tr>
<tr><td><code id="rvn_rvh_subbasin_visnetwork_plot_+3A_groupby">groupBy</code></td>
<td>
<p>a character referring to one of the sub-basins attributes in the <code>rvh</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>p1returns visNetwork plot object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_rvh_read">rvn_rvh_read</a></code> to import an watershed network table from an <code>rvh</code> file.
</p>
<p>See also the <a href="http://raven.uwaterloo.ca/">Raven page</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## additional example from tutorial files (not run)
## Not run: 
  path &lt;- dirname(tempfile())
  dir.create(paste(path,"/tmp",sep=""))
  url&lt;-"http://raven.uwaterloo.ca/files/RavenOstrichTutorialFiles.zip"
  download.file(url,dest=paste(path,"/tmp/example.zip",sep=""))
  unzip(zipfile = paste(path,"/tmp/example.zip",sep=""),
        exdir = paste(path,"/tmp",sep=""))
  rvh&lt;-rvn_rvh_read(paste(path,"/tmp/Demo_C4/model/LOWRL.rvh",sep=""))
  rvn_rvh_subbasin_visnetwork_plot(rvh,groupBy="Gauged")
  rvn_rvh_subbasin_visnetwork_plot(rvh,groupBy="DomLU")
  rvn_rvh_subbasin_visnetwork_plot(rvh,groupBy="Elevation")
  
## End(Not run)

rvh &lt;- rvn_rvh_read(system.file("extdata","Nith.rvh", package="RavenR"))
rvn_rvh_subbasin_visnetwork_plot(rvh,groupBy="Gauged")
rvn_rvh_subbasin_visnetwork_plot(rvh,groupBy="Elevation")

</code></pre>

<hr>
<h2 id='rvn_rvh_summarize'>Summarize RVH object</h2><span id='topic+rvn_rvh_summarize'></span>

<h3>Description</h3>

<p>Summarizes the RVH object provided in a number of useful ways, and returns a list with the summarized information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_rvh_summarize(rvh = NULL, return_list = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_rvh_summarize_+3A_rvh">rvh</code></td>
<td>
<p>rvh object as returned by <code><a href="#topic+rvn_rvh_read">rvn_rvh_read</a></code> or <code><a href="#topic+rvn_rvh_query">rvn_rvh_query</a></code></p>
</td></tr>
<tr><td><code id="rvn_rvh_summarize_+3A_return_list">return_list</code></td>
<td>
<p>boolean whether the to return the summary list object, if <code>FALSE</code> only <code>TRUE</code> is returned (default <code>TRUE</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The total subbasin area is the total area of all subbasins in the RVH object. If there are multiple outlets
in the model, or additional subbasin information that is not part of the model domain, this will be counted in the total
area and other summary diagnostics. Consider using <code><a href="#topic+rvn_rvh_query">rvn_rvh_query</a></code> to isolate portions of the domain
in such instances.
</p>
<p>Information for dominant Terrain and Aquifer classes is also returned, but only if there are Terrain or Aquifer
classes respectively other than '[NONE]'. The number of unique HRUs include Terrain and Aquifer classes in the consideration of unique HRUs if
there are instances of classes other than '[NONE]' for these classes.
</p>


<h3>Value</h3>

<p>Returns <code>TRUE</code> if the parameter <code>return_list</code> is <code>FALSE</code>, otherwise returns a list with multiple items:
</p>
<table>
<tr><td><code>total_subbasin_area</code></td>
<td>
<p>total subbasin area, computed as the sum of all areas in <code>rvh$SBtable$Area</code></p>
</td></tr>
<tr><td><code>num_subbasins</code></td>
<td>
<p>total number of subbasins</p>
</td></tr>
<tr><td><code>num_hrus</code></td>
<td>
<p>total number of HRUs</p>
</td></tr>
<tr><td><code>num_unique_hrus</code></td>
<td>
<p>total number of unique HRUs, i.e. HRUs with unique combination of LandUse, Vegetation, Soil Profile, and Terrain/Aquifer if relevant (see details)</p>
</td></tr>
<tr><td><code>hru_summary_landuse</code></td>
<td>
<p>a dataframe summarizing the RVH object by LandUse class</p>
</td></tr>
<tr><td><code>hru_summary_vegetation</code></td>
<td>
<p>a dataframe summarizing the RVH object by Vegetation class</p>
</td></tr>
<tr><td><code>hru_summary_soilprofile</code></td>
<td>
<p>a dataframe summarizing the RVH object by Soil Profile</p>
</td></tr>
<tr><td><code>hru_summary_terrain</code></td>
<td>
<p>a dataframe summarizing the RVH object by Terrain class</p>
</td></tr>
<tr><td><code>hru_summary_aquifer</code></td>
<td>
<p>a dataframe summarizing the RVH object by Aquifer class</p>
</td></tr>
<tr><td><code>hru_summary_general</code></td>
<td>
<p>a dataframe summarizing the RVH object by LandUse, Vegetation, Soil Profile, and Terrain/Aquifer if relevant (see details)</p>
</td></tr>
<tr><td><code>dom_landuse</code></td>
<td>
<p>dominant LandUse class by total area</p>
</td></tr>
<tr><td><code>dom_landuse_ratio</code></td>
<td>
<p>ratio of the total area of dominant LandUse class by total subbasin area</p>
</td></tr>
<tr><td><code>dom_vegetation</code></td>
<td>
<p>dominant Vegetation class by total area</p>
</td></tr>
<tr><td><code>dom_vegetation_ratio</code></td>
<td>
<p>ratio of the total area of dominant Vegetation class by total subbasin area</p>
</td></tr>
<tr><td><code>dom_soilprofile</code></td>
<td>
<p>dominant Soil Profile by total area</p>
</td></tr>
<tr><td><code>dom_soilprofile_ratio</code></td>
<td>
<p>ratio of the total area of dominant Soil Profile by total subbasin area</p>
</td></tr>
<tr><td><code>dom_terrain</code></td>
<td>
<p>dominant Terrain class by total area (NULL if no Terrain classes defined)</p>
</td></tr>
<tr><td><code>dom_terrain_ratio</code></td>
<td>
<p>ratio of the total area of dominant Terrain class by total subbasin area (NA if no Terrain classes defined)</p>
</td></tr>
<tr><td><code>dom_aquifer</code></td>
<td>
<p>dominant Aquifer class by total area (NULL if no Aquifer classes defined)</p>
</td></tr>
<tr><td><code>dom_aquifer_ratio</code></td>
<td>
<p>ratio of the total area of dominant Aquifer class by total subbasin area (NA if no Aquifer classes defined)</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_rvh_read">rvn_rvh_read</a></code> to read a Raven RVH file into R
<code><a href="#topic+rvn_rvh_query">rvn_rvh_query</a></code> to query the RVH file prior to other operations, such as summarizing)
</p>


<h3>Examples</h3>

<pre><code class='language-R'># load example rvh file
nith &lt;- system.file("extdata","Nith.rvh",package = "RavenR")
rvh &lt;- rvn_rvh_read(nith)

# summarize rvh
rvn_rvh_summarize(rvh, return_list=FALSE)

# query of HRUs upstream of basin 39, then summarize
rvh %&gt;%
  rvn_rvh_query(subbasinID=39, condition="upstream_of") %&gt;%
  rvn_rvh_summarize(return_list=FALSE)

</code></pre>

<hr>
<h2 id='rvn_rvh_write_subbasingroup'>Write a subbasin group to Raven RVH format</h2><span id='topic+rvn_rvh_write_subbasingroup'></span>

<h3>Description</h3>

<p>Writes the subbasins in a given RVH object to Raven RVH format in the specified file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_rvh_write_subbasingroup(
  rvh = NULL,
  sbgroup_name = NULL,
  outfile = NULL,
  subs_per_line = 30,
  overwrite = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_rvh_write_subbasingroup_+3A_rvh">rvh</code></td>
<td>
<p>rvh object as returned by <code><a href="#topic+rvn_rvh_read">rvn_rvh_read</a></code> or <code><a href="#topic+rvn_rvh_query">rvn_rvh_query</a></code></p>
</td></tr>
<tr><td><code id="rvn_rvh_write_subbasingroup_+3A_sbgroup_name">sbgroup_name</code></td>
<td>
<p>the name of the subbasin group to write to file</p>
</td></tr>
<tr><td><code id="rvn_rvh_write_subbasingroup_+3A_outfile">outfile</code></td>
<td>
<p>the output file to write the subbasin group to</p>
</td></tr>
<tr><td><code id="rvn_rvh_write_subbasingroup_+3A_subs_per_line">subs_per_line</code></td>
<td>
<p>the number of subabsins to write per line in the file (default 30)</p>
</td></tr>
<tr><td><code id="rvn_rvh_write_subbasingroup_+3A_overwrite">overwrite</code></td>
<td>
<p>if <code>TRUE</code>, will overwrite the existing <code>outfile</code> specified if it already exists (default <code>FALSE</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Writes the subbasin group for all subbasins in the rvh$SBtable data frame to file using the ':SubbasinGroup'
command in Raven. This function is intended to be used with <code><a href="#topic+rvn_rvh_query">rvn_rvh_query</a></code> to first subset the
RVH object in order to create useful groups, though this can be done manually as well.
</p>


<h3>Value</h3>

<p>Returns <code>TRUE</code> if the file is written successfully
</p>


<h3>Note</h3>

<p>Raven has capabilities for creating subbasin and HRU groups that meet certain criteria as well, consider
reviewing the ':PopulateSubbasinGroup', ':PopulateHRUGroup', and other commands in Section A.3.2 of the
Raven User's Manual.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_rvh_read">rvn_rvh_read</a></code> to read a Raven RVH file into R
<code><a href="#topic+rvn_rvh_query">rvn_rvh_query</a></code> to query the RVH file prior to other operations, such as summarizing or writing out subbasin groups)
</p>


<h3>Examples</h3>

<pre><code class='language-R'># load example rvh file
nith &lt;- system.file("extdata","Nith.rvh",package = "RavenR")
rvh &lt;- rvn_rvh_read(nith)

# query all subbasins upstream of basin 39
rvh_upstream_of_39 &lt;- rvn_rvh_query(rvh, subbasinID=39, condition="upstream_of")

# temporary filename
tf &lt;- file.path(tempdir(), 'mysubbasigroup.rvh')

# write this subbasin group to file
rvn_rvh_write_subbasingroup(rvh=rvh_upstream_of_39, outfile=tf)

</code></pre>

<hr>
<h2 id='rvn_rvi_connections'>Generate Hydrological process connections list</h2><span id='topic+rvn_rvi_connections'></span>

<h3>Description</h3>

<p>This routine reads in a hydrologic process list from <code><a href="#topic+rvn_rvi_read">rvn_rvi_read</a></code> and generates
the list of hydrologic process connections.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_rvi_connections(
  rvi,
  ProcConDataFile = system.file("extdata", "RavenProcessConnections.dat", package =
    "RavenR")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_rvi_connections_+3A_rvi">rvi</code></td>
<td>
<p>data object generated from the <code><a href="#topic+rvn_rvi_read">rvn_rvi_read</a></code> routine</p>
</td></tr>
<tr><td><code id="rvn_rvi_connections_+3A_proccondatafile">ProcConDataFile</code></td>
<td>
<p>(optional) path to RavenProcesConnections.dat file</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Relies on a valid and up-to-date RavenProcessConnections.dat file.
This file is provided with the RavenR package, but
may be overridden by a more recent file if provided manually.
</p>


<h3>Value</h3>

<p>Returns a list with two items:
</p>
<table>
<tr><td><code>connections</code></td>
<td>
<p>a a dataframe of all of the process connections Includes the following data columns:
process type, algorithm, 'from' compartment, 'to' compartment, and conditional</p>
</td></tr>
<tr><td><code>AliasTable</code></td>
<td>
<p>a table of aliases (unchanged from the supplied <code>rvi$AliasTable</code>)</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>James R. Craig, University of Waterloo
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_rvi_read">rvn_rvi_read</a></code> to read a .rvi file and generate an rvi object, and
<code><a href="#topic+rvn_rvi_process_ggplot">rvn_rvi_process_ggplot</a></code> or <code><a href="#topic+rvn_rvi_process_diagrammer">rvn_rvi_process_diagrammer</a></code> to plot the process network produced in this function.
</p>
<p>See also the <a href="http://raven.uwaterloo.ca/">Raven page</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>rvi &lt;- rvn_rvi_read(system.file("extdata","Nith.rvi", package="RavenR"))

rvi_conn &lt;- rvn_rvi_connections(rvi)
head(rvi_conn$connections)
head(rvi_conn$AliasTable)

</code></pre>

<hr>
<h2 id='rvn_rvi_getparams'>Retrieve Parameter Information from RVI file Algorithms</h2><span id='topic+rvn_rvi_getparams'></span>

<h3>Description</h3>

<p>Reads the processed rvi object and returns a data frame of parameter information for parameters
associated with processes in the rvi object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_rvi_getparams(
  rvi,
  RavenAlgParamsFile = system.file("extdata", "RavenAlgParams.dat", package = "RavenR"),
  RavenParamsFile = system.file("extdata", "RavenParameters.dat", package = "RavenR")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_rvi_getparams_+3A_rvi">rvi</code></td>
<td>
<p>data object generated from the <code><a href="#topic+rvn_rvi_read">rvn_rvi_read</a></code> routine</p>
</td></tr>
<tr><td><code id="rvn_rvi_getparams_+3A_ravenalgparamsfile">RavenAlgParamsFile</code></td>
<td>
<p>(optional) path to RavenAlgParams.dat file</p>
</td></tr>
<tr><td><code id="rvn_rvi_getparams_+3A_ravenparamsfile">RavenParamsFile</code></td>
<td>
<p>(optional) path to RavenParameters.dat file</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Uses the Raven database files in the /extdata folder to (1) associate parameters with particular algorithms,
and (2) subset the database parameter list based on the information in the rvi file.
</p>
<p>These files are stored with the RavenR package and retrieved with this function by default,
but a separate link may be provided to a modified file if desired. Note that the database files held in the RavenR
package are unofficial copies of those in the official Raven SVN, and any discrepancies should defer to the Raven SVN versions.
</p>


<h3>Value</h3>

<p>Returns a data frame with parameter information containing the parameter name, parameter class, units, auto (whether
the parameter may be autogenerated within Raven), default, min, and max values. Note that the flags 'xxx',
-9999, and 9999 are used as missing values within the parameter data frame.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># sample workflow of rvn_rvi_read
rvi &lt;- system.file("extdata","Nith.rvi", package="RavenR") %&gt;%
rvn_rvi_read(.)

# get data frame of parameters related to processes in rvi file
rvn_rvi_getparams(rvi)

</code></pre>

<hr>
<h2 id='rvn_rvi_process_diagrammer'>Plot Raven hydrologic process network using DiagrammeR</h2><span id='topic+rvn_rvi_process_diagrammer'></span>

<h3>Description</h3>

<p>This routine takes a connections data from generated using rvn_rvi_connections()
and returns the connections information as a DiagrammeR object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_rvi_process_diagrammer(
  rvi_conn,
  sv_omit = c("SNOW_DEPTH", "COLD_CONTENT", "PONDED_WATER/SNOW_LIQ", "NEW_SNOW",
    "SNOW_DEFICIT"),
  repel_force = 0.001,
  repel_iter = 2000,
  lbl_size = 0.5,
  lbl_height = 0.3,
  lbl_width = 1,
  pdfout = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_rvi_process_diagrammer_+3A_rvi_conn">rvi_conn</code></td>
<td>
<p>a list of connections and AliasTable, provided by <code>rvn_rvi_connections</code></p>
</td></tr>
<tr><td><code id="rvn_rvi_process_diagrammer_+3A_sv_omit">sv_omit</code></td>
<td>
<p>character vector of state variables to omit from the plot</p>
</td></tr>
<tr><td><code id="rvn_rvi_process_diagrammer_+3A_repel_force">repel_force</code></td>
<td>
<p>numeric value indicating the 'force' with which the repel function will move labels</p>
</td></tr>
<tr><td><code id="rvn_rvi_process_diagrammer_+3A_repel_iter">repel_iter</code></td>
<td>
<p>the maximum number of iterations for the repel algorithm</p>
</td></tr>
<tr><td><code id="rvn_rvi_process_diagrammer_+3A_lbl_size">lbl_size</code></td>
<td>
<p>estimated height of labels, used in repel algorithm</p>
</td></tr>
<tr><td><code id="rvn_rvi_process_diagrammer_+3A_lbl_height">lbl_height</code></td>
<td>
<p>actual height of the labels (in inches)</p>
</td></tr>
<tr><td><code id="rvn_rvi_process_diagrammer_+3A_lbl_width">lbl_width</code></td>
<td>
<p>relative width of the labels (multiplier)</p>
</td></tr>
<tr><td><code id="rvn_rvi_process_diagrammer_+3A_pdfout">pdfout</code></td>
<td>
<p>name of pdf file to save the network plot to, if null no PDF is generated</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Uses the output from the <code><a href="#topic+rvn_rvi_connections">rvn_rvi_connections</a></code> function to generate the plot
with the <code>DiagrammeR</code> library.
</p>
<p>Note that the output can be plotted using the <code><a href="DiagrammeR.html#topic+render_graph">render_graph</a></code> function
in the DiagrammeR library. The outputted DiagrammeR object may also have aesthetics modified
with various commands from the
same library, if desired, as shown in the examples. The <code>rsvg</code> and <code>DiagrammeRsvg</code> packages
may be required to export to PDF with desired results,
but are not explicit dependencies of RavenR.
</p>
<p><code>sv_omit</code> is used to reduce the clutter in the process plot of state variables that
one may wish to omit from the plot.
</p>
<p>The function uses the functionality from <code>ggrepel</code> to repel labels from one another.
The degree of separation in the labels can be controlled by the <code>repel_force</code> and
<code>lbl_size</code> parameters (increasing either will increase the separation between labels).
The <code>repel_force</code> may range from approximately 1 to 1e-6. The <code>lbl_size</code> is a
relative estimate of the label height (default 0.5), which is used in estimating the label
size in the repel functionality. Providing a larger number will increase the perceived size
of the label in the repel functionality and tend towards more separation between labels, and
vice-versa. Both of these parameters may need to change depending on the plot size and number
of labels. The <code>lbl_height</code> and <code>lbl_width</code> parameters can be changed to affect
the height and relative width of the actual labels.
</p>
<p>The basic model structure outline is followed, but unrecognized state variables are plotted
on the left hand side of the plot (determined with internal RavenR function <code>rvn_rvi_process_layout</code>).
</p>


<h3>Value</h3>

<p><code>d1</code> returns DiagrammeR object. Also generates a .pdf file in working directory if
pdfplot argument is not <code>NULL</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_rvi_connections">rvn_rvi_connections</a></code> to generate connections table from an rvi object
</p>
<p><code><a href="#topic+rvn_rvi_process_ggplot">rvn_rvi_process_ggplot</a></code> to generate the structure plot using ggplot.
</p>
<p>See also the <a href="http://raven.uwaterloo.ca/">Raven page</a>. Additional details on the
<code>DiagrammeR</code> package may be found on the <a href="https://github.com/rich-iannone/DiagrammeR">Github page</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>d1 &lt;- rvn_rvi_read(system.file("extdata","Nith.rvi", package="RavenR")) %&gt;%
  rvn_rvi_connections() %&gt;%
    rvn_rvi_process_diagrammer()

# plot diagram using the DiagrammeR package
library(DiagrammeR)

d1 %&gt;%
  render_graph()

# modify default plot attributes, plot
d1 %&gt;%
  select_nodes() %&gt;%
  set_node_attrs_ws(node_attr = fillcolor, value = "hotpink") %&gt;%
  select_edges() %&gt;%
  set_edge_attrs_ws(edge_attr = style, value = "dashed") %&gt;%
  set_edge_attrs_ws(edge_attr = penwidth, value = 2) %&gt;%
  render_graph()

</code></pre>

<hr>
<h2 id='rvn_rvi_process_ggplot'>Plot Raven hydrologic process network</h2><span id='topic+rvn_rvi_process_ggplot'></span>

<h3>Description</h3>

<p>This routine takes a connections data from generated using <code>rvn_rvi_connections</code>
and returns the connections information as a network graph ggplot object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_rvi_process_ggplot(
  rvi_conn,
  sv_omit = c("SNOW_DEPTH", "COLD_CONTENT", "PONDED_WATER/SNOW_LIQ", "NEW_SNOW",
    "SNOW_DEFICIT"),
  repel_force = 0.001,
  repel_iter = 2000,
  lbl_size = 0.5,
  lbl_fill = "lightblue",
  arrow_size = 0.25,
  arrow_adj = 0.25,
  pdfout = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_rvi_process_ggplot_+3A_rvi_conn">rvi_conn</code></td>
<td>
<p>a list of connections and AliasTable, provided by <code>rvn_rvi_connections</code></p>
</td></tr>
<tr><td><code id="rvn_rvi_process_ggplot_+3A_sv_omit">sv_omit</code></td>
<td>
<p>character vector of state variables to omit from the plot</p>
</td></tr>
<tr><td><code id="rvn_rvi_process_ggplot_+3A_repel_force">repel_force</code></td>
<td>
<p>numeric value indicating the 'force' with which the repel function will move labels</p>
</td></tr>
<tr><td><code id="rvn_rvi_process_ggplot_+3A_repel_iter">repel_iter</code></td>
<td>
<p>the maximum number of iterations for the repel algorithm</p>
</td></tr>
<tr><td><code id="rvn_rvi_process_ggplot_+3A_lbl_size">lbl_size</code></td>
<td>
<p>estimated height of labels, used in repel algorithm</p>
</td></tr>
<tr><td><code id="rvn_rvi_process_ggplot_+3A_lbl_fill">lbl_fill</code></td>
<td>
<p>fill colour for labels (default 'lightblue')</p>
</td></tr>
<tr><td><code id="rvn_rvi_process_ggplot_+3A_arrow_size">arrow_size</code></td>
<td>
<p>size of plotted arrows (default 0.25)</p>
</td></tr>
<tr><td><code id="rvn_rvi_process_ggplot_+3A_arrow_adj">arrow_adj</code></td>
<td>
<p>adjustment in line length reduction for arrows (default 0.25)</p>
</td></tr>
<tr><td><code id="rvn_rvi_process_ggplot_+3A_pdfout">pdfout</code></td>
<td>
<p>name of pdf file to save the network plot to, if null no PDF is generated</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Uses the output from the <code><a href="#topic+rvn_rvi_connections">rvn_rvi_connections</a></code> function to generate the plot
with the <code>ggplot2</code> library..
</p>
<p><code>sv_omit</code> is used to reduce the clutter in the process plot of state variables that
one may wish to omit from the plot.
</p>
<p>The function uses the functionality from <code>ggrepel</code> to repel labels from one another.
The degree of separation in the labels can be controlled by the <code>repel_force</code> and
<code>lbl_size</code> parameters (increasing either will increase the separation between labels).
The <code>repel_force</code> may range from approximately 1 to 1e-6. The <code>lbl_size</code> is a
relative estimate of the label height (default 0.5), which is used in estimating the label
height in the repel functionality. Providing a larger number will increase the perceived size
of the label in the repel functionality and tend towards more separation between labels, and
vice-versa. Both of these parameters may need to change depending on the plot size and number
of labels.
</p>
<p><code>arrow_adj</code> is the amount that each line segment is reduced in length to accomodate the
arrow. Increasing this value will decrease the length of the line segment, and place the arrow
further from the box. This value should generally be similar to the <code>arrow_size</code> parameter.
</p>
<p>The basic model structure outline is followed, but unrecognized state variables are plotted
on the left hand side of the plot (determined with internal RavenR function <code>rvn_rvi_process_layout</code>).
</p>


<h3>Value</h3>

<p>p1returns ggplot object. Also generates a .pdf file in working directory if pdfplot argument is not NULL.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_rvi_connections">rvn_rvi_connections</a></code> to generate connections table from an rvi object
</p>
<p><code><a href="#topic+rvn_rvi_process_diagrammer">rvn_rvi_process_diagrammer</a></code> to generate the structure plot using DiagrammeR.
</p>
<p>See also the <a href="http://raven.uwaterloo.ca/">Raven page</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(ggplot2)

p1 &lt;- rvn_rvi_read(system.file("extdata","Nith.rvi", package="RavenR")) %&gt;%
  rvn_rvi_connections() %&gt;%
    rvn_rvi_process_ggplot()
p1 ## plot to screen

## change the colour of the background
p1 + theme(panel.background = element_rect(fill = 'lightgrey', colour = 'purple'))

## adjust line/arrow colours (no conditional lines shown in Nith example)
p1 + scale_colour_manual(values=c('FALSE'='purple', 'TRUE'='red'))

## adjust line/arrow types (no conditional lines shown in Nith example)
p1 + scale_linetype_manual(values=c('FALSE'='longdash', 'TRUE'='twodash'))

</code></pre>

<hr>
<h2 id='rvn_rvi_read'>Read Raven .rvi (watershed discretization) file</h2><span id='topic+rvn_rvi_read'></span>

<h3>Description</h3>

<p>This routine reads in a valid Raven main input (.rvi) file and returns the
information about hydrological processes as a data table.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_rvi_read(filename)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_rvi_read_+3A_filename">filename</code></td>
<td>
<p>the name of the .rvi file (with .rvi extension included), either relative
to the working directory or absolute.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function does not like tabs in the .rvi file - it should be untabified first.
Comma-delimited tables with a trailing comma are also problematic.
The .rvi file can have arbitrary contents outside of the :HydrologicProcesses-
:EndHydrologicProcesses block and :SubBasins-:EndSubBasins command blocks.
</p>


<h3>Value</h3>

<p>Returns a list with two items:
</p>
<table>
<tr><td><code>HydProcTable</code></td>
<td>
<p>a data table of hydrologic processes. Includes the following data columns:
process type, algorithm, 'from' compartment, 'to' compartment, conditional (logical), and condition (character)</p>
</td></tr>
<tr><td><code>AliasTable</code></td>
<td>
<p>a table of aliases read from the rvi file, <code>NULL</code> if no aliases are included</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>James R. Craig, University of Waterloo
</p>


<h3>Examples</h3>

<pre><code class='language-R'># sample workflow of rvn_rvi_read
rvi &lt;- system.file("extdata","Nith.rvi", package="RavenR") %&gt;%
rvn_rvi_read(.)

# get number of Hydrologic processes
nrow(rvi$HydProcTable)

</code></pre>

<hr>
<h2 id='rvn_rvi_write_template'>Write Raven rvi file based on model configuration templates</h2><span id='topic+rvn_rvi_write_template'></span>

<h3>Description</h3>

<p>Writes a Raven rvi file based on one of several template model configurations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_rvi_write_template(
  template_name = "UBCWM",
  filename = NULL,
  overwrite = TRUE,
  writeheader = TRUE,
  filetype = "rvi ASCII Raven",
  author = "RavenR",
  description = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_rvi_write_template_+3A_template_name">template_name</code></td>
<td>
<p>name of the model template to be written (default 'UBCWM')</p>
</td></tr>
<tr><td><code id="rvn_rvi_write_template_+3A_filename">filename</code></td>
<td>
<p>Name of the rvi file, with extension (optional)</p>
</td></tr>
<tr><td><code id="rvn_rvi_write_template_+3A_overwrite">overwrite</code></td>
<td>
<p>boolean whether to overwrite file if it already exists (default <code>FALSE</code>)</p>
</td></tr>
<tr><td><code id="rvn_rvi_write_template_+3A_writeheader">writeheader</code></td>
<td>
<p>boolean whether to write a header to the rvi file (default <code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="rvn_rvi_write_template_+3A_filetype">filetype</code></td>
<td>
<p>File extension, Encoding, Raven version (e.g. &quot;rvp ASCII Raven 2.9.1&quot;) (optional)</p>
</td></tr>
<tr><td><code id="rvn_rvi_write_template_+3A_author">author</code></td>
<td>
<p>Name of file author (optional)</p>
</td></tr>
<tr><td><code id="rvn_rvi_write_template_+3A_description">description</code></td>
<td>
<p>File Description for header (e.g., Basin or project information, R script name) (optional)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Raven has the capability of emulating a number of existing model configurations, and a number of additional
novel model configurations are provided which may be helpful to the user. These can be written with this function
for ease of getting started with a model using Raven.
</p>
<p>The template_name parameter should be one of &quot;UBCWM&quot;, &quot;HBV-EC&quot;, &quot;HBV-Light&quot;, &quot;GR4J&quot;,
&quot;CdnShield&quot;, &quot;MOHYSE&quot;, &quot;HMETS&quot;, &quot;HYPR&quot;, or &quot;HYMOD&quot;.
</p>
<p>This function uses the same model template files that are provided in the Raven User's manual, Appendix D.
</p>
<p>The <code><a href="#topic+rvn_write_Raven_newfile">rvn_write_Raven_newfile</a></code> is used to write a header in the rvi file. Writing of a header
can be disabled with <code>writeheader=FALSE</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>TRUE</code></td>
<td>
<p>returns <code>TRUE</code> if executed successfully</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
# write the Canadian Shield configuration to 'mymodel.rvi'
rvn_rvi_write_template(template_name="CdnShield",
   filename=file.path(tempdir(), "mymodel.rvi"))

# write the HMETS model with some additional details in the description
rvn_rvi_write_template(template_name="HMETS",
   filename=file.path(tempdir(), "mynewmodel.rvi"),
   author="Robert Chlumsky",
   description="RVI file for the HMETS model (Martel, 2017) created by RavenR")

</code></pre>

<hr>
<h2 id='rvn_rvp_fill_template'>Rewrite template rvp file with values</h2><span id='topic+rvn_rvp_fill_template'></span>

<h3>Description</h3>

<p>Rewrites a Raven template rvp file with default parameter values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_rvp_fill_template(
  rvi_file = NULL,
  rvh_file = NULL,
  rvp_template_file = NULL,
  fileprefix = NULL,
  rvp_out = NULL,
  overwrite = FALSE,
  default_param_value = 0.12345,
  default_soil_thickness = 0.5,
  use_default_flag = FALSE,
  avg_annual_runoff = NULL,
  extra_commands = NULL,
  RavenParamsFile = system.file("extdata", "RavenParameters.dat", package = "RavenR")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_rvp_fill_template_+3A_rvi_file">rvi_file</code></td>
<td>
<p>path to the model *.rvi file</p>
</td></tr>
<tr><td><code id="rvn_rvp_fill_template_+3A_rvh_file">rvh_file</code></td>
<td>
<p>path to the model *.rvh file</p>
</td></tr>
<tr><td><code id="rvn_rvp_fill_template_+3A_rvp_template_file">rvp_template_file</code></td>
<td>
<p>path to the model rvp template file (*.rvp_temp.rvp)</p>
</td></tr>
<tr><td><code id="rvn_rvp_fill_template_+3A_fileprefix">fileprefix</code></td>
<td>
<p>model name prefix for the main model files; if provided, the function will attempt to find all missing file paths in the current working directory</p>
</td></tr>
<tr><td><code id="rvn_rvp_fill_template_+3A_rvp_out">rvp_out</code></td>
<td>
<p>file path to rewritten rvp file</p>
</td></tr>
<tr><td><code id="rvn_rvp_fill_template_+3A_overwrite">overwrite</code></td>
<td>
<p>logical for whether to rewrite the *.rvp file if it already exists (default FALSE)</p>
</td></tr>
<tr><td><code id="rvn_rvp_fill_template_+3A_default_param_value">default_param_value</code></td>
<td>
<p>default parameter value to write for any parameters not found in RavenParameters.dat</p>
</td></tr>
<tr><td><code id="rvn_rvp_fill_template_+3A_default_soil_thickness">default_soil_thickness</code></td>
<td>
<p>default soil layer thickness (m) to provide in :SoilProfile block</p>
</td></tr>
<tr><td><code id="rvn_rvp_fill_template_+3A_use_default_flag">use_default_flag</code></td>
<td>
<p>writes all soil/land use/vegetation classes with [DEFAULT] flag</p>
</td></tr>
<tr><td><code id="rvn_rvp_fill_template_+3A_avg_annual_runoff">avg_annual_runoff</code></td>
<td>
<p>adds a line for :AvgAnnualRunoff if value provided with this parameter and not already in file</p>
</td></tr>
<tr><td><code id="rvn_rvp_fill_template_+3A_extra_commands">extra_commands</code></td>
<td>
<p>additional commands to add to end of rvp file as character vector</p>
</td></tr>
<tr><td><code id="rvn_rvp_fill_template_+3A_ravenparamsfile">RavenParamsFile</code></td>
<td>
<p>path to RavenParameters.dat file (default path points to file included with RavenR installation)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The Raven rvp template file is generated by Raven when the :CreateRVPTemplate command is included in the
rvi file (the default when <code><a href="#topic+rvn_rvi_write_template">rvn_rvi_write_template</a></code> is used to produce an rvi file). This
template file displays the layout of the rvp file with required parameters based on the hydrologic processes
in the rvi file, but is not immediately usable. This function uses the soil model information in the rvi file
and the HRU class information in the rvh file to rewrite the template file with default parameter values so that
it can be used in a model run.
</p>
<p>If <code>rvp_out</code> is not provided, Raven will attempt to write to the file prefix of the provided template file with a .rvp extension.
If there is a conflict with an existing file and <code>overwrite==FALSE</code>, the function will automatically overwrite a file
with the suffix &quot;_ravenr_generated.rvp&quot;.
</p>
<p>The default parameter values come from the RavenParameters.dat file included with RavenR in the extdata folder. The
user may provide their own file with updated values if preferred. Note that the database files held in the RavenR
package are unofficial copies of those in the official Raven SVN, and any discrepancies should defer to the Raven SVN versions.
</p>
<p>Any parameters not found in this file will be written
with the value provided by <code>default_param_value</code>. The default soil thickness for the :SoilProfiles block is provided
by the <code>default_soil_thickness</code> function parameter, which is applied for all soil classes.
</p>
<p>As an alternative to specifying the three input files (rvi, rvh, rvp_temp.rvp), the <code>fileprefix</code> of the model (e.g.
'Nith' for Nith.rvi) may be provided instead. If provided, the function will attempt to find all required input files based on
the provided fileprefix in the current working directory.
</p>
<p>Additional commands can be added to the end of the rvp file with <code>extra_commands</code>, which are not quality controlled but
simply appended to the rvp file. This can be useful for non-standard commands such as :RedirectToFile for channel properties rvp files
that are not added automatically to base templates rvp files.
</p>
<p>If you find parameters not found by this function, please open an ticket on Github (<a href="https://github.com/rchlumsk/RavenR/issues">https://github.com/rchlumsk/RavenR/issues</a>).
</p>


<h3>Value</h3>

<p><code>TRUE</code> if the function executed successfully
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_rvi_getparams">rvn_rvi_getparams</a></code> to get parameter ranges from rvi.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
### this section is not run, but illustrates how an rvp template file would be created
# -----
## Not run: 
## create an rvi file and template file with Raven
rvn_rvi_write_template(modelname="HBV-EC",
   filename="nithmodel.rvi")

## download Raven.exe if not already downloaded
if (!rvn_download(check=TRUE)) {
  rvn_download()
}

## run Raven to create template file
rvn_run(fileprefix="nithmodel")

## End(Not run)
# -----

# load pre-generated template file and other model files
nithmodel_template_file &lt;- system.file("extdata","nithmodel.rvp_temp.rvp", package="RavenR")
nith_rvi_file &lt;- system.file("extdata","Nith.rvi", package="RavenR")
nith_rvh_file &lt;- system.file("extdata","Nith.rvh", package="RavenR")
rvp_out_file &lt;- file.path(tempdir(), 'nithmodel.rvp')

# rewrite template with parameter values
rvn_rvp_fill_template(rvi_file=nith_rvi_file,
                      rvh_file=nith_rvh_file,
                      rvp_template_file=nithmodel_template_file,
                      rvp_out=rvp_out_file)

</code></pre>

<hr>
<h2 id='rvn_rvt_mappings_data'>Rvt Mappings Data</h2><span id='topic+rvn_rvt_mappings_data'></span>

<h3>Description</h3>

<p>A list of lists that has information for use in the RavenR rvt-related files.
</p>
<p>Additional information on Raven variables can be found in the Raven User's Manual, available from
<a href="http://raven.uwaterloo.ca/Downloads.html">http://raven.uwaterloo.ca/Downloads.html</a>
</p>


<h3>Format</h3>

<p><code>rvn_rvt_mappings_data</code> is a list with four lists.
</p>

<dl>
<dt>rvt_mapping</dt><dd><p>list: data formats for all rvt file types</p>
</dd>
<dt>rvt_data_type_mapping</dt><dd><p>list: data types permitted in Raven, and associated units</p>
</dd>
<dt>rvn_met_raven_mapping</dt><dd><p>list: meteorological forcing functions permitted in Raven, and associated units</p>
</dd>
<dt>rvt_met_mapping_weathercan</dt><dd><p>list: mapping of weathercan variable names to Raven variables</p>
</dd>
</dl>



<h3>See Also</h3>

<p><code><a href="#topic+rvn_rvt_read">rvn_rvt_read</a></code> for reading in rvt files
</p>
<p><code><a href="#topic+rvn_rvt_write">rvn_rvt_write</a></code> and <code><a href="#topic+rvn_rvt_write_met">rvn_rvt_write_met</a></code> for writing data to rvt files.
</p>

<hr>
<h2 id='rvn_rvt_read'>Read .rvt (Raven time series) file</h2><span id='topic+rvn_rvt_read'></span>

<h3>Description</h3>

<p>This routine reads in a valid Raven time series input (.rvt) file and returns the
information as an xts time series and metadata data frame.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_rvt_read(filename, tzone = "UTC")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_rvt_read_+3A_filename">filename</code></td>
<td>
<p>path/name of the .rvt file (with .rvt extension included)</p>
</td></tr>
<tr><td><code id="rvn_rvt_read_+3A_tzone">tzone</code></td>
<td>
<p>string indicating the timezone of the data provided in filename (default &quot;UTC&quot;)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>All rvt data types available in Raven are supported (e.g. :MultiData, :Data, :ObservedData,
:BasinInflowHydrograph). This is handled by the mappings provided in the <code>data("rvn_rvt_mappings_data")</code>
function, and additional support for other rvt types can likely be included by making updates
to that function with modifications to the somewhat generic read function here.
</p>
<p>It does NOT support the master .rvt file with :Gauge or :GriddedForcing commands, only the
reading of time-series based .rvt files with a single time series block within the file.
</p>
<p>The timezone is provided by the tzone argument as &quot;UTC&quot; by default, and should be adjusted by
the user to the local time zone as needed, based on the model run.
</p>


<h3>Value</h3>

<p>Returns a list with two objects:
</p>
<table>
<tr><td><code>rvt_xts</code></td>
<td>
<p>xts formatted time series with data</p>
</td></tr>
<tr><td><code>rvt_metadata</code></td>
<td>
<p>data frame with a 'param' and 'value' column providing rvt metadata (number of points, time interval, subbasin ID, etc.)</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'># read in rvt file
system.file('extdata','GlenAllan.rvt',package="RavenR") %&gt;%
rvn_rvt_read(.) -&gt; rvt
plot(rvt$rvt_xts$TEMP_DAILY_MIN)

</code></pre>

<hr>
<h2 id='rvn_rvt_tidyhydat'>EC Streamgauge File Conversion from tidyhydat</h2><span id='topic+rvn_rvt_tidyhydat'></span>

<h3>Description</h3>

<p>rvn_rvt_tidyhydat converts Environment Canada historical streamgauge data,
accessed via the tidyhydat package, into .rvt format files usable in
Raven.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_rvt_tidyhydat(
  indata,
  rvt_type = "ObservationData",
  data_type = "HYDROGRAPH",
  subIDs,
  prd = NULL,
  stnNames = NULL,
  write_redirect = FALSE,
  flip_number = FALSE,
  rd_file = "flow_stn_redirect_text.rvt",
  filename = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_rvt_tidyhydat_+3A_indata">indata</code></td>
<td>
<p>tibble of WSC flow data from tidyhydat's hy_daily_flows() function</p>
</td></tr>
<tr><td><code id="rvn_rvt_tidyhydat_+3A_rvt_type">rvt_type</code></td>
<td>
<p>type of rvt file to write (e.g. ObservationData, BasinInflowHydrograph, etc.)</p>
</td></tr>
<tr><td><code id="rvn_rvt_tidyhydat_+3A_data_type">data_type</code></td>
<td>
<p>Raven-syntax data type for flow data (default 'HYDROGRAPH')</p>
</td></tr>
<tr><td><code id="rvn_rvt_tidyhydat_+3A_subids">subIDs</code></td>
<td>
<p>vector of subbasin IDs to correspond to the stations in indata</p>
</td></tr>
<tr><td><code id="rvn_rvt_tidyhydat_+3A_prd">prd</code></td>
<td>
<p>(optional) data period to use in .rvt file</p>
</td></tr>
<tr><td><code id="rvn_rvt_tidyhydat_+3A_stnnames">stnNames</code></td>
<td>
<p>(optional) character vector of alternative station names to use</p>
</td></tr>
<tr><td><code id="rvn_rvt_tidyhydat_+3A_write_redirect">write_redirect</code></td>
<td>
<p>(optional) write the :RedirectToFile commands in a separate .rvt file</p>
</td></tr>
<tr><td><code id="rvn_rvt_tidyhydat_+3A_flip_number">flip_number</code></td>
<td>
<p>(optional) put the subID first in the .rvt filename</p>
</td></tr>
<tr><td><code id="rvn_rvt_tidyhydat_+3A_rd_file">rd_file</code></td>
<td>
<p>(optional) name of the redirect file created (if <code>write_redirect=TRUE</code>)</p>
</td></tr>
<tr><td><code id="rvn_rvt_tidyhydat_+3A_filename">filename</code></td>
<td>
<p>specified name of file(s) to write to (optional)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Takes a single flow tibble generated from tidyhydat and converts the flow data for
each station in the file into .rvt formatted files for a Raven model. If
multiple stations exist in indata, multiple observation files are created. This function
is a wrapper for <code>rvn_rvt_write</code>, with the benefit of automatically parsing the
tidyhydat download for possibly multiple stations in xts formats before passing
to the rvt writing function.
</p>
<p>rvt_type is the specified rvt file type to write to (see the Raven User's Manual
or the <code>rvn_rvt_mappings</code> function for more rvt types). This should be a flow-based
rvt type, such as ObservationData, BasinInflowHydrograph, ReservoirExtraction, etc.
Most applications of this will likely write the tidyhydat observations as
ObservedData for use in model evaluation to historic records.
</p>
<p>data_type is the type of Raven input data type, likely 'HYDROGRAPH', for the corresponding
flow data. If the flow is used as a reservoir-related flow, the data_type may be
RESERVOIR_INFLOW or RESERVOIR_NETINFLOW.
</p>
<p>subIDs is required and should correspond to the subID to be used in the .rvt
file for each station in the ff file, in the order in which it will be read
in.
</p>
<p>prd is used by the xts formatted-data to restrict the data reported in .rvt
files, for each station, to this period. The prd should be defined in
&quot;YYYY-MM-DD/YYYY-MM-DD&quot; string format. If the period supplied results in an
empty time series (i.e. non-overlapping time periods), an error will be
thrown.
</p>
<p>stnNames is an optional character vector to replace the EC station codes
found in the HYDAT database. If supplied, the vector must be of the same length
as the number of stations supplied and the subIDs vector. If not supplied,
the EC station codes will be used. Note that this does not impact model
function, only filename readability and station recognition.
</p>
<p>write_redirect will print out the :RedirectToFile commands in a separate
file called, &quot;flow_stn_redirect_text.rvt&quot;. These commands can be copied into
the main model's .rvt file to redirect to the produced time series files.
</p>
<p>flip_number is a useful option to place the subID first in the filename.
This is often cleaner for organizing files in a folder, since the
alphabetized order is not dependent on the station name, and the observed
files will be in one set.
</p>
<p>The function will write to name generated from the station name(s), otherwise
the .rvt filename may be specified with the filename argument (full path to
the filename, including .rvt extension). If multiple stations are provided,
the filename argument may be a vector of filenames.
</p>
<p>Note that the function uses
<code>sort(unique(indata$STATION_NUMBER))</code> to determine the order of stations,
thus the filenames and stnNames should correspond to the sorted vector of station numbers as well.
</p>
<p>Note that only daily flow data is supported, as tidyhydat only allows for the
download of daily (or coarser resolution) flow data. Hourly data that is obtained
must be first processed into xts format and then written with <code><a href="#topic+rvn_rvt_write">rvn_rvt_write</a></code>.
</p>
<p>If the data is found to have an inconsistent timestep, the function will attempt to correct it
by infilling missing time steps with <code><a href="#topic+rvn_ts_infill">rvn_ts_infill</a></code>. If successful, a warning is issued
to the user and the function will proceed, else an error will be raised.
</p>


<h3>Value</h3>

<table>
<tr><td><code>TRUE</code></td>
<td>
<p>return TRUE if the function is executed properly</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
# note: example modified to avoid using tidyhydat directly, uses saved
## tidyhydat data from RavenR package sample data
# library(tidyhydat)
stations &lt;- c("05CB004","05CA002")

# Gather station data/info using tidyhydat functions
# hd &lt;- tidyhydat::hy_daily_flows(station_number = stations,
#  start_date = "1996-01-01", end_date = "1997-01-01")
data(rvn_tidyhydat_sample)
hd &lt;- rvn_tidyhydat_sample

# station_info &lt;- hy_stations(stations)

tf1 &lt;- file.path(tempdir(), "station1.rvt")
tf2 &lt;- file.path(tempdir(), "station2.rvt")

# Create RVT files
rvn_rvt_tidyhydat(hd, subIDs=c(3,11),
  filename=c(tf1,tf2))

</code></pre>

<hr>
<h2 id='rvn_rvt_write'>Write Raven rvt file from Time Series</h2><span id='topic+rvn_rvt_write'></span>

<h3>Description</h3>

<p>Generates a Raven rvt file of the specified type from an xts time series.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_rvt_write(
  x,
  filename = NULL,
  rvt_type = "ObservationData",
  data_type = "HYDROGRAPH",
  basin_ID = NULL,
  NA_value = -1.2345
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_rvt_write_+3A_x">x</code></td>
<td>
<p>time series in xts format to write to file</p>
</td></tr>
<tr><td><code id="rvn_rvt_write_+3A_filename">filename</code></td>
<td>
<p>name of output file (with rvt extension)</p>
</td></tr>
<tr><td><code id="rvn_rvt_write_+3A_rvt_type">rvt_type</code></td>
<td>
<p>type of rvt file to write (e.g. ObservationData)</p>
</td></tr>
<tr><td><code id="rvn_rvt_write_+3A_data_type">data_type</code></td>
<td>
<p>type of data in x (e.g. HYDROGRAPH)</p>
</td></tr>
<tr><td><code id="rvn_rvt_write_+3A_basin_id">basin_ID</code></td>
<td>
<p>subbasin (or HRU) ID corresponding to the time series</p>
</td></tr>
<tr><td><code id="rvn_rvt_write_+3A_na_value">NA_value</code></td>
<td>
<p>value to use for NA values in rvt file (default -1.2345 for Raven format)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Writes the rvt file for a given time series dataset. The type of rvt file to write is
determined by the rvt_type argument, which must match one of the supported Raven types.
Note that this function does not support the writing of meteorological data, this is handled
by the <code>rvn_rvt_write_met</code> function.
</p>
<p>The format of the rvt file, including required fields to write to file, are determined from
the supplied rvt_type parameter and from the mapping provided by <code>data("rvn_rvt_mappings_data")</code>. The
data_type is also checked against the provided mappings to check for valid state variables and
accompanying units.
</p>
<p>If the data is found to have an inconsistent timestep, the function will attempt to correct it
by infilling missing time steps with <code><a href="#topic+rvn_ts_infill">rvn_ts_infill</a></code>. If successful, a warning is issued
to the user and the function will proceed, else an error will be raised.
</p>
<p>The timezone of the xts object is used as supplied to write to file, no assumption on changing the
time zone is done in this function.
</p>
<p>No other quality control of the data is performed here. Some rvt types, such as ObservationWeights,
cannot have missing values in the data; it is the responsibility of the user to supply <code>x</code> with
no missing values if required. Any missing values in <code>x</code> are written to file with the
missing value code provided by <code>NA_value</code>.
</p>
<p><code>x</code> should be an xts time series object with multiple rows of data and a single column.
</p>


<h3>Value</h3>

<p><code>TRUE</code> if the function executed successfully
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_rvt_read">rvn_rvt_read</a></code> to read in rvt data files,
and <code>rvn_rvt_write_met</code> to write meteorological rvt files.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# load sample flow data
system.file('extdata','run1_Hydrographs.csv', package = "RavenR") %&gt;%
rvn_hyd_read() -&gt; mydata

# temporary filename
tf &lt;- file.path(tempdir(), 'mydata.rvt')

# write time series to rvt file using data from subbasin 36 as observed data
rvn_rvt_write(x=mydata$hyd$Sub36,
  rvt_type = "ObservationData",
  data_type = "HYDROGRAPH",
  basin_ID = 36,
  filename = tf)

</code></pre>

<hr>
<h2 id='rvn_rvt_write_met'>EC Climate Station File Conversion</h2><span id='topic+rvn_rvt_write_met'></span>

<h3>Description</h3>

<p>Converts meteorological data for a given station into the
Raven .rvt format.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_rvt_write_met(
  metdata,
  rvt_met_mapping = NULL,
  filenames = NULL,
  met_file_prefix = "met_",
  prd = NULL,
  write_stndata = TRUE,
  write_redirect = TRUE,
  filename_stndata = "met_stndata.rvt",
  NA_value = -1.2345
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_rvt_write_met_+3A_metdata">metdata</code></td>
<td>
<p>EC meteorological data from one or more stations (e.g., from <code>weathercan::weather_dl()</code>)</p>
</td></tr>
<tr><td><code id="rvn_rvt_write_met_+3A_rvt_met_mapping">rvt_met_mapping</code></td>
<td>
<p>list that provides the mapping between metdata names and those used in Raven</p>
</td></tr>
<tr><td><code id="rvn_rvt_write_met_+3A_filenames">filenames</code></td>
<td>
<p>(optional) character vector of filenames for the rvt data files, length same as number of stations in metdata</p>
</td></tr>
<tr><td><code id="rvn_rvt_write_met_+3A_met_file_prefix">met_file_prefix</code></td>
<td>
<p>(optional) prefixes the file name (default: &quot;met_&quot;)</p>
</td></tr>
<tr><td><code id="rvn_rvt_write_met_+3A_prd">prd</code></td>
<td>
<p>(optional) data period to use in .rvt file</p>
</td></tr>
<tr><td><code id="rvn_rvt_write_met_+3A_write_stndata">write_stndata</code></td>
<td>
<p>(optional) write the gauge data to a separate .rvt file</p>
</td></tr>
<tr><td><code id="rvn_rvt_write_met_+3A_write_redirect">write_redirect</code></td>
<td>
<p>(optional) write the :RedirectToFile commands in a
separate .rvt file</p>
</td></tr>
<tr><td><code id="rvn_rvt_write_met_+3A_filename_stndata">filename_stndata</code></td>
<td>
<p>(optional) name of the station data file created (if <code>write_stndata=TRUE</code>)</p>
</td></tr>
<tr><td><code id="rvn_rvt_write_met_+3A_na_value">NA_value</code></td>
<td>
<p>(optional) value to use for NA values in rvt file (default -1.2345 for Raven format)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Writes data in either :Data or :MultiData format depending on the number of
supported parameter columns provided. The data should be downloaded and prepared
with missing days included, and preferably is downloaded directly using <code>weathercan</code>.
</p>
<p>metdata contains all of the meteorological data to be written to file. metdata should be
in a tibble or data frame format, and is required to have a date/time column (either DATE,
TIME, or DATETIME, all of which have at least a Date component), the STATION_NAME,
and all desired forcings to be written to file. If the columns ELEV, LAT, LON are included,
the station meta data may be written to a separate rvt file as well (see below). All supported
data columns in metdata are written into rvt format, so the desired columns
for the rvt file should be passed through metdata and filtered first if needed.
</p>
<p>rvt_met_mapping is a list that maps the metdata column names to Raven variables. If
<code>weathercan</code> is used then this may be left NULL, as the mapping is automatically provided.
Otherwise, the user must convert all desired column names to Raven-recognized names, or
provide the mapping information as a list through this parameter. An example format can be seen
(the mapping used for weathercan by default) in <code>data("rvn_rvt_mappings_data")</code>.
</p>
<p>filenames may be used to provide the specific desired filenames (with paths) for each
station rvt data file being generated; this should be a character vector of length
equal to the number of unique station names in the data.
</p>
<p>Note that the function uses
<code>sort(unique(metdata$STATION_NAME))</code> to determine the order of stations,
thus the filenames should correspond to the sorted vector of station numbers as well.
</p>
<p>prd is used by the xts formatted-data to restrict the data reported in .rvt
files, for each station, to this period. The prd should be defined in
&quot;YYYY-MM-DD/YYYY-MM-DD&quot; string format. If the period supplied results in an
empty time series (i.e. non-overlapping time periods), an error will be
thrown.
</p>
<p>met_file_prefix can be used to add a prefix to the .rvt data file names, (&quot;met_&quot; by default)
which may be useful in organizing multiple climate data files. This is ignored
if filenames are specified.
</p>
<p>write_stndata wil print out the gauge(s) metadata to file (specified by
filename_stndata parameter) in the .rvt format, which is required to include a
meterological station in Raven. The function will append to the file if it already exists, meaning
that this works for iterations of this function. metdata must include the columns
ELEV, LAT, and LON if station data is to be written, else the meta data file will not be created.
</p>
<p>write_redirect will print out the :RedirectToFile commands into the file specified
by filename_stndata, if write_stndata is <code>TRUE</code>. These commands can be copied into the main model's
.rvt file to redirect to the produced time series files. The function will
append to the file if it already exists, meaning that this works for
iterations of this function.
</p>
<p>The function has several built-in data quality checks. These include:
</p>
<p>* checking that the time interval is consistent for each station;
* ensuring that meta data is unique for each station name; and
* check for missing data and issuing a warning that post-processing will be required
</p>
<p>Data quality is not assessed in this package, such as consistency between
minimum and maximum temperatures and missing data. Consider viewing the RavenR.extras package for
functions to interpolate missing meteorological data and checking for min/max temperature consistency.
</p>
<p>This function is designated to use data from the weathercan package, but may be used with any
supplied data frame of meteorological information if in the correct format and other
relevant information (such as rvt_met_mapping, if needed) is supplied. The
weathercan package is external to RavenR and is not an explicit dependency
of RavenR, although a sample weathercan data set can be viewed as <code>data(rvn_weathercan_sample)</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>TRUE</code></td>
<td>
<p>return <code>TRUE</code> if the function is executed properly</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_rvt_write">rvn_rvt_write</a></code> to write non-forcing time series data to Raven rvt format.
</p>
<p>Download Environment Canada Historical weather data from (climate.weather.gc.ca), or use the
'weathercan' package to access this data through R.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># note: example modified to avoid using weathercan directly, uses saved
## weathercan data from RavenR package sample data
data(rvn_weathercan_sample)
kam &lt;- rvn_weathercan_sample

# basic use, override filename to temporary file
rvn_rvt_write_met(metdata = kam,
  filenames = file.path(tempdir(), "rvn_rvt_metfile.rvt"),
  filename_stndata = file.path(tempdir(), "met_stndata.rvt"))

</code></pre>

<hr>
<h2 id='rvn_stringpad'>Pads string with spaces, either right or left justified</h2><span id='topic+rvn_stringpad'></span>

<h3>Description</h3>

<p>Pad string with spaces, justified on either the left or right
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_stringpad(string, width, just = "r", padstring = " ")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_stringpad_+3A_string">string</code></td>
<td>
<p>Text string</p>
</td></tr>
<tr><td><code id="rvn_stringpad_+3A_width">width</code></td>
<td>
<p>Number of characters total, including desired spaces</p>
</td></tr>
<tr><td><code id="rvn_stringpad_+3A_just">just</code></td>
<td>
<p>'r' for right, 'l' for left</p>
</td></tr>
<tr><td><code id="rvn_stringpad_+3A_padstring">padstring</code></td>
<td>
<p>string to use for padding (default space character)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Padded string
</p>


<h3>Author(s)</h3>

<p>Leland Scantlebury, <a href="mailto:leland@scantle.com">leland@scantle.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Returns "   To the right"
rvn_stringpad('To the right', 15, just='r')

# Returns "Padded    "
rvn_stringpad('Padded', 10, just='l')
</code></pre>

<hr>
<h2 id='rvn_substrLeft'>substring from the Left</h2><span id='topic+rvn_substrLeft'></span>

<h3>Description</h3>

<p>Returns n characters from the left side of the supplied string x.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_substrLeft(x, n)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_substrLeft_+3A_x">x</code></td>
<td>
<p>a string to manipulate</p>
</td></tr>
<tr><td><code id="rvn_substrLeft_+3A_n">n</code></td>
<td>
<p>number of characters to remove from the left side of the string</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_substrRight">rvn_substrRight</a></code> for using n characters from right side of string
</p>
<p><code><a href="#topic+rvn_substrMRight">rvn_substrMRight</a></code> for removing n characters from the right side of a string
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
rvn_substrLeft("hello world",3)
# returns "hel"

</code></pre>

<hr>
<h2 id='rvn_substrMLeft'>substring minus characters from the Left</h2><span id='topic+rvn_substrMLeft'></span>

<h3>Description</h3>

<p>Returns a string x with n characters removed from the left side
of the string.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_substrMLeft(x, n)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_substrMLeft_+3A_x">x</code></td>
<td>
<p>a string to manipulate</p>
</td></tr>
<tr><td><code id="rvn_substrMLeft_+3A_n">n</code></td>
<td>
<p>number of characters to remove from the left side of the string</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_substrRight">rvn_substrRight</a></code> for using n characters from the right
side of string,
</p>
<p><code><a href="#topic+rvn_substrLeft">rvn_substrLeft</a></code> for using n characters from the left side of
string
</p>
<p><code><a href="#topic+rvn_substrMRight">rvn_substrMRight</a></code> for removing n characters from the right side of
a string
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
rvn_substrMLeft("hello world",3)
# returns "lo world"

</code></pre>

<hr>
<h2 id='rvn_substrMRight'>substring minus characters from the Right</h2><span id='topic+rvn_substrMRight'></span>

<h3>Description</h3>

<p>Returns a string x with n characters removed from the right
side of the string.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_substrMRight(x, n)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_substrMRight_+3A_x">x</code></td>
<td>
<p>a string to manipulate</p>
</td></tr>
<tr><td><code id="rvn_substrMRight_+3A_n">n</code></td>
<td>
<p>number of characters to remove from the right side of the string</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_substrRight">rvn_substrRight</a></code> for using n characters from the right
side of string
</p>
<p><code><a href="#topic+rvn_substrLeft">rvn_substrLeft</a></code> for using n characters from the left side of
string
</p>
<p><code><a href="#topic+rvn_substrMLeft">rvn_substrMLeft</a></code> for removing n characters from the left side of a
string
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
rvn_substrMRight("hello world",3)
# returns "hello wo"

</code></pre>

<hr>
<h2 id='rvn_substrRight'>substring from the Right</h2><span id='topic+rvn_substrRight'></span>

<h3>Description</h3>

<p>Returns n characters from the right side of the supplied string
x.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_substrRight(x, n)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_substrRight_+3A_x">x</code></td>
<td>
<p>a string to manipulate</p>
</td></tr>
<tr><td><code id="rvn_substrRight_+3A_n">n</code></td>
<td>
<p>number of characters to use from the right side of the string</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_substrLeft">rvn_substrLeft</a></code> for using n characters from the left side
of string
</p>
<p><code><a href="#topic+rvn_substrMRight">rvn_substrMRight</a></code> for removing n characters from the right side of
a string
</p>
<p><code><a href="#topic+rvn_substrMLeft">rvn_substrMLeft</a></code> for removing n characters from the left side of a
string
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
rvn_substrRight("hello world",3)
# returns "rld"

</code></pre>

<hr>
<h2 id='rvn_theme_RavenR'>RavenR ggplot theme</h2><span id='topic+rvn_theme_RavenR'></span>

<h3>Description</h3>

<p>Makes the general Raven R Theme for all ggplots
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_theme_RavenR()
</code></pre>


<h3>Details</h3>

<p>Sets up the default theme for all ggplots generated using a
built in Raven R function. Made by adjusting the built in <code>theme_bw</code>.
</p>


<h3>Value</h3>

<p>returns a theme for use in ggplot2 figures
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_annual_volume">rvn_annual_volume</a></code> to create a scatterplot of annual flow
volumes.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># generate a basic ggplot and apply the RavenR theme
library(ggplot2)
ggplot(data=cars, aes(x=speed, y=dist))+
geom_point()+
rvn_theme_RavenR()

</code></pre>

<hr>
<h2 id='rvn_tidyhydat_sample'>tidyhydat sample data for RavenR package</h2><span id='topic+rvn_tidyhydat_sample'></span>

<h3>Description</h3>

<p>A dataset downloaded using the tidyhydat package for two stations, between 1996-01-01 and
1997-01-01. Additional details on the tidyhydat package and data formats can be found at the
<a href="https://github.com/ropensci/tidyhydat">tidyhydat github page</a>.
</p>
<p>Note that this sample is provided to avoid loading the tidyhydat package and requiring the download_hydat()
function in CRAN testing of examples.
</p>
<p>Additional information on data provided by the Water Survey of Canada may be found on the WSC webpage.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_tidyhydat_sample
</code></pre>


<h3>Format</h3>

<p>rvn_tidyhydat_sample is a tibble with 671 rows, and 5 columns.
</p>

<dl>
<dt>STATION_NUMBER</dt><dd><p>station number from WSC stations in HYDAT database</p>
</dd>
<dt>Date</dt><dd><p>date in YYYY-MM-DD format</p>
</dd>
<dt>Parameter</dt><dd><p>Code indicating the parameter provided in the given row as either flow or level data</p>
</dd>
<dt>Value</dt><dd><p>the value of the parameter provided (flow or level)</p>
</dd>
<dt>Symbol</dt><dd><p>additional data flags provided by WSC</p>
</dd>
</dl>



<h3>Source</h3>

<p>Water Survey of Canada (wateroffice.ec.gc.ca) via 'tidyhydat' package
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_rvt_tidyhydat">rvn_rvt_tidyhydat</a></code> for writing rvt files from tidyhydat data
</p>

<hr>
<h2 id='rvn_ts_infill'>Infill discontinuous time series with blank values</h2><span id='topic+rvn_ts_infill'></span>

<h3>Description</h3>

<p>Infills missing time values from a time series based on a regular interval.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_ts_infill(ts)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_ts_infill_+3A_ts">ts</code></td>
<td>
<p>valid xts time series</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Takes xts dataset, finds minimum interval between time stamps and
returns a new regular interval xts with same data content, but <code>NA</code> values in between known
data values
</p>
<p>Only handles data with minimum time interval of 1 day; 1,2,3,4,6,8, or 12 hrs.
</p>
<p>Note that in default reading in of date/time data, the daylight savings timezones may be assigned
to the date/time when reading in a data file with Raven using functions such as <code><a href="#topic+rvn_hyd_read">rvn_hyd_read</a></code>. This
function will then detect differences in the intervals and throw an error. To avoid this, the
timezone may be assigned explicitly to all values with the read function and all daylight savings/endings
will be ignored.
</p>


<h3>Value</h3>

<table>
<tr><td><code>ts</code></td>
<td>
<p>continuous xts time series</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>James R. Craig, University of Waterloo
</p>


<h3>Examples</h3>

<pre><code class='language-R'>system.file("extdata","run1_Hydrographs.csv", package="RavenR") %&gt;%
rvn_hyd_read(., tzone="EST") -&gt; mydata
mydata &lt;- mydata$hyd$precip
mydata&lt;-mydata[-seq(2,nrow(mydata),3),] # remove every 3rd day
head(mydata)

# fill back with rvn_ts_infill using NA values
rvn_ts_infill(mydata$precip) %&gt;%
head()

</code></pre>

<hr>
<h2 id='rvn_watershed_data'>Watershed Storage Data from Raven</h2><span id='topic+rvn_watershed_data'></span>

<h3>Description</h3>

<p>A dataset formatted to the xts package, read in by the watershed.read function.
The dataset contains the typical columns from the Raven outputted
WatershedStorage.csv file, available for download in the Raven
Tutorials (linked below).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_watershed_data
</code></pre>


<h3>Format</h3>

<p>rvn_watershed_data is a data frame with two object
</p>

<dl>
<dt>watershed.storage</dt><dd><p>various storage variable states outputted from the
Raven model</p>
</dd>
<dt>units</dt><dd><p>units associated with each variable in watershed.storage</p>
</dd>
</dl>

<p>rvn_watershed_data$watershed.storage is an xts (time series) object with 731 rows and
19 variables, containing data from 2002-10-01 to 2004-09-30. The details of
each watershed storage state can be found in the Raven Manual
</p>

<ul>
<li><p>rainfall
</p>
</li>
<li><p>snowfall
</p>
</li>
<li><p>Channel.Storage
</p>
</li>
<li><p>Reservoir.Storage
</p>
</li>
<li><p>Rivulet.Storage
</p>
</li>
<li><p>Surface.Water
</p>
</li>
<li><p>Cum..Losses.to.Atmosphere..mm.
</p>
</li>
<li><p>Ponded.Water
</p>
</li>
<li><p>Soil.Water.0
</p>
</li>
<li><p>Soil.Water.1
</p>
</li>
<li><p>Soil.Water.2
</p>
</li>
<li><p>Snow.Melt..Liquid..mm.
</p>
</li>
<li><p>Snow
</p>
</li>
<li><p>Canopy
</p>
</li>
<li><p>Canopy.Snow
</p>
</li>
<li><p>Total
</p>
</li>
<li><p>Cum..Inputs..mm.
</p>
</li>
<li><p>Cum..Outflow..mm.
</p>
</li>
<li><p>MB.Error
</p>
</li></ul>

<p>The Nith River model can be downloaded from the Raven Tutorials (tutorial #2)
<a href="http://www.civil.uwaterloo.ca/jrcraig/Raven/Downloads.html">http://www.civil.uwaterloo.ca/jrcraig/Raven/Downloads.html</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_watershed_read">rvn_watershed_read</a></code> for reading in watershed storage output files
</p>


<h3>Examples</h3>

<pre><code class='language-R'># View data
head(rvn_watershed_data$watershed.storage)
# Also has units
rvn_watershed_data$units
</code></pre>

<hr>
<h2 id='rvn_watershed_read'>Read in Raven WatershedStorage file</h2><span id='topic+rvn_watershed_read'></span>

<h3>Description</h3>

<p>Read in the WatershedStorage.csv file produced by Raven.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_watershed_read(ff = NA, tzone = "UTC")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_watershed_read_+3A_ff">ff</code></td>
<td>
<p>full file path to the WatershedStorage.csv file</p>
</td></tr>
<tr><td><code id="rvn_watershed_read_+3A_tzone">tzone</code></td>
<td>
<p>string indicating the timezone of the data in ff</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Expects a full file path to the WatershedStorage.csv file,
then reads in the file using read.csv. The main advantage of this functon is
renaming the columns to nicer names and extracting the units into something
much easier to read.
</p>
<p>ff is the full file path of the WatershedStorage.csv file. If the file is
located in the current working directory, then simply the name of the file
is sufficient.
</p>
<p>The timezone is provided by the tzone argument as &quot;UTC&quot; by default, and should be adjusted by
the user to the local time zone as needed, based on the model run.
</p>


<h3>Value</h3>

<table>
<tr><td><code>watershed_storage</code></td>
<td>
<p>data frame from the file with standardized
names</p>
</td></tr> <tr><td><code>units</code></td>
<td>
<p>vector corresponding to units of each column</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_hyd_read">rvn_hyd_read</a></code> for reading in the Hydrographs.csv file
<code><a href="#topic+rvn_watershedmeb_read">rvn_watershedmeb_read</a></code> for reading in the
WatershedMassEnergyBalance.csv file
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# locate in RavenR Watershed storage file
ff &lt;- system.file("extdata","run1_WatershedStorage.csv", package="RavenR")

# create full file path and read in file
mywshd &lt;- rvn_watershed_read(ff)

# check data
head(mywshd$watershed_storage)

</code></pre>

<hr>
<h2 id='rvn_watershedmeb_read'>Read in Raven WatershedMassEnergyBalance file</h2><span id='topic+rvn_watershedmeb_read'></span>

<h3>Description</h3>

<p>Used to read in the WatershedMassEnergyBalance.csv file
produced by the modelling Framework Raven.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_watershedmeb_read(ff = NA, tzone = "UTC")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_watershedmeb_read_+3A_ff">ff</code></td>
<td>
<p>full file path to the WatershedMassEnergyBalance.csv file</p>
</td></tr>
<tr><td><code id="rvn_watershedmeb_read_+3A_tzone">tzone</code></td>
<td>
<p>string indicating the timezone of the data in ff</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Expects a full file path to the WatershedMassEnergyBalance.csv
file, then reads in the file using read.csv. The main advantage of this
function is renaming the columns to nicer names and extracting the units into
something much easier to read. The from and to rows are also properly
handled, which is not as straightforward as some of the other Raven files.
</p>
<p>ff is the full file path of the WatershedMassEnergyBalance.csv file. If the
file is located in the current working directory, then simply the name of
the file is sufficient.
</p>
<p>The timezone is provided by the tzone argument as &quot;UTC&quot; by default, and should be adjusted by
the user to the local time zone as needed, based on the model run.
</p>


<h3>Value</h3>

<table>
<tr><td><code>watershedmeb</code></td>
<td>
<p>data frame from the file with standardized names</p>
</td></tr>
<tr><td><code>units</code></td>
<td>
<p>vector corresponding to units of each column</p>
</td></tr>
<tr><td><code>from</code></td>
<td>
<p>vector of the 'from' compartments in file</p>
</td></tr>
<tr><td><code>to</code></td>
<td>
<p>vector of the 'to' compartments in file</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_watershed_read">rvn_watershed_read</a></code> for reading in the
WatershedStorage.csv file
</p>


<h3>Examples</h3>

<pre><code class='language-R'># locate RavenR Watershed Mass Energy Balance storage file
ff &lt;- system.file("extdata","run1_WatershedMassEnergyBalance.csv", package="RavenR")

# read in file
mywshdmeb &lt;- rvn_watershedmeb_read(ff)

# view mass energy balance time series
head(mywshdmeb$watershedmeb)

# view 'from' dataframe
mywshdmeb$from

</code></pre>

<hr>
<h2 id='rvn_weathercan_metadata_sample'>weathercan sample metadata for RavenR package</h2><span id='topic+rvn_weathercan_metadata_sample'></span>

<h3>Description</h3>

<p>A dataset downloaded using the <span class="pkg">weathercan</span> package function <code>stations_search</code> for stations
within 150 km of Merritt, BC. Additional details on the weathercan package and data formats can be found at the
<a href="https://github.com/ropensci/weathercan">weathercan github page</a>.
</p>
<p>Note that this sample is provided to avoid loading the <span class="pkg">weathercan</span> package while compiling and testing the package.
</p>
<p>Additional information on data provided by Environment Canada can be found on the Historical Data portal.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_weathercan_metadata_sample
</code></pre>


<h3>Format</h3>

<p>rvn_weathercan_sample is a tibble with 3 rows, and 17 columns.
</p>


<h3>Source</h3>

<p>Historical Climate Data from Environment Canada (climate.weather.gc.ca) via 'weathercan' package
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_met_recordplot">rvn_met_recordplot</a></code> for checking the record of meteorological data. This function example
also has the original code used to create the rvn_weathercan_metadata_sample data set.
</p>

<hr>
<h2 id='rvn_weathercan_sample'>weathercan sample data for RavenR package</h2><span id='topic+rvn_weathercan_sample'></span>

<h3>Description</h3>

<p>A dataset downloaded using the weathercan package for the 'KAMLOOPS A' station (station id 51423),
between 2016-10-01 and 2019-09-30. Additional details on the weathercan package and data formats can be found at the
<a href="https://github.com/ropensci/weathercan">weathercan github page</a>.
</p>
<p>Note that this sample is provided to avoid loading the weathercan package while compiling and testing the package.
</p>
<p>Additional information on data provided by Environment Canada can be found on the Historical Data portal.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_weathercan_sample
</code></pre>


<h3>Format</h3>

<p>rvn_weathercan_sample is a tibble with 1095 rows, and 37 columns.
</p>


<h3>Source</h3>

<p>Historical Climate Data from Environment Canada (climate.weather.gc.ca) via 'weathercan' package
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_rvt_write_met">rvn_rvt_write_met</a></code> for writing rvt files from meteorological data (including weathercan data).
</p>

<hr>
<h2 id='rvn_which_max_xts'>which.max for xts objects</h2><span id='topic+rvn_which_max_xts'></span>

<h3>Description</h3>

<p>Applies the which.max function and returns an xts object
with the maximum value and associated date.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_which_max_xts(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_which_max_xts_+3A_x">x</code></td>
<td>
<p>xts object to apply which.max to</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Acts as the which.max function, applicable
to xts objects and returning values in an xts format.
</p>
<p>Note that when deploying the rvn_apply_wyearly function, the dates are overwritten
and the dates of the water year ending periods are displayed rather than the event dates.
In order to obtain the corresponding dates when using the <code><a href="#topic+rvn_apply_wyearly">rvn_apply_wyearly</a></code>
function, please use <code><a href="#topic+rvn_apply_wyearly_which_max_xts">rvn_apply_wyearly_which_max_xts</a></code>.
</p>


<h3>Value</h3>

<p>xts object with max value and corresponding date
</p>


<h3>See Also</h3>

<p><code><a href="base.html#topic+which.max">which.max</a></code> base which.max function
<code><a href="#topic+rvn_apply_wyearly_which_max_xts">rvn_apply_wyearly_which_max_xts</a></code> for using apply_wyearly with the rvn_which_max_xts function
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(rvn_hydrograph_data)

# obtain the peak observed flow and the corresponding date
rvn_which_max_xts(rvn_hydrograph_data$hyd$Sub43_obs)

# note that the usual rvn_apply_wyearly does not provide the correct dates with this function
rvn_apply_wyearly(rvn_hydrograph_data$hyd$Sub43_obs, rvn_which_max_xts)

</code></pre>

<hr>
<h2 id='rvn_write_Raven_header'>Write common Raven file header</h2><span id='topic+rvn_write_Raven_header'></span>

<h3>Description</h3>

<p>Writes the common Raven file header to file. All lines are Appended.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_write_Raven_header(
  filename,
  filetype,
  author = NULL,
  creationDate = TRUE,
  textlen = 40
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_write_Raven_header_+3A_filename">filename</code></td>
<td>
<p>Name of the file, with extension</p>
</td></tr>
<tr><td><code id="rvn_write_Raven_header_+3A_filetype">filetype</code></td>
<td>
<p>File extension, Encoding, Raven version (e.g. &quot;rvp ASCII Raven 2.9.1&quot;)</p>
</td></tr>
<tr><td><code id="rvn_write_Raven_header_+3A_author">author</code></td>
<td>
<p>Name of file author (optional)</p>
</td></tr>
<tr><td><code id="rvn_write_Raven_header_+3A_creationdate">creationDate</code></td>
<td>
<p>Bool of whether creation date should be added to header. (default <code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="rvn_write_Raven_header_+3A_textlen">textlen</code></td>
<td>
<p>Length of lines (default: 40, used to right-align text)</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>TRUE</code></td>
<td>
<p>returns <code>TRUE</code> if executed successfully</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Leland Scantlebury, <a href="mailto:leland@scantle.com">leland@scantle.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>tf &lt;- file.path(tempdir(), 'HogwartsBasin.rvp')
rvn_write_Raven_header(filename = tf,
                    filetype = 'rvp ASCII Raven 2.9.1',
                    author   = 'Harry Potter')

# view file
readLines(tf)

</code></pre>

<hr>
<h2 id='rvn_write_Raven_label'>Writes common Raven labeled line to file, with optional value (appends)</h2><span id='topic+rvn_write_Raven_label'></span>

<h3>Description</h3>

<p>Writes common Raven labeled line to file, with optional value (appends)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_write_Raven_label(
  label,
  filename,
  value = NULL,
  digits = NULL,
  indent_level = 0
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_write_Raven_label_+3A_label">label</code></td>
<td>
<p>character, (e.g. &quot;SoilClasses&quot;)</p>
</td></tr>
<tr><td><code id="rvn_write_Raven_label_+3A_filename">filename</code></td>
<td>
<p>character, file name/path to write to, with extension</p>
</td></tr>
<tr><td><code id="rvn_write_Raven_label_+3A_value">value</code></td>
<td>
<p>numeric or character, corresponding value written after label (optional)</p>
</td></tr>
<tr><td><code id="rvn_write_Raven_label_+3A_digits">digits</code></td>
<td>
<p>Number of digits to round value to (optional)</p>
</td></tr>
<tr><td><code id="rvn_write_Raven_label_+3A_indent_level">indent_level</code></td>
<td>
<p>Adds two spaces before label for every one level (default = 0)</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>TRUE</code></td>
<td>
<p>returns <code>TRUE</code> if executed successfully</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Leland Scantlebury, <a href="mailto:leland@scantle.com">leland@scantle.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
tf &lt;- file.path(tempdir(), "Hogwarts.rvi")

# Numeric example
rvn_write_Raven_label('Duration', filename=tf, value=365)

# Hydrologic Processes
rvn_write_Raven_label('HydrologicProcesses', tf)

# String example, with indent
rvn_write_Raven_label('SnowBalance', filename = tf,
                      value = paste('SNOBAL_HMETS', 'MULTIPLE', 'MULTIPLE'),
                      indent_level = 1)

# Preview file
readLines(tf)

</code></pre>

<hr>
<h2 id='rvn_write_Raven_newfile'>Opens/Creates a new file, writes common file header.</h2><span id='topic+rvn_write_Raven_newfile'></span>

<h3>Description</h3>

<p>Opens/Creates a new file, writes common file header.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_write_Raven_newfile(
  filename,
  description,
  filetype,
  author = NULL,
  creationDate = TRUE,
  linelen = 74,
  textlen = 40
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_write_Raven_newfile_+3A_filename">filename</code></td>
<td>
<p>Name of the file, with extension</p>
</td></tr>
<tr><td><code id="rvn_write_Raven_newfile_+3A_description">description</code></td>
<td>
<p>File Description (e.g., Basin or project information, R script name)</p>
</td></tr>
<tr><td><code id="rvn_write_Raven_newfile_+3A_filetype">filetype</code></td>
<td>
<p>File extension, Encoding, Raven version (e.g. &quot;rvp ASCII Raven 2.9.1&quot;)</p>
</td></tr>
<tr><td><code id="rvn_write_Raven_newfile_+3A_author">author</code></td>
<td>
<p>Name of file author (optional)</p>
</td></tr>
<tr><td><code id="rvn_write_Raven_newfile_+3A_creationdate">creationDate</code></td>
<td>
<p>Bool of whether creation date should be added to header. (default <code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="rvn_write_Raven_newfile_+3A_linelen">linelen</code></td>
<td>
<p>length (width) of header, in text characters (default: 74)</p>
</td></tr>
<tr><td><code id="rvn_write_Raven_newfile_+3A_textlen">textlen</code></td>
<td>
<p>Length of textlines (default: 40, used to right-align text)</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>TRUE</code></td>
<td>
<p>returns <code>TRUE</code> if executed successfully</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Leland Scantlebury, <a href="mailto:leland@scantle.com">leland@scantle.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>tf &lt;- file.path(tempdir(), "HogwartsBasin.rvp")
rvn_write_Raven_newfile(filename = tf,
                description = "Hogwarts River Basin RVP File Generated by HP_FileGen.R",
                filetype = "rvp ASCII Raven 2.9.1",
                author = 'Harry Potter')

# view file
readLines(tf)

</code></pre>

<hr>
<h2 id='rvn_write_Raven_table'>Writes a nicely formatted tables of Raven attributes/parameters</h2><span id='topic+rvn_write_Raven_table'></span>

<h3>Description</h3>

<p>Writes a nicely formatted tables of Raven attributes/parameters
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_write_Raven_table(
  attributes,
  units,
  df,
  filename,
  id_col = TRUE,
  justify = "right",
  sep = ", ",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_write_Raven_table_+3A_attributes">attributes</code></td>
<td>
<p>array of strings containing attribute/parameter names</p>
</td></tr>
<tr><td><code id="rvn_write_Raven_table_+3A_units">units</code></td>
<td>
<p>array of strings with the corresponding units</p>
</td></tr>
<tr><td><code id="rvn_write_Raven_table_+3A_df">df</code></td>
<td>
<p>Dataframe of values corresponding to attributes/parameters</p>
</td></tr>
<tr><td><code id="rvn_write_Raven_table_+3A_filename">filename</code></td>
<td>
<p>Name of the file, with extension, to append the table to</p>
</td></tr>
<tr><td><code id="rvn_write_Raven_table_+3A_id_col">id_col</code></td>
<td>
<p><code>TRUE/FALSE</code> of whether an numeric id column is the first column in the table
and, in common Raven fashion, does not have a corresponding attribute (default <code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="rvn_write_Raven_table_+3A_justify">justify</code></td>
<td>
<p>alignment of character columns (default 'right'). See <code><a href="base.html#topic+format">format</a></code></p>
</td></tr>
<tr><td><code id="rvn_write_Raven_table_+3A_sep">sep</code></td>
<td>
<p>character(s) used to seperate columns (default ', ')</p>
</td></tr>
<tr><td><code id="rvn_write_Raven_table_+3A_...">...</code></td>
<td>
<p>Extra arguments for <code><a href="gdata.html#topic+write.fwf">write.fwf</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>TRUE</code></td>
<td>
<p>returns <code>TRUE</code> if executed successfully</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Leland Scantlebury, <a href="mailto:leland@scantle.com">leland@scantle.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>soil_classes &lt;- data.frame('Attributes' = c('DEFAULT','ALTERNATIVE'),
                           'SAND'      = c(0.4316, 0.3000),
                           'CLAY'      = c(0.1684, 0.4000),
                           'SILT'      = c(0.4000, 0.3000),
                           'ORGANIC'   = c(0.0000, 0.0000))
attributes &lt;- c('%SAND','%CLAY','%SILT','%ORGANIC')
units &lt;-  rep('none',4)

tf &lt;- file.path(tempdir(), "Hogwarts.rvp")
rvn_write_Raven_table(tf, attributes = attributes, units = units, df = soil_classes)

# view file
readLines(tf)

</code></pre>

<hr>
<h2 id='rvn_wyear_indices'>Water Year Indices</h2><span id='topic+rvn_wyear_indices'></span>

<h3>Description</h3>

<p>Returns the indices of the provided time series for the
start/end of the water year. The month/day of the water year defaults to September 30 for
an October 1 water year cycle. However, this may be supplied as other values,
for example as June 30th for a July 1 water year (i.e. the Australian water year).
This function is useful in supplying endpoints for water year evaluations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_wyear_indices(x, mm = 9, dd = 30)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_wyear_indices_+3A_x">x</code></td>
<td>
<p>xts object or Date/POSITXtc series to obtain indices for</p>
</td></tr>
<tr><td><code id="rvn_wyear_indices_+3A_mm">mm</code></td>
<td>
<p>month of water year (default 9)</p>
</td></tr>
<tr><td><code id="rvn_wyear_indices_+3A_dd">dd</code></td>
<td>
<p>day of water year (default 30)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Emulates the <code><a href="xts.html#topic+endpoints">endpoints</a></code> function
for a water year period. The first and last points are included in all supplied endpoints,
which may introduce partial periods to the analysis.#'
</p>


<h3>Value</h3>

<table>
<tr><td><code>ep</code></td>
<td>
<p>array of indices corresponding to start/end of
water years</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_apply_wyearly">rvn_apply_wyearly</a></code> to apply functions over the water year
<code><a href="xts.html#topic+endpoints">endpoints</a></code> workhorse function for generating endpoints in xts for other periods
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# read in sample forcings data
data(rvn_forcing_data)

# get the indices of the water year for October 1 (the default)
rvn_wyear_indices(rvn_forcing_data$forcings)
rvn_wyear_indices(rvn_forcing_data$forcings) %&gt;%
rvn_forcing_data$forcings[., 1:2]

# get the indices of the start of the water year for July 1
## note that the last period is the last index, and not a complete water year period
rvn_wyear_indices(rvn_forcing_data$forcings, mm=6, dd=30) %&gt;%
rvn_forcing_data$forcings[., 1:2]

</code></pre>

<hr>
<h2 id='rvn_xts_plot'>Create plot from xts data</h2><span id='topic+rvn_xts_plot'></span>

<h3>Description</h3>

<p>Generic function for plotting data from an xts format
using the ggplot2 function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rvn_xts_plot(
  x = NULL,
  prd = NULL,
  winter_shading = FALSE,
  wsdates = c(12, 1, 3, 31)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rvn_xts_plot_+3A_x">x</code></td>
<td>
<p>time series object (xts) of data to plot</p>
</td></tr>
<tr><td><code id="rvn_xts_plot_+3A_prd">prd</code></td>
<td>
<p>period to use in plotting</p>
</td></tr>
<tr><td><code id="rvn_xts_plot_+3A_winter_shading">winter_shading</code></td>
<td>
<p>optionally adds shading for winter months (default <code>FALSE</code>)</p>
</td></tr>
<tr><td><code id="rvn_xts_plot_+3A_wsdates">wsdates</code></td>
<td>
<p>integer vector of winter shading period dates (see details)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Creates a plot using the supplied time series in
xts format. The xts object is converted to a tibble using the <code><a href="#topic+rvn_fortify_xts">rvn_fortify_xts</a></code>
function, and all columns are plotted by their respective names.
</p>
<p>The winter_shading argument will add a transparent grey shading for the
specified period by wsdates in each year that is plotted. Note that by changing the
wsdates parameter values, the shading can be applied to any time of year.
</p>
<p>wsdates is formatted as c(winter start month, winter start day, winter end month, winter end day).
By default, wsdates is set to generate shading for December 1st to March 31st.
</p>
<p>Note that a plot title is purposely omitted in order to allow the automatic
generation of plot titles.
</p>


<h3>Value</h3>

<table>
<tr><td><code>p1</code></td>
<td>
<p>returns ggplot plot object</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+rvn_hyd_plot">rvn_hyd_plot</a></code> to create a hydrograph plot
</p>
<p><code><a href="#topic+rvn_hyd_extract">rvn_hyd_extract</a></code> to extract time series from Raven objects
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# load sample hydrograph data, two years worth of sim/obs
ff &lt;- system.file("extdata","run1_Hydrographs.csv", package="RavenR")
run1 &lt;- rvn_hyd_read(ff)

# create a hydrograph with the generic xts plotting function
rvn_xts_plot(run1$hyd[,2:5])

# add shading for the month of August
rvn_xts_plot(run1$hyd[,2:5], winter_shading=TRUE, wsdates=c(8,1,8,31))

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
