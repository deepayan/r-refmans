<!DOCTYPE html><html><head><title>Help for package APCtools</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {APCtools}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#calc_density'><p>Internal helper to calculate the (group-specific) density of a variable</p></a></li>
<li><a href='#capitalize_firstLetter'><p>Internal function to capitalize the first letter of a character</p></a></li>
<li><a href='#compute_xCoordinate'><p>Internal helper to tilt the x-axis for the hexamap plot</p></a></li>
<li><a href='#compute_yCoordinate'><p>Internal helper to tilt the x-axis for the hexamap plot</p></a></li>
<li><a href='#create_APCsummary'><p>Create a summary table for multiple estimated GAM models</p></a></li>
<li><a href='#create_groupVariable'><p>Internal helper to create a group variable as base for a density matrix</p></a></li>
<li><a href='#create_highlightDiagonalData'><p>Internal helper to create a dataset for ggplot2 to highlight diagonals</p></a></li>
<li><a href='#create_modelSummary'><p>Create model summary tables for multiple estimated GAM models</p></a></li>
<li><a href='#create_oneAPCsummaryTable'><p>Internal helper to create a summary table for one estimated GAM model</p></a></li>
<li><a href='#drug_deaths'><p>Drug deaths of white men in the United States</p></a></li>
<li><a href='#ensure_segmentsInPlotRange'><p>Internal helper for gg_addReferenceLines to keep diagonal lines in the plot range</p></a></li>
<li><a href='#extract_summary_linearEffects'><p>Internal helper to extract summary of linear effects in a gam model</p></a></li>
<li><a href='#get_plotGAMobject'><p>Extract returned values of plot.gam() while suppressing creation of the plot</p></a></li>
<li><a href='#gg_addReferenceLines'><p>Internal helper to add reference lines in an APC heatmap</p></a></li>
<li><a href='#gg_highlightDiagonals'><p>Internal helper to add the diagonal highlighting to a ggplot</p></a></li>
<li><a href='#plot_1Dsmooth'><p>Plot 1D smooth effects for <code>gam</code> models</p></a></li>
<li><a href='#plot_APCheatmap'><p>Heatmap of an APC surface</p></a></li>
<li><a href='#plot_APChexamap'><p>Hexamap of an APC surface</p></a></li>
<li><a href='#plot_density'><p>Plot the density of one metric or categorical variable</p></a></li>
<li><a href='#plot_density_categorical'><p>Internal helper to plot a categorical density</p></a></li>
<li><a href='#plot_density_metric'><p>Internal helper to plot a metric density</p></a></li>
<li><a href='#plot_densityMatrix'><p>Create a matrix of density plots</p></a></li>
<li><a href='#plot_jointMarginalAPCeffects'><p>Joint plot to compare the marginal APC effects of multiple models</p></a></li>
<li><a href='#plot_linearEffects'><p>Plot linear effects of a gam in an effect plot</p></a></li>
<li><a href='#plot_marginalAPCeffects'><p>Plot of marginal APC effects based on an estimated GAM model</p></a></li>
<li><a href='#plot_partialAPCeffects'><p>Partial APC plots based on an estimated GAM model</p></a></li>
<li><a href='#plot_variable'><p>Distribution plot of one variable against one APC dimension</p></a></li>
<li><a href='#travel'><p>Data from the German Reiseanalyse survey</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Routines for Descriptive and Model-Based APC Analysis</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.4</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Alexander Bauer &lt;alexander.bauer@stat.uni-muenchen.de&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Age-Period-Cohort (APC) analyses are used to differentiate relevant drivers for long-term developments.
    The 'APCtools' package offers visualization techniques and general routines to simplify the workflow of an APC analysis.
    Sophisticated functions are available both for descriptive and regression model-based analyses.
    For the former, we use density (or ridgeline) matrices and (hexagonally binned) heatmaps as innovative visualization
    techniques building on the concept of Lexis diagrams.
    Model-based analyses build on the separation of the temporal dimensions based on generalized additive models,
    where a tensor product interaction surface (usually between age and period) is utilized
    to represent the third dimension (usually cohort) on its diagonal.
    Such tensor product surfaces can also be estimated while accounting for
    further covariates in the regression model.
    See Weigert et al. (2021) &lt;<a href="https://doi.org/10.1177%2F1354816620987198">doi:10.1177/1354816620987198</a>&gt; for methodological details.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://bauer-alex.github.io/APCtools/">https://bauer-alex.github.io/APCtools/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/bauer-alex/APCtools/issues">https://github.com/bauer-alex/APCtools/issues</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.1</td>
</tr>
<tr>
<td>Imports:</td>
<td>ggpubr, checkmate, knitr, ggplot2, colorspace, dplyr, mgcv,
scales, tidyr, stringr</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 3.0.0), rmarkdown, covr</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5)</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-01-13 22:35:03 UTC; alex</td>
</tr>
<tr>
<td>Author:</td>
<td>Alexander Bauer <a href="https://orcid.org/0000-0003-3495-5131"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Maximilian Weigert
    <a href="https://orcid.org/0000-0003-4400-134X"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Hawre Jalal <a href="https://orcid.org/0000-0002-8224-6834"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-01-13 23:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='calc_density'>Internal helper to calculate the (group-specific) density of a variable</h2><span id='topic+calc_density'></span>

<h3>Description</h3>

<p>Internal helper function that is called in <code><a href="#topic+plot_density">plot_density</a></code> to
calculate the density of a metric variable. If <code>plot_density</code> is called
from within <code><a href="#topic+plot_densityMatrix">plot_densityMatrix</a></code> (i.e., when some of the columns
<code>c("age_group","period_group","cohort_group")</code> are part of the dataset,
the density is computed individually for all respective APC groups.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calc_density(dat, y_var, weights_var = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calc_density_+3A_dat">dat</code></td>
<td>
<p>Dataset with columns <code>period</code> and <code>age</code> and the
main variable specified through argument <code>y_var</code>.</p>
</td></tr>
<tr><td><code id="calc_density_+3A_y_var">y_var</code></td>
<td>
<p>Character name of the main variable to be plotted.</p>
</td></tr>
<tr><td><code id="calc_density_+3A_weights_var">weights_var</code></td>
<td>
<p>Optional character name of a weights variable used to
project the results in the sample to some population.</p>
</td></tr>
<tr><td><code id="calc_density_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code><a href="stats.html#topic+density">density</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Dataset with the calculated densities.
</p>

<hr>
<h2 id='capitalize_firstLetter'>Internal function to capitalize the first letter of a character</h2><span id='topic+capitalize_firstLetter'></span>

<h3>Description</h3>

<p>Internal helper function to capitalize the first letter of a character value.
The use case is to create a plot label like 'Age' from a variable name like
'age'.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>capitalize_firstLetter(char)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="capitalize_firstLetter_+3A_char">char</code></td>
<td>
<p>Character value whose first letter should be capitalized</p>
</td></tr>
</table>

<hr>
<h2 id='compute_xCoordinate'>Internal helper to tilt the x-axis for the hexamap plot</h2><span id='topic+compute_xCoordinate'></span>

<h3>Description</h3>

<p>Internal helper function to be called in <code><a href="#topic+plot_APChexamap">plot_APChexamap</a></code>,
to tilt the x-axis for the hexamap plot.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compute_xCoordinate(period_vec)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="compute_xCoordinate_+3A_period_vec">period_vec</code></td>
<td>
<p>Numeric vector of period values.</p>
</td></tr>
</table>

<hr>
<h2 id='compute_yCoordinate'>Internal helper to tilt the x-axis for the hexamap plot</h2><span id='topic+compute_yCoordinate'></span>

<h3>Description</h3>

<p>Internal helper function to be called in <code><a href="#topic+plot_APChexamap">plot_APChexamap</a></code>,
to tilt the x-axis for the hexamap plot.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compute_yCoordinate(period_vec, age_vec)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="compute_yCoordinate_+3A_period_vec">period_vec</code></td>
<td>
<p>Numeric vector of period values.</p>
</td></tr>
<tr><td><code id="compute_yCoordinate_+3A_age_vec">age_vec</code></td>
<td>
<p>Numeric vector of age values.</p>
</td></tr>
</table>

<hr>
<h2 id='create_APCsummary'>Create a summary table for multiple estimated GAM models</h2><span id='topic+create_APCsummary'></span>

<h3>Description</h3>

<p>Create a table to summarize the overall effect strengths of the age, period
and cohort effects for models fitted with <code><a href="mgcv.html#topic+gam">gam</a></code> or
<code><a href="mgcv.html#topic+bam">bam</a></code>. The output format can be adjusted by passing
arguments to <code><a href="knitr.html#topic+kable">kable</a></code> via the <code>...</code> argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_APCsummary(model_list, dat, digits = 2, apc_range = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_APCsummary_+3A_model_list">model_list</code></td>
<td>
<p>A list of regression models estimated with
<code><a href="mgcv.html#topic+gam">gam</a></code> or <code><a href="mgcv.html#topic+bam">bam</a></code>. If the list is named, the
names are used as labels. Can also be a single model object instead of a list.</p>
</td></tr>
<tr><td><code id="create_APCsummary_+3A_dat">dat</code></td>
<td>
<p>Dataset with columns <code>period</code> and <code>age</code>. If <code>y_var</code>
is specified, the dataset must contain the respective column. If <code>model</code>
is specified, the dataset must have been used for model estimation with
<code>gam</code> or <code>bam</code>.</p>
</td></tr>
<tr><td><code id="create_APCsummary_+3A_digits">digits</code></td>
<td>
<p>Number of digits for numeric columns. Defaults to 2.</p>
</td></tr>
<tr><td><code id="create_APCsummary_+3A_apc_range">apc_range</code></td>
<td>
<p>Optional list with one or multiple elements with names
<code>"age","period","cohort"</code> to filter the data. Each element should
contain a numeric vector of values for the respective variable that should
be kept in the data. All other values are deleted before producing the table.</p>
</td></tr>
<tr><td><code id="create_APCsummary_+3A_...">...</code></td>
<td>
<p>Optional additional arguments passed to <code><a href="knitr.html#topic+kable">kable</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If the model was estimated with a log or logit link, the function
automatically performs an exponential transformation of the effect.
</p>


<h3>Value</h3>

<p>Table created with <code><a href="knitr.html#topic+kable">kable</a></code>.
</p>


<h3>Author(s)</h3>

<p>Alexander Bauer <a href="mailto:alexander.bauer@stat.uni-muenchen.de">alexander.bauer@stat.uni-muenchen.de</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(APCtools)
library(mgcv)

data(travel)

# create the summary table for one model
model_pure &lt;- gam(mainTrip_distance ~ te(age, period), data = travel)
create_APCsummary(model_pure, dat = travel)

# create the summary table for multiple models
model_cov  &lt;- gam(mainTrip_distance ~ te(age, period) + s(household_income),
                  data = travel)
model_list &lt;- list("pure model"      = model_pure,
                   "covariate model" = model_cov)
create_APCsummary(model_list, dat = travel)

</code></pre>

<hr>
<h2 id='create_groupVariable'>Internal helper to create a group variable as base for a density matrix</h2><span id='topic+create_groupVariable'></span>

<h3>Description</h3>

<p>Internal helper function to create a group variable based on the
categorization of either age, period or cohort. To be called from within
<code><a href="#topic+plot_densityMatrix">plot_densityMatrix</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_groupVariable(dat, APC_var, groups_list)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_groupVariable_+3A_dat">dat</code></td>
<td>
<p>Dataset with a column <code>"age"</code>, <code>"period"</code> or
<code>"cohort"</code>, dependent on the specified <code>APC_var</code>.</p>
</td></tr>
<tr><td><code id="create_groupVariable_+3A_apc_var">APC_var</code></td>
<td>
<p>One of <code>c("age","period","cohort")</code>.</p>
</td></tr>
<tr><td><code id="create_groupVariable_+3A_groups_list">groups_list</code></td>
<td>
<p>A list with each element specifying the borders of one
row or column in the density matrix. E.g., if the period should be visualized
in decade columns from 1980 to 2009, specify
<code>groups_list = list(c(1980,1989), c(1990,1999), c(2000,2009))</code>.
The list can be named to specify labels for the categories.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Vector for the grouping that can be added as additional column to
the data.
</p>

<hr>
<h2 id='create_highlightDiagonalData'>Internal helper to create a dataset for ggplot2 to highlight diagonals</h2><span id='topic+create_highlightDiagonalData'></span>

<h3>Description</h3>

<p>Internal helper function to create a dataset for <code>ggplot2</code> that can
be used to highlight specific diagonals in a density matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_highlightDiagonalData(dat, highlight_diagonals)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_highlightDiagonalData_+3A_dat">dat</code></td>
<td>
<p>Dataset with columns <code>period</code> and <code>age</code> and the
main variable specified through argument <code>y_var</code>.</p>
</td></tr>
<tr><td><code id="create_highlightDiagonalData_+3A_highlight_diagonals">highlight_diagonals</code></td>
<td>
<p>Optional internal parameter which is only
specified when <code>plot_density</code> is called from within
<code>plot_densityMatrix</code>. See <code><a href="#topic+plot_densityMatrix">plot_densityMatrix</a></code> for details.</p>
</td></tr>
</table>

<hr>
<h2 id='create_modelSummary'>Create model summary tables for multiple estimated GAM models</h2><span id='topic+create_modelSummary'></span>

<h3>Description</h3>

<p>Create publication-ready summary tables of all linear and nonlinear effects
for models fitted with <code><a href="mgcv.html#topic+gam">gam</a></code> or <code><a href="mgcv.html#topic+bam">bam</a></code>.
The output format of the tables can be adjusted by passing arguments to
<code><a href="knitr.html#topic+kable">kable</a></code> via the <code>...</code> argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_modelSummary(
  model_list,
  digits = 2,
  method_expTransform = "simple",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_modelSummary_+3A_model_list">model_list</code></td>
<td>
<p>list of APC models</p>
</td></tr>
<tr><td><code id="create_modelSummary_+3A_digits">digits</code></td>
<td>
<p>number of displayed digits</p>
</td></tr>
<tr><td><code id="create_modelSummary_+3A_method_exptransform">method_expTransform</code></td>
<td>
<p>One of <code>c("simple","delta")</code>, stating if
standard errors and confidence interval limits should be transformed by
a simple exp transformation or using the delta method. The delta method can
be unstable in situations and lead to negative confidence interval limits.
Only used when the model was estimated with a log or logit link.</p>
</td></tr>
<tr><td><code id="create_modelSummary_+3A_...">...</code></td>
<td>
<p>additional arguments to <code><a href="knitr.html#topic+kable">kable</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>If the model was estimated with a log or logit link, the function
automatically performs an exponential transformation of the effects.
</p>
<p>The table for linear coefficients includes the estimated coefficient
(<code>coef</code>), the corresponding standard error (<code>se</code>), lower and upper
limits of 95% confidence intervals (<code>CI_lower</code>, <code>CI_upper</code>) and
the p-values for all coefficients apart from the intercept.
</p>
<p>The table for nonlinear coefficients include the estimated degrees of freedom
(<code>edf</code>) and the p-value for each estimate.
</p>


<h3>Value</h3>

<p>List of tables created with <code><a href="knitr.html#topic+kable">kable</a></code>.
</p>


<h3>Author(s)</h3>

<p>Alexander Bauer <a href="mailto:alexander.bauer@stat.uni-muenchen.de">alexander.bauer@stat.uni-muenchen.de</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(APCtools)
library(mgcv)

data(travel)
model &lt;- gam(mainTrip_distance ~ te(age, period) + residence_region +
             household_size + s(household_income), data = travel)

create_modelSummary(list(model), dat = travel)

</code></pre>

<hr>
<h2 id='create_oneAPCsummaryTable'>Internal helper to create a summary table for one estimated GAM model</h2><span id='topic+create_oneAPCsummaryTable'></span>

<h3>Description</h3>

<p>Internal helper function to be called in <code><a href="#topic+create_APCsummary">create_APCsummary</a></code>.
This function creates the summary table for one model estimated with
<code><a href="mgcv.html#topic+gam">gam</a></code> or <code><a href="mgcv.html#topic+bam">bam</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_oneAPCsummaryTable(model, dat, apc_range = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_oneAPCsummaryTable_+3A_model">model</code></td>
<td>
<p>Optional regression model estimated with <code><a href="mgcv.html#topic+gam">gam</a></code>
or <code><a href="mgcv.html#topic+bam">bam</a></code> to estimate a smoothed APC surface. Only used if
<code>y_var</code> is not
specified.</p>
</td></tr>
<tr><td><code id="create_oneAPCsummaryTable_+3A_dat">dat</code></td>
<td>
<p>Dataset with columns <code>period</code> and <code>age</code>. If <code>y_var</code>
is specified, the dataset must contain the respective column. If <code>model</code>
is specified, the dataset must have been used for model estimation with
<code>gam</code> or <code>bam</code>.</p>
</td></tr>
<tr><td><code id="create_oneAPCsummaryTable_+3A_apc_range">apc_range</code></td>
<td>
<p>Optional list with one or multiple elements with names
<code>"age","period","cohort"</code> to filter the data. Each element should
contain a numeric vector of values for the respective variable that should
be kept in the data. All other values are deleted.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>data.frame</code> containing aggregated information on the
individual effects.
</p>

<hr>
<h2 id='drug_deaths'>Drug deaths of white men in the United States</h2><span id='topic+drug_deaths'></span>

<h3>Description</h3>

<p>Dataset on the number of unintentional drug overdose deaths in the United
States for each age group between 1999 and 2019, retrieved from the CDC
WONDER Online Database. The data only cover white men.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(drug_deaths)
</code></pre>


<h3>Format</h3>

<p>A dataframe containing
</p>

<dl>
<dt>period</dt><dd><p>Calendar year</p>
</dd>
<dt>age</dt><dd><p>Age group.</p>
</dd>
<dt>deaths</dt><dd><p>Number of observed unintentional drug overdose deaths in the
respective age group and calendar year.</p>
</dd>
<dt>population</dt><dd><p>Number of white men in the respective age group and
calendar year in the U.S. population.</p>
</dd>
<dt>mortality_rate</dt><dd><p>Drug overdose mortality rate for the respective age
group and calendar year, reported as the number of deaths per 100,000
people. Calculated as <code>100000 * deaths / population</code>.</p>
</dd>
</dl>



<h3>Details</h3>

<p>The data were exported from the CDC WONDER Online Database (see link in
references down below), based on the following settings:
</p>

<ul>
<li><p> Group by <em>Year</em> and by <em>Single-Year Ages</em>
</p>
</li>
<li><p> Demographics: Gender <em>Male</em>; Ethnicity <em>White</em>
</p>
</li>
<li><p> Cause of death: <em>Drug / Alcohol Induced Causes</em>. Then select the more
specific category <em>Drug poisonings (overdose) Unintentional (X40-X44)</em>.
</p>
</li></ul>



<h3>References</h3>

<p>Jalal, H., &amp; Burke, D. S. (2020). Hexamaps for Age-Period-Cohort Data
Visualization and Implementation in R. <em>Epidemiology (Cambridge, Mass.)</em>,
31(6), e47.
<a href="https://doi.org/10.1097/EDE.0000000000001236">doi:10.1097/EDE.0000000000001236</a>.
</p>
<p>Centers for Disease Control and Prevention, National Center for Health
Statistics. Underlying Cause of Death 1999-2019 on CDC WONDER Online Database,
released in 2020. Data are from the Multiple Cause of Death Files, 1999-2019,
as compiled from data provided by the 57 vital statistics jurisdictions
through the Vital Statistics Cooperative Program. Accessed at
<a href="http://wonder.cdc.gov/ucd-icd10.html">wonder.cdc.gov/ucd-icd10.html</a>
on 6 December 2021.
</p>

<hr>
<h2 id='ensure_segmentsInPlotRange'>Internal helper for gg_addReferenceLines to keep diagonal lines in the plot range</h2><span id='topic+ensure_segmentsInPlotRange'></span>

<h3>Description</h3>

<p>Internal helper function to be called from within
<code><a href="#topic+gg_addReferenceLines">gg_addReferenceLines</a></code>. This function takes the dataset prepared
for adding diagonal reference lines in the plot, checks if some diagonals
exceed the plot limits, cuts them accordingly, if necessary, and again
returns the corrected dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ensure_segmentsInPlotRange(dat_segments, plot_dat)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ensure_segmentsInPlotRange_+3A_dat_segments">dat_segments</code></td>
<td>
<p>Dataset containing information on the diagonal reference
lines.</p>
</td></tr>
<tr><td><code id="ensure_segmentsInPlotRange_+3A_plot_dat">plot_dat</code></td>
<td>
<p>Dataset used for creating the heatmap.</p>
</td></tr>
</table>

<hr>
<h2 id='extract_summary_linearEffects'>Internal helper to extract summary of linear effects in a gam model</h2><span id='topic+extract_summary_linearEffects'></span>

<h3>Description</h3>

<p>Internal helper function to create a <code>data.frame</code> containing the linear
effects summary of a model fitted with <code><a href="mgcv.html#topic+gam">gam</a></code> or
<code><a href="mgcv.html#topic+bam">bam</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_summary_linearEffects(model, method_expTransform = "simple")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract_summary_linearEffects_+3A_model">model</code></td>
<td>
<p>Model fitted with <code><a href="mgcv.html#topic+gam">gam</a></code> or <code><a href="mgcv.html#topic+bam">bam</a></code>.</p>
</td></tr>
<tr><td><code id="extract_summary_linearEffects_+3A_method_exptransform">method_expTransform</code></td>
<td>
<p>One of <code>c("simple","delta")</code>, stating if
standard errors and confidence interval limits should be transformed by
a simple exp transformation or using the delta method. The delta method can
be unstable in situations and lead to negative confidence interval limits.
Only used when the model was estimated with a log or logit link.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If the model was estimated with a log or logit link, the function
automatically performs an exponential transformation of the effect,
see argument <code>method_expTransform</code>.
</p>

<hr>
<h2 id='get_plotGAMobject'>Extract returned values of plot.gam() while suppressing creation of the plot</h2><span id='topic+get_plotGAMobject'></span>

<h3>Description</h3>

<p>Internal helper function to extract the values returned of
<code><a href="mgcv.html#topic+plot.gam">plot.gam</a></code> while suppressing creation of the plot.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_plotGAMobject(model)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_plotGAMobject_+3A_model">model</code></td>
<td>
<p>GAM model fitted with <code><a href="mgcv.html#topic+gam">gam</a></code> or
<code><a href="mgcv.html#topic+bam">bam</a></code>.</p>
</td></tr>
</table>

<hr>
<h2 id='gg_addReferenceLines'>Internal helper to add reference lines in an APC heatmap</h2><span id='topic+gg_addReferenceLines'></span>

<h3>Description</h3>

<p>Internal helper function to add reference lines in an APC heatmap
(vertically, horizontally or diagonally). The function takes an existing list
of ggplot objects, adds the specified reference lines in each plot and
returns the edited ggplot list again. To be called from within
<code><a href="#topic+plot_APCheatmap">plot_APCheatmap</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gg_addReferenceLines(
  gg_list,
  dimensions,
  plot_dat,
  markLines_list,
  markLines_displayLabels
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gg_addReferenceLines_+3A_gg_list">gg_list</code></td>
<td>
<p>Existing list of ggplot objects where the reference lines
should be marked in each individual ggplot.</p>
</td></tr>
<tr><td><code id="gg_addReferenceLines_+3A_dimensions">dimensions</code></td>
<td>
<p>Character vector specifying the two APC dimensions that
should be visualized along the x-axis and y-axis. Defaults to
<code>c("period","age")</code>.</p>
</td></tr>
<tr><td><code id="gg_addReferenceLines_+3A_plot_dat">plot_dat</code></td>
<td>
<p>Dataset used for creating the heatmap.</p>
</td></tr>
<tr><td><code id="gg_addReferenceLines_+3A_marklines_list">markLines_list</code></td>
<td>
<p>Optional list that can be used to highlight the borders
of specific age groups, time intervals or cohorts. Each element must be a
numeric vector of values where horizontal, vertical or diagonal lines should
be drawn (depends on which APC dimension is displayed on which axis).
The list can maximally have three elements and must have names out of
<code>c("age","period","cohort")</code>.</p>
</td></tr>
<tr><td><code id="gg_addReferenceLines_+3A_marklines_displaylabels">markLines_displayLabels</code></td>
<td>
<p>Optional character vector defining for which
dimensions the lines defined through <code>markLines_list</code> should be marked
by a respective label. The vector should be a subset of
<code>c("age","period","cohort")</code>, or NULL to suppress all labels.
Defaults to <code>c("age","period","cohort")</code>.</p>
</td></tr>
</table>

<hr>
<h2 id='gg_highlightDiagonals'>Internal helper to add the diagonal highlighting to a ggplot</h2><span id='topic+gg_highlightDiagonals'></span>

<h3>Description</h3>

<p>Internal helper function to highlight diagonals in a density matrix. The
function takes an existing ggplot object, adds the diagonal highlighting
and returns the edited ggplot object again.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gg_highlightDiagonals(gg, dat, dat_highlightDiagonals)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gg_highlightDiagonals_+3A_gg">gg</code></td>
<td>
<p>Existing ggplot object to which the diagonal highlighting should
be added.</p>
</td></tr>
<tr><td><code id="gg_highlightDiagonals_+3A_dat">dat</code></td>
<td>
<p>Dataset with columns <code>period</code> and <code>age</code> and the
main variable specified through argument <code>y_var</code>.</p>
</td></tr>
<tr><td><code id="gg_highlightDiagonals_+3A_dat_highlightdiagonals">dat_highlightDiagonals</code></td>
<td>
<p>Dataset created by
<code><a href="#topic+create_highlightDiagonalData">create_highlightDiagonalData</a></code> to highlight specific diagonals
in a density matrix.</p>
</td></tr>
</table>

<hr>
<h2 id='plot_1Dsmooth'>Plot 1D smooth effects for <code><a href="mgcv.html#topic+gam">gam</a></code> models</h2><span id='topic+plot_1Dsmooth'></span>

<h3>Description</h3>

<p>Plots 1D smooth effects for a GAM model fitted with <code><a href="mgcv.html#topic+gam">gam</a></code>
or <code><a href="mgcv.html#topic+bam">bam</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_1Dsmooth(
  model,
  plot_ci = TRUE,
  select,
  alpha = 0.05,
  ylim = NULL,
  method_expTransform = "simple",
  return_plotData = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_1Dsmooth_+3A_model">model</code></td>
<td>
<p>GAM model fitted with <code><a href="mgcv.html#topic+gam">gam</a></code> or
<code><a href="mgcv.html#topic+bam">bam</a></code>.</p>
</td></tr>
<tr><td><code id="plot_1Dsmooth_+3A_plot_ci">plot_ci</code></td>
<td>
<p>If <code>TRUE</code> CIs are plotted. Only used if <code>plot_type = 1</code>.</p>
</td></tr>
<tr><td><code id="plot_1Dsmooth_+3A_select">select</code></td>
<td>
<p>Index of smooth term to be plotted.</p>
</td></tr>
<tr><td><code id="plot_1Dsmooth_+3A_alpha">alpha</code></td>
<td>
<p><code>(1-alpha)</code> CIs are calculated. The default 0.05 leads to
95% CIs.</p>
</td></tr>
<tr><td><code id="plot_1Dsmooth_+3A_ylim">ylim</code></td>
<td>
<p>Optional limits of the y-axis.</p>
</td></tr>
<tr><td><code id="plot_1Dsmooth_+3A_method_exptransform">method_expTransform</code></td>
<td>
<p>One of <code>c("simple","delta")</code>, stating if
standard errors and confidence interval limits should be transformed by
a simple exp transformation or using the delta method. The delta method can
be unstable in situations and lead to negative confidence interval limits.
Only used when the model was estimated with a log or logit link.</p>
</td></tr>
<tr><td><code id="plot_1Dsmooth_+3A_return_plotdata">return_plotData</code></td>
<td>
<p>If TRUE, the dataset prepared for plotting is
returned. Defaults to FALSE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If the model was estimated with a log or logit link, the function
automatically performs an exponential transformation of the effect,
see argument <code>method_expTransform</code>.
</p>


<h3>Value</h3>

<p>ggplot object
</p>


<h3>Author(s)</h3>

<p>Alexander Bauer <a href="mailto:alexander.bauer@stat.uni-muenchen.de">alexander.bauer@stat.uni-muenchen.de</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(APCtools)
library(mgcv)

data(travel)
model &lt;- gam(mainTrip_distance ~ te(age, period) + residence_region +
             household_size + s(household_income), data = travel)

plot_1Dsmooth(model, select = 2)

</code></pre>

<hr>
<h2 id='plot_APCheatmap'>Heatmap of an APC surface</h2><span id='topic+plot_APCheatmap'></span>

<h3>Description</h3>

<p>Plot the heatmap of an APC structure. The function can be used in two ways:
Either to plot the observed mean structure of a metric variable, by
specifying <code>dat</code> and the variable <code>y_var</code>, or by specifying
<code>dat</code> and the <code>model</code> object, to plot some mean structure
represented by an estimated two-dimensional tensor product surface. The model
must be estimated with <code><a href="mgcv.html#topic+gam">gam</a></code> or <code><a href="mgcv.html#topic+bam">bam</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_APCheatmap(
  dat,
  y_var = NULL,
  model = NULL,
  dimensions = c("period", "age"),
  apc_range = NULL,
  bin_heatmap = TRUE,
  bin_heatmapGrid_list = NULL,
  markLines_list = NULL,
  markLines_displayLabels = c("age", "period", "cohort"),
  y_var_logScale = FALSE,
  plot_CI = TRUE,
  legend_limits = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_APCheatmap_+3A_dat">dat</code></td>
<td>
<p>Dataset with columns <code>period</code> and <code>age</code>. If <code>y_var</code>
is specified, the dataset must contain the respective column. If <code>model</code>
is specified, the dataset must have been used for model estimation with
<code>gam</code> or <code>bam</code>.</p>
</td></tr>
<tr><td><code id="plot_APCheatmap_+3A_y_var">y_var</code></td>
<td>
<p>Optional character name of a metric variable to be plotted.</p>
</td></tr>
<tr><td><code id="plot_APCheatmap_+3A_model">model</code></td>
<td>
<p>Optional regression model estimated with <code><a href="mgcv.html#topic+gam">gam</a></code>
or <code><a href="mgcv.html#topic+bam">bam</a></code> to estimate a smoothed APC surface. Only used if
<code>y_var</code> is not
specified.</p>
</td></tr>
<tr><td><code id="plot_APCheatmap_+3A_dimensions">dimensions</code></td>
<td>
<p>Character vector specifying the two APC dimensions that
should be visualized along the x-axis and y-axis. Defaults to
<code>c("period","age")</code>.</p>
</td></tr>
<tr><td><code id="plot_APCheatmap_+3A_apc_range">apc_range</code></td>
<td>
<p>Optional list with one or multiple elements with names
<code>"age","period","cohort"</code> to filter the data. Each element should
contain a numeric vector of values for the respective variable that should
be kept in the data. All other values are deleted.</p>
</td></tr>
<tr><td><code id="plot_APCheatmap_+3A_bin_heatmap">bin_heatmap</code>, <code id="plot_APCheatmap_+3A_bin_heatmapgrid_list">bin_heatmapGrid_list</code></td>
<td>
<p><code>bin_heatmap</code> indicates if the
heatmap surface should be binned. Defaults to TRUE. If TRUE, the binning
grid borders are defined by <code>bin_heatmapGrid_list</code>. This is a list with
each element a numeric vector and a name out of
<code>c("age","period","cohort")</code>. Can maximally have three elements. Defaults
to NULL, where the heatmap is binned in 5 year steps along the x-axis and the
y-axis.</p>
</td></tr>
<tr><td><code id="plot_APCheatmap_+3A_marklines_list">markLines_list</code></td>
<td>
<p>Optional list that can be used to highlight the borders
of specific age groups, time intervals or cohorts. Each element must be a
numeric vector of values where horizontal, vertical or diagonal lines should
be drawn (depends on which APC dimension is displayed on which axis).
The list can maximally have three elements and must have names out of
<code>c("age","period","cohort")</code>.</p>
</td></tr>
<tr><td><code id="plot_APCheatmap_+3A_marklines_displaylabels">markLines_displayLabels</code></td>
<td>
<p>Optional character vector defining for which
dimensions the lines defined through <code>markLines_list</code> should be marked
by a respective label. The vector should be a subset of
<code>c("age","period","cohort")</code>, or NULL to suppress all labels.
Defaults to <code>c("age","period","cohort")</code>.</p>
</td></tr>
<tr><td><code id="plot_APCheatmap_+3A_y_var_logscale">y_var_logScale</code></td>
<td>
<p>Indicator if <code>y_var</code> should be log10 transformed.
Only used if <code>y_var</code> is specified. Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="plot_APCheatmap_+3A_plot_ci">plot_CI</code></td>
<td>
<p>Indicator if the confidence intervals should be plotted.
Only used if <code>y_var</code> is not specified. Defaults to TRUE.</p>
</td></tr>
<tr><td><code id="plot_APCheatmap_+3A_legend_limits">legend_limits</code></td>
<td>
<p>Optional numeric vector passed as argument <code>limits</code>
to <code><a href="ggplot2.html#topic+scale_fill_gradient2">scale_fill_gradient2</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See also <code><a href="#topic+plot_APChexamap">plot_APChexamap</a></code> to plot a hexagonal heatmap with
adapted axes.
</p>
<p>If the plot is created based on the <code>model</code> object and the model was
estimated with a log or logit link, the function automatically performs an
exponential transformation of the effect.
</p>


<h3>Value</h3>

<p>Plot grid created with <code><a href="ggpubr.html#topic+ggarrange">ggarrange</a></code> (if
<code>plot_CI</code> is TRUE) or a <code>ggplot2</code> object (if <code>plot_CI</code> is
FALSE).
</p>


<h3>Author(s)</h3>

<p>Alexander Bauer <a href="mailto:alexander.bauer@stat.uni-muenchen.de">alexander.bauer@stat.uni-muenchen.de</a>,
Maximilian Weigert <a href="mailto:maximilian.weigert@stat.uni-muenchen.de">maximilian.weigert@stat.uni-muenchen.de</a>
</p>


<h3>References</h3>

<p>Weigert, M., Bauer, A., Gernert, J., Karl, M., Nalmpatian, A.,
Küchenhoff, H., and Schmude, J. (2021). Semiparametric APC analysis of
destination choice patterns: Using generalized additive models to quantify
the impact of age, period, and cohort on travel distances.
<em>Tourism Economics</em>. doi:10.1177/1354816620987198.
</p>


<h3>See Also</h3>

<p>plot_APChexamap
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(APCtools)
library(mgcv)

data(travel)

# variant A: plot observed mean structures
# observed heatmap
plot_APCheatmap(dat = travel, y_var = "mainTrip_distance",
                bin_heatmap = FALSE, y_var_logScale = TRUE)

# with binning
plot_APCheatmap(dat = travel, y_var = "mainTrip_distance",
                bin_heatmap = TRUE, y_var_logScale = TRUE)

# variant B: plot some smoothed, estimated mean structure
model &lt;- gam(mainTrip_distance ~ te(age, period) + residence_region +
             household_size + s(household_income), data = travel)

# plot the smooth tensor product surface
plot_APCheatmap(dat = travel, model = model, bin_heatmap = FALSE, plot_CI = FALSE)

# ... same plot including the confidence intervals
plot_APCheatmap(dat = travel, model = model, bin_heatmap = FALSE)

# the APC dimensions can be flexibly assigned to the x-axis and y-axis
plot_APCheatmap(dat = travel, model = model, dimensions = c("age","cohort"),
                bin_heatmap = FALSE, plot_CI = FALSE)

# add some reference lines
plot_APCheatmap(dat = travel, model = model, bin_heatmap = FALSE, plot_CI = FALSE,
                markLines_list = list(cohort = c(1910,1939,1955,1980)))

# default binning of the tensor product surface in 5-year-blocks
plot_APCheatmap(dat = travel, model = model, plot_CI = FALSE)

# manual binning
manual_binning &lt;- list(period = seq(min(travel$period, na.rm = TRUE) - 1,
                                    max(travel$period, na.rm = TRUE), by = 5),
                       cohort = seq(min(travel$period - travel$age, na.rm = TRUE) - 1,
                                    max(travel$period - travel$age, na.rm = TRUE), by = 10))
plot_APCheatmap(dat = travel, model = model, plot_CI = FALSE,
                bin_heatmapGrid_list = manual_binning)

</code></pre>

<hr>
<h2 id='plot_APChexamap'>Hexamap of an APC surface</h2><span id='topic+plot_APChexamap'></span>

<h3>Description</h3>

<p>Plot the heatmap of an APC structure using a hexagon-based plot with adapted
axes. In this way, the one temporal dimension that is represented by the
diagonal structure is visually not underrepresented compared to the other two
dimensions on the x-axis and y-axis. <br />
The function can be used in two ways: Either to plot the observed mean
structure of a metric variable, by specifying <code>dat</code> and the variable
<code>y_var</code>, or by specifying <code>dat</code> and the <code>model</code> object, to
plot some mean structure represented by an estimated two-dimensional tensor
product surface. The model must be estimated with <code><a href="mgcv.html#topic+gam">gam</a></code> or
<code><a href="mgcv.html#topic+bam">bam</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_APChexamap(
  dat,
  y_var = NULL,
  model = NULL,
  apc_range = NULL,
  y_var_logScale = FALSE,
  obs_interval = 1,
  iso_interval = 5,
  color_vec = NULL,
  color_range = NULL,
  line_width = 0.5,
  line_color = gray(0.5),
  label_size = 0.5,
  label_color = "black",
  legend_title = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_APChexamap_+3A_dat">dat</code></td>
<td>
<p>Dataset with columns <code>period</code> and <code>age</code>. If <code>y_var</code>
is specified, the dataset must contain the respective column. If <code>model</code>
is specified, the dataset must have been used for model estimation with
<code>gam</code> or <code>bam</code>.</p>
</td></tr>
<tr><td><code id="plot_APChexamap_+3A_y_var">y_var</code></td>
<td>
<p>Optional character name of a metric variable to be plotted.</p>
</td></tr>
<tr><td><code id="plot_APChexamap_+3A_model">model</code></td>
<td>
<p>Optional regression model estimated with <code><a href="mgcv.html#topic+gam">gam</a></code>
or <code><a href="mgcv.html#topic+bam">bam</a></code> to estimate a smoothed APC surface. Only used if
<code>y_var</code> is not
specified.</p>
</td></tr>
<tr><td><code id="plot_APChexamap_+3A_apc_range">apc_range</code></td>
<td>
<p>Optional list with one or multiple elements with names
<code>"age","period","cohort"</code> to filter the data. Each element should
contain a numeric vector of values for the respective variable that should
be kept in the data. All other values are deleted.</p>
</td></tr>
<tr><td><code id="plot_APChexamap_+3A_y_var_logscale">y_var_logScale</code></td>
<td>
<p>Indicator if <code>y_var</code> should be log10 transformed.
Only used if <code>y_var</code> is specified. Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="plot_APChexamap_+3A_obs_interval">obs_interval</code></td>
<td>
<p>Numeric specifying the interval width based on which the
data is spaced. Only used if <code>y_var</code> is specified. Defaults to 1, i.e.
observations each year.</p>
</td></tr>
<tr><td><code id="plot_APChexamap_+3A_iso_interval">iso_interval</code></td>
<td>
<p>Numeric specifying the interval width between the
isolines along each axis. Defaults to 5.</p>
</td></tr>
<tr><td><code id="plot_APChexamap_+3A_color_vec">color_vec</code></td>
<td>
<p>Optional character vector of color names, specifying the
color continuum.</p>
</td></tr>
<tr><td><code id="plot_APChexamap_+3A_color_range">color_range</code></td>
<td>
<p>Optional numeric vector with two elements, specifying the
ends of the color scale in the legend.</p>
</td></tr>
<tr><td><code id="plot_APChexamap_+3A_line_width">line_width</code></td>
<td>
<p>Line width of the isolines. Defaults to 0.5.</p>
</td></tr>
<tr><td><code id="plot_APChexamap_+3A_line_color">line_color</code></td>
<td>
<p>Character color name for the isolines. Defaults to gray.</p>
</td></tr>
<tr><td><code id="plot_APChexamap_+3A_label_size">label_size</code></td>
<td>
<p>Size of the labels along the axes. Defaults to 0.5.</p>
</td></tr>
<tr><td><code id="plot_APChexamap_+3A_label_color">label_color</code></td>
<td>
<p>Character color name for the labels along the axes.</p>
</td></tr>
<tr><td><code id="plot_APChexamap_+3A_legend_title">legend_title</code></td>
<td>
<p>Optional character title for the legend.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See also <code><a href="#topic+plot_APCheatmap">plot_APCheatmap</a></code> to plot a regular heatmap.
</p>
<p>If the plot is created based on the <code>model</code> object and the model was
estimated with a log or logit link, the function automatically performs an
exponential transformation of the effect.
</p>


<h3>Value</h3>

<p>Creates a plot with base R functions (not <code>ggplot2</code>).
</p>


<h3>Author(s)</h3>

<p>Hawre Jalal <a href="mailto:hjalal@pitt.edu">hjalal@pitt.edu</a>,
Alexander Bauer <a href="mailto:alexander.bauer@stat.uni-muenchen.de">alexander.bauer@stat.uni-muenchen.de</a>
</p>


<h3>References</h3>

<p>Jalal, H., Burke, D. (2020). Hexamaps for Age–Period–Cohort
Data Visualization and Implementation in R.
<em>Epidemiology</em>, 31 (6), e47-e49. doi: 10.1097/EDE.0000000000001236.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot_APCheatmap">plot_APCheatmap</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(APCtools)
library(mgcv)
library(dplyr)

data(drug_deaths)

# restrict to data where the mortality rate is available
drug_deaths &lt;- drug_deaths %&gt;% filter(!is.na(mortality_rate))

# hexamap of an observed structure
plot_APChexamap(dat         = drug_deaths,
                y_var       = "mortality_rate",
                color_range = c(0,40))

# hexamap of a smoothed structure
model &lt;- gam(mortality_rate ~ te(age, period, bs = "ps", k = c(8,8)),
             data = drug_deaths)

plot_APChexamap(dat = drug_deaths, model = model)

</code></pre>

<hr>
<h2 id='plot_density'>Plot the density of one metric or categorical variable</h2><span id='topic+plot_density'></span>

<h3>Description</h3>

<p>Create a density plot or a boxplot of one metric variable or a barplot
of one categorical variable, based on a specific subset of the data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_density(
  dat,
  y_var,
  plot_type = "density",
  apc_range = NULL,
  highlight_diagonals = NULL,
  y_var_cat_breaks = NULL,
  y_var_cat_labels = NULL,
  weights_var = NULL,
  log_scale = FALSE,
  xlab = NULL,
  ylab = NULL,
  legend_title = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_density_+3A_dat">dat</code></td>
<td>
<p>Dataset with columns <code>period</code> and <code>age</code> and the
main variable specified through argument <code>y_var</code>.</p>
</td></tr>
<tr><td><code id="plot_density_+3A_y_var">y_var</code></td>
<td>
<p>Character name of the main variable to be plotted.</p>
</td></tr>
<tr><td><code id="plot_density_+3A_plot_type">plot_type</code></td>
<td>
<p>One of <code>c("density","boxplot")</code>. Only used if the
<code>y_var</code> column is metric.</p>
</td></tr>
<tr><td><code id="plot_density_+3A_apc_range">apc_range</code></td>
<td>
<p>Optional list with one or multiple elements with names
<code>"age","period","cohort"</code> to filter the data. Each element should
contain a numeric vector of values for the respective variable that should
be kept in the data. All other values are deleted.</p>
</td></tr>
<tr><td><code id="plot_density_+3A_highlight_diagonals">highlight_diagonals</code></td>
<td>
<p>Optional internal parameter which is only
specified when <code>plot_density</code> is called from within
<code>plot_densityMatrix</code>. See <code><a href="#topic+plot_densityMatrix">plot_densityMatrix</a></code> for details.</p>
</td></tr>
<tr><td><code id="plot_density_+3A_y_var_cat_breaks">y_var_cat_breaks</code></td>
<td>
<p>Optional numeric vector of breaks to categorize
<code>y_var</code> based on calling function <code><a href="base.html#topic+cut">cut</a></code>. Only used to
highlight the categories based on different colors. And only used if the
<code>y_var</code> column is numeric.</p>
</td></tr>
<tr><td><code id="plot_density_+3A_y_var_cat_labels">y_var_cat_labels</code></td>
<td>
<p>Optional character vector for the names of the
categories that were defined based on <code>y_var_cat_breaks</code>. The length of
this vector must be one shorter than <code>length(y_var_cat_breaks)</code>. Only
used if the <code>y_var</code> column is numeric.</p>
</td></tr>
<tr><td><code id="plot_density_+3A_weights_var">weights_var</code></td>
<td>
<p>Optional character name of a weights variable used to
project the results in the sample to some population.</p>
</td></tr>
<tr><td><code id="plot_density_+3A_log_scale">log_scale</code></td>
<td>
<p>Indicator if the main variable should be log10 transformed.
Only used if the <code>y_var</code> column is numeric. Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="plot_density_+3A_xlab">xlab</code>, <code id="plot_density_+3A_ylab">ylab</code>, <code id="plot_density_+3A_legend_title">legend_title</code></td>
<td>
<p>Optional plot annotations.</p>
</td></tr>
<tr><td><code id="plot_density_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code><a href="stats.html#topic+density">density</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>plot_density</code> is called internally from within
<code><a href="#topic+plot_densityMatrix">plot_densityMatrix</a></code> (i.e., if the dataset contains some of the
columns <code>c("age_group","period_group","cohort_group")</code>), this function
will calculate the metric densities individually for these groups.
</p>


<h3>Value</h3>

<p>ggplot object
</p>


<h3>Author(s)</h3>

<p>Alexander Bauer <a href="mailto:alexander.bauer@stat.uni-muenchen.de">alexander.bauer@stat.uni-muenchen.de</a>,
Maximilian Weigert <a href="mailto:maximilian.weigert@stat.uni-muenchen.de">maximilian.weigert@stat.uni-muenchen.de</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(APCtools)
data(travel)

plot_density(dat = travel, y_var = "mainTrip_distance")

plot_density(dat = travel, y_var = "mainTrip_distance")

</code></pre>

<hr>
<h2 id='plot_density_categorical'>Internal helper to plot a categorical density</h2><span id='topic+plot_density_categorical'></span>

<h3>Description</h3>

<p>Internal helper function to plot one categorical density, to be called from
within <code><a href="#topic+plot_density">plot_density</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_density_categorical(
  dat,
  y_var,
  dat_highlightDiagonals = NULL,
  weights_var = NULL,
  xlab = NULL,
  ylab = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_density_categorical_+3A_dat">dat</code></td>
<td>
<p>Dataset with columns <code>period</code> and <code>age</code> and the
main variable specified through argument <code>y_var</code>.</p>
</td></tr>
<tr><td><code id="plot_density_categorical_+3A_y_var">y_var</code></td>
<td>
<p>Character name of the main variable to be plotted.</p>
</td></tr>
<tr><td><code id="plot_density_categorical_+3A_dat_highlightdiagonals">dat_highlightDiagonals</code></td>
<td>
<p>Optional dataset created by
<code><a href="#topic+create_highlightDiagonalData">create_highlightDiagonalData</a></code> to highlight specific diagonals
in a density matrix.</p>
</td></tr>
<tr><td><code id="plot_density_categorical_+3A_weights_var">weights_var</code></td>
<td>
<p>Optional character name of a weights variable used to
project the results in the sample to some population.</p>
</td></tr>
<tr><td><code id="plot_density_categorical_+3A_xlab">xlab</code>, <code id="plot_density_categorical_+3A_ylab">ylab</code></td>
<td>
<p>Optional plot annotations.</p>
</td></tr>
</table>

<hr>
<h2 id='plot_density_metric'>Internal helper to plot a metric density</h2><span id='topic+plot_density_metric'></span>

<h3>Description</h3>

<p>Internal helper function to plot one metric density, to be called from within
<code><a href="#topic+plot_density">plot_density</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_density_metric(
  dat,
  y_var,
  plot_type = "density",
  dat_highlightDiagonals = NULL,
  y_var_cat_breaks = NULL,
  y_var_cat_labels = NULL,
  weights_var = NULL,
  log_scale = FALSE,
  xlab = NULL,
  ylab = NULL,
  legend_title = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_density_metric_+3A_dat">dat</code></td>
<td>
<p>Dataset with columns <code>period</code> and <code>age</code> and the
main variable specified through argument <code>y_var</code>.</p>
</td></tr>
<tr><td><code id="plot_density_metric_+3A_y_var">y_var</code></td>
<td>
<p>Character name of the main variable to be plotted.</p>
</td></tr>
<tr><td><code id="plot_density_metric_+3A_plot_type">plot_type</code></td>
<td>
<p>One of <code>c("density","boxplot")</code>. Only used if the
<code>y_var</code> column is metric.</p>
</td></tr>
<tr><td><code id="plot_density_metric_+3A_dat_highlightdiagonals">dat_highlightDiagonals</code></td>
<td>
<p>Optional dataset created by
<code><a href="#topic+create_highlightDiagonalData">create_highlightDiagonalData</a></code> to highlight specific diagonals
in a density matrix.</p>
</td></tr>
<tr><td><code id="plot_density_metric_+3A_y_var_cat_breaks">y_var_cat_breaks</code></td>
<td>
<p>Optional numeric vector of breaks to categorize
<code>y_var</code> based on calling function <code><a href="base.html#topic+cut">cut</a></code>. Only used to
highlight the categories based on different colors. And only used if the
<code>y_var</code> column is numeric.</p>
</td></tr>
<tr><td><code id="plot_density_metric_+3A_y_var_cat_labels">y_var_cat_labels</code></td>
<td>
<p>Optional character vector for the names of the
categories that were defined based on <code>y_var_cat_breaks</code>. The length of
this vector must be one shorter than <code>length(y_var_cat_breaks)</code>. Only
used if the <code>y_var</code> column is numeric.</p>
</td></tr>
<tr><td><code id="plot_density_metric_+3A_weights_var">weights_var</code></td>
<td>
<p>Optional character name of a weights variable used to
project the results in the sample to some population.</p>
</td></tr>
<tr><td><code id="plot_density_metric_+3A_log_scale">log_scale</code></td>
<td>
<p>Indicator if the main variable should be log10 transformed.
Only used if the <code>y_var</code> column is numeric. Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="plot_density_metric_+3A_xlab">xlab</code>, <code id="plot_density_metric_+3A_ylab">ylab</code>, <code id="plot_density_metric_+3A_legend_title">legend_title</code></td>
<td>
<p>Optional plot annotations.</p>
</td></tr>
<tr><td><code id="plot_density_metric_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code><a href="stats.html#topic+density">density</a></code>.</p>
</td></tr>
</table>

<hr>
<h2 id='plot_densityMatrix'>Create a matrix of density plots</h2><span id='topic+plot_densityMatrix'></span>

<h3>Description</h3>

<p>This function creates a matrix of individual density plots
(i.e., a <em>ridgeline matrix</em>) or boxplots (for
metric variables) or of individual barplots (for categorical variables).
The age, period or cohort information can each either be plotted on the
x-axis or the y-axis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_densityMatrix(
  dat,
  y_var,
  dimensions = c("period", "age"),
  age_groups = NULL,
  period_groups = NULL,
  cohort_groups = NULL,
  plot_type = "density",
  highlight_diagonals = NULL,
  y_var_cat_breaks = NULL,
  y_var_cat_labels = NULL,
  weights_var = NULL,
  log_scale = FALSE,
  legend_title = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_densityMatrix_+3A_dat">dat</code></td>
<td>
<p>Dataset with columns <code>period</code> and <code>age</code> and the
main variable specified through argument <code>y_var</code>.</p>
</td></tr>
<tr><td><code id="plot_densityMatrix_+3A_y_var">y_var</code></td>
<td>
<p>Character name of the main variable to be plotted.</p>
</td></tr>
<tr><td><code id="plot_densityMatrix_+3A_dimensions">dimensions</code></td>
<td>
<p>Character vector specifying the two APC dimensions that
should be visualized along the x-axis and y-axis. Defaults to
<code>c("period","age")</code>.</p>
</td></tr>
<tr><td><code id="plot_densityMatrix_+3A_age_groups">age_groups</code>, <code id="plot_densityMatrix_+3A_period_groups">period_groups</code>, <code id="plot_densityMatrix_+3A_cohort_groups">cohort_groups</code></td>
<td>
<p>Each a list. Either containing
purely scalar values or with each element specifying the two borders of one
row or column in the density matrix. E.g., if the period should be visualized
in decade columns from 1980 to 2009, specify
<code>period_groups = list(c(1980,1989), c(1990,1999), c(2000,2009))</code>.
The list can be named to specify labels for the categories. Only the two
arguments must be passed that were specified by the <code>dimensions</code>
argument.</p>
</td></tr>
<tr><td><code id="plot_densityMatrix_+3A_plot_type">plot_type</code></td>
<td>
<p>One of <code>c("density","boxplot")</code>. Only used if the
<code>y_var</code> column is metric.</p>
</td></tr>
<tr><td><code id="plot_densityMatrix_+3A_highlight_diagonals">highlight_diagonals</code></td>
<td>
<p>Optional list to define diagonals in the density
that should be highlighted with different colors. Each list element should be
a numeric vector stating the index of the diagonals (counted from the top
left) that should be highlighted in the same color. If the list is named, the
names are used as legend labels.</p>
</td></tr>
<tr><td><code id="plot_densityMatrix_+3A_y_var_cat_breaks">y_var_cat_breaks</code></td>
<td>
<p>Optional numeric vector of breaks to categorize
<code>y_var</code> based on calling function <code><a href="base.html#topic+cut">cut</a></code>. Only used to
highlight the categories based on different colors. And only used if the
<code>y_var</code> column is numeric.</p>
</td></tr>
<tr><td><code id="plot_densityMatrix_+3A_y_var_cat_labels">y_var_cat_labels</code></td>
<td>
<p>Optional character vector for the names of the
categories that were defined based on <code>y_var_cat_breaks</code>. The length of
this vector must be one shorter than <code>length(y_var_cat_breaks)</code>. Only
used if the <code>y_var</code> column is numeric.</p>
</td></tr>
<tr><td><code id="plot_densityMatrix_+3A_weights_var">weights_var</code></td>
<td>
<p>Optional character name of a weights variable used to
project the results in the sample to some population.</p>
</td></tr>
<tr><td><code id="plot_densityMatrix_+3A_log_scale">log_scale</code></td>
<td>
<p>Indicator if the main variable should be log10 transformed.
Only used if the <code>y_var</code> column is numeric. Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="plot_densityMatrix_+3A_legend_title">legend_title</code></td>
<td>
<p>Optional plot annotation.</p>
</td></tr>
<tr><td><code id="plot_densityMatrix_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code><a href="#topic+plot_density">plot_density</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ggplot object
</p>


<h3>Author(s)</h3>

<p>Alexander Bauer <a href="mailto:alexander.bauer@stat.uni-muenchen.de">alexander.bauer@stat.uni-muenchen.de</a>,
Maximilian Weigert <a href="mailto:maximilian.weigert@stat.uni-muenchen.de">maximilian.weigert@stat.uni-muenchen.de</a>
</p>


<h3>References</h3>

<p>Weigert, M., Bauer, A., Gernert, J., Karl, M., Nalmpatian, A.,
Küchenhoff, H., and Schmude, J. (2021). Semiparametric APC analysis of
destination choice patterns: Using generalized additive models to quantify
the impact of age, period, and cohort on travel distances.
<em>Tourism Economics</em>. doi:10.1177/1354816620987198.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(APCtools)

# define categorizations for the main trip distance
dist_cat_breaks &lt;- c(1,500,1000,2000,6000,100000)
dist_cat_labels &lt;- c("&lt; 500 km","500 - 1,000 km", "1,000 - 2,000 km",
                     "2,000 - 6,000 km", "&gt; 6,000 km")

age_groups    &lt;- list(c(80,89),c(70,79),c(60,69),c(50,59),c(40,49),c(30,39),c(20,29))
period_groups &lt;- list(c(1970,1979),c(1980,1989),c(1990,1999),c(2000,2009),c(2010,2019))
cohort_groups &lt;- list(c(1980,1989),c(1970,1979),c(1960,1969),c(1950,1959),c(1940,1949),
                      c(1930,1939),c(1920,1929))

plot_densityMatrix(dat              = travel,
                   y_var            = "mainTrip_distance",
                   age_groups       = age_groups,
                   period_groups    = period_groups,
                   log_scale        = TRUE)


# highlight two cohorts
plot_densityMatrix(dat                 = travel,
                   y_var               = "mainTrip_distance",
                   age_groups          = age_groups,
                   period_groups       = period_groups,
                   highlight_diagonals = list(8, 10),
                   log_scale           = TRUE)

# also mark different distance categories
plot_densityMatrix(dat              = travel,
                   y_var            = "mainTrip_distance",
                   age_groups       = age_groups,
                   period_groups    = period_groups,
                   log_scale        = TRUE,
                   y_var_cat_breaks = dist_cat_breaks,
                   y_var_cat_labels = dist_cat_labels,
                   highlight_diagonals = list(8, 10),
                   legend_title     = "Distance category")

# flexibly assign the APC dimensions to the x-axis and y-axis
plot_densityMatrix(dat              = travel,
                   y_var            = "mainTrip_distance",
                   dimensions       = c("period","cohort"),
                   period_groups    = period_groups,
                   cohort_groups    = cohort_groups,
                   log_scale        = TRUE,
                   y_var_cat_breaks = dist_cat_breaks,
                   y_var_cat_labels = dist_cat_labels,
                   legend_title     = "Distance category")

# use boxplots instead of densities
plot_densityMatrix(dat           = travel,
                   y_var         = "mainTrip_distance",
                   plot_type     = "boxplot",
                   age_groups    = age_groups,
                   period_groups = period_groups,
                   log_scale     = TRUE,
                   highlight_diagonals = list(8, 10))

# plot categorical variables instead of metric ones
plot_densityMatrix(dat                 = travel,
                   y_var               = "household_size",
                   age_groups          = age_groups,
                   period_groups       = period_groups,
                   highlight_diagonals = list(8, 10))


</code></pre>

<hr>
<h2 id='plot_jointMarginalAPCeffects'>Joint plot to compare the marginal APC effects of multiple models</h2><span id='topic+plot_jointMarginalAPCeffects'></span>

<h3>Description</h3>

<p>This function creates a joint plot of the marginal APC effects of multiple
estimated models. It creates a plot with one pane per age, period and
cohort effect, each containing one lines for each estimated model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_jointMarginalAPCeffects(
  model_list,
  dat,
  vlines_list = NULL,
  ylab = NULL,
  ylim = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_jointMarginalAPCeffects_+3A_model_list">model_list</code></td>
<td>
<p>A list of regression models estimated with
<code><a href="mgcv.html#topic+gam">gam</a></code> or <code><a href="mgcv.html#topic+bam">bam</a></code>. If the list is named, the
names are used as labels. Can also be a single model object instead of a list.</p>
</td></tr>
<tr><td><code id="plot_jointMarginalAPCeffects_+3A_dat">dat</code></td>
<td>
<p>Dataset with columns <code>period</code> and <code>age</code>. If <code>y_var</code>
is specified, the dataset must contain the respective column. If <code>model</code>
is specified, the dataset must have been used for model estimation with
<code>gam</code> or <code>bam</code>.</p>
</td></tr>
<tr><td><code id="plot_jointMarginalAPCeffects_+3A_vlines_list">vlines_list</code></td>
<td>
<p>Optional list that can be used to highlight the borders of
specific age groups, time intervals or cohorts. Each element must be a
numeric vector of values on the x-axis where vertical lines should be drawn.
The list can maximally have three elements and must have names out of
<code>c("age","period","cohort"</code>.</p>
</td></tr>
<tr><td><code id="plot_jointMarginalAPCeffects_+3A_ylab">ylab</code>, <code id="plot_jointMarginalAPCeffects_+3A_ylim">ylim</code></td>
<td>
<p>Optional ggplot2 styling arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If the model was estimated with a log or logit link, the function
automatically performs an exponential transformation of the effect.
</p>
<p>Since the plot output created by the function is no <code>ggplot2</code> object,
but an object created with <code>ggpubr::ggarrange</code>, the overall theme
of the plot cannot be changed by adding the theme in the form of
'<code>plot_jointMarginalAPCeffects(...) + theme_minimal(...)</code>'.
Instead, you can call <code>theme_set(theme_minimal(...))</code> as an individual
call before calling <code>plot_jointMarginalAPCeffects(...)</code>. The latter
function will then use this global plotting theme.
</p>


<h3>Value</h3>

<p>Plot grid created with <code><a href="ggpubr.html#topic+ggarrange">ggarrange</a></code>.
</p>


<h3>Author(s)</h3>

<p>Alexander Bauer <a href="mailto:alexander.bauer@stat.uni-muenchen.de">alexander.bauer@stat.uni-muenchen.de</a>,
Maximilian Weigert <a href="mailto:maximilian.weigert@stat.uni-muenchen.de">maximilian.weigert@stat.uni-muenchen.de</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(APCtools)
library(mgcv)

data(travel)

# plot marginal effects of one model
model_pure &lt;- gam(mainTrip_distance ~ te(age, period), data = travel)
plot_jointMarginalAPCeffects(model_pure, dat = travel)

# plot marginal effects of multiple models
model_cov  &lt;- gam(mainTrip_distance ~ te(age, period) + s(household_income),
                  data = travel)
model_list &lt;- list("pure model"      = model_pure,
                   "covariate model" = model_cov)
plot_jointMarginalAPCeffects(model_list, dat = travel)

# mark specific cohorts
plot_jointMarginalAPCeffects(model_list, dat = travel,
                             vlines_list = list("cohort" = c(1966.5,1982.5,1994.5)))

</code></pre>

<hr>
<h2 id='plot_linearEffects'>Plot linear effects of a gam in an effect plot</h2><span id='topic+plot_linearEffects'></span>

<h3>Description</h3>

<p>Create an effect plot of linear effects of a model fitted with
<code><a href="mgcv.html#topic+gam">gam</a></code> or <code><a href="mgcv.html#topic+bam">bam</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_linearEffects(
  model,
  variables = NULL,
  return_plotData = FALSE,
  refCat = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_linearEffects_+3A_model">model</code></td>
<td>
<p>Model fitted with <code><a href="mgcv.html#topic+gam">gam</a></code> or <code><a href="mgcv.html#topic+bam">bam</a></code>.</p>
</td></tr>
<tr><td><code id="plot_linearEffects_+3A_variables">variables</code></td>
<td>
<p>Optional character vector of variable names specifying which
effects should be plotted. The order of the vector corresponds to
the order in the effect plot. If the argument is not specified, all linear
effects are plotted according to the order of their appearance in the model
output.</p>
</td></tr>
<tr><td><code id="plot_linearEffects_+3A_return_plotdata">return_plotData</code></td>
<td>
<p>If TRUE, the dataset prepared for plotting is
returned. Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="plot_linearEffects_+3A_refcat">refCat</code></td>
<td>
<p>If TRUE, reference categories are added to the output for
categorical covariates. Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="plot_linearEffects_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to
<code><a href="#topic+extract_summary_linearEffects">extract_summary_linearEffects</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If the model was estimated with a log or logit link, the function
automatically performs an exponential transformation of the effect.
</p>


<h3>Value</h3>

<p>ggplot object
</p>


<h3>Author(s)</h3>

<p>Alexander Bauer <a href="mailto:alexander.bauer@stat.uni-muenchen.de">alexander.bauer@stat.uni-muenchen.de</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(APCtools)
library(mgcv)

data(travel)
model &lt;- gam(mainTrip_distance ~ te(age, period) + residence_region +
             household_size + s(household_income), data = travel)

plot_linearEffects(model)

</code></pre>

<hr>
<h2 id='plot_marginalAPCeffects'>Plot of marginal APC effects based on an estimated GAM model</h2><span id='topic+plot_marginalAPCeffects'></span>

<h3>Description</h3>

<p>Plot the marginal effect of age, period or cohort, based on an APC model
estimated as a semiparametric additive regression model with <code><a href="mgcv.html#topic+gam">gam</a></code>
or <code><a href="mgcv.html#topic+bam">bam</a></code>.
This function is a simple wrapper to <code><a href="#topic+plot_partialAPCeffects">plot_partialAPCeffects</a></code>,
called with argument <code>hide_partialEffects = TRUE</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_marginalAPCeffects(
  model,
  dat,
  variable = "age",
  vlines_vec = NULL,
  return_plotData = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_marginalAPCeffects_+3A_model">model</code></td>
<td>
<p>Optional regression model estimated with <code><a href="mgcv.html#topic+gam">gam</a></code>
or <code><a href="mgcv.html#topic+bam">bam</a></code> to estimate a smoothed APC surface. Only used if
<code>y_var</code> is not
specified.</p>
</td></tr>
<tr><td><code id="plot_marginalAPCeffects_+3A_dat">dat</code></td>
<td>
<p>Dataset with columns <code>period</code> and <code>age</code>. If <code>y_var</code>
is specified, the dataset must contain the respective column. If <code>model</code>
is specified, the dataset must have been used for model estimation with
<code>gam</code> or <code>bam</code>.</p>
</td></tr>
<tr><td><code id="plot_marginalAPCeffects_+3A_variable">variable</code></td>
<td>
<p>One of <code>c("age","period","cohort")</code>, specifying the
temporal dimension for which the partial effect plots should be created.</p>
</td></tr>
<tr><td><code id="plot_marginalAPCeffects_+3A_vlines_vec">vlines_vec</code></td>
<td>
<p>Optional numeric vector of values on the x-axis where
vertical lines should be drawn. Can be used to highlight the borders of
specific age groups, time intervals or cohorts.</p>
</td></tr>
<tr><td><code id="plot_marginalAPCeffects_+3A_return_plotdata">return_plotData</code></td>
<td>
<p>If TRUE, a list of the datasets prepared for plotting
is returned instead of the ggplot object. The list contains one dataset each
for the overall effect (= evaluations of the APC surface to plot the partial
effects) and for each marginal APC effect (no matter the specified value of
the argument <code>variable</code>). Defaults to FALSE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ggplot object
</p>


<h3>Author(s)</h3>

<p>Alexander Bauer <a href="mailto:alexander.bauer@stat.uni-muenchen.de">alexander.bauer@stat.uni-muenchen.de</a>,
Maximilian Weigert <a href="mailto:maximilian.weigert@stat.uni-muenchen.de">maximilian.weigert@stat.uni-muenchen.de</a>
</p>


<h3>References</h3>

<p>Weigert, M., Bauer, A., Gernert, J., Karl, M., Nalmpatian, A.,
Küchenhoff, H., and Schmude, J. (2021). Semiparametric APC analysis of
destination choice patterns: Using generalized additive models to quantify
the impact of age, period, and cohort on travel distances.
<em>Tourism Economics</em>. doi:10.1177/1354816620987198.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(APCtools)
library(mgcv)

data(travel)
model &lt;- gam(mainTrip_distance ~ te(age, period), data = travel)

plot_marginalAPCeffects(model, dat = travel, variable = "age")

# mark specific cohorts
plot_marginalAPCeffects(model, dat = travel, variable = "cohort",
                        vlines_vec = c(1966.5,1982.5,1994.5))

</code></pre>

<hr>
<h2 id='plot_partialAPCeffects'>Partial APC plots based on an estimated GAM model</h2><span id='topic+plot_partialAPCeffects'></span>

<h3>Description</h3>

<p>Create the partial APC plots based on an APC model estimated as a semiparametric
additive regression model with <code><a href="mgcv.html#topic+gam">gam</a></code> or <code><a href="mgcv.html#topic+bam">bam</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_partialAPCeffects(
  model,
  dat,
  variable = "age",
  hide_partialEffects = FALSE,
  vlines_vec = NULL,
  return_plotData = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_partialAPCeffects_+3A_model">model</code></td>
<td>
<p>Optional regression model estimated with <code><a href="mgcv.html#topic+gam">gam</a></code>
or <code><a href="mgcv.html#topic+bam">bam</a></code> to estimate a smoothed APC surface. Only used if
<code>y_var</code> is not
specified.</p>
</td></tr>
<tr><td><code id="plot_partialAPCeffects_+3A_dat">dat</code></td>
<td>
<p>Dataset with columns <code>period</code> and <code>age</code>. If <code>y_var</code>
is specified, the dataset must contain the respective column. If <code>model</code>
is specified, the dataset must have been used for model estimation with
<code>gam</code> or <code>bam</code>.</p>
</td></tr>
<tr><td><code id="plot_partialAPCeffects_+3A_variable">variable</code></td>
<td>
<p>One of <code>c("age","period","cohort")</code>, specifying the
temporal dimension for which the partial effect plots should be created.</p>
</td></tr>
<tr><td><code id="plot_partialAPCeffects_+3A_hide_partialeffects">hide_partialEffects</code></td>
<td>
<p>If TRUE, only the marginal effect will be plotted.
Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="plot_partialAPCeffects_+3A_vlines_vec">vlines_vec</code></td>
<td>
<p>Optional numeric vector of values on the x-axis where
vertical lines should be drawn. Can be used to highlight the borders of
specific age groups, time intervals or cohorts.</p>
</td></tr>
<tr><td><code id="plot_partialAPCeffects_+3A_return_plotdata">return_plotData</code></td>
<td>
<p>If TRUE, a list of the datasets prepared for plotting
is returned instead of the ggplot object. The list contains one dataset each
for the overall effect (= evaluations of the APC surface to plot the partial
effects) and for each marginal APC effect (no matter the specified value of
the argument <code>variable</code>). Defaults to FALSE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If the model was estimated with a log or logit link, the function
automatically performs an exponential transformation of the effect.
</p>


<h3>Value</h3>

<p>ggplot object (if <code>hide_partialEffects</code> is TRUE) or a plot grid
created with <code><a href="ggpubr.html#topic+ggarrange">ggarrange</a></code> (if FALSE).
</p>


<h3>Author(s)</h3>

<p>Alexander Bauer <a href="mailto:alexander.bauer@stat.uni-muenchen.de">alexander.bauer@stat.uni-muenchen.de</a>,
Maximilian Weigert <a href="mailto:maximilian.weigert@stat.uni-muenchen.de">maximilian.weigert@stat.uni-muenchen.de</a>
</p>


<h3>References</h3>

<p>Weigert, M., Bauer, A., Gernert, J., Karl, M., Nalmpatian, A.,
Küchenhoff, H., and Schmude, J. (2021). Semiparametric APC analysis of
destination choice patterns: Using generalized additive models to quantify
the impact of age, period, and cohort on travel distances.
<em>Tourism Economics</em>. doi:10.1177/1354816620987198.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(APCtools)
library(mgcv)

data(travel)
model &lt;- gam(mainTrip_distance ~ te(age, period), data = travel)

plot_partialAPCeffects(model, dat = travel, variable = "age")

# mark specific cohorts
plot_partialAPCeffects(model, dat = travel, variable = "cohort",
                       vlines_vec = c(1966.5,1982.5,1994.5))

</code></pre>

<hr>
<h2 id='plot_variable'>Distribution plot of one variable against one APC dimension</h2><span id='topic+plot_variable'></span>

<h3>Description</h3>

<p>Plot the distribution of one variable in the data against age, period or
cohort. Creates a bar plot for categorical variables (see argument
<code>geomBar_position</code>) and boxplots or a line plot of median values for
metric variables (see <code>plot_type</code>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_variable(
  dat,
  y_var,
  apc_dimension = "period",
  log_scale = FALSE,
  plot_type = "boxplot",
  geomBar_position = "fill",
  legend_title = NULL,
  ylab = NULL,
  ylim = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_variable_+3A_dat">dat</code></td>
<td>
<p>Dataset containing columns <code>age</code> and <code>period</code>.</p>
</td></tr>
<tr><td><code id="plot_variable_+3A_y_var">y_var</code></td>
<td>
<p>Character name of the variable to plot.</p>
</td></tr>
<tr><td><code id="plot_variable_+3A_apc_dimension">apc_dimension</code></td>
<td>
<p>One of <code>c("age","period","cohort")</code>. Defaults to
<code>"period"</code>.</p>
</td></tr>
<tr><td><code id="plot_variable_+3A_log_scale">log_scale</code></td>
<td>
<p>Indicator if the visualized variable should be log10
transformed. Only used if the variable is numeric. Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="plot_variable_+3A_plot_type">plot_type</code></td>
<td>
<p>One of <code>c("boxplot","line","line-points")</code>, specifying
if boxplots or a line plot of median values should be drawn for metric
variables. <code>"line-points"</code> adds points to the line plot where
observations are available.</p>
</td></tr>
<tr><td><code id="plot_variable_+3A_geombar_position">geomBar_position</code></td>
<td>
<p>Value passed to <code><a href="ggplot2.html#topic+geom_bar">geom_bar</a></code> as
<code>position</code> argument. Only used if the visualized variable is categorical.
Defaults to <code>"fill"</code>.</p>
</td></tr>
<tr><td><code id="plot_variable_+3A_legend_title">legend_title</code></td>
<td>
<p>Optional character title for the legend which is drawn
for categorical variables.</p>
</td></tr>
<tr><td><code id="plot_variable_+3A_ylab">ylab</code>, <code id="plot_variable_+3A_ylim">ylim</code></td>
<td>
<p>Optional arguments for styling the ggplot.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ggplot object
</p>


<h3>Author(s)</h3>

<p>Alexander Bauer <a href="mailto:alexander.bauer@stat.uni-muenchen.de">alexander.bauer@stat.uni-muenchen.de</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(APCtools)
data(travel)

# plot a metric variable
plot_variable(dat = travel, y_var = "mainTrip_distance",
              apc_dimension = "period", log_scale = TRUE)
plot_variable(dat = travel, y_var = "mainTrip_distance",
              apc_dimension = "period", log_scale = TRUE, plot_type = "line")

# plot a categorical variable
plot_variable(dat = travel, y_var = "household_size", apc_dimension = "period")
plot_variable(dat = travel, y_var = "household_size", apc_dimension = "period",
              geomBar_position = "stack")

</code></pre>

<hr>
<h2 id='travel'>Data from the German Reiseanalyse survey</h2><span id='topic+travel'></span>

<h3>Description</h3>

<p>This dataset from the
<a href="https://reiseanalyse.de/en/">Reiseanalyse survey</a> comprises travel
information on German travelers between 1971 and 2018. Data were collected
in a yearly repeated cross-sectional survey of German pleasure travels,
based on a sample representative for the (West) German citizens (until 2009)
or for all German-speaking residents (starting 2010). Travelers from former
East Germany are only included since 1990. Note that the sample only contains
trips with at least five days of trip length. For details see
<a href="https://journals.sagepub.com/doi/10.1177/1354816620987198">Weigert et al. (2021)</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(travel)
</code></pre>


<h3>Format</h3>

<p>A dataframe containing
</p>

<dl>
<dt>period</dt><dd><p>Year in which the respondent traveled.</p>
</dd>
<dt>age</dt><dd><p>Age of the respondent.</p>
</dd>
<dt>sampling_weight</dt><dd><p>Individual weight of each respondent to account for
a not perfectly representative sample and project the sample results to
the population of German citizens (until 2009) or of German-speaking
residents (starting 2010). Only available since 1974.</p>
</dd>
<dt>german_citizenship</dt><dd><p>Indicator if the respondent is German citizen or
not. Only available since 2010. Until 2009, all respondents were German
citizens.</p>
</dd>
<dt>residence_region</dt><dd><p>Indicator if the respondent's main residence is in a
federal state in the former area of West Germany or in the former area of
East Germany.</p>
</dd>
<dt>household size</dt><dd><p>Categorized size of the respondent's household.</p>
</dd>
<dt>household_income</dt><dd><p>Joint income (in €) of the respondent's household.</p>
</dd>
<dt>mainTrip_duration</dt><dd><p>Categorized trip length of the respondent's
<em>main trip</em>. The main trip is the trip which the respondent stated was
his/her most important trip in the respective year.</p>
</dd>
<dt>mainTrip_distance</dt><dd><p>Distance (in km) between the center of the
respondent's federal state and the center of the country of destination,
for the <em>main trip</em>. The main trip is the trip which the respondent
stated was his/her most important trip in the respective year.</p>
</dd>
</dl>



<h3>Details</h3>

<p>The data are a 10% random sample of all respondents who undertook at least
one trip in the respective year, between 1971 and 2018. We thank the
<a href="https://reiseanalyse.de/en/">Forschungsgemeinschaft Urlaub und Reisen e.V.</a>
for allowing us to publish this sample.
</p>


<h3>References</h3>

<p>Weigert, M., Bauer, A., Gernert, J., Karl, M., Nalmpatian, A., Küchenhoff,
H., and Schmude, J. (2021). Semiparametric APC analysis of destination choice
patterns: Using generalized additive models to quantify the impact of age,
period, and cohort on travel distances. <em>Tourism Economics</em>.
<a href="https://doi.org/10.1177/1354816620987198">doi:10.1177/1354816620987198</a>.
</p>
<p>Forschungsgemeinschaft Urlaub und Reisen e.V. (FUR) (2020b) <em>Survey of
tourist demand in Germany for holiday travel and short breaks</em>. Available at:
<a href="https://reiseanalyse.de/wp-content/uploads/2022/11/RA2020_First-results_EN.pdf">https://reiseanalyse.de/wp-content/uploads/2022/11/RA2020_First-results_EN.pdf</a>
(accessed 13 January 2023).
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
