<!DOCTYPE html><html lang="en"><head><title>Help for package beeca</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {beeca}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#beeca-package'><p>beeca: Binary Endpoint Estimation with Covariate Adjustment</p></a></li>
<li><a href='#apply_contrast'><p>Apply contrast to calculate marginal estimate of treatment effect and corresponding standard error</p></a></li>
<li><a href='#average_predictions'><p>Average over counterfactual predictions</p></a></li>
<li><a href='#estimate_varcov'><p>Estimate variance-covariance matrix for marginal estimand based on GLM model</p></a></li>
<li><a href='#ge_macro_trial01'><p>Output from the Ge et al (2011) SAS macro applied to the trial01 dataset</p></a></li>
<li><a href='#get_marginal_effect'><p>Estimate marginal treatment effects using a GLM working model</p></a></li>
<li><a href='#margins_trial01'><p>Output from the Margins SAS macro applied to the trial01 dataset</p></a></li>
<li><a href='#predict_counterfactuals'><p>Predict counterfactual outcomes in GLM models</p></a></li>
<li><a href='#sanitize_model'><p>(internal) Sanitize functions to check model and data within GLM model object</p></a></li>
<li><a href='#sanitize_model.glm'><p>(internal) Sanitize a glm model</p></a></li>
<li><a href='#sanitize_variable'><p>(internal) Sanitize function to check model and data</p></a></li>
<li><a href='#trial01'><p>Example trial dataset 01</p></a></li>
<li><a href='#trial02_cdisc'><p>Example CDISC Clinical Trial Dataset in ADaM Format</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Binary Endpoint Estimation with Covariate Adjustment</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Performs estimation of marginal treatment effects for binary 
  outcomes when using logistic regression working models with covariate 
  adjustment (see discussions in Magirr et al (2024) <a href="https://osf.io/9mp58/">https://osf.io/9mp58/</a>). 
  Implements the variance estimators of Ge et al (2011) &lt;<a href="https://doi.org/10.1177%2F009286151104500409">doi:10.1177/009286151104500409</a>&gt; 
  and Ye et al (2023) &lt;<a href="https://doi.org/10.1080%2F24754269.2023.2205802">doi:10.1080/24754269.2023.2205802</a>&gt;. </td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Alex Przybylski &lt;alexander.przybylski@novartis.com&gt;</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/LGPL-3">LGPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat (&ge; 3.0.0), tidyr,
marginaleffects, margins, RobinCar (&ge; 0.3.0)</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr, lifecycle, sandwich, stats</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://openpharma.github.io/beeca/">https://openpharma.github.io/beeca/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/openpharma/beeca/issues">https://github.com/openpharma/beeca/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-11-12 15:11:23 UTC; PRZYBAL2</td>
</tr>
<tr>
<td>Author:</td>
<td>Alex Przybylski [cre, aut],
  Mark Baillie <a href="https://orcid.org/0000-0002-5618-0667"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Craig Wang <a href="https://orcid.org/0000-0003-1804-2463"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Dominic Magirr [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-11-12 16:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='beeca-package'>beeca: Binary Endpoint Estimation with Covariate Adjustment</h2><span id='topic+beeca'></span><span id='topic+beeca-package'></span>

<h3>Description</h3>

<p>Performs estimation of marginal treatment effects for binary outcomes when using logistic regression working models with covariate adjustment (see discussions in Magirr et al (2024) <a href="https://osf.io/9mp58/">https://osf.io/9mp58/</a>). Implements the variance estimators of Ge et al (2011) <a href="https://doi.org/10.1177/009286151104500409">doi:10.1177/009286151104500409</a> and Ye et al (2023) <a href="https://doi.org/10.1080/24754269.2023.2205802">doi:10.1080/24754269.2023.2205802</a>.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Alex Przybylski <a href="mailto:alexander.przybylski@novartis.com">alexander.przybylski@novartis.com</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> Mark Baillie <a href="mailto:mark.baillie@novartis.com">mark.baillie@novartis.com</a> (<a href="https://orcid.org/0000-0002-5618-0667">ORCID</a>)
</p>
</li>
<li><p> Craig Wang <a href="mailto:craig.wang@novartis.com">craig.wang@novartis.com</a> (<a href="https://orcid.org/0000-0003-1804-2463">ORCID</a>)
</p>
</li>
<li><p> Dominic Magirr <a href="mailto:dominic.magirr@novartis.com">dominic.magirr@novartis.com</a>
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://openpharma.github.io/beeca/">https://openpharma.github.io/beeca/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/openpharma/beeca/issues">https://github.com/openpharma/beeca/issues</a>
</p>
</li></ul>


<hr>
<h2 id='apply_contrast'>Apply contrast to calculate marginal estimate of treatment effect and corresponding standard error</h2><span id='topic+apply_contrast'></span>

<h3>Description</h3>

<p>Calculates the marginal estimate of treatment effect and its corresponding
standard error based on a fitted GLM object using specified contrast (summary
measure) methods
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apply_contrast(
  object,
  contrast = c("diff", "rr", "or", "logrr", "logor"),
  reference
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="apply_contrast_+3A_object">object</code></td>
<td>
<p>a fitted <code><a href="stats.html#topic+glm">glm</a></code> object augmented with
<code>counterfactual.predictions</code>, <code>counterfactual.means</code> and <code>robust_varcov</code>.</p>
</td></tr>
<tr><td><code id="apply_contrast_+3A_contrast">contrast</code></td>
<td>
<p>a string specifying the type of contrast to apply.
Accepted values are &quot;diff&quot; (risk difference), &quot;rr&quot; (risk ratio),
&quot;or&quot; (odds ratio), &quot;logrr&quot; (log risk ratio), &quot;logor&quot; (log odds ratio).
Note: log-transformed ratios (logrr and logor) work better compared to rr
and or when computing confidence intervals using normal approximation.
The choice of contrast affects how treatment effects are calculated and
interpreted. Default is <code>diff</code>.</p>
</td></tr>
<tr><td><code id="apply_contrast_+3A_reference">reference</code></td>
<td>
<p>a string or list of strings indicating which treatment
group(s) to use as reference level for pairwise comparisons. Accepted values
must be a subset of the levels in the treatment variable. Default to the
first n-1 treatment levels used in the <code>glm</code> object.
</p>
<p>This parameter influences the calculation of treatment effects
relative to the chosen reference group.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>apply_constrast()</code> functions computes the summary measure between two arms
based on the estimated marginal effect and its variance-covariance matrix using
the Delta method.
</p>
<p>Note: Ensure that the <code>glm</code> object has been adequately prepared with
<code>average_predictions()</code> and <code>estimate_varcov()</code>
before applying <code>apply_contrast()</code>. Failure to do so may result in
errors indicating missing components.
</p>


<h3>Value</h3>

<p>An updated <code>glm</code> object with two additional components
appended: <code>marginal_est</code> (marginal estimate of the treatment effect)
and <code>marginal_se</code> (standard error of the marginal estimate).
These appended component provide crucial information for interpreting
the treatment effect using the specified contrast method.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_marginal_effect">get_marginal_effect()</a></code> for estimating marginal effects directly
from an original <code><a href="stats.html#topic+glm">glm</a></code> object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>trial01$trtp &lt;- factor(trial01$trtp)
fit1 &lt;- glm(aval ~ trtp + bl_cov, family = "binomial", data = trial01) |&gt;
  predict_counterfactuals(trt = "trtp") |&gt;
  average_predictions() |&gt;
  estimate_varcov(method = "Ye") |&gt;
  apply_contrast("diff", reference = "0")

# Assuming `trial01` is a dataset with treatment (`trtp`)
# and baseline covariate (`bl_cov`)
trial01$trtp &lt;- factor(trial01$trtp)
fit1 &lt;- glm(aval ~ trtp + bl_cov, family = "binomial", data = trial01)

# Preprocess fit1 as required by apply_contrast
fit2 &lt;- fit1 |&gt;
  predict_counterfactuals(trt = "trtp") |&gt;
  average_predictions() |&gt;
  estimate_varcov(method = "Ye")

# Apply contrast to calculate marginal estimates
fit3 &lt;- apply_contrast(fit2, contrast = "diff", reference = "0")

fit3$marginal_est
fit3$marginal_se

</code></pre>

<hr>
<h2 id='average_predictions'>Average over counterfactual predictions</h2><span id='topic+average_predictions'></span>

<h3>Description</h3>

<p><code>average_predictions()</code> averages counterfactual predictions stored within
a <code>glm</code> object. This is pivotal for estimating treatment contrasts and
associated variance estimates using g-computation. The function assumes
predictions are generated via <code>predict_counterfactuals()</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>average_predictions(object)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="average_predictions_+3A_object">object</code></td>
<td>
<p>a fitted <code><a href="stats.html#topic+glm">glm</a></code> object augmented with
counterfactual predictions named: <code>counterfactual.predictions</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>average_predictions()</code> function calculates the average over the
counterfactual predictions which can then be used to estimate a treatment
contrast and associated variance estimate.
</p>
<p>The function appends a <code>glm</code> object with the
averaged counterfactual predictions.
</p>
<p>Note: Ensure that the <code>glm</code> object has been adequately prepared with
<code>predict_counterfactuals()</code> before applying <code>average_predictions()</code>.
Failure to do so may result in errors indicating missing components.
</p>


<h3>Value</h3>

<p>an updated <code>glm</code> object appended with an additional component
<code>counterfactual.means</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+predict_counterfactuals">predict_counterfactuals()</a></code> for generating counterfactual
predictions.
</p>
<p><code><a href="#topic+estimate_varcov">estimate_varcov()</a></code> for estimating the variance-covariate matrix
of mariginal effects
</p>
<p><code><a href="#topic+get_marginal_effect">get_marginal_effect()</a></code> for estimating marginal effects directly
from an original <code><a href="stats.html#topic+glm">glm</a></code> object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Use the trial01 dataset
data(trial01)

# ensure the treatment indicator is a factor
trial01$trtp &lt;- factor(trial01$trtp)

# fit glm model for trial data
fit1 &lt;- glm(aval ~ trtp + bl_cov, family = "binomial", data = trial01)

# Preprocess fit1 as required by average_predictions
fit2 &lt;- fit1 |&gt;
  predict_counterfactuals(trt = "trtp")

# average over the counterfactual predictions
fit3 &lt;- average_predictions(fit2)

# display the average predictions
fit3$counterfactual.means

</code></pre>

<hr>
<h2 id='estimate_varcov'>Estimate variance-covariance matrix for marginal estimand based on GLM model</h2><span id='topic+estimate_varcov'></span>

<h3>Description</h3>

<p>Main variance estimation function. Estimates the variance-covariance
matrix of a marginal estimand for a generalized linear model (GLM) object
using specified methods. This function supports both Ge's and Ye's methods
for variance estimation, accommodating different estimand specifications.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_varcov(
  object,
  strata = NULL,
  method = c("Ge", "Ye"),
  type = c("HC0", "model-based", "HC3", "HC", "HC1", "HC2", "HC4", "HC4m", "HC5"),
  mod = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="estimate_varcov_+3A_object">object</code></td>
<td>
<p>a fitted <code><a href="stats.html#topic+glm">glm</a></code> object augmented with
<code>counterfactual.predictions</code>, <code>counterfactual.predictions</code> and <code>counterfactual.means</code></p>
</td></tr>
<tr><td><code id="estimate_varcov_+3A_strata">strata</code></td>
<td>
<p>an optional string or vector of strings specifying the names
of stratification variables. Relevant only for Ye's method and used to
adjust the variance-covariance estimation for stratification.
If provided, each specified variable must be present in the model.</p>
</td></tr>
<tr><td><code id="estimate_varcov_+3A_method">method</code></td>
<td>
<p>a string indicating the chosen method for variance estimation.
Supported methods are <code>Ge</code> and <code>Ye</code>. The default method is <code>Ge</code> based on Ge
et al (2011) which is suitable for the variance estimation of conditional
average treatment effect. The method <code>Ye</code> is based on Ye et al (2023) and is
suitable for the variance estimation of population average treatment effect.
For more details, see <a href="https://osf.io/9mp58/">Magirr et al. (2024)</a>.</p>
</td></tr>
<tr><td><code id="estimate_varcov_+3A_type">type</code></td>
<td>
<p>a string indicating the type of
variance estimator to use (only applicable for Ge's method). Supported types include HC0 (default),
model-based, HC3, HC, HC1, HC2, HC4, HC4m, and HC5. See <a href="sandwich.html#topic+vcovHC">vcovHC</a> for heteroscedasticity-consistent estimators.
This parameter allows for flexibility in handling heteroscedasticity
and model specification errors.</p>
</td></tr>
<tr><td><code id="estimate_varcov_+3A_mod">mod</code></td>
<td>
<p>For Ye's method, the implementation of open-source RobinCar package
has an additional variance decomposition step when estimating the robust variance,
which then utilizes different counterfactual outcomes than the original reference.
Set <code>mod = TRUE</code> to use exactly the implementation method described in
Ye et al (2022), default to <code>FALSE</code> to use the modified implementation in
RobinCar and Bannick et al (2023) which improves stability.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>estimate_varcov</code> function facilitates robust variance estimation
techniques for GLM models, particularly useful in clinical trial analysis
and other fields requiring robust statistical inference. It allows
researchers to account for complex study designs,
including stratification and different treatment contrasts,
by providing a flexible interface for variance-covariance estimation.
</p>
<p>Note: Ensure that the <code>glm</code> object has been adequately prepared with
<code><a href="#topic+predict_counterfactuals">predict_counterfactuals</a></code> and <code><a href="#topic+average_predictions">average_predictions</a></code>
before applying <code>estimate_varcov()</code>. Failure to do so may result in
errors indicating missing components.
</p>


<h3>Value</h3>

<p>an updated <code>glm</code> object appended with an
additional component <code>robust_varcov</code>, which is the estimated variance-covariance matrix
of the marginal effect. The matrix format and estimation method are
indicated in the matrix attributes.
</p>


<h3>References</h3>

<p>Ye T. et al. (2023) Robust variance
estimation for covariate-adjusted unconditional treatment effect in randomized
clinical trials with binary outcomes. Statistical Theory and Related Fields
</p>
<p>Ge M. et al. (2011) Covariate-Adjusted
Difference in Proportions from Clinical Trials Using Logistic Regression
and Weighted Risk Differences. Drug Information Journal.
</p>
<p>Bannick, M. S., et al. A General Form of Covariate Adjustment in
Randomized Clinical Trials. arXiv preprint arXiv:2306.10213 (2023).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+average_predictions">average_predictions()</a></code> for averaging counterfactual
predictions.
</p>
<p><code><a href="#topic+apply_contrast">apply_contrast()</a></code> for computing a summary measure.
</p>
<p><code><a href="#topic+get_marginal_effect">get_marginal_effect()</a></code> for estimating marginal effects directly
from an original <code><a href="stats.html#topic+glm">glm</a></code> object
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Example usage with a binary outcome GLM model
trial01$trtp &lt;- factor(trial01$trtp)
fit1 &lt;- glm(aval ~ trtp + bl_cov, family = "binomial", data = trial01)

#' # Preprocess fit1 as required by estimate_varcov
fit2 &lt;- fit1 |&gt;
  predict_counterfactuals(trt = "trtp") |&gt;
  average_predictions()

# Estimate variance-covariance using Ge's method
fit3_ge &lt;- estimate_varcov(fit2, method = "Ge")
print(fit3_ge$robust_varcov)


# Estimate variance-covariance using Ye's method with stratification
fit4 &lt;- glm(aval ~ trtp + bl_cov_c, family = "binomial", data = trial01) |&gt;
  predict_counterfactuals(trt = "trtp") |&gt;
  average_predictions()
fit4_ye &lt;- estimate_varcov(fit4, method = "Ye", strata = "bl_cov_c")
print(fit4_ye$robust_varcov)

</code></pre>

<hr>
<h2 id='ge_macro_trial01'>Output from the Ge et al (2011) SAS macro applied to the trial01 dataset</h2><span id='topic+ge_macro_trial01'></span>

<h3>Description</h3>

<p>For purposes of implementation comparisons, these are the result outputs from
the SAS macro provided with the Ge et al (2011) publication
(https://doi.org/10.1177/009286151104500409), applied to the trial01 dataset
included with beeca, adjusting for treatment (trtp) and a single covariate
(bl_cov) and targeting a risk difference contrast.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ge_macro_trial01
</code></pre>


<h3>Format</h3>

<p><code>ge_macro_trial01</code>
A tibble with 1 row and 6 columns:
</p>

<dl>
<dt>diff</dt><dd><p>Marginal risk difference estimate</p>
</dd>
<dt>se</dt><dd><p>Standard error of marginal risk difference estimate</p>
</dd>
<dt>pt</dt><dd><p>Marginal risk in treated</p>
</dd>
<dt>pC</dt><dd><p>Marginal risk in controls</p>
</dd>
<dt>lower</dt><dd><p>Lower bound of 95 percent confidence interval of risk difference estimate</p>
</dd>
<dt>upper</dt><dd><p>Upper bound of 95 percent confidence interval of risk difference estimate</p>
</dd>
</dl>


<hr>
<h2 id='get_marginal_effect'>Estimate marginal treatment effects using a GLM working model</h2><span id='topic+get_marginal_effect'></span>

<h3>Description</h3>

<p>Estimates the marginal treatment effect from a logistic regression working model
using a specified choice of variance estimator and contrast.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_marginal_effect(
  object,
  trt,
  strata = NULL,
  method = "Ge",
  type = "HC0",
  contrast = "diff",
  reference,
  mod = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_marginal_effect_+3A_object">object</code></td>
<td>
<p>a fitted <a href="stats.html#topic+glm">glm</a> object.</p>
</td></tr>
<tr><td><code id="get_marginal_effect_+3A_trt">trt</code></td>
<td>
<p>a string specifying the name of the treatment variable
in the model formula. It must be one of the linear predictor variables used
in fitting the <code>object</code>.</p>
</td></tr>
<tr><td><code id="get_marginal_effect_+3A_strata">strata</code></td>
<td>
<p>an optional string or vector of strings specifying the names
of stratification variables. Relevant only for Ye's method and used to
adjust the variance-covariance estimation for stratification.
If provided, each specified variable must be present in the model.</p>
</td></tr>
<tr><td><code id="get_marginal_effect_+3A_method">method</code></td>
<td>
<p>a string indicating the chosen method for variance estimation.
Supported methods are <code>Ge</code> and <code>Ye</code>. The default method is <code>Ge</code> based on Ge
et al (2011) which is suitable for the variance estimation of conditional
average treatment effect. The method <code>Ye</code> is based on Ye et al (2023) and is
suitable for the variance estimation of population average treatment effect.
For more details, see <a href="https://osf.io/9mp58/">Magirr et al. (2024)</a>.</p>
</td></tr>
<tr><td><code id="get_marginal_effect_+3A_type">type</code></td>
<td>
<p>a string indicating the type of
variance estimator to use (only applicable for Ge's method). Supported types include HC0 (default),
model-based, HC3, HC, HC1, HC2, HC4, HC4m, and HC5. See <a href="sandwich.html#topic+vcovHC">vcovHC</a> for heteroscedasticity-consistent estimators.</p>
</td></tr>
<tr><td><code id="get_marginal_effect_+3A_contrast">contrast</code></td>
<td>
<p>a string indicating choice of contrast. Defaults to 'diff' for a risk difference. See <a href="#topic+apply_contrast">apply_contrast</a>.</p>
</td></tr>
<tr><td><code id="get_marginal_effect_+3A_reference">reference</code></td>
<td>
<p>a string or list of strings indicating which treatment
group(s) to use as reference level for pairwise comparisons. Accepted values
must be a subset of the levels in the treatment variable. Default to the
first n-1 treatment levels used in the <code>glm</code> object. This parameter influences
the calculation of treatment effects relative to the chosen reference group.</p>
</td></tr>
<tr><td><code id="get_marginal_effect_+3A_mod">mod</code></td>
<td>
<p>for Ye's method, the implementation of open-source RobinCar package
has an additional variance decomposition step when estimating the robust variance,
which then utilizes different counterfactual outcomes than the original reference.
Set <code>mod = TRUE</code> to use exactly the implementation method described in
Ye et al (2022), default to <code>FALSE</code> to use the modified implementation in
RobinCar and Bannick et al (2023) which improves stability.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>get_marginal_effect</code> function is a wrapper that facilitates
advanced variance estimation techniques for GLM models with covariate adjustment
targeting a population average treatment effect. It is particularly useful in clinical trial analysis
and other fields requiring robust statistical inference.
It allows researchers to account for complex study designs,
including stratification and treatment contrasts, by providing a flexible
interface for variance-covariance estimation.
</p>


<h3>Value</h3>

<p>an updated <code>glm</code> object appended with marginal estimate components:
counterfactual.predictions (see <a href="#topic+predict_counterfactuals">predict_counterfactuals</a>),
counterfactual.means (see <a href="#topic+average_predictions">average_predictions</a>),
robust_varcov (see <a href="#topic+estimate_varcov">estimate_varcov</a>),
marginal_est, marginal_se (see <a href="#topic+apply_contrast">apply_contrast</a>) and marginal_results. A summary is shown below
</p>

<table>
<tr>
 <td style="text-align: left;">
counterfactual.predictions </td><td style="text-align: left;"> Counterfactual predictions based on the working model. For each subject in the input glm data, the potential outcomes are obtained by assigning subjects to each of the possible treatment variable levels. Each prediction is associated with a descriptive label explaining the counterfactual scenario. </td>
</tr>
<tr>
 <td style="text-align: left;">
counterfactual.means       </td><td style="text-align: left;"> Average of the counterfactual predictions for each level of the treatment variable. </td>
</tr>
<tr>
 <td style="text-align: left;">
robust_varcov              </td><td style="text-align: left;"> Variance-covariance matrix of the marginal effect estimate for each level of treatment variable, with estimation method indicated in the attributes.</td>
</tr>
<tr>
 <td style="text-align: left;">
marginal_est               </td><td style="text-align: left;"> Marginal treatment effect estimate for a given contrast.</td>
</tr>
<tr>
 <td style="text-align: left;">
marginal_se                </td><td style="text-align: left;"> Standard error estimate of the marginal treatment effect estimate. </td>
</tr>
<tr>
 <td style="text-align: left;">
marginal_results           </td><td style="text-align: left;"> Analysis results data (ARD) containing a summary of the analysis for subsequent reporting. </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Examples</h3>

<pre><code class='language-R'>trial01$trtp &lt;- factor(trial01$trtp)
fit1 &lt;- glm(aval ~ trtp + bl_cov, family = "binomial", data = trial01) |&gt;
  get_marginal_effect(trt = "trtp", method = "Ye", contrast = "diff", reference = "0")
fit1$marginal_results
</code></pre>

<hr>
<h2 id='margins_trial01'>Output from the Margins SAS macro applied to the trial01 dataset</h2><span id='topic+margins_trial01'></span>

<h3>Description</h3>

<p>For purposes of implementation comparisons, these are the result outputs from
the SAS Margins macro (https://support.sas.com/kb/63/038.html), applied to the
trial01 dataset included with beeca, adjusting for treatment (trtp) and a
single covariate (bl_cov) and targeting a risk difference contrast.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>margins_trial01
</code></pre>


<h3>Format</h3>

<p><code>margins_trial01</code>
A tibble with 1 row and 11 columns:
</p>

<dl>
<dt>Estimate</dt><dd><p>Marginal risk difference estimate</p>
</dd>
<dt>ChiSq</dt><dd><p>Wald Chi-Square statistic</p>
</dd>
<dt>Row</dt><dd><p>Row number</p>
</dd>
<dt>StdErr</dt><dd><p>Standard error of marginal risk difference estimate</p>
</dd>
<dt>Lower</dt><dd><p>Lower bound of 95 percent confidence interval of estimate</p>
</dd>
<dt>Upper</dt><dd><p>Upper bound of 95 percent confidence interval of estimate</p>
</dd>
<dt>Contrast</dt><dd><p>Descriptive label for contrast</p>
</dd>
<dt>df</dt><dd><p>Degrees of freedom</p>
</dd>
<dt>Pr</dt><dd><p>p-value</p>
</dd>
<dt>Alpha</dt><dd><p>Significance level alpha</p>
</dd>
<dt>label</dt><dd><p>Label for contrast</p>
</dd>
</dl>


<hr>
<h2 id='predict_counterfactuals'>Predict counterfactual outcomes in GLM models</h2><span id='topic+predict_counterfactuals'></span>

<h3>Description</h3>

<p>This function calculates counterfactual predictions for each level of a
specified treatment variable in a generalized linear model (GLM).
It is designed to aid in the assessment of treatment effects by predicting
outcomes under different treatments under causal inference framework.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predict_counterfactuals(object, trt)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict_counterfactuals_+3A_object">object</code></td>
<td>
<p>a fitted <code><a href="stats.html#topic+glm">glm</a></code> object for which
counterfactual predictions are desired.</p>
</td></tr>
<tr><td><code id="predict_counterfactuals_+3A_trt">trt</code></td>
<td>
<p>a string specifying the name of the treatment variable
in the model formula. It must be one of the linear predictor variables used
in fitting the <code>object</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function works by creating new datasets from the original data used
to fit the GLM model. In these datasets, the treatment variable for all
records (e.g., patients) is set to each possible treatment level.
</p>
<p>Predictions are then made for each dataset based on the fitted GLM model,
simulating the response variable under each treatment condition.
</p>
<p>The results are stored in a tidy format and appended to the original model
object for further analysis or inspection.
</p>
<p>For averaging counterfactual outcomes, apply <code>average_predictions()</code>.
</p>


<h3>Value</h3>

<p>an updated <code>glm</code> object appended with an
additional component <code>counterfactual.predictions</code>.
</p>
<p>This component contains a tibble with columns representing counterfactual
predictions for each level of the treatment variable. A descriptive <code>label</code>
attribute explains the counterfactual scenario associated with each column.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+average_predictions">average_predictions()</a></code> for averaging counterfactual
predictions.
</p>
<p><code><a href="#topic+get_marginal_effect">get_marginal_effect()</a></code> for estimating marginal effects directly
from an original <code><a href="stats.html#topic+glm">glm</a></code> object
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Preparing data and fitting a GLM model
trial01$trtp &lt;- factor(trial01$trtp)
fit1 &lt;- glm(aval ~ trtp + bl_cov, family = "binomial", data = trial01)

# Generating counterfactual predictions
fit2 &lt;- predict_counterfactuals(fit1, "trtp")

# Accessing the counterfactual predictions
fit2$counterfactual.predictions
attributes(fit2$counterfactual.predictions)

</code></pre>

<hr>
<h2 id='sanitize_model'>(internal) Sanitize functions to check model and data within GLM model object</h2><span id='topic+sanitize_model'></span>

<h3>Description</h3>

<p>Performs checks on a GLM model object to ensure it meets specific criteria
required for further analysis using other functions from the <code>beeca</code> package.
</p>
<p>This includes verifying the model's family, link function, data completeness
and mode convergence.
</p>
<p>Currently it supports models with a binomial family and canonical logit link.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sanitize_model(model, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sanitize_model_+3A_model">model</code></td>
<td>
<p>a model object, currently only
<a href="stats.html#topic+glm">glm</a> with binomial family canonical link is supported.</p>
</td></tr>
<tr><td><code id="sanitize_model_+3A_...">...</code></td>
<td>
<p>arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>if model is non-compliant will throw warnings or errors.
</p>

<hr>
<h2 id='sanitize_model.glm'>(internal) Sanitize a glm model</h2><span id='topic+sanitize_model.glm'></span>

<h3>Description</h3>

<p>(internal) Sanitize a glm model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'glm'
sanitize_model(model, trt, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sanitize_model.glm_+3A_model">model</code></td>
<td>
<p>a <a href="stats.html#topic+glm">glm</a> with binomial family canonical link.</p>
</td></tr>
<tr><td><code id="sanitize_model.glm_+3A_trt">trt</code></td>
<td>
<p>the name of the treatment variable on the right-hand side of the formula in a <a href="stats.html#topic+glm">glm</a>.</p>
</td></tr>
<tr><td><code id="sanitize_model.glm_+3A_...">...</code></td>
<td>
<p>ignored.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>if model is non-compliant will throw warnings or errors.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>trial01$trtp &lt;- factor(trial01$trtp)
fit1 &lt;- glm(aval ~ trtp + bl_cov, family = "binomial", data = trial01)
fit1 &lt;- sanitize_model(fit1, "trtp")

</code></pre>

<hr>
<h2 id='sanitize_variable'>(internal) Sanitize function to check model and data</h2><span id='topic+sanitize_variable'></span>

<h3>Description</h3>

<p>(internal) Sanitize function to check model and data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sanitize_variable(model, trt)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sanitize_variable_+3A_model">model</code></td>
<td>
<p>an <a href="stats.html#topic+glm">glm</a> model object.</p>
</td></tr>
<tr><td><code id="sanitize_variable_+3A_trt">trt</code></td>
<td>
<p>the name of the treatment variable on the right-hand side of the glm formula.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>if model and variable are non-compliant, will throw warnings or error.
</p>

<hr>
<h2 id='trial01'>Example trial dataset 01</h2><span id='topic+trial01'></span>

<h3>Description</h3>

<p>A simplified example of a simulated trial dataset, with missing data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trial01
</code></pre>


<h3>Format</h3>

<p><code>trial01</code>
A data frame with 268 rows and 9 columns:
</p>

<dl>
<dt>usubjid</dt><dd><p>Unique subject identifier</p>
</dd>
<dt>aval</dt><dd><p>Primary outcome variable (1 = yes/0 = no)</p>
</dd>
<dt>trtp</dt><dd><p>Planned treatment</p>
</dd>
<dt>bl_cov</dt><dd><p>Baseline covariate (numeric)</p>
</dd>
<dt>bl_cov_c</dt><dd><p>Dichotomized version of bl_cov (category of 1 or 0)</p>
</dd>
<dt>region_2, ..., region_5</dt><dd><p>Indicators for region (1 = yes/0 = no)</p>
</dd>
</dl>


<hr>
<h2 id='trial02_cdisc'>Example CDISC Clinical Trial Dataset in ADaM Format</h2><span id='topic+trial02_cdisc'></span>

<h3>Description</h3>

<p>This dataset is a simplified, binary outcome version of a sample Phase 2 clinical trial dataset
formatted according to the Analysis Data Model (ADaM) standards set by the Clinical Data
Interchange Standards Consortium (CDISC). It is designed for training and educational purposes,
showcasing how clinical trial data can be structured for statistical analysis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trial02_cdisc
</code></pre>


<h3>Format</h3>

<p>A data frame with 254 rows and 13 columns, representing trial participants and key variables:
</p>

<dl>
<dt>USUBJID</dt><dd><p>Unique subject identifier (alphanumeric code). A code unique to the clinical trial</p>
</dd>
<dt>PARAM</dt><dd><p>Parameter name indicating the specific measurement or outcome assessed.</p>
</dd>
<dt>AGE</dt><dd><p>Age of the participant at study enrollment, in years.</p>
</dd>
<dt>AGEGR1</dt><dd><p>Categorical representation of age groups.</p>
</dd>
<dt>AGEGR1N</dt><dd><p>Numeric code representing age groups, used for statistical modeling.</p>
</dd>
<dt>RACE</dt><dd><p>Self-identified race of the participant</p>
</dd>
<dt>RACEN</dt><dd><p>Numeric representation of race categories, used for statistical modeling.</p>
</dd>
<dt>SEX</dt><dd><p>Participant's sex at birth.</p>
</dd>
<dt>TRTP</dt><dd><p>Planned treatment assignment, indicating the specific intervention or control condition.</p>
</dd>
<dt>TRTPN</dt><dd><p>Numeric code for the planned treatment, simplifying data analysis procedures.</p>
</dd>
<dt>AVAL</dt><dd><p>Analysis value, representing the primary outcome measure for each participant.</p>
</dd>
<dt>AVALC</dt><dd><p>Character representation of the analysis value, used in descriptive summaries.</p>
</dd>
<dt>FASFL</dt><dd><p>Full analysis set flag, indicating if the participant's data is included in the full analysis set.</p>
</dd>
</dl>



<h3>Details</h3>

<p>This dataset serves as an illustrative example for those learning about the
ADaM standard in clinical trials. It includes common variables like
demographic information, treatment assignments, and outcome measures.
</p>
<p>Data privacy and ethical considerations have been addressed through the
anonymization of subject identifiers and other sensitive information.
The dataset is intended for educational and training purposes only.
</p>


<h3>Note</h3>

<p>The numeric codes for categorical variables such as <code>RACEN</code> and <code>TRTPN</code>
are arbitrary and should be interpreted within the context of this dataset.
For example, refer to the categorical representations for additional context.
</p>


<h3>Source</h3>

<p>This dataset has been reformatted for educational use from the
<code>safetyData</code> package, specifically <code>adam_adtte</code>. For the original data and
more detailed information, please refer to the
<a href="https://safetygraphics.github.io/safetyData/"><code>safetyData</code></a> documentation.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
