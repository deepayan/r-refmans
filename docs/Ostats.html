<!DOCTYPE html><html><head><title>Help for package Ostats</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {Ostats}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#ant_data'><p>Sample Circular Data</p></a></li>
<li><a href='#community_overlap'><p>Community Overlap Calculation</p></a></li>
<li><a href='#Ostats'><p>Calculate O-statistics (community-level pairwise niche overlap statistics)</p></a></li>
<li><a href='#Ostats_multivariate'><p>Calculate multivariate O-statistics</p></a></li>
<li><a href='#Ostats_multivariate_plot'><p>Plot multivariate community overlap</p></a></li>
<li><a href='#Ostats_plot'><p>Plot community trait overlap</p></a></li>
<li><a href='#pitcher_traits'><p>Sample Multivariate Trait Data (Pitcher Plants)</p></a></li>
<li><a href='#reg_pool'><p>Sample Data for Ostats_regional</p></a></li>
<li><a href='#small_mammal_data'><p>Sample Continuous Trait Data (NEON Small Mammals 2015)</p></a></li>
<li><a href='#small_mammal_Ostats'><p>Pre-calculated Overlap Statistics for NEON Small Mammals 2015</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>O-Stats, or Pairwise Community-Level Niche Overlap Statistics</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.0</td>
</tr>
<tr>
<td>Description:</td>
<td>O-statistics, or overlap statistics, measure the degree of community-level trait overlap. 
    They are estimated by fitting nonparametric kernel density functions to each species’ trait 
    distribution and calculating their areas of overlap. For instance, the median pairwise overlap 
    for a community is calculated by first determining the overlap of each species pair 
    in trait space, and then taking the median overlap of each species pair in a community. 
    This median overlap value is called the O-statistic (O for overlap).
    The Ostats() function calculates separate univariate overlap statistics for each trait, 
    while the Ostats_multivariate() function calculates a single multivariate overlap statistic for all traits. 
    O-statistics can be evaluated against null models to obtain standardized effect sizes. 
    'Ostats' is part of the collaborative Macrosystems Biodiversity Project "Local- to continental-scale 
    drivers of biodiversity across the National Ecological Observatory Network (NEON)." 
    For more information on this project, see the Macrosystems Biodiversity Website 
    (<a href="https://neon-biodiversity.github.io/">https://neon-biodiversity.github.io/</a>). Calculation of O-statistics is described in
    Read et al. (2018) &lt;<a href="https://doi.org/10.1111%2Fecog.03641">doi:10.1111/ecog.03641</a>&gt;, and a teaching module for introducing the
    underlying biological concepts at an undergraduate level is described in Grady et al.
    (2018) <a href="http://tiee.esa.org/vol/v14/issues/figure_sets/grady/abstract.html">http://tiee.esa.org/vol/v14/issues/figure_sets/grady/abstract.html</a>.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://neon-biodiversity.github.io/Ostats/">https://neon-biodiversity.github.io/Ostats/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/NEON-biodiversity/Ostats/issues">https://github.com/NEON-biodiversity/Ostats/issues</a></td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>sfsmisc, matrixStats, circular, hypervolume, ggplot2,
gridExtra, viridis, grid, MASS</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.2</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 2.1.0), knitr, rmarkdown</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-09-12 15:27:31 UTC; qdread</td>
</tr>
<tr>
<td>Author:</td>
<td>Quentin D. Read [aut, cre],
  Arya Yue [aut],
  Isadora E. Fluck [aut],
  Benjamin Baiser [aut],
  John M. Grady [aut],
  Phoebe L. Zarnetske [aut],
  Sydne Record [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Quentin D. Read &lt;quentin.read@usda.gov&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-09-12 16:20:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='ant_data'>Sample Circular Data</h2><span id='topic+ant_data'></span>

<h3>Description</h3>

<p>This is a sample dataset with discrete hourly data collection from a study
in which ants were observed during 24-hour periods in multiple experimental
chambers. Each row represents an observation of an individual ant, with its
species identity and the time it was observed, rounded to the nearest hour.
The experimental setup is described in Stuble et al. 2014.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ant_data
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 4837 rows and 3 columns.
</p>


<h3>References</h3>

<p>Stuble, K.L., Patterson, C.M., Rodriguez-Cabal, M.A., Ribbons,
R.R., Dunn, R.R. &amp; Sanders, N.J. (2014). Ant-mediated seed dispersal in a
warmed world. PeerJ, 2, e286. https://peerj.com/articles/286/
</p>

<hr>
<h2 id='community_overlap'>Community Overlap Calculation</h2><span id='topic+community_overlap'></span>

<h3>Description</h3>

<p>This function calculates the median or mean of pairwise overlaps between density
estimates of trait distributions of all species within a community, which can
be weighted by species abundances.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>community_overlap(
  traits,
  sp,
  discrete = FALSE,
  circular = FALSE,
  normal = TRUE,
  output = "median",
  weight_type = "hmean",
  randomize_weights = FALSE,
  unique_values = NULL,
  raw = FALSE,
  circular_args = list(),
  density_args = list(),
  hypervolume_set_args = list()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="community_overlap_+3A_traits">traits</code></td>
<td>
<p>a vector of trait measurements in the univariate case, or a
matrix in the multivariate case where each column is a trait.</p>
</td></tr>
<tr><td><code id="community_overlap_+3A_sp">sp</code></td>
<td>
<p>a vector with length equal to length(traits) that indicates the
taxon of each individual.</p>
</td></tr>
<tr><td><code id="community_overlap_+3A_discrete">discrete</code></td>
<td>
<p>whether trait data may take continuous or discrete values. Defaults to
<code>FALSE</code> (all traits continuous). A single logical value or a logical
vector with length equal to the number of columns in traits.</p>
</td></tr>
<tr><td><code id="community_overlap_+3A_circular">circular</code></td>
<td>
<p>whether trait data are circular (e.g., hours or angles). Defaults to
<code>FALSE</code> (all traits non-circular). A single logical value or a logical
vector with length equal to the number of columns in traits.</p>
</td></tr>
<tr><td><code id="community_overlap_+3A_normal">normal</code></td>
<td>
<p>if TRUE, the area under all density functions is normalized to 1,
if FALSE, the area under all density functions is proportional to the number of
observations in that group.</p>
</td></tr>
<tr><td><code id="community_overlap_+3A_output">output</code></td>
<td>
<p>specifies whether median or mean is calculated.</p>
</td></tr>
<tr><td><code id="community_overlap_+3A_weight_type">weight_type</code></td>
<td>
<p>specifies weights to be used to calculate the median or mean.</p>
</td></tr>
<tr><td><code id="community_overlap_+3A_randomize_weights">randomize_weights</code></td>
<td>
<p>If TRUE, randomize weights given to pairwise overlaps
within a community. This can be used to generate null models.</p>
</td></tr>
<tr><td><code id="community_overlap_+3A_unique_values">unique_values</code></td>
<td>
<p>Vector of all possible discrete values that <code>traits</code>
can take. Only used if <code>discrete = TRUE</code> and <code>circular = TRUE</code>.</p>
</td></tr>
<tr><td><code id="community_overlap_+3A_raw">raw</code></td>
<td>
<p>If <code>TRUE</code>, also return the raw individual pairwise overlaps
used to calculate the community-level statistic. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="community_overlap_+3A_circular_args">circular_args</code></td>
<td>
<p>optional list of additional arguments to pass to
<code><a href="circular.html#topic+circular">circular</a></code>. Only used if <code>circular = TRUE</code> and
<code>discrete = FALSE</code>.</p>
</td></tr>
<tr><td><code id="community_overlap_+3A_density_args">density_args</code></td>
<td>
<p>list of additional arguments to be passed to
<code><a href="stats.html#topic+density">density</a></code> if univariate, or
<code><a href="hypervolume.html#topic+hypervolume">hypervolume</a></code> if multivariate.</p>
</td></tr>
<tr><td><code id="community_overlap_+3A_hypervolume_set_args">hypervolume_set_args</code></td>
<td>
<p>list of additional arguments to be passed to
<code><a href="hypervolume.html#topic+hypervolume_set">hypervolume_set</a></code>. Used only in multivariate case.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function evaluates weighted mean or median of overlaps of density
estimates of all species in a community taking complete cases with species abundances
greater than 1 from the dataset. The default calculates the median of pairwise overlaps
for the whole community using the harmonic means of abundances of the species pairs as
weights, which minimizes the effect of outliners and rare species.If the argument
<code>weight_type = "none"</code>, no weights are used for the calculation of mean/median. If
<code>weight_type = "mean"</code>, arithmetic means of abundances are used as weights. To change the
output to mean, specify the argument <code>output = "mean"</code>.
</p>


<h3>Value</h3>

<p>The function returns the O-statistic for the community as a numeric value. If
<code>raw = TRUE</code>, instead a list is returned, where the first element <code>value</code> is
the numeric value, and the second element <code>raw</code> is a data frame with all the raw
pairwise overlaps.
</p>


<h3>References</h3>

<p>Read, Q. D. et al. Among-species overlap in rodent body size
distributions predicts species richness along a temperature gradient.
Ecography 41, 1718-1727 (2018).
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Keep only the relevant part of small mammal data
dat &lt;- small_mammal_data[small_mammal_data$siteID %in% c('HARV','JORN'), ]
dat &lt;- dat[!is.na(dat$weight), ]
dat$log_weight &lt;- log10(dat$weight)

# Calculate median of pairwise overlaps for the community,weighted by harmonic means
# of abundances
community_overlap(traits = as.matrix(dat$log_weight),
   sp = factor(dat$taxonID))

</code></pre>

<hr>
<h2 id='Ostats'>Calculate O-statistics (community-level pairwise niche overlap statistics)</h2><span id='topic+Ostats'></span>

<h3>Description</h3>

<p>This is the primary function in the Ostats package. It calculates O-statistics
by finding the trait density overlap among all pairs of species in each
community and taking the mean or median. Next it optionally evaluates the
O-statistics against a local null model. This is done separately for each trait.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Ostats(
  traits,
  plots,
  sp,
  discrete = FALSE,
  circular = FALSE,
  output = "median",
  weight_type = "hmean",
  run_null_model = TRUE,
  nperm = 99,
  nullqs = c(0.025, 0.975),
  shuffle_weights = FALSE,
  swap_means = FALSE,
  random_seed = NULL,
  unique_values = NULL,
  circular_args = list(),
  density_args = list(),
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Ostats_+3A_traits">traits</code></td>
<td>
<p>a numeric vector or matrix of trait measurements. The number of elements
in the vector or number of rows in the matrix is the number of individuals,
and the number of columns of the matrix is the number of traits.</p>
</td></tr>
<tr><td><code id="Ostats_+3A_plots">plots</code></td>
<td>
<p>a factor with length equal to <code>nrow(traits)</code> that indicates the
community each individual belongs to.</p>
</td></tr>
<tr><td><code id="Ostats_+3A_sp">sp</code></td>
<td>
<p>a factor with length equal to <code>nrow(traits)</code> that indicates the taxon
of each individual.</p>
</td></tr>
<tr><td><code id="Ostats_+3A_discrete">discrete</code></td>
<td>
<p>whether trait data may take continuous or discrete values. Defaults to
<code>FALSE</code> (all traits continuous). A single logical value or a logical
vector with length equal to the number of columns in traits. See details below.</p>
</td></tr>
<tr><td><code id="Ostats_+3A_circular">circular</code></td>
<td>
<p>whether trait data are circular (e.g., hours or angles). Defaults to
<code>FALSE</code> (all traits non-circular). A single logical value or a logical
vector with length equal to the number of columns in traits. See details below.</p>
</td></tr>
<tr><td><code id="Ostats_+3A_output">output</code></td>
<td>
<p>specifies whether median or mean is calculated. Default <code>"median"</code>.</p>
</td></tr>
<tr><td><code id="Ostats_+3A_weight_type">weight_type</code></td>
<td>
<p>specifies weights to be used to calculate the median or mean.
Default <code>"hmean"</code> (harmonic mean), meaning each pair of species is weighted
by the harmonic mean of abundances.</p>
</td></tr>
<tr><td><code id="Ostats_+3A_run_null_model">run_null_model</code></td>
<td>
<p>whether to run a null model (if <code>TRUE</code>) and evaluate the
O-statistics against it, or simply return the raw O-statistics (if <code>FALSE</code>).
Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="Ostats_+3A_nperm">nperm</code></td>
<td>
<p>the number of null model permutations to generate. Defaults to 99.</p>
</td></tr>
<tr><td><code id="Ostats_+3A_nullqs">nullqs</code></td>
<td>
<p>numeric vector of probabilities with values in [0,1] to set
effect size quantiles. Defaults to <code>c(0.025, 0.975)</code>.</p>
</td></tr>
<tr><td><code id="Ostats_+3A_shuffle_weights">shuffle_weights</code></td>
<td>
<p>If <code>TRUE</code>, shuffle weights given to pairwise overlaps
within a community when generating null models.</p>
</td></tr>
<tr><td><code id="Ostats_+3A_swap_means">swap_means</code></td>
<td>
<p>If <code>TRUE</code>, swap means of body sizes within a community when
generating null models.</p>
</td></tr>
<tr><td><code id="Ostats_+3A_random_seed">random_seed</code></td>
<td>
<p>User may supply a random seed to enable reproducibility
of null model output. A warning is issued, and a random seed is generated
based on the local time, if the user does not supply a seed.</p>
</td></tr>
<tr><td><code id="Ostats_+3A_unique_values">unique_values</code></td>
<td>
<p>Vector of all possible discrete values that <code>traits</code>
can take. Only used if <code>discrete = TRUE</code> and <code>circular = TRUE</code>.</p>
</td></tr>
<tr><td><code id="Ostats_+3A_circular_args">circular_args</code></td>
<td>
<p>optional list of additional arguments to pass to
<code><a href="circular.html#topic+circular">circular</a></code>. Only used if <code>circular = TRUE</code> and
<code>discrete = FALSE</code>.
Note that continuous circular data must be provided in radian units.</p>
</td></tr>
<tr><td><code id="Ostats_+3A_density_args">density_args</code></td>
<td>
<p>additional arguments to pass to <code><a href="stats.html#topic+density">density</a></code>, such as
<code>bw</code>, <code>n</code>, or <code>adjust</code>. If none are provided, default values
are used.</p>
</td></tr>
<tr><td><code id="Ostats_+3A_verbose">verbose</code></td>
<td>
<p>If <code>TRUE</code>, progress messages are displayed. Defaults to <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function calculates overlap statistics and optionally evaluates them
against a local null model. By default, it calculates the median of pairwise
overlaps, weighted by harmonic mean of species abundaces of the species
pairs in each community. Two results are produced, one normalizing the area
under all density functions to 1, the other making the area under all density
functions proportional to the number of observations in that group.
</p>
<p>If <code>discrete = FALSE</code>, continuous kernel density functions are estimated for
each species at each community, if <code>TRUE</code>, discrete functions (histograms) are
estimated.
</p>
<p>If <code>circular = TRUE</code> and <code>discrete = FALSE</code>, the function <code><a href="circular.html#topic+circular">circular</a></code>
is used to convert each column of <code>traits</code> to an object of class circular.
Unless additional arguments about input data type are specified, it is
assumed that the circular input data are in radian units (0 to 2*pi).
</p>
<p>If <code>circular = TRUE</code> and <code>discrete = TRUE</code>, data will be interpreted as
discrete values on a circular scale. For example, data might be integer values
representing hours and ranging from 0 to 23.
</p>
<p>If <code>run_null_model</code> is <code>TRUE</code>, the O-statistics are evaluated relative
to a null model. When both <code>shuffle_weights</code> and <code>swap_means</code> are <code>FALSE</code>,
null communities are generated by randomly assigning a taxon that is present in the community to
each individual. If <code>shuffle_weights</code> is <code>TRUE</code>, species abundances
are also randomly assigned to each species to weight the O-statistic for each
null community. If <code>swap_means</code> is <code>TRUE</code>, instead of sampling individuals
randomly, species means are sampled randomly among species, keeping the deviation
of each individual from its species mean the same. After the null communities
are generated, O-stats are calculated for each null community to compare with
the observed O-stat.
</p>
<p>Effect size statistics are calculated by z-transforming the O-statistics
using the mean and standard deviation of the null distribution.
</p>


<h3>Value</h3>

<p>The function returns a list containing four objects:
</p>
<table>
<tr><td><code>overlaps_norm</code></td>
<td>
<p>a matrix showing the O-statistic for each trait and each community,
with the area under all density functions normalized to 1.</p>
</td></tr>
<tr><td><code>overlaps_unnorm</code></td>
<td>
<p>a matrix showing O-stats calculated with the area under all density
functions proportional to the number of observations in that group.</p>
</td></tr>
<tr><td><code>overlaps_norm_ses</code></td>
<td>
<p>List of matrices of effect size statistics against a null model
with the area under all density functions normalized to 1. <code>ses</code> contains the
effect sizes (z-scores), <code>ses_lower</code> contains the effect size lower critical values
for significance at the level determined by <code>nullqs</code>, and <code>ses_upper</code>
contains the upper critical values. <code>raw_lower</code> and <code>raw_upper</code> are
the critical values in raw units ranging from 0 to 1.</p>
</td></tr>
<tr><td><code>overlaps_unnorm_ses</code></td>
<td>
<p>List of matrices of effect size statistics against a null model
with the area under all density functions proportional to the number
of observations in that group. Elements are as in <code>overlaps_norm_ses</code>.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Quentin D. Read, John M. Grady, Arya Y. Yue, Isadora Fluck E., Ben Baiser,
Angela Strecker, Phoebe L. Zarnetske, and Sydne Record
</p>


<h3>References</h3>

<p>Read, Q. D. et al. Among-species overlap in rodent body size
distributions predicts species richness along a temperature gradient.
Ecography 41, 1718-1727 (2018).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Ostats_multivariate">Ostats_multivariate</a></code> for multidimensional overlap.
</p>
<p><code><a href="#topic+Ostats_plot">Ostats_plot</a></code> for plotting community overlap for
each community.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># overlap statistics for body weights of small mammals in NEON sites

# Keep only the relevant part of data
dat &lt;- small_mammal_data[small_mammal_data$siteID %in% c('HARV','JORN'), ]
dat &lt;- dat[!is.na(dat$weight), ]
dat$log_weight &lt;- log10(dat$weight)


#Run O-stats on the data with only a few null model iterations
Ostats_example &lt;- Ostats(traits = as.matrix(dat[,'log_weight']),
                   sp = factor(dat$taxonID),
                   plots = factor(dat$siteID),
                   nperm = 10)
</code></pre>

<hr>
<h2 id='Ostats_multivariate'>Calculate multivariate O-statistics</h2><span id='topic+Ostats_multivariate'></span>

<h3>Description</h3>

<p>This function calculates a single O-statistic across multiple traits
by estimating hypervolumes for each species in multivariate trait space that
contain the trait values for all the individuals in each species. It uses a
stochastic estimation procedure implemented in the R package hypervolume. The
community-level O-statistics estimated from the hypervolume overlaps can be
evaluated against a null model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Ostats_multivariate(
  traits,
  plots,
  sp,
  output = "median",
  weight_type = "hmean",
  run_null_model = TRUE,
  nperm = 99,
  nullqs = c(0.025, 0.975),
  shuffle_weights = FALSE,
  swap_means = FALSE,
  random_seed = NULL,
  hypervolume_args = list(),
  hypervolume_set_args = list(),
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Ostats_multivariate_+3A_traits">traits</code></td>
<td>
<p>matrix of trait measurements. The number of rows in the matrix
is the number of individuals,
and the number of columns of the matrix is the number of traits.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_+3A_plots">plots</code></td>
<td>
<p>a factor with length equal to nrow(traits) that indicates the
community each individual belongs to.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_+3A_sp">sp</code></td>
<td>
<p>a factor with length equal to nrow(traits) that indicates the taxon
of each individual.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_+3A_output">output</code></td>
<td>
<p>specifies whether median or mean is calculated.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_+3A_weight_type">weight_type</code></td>
<td>
<p>specifies weights to be used to calculate the median or mean.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_+3A_run_null_model">run_null_model</code></td>
<td>
<p>whether to run a null model (if <code>TRUE</code>) and evaluate the
O-statistics against it, or simply return the raw O-statistics (if <code>FALSE</code>).
Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_+3A_nperm">nperm</code></td>
<td>
<p>the number of null model permutations to generate. Defaults to 99.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_+3A_nullqs">nullqs</code></td>
<td>
<p>numeric vector of probabilities with values in [0,1] to set
effect size quantiles. Defaults to <code>c(0.025, 0.975)</code>.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_+3A_shuffle_weights">shuffle_weights</code></td>
<td>
<p>If TRUE, shuffle weights given to pairwise overlaps
within a community when generating null models.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_+3A_swap_means">swap_means</code></td>
<td>
<p>If TRUE, swap means of body sizes within a community when
generating null models.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_+3A_random_seed">random_seed</code></td>
<td>
<p>User may supply a random seed to enable reproducibility
of null model output. A warning is issued, and a random seed is generated
based on the local time, if the user does not supply a seed.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_+3A_hypervolume_args">hypervolume_args</code></td>
<td>
<p>additional arguments to pass to <code><a href="hypervolume.html#topic+hypervolume">hypervolume</a></code>,
such as <code>method</code>. If none are provided, default values are used.
By default, <code>method = "gaussian"</code>.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_+3A_hypervolume_set_args">hypervolume_set_args</code></td>
<td>
<p>additional arguments to pass to <code><a href="hypervolume.html#topic+hypervolume_set">hypervolume_set</a></code>,
such as <code>num.points.max</code>. If none are provided, default values are used.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_+3A_verbose">verbose</code></td>
<td>
<p>If <code>TRUE</code>, progress messages are displayed. Defaults to <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function calculates multivariate O-statistics and optionally evaluates them
against a local null model. By default, it calculates the median of pairwise
hypervolume overlaps, weighted by harmonic mean of species abundaces of the species
pairs in each community. Two results are produced, one normalizing the area
under all density functions to 1, the other making the area under all density
functions proportional to the number of observations in that group.
</p>
<p>Functions from the R package hypervolume by Blonder and colleagues (Blonder 2018) are
used internally. The function <code><a href="hypervolume.html#topic+hypervolume">hypervolume</a></code> stochastically
estimates hypervolumes for each species in each community, and the function
<code><a href="hypervolume.html#topic+hypervolume_set">hypervolume_set</a></code> finds the proportional overlap
between each pair of hypervolumes.
</p>
<p>If <code>run_null_model</code> is <code>TRUE</code>, the O-statistics are evaluated relative
to a null model. When both <code>shuffle_weights</code> and <code>swap_means</code> are <code>FALSE</code>,
null communities are generated by randomly assigning a taxon that is present in the community to
each individual. If <code>shuffle_weights</code> is <code>TRUE</code>, species abundances
are also randomly assigned to each species to weight the O-statistic for each
null community. If <code>swap_means</code> is <code>TRUE</code>, instead of sampling individuals
randomly, species means are sampled randomly among species, keeping the deviation
of each individual from its species mean the same. After the null communities
are generated, O-stats are calculated for each null community to compare with
the observed O-stat.
</p>
<p>Effect size statistics are calculated by z-transforming the O-statistics
using the mean and standard deviation of the null distribution.
</p>


<h3>Value</h3>

<p>The function returns a list containing four objects:
</p>
<table>
<tr><td><code>overlaps_norm</code></td>
<td>
<p>a matrix showing the O-statistic for each community,
with the area under all density functions normalized to 1.</p>
</td></tr>
<tr><td><code>overlaps_unnorm</code></td>
<td>
<p>a matrix showing O-stats calculated with the area under all density
functions proportional to the number of observations in that group.</p>
</td></tr>
<tr><td><code>overlaps_norm_ses</code></td>
<td>
<p>List of matrices of effect size statistics against a null model
with the area under all density functions normalized to 1. <code>ses</code> contains the
effect sizes (z-scores), <code>ses_lower</code> contains the effect size lower critical values
for significance at the level determined by <code>nullqs</code>, and <code>ses_upper</code>
contains the upper critical values. <code>raw_lower</code> and <code>raw_upper</code> are
the critical values in raw units ranging from 0 to 1.</p>
</td></tr>
<tr><td><code>overlaps_unnorm_ses</code></td>
<td>
<p>List of matrices of effect size statistics against a null model
with the area under all density functions proportional to the number
of observations in that group. Elements are as in <code>overlaps_norm_ses</code>.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Blonder, B. Hypervolume concepts in niche- and trait-based ecology.
Ecography 41, 1441–1455 (2018). https://doi.org/10.1111/ecog.03187
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Ostats">Ostats</a></code> for univariate data.
</p>
<p><code><a href="#topic+Ostats_multivariate_plot">Ostats_multivariate_plot</a></code> for plotting multivariate trait overlap in
each community.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# overlap statistic between populations of pitcher plants at two different sites

# Select two sites and three dimensions and scale data
site_index &lt;- pitcher_traits[, 'site_id'] %in% c('FLK', 'MYR')
dat &lt;- as.matrix(pitcher_traits[site_index,
                               c('rosette_diameter_1', 'pitcher_width', 'mouth_diameter')])
dat &lt;- scale(dat, center = TRUE, scale = TRUE)

# Here a low number is used for num.points.max for example purposes
Ostats_multi_example &lt;- Ostats_multivariate(traits = dat,
                                            plots = factor(rep(1, nrow(dat))),
                                            sp = factor(pitcher_traits$site_id[site_index]),
                                            random_seed = 111,
                                            run_null_model = FALSE,
                                            hypervolume_args = list(method = 'box'),
                                            hypervolume_set_args = list(num.points.max = 100)
)

## End(Not run)

</code></pre>

<hr>
<h2 id='Ostats_multivariate_plot'>Plot multivariate community overlap</h2><span id='topic+Ostats_multivariate_plot'></span>

<h3>Description</h3>

<p>This function plots the overlap of traits among
species for each community in multivariate space, showing
projections of trait hypervolumes into two-dimensional space for
all pairs of traits.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Ostats_multivariate_plot(
  plots,
  sp,
  traits,
  overlap_dat = NULL,
  use_plots = NULL,
  colorvalues = NULL,
  plot_points = TRUE,
  contour_level,
  axis_expansion = 0.01,
  contour_buffer_factor = 0.25,
  panel_height = 3,
  panel_width = 3,
  units = "cm",
  hypervolume_args = list()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Ostats_multivariate_plot_+3A_plots">plots</code></td>
<td>
<p>Site identity: a vector of names of each community.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_plot_+3A_sp">sp</code></td>
<td>
<p>Taxon identity: a vector of species or taxa names.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_plot_+3A_traits">traits</code></td>
<td>
<p>A matrix or data frame with rows representing individuals
and columns representing traits.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_plot_+3A_overlap_dat">overlap_dat</code></td>
<td>
<p>Optional: an object containing the output of
<code><a href="#topic+Ostats_multivariate">Ostats_multivariate</a></code>.
If provided, overlap statistics will be displayed in the plot panels.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_plot_+3A_use_plots">use_plots</code></td>
<td>
<p>a vector of sites to plot. If NULL, the function will plot all the sites.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_plot_+3A_colorvalues">colorvalues</code></td>
<td>
<p>Vector of color values for the density polygons.
Defaults to a viridis palette if none provided.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_plot_+3A_plot_points">plot_points</code></td>
<td>
<p>whether to plot individual data points in addition to
the hypervolume slices. Default is TRUE.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_plot_+3A_contour_level">contour_level</code></td>
<td>
<p>level at which to plot contour lines. If not provided
by the user, a message is issued stating the default plotting level is 0.01.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_plot_+3A_axis_expansion">axis_expansion</code></td>
<td>
<p>multiplicative expansion factor by which to expand the x and y axes around
the hypervolume contours before plotting. Default is 0.01.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_plot_+3A_contour_buffer_factor">contour_buffer_factor</code></td>
<td>
<p>multiplicative expansion factor by which to expand the x and y axes in all directions,
relative to the range of the axis, before calculating the hypervolume contours for plotting.
If this is not set to a sufficiently large value, the contour lines of the hypervolumes will be cut off.
Default value is 0.25 (25% expansion of the axis limits in all directions).</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_plot_+3A_panel_height">panel_height</code></td>
<td>
<p>height of the individual plot panels, in units given by <code>units</code>. Default is 3 cm.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_plot_+3A_panel_width">panel_width</code></td>
<td>
<p>height of the individual plot panels, in units given by <code>units</code>. Default is 3 cm.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_plot_+3A_units">units</code></td>
<td>
<p>units for panel height and width. Default is centimeters.</p>
</td></tr>
<tr><td><code id="Ostats_multivariate_plot_+3A_hypervolume_args">hypervolume_args</code></td>
<td>
<p>additional arguments to pass to <code><a href="hypervolume.html#topic+hypervolume">hypervolume</a></code>,
such as <code>method</code>. If none are provided, default values are used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Some of the code for generating contour lines is modified from
<code><a href="hypervolume.html#topic+plot.Hypervolume">plot.HypervolumeList</a></code>.
</p>


<h3>Value</h3>

<p>Two-dimensional projections of species trait hypervolumes for each pair of traits,
plotted together for each community to show how they overlap each other.
The overlap value obtained as output from <code><a href="#topic+Ostats_multivariate">Ostats_multivariate</a></code>
is labelled on each community graph, if provided by the user.
</p>
<p>The class of the returned object is <code>Ostats_plot_object</code>. Calling
<code>print</code> on this object will invoke a method to draw the plot using
<code><a href="grid.html#topic+grid.draw">grid.draw</a></code>.
</p>
<p>If more than one community is provided, a list of objects of class
<code>Ostats_plot_object</code> will be returned.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Ostats_multivariate">Ostats_multivariate</a></code> for generating multivariate O-statistics
</p>

<hr>
<h2 id='Ostats_plot'>Plot community trait overlap</h2><span id='topic+Ostats_plot'></span>

<h3>Description</h3>

<p>This function plots the overlap of traits among
species for each community. If there are multiple traits,
each trait is plotted separately in one-dimensional space.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Ostats_plot(
  plots,
  sp,
  traits,
  overlap_dat = NULL,
  use_plots = NULL,
  n_col = 1,
  scale = "fixed",
  colorvalues = NULL,
  alpha = 0.5,
  adjust = 2,
  bin_width = 1,
  limits_x = NULL,
  legend = FALSE,
  name_x = "trait value",
  name_y = "probability density",
  normalize = TRUE,
  means = FALSE,
  circular = FALSE,
  discrete = FALSE,
  circular_args = list()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Ostats_plot_+3A_plots">plots</code></td>
<td>
<p>Site identity: a vector of names of each community.</p>
</td></tr>
<tr><td><code id="Ostats_plot_+3A_sp">sp</code></td>
<td>
<p>Taxon identity: a vector of species or taxa names.</p>
</td></tr>
<tr><td><code id="Ostats_plot_+3A_traits">traits</code></td>
<td>
<p>A vector of trait measurements for each individual, or a matrix
or data frame with rows representing individuals and columns representing traits.</p>
</td></tr>
<tr><td><code id="Ostats_plot_+3A_overlap_dat">overlap_dat</code></td>
<td>
<p>Optional: an object containing the output of <code><a href="#topic+Ostats">Ostats</a></code>.
If provided, overlap statistics will be displayed in the plot panels.</p>
</td></tr>
<tr><td><code id="Ostats_plot_+3A_use_plots">use_plots</code></td>
<td>
<p>a vector of sites to plot. If NULL, the function will plot all the sites.</p>
</td></tr>
<tr><td><code id="Ostats_plot_+3A_n_col">n_col</code></td>
<td>
<p>Number of columns for layout of individual panels. Default is 1.</p>
</td></tr>
<tr><td><code id="Ostats_plot_+3A_scale">scale</code></td>
<td>
<p>If you want the scale of x, y or both x and y axis to be independent,
set the argument to &quot;free_x&quot;, &quot;free_y&quot; or &quot;free&quot; respectively.
Default = &quot;fixed&quot; which uses the same scale across all sites.
See <code><a href="ggplot2.html#topic+facet_grid">facet_grid</a></code>.</p>
</td></tr>
<tr><td><code id="Ostats_plot_+3A_colorvalues">colorvalues</code></td>
<td>
<p>Vector of color values for the density polygons.
Defaults to a viridis palette if none provided.</p>
</td></tr>
<tr><td><code id="Ostats_plot_+3A_alpha">alpha</code></td>
<td>
<p>defines the transparency level for the density polygons. Default is 0.5.</p>
</td></tr>
<tr><td><code id="Ostats_plot_+3A_adjust">adjust</code></td>
<td>
<p>the bandwidth adjustment of the density polygons. Default is 2.
See <code><a href="stats.html#topic+density">density</a></code>. Only used if <code>discrete = FALSE</code>.</p>
</td></tr>
<tr><td><code id="Ostats_plot_+3A_bin_width">bin_width</code></td>
<td>
<p>the width of each bin of the histograms. Default is 1.
Only used if <code>discrete = TRUE</code>.</p>
</td></tr>
<tr><td><code id="Ostats_plot_+3A_limits_x">limits_x</code></td>
<td>
<p>Vector of length 2, with multiplicative factor to apply to the minimum
and maximum values of each trait to expand the limits of the x axis.
Default is <code>c(0.5, 1.5)</code>, or 0.5 times the minimum and 1.5 times the maximum
value of each trait, for continuous traits. For discrete traits the default is
<code>c(1, 1)</code> or no expansion of limits.</p>
</td></tr>
<tr><td><code id="Ostats_plot_+3A_legend">legend</code></td>
<td>
<p>Whether to include a legend. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="Ostats_plot_+3A_name_x">name_x</code></td>
<td>
<p>x-axis label. Default is 'trait value'</p>
</td></tr>
<tr><td><code id="Ostats_plot_+3A_name_y">name_y</code></td>
<td>
<p>y-axis label. Default is 'probability density'</p>
</td></tr>
<tr><td><code id="Ostats_plot_+3A_normalize">normalize</code></td>
<td>
<p>if <code>TRUE</code>, areas of density plots are normalized to be equal
across taxa; if <code>FALSE</code>, areas will be proportional to abundance.
Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="Ostats_plot_+3A_means">means</code></td>
<td>
<p>if <code>TRUE</code>, trait means for each species are plotted in an additional plot
column next to the traits distribution plots for each site. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="Ostats_plot_+3A_circular">circular</code></td>
<td>
<p>if <code>TRUE</code>, plots density plots or histograms using polar
coordinates, and estimates density using method for objects of class
<code>circular</code>. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="Ostats_plot_+3A_discrete">discrete</code></td>
<td>
<p>if <code>TRUE</code>, plots histograms at discrete trait values instead
of smooth kernel density plots. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="Ostats_plot_+3A_circular_args">circular_args</code></td>
<td>
<p>optional list of additional arguments to pass to
<code><a href="circular.html#topic+circular">circular</a></code>. Only used if <code>circular = TRUE</code> and
<code>discrete = FALSE</code>. If no arguments are provided, default arguments to
<code><a href="circular.html#topic+circular">circular</a></code> are used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Density plots of species trait distributions plotted together
for each community to show how they overlap each other. Each community
is plotted on a separate panel within a multipanel figure.
The overlap value obtained as output from <code><a href="#topic+Ostats">Ostats</a></code>
is labelled on each community graph, if provided by the user.
</p>
<p>If trait values are discrete rather than continuous, histograms are
plotted instead of kernel density plots.
</p>
<p>If trait values are circular, a circular kernel density estimate for
each species is plotted on a polar coordinate plot. If trait values are
both circular and discrete, a &quot;sunburst&quot; plot is returned.
</p>
<p>The class of the returned object is <code>Ostats_plot_object</code>. Calling
<code>print</code> on this object will draw the plot using
<code><a href="grid.html#topic+grid.draw">grid.draw</a></code>.
</p>
<p>If more than one trait is provided, a list of objects of class
<code>Ostats_plot_object</code> will be returned.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Ostats">Ostats</a></code> to Calculate O-statistics (community-level
pairwise niche overlap statistics)
</p>


<h3>Examples</h3>

<pre><code class='language-R'># set the arguments:
plots &lt;- small_mammal_data$siteID
sp &lt;- small_mammal_data$taxonID
traits &lt;- log10(small_mammal_data$weight)

# to plot only selected sites:
use_plots &lt;- c('BART','KONZ','JORN')


Ostats_plot(plots = plots, sp = sp, traits = traits,
           overlap_dat = small_mammal_Ostats,
           use_plots = use_plots, means = TRUE)
</code></pre>

<hr>
<h2 id='pitcher_traits'>Sample Multivariate Trait Data (Pitcher Plants)</h2><span id='topic+pitcher_traits'></span>

<h3>Description</h3>

<p>These data represent a subset of trait information collected on carnivorous pitchers of the Northern Pitcher plant, *Sarracenia purpurea*,
across the species' native North American latitudinal range 30.197°N-53.722°N (Freedman et al. 2021).
We provide data from 5 sites out of the 36 sites sampled.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pitcher_traits
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 120 rows and 9 columns.
</p>


<h3>Details</h3>

<p>Pitcher traits measured include:
</p>

<ul>
<li><p> orthogonal rosette diameters: the length of the widest part of the basal rosette and the longest length of the basal rosette that is perpendicular to the length of the widest part of the basal rosette
</p>
</li>
<li><p> pitcher length: for the randomly selected pitcher selected for measurement this represents the length from the base of the pitcher (near the rosette of the individual plant) up to the topmost part of the pitcher
</p>
</li>
<li><p> pitcher width: length of the widest part of the pitcher randomly selected for measurement
</p>
</li>
<li><p> keel width: length of the widest part of the keel (the lobe that runs from the pitcher opening to the base on the front side of the pitcher)
</p>
</li>
<li><p> mouth diameter: the length of the widest part of the pitcher opening
</p>
</li>
<li><p> lip thickness: the length of the thickness of the pitcher at its opening
</p>
</li></ul>

<p>See Ellison and Gotelli (2002) for a diagram illustrating traits measured.
</p>


<h3>References</h3>

<p>Ellison, A.M., and N.J. Gotelli. 2002. Nitrogen availability alters the expression of carnivory in the Northern Pitcher Plant, *Sarracenia purpurea*. *Proceedings of the National Academy of Science* 99(7):4409-12.
</p>
<p>Freedman, Z.B., A. McGrew, B. Baiser, M. Besson, D. Gravel, T. Poisot, S. Record, L.B. Trotta, and N.J. Gotelli. 2021. Environment-host-microbial interactions shape the *Sarracenia purpurea* microbiome at the continental scale. *Ecology*, 102(5):e03308.
</p>

<hr>
<h2 id='reg_pool'>Sample Data for Ostats_regional</h2><span id='topic+reg_pool'></span>

<h3>Description</h3>

<p>This is a sample dataset with small mammal data from the NEON sites Bartlett
(BART) and Harvard Forest (HARV) for all available years.
The two sites belong to the same domain, the Northeast domain.
Each row represents an individual small mammal that was
trapped and weighed, with its species identity and body mass in grams.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>reg_pool
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 7905 rows and 6 columns.
</p>


<h3>References</h3>

<p>Read, Q.D., J.M. Grady, P.L. Zarnetske, S. Record, B. Baiser, J. Belmaker, M.-N. Tuanmu, A. Strecker, L. Beaudrot, and K.M. Thibault. 2018. Among-species overlap in rodent body size distributions predicts species richness along a temperature gradient. *Ecography* 41(10):1718-1727. https://doi.org/10.1111/ecog.03641
</p>

<hr>
<h2 id='small_mammal_data'>Sample Continuous Trait Data (NEON Small Mammals 2015)</h2><span id='topic+small_mammal_data'></span>

<h3>Description</h3>

<p>This is a sample dataset with small mammal data from all available
NEON sites in 2015.
Each row represents an individual small mammal that was
trapped and weighed, with its species identity, body weight in grams,
sex, and life stage provided.
Site name, site code, and sampling plot ID are provided.
This dataset is adapted from one published by Read et al. (2018).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>small_mammal_data
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 7692 rows and 7 columns.
</p>


<h3>References</h3>

<p>NEON (National Ecological Observatory Network). Small mammal box trapping (DP1.10072.001). https://data.neonscience.org (accessed July 13, 2021)
</p>
<p>Read, Q.D., J.M. Grady, P.L. Zarnetske, S. Record, B. Baiser, J. Belmaker, M.-N. Tuanmu, A. Strecker, L. Beaudrot, and K.M. Thibault. 2018. Among-species overlap in rodent body size distributions predicts species richness along a temperature gradient. *Ecography* 41(10):1718-1727. https://doi.org/10.1111/ecog.03641
</p>

<hr>
<h2 id='small_mammal_Ostats'>Pre-calculated Overlap Statistics for NEON Small Mammals 2015</h2><span id='topic+small_mammal_Ostats'></span>

<h3>Description</h3>

<p>This is the pre-calculated output of the Ostats() function run on the
<code><a href="#topic+small_mammal_data">small_mammal_data</a></code> dataset, after log-transforming the body masses.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>small_mammal_Ostats
</code></pre>


<h3>Format</h3>

<p>An object of class <code>list</code> of length 4.
</p>


<h3>References</h3>

<p>Read, Q.D., J.M. Grady, P.L. Zarnetske, S. Record, B. Baiser, J. Belmaker, M.-N. Tuanmu, A. Strecker, L. Beaudrot, and K.M. Thibault. 2018. Among-species overlap in rodent body size distributions predicts species richness along a temperature gradient. *Ecography* 41(10):1718-1727. https://doi.org/10.1111/ecog.03641
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
