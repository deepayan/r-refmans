<!DOCTYPE html><html><head><title>Help for package CARME</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {CARME}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#CARME-package'><p>The 'CARME' package.</p></a></li>
<li><a href='#car_mm'><p>CAR-MM prior model</p></a></li>
<li><a href='#f_mm_high_ord'><p>Helper function for MM matrix simulation</p></a></li>
<li><a href='#sim_car'><p>Simulation of proper CAR random effects</p></a></li>
<li><a href='#sim_MM_matrix'><p>Simulation of MM matrix based</p></a></li>
<li><a href='#W_sel'><p>Adjacency matrix for the South East London set of MSOAs</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>CAR-MM Modelling in Stan</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.1</td>
</tr>
<tr>
<td>Description:</td>
<td>'Stan' based functions to estimate CAR-MM models. These models allow to estimate Generalised Linear Models with CAR (conditional autoregressive) spatial random effects for spatially and temporally misaligned data, provided a suitable Multiple Membership matrix. The main references are Gramatica, Liverani and Congdon (2023) &lt;<a href="https://doi.org/10.1214%2F23-BA1370">doi:10.1214/23-BA1370</a>&gt;, Petrof, Neyens, Nuyts, Nackaerts, Nemery and Faes (2020) &lt;<a href="https://doi.org/10.1002%2Fsim.8697">doi:10.1002/sim.8697</a>&gt; and Gramatica, Congdon and Liverani &lt;<a href="https://doi.org/10.1111%2Frssc.12480">doi:10.1111/rssc.12480</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Biarch:</td>
<td>true</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>methods, Rcpp (&ge; 0.12.0), rstan (&ge; 2.18.1), MASS, expm,
stats, rstantools</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>BH (&ge; 1.66.0), Rcpp (&ge; 0.12.0), RcppEigen (&ge; 0.3.3.3.0),
rstan (&ge; 2.18.1), StanHeaders (&ge; 2.18.0), RcppParallel (&ge;
5.0.1)</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>GNU make</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-03-25 12:44:09 UTC; marcogramatica</td>
</tr>
<tr>
<td>Author:</td>
<td>Marco Gramatica <a href="https://orcid.org/0000-0002-6374-0933"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Silvia Liverani <a href="https://orcid.org/0000-0002-1870-3017"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Peter Congdon <a href="https://orcid.org/0000-0003-1934-9205"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Marco Gramatica &lt;gramaticamarco@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-03-25 13:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='CARME-package'>The 'CARME' package.</h2><span id='topic+CARME-package'></span><span id='topic+CARME'></span>

<h3>Description</h3>

<p>CAR-MM modelling in Stan
</p>


<h3>References</h3>

<p>Stan Development Team (2023). RStan: the R interface to Stan. R package version
2.26.11. https://mc-stan.org
</p>
<p>Marco Gramatica. Silvia Liverani. Peter Congdon.
Structure Induced by a Multiple Membership Transformation on the Conditional
Autoregressive Model. Bayesian Analysis Advance Publication 1 - 25, 2023.
https://doi.org/10.1214/23-BA1370
</p>
<p>Petrof, O, Neyens, T, Nuyts, V, Nackaerts, K, Nemery, B, Faes, C. On the
impact of residential history in the spatial analysis of diseases with a
long latency period: A study of mesothelioma in Belgium.
Statistics in Medicine. 2020; 39: 3840– 3866.
https://doi.org/10.1002/sim.8697
</p>
<p>Marco Gramatica, Peter Congdon, Silvia Liverani, Bayesian Modelling for
Spatially Misaligned Health Areal Data: A Multiple Membership Approach,
Journal of the Royal Statistical Society Series C: Applied Statistics,
Volume 70, Issue 3, June 2021, Pages 645–666,
https://doi.org/10.1111/rssc.12480
</p>

<hr>
<h2 id='car_mm'>CAR-MM prior model</h2><span id='topic+car_mm'></span>

<h3>Description</h3>

<p>CAR-MM prior model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>car_mm(d_list, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="car_mm_+3A_d_list">d_list</code></td>
<td>
<p>List of data inputs for the stan model.</p>
</td></tr>
<tr><td><code id="car_mm_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code>rstan::sampling</code> (e.g. iter, chains).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>stanfit</code> returned by <code>rstan::sampling</code>
</p>


<h3>References</h3>


<p>Marco Gramatica. Silvia Liverani. Peter Congdon.
&quot;Structure Induced by a Multiple Membership Transformation on the Conditional
Autoregressive Model.&quot; Bayesian Analysis Advance Publication 1 - 25, 2023.
https://doi.org/10.1214/23-BA1370
</p>
<p>Petrof, O, Neyens, T, Nuyts, V, Nackaerts, K, Nemery, B, Faes, C. On the
impact of residential history in the spatial analysis of diseases with a
long latency period: A study of mesothelioma in Belgium.
Statistics in Medicine. 2020; 39: 3840– 3866.
https://doi.org/10.1002/sim.8697

</p>


<h3>Examples</h3>

<pre><code class='language-R'>
set.seed(455)

#---- Load data
data(W_sel)
## Number of areas
n &lt;- nrow(W_sel)
## Number of memberships
m &lt;- 153

#---- Simulate covariates
X &lt;- cbind(rnorm(nrow(W_sel)), rnorm(nrow(W_sel)))
## Min-max normalisation
X_cent &lt;- apply(X, 2, function(x) (x - min(x))/diff(range(x)))

#---- Simulate MM matrix
w_ord &lt;- c(.5, .35, .15) # Weight of each neighbours orders
ord &lt;- length(w_ord) - 1 # Order of neighbours to include
H_sel_sim &lt;- sim_MM_matrix(
  W = W_sel, m = m, ord = ord, w_ord = w_ord, id_vec = rep(1, nrow(W_sel))
)

#---- Simulate outcomes
## Linear term parameters
gamma &lt;- -.5 # Intercept
beta &lt;- c(1, .5) # Covariates coefficients
## CAR random effects
phi_car &lt;- sim_car(W = W_sel, alpha = .9, tau = 5)
# Areal log relative risks
l_RR &lt;- X_cent %*% beta + phi_car
## Membership log relative risks
l_RR_mm &lt;- as.numeric(apply(H_sel_sim, 1, function(x) x %*% l_RR))
## Expected rates
exp_rates &lt;- rpois(m, lambda = 20)
## Outcomes
y &lt;- rpois(m, lambda = exp_rates*exp(l_RR_mm))

#---- Create dataset for stan function
d_sel &lt;- list(
  # Number of areas
  n = nrow(W_sel),
  # Covariates
  k = ncol(X_cent),
  X_cov = X_cent,
  # Adjacency
  W_n = sum(W_sel) / 2,
  # Number of neighbour pairs
  W = W_sel,
  # Memberships
  m = nrow(H_sel_sim),
  H = H_sel_sim,
  # Outcomes
  y = y,
  log_offset = log(exp_rates),
  # Prior parameters
  ## Intercept (mean and sd of normal prior)
  mu_gamma = 0, sigma_gamma = 1,
  ## Covariates (mean and sd of normal prior)
  mu_beta = 0, sigma_beta = 1,
  ## Marginal precision gamma prior
  tau_shape = 2,
  tau_rate = 0.2
)

#---- HMC parameters
niter &lt;- 1E4
nchains &lt;- 4

#---- Stan sampling
fit &lt;- car_mm(
  d_list = d_sel,
  # arguments passed to sampling
  iter = niter, chains = nchains, refresh = 500,
  control = list(adapt_delta = .99, max_treedepth = 15)
)


</code></pre>

<hr>
<h2 id='f_mm_high_ord'>Helper function for MM matrix simulation</h2><span id='topic+f_mm_high_ord'></span>

<h3>Description</h3>

<p>Helper function for MM matrix simulation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>f_mm_high_ord(W, ord, mat_ord_weight, ind_range)
</code></pre>


<h3>References</h3>

<p>Marco Gramatica. Silvia Liverani. Peter Congdon.
&quot;Structure Induced by a Multiple Membership Transformation on the Conditional
Autoregressive Model.&quot; Bayesian Analysis Advance Publication 1 - 25, 2023.
https://doi.org/10.1214/23-BA1370
</p>

<hr>
<h2 id='sim_car'>Simulation of proper CAR random effects</h2><span id='topic+sim_car'></span>

<h3>Description</h3>

<p><code>sim_car</code> returns a vector of CAR distributed random effects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim_car(W, alpha = 0.5, tau = 5)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sim_car_+3A_w">W</code></td>
<td>
<p>Symmetric adjacency matrix of size <code>n</code></p>
</td></tr>
<tr><td><code id="sim_car_+3A_alpha">alpha</code></td>
<td>
<p>properness parameter between 0 and 1. Defaults to 0.5</p>
</td></tr>
<tr><td><code id="sim_car_+3A_tau">tau</code></td>
<td>
<p>marginal precision. Defaults to 5</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a vector of length <code>n</code>
</p>


<h3>References</h3>

<p>Jin, X., Carlin, B.P. and Banerjee, S. (2005), Generalized
Hierarchical Multivariate CAR Models for Areal Data. Biometrics,
61: 950-961. https://doi.org/10.1111/j.1541-0420.2005.00359.x
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(W_sel)
sim_car(W = W_sel, alpha = .9, tau = 5)
</code></pre>

<hr>
<h2 id='sim_MM_matrix'>Simulation of MM matrix based</h2><span id='topic+sim_MM_matrix'></span>

<h3>Description</h3>

<p><code>sim_MM_matrix</code> returns a multiple membership matrix simulated based on an
adjacency matrix according to the method described in
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim_MM_matrix(W, m, ord = 3, w_ord, id_vec, excess_areas = FALSE, red_areas)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sim_MM_matrix_+3A_w">W</code></td>
<td>
<p>Symmetric adjacency matrix of size <code>n</code></p>
</td></tr>
<tr><td><code id="sim_MM_matrix_+3A_m">m</code></td>
<td>
<p>Integer. Number of membership to simulate</p>
</td></tr>
<tr><td><code id="sim_MM_matrix_+3A_ord">ord</code></td>
<td>
<p>Integer. Maximum order of neighbours to be used to simulate the
memberships based on the adjacency matrix <code>W</code></p>
</td></tr>
<tr><td><code id="sim_MM_matrix_+3A_w_ord">w_ord</code></td>
<td>
<p>A vector of length <code>ord</code> that specifies the weights of each
order of neighbours</p>
</td></tr>
<tr><td><code id="sim_MM_matrix_+3A_id_vec">id_vec</code></td>
<td>
<p>Vector of zeros and ones of length <code>n</code>. Defaults to
a vector of ones. It indicates whether an area is included in the
simulation of a membership</p>
</td></tr>
<tr><td><code id="sim_MM_matrix_+3A_excess_areas">excess_areas</code></td>
<td>
<p>if different from FALSE it indicates the indices of the
areas to reuse in simulating memberships, whenever <code>m</code> &gt; <code>n</code>. It defaults to
FALSE, and if omitted randomly selects without replacement
(if <code>m</code> - <code>n</code> &lt;= <code>n</code>, otherwise with replacement) a subset of areas</p>
</td></tr>
<tr><td><code id="sim_MM_matrix_+3A_red_areas">red_areas</code></td>
<td>
<p>vector of indices of areas to use if <code>m</code> &lt; <code>n</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>an m x n matrix of weights
</p>


<h3>References</h3>

<p>Marco Gramatica. Silvia Liverani. Peter Congdon.
&quot;Structure Induced by a Multiple Membership Transformation on the Conditional
Autoregressive Model.&quot; Bayesian Analysis Advance Publication 1 - 25, 2023.
https://doi.org/10.1214/23-BA1370
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(455)

#---- Load data
data(W_sel)
## Number of areas
n &lt;- nrow(W_sel)
## Number of memberships
m &lt;- 153

#---- Simulate MM matrix
w_ord &lt;- c(.5, .35, .15) # Weight of each neighbours orders
ord &lt;- length(w_ord) - 1 # Order of neighbours to include
H_sel_sim &lt;- sim_MM_matrix(
  W = W_sel, m = m, ord = ord, w_ord = w_ord, id_vec = rep(1, nrow(W_sel))
)
</code></pre>

<hr>
<h2 id='W_sel'>Adjacency matrix for the South East London set of MSOAs</h2><span id='topic+W_sel'></span>

<h3>Description</h3>

<p>Adjacency matrix of 152 MSOAs in South East London, used for the data
analysis in the paper &quot;Structure induced by a multiple membership
transformation on the Conditional Autoregressive model&quot;. Column and rows
names indicate the MSOA code.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(W_sel)
</code></pre>


<h3>Format</h3>

<p>A 152x152 symmetric matrix
</p>


<h3>References</h3>

<p>Marco Gramatica. Silvia Liverani. Peter Congdon.
&quot;Structure Induced by a Multiple Membership Transformation on the Conditional
Autoregressive Model.&quot; Bayesian Analysis Advance Publication 1 - 25, 2023.
https://doi.org/10.1214/23-BA1370
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
