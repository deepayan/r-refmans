<!DOCTYPE html><html lang="en-US"><head><title>Help for package gapclosing</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {gapclosing}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#+25+26gt+3B+25'><p>Pipe operator</p></a></li>
<li><a href='#as.data.frame.gapclosing'><p>Coerce to a Data Frame</p></a></li>
<li><a href='#cross_fit_estimator'><p>Cross-fitting gap closing estimator</p></a></li>
<li><a href='#df_to_gapclosing_list'><p>Convert Back to Canonical List Output</p></a></li>
<li><a href='#disparityplot'><p>Plot a disparity</p></a></li>
<li><a href='#fit_ridge'><p>Ridge regression estimator</p></a></li>
<li><a href='#gapclosing'><p>Gap closing estimator</p></a></li>
<li><a href='#generate_simulated_data'><p>Generate simulated data</p></a></li>
<li><a href='#pairwise_diff'><p>Pairwise difference calculator</p></a></li>
<li><a href='#plot.gapclosing'><p>Plot function for gapclosing objects</p></a></li>
<li><a href='#point_estimator'><p>Point estimator for gap-closing estimands</p></a></li>
<li><a href='#print.gapclosing'><p>Print function for gapclosing objects</p></a></li>
<li><a href='#summary.gapclosing'><p>Summary function for gapclosing objects</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Estimate Gaps Under an Intervention</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.2</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides functions to estimate the disparities across categories (e.g. Black and white) that persists if a treatment variable (e.g. college) is equalized. Makes estimates by treatment modeling, outcome modeling, and doubly-robust augmented inverse probability weighting estimation, with standard errors calculated by a nonparametric bootstrap. Cross-fitting is supported. Survey weights are supported for point estimation but not for standard error estimation; those applying this package with complex survey samples should consult the data distributor to select an appropriate approach for standard error construction, which may involve calling the functions repeatedly for many sets of replicate weights provided by the data distributor. The methods in this package are described in Lundberg (2021) &lt;<a href="https://doi.org/10.31235%2Fosf.io%2Fgx4y3">doi:10.31235/osf.io/gx4y3</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://ilundberg.github.io/gapclosing/">https://ilundberg.github.io/gapclosing/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/ilundberg/gapclosing/issues">https://github.com/ilundberg/gapclosing/issues</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats, mgcv, ranger, glmnet, magrittr, dplyr, forcats,
ggplot2, tidyr, foreach, tidyselect, parallel, doParallel</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 3.0.0), knitr, rmarkdown, spelling</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-09-30 01:53:22 UTC; ilundberg</td>
</tr>
<tr>
<td>Author:</td>
<td>Ian Lundberg <a href="https://orcid.org/0000-0002-1909-2270"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Ian Lundberg &lt;ianlundberg@ucla.edu&gt;</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-10-11 07:40:22 UTC</td>
</tr>
</table>
<hr>
<h2 id='+25+26gt+3B+25'>Pipe operator</h2><span id='topic++25+3E+25'></span>

<h3>Description</h3>

<p>See <code>magrittr::<a href="magrittr.html#topic+pipe">%&gt;%</a></code> for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lhs %&gt;% rhs
</code></pre>

<hr>
<h2 id='as.data.frame.gapclosing'>Coerce to a Data Frame</h2><span id='topic+as.data.frame.gapclosing'></span>

<h3>Description</h3>

<p>This function converts a <code>gapclosing</code> object into a data frame. The gapclosing class contains results within a named list, thus simplifying things for manual user interaction with the results. In some programming settings (e.g. a bootstrap), it is easier to work with a rectangular data frame of results. This function produces that data frame.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'gapclosing'
as.data.frame(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as.data.frame.gapclosing_+3A_x">x</code></td>
<td>
<p>Object of class <code>gapclosing</code>, produced by a call to <code>gapclosing()</code>.</p>
</td></tr>
<tr><td><code id="as.data.frame.gapclosing_+3A_...">...</code></td>
<td>
<p>Additional arguments to be passed to or from methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame containing estimates.
</p>


<h3>References</h3>

<p>Lundberg I (2021). &quot;The gap-closing estimand: A causal approach to study interventions that close disparities across social categories.&quot; Sociological Methods and Research. Available at https://osf.io/gx4y3/.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulate example data
simulated_data &lt;- generate_simulated_data(n = 100)

# Fit by outcome modeling
estimate &lt;- gapclosing(
  data = simulated_data,
  outcome_formula = formula(outcome ~ treatment * category + confounder),
  treatment_name = "treatment",
  category_name = "category",
  counterfactual_assignments = 1
)
summary(estimate)

# Convert to a data frame
estimate.df &lt;- as.data.frame(estimate)
</code></pre>

<hr>
<h2 id='cross_fit_estimator'>Cross-fitting gap closing estimator</h2><span id='topic+cross_fit_estimator'></span>

<h3>Description</h3>

<p>This is an internal function typically called from other functions rather than by the user. It creates cross-validation folds and repeatedly calls split_sample_estimator to conduct cross-fitting.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cross_fit_estimator(
  data,
  counterfactual_assignments,
  outcome_formula,
  treatment_formula,
  category_name,
  outcome_name,
  treatment_name,
  treatment_algorithm = "glm",
  outcome_algorithm = "lm",
  weight_name = NULL,
  n_folds = 2,
  folds_name = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cross_fit_estimator_+3A_data">data</code></td>
<td>
<p>Data frame containing the observed data</p>
</td></tr>
<tr><td><code id="cross_fit_estimator_+3A_counterfactual_assignments">counterfactual_assignments</code></td>
<td>
<p>Numeric scalar or vector of length nrow(data), each element of which is on the [0,1] interval. If a scalar, the counterfactual probability by which all units are assigned to treatment condition 1. If a vector, each element i corresponds to the counterfactual probability by which each unit i is assigned to treatment condition 1.</p>
</td></tr>
<tr><td><code id="cross_fit_estimator_+3A_outcome_formula">outcome_formula</code></td>
<td>
<p>Model formula the outcome. Covariates should include those needed for causal identification of the treatment effect (e.g. as defended in your Directed Acyclic Graph). If <code>outcome_algorithm</code> = &quot;ranger&quot;, then the outcome model will be fit separately on the treatment and control groups. Otherwise, the user must specify all interactions in the formula.</p>
</td></tr>
<tr><td><code id="cross_fit_estimator_+3A_treatment_formula">treatment_formula</code></td>
<td>
<p>Treatment formula, in the style formula(treatment ~ covariates). Covariates should include those needed for causal identification of the treatment effect (e.g. as defended in your Directed Acyclic Graph).</p>
</td></tr>
<tr><td><code id="cross_fit_estimator_+3A_category_name">category_name</code></td>
<td>
<p>Character name of the variable indicating the categories over which the gap is defined. Must be the name of a column in <code>data</code>.</p>
</td></tr>
<tr><td><code id="cross_fit_estimator_+3A_outcome_name">outcome_name</code></td>
<td>
<p>Character name of the outcome variable. Only required when there is no outcome_formula; otherwise extracted automatically. Must be a name of a column in <code>data</code>.</p>
</td></tr>
<tr><td><code id="cross_fit_estimator_+3A_treatment_name">treatment_name</code></td>
<td>
<p>Character name of the treatment variable. Only required when there is no treatment_formula; otherwise extracted automatically. Must be a name of a column in <code>data</code>.</p>
</td></tr>
<tr><td><code id="cross_fit_estimator_+3A_treatment_algorithm">treatment_algorithm</code></td>
<td>
<p>Character name of the algorithm for the treatment model. One of &quot;glm&quot;, &quot;ridge&quot;, &quot;gam&quot;, or &quot;ranger&quot;. Defaults to &quot;glm&quot;, which is a logit model. Option &quot;ridge&quot; is ridge regression. Option &quot;gam&quot; is a generalized additive model fit (see package <code>mgcv</code>). Option &quot;ranger&quot; is a random forest (see package <code>ranger</code>). If &quot;ranger&quot;, this function avoids propensity scores equal to 0 or 1 by bottom- and top-coding predicted values at .001 and .999.</p>
</td></tr>
<tr><td><code id="cross_fit_estimator_+3A_outcome_algorithm">outcome_algorithm</code></td>
<td>
<p>Character name of the algorithm for the outcome model. One of &quot;lm&quot;, &quot;ridge&quot;, &quot;gam&quot;, or &quot;ranger&quot;. Defaults to &quot;lm&quot;, which is an OLS model. Option &quot;ridge&quot; is ridge regression. Option &quot;gam&quot; is a generalized additive model fit (see package <code>mgcv</code>). Option &quot;ranger&quot; is a random forest (see package <code>ranger</code>).</p>
</td></tr>
<tr><td><code id="cross_fit_estimator_+3A_weight_name">weight_name</code></td>
<td>
<p>Character name of a sampling weight variable, if any, which captures the inverse probability of inclusion in the sample. The default assumes a simple random sample (all weights equal).</p>
</td></tr>
<tr><td><code id="cross_fit_estimator_+3A_n_folds">n_folds</code></td>
<td>
<p>Only used if <code>method</code> = &quot;cross_fit&quot; and if <code>folds</code> is not provided. Integer scalar containing number of cross-validation folds. The function will assign observations to folds systematically: sort the data by the variable named <code>category_name</code>, then by the treatment variable, then at random. On this sorted dataset, folds are assigned systematically by repeated <code>1:n_folds</code>. To be used if the user does not provide <code>folds</code>. Defaults to 2.</p>
</td></tr>
<tr><td><code id="cross_fit_estimator_+3A_folds_name">folds_name</code></td>
<td>
<p>Only used if <code>method</code> = &quot;cross_fit&quot;. Character string indicating a column of <code>data</code> containing fold identifiers. This may be preferable to <code>n_folds</code> if the researcher has a reason to assign the folds in these data by some other process, perhaps due to particulars of how these data were generated. If null (the default), folds are assigned as stated in <code>n_folds</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with four elements.
</p>

<p><code>counterfactual_means</code> A tibble with a counterfactual mean estimate for each category
<code>counterfactual_means</code> A tibble with a counterfactual disparity estimate for each pair of categories
<code>treatment_model</code> Object containing the fitted treatment model
<code>outcome_model</code> Object containing the fitted outcome model

</p>


<h3>References</h3>

<p>Lundberg I (2021). &quot;The gap-closing estimand: A causal approach to study interventions that close disparities across social categories.&quot; Sociological Methods and Research. Available at https://osf.io/gx4y3/.
</p>

<hr>
<h2 id='df_to_gapclosing_list'>Convert Back to Canonical List Output</h2><span id='topic+df_to_gapclosing_list'></span>

<h3>Description</h3>

<p>If the user has used <code>as.data.frame(x)</code> to convert a <code>gapclosing</code> object to a data frame of estimates, this function will invert back to the original list format. This function does not fully reinstate the original gapclosing object because some elements are lost when <code>as.data.frame()</code> is called. This function is most useful as a check on <code>as.data.frame()</code> and as a helper in settings like bootstrapping where a data frame is easier to work with but we want to return to the original format before returning an object to the user.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>df_to_gapclosing_list(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="df_to_gapclosing_list_+3A_x">x</code></td>
<td>
<p>A data frame produced by <code>as.data.frame(x)</code> applied to an object <code>x</code> of class <code>gapclosing</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing a subset of the elements in a <code>gapclosing</code> object.
</p>


<h3>References</h3>

<p>Lundberg I (2021). &quot;The gap-closing estimand: A causal approach to study interventions that close disparities across social categories.&quot; Sociological Methods and Research. Available at https://osf.io/gx4y3/.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulate example data
simulated_data &lt;- generate_simulated_data(n = 100)

# Fit by outcome modeling
estimate &lt;- gapclosing(
  data = simulated_data,
  outcome_formula = formula(outcome ~ treatment * category + confounder),
  treatment_name = "treatment",
  category_name = "category",
  counterfactual_assignments = 1
)
summary(estimate)

# Convert to a data frame
estimate.df &lt;- as.data.frame(estimate)
# Convert back to a list
estimate.df &lt;- df_to_gapclosing_list(estimate.df)
</code></pre>

<hr>
<h2 id='disparityplot'>Plot a disparity</h2><span id='topic+disparityplot'></span>

<h3>Description</h3>

<p>Plots the factual and counterfactual mean outcomes in two categories. The returned object is a ggplot2 object which can be further customized using the syntax of ggplot2.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>disparityplot(
  x,
  category_A,
  category_B,
  custom_ylab = "Mean Outcome",
  custom_xlab = "Category"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="disparityplot_+3A_x">x</code></td>
<td>
<p>An object of class <code>gapclosing</code>, which results from a call to the function <code>gapclosing</code></p>
</td></tr>
<tr><td><code id="disparityplot_+3A_category_a">category_A</code></td>
<td>
<p>The first category to be plotted. A value of the category_name variable in x.</p>
</td></tr>
<tr><td><code id="disparityplot_+3A_category_b">category_B</code></td>
<td>
<p>The second category to be plotted. Must be a value of <code>x$category</code></p>
</td></tr>
<tr><td><code id="disparityplot_+3A_custom_ylab">custom_ylab</code></td>
<td>
<p>Custom y-axis label. Defaults to &quot;Mean Outcome&quot;</p>
</td></tr>
<tr><td><code id="disparityplot_+3A_custom_xlab">custom_xlab</code></td>
<td>
<p>Custom x-axis label. Defaults to &quot;Category&quot;</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>ggplot2</code> object
</p>


<h3>References</h3>

<p>Lundberg I (2021). &quot;The gap-closing estimand: A causal approach to study interventions that close disparities across social categories.&quot; Sociological Methods and Research. Available at https://osf.io/gx4y3/.
</p>

<hr>
<h2 id='fit_ridge'>Ridge regression estimator</h2><span id='topic+fit_ridge'></span>

<h3>Description</h3>

<p>Not typically called by the user directly; called indirectly via other functions. Uses <code>glmnet</code> to fit a ridge regression with penalty chosen by cross-validation. Returns fitted values for the data in <code>to_predict</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_ridge(data, model_formula, to_predict)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fit_ridge_+3A_data">data</code></td>
<td>
<p>Data frame containing the observed data</p>
</td></tr>
<tr><td><code id="fit_ridge_+3A_model_formula">model_formula</code></td>
<td>
<p>A model formula object for the ridge regression to be fitted</p>
</td></tr>
<tr><td><code id="fit_ridge_+3A_to_predict">to_predict</code></td>
<td>
<p>Data frame containing observations for which predictions are to be made. If NULL, defaults to the same as <code>data</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing a <code>glmnet</code> model object <code>fit</code> and a vector <code>fitted</code> of fitted values for observations in <code>to_predict</code>.
</p>


<h3>References</h3>

<p>Lundberg I (2021). &quot;The gap-closing estimand: A causal approach to study interventions that close disparities across social categories.&quot; Sociological Methods and Research. Available at https://osf.io/gx4y3/.
</p>
<p>Friedman J, Hastie T, Tibshirani R (2010). &quot;Regularization Paths for Generalized Linear Models via Coordinate Descent.&quot; Journal of Statistical Software, 33(1), 1–22. https://www.jstatsoft.org/htaccess.php?volume=33&amp;type=i&amp;issue=01.
</p>

<hr>
<h2 id='gapclosing'>Gap closing estimator</h2><span id='topic+gapclosing'></span>

<h3>Description</h3>

<p>A function to estimate gap-closing estimands: means and disparities across categories of units that would persist under some counterfactual assignment of a treatment. To use this function, the user provides a data frame <code>data</code>, a rule <code>counterfactual_assignments</code> for counterfactually assigning treatment, a treatment and/or an outcome model for learning statistically about the counterfactuals, and the <code>category_name</code> of the variable in <code>data</code> over which categories are defined. The returned object summarizes factual and counterfactual means and disparities. Supported estimation algorithms include generalized linear models, ridge regression, generalized additive models, and random forests. Standard errors are supported by bootstrapping.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gapclosing(
  data,
  counterfactual_assignments,
  outcome_formula = NULL,
  treatment_formula = NULL,
  category_name,
  outcome_name = NULL,
  treatment_name = NULL,
  treatment_algorithm = "glm",
  outcome_algorithm = "lm",
  sample_split = "single_sample",
  se = FALSE,
  bootstrap_samples = 1000,
  bootstrap_method = "simple",
  parallel_cores = NULL,
  weight_name = NULL,
  n_folds = 2,
  folds_name = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gapclosing_+3A_data">data</code></td>
<td>
<p>Data frame containing the observed data</p>
</td></tr>
<tr><td><code id="gapclosing_+3A_counterfactual_assignments">counterfactual_assignments</code></td>
<td>
<p>Numeric scalar or vector of length nrow(data), each element of which is on the [0,1] interval. If a scalar, the counterfactual probability by which all units are assigned to treatment condition 1. If a vector, each element i corresponds to the counterfactual probability by which each unit i is assigned to treatment condition 1.</p>
</td></tr>
<tr><td><code id="gapclosing_+3A_outcome_formula">outcome_formula</code></td>
<td>
<p>Outcome formula , in the style <code>outcome ~ treatment*covariate</code>. Covariates should include those needed for causal identification of the treatment effect (e.g. as defended in your Directed Acyclic Graph). If <code>outcome_algorithm</code> = &quot;ranger&quot;, then the outcome model will be fit separately on the treatment and control groups. Otherwise, the user must specify all interactions in the formula.</p>
</td></tr>
<tr><td><code id="gapclosing_+3A_treatment_formula">treatment_formula</code></td>
<td>
<p>Treatment formula, in the style <code>treatment ~ covariate</code>. Covariates should include those needed for causal identification of the treatment effect (e.g. as defended in your Directed Acyclic Graph).</p>
</td></tr>
<tr><td><code id="gapclosing_+3A_category_name">category_name</code></td>
<td>
<p>Character name of the variable indicating the categories over which the gap is defined. Must be the name of a column in <code>data</code>.</p>
</td></tr>
<tr><td><code id="gapclosing_+3A_outcome_name">outcome_name</code></td>
<td>
<p>Character name of the outcome variable. Only required when there is no outcome_formula; otherwise extracted automatically. Must be a name of a column in <code>data</code>.</p>
</td></tr>
<tr><td><code id="gapclosing_+3A_treatment_name">treatment_name</code></td>
<td>
<p>Character name of the treatment variable. Only required when there is no treatment_formula; otherwise extracted automatically. Must be a name of a column in <code>data</code>.</p>
</td></tr>
<tr><td><code id="gapclosing_+3A_treatment_algorithm">treatment_algorithm</code></td>
<td>
<p>Character name of the algorithm for the treatment model. One of &quot;glm&quot;, &quot;ridge&quot;, &quot;gam&quot;, or &quot;ranger&quot;. Defaults to &quot;glm&quot;, which is a logit model. Option &quot;ridge&quot; is ridge regression. Option &quot;gam&quot; is a generalized additive model fit (see package <code>mgcv</code>). Option &quot;ranger&quot; is a random forest (see package <code>ranger</code>). If &quot;ranger&quot;, this function avoids propensity scores equal to 0 or 1 by bottom- and top-coding predicted values at .001 and .999.</p>
</td></tr>
<tr><td><code id="gapclosing_+3A_outcome_algorithm">outcome_algorithm</code></td>
<td>
<p>Character name of the algorithm for the outcome model. One of &quot;lm&quot;, &quot;ridge&quot;, &quot;gam&quot;, or &quot;ranger&quot;. Defaults to &quot;lm&quot;, which is an OLS model. Option &quot;ridge&quot; is ridge regression. Option &quot;gam&quot; is a generalized additive model fit (see package <code>mgcv</code>). Option &quot;ranger&quot; is a random forest (see package <code>ranger</code>).</p>
</td></tr>
<tr><td><code id="gapclosing_+3A_sample_split">sample_split</code></td>
<td>
<p>Character for the type of sample splitting to be conducted. One of &quot;single_sample&quot; or &quot;cross_fit&quot;. Defaults to &quot;single_sample&quot;, in which case <code>data</code> is used for both learning the nuisance functions and aggregating to an estimate. Option &quot;cross_fit&quot; uses cross-fitting to repeatedly use part of the sample to learn the nuisance function and another part to estimate the estimand, averaged over repetitions with these roles swapped.</p>
</td></tr>
<tr><td><code id="gapclosing_+3A_se">se</code></td>
<td>
<p>Logical indicating whether standard errors should be calculated. Default is FALSE. Standard errors assume a simple random sample by default; to stratify by (category x treatment), see the <code>bootstrap_method</code> argument. Because many datasets are not simple random samples, users should carefully consider whether a simple random sample bootstrap will accurately capture uncertainty.</p>
</td></tr>
<tr><td><code id="gapclosing_+3A_bootstrap_samples">bootstrap_samples</code></td>
<td>
<p>Only used if <code>se = TRUE</code>. Number of bootstrap samples. Default is 1000.</p>
</td></tr>
<tr><td><code id="gapclosing_+3A_bootstrap_method">bootstrap_method</code></td>
<td>
<p>Only used if <code>se = TRUE</code>. A character string stating how to conduct bootstrap samples. If &quot;simple&quot;, then samples are drawn with replacement from the full data. If &quot;stratified&quot;, then the bootstrap is carried out within subpopulations defined by category and treatment. The latter may be useful if the sample contains only a small number of observations in these cells and the user wants to ensure that every (category x treatment) cell appears in every bootstrap sample. With &quot;stratified&quot;, inference assumes that in repeated samples from the true population the proportion in each (category x treatment) cell would not change; this may or may not correspond to the true sampling process. Users should be cautious.</p>
</td></tr>
<tr><td><code id="gapclosing_+3A_parallel_cores">parallel_cores</code></td>
<td>
<p>Integer number of cores for parallel processing of the bootstrap. Defaults to sequential processing.</p>
</td></tr>
<tr><td><code id="gapclosing_+3A_weight_name">weight_name</code></td>
<td>
<p>Character name of a sampling weight variable, if any, which captures the inverse probability of inclusion in the sample. The default assumes a simple random sample (all weights equal).</p>
</td></tr>
<tr><td><code id="gapclosing_+3A_n_folds">n_folds</code></td>
<td>
<p>Only used if <code>method</code> = &quot;cross_fit&quot; and if <code>folds</code> is not provided. Integer scalar containing number of cross-validation folds. The function will assign observations to folds systematically: sort the data by the variable named <code>category_name</code>, then by the treatment variable, then at random. On this sorted dataset, folds are assigned systematically by repeated <code>1:n_folds</code>. To be used if the user does not provide <code>folds</code>. Defaults to 2.</p>
</td></tr>
<tr><td><code id="gapclosing_+3A_folds_name">folds_name</code></td>
<td>
<p>Only used if <code>method</code> = &quot;cross_fit&quot;. Character string indicating a column of <code>data</code> containing fold identifiers. This may be preferable to <code>n_folds</code> if the researcher has a reason to assign the folds in these data by some other process, perhaps due to particulars of how these data were generated. If null (the default), folds are assigned as stated in <code>n_folds</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of S3 class <code>gapclosing</code>, which supports <code>summary()</code>, <code>print()</code>, and <code>plot()</code> functions. The returned object can be coerced to a data frame of estimates with <code>as.data.frame()</code>. <br />
The object returned by a call to <code>gapclosing</code> contains several elements.
</p>

<ul>
<li> <p><code>factual_means</code> A tibble containing the factual mean outcome in each category <br />
</p>
</li>
<li> <p><code>factual_disparities</code> A tibble containing the disparities in factual mean outcomes across categories <br />
</p>
</li>
<li> <p><code>counterfactual_means</code> A tibble containing the counterfactual mean outcome (post-intervention mean) in each category <br />
</p>
</li>
<li> <p><code>counterfactual_disparities</code> A tibble containing the counterfactual disparities (gap-closing estimands) across categories <br />
</p>
</li>
<li> <p><code>change_means</code> A tibble containing the additive and proportional change from factual to counterfactual values for mean outcomes <br />
</p>
</li>
<li> <p><code>change_disparities</code> A tibble containing the additive and proportional change from factual to counterfactual values for disparities in mean outcomes (e.g. proportion of the factual gap which is closed by the intervention) <br />
</p>
</li>
<li> <p><code>all_estimators</code> A list containing estimates by treatment modeling, outcome modeling, and doubly-robust estimation. If any of these are not applicable, estimates are NA. <br />
</p>
</li>
<li> <p><code>primary_estimator_name</code> The name of the primary estimator (treatment_modeling, outcome_modeling, or doubly_robust). The estimates reported in the first 6 slots of the returned object come from this estimator. <br />
</p>
</li>
<li> <p><code>treatment_model</code> The fitted treatment model (or models on each fold in the case of cross-fitting). Note that this model object is a point estimate with standard errors derived from the algorithm used to fit it; any standard errors within <code>treatment_model</code> do not come from bootstrapping by the package. <br />
</p>
</li>
<li> <p><code>outcome_model</code> The fitted outcome model (or models on each fold in the case of cross-fitting). Note that this model object is a point estimate with standard errors derived from the algorithm used to fit it; any standard errors within <code>treatment_model</code> do not come from bootstrapping by the package. <br />
</p>
</li>
<li> <p><code>call</code> The call that produced this <code>gapclosing</code> object <br />
</p>
</li>
<li> <p><code>arguments</code> A list of all arguments from the call to <code>gapclosing</code>
</p>
</li></ul>



<h3>References</h3>

<p>Lundberg I (2021). &quot;The gap-closing estimand: A causal approach to study interventions that close disparities across social categories.&quot; Sociological Methods and Research. Available at https://osf.io/gx4y3/.
</p>
<p>Friedman J, Hastie T, Tibshirani R (2010). &quot;Regularization Paths for Generalized Linear Models via Coordinate Descent.&quot; Journal of Statistical Software, 33(1), 1–22. https://www.jstatsoft.org/htaccess.php?volume=33&amp;type=i&amp;issue=01.
</p>
<p>Wood S (2017). Generalized Additive Models: An Introduction with R, 2 edition. Chapman and Hall/CRC.
</p>
<p>Wright MN, Ziegler A (2017). &quot;ranger: A Fast Implementation of Random Forests for High Dimensional Data in C++ and R.&quot; Journal of Statistical Software, 77(1), 1–17. doi: 10.18637/jss.v077.i01.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulate example data
simulated_data &lt;- generate_simulated_data(n = 100)

# Fit by outcome modeling
# You can add standard errors with se = TRUE
estimate &lt;- gapclosing(
  data = simulated_data,
  outcome_formula = outcome ~ treatment * category + confounder,
  treatment_name = "treatment",
  category_name = "category",
  counterfactual_assignments = 1
)
summary(estimate)

# Fit by treatment modeling
# You can add standard errors with se = TRUE
estimate &lt;- gapclosing(
  data = simulated_data,
  treatment_formula = treatment ~ category + confounder,
  outcome_name = "outcome",
  category_name = "category",
  counterfactual_assignments = 1
)
summary(estimate)

# Fit by doubly-robust estimation
# You can add standard errors with se = TRUE
estimate &lt;- gapclosing(
  data = simulated_data,
  outcome_formula = outcome ~ treatment * category + confounder,
  treatment_formula = treatment ~ category + confounder,
  category_name = "category",
  counterfactual_assignments = 1
)
summary(estimate)

# Fit by doubly-robust cross-fitting estimation with random forests
# You can add standard errors with se = TRUE
estimate &lt;- gapclosing(
  data = simulated_data,
  outcome_formula = outcome ~ category + confounder,
  treatment_formula = treatment ~ category + confounder,
  category_name = "category",
  counterfactual_assignments = 1,
  outcome_algorithm = "ranger",
  treatment_algorithm = "ranger",
  sample_split = "cross_fit"
)
summary(estimate)
</code></pre>

<hr>
<h2 id='generate_simulated_data'>Generate simulated data</h2><span id='topic+generate_simulated_data'></span>

<h3>Description</h3>

<p>Generates simulated data to illustrate the gapclosing function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>generate_simulated_data(n = 1000)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="generate_simulated_data_+3A_n">n</code></td>
<td>
<p>Number of observations to be generated</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with <code>n</code> rows and 4 columns containing simulated data containing <code>category</code> over which disparities are defined, a <code>confounder</code> that affects treatment assignment, a binary <code>treatment</code>, and a continuous <code>outcome</code>.
</p>


<h3>References</h3>

<p>Lundberg I (2021). &quot;The gap-closing estimand: A causal approach to study interventions that close disparities across social categories.&quot; Sociological Methods and Research. Available at https://osf.io/gx4y3/.
</p>

<hr>
<h2 id='pairwise_diff'>Pairwise difference calculator</h2><span id='topic+pairwise_diff'></span>

<h3>Description</h3>

<p>A function to estimate the pairwise differences of estimates made for each category.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pairwise_diff(category_means_data, category_name)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pairwise_diff_+3A_category_means_data">category_means_data</code></td>
<td>
<p>Data frame containing two columns: the category-specific mean estimate (a column named <code>estimate</code>) and the category name (named as specified in <code>category_name</code>)</p>
</td></tr>
<tr><td><code id="pairwise_diff_+3A_category_name">category_name</code></td>
<td>
<p>The name of the column containing the category identifier.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with pairwise differences of <code>estimate</code> over pairs of categories.
</p>


<h3>References</h3>

<p>Lundberg I (2021). &quot;The gap-closing estimand: A causal approach to study interventions that close disparities across social categories.&quot; Sociological Methods and Research. Available at https://osf.io/gx4y3/.
</p>
<p>Friedman J, Hastie T, Tibshirani R (2010). &quot;Regularization Paths for Generalized Linear Models via Coordinate Descent.&quot; Journal of Statistical Software, 33(1), 1–22. https://www.jstatsoft.org/htaccess.php?volume=33&amp;type=i&amp;issue=01.
</p>
<p>Wood S (2017). Generalized Additive Models: An Introduction with R, 2 edition. Chapman and Hall/CRC.
</p>
<p>Wright MN, Ziegler A (2017). &quot;ranger: A Fast Implementation of Random Forests for High Dimensional Data in C++ and R.&quot; Journal of Statistical Software, 77(1), 1–17. doi: 10.18637/jss.v077.i01.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sim_data &lt;- data.frame(example_category = c("A","B","C"),
                       estimate = c(1,2,3))
pairwise_diff(sim_data, category_name = "example_category")
</code></pre>

<hr>
<h2 id='plot.gapclosing'>Plot function for gapclosing objects</h2><span id='topic+plot.gapclosing'></span>

<h3>Description</h3>

<p>Produces summary plots for a gapclosing object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'gapclosing'
plot(x, return_plots = FALSE, arranged = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.gapclosing_+3A_x">x</code></td>
<td>
<p>An object of class <code>gapclosing</code>, which results from a call to the function <code>gapclosing</code></p>
</td></tr>
<tr><td><code id="plot.gapclosing_+3A_return_plots">return_plots</code></td>
<td>
<p>Logical, defaults to FALSE. If TRUE, returns a list of the 4 plots without printing. Defaults to FALSE, in which case the console will interactively ask the user to hit &quot;return&quot; to proceed through printouts of the four plots, with no plots returned.</p>
</td></tr>
<tr><td><code id="plot.gapclosing_+3A_arranged">arranged</code></td>
<td>
<p>Logical, defaults to FALSE. If TRUE, returns a list of the 4 plots arranged in a 2x2 table. Useful to visualize all four in one screen.</p>
</td></tr>
<tr><td><code id="plot.gapclosing_+3A_...">...</code></td>
<td>
<p>Other arguments to <code>plot</code> commands</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If <code>return_plots = TRUE</code>, returns a list of <code>ggplot2</code> objects. If <code>return_plots = FALSE</code> (the default), then nothing is returned and output is printed.
</p>


<h3>References</h3>

<p>Lundberg I (2021). &quot;The gap-closing estimand: A causal approach to study interventions that close disparities across social categories.&quot; Sociological Methods and Research. Available at https://osf.io/gx4y3/.
</p>

<hr>
<h2 id='point_estimator'>Point estimator for gap-closing estimands</h2><span id='topic+point_estimator'></span>

<h3>Description</h3>

<p>This is an internal function typically called from other functions rather than by the user. It uses a learning sample to learn the nuisance functions (treatment and outcome model) and then an auxiliary estimation sample to use those functions in estimation of the gap-closing estimand. For single-sample estimation, both the learning and estimation samples are the same. For cross-fitting, this function is called repeatedly with the roles of each dataset swapped.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>point_estimator(
  data_learn,
  data_estimate,
  counterfactual_assignments,
  outcome_formula,
  treatment_formula,
  category_name,
  outcome_name,
  treatment_name,
  treatment_algorithm = "glm",
  outcome_algorithm = "lm",
  weight_name = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="point_estimator_+3A_data_learn">data_learn</code></td>
<td>
<p>Data frame in which treatment and outcome models will be learned</p>
</td></tr>
<tr><td><code id="point_estimator_+3A_data_estimate">data_estimate</code></td>
<td>
<p>Data frame in which the learned models will be converted to an estimate of the gap-closing estimand</p>
</td></tr>
<tr><td><code id="point_estimator_+3A_counterfactual_assignments">counterfactual_assignments</code></td>
<td>
<p>Numeric scalar or vector of length nrow(data), each element of which is on the [0,1] interval. If a scalar, the counterfactual probability by which all units are assigned to treatment condition 1. If a vector, each element i corresponds to the counterfactual probability by which each unit i is assigned to treatment condition 1.</p>
</td></tr>
<tr><td><code id="point_estimator_+3A_outcome_formula">outcome_formula</code></td>
<td>
<p>Model formula the outcome. Covariates should include those needed for causal identification of the treatment effect (e.g. as defended in your Directed Acyclic Graph). If <code>outcome_algorithm</code> = &quot;ranger&quot;, then the outcome model will be fit separately on the treatment and control groups. Otherwise, the user must specify all interactions in the formula.</p>
</td></tr>
<tr><td><code id="point_estimator_+3A_treatment_formula">treatment_formula</code></td>
<td>
<p>Treatment formula, in the style formula(treatment ~ covariates). Covariates should include those needed for causal identification of the treatment effect (e.g. as defended in your Directed Acyclic Graph).</p>
</td></tr>
<tr><td><code id="point_estimator_+3A_category_name">category_name</code></td>
<td>
<p>Character name of the variable indicating the categories over which the gap is defined. Must be the name of a column in <code>data</code>.</p>
</td></tr>
<tr><td><code id="point_estimator_+3A_outcome_name">outcome_name</code></td>
<td>
<p>Character name of the outcome variable. Only required when there is no outcome_formula; otherwise extracted automatically. Must be a name of a column in <code>data</code>.</p>
</td></tr>
<tr><td><code id="point_estimator_+3A_treatment_name">treatment_name</code></td>
<td>
<p>Character name of the treatment variable. Only required when there is no treatment_formula; otherwise extracted automatically. Must be a name of a column in <code>data</code>.</p>
</td></tr>
<tr><td><code id="point_estimator_+3A_treatment_algorithm">treatment_algorithm</code></td>
<td>
<p>Character name of the algorithm for the treatment model. One of &quot;glm&quot;, &quot;ridge&quot;, &quot;gam&quot;, or &quot;ranger&quot;. Defaults to &quot;glm&quot;, which is a logit model. Option &quot;ridge&quot; is ridge regression. Option &quot;gam&quot; is a generalized additive model fit (see package <code>mgcv</code>). Option &quot;ranger&quot; is a random forest (see package <code>ranger</code>). If &quot;ranger&quot;, this function avoids propensity scores equal to 0 or 1 by bottom- and top-coding predicted values at .001 and .999.</p>
</td></tr>
<tr><td><code id="point_estimator_+3A_outcome_algorithm">outcome_algorithm</code></td>
<td>
<p>Character name of the algorithm for the outcome model. One of &quot;lm&quot;, &quot;ridge&quot;, &quot;gam&quot;, or &quot;ranger&quot;. Defaults to &quot;lm&quot;, which is an OLS model. Option &quot;ridge&quot; is ridge regression. Option &quot;gam&quot; is a generalized additive model fit (see package <code>mgcv</code>). Option &quot;ranger&quot; is a random forest (see package <code>ranger</code>).</p>
</td></tr>
<tr><td><code id="point_estimator_+3A_weight_name">weight_name</code></td>
<td>
<p>Character name of a sampling weight variable, if any, which captures the inverse probability of inclusion in the sample. The default assumes a simple random sample (all weights equal).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>@return A list with four elements.
</p>

<p><code>counterfactual_means</code> A tibble with a counterfactual mean estimate for each category
<code>counterfactual_means</code> A tibble with a counterfactual disparity estimate for each pair of categories
<code>treatment_model</code> Object containing the fitted treatment model
<code>outcome_model</code> Object containing the fitted outcome model

</p>


<h3>References</h3>

<p>Lundberg I (2021). &quot;The gap-closing estimand: A causal approach to study interventions that close disparities across social categories.&quot; Sociological Methods and Research. Available at https://osf.io/gx4y3/.
</p>

<hr>
<h2 id='print.gapclosing'>Print function for gapclosing objects</h2><span id='topic+print.gapclosing'></span>

<h3>Description</h3>

<p>Prints the same output as generated by <code>summary</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'gapclosing'
print(
  x,
  ...,
  digits = 2,
  quote = FALSE,
  right = FALSE,
  row.names = FALSE,
  max = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.gapclosing_+3A_x">x</code></td>
<td>
<p>An object of class <code>gapclosing</code>, which results from a call to the function <code>gapclosing</code></p>
</td></tr>
<tr><td><code id="print.gapclosing_+3A_...">...</code></td>
<td>
<p>Other arguments to <code>print</code> commands</p>
</td></tr>
<tr><td><code id="print.gapclosing_+3A_digits">digits</code></td>
<td>
<p>Argument passed to print.data.frame</p>
</td></tr>
<tr><td><code id="print.gapclosing_+3A_quote">quote</code></td>
<td>
<p>Argument passed to print.data.frame</p>
</td></tr>
<tr><td><code id="print.gapclosing_+3A_right">right</code></td>
<td>
<p>Argument passed to print.data.frame</p>
</td></tr>
<tr><td><code id="print.gapclosing_+3A_row.names">row.names</code></td>
<td>
<p>Argument passed to print.data.frame</p>
</td></tr>
<tr><td><code id="print.gapclosing_+3A_max">max</code></td>
<td>
<p>Argument passed to print.data.frame</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Prints a summary of the estimates.
</p>


<h3>References</h3>

<p>Lundberg I (2021). &quot;The gap-closing estimand: A causal approach to study interventions that close disparities across social categories.&quot; Sociological Methods and Research. Available at https://osf.io/gx4y3/.
</p>

<hr>
<h2 id='summary.gapclosing'>Summary function for gapclosing objects</h2><span id='topic+summary.gapclosing'></span>

<h3>Description</h3>

<p>Summarizes the S3 class object returned by the gapclosing function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'gapclosing'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.gapclosing_+3A_object">object</code></td>
<td>
<p>An object of class <code>gapclosing</code>, which results from a call to the function <code>gapclosing</code></p>
</td></tr>
<tr><td><code id="summary.gapclosing_+3A_...">...</code></td>
<td>
<p>Other arguments to <code>summary</code> commands</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Prints a summary of the estimates.
</p>


<h3>References</h3>

<p>Lundberg I (2021). &quot;The gap-closing estimand: A causal approach to study interventions that close disparities across social categories.&quot; Sociological Methods and Research. Available at https://osf.io/gx4y3/.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
