<!DOCTYPE html><html><head><title>Help for package apyramid</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {apyramid}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#age_pyramid'><p>Plot a population pyramid (age-sex) from a dataframe.</p></a></li>
<li><a href='#us_2018'><p>US Census data for population, age, and gender</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Visualize Population Pyramids Aggregated by Age</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.3</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides a quick method for visualizing non-aggregated line-list
    or aggregated census data stratified by age and one or two categorical
    variables (e.g. gender and health status) with any number of values. It
    returns a 'ggplot' object, allowing the user to further customize the
    output. This package is part of the 'R4Epis' project 
    <a href="https://r4epis.netlify.app/">https://r4epis.netlify.app/</a>.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.2.0)</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/R4EPI/apyramid">https://github.com/R4EPI/apyramid</a>, <a href="https://r4epis.netlify.app/">https://r4epis.netlify.app/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/R4EPI/apyramid/issues">https://github.com/R4EPI/apyramid/issues</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>ggplot2 (&ge; 3.0.0), tidyselect, rlang, forcats (&ge; 1.0.0),
dplyr, scales, glue</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 2.1.0), survey, srvyr, vdiffr, covr, outbreaks,
knitr, rmarkdown</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-02-14 17:09:42 UTC; zhian</td>
</tr>
<tr>
<td>Author:</td>
<td>Zhian N. Kamvar <a href="https://orcid.org/0000-0003-1458-7108"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Alex Spina [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Zhian N. Kamvar &lt;zkamvar@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-02-14 17:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='age_pyramid'>Plot a population pyramid (age-sex) from a dataframe.</h2><span id='topic+age_pyramid'></span>

<h3>Description</h3>

<p>Plot a population pyramid (age-sex) from a dataframe.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>age_pyramid(
  data,
  age_group = "age_group",
  split_by = "sex",
  stack_by = NULL,
  count = NULL,
  proportional = FALSE,
  na.rm = TRUE,
  show_midpoint = TRUE,
  vertical_lines = FALSE,
  horizontal_lines = TRUE,
  pyramid = TRUE,
  pal = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="age_pyramid_+3A_data">data</code></td>
<td>
<p>Your dataframe (e.g. linelist)</p>
</td></tr>
<tr><td><code id="age_pyramid_+3A_age_group">age_group</code></td>
<td>
<p>the name of a column in the data frame that defines the age
group categories. Defaults to &quot;age_group&quot;</p>
</td></tr>
<tr><td><code id="age_pyramid_+3A_split_by">split_by</code></td>
<td>
<p>the name of a column in the data frame that defines the
the bivariate column. Defaults to &quot;sex&quot;. See NOTE</p>
</td></tr>
<tr><td><code id="age_pyramid_+3A_stack_by">stack_by</code></td>
<td>
<p>the name of the column in the data frame to use for shading
the bars. Defaults to <code>NULL</code> which will shade the bars by the <code>split_by</code>
variable.</p>
</td></tr>
<tr><td><code id="age_pyramid_+3A_count">count</code></td>
<td>
<p><strong>for pre-computed data</strong> the name of the column in the data
frame for the values of the bars. If this represents proportions, the
values should be within [0, 1].</p>
</td></tr>
<tr><td><code id="age_pyramid_+3A_proportional">proportional</code></td>
<td>
<p>If <code>TRUE</code>, bars will represent proportions of cases out
of the entire population. Otherwise (<code>FALSE</code>, default), bars represent
case counts</p>
</td></tr>
<tr><td><code id="age_pyramid_+3A_na.rm">na.rm</code></td>
<td>
<p>If <code>TRUE</code>, this removes NA counts from the age groups. Defaults
to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="age_pyramid_+3A_show_midpoint">show_midpoint</code></td>
<td>
<p>When <code>TRUE</code> (default), a dashed vertical line will be
added to each of the age bars showing the halfway point for the
un-stratified age group. When <code>FALSE</code>, no halfway point is marked.</p>
</td></tr>
<tr><td><code id="age_pyramid_+3A_vertical_lines">vertical_lines</code></td>
<td>
<p>If you would like to add dashed vertical lines to help
visual interpretation of numbers. Default is to not show (<code>FALSE</code>),
to turn on write <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="age_pyramid_+3A_horizontal_lines">horizontal_lines</code></td>
<td>
<p>If <code>TRUE</code> (default), horizontal dashed lines will
appear behind the bars of the pyramid</p>
</td></tr>
<tr><td><code id="age_pyramid_+3A_pyramid">pyramid</code></td>
<td>
<p>if <code>TRUE</code>, then binary <code>split_by</code> variables will result in
a population pyramid (non-binary variables cannot form a pyramid). If
<code>FALSE</code>, a pyramid will not form.</p>
</td></tr>
<tr><td><code id="age_pyramid_+3A_pal">pal</code></td>
<td>
<p>a color palette function or vector of colors to be passed to
<code><a href="ggplot2.html#topic+scale_manual">ggplot2::scale_fill_manual()</a></code> defaults to the first &quot;qual&quot; palette from
<code><a href="ggplot2.html#topic+scale_brewer">ggplot2::scale_fill_brewer()</a></code>.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>If the <code>split_by</code> variable is bivariate (e.g. an indicator for a
specific symptom), then the result will show up as a pyramid, otherwise, it
will be presented as a facetted barplot with with empty bars in the
background indicating the range of the un-facetted data set. Values of
<code>split_by</code> will show up as labels at top of each facet.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(ggplot2)
old &lt;- theme_set(theme_classic(base_size = 18))

# with pre-computed data ----------------------------------------------------
# 2018/2008 US census data by age and gender
data(us_2018)
data(us_2008)
age_pyramid(us_2018, age_group = age, split_by = gender, count = count)
age_pyramid(us_2008, age_group = age, split_by = gender, count = count)

# 2018 US census data by age, gender, and insurance status
data(us_ins_2018)
age_pyramid(us_ins_2018, 
  age_group = age,
  split_by = gender,
  stack_by = insured,
  count = count
)
us_ins_2018$prop &lt;- us_ins_2018$percent/100
age_pyramid(us_ins_2018,
  age_group = age,
  split_by = gender,
  stack_by = insured,
  count = prop,
  proportion = TRUE
)

# from linelist data --------------------------------------------------------
set.seed(2018 - 01 - 15)
ages &lt;- cut(sample(80, 150, replace = TRUE),
  breaks = c(0, 5, 10, 30, 90), right = FALSE
)
sex &lt;- sample(c("Female", "Male"), 150, replace = TRUE)
gender &lt;- sex
gender[sample(5)] &lt;- "NB"
ill &lt;- sample(c("case", "non-case"), 150, replace = TRUE)
dat &lt;- data.frame(
  AGE = ages,
  sex = factor(sex, c("Male", "Female")),
  gender = factor(gender, c("Male", "NB", "Female")),
  ill = ill,
  stringsAsFactors = FALSE
)

# Create the age pyramid, stratifying by sex
print(ap &lt;- age_pyramid(dat, age_group = AGE))

# Create the age pyramid, stratifying by gender, which can include non-binary
print(apg &lt;- age_pyramid(dat, age_group = AGE, split_by = gender))

# Remove NA categories with na.rm = TRUE
dat2 &lt;- dat
dat2[1, 1] &lt;- NA
dat2[2, 2] &lt;- NA
dat2[3, 3] &lt;- NA
print(ap &lt;- age_pyramid(dat2, age_group = AGE))
print(ap &lt;- age_pyramid(dat2, age_group = AGE, na.rm = TRUE))

# Stratify by case definition and customize with ggplot2
ap &lt;- age_pyramid(dat, age_group = AGE, split_by = ill) +
  theme_bw(base_size = 16) +
  labs(title = "Age groups by case definition")
print(ap)

# Stratify by multiple factors
ap &lt;- age_pyramid(dat,
  age_group = AGE,
  split_by = sex,
  stack_by = ill,
  vertical_lines = TRUE
) +
  labs(title = "Age groups by case definition and sex")
print(ap)

# Display proportions
ap &lt;- age_pyramid(dat,
  age_group = AGE,
  split_by = sex,
  stack_by = ill,
  proportional = TRUE,
  vertical_lines = TRUE
) +
  labs(title = "Age groups by case definition and sex")
print(ap)

# empty group levels will still be displayed
dat3 &lt;- dat2
dat3[dat$AGE == "[0,5)", "sex"] &lt;- NA
age_pyramid(dat3, age_group = AGE)
theme_set(old)
</code></pre>

<hr>
<h2 id='us_2018'>US Census data for population, age, and gender</h2><span id='topic+us_2018'></span><span id='topic+us_2008'></span><span id='topic+us_ins_2018'></span><span id='topic+us_ins_2008'></span><span id='topic+us_gen_2018'></span><span id='topic+us_gen_2008'></span>

<h3>Description</h3>

<p>All of these tables were read directly from the excel sources via custom
script located at <a href="https://github.com/R4EPI/apyramid/blob/master/scripts/read-us-pyramid.R">https://github.com/R4EPI/apyramid/blob/master/scripts/read-us-pyramid.R</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>us_2018

us_2008

us_ins_2018

us_ins_2008

us_gen_2018

us_gen_2008
</code></pre>


<h3>Format</h3>

<p>All tables are in long <a href="dplyr.html#topic+reexports">tibble</a> format. There are three
columns common to all of the tables:
</p>

<ul>
<li> <p><strong>age</strong> [factor] 18 ordered age groups in increments of five years from
&quot;&lt;5&quot; to  &quot;85+&quot;
</p>
</li>
<li> <p><strong>gender</strong> [factor] 2 reported genders (male, female).
</p>
</li>
<li> <p><strong>count</strong> [integer] Numbers in thousands. Civilian noninstitutionalized
and military population.
</p>
</li></ul>

<p>Below are specifics of each table beyond the stated three columns with names
as reported on the US census website
</p>


<h4>Population by Age and Sex (<code>us_2018</code>, <code>us_2008</code>)</h4>

<p>A tibble with 36 rows and 4 columns.
(<code>us_2018</code> source: <a href="https://www2.census.gov/programs-surveys/demo/tables/age-and-sex/2018/age-sex-composition/2018gender_table1.xls">https://www2.census.gov/programs-surveys/demo/tables/age-and-sex/2018/age-sex-composition/2018gender_table1.xls</a>)
(<code>us_2008</code> source: <a href="https://www2.census.gov/programs-surveys/demo/tables/age-and-sex/2008/age-sex-composition/2008gender_table1.xls">https://www2.census.gov/programs-surveys/demo/tables/age-and-sex/2008/age-sex-composition/2008gender_table1.xls</a>)
</p>
<p>Additional columns:
</p>

<ul>
<li> <p><strong>percent</strong> [numeric] percent of the total US population rounded to the nearest 0.1%
</p>
</li></ul>




<h4>Health Insurance by Sex and Age (<code>us_ins_2018</code>, <code>us_ins_2008</code>)</h4>

<p>A tibble with 72 rows and 5 columns.
(<code>us_ins_2018</code> source: <a href="https://www2.census.gov/programs-surveys/demo/tables/age-and-sex/2018/age-sex-composition/2018gender_table14.xls">https://www2.census.gov/programs-surveys/demo/tables/age-and-sex/2018/age-sex-composition/2018gender_table14.xls</a>)
(<code>us_ins_2008</code> source: <a href="https://www2.census.gov/programs-surveys/demo/tables/age-and-sex/2008/age-sex-composition/2008gender_table29.xls">https://www2.census.gov/programs-surveys/demo/tables/age-and-sex/2008/age-sex-composition/2008gender_table29.xls</a>)
</p>
<p>Additional columns:
</p>

<ul>
<li> <p><strong>insured</strong> [factor] Either &quot;Insured&quot; or &quot;Not insured&quot; indicating insured status
</p>
</li>
<li> <p><strong>percent</strong> [numeric] percent of each age and gender category insured rounded to the nearest 0.1%
</p>
</li></ul>




<h4>Generational Distribution of the Population by Sex and Age (<code>us_gen_2018</code>, <code>us_gen_2008</code>)</h4>

<p>A tibble with 108 rows and 5 columns.
(<code>us_gen_2018</code> source: <a href="https://www2.census.gov/programs-surveys/demo/tables/age-and-sex/2018/age-sex-composition/2018gender_table13.xls">https://www2.census.gov/programs-surveys/demo/tables/age-and-sex/2018/age-sex-composition/2018gender_table13.xls</a>)
(<code>us_gen_2008</code> source: <a href="https://www2.census.gov/programs-surveys/demo/tables/age-and-sex/2008/age-sex-composition/2008gender_table29.xls">https://www2.census.gov/programs-surveys/demo/tables/age-and-sex/2008/age-sex-composition/2008gender_table29.xls</a>)
</p>
<p>Additional columns:
</p>

<ul>
<li> <p><strong>generation</strong> [factor] Three categories of generations in the US:
First, Second, Third and higher (see note)
</p>
</li>
<li> <p><strong>percent</strong> [numeric] percent of the total US population rounded to the nearest 0.1%
</p>
</li></ul>

<p>Note: from the US Census Bureau: The foreign born are considered first
generation.  Natives with at least one foreign-born parent are considered
second generation.  Natives with two native parents are considered
third-and-higher generation.
</p>

<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 36 rows and 4 columns.
</p>
<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 72 rows and 5 columns.
</p>
<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 72 rows and 5 columns.
</p>
<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 108 rows and 5 columns.
</p>
<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 108 rows and 5 columns.
</p>


<h3>Source</h3>

<p><a href="https://census.gov/data/tables/2018/demo/age-and-sex/2018-age-sex-composition.html">https://census.gov/data/tables/2018/demo/age-and-sex/2018-age-sex-composition.html</a>
<a href="https://census.gov/data/tables/2008/demo/age-and-sex/2008-age-sex-composition.html">https://census.gov/data/tables/2008/demo/age-and-sex/2008-age-sex-composition.html</a>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
