<!DOCTYPE html><html lang="en"><head><title>Help for package photon</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {photon}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#photon-package'><p>photon: High-Performance Geocoding using 'photon'</p></a></li>
<li><a href='#cmd_options'><p>Format command line options</p></a></li>
<li><a href='#download_photon'><p>Download photon</p></a></li>
<li><a href='#download_searchindex'><p>Download search index</p></a></li>
<li><a href='#geocode'><p>Unstructured geocoding</p></a></li>
<li><a href='#get_instance'><p>Photon utilities</p></a></li>
<li><a href='#has_java'><p>Is Java installed?</p></a></li>
<li><a href='#latinize'><p>Latinization</p></a></li>
<li><a href='#new_photon'><p>Initialize a photon instance</p></a></li>
<li><a href='#photon_local'><p>Local photon instance</p></a></li>
<li><a href='#purge_java'><p>Purge Java processes</p></a></li>
<li><a href='#reexports'><p>Objects exported from other packages</p></a></li>
<li><a href='#reverse'><p>Reverse geocoding</p></a></li>
<li><a href='#structured'><p>Structured geocoding</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>High-Performance Geocoding using 'photon'</td>
</tr>
<tr>
<td>Version:</td>
<td>0.3.5</td>
</tr>
<tr>
<td>Description:</td>
<td>Features unstructured, structured and reverse geocoding using the
    'photon' geocoding API <a href="https://photon.komoot.io/">https://photon.komoot.io/</a>.
    Facilitates the setup of local 'photon' instances to enable offline
    geocoding.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License (&ge; 2)</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/jslth/photon/">https://github.com/jslth/photon/</a>, <a href="https://jslth.github.io/photon/">https://jslth.github.io/photon/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/jslth/photon/issues">https://github.com/jslth/photon/issues</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Imports:</td>
<td>utils, cli, countrycode, httr2, R6, sf, processx</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 3.0.0), tibble, knitr, rmarkdown, webfakes, ps</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-02-23 11:57:49 UTC; PC</td>
</tr>
<tr>
<td>Author:</td>
<td>Jonas Lieth <a href="https://orcid.org/0000-0002-3451-3176"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cre, cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jonas Lieth &lt;jonas.lieth@gesis.org&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-02-24 13:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='photon-package'>photon: High-Performance Geocoding using 'photon'</h2><span id='topic+photon'></span><span id='topic+photon-package'></span>

<h3>Description</h3>

<p>Features unstructured, structured and reverse geocoding using the 'photon' geocoding API <a href="https://photon.komoot.io/">https://photon.komoot.io/</a>. Facilitates the setup of local 'photon' instances to enable offline geocoding.
</p>


<h3>Terms of use</h3>

<p>From <a href="https://photon.komoot.io">https://photon.komoot.io</a> on using the public API:
</p>
<p><em>&quot;You can use the API for your project, but please be fair - extensive usage
will be throttled. We do not guarantee for the availability and usage might
be subject of change in the future.&quot;</em>
</p>
<p>Note that these terms only apply to the public API
(<code><a href="#topic+new_photon">new_photon()</a></code>), and not to local instances
(e.g. <code><a href="#topic+new_photon">new_photon(path = &quot;.&quot;)</a></code>)! For the public
API, the package sets a default of 1 request per second (see below).
</p>


<h3>Global options</h3>

<p>A number of global options can be set that change the behavior of package
functions. These include:
</p>

<dl>
<dt><code>photon_throttle</code></dt><dd><p>Rate limit used to throttle requests.
By default, no throttle is set for non-komoot instances. For komoot's
public API, this option defaults to 1 request per second. See
<code><a href="httr2.html#topic+req_throttle">req_throttle</a></code>.</p>
</dd>
<dt><code>photon_max_tries</code></dt><dd><p>Number of retries a failing request should
do before ultimately aborting. Defaults to 3. See
<code><a href="httr2.html#topic+req_retry">req_retry</a></code>.</p>
</dd>
<dt><code>photon_debug</code></dt><dd><p>Whether to echo the command of external
processes and GET requests sent to photon. Defaults to <code>FALSE</code>.</p>
</dd>
<dt><code>photon_movers</code></dt><dd><p>Whether moving verbosity is allowed. If
<code>FALSE</code>, disables progress bars and spinners globally. Overwritten
by local parameters. Defaults to <code>TRUE</code>. This option is useful for
non-interactive sessions like RMarkdown.</p>
</dd>
<dt><code>photon_setup_warn</code></dt><dd><p>Whether to convert warnings in the photon
logs to R warnings. Many warnings in the log are somewhat useless, but
some can be important. Defaults to <code>TRUE</code>.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Jonas Lieth <a href="mailto:jonas.lieth@gesis.org">jonas.lieth@gesis.org</a> (<a href="https://orcid.org/0000-0002-3451-3176">ORCID</a>) [copyright holder]
</p>


<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/jslth/photon/">https://github.com/jslth/photon/</a>
</p>
</li>
<li> <p><a href="https://jslth.github.io/photon/">https://jslth.github.io/photon/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/jslth/photon/issues">https://github.com/jslth/photon/issues</a>
</p>
</li></ul>


<hr>
<h2 id='cmd_options'>Format command line options</h2><span id='topic+cmd_options'></span>

<h3>Description</h3>

<p>Helper function to format options for command line calls. The function
accepts key-value pairs where the parameter name is the name of the option
and the parameter value is the value of the option.
Arguments are formatted according to the following rules:
</p>

<ul>
<li><p>If a value is <code>TRUE</code>, add parameter name as flag.
</p>
</li>
<li><p>If a value is <code>FALSE</code>, do not add parameter name as flag.
</p>
</li>
<li><p>If a value has <code>length(x) &gt; 1</code>, collapse it as a CSV.
</p>
</li>
<li><p>If a parameter name is missing, take the value as the flag name.
</p>
</li>
<li><p>If a parameter name is given, replace underscores with hyphens.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>cmd_options(..., use_double_hyphens = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cmd_options_+3A_...">...</code></td>
<td>
<p>Key-value pairs of command line options.</p>
</td></tr>
<tr><td><code id="cmd_options_+3A_use_double_hyphens">use_double_hyphens</code></td>
<td>
<p>If <code>TRUE</code>, uses double hyphens to designate
non-abbreviated command line options and single-hyphens to designate
abbreviated ones. If <code>FALSE</code>, always uses single hyphens. Defaults
to <code>FALSE</code> as both Java and photon use single hyphens.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A character vector of formatted command line options that can
be used as input to <code><a href="base.html#topic+system2">system2</a></code> or <code><a href="processx.html#topic+run">run</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># converts R parameters to CMD options
# parameters for the ping command
cmd_options(n = 1, w = 5, "127.0.0.1")

# sometimes, it is necessary to use double hyphens
# options for the docker ps command
cmd_options("ps", all = TRUE, format = "json", use_double_hyphens = TRUE)

# particularly useful together with photon
# the following options can be used for the `photon_opts` argument
# of photon$start()
cmd_options(cors_any = TRUE, data_dir = "path/to/dir")
</code></pre>

<hr>
<h2 id='download_photon'>Download photon</h2><span id='topic+download_photon'></span>

<h3>Description</h3>

<p>Download the photon executable from GitHub.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>download_photon(
  path = ".",
  version = NULL,
  opensearch = FALSE,
  only_url = FALSE,
  quiet = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="download_photon_+3A_path">path</code></td>
<td>
<p>Path to a directory to store the executable.</p>
</td></tr>
<tr><td><code id="download_photon_+3A_version">version</code></td>
<td>
<p>Version tag of the photon release. If <code>NULL</code>,
downloads the latest known version. A list of all
releases can be found here: <a href="https://github.com/komoot/photon/releases/">https://github.com/komoot/photon/releases/</a>.
Ignored if <code>jar</code> is given. If <code>NULL</code>, uses the latest known
version (Currently: 0.6.2).</p>
</td></tr>
<tr><td><code id="download_photon_+3A_opensearch">opensearch</code></td>
<td>
<p>If <code>TRUE</code>, downloads the OpenSearch version of
photon if available. OpenSearch versions are available for photon &gt;= 0.6.0.</p>
</td></tr>
<tr><td><code id="download_photon_+3A_only_url">only_url</code></td>
<td>
<p>If <code>TRUE</code>, performs a download. Otherwise,
only returns a link to the file.</p>
</td></tr>
<tr><td><code id="download_photon_+3A_quiet">quiet</code></td>
<td>
<p>If <code>TRUE</code>, suppresses all informative messages.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If <code>only_url = FALSE</code>, returns a character string giving the
path to the downloaded file. Otherwise, returns the URL to be downloaded.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>download_photon(tempdir(), version = "0.4.1")
</code></pre>

<hr>
<h2 id='download_searchindex'>Download search index</h2><span id='topic+download_searchindex'></span>

<h3>Description</h3>

<p>Finds and downloads the Elasticsearch index database necessary to set up
Photon locally.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>download_searchindex(
  path = ".",
  country = "Monaco",
  date = "latest",
  exact = FALSE,
  section = NULL,
  only_url = FALSE,
  quiet = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="download_searchindex_+3A_path">path</code></td>
<td>
<p>Path to a directory where the identified file should be stored.</p>
</td></tr>
<tr><td><code id="download_searchindex_+3A_country">country</code></td>
<td>
<p>Character string that can be identified by
<code><a href="countrycode.html#topic+countryname">countryname</a></code> as a country. An extract for this
country will be downloaded. If <code>"planet"</code>, downloads a global search
index.</p>
</td></tr>
<tr><td><code id="download_searchindex_+3A_date">date</code></td>
<td>
<p>Character string or date-time object used to specify the creation
date of the search index. If <code>"latest"</code>, will download the file tagged
with &quot;latest&quot;. If a character string, the value should be parseable by
<code><a href="base.html#topic+as.POSIXct">as.POSIXct</a></code>. If <code>exact = FALSE</code>, the input value is
compared to all available dates and the closest date will be selected.
Otherwise, a file will be selected that exactly matches the input to
<code>date</code>.</p>
</td></tr>
<tr><td><code id="download_searchindex_+3A_exact">exact</code></td>
<td>
<p>If <code>TRUE</code>, exactly matches the <code>date</code>. Otherwise,
selects the date with lowest difference to the <code>date</code> parameter.</p>
</td></tr>
<tr><td><code id="download_searchindex_+3A_section">section</code></td>
<td>
<p>Subdirectory of the download server from which to select a
search index. If <code>"experimental"</code>, selects a dump made for the master
version of photon. If <code>"archived"</code>, selects a dump made for an older
version of photon. If <code>NULL</code> (or any arbitrary string), selects a
dump made for the current release. Defaults to <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="download_searchindex_+3A_only_url">only_url</code></td>
<td>
<p>If <code>TRUE</code>, performs a download. Otherwise,
only returns a link to the file.</p>
</td></tr>
<tr><td><code id="download_searchindex_+3A_quiet">quiet</code></td>
<td>
<p>If <code>TRUE</code>, suppresses all informative messages.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If <code>only_url = FALSE</code>, returns the local path to the downloaded
file. Otherwise, returns the URL to the remote file.
</p>


<h3>Note</h3>

<p>Depending on the country, search index databases tend to be very large.
The global search index is about 75 GB of size (10/2024). Keep that in mind
when running this function.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># download the latest extract of Monaco
download_searchindex(path = tempdir())

# download the latest extract of American Samoa
download_searchindex(path = tempdir(), country = "Samoa")

# download an extract from a month ago
download_searchindex(
  path = tempdir(),
  country = "Monaco",
  date = Sys.time() - 2629800
 )

# if possible, download an extract from today
try(download_searchindex(
  path = tempdir(),
  country = "Monaco",
  date = Sys.Date(),
  exact = TRUE
))

# get the latest global coverage
# NOTE: the file to be downloaded is several tens of gigabytes of size!
## Not run: 
download_searchindex(path = tempdir(), country = "planet")
## End(Not run)
</code></pre>

<hr>
<h2 id='geocode'>Unstructured geocoding</h2><span id='topic+geocode'></span>

<h3>Description</h3>

<p>Geocode arbitrary text strings. Unstructured geocoding is more flexible but
generally less accurate than <a href="#topic+structured">structured geocoding</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>geocode(
  texts,
  limit = 1,
  lang = "en",
  bbox = NULL,
  osm_tag = NULL,
  layer = NULL,
  locbias = NULL,
  locbias_scale = NULL,
  zoom = NULL,
  latinize = TRUE,
  progress = interactive()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="geocode_+3A_texts">texts</code></td>
<td>
<p>Character vector of a texts to geocode.</p>
</td></tr>
<tr><td><code id="geocode_+3A_limit">limit</code></td>
<td>
<p>Number of results to return. A maximum of 50 results can be
returned for a single search term. Defaults to 1. When more than a single
text is provided but limit is greater than 1, the results can be uniquely
linked to the input texts using the <code>idx</code> column in the output.</p>
</td></tr>
<tr><td><code id="geocode_+3A_lang">lang</code></td>
<td>
<p>Language of the results. If <code>"default"</code>, returns the results
in local language.</p>
</td></tr>
<tr><td><code id="geocode_+3A_bbox">bbox</code></td>
<td>
<p>Any object that can be parsed by <code><a href="sf.html#topic+st_bbox">st_bbox</a></code>.
Results must lie within this bbox.</p>
</td></tr>
<tr><td><code id="geocode_+3A_osm_tag">osm_tag</code></td>
<td>
<p>Character string giving an
<a href="https://wiki.openstreetmap.org/wiki/Tags">OSM tag</a> to filter the
results by. See details.</p>
</td></tr>
<tr><td><code id="geocode_+3A_layer">layer</code></td>
<td>
<p>Character string giving a layer to filter the results by.
Can be one of <code>"house"</code>, <code>"street"</code>, <code>"locality"</code>,
<code>"district"</code>, <code>"city"</code>, <code>"county"</code>, <code>"state"</code>,
<code>"country"</code>, or <code>"other"</code>.</p>
</td></tr>
<tr><td><code id="geocode_+3A_locbias">locbias</code></td>
<td>
<p>Numeric vector of length 2 or any object that can be coerced
to a length-2 numeric vector (e.g. a list or <code>sfg</code> object). Specifies a
location bias for geocoding in the format <code>c(lon, lat)</code>. Geocoding
results are biased towards this point. The radius of the bias is controlled
through <code>zoom</code> and the weight of place prominence through
<code>location_bias_scale</code>.</p>
</td></tr>
<tr><td><code id="geocode_+3A_locbias_scale">locbias_scale</code></td>
<td>
<p>Numeric vector specifying the importance of prominence
in <code>locbias</code>. A higher prominence scale gives more weight to important
places. Possible values range from 0 to 1. Defaults to 0.2.</p>
</td></tr>
<tr><td><code id="geocode_+3A_zoom">zoom</code></td>
<td>
<p>Numeric specifying the radius for which the <code>locbias</code> is
effective. Corresponds to the zoom level in OpenStreetMap. The exact relation
to <code>locbias</code> is <code class="reqn">0.25\text{ km} \cdot 2^{(18 - \text{zoom})}</code>.
Defaults to 16.</p>
</td></tr>
<tr><td><code id="geocode_+3A_latinize">latinize</code></td>
<td>
<p>If <code>TRUE</code> sanitizes search terms in <code>texts</code> by
converting their encoding to <code>"latin1"</code> using <code><a href="#topic+latinize">latinize</a></code>.
This can be helpful if the search terms contain certain symbols (e.g. fancy
quotes) that photon cannot handle properly. Defaults to <code>TRUE</code> as
<code>latinize</code> is very conservative and should usually not cause any
problems.</p>
</td></tr>
<tr><td><code id="geocode_+3A_progress">progress</code></td>
<td>
<p>If <code>TRUE</code>, shows a progress bar for longer queries.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Filtering by OpenStreetMap tags follows a distinct syntax explained on
<a href="https://github.com/komoot/photon">https://github.com/komoot/photon</a>. In particular:
</p>

<ul>
<li><p>Include places with tag: <code>key:value</code>
</p>
</li>
<li><p>Exclude places with tag: <code>!key:value</code>
</p>
</li>
<li><p>Include places with tag key: <code>key</code>
</p>
</li>
<li><p>Include places with tag value: <code>:value</code>
</p>
</li>
<li><p>Exclude places with tag key: <code>!key</code>
</p>
</li>
<li><p>Exclude places with tag value: <code>:!value</code>
</p>
</li></ul>



<h3>Value</h3>

<p>An sf dataframe or tibble containing the following columns:
</p>

<ul>
<li><p><code>idx</code>: Internal ID specifying the index of the <code>texts</code>
parameter.
</p>
</li>
<li><p><code>osm_type</code>: Type of OSM element, one of N (node), W (way),
R (relation), or P (polygon).
</p>
</li>
<li><p><code>osm_id</code>: OpenStreetMap ID of the matched element.
</p>
</li>
<li><p><code>country</code>: Country of the matched place.
</p>
</li>
<li><p><code>city</code>: City of the matched place.
</p>
</li>
<li><p><code>osm_key</code>: OpenStreetMap key.
</p>
</li>
<li><p><code>countrycode</code>: ISO2 country code.
</p>
</li>
<li><p><code>housenumber</code>: House number, if applicable.
</p>
</li>
<li><p><code>postcode</code>: Post code, if applicable.
</p>
</li>
<li><p><code>locality</code>: Locality, if applicable.
</p>
</li>
<li><p><code>street</code>: Street, if applicable.
</p>
</li>
<li><p><code>district</code>: District name, if applicable.
</p>
</li>
<li><p><code>osm_value</code>: OpenStreetMap tag value.
</p>
</li>
<li><p><code>name</code>: Place name.
</p>
</li>
<li><p><code>type</code>: Layer type as described for the <code>layer</code> parameter.
</p>
</li>
<li><p><code>extent</code>: Boundary box of the match.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># an instance must be mounted first
photon &lt;- new_photon()

# geocode a city
geocode("Berlin")

# return more results
geocode("Berlin", limit = 10)

# return the results in german
geocode("Berlin", limit = 10, lang = "de")

# limit to cities
geocode("Berlin", layer = "city")

# limit to European cities
geocode("Berlin", bbox = c(xmin = -71.18, ymin = 44.46, xmax = 13.39, ymax = 52.52))

# search for museums in berlin
geocode("Berlin", osm_tag = "tourism:museum")

# search for touristic attractions in berlin
geocode("Berlin", osm_tag = "tourism")

# search for anything but tourism
geocode("Berlin", osm_tag = "!tourism")

# use location biases to match Berlin, IL instead of Berlin, DE
geocode("Berlin", locbias = c(-100, 40), locbias_scale = 0.1, zoom = 7, osm_tag = "place")

# latinization can help normalize search terms
geocode("Luatuanu\u2019u", latinize = FALSE) # fails
geocode("Luatuanu\u2019u", latinize = TRUE)  # works
</code></pre>

<hr>
<h2 id='get_instance'>Photon utilities</h2><span id='topic+get_instance'></span><span id='topic+get_photon_url'></span>

<h3>Description</h3>

<p>Utilities to manage photon instances. These functions operate on mounted
photon instances which can be initialized using <code><a href="#topic+new_photon">new_photon</a></code>.
</p>

<ul>
<li><p><code>get_instance()</code> retrieves the active photon instance.
</p>
</li>
<li><p><code>get_photon_url()</code> retrieves the photon URL to send requests.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>get_instance()

get_photon_url()
</code></pre>


<h3>Value</h3>

<p><code>get_instance</code> returns a R6 object of class <code>photon</code>.
<code>get_photon_url()</code> returns a URL string.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># make a new photon instance
new_photon()

# retrieve it from the cache
get_instance()

# get the server url
get_photon_url()
</code></pre>

<hr>
<h2 id='has_java'>Is Java installed?</h2><span id='topic+has_java'></span>

<h3>Description</h3>

<p>Utility function to check if Java is installed and if it has the right
version.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>has_java(version = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="has_java_+3A_version">version</code></td>
<td>
<p>Character string specifying the minimum version of Java.
If the installed Java version is lower than this, returns <code>FALSE</code>.
If <code>NULL</code>, only checks if any kind of Java is installed on the
system.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A logical vector of length 1.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>has_java() # Is Java installed?
has_java("11") # Is Java &gt; 11 installed?
</code></pre>

<hr>
<h2 id='latinize'>Latinization</h2><span id='topic+latinize'></span>

<h3>Description</h3>

<p>Helper tool to transliterate various encodings to latin. Attempts to
convert a character vector from its current encoding to <code>"latin1"</code> and -
if it fails - defaults back to the original term. This can be useful
for <code><a href="#topic+geocode">geocode</a></code> and <code><a href="#topic+structured">structured</a></code> when attempting to
geocode terms containing symbols that photon does not support.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>latinize(x, encoding = "latin1")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="latinize_+3A_x">x</code></td>
<td>
<p>A character vector.</p>
</td></tr>
<tr><td><code id="latinize_+3A_encoding">encoding</code></td>
<td>
<p>Encoding that the strings in <code>x</code> should be
converted to. If the conversion fails, defaults back to the original
encoding. Defaults to <code>"latin1"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The transliterated vector of the same length as <code>x</code>. <code>NA</code>s
are avoided.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># converts fancy apostrophes to normal ones
latinize("Luatuanu\u2019u")

# does nothing
latinize("Berlin")

# also does nothing, although it would fail with `iconv`
latinize("\u0391\u03b8\u03ae\u03bd\u03b1")
</code></pre>

<hr>
<h2 id='new_photon'>Initialize a photon instance</h2><span id='topic+new_photon'></span>

<h3>Description</h3>

<p>Initialize a photon instance by creating a new photon object. This object
is stored in the R session and can be used to perform geocoding requests.
</p>
<p>Instances can either be local or remote. Remote instances require nothing
more than a URL that geocoding requests are sent to. Local instances require
the setup of the photon executable, a search index, and Java. See
<code><a href="#topic+photon_local">photon_local</a></code> for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>new_photon(
  path = NULL,
  url = NULL,
  photon_version = NULL,
  country = NULL,
  date = "latest",
  exact = FALSE,
  section = NULL,
  opensearch = FALSE,
  overwrite = FALSE,
  quiet = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="new_photon_+3A_path">path</code></td>
<td>
<p>Path to a directory where the photon executable and data
should be stored. Defaults to a directory &quot;photon&quot; in the current
working directory. If <code>NULL</code>, a remote instance is set up based on
the <code>url</code> parameter.</p>
</td></tr>
<tr><td><code id="new_photon_+3A_url">url</code></td>
<td>
<p>URL of a photon server to connect to. If <code>NULL</code> and
<code>path</code> is also <code>NULL</code>, connects to the public API under
<a href="https://photon.komoot.io/">https://photon.komoot.io/</a>.</p>
</td></tr>
<tr><td><code id="new_photon_+3A_photon_version">photon_version</code></td>
<td>
<p>Version of photon to be used. A list of all
releases can be found here: <a href="https://github.com/komoot/photon/releases/">https://github.com/komoot/photon/releases/</a>.
Ignored if <code>jar</code> is given. If <code>NULL</code>, uses the latest known
version.</p>
</td></tr>
<tr><td><code id="new_photon_+3A_country">country</code></td>
<td>
<p>Character string that can be identified by
<code><a href="countrycode.html#topic+countryname">countryname</a></code> as a country. An extract for this
country will be downloaded. If <code>NULL</code>, downloads a global search index.</p>
</td></tr>
<tr><td><code id="new_photon_+3A_date">date</code></td>
<td>
<p>Character string or date-time object used to specify the creation
date of the search index. If <code>"latest"</code>, will download the file tagged
with &quot;latest&quot;. If a character string, the value should be parseable by
<code><a href="base.html#topic+as.POSIXct">as.POSIXct</a></code>. If <code>exact = FALSE</code>, the input value is
compared to all available dates and the closest date will be selected.
Otherwise, a file will be selected that exactly matches the input to
<code>date</code>.</p>
</td></tr>
<tr><td><code id="new_photon_+3A_exact">exact</code></td>
<td>
<p>If <code>TRUE</code>, exactly matches the <code>date</code>. Otherwise,
selects the date with lowest difference to the <code>date</code> parameter.</p>
</td></tr>
<tr><td><code id="new_photon_+3A_section">section</code></td>
<td>
<p>Subdirectory of the download server from which to select a
search index. If <code>"experimental"</code>, selects a dump made for the master
version of photon. If <code>"archived"</code>, selects a dump made for an older
version of photon. If <code>NULL</code> (or any arbitrary string), selects a
dump made for the current release. Defaults to <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="new_photon_+3A_opensearch">opensearch</code></td>
<td>
<p>If <code>TRUE</code>, looks for an OpenSearch version of
photon in the specified path. Opensearch-based photon supports structured
geocoding queries but is currently only experimental. Defaults to
<code>FALSE</code>. See <code>vignette("nominatim-import", package = "photon")</code>
for details.</p>
</td></tr>
<tr><td><code id="new_photon_+3A_overwrite">overwrite</code></td>
<td>
<p>If <code>TRUE</code>, overwrites existing jar files and
search indices when initializing a new instance. Defaults to
<code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="new_photon_+3A_quiet">quiet</code></td>
<td>
<p>If <code>TRUE</code>, suppresses all informative messages.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An R6 object of class <code>photon</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># connect to public API
photon &lt;- new_photon()

# connect to arbitrary server
photon &lt;- new_photon(url = "photonserver.org")

if (has_java("11")) {
# set up a local instance in the current working directory
photon &lt;- new_photon("photon", country = "Monaco")
}
</code></pre>

<hr>
<h2 id='photon_local'>Local photon instance</h2><span id='topic+photon_local'></span>

<h3>Description</h3>

<p>This R6 class is used to initialize and manage local photon instances.
It can download and setup the Java, the photon executable, and the necessary
ElasticSearch search index. It can start, stop, and query the status of the
photon instance. It is also the basis for geocoding requests at it is used
to retrieve the URL for geocoding.
</p>


<h3>ElasticSearch / OpenSearch</h3>

<p>The standard version of photon uses ElasticSearch indices to geocode.
These search indices can be self-provided by importing an existing
Nominatim database or they can be downloaded from the
<a href="https://nominatim.org/2020/10/21/photon-country-extracts.html">Photon download server</a>.
Use <code>nominatim = TRUE</code> to indicate that no ElasticSearch indices
should be downloaded. See
<code>vignette("nominatim-import", package = "photon")</code> for details on how
to import from Nominatim.
</p>
<p>To enable structured geocoding, the photon geocoder needs to be built to
support OpenSearch. Since photon 0.6.0, OpenSearch jar files are included
in the photon releases. OpenSearch indices can also be downloaded, but
do not support structured geocoding as of yet. To enable structured
geocoding, indices have to be imported from an existing Nominatim database.
</p>


<h3>Super class</h3>

<p><code><a href="#topic+photon">photon::photon</a></code> -&gt; <code>photon_local</code>
</p>


<h3>Public fields</h3>

<div class="r6-fields">

<dl>
<dt><code>path</code></dt><dd><p>Path to the directory where the photon instance is stored.</p>
</dd>
<dt><code>proc</code></dt><dd><p><code><a href="processx.html#topic+process">process</a></code> object that handles the
external process running photon.</p>
</dd>
</dl>

</div>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-photon_local-new"><code>photon_local$new()</code></a>
</p>
</li>
<li> <p><a href="#method-photon_local-mount"><code>photon_local$mount()</code></a>
</p>
</li>
<li> <p><a href="#method-photon_local-info"><code>photon_local$info()</code></a>
</p>
</li>
<li> <p><a href="#method-photon_local-purge"><code>photon_local$purge()</code></a>
</p>
</li>
<li> <p><a href="#method-photon_local-import"><code>photon_local$import()</code></a>
</p>
</li>
<li> <p><a href="#method-photon_local-start"><code>photon_local$start()</code></a>
</p>
</li>
<li> <p><a href="#method-photon_local-stop"><code>photon_local$stop()</code></a>
</p>
</li>
<li> <p><a href="#method-photon_local-download_data"><code>photon_local$download_data()</code></a>
</p>
</li>
<li> <p><a href="#method-photon_local-remove_data"><code>photon_local$remove_data()</code></a>
</p>
</li>
<li> <p><a href="#method-photon_local-is_running"><code>photon_local$is_running()</code></a>
</p>
</li>
<li> <p><a href="#method-photon_local-is_ready"><code>photon_local$is_ready()</code></a>
</p>
</li>
<li> <p><a href="#method-photon_local-get_url"><code>photon_local$get_url()</code></a>
</p>
</li>
<li> <p><a href="#method-photon_local-get_logs"><code>photon_local$get_logs()</code></a>
</p>
</li>
<li> <p><a href="#method-photon_local-clone"><code>photon_local$clone()</code></a>
</p>
</li></ul>


<hr>
<a id="method-photon_local-new"></a>



<h4>Method <code>new()</code></h4>

<p>Initialize a local photon instance. If necessary, downloads the photon
executable, the search index, and Java.
</p>


<h5>Usage</h5>

<div class="r"><pre>photon_local$new(
  path,
  photon_version = NULL,
  country = NULL,
  date = "latest",
  exact = FALSE,
  section = NULL,
  opensearch = FALSE,
  overwrite = FALSE,
  quiet = FALSE
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>path</code></dt><dd><p>Path to a directory where the photon executable and data
should be stored.</p>
</dd>
<dt><code>photon_version</code></dt><dd><p>Version of photon to be used. A list of all
releases can be found here: <a href="https://github.com/komoot/photon/releases/">https://github.com/komoot/photon/releases/</a>.
Ignored if <code>jar</code> is given. If <code>NULL</code>, uses the latest known
version (Currently: 0.6.2).</p>
</dd>
<dt><code>country</code></dt><dd><p>Character string that can be identified by
<code><a href="countrycode.html#topic+countryname">countryname</a></code> as a country. An extract for this
country will be downloaded. If <code>"planet"</code>, downloads a global search
index.</p>
</dd>
<dt><code>date</code></dt><dd><p>Character string or date-time object used to specify the creation
date of the search index. If <code>"latest"</code>, will download the file tagged
with &quot;latest&quot;. If a character string, the value should be parseable by
<code><a href="base.html#topic+as.POSIXct">as.POSIXct</a></code>. If <code>exact = FALSE</code>, the input value is
compared to all available dates and the closest date will be selected.
Otherwise, a file will be selected that exactly matches the input to
<code>date</code>.</p>
</dd>
<dt><code>exact</code></dt><dd><p>If <code>TRUE</code>, exactly matches the <code>date</code>. Otherwise,
selects the date with lowest difference to the <code>date</code> parameter.</p>
</dd>
<dt><code>section</code></dt><dd><p>Subdirectory of the download server from which to select a
search index. If <code>"experimental"</code>, selects a dump made for the master
version of photon. If <code>"archived"</code>, selects a dump made for an older
version of photon. If <code>NULL</code> (or any arbitrary string), selects a
dump made for the current release. Defaults to <code>NULL</code>.</p>
</dd>
<dt><code>opensearch</code></dt><dd><p>If <code>TRUE</code>, looks for an OpenSearch version of
photon in the specified path. Opensearch-based photon supports structured
geocoding queries but has to be built manually using gradle. Hence,
it cannot be downloaded directly. If no OpenSearch executable is found
in the search path, then this parameter is set to <code>FALSE</code>. Defaults
to <code>FALSE</code>.</p>
</dd>
<dt><code>overwrite</code></dt><dd><p>If <code>TRUE</code>, overwrites existing jar files and
search indices when initializing a new instance. Defaults to
<code>FALSE</code>.</p>
</dd>
<dt><code>quiet</code></dt><dd><p>If <code>TRUE</code>, suppresses all informative messages.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-photon_local-mount"></a>



<h4>Method <code>mount()</code></h4>

<p>Attach the object to the session. If mounted, all geocoding functions
send their requests to the URL of this instance. Manually mounting
is useful if you want to switch between multiple photon instances.
</p>


<h5>Usage</h5>

<div class="r"><pre>photon_local$mount()</pre></div>


<hr>
<a id="method-photon_local-info"></a>



<h4>Method <code>info()</code></h4>

<p>Retrieve metadata about the java and photon version used as well
as the country and creation date of the Eleasticsearch search index.
</p>


<h5>Usage</h5>

<div class="r"><pre>photon_local$info()</pre></div>



<h5>Returns</h5>

<p>A list containing the java version, the photon version, and
if applicable, the spatial and temporal coverage of the search index.
</p>


<hr>
<a id="method-photon_local-purge"></a>



<h4>Method <code>purge()</code></h4>

<p>Kill the photon process and remove the directory. Useful to get rid
of an instance entirely.
</p>


<h5>Usage</h5>

<div class="r"><pre>photon_local$purge(ask = TRUE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>ask</code></dt><dd><p>If <code>TRUE</code>, asks for confirmation before purging the
instance.</p>
</dd>
</dl>

</div>



<h5>Returns</h5>

<p><code>NULL</code>, invisibly.
</p>


<hr>
<a id="method-photon_local-import"></a>



<h4>Method <code>import()</code></h4>

<p>Import a Postgres Nominatim database to photon. Runs the photon jar
file using the additional parameter <code>-nominatim-import</code>. Requires
a running Nominatim database that can be connected to.
</p>


<h5>Usage</h5>

<div class="r"><pre>photon_local$import(
  host = "127.0.0.1",
  port = 5432,
  database = "nominatim",
  user = "nominatim",
  password = "",
  structured = FALSE,
  update = FALSE,
  enable_update_api = FALSE,
  languages = c("en", "fr", "de", "it"),
  countries = NULL,
  extra_tags = NULL,
  json = FALSE,
  timeout = 60,
  java_opts = NULL,
  photon_opts = NULL
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>host</code></dt><dd><p>Postgres host of the database. Defaults to <code>"127.0.0.1"</code>.</p>
</dd>
<dt><code>port</code></dt><dd><p>Postgres port of the database. Defaults to <code>5432</code>.</p>
</dd>
<dt><code>database</code></dt><dd><p>Postgres database name. Defaults to <code>"nominatim"</code>.</p>
</dd>
<dt><code>user</code></dt><dd><p>Postgres database user. Defaults to <code>"nominatim"</code>.</p>
</dd>
<dt><code>password</code></dt><dd><p>Postgres database password. Defaults to <code>""</code>.</p>
</dd>
<dt><code>structured</code></dt><dd><p>If <code>TRUE</code>, enables structured query support when
importing the database. This allows the usage of
<code><a href="#topic+structured">structured</a></code>. Structured queries are only supported in the
OpenSearch version of photon. See section &quot;OpenSearch&quot; above. Defaults
to <code>FALSE</code>.</p>
</dd>
<dt><code>update</code></dt><dd><p>If <code>TRUE</code>, fetches updates from the Nominatim database,
updating the search index without offering an API. If <code>FALSE</code>,
imports the database an deletes the previous index. Defaults to
<code>FALSE</code>.</p>
</dd>
<dt><code>enable_update_api</code></dt><dd><p>If <code>TRUE</code>, enables an additional
endpoint <code>/nominatim-update</code>, which allows updates from
Nominatim databases.</p>
</dd>
<dt><code>languages</code></dt><dd><p>Character vector specifying the languages to import
from the Nominatim databases. Defaults to English, French, German,
and Italian.</p>
</dd>
<dt><code>countries</code></dt><dd><p>Character vector specifying the country codes to
import from the Nominatim database. Defaults to all country codes.</p>
</dd>
<dt><code>extra_tags</code></dt><dd><p>Character vector specifying extra OSM tags to import
from the Nominatim database. These tags are used to augment geocoding
results. Defaults to <code>NULL</code>.</p>
</dd>
<dt><code>json</code></dt><dd><p>If <code>TRUE</code>, dumps the imported Nominatim database to
a JSON file and returns the path to the output file. Defaults to
<code>FALSE</code>.</p>
</dd>
<dt><code>timeout</code></dt><dd><p>Time in seconds before the java process aborts. Defaults
to 60 seconds.</p>
</dd>
<dt><code>java_opts</code></dt><dd><p>List of further flags passed on to the <code>java</code>
command.</p>
</dd>
<dt><code>photon_opts</code></dt><dd><p>List of further flags passed on to the photon
jar in the java command. See <code><a href="#topic+cmd_options">cmd_options</a></code> for a helper
function to import external Nominatim databases.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-photon_local-start"></a>



<h4>Method <code>start()</code></h4>

<p>Start a local instance of the Photon geocoder. Runs the jar executable
located in the instance directory.
</p>


<h5>Usage</h5>

<div class="r"><pre>photon_local$start(
  host = "0.0.0.0",
  port = "2322",
  ssl = FALSE,
  timeout = 60,
  java_opts = NULL,
  photon_opts = NULL
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>host</code></dt><dd><p>Character string of the host name that the geocoder should
be opened on.</p>
</dd>
<dt><code>port</code></dt><dd><p>Port that the geocoder should listen to.</p>
</dd>
<dt><code>ssl</code></dt><dd><p>If <code>TRUE</code>, uses <code>https</code>, otherwise <code>http</code>.
Defaults to <code>FALSE</code>.</p>
</dd>
<dt><code>timeout</code></dt><dd><p>Time in seconds before the java process aborts. Defaults
to 60 seconds.</p>
</dd>
<dt><code>java_opts</code></dt><dd><p>List of further flags passed on to the <code>java</code>
command.</p>
</dd>
<dt><code>photon_opts</code></dt><dd><p>List of further flags passed on to the photon
jar in the java command. See <code><a href="#topic+cmd_options">cmd_options</a></code> for a helper
function to import external Nominatim databases.</p>
</dd>
</dl>

</div>



<h5>Details</h5>

<p>While there is a certain way to determine if a photon instance is
ready, there is no clear way as of yet to determine if a photon setup
has failed. Due to this, a failing setup is mostly indicated by the
setup hanging after emitting a warning. In this case, the setup has to
be interrupted manually.
</p>


<hr>
<a id="method-photon_local-stop"></a>



<h4>Method <code>stop()</code></h4>

<p>Kills the running photon process.
</p>


<h5>Usage</h5>

<div class="r"><pre>photon_local$stop()</pre></div>


<hr>
<a id="method-photon_local-download_data"></a>



<h4>Method <code>download_data()</code></h4>

<p>Downloads a search index using <code><a href="#topic+download_searchindex">download_searchindex</a></code>.
</p>


<h5>Usage</h5>

<div class="r"><pre>photon_local$download_data(
  country = NULL,
  date = "latest",
  exact = FALSE,
  section = NULL
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>country</code></dt><dd><p>Character string that can be identified by
<code><a href="countrycode.html#topic+countryname">countryname</a></code> as a country. An extract for this
country will be downloaded. If <code>NULL</code>, downloads a global search index.</p>
</dd>
<dt><code>date</code></dt><dd><p>Character string or date-time object used to specify the creation
date of the search index. If <code>"latest"</code>, will download the file tagged
with &quot;latest&quot;. If a character string, the value should be parseable by
<code><a href="base.html#topic+as.POSIXct">as.POSIXct</a></code>. If <code>exact = FALSE</code>, the input value is
compared to all available dates and the closest date will be selected.
Otherwise, a file will be selected that exactly matches the input to
<code>date</code>.</p>
</dd>
<dt><code>exact</code></dt><dd><p>If <code>TRUE</code>, exactly matches the <code>date</code>. Otherwise,
selects the date with lowest difference to the <code>date</code> parameter.</p>
</dd>
<dt><code>section</code></dt><dd><p>Subdirectory of the download server from which to select a
search index. If <code>"experimental"</code>, selects a dump made for the master
version of photon. If <code>"archived"</code>, selects a dump made for an older
version of photon. If <code>NULL</code> (or any arbitrary string), selects a
dump made for the current release. Defaults to <code>NULL</code>.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-photon_local-remove_data"></a>



<h4>Method <code>remove_data()</code></h4>

<p>Removes the data currently used in the photon directory. This only
affects the unpacked <code>photon_data</code> directory, not archived files.
</p>


<h5>Usage</h5>

<div class="r"><pre>photon_local$remove_data()</pre></div>


<hr>
<a id="method-photon_local-is_running"></a>



<h4>Method <code>is_running()</code></h4>

<p>Checks whether the photon instance is running and ready. The difference
to <code>$is_ready()</code> is that <code>$is_running()</code> checks specifically
if the running photon instance is managed by a process from its own
<code>photon</code> object. In other words, <code>$is_running()</code> returns
<code>TRUE</code> if both <code>$proc$is_alive()</code> and <code>$is_ready()</code>
return <code>TRUE</code>. This method is useful if you want to ensure that
the <code>photon</code> object can control its photon server (mostly internal
use).
</p>


<h5>Usage</h5>

<div class="r"><pre>photon_local$is_running()</pre></div>



<h5>Returns</h5>

<p>A logical of length 1.
</p>


<hr>
<a id="method-photon_local-is_ready"></a>



<h4>Method <code>is_ready()</code></h4>

<p>Checks whether the photon instance is ready to take requests. This
is the case if the photon server returns a HTTP 400 when sending a
queryless request. This method is useful if you want to check whether
you can send requests.
</p>


<h5>Usage</h5>

<div class="r"><pre>photon_local$is_ready()</pre></div>



<h5>Returns</h5>

<p>A logical of length 1.
</p>


<hr>
<a id="method-photon_local-get_url"></a>



<h4>Method <code>get_url()</code></h4>

<p>Constructs the URL that geocoding requests should be sent to.
</p>


<h5>Usage</h5>

<div class="r"><pre>photon_local$get_url()</pre></div>



<h5>Returns</h5>

<p>A URL to send requests to.
</p>


<hr>
<a id="method-photon_local-get_logs"></a>



<h4>Method <code>get_logs()</code></h4>

<p>Retrieve the logs of previous photon runs.
</p>


<h5>Usage</h5>

<div class="r"><pre>photon_local$get_logs()</pre></div>



<h5>Returns</h5>

<p>Returns a dataframe containing the run ID (<code>rid</code>, the
highest number is the most recent run), a timestamp (<code>ts</code>), the
thread, the log type (INFO, WARN, or ERROR), the class trace and the
error message.
</p>


<hr>
<a id="method-photon_local-clone"></a>



<h4>Method <code>clone()</code></h4>

<p>The objects of this class are cloneable with this method.
</p>


<h5>Usage</h5>

<div class="r"><pre>photon_local$clone(deep = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>deep</code></dt><dd><p>Whether to make a deep clone.</p>
</dd>
</dl>

</div>




<h3>Examples</h3>

<pre><code class='language-R'>if (has_java("11")) {
dir &lt;- file.path(tempdir(), "photon")

# start a new instance using a Monaco extract
photon &lt;- new_photon(path = dir, country = "Monaco")

# start a new instance with an older photon version
photon &lt;- new_photon(path = dir, photon_version = "0.4.1")}

## Not run: 
# import a nominatim database using OpenSearch photon
# this example requires the OpenSearch version of photon and a running
# Nominatim server.
photon &lt;- new_photon(path = dir, opensearch = TRUE)
photon$start(photon_options = cmd_options(port = 29146, password = "pgpass"))
## End(Not run)

</code></pre>

<hr>
<h2 id='purge_java'>Purge Java processes</h2><span id='topic+purge_java'></span>

<h3>Description</h3>

<p>Kill all or selected running Java processes. This function is useful to
stop Photon instances when not being able to kill the
<code><a href="processx.html#topic+process">process</a></code> objects. Be aware that you can also
kill Java processes other than the photon application using this function!
</p>


<h3>Usage</h3>

<pre><code class='language-R'>purge_java(pids = NULL, ask = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="purge_java_+3A_pids">pids</code></td>
<td>
<p>PIDs to kill. The PIDs should be Java processes. If <code>NULL</code>,
tries to kill all Java processes.</p>
</td></tr>
<tr><td><code id="purge_java_+3A_ask">ask</code></td>
<td>
<p>If <code>TRUE</code>, asks for consent before killing the
processes. Defaults to <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A list of running Java tasks is retrieved using <code>ps</code> (on Linux and MacOS)
or <code>tasklist</code> (on Windows). Tasks are killed using <code>pkill</code>
(on Linux and MacOS) or <code>Taskkill</code> (on Windows).
</p>


<h3>Value</h3>

<p>An integer vector of the <code>pkill</code> / <code>Taskkill</code> status
codes or <code>NULL</code> if not running Java processes are found.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># NOTE: These examples should only be run interactively or when you are
# sure that no other java processes are running simultaneously!
## Not run: 
purge_java() # does nothing if no java processes are running

# start a new photon instance
dir &lt;- file.path(tempdir(), "photon")
photon &lt;- new_photon(dir, country = "Samoa")
photon$start()

# kill photon using a sledgehammer
purge_java()

photon$start()

# kill photon using a scalpel
library(ps)
p &lt;- ps_handle(photon$proc$get_pid())
pids &lt;- sapply(ps_children(p), ps::ps_pid)
purge_java(pids)
## End(Not run)
</code></pre>

<hr>
<h2 id='reexports'>Objects exported from other packages</h2><span id='topic+reexports'></span><span id='topic+run'></span><span id='topic+process'></span>

<h3>Description</h3>

<p>These objects are imported from other packages. Follow the links
below to see their documentation.
</p>

<dl>
<dt>processx</dt><dd><p><code><a href="processx.html#topic+process">process</a></code>, <code><a href="processx.html#topic+run">run</a></code></p>
</dd>
</dl>

<hr>
<h2 id='reverse'>Reverse geocoding</h2><span id='topic+reverse'></span>

<h3>Description</h3>

<p>Reverse geocode a set of points to retrieve their corresponding place names.
To geocode a place name or an address, see <a href="#topic+geocode">unstructured</a>
or <a href="#topic+structured">structured</a> geocoding.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>reverse(
  .data,
  radius = NULL,
  limit = 1,
  lang = "en",
  osm_tag = NULL,
  layer = NULL,
  locbias = NULL,
  locbias_scale = NULL,
  zoom = NULL,
  distance_sort = TRUE,
  progress = interactive()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="reverse_+3A_.data">.data</code></td>
<td>
<p>A dataframe or list with names <code>lon</code> and <code>lat</code>, or
an <code>sfc</code> or <code>sf</code> object containing point geometries.</p>
</td></tr>
<tr><td><code id="reverse_+3A_radius">radius</code></td>
<td>
<p>Numeric specifying the range around the points in <code>.data</code>
that is used for searching.</p>
</td></tr>
<tr><td><code id="reverse_+3A_limit">limit</code></td>
<td>
<p>Number of results to return. A maximum of 50 results can be
returned for a single search term. Defaults to 1. When more than a single
text is provided but limit is greater than 1, the results can be uniquely
linked to the input texts using the <code>idx</code> column in the output.</p>
</td></tr>
<tr><td><code id="reverse_+3A_lang">lang</code></td>
<td>
<p>Language of the results. If <code>"default"</code>, returns the results
in local language.</p>
</td></tr>
<tr><td><code id="reverse_+3A_osm_tag">osm_tag</code></td>
<td>
<p>Character string giving an
<a href="https://wiki.openstreetmap.org/wiki/Tags">OSM tag</a> to filter the
results by. See details.</p>
</td></tr>
<tr><td><code id="reverse_+3A_layer">layer</code></td>
<td>
<p>Character string giving a layer to filter the results by.
Can be one of <code>"house"</code>, <code>"street"</code>, <code>"locality"</code>,
<code>"district"</code>, <code>"city"</code>, <code>"county"</code>, <code>"state"</code>,
<code>"country"</code>, or <code>"other"</code>.</p>
</td></tr>
<tr><td><code id="reverse_+3A_locbias">locbias</code></td>
<td>
<p>Numeric vector of length 2 or any object that can be coerced
to a length-2 numeric vector (e.g. a list or <code>sfg</code> object). Specifies a
location bias for geocoding in the format <code>c(lon, lat)</code>. Geocoding
results are biased towards this point. The radius of the bias is controlled
through <code>zoom</code> and the weight of place prominence through
<code>location_bias_scale</code>.</p>
</td></tr>
<tr><td><code id="reverse_+3A_locbias_scale">locbias_scale</code></td>
<td>
<p>Numeric vector specifying the importance of prominence
in <code>locbias</code>. A higher prominence scale gives more weight to important
places. Possible values range from 0 to 1. Defaults to 0.2.</p>
</td></tr>
<tr><td><code id="reverse_+3A_zoom">zoom</code></td>
<td>
<p>Numeric specifying the radius for which the <code>locbias</code> is
effective. Corresponds to the zoom level in OpenStreetMap. The exact relation
to <code>locbias</code> is <code class="reqn">0.25\text{ km} \cdot 2^{(18 - \text{zoom})}</code>.
Defaults to 16.</p>
</td></tr>
<tr><td><code id="reverse_+3A_distance_sort">distance_sort</code></td>
<td>
<p>If <code>TRUE</code>, sorts the reverse geocoding results
based on the distance to the input point. Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="reverse_+3A_progress">progress</code></td>
<td>
<p>If <code>TRUE</code>, shows a progress bar for longer queries.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Filtering by OpenStreetMap tags follows a distinct syntax explained on
<a href="https://github.com/komoot/photon">https://github.com/komoot/photon</a>. In particular:
</p>

<ul>
<li><p>Include places with tag: <code>key:value</code>
</p>
</li>
<li><p>Exclude places with tag: <code>!key:value</code>
</p>
</li>
<li><p>Include places with tag key: <code>key</code>
</p>
</li>
<li><p>Include places with tag value: <code>:value</code>
</p>
</li>
<li><p>Exclude places with tag key: <code>!key</code>
</p>
</li>
<li><p>Exclude places with tag value: <code>:!value</code>
</p>
</li></ul>



<h3>Value</h3>

<p>An sf dataframe or tibble containing the following columns:
</p>

<ul>
<li><p><code>idx</code>: Internal ID specifying the index of the <code>texts</code>
parameter.
</p>
</li>
<li><p><code>osm_type</code>: Type of OSM element, one of N (node), W (way),
R (relation), or P (polygon).
</p>
</li>
<li><p><code>osm_id</code>: OpenStreetMap ID of the matched element.
</p>
</li>
<li><p><code>country</code>: Country of the matched place.
</p>
</li>
<li><p><code>city</code>: City of the matched place.
</p>
</li>
<li><p><code>osm_key</code>: OpenStreetMap key.
</p>
</li>
<li><p><code>countrycode</code>: ISO2 country code.
</p>
</li>
<li><p><code>housenumber</code>: House number, if applicable.
</p>
</li>
<li><p><code>postcode</code>: Post code, if applicable.
</p>
</li>
<li><p><code>locality</code>: Locality, if applicable.
</p>
</li>
<li><p><code>street</code>: Street, if applicable.
</p>
</li>
<li><p><code>district</code>: District name, if applicable.
</p>
</li>
<li><p><code>osm_value</code>: OpenStreetMap tag value.
</p>
</li>
<li><p><code>name</code>: Place name.
</p>
</li>
<li><p><code>type</code>: Layer type as described for the <code>layer</code> parameter.
</p>
</li>
<li><p><code>extent</code>: Boundary box of the match.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># an instance must be mounted first
photon &lt;- new_photon()

# works with sf objects
sf_data &lt;- sf::st_sfc(sf::st_point(c(8, 52)), sf::st_point(c(7, 52)))
reverse(sf_data)

# ... but also with simple dataframes
df_data &lt;- data.frame(lon = c(8, 7), lat = c(52, 52))
reverse(df_data)

# limit search radius to 10m
reverse(df_data, radius = 10)
</code></pre>

<hr>
<h2 id='structured'>Structured geocoding</h2><span id='topic+structured'></span><span id='topic+has_structured_support'></span>

<h3>Description</h3>

<p>Geocode a set of place information such as street, house number, or
post code. Structured geocoding is generally more accurate but requires
more information than <a href="#topic+geocode">unstructured geocoding</a>.
</p>
<p>Note that structured geocoding must be specifically enabled when building a
Nominatim database. It is generally not available on komoot's public API and
on pre-built search indices through <code><a href="#topic+download_searchindex">download_searchindex</a></code>. See
<code>vignette("nominatim-import", package = "photon")</code> for details. You can
use the helper function <code>has_structured_support()</code> to check if the
current API supports structured geocoding.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>structured(
  .data,
  limit = 1,
  lang = "en",
  bbox = NULL,
  osm_tag = NULL,
  layer = NULL,
  locbias = NULL,
  locbias_scale = NULL,
  zoom = NULL,
  progress = interactive()
)

has_structured_support()
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="structured_+3A_.data">.data</code></td>
<td>
<p>Dataframe or list containing structured information on a place
to geocode. Can contain the columns <code>street</code>, <code>housenumber</code>,
<code>postcode</code>, <code>city</code>, <code>district</code>, <code>county</code>, <code>state</code>,
and <code>countrycode</code>. At least one of these columns must be present in the
dataframe. Note that countries must be passed as ISO-2 country codes.</p>
</td></tr>
<tr><td><code id="structured_+3A_limit">limit</code></td>
<td>
<p>Number of results to return. A maximum of 50 results can be
returned for a single search term. Defaults to 1. When more than a single
text is provided but limit is greater than 1, the results can be uniquely
linked to the input texts using the <code>idx</code> column in the output.</p>
</td></tr>
<tr><td><code id="structured_+3A_lang">lang</code></td>
<td>
<p>Language of the results. If <code>"default"</code>, returns the results
in local language.</p>
</td></tr>
<tr><td><code id="structured_+3A_bbox">bbox</code></td>
<td>
<p>Any object that can be parsed by <code><a href="sf.html#topic+st_bbox">st_bbox</a></code>.
Results must lie within this bbox.</p>
</td></tr>
<tr><td><code id="structured_+3A_osm_tag">osm_tag</code></td>
<td>
<p>Character string giving an
<a href="https://wiki.openstreetmap.org/wiki/Tags">OSM tag</a> to filter the
results by. See details.</p>
</td></tr>
<tr><td><code id="structured_+3A_layer">layer</code></td>
<td>
<p>Character string giving a layer to filter the results by.
Can be one of <code>"house"</code>, <code>"street"</code>, <code>"locality"</code>,
<code>"district"</code>, <code>"city"</code>, <code>"county"</code>, <code>"state"</code>,
<code>"country"</code>, or <code>"other"</code>.</p>
</td></tr>
<tr><td><code id="structured_+3A_locbias">locbias</code></td>
<td>
<p>Numeric vector of length 2 or any object that can be coerced
to a length-2 numeric vector (e.g. a list or <code>sfg</code> object). Specifies a
location bias for geocoding in the format <code>c(lon, lat)</code>. Geocoding
results are biased towards this point. The radius of the bias is controlled
through <code>zoom</code> and the weight of place prominence through
<code>location_bias_scale</code>.</p>
</td></tr>
<tr><td><code id="structured_+3A_locbias_scale">locbias_scale</code></td>
<td>
<p>Numeric vector specifying the importance of prominence
in <code>locbias</code>. A higher prominence scale gives more weight to important
places. Possible values range from 0 to 1. Defaults to 0.2.</p>
</td></tr>
<tr><td><code id="structured_+3A_zoom">zoom</code></td>
<td>
<p>Numeric specifying the radius for which the <code>locbias</code> is
effective. Corresponds to the zoom level in OpenStreetMap. The exact relation
to <code>locbias</code> is <code class="reqn">0.25\text{ km} \cdot 2^{(18 - \text{zoom})}</code>.
Defaults to 16.</p>
</td></tr>
<tr><td><code id="structured_+3A_progress">progress</code></td>
<td>
<p>If <code>TRUE</code>, shows a progress bar for longer queries.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Filtering by OpenStreetMap tags follows a distinct syntax explained on
<a href="https://github.com/komoot/photon">https://github.com/komoot/photon</a>. In particular:
</p>

<ul>
<li><p>Include places with tag: <code>key:value</code>
</p>
</li>
<li><p>Exclude places with tag: <code>!key:value</code>
</p>
</li>
<li><p>Include places with tag key: <code>key</code>
</p>
</li>
<li><p>Include places with tag value: <code>:value</code>
</p>
</li>
<li><p>Exclude places with tag key: <code>!key</code>
</p>
</li>
<li><p>Exclude places with tag value: <code>:!value</code>
</p>
</li></ul>



<h3>Value</h3>

<p>An sf dataframe or tibble containing the following columns:
</p>

<ul>
<li><p><code>idx</code>: Internal ID specifying the index of the <code>texts</code>
parameter.
</p>
</li>
<li><p><code>osm_type</code>: Type of OSM element, one of N (node), W (way),
R (relation), or P (polygon).
</p>
</li>
<li><p><code>osm_id</code>: OpenStreetMap ID of the matched element.
</p>
</li>
<li><p><code>country</code>: Country of the matched place.
</p>
</li>
<li><p><code>city</code>: City of the matched place.
</p>
</li>
<li><p><code>osm_key</code>: OpenStreetMap key.
</p>
</li>
<li><p><code>countrycode</code>: ISO2 country code.
</p>
</li>
<li><p><code>housenumber</code>: House number, if applicable.
</p>
</li>
<li><p><code>postcode</code>: Post code, if applicable.
</p>
</li>
<li><p><code>locality</code>: Locality, if applicable.
</p>
</li>
<li><p><code>street</code>: Street, if applicable.
</p>
</li>
<li><p><code>district</code>: District name, if applicable.
</p>
</li>
<li><p><code>osm_value</code>: OpenStreetMap tag value.
</p>
</li>
<li><p><code>name</code>: Place name.
</p>
</li>
<li><p><code>type</code>: Layer type as described for the <code>layer</code> parameter.
</p>
</li>
<li><p><code>extent</code>: Boundary box of the match.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# structured() requires an OpenSearch instance with structured support
# the following code will not work off the shelf
# refer to vignette("nominatim-import") for details
dir &lt;- file.path(tempdir(), "photon")
photon &lt;- new_photon(dir, opensearch = TRUE)
photon$import(password = "psql_password", structured = TRUE)
photon$start()

# check if structured() is supported
has_structured_support()

# structured() works on dataframes containing structurized data
place_data &lt;- data.frame(
  housenumber = c(NA, "77C", NA),
  street = c("Falealilli Cross Island Road", "Main Beach Road", "Le Mafa Pass Road"),
  state = c("Tuamasaga", "Tuamasaga", "Atua")
)
structured(place_data, limit = 1)

# countries must be specified as iso2 country codes
structured(data.frame(countrycode = "ws"))

# traditional parameters from geocode() can also be used but are much more niche
structured(data.frame(city = "Apia"), layer = "house") # matches nothing

# structured geocoding can discern small differences in places
safune &lt;- data.frame(
  city = c("Safune", "Safune"),
  state = c("Gaga'ifomauga", "Tuamasaga")
)
structured(safune, limit = 1)

## End(Not run)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
