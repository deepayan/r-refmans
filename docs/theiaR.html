<!DOCTYPE html><html><head><title>Help for package theiaR</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {theiaR}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#TheiaAuth'><p>Authentication system to Theia website</p></a></li>
<li><a href='#TheiaCollection'><p>A collection of tiles from Theia</p></a></li>
<li><a href='#TheiaQuery'><p>A query to the Theia website</p></a></li>
<li><a href='#theiaR'><p>theiaR: search, download and manage theia data</p></a></li>
<li><a href='#TheiaTile'><p>A tile from Theia</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Download and Manage Data from Theia</td>
</tr>
<tr>
<td>Version:</td>
<td>0.4.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides a simple interface to search available data provided by
    Theia (<a href="https://theia.cnes.fr">https://theia.cnes.fr</a>), download it, and manage it. Data can be downloaded
    based on a search result or from a cart file downloaded from Theia website.</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5)</td>
</tr>
<tr>
<td>Imports:</td>
<td>askpass (&ge; 1.1), httr (&ge; 1.3), R6 (&ge; 2.3), raster (&ge; 2.6),
tools (&ge; 3.5), XML (&ge; 3.86)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3.0)</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/norival/theiaR">https://github.com/norival/theiaR</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/norival/theiaR/issues">https://github.com/norival/theiaR/issues</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, gdalcubes</td>
</tr>
<tr>
<td>Collate:</td>
<td>'TheiaAuth.R' 'TheiaTile.R' 'TheiaCollection.R' 'TheiaQuery.R'
'theiaR.R' 'utils.R'</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-11-14 18:05:09 UTC; xavier</td>
</tr>
<tr>
<td>Author:</td>
<td>Xavier Laviron <a href="https://orcid.org/0000-0002-9882-3253"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Xavier Laviron &lt;xavier@norival.dev&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-11-19 09:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='TheiaAuth'>Authentication system to Theia website</h2><span id='topic+TheiaAuth'></span>

<h3>Description</h3>

<p>Generate and manage authentication to Theia website from login and
password. It requests a token to download tiles when created and
automatically request a new one when it has expired (after 2h). It is used
to download tiles from <a href="#topic+TheiaTile">TheiaTile</a> and <a href="#topic+TheiaCollection">TheiaCollection</a> objects.
</p>


<h3>Usage</h3>

<pre>
   a &lt;- TheiaAuth$new(auth.file)

   a$token()
</pre>


<h3>Arguments</h3>


<dl>
<dt>a:</dt><dd><p>A <code>TheiaAuth</code> object</p>
</dd>
<dt>auth.file</dt><dd><p>The path to the file containing login and password. It
will be created if it does not exist. See 'Details' for more informations</p>
</dd>
</dl>



<h3>Details</h3>

<p><code>TheiaAuth$new(auth.file)</code> Create a new instance of the class
</p>
<p><code>a$token()</code> Return the current token or generate a next one if it has
expired
</p>
<p>This class is used to manage authentication to Theia website, without
intervention from the user. Login and password must be stored in a
separate text file with these two lines:
</p>
<p>login
password
</p>
<p>File content is read each time authentication is needed (to request a new
token), so login and password are not stored in R's memory. If this file
does not exist, R will prompt you to enter your login and password and
will create the file.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
# create an authentication object
myauth &lt;- TheiaAuth$new("path_to_auth_file.txt")

# show the access token (and request a new one if needed)
myauth$token

## End(Not run)

</code></pre>

<hr>
<h2 id='TheiaCollection'>A collection of tiles from Theia</h2><span id='topic+TheiaCollection'></span>

<h3>Description</h3>

<p>Generate and manage collection of tiles from Theia. This collection can be
created either from a cart file ('.meta4') downloaded from Theia website,
from a <code><a href="#topic+TheiaQuery">TheiaQuery</a></code> object or from a list of
<code><a href="#topic+TheiaTile">TheiaTile</a></code> (not implemented yet).
</p>


<h3>Usage</h3>

<pre>
   c &lt;- TheiaCollection$new(cart.path = NULL,
                            tiles     = NULL,
                            query     = NULL,
                            dir.path  = NULL,
                            check     = TRUE)
                            quiet     = TRUE)

   c$download(auth, overwrite = FALSE, check = TRUE, quiet = TRUE)
   c$check()
   c$status
   c$extract(overwrite = FALSE, dest.dir = NULL)
   c$read(bands)
   c$as_gdalcube(out.file = "gdalcube_collection.sqlite")
</pre>


<h3>Arguments</h3>


<dl>
<dt>c:</dt><dd><p>A <code>TheiaCollection</code> object</p>
</dd>
<dt>dir.path:</dt><dd><p>The path to the directory containing zip files</p>
</dd>
<dt>check:</dt><dd><p>Whether or not to check existing files on collection's creation</p>
</dd>
<dt>quiet:</dt><dd><p>Control verbose output</p>
</dd>
<dt>tiles:</dt><dd><p>A list of TheiaTile objects</p>
</dd>
<dt>cart:</dt><dd><p>An XML cart parsed from a 'meta4' file downloaded from Theia</p>
</dd>
</dl>
<p>website. Used only if Collection is created from a cart
</p>
<dl>
<dt>query:</dt><dd><p>A TheiaQuery object, used only if collection is created
from a TheiaQuery object. Can also be a list with search terms. In this
case, it will create a 'TheiaQuery' object from it. See
<code><a href="#topic+TheiaQuery">TheiaQuery</a></code> for details on query syntax</p>
</dd>
<dt>auth:</dt><dd><p>A character string giving the file path to Theia credentials.
Or a <code><a href="#topic+TheiaAuth">TheiaAuth</a></code> object</p>
</dd>
<dt>overwrite:</dt><dd><p>Overwrite existing tiles (default to 'FALSE')</p>
</dd>
<dt>bands:</dt><dd><p>A character vector of bands to load from tiles</p>
</dd>
<dt>out.file:</dt><dd><p>Filename to store gdalcubes' image collection</p>
</dd>
</dl>



<h3>Details</h3>

<p><code>TheiaCollection$new()</code> Create a new instance of the class
</p>
<p><code>c$download(overwrite = FALSE, check = TRUE)</code> Download the tiles of the collection
and check the resulting files
</p>
<p><code>$ccheck()</code> Check the tiles of the collection
</p>
<p><code>c$status</code> Return the status of each tile of the collection
</p>
<p><code>c$extract(overwrite = FALSE, dest.dir = NULL)</code> Extract archives to
dest.dir if supplied, or to the same directory as the archives otherwise
</p>
<p><code>c$read(bands)</code> Read requested bands, apply corrections on values
(as specified in Theia's product information), and return a list of
RasterStack objects (one stack per tile)
</p>
<p><code>c$as_gdalcube(out.file)</code> Create a 'gdalcubes' image collection from
downloaded tiles. See <a href="https://github.com/appelmar/gdalcubes_R">https://github.com/appelmar/gdalcubes_R</a> for
more details.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

# Create a collection from a query
## Create a query to Theia database, looking for tiles from Sentinel2
## satellite around Grenoble, between 2018-07-01 and 2018-07-06.

query &lt;- list(collection = "SENTINEL2",
              town       = "Grenoble",
              start.date = "2018-07-01",
              end.date   = "2018-07-06")

## Create a collecion of tiles from this query
mycollection &lt;- TheiaCollection$new(query = query, dir.path = ".")

print(mycollection)


# Alternatively, you can create a collection from a cart file (that you can
# download from Theia's website)
cart.path &lt;- system.file("extdata", "cart.meta4", package = "theiaR")

mycollection &lt;- TheiaCollection$new(cart.path = cart.path,
                                    dir.path  = ".")

print(mycollection)

## Not run: 
# Download the tiles in the collection
mycollection$download()

## End(Not run)

## Not run: 
# Finally, you can extract zip archives containing the tiles
mycollection$extract(overwrite = FALSE)

## End(Not run)

</code></pre>

<hr>
<h2 id='TheiaQuery'>A query to the Theia website</h2><span id='topic+TheiaQuery'></span>

<h3>Description</h3>

<p>Generate an send a query to Theia web API to get and download tiles based on
input given by the user.
</p>


<h3>Usage</h3>

<pre>
   q &lt;- TheiaQuery$new(query)

   q$update_token()
   q$submit()
</pre>


<h3>Arguments</h3>


<dl>
<dt>q:</dt><dd><p>A <code>TheiaQuery</code> object</p>
</dd>
<dt>query:</dt><dd><p><code>list</code>, the users' request, see 'Queries' for
more informations</p>
</dd>
</dl>



<h3>Details</h3>

<p><code>TheiaQuery$new()</code> Create a new instance of the class, parse 'query'
list and submit the query to Theia to retrieve files catalog
</p>
<p><code>q$submit()</code> Submit the query to Theia and get a list of tiles
corresponding to search criteria
</p>


<h3>Queries</h3>

<p>Search criteria are given with a 'list' accepting these fields:
</p>

<ul>
<li><p>collection: The collection to look for. Accepted values are:
'SENTINEL2', 'LANDSAT', 'Landsat57', 'SpotWorldHeritage', 'Snow'.
Defaults to 'SENTINEL2'
</p>
</li>
<li><p>platform: The platform to look for. Accepted values are:
'LANDSAT5', 'LANDSAT7', 'LANDSAT8', 'SPOT1', 'SPOT2', 'SPOT3',
'SPOT4', 'SPOT5', 'SENTINEL2A', 'SENTINEL2B'
</p>
</li>
<li><p>level: Processing level. Accepted values are: 'LEVEL1C',
'LEVEL2A', LEVEL3A', 'N2A'. Defaults to 'LEVEL2A' (or 'N2A' if
querying Landsat57 collection).
</p>
</li>
<li><p>town: The location to look for. Give a common town name.
</p>
</li>
<li><p>tile: The tile identifier to retrieve.
</p>
</li>
<li><p>start.date: The first date to look for (format: YYYY-MM-DD).
</p>
</li>
<li><p>end.date: The last date to look for (format: YYYY-MM-DD). Must be
after start.date. Defaults to today's date.
</p>
</li>
<li><p>latitude: The x coordinate of a point
</p>
</li>
<li><p>longitude: The y coordinate of a point
</p>
</li>
<li><p>latmin: The minimum latitude to search
</p>
</li>
<li><p>latmax: The maximum latitude to search
</p>
</li>
<li><p>lonmin: The minimum longitude to search
</p>
</li>
<li><p>lonmax: The maximum longitude to search
</p>
</li>
<li><p>orbit.number: The orbit number
</p>
</li>
<li><p>rel.orbit.number: The relative orbit number
</p>
</li>
<li><p>max.clouds: The maximum of cloud cover wanted (0-100)
</p>
</li>
<li><p>max.records: The maximum of tiles to search
</p>
</li></ul>



<h3>See Also</h3>

<p><a href="https://github.com/olivierhagolle/theia_download">https://github.com/olivierhagolle/theia_download</a> for an alternative
download method based on Python. Inspiration for this function.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

# Create a query to Theia database, looking for tiles from Sentinel2
# satellite around Grenoble, between 2018-07-01 and 2018-07-06.

query &lt;- list(collection = "SENTINEL2",
              town       = "Grenoble",
              start.date = "2018-07-01",
              end.date   = "2018-07-06")
q &lt;- TheiaQuery$new(query)

# Show informations on found tiles
print(q$tiles)


</code></pre>

<hr>
<h2 id='theiaR'>theiaR: search, download and manage theia data</h2><span id='topic+theiaR'></span>

<h3>Description</h3>

<p>Search, manage and download data from Theia website
</p>

<hr>
<h2 id='TheiaTile'>A tile from Theia</h2><span id='topic+TheiaTile'></span>

<h3>Description</h3>

<p>Generate and manage a tile from Theia (download, check, load).
</p>


<h3>Usage</h3>

<pre>
   t &lt;- TheiaTile$new(file.path,
                      url,
                      file.hash,
                      check = TRUE,
                      quiet = TRUE)

   t$download(overwrite = FALSE, check = TRUE, quiet = TRUE)
   t$check()
   t$extract(overwrite = FALSE, dest.dir = NULL)
   t$read(bands)
</pre>


<h3>Arguments</h3>


<dl>
<dt>t:</dt><dd><p>A <code>TheiaTile</code> object</p>
</dd>
<dt>file.path:</dt><dd><p>The path to the zip file containing the tile</p>
</dd>
<dt>url:</dt><dd><p>The url to download the tile</p>
</dd>
<dt>file.hash:</dt><dd><p>The md5sum used to check the zip file</p>
</dd>
<dt>check:</dt><dd><p>Whether or not to check existing files on tile's creation</p>
</dd>
<dt>quiet:</dt><dd><p>Control verbose output</p>
</dd>
<dt>auth:</dt><dd><p>A character string giving the file path to Theia credentials.
Or a <code><a href="#topic+TheiaAuth">TheiaAuth</a></code> object</p>
</dd>
<dt>overwrite:</dt><dd><p>Overwrite existing tiles (default to 'FALSE')</p>
</dd>
<dt>bands:</dt><dd><p>A character vector of bands to load from tiles</p>
</dd>
</dl>



<h3>Details</h3>

<p><code>TheiaTile$new(file.path, url, file.hash, check)</code> Create a new instance of
the class
</p>
<p><code>t$download(auth, overwrite = FALSE, check = TRUE)</code> Download the
tiles of the collection and check the resulting files
</p>
<p><code>t$check()</code> Check the tiles of the collection
</p>
<p><code>t$extract(overwrite = FALSE, dest.dir = NULL)</code> Extract archive to
dest.dir if supplied, or to the same directory as the archive otherwise
</p>
<p><code>t$read(bands)</code> Read requested bands, apply corrections on values
(as specified in Theia's product information), and return a RasterStack
</p>
<p><code>t$bands</code> List bands available in the tile
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
