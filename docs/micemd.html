<!DOCTYPE html><html><head><title>Help for package micemd</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {micemd}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#CHEM97Na'>
<p>An incomplete two-level dataset which consists of A/AS-level examination data from England</p></a></li>
<li><a href='#find.defaultMethod'>
<p>Suggestion of conditional imputation models to use accordingly to the incomplete dataset</p></a></li>
<li><a href='#IPDNa'>
<p>A simulated Individual Patient Data (IPD) meta-analysis with missing values.</p></a></li>
<li><a href='#mice.impute.2l.2stage.bin'>
<p>Imputation by a two-level logistic model based on a two-stage estimator</p></a></li>
<li><a href='#mice.impute.2l.2stage.heckman'>
<p>Imputation based on Heckman model for multilevel data.</p></a></li>
<li><a href='#mice.impute.2l.2stage.norm'>
<p>Imputation by a two-level heteroscedastic normal model based on a two-stage estimator</p></a></li>
<li><a href='#mice.impute.2l.2stage.pmm'>
<p>Predictive mean matching imputation for two-level variable</p></a></li>
<li><a href='#mice.impute.2l.2stage.pois'>
<p>Imputation by a two-level Poisson model based on a two-stage estimator</p></a></li>
<li><a href='#mice.impute.2l.glm.bin'>
<p>Imputation of univariate missing data using a Bayesian logistic mixed model based on non-informative prior distributions</p></a></li>
<li><a href='#mice.impute.2l.glm.norm'>
<p>Imputation of univariate missing data using a Bayesian linear mixed model based on non-informative prior distributions</p></a></li>
<li><a href='#mice.impute.2l.glm.pois'>
<p>Imputation of count variable using a Bayesian mixed model based on non-informative prior distributions</p></a></li>
<li><a href='#mice.impute.2l.jomo'>
<p>Imputation of univariate missing data by a Bayesian multivariate generalized model based on conjugate priors</p></a></li>
<li><a href='#mice.par'>
<p>Parallel calculations for Multivariate Imputation by Chained Equations</p></a></li>
<li><a href='#micemd-package'>
<p>Multiple Imputation by Chained Equations with Multilevel Data</p>
</p></a></li>
<li><a href='#Obesity'><p>A two-level incomplete dataset based on an online obesity survey</p></a></li>
<li><a href='#overimpute'>
<p>Overimputation diagnostic plot</p></a></li>
<li><a href='#plot.mira'>
<p>Graphical investigation for the number of generated datasets</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Multiple Imputation by Chained Equations with Multilevel Data</td>
</tr>
<tr>
<td>Version:</td>
<td>1.10.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-11-17</td>
</tr>
<tr>
<td>Description:</td>
<td>Addons for the 'mice' package to perform multiple imputation using chained equations with two-level data. Includes imputation methods dedicated to sporadically and systematically missing values. Imputation of continuous, binary or count variables are available. Following the recommendations of Audigier, V. et al (2018) &lt;<a href="https://doi.org/10.1214%2F18-STS646">doi:10.1214/18-STS646</a>&gt;, the choice of the imputation method for each variable can be facilitated by a default choice tuned according to the structure of the incomplete dataset. Allows parallel calculation and overimputation for 'mice'.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0), mice (&ge; 2.42)</td>
</tr>
<tr>
<td>Imports:</td>
<td>Matrix, graphics, utils, stats, MASS, parallel, nlme, lme4,
mvmeta (&ge; 0.4.7), jomo (&ge; 2.6-3), mvtnorm, digest, abind,
GJRM (&ge; 0.2-6.4), mgcv, mixmeta, pbivnorm</td>
</tr>
<tr>
<td>Suggests:</td>
<td>VIM, ggplot2, data.table, broom.mixed</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>6.1.0</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-11-17 10:11:21 UTC; V. Audigier</td>
</tr>
<tr>
<td>Author:</td>
<td>Vincent Audigier [aut, cre] (CNAM MSDMA team),
  Matthieu Resche-Rigon [aut] (INSERM ECSTRA team),
  Johanna Munoz Avila [ctb] (Julius Center Methods Group UMC, 2022)</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Vincent Audigier &lt;vincent.audigier@cnam.fr&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-11-17 10:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='CHEM97Na'>
An incomplete two-level dataset which consists of A/AS-level examination data from England
</h2><span id='topic+CHEM97Na'></span>

<h3>Description</h3>

<p>This dataset is an extract of the CHEM97 dataset (Fielding, A. et al, 2003) dealing with point scores of 31,022 pupils grouped in 2,280 schools. CHEM97Na reports point score for Schools with more than 70 pupils only, i.e. 1681 pupils grouped in 18 schools. Systematically missing values and sporadically missing values have been added according to a missing completely at random (MCAR) mechanism (Little R.J.A. and Rubin D.B., 2002). Systematically missing values are values that are missing for all pupils of a same school, while sporadically missing values are values which are missing for an individual only (Resche-Rigon, et al 2013).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("CHEM97Na")</code></pre>


<h3>Format</h3>

<p>A data frame with 1681 observations on the following 5 variables.
</p>

<dl>
<dt><code>School</code></dt><dd><p>a numeric indexing the School</p>
</dd>
<dt><code>Sex</code></dt><dd><p>a factor with levels <code>M</code> <code>F</code></p>
</dd>
<dt><code>Age</code></dt><dd><p>a numeric indicating the age in months</p>
</dd>
<dt><code>GSCE</code></dt><dd><p>a numeric vector indicating the point score at the General Certificate of Secondary Education</p>
</dd>
<dt><code>Score</code></dt><dd><p>a numeric vector indicating the point score on A-level Chemistry in 1997</p>
</dd>
</dl>



<h3>Details</h3>

<p>For more details, see Fielding, A. et al (2003).
</p>


<h3>Source</h3>

<p>Fielding, A., Yang, M., and Goldstein, H.(2003). Multilevel ordinal models for examination grades. Statistical Modelling, 3 (2): 127-153.
</p>
<p>Available at http://www.bristol.ac.uk/cmm/learning/mmsoftware/data-rev.html#chem97
</p>


<h3>References</h3>

<p>Fielding, A., Yang, M., and Goldstein, H. (2003). Multilevel ordinal models for examination grades. Statistical Modelling, 3 (2): 127-153. <a href="https://doi.org/10.1191/1471082X03st052oa">doi:10.1191/1471082X03st052oa</a>
</p>
<p>Resche-Rigon, M., White, I. R., Bartlett, J., Peters, S., Thompson, S., and on behalf of the PROG-IMT Study Group (2013). Multiple imputation for handling systematically missing confounders in meta-analysis of individual participant data. Statistics in Medicine, 32(28):4890-4905. <a href="https://doi.org/10.1002/sim.5894">doi:10.1002/sim.5894</a>
</p>
<p>Little R.J.A., Rubin D.B. (2002) Statistical Analysis with Missing Data. Wiley series in probability and statistics, New-York
</p>


<h3>See Also</h3>

<p><code><a href="VIM.html#topic+matrixplot">matrixplot</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(CHEM97Na)

#summary
summary(CHEM97Na)

#summary per School
by(CHEM97Na,CHEM97Na$School,summary)

</code></pre>

<hr>
<h2 id='find.defaultMethod'>
Suggestion of conditional imputation models to use accordingly to the incomplete dataset
</h2><span id='topic+find.defaultMethod'></span>

<h3>Description</h3>

<p>Provides conditionnal imputation models to use for each column of the incomplete dataset according to the number of clusters, the number of individuals per cluster and the class of the variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>find.defaultMethod(don.na, ind.clust, I.small = 7, ni.small = 100, prop.small = 0.4)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="find.defaultMethod_+3A_don.na">don.na</code></td>
<td>

<p>An incomplete data frame.
</p>
</td></tr>
<tr><td><code id="find.defaultMethod_+3A_ind.clust">ind.clust</code></td>
<td>

<p>A scalar indexes the variable corresponding to the cluster indicator.
</p>
</td></tr>
<tr><td><code id="find.defaultMethod_+3A_i.small">I.small</code></td>
<td>

<p>A scalar that is used as threshold to consider the number of observed clusters (fully observed or partially observed) as small. Default is <code>I.small=7</code>.
</p>
</td></tr>
<tr><td><code id="find.defaultMethod_+3A_ni.small">ni.small</code></td>
<td>

<p>A scalar that is used as threshold to consider the number individuals per clusters (with observed values) as small. Default is <code>ni.small=100</code>.
</p>
</td></tr>
<tr><td><code id="find.defaultMethod_+3A_prop.small">prop.small</code></td>
<td>

<p>A scalar that is used as threshold to consider the number of small clusters as small. Default is <code>prop.small=0.4</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Provides conditionnal imputation models to use for each column of the incomplete dataset according to the number of clusters, the number of individuals per cluster and the class of the variable (Audigier, V. et al 2017). Returned methods can be: 2l.stage.bin (binary), 2l.stage.norm (continuous), 2l.stage.pois (integer), 2l.glm.bin (binary), 2l.glm.norm (continuous), 2l.glm.pois (integer), 2l.jomo (continuous or binary). For a given variable, the method retained is chosen according to the following decision tree:
</p>

<table>
<tr>
 <td style="text-align: right;">
</td><td style="text-align: right;">----------------------------------</td><td style="text-align: left;">-----------------------------------</td>
</tr>
<tr>
 <td style="text-align: right;">
</td><td style="text-align: right;"> Few observed </td><td style="text-align: left;"> clusters </td>
</tr>
<tr>
 <td style="text-align: right;">
</td><td style="text-align: right;">----------------------------------</td><td style="text-align: left;">-----------------------------------</td>
</tr>
<tr>
 <td style="text-align: right;">
</td><td style="text-align: right;"> Few observed values per cluster </td><td style="text-align: left;"> Many observed values per cluster </td>
</tr>
<tr>
 <td style="text-align: right;">
------------------</td><td style="text-align: right;">------------------------------------------------</td><td style="text-align: left;">-----------------------------------</td>
</tr>
<tr>
 <td style="text-align: right;">
continuous	</td><td style="text-align: right;"> 2l.glm.norm	</td><td style="text-align: left;"> 2l.stage.norm </td>
</tr>
<tr>
 <td style="text-align: right;">
binary	</td><td style="text-align: right;"> 2l.glm.bin	</td><td style="text-align: left;"> 2l.stage.bin </td>
</tr>
<tr>
 <td style="text-align: right;">
integer	</td><td style="text-align: right;"> 2l.glm.pois	</td><td style="text-align: left;"> 2l.stage.pois </td>
</tr>
<tr>
 <td style="text-align: right;">
------------------</td><td style="text-align: right;">------------------------------------------------</td><td style="text-align: left;">-----------------------------------</td>
</tr>
<tr>
 <td style="text-align: right;">
</td>
</tr>

</table>


<table>
<tr>
 <td style="text-align: right;">
</td><td style="text-align: right;">----------------------------------</td><td style="text-align: left;">-----------------------------------</td>
</tr>
<tr>
 <td style="text-align: right;">
</td><td style="text-align: right;"> Many observed  </td><td style="text-align: left;"> clusters</td>
</tr>
<tr>
 <td style="text-align: right;">
</td><td style="text-align: right;">----------------------------------</td><td style="text-align: left;">-----------------------------------</td>
</tr>
<tr>
 <td style="text-align: right;">
</td><td style="text-align: right;"> Few observed values per cluster </td><td style="text-align: left;"> Many observed values per cluster </td>
</tr>
<tr>
 <td style="text-align: right;">
------------------</td><td style="text-align: right;">------------------------------------------------</td><td style="text-align: left;">-----------------------------------</td>
</tr>
<tr>
 <td style="text-align: right;">
continuous	</td><td style="text-align: right;"> 2l.glm.norm	</td><td style="text-align: left;"> 2l.stage.norm</td>
</tr>
<tr>
 <td style="text-align: right;">
binary	</td><td style="text-align: right;"> 2l.jomo	</td><td style="text-align: left;"> 2l.jomo</td>
</tr>
<tr>
 <td style="text-align: right;">
integer	</td><td style="text-align: right;"> 2l.glm.pois	</td><td style="text-align: left;"> 2l.stage.pois</td>
</tr>
<tr>
 <td style="text-align: right;">
------------------</td><td style="text-align: right;">------------------------------------------------</td><td style="text-align: left;">-----------------------------------</td>
</tr>
<tr>
 <td style="text-align: right;">
</td>
</tr>

</table>

<p>For instance, with few observed clusters (i.e. less than <code>I.small</code>), and many observed values per cluster (i.e. less than <code>prop.small</code> clusters with less than <code>ni.small</code> observed values), imputation of a continuous variable according to the method 2l.stage.norm will be suggested.
</p>


<h3>Value</h3>

<p>A vector of strings with length <code>ncol(data)</code>.
</p>


<h3>Author(s)</h3>

<p>Vincent Audigier <a href="mailto:vincent.audigier@cnam.fr">vincent.audigier@cnam.fr</a>
</p>


<h3>References</h3>

<p>Audigier, V., White, I. ,  Jolani ,S.  Debray, T.,  Quartagno, M., Carpenter, J., van Buuren, S. and Resche-Rigon, M. Multiple imputation for multilevel data with continuous and binary variables (2018). Statistical Science. <a href="https://doi.org/10.1214/18-STS646">doi:10.1214/18-STS646</a>.
</p>
<p>Jolani, S., Debray, T. P. A., Koffijberg, H., van Buuren, S., and Moons, K. G. M. (2015). Imputation of systematically missing predictors in an individual participant data meta-analysis: a generalized approach using MICE. Statistics in Medicine, 34(11):1841-1863). <a href="https://doi.org/10.1002/sim.6451">doi:10.1002/sim.6451</a>
</p>
<p>Quartagno, M. and Carpenter, J. R. (2016). Multiple imputation for IPD meta-analysis: allowing for heterogeneity and studies with missing covariates. Statistics in Medicine, 35(17):2938-2954. <a href="https://doi.org/10.1002/sim.6837">doi:10.1002/sim.6837</a>
</p>
<p>Resche-Rigon, M. and White, I. R. (2018). Multiple imputation by chained equations for systematically and sporadically missing multilevel data. Statistical Methods in Medical Research, 27(6):1634-1649. <a href="https://doi.org/10.1177/0962280216666564">doi:10.1177/0962280216666564</a>
</p>


<h3>See Also</h3>

<p><code><a href="HH.html#topic+mice">mice</a></code>, <code><a href="#topic+mice.par">mice.par</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  data(CHEM97Na)
  
  ind.clust &lt;- 1#index for the cluster variable
  
  #initialisation of the argument predictorMatrix
  predictor.matrix &lt;- mice(CHEM97Na, m = 1, maxit = 0)$pred
  predictor.matrix[ind.clust,ind.clust] &lt;- 0
  predictor.matrix[-ind.clust,ind.clust] &lt;- -2
  predictor.matrix[predictor.matrix==1] &lt;- 2
  
  #initialisation of the argument method
  method &lt;- find.defaultMethod(CHEM97Na, ind.clust)
  print(method)
  
  #multiple imputation by chained equations (parallel calculation)
  #res.mice &lt;- mice.par(CHEM97Na, m = 3, predictorMatrix = predictor.matrix, method = method)

</code></pre>

<hr>
<h2 id='IPDNa'>
A simulated Individual Patient Data (IPD) meta-analysis with missing values.
</h2><span id='topic+IPDNa'></span>

<h3>Description</h3>

<p>This dataset is a simulated version of an IPD meta-analysis consisting of 28 studies focusing on risk factors in acute heart failure (GREAT, 2013). Each study includes a list of patient characteristics and potential risk factors. Each of them is incomplete, leading to sporadically missing values (Resche-Rigon, et al 2013). In addition, some variables have been collected on some studies only, leading to systematically missing values. More details on the original dataset are provided in Audigier et al. (2018). To mimic the real data, a general location model has been fitted on each study (Schafer, 1997). Then, each study has been generated according to the estimated parameters. Finally, missing values have been allocated similarly to the original dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("IPDNa")</code></pre>


<h3>Format</h3>

<p>A data frame with 11685 observations on the following 10 variables.
</p>

<dl>
<dt><code>centre</code></dt><dd><p>a numeric indexing the center where the study is conducted</p>
</dd>
<dt><code>gender</code></dt><dd><p>a factor with levels <code>0</code> <code>1</code></p>
</dd>
<dt><code>bmi</code></dt><dd><p>a numeric vector indicating the body mass index</p>
</dd>
<dt><code>age</code></dt><dd><p>a numeric vector indicating the age</p>
</dd>
<dt><code>sbp</code></dt><dd><p>a numeric vector indicating the systolic blood pressure</p>
</dd>
<dt><code>dbp</code></dt><dd><p>a numeric vector indicating the diastolic blood pressure</p>
</dd>
<dt><code>hr</code></dt><dd><p>a numeric vector indicating the heart rate</p>
</dd>
<dt><code>lvef</code></dt><dd><p>a numeric vector indicating the ventricular ejection fraction</p>
</dd>
<dt><code>bnp</code></dt><dd><p>a numeric vector indicating the level of the brain natriuretic peptide biomarker</p>
</dd>
<dt><code>afib</code></dt><dd><p>a factor with levels <code>0</code> <code>1</code> indicating the atrial fibrillation</p>
</dd>
</dl>



<h3>Details</h3>

<p>For more details, see Audigier et al. (2018)
</p>


<h3>Source</h3>

<p>GREAT Network (2013).  Managing acute heart failure in the ed - case studies
from the acute heart failure academy.  http://www.greatnetwork.org
</p>


<h3>References</h3>

<p>Audigier, V., White, I. ,  Jolani ,S.  Debray, T.,  Quartagno, M., Carpenter, J., van Buuren, S. and Resche-Rigon, M. Multiple imputation for multilevel data with continuous and binary variables (2018). Statistical Science. <a href="https://doi.org/10.1214/18-STS646">doi:10.1214/18-STS646</a>.
</p>
<p>Resche-Rigon, M., White, I. R., Bartlett, J., Peters, S., Thompson, S., and on behalf of the PROG-IMT Study Group (2013). Multiple imputation for handling systematically missing confounders in meta-analysis of individual participant data. Statistics in Medicine, 32(28):4890-4905. <a href="https://doi.org/10.1002/sim.5894">doi:10.1002/sim.5894</a>
</p>
<p>Schafer, J. L. (1997) Analysis of Incomplete Multivariate Data. Chapman &amp; Hall, Chapter 9.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(IPDNa)

#summary
summary(IPDNa)

#summary per study
by(IPDNa, IPDNa$centre, summary)
</code></pre>

<hr>
<h2 id='mice.impute.2l.2stage.bin'>
Imputation by a two-level logistic model based on a two-stage estimator
</h2><span id='topic+mice.impute.2l.2stage.bin'></span>

<h3>Description</h3>

<p>Imputes univariate two-level binary variable from a logistic model. The imputation method is based on a two-stage estimator: at step 1, a logistic regression model is fitted to each observed cluster; at step 2, estimates obtained from each cluster are combined according to a linear random effect model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mice.impute.2l.2stage.bin(y, ry, x, type, method_est = "mm", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mice.impute.2l.2stage.bin_+3A_y">y</code></td>
<td>

<p>Incomplete data vector of length <code>n</code>
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.bin_+3A_ry">ry</code></td>
<td>

<p>Vector of missing data pattern <code>(FALSE=missing, TRUE=observed)</code>
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.bin_+3A_x">x</code></td>
<td>

<p>Matrix <code>(n x p)</code> of complete covariates.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.bin_+3A_type">type</code></td>
<td>

<p>Vector of length <code>ncol(x)</code> identifying random and class variables. Random variables are identified by a '2'. The class variable (only one is allowed) is coded as '-2'. Random variables also include the fixed effect.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.bin_+3A_method_est">method_est</code></td>
<td>

<p>Vector of string given the version of the estimator to used. Choose <code>method_est="reml"</code> for restricted maximum likelihood estimator or <code>method_est="mm"</code> for the method of moments. By default <code>method_est="mm"</code>.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.bin_+3A_...">...</code></td>
<td>

<p>Other named arguments.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Imputes univariate two-level continuous variable from a heteroscedastic normal model. The imputation method is based on a two-stage estimator: at step 1, a linear regression model is fitted to each observed cluster; at step 2, estimates obtained from each cluster are combined according to a linear random effect model. Two possibilities are available to combine estimates at stage 2: by default, parameters of the linear random effect model are estimated according to the method of moments (MM), otherwise, parameters of the linear random effect model can be estimated according to the restricted maximum likelihood estimator (REML). The variability on the parameters of the imputation is propagated according to an asymptotic strategy requiring a large number of clusters. Compared to the REML version, the MM version is quicker to perform, but it provides less theoretical garanties. Nevertheless, simulation studies show that both versions lead to similar inferences (Audigier et al, 2018; Resche-Rigon, M. and White, I. R., 2016).
</p>


<h3>Value</h3>

<p>A vector of length <code>nmis</code> with imputations.
</p>


<h3>Author(s)</h3>

<p>Vincent Audigier <a href="mailto:vincent.audigier@cnam.fr">vincent.audigier@cnam.fr</a>
</p>


<h3>References</h3>

<p>Audigier, V., White, I. ,  Jolani ,S.  Debray, T.,  Quartagno, M., Carpenter, J., van Buuren, S. and Resche-Rigon, M.
Multiple imputation for multilevel data with continuous and binary variables (2018). Statistical Science. &lt;doi:10.1214/18-STS646&gt;.
</p>
<p>Resche-Rigon, M. and White, I. R. (2016). Multiple imputation by chained equations for systematically
and sporadically missing multilevel data. Statistical Methods in Medical Research.
To appear. &lt;doi:10.1177/0962280216666564&gt;
</p>


<h3>See Also</h3>

<p><code><a href="HH.html#topic+mice">mice</a>,<a href="#topic+mice.impute.2l.glm.bin">mice.impute.2l.glm.bin</a>,<a href="#topic+mice.impute.2l.jomo">mice.impute.2l.jomo</a></code>
</p>

<hr>
<h2 id='mice.impute.2l.2stage.heckman'>
Imputation based on Heckman model for multilevel data.
</h2><span id='topic+mice.impute.2l.2stage.heckman'></span>

<h3>Description</h3>

<p>Imputes both outcome or predictor incomplete variables that follow an indirectly non-ignorable Missing Not at Random (MNAR) mechanism, i.e., the likelihood of a missing value in the incomplete variable depends on other unobserved variable(s) that are also correlated with the incomplete variable. This imputation is based on Heckman's selection model and is suitable for multilevel databases, such as individual participant data, with both systematic or sporadic missing data.</p>


<h3>Usage</h3>

<pre><code class='language-R'>mice.impute.2l.2stage.heckman(y, ry, x, wy = NULL, type,
pmm = FALSE, ypmm = NULL, meta_method = "reml", pred_std = FALSE,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mice.impute.2l.2stage.heckman_+3A_y">y</code></td>
<td>

<p>Vector to be imputed
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.heckman_+3A_ry">ry</code></td>
<td>

<p>A logical vector of length <code>length(y)</code> indicating the subset <code>y[ry]</code> of elements in <code>y</code> to which the imputation model is fitted. The <code>ry</code> generally distinguishes the observed (<code>TRUE</code>) and missing values (<code>FALSE</code>) in <code>y</code>.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.heckman_+3A_x">x</code></td>
<td>

<p>A numeric design matrix with <code>length(y)</code> rows with predictors for <code>y</code>. Matrix <code>x</code> may have no missing values.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.heckman_+3A_wy">wy</code></td>
<td>

<p>A logical vector of length <code>length(y)</code>. A <code>TRUE</code> value indicates locations in <code>y</code> for which imputations are created.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.heckman_+3A_type">type</code></td>
<td>

<p>Type of the variable in the prediction model, which can be one of the following: No predictor (0), Cluster variable (-2), Predictor in both the outcome and selection equation (2), Predictor only in the selection equation (-3), Predictor only in the outcome equation (-4). In this method all predictors are considered random variables that also included the fixed effect.</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.heckman_+3A_pmm">pmm</code></td>
<td>

<p>A logical value that specifies whether the predictive mean matching method is applied.(default = &quot;FALSE&quot;). This method is only applicable to missing continuous variables.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.heckman_+3A_ypmm">ypmm</code></td>
<td>

<p>A continuous vector of donor values for y used in the predictive mean matching method. if ypmm is not provided, the observable values of y are used as donors.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.heckman_+3A_meta_method">meta_method</code></td>
<td>

<p>A character value that indicates the method for estimating meta_analysis random effects: &quot;ml&quot; (maximum likelihood), &quot;reml&quot; (restricted maximum likelihood) or &quot;mm&quot; (method of moments).
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.heckman_+3A_pred_std">pred_std</code></td>
<td>

<p>A logical value that indicates whether internally standardize the set of predictor variables (default = FALSE).
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.heckman_+3A_...">...</code></td>
<td>

<p>Other named arguments. Not used.
</p>
</td></tr></table>


<h3>Details</h3>

<p>This function imputes systematically and sporadically missing binary and continuous univariate variables that follow an MNAR mechanism according to the Heckman selection model. It is specifically designed for clustered datasets. The imputation method employs a two-stage approach in which the Heckman model parameters at the cluster level are estimated using the copula method.
</p>


<h3>Value</h3>

<p>Vector with imputed data, of type binary or continuous type
</p>


<h3>Note</h3>

<p>Missing binary variables should be included as two-level factor type variables in the incomplete dataset.The cluster variable should be included as a numeric variable in the dataset. When the cluster variable is not specified, the imputation method defaults to a simple Heckman model, which does not take in account the hierarchical structure. In cases where the Heckman model cannot be estimated at the hierarchical level, the imputation method reverts to the simple Heckman model.
</p>


<h3>Author(s)</h3>

<p>Julius Center Methods Group UMC, 2022 <a href="mailto:J.MunozAvila@umcutrecht.nl">J.MunozAvila@umcutrecht.nl</a>
</p>


<h3>References</h3>

<p>Munoz J,Hufstedler H,Gustafson P, Barnighausen T, De Jong V, Debray T. Dealing with missing data using the Heckman selection model: methods primer for epidemiologists.IJE,December 2022. <a href="https://doi.org/10.1093/ije/dyac237">doi:10.1093/ije/dyac237</a>.
</p>
<p>Munoz J, Egger M, Efthimiou O, Audigier V, De Jong V, Debray T. Multiple imputation of incomplete multilevel data using Heckman selection models, Jan 2023, <a href="https://doi.org/10.48550/arXiv.2301.05043">doi:10.48550/arXiv.2301.05043</a>.
</p>


<h3>See Also</h3>

<p><code><a href="HH.html#topic+mice">mice</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>require(mice)
require(nlme)
require(broom.mixed)
require(parallel)

# Load dataset
data(Obesity) 

# Define imputation methods for each incomplete variables
meth &lt;- find.defaultMethod(Obesity, ind.clust = 1)

# Modify some of the proposed imputation methods
# Deterministic imputation
meth["BMI"] &lt;- "~ I(Weight / (Height)^2)" 
meth["Age"] &lt;- "2l.2stage.pmm" 

# Set method, here Weight variable is assumed an MNAR variable
# Weight imputed with the Heckman method
meth["Weight"] &lt;- "2l.2stage.heckman" 

# Set type of predictor variable, 
# All covariates are included in both outcome and selection equation
ini &lt;- mice(Obesity, maxit = 0)
pred &lt;- ini$pred
pred[,"Time"] &lt;- 0
pred[,"Cluster"] &lt;- -2
pred[pred == 1] &lt;- 2

# Time was used as exclusion restriction variable 
pred["Weight","Time"]  &lt;- -3  
# Deterministic imputation, to avoid circular predictions
pred[c("Height", "Weight"), "BMI"] &lt;- 0 

# Imputation of continuous variables (time consumming)

# nnodes &lt;- detectCores()
# imp &lt;- mice.par(Obesity, meth = meth, pred = pred, m=10, seed = 123,
#                 nnodes = nnodes)
# summary(complete(imp,"long")$Weight)

# Imputation of continuous variables using the predictor mean matching method.
# Imputed values fall within the range of observable variables.

# imp_pmm &lt;- mice.par(Obesity, meth = meth, pred = pred, m = 10,
#                     seed = 123, pmm=TRUE, nnodes = nnodes) 
# summary(complete(imp_pmm,"long")$Weight)

# Fit the model

# model_MNAR &lt;- with(imp,lme( BMI ~ Age + FamOb + Gender,random=~1+Age|Cluster))
# model_MNAR_pmm &lt;- with(imp_pmm,lme( BMI ~ Age + FamOb + Gender,random=~1+Age|Cluster))

# summary(pool(model_MNAR))
# summary(pool(model_MNAR_pmm))
</code></pre>

<hr>
<h2 id='mice.impute.2l.2stage.norm'>
Imputation by a two-level heteroscedastic normal model based on a two-stage estimator
</h2><span id='topic+mice.impute.2l.2stage.norm'></span>

<h3>Description</h3>

<p>Imputes univariate two-level continuous variable from a heteroscedastic normal model. The imputation method is based on a two-stage estimator: at step 1, a linear regression model is fitted to each observed cluster; at step 2, estimates obtained from each cluster are combined according to a linear random effect model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mice.impute.2l.2stage.norm(y, ry, x, type, method_est = "mm", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mice.impute.2l.2stage.norm_+3A_y">y</code></td>
<td>

<p>Incomplete data vector of length <code>n</code>
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.norm_+3A_ry">ry</code></td>
<td>

<p>Vector of missing data pattern <code>(FALSE=missing, TRUE=observed)</code>
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.norm_+3A_x">x</code></td>
<td>

<p>Matrix <code>(n x p)</code> of complete covariates.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.norm_+3A_type">type</code></td>
<td>

<p>Vector of length <code>ncol(x)</code> identifying random and class variables. Random variables are identified by a '2'. The class variable (only one is allowed) is coded as '-2'. Random variables also include the fixed effect.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.norm_+3A_method_est">method_est</code></td>
<td>

<p>Vector of string given the version of the estimator to used. Choose <code>method_est="reml"</code> for restricted maximum likelihood estimator or <code>method_est="mm"</code> for the method of moments. By default <code>method_est="mm"</code>.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.norm_+3A_...">...</code></td>
<td>

<p>Other named arguments.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Imputes univariate two-level continuous variable from a heteroscedastic normal model. The imputation method is based on a two-stage estimator: at step 1, a linear regression model is fitted to each observed cluster; at step 2, estimates obtained from each cluster are combined according to a linear random effect model. Two possibilities are available to combine estimates at stage 2: by default, parameters of the linear random effect model are estimated according to the method of moments (MM), otherwise, parameters of the linear random effect model can be estimated according to the restricted maximum likelihood estimator (REML). The variability on the parameters of the imputation is propagated according to an asymptotic strategy requiring a large number of clusters. Compared to the REML version, the MM version is quicker to perform, but it provides less theoretical garanties. Nevertheless, simulation studies show that both versions lead to similar inferences (Resche-Rigon, M. and White, I. R. (2016)).
</p>


<h3>Value</h3>

<p>A vector of length <code>nmis</code> with imputations.
</p>


<h3>Author(s)</h3>

<p>Vincent Audigier <a href="mailto:vincent.audigier@cnam.fr">vincent.audigier@cnam.fr</a>
</p>


<h3>References</h3>

<p>Resche-Rigon, M. and White, I. R. (2016). Multiple imputation by chained equations for systematically
and sporadically missing multilevel data. Statistical Methods in Medical Research.
To appear. &lt;doi:10.1177/0962280216666564&gt;
</p>
<p>Audigier, V., White, I. ,  Jolani ,S.  Debray, T.,  Quartagno, M., Carpenter, J., van Buuren, S. and Resche-Rigon, M.
Multiple imputation for multilevel data with continuous and binary variables (2018). Statistical Science. &lt;doi:10.1214/18-STS646&gt;.
</p>


<h3>See Also</h3>

<p><code><a href="HH.html#topic+mice">mice</a>,<a href="#topic+mice.impute.2l.2stage.pmm">mice.impute.2l.2stage.pmm</a>,<a href="#topic+mice.impute.2l.glm.norm">mice.impute.2l.glm.norm</a>,<a href="#topic+mice.impute.2l.jomo">mice.impute.2l.jomo</a></code>
</p>

<hr>
<h2 id='mice.impute.2l.2stage.pmm'>
Predictive mean matching imputation for two-level variable
</h2><span id='topic+mice.impute.2l.2stage.pmm'></span>

<h3>Description</h3>

<p>Similarly to mice.impute.2l.stage.norm, this function imputes univariate two-level continuous variable from a heteroscedastic normal model. The difference consists in replacing missing values by observed values instead of adding a parametric noise to the prediction of a linear model with random effects (as done in mice.impute.2l.stage.norm.mm and mice.impute.2l.stage.norm.reml).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mice.impute.2l.2stage.pmm(y, ry, x, type,
                              method_est = "mm",
                              incluster = FALSE,
                              kpmm = 5, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mice.impute.2l.2stage.pmm_+3A_y">y</code></td>
<td>

<p>Incomplete data vector of length <code>n</code>
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.pmm_+3A_ry">ry</code></td>
<td>

<p>Vector of missing data pattern <code>(FALSE=missing, TRUE=observed)</code>
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.pmm_+3A_x">x</code></td>
<td>

<p>Matrix <code>(n x p)</code> of complete covariates.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.pmm_+3A_type">type</code></td>
<td>

<p>Vector of length <code>ncol(x)</code> identifying random and class variables. Random variables are identified by a '2'. The class variable (only one is allowed) is coded as '-2'. Random variables also include the fixed effect.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.pmm_+3A_method_est">method_est</code></td>
<td>

<p>Vector of string given the version of the estimator to used. Choose <code>method_est="reml"</code> for restricted maximum likelihood estimator or <code>method_est="mm"</code> for the method of moments. By default <code>method_est="mm"</code>.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.pmm_+3A_incluster">incluster</code></td>
<td>

<p>Boolean indicating if the imputed values are drawn from the cluster or from the full dataset. By default imputed values are drawn from all available clusters <code>incluster=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.pmm_+3A_kpmm">kpmm</code></td>
<td>

<p>The size of the donor pool among which a draw is made. The default is <code>k = 5</code>.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.pmm_+3A_...">...</code></td>
<td>

<p>Other named arguments.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Imputes univariate two-level continuous variable from observed values. The imputation method is based on a two-stage estimator: at step 1, a linear regression model is fitted to each observed cluster; at step 2, estimates obtained from each cluster are combined according to a linear random effect model. To combine estimates at stage 2, parameters of the linear random effect model are estimated according to the method of moments or according to the restricted maximum likelihood estimator. The variability on the parameters of the imputation is propagated according to an asymptotic strategy requiring a large number of clusters. The sample variability is reflected by using a predictive mean matching approach, meaning that missing values are imputed by a draw from observed values. The pool of <code>k</code> donors is defined according to the Manhattan distance between the prediction of the observation which is imputed and the predictions of other available observations (matching of type 2). The pool can be restricted to the cluster of the individual that is imputed or from all clusters. By drawing values inside the cluster, the heteroscedasticity assumption is preserved. Otherwise, the sample variability of imputed values is the same for all clusters, which strengthen the homoscedasticity assumption. Among the pool of <code>k</code> donors, the selected one is drawn at random.
</p>


<h3>Value</h3>

<p>Numeric vector of length  <code>sum(!ry)</code> with imputations
</p>


<h3>Note</h3>

<p>This method is experimental.
</p>


<h3>Author(s)</h3>

<p>Vincent Audigier <a href="mailto:vincent.audigier@cnam.fr">vincent.audigier@cnam.fr</a>
</p>


<h3>References</h3>

<p>Rubin, D.B. (1987). Multiple imputation for nonresponse in surveys. New York: Wiley.
</p>
<p>Resche-Rigon, M. and White, I. R. (2016). Multiple imputation by chained equations for systematically
and sporadically missing multilevel data. Statistical Methods in Medical Research.
To appear. &lt;doi:10.1177/0962280216666564&gt;
</p>
<p>Audigier, V., White, I. ,  Jolani ,S.  Debray, T.,  Quartagno, M., Carpenter, J., van Buuren, S. and Resche-Rigon, M.
Multiple imputation for multilevel data with continuous and binary variables (2018). Statistical Science. &lt;doi:10.1214/18-STS646&gt;.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mice.impute.2l.2stage.norm">mice.impute.2l.2stage.norm</a></code>
</p>

<hr>
<h2 id='mice.impute.2l.2stage.pois'>
Imputation by a two-level Poisson model based on a two-stage estimator
</h2><span id='topic+mice.impute.2l.2stage.pois'></span>

<h3>Description</h3>

<p>Imputes univariate two-level count variable from a Poisson model. The imputation method is based on a two-stage estimator: at step 1, a Poisson regression model is fitted to each observed cluster; at step 2, estimates obtained from each cluster are combined according to a linear random effect model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mice.impute.2l.2stage.pois(y, ry, x, type, method_est = "mm", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mice.impute.2l.2stage.pois_+3A_y">y</code></td>
<td>

<p>Incomplete data vector of length <code>n</code>
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.pois_+3A_ry">ry</code></td>
<td>

<p>Vector of missing data pattern <code>(FALSE=missing, TRUE=observed)</code>
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.pois_+3A_x">x</code></td>
<td>

<p>Matrix <code>(n x p)</code> of complete covariates.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.pois_+3A_type">type</code></td>
<td>

<p>Vector of length <code>ncol(x)</code> identifying random and class variables. Random variables are identified by a '2'. The class variable (only one is allowed) is coded as '-2'. Random variables also include the fixed effect.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.pois_+3A_method_est">method_est</code></td>
<td>

<p>Vector of string given the version of the estimator to used. Choose <code>method_est="reml"</code> for restricted maximum likelihood estimator or <code>method_est="mm"</code> for the method of moments. By default <code>method_est="mm"</code>.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.2stage.pois_+3A_...">...</code></td>
<td>

<p>Other named arguments.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Imputes univariate two-level count variable from a Poisson model. The imputation method is based on a two-stage estimator: at step 1, a Poisson regression model is fitted to each observed cluster; at step 2, estimates obtained from each cluster are combined according to a linear random effect model. Two possibilities are available to combine estimates at stage 2: by default, parameters of the linear random effect model are estimated according to the method of moments (MM), otherwise, parameters of the linear random effect model can be estimated according to the restricted maximum likelihood estimator (REML). The variability on the parameters of the imputation is propagated according to an asymptotic strategy requiring large samples and a large number of clusters. Compared to the REML version, the MM version is quicker to perform, but it provides less theoretical garanties. Nevertheless, simulation studies show that both versions lead to similar inferences (Audigier et al, 2018; Resche-Rigon and White, 2016).
</p>


<h3>Value</h3>

<p>A vector of length <code>nmis</code> with imputations.
</p>


<h3>Author(s)</h3>

<p>Vincent Audigier <a href="mailto:vincent.audigier@cnam.fr">vincent.audigier@cnam.fr</a>
</p>


<h3>References</h3>

<p>Resche-Rigon, M. and White, I. R. (2016). Multiple imputation by chained equations for systematically
and sporadically missing multilevel data. Statistical Methods in Medical Research.
To appear. &lt;doi:10.1177/0962280216666564&gt;
</p>
<p>Audigier, V., White, I. ,  Jolani ,S.  Debray, T.,  Quartagno, M., Carpenter, J., van Buuren, S. and Resche-Rigon, M.
Multiple imputation for multilevel data with continuous and binary variables (2018). Statistical Science. &lt;doi:10.1214/18-STS646&gt;.
</p>


<h3>See Also</h3>

<p><code><a href="HH.html#topic+mice">mice</a>,<a href="#topic+mice.impute.2l.glm.pois">mice.impute.2l.glm.pois</a></code>
</p>

<hr>
<h2 id='mice.impute.2l.glm.bin'>
Imputation of univariate missing data using a Bayesian logistic mixed model based on non-informative prior distributions
</h2><span id='topic+mice.impute.2l.glm.bin'></span>

<h3>Description</h3>

<p>Imputes univariate missing data using a Bayesian logistic mixed model based on non-informative prior distributions. The method is dedicated to a binary outcome stratified in severals clusters. Should be used with few clusters and few individuals per cluster. Can be very slow to perform otherwise.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mice.impute.2l.glm.bin(y, ry, x, type, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mice.impute.2l.glm.bin_+3A_y">y</code></td>
<td>

<p>Incomplete data vector of length <code>n</code>
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.glm.bin_+3A_ry">ry</code></td>
<td>

<p>Vector of missing data pattern <code>(FALSE=missing, TRUE=observed)</code>
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.glm.bin_+3A_x">x</code></td>
<td>

<p>Matrix <code>(n x p)</code> of complete covariates.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.glm.bin_+3A_type">type</code></td>
<td>

<p>Vector of length <code>ncol(x)</code> identifying random and class variables. Random variables are identified by a '2'. The class variable (only one is allowed) is coded as '-2'. Random variables also include the fixed effect.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.glm.bin_+3A_...">...</code></td>
<td>

<p>Other named arguments.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Imputes univariate missing data using a Bayesian logistic mixed model based on non-informative prior distributions. The variability on the parameters of the imputation is propagated according to an explicit Bayesian modelling. More precisely, improper prior distributions are used for regression coefficients and covariance matrix of random effects. The method is recommended for datasets with a small number of clusters and a small number of individuals per cluster. Otherwise, the method can be very slow to perform.
</p>


<h3>Value</h3>

<p>A vector of length <code>nmis</code> with imputations.
</p>


<h3>Author(s)</h3>

<p>Vincent Audigier <a href="mailto:vincent.audigier@cnam.fr">vincent.audigier@cnam.fr</a> from the R code of Shahab Jolani.
</p>


<h3>References</h3>

<p>Jolani, S., Debray, T. P. A., Koffijberg, H., van Buuren, S., and Moons, K. G. M. (2015). Imputation of systematically missing predictors in an individual participant data meta-analysis: a generalized approach using MICE. Statistics in Medicine, 34(11):1841-1863. <a href="https://doi.org/10.1002/sim.6451">doi:10.1002/sim.6451</a>
</p>
<p>Audigier, V., White, I. ,  Jolani ,S.  Debray, T.,  Quartagno, M., Carpenter, J., van Buuren, S. and Resche-Rigon, M. Multiple imputation for multilevel data with continuous and binary variables (2018). Statistical Science. <a href="https://doi.org/10.1214/18-STS646">doi:10.1214/18-STS646</a>.
</p>


<h3>See Also</h3>

<p><code><a href="HH.html#topic+mice">mice</a>,<a href="#topic+mice.impute.2l.2stage.bin">mice.impute.2l.2stage.bin</a>,<a href="#topic+mice.impute.2l.jomo">mice.impute.2l.jomo</a></code>
</p>

<hr>
<h2 id='mice.impute.2l.glm.norm'>
Imputation of univariate missing data using a Bayesian linear mixed model based on non-informative prior distributions
</h2><span id='topic+mice.impute.2l.glm.norm'></span>

<h3>Description</h3>

<p>Imputes univariate missing data using a Bayesian linear mixed model based on non-informative prior distributions. The method is dedicated to a continuous outcome stratified in severals clusters. Should be used with few clusters and few individuals per cluster. Can be very slow to perform otherwise.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mice.impute.2l.glm.norm(y, ry, x, type,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mice.impute.2l.glm.norm_+3A_y">y</code></td>
<td>

<p>Incomplete data vector of length <code>n</code>
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.glm.norm_+3A_ry">ry</code></td>
<td>

<p>Vector of missing data pattern <code>(FALSE=missing, TRUE=observed)</code>
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.glm.norm_+3A_x">x</code></td>
<td>

<p>Matrix <code>(n x p)</code> of complete covariates.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.glm.norm_+3A_type">type</code></td>
<td>

<p>Vector of length <code>ncol(x)</code> identifying random and class variables. Random variables are identified by a '2'. The class variable (only one is allowed) is coded as '-2'. Random variables also include the fixed effect.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.glm.norm_+3A_...">...</code></td>
<td>

<p>Other named arguments.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Imputes univariate two-level continuous variable from a homoscedastic normal model. The variability on the parameters of the imputation is propagated according to an explicit Bayesian modelling. More precisely, improper prior distributions are used for regression coefficients and variances components. The method is recommended for datasets with a small number of clusters and a small number of individuals per cluster. Otherwise, confidence intervals after applying analysis method on the multiply imputed dataset tend to be anti-conservative. In addition, the imputation can be highly time consumming.
</p>


<h3>Value</h3>

<p>A vector of length <code>nmis</code> with imputations.
</p>


<h3>Author(s)</h3>

<p>Vincent Audigier <a href="mailto:vincent.audigier@cnam.fr">vincent.audigier@cnam.fr</a> from the R code of Shahab Jolani.
</p>


<h3>References</h3>

<p>Jolani, S. (2017) Hierarchical imputation of systematically and sporadically missing data: An approximate Bayesian approach using chained equations. Biometrical Journal <a href="https://doi.org/10.1002/bimj.201600220">doi:10.1002/bimj.201600220</a>
</p>
<p>Jolani, S., Debray, T. P. A., Koffijberg, H., van Buuren, S., and Moons, K. G. M. (2015). Imputation of systematically missing predictors in an individual participant data meta-analysis: a generalized approach using MICE. Statistics in Medicine, 34(11):1841-1863. <a href="https://doi.org/10.1002/sim.6451">doi:10.1002/sim.6451</a>
</p>
<p>Audigier, V., White, I. ,  Jolani ,S.  Debray, T.,  Quartagno, M., Carpenter, J., van Buuren, S. and Resche-Rigon, M. Multiple imputation for multilevel data with continuous and binary variables (2018). Statistical Science. <a href="https://doi.org/10.1214/18-STS646">doi:10.1214/18-STS646</a>.
</p>


<h3>See Also</h3>

<p><code><a href="HH.html#topic+mice">mice</a>,<a href="#topic+mice.impute.2l.2stage.norm">mice.impute.2l.2stage.norm</a>,<a href="#topic+mice.impute.2l.jomo">mice.impute.2l.jomo</a></code>
</p>

<hr>
<h2 id='mice.impute.2l.glm.pois'>
Imputation of count variable using a Bayesian mixed model based on non-informative prior distributions
</h2><span id='topic+mice.impute.2l.glm.pois'></span>

<h3>Description</h3>

<p>Imputes univariate missing data using a Bayesian mixed model (Poisson regression) based on non-informative prior distributions. The method is dedicated to a count outcome stratified in severals clusters. Should be used with few clusters and few individuals per cluster. Can be very slow to perform otherwise.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mice.impute.2l.glm.pois(y, ry, x, type,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mice.impute.2l.glm.pois_+3A_y">y</code></td>
<td>

<p>Incomplete data vector of length <code>n</code>
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.glm.pois_+3A_ry">ry</code></td>
<td>

<p>Vector of missing data pattern <code>(FALSE=missing, TRUE=observed)</code>
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.glm.pois_+3A_x">x</code></td>
<td>

<p>Matrix <code>(n x p)</code> of complete covariates.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.glm.pois_+3A_type">type</code></td>
<td>

<p>Vector of length <code>ncol(x)</code> identifying random and class variables. Random variables are identified by a '2'. The class variable (only one is allowed) is coded as '-2'. Random variables also include the fixed effect.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.glm.pois_+3A_...">...</code></td>
<td>

<p>Other named arguments.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Imputes univariate missing data using a Bayesian mixed model (Poisson regression) based on non-informative prior distributions. The variability on the parameters of the imputation is propagated according to an explicit Bayesian modelling. More precisely, improper prior distributions are used for regression coefficients and variances components. The method is recommended for datasets with a small number of clusters and a small number of individuals per cluster. Otherwise, the method can be very slow to perform.
</p>


<h3>Value</h3>

<p>A vector of length <code>nmis</code> with imputations.
</p>


<h3>Author(s)</h3>

<p>Vincent Audigier <a href="mailto:vincent.audigier@cnam.fr">vincent.audigier@cnam.fr</a> from the R code of Shahab Jolani.
</p>


<h3>References</h3>

<p>Jolani, S., Debray, T. P. A., Koffijberg, H., van Buuren, S., and Moons, K. G. M. (2015). Imputation of systematically missing predictors in an individual participant data meta-analysis: a generalized approach using MICE. Statistics in Medicine, 34(11):1841-1863. <a href="https://doi.org/10.1002/sim.6451">doi:10.1002/sim.6451</a>
</p>


<h3>See Also</h3>

<p><code><a href="HH.html#topic+mice">mice</a>,<a href="#topic+mice.impute.2l.2stage.pois">mice.impute.2l.2stage.pois</a></code>
</p>

<hr>
<h2 id='mice.impute.2l.jomo'>
Imputation of univariate missing data by a Bayesian multivariate generalized model based on conjugate priors
</h2><span id='topic+mice.impute.2l.jomo'></span>

<h3>Description</h3>

<p>Univariate imputation by a Bayesian multivariate generalized model based on conjugate priors. Can be used for a continuous or binary incomplete variable. For continuous variables, the modelling assumes heteroscedasticity for errors. For a binary variable, a probit link and a latent variables framework are used. The method should be used for a variable with large number of clusters and a large number of individuals per cluster.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mice.impute.2l.jomo(y, ry, x, type, nburn = 200, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mice.impute.2l.jomo_+3A_y">y</code></td>
<td>

<p>Incomplete data vector of length <code>n</code>
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.jomo_+3A_ry">ry</code></td>
<td>

<p>Vector of missing data pattern <code>(FALSE=missing, TRUE=observed)</code>
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.jomo_+3A_x">x</code></td>
<td>

<p>Matrix <code>(n x p)</code> of complete covariates.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.jomo_+3A_type">type</code></td>
<td>

<p>Vector of length <code>ncol(x)</code> identifying random and class variables. Random variables are identified by a '2'. The class variable (only one is allowed) is coded as '-2'. Random variables also include the fixed effect.
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.jomo_+3A_nburn">nburn</code></td>
<td>

<p>A scalar indicating the number of iterations for the Gibbs sampler. Default is <code>nburn=200</code>
</p>
</td></tr>
<tr><td><code id="mice.impute.2l.jomo_+3A_...">...</code></td>
<td>

<p>Other named arguments.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Contrary to the approach developped in the R jomo package, the imputation is here sequentially performed through a FCS approach, instead of imputing all variables simulatenously. The motivation for such a method is that jomo presents some advantages over other imputation methods, but not always for any type of variables (binary or continuous). By proposing a FCS version of jomo, we allow imputation of mixed variables (continuous and binary), while taking the best of jomo and of other imputation methods. To impute one variable according to this method, other variables are assumed to be full, like in any FCS approach. The imputation function is a direct use of the R function jomo1ran from the jomo package. The argument <code>meth</code> is tuned to &quot;random&quot; to allow covariance matrices drawn from an inverse Wishart distribution. Only intercept are considered in covariates (<code>X=NULL</code> and <code>Z=NULL</code>), while the multivariate outcome corresponds to all variables of the datasets.
</p>


<h3>Value</h3>

<p>A vector of length <code>nmis</code> with imputations.
</p>


<h3>Author(s)</h3>

<p>Vincent Audigier <a href="mailto:vincent.audigier@cnam.fr">vincent.audigier@cnam.fr</a> from the R code of Matteo Quartagno.
</p>


<h3>References</h3>

<p>Carpenter J.R., Kenward M.G., (2013), Multiple Imputation and its Application. Chapters 3-5-9, Wiley, ISBN: 978-0-470-74052-1.
</p>
<p>Yucel R.M., (2011), Random-covariances and mixed-effects models for imputing multivariate multilevel continuous data, Statistical Modelling, 11 (4), 351-370, &lt;doi:10.1177/1471082X100110040&gt;.
</p>


<h3>See Also</h3>

<p><code><a href="HH.html#topic+mice">mice</a>,jomo1ran</code>
</p>

<hr>
<h2 id='mice.par'>
Parallel calculations for Multivariate Imputation by Chained Equations
</h2><span id='topic+mice.par'></span>

<h3>Description</h3>

<p>Parallel calculations for Multivariate Imputation by Chained Equations using the R package <code>parallel</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mice.par(don.na, m = 5, method = NULL, predictorMatrix, where = NULL,
visitSequence = NULL, blots = NULL, post = NULL, blocks, formulas,
defaultMethod = c("pmm", "logreg", "polyreg", "polr"), maxit = 5,
seed = NA, data.init = NULL, nnodes = 5, path.outfile = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mice.par_+3A_don.na">don.na</code></td>
<td>

<p>A data frame or a matrix containing the incomplete data.  Missing
values are coded as <code>NA</code>.
</p>
</td></tr>
<tr><td><code id="mice.par_+3A_m">m</code></td>
<td>

<p>Number of multiple imputations. The default is <code>m=5</code>.
</p>
</td></tr>
<tr><td><code id="mice.par_+3A_method">method</code></td>
<td>

<p>Can be either a single string, or a vector of strings with
length <code>ncol(data)</code>, specifying the elementary imputation method to be
used for each column in data. If specified as a single string, the same
method will be used for all columns.  The default imputation method (when no
argument is specified) depends on the measurement level of the target column
and are specified by the <code>defaultMethod</code> argument.  Columns that need
not be imputed have the empty method <code>''</code>.  See details for more
information.
</p>
</td></tr>
<tr><td><code id="mice.par_+3A_predictormatrix">predictorMatrix</code></td>
<td>

<p>A square matrix of size <code>ncol(data)</code> containing
0/1 data specifying the set of predictors to be used for each target column.
Rows correspond to target variables (i.e. variables to be imputed), in the
sequence as they appear in data. A value of '1' means that the column
variable is used as a predictor for the target variable (in the rows). The
diagonal of <code>predictorMatrix</code> must be zero. The default for
<code>predictorMatrix</code> is that all other columns are used as predictors
(sometimes called massive imputation). Note: For two-level imputation codes
'2' and '-2' are also allowed.
</p>
</td></tr>
<tr><td><code id="mice.par_+3A_where">where</code></td>
<td>
<p>A data frame or matrix with logicals of the same dimensions 
as <code>data</code> indicating where in the data the imputations should be 
created. The default, <code>where = is.na(data)</code>, specifies that the
missing data should be imputed. The <code>where</code> argument may be used to 
overimpute observed data, or to skip imputations for selected missing values.</p>
</td></tr>
<tr><td><code id="mice.par_+3A_visitsequence">visitSequence</code></td>
<td>

<p>A vector of integers of arbitrary length, specifying the
column indices of the visiting sequence. The visiting sequence is the column
order that is used to impute the data during one pass through the data. A
column may be visited more than once. All incomplete columns that are used as
predictors should be visited, or else the function will stop with an error.
The default sequence <code>1:ncol(data)</code> implies that columns are imputed
from left to right. It is possible to specify one of the keywords
<code>'roman'</code> (left to right), <code>'arabic'</code> (right to left),
<code>'monotone'</code> (sorted in increasing amount of missingness) and
<code>'revmonotone'</code> (reverse of monotone). The keyword should be supplied as
a string and may be abbreviated.
</p>
</td></tr>
<tr><td><code id="mice.par_+3A_blots">blots</code></td>
<td>
<p>A named <code>list</code> of <code>alist</code>'s that can be used 
to pass down arguments to lower level imputation function. The entries
of element <code>blots[[blockname]]</code> are passed down to the function
called for block <code>blockname</code>.</p>
</td></tr>
<tr><td><code id="mice.par_+3A_post">post</code></td>
<td>

<p>A vector of strings with length <code>ncol(data)</code>, specifying
expressions. Each string is parsed and executed within the <code>sampler()</code>
function to postprocess imputed values.  The default is to do nothing,
indicated by a vector of empty strings <code>''</code>.
</p>
</td></tr>
<tr><td><code id="mice.par_+3A_blocks">blocks</code></td>
<td>
<p>List of vectors with variable names per block. List elements 
may be named to identify blocks. Variables within a block are 
imputed by a multivariate imputation method
(see <code>method</code> argument). By default each variable is placed 
into its own block, which is effectively
fully conditional specification (FCS) by univariate models 
(variable-by-variable imputation). Only variables whose names appear in 
<code>blocks</code> are imputed. The relevant columns in the <code>where</code> 
matrix are set to <code>FALSE</code> of variables that are not block members. 
A variable may appear in multiple blocks. In that case, it is 
effectively re-imputed each time that it is visited.</p>
</td></tr>
<tr><td><code id="mice.par_+3A_formulas">formulas</code></td>
<td>
<p>A named list of formula's, or expressions that
can be converted into formula's by <code>as.formula</code>. List elements
correspond to blocks. The block to which the list element applies is 
identified by its name, so list names must correspond to block names.
The <code>formulas</code> argument is an alternative to the 
<code>predictorMatrix</code> argument that allows for more flexibility in 
specifying imputation models, e.g., for specifying interaction terms.</p>
</td></tr>
<tr><td><code id="mice.par_+3A_defaultmethod">defaultMethod</code></td>
<td>

<p>A vector of three strings containing the default
imputation methods for numerical columns, factor columns with 2 levels, and
columns with (unordered or ordered) factors with more than two levels,
respectively. If nothing is specified, the following defaults will be used:
<code>pmm</code>, predictive mean matching (numeric data) <code>logreg</code>, logistic
regression imputation (binary data, factor with 2 levels) <code>polyreg</code>,
polytomous regression imputation for unordered categorical data (factor &gt;= 2
levels) <code>polr</code>, proportional odds model for (ordered, &gt;= 2 levels)
</p>
</td></tr>
<tr><td><code id="mice.par_+3A_maxit">maxit</code></td>
<td>

<p>A scalar giving the number of iterations. The default is 5.
</p>
</td></tr>
<tr><td><code id="mice.par_+3A_seed">seed</code></td>
<td>
<p>An integer that is used as argument by the <code>set.seed()</code> for
offsetting the random number generator. Default is to leave the random number
generator alone.</p>
</td></tr>
<tr><td><code id="mice.par_+3A_data.init">data.init</code></td>
<td>
<p>A data frame of the same size and type as <code>data</code>,
without missing data, used to initialize imputations before the start of the
iterative process.  The default <code>NULL</code> implies that starting imputation
are created by a simple random draw from the data. Note that specification of
<code>data.init</code> will start the <code>m</code> Gibbs sampling streams from the same
imputations.</p>
</td></tr>
<tr><td><code id="mice.par_+3A_nnodes">nnodes</code></td>
<td>
<p>A scalar indicating the number of nodes for parallel calculation. Default value is 5.</p>
</td></tr>
<tr><td><code id="mice.par_+3A_path.outfile">path.outfile</code></td>
<td>
<p>A vector of strings indicating the path for redirection of print messages. Default value is NULL, meaning that silent imputation is performed. Otherwise, print messages are saved in the files path.outfile/output.txt. One file per node is generated.</p>
</td></tr>
<tr><td><code id="mice.par_+3A_...">...</code></td>
<td>
<p>Named arguments that are passed down to the elementary imputation functions.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Performs multiple imputation of <code>m</code> tables in parallel by generating <code>m</code> seeds, and then by performing multiple imputation by chained equations in parallel from each one. The output is the same as the <code>mice</code> function of the mice package.
</p>


<h3>Value</h3>

<p>Returns an S3 object of class <code>mids</code> (multiply imputed data set)
</p>


<h3>Author(s)</h3>

<p>Vincent Audigier <a href="mailto:vincent.audigier@cnam.fr">vincent.audigier@cnam.fr</a>
</p>


<h3>References</h3>

<p>Van Buuren, S., Groothuis-Oudshoorn, K. (2011). <code>mice</code>:
Multivariate Imputation by Chained Equations in <code>R</code>. <em>Journal of
Statistical Software</em>, <b>45</b>(3), 1-67.
<a href="https://www.jstatsoft.org/article/view/v045i03">https://www.jstatsoft.org/article/view/v045i03</a> &lt;doi:10.18637/jss.v045.i03&gt;
</p>
<p>van Buuren, S. (2012). <em>Flexible Imputation of Missing Data.</em> Boca
Raton, FL: Chapman &amp; Hall/CRC Press.
</p>
<p>Van Buuren, S., Brand, J.P.L., Groothuis-Oudshoorn C.G.M., Rubin, D.B. (2006)
Fully conditional specification in multivariate imputation.  <em>Journal of
Statistical Computation and Simulation</em>, <b>76</b>, 12, 1049&ndash;1064. &lt;doi:10.1080/10629360600810434&gt;
</p>
<p>Van Buuren, S. (2007) Multiple imputation of discrete and continuous data by
fully conditional specification.  <em>Statistical Methods in Medical
Research</em>, <b>16</b>, 3, 219&ndash;242. &lt;doi:10.1177/0962280206074463&gt;
</p>
<p>Van Buuren, S., Boshuizen, H.C., Knook, D.L. (1999) Multiple imputation of
missing blood pressure covariates in survival analysis.  <em>Statistics in
Medicine</em>, <b>18</b>, 681&ndash;694. &lt;doi:10.1002/(SICI)1097-0258(19990330)18:6&lt;681::AID-SIM71&gt;3.0.CO;2-R&gt;
</p>
<p>Brand, J.P.L. (1999) <em>Development, implementation and evaluation of
multiple imputation strategies for the statistical analysis of incomplete
data sets.</em> Dissertation. Rotterdam: Erasmus University.
</p>


<h3>See Also</h3>

<p><code><a href="HH.html#topic+mice">mice</a>,<a href="lattice.html#topic+parallel">parallel</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  ##############
  # nhanes (one level data)
  ##############
  data(nhanes, package = "mice")
  #imp &lt;- mice.par(nhanes)
  #fit &lt;- with(data = imp, exp = lm(bmi ~ hyp + chl))
  #summary(pool(fit))
  
  ##############
  #CHEM97Na (Two levels data with 1681 observations and 5 variables)
  ##############
  
  data(CHEM97Na)
  
  ind.clust&lt;-1#index for the cluster variable
  
  #initialisation of the argument predictorMatrix
  predictor.matrix&lt;-mice(CHEM97Na,m=1,maxit=0)$pred
  predictor.matrix[ind.clust,ind.clust]&lt;-0
  predictor.matrix[-ind.clust,ind.clust]&lt;- -2
  predictor.matrix[predictor.matrix==1]&lt;-2
  
  #initialisation of the argument method
  method&lt;-find.defaultMethod(CHEM97Na,ind.clust)
  
  #multiple imputation by chained equations (parallel calculation) [1 minute]
  #(the imputation process can be followed by opening output.txt files in the working directory)
  #res.mice&lt;-mice.par(CHEM97Na,
  #                  predictorMatrix = predictor.matrix,
  #                  method=method,
  #                  path.outfile=getwd())

  
  #multiple imputation by chained equations (without parallel calculation) [4.8 minutes]
  #res.mice&lt;-mice(CHEM97Na,
  #                  predictorMatrix = predictor.matrix,
  #                  method=method)

  
  
  ############
  #IPDNa (Two levels data with 11685 observations and 10 variables)
  ############
  
  data(IPDNa)
  
  ind.clust&lt;-1#index for the cluster variable

  #initialisation of the argument predictorMatrix
  predictor.matrix&lt;-mice(IPDNa,m=1,maxit=0)$pred
  predictor.matrix[ind.clust,ind.clust]&lt;-0
  predictor.matrix[-ind.clust,ind.clust]&lt;- -2
  predictor.matrix[predictor.matrix==1]&lt;-2

  #initialisation of the argument method
  method&lt;-find.defaultMethod(IPDNa,ind.clust)

  #multiple imputation by chained equations (parallel calculation)

  #res.mice&lt;-mice.par(IPDNa,
  #                 predictorMatrix = predictor.matrix,
  #                 method=method,
  #                 path.outfile=getwd())
</code></pre>

<hr>
<h2 id='micemd-package'>
Multiple Imputation by Chained Equations with Multilevel Data
</h2><span id='topic+micemd-package'></span><span id='topic+micemd'></span>

<h3>Description</h3>

<p>Addons for the mice package to perform multiple imputation using chained equations with two-level data. Includes imputation methods specifically handling sporadically and systematically missing values (Resche-Rigon et al. 2013). Imputation of continuous, binary or count variables are available. Following the recommendations of Audigier, V. et al (2018), the choice of the imputation method for each variable can be facilitated by a default choice tuned according to the structure of the incomplete dataset. Allows parallel calculation for mice.
</p>


<h3>Author(s)</h3>

<p>Vincent Audigier, Matthieu Resche-Rigon
</p>
<p>Maintainer: Vincent Audigier &lt;vincent.audigier@cnam.fr&gt;
</p>


<h3>References</h3>

<p>Audigier, V., White, I. ,  Jolani ,S.  Debray, T.,  Quartagno, M., Carpenter, J., van Buuren, S. and Resche-Rigon, M.
Multiple imputation for multilevel data with continuous and binary variables (2018). Statistical Science. <a href="https://doi.org/10.1214/18-STS646">doi:10.1214/18-STS646</a>.
</p>
<p>Jolani, S., Debray, T. P. A., Koffijberg, H., van Buuren, S., and Moons, K. G. M. (2015). Imputation of systematically missing predictors in an individual participant data meta-analysis: a generalized approach using MICE. Statistics in Medicine, 34(11):1841-1863. <a href="https://doi.org/10.1002/sim.6451">doi:10.1002/sim.6451</a>
</p>
<p>Quartagno, M. and Carpenter, J. R. (2016). jomo: A package for Multilevel Joint Modelling Multiple Imputation.
</p>
<p>Quartagno, M. and Carpenter, J. R. (2016). Multiple imputation for IPD meta-analysis: allowing for heterogeneity and studies with missing covariates. Statistics in Medicine, 35(17):2938-2954. <a href="https://doi.org/10.1002/sim.6837">doi:10.1002/sim.6837</a>
</p>
<p>Resche-Rigon, M. and White, I. R. (2016). Multiple imputation by chained equations for systematically and sporadically missing multilevel data. Statistical Methods in Medical Research, 27(6):1634-1649. <a href="https://doi.org/10.1177/0962280216666564">doi:10.1177/0962280216666564</a>
</p>
<p>Resche-Rigon, M., White, I. R., Bartlett, J., Peters, S., Thompson, S., and on behalf of the PROG-IMT Study Group (2013). Multiple imputation for handling systematically missing confounders in meta-analysis of individual participant data. Statistics in Medicine, 32(28):4890-4905. <a href="https://doi.org/10.1002/sim.5894">doi:10.1002/sim.5894</a>
</p>
<p>Van Buuren, S., Groothuis-Oudshoorn, K. (2011). mice: Multivariate Imputation by Chained Equations in R. Journal of Statistical Software, 45(3), 1-67. <a href="https://doi.org/10.18637/jss.v045.i03">doi:10.18637/jss.v045.i03</a>. http://www.jstatsoft.org/v45/i03/
</p>


<h3>See Also</h3>

<p><code><a href="HH.html#topic+mice">mice</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  require(lme4)
  data(CHEM97Na)
  
  ind.clust &lt;- 1#index for the cluster variable
  
  #initialisation of the argument predictorMatrix
  predictor.matrix&lt;-mice(CHEM97Na,m=1,maxit=0)$pred
  predictor.matrix[ind.clust,ind.clust] &lt;- 0
  predictor.matrix[-ind.clust,ind.clust]&lt;- -2
  predictor.matrix[predictor.matrix==1] &lt;- 2
  
  #initialisation of the argument method
  method&lt;-find.defaultMethod(CHEM97Na,ind.clust)
  
  #multiple imputation by chained equations (parallel calculation) [time consumming]
  #res.mice &lt;- mice.par(CHEM97Na, predictorMatrix = predictor.matrix,
  #                   method=method)
  
  #check convergence
  #plot(res.mice)
  
  #analysis (apply a generalized linear mixed effects model to each imputed dataset)
  #ana &lt;- with(res.mice, expr=glmer(Score~Sex+GSCE+(1|School),
  #                            family="poisson",
  #                            control=glmerControl(optimizer = "bobyqa")))
                              
  #check the number of generated tables
  #plot(ana)

  #pooling
  #res.pool &lt;- pool(ana)
  #summary(res.pool)
</code></pre>

<hr>
<h2 id='Obesity'>A two-level incomplete dataset based on an online obesity survey</h2><span id='topic+Obesity'></span>

<h3>Description</h3>

<p>This synthetic dataset was generated from an online survey on obesity, which collected information on the dietary behavior of 2111 participants. We made the assumption that the data was gathered from five distinct locations or clusters. To account for potential selection bias in the responses related to weight, we simulated the values and observability of this variable using the Heckman selection model within a hierarchical structure.
</p>
<p>Additionally, we assumed that in one of the locations, the weight variable was systematically missing. We also introduced missing values for some other variables in the dataset using a Missing at Random (MAR) mechanism.
</p>


<h3>Format</h3>

<p>A dataframe with 2111 observations with the following variables:
</p>

<table>
<tr>
 <td style="text-align: right;">
     </td><td style="text-align: left;"> Gender </td><td style="text-align: left;"> a factor variable with two levels: 1 ("Female"), 0 ("Male").</td>
</tr>
<tr>
 <td style="text-align: right;">
     </td><td style="text-align: left;"> Age </td><td style="text-align: left;"> a numeric variable indicating the subject's age in years.</td>
</tr>
<tr>
 <td style="text-align: right;">
     </td><td style="text-align: left;"> Height</td><td style="text-align: left;"> a numeric value with Height in meters.</td>
</tr>
<tr>
 <td style="text-align: right;">
     </td><td style="text-align: left;"> FamOb</td><td style="text-align: left;"> a factor variable describing the subject's family history of obesity with two levels: 1("Yes"), 0("No").</td>
</tr>
<tr>
 <td style="text-align: right;">
     </td><td style="text-align: left;"> Weight</td><td style="text-align: left;"> a numeric variable indicating the subject's weight in kilograms.</td>
</tr>
<tr>
 <td style="text-align: right;">
     </td><td style="text-align: left;"> Time</td><td style="text-align: left;"> a numeric variable indicating the time taken by the subject to respond to the surveys questions in minutes.</td>
</tr>
<tr>
 <td style="text-align: right;">
     </td><td style="text-align: left;"> BMI</td><td style="text-align: left;"> a numeric variable with the subject's body mass index.</td>
</tr>
<tr>
 <td style="text-align: right;">
     </td><td style="text-align: left;"> Cluster</td><td style="text-align: left;"> a numeric variable indexing the cluster.</td>
</tr>
<tr>
 <td style="text-align: right;">
  </td>
</tr>

</table>



<h3>Details</h3>

<p>Data generation code availble on https://github.com/johamunoz/Statsmed_Heckman/blob/main/4.Codes/gendata_Obesity.R
</p>


<h3>Source</h3>

<p>Synthetic data based on the data retrieved from &quot;https://www.kaggle.com/datasets/fabinmndez/obesitydata/&quot;</p>


<h3>References</h3>

<p>Palechor, F. M., &amp; de la Hoz Manotas, A. (2019). Dataset for estimation of obesity levels based on eating habits and physical condition in individuals from Colombia, Peru and Mexico. Data in brief, 25, 104344.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(mice)
library(ggplot2)
library(data.table)

data(Obesity)
summary(Obesity)
md.pattern(Obesity)

# Missingness per region (Weight)
dataNA &lt;- setDT(Obesity)[, .(nNA = sum(is.na(Weight)),n=.N), by = Cluster]
dataNA[, propNA:=nNA/n]
dataNA

# Density per region (Weight)
Obesity$Cluster &lt;- as.factor(Obesity$Cluster)
ggplot(Obesity, aes(x = Weight, group=Cluster)) +
  geom_histogram(aes(color = Cluster,fill= Cluster),
                 position = "identity", bins = 30) + 
                 facet_grid(Cluster~.)
</code></pre>

<hr>
<h2 id='overimpute'>
Overimputation diagnostic plot
</h2><span id='topic+overimpute'></span>

<h3>Description</h3>

<p>Assess the fit of the predictive distribution after performing multiple imputation with mice
</p>


<h3>Usage</h3>

<pre><code class='language-R'>overimpute(res.mice, plotvars = NULL, plotinds = NULL,
  nnodes = 5, path.outfile = NULL, alpha = 0.1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="overimpute_+3A_res.mice">res.mice</code></td>
<td>

<p>An object of class mids
</p>
</td></tr>
<tr><td><code id="overimpute_+3A_plotvars">plotvars</code></td>
<td>

<p>column index of the variables overimputed
</p>
</td></tr>
<tr><td><code id="overimpute_+3A_plotinds">plotinds</code></td>
<td>

<p>row index of the individuals overimputed
</p>
</td></tr>
<tr><td><code id="overimpute_+3A_nnodes">nnodes</code></td>
<td>

<p>A scalar indicating the number of nodes for parallel calculation. Default value is 5.
</p>
</td></tr>
<tr><td><code id="overimpute_+3A_path.outfile">path.outfile</code></td>
<td>

<p>A vector of strings indicating the path for redirection of print messages. Default value is NULL, meaning that silent imputation is performed. Otherwise, print messages are saved in the files path.outfile/output.txt. One file per node is generated.
</p>
</td></tr>
<tr><td><code id="overimpute_+3A_alpha">alpha</code></td>
<td>

<p>alpha level for prediction intervals
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function imputes each observed values from each of the parameters of the imputation model obtained from the mice procedure. The comparison between the &quot;overimputed&quot; values and the observed values is made by building a confidence interval for each observed value using the quantiles of the overimputed values (Blackwell et al. (2015)). Note that confidence intervals builded with quantiles require a large number of imputations. If the model fits the data well, then the 90% confidence interval should contain the observed value in 90% of the cases (the proportion of intervals containing the observed value is reported in the title of each graph). The function overimpute takes as an input the output of the mice or mice.par function (res.mice), the indices of the incomplete continuous variables that are plotted (plotvars), the indices of individuals (can be useful for time consumming imputation methods), the number of nodes for parallel computation, and the path for exporting print message generated during the parallel process.
</p>


<h3>Value</h3>

<p>A list of two matrices
</p>
<table>
<tr><td><code>res.plot</code></td>
<td>
<p>7-columns matrix that contains (1) the variable which is overimputed, (2) the observed value of the observation, (3) the mean of the overimputations, (4) the lower bound of the confidence interval of the overimputations, (5) the upper bound of the confidence interval of the overimputations, (6) the proportion of the other variables that were missing for that observation in the original data, and (7) the color for graphical representation.</p>
</td></tr>
<tr><td><code>res.values</code></td>
<td>
<p>A matrix with overimputed values for each cell. The number of columns corresponds to the number of values generated (i.e. the number of imputed tables)</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Vincent Audigier <a href="mailto:vincent.audigier@cnam.fr">vincent.audigier@cnam.fr</a>
</p>


<h3>References</h3>

<p>Blackwell, M., Honaker, J. and King. G. 2015. A Unified Approach to Measurement Error and Missing Data: Overview and Applications. Sociological Methods and Research, 1-39. &lt;doi:10.1177/0049124115585360&gt;
</p>


<h3>See Also</h3>

<p><code><a href="HH.html#topic+mice">mice</a>,<a href="lattice.html#topic+parallel">parallel</a>, <a href="#topic+mice.par">mice.par</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
require(parallel)
nnodes&lt;-detectCores()-1#number of nodes
m&lt;-1000#nb generated values per observation

################
#one level data
################
require(mice)
data(nhanes)
#res.mice&lt;-mice.par(nhanes,m = m,nnodes = nnodes)
#res.over&lt;-overimpute(res.mice, nnodes = nnodes)

################
#two level data (time consumming)
################
data(CHEM97Na)

ind.clust&lt;-1#index for the cluster variable

#initialisation of the argument predictorMatrix
predictor.matrix&lt;-mice(CHEM97Na,m=1,maxit=0)$pred
predictor.matrix[ind.clust,ind.clust]&lt;-0
predictor.matrix[-ind.clust,ind.clust]&lt;- -2
predictor.matrix[predictor.matrix==1]&lt;-2

#initialisation of the argument method
method&lt;-find.defaultMethod(CHEM97Na,ind.clust)

#multiple imputation by chained equations (time consumming)

#res.mice&lt;-mice.par(CHEM97Na,
#                   predictorMatrix = predictor.matrix,
#                   method=method,m=m,nnodes = nnodes)


#overimputation on 30 individuals
#res.over&lt;-overimpute(res.mice,
#                     nnodes=nnodes,
#                     plotinds=sample(x = seq(nrow(CHEM97Na)),size = 30))

</code></pre>

<hr>
<h2 id='plot.mira'>
Graphical investigation for the number of generated datasets
</h2><span id='topic+plot.mira'></span>

<h3>Description</h3>

<p>The <code>plot</code> method for a <code>mira</code> object plots the confidence interval length against the number of multiply imputed datasets from 2 to <code>m</code>. This is a graphical tool to check if the variability due to the simulation of the multiple imputation process can be substantially reduced by increasing the number of generated datasets <code>m</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mira'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.mira_+3A_x">x</code></td>
<td>

<p>An object of class <code>mira</code>.
</p>
</td></tr>
<tr><td><code id="plot.mira_+3A_...">...</code></td>
<td>

<p>Extra arguments for <code><a href="#topic+plot.mira">plot.mira</a></code>
</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Vincent Audigier <a href="mailto:vincent.audigier@cnam.fr">vincent.audigier@cnam.fr</a>
</p>


<h3>References</h3>

<p>Schafer, J. L. (1997). Analysis of Incomplete Multivariate Data. Chapman &amp; Hall/CRC, London
</p>


<h3>See Also</h3>

<p><code><a href="HH.html#topic+mice">mice</a></code>, <code>mira</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  require(nlme)
  data(CHEM97Na)
  
  ind.clust&lt;-1#index for the cluster variable
  
  #initialisation of the argument predictorMatrix
  predictor.matrix&lt;-mice(CHEM97Na,m=1,maxit=0)$pred
  predictor.matrix[ind.clust,ind.clust]&lt;-0
  predictor.matrix[-ind.clust,ind.clust]&lt;- -2
  predictor.matrix[predictor.matrix==1]&lt;-2

  
  #initialisation of the argument method
  method&lt;-c("", "2l.2stage.bin", "2l.2stage.pois", "2l.2stage.norm", "") #quickest methods
  
  #multiple imputation by chained equations (parallel calculation)
  #res.mice&lt;-mice.par(CHEM97Na,m=15,predictorMatrix = predictor.matrix,method=method)

  #analysis (apply a linear mixed effects model to each imputed dataset)
  #ana&lt;-with(res.mice,expr=lme(fixed=formula(Score~Sex+GSCE+Age),
  #                            random=formula(~1|School),method="REML",
  #                            control=list(maxIter=100,msMaxIter=100,niterEM=25)))

  #graphical investigation for the number of generated datasets m
  #plot(ana)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
