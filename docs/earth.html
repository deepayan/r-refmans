<!DOCTYPE html><html><head><title>Help for package earth</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {earth}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#contr.earth.response'><p>Please ignore</p></a></li>
<li><a href='#earth'><p>Multivariate Adaptive Regression Splines</p></a></li>
<li><a href='#earth.object'><p>An earth object</p></a></li>
<li><a href='#etitanic'><p>Titanic data with incomplete cases removed</p></a></li>
<li><a href='#evimp'><p>Estimate variable importances in an earth object</p></a></li>
<li><a href='#expand.bpairs'><p>Expand binomial-pair data from short to long form</p></a></li>
<li><a href='#format.earth'><p>Format earth objects</p></a></li>
<li><a href='#mars.to.earth'><p>Convert a mars object from the mda package to an earth object</p></a></li>
<li><a href='#model.matrix.earth'><p>Get the earth basis matrix</p></a></li>
<li><a href='#ozone1'><p>Ozone readings in Los Angeles with incomplete cases removed</p></a></li>
<li><a href='#plot.earth'><p>Plot an earth object</p></a></li>
<li><a href='#plot.earth.models'><p>Compare earth models by plotting them.</p></a></li>
<li><a href='#plot.evimp'><p>Plot an evimp object (created by the evimp function)</p></a></li>
<li><a href='#plot.varmod'><p>Plot a varmod object (created by calling earth with the varmod argument)</p></a></li>
<li><a href='#plotd'><p>Plot the distribution of predictions for each class</p></a></li>
<li><a href='#predict.earth'><p>Predict with an earth model</p></a></li>
<li><a href='#predict.varmod'><p>Predict with a varmod model</p></a></li>
<li><a href='#residuals.earth'><p>Residuals for an earth model</p></a></li>
<li><a href='#summary.earth'><p>Summary method for earth objects</p></a></li>
<li><a href='#update.earth'><p>Update an earth model</p></a></li>
<li><a href='#varmod'><p>Variance models for estimating prediction intervals</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Version:</td>
<td>5.3.3</td>
</tr>
<tr>
<td>Title:</td>
<td>Multivariate Adaptive Regression Splines</td>
</tr>
<tr>
<td>Author:</td>
<td>Stephen Milborrow.  Derived from mda:mars by Trevor Hastie and
    Rob Tibshirani.  Uses Alan Miller's Fortran utilities
    with Thomas Lumley's leaps wrapper.</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Stephen Milborrow &lt;milbo@sonic.net&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.4.0), Formula (&ge; 1.2-3), plotmo (&ge; 3.6.0),</td>
</tr>
<tr>
<td>Suggests:</td>
<td>gam (&ge; 1.20), mgcv (&ge; 1.8-26), mda (&ge; 0.5-2), MASS (&ge;
7.3-51)</td>
</tr>
<tr>
<td>Description:</td>
<td>Build regression models using the techniques in Friedman's
    papers "Fast MARS" and "Multivariate Adaptive Regression
    Splines" &lt;<a href="https://doi.org/10.1214%2Faos%2F1176347963">doi:10.1214/aos/1176347963</a>&gt;.
    (The term "MARS" is trademarked and thus not used in
    the name of the package.)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>LazyData:</td>
<td>yes</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="http://www.milbo.users.sonic.net/earth/">http://www.milbo.users.sonic.net/earth/</a></td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-02-26 12:13:39 UTC; milbo</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-02-26 14:00:11 UTC</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>5.1.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
</table>
<hr>
<h2 id='contr.earth.response'>Please ignore</h2><span id='topic+contr.earth.response'></span>

<h3>Description</h3>

<p>Contrasts function for factors in the <code><a href="#topic+earth">earth</a></code> response.
For internal use by earth.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>contr.earth.response(x, base, contrasts)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="contr.earth.response_+3A_x">x</code></td>
<td>

<p>a factor
</p>
</td></tr>
<tr><td><code id="contr.earth.response_+3A_base">base</code></td>
<td>

<p>unused
</p>
</td></tr>
<tr><td><code id="contr.earth.response_+3A_contrasts">contrasts</code></td>
<td>

<p>unused
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a diagonal matrix.
An example for a 3 level factor with levels <code>A</code>, <code>B</code>, and <code>C</code>:
</p>
<pre>
      A B C
    A 1 0 0
    B 0 1 0
    C 0 0 1
</pre>


<h3>Note</h3>

<p>Earth uses this function internally.
You shouldn't need it.
It is made publicly available only because it seems that is necessary
for <code>model.matrix</code>.
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+contrasts">contrasts</a></code>
</p>

<hr>
<h2 id='earth'>Multivariate Adaptive Regression Splines</h2><span id='topic+earth'></span><span id='topic+earth.default'></span><span id='topic+earth.formula'></span><span id='topic+earth.fit'></span>

<h3>Description</h3>

<p>Build a regression model
using the techniques in Friedman's papers &quot;Multivariate Adaptive Regression Splines&quot;
and &quot;Fast MARS&quot;.
</p>
<p>See the package vignette
&ldquo;<a href="../doc/earth-notes.pdf">Notes on the earth package</a>&rdquo;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'formula'
earth(formula = stop("no 'formula' argument"), data = NULL,
   weights = NULL, wp = NULL, subset = NULL,
   na.action = na.fail,
   pmethod = c("backward", "none", "exhaustive", "forward", "seqrep", "cv"),
   keepxy = FALSE, trace = 0, glm = NULL, degree = 1, nprune = NULL,
   nfold=0, ncross=1, stratify=TRUE,
   varmod.method = "none", varmod.exponent = 1,
   varmod.conv = 1, varmod.clamp = .1, varmod.minspan = -3,
   Scale.y = NULL, ...)

## Default S3 method:
earth(x = stop("no 'x' argument"), y = stop("no 'y' argument"),
    weights = NULL, wp = NULL, subset = NULL,
    na.action = na.fail,
    pmethod = c("backward", "none", "exhaustive", "forward", "seqrep", "cv"),
    keepxy = FALSE, trace = 0, glm = NULL, degree = 1, nprune = NULL,
    nfold=0, ncross=1, stratify=TRUE,
    varmod.method = "none", varmod.exponent = 1,
    varmod.conv = 1, varmod.clamp = .1, varmod.minspan = -3,
    Scale.y = NULL, ...)

## S3 method for class 'fit'
earth(x = stop("no 'x' argument"), y = stop("no 'y' argument"),
    weights = NULL, wp = NULL, subset = NULL,
    na.action = na.fail, offset = NULL,
    pmethod = c("backward", "none", "exhaustive", "forward", "seqrep", "cv"),
    keepxy = FALSE, trace = 0, glm = NULL, degree = 1,
    penalty = if(degree &gt; 1) 3 else 2,
    nk = min(200, max(20, 2 * ncol(x))) + 1,
    thresh = 0.001, minspan = 0, endspan = 0,
    newvar.penalty = 0, fast.k = 20, fast.beta = 1,
    linpreds = FALSE, allowed = NULL,
    nprune = NULL, Object = NULL,
    Scale.y = NULL, Adjust.endspan = 2, Auto.linpreds = TRUE,
    Force.weights = FALSE, Use.beta.cache = TRUE, Force.xtx.prune = FALSE,
    Get.leverages = NROW(x) &lt; 1e5, Exhaustive.tol = 1e-10, ...)
</code></pre>


<h3>Arguments</h3>

<p>To start off, look at the arguments
<code>formula</code>,
<code>data</code>,
<code>x</code>,
<code>y</code>,
<code>nk</code>,
<code>degree</code>, and
<code>trace</code>.
<br />
If the response is binary or a factor, consider using the <code>glm</code>
argument.<br />
For cross validation, use the <code>nfold</code> argument.<br />
For prediction intervals, use the <code>varmod.method</code> argument.<br />
<br />
Most users will find that the above arguments are all they need,
plus in some cases <code>keepxy</code> and <code>nprune</code>.
Unless you are a knowledgeable user, it's best not subvert the
standard algorithm by toying with tuning parameters such as <code>thresh</code>,
<code>penalty</code>, and <code>endspan</code>.
<br />
</p>
<table>
<tr><td><code id="earth_+3A_formula">formula</code></td>
<td>

<p>Model formula.
</p>
</td></tr>
<tr><td><code id="earth_+3A_data">data</code></td>
<td>

<p>Data frame for <code>formula</code>.
</p>
</td></tr>
<tr><td><code id="earth_+3A_x">x</code></td>
<td>

<p>Matrix or dataframe containing the independent variables.
</p>
</td></tr>
<tr><td><code id="earth_+3A_y">y</code></td>
<td>

<p>Vector containing the response variable, or, in the case of multiple responses,
a matrix or dataframe whose columns are the values for each response.
</p>
</td></tr>
<tr><td><code id="earth_+3A_subset">subset</code></td>
<td>

<p>Index vector specifying which cases to use, i.e., which rows in <code>x</code> to use.
Default is NULL, meaning all.
</p>
</td></tr>
<tr><td><code id="earth_+3A_weights">weights</code></td>
<td>

<p>Case weights.
Default is NULL, meaning no case weights.
If specified, <code>weights</code> must have length equal to <code>nrow(x)</code>
before applying <code>subset</code>.
Zero weights are converted to a very small nonzero value.
In the current implementation, building models with weights can be slow.


</p>
</td></tr>
<tr><td><code id="earth_+3A_wp">wp</code></td>
<td>

<p>Response weights.
Default is NULL, meaning no response weights.
If specified, <code>wp</code> must have an element for each column of
<code>y</code> (after <code><a href="base.html#topic+factor">factors</a></code> in
<code>y</code>, if any, have been expanded).
Zero weights are converted to a very small nonzero value.
</p>
</td></tr>
<tr><td><code id="earth_+3A_na.action">na.action</code></td>
<td>

<p>NA action. Default is <code>na.fail</code>, and only <code>na.fail</code> is supported.
</p>
</td></tr>
<tr><td><code id="earth_+3A_offset">offset</code></td>
<td>

<p>Offset term passed from the formula in <code>earth.formula</code>.
</p>
</td></tr>
<tr><td><code id="earth_+3A_keepxy">keepxy</code></td>
<td>

<p>Default is <code>FALSE</code>.
Set to <code>TRUE</code> to retain the following in the returned value: <code>x</code> and <code>y</code> (or <code>data</code>),
<code>subset</code>, and <code>weights</code>.
The function <code><a href="#topic+update.earth">update.earth</a></code> and friends will use these
if present instead of searching for them
in the environment at the time <code>update.earth</code> is invoked.<br />

When the <code>nfold</code> argument is used with <code>keepxy=TRUE</code>,
<code>earth</code> keeps more data and calls <code>predict.earth</code> multiple
times to generate <code>cv.oof.rsq.tab</code> and <code>cv.infold.rsq.tab</code>
(see the <code>cv.</code> arguments in <code><a href="#topic+earth.object">earth.object</a></code>).
It therefore makes cross-validation significantly slower.
</p>
</td></tr>
<tr><td><code id="earth_+3A_trace">trace</code></td>
<td>

<p>Trace <code>earth</code>'s execution.  Values:<br />
<code>0</code> (default) no tracing<br />
<code>.3</code> variance model (the <code>varmod.method</code> arg)<br />
<code>.5</code> cross validation (the <code>nfold</code> arg)<br />
<code>1</code> overview<br />
<code>2</code> forward pass<br />
<code>3</code> pruning<br />
<code>4</code> model mats summary, pruning details<br />
<code>5</code> full model mats, internal details of operation<br />
</p>
</td></tr>
<tr><td><code id="earth_+3A_glm">glm</code></td>
<td>

<p>NULL (default) or a list of arguments to pass on to <code><a href="stats.html#topic+glm">glm</a></code>.
See the documentation of <code><a href="stats.html#topic+glm">glm</a></code> for a description of these arguments
See &ldquo;<em>Generalized linear models</em>&rdquo; in the vignette.
Example:<br />
<code>earth(survived~., data=etitanic, degree=2, glm=list(family=binomial))</code>
<br /><br />
<b>The following arguments are for the forward pass.</b>
</p>
</td></tr>
<tr><td><code id="earth_+3A_degree">degree</code></td>
<td>

<p>Maximum degree of interaction (Friedman's <code class="reqn">mi</code>).
Default is <code>1</code>, meaning build an additive model (i.e., no interaction terms).
</p>
</td></tr>
<tr><td><code id="earth_+3A_penalty">penalty</code></td>
<td>

<p>Generalized Cross Validation (GCV) penalty per knot.
Default is <code>if(degree&gt;1) 3 else 2</code>.
Simulation studies suggest values in the range of about <code>2</code> to <code>4</code>.
The FAQ section in the vignette has some information on GCVs.<br />
Special values (for use by knowledgeable users):
The value <code>0</code> penalizes only terms, not knots.
The value <code>-1</code> means no penalty, so GCV = RSS/n.
</p>
</td></tr>
<tr><td><code id="earth_+3A_nk">nk</code></td>
<td>

<p>Maximum number of model terms before pruning, i.e., the
maximum number of terms created by the forward pass.
Includes the intercept.<br />
The actual number of terms created by the forward pass will often be
less than <code>nk</code> because of other stopping conditions.
See &ldquo;<em>Termination conditions for the forward pass</em>&rdquo;
in the vignette.<br />
The default is semi-automatically calculated from the number of predictors
but may need adjusting.
</p>
</td></tr>
<tr><td><code id="earth_+3A_thresh">thresh</code></td>
<td>

<p>Forward stepping threshold.
Default is <code>0.001</code>.
This is one of the arguments used to decide when forward stepping
should terminate:
the forward pass terminates if adding a term changes RSq by less than <code>thresh</code>.
See &ldquo;<em>Termination conditions for the forward pass</em>&rdquo; in the vignette.
</p>
</td></tr>
<tr><td><code id="earth_+3A_minspan">minspan</code></td>
<td>

<p>Minimum number of observations between knots.
(This increases resistance to runs of correlated noise in the input data.)<br />
The default <code>minspan=0</code> is treated specially and
means calculate the <code>minspan</code> internally, as per
Friedman's MARS paper section 3.8 with <code class="reqn">alpha</code> = 0.05.
Set <code>trace&gt;=2</code> to see the calculated value.<br />
Use <code>minspan=1</code> and <code>endspan=1</code> to consider all x values.<br />
Negative values of <code>minspan</code> specify the maximum number of knots
per predictor.  These will be equally spaced.
For example, <code>minspan=-3</code> allows three evenly spaced knots for each predictor.
As always, knots that fall in the end zones specified by <code>endspan</code> will be ignored.
</p>
</td></tr>
<tr><td><code id="earth_+3A_endspan">endspan</code></td>
<td>

<p>Minimum number of observations before the first and after the final knot.<br />
The default <code>endspan=0</code> is treated specially and
means calculate the <code>endspan</code> internally, as per
the MARS paper equation 45 with <code class="reqn">alpha</code> = 0.05.
Set <code>trace&gt;=2</code> to see the calculated value.
<br />
Be wary of reducing <code>endspan</code>, especially if you plan to make
predictions beyond or near the limits of the training data.
Overfitting near the edges of training data is much more
likely with a small <code>endspan</code>.
The model's <code>RSq</code> and <code>GRSq</code> won't indicate when this
overfitting is occurring.
(A <code><a href="plotmo.html#topic+plotmo">plotmo</a></code> plot can help: look for sharp hinges at the
edges of the data).  See also the <code>Adjust.endspan</code> argument.
</p>
</td></tr>
<tr><td><code id="earth_+3A_newvar.penalty">newvar.penalty</code></td>
<td>

<p>Penalty for adding a new variable in the forward pass
(Friedman's <code class="reqn">gamma</code>, equation 74 in the MARS paper).
Default is <code>0</code>, meaning no penalty for adding a new variable.
Useful non-zero values typically range from about <code>0.01</code> to <code>0.2</code>
and sometimes higher &mdash;
you will need to experiment.<br />
A word of explanation.  With the default <code>newvar.penalty=0</code>,
if two variables have nearly the same effect (e.g. they are
collinear), at any step in the forward pass <code>earth</code> will
arbitrarily select one or the other (depending on noise in the sample).
Both variables can appear in the
final model, complicating model interpretation.  On the other hand
with a non-zero <code>newvar.penalty</code>, the forward pass will be
reluctant to add a new variable &mdash; it will rather try to use a
variable already in the model, if that does not affect RSq too much.
The resulting final model may be easier to interpret, if you are lucky.
There will often be a small performance hit (a worse GCV).
</p>
</td></tr>
<tr><td><code id="earth_+3A_fast.k">fast.k</code></td>
<td>

<p>Maximum number of parent terms considered at each step of the forward pass.
(This speeds up the forward pass. See the Fast MARS paper section 3.0.)<br />
Default is <code>20</code>.
A value of <code>0</code> is treated specially
(as being equivalent to infinity), meaning no Fast MARS.
Typical values, apart from <code>0</code>, are <code>20</code>, <code>10</code>, or <code>5</code>.<br />
In general, with a lower <code>fast.k</code> (say <code>5</code>), <code>earth</code> is faster;
with a higher <code>fast.k</code>, or with <code>fast.k</code> disabled (set to <code>0</code>),
<code>earth</code> builds a better model.
However, because of random variation this general rule often doesn't apply.
</p>
</td></tr>
<tr><td><code id="earth_+3A_fast.beta">fast.beta</code></td>
<td>

<p>Fast MARS ageing coefficient, as described in the
Fast MARS paper section 3.1.
Default is <code>1</code>.
A value of <code>0</code> sometimes gives better results.
</p>
</td></tr>
<tr><td><code id="earth_+3A_linpreds">linpreds</code></td>
<td>

<p>Index vector specifying which predictors should enter linearly, as in <code><a href="stats.html#topic+lm">lm</a></code>.
The default is <code>FALSE</code>, meaning predictors enter
in the standard MARS fashion, i.e., in hinge functions.
<br />
<br />
The linpreds argument does not specify that a predictor
<em>must</em> enter the model; only that if it enters, it enters
linearly.  See &ldquo;<em>The linpreds argument</em>&rdquo; in the
<a href="../doc/earth-notes.pdf">vignette</a>.
<br />
See also the <code>Auto.linpreds</code> argument below (which describes how
<code>earth</code> will <em>automatically</em> treat a predictor as linear
under certain conditions).
<br />
<br />
Details:
A predictor's index in <code>linpreds</code> is the column number in the input matrix <code>x</code>
(after factors have been expanded).
<br />
<code>linpreds=TRUE</code> makes all predictors enter linearly (the <code>TRUE</code> gets recycled).
<br />
<code>linpreds</code> may be a character vector e.g.
<code>linpreds=c("wind", "vis")</code>.  Note: <code><a href="base.html#topic+grep">grep</a></code> is used
for matching. Thus <code>"wind"</code> will match all variables that have
<code>"wind"</code> in their names. Use <code>"^wind$"</code> to match only the
variable named <code>"wind"</code>.
</p>
</td></tr>
<tr><td><code id="earth_+3A_allowed">allowed</code></td>
<td>

<p>Function specifying which predictors can interact and how.
Default is NULL, meaning all standard MARS terms are allowed.<br />
During the forward pass, <code>earth</code> calls the <code>allowed</code> function
before considering a term for inclusion; the term can go into the
model only if the <code>allowed</code> function returns <code>TRUE</code>.
See &ldquo;<em>The allowed argument</em>&rdquo; in the vignette.
<br /><br />
<b>The following arguments are for the pruning pass.</b>
</p>
</td></tr>
<tr><td><code id="earth_+3A_pmethod">pmethod</code></td>
<td>

<p>Pruning method.
One of: <code>backward none exhaustive forward seqrep cv</code>.<br />
Default is <code>"backward"</code>.<br />
Specify <code>pmethod="cv"</code> to use cross-validation to select the number of terms.
This selects the number of terms that gives the maximum
mean out-of-fold RSq on the fold models.
Requires the <code>nfold</code> argument.<br />
Use <code>"none"</code> to retain all the terms created by the forward pass.<br />
If <code>y</code> has multiple columns, then only <code>"backward"</code> or <code>"none"</code>
is allowed.<br />
Pruning can take a while if <code>"exhaustive"</code> is chosen and
the model is big (more than about 30 terms).
The current version of the <code><a href="leaps.html#topic+leaps">leaps</a></code> package
used during pruning does not allow user interrupts
(i.e., you have to kill your R session to interrupt;
in Windows use the Task Manager or from the command line use <code>taskkill</code>).
</p>
</td></tr>
<tr><td><code id="earth_+3A_nprune">nprune</code></td>
<td>

<p>Maximum number of terms (including intercept) in the pruned model.
Default is NULL, meaning all terms created by the forward pass
(but typically not all terms will remain after pruning).
Use this to enforce an upper bound on the model size (that is less than <code>nk</code>),
or to reduce exhaustive search time with <code>pmethod="exhaustive"</code>.
<br /><br />
<b>The following arguments are for cross validation.</b>
</p>
</td></tr>
<tr><td><code id="earth_+3A_nfold">nfold</code></td>
<td>

<p>Number of cross-validation folds.
Default is <code>0</code>, no cross validation.
If greater than <code>1</code>, <code>earth</code> first builds a standard model as usual with all the data.
It then builds <code>nfold</code> cross-validated models,
measuring R-Squared on the out-of-fold (left out) data each time.
The final cross validation R-Squared (<code>CVRSq</code>) is the mean of these
out-of-fold R-Squareds.<br />
The above process of building <code>nfold</code> models is repeated
<code>ncross</code> times (by default, once).
Use <code>trace=.5</code> to trace cross-validation.<br />
Further statistics are calculated if <code>keepxy=TRUE</code> or
if a binomial or poisson model (specified with the <code>glm</code> argument).
See &ldquo;<em>Cross validation</em>&rdquo; in the vignette.
</p>
</td></tr>
<tr><td><code id="earth_+3A_ncross">ncross</code></td>
<td>

<p>Only applies if <code>nfold&gt;1</code>.
Number of cross-validations.  Each cross-validation has <code>nfold</code> folds.
Default <code>1</code>.
</p>
</td></tr>
<tr><td><code id="earth_+3A_stratify">stratify</code></td>
<td>

<p>Only applies if <code>nfold&gt;1</code>.
Default is <code>TRUE</code>.
Stratify the cross-validation samples so that
an approximately equal number of cases with a non-zero response
occur in each cross validation subset.
So if the response <code>y</code> is logical, the <code>TRUE</code>s will be spread
evenly across folds.
And if the response is a multilevel factor, there will be an
approximately equal number of each factor level in each fold
(because a multilevel factor response gets expanded to columns of zeros and ones,
see &ldquo;<em>Factors</em>&rdquo; in  the vignette).
We say &ldquo;approximately equal&rdquo; because the number of occurrences of a factor
level may not be exactly divisible by the number of folds.
<br /><br />
<b>The following arguments are for variance models.</b>
</p>
</td></tr>
<tr><td><code id="earth_+3A_varmod.method">varmod.method</code></td>
<td>

<p>Construct a variance model.
For details, see <code><a href="#topic+varmod">varmod</a></code> and the vignette
&ldquo;<a href="../doc/earth-varmod.pdf">Variance models in earth</a>&rdquo;.
Use <code>trace=.3</code> to trace construction of the variance model.
<br />
This argument requires <code>nfold</code> and <code>ncross</code>. (We suggest at least <code>ncross=30</code>
here to properly calculate the variance of the errors &mdash; although
you can use a smaller value, say <code>3</code>, for debugging.)<br />
The <code>varmod.method</code> argument should be one of<br />
<b><code>"none"</code></b> Default.  Don't build a variance model.
<br />
<b><code>"const"</code></b> Assume homoscedastic errors.
<br />
<b><code>"lm"</code></b> Use <code><a href="stats.html#topic+lm">lm</a></code> to estimate standard deviation as a
function of the predicted response.
<br />
<b><code>"rlm"</code></b> Use <code><a href="MASS.html#topic+rlm">rlm</a></code>.
<br />
<b><code>"earth"</code></b> Use <code><a href="#topic+earth">earth</a></code>.
<br />
<b><code>"gam"</code></b> Use <code>gam</code>.
This will use either <code><a href="gam.html#topic+gam">gam</a></code>
or the <code>mgcv</code> package, whichever is loaded.
<br />
<b><code>"power"</code></b> Estimate standard deviation as
<code>intercept + coef * predicted.response^exponent</code>,
where
<code>intercept</code>, <code>coef</code>, and <code>exponent</code> will be estimated by <code><a href="stats.html#topic+nls">nls</a></code>.
This is equivalent to <code>varmod.method="lm"</code> except that <code>exponent</code> is
automatically estimated instead of being held at the value
set by the <code>varmod.exponent</code> argument.
<br />
<b><code>"power0"</code></b> Same as <code>"power"</code> but no intercept (offset) term.
<br />
<b><code>"x.lm"</code></b>,
<b><code>"x.rlm"</code></b>,
<b><code>"x.earth"</code></b>,
<b><code>"x.gam"</code></b>
Like the similarly named options above,
but estimate standard deviation by regressing on the predictors <code>x</code>
(instead of the predicted response).
A current implementation restriction is that <code>"x.gam"</code>
allows only models with one predictor (<code>x</code> must have only one column).
</p>
</td></tr>
<tr><td><code id="earth_+3A_varmod.exponent">varmod.exponent</code></td>
<td>

<p>Power transform applied to the rhs before regressing the
absolute residuals with the specified <code>varmod.method</code>.
Default is <code>1</code>.<br />
For example, with <code>varmod.method="lm"</code>, if you expect the
standard deviance to increase linearly with the mean response, use
<code>varmod.exponent=1</code>.
If you expect the standard deviance to increase with the square root
of the mean response, use
<code>varmod.exponent=.5</code>
(where negative response values will be treated as <code>0</code>,
and you will get an error message if more than 20% of them are negative).
</p>
</td></tr>
<tr><td><code id="earth_+3A_varmod.conv">varmod.conv</code></td>
<td>

<p>Convergence criterion for the Iteratively Reweighted Least Squares used
when creating the variance model.<br />
Iterations stop when the mean value of the coefficients of the
residual model change by less than <code>varmod.conv</code>
percent.
Default is <code>1</code> percent.<br />
Negative values force the specified number of iterations,
e.g. <code>varmod.conv=-2</code> means iterate twice.<br />
Positive values are ignored for <code>varmod="const"</code>
and also currently ignored for <code>varmod="earth"</code>
(these are iterated just once, the same as using <code>varmod.conv=-1</code>).
</p>
</td></tr>
<tr><td><code id="earth_+3A_varmod.clamp">varmod.clamp</code></td>
<td>

<p>The estimated standard deviation of the main model errors
is forced to be at least a small positive value,
which we call <code>min.sd</code>.
This prevents negative or absurdly small estimated standard deviations.
Clamping takes place in <code>predict.varmod</code>, which is called
by <code>predict.earth</code> when estimating prediction intervals.
The value of <code>min.sd</code> is determined when building the variance
model as <code>min.sd = varmod.clamp * mean(sd(training.residuals))</code>.
The default <code>varmod.clamp</code> is <code>0.1</code>.
</p>
</td></tr>
<tr><td><code id="earth_+3A_varmod.minspan">varmod.minspan</code></td>
<td>

<p>Only applies when <code>varmod.method="earth"</code> or <code>"x.earth"</code>.
This is the <code>minspan</code> used in the internal call to <code>earth</code>
when creating the variance model (not the main <code>earth</code> model).<br />
Default is <code>-3</code>, i.e., three evenly spaced knots per predictor.
Residuals tend to be very noisy, and allowing only this small
number of knots helps prevent overfitting.
<br /><br />
<b>The following arguments are for internal or advanced use.</b>
</p>
</td></tr>
<tr><td><code id="earth_+3A_object">Object</code></td>
<td>

<p>Earth object to be updated, for use by <code><a href="#topic+update.earth">update.earth</a></code>.
</p>
</td></tr>
<tr><td><code id="earth_+3A_scale.y">Scale.y</code></td>
<td>

<p><code><a href="base.html#topic+scale">Scale</a></code> the response internally in the forward pass.
Scaling here means subtract the mean and divide by the standard
deviation.
<br />
For single-response models, the default is <code>Scale.y = TRUE</code>.
Scaling is invisible to the user, up to numerical differences,
but does provide better numeric stability.
<br />
For multiple-response models, the default is <code>FALSE</code>.
If <code>Scale.y</code> is set <code>TRUE</code>, each column of the response is
independently scaled.
This can prevent one response from &ldquo;overwhelming&rdquo; the others,
and earth typically generates a different set of hinge functions.
</p>
</td></tr>
<tr><td><code id="earth_+3A_adjust.endspan">Adjust.endspan</code></td>
<td>

<p>In interaction terms, <code>endspan</code> gets multiplied by this value.
This reduces the possibility of an overfitted interaction term
supported by just a few cases on the boundary of the predictor space
(as sometimes seen in our simulation studies).<br />
The default is <code>2</code>.
Use <code>Adjust.endspan=1</code> for compatibility with old
versions of <code>earth</code>.
</p>
</td></tr>
<tr><td><code id="earth_+3A_auto.linpreds">Auto.linpreds</code></td>
<td>

<p>Default is <code>TRUE</code>, which works as follows
(see <a href="../doc/Auto-linpreds-example.pdf">example</a>):<br />
At any step in the forward pass, if earth discovers that the best knot
for the best predictor is at the predictor minimum (in the
training data),
then earth adds the predictor to the model as a linear &ldquo;basis
function&rdquo; (with no hinge).
Compare the following basis functions (printed in bold)
for an example such predictor <code>x</code>:<br />
<code>Auto.linpreds=TRUE</code> (default): <b><code>x</code></b><br />
<code>Auto.linpreds=FALSE</code>: <b><code>max(x-99, 0)</code></b> where
<code>99</code> is the minimum <code>x</code> in the training data.<br />
Using <code>Auto.linpreds=FALSE</code> always forces a knot, even when the
knot is at the minimum value of the variable.
This ensures that the basis functions are always expressed as hinge functions
(and will always be non-negative).<br />
Note that <code>Auto.linpreds</code> affects only how the model behaves <em>outside</em>
the training data.
Thus <code>predict.earth</code> will
make the same predictions from the training data, regardless
of whether the earth model was built with <code>Auto.linpreds</code> set
<code>TRUE</code> or <code>FALSE</code>
(up to possible differences in the size of the model caused by
different GCVs because of the different forms of the terms).
</p>
</td></tr>
<tr><td><code id="earth_+3A_force.weights">Force.weights</code></td>
<td>

<p>Default is <code>FALSE</code>.
For testing the <code>weights</code> argument.
Force use of the code for handling weights in the <code>earth</code> code,
even if <code>weights=NULL</code> or all the weights are the same.
This will not necessarily generate an identical model,
primarily because the non-weighted code requires some tests for
numerical stability that can sometimes affect knot selection.
</p>
</td></tr>
<tr><td><code id="earth_+3A_use.beta.cache">Use.beta.cache</code></td>
<td>

<p>Default is <code>TRUE</code>.
Using the &ldquo;beta cache&rdquo; takes a little more memory but is faster
(by 20% and often much more for large models).
The beta cache uses <code>nk * nk * ncol(x) * sizeof(double)</code> bytes.
(The beta cache is an innovation in this implementation of MARS
and does not appear in Friedman's papers. It is not related to
the <code>fast.beta</code> argument.  Certain regression coefficients
in the forward pass can be saved and re-used, thus
saving recalculation time.)
</p>
</td></tr>
<tr><td><code id="earth_+3A_force.xtx.prune">Force.xtx.prune</code></td>
<td>

<p>Default is <code>FALSE</code>.
This argument pertains to subset evaluation in the pruning pass.
By default,
if <code>y</code> has a single column then <code>earth</code> calls the <code><a href="leaps.html#topic+leaps">leaps</a></code> routines;
if <code>y</code> has multiple columns then <code>earth</code> calls <code>EvalSubsetsUsingXtx</code>.
The <code>leaps</code> routines are numerically more stable
but do not support multiple responses
(<code>leaps</code> is based on the QR decomposition and
<code>EvalSubsetsUsingXtx</code> is based on the inverse of X'X).
Setting <code>Force.xtx.prune=TRUE</code> forces use of <code>EvalSubsetsUsingXtx</code>, even
if <code>y</code> has a single column.
</p>
</td></tr>
<tr><td><code id="earth_+3A_get.leverages">Get.leverages</code></td>
<td>

<p>Default is <code>TRUE</code> unless the model has more than 100 thousand cases.
The leverages are the diagonal hat values for the linear regression of
<code>y</code> on <code>bx</code>.
(The leverages are needed only for certain model checks, for example
when <code>plotres</code> is called with <code>versus=4</code>).
<br />
Details:
This argument was introduced to reduce peak memory usage.
When <code>n &gt;&gt; p</code>, memory use peaks when <code>earth</code> is
calculating the leverages.
</p>
</td></tr>
<tr><td><code id="earth_+3A_exhaustive.tol">Exhaustive.tol</code></td>
<td>

<p>Default <code>1e-10</code>.
Applies only when <code>pmethod="exhaustive"</code>.
If the reciprocal of the condition number of <code>bx</code>
is less than <code>Exhaustive.tol</code>, <code>earth</code> forces <code>pmethod="backward"</code>.
See &ldquo;<em>XHAUST returned error code -999</em>&rdquo; in the vignette.
</p>
</td></tr>
<tr><td><code id="earth_+3A_...">...</code></td>
<td>

<p>Dots are passed on to <code>earth.fit</code>.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An S3 model of class <code>"earth"</code>.
See <code><a href="#topic+earth.object">earth.object</a></code> for a complete description.
</p>


<h3>Author(s)</h3>

<p>Stephen Milborrow, derived from <code>mda::<a href="mda.html#topic+mars">mars</a></code>
by Trevor Hastie and Robert Tibshirani.
</p>
<p>The approach used for GLMs was motivated by work done by
Jane Elith and John Leathwick
(a representative paper is given below).
</p>
<p>The <code><a href="#topic+evimp">evimp</a></code> function uses ideas from Max Kuhn's <code>caret</code> package
<a href="https://CRAN.R-project.org/package=caret">https://CRAN.R-project.org/package=caret</a>.
</p>
<p>Parts of Thomas Lumley's <code><a href="leaps.html#topic+leaps">leaps</a></code> package have been
incorporated into <code>earth</code>, so <code>earth</code> can directly access
Alan Miller's Fortran functions without going through hidden functions
in the <code>leaps</code> package.
</p>


<h3>References</h3>

<p>The Wikipedia article is recommended for an elementary introduction.
The primary references are the Friedman papers, but
readers may find the MARS section in Hastie, Tibshirani,
and Friedman a more accessible introduction.
Faraway takes a hands-on approach,
using the <code><a href="#topic+ozone1">ozone</a></code> data to compare <code>mda::mars</code> with other techniques.
(If you use Faraway's examples with <code>earth</code> instead of <code>mars</code>, use <code>$bx</code>
instead of <code>$x</code>, and check out the book's errata.)
Friedman and Silverman is recommended background reading for the MARS paper.
Earth's pruning pass uses code from the <code><a href="leaps.html#topic+leaps">leaps</a></code> package
which is based on techniques in Miller.
</p>
<p>Faraway (2005) <em>Extending the Linear Model with R</em>
<a href="https://www.maths.bath.ac.uk/~jjf23">https://www.maths.bath.ac.uk/~jjf23</a>
</p>
<p>Friedman (1991) <em>Multivariate Adaptive Regression Splines (with discussion)</em>
Annals of Statistics 19/1, 1&ndash;141

<a href="http://projecteuclid.org/euclid.aos/1176347963">http://projecteuclid.org/euclid.aos/1176347963</a><br />
<a href="https://doi.org/10.1214/aos/1176347963">doi:10.1214/aos/1176347963</a>
</p>
<p>Friedman (1993) <em>Fast MARS</em>
Stanford University Department of Statistics, Technical Report 110


<code>https://statistics.stanford.edu/research/fast-mars</code>
</p>
<p>Friedman and Silverman (1989)
<em>Flexible Parsimonious Smoothing and Additive Modeling</em>
Technometrics, Vol. 31, No. 1.


</p>
<p>Hastie, Tibshirani, and Friedman (2009) <em>The Elements of Statistical Learning (2nd ed.)</em>
<a href="https://hastie.su.domains/pub.htm">https://hastie.su.domains/pub.htm</a>
</p>
<p>Leathwick, J.R., Rowe, D., Richardson, J., Elith, J., &amp; Hastie, T. (2005)
<em>Using multivariate adaptive regression splines to predict the distributions
of New Zealand's freshwater diadromous fish</em> Freshwater Biology, 50, 2034-2052
<a href="https://hastie.su.domains/pub.htm">https://hastie.su.domains/pub.htm</a>
</p>
<p>Miller, Alan (1990, 2nd ed. 2002) <em>Subset Selection in Regression</em>
<a href="https://wp.csiro.au/alanmiller/index.html">https://wp.csiro.au/alanmiller/index.html</a>
</p>
<p>Wikipedia article on MARS
<a href="https://en.wikipedia.org/wiki/Multivariate_adaptive_regression_splines">https://en.wikipedia.org/wiki/Multivariate_adaptive_regression_splines</a>
</p>


<h3>See Also</h3>

<p>Start with <code><a href="#topic+summary.earth">summary.earth</a></code>, <code><a href="#topic+plot.earth">plot.earth</a></code>,
<code><a href="#topic+evimp">evimp</a></code>, and <code><a href="plotmo.html#topic+plotmo">plotmo</a></code>.
</p>
<p>Please see the main package vignette
&ldquo;<a href="../doc/earth-notes.pdf">Notes on the earth package</a>&rdquo;.
The vignette can also be downloaded from
<a href="http://www.milbo.org/doc/earth-notes.pdf">http://www.milbo.org/doc/earth-notes.pdf</a>.
</p>
<p>The vignette
&ldquo;<a href="../doc/earth-varmod.pdf">Variance models in earth</a>&rdquo;
is also included with the package.
It describes how to generate prediction intervals for <code>earth</code> models.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>earth.mod &lt;- earth(Volume ~ ., data = trees)
plotmo(earth.mod)
summary(earth.mod, digits = 2, style = "pmax")
</code></pre>

<hr>
<h2 id='earth.object'>An earth object</h2><span id='topic+earth.object'></span>

<h3>Description</h3>

<p>The object returned by the <code><a href="#topic+earth">earth</a></code> function.
</p>
<p>This is an <code>S3</code> model of <code><a href="base.html#topic+class">class</a></code> <code>"earth"</code>.
It is a list with the components listed below.
</p>
<p><em>Term</em> refers to a term created during the
forward pass (each line of the output from <code><a href="#topic+format.earth">format.earth</a></code>
is a term).
Term number 1 is always the intercept.
</p>


<h3>Value</h3>

<table>
<tr><td><code>rss</code></td>
<td>

<p>Residual sum-of-squares (RSS) of the model (summed over all responses,
if <code>y</code> has multiple columns).
</p>
</td></tr>
<tr><td><code>rsq</code></td>
<td>

<p><code>1-rss/tss</code>.
R-Squared of the model (calculated over all responses,
and calculated using the <code>weights</code> argument if it was supplied).
A measure of how well the model fits the training data.
Note that <code>tss</code> is the total sum-of-squares, <code>sum((y - mean(y))^2)</code>.
</p>
</td></tr>
<tr><td><code>gcv</code></td>
<td>

<p>Generalized Cross Validation (GCV) of the model (summed over all responses).
The GCV is calculated using the <code>penalty</code> argument.
For details of the GCV calculation, see
equation 30 in Friedman's MARS paper and <code>earth:::get.gcv</code>.
</p>
</td></tr>
<tr><td><code>grsq</code></td>
<td>

<p><code>1-gcv/gcv.null</code>.
An estimate of the predictive power of the model (calculated over all responses,
and calculated using the <code>weights</code> argument if it was supplied).
<code>gcv.null</code> is the GCV of an intercept-only model.
See &ldquo;<em>Can <code>GRSq</code> be negative?</em>&rdquo; in the vignette.
</p>
</td></tr>
<tr><td><code>bx</code></td>
<td>

<p>Matrix of basis functions applied to <code>x</code>.
Each column corresponds to a selected term.
Each row corresponds to a row in in the input matrix <code>x</code>,
after taking <code>subset</code>.
See <code><a href="#topic+model.matrix.earth">model.matrix.earth</a></code> for an example of <code>bx</code> handling.
Example <code>bx</code>:</p>
<pre>     (Intercept)  h(Girth-12.9)  h(12.9-Girth)  h(Girth-12.9)*h(...
[1,]           1            0.0            4.6                    0
[2,]           1            0.0            4.3                    0
[3,]           1            0.0            4.1                    0
...</pre>
</td></tr>
<tr><td><code>dirs</code></td>
<td>

<p>Matrix with one row per MARS term, and with with ij-th element equal to<br />
</p>
<p><code>0</code>  if predictor j is not in term i<br />
<code>-1</code> if an expression of the form <code>h(const - xj)</code> is in term i<br />
<code>1</code>  if an expression of the form <code>h(xj - const)</code> is in term i<br />
<code>2</code>  if predictor j should enter term i linearly
(either because specified by the <code>linpreds</code> argument or because earth
discovered that a knot was unnecessary).<br />
</p>
<p>This matrix includes all terms generated by the forward pass,
including those not in <code>selected.terms</code>.
Note that here the terms may not all be in pairs, because
although the forward pass add terms as hinged pairs (so both sides of
the hinge are available as building blocks for further terms), it also
deletes linearly dependent terms before handing control to the pruning pass.
Example <code>dirs</code>:</p>
<pre>                        Girth Height
(Intercept)                 0      0  # intercept
h(12.9-Girth)              -1      0  # 2nd term uses Girth
h(Girth-12.9)               1      0  # 3rd term uses Girth
h(Girth-12.9)*h(Height-76)  1      1  # 4th term uses Girth and Height
...
</pre>
</td></tr>
<tr><td><code>cuts</code></td>
<td>

<p>Matrix with ij-th element equal to the cut point (hinge value)
for predictor j in term i.
This matrix includes all terms generated by the forward pass,
including those not in <code>selected.terms</code>.
Note for programmers: the precedent is to use <code>dirs</code>
for term names etc. and to only use <code>cuts</code> where cut information needed.
Example <code>cuts</code>:</p>
<pre>                           Girth Height
(Intercept)                    0      0  # intercept, no cuts
h(12.9-Girth)               12.9      0  # 2nd term has cut at 12.9
h(Girth-12.9)               12.9      0  # 3rd term has cut at 12.9
h(Girth-12.9)*h(Height-76)  12.9     76  # 4th term has two cuts
...</pre>
</td></tr>
<tr><td><code>prune.terms</code></td>
<td>

<p>A matrix specifying which terms appear in which pruning pass subsets.
The row index of <code>prune.terms</code> is the model size.
(The model size is the number of terms in the model.
The intercept is counted as a term.)
Each row is a vector of term numbers for the best model of that size.
An element is 0 if the term is not in the model, thus <code>prune.terms</code> is a
lower triangular matrix, with dimensions <code>nprune x nprune</code>.
The model selected by the pruning pass is at row number <code>length(selected.terms)</code>.
</p>
<p>Example <code>prune.terms</code>:</p>
<pre>     [,1] [,2] [,3] [,4] [,5] [,6] [,7]
[1,]    1    0    0    0    0    0    0   # intercept-only model
[2,]    1    2    0    0    0    0    0   # best 2 term model uses terms 1,2
[3,]    1    2    4    0    0    0    0   # best 3 term model uses terms 1,2,4
[4,]    1    2    6    9    0    0    0   # and so on
...</pre>
</td></tr>
<tr><td><code>selected.terms</code></td>
<td>

<p>Vector of term numbers in the selected model.
Can be used as a row index vector into <code>cuts</code> and <code>dirs</code>.
The first element <code>selected.terms[1]</code> is always 1, the intercept.
</p>
</td></tr>
<tr><td><code>fitted.values</code></td>
<td>

<p>Fitted values.
A matrix with dimensions <code>nrow(y) x ncol(y)</code>
after factors in <code>y</code> have been expanded.
</p>
</td></tr>
<tr><td><code>residuals</code></td>
<td>

<p>Residuals.
A matrix with dimensions <code>nrow(y) x ncol(y)</code>
after factors in <code>y</code> have been expanded.
</p>
</td></tr>
<tr><td><code>coefficients</code></td>
<td>

<p>Regression coefficients.
A matrix with dimensions <code>length(selected.terms) x ncol(y)</code>
after factors in <code>y</code> have been expanded.
Each column holds the least squares coefficients from regressing that
column of <code>y</code> on <code>bx</code>.
The first row holds the intercept coefficient(s).
</p>
</td></tr>
<tr><td><code>rss.per.response</code></td>
<td>

<p>A vector of the RSS for each response.
Length is the number of responses, i.e., <code>ncol(y)</code> after factors in <code>y</code> have been expanded.
The <code>rss</code> component above is  equal to <code>sum(rss.per.response)</code>.
</p>
</td></tr>
<tr><td><code>rsq.per.response</code></td>
<td>

<p>A vector of the R-Squared for each response
(where R-Squared is calculated using the <code>weights</code> argument if it was supplied).
Length is the number of responses.
</p>
</td></tr>
<tr><td><code>gcv.per.response</code></td>
<td>

<p>A vector of the GCV for each response.
Length is the number of responses.
The <code>gcv</code> component above is equal to <code>sum(gcv.per.response)</code>.
</p>
</td></tr>
<tr><td><code>grsq.per.response</code></td>
<td>

<p>A vector of the GRSq for each response
(calculated using the <code>weights</code> argument if it was supplied).
Length is the number of responses.
</p>
</td></tr>
<tr><td><code>rss.per.subset</code></td>
<td>

<p>A vector of the RSS
for each model subset generated by the pruning pass.
Length is <code>nprune</code>.
For multiple responses, the RSS is summed over all responses for each subset.
The <code>rss</code> above is<br />
<code>rss.per.subset[length(selected.terms)]</code>.
The RSS of an intercept only-model is <code>rss.per.subset[1]</code>.
</p>
</td></tr>
<tr><td><code>gcv.per.subset</code></td>
<td>

<p>A vector of the GCV for each model in <code>prune.terms</code>.
Length is <code>nprune</code>.
For multiple responses, the GCV is summed over all responses for each subset.
The <code>gcv</code> above is <code>gcv.per.subset[length(selected.terms)]</code>.
The GCV of an intercept-only model is <code>gcv.per.subset[1]</code>.
</p>
</td></tr>
<tr><td><code>leverages</code></td>
<td>

<p>Diagonal of the hat matrix (from the linear regression of the response on <code>bx</code>).
</p>
</td></tr>
<tr><td><code>penalty</code>, <code>nk</code>, <code>thresh</code></td>
<td>

<p>Copies of the corresponding arguments to <code>earth</code>.
</p>
</td></tr>
<tr><td><code>pmethod</code>, <code>nprune</code></td>
<td>

<p>Copies of the corresponding arguments to <code>earth</code>.
</p>
</td></tr>
<tr><td><code>weights</code>, <code>wp</code></td>
<td>

<p>Copies of the corresponding arguments to <code>earth</code>.
</p>
</td></tr>
<tr><td><code>termcond</code></td>
<td>

<p>Reason the forward pass terminated (an integer).
</p>
</td></tr>
<tr><td><code>call</code></td>
<td>

<p>The call used to invoke <code>earth</code>.
</p>
</td></tr>
<tr><td><code>terms</code></td>
<td>

<p>Model frame terms.
This component exists only if the model was built using <code>earth.formula</code>.
</p>
</td></tr>
<tr><td><code>modvars</code></td>
<td>

<p>A matrix specifying which input variables
are used in each column of the model matrix.
(This field is <b>new in earth 5.2.0</b>.)<br />
Columns correspond to columns of the model matrix (same as cols of <code>dirs</code>, see above).<br />
Rows correspond to variables in the formula.
</p>
<p>For example, the formula:</p>
<pre>    survived ~ age + pclass + sqrt(age) - sex
</pre>
<p>results in:
</p>
<p><code>attr(terms,"factors")</code>:</p>
<pre>                age  pclass  sqrt(age)
    survived      0       0          0  # the response will be dropped
    age           1       0          0
    pclass        0       1          0
    sqrt(age)     0       0          1  # sqrt(age) will be merged with age
    sex           0       0          0  # sex is unused and will be dropped
</pre>
<p><code>modvars</code>:</p>
<pre>            age pclass2nd pclass3rd sqrt(age)
    age       1         0         0         1  # age and sqrt(age) use "age"
    pclass    0         1         1         0  # pclass2nd and pclass3rd use "pclass"
</pre>
<p>Note that for models built with <code>earth.default</code> (<code>x,y</code> models),
&ldquo;derived variables&rdquo; are not combined in <code>modvars</code> as they are for formula models.
The row names of <code>modvars</code> match the column names of <code>x</code>,
after factor expansion.
Columns in <code>x</code> named <code>"age"</code> and <code>"sqrt(age)"</code>
will be treated as two separate variables.
</p>
</td></tr>
<tr><td><code>namesx</code></td>
<td>

<p>Variable names in the input data.  Deprecated (subsumed by <code>modvars</code>).
</p>
</td></tr>
<tr><td><code>xlevels</code></td>
<td>

<p>This component exists only if the model was built using <code>earth.formula</code>.<br />
Same as <code>lm</code>.  A record of the levels of the factors used in fitting,
needed under certain conditions by <code>predict.earth</code>.
</p>
</td></tr>
<tr><td><code>levels</code></td>
<td>

<p>This component exists only if the model was built using <code>earth.default</code>.<br />
Levels of <code>y</code> if <code>y</code> is a <code><a href="base.html#topic+factor">factor</a></code>,<br />
<code>c(FALSE,TRUE)</code> if <code>y</code> is <code><a href="base.html#topic+logical">logical</a></code>,<br />
Else <code>NULL</code>.
<br /><br />
<b>The following fields appear only if <code>earth</code>'s argument <code>keepxy</code> is <code>TRUE</code>.</b>
</p>
</td></tr>
<tr><td><code>x</code>, <code>y</code>, <code>data</code>, <code>subset</code></td>
<td>

<p>Copies of the corresponding arguments to <code>earth</code>.
Only exist if <code>keepxy=TRUE</code>.
<br /><br />
<b>The following fields appear only if <code>earth</code>'s <code>glm</code> argument is used.</b>
</p>
</td></tr>
<tr><td><code>glm.list</code></td>
<td>

<p>List of GLM models. Each element is the value returned by <code>earth</code>'s
internal call to <code><a href="stats.html#topic+glm">glm</a></code> for each response.<br />
Thus if there is a single response (or a single binomial pair, see
&ldquo;<em>Binomial pairs</em>&rdquo; in the vignette)
this will be a one element list and you access the GLM model with
<code>earth.mod$glm.list[[1]]</code>.
</p>
</td></tr>
<tr><td><code>glm.coefficients</code></td>
<td>

<p>GLM regression coefficients.
Analogous to the <code>coefficients</code> field described above but for the GLM model(s).
A matrix with dimensions <code>length(selected.terms) x ncol(y)</code>
after factors in <code>y</code> have been expanded.
Each column holds the coefficients from the GLM regression of that
column of <code>y</code> on <code>bx</code>.
This duplicates, for convenience, information buried in <code>glm.list</code>.
</p>
</td></tr>
<tr><td><code>glm.stats</code></td>
<td>

<p>GLM summary statistics such as <code>devratio</code>, <code>AIC</code>, and <code>iters</code>.
</p>
</td></tr>
<tr><td><code>glm.bpairs</code></td>
<td>

<p>Is <code>NULL</code> unless there are paired binomial columns.
Else a logical vector <code>c(TRUE, FALSE)</code>.
See &ldquo;<em>Binomial pairs</em>&rdquo; in the vignette.
Retained for backwards compatibility with old versions of earth.
<br /><br />
<b>The following fields appear only if the <code>nfold</code> argument is greater than 1.</b>
</p>
</td></tr>
<tr><td><code>cv.list</code></td>
<td>

<p>List of <code>earth</code> models, one model for each fold (<code>ncross * nfold</code> models).<br />
The fold models have two extra fields,
<code>icross</code> (an integer from <code>1</code> to <code>ncross</code>)
and <code>ifold</code> (an integer from <code>1</code> to <code>nfold</code>).<br />
To save memory, lengthy fields
in the fold models are removed unless you use <code>keepxy=TRUE</code>.
The &ldquo;lengthy fields&rdquo; are <code>$bx</code>, <code>$fitted.values</code>, and <code>$residuals</code>.
</p>
</td></tr>
<tr><td><code>cv.nterms</code></td>
<td>

<p>Vector of length <code>ncross * nfold + 1</code>.
Number of MARS terms in the model generated at each cross-validation fold,
with the final element being the mean of these.
</p>
</td></tr>
<tr><td><code>cv.nvars</code></td>
<td>

<p>Vector of length <code>ncross * nfold + 1</code>.
Number of predictors in the model generated at each cross-validation fold,
with the final element being the mean of these.
</p>
</td></tr>
<tr><td><code>cv.groups</code></td>
<td>

<p>Specifies which cases went into which folds.
Matrix with two columns and number of rows equal to the the number of cases <code>nrow(x)</code>
Elements of the first column specify the cross-validation number, <code>1:ncross</code>.
Elements of the second column specify the fold number, <code>1:nfold</code>.
</p>
</td></tr>
<tr><td><code>cv.rsq.tab</code></td>
<td>

<p>Matrix with <code>ncross * nfold + 1</code> rows and <code>nresponse+1</code> columns,
where <code>nresponse</code> is the number of responses,
i.e., <code>ncol(y)</code> after factors in <code>y</code> have been expanded.
The first <code>nresponse</code> elements of a row are the <code>cv.rsq</code>'s on
the out-of-fold data for each response of the model generated at that row's fold.
(A <code>cv.rsq</code> is calculated from predictions on the out-of-fold data
using the best model built from the in-fold data;
where &ldquo;best&rdquo; means the model was selected using the in-fold GCV.
The R-Squareds are calculated using the <code>weights</code> argument if it was supplied.
The final column holds the row mean (a weighted mean if <code>wp</code> if specified)).
The final row holds the column means.
The values in this final row is the mean <code>cv.rsq</code>
printed by <code><a href="#topic+summary.earth">summary.earth</a></code>.
<br /><br />
Example for a single response model (where the <code>mean</code> column
is redundant but included for uniformity with multiple response models):
</p>
<pre>           y  mean
fold1  0.909 0.909
fold2  0.869 0.869
fold3  0.952 0.952
fold4  0.157 0.157
fold5  0.961 0.961
mean   0.769 0.769
</pre>
<p>Example for a multiple response model:
</p>
<pre>         y1   y2    y3   mean
fold1 0.915 0.951 0.944 0.937
fold2 0.962 0.970 0.970 0.968
fold3 0.914 0.940 0.942 0.932
fold4 0.907 0.929 0.925 0.920
fold5 0.947 0.987 0.979 0.971
mean  0.929 0.955 0.952 0.946

</pre>
</td></tr>
<tr><td><code>cv.class.rate.tab</code></td>
<td>

<p>Like <code>cv.rsq.tab</code> but is the classification rate at each fold
i.e. the fraction of classes correctly predicted.
Models with discrete response only.
Calculated with <code>thresh=.5</code> for binary responses.
For responses with more than two
levels, the final row is the overall classification rate.  The other
rows are the classification rates for each level (the level
versus not-the-level), which are usually higher than the overall
classification rate (predicting the level versus not-the-level is
easier than correctly predicting one of many levels).
The <code>weights</code> argument is ignored for all cross-validation stats except R-Squareds.
</p>
</td></tr>
<tr><td><code>cv.maxerr.tab</code></td>
<td>

<p>Like <code>cv.rsq.tab</code> but is the <code>MaxErr</code> at each fold.
This is the signed max absolute value at each fold.
Results are aggregated for the final column and final row
using the signed max absolute value.
The <em>signed max absolute value</em> is defined
as the maximum of the absolute difference
between the predicted and observed response values, multiplied
by <code>-1</code> if the sign of that difference is negative.
</p>
</td></tr>
<tr><td><code>cv.auc.tab</code></td>
<td>

<p>Like <code>cv.rsq.tab</code> but is the <code>AUC</code> at each fold.
Binomial models only.
</p>
</td></tr>
<tr><td><code>cv.cor.tab</code></td>
<td>

<p>Like <code>cv.rsq.tab</code> but is the <code>cor</code> at each fold.
Poisson models only.
</p>
</td></tr>
<tr><td><code>cv.deviance.tab</code></td>
<td>

<p>Like <code>cv.rsq.tab</code> but is the <code>MeanDev</code> at each fold.
Binomial models only.
</p>
</td></tr>
<tr><td><code>cv.calib.int.tab</code></td>
<td>

<p>Like <code>cv.rsq.tab</code> but is the <code>CalibInt</code> at each fold.
Binomial models only.
</p>
</td></tr>
<tr><td><code>cv.calib.slope.tab</code></td>
<td>

<p>Like <code>cv.rsq.tab</code> but is the <code>CalibSlope</code> at each fold.
Binomial models only.
</p>
</td></tr>
<tr><td><code>cv.oof.rsq.tab</code></td>
<td>

<p>Generated only if <code>keepxy=TRUE</code> or <code>pmethod="cv"</code>.<br />
A matrix with <code>ncross * nfold + 1</code> rows and <code>max.nterms</code> columns,
Each element holds an out-of-fold RSq (<code>oof.rsq</code>),
calculated from predictions from the out-of-fold observations using
the model built with the in-fold data.  The final row is the mean over
all folds.
The R-Squareds are calculated using the <code>weights</code> argument if it was supplied.
</p>
</td></tr>
<tr><td><code>cv.infold.rsq.tab</code></td>
<td>

<p>Generated only if <code>keepxy=TRUE</code>.
Like <code>cv.oof.rsq.tab</code> but from predictions made on the in-fold observations.
</p>
</td></tr>
<tr><td><code>cv.oof.fit.tab</code></td>
<td>

<p>Generated only if the <code>varmod.method</code> argument is used.
Predicted values on the out-of-fold data.
Dataframe with <code>nrow(data)</code> rows and <code>ncross</code> columns.
<br /><br />
<b>The following field appears only if the <code>varmod.method</code> is specified.</b>
</p>
</td></tr>
<tr><td><code>varmod</code></td>
<td>

<p>An object of class <code>"varmod"</code>.
See the <code><a href="#topic+predict.varmod">varmod</a></code> help page for a description.
Only appears if the <code>varmod.method</code> argument is used.
</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+earth">earth</a></code>
</p>

<hr>
<h2 id='etitanic'>Titanic data with incomplete cases removed</h2><span id='topic+etitanic'></span>

<h3>Description</h3>

<p>Titanic data with incomplete cases,
passenger names, and other details removed.
</p>


<h3>Format</h3>

<p>A data frame with 1046 observations on 6 variables.
</p>

<table>
<tr>
 <td style="text-align: left;">
      <code>pclass</code>   </td><td style="text-align: left;"> passenger class, unordered factor: 1st 2nd 3rd</td>
</tr>
<tr>
 <td style="text-align: left;">
      <code>survived</code> </td><td style="text-align: left;"> integer: 0 or 1</td>
</tr>
<tr>
 <td style="text-align: left;">
      <code>sex</code>      </td><td style="text-align: left;"> unordered factor: male female</td>
</tr>
<tr>
 <td style="text-align: left;">
      <code>age</code>      </td><td style="text-align: left;"> age in years, min 0.167 max 80.0</td>
</tr>
<tr>
 <td style="text-align: left;">
      <code>sibsp</code>    </td><td style="text-align: left;"> number of siblings or spouses aboard, integer: 0...8</td>
</tr>
<tr>
 <td style="text-align: left;">
      <code>parch</code>    </td><td style="text-align: left;"> number of parents or children aboard, integer: 0...6</td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>Source</h3>

<p>This dataset is included in the earth package because it is a convenient
vehicle for illustrating earth's GLM and factor handling.
</p>
<p>The dataset was compiled by Frank Harrell and Robert Dawson:
<a href="https://hbiostat.org/data/repo/titanic.html">https://hbiostat.org/data/repo/titanic.html</a><br />
See also:<br />
<a href="https://biostat.app.vumc.org/wiki/pub/Main/DataSets/titanic3info.txt">https://biostat.app.vumc.org/wiki/pub/Main/DataSets/titanic3info.txt</a>.
</p>
<p>For this version of the Titanic data,
passenger details and incomplete cases were deleted
and the name changed to <code>etitanic</code> to minimize confusion with other
versions (&quot;e&quot; because it is part of the earth package).
</p>
<p>Note that <code>survived</code> is an integer (it should arguably be a logical).
</p>
<p>In this data the crew are conspicuous by their absence.
</p>
<p>Contents of <code>etitanic</code>:
</p>
<pre>
         pclass survived    sex    age sibsp parch
    1       1st        1 female 29.000     0     0
    2       1st        1   male  0.917     1     2
    3       1st        0 female  2.000     1     2
    4       1st        0   male 30.000     1     2
    5       1st        0 female 25.000     1     2
    ...
    1309    3rd        0   male 29.000     0     0
    </pre>
<p>How <code>etitanic</code> was built:
</p>
<pre>
    load("titanic3") # from Harrell's web site
    # discard name, ticket, fare, cabin, embarked, body, home.dest
    etitanic &lt;- titanic3[,c(1,2,4,5,6,7)]
    etitanic &lt;- etitanic[!is.na(etitanic$age),]
    save(etitanic, file="etitanic.rda")
    </pre>


<h3>References</h3>

<p>Further details and analyses of the Titanic data may be found in:
</p>
<p>F. Harrell (2001) <em>
Regression Modeling Strategies with Applications to Linear Models, Logistic Regression, and Survival Analysis </em>
<a href="https://biostat.app.vumc.org/wiki/bin/view/Main/RmS">https://biostat.app.vumc.org/wiki/bin/view/Main/RmS</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+earth">earth</a></code>
</p>

<hr>
<h2 id='evimp'>Estimate variable importances in an earth object</h2><span id='topic+evimp'></span>

<h3>Description</h3>

<p>Estimate variable importances in an <code><a href="#topic+earth">earth</a></code> object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>evimp(object, trim=TRUE, sqrt.=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="evimp_+3A_object">object</code></td>
<td>

<p>An <code><a href="#topic+earth">earth</a></code> object.
</p>
</td></tr>
<tr><td><code id="evimp_+3A_trim">trim</code></td>
<td>

<p>If <code>TRUE</code> (default), delete rows in the returned matrix for
variables that don't appear in any subsets.
</p>
</td></tr>
<tr><td><code id="evimp_+3A_sqrt.">sqrt.</code></td>
<td>

<p>Default is <code>TRUE</code>,
meaning take the <code><a href="base.html#topic+sqrt">sqrt</a></code> of the GCV and RSS importances before
normalizing to 0 to 100.
Taking the square root gives a better indication of
relative importances because the raw importances are calculated using
a sum of squares.
Use <code>FALSE</code> to not take the square root.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>This function returns a matrix showing the relative importances of the
variables in the model.  There is a row for each variable.  The row
name is the variable name, but with <code>-unused</code> appended if the
variable does not appear in the final model.
</p>
<p>The columns of the matrix are (not all of these are printed by <code>print.evimp</code>):
</p>

<ul>
<li> <p><code>col</code>: Column index of the variable in the <code>x</code> argument to <code>earth</code>.
</p>
</li>
<li> <p><code>used</code>: 1 if the variable is used in the final model, else 0.
Equivalently, 0 if the row name has an <code>-unused</code> suffix.
</p>
</li>
<li> <p><code>nsubsets</code>: Variable importance using the &quot;number of subsets&quot; criterion.
Is the number of subsets that include the variable (see &quot;Three Criteria&quot; in the chapter
on <code>evimp</code> in the <code>earth</code> vignette
&ldquo;<a href="../doc/earth-notes.pdf">Notes on the earth package</a>&rdquo;).
</p>
</li>
<li> <p><code>gcv</code>: Variable importance using the GCV criterion (see &quot;Three Criteria&quot;).
</p>
</li>
<li> <p><code>gcv.match</code>: 1, except is
0 where the rank using the <code>gcv</code> criterion differs from
that using the <code>nsubsets</code> criterion.
In other words, there is a 0 for values that increase as you go
down the <code>gcv</code> column.
</p>
</li>
<li> <p><code>rss</code>: Variable importance using the RSS criterion (see &quot;Three Criteria&quot;).
</p>
</li>
<li> <p><code>rss.match</code>: Like <code>gcv.match</code> but for the <code>rss</code>.
</p>
</li></ul>

<p>The rows are sorted on the <code>nsubsets</code> criterion.
This means that values in the <code>nsubsets</code> column decrease as you go down the column
(more accurately, they are non-increasing).
The values in the <code>gcv</code> and <code>rss</code> columns
are also non-increasing, except where the
<code>gcv</code> or <code>rss</code> rank differs from the <code>nsubsets</code> ranking.
</p>


<h3>Note</h3>

<p>There is a chapter on <code>evimp</code> in the <code>earth</code> package vignette
&ldquo;<a href="../doc/earth-notes.pdf">Notes on the earth package</a>&rdquo;.
</p>
<p><b>Acknowledgment</b>
</p>
<p>Thanks to Max Kuhn for the original <code>evimp</code> code and for helpful discussions.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+earth">earth</a></code>,
<code><a href="#topic+plot.evimp">plot.evimp</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(ozone1)
earth.mod &lt;- earth(O3 ~ ., data=ozone1, degree=2)
ev &lt;- evimp(earth.mod, trim=FALSE)
plot(ev)
print(ev)
</code></pre>

<hr>
<h2 id='expand.bpairs'>Expand binomial-pair data from short to long form</h2><span id='topic+expand.bpairs'></span><span id='topic+expand.bpairs.default'></span><span id='topic+expand.bpairs.formula'></span>

<h3>Description</h3>

<p>Expand binomial-pair data from &ldquo;short&rdquo; to &ldquo;long&rdquo; form.
</p>
<p>The short form specifies the response with two columns
giving the numbers of successes and failures.
Example short form:</p>
<pre>
    survived died dose    sex
           3    0   10   male
           2    1   10 female
           1    2   20   male
           1    2   20 female
</pre>
<p>The long form specifies the response as single column of
<code>TRUE</code>s and <code>FALSE</code>s.
For example, the
long form of the above data (spaces and comments added):</p>
<pre>
    survived dose    sex
        TRUE   10   male     # row 1 of short data: 0 died, 3 survived
        TRUE   10   male
        TRUE   10   male

       FALSE   10 female     # row 2 of short data: 1 died, 2 survived
        TRUE   10 female
        TRUE   10 female

       FALSE   20   male     # row 3 of short data: 2 died, 1 survived
       FALSE   20   male
        TRUE   20   male

       FALSE   20 female     # row 4 of short data: 2 died, 1 survived
       FALSE   20 female
        TRUE   20 female
</pre>
<p>In this example the total number of survived and died for each row in
the short data is the same, but in general that need not be true.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'formula'
expand.bpairs(formula = stop("no 'formula' argument"), data = NULL, sort = FALSE, ...)

## Default S3 method:
expand.bpairs(data = stop("no 'data' argument"), y = NULL, sort = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="expand.bpairs_+3A_formula">formula</code></td>
<td>

<p>Model formula such as <code>survived + died ~ dose + temp</code>.
</p>
</td></tr>
<tr><td><code id="expand.bpairs_+3A_data">data</code></td>
<td>

<p>Matrix or dataframe containing the data.
</p>
</td></tr>
<tr><td><code id="expand.bpairs_+3A_y">y</code></td>
<td>

<p>Model response.  One of:
<br />
o Two column matrix or dataframe of binomial pairs e.g. <code>cbind(survived, died=20-survived)</code>
<br />
o Two-element numeric vector specifying the response columns in <code>data</code> e.g. <code>c(1,2)</code>
<br />
o Two-element character vector specifying the response column names in <code>data</code>
e.g. <code>c("survived", "died")</code>.
The full names must be used (partial matching isn't supported).
</p>
</td></tr>
<tr><td><code id="expand.bpairs_+3A_sort">sort</code></td>
<td>

<p>Default <code>FALSE</code>.
Use <code>TRUE</code> to sort the rows of the long data so it is returned
in canonical form, independent of the row order of the short data.
The long data is sorted on predictor values;
predictors on the left take precedence in the sort order.
</p>
</td></tr>
<tr><td><code id="expand.bpairs_+3A_...">...</code></td>
<td>

<p>Unused, but provided for generic/method consistency.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A dataframe of the data in the long form, with expanded binomial pairs.
The first column of the data will be the response column
(a column of <code>TRUE</code>s and <code>FALSE</code>s).
</p>
<p>Additionally, the returned value has two attached attributes:
</p>
<p><code>bpairs.index</code> A vector of row indices into the returned data.
Can be used to reconstruct the short data from the long data
(although this package does not yet provide a function to do so).
</p>
<p><code>ynames</code> Column names of the original response (a two-element character vector).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>survived &lt;- c(3,2,1,1) # short data for demo (too short to build a real model)
died     &lt;- c(0,1,2,2)
dose &lt;- c(10,10,20,20)
sex  &lt;- factor(c("male", "female", "male", "female"))

short.data &lt;- data.frame(survived, died, dose, sex)

expand.bpairs(survived + died ~ ., short.data) # returns long form of the data

# expand.bpairs(data=short.data, y=cbind(survived, died)) # equivalent
# expand.bpairs(short.data, c(1,2))                       # equivalent
# expand.bpairs(short.data, c("survived", "died"))        # equivalent

# For example models, see the earth vignette
# section "Short versus long binomial data".
</code></pre>

<hr>
<h2 id='format.earth'>Format earth objects</h2><span id='topic+format.earth'></span>

<h3>Description</h3>

<p>Return a string representing an <code><a href="#topic+earth">earth</a></code> expression
(<code><a href="#topic+summary.earth">summary.earth</a></code> calls this function internally to
display the terms of the <code>earth</code> model).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'earth'
format(x = stop("no 'x' argument"),
       style = "h", decomp = "anova", digits = getOption("digits"),
       use.names = TRUE, colon.char = ":", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="format.earth_+3A_x">x</code></td>
<td>

<p>An <code><a href="#topic+earth">earth</a></code> object.
This is the only required argument.
</p>
</td></tr>
<tr><td><code id="format.earth_+3A_style">style</code></td>
<td>

<p>Formatting style. One of<br />
<code>"h"</code> (default) more compact<br />
<code>"pmax"</code> for those who prefer it<br />
<code>"max"</code> is the same as <code>"pmax"</code> but prints <code>max</code> rather than <code>pmax</code><br />
<code>"C"</code> C style expression with zero based indexing<br />
<code>"bf"</code> basis function format
</p>
</td></tr>
<tr><td><code id="format.earth_+3A_decomp">decomp</code></td>
<td>
<p>One of<br />
<code>"anova"</code>  (default) order the terms using the &quot;anova decomposition&quot;,
i.e., in increasing order of interaction<br />
<code>"none"</code>   order the terms as created during the earth forward pass.<br />
</p>
</td></tr>
<tr><td><code id="format.earth_+3A_digits">digits</code></td>
<td>

<p>Number of significant digits.
The default is <code>getOption(digits)</code>.
</p>
</td></tr>
<tr><td><code id="format.earth_+3A_use.names">use.names</code></td>
<td>
<p>One of<br />
<code>TRUE</code> (default), use variable names if available.<br />
<code>FALSE</code> use names of the form <code>x[,1]</code>.
</p>
</td></tr>
<tr><td><code id="format.earth_+3A_colon.char">colon.char</code></td>
<td>

<p>Change colons in the returned string to colon.char.
Default is &quot;:&quot; (no change).
Specifying <code>colon.char="*"</code> can be useful in some contexts to change
names of the form <code>x1:x2</code> to <code>x1*x2</code>.
</p>
</td></tr>
<tr><td><code id="format.earth_+3A_...">...</code></td>
<td>

<p>Unused, but provided for generic/method consistency.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A character representation of the <code>earth</code> model.
</p>
<p>If there are multiple responses, <code>format.earth</code> will return multiple strings.
</p>
<p>If there are embedded GLM model(s), the strings for the GLM model(s)
come after the strings for the standard <code>earth</code> model(s).
</p>


<h3>Note</h3>

<p>The FAQ section in the package vignette gives precise details of the
<code>"anova"</code> ordering.
</p>
<p>Using <code>format.earth</code>, perhaps after hand editing the returned string,
you can create an alternative to <code>predict.earth</code>.
For example:
</p>
<pre>as.func &lt;- function(object, digits = 8, use.names = FALSE, ...)
  eval(parse(text=paste(
    "function(x){\n",
    "if(is.vector(x))\n",
    "  x &lt;- matrix(x, nrow = 1, ncol = length(x))\n",
    "with(as.data.frame(x),\n",
    format(object, digits = digits, use.names = use.names, style = "pmax", ...),
    ")\n",
    "}\n", sep = "")))

earth.mod &lt;- earth(Volume ~ ., data = trees)
my.func &lt;- as.func(earth.mod, use.names = FALSE)
my.func(c(10,80))             # returns 16.84
predict(earth.mod, c(10,80))  # returns 16.84
</pre>
<p>Note that with <code>pmax</code> the R expression generated by
<code>format.earth</code> can handle multiple cases.
Thus the expression is consistent with the way <code>predict</code>
functions usually work in R &mdash; we can give <code>predict</code> multiple
cases (i.e., multiple rows in the input matrix) and it will return a
vector of predicted values.
</p>
<pre> 
</pre>
<p>The  earth package also provides a function <code>format.lm</code>.
It has arguments as follows<br />
<code>format.lm(x, digits=getOption("digits"), use.names=TRUE, colon.char=":")</code><br />
(Strictly speaking, <code>format.lm</code> doesn't belong in the earth package.) Example:
</p>
<pre>
lm.mod &lt;- lm(Volume ~ Height*Girth, data = trees)
cat(format(lm.mod, colon.char="*"))

# yields:
#    69.4
#    -  1.30 * Height
#    -  5.86 * Girth
#    + 0.135 * Height*Girth
</pre>


<h3>See Also</h3>

<p><code><a href="#topic+summary.earth">summary.earth</a></code>,
<code><a href="base.html#topic+pmax">pmax</a></code>,
</p>


<h3>Examples</h3>

<pre><code class='language-R'>earth.mod &lt;- earth(Volume ~ ., data = trees)
cat(format(earth.mod))

# yields:
#    29.0
#    -  3.42 * h(14.2-Girth)
#    +  6.23 * h(Girth-14.2)
#    + 0.581 * h(Height-75)

cat(format(earth.mod, style="pmax"))

# yields:
#    29.0
#    -  3.42 * pmax(0,   14.2 -  Girth)
#    +  6.23 * pmax(0,  Girth -  14.2)
#    + 0.581 * pmax(0, Height -  75)

cat(format(earth.mod, style="C"))

# yields (note zero based indexing):
#    29.0
#    -  3.42 * max(0, 14.2 - x[0])
#    +  6.23 * max(0, x[0] - 14.2)
#    + 0.581 * max(0, x[1] - 75)

cat(format(earth.mod, style="bf"))

# yields:
#    29.0
#    -  3.42 * bf1
#    +  6.23 * bf2
#    + 0.581 * bf3
#
#     bf1  h(14.2-Girth)
#     bf2  h(Girth-14.2)
#     bf3  h(Height-75)
</code></pre>

<hr>
<h2 id='mars.to.earth'>Convert a mars object from the mda package to an earth object</h2><span id='topic+mars.to.earth'></span>

<h3>Description</h3>

<p>Convert a <code><a href="mda.html#topic+mars">mars</a></code> object from the <code>mda</code> package to an <code><a href="#topic+earth">earth</a></code> object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mars.to.earth(object, trace=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mars.to.earth_+3A_object">object</code></td>
<td>

<p>A <code>mars</code> object, created using <code><a href="mda.html#topic+mars">mars</a></code> in the <code>mda</code> package.
</p>
</td></tr>
<tr><td><code id="mars.to.earth_+3A_trace">trace</code></td>
<td>

<p>If <code>TRUE</code> (default) print a summary of the conversion.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The value is the same format as that returned by <code><a href="#topic+earth">earth</a></code> but
with skeletal versions of <code>rss.per.subset</code>,
<code>gcv.per.subset</code>, and <code>prune.terms</code>.<br />
</p>
<p>You can fully initialize these components by calling <code><a href="#topic+update.earth">update.earth</a></code>
after <code>mars.to.earth</code>, but if you do this <code>selected.terms</code> may change.
However with <code>pmethod="backward"</code> a change is unlikely &mdash;
<code>selected.terms</code> would change only if GCVs are so close that numerical errors
have an effect.
</p>


<h3>Note</h3>

<p><b>Differences between mars and earth objects</b>
</p>
<p>Perhaps the most notable difference between
<code>mars</code> and <code>earth</code> objects is that <code>mars</code> returns the
MARS basis matrix in a field called &quot;<code>x</code>&quot;
whereas <code>earth</code> returns &quot;<code>bx</code>&quot; with only the selected terms.
Also, <code>earth</code> returns &quot;<code>dirs</code>&quot; rather than &quot;<code>factors</code>&quot;,
and in <code>earth</code> this matrix can have entries of value 2 for linear predictors.
</p>
<p>For details of other differences between <code>mars</code> and <code>earth</code> objects,
see the comments in the source code of <code>mars.to.earth</code>.
</p>
<p><b>Weights</b>
</p>
<p>The <code>w</code> argument is silently ignored by <code>mars</code>.
</p>
<p><code>mars</code> normalizes <code>wp</code> to (euclidean) length 1;
<code>earth</code> normalizes
<code>wp</code> to length equal to the number of responses, i.e., the number
of columns in <code>y</code>.  This change was made so an all ones <code>wp</code>
(or in fact any all constant <code>wp</code>) is equivalent to using no <code>wp</code>.
</p>
<p>If the original call to <code>mars</code> used the <code>wp</code> argument,
<code>mars.to.earth</code> will run <code><a href="#topic+update.earth">update.earth</a></code> to force consistency.
This could modify the model, so a warning is issued.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+earth">earth</a></code>,
<code><a href="mda.html#topic+mars">mars</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if(require(mda)) {
    mars.mod &lt;- mars(trees[,-3], trees[,3])
    earth.mod &lt;- mars.to.earth(mars.mod)
    # the standard earth functions can now be used
    # note the reconstructed call in the summary
    summary(earth.mod, digits = 2)
}
</code></pre>

<hr>
<h2 id='model.matrix.earth'>Get the earth basis matrix</h2><span id='topic+model.matrix.earth'></span>

<h3>Description</h3>

<p>Get the basis matrix of an <code><a href="#topic+earth">earth</a></code> model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'earth'
model.matrix(object = stop("no 'object' argument"),
    x = NULL, subset = NULL, which.terms = NULL,
    trace = 0,
    ...,
    Env = parent.frame(),
    Callers.name = "model.matrix.earth")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="model.matrix.earth_+3A_object">object</code></td>
<td>

<p>An <code><a href="#topic+earth">earth</a></code> model.
This is the only required argument.
</p>
</td></tr>
<tr><td><code id="model.matrix.earth_+3A_x">x</code></td>
<td>

<p>Default is NULL, meaning use the original data
used to build the <code>earth</code> model
(after taking the original <code>subset</code>, if any).
</p>
<p>Else <code>x</code> can be a data frame, a matrix, or a vector with
length equal to a multiple of the number of columns
of the original input matrix <code>x</code>.
(There is some leniency here.  For example, column names aren't
necessary if <code>x</code> has the same number of predictors originally
used to build the <code>earth</code> model.)
</p>
</td></tr>
<tr><td><code id="model.matrix.earth_+3A_subset">subset</code></td>
<td>

<p>Which rows to use in <code>x</code>.
Default is NULL, meaning use all of <code>x</code>.
</p>
</td></tr>
<tr><td><code id="model.matrix.earth_+3A_which.terms">which.terms</code></td>
<td>

<p>Which terms to use.
Default is NULL, meaning all terms in the earth model
(i.e. the terms in <code>object$selected.terms</code>).
</p>
</td></tr>
<tr><td><code id="model.matrix.earth_+3A_trace">trace</code></td>
<td>

<p>Default 0. Set to non-zero to see which data <code>model.matrix.earth</code> is using.
</p>
</td></tr>
<tr><td><code id="model.matrix.earth_+3A_...">...</code></td>
<td>

<p>Unused, but provided for generic/method consistency.
</p>
</td></tr>
<tr><td><code id="model.matrix.earth_+3A_env">Env</code></td>
<td>

<p>For internal use.
</p>
</td></tr>
<tr><td><code id="model.matrix.earth_+3A_callers.name">Callers.name</code></td>
<td>

<p>For internal use (used by earth in trace messages).
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A basis matrix <code>bx</code> of the same form returned by <code><a href="#topic+earth">earth</a></code>.
The format of <code>bx</code> is described in <code><a href="#topic+earth.object">earth.object</a></code>.
</p>
<p>If <code>x</code>, <code>subset</code>, and <code>which.terms</code> are all NULL (the
default), this function returns the model's <code>bx</code>.  In this case,
it is perhaps easier to simply use <code>object$bx</code>.<br />
</p>
<p>The matrix <code>bx</code> can be used
as the input matrix to <code><a href="stats.html#topic+lm">lm</a></code> or <code><a href="stats.html#topic+glm">glm</a></code>,
as shown below in the example.
In fact, that is what earth does internally after the pruning pass &mdash;
it calls <code><a href="stats.html#topic+lm.fit">lm.fit</a></code>,
and additionally <code><a href="stats.html#topic+glm">glm</a></code> if earth's <code>glm</code> argument is used.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+earth">earth</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Example 1

data(trees)
earth.mod &lt;- earth(Volume ~ ., data = trees) # standard earth model
summary(earth.mod, decomp = "none")  # "none" to print terms in same order as lm.mod below
bx &lt;- model.matrix(earth.mod)        # earth model's basis mat (equivalent to bx &lt;- earth.mod$bx)
lm.mod &lt;- lm(trees$Volume ~ bx[,-1]) # -1 to drop intercept
summary(lm.mod)                      # yields same coeffs as above summary
                                     # displayed t values are not meaningful

# Example 2

earth.mod &lt;- earth(Volume~., data=trees) # standard earth model
summary(earth.mod, decomp = "none")  # "none" to print terms in same order as lm.mod below
bx &lt;- model.matrix(earth.mod)        # earth model's basis mat (equivalent to bx &lt;- earth.mod$bx)
bx &lt;- bx[, -1]                       # drop intercept column
bx &lt;- as.data.frame(bx)              # lm requires a data frame
bx$Volume &lt;- trees$Volume            # add Volume to data
lm.mod &lt;- lm(Volume~., data=bx)      # standard linear regression on earth's basis mat
summary(lm.mod)                      # yields same coeffs as above summary
                                     # displayed t values are not meaningful
</code></pre>

<hr>
<h2 id='ozone1'>Ozone readings in Los Angeles with incomplete cases removed</h2><span id='topic+ozone1'></span>

<h3>Description</h3>

<p>Ozone readings in Los Angeles, with incomplete cases removed.</p>


<h3>Format</h3>

<p>A data frame with 330 observations on 10 variables.
</p>

<table>
<tr>
 <td style="text-align: left;">
      <code>O3</code> </td><td style="text-align: left;"> daily maximum of the hourly average ozone concentrations in Upland, CA</td>
</tr>
<tr>
 <td style="text-align: left;">
      <code>vh</code> </td><td style="text-align: left;"> 500 millibar pressure height, measured at the Vandenberg air force base</td>
</tr>
<tr>
 <td style="text-align: left;">
      <code>wind</code> </td><td style="text-align: left;"> wind speed in mph at LAX airport</td>
</tr>
<tr>
 <td style="text-align: left;">
      <code>humidity</code> </td><td style="text-align: left;"> humidity in percent at LAX</td>
</tr>
<tr>
 <td style="text-align: left;">
      <code>temp</code> </td><td style="text-align: left;"> Sandburg Air Force Base temperature in degrees Fahrenheit</td>
</tr>
<tr>
 <td style="text-align: left;">
      <code>ibh</code> </td><td style="text-align: left;"> temperature inversion base height in feet</td>
</tr>
<tr>
 <td style="text-align: left;">
      <code>dpg</code> </td><td style="text-align: left;"> pressure gradient from LAX to Daggert in mm Hg</td>
</tr>
<tr>
 <td style="text-align: left;">
      <code>ibt</code> </td><td style="text-align: left;"> inversion base temperature at LAX in degrees Fahrenheit</td>
</tr>
<tr>
 <td style="text-align: left;">
      <code>vis</code> </td><td style="text-align: left;"> visibility at LAX in miles</td>
</tr>
<tr>
 <td style="text-align: left;">
      <code>doy</code> </td><td style="text-align: left;"> day of the year</td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>Source</h3>

<p>This dataset was copied from <code>library(faraway)</code> and the name
changed to <code>ozone1</code> to prevent a name clash.
The data were originally made available by Leo Breiman who was a consultant
on a project where the data were generated.
Example analyses using these data may be found in Faraway and in Hastie and Tibshirani.
</p>
<pre>    &gt; ozone1
        O3   vh wind humidity temp  ibh dpg ibt vis doy
    1    3 5710    4       28   40 2693 -25  87 250  33
    2    5 5700    3       37   45  590 -24 128 100  34
    3    5 5760    3       51   54 1450  25 139  60  35
    ...
    330  1 5550    4       85   39 5000   8  44 100 390
</pre>


<h3>References</h3>

<p>Faraway (2005) <em>Extending the Linear Model with R</em>
<a href="https://www.maths.bath.ac.uk/~jjf23">https://www.maths.bath.ac.uk/~jjf23</a>
</p>
<p>Hastie and Tibshirani (1990) <em>Generalized Additive Models</em>
<a href="https://hastie.su.domains/pub.htm">https://hastie.su.domains/pub.htm</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+earth">earth</a></code>
</p>
<p><code><a href="datasets.html#topic+airquality">airquality</a></code> a different set of ozone data
</p>

<hr>
<h2 id='plot.earth'>Plot an earth object</h2><span id='topic+plot.earth'></span><span id='topic+earth_plotmodsel'></span>

<h3>Description</h3>

<p>Plot an <code><a href="#topic+earth">earth</a></code> object.
By default the plot shows model selection, cumulative distribution
of the residuals, residuals versus fitted values, and the residual QQ plot.
</p>
<p>This function calls <code><a href="plotmo.html#topic+plotres">plotres</a></code> internally.
The first arguments are identical to <code>plotres</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'earth'
plot(x = stop("no 'x' argument"),

  # the following are identical to plotres arguments

  which = 1:4, info = FALSE, versus = 1, standardize = FALSE, delever = FALSE,
  level = 0, id.n = 3, labels.id = NULL, smooth.col = 2, grid.col = 0,
  jitter = 0, do.par = NULL, caption = NULL,
  trace = 0, npoints = 3000, center = TRUE, type = NULL, nresponse = NA,

  # the following are earth specific

  col.cv = "lightblue", col.grsq = 1, col.rsq = 2, col.infold.rsq = 0,
  col.mean.infold.rsq = 0, col.mean.oof.rsq = "palevioletred",
  col.npreds = if(is.null(object$cv.oof.rsq.tab)) 1 else 0, col.oof.labs = 0,
  col.oof.rsq = "mistyrose2", col.oof.vline = col.mean.oof.rsq,
  col.pch.cv.rsq = 0, col.pch.max.oof.rsq = 0, col.vline = col.grsq,
  col.vseg = 0, lty.grsq = 1, lty.npreds = 2, lty.rsq = 5, lty.vline = "12",
  legend.pos = NULL, ...)

earth_plotmodsel( # for internal use by plotres
  x, col.rsq = 2, col.grsq = 1, col.infold.rsq = 0,
  col.mean.infold.rsq = 0, col.mean.oof.rsq = "palevioletred",
  col.npreds = NULL, col.oof.labs = 0, col.oof.rsq = "mistyrose2",
  col.oof.vline = col.mean.oof.rsq, col.pch.cv.rsq = 0,
  col.pch.max.oof.rsq = 0, col.vline = col.grsq, col.vseg = 0,
  lty.grsq = 1, lty.npreds = 2, lty.rsq = 5, lty.vline = "12",
  legend.pos=NULL, add = FALSE, jitter = 0,
  max.nterms = length(object$rss.per.subset),
  max.npreds=max(1,get.nused.preds.per.subset(object$dirs,object$prune.terms)),
  ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.earth_+3A_x">x</code></td>
<td>

<p>An <code><a href="#topic+earth">earth</a></code> object.
This is the only required argument.
(It is called &quot;x&quot; for consistency with the generic <code><a href="graphics.html#topic+plot">plot</a></code>.)
<br />
<br />
</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_which">which</code>, <code id="plot.earth_+3A_info">info</code>, <code id="plot.earth_+3A_versus">versus</code></td>
<td>
<p>These arguments are identical to <code><a href="plotmo.html#topic+plotres">plotres</a></code>.
Please see the help page for <code><a href="plotmo.html#topic+plotres">plotres</a></code>.
</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_standardize">standardize</code>, <code id="plot.earth_+3A_delever">delever</code>, <code id="plot.earth_+3A_level">level</code></td>
<td>
<p>.</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_id.n">id.n</code>, <code id="plot.earth_+3A_labels.id">labels.id</code>, <code id="plot.earth_+3A_smooth.col">smooth.col</code></td>
<td>
<p>.</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_grid.col">grid.col</code>, <code id="plot.earth_+3A_jitter">jitter</code></td>
<td>
<p>.</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_do.par">do.par</code>, <code id="plot.earth_+3A_caption">caption</code>, <code id="plot.earth_+3A_trace">trace</code></td>
<td>
<p>.</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_npoints">npoints</code>, <code id="plot.earth_+3A_center">center</code></td>
<td>
<p>.</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_type">type</code>, <code id="plot.earth_+3A_nresponse">nresponse</code></td>
<td>
<p>.<br />
<br />
</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_col.cv">col.cv</code></td>
<td>
<p>Default <code>"lightblue"</code>.
Color of cross validation line in the residuals plot.
This is the residual of the mean out-fold-predicted value.
<br />
<br />
<b>The following arguments are for the model selection plot.</b>
<br />
<br />
</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_col.grsq">col.grsq</code></td>
<td>
<p>Default <code>1</code>.
Color of GRSq line in the Model Selection plot.
Use <code>0</code> for no GRSq line.
</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_col.rsq">col.rsq</code></td>
<td>
<p>Default <code>2</code>.
Color of the RSq line in the Model Selection plot.
Use <code>0</code> for no RSq line.
</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_col.infold.rsq">col.infold.rsq</code></td>
<td>

<p>Color of in-fold RSq lines for each fold in the Model Selection plot.
Applies only if <code>nfold</code> and <code>keepxy</code> were used
in the original call to <code>earth</code>.
Default is <code>0</code>, lines not plotted.
</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_col.mean.infold.rsq">col.mean.infold.rsq</code></td>
<td>

<p>Color of mean in-fold RSq for each number of terms in the Model Selection plot.
Default is <code>0</code>, line not plotted.
Applies only if <code>nfold</code> and <code>keepxy</code> were used
in the original call to <code>earth</code>.
</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_col.mean.oof.rsq">col.mean.oof.rsq</code></td>
<td>
<p>Default <code>"palevioletred"</code>.
Color of mean out-of-fold RSq for each number of terms in the Model Selection plot.
Applies only if <code>nfold</code> and <code>keepxy</code> were used
in the original call to <code>earth</code>.
Use <code>0</code> to not plot this line.
</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_col.npreds">col.npreds</code></td>
<td>
<p>Color
of the &quot;number of predictors&quot; plot in the Model Selection plot.
The default displays the number of predictors unless the <code>oof.rsq</code>'s are displayed.
Use <code>0</code> for no &quot;number of predictors&quot; plot.
</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_col.oof.labs">col.oof.labs</code></td>
<td>

<p>Color of fold number labels on the <code>oof.rsq</code> lines.
Default is <code>0</code>, no labels.
</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_col.oof.rsq">col.oof.rsq</code></td>
<td>

<p>Color of out-of-fold RSq lines for each fold in the Model Selection plot.
Applies only if <code>nfold</code> and <code>keepxy</code> were used
in the original call to <code>earth</code>.
Default is <code>"mistyrose2"</code>, a pale pink.
Use <code>0</code> to not plot these lines.
May be a vector of colors, which will be recycled if necessary.
</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_col.oof.vline">col.oof.vline</code></td>
<td>

<p>Color of vertical line at the maximum <code>oof.rsq</code> in the Model Selection plot.
Default is <code>col.mean.oof.rsq</code>.
</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_col.pch.cv.rsq">col.pch.cv.rsq</code></td>
<td>

<p>Color of point plotted on the <code>oof.rsq</code> line to indicate the <code>cv.rsq</code>.
for that fold
(i.e., it is plotted at the number of terms selected by the in-fold GCV).
Default is <code>0</code>, point not plotted.
</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_col.pch.max.oof.rsq">col.pch.max.oof.rsq</code></td>
<td>

<p>Color of point plotted on the <code>oof.rsq</code> line to indicate the
maximum <code>oof.rsq</code> for that fold.
Default is <code>0</code>, point not plotted.
</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_col.vline">col.vline</code></td>
<td>

<p>Color of the vertical line at selected model in the Model Selection plot.
Default is <code>col.grsq</code>.
This will be at the maximum GRSq unless <code>pmethod="none"</code>.
Use <code>0</code> for no vertical line.
</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_col.vseg">col.vseg</code></td>
<td>

<p>Default is <code>0</code>.
Color of triangular marker at top of vertical line for best GRSq.
</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_lty.grsq">lty.grsq</code></td>
<td>

<p>Line type of GRSq line in the Model Selection plot.
Default is <code>1</code>
</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_lty.npreds">lty.npreds</code></td>
<td>

<p>Line type of the &quot;number of predictors&quot; plot in the Model Selection plot.
Default is <code>2</code>.
</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_lty.rsq">lty.rsq</code></td>
<td>

<p>Line type of RSq line in the Model Selection plot.
Default is <code>5</code>.
</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_lty.vline">lty.vline</code></td>
<td>

<p>Line type of vertical line at selected model in the Model Selection plot.
Default is <code>"12"</code>.
</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_legend.pos">legend.pos</code></td>
<td>

<p>Position of the legend in the Model Selection plot.
Default is <code>NULL</code> meaning automatic.
Use <code>legend.pos=NA</code> or <code>0</code> for no legend.
Can be something like <code>legend.pos="topleft"</code> or <code>legend.pos=c(6, .75)</code>.
</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_add">add</code>, <code id="plot.earth_+3A_max.nterms">max.nterms</code>, <code id="plot.earth_+3A_max.npreds">max.npreds</code></td>
<td>

<p><code>earth_plotmodsel</code> arguments for internal use by
<code>plotres</code>.
<br />
<br />
<br />
</p>
</td></tr>
<tr><td><code id="plot.earth_+3A_...">...</code></td>
<td>
<p>Please see <code><a href="plotmo.html#topic+plotres">plotres</a></code> for the details
on the dots arguments.
</p>
<p>The <code>ylim</code> argument is treated specially in the model selection plot:
<code>ymin</code> equal to <code>-1</code> means use
the smallest GRSq or RSq value, excluding the intercept,
and <code>ymax</code> equal <code>-1</code> means use
the largest GRSq or RSq value.
</p>
</td></tr>
</table>


<h3>Note</h3>

<p>For details on interpreting the graphs,
please see the <code>earth</code> package vignettes
&ldquo;<a href="../doc/earth-notes.pdf">Notes on the earth package</a>&rdquo;
and
&ldquo;<a href="../doc/earth-varmod.pdf">Variance models in earth</a>&rdquo;.
</p>
<p>Note that cross-validation data will not be displayed unless
both <code>nfold</code> and <code>keepxy</code> were used in the original call to
<code>earth</code>.
</p>
<p>To remove the <code>Number of used predictors</code> from the Model Selection
graph (to reduce clutter), use <code>col.npreds=0</code>.
</p>
<p><code>earth_plotmodsel</code> is provided for use by <code><a href="plotmo.html#topic+plotres">plotres</a></code>.
</p>
<p><b>Acknowledgment</b>
</p>
<p>This function incorporates the function <code>spread.labs</code> from the orphaned
package <code>TeachingDemos</code> written by Greg Snow.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+earth">earth</a></code>,
<code><a href="#topic+plot.earth.models">plot.earth.models</a></code>,
<code><a href="#topic+plotd">plotd</a></code>,
<code><a href="plotmo.html#topic+plotmo">plotmo</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(ozone1)
earth.mod &lt;- earth(O3 ~ ., data = ozone1, degree = 2)
plot(earth.mod)
</code></pre>

<hr>
<h2 id='plot.earth.models'>Compare earth models by plotting them.</h2><span id='topic+plot.earth.models'></span>

<h3>Description</h3>

<p>Compare <code><a href="#topic+earth">earth</a></code> models by plotting them.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'earth.models'
plot(x = stop("no 'x' argument"), which = c(1:2),
    caption = "", jitter = 0,
    col.grsq = discrete.plot.cols(length(objects)), lty.grsq = 1,
    col.rsq = 0, lty.rsq = 5,
    col.vline = col.grsq, lty.vline = "12",
    col.npreds = 0,  lty.npreds  = 2,
    legend.text = NULL, do.par = NULL, trace = 0,
    ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.earth.models_+3A_x">x</code></td>
<td>

<p>A list of one or more <code><a href="#topic+earth">earth</a></code> objects,
or a single <code><a href="#topic+earth">earth</a></code> object.
This is the only required argument.
(This argument is called 'x' for consistency with the generic <code><a href="graphics.html#topic+plot">plot</a></code>.)
</p>
</td></tr>
<tr><td><code id="plot.earth.models_+3A_which">which</code></td>
<td>

<p>Which plots to plot: 1 model, 2 cumulative distribution of residuals.
Default is <code>1:2</code>, meaning both.
</p>
</td></tr>
<tr><td><code id="plot.earth.models_+3A_caption">caption</code></td>
<td>

<p>Overall caption. Values:<br />
<code>"string"</code> string<br />
<code>""</code> (default) no caption<br />
<code>NULL</code> generate a caption from the <code>$call</code> component of the <code>earth</code> objects.
</p>
</td></tr>
<tr><td><code id="plot.earth.models_+3A_jitter">jitter</code></td>
<td>

<p>Jitter applied to GRSq and RSq values to minimize over-plotting.
Default is <code>0</code>, meaning no jitter.
A typical useful value is 0.01.
<br />
<br />
<em>For the col arguments below, 0 means do not plot the corresponding graph element.
You can use vectors of colors.</em>
</p>
</td></tr>
<tr><td><code id="plot.earth.models_+3A_col.grsq">col.grsq</code></td>
<td>

<p>Vector of colors for the GRSq plot.
The default is <code>discrete.plot.cols(length(x))</code> which is vector
of distinguishable colors, the first three of which are also distinguishable on
a monochrome printer.
You can examine the colors using<br />
<code>earth:::discrete.plot.cols()</code>.
</p>
</td></tr>
<tr><td><code id="plot.earth.models_+3A_lty.grsq">lty.grsq</code></td>
<td>

<p>Line type for the GRSq plot.
Default is <code>1</code>.
</p>
</td></tr>
<tr><td><code id="plot.earth.models_+3A_col.rsq">col.rsq</code></td>
<td>

<p>Vector of colors for the RSq plot.
Default is <code>0</code>, meaning no RSq plot.
</p>
</td></tr>
<tr><td><code id="plot.earth.models_+3A_lty.rsq">lty.rsq</code></td>
<td>

<p>Line type for the RSq plot.
Default is <code>5</code>.
</p>
</td></tr>
<tr><td><code id="plot.earth.models_+3A_col.vline">col.vline</code></td>
<td>

<p>A vertical line is drawn for each object
to show which model size was chosen for that object.
The color of the line is <code>col.vline</code>.
Default is <code>col.grsq</code>.
</p>
</td></tr>
<tr><td><code id="plot.earth.models_+3A_lty.vline">lty.vline</code></td>
<td>

<p>Line type of vertical lines (a vertical line is drawn to show the selected model for each object).
Can be a vector.
Default is <code>3</code>.
</p>
</td></tr>
<tr><td><code id="plot.earth.models_+3A_col.npreds">col.npreds</code></td>
<td>

<p>Vector of colors for the &quot;number of predictors&quot; plot within the model selection plot.
Default is <code>0</code>, meaning no &quot;number of predictors&quot; plot.
The special value <code>NULL</code> means borrow <code>col.grsq</code>
(or <code>col.rsq</code> if <code>col.grsq</code> is <code>NULL</code>).
</p>
</td></tr>
<tr><td><code id="plot.earth.models_+3A_lty.npreds">lty.npreds</code></td>
<td>

<p>Line type of the &quot;number of predictors&quot; plot (in the Model Selection plot).
Default is <code>2</code>.
</p>
</td></tr>
<tr><td><code id="plot.earth.models_+3A_legend.text">legend.text</code>, <code id="plot.earth.models_+3A_do.par">do.par</code>, <code id="plot.earth.models_+3A_trace">trace</code></td>
<td>
<p>Please see <code><a href="plotmo.html#topic+plotres">plotres</a></code>
</p>
</td></tr>
<tr><td><code id="plot.earth.models_+3A_...">...</code></td>
<td>
<p>Please see <code><a href="plotmo.html#topic+plotres">plotres</a></code>
</p>
</td></tr>
</table>


<h3>Note</h3>

<p>This function ignores GLM and cross-validation components of the earth model, if any.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+earth">earth</a></code>,
<code><a href="#topic+plot.earth">plot.earth</a></code>,
<code><a href="#topic+plot.earth.models">plot.earth.models</a></code>,
<code><a href="#topic+plotd">plotd</a></code>,
<code><a href="plotmo.html#topic+plotmo">plotmo</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(ozone1)
a1 &lt;- earth(O3 ~ .,          data = ozone1, degree = 2)
a2 &lt;- earth(O3 ~ .-wind,     data = ozone1, degree = 2)
a3 &lt;- earth(O3 ~ .-humidity, data = ozone1, degree = 2)
plot.earth.models(list(a1,a2,a3), ylim=c(.65,.85))
</code></pre>

<hr>
<h2 id='plot.evimp'>Plot an evimp object (created by the evimp function)</h2><span id='topic+plot.evimp'></span>

<h3>Description</h3>

<p>Plot an <code><a href="#topic+evimp">evimp</a></code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'evimp'
plot(x = stop("no 'x' argument"),
    cex.var = 1,
    type.nsubsets = "l", col.nsubsets = "black", lty.nsubsets = 1,
    type.gcv = "l", col.gcv = 2, lty.gcv = 1,
    type.rss = "l", col.rss = "gray60", lty.rss = 1,
    cex.legend = 1, x.legend = nrow(x), y.legend = x[1,"nsubsets"],
    rh.col = 1, do.par = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.evimp_+3A_x">x</code></td>
<td>

<p>An <code><a href="#topic+evimp">evimp</a></code> object.
</p>
</td></tr>
<tr><td><code id="plot.evimp_+3A_cex.var">cex.var</code></td>
<td>

<p>cex for variable names.
Default is 1.
Make smaller (say 0.8) if you have lots of variables.
</p>
</td></tr>
<tr><td><code id="plot.evimp_+3A_type.nsubsets">type.nsubsets</code></td>
<td>

<p>Plot type for nsubsets graph.
Default is &quot;l&quot;.
Use &quot;n&quot; for none, &quot;b&quot; looks good too.
</p>
</td></tr>
<tr><td><code id="plot.evimp_+3A_col.nsubsets">col.nsubsets</code></td>
<td>

<p>Color of nsubsets line.
Default is &quot;black&quot;.
</p>
</td></tr>
<tr><td><code id="plot.evimp_+3A_lty.nsubsets">lty.nsubsets</code></td>
<td>

<p>Line type of nsubsets line.
Default is 1.
</p>
</td></tr>
<tr><td><code id="plot.evimp_+3A_type.gcv">type.gcv</code>, <code id="plot.evimp_+3A_col.gcv">col.gcv</code>, <code id="plot.evimp_+3A_lty.gcv">lty.gcv</code></td>
<td>

<p>As above but for the gcv plot
</p>
</td></tr>
<tr><td><code id="plot.evimp_+3A_type.rss">type.rss</code>, <code id="plot.evimp_+3A_col.rss">col.rss</code>, <code id="plot.evimp_+3A_lty.rss">lty.rss</code></td>
<td>

<p>As above but for the rss plot
</p>
</td></tr>
<tr><td><code id="plot.evimp_+3A_cex.legend">cex.legend</code></td>
<td>

<p>cex for legend strings.
Default is 1.
Make smaller (say 0.8) if you want a smaller legend.
</p>
</td></tr>
<tr><td><code id="plot.evimp_+3A_x.legend">x.legend</code></td>
<td>

<p>x position of legend.
Use 0 for no legend.
</p>
</td></tr>
<tr><td><code id="plot.evimp_+3A_y.legend">y.legend</code></td>
<td>

<p>y position of legend.
</p>
</td></tr>
<tr><td><code id="plot.evimp_+3A_rh.col">rh.col</code></td>
<td>

<p>Color of right hand axis label.  Use <code>rh.col=0</code> for no label,
a workaround for when the label is mispositioned.
</p>
</td></tr>
<tr><td><code id="plot.evimp_+3A_do.par">do.par</code></td>
<td>

<p>Call <code>par()</code> for global settings as appropriate.
Default is <code>TRUE</code>, which sets<br />
<code>oma=c(bottom.margin,0,0,3), cex=cex.var</code>.<br />
Set to <code>FALSE</code> if you want to append figures to an existing plot.
</p>
</td></tr>
<tr><td><code id="plot.evimp_+3A_...">...</code></td>
<td>

<p>Extra arguments passed to plotting functions.
</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+earth">earth</a></code>,
<code><a href="#topic+evimp">evimp</a></code>,
<code><a href="#topic+plot.earth.models">plot.earth.models</a></code>,
<code><a href="plotmo.html#topic+plotmo">plotmo</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(ozone1)
earth.mod &lt;- earth(O3 ~ ., data=ozone1, degree=2)
ev &lt;- evimp(earth.mod)
plot(ev)
print(ev)
</code></pre>

<hr>
<h2 id='plot.varmod'>Plot a varmod object (created by calling earth with the varmod argument)</h2><span id='topic+plot.varmod'></span>

<h3>Description</h3>

<p>Plot a variance model (a <code>varmod</code> object).
</p>
<p>Typically you call this function for a variance model
embedded in an <code>earth</code> model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'varmod'
plot(x = stop("no 'x' argument"), which = 1:4,
  do.par = NULL, info=FALSE,
  cex = NULL, caption = NULL,
  line.col = 2, min.sd.col = line.col,
  trace = 0, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.varmod_+3A_x">x</code></td>
<td>

<p>A <code>varmod</code> object.
Typically this is embedded in a parent <code>earth</code> object,
and so you invoke this function with <code>plot(earth.mod$varmod)</code>.
The <code>varmod.method</code> argument must have been specified
when building the <code>earth</code> model.
</p>
</td></tr>
<tr><td><code id="plot.varmod_+3A_which">which</code></td>
<td>

<p>Which plots to plot.  Default is 1:4 meaning all.
The term <em>parent</em> below refers to the <code>earth</code> model in which
the <code>varmod</code> is embedded.<br />
1) fitted vs parent fitted<br />
2) fitted vs parent first predictor<br />
3) residuals vs fitted<br />
4) model selection graph (only when <code>varmod.method="earth"</code> or <code>"x.earth"</code>).<br />
</p>
</td></tr>
<tr><td><code id="plot.varmod_+3A_do.par">do.par</code></td>
<td>
<p>Please see <code><a href="plotmo.html#topic+plotres">plotres</a></code>
</p>
</td></tr>
<tr><td><code id="plot.varmod_+3A_info">info</code></td>
<td>

<p>Plot some additional information, including lowess fits in the first two plots.
</p>
</td></tr>
<tr><td><code id="plot.varmod_+3A_cex">cex</code></td>
<td>

<p>Character expansion.
</p>
</td></tr>
<tr><td><code id="plot.varmod_+3A_caption">caption</code></td>
<td>

<p>Default is NULL, meaning automatically generate an overall caption.
</p>
</td></tr>
<tr><td><code id="plot.varmod_+3A_line.col">line.col</code></td>
<td>

<p>Color of lines in the plots.
Default is <code>red</code>.
</p>
</td></tr>
<tr><td><code id="plot.varmod_+3A_min.sd.col">min.sd.col</code></td>
<td>

<p>Color of the <code>min.sd</code> dotted horizontal line.
Default is <code>line.col</code>.  Use <code>0</code> to not plot this line.
</p>
</td></tr>
<tr><td><code id="plot.varmod_+3A_trace">trace</code>, <code id="plot.varmod_+3A_...">...</code></td>
<td>
<p>Similar to <code><a href="plotmo.html#topic+plotres">plotres</a></code>
</p>
</td></tr>
</table>


<h3>Note</h3>

<p>The horizontal red dotted line in the first two plots
shows the value of <code>min.sd</code>.
See <code><a href="#topic+earth">earth</a></code>'s <code>varmod.clamp</code> argument.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+varmod">varmod</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(ozone1)

set.seed(1) # optional, for cross validation reproducibility

# note: should really use ncross=30 below but for a quick demo we don't

earth.mod &lt;- earth(O3~temp, data=ozone1, nfold=10, ncross=3, varmod.method="lm")

plot(earth.mod$varmod) # plot the embedded variance model (this calls plot.varmod)
</code></pre>

<hr>
<h2 id='plotd'>Plot the distribution of predictions for each class</h2><span id='topic+plotd'></span>

<h3>Description</h3>

<p>Plot the distribution of the predicted values for each class.
Can be used for <code><a href="#topic+earth">earth</a></code> models, but also for models built by
<code><a href="stats.html#topic+lm">lm</a></code>,
<code><a href="stats.html#topic+glm">glm</a></code>,
<code><a href="MASS.html#topic+lda">lda</a></code>,
etc.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotd(object, hist = FALSE, type = NULL, nresponse = NULL, dichot = FALSE,
      trace = FALSE, xlim = NULL, ylim = NULL, jitter = FALSE, main=NULL,
      xlab = "Predicted Value", ylab = if(hist) "Count" else "Density",
      lty = 1, col = c("gray70", 1, "lightblue", "brown", "pink", 2, 3, 4),
      fill = if(hist) col[1] else 0,
      breaks = "Sturges", labels = FALSE,
      kernel = "gaussian", adjust = 1, zero.line = FALSE,
      legend = TRUE, legend.names = NULL, legend.pos = NULL,
      cex.legend = .8, legend.bg = "white", legend.extra = FALSE,
      vline.col = 0, vline.thresh = .5, vline.lty = 1, vline.lwd = 1,
      err.thresh = vline.thresh, err.col = 0, err.border = 0, err.lwd = 1,
      xaxt = "s", yaxt = "s", xaxis.cex = 1, sd.thresh = 0.01, ...)
</code></pre>


<h3>Arguments</h3>

<p>To start off, look at the arguments <code>object</code>, <code>hist</code>, <code>type</code>.<br />
For predict methods with multiple column responses, see the <code>nresponse</code> argument.<br />
For factor responses with more than two levels, see the <code>dichot</code> argument.
</p>
<table>
<tr><td><code id="plotd_+3A_object">object</code></td>
<td>

<p>Model object.
Typically a model which predicts a class or a class discriminant.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_hist">hist</code></td>
<td>

<p><code>FALSE</code> (default) to call <code><a href="stats.html#topic+density">density</a></code> internally.<br />
<code>TRUE</code> to call <code><a href="graphics.html#topic+hist">hist</a></code> internally.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_type">type</code></td>
<td>

<p>Type parameter passed to <code><a href="stats.html#topic+predict">predict</a></code>.
For allowed values see the <code>predict</code> method for
your <code>object</code> (such as <code><a href="#topic+predict.earth">predict.earth</a></code>).
By default, <code>plotd</code> tries to automatically select a suitable
value for the model in question.
(This is <code>"response"</code> for all objects except <code>rpart</code> models, where <code>"vector"</code>
is used. The choices will often be inappropriate.)
Typically you would set <code>hist=TRUE</code> when <code>type="class"</code>.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_nresponse">nresponse</code></td>
<td>

<p>Which column to use when <code>predict</code> returns multiple columns.
This can be a column index or column name
(which may be abbreviated, partial matching is used).
The default is <code>NULL</code>, meaning use all columns of the predicted response.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_dichot">dichot</code></td>
<td>

<p>Dichotimise the predicted response.
This argument is ignored except for models where the observed response
is a factor with more than two levels
and the predicted response is a numeric vector.
The default <code>FALSE</code> separates the response into a group for each factor.
With <code>dichot=TRUE</code> the response is separated into just two groups:
the first level of the factor versus the remaining levels.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_trace">trace</code></td>
<td>

<p>Default <code>FALSE</code>.
Use <code>TRUE</code> or <code>1</code> to trace <code>plotd</code> &mdash;
useful to see how <code>plotd</code>
partitions the predicted response into classes.
Use <code>2</code> for more details.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_xlim">xlim</code></td>
<td>

<p>Limits of the x axis.
The default <code>NULL</code> means determine these limits automatically,
else specify <code>c(xmin,xmax)</code>.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_ylim">ylim</code></td>
<td>

<p>Limits of the y axis.
The default <code>NULL</code> means determine these limits automatically,
else specify <code>c(ymin,ymax)</code>.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_jitter">jitter</code></td>
<td>

<p>Jitter the histograms or densities horizontally to minimize overplotting.
Default <code>FALSE</code>.
Specify <code>TRUE</code> to automatically calculate the jitter,
else specify a numeric jitter value.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_main">main</code></td>
<td>

<p>Main title. Values:<br />
<code>"string"</code> string<br />
<code>""</code> no title<br />
<code>NULL</code> (default) generate a title from the call.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_xlab">xlab</code></td>
<td>

<p>x axis label.
Default is <code>"Predicted Value"</code>.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_ylab">ylab</code></td>
<td>

<p>y axis label.
Default is <code>if(hist) "Count" else "Density"</code>.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_lty">lty</code></td>
<td>

<p>Per class line types for the plotted lines.
Default is 1 (which gets recycled for all lines).
</p>
</td></tr>
<tr><td><code id="plotd_+3A_col">col</code></td>
<td>

<p>Per class line colors.
The first few colors of the default are intended to be
easily distinguishable on both color displays and monochrome printers.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_fill">fill</code></td>
<td>

<p>Fill color for the plot for the first class.
For <code>hist=FALSE</code>, the default is 0, i.e., no fill.
For <code>hist=TRUE</code>, the default is the first element in the <code>col</code> argument.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_breaks">breaks</code></td>
<td>

<p>Passed to <code><a href="graphics.html#topic+hist">hist</a></code>.
Only used if <code>hist=TRUE</code>.
Default is <code>"Sturges"</code>.
When <code>type="class"</code>, setting <code>breaks</code> to a low number
can be used to widen the histogram bars
</p>
</td></tr>
<tr><td><code id="plotd_+3A_labels">labels</code></td>
<td>

<p><code>TRUE</code> to draw counts on the <code><a href="graphics.html#topic+hist">hist</a></code> plot.
Only used if <code>hist=TRUE</code>.
Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_kernel">kernel</code></td>
<td>

<p>Passed to <code><a href="stats.html#topic+density">density</a></code>.
Only used if <code>hist=FALSE</code>.
Default is <code>"gaussian"</code>.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_adjust">adjust</code></td>
<td>

<p>Passed to <code><a href="stats.html#topic+density">density</a></code>.
Only used if <code>hist=FALSE</code>.
Default is <code>1</code>.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_zero.line">zero.line</code></td>
<td>

<p>Passed to <code><a href="stats.html#topic+plot.density">plot.density</a></code>.
Only used if <code>hist=FALSE</code>.
Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_legend">legend</code></td>
<td>

<p><code>TRUE</code> (default) to draw a legend, else <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_legend.names">legend.names</code></td>
<td>

<p>Class names in legend.
The default <code>NULL</code> means determine these automatically.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_legend.pos">legend.pos</code></td>
<td>

<p>Position of the legend.
The default <code>NULL</code> means position the legend automatically,
else specify <code>c(x,y)</code>.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_cex.legend">cex.legend</code></td>
<td>

<p><code>cex</code> for <code><a href="graphics.html#topic+legend">legend</a></code>.
Default is <code>.8</code>.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_legend.bg">legend.bg</code></td>
<td>

<p><code>bg</code> color for <code><a href="graphics.html#topic+legend">legend</a></code>.
Default is <code>"white"</code>.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_legend.extra">legend.extra</code></td>
<td>

<p>Show (in the legend) the number of occurrences of each class.
Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_vline.thresh">vline.thresh</code></td>
<td>

<p>Horizontal position of optional vertical line.
Default is <code>0.5</code>.
The vertical line is intended to indicate class separation.
If you use this, don't forget to set <code>vline.col</code>.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_vline.col">vline.col</code></td>
<td>

<p>Color of vertical line.
Default is 0, meaning no vertical line.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_vline.lty">vline.lty</code></td>
<td>

<p>Line type of vertical line.
Default is <code>1</code>.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_vline.lwd">vline.lwd</code></td>
<td>

<p>Line width of vertical line.
Default is <code>1</code>.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_err.thresh">err.thresh</code></td>
<td>

<p>x axis value specifying the error shading threshold.
See <code>err.col</code>.
Default is <code>vline.thresh</code>.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_err.col">err.col</code></td>
<td>

<p>Specify up to three colors to shade the &quot;error areas&quot; of the density plot.
The default is <code>0</code>, meaning no error shading.
This argument is ignored unless <code>hist=FALSE</code>.
If there are more than two classes, <code>err.col</code> uses only the first two.
This argument is best explained by running an example:</p>
<pre>
data(etitanic)
earth.mod &lt;- earth(survived ~ ., data=etitanic)
plotd(earth.mod, vline.col=1, err.col=c(2,3,4))
      </pre>
<p>The three areas are (i) the error area to the left of the threshold,
(ii) the error area to the right of the threshold, and,
(iii) the reducible error area.
If less than three values are specified, <code>plotd</code> re-uses values in a sensible manner.
Use values of <code>0</code> to skip areas.
Disjoint regions are not handled well by the current implementation.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_err.border">err.border</code></td>
<td>

<p>Borders around the error shading.
Default is <code>0</code>, meaning no borders, else specify up to three colors.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_err.lwd">err.lwd</code></td>
<td>

<p>Line widths of borders of the error shading.
Default is <code>1</code>, else specify up to three line widths.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_xaxt">xaxt</code></td>
<td>

<p>Default is <code>"s"</code>.
Use <code>xaxt="n"</code> for no x axis.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_yaxt">yaxt</code></td>
<td>

<p>Default is <code>"s"</code>.
Use <code>yaxt="n"</code> for no y axis.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_xaxis.cex">xaxis.cex</code></td>
<td>

<p>Only used if <code>hist=TRUE</code> and <code>type="class"</code>.
Specify size of class labels drawn on the x axis.
Default is 1.
</p>
</td></tr>
<tr><td><code id="plotd_+3A_sd.thresh">sd.thresh</code></td>
<td>

<p>Minimum acceptable standard deviation for a density.
Default is <code>0.01</code>.
Densities with a standard deviation less than <code>sd.thresh</code>
will not be plotted (a warning will be issued and the legend
will say <code>"not plotted"</code>).
</p>
</td></tr>
<tr><td><code id="plotd_+3A_...">...</code></td>
<td>

<p>Extra arguments passed to the predict method for the object.
</p>
</td></tr>
</table>


<h3>Note</h3>

<p>This function calls <code><a href="stats.html#topic+predict">predict</a></code>
with the data originally used to build
the model, and with the <code>type</code> specified above.
It then separates the predicted values into classes,
where the class for each predicted value
is determined by the class of the observed response.
Finally, it calls <code><a href="stats.html#topic+density">density</a></code> (or <code><a href="graphics.html#topic+hist">hist</a></code>
if <code>hist=TRUE</code>) for each class-specific set of values,
and plots the results.
</p>
<p>This function estimates distributions with the
<code><a href="stats.html#topic+density">density</a></code> and <code><a href="graphics.html#topic+hist">hist</a></code> functions,
and also calls <code><a href="stats.html#topic+plot.density">plot.density</a></code> and <code><a href="graphics.html#topic+plot.histogram">plot.histogram</a></code>.
For an overview see Venables and Ripley MASS section 5.6.
</p>
<p><b>Partitioning the response into classes</b>
</p>
<p>Considerable effort is made to partition the predicted response
into classes in a sensible way.
This is not always possible for multiple column responses and the <code>nresponse</code> argument
should be used where necessary.
The partitioning details depend on the types and numbers of columns in the observed
and predicted responses.
These in turn depend on the model object and the <code>type</code> argument.
</p>
<p>Use the <code>trace</code> argument to see how <code>plotd</code> partitions the
response for your model.
</p>
<p><b>Degenerate densities</b>
</p>
<p>A message such as<br />
<code>Warning: standard deviation of "male" density is 0,  density is degenerate?</code><br />
means that the density for that class will not be plotted
(the legend will say <code>"not plotted"</code>).
</p>
<p>Set <code>sd.thresh=0</code> to get rid of this check,
but be aware that histograms (and sometimes x axis labels)
for degenerate densities will be misleading.
</p>
<p><b>Using plotd for various models</b>
</p>
<p>This function is included in the <code><a href="#topic+earth">earth</a></code> package
but can also be used with other models.
</p>
<p>Example with <code><a href="stats.html#topic+glm">glm</a></code>: </p>
<pre>
      library(earth); data(etitanic)
      glm.model &lt;- glm(sex ~ ., data=etitanic, family=binomial)
      plotd(glm.model)
  </pre>
<p>Example with <code><a href="stats.html#topic+lm">lm</a></code>:</p>
<pre>
      library(earth); data(etitanic)
      lm.model &lt;- lm(as.numeric(sex) ~ ., data=etitanic)
      plotd(lm.model)
  </pre>
<p><b>Using plotd with lda or qda</b>
</p>
<p>The <code>plotd</code> function has special handling for <code><a href="MASS.html#topic+lda">lda</a></code>
(and <code><a href="MASS.html#topic+qda">qda</a></code>) objects.
For such objects, the <code>type</code> argument can take one of the
following values:
</p>
<p><code>"response"</code> (default) linear discriminant<br />
<code>"ld"</code> same as <code>"response"</code><br />
<code>"class"</code> predicted classes<br />
<code>"posterior"</code> posterior probabilities
</p>
<p>Example:</p>
<pre>
    library(MASS); library(earth); data(etitanic)
    lda.model &lt;- lda(sex ~ ., data=etitanic)
    plotd(lda.model) # linear discriminant by default
    plotd(lda.model, type="class", hist=TRUE, labels=TRUE)
    </pre>
<p>This handling of <code>type</code> is handled internally by <code>plotd</code>
and <code>type</code> is not passed to <code>predict.lda</code>
(<code>type</code> is used merely to select fields in the list
returned by <code>predict.lda</code>).
The type names can be abbreviated down to a single character.
</p>
<p>For objects created with <code>lda.matrix</code>
(as opposed to <code>lda.formula</code>),
<code>plotd</code> blindly assumes that the <code>grouping</code> argument was the second argument.
</p>
<p><code>plotd</code> does not yet support objects created with <code>lda.data.frame</code>.
</p>
<p>For <code>lda</code> responses with more than two factor levels,
use the <code>nresponse</code> argument to
select a column in the predicted response.
Thus with the default <code>type=NULL</code>,
(which gets automatically converted by <code>plotd</code> to <code>type="response"</code>),
use <code>nresponse=1</code> to select just the first linear discriminant.
The default <code>nresponse=NULL</code> selects all columns,
which is typically not what you want for <code>lda</code> models.
Example:</p>
<pre>
    library(MASS); library(earth);
    set.seed(1)      # optional, for reproducibility
    example(lda)     # creates a model called "z"
    plot(z, dimen=1) # invokes plot.lda from the MASS package
    plotd(z, nresponse=1, hist=1) # equivalent using plotd
                                 # nresponse=1 selects first linear discr.
    </pre>
<p>The <code>dichot=TRUE</code> argument is also useful for <code>lda</code>
responses with more than two factor levels.<br />
</p>
<p><b>TODO</b>
</p>
<p>Handle degenerate densities in a more useful way.<br />
Add <code>freq</code> argument for <code><a href="graphics.html#topic+hist">hist</a></code>.
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+density">density</a></code>, <code><a href="stats.html#topic+plot.density">plot.density</a></code><br />
<code><a href="graphics.html#topic+hist">hist</a></code>, <code><a href="graphics.html#topic+plot.histogram">plot.histogram</a></code><br />
<code><a href="#topic+earth">earth</a></code>, <code><a href="#topic+plot.earth">plot.earth</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if (require(earth)) {
    old.par &lt;- par(no.readonly=TRUE);
    par(mfrow=c(2,2), mar=c(4, 3, 1.7, 0.5), mgp=c(1.6, 0.6, 0), cex = 0.8)
    data(etitanic)
    mod &lt;- earth(survived ~ ., data=etitanic, degree=2, glm=list(family=binomial))

    plotd(mod)

    plotd(mod, hist=TRUE, legend.pos=c(.25,220))

    plotd(mod, hist=TRUE, type="class", labels=TRUE, xlab="", xaxis.cex=.8)

    par(old.par)
}
</code></pre>

<hr>
<h2 id='predict.earth'>Predict with an earth model</h2><span id='topic+predict.earth'></span>

<h3>Description</h3>

<p>Predict with an <code><a href="#topic+earth">earth</a></code> model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'earth'
predict(object = stop("no 'object' argument"), newdata = NULL,
        type = c("link", "response", "earth", "class", "terms"),
        interval = "none", level = .95,
        thresh = .5, trace = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict.earth_+3A_object">object</code></td>
<td>

<p>An <code><a href="#topic+earth">earth</a></code> object.
This is the only required argument.
</p>
</td></tr>
<tr><td><code id="predict.earth_+3A_newdata">newdata</code></td>
<td>

<p>Make predictions using <code>newdata</code>, which
can be a data frame, a matrix, or a vector with length equal to a
multiple of the number of columns
of the original input matrix <code>x</code>.<br />
Default is NULL, meaning return values predicted from the training set.<br />
NAs are allowed in <code>newdata</code> (and the predicted value will be NA
unless the NAs are in variables that are unused in the earth model).
</p>
</td></tr>
<tr><td><code id="predict.earth_+3A_type">type</code></td>
<td>

<p>Type of prediction.
One of <code>"link"</code> (default), <code>"response"</code>, <code>"earth"</code>, <code>"class"</code>, or <code>"terms"</code>.
See the <b>Note</b> below.
</p>
</td></tr>
<tr><td><code id="predict.earth_+3A_interval">interval</code></td>
<td>

<p>Return prediction or confidence levels.
Default is <code>"none"</code>.
Use <code>interval="pint"</code> to get prediction intervals on new data.
<br />
Requires that the earth model was built with <code>varmod.method</code>.
<br />
This argument gets passed on as the <code>type</code> argument to <code><a href="#topic+predict.varmod">predict.varmod</a></code>.
See its help page for details.
</p>
</td></tr>
<tr><td><code id="predict.earth_+3A_level">level</code></td>
<td>

<p>Confidence level for the <code>interval</code> argument.
Default is <code>0.95</code>, meaning construct 95% confidence bands
(estimate the 2.5% and 97.5% levels).
</p>
</td></tr>
<tr><td><code id="predict.earth_+3A_thresh">thresh</code></td>
<td>

<p>Threshold, a value between 0 and 1 when predicting a probability.
Only applies when <code>type="class"</code>.
Default is 0.5.
See the <b>Note</b> below.
</p>
</td></tr>
<tr><td><code id="predict.earth_+3A_trace">trace</code></td>
<td>

<p>Default <code>FALSE</code>. Set to <code>TRUE</code> to see which data, subset, etc.  <code>predict.earth</code> is using.
</p>
</td></tr>
<tr><td><code id="predict.earth_+3A_...">...</code></td>
<td>

<p>Unused, but provided for generic/method consistency.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The predicted values (a matrix for multiple response models).
</p>
<p>If <code>type="terms"</code>, a matrix with each column showing the contribution of a predictor.
</p>
<p>If <code>interval="pint"</code> or <code>"cint"</code>, a matrix with three columns:<br />
<code>fit</code>: the predicted values<br />
<code>lwr</code>: the lower confidence or prediction limit<br />
<code>upr</code>: the upper confidence or prediction limit
</p>
<p>If <code>interval="se"</code>, the standard errors.
</p>


<h3>Note</h3>

<p><b>Predicting with standard earth models</b>
</p>
<p>Use the default <code>type="link"</code>, or possibly <code>type="class"</code>.
</p>
<p>Actually, the <code>"link"</code>, <code>"response"</code>, and <code>"earth"</code>
choices all return the same value unless the <code>glm</code> argument
was used in the original call to <code><a href="#topic+earth">earth</a></code>.
</p>
<p><b>Predicting with earth-GLM models</b>
</p>
<p>This section applies to earth models with a GLM component, i.e.,
when the <code>glm</code> argument was used
in the original call to <code><a href="#topic+earth">earth</a></code>.
</p>
<p>The <code>"link"</code> and <code>"response"</code> options:
see <code><a href="stats.html#topic+predict.glm">predict.glm</a></code> for a description of these.
In brief: for logistic models
use <code>type="response"</code> to get probabilities,
and <code>type="link"</code> to get log-odds.
</p>
<p>Use option <code>"earth"</code> to get the linear fit (this gives the prediction you would get
if your original call to earth had no <code>glm</code> argument).
</p>
<p><b>Predicting with &quot;class&quot;</b>
</p>
<p>Use option <code>"class"</code> to get the predicted class.
With option <code>"class"</code>, this function first makes predictions with
<code>type="response"</code> and then assigns the predicted values to classes as follows:
</p>
<p>(i) When the response is a <em>logical</em>, predict <code>TRUE</code> if
the predicted probability is greater than <code>thresh</code> (default <code>0.5</code>).
</p>
<p>(ii) When the response is a <em>numeric</em>, predict <code>TRUE</code> if
the predicted value is greater than <code>thresh</code>.
Actually, this is identical to the above case,
although <code>thresh</code> here may legitimately be a value
outside the 0...1 range.
</p>
<p>(iii) When the response is a <em>two level factor</em>,
predict the second level if its probability is more than <code>thresh</code>.
In other words, with the default <code>thresh=0.5</code> predict the most probable level.
</p>
<p>(iv) When the response is a <em>three or more level factor</em>,
predict the most probable level (and <code>thresh</code> is ignored).
</p>
<p><b>Predicting with &quot;terms&quot;</b>
</p>
<p>The <code>"terms"</code> option returns a <code>"link"</code> response suitable for <code><a href="stats.html#topic+termplot">termplot</a></code>.
Only the additive terms and the first response (for multi-response models) are returned.
Also, <code>"terms"</code> always returns the earth terms, and ignores the GLM component
of the model, if any.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+earth">earth</a></code>,
<code><a href="stats.html#topic+predict">predict</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(trees)
earth.mod &lt;- earth(Volume ~ ., data = trees)
predict(earth.mod) # same as earth.mod$fitted.values
predict(earth.mod, data.frame(Girth=10, Height=80)) # yields 17.6
predict(earth.mod, c(10,80))                        # equivalent
</code></pre>

<hr>
<h2 id='predict.varmod'>Predict with a varmod model</h2><span id='topic+predict.varmod'></span>

<h3>Description</h3>

<p>You probably won't need to call this function directly.
It is called by <code><a href="#topic+predict.earth">predict.earth</a></code>
when that function's <code>interval</code> argument is used.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'varmod'
predict(
    object  = stop("no 'object' argument"),
    newdata = NULL,
    type    = c("pint", "cint", "se", "abs.residual"),
    level   = .95,
    trace   = FALSE,
    ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict.varmod_+3A_object">object</code></td>
<td>

<p>A <code>varmod</code> object.
</p>
</td></tr>
<tr><td><code id="predict.varmod_+3A_newdata">newdata</code></td>
<td>

<p>Make predictions using <code>newdata</code>.
Default is NULL, meaning return values predicted from the training set.
</p>
</td></tr>
<tr><td><code id="predict.varmod_+3A_type">type</code></td>
<td>

<p>Type of prediction. This is the <code>interval</code> argument of
<code><a href="#topic+predict.earth">predict.earth</a></code>. One of
<br /><br />
<code>"pint"</code> Prediction intervals.
<br /><br />
<code>"cint"</code> Confidence intervals.
Cannot be used with <code>newdata</code>.
<br /><br />
<code>"se"</code> Standard error of the parent model residuals.
<br /><br />
<code>"abs.residual"</code> The absolute residuals of the parent model
on which the residual model regresses.
<br /><br />
</p>
</td></tr>
<tr><td><code id="predict.varmod_+3A_level">level</code></td>
<td>

<p>Confidence level for the <code>interval</code> argument.
Default is <code>.95</code>, meaning construct 95% confidence bands
(estimate the 2.5% and 97.5% levels).
</p>
</td></tr>
<tr><td><code id="predict.varmod_+3A_trace">trace</code></td>
<td>

<p>Currently unused.
</p>
</td></tr>
<tr><td><code id="predict.varmod_+3A_...">...</code></td>
<td>

<p>Unused, but provided for generic/method consistency.
</p>
</td></tr>
</table>


<h3>Note</h3>

<p><code>predict.varmod</code> is called by <code>predict.earth</code>
when its <code>interval</code> argument is used.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+predict.earth">predict.earth</a></code>
<code><a href="#topic+varmod">varmod</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(ozone1)

set.seed(1) # optional, for cross validation reproducibility

# note: should really use ncross=30 below but for a quick demo we don't

earth.mod &lt;- earth(O3~temp, data=ozone1, nfold=10, ncross=3, varmod.method="lm")

# call predict.earth, which calls predict.varmod

predict(earth.mod, newdata=ozone1[200:203,], interval="pint", level=.95)
</code></pre>

<hr>
<h2 id='residuals.earth'>Residuals for an earth model</h2><span id='topic+residuals.earth'></span>

<h3>Description</h3>

<p>Residuals of an <code><a href="#topic+earth">earth</a></code> model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'earth'
residuals(object = stop("no 'object' argument"),
          type = NULL, warn = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="residuals.earth_+3A_object">object</code></td>
<td>

<p>An <code><a href="#topic+earth">earth</a></code> object.
This is the only required argument.
</p>
</td></tr>
<tr><td><code id="residuals.earth_+3A_type">type</code></td>
<td>

<p>One of:<br />
<br />
<b><code>"earth"</code></b> (default) Residuals from the <code><a href="stats.html#topic+lm">lm</a></code> fit on <code>bx</code>.<br />
<b><code>"response"</code></b>
Residuals as above, but for earth-glm models
return the <code><a href="stats.html#topic+glm">glm</a></code> response residuals.<br />
<b><code>"standardize"</code></b> Residuals divided by <code>se * sqrt(1 - h_ii)</code>.
See the <code>standardize</code> argument of <code><a href="#topic+plot.earth">plot.earth</a></code>.<br />
<b><code>"delever"</code></b> Residuals divided by <code>sqrt(1 - h_ii)</code>.
See the <code>delever</code> argument of <code><a href="#topic+plot.earth">plot.earth</a></code>.<br />
<br />
The following options are for earth-glm models.
They return the GLM residuals (from the <code><a href="stats.html#topic+glm">glm</a></code> fit on <code>bx</code>).
See <code><a href="stats.html#topic+residuals.glm">residuals.glm</a></code> for details:
<br />
<br />
<b><code>"deviance"</code></b><br />
<b><code>"pearson"</code></b><br />
<b><code>"working"</code></b><br />
<b><code>"partial"</code></b><br />
<br />
The following options for earth-glm models are redundant.
They are provided for compatibility with older versions of earth or other functions:
<br />
<br />
<b><code>"glm.response"</code></b> same as <code>"response"</code><br />
<b><code>"glm.deviance"</code></b> same as <code>"deviance"</code><br />
<b><code>"glm.pearson"</code></b> same as <code>"pearson"</code><br />
<b><code>"glm.working"</code></b> same as <code>"working"</code><br />
<b><code>"glm.partial"</code></b> same as <code>"partial"</code>
</p>
</td></tr>
<tr><td><code id="residuals.earth_+3A_warn">warn</code></td>
<td>

<p>This function gives warnings when the results are not what you may expect.
Use <code>warn=FALSE</code> to turn of just these warnings.
</p>
</td></tr>
<tr><td><code id="residuals.earth_+3A_...">...</code></td>
<td>

<p>Unused, but provided for generic/method consistency.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The residual values (will be a matrix for multiple response models).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+earth">earth</a></code><br />
<code><a href="stats.html#topic+residuals">residuals</a></code><br />
<code><a href="stats.html#topic+resid">resid</a></code> identical to <code><a href="stats.html#topic+residuals">residuals</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(etitanic)
earth.mod &lt;- earth(pclass ~ ., data=etitanic, glm=list(family=binomial))
head(resid(earth.mod, warn=FALSE))      # earth residuals, a column for each response
head(resid(earth.mod, type="response")) # GLM response resids, a column for each response
</code></pre>

<hr>
<h2 id='summary.earth'>Summary method for earth objects</h2><span id='topic+summary.earth'></span><span id='topic+print.summary.earth'></span>

<h3>Description</h3>

<p>Summary method for <code><a href="#topic+earth">earth</a></code> objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'earth'
summary(object = stop("no 'object' argument"),
        details = FALSE,  style = c("h", "pmax", "max", "C", "bf"),
        decomp = "anova", digits = getOption("digits"), fixed.point=TRUE,
        newdata = NULL, ...)

## S3 method for class 'summary.earth'
print(x = stop("no 'x' argument"),
        details = x$details,
        decomp = x$decomp, digits = x$digits, fixed.point = x$fixed.point,
        newdata = x$newdata, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.earth_+3A_object">object</code></td>
<td>

<p>An <code><a href="#topic+earth">earth</a></code> object.
This is the only required argument for <code>summary.earth</code>.
</p>
</td></tr>
<tr><td><code id="summary.earth_+3A_x">x</code></td>
<td>

<p>A <code><a href="#topic+summary.earth">summary.earth</a></code> object.
This is the only required argument for <code>print.summary.earth</code>.
</p>
</td></tr>
<tr><td><code id="summary.earth_+3A_details">details</code></td>
<td>

<p>Default is <code>FALSE</code>.
Use <code>TRUE</code>
to print more information about <code><a href="#topic+earth">earth</a></code>&ndash;<code><a href="stats.html#topic+glm">glm</a></code> models.
But note that the displayed Standard Errors and statistics for the
GLM coefficients are meaningless (because of the amount of preprocessing
done by earth to select the regression terms).
</p>
</td></tr>
<tr><td><code id="summary.earth_+3A_style">style</code></td>
<td>

<p>Formatting style. One of<br />
<code>"h"</code> (default) more compact<br />
<code>"pmax"</code> for those who prefer it and for compatibility with old versions of earth<br />
<code>"max"</code> is the same as <code>"pmax"</code> but prints <code>max</code> rather than <code>pmax</code><br />
<code>"C"</code> C style expression with zero based indexing<br />
<code>"bf"</code> basis function format.
</p>
</td></tr>
<tr><td><code id="summary.earth_+3A_decomp">decomp</code></td>
<td>

<p>Specify how terms are ordered.
Default is <code>"anova"</code>.
Use <code>"none"</code> to order the terms as created by the forward.pass.
See <code><a href="#topic+format.earth">format.earth</a></code> for a full description.
</p>
</td></tr>
<tr><td><code id="summary.earth_+3A_digits">digits</code></td>
<td>

<p>The number of significant digits.<br />
For <code>summary.earth</code>, the default is <code>getOption("digits")</code>.<br />
For <code>print.summary.earth</code>, the default is the <code>$digits</code> component of <code>object</code>.
</p>
</td></tr>
<tr><td><code id="summary.earth_+3A_fixed.point">fixed.point</code></td>
<td>

<p>Method of printing numbers in matrices.
Default is <code>TRUE</code> which prints like this
(making it easier to compare coefficients):</p>
<pre>
        (Intercept)    15.029
        h(temp-58)      0.313
        h(234-ibt)     -0.046
        ...
</pre><p> whereas <code>fixed.point=FALSE</code> prints like this (which is more usual in R):</p>
<pre>
        (Intercept)   1.5e+01
        h(temp-58)    3.1e-01
        h(234-ibt)   -4.6e-02
        ...
</pre>
<p>Matrices with two or fewer rows are never printed with a fixed point.
</p>
</td></tr>
<tr><td><code id="summary.earth_+3A_newdata">newdata</code></td>
<td>

<p>Default <code>NULL</code>.<br />
Else print R-Squared for the new data
(and the returned object will have <code>newrsq</code> and <code>newdata</code> fields).
Additionally, if a variance model is present print the interval coverage table for the new data.<br />
</p>
</td></tr>
<tr><td><code id="summary.earth_+3A_...">...</code></td>
<td>

<p>Extra arguments are passed to <code><a href="#topic+format.earth">format.earth</a></code>.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The value is the same as that returned by <code><a href="#topic+earth">earth</a></code>
but with the following extra components.<br />
</p>
<table>
<tr><td><code>strings</code></td>
<td>

<p>String(s) created by <code><a href="#topic+format.earth">format.earth</a></code>.
For multiple response models, a vector of strings.
</p>
</td></tr>
<tr><td><code>newrsq</code></td>
<td>
<p>Only if <code>newdata</code> was passed to <code>summary.earth</code>.</p>
</td></tr>
<tr><td><code>newdata</code></td>
<td>
<p>Only if <code>newdata</code> was passed to <code>summary.earth</code>.</p>
</td></tr>
<tr><td><code>digits</code></td>
<td>
</td></tr>
<tr><td><code>details</code></td>
<td>
</td></tr>
<tr><td><code>decomp</code></td>
<td>
</td></tr>
<tr><td><code>fixed.point</code></td>
<td>
<p>The corresponding arguments, passed on to <code>print.summary.earth</code>.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>The printed <code>Estimated importance</code> uses <code><a href="#topic+evimp">evimp</a></code>
with the <code>nsubsets</code> criterion.
The most important predictor is printed first, and so on.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+earth">earth</a></code>,
<code><a href="#topic+evimp">evimp</a></code>,
<code><a href="#topic+format.earth">format.earth</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>earth.mod &lt;- earth(Volume~ ., data = trees)
summary(earth.mod, digits = 2)
</code></pre>

<hr>
<h2 id='update.earth'>Update an earth model</h2><span id='topic+update.earth'></span>

<h3>Description</h3>

<p>Update an <code><a href="#topic+earth">earth</a></code> model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'earth'
update(object = stop("no 'object' argument"),
       formula. = NULL, ponly = FALSE, ..., evaluate = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="update.earth_+3A_object">object</code></td>
<td>
<p> The earth object</p>
</td></tr>
<tr><td><code id="update.earth_+3A_formula.">formula.</code></td>
<td>

<p>The <code>formula.</code> argument is treated like earth's <code>formula</code> argument.<br />
</p>
</td></tr>
<tr><td><code id="update.earth_+3A_ponly">ponly</code></td>
<td>

<p>Force pruning only, no forward pass.
Default is <code>FALSE</code>,
meaning <code>update.earth</code> decides automatically if a forward pass is needed.
See note below.
</p>
</td></tr>
<tr><td><code id="update.earth_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="#topic+earth">earth</a></code>.
</p>
</td></tr>
<tr><td><code id="update.earth_+3A_evaluate">evaluate</code></td>
<td>

<p>If <code>TRUE</code> (default) evaluate the new call, else return the call.
Mostly for compatibility with the generic <code><a href="stats.html#topic+update">update</a></code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If only the following arguments are used, a forward pass
is unnecessary, and <code>update.earth</code> will perform only the pruning pass.
This is usually much faster for large models.
</p>
<pre>
     object
     glm
     trace
     nprune
     pmethod
     Eval.model.subsets
     Print.pruning.pass
     Force.xtx.prune
     Use.beta.cache
     Endspan.penalty
     Get.leverages
</pre>
<p>This automatic determination to do a forward pass can be overridden
with the <code>ponly</code> argument.
If <code>ponly=TRUE</code> the forward pass will be skipped and only the pruning pass will be executed.
This is useful for doing a pruning pass with new data.
(Use earth's <code>data</code> argument to specify the new data.)
Typically in this scenario you would also specify <code>penalty=-1</code>.
This is because with sufficient new data, independent of the original
training data, the RSS not the GCV should be used for evaluating model
subsets
(The GCV approximates what the RSS would be on new data &mdash; but here
we actually have new data, so why bother approximating.
This &quot;use new data for pruning&quot; approach is useful in situations where
you don't trust the GCV approximation for your data.)
By making <code>penalty=-1</code>, earth will calculate the RSS, not the GCV.
See also the description of <code>penalty</code> on the
<code><a href="#topic+earth">earth</a></code> help page.
<br />
<br />
Another (somewhat esoteric) use of <code>ponly=TRUE</code> is to do subset
selection with a different <code>penalty</code> from that used to build the
original model.
<br />
<br />
With <code>trace=1</code>, <code>update.earth</code> will tell you if earth's
forward pass was skipped.
<br />
<br />
If you used <code>keepxy=TRUE</code> in your original call to <code>earth</code>, then
<code>update.earth</code> will use the saved values of <code>x</code>, <code>y</code>, etc.,
unless you specify otherwise by arguments to <code>update.earth</code>.
It can be helpful to set <code>trace=1</code> to see which <code>x</code> and <code>y</code>
is used by <code>update.earth</code>.
</p>


<h3>Value</h3>

<p>The value is the same as that returned by <code><a href="#topic+earth">earth</a></code>.
If <code>object</code> is the only parameter then no changes are made
&mdash; the returned value will be the same as the original <code>object</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+earth">earth</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(ozone1)

(earth.mod &lt;- earth(O3 ~ ., data = ozone1, degree = 2))

update(earth.mod, formula = O3 ~ . - temp) # requires forward pass and pruning

update(earth.mod, nprune = 8)              # requires only pruning

update(earth.mod, penalty=1, ponly=TRUE)   # pruning pass only with a new penalty
</code></pre>

<hr>
<h2 id='varmod'>Variance models for estimating prediction intervals</h2><span id='topic+varmod'></span><span id='topic+summary.varmod'></span>

<h3>Description</h3>

<p>A <em>variance model</em> estimates the variance of predicted values.
It can be used to estimate prediction intervals.
See the <code>interval</code> argument of <code><a href="#topic+predict.earth">predict.earth</a></code>.
</p>
<p>A variance model is built by <code>earth</code> if <code>earth</code>'s
<code>varmod.method</code> argument is specified.
Results are stored in the <code>$varmod</code> field of the <code>earth</code> model.
See the vignette &ldquo;<a href="../doc/earth-varmod.pdf">Variance models in earth</a>&rdquo; for details.
</p>
<p>You probably won't need to directly call
<code>print.varmod</code> or <code>summary.varmod</code>.
They get called internally by <code><a href="#topic+summary.earth">summary.earth</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'varmod'
summary(
    object  = stop("no 'object' argument"),
    level   = .95,
    style   = "standard",
    digits  = 2,
    newdata = NULL,
    ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="varmod_+3A_object">object</code></td>
<td>

<p>A <code>varmod</code> object.  This is the only required argument.
</p>
</td></tr>
<tr><td><code id="varmod_+3A_level">level</code></td>
<td>

<p>Same as <code>predict.earth</code>'s <code>level</code> argument.
</p>
</td></tr>
<tr><td><code id="varmod_+3A_style">style</code></td>
<td>

<p>Determines how the coefficients of the <code>varmod</code> are printed
by <code>summary.varmod</code>:<br />
<code>"standard"</code> (default)<br />
<code>"unit"</code> for easy comparison normalize the coefficients
by dividing by the first coefficient.
</p>
</td></tr>
<tr><td><code id="varmod_+3A_digits">digits</code></td>
<td>

<p>Number of digits to print.  Default is <code>2</code>.
</p>
</td></tr>
<tr><td><code id="varmod_+3A_newdata">newdata</code></td>
<td>

<p>Default <code>NULL</code>.<br />
Else print the interval coverage table for the new data.
</p>
</td></tr>
<tr><td><code id="varmod_+3A_...">...</code></td>
<td>

<p>Dots are passed on.
</p>
</td></tr>
</table>


<h3>Note</h3>

<p>A <code>"varmod"</code> object has the following fields:
</p>

<ul>
<li><p><code>call</code>
The call used internally in the parent model to build the <code>varmod</code> object.
</p>
</li>
<li><p><code>parent</code> The parent <code>earth</code> model.
</p>
</li>
<li><p><code>method</code> Copy of the <code>varmod.method</code> argument to the parent model.
</p>
</li>
<li><p><code>package</code> NULL, unless <code>method="gam"</code>, in which case either <code>"gam"</code> or <code>"mgcv"</code>.
</p>
</li>
<li><p><code>exponent</code> Copy of the <code>varmod.exponent</code> argument to the parent model.
</p>
</li>
<li><p><code>lambda</code> Currently always 1, meaning use absolute residuals.
</p>
</li>
<li><p><code>rmethod</code> Currently always &quot;hc2&quot;, meaning correct the residuals with <code>1/(1-h_ii)</code>.
</p>
</li>
<li><p><code>converged</code> Did the residual submodel IRLS converge?
</p>
</li>
<li><p><code>iters</code> Number of residual model IRLS iterations (1 to 50).
</p>
</li>
<li><p><code>residmod</code> The residual submodel.
So for example, if <code>varmod.method="lm"</code>, this will be an <code>lm</code> object.
</p>
</li>
<li><p><code>min.sd</code>
The predicted residual standard deviation is clamped
so it will always be at least this value.
This prevents prediction of negative or absurdly small variances.
See <code>earth</code>'s <code>varmod.clamp</code> argument.
Clamping takes place in <code>predict.varmod</code>, which is called
by <code>predict.earth</code> when estimating prediction intervals.
</p>
</li>
<li><p><code>model.var</code>
An n x 1 matrix.
The <code>model.var</code> for an observation is the estimated model
variance for that observation over all datasets, and is estimated with
repeated cross validation.
It is the variance of the mean out-of-fold prediction for that
observation over <code>ncross</code> repetitions.
</p>
</li>
<li><p><code>abs.resids</code>
An n x 1 matrix.
The absolute residuals used to build the residual model.
</p>
</li>
<li><p><code>parent.x</code>
An n x p matrix. Parent earth model <code>x</code>.
</p>
</li>
<li><p><code>parent.y</code>
An n x 1 matrix. Parent earth model <code>y</code>.
</p>
</li>
<li><p><code>iter.rsq</code>
Weighted R-Squared of residual submodel <code>residmod</code>,
after IRLS iteration.
</p>
</li>
<li><p><code>iter.stderr</code>
Standard errors of the coefficients of the residual submodel <code>residmod</code>,
after IRLS iteration.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+plot.varmod">plot.varmod</a></code>,
<code><a href="#topic+predict.varmod">predict.varmod</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(ozone1)

set.seed(1) # optional, for cross validation reproducibility

# note: should really use ncross=30 below but for a quick demo we don't

earth.mod &lt;- earth(O3~temp, data=ozone1, nfold=10, ncross=3, varmod.method="lm")

print(summary(earth.mod)) # note additional info on the variance model

old.mfrow &lt;- par(mfrow=c(2,2), mar=c(3, 3, 3, 1), mgp=c(1.5, 0.5, 0))

plotmo(earth.mod, do.par=FALSE, response.col=1, level=.90, main="earth model: O3~temp")

plot(earth.mod, which=3, level=.90) # residual plot: note 90% pred and darker conf intervals

par(par=old.mfrow)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
