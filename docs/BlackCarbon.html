<!DOCTYPE html><html><head><title>Help for package BlackCarbon</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {BlackCarbon}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#data_compiled'><p>Dataset compiled at file level</p></a></li>
<li><a href='#data_ONA'><p> A practise dataset</p></a></li>
<li><a href='#filter_adjust_ONA'><p>ONA adjusting filter change</p></a></li>
<li><a href='#filter_loading'><p> Filter loading correction</p></a></li>
<li><a href='#ONA'><p> Optimized Noise Reduction Averaging (ONA) algorithm</p>
</a></li>
<li><a href='#ONA_compiled'><p> ONA at file level</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Processing Raw Black Carbon Concentration</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Author:</td>
<td>Sanjeev Bista &lt;sanjeev.bista1@gmail.com&gt;</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Sanjeev Bista &lt;sanjeev.bista1@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>The functions in this package are designed to be used in the processing of black carbon concentration collected by a specific type of a personal monitor. The package includes functions for processing of the data by applying Optimized noise reduction averaging algorithm along with filter loading correction and with an option of filter change adjustment.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-10-14 08:15:07 UTC; Sanjeev</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-10-22 15:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='data_compiled'>Dataset compiled at file level
</h2><span id='topic+data_compiled'></span>

<h3>Description</h3>

<p>This is a hypothetical dataset (compiled at file level) created as an example to faciliate user's learning of the function used in the package while processing the black carbon data with ONA algorithm
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("data_compiled")</code></pre>


<h3>Format</h3>

<p>A data frame with 31118 observations on the following 3 variables.
</p>

<dl>
<dt><code>file_ID</code></dt><dd><p>a factor with levels <code>AE51-S6-1211_20181114-025500</code> <code>AE51-S6-1211_20181115-070300</code> <code>AE51-S6-1211_20181115-201000</code></p>
</dd>
<dt><code>ATN</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>BC</code></dt><dd><p>a numeric vector</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>data(data_compiled)
## maybe str(data_compiled)
</code></pre>

<hr>
<h2 id='data_ONA'> A practise dataset
</h2><span id='topic+data_ONA'></span>

<h3>Description</h3>

<p>This is a hypothetical dataset created as an example to faciliate user's learning of the function used in the package while processing the black carbon data with ONA algorithm
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("data_ONA")</code></pre>


<h3>Format</h3>

<p>A data frame with 31118 observations on the following 2 variables.
</p>

<dl>
<dt><code>ATN</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>BC</code></dt><dd><p>a numeric vector</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>data(data_ONA)
## maybe str(data_ONA)
</code></pre>

<hr>
<h2 id='filter_adjust_ONA'>ONA adjusting filter change
</h2><span id='topic+filter_adjust_ONA'></span>

<h3>Description</h3>

<p>This function is an extended version of (ONA and filter_loading) which can only work at individual file level, similar to the ONA function. This function has an inbuilt function of filter loading correction as well as has capacity to adjust for filter change or a huge drop in ATN marked as mechanical error.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>filter_adjust_ONA(data =data, ATN = "ATN", BC = "BC", dATN = 0.05,
threshold = 5, skip = 15, ignore = 10)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="filter_adjust_ONA_+3A_data">data</code></td>
<td>

<p>a datafram containing the raw data of black carbon.
</p>
</td></tr>
<tr><td><code id="filter_adjust_ONA_+3A_atn">ATN</code></td>
<td>

<p>the coloumn having ATN coefficient.
</p>
</td></tr>
<tr><td><code id="filter_adjust_ONA_+3A_bc">BC</code></td>
<td>

<p>the column having raw black carbon data.
</p>
</td></tr>
<tr><td><code id="filter_adjust_ONA_+3A_datn">dATN</code></td>
<td>

<p>the difference in ATN coefficient which is used for defining the averaging window of raw black carbon concentration, by default it is 0.05.
</p>
</td></tr>
<tr><td><code id="filter_adjust_ONA_+3A_threshold">threshold</code></td>
<td>

<p>the change in ATN value which indicates the filter change, it is 5 by default.
</p>
</td></tr>
<tr><td><code id="filter_adjust_ONA_+3A_skip">skip</code></td>
<td>

<p>number of observations before the filter change point that has to be skipped or deleted from analysis. When the AE51 device is about to indicate the need of filter change or when it’s about encounters a sudden drop of ATN it either produces maximum negative or positive black carbon concentration which is a mechanical noise and averaging those values also introduces bias. Therefore certain observations before filter change or extreme drop down of ATN should be deleted depending on the data collection interval. By default it is 15 observation for 10s interval data.
</p>
</td></tr>
<tr><td><code id="filter_adjust_ONA_+3A_ignore">ignore</code></td>
<td>

<p>number of observations after the filter change point that has to be ignored or deleted from analysis. After changing the filter or after a while of sudden drop of ATN value, AE51 device either produces maximum negative or positive black carbon concentration which is a mechanical noise and averaging those values also introduces bias. Therefore certain observations after filter change or sudden drop of ATN should be deleted depending on the data collection interval. By default it is 10 observation for 10s interval data.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This method is only applicable when the raw files are not compiled
</p>


<h3>Value</h3>

<p>The default method returns the existing data frame with two additional columns 1) with ONA processed black carbon concentration and 2) filter loading corrected ONA processed black carbon concentration. If there is a filter change or a drop of ATN by more than 5 units within two adjoining observations some observations (25 rows), which is ignore + skip given in the function,  will be deleted to correct for the mechanical error
</p>


<h3>Note</h3>

<p>When there is a filter change or a rapid drop of ATN value, as opposed to the assumption that the ATN should gradually increase, the averaging window identified using dATN becomes wider or gets violated as it doesn't/may not get a proper window till the last observation. Therefore, an averaging window should be then identified from the very next point to the rapid drop of ATN, considering it as if an initial point of a new file.
</p>


<h3>Author(s)</h3>

<p>Sanjeev Bista (MPH - Advanced Bio-statistics and Epidemiology)
</p>


<h3>References</h3>

<p>Hagler GSW, Yelverton TLB, Vedantham R, Hansen ADA, Turner JR. Post-processing Method to Reduce Noise while Preserving High Time Resolution in Aethalometer Real-time Black Carbon Data. Aerosol Air Qual Res [Internet]. 2011 Oct [cited 2020 May 3];11(5):539–46. Available from: http://www.aaqr.org/doi/10.4209/aaqr.2011.05.0055
</p>
<p>Kirchstetter, T.W., Novakov, T., 2007. Controlled generation of black carbon particles from a diffusion flame and applications in evaluating black carbon measurement methods. Atmospheric Environment 41, 1874-1888 Available from: https://doi.org/10.1016/j.atmosenv.2006.10.067
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ONA">ONA</a></code>
<code><a href="#topic+filter_loading">filter_loading</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(data_ONA)#loading the example dataset
#saving a processed dataset with the same name
data_ONA&lt;-filter_adjust_ONA(data =data_ONA, ATN = "ATN", BC = "BC", dATN = 0.05, threshold = 5,
                  skip = 15, ignore = 10)


## The function is currently defined as
function (data =data, ATN = "ATN", BC = "BC", dATN = 0.05, threshold = 5,
    skip = 15, ignore = 10)
{
    if (nrow(data) &lt; (skip + ignore)) {
        print("not enough observations to correct for filter loading")
    }
    else {
        for (j in skip:(nrow(data) - ignore)) {
            if ((data[, ATN][j] - data[, ATN][j - 1]) &lt; (-threshold)) {
                f &lt;- j
                k1 &lt;- data[1:(f - skip), ]
                k2 &lt;- data[(f + ignore):nrow(data), ]
                k1[, "BC_ONA"] &lt;- ONA(data = k1, ATN = "ATN",
                  BC = "BC", dATN = dATN)
                k1[, "BC_ONA_Cor"] &lt;- k1[, "BC_ONA"] * (0.88 *
                  exp(-(k1[, ATN])/100) + 0.12)^(-1)
                k2[, "BC_ONA"] &lt;- ONA(data = k2, ATN = "ATN",
                  BC = "BC", dATN = dATN)
                k2[, "BC_ONA_Cor"] &lt;- k2[, "BC_ONA"] * (0.88 *
                  exp(-(k2[, ATN])/100) + 0.12)^(-1)
            }
        }
    }
    if (exists("k1") == T) {
        data &lt;- rbind(k1, k2)
        rm(k1, k2)
    }
    else {
        data[, "BC_ONA"] &lt;- ONA(data, ATN = "ATN", BC = "BC",
            dATN = 0.1)
        data[, "BC_ONA_Cor"] &lt;- data[, "BC_ONA"] * (0.88 * exp(-(data[,
            ATN])/100) + 0.12)^(-1)
    }
    return(data)
  }
</code></pre>

<hr>
<h2 id='filter_loading'> Filter loading correction
</h2><span id='topic+filter_loading'></span>

<h3>Description</h3>

<p>This function is applied when we already have black carbon concentration processed by ONA algorithm. Since Black carbon concentration measured by AE51 substantially decreases when the filter loading goes up, we can apply filter correction function to adjust for that.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>filter_loading(data, ONA_BC = "BC_ONA", ATN = "ATN")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="filter_loading_+3A_data">data</code></td>
<td>

<p>a datafram containing the raw data of black carbon.
</p>
</td></tr>
<tr><td><code id="filter_loading_+3A_ona_bc">ONA_BC</code></td>
<td>

<p>the column having black carbon concentration processed by ONA algorithm.
</p>
</td></tr>
<tr><td><code id="filter_loading_+3A_atn">ATN</code></td>
<td>

<p>the column having ATN coefficient.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This method is applicable even when the raw files are compiled as it uses the corresponding ATN values to correct for filter loading of black carbon concentration
</p>


<h3>Value</h3>

<p>The default mthod returns a vector with equal length as the dataframe.
</p>


<h3>Note</h3>

<p>Higly recommend to read the reference before using the function
</p>


<h3>Author(s)</h3>

<p>Sanjeev Bista (MPH - Advanced Bio-statistics and Epidemiology)
</p>


<h3>References</h3>

<p>Kirchstetter, T.W., Novakov, T., 2007. Controlled generation of black carbon particles from a diffusion flame and applications in evaluating black carbon measurement methods. Atmospheric Environment 41, 1874-1888 Available from: https://doi.org/10.1016/j.atmosenv.2006.10.067
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ONA">ONA</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(data_ONA)#loading the example dataset
#calculating ONA processed black carbon first
data_ONA$ONA_BC&lt;-ONA(data=data_ONA, ATN = "ATN", BC ="BC", dATN =0.05)
filter_loading(data =data_ONA, ATN = "ATN", ONA_BC="BC")

## The function is currently defined as
function (data, ONA_BC = "BC_ONA", ATN = "ATN")
{
    data[, ONA_BC] * (0.88 * exp(-(data[, ATN])/100) + 0.12)^(-1)
  }
</code></pre>

<hr>
<h2 id='ONA'> Optimized Noise Reduction Averaging (ONA) algorithm

</h2><span id='topic+ONA'></span>

<h3>Description</h3>

<p>The function uses the Optimized Noise Reduction Averaging (ONA) algorithm to process the raw black carbon data collected by Aethalometers (MicroAeth AE51, AethLabs, CA, USA).The algorithm smooths the black carbon concentration over a varying smoothing window identified by change in coefficient of light attenuation (ATN).

</p>


<h3>Usage</h3>

<pre><code class='language-R'>  ONA(data=data, ATN = "ATN", BC ="BC", dATN =0.05)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ONA_+3A_data">data</code></td>
<td>
<p> it is a datafram generated by the AE51 device at the file level and not compiled with other files, however, a little pre-processing has to be done such as naming the columns and formatting it as a data frame.

</p>
</td></tr>
<tr><td><code id="ONA_+3A_atn">ATN</code></td>
<td>

<p>the column having ATN coefficient.

</p>
</td></tr>
<tr><td><code id="ONA_+3A_bc">BC</code></td>
<td>

<p>the column having raw black carbon data.

</p>
</td></tr>
<tr><td><code id="ONA_+3A_datn">dATN</code></td>
<td>
<p>the difference in ATN coefficient which is used for defining the averaging window of raw black carbon concentration, by default it is 0.05.

</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This method is only applicable when the raw files are not compiled

</p>


<h3>Value</h3>

<p>The default method returns a vector with equal length as the dataframe





</p>


<h3>Note</h3>

<p>Higly recommend to read the reference before using the function

</p>


<h3>Author(s)</h3>

<p>Sanjeev Bista (MPH - Advanced Bio-statistics and Epidemiology)

</p>


<h3>References</h3>

<p>Hagler GSW, Yelverton TLB, Vedantham R, Hansen ADA, Turner JR. Post-processing Method to Reduce Noise while Preserving High Time Resolution in Aethalometer Real-time Black Carbon Data. Aerosol Air Qual Res [Internet]. 2011 Oct [cited 2020 May 3];11(5):539–46. Available from: http://www.aaqr.org/doi/10.4209/aaqr.2011.05.0055

</p>


<h3>See Also</h3>

<p><code><a href="base.html#topic+mean">mean</a></code>
<code><a href="base.html#topic+lapply">lapply</a></code>

</p>


<h3>Examples</h3>

<pre><code class='language-R'>  data(data_ONA) # loading example dataset
  ONA(data=data_ONA, ATN = "ATN", BC ="BC", dATN =0.05)

  data(data_compiled) #loading the example dataset compiled at file level
  #applying ONA on a compiled file where data come from different files
  data_compiled$file_ID&lt;-as.factor(data_compiled$file_ID)
  data_compiled$ONA_BC&lt;-unlist(lapply(split(data_compiled, data_compiled$file_ID),
  function(x) ONA(data=x, ATN = "ATN", BC ="BC", dATN =0.05)))

  </code></pre>

<hr>
<h2 id='ONA_compiled'> ONA at file level
</h2><span id='topic+ONA_compiled'></span>

<h3>Description</h3>

<p>This function is an extended version of filter_adjust_ONA which can work with the files compiled at person level or at study level, unlike the filter_adjust_ONA function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ONA_compiled(data = data, ATN = "ATN", BC = "BC", file_id = "file_ID", dATN = 0.05,
threshold = 5, skip = 15, ignore = 10)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ONA_compiled_+3A_data">data</code></td>
<td>

<p>a datafram containing the raw data of black carbon.
</p>
</td></tr>
<tr><td><code id="ONA_compiled_+3A_atn">ATN</code></td>
<td>

</td></tr>
<tr><td><code id="ONA_compiled_+3A_bc">BC</code></td>
<td>

<p>the column having ATN coefficient.
</p>
</td></tr>
<tr><td><code id="ONA_compiled_+3A_file_id">file_id</code></td>
<td>

<p>the column having file id after compiling files produced at different time for a person or of different participants.
</p>
</td></tr>
<tr><td><code id="ONA_compiled_+3A_datn">dATN</code></td>
<td>

<p>the difference in ATN coefficient which is used for defining the averaging window of raw black carbon concentration, by default it is 0.05.
</p>
</td></tr>
<tr><td><code id="ONA_compiled_+3A_threshold">threshold</code></td>
<td>

<p>the change in ATN value which indicates the filter change or the rapid drop of ATN value that may violate the averaging window which is based on the assumption that the ATN gradually increases.By default the value of 5 is used.
</p>
</td></tr>
<tr><td><code id="ONA_compiled_+3A_skip">skip</code></td>
<td>

<p>number of observations before the filter change point that has to be skiped or deleted from analysis. When the AE51 device is about to indicate the need of filter change it either produces maximum negative or positive black carbon concentration which is a mechanical noise and averaging those values also introduces bias. Therefore certain observations before filter change should be deleted depending on the data collection interval. By default it is 15 observation for 10s interval data.
</p>
</td></tr>
<tr><td><code id="ONA_compiled_+3A_ignore">ignore</code></td>
<td>

<p>number of observations after the filter change point that has to be ignored or deleted from analysis. After chaning the filter AE51 device either produces maximum negative or positive black carbon concentration which is a mechanical noise and averaging those values also introduces bias. Therefore certain observations after filter change should be deleted depending on the data collection interval. By default it is 10 observation for 10s interval data.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This method also applicable when the raw files are compiled at person level or even at study level
</p>


<h3>Value</h3>

<p>The default method returns the existing data frame with two additional columns 1) with ONA processed black carbon concentration and 2) filter loading corrected ONA processed black carbon concentration.
</p>


<h3>Note</h3>

<p>The file id helps the function to distinguish each separate file created by AE51 device at different point in time or created for different participants and assists in processing the file individually and compile them back to make a single file as it was given to the function.
</p>


<h3>Author(s)</h3>

<p>Sanjeev Bista (MPH - Advanced Bio-statistics and Epidemiology)
</p>


<h3>References</h3>

<p>Hagler GSW, Yelverton TLB, Vedantham R, Hansen ADA, Turner JR. Post-processing Method to Reduce Noise while Preserving High Time Resolution in Aethalometer Real-time Black Carbon Data. Aerosol Air Qual Res [Internet]. 2011 Oct [cited 2020 May 3];11(5):539–46. Available from: http://www.aaqr.org/doi/10.4209/aaqr.2011.05.0055
</p>
<p>Kirchstetter, T.W., Novakov, T., 2007. Controlled generation of black carbon particles from a
diffusion flame and applications in evaluating black carbon measurement methods.
Atmospheric Environment 41, 1874-1888
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ONA">ONA</a></code>
<code><a href="#topic+filter_loading">filter_loading</a></code>
<code><a href="#topic+filter_adjust_ONA">filter_adjust_ONA</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(data_compiled) #loading the example dataset compiled at file level
#saving a processed dataset (compiled at file level) with the same name
data_compiled&lt;-ONA_compiled(data = data_compiled, ATN = "ATN", BC = "BC", file_id = "file_ID",
          dATN = 0.05, threshold = 5, skip = 15, ignore = 10)

## The function is currently defined as
function (data = data, ATN = "ATN", BC = "BC", file_id = "file_ID",
    dATN = 0.05, threshold = 5, skip = 15, ignore = 10)
{
    data[, "file_ID"] &lt;- as.factor(data[, "file_ID"])
    data1 &lt;- lapply(split(data, data[, file_id]), function(x) {
        filter_adjust_ONA(x, ATN = ATN, BC = BC, dATN = dATN,
            threshold = threshold, skip = skip, ignore = ignore)
    })
    names(data1) &lt;- NULL
    data2 &lt;- do.call("rbind", data1)
    return(data2)
  }
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
