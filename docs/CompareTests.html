<!DOCTYPE html><html lang="en"><head><title>Help for package CompareTests</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {CompareTests}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#CompareTests-package'>
<p>Correct for Verification Bias in Diagnostic Accuracy &amp; Agreement</p></a></li>
<li><a href='#CompareTests'>
<p>Correct for Verification Bias in Diagnostic Accuracy &amp; Agreement</p></a></li>
<li><a href='#fulltable'>
<p>fulltable attaches margins and NA/NaN category to the output of table()</p></a></li>
<li><a href='#specimens'>
<p>Fictitious data on specimens tested by two methods</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Correct for Verification Bias in Diagnostic Accuracy &amp; Agreement</td>
</tr>
<tr>
<td>Version:</td>
<td>1.3</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-12-12</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Hormuzd Katki &lt;katkih@mail.nih.gov&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>A standard test is observed on all specimens.  We treat the second test (or sampled test) as being conducted on only a stratified sample of specimens.  Verification Bias is this situation when the specimens for doing the second (sampled) test is not under investigator control.  We treat the total sample as stratified two-phase sampling and use inverse probability weighting.  We estimate diagnostic accuracy (category-specific classification probabilities; for binary tests reduces to specificity and sensitivity, and also predictive values) and agreement statistics (percent agreement, percent agreement by category, Kappa (unweighted), Kappa (quadratic weighted) and symmetry tests (reduces to McNemar's test for binary tests)).  See: Katki HA, Li Y, Edelstein DW, Castle PE.  Estimating the agreement and diagnostic accuracy of two diagnostic tests when one test is conducted on only a subsample of specimens. Stat Med. 2012 Feb 28; 31(5) &lt;<a href="https://doi.org/10.1002%2Fsim.4422">doi:10.1002/sim.4422</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://dceg.cancer.gov/about/staff-directory/katki-hormuzd">https://dceg.cancer.gov/about/staff-directory/katki-hormuzd</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-12-12 15:21:17 UTC; katkih</td>
</tr>
<tr>
<td>Author:</td>
<td>Hormuzd A. Katki [aut],
  David W. Edelstein [aut],
  Hormuzd Katki [cre]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-12-12 15:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='CompareTests-package'>
Correct for Verification Bias in Diagnostic Accuracy &amp; Agreement
</h2><span id='topic+CompareTests-package'></span>

<h3>Description</h3>

<p>A standard test is observed on all specimens.  We treat the second test (or sampled test) as being conducted on only a stratified sample of specimens.  Verification Bias is this situation when the specimens for doing the second (sampled) test is not under investigator control.  We treat the total sample as stratified two-phase sampling and use inverse probability weighting.  We estimate diagnostic accuracy (category-specific classification probabilities; for binary tests reduces to specificity and sensitivity) and agreement statistics (percent agreement, percent agreement by category, Kappa (unweighted), Kappa (quadratic weighted) and symmetry test (reduces to McNemar's test for binary tests)). 
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> CompareTests</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.1</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2015-06-19</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL-3</td>
</tr>
<tr>
 <td style="text-align: left;">
LazyLoad: </td><td style="text-align: left;"> yes</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>You have a dataframe with columns &quot;stdtest&quot; (no NAs allowed; all specimens with NA stdtest results are dropped), &quot;sampledtest&quot; (a gold standard which is NA for some specimens), sampling strata &quot;strata1&quot; &quot;strata2&quot; (values cannot be missing for any specimens). Correct for Verification Bias in the diagnostic and agreement statistics with CompareTests(stdtest,sampledtest,interaction(strata1,strata2),goldstd=&quot;sampledtest&quot;)
</p>


<h3>Author(s)</h3>

<p>Hormuzd A. Katki and David W. Edelstein
</p>
<p>Maintainer: Hormuzd Katki &lt;katkih@mail.nih.gov&gt;
</p>


<h3>References</h3>

<p>Katki HA, Li Y, Edelstein DW, Castle PE.  Estimating the agreement and diagnostic accuracy of two diagnostic tests when one test is conducted on only a subsample of specimens.  Stat Med. 2012 Feb 28; 31(5): 10.1002/sim.4422.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Get specimens dataset
data(specimens)

# Get diagnostic and agreement statistics if sampledtest is the gold standard
CompareTests(specimens$stdtest,specimens$sampledtest,specimens$stratum)

# Get diagnostic and agreement statistics if stdtest is the gold standard
CompareTests(specimens$stdtest,specimens$sampledtest,specimens$stratum,goldstd="stdtest")

# Get agreement statistics if neither test is a gold standard
CompareTests(specimens$stdtest,specimens$sampledtest,specimens$stratum,goldstd=FALSE)

</code></pre>

<hr>
<h2 id='CompareTests'>
Correct for Verification Bias in Diagnostic Accuracy &amp; Agreement
</h2><span id='topic+CompareTests'></span>

<h3>Description</h3>

<p>A standard test is observed on all specimens.  We treat the second test (or sampled test) as being conducted on only a stratified sample of specimens.  We treat the total sample as stratified two-phase sampling and use inverse probability weighting.  We estimate diagnostic accuracy (category-specific classification probabilities; for binary tests reduces to specificity and sensitivity) and agreement statistics (percent agreement, percent agreement by category, Kappa (unweighted), Kappa (quadratic weighted) and symmetry tests (reduces to McNemar's test for binary tests)).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CompareTests(stdtest, sampledtest, strata = NA, goldstd = "sampledtest")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="CompareTests_+3A_stdtest">stdtest</code></td>
<td>
<p>A vector of standard test results.  Any NA test results are dropped from the analysis entirely.
</p>
</td></tr>
<tr><td><code id="CompareTests_+3A_sampledtest">sampledtest</code></td>
<td>
<p>A vector of test results observed only on a sample of specimens.  Test results with NA are assumed to no be observed for that specimen
</p>
</td></tr>
<tr><td><code id="CompareTests_+3A_strata">strata</code></td>
<td>
<p>The sampling stratum each specimen belongs to.  Set to NA if no sampling or simple random sampling.
</p>
</td></tr>
<tr><td><code id="CompareTests_+3A_goldstd">goldstd</code></td>
<td>
<p>For outputing diagnostic accuracy statistics, denote if &quot;stdtest&quot; or &quot;sampledtest&quot; is the gold standard.  If no gold standard, set to FALSE.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Outputs to screen the estimated contingency table of paired test results, agreement statistics, and diagnostic accuracy statistics.
</p>
<p>Returns a list with the following components
</p>
<table role = "presentation">
<tr><td><code>Cells</code></td>
<td>
<p>Observed contingency tables of pair test results for each stratum</p>
</td></tr>
<tr><td><code>EstCohort</code></td>
<td>
<p>Weighted contingency table of each pair of test results</p>
</td></tr>
<tr><td><code>Cellvars</code></td>
<td>
<p>Variance of each weighted cell count</p>
</td></tr>
<tr><td><code>Cellcovars</code></td>
<td>
<p>Variance-covariance matrix for each column of weighted cell counts</p>
</td></tr>
<tr><td><code>p0</code></td>
<td>
<p>Percent agreement</p>
</td></tr>
<tr><td><code>Varp0</code></td>
<td>
<p>Variance of percent agreement</p>
</td></tr>
<tr><td><code>AgrCat</code></td>
<td>
<p>Percent agreement by each test category</p>
</td></tr>
<tr><td><code>VarAgrCat</code></td>
<td>
<p>Variance of Percent agreement by each test category</p>
</td></tr>
<tr><td><code>uncondsymm</code></td>
<td>
<p>Symmetry test test statistic</p>
</td></tr>
<tr><td><code>Margincovars</code></td>
<td>
<p>covariance of each pair of margins</p>
</td></tr>
<tr><td><code>Kappa</code></td>
<td>
<p>Kappa (unweighted)</p>
</td></tr>
<tr><td><code>Kappavar</code></td>
<td>
<p>Variance of Kappa</p>
</td></tr>
<tr><td><code>iPV</code></td>
<td>
<p>Each predictive value (for binary tests, NPV and PPV)</p>
</td></tr>
<tr><td><code>VarsiPV</code></td>
<td>
<p>Variance of each predictive value (for binary tests, NPV and PPV)</p>
</td></tr>
<tr><td><code>iCSCP</code></td>
<td>
<p>Each category-specific classification probability (for binary tests, specificity and sensitivity</p>
</td></tr>
<tr><td><code>VarsiCSCP</code></td>
<td>
<p>Variance of each category-specific classification probability (for binary tests, specificity and sensitivity</p>
</td></tr>
<tr><td><code>WeightedKappa</code></td>
<td>
<p>Kappa (quadratic weights)</p>
</td></tr>
<tr><td><code>varWeightedKappa</code></td>
<td>
<p>Variance of quadratic-weighted Kappa</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Order the categories from least to most severe, for binary (-,+) or (0,1) to make sure that what is output as sensitivity is not the specificity, or that PPV is not reported as NPV.
</p>
<p>If you have multiple variables to be crossed to represent the sampling strata, use interaction(), e.g. strata=interaction(strata1,strata2)
</p>


<h3>Author(s)</h3>

<p>Hormuzd A. Katki and David W. Edelstein
</p>


<h3>References</h3>

<p>Katki HA, Li Y, Edelstein DW, Castle PE.  Estimating the agreement and diagnostic accuracy of two diagnostic tests when one test is conducted on only a subsample of specimens. Stat Med. 2012 Feb 28; 31(5): 10.1002/sim.4422.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##---- Should be DIRECTLY executable !! ----
##-- ==&gt;  Define data, use random,
##--	or do  help(data=index)  for the standard data sets.

##
# Stat Med Paper 2x2 Chlamydia testing verification bias example
# Note that p for symmetry test is 0.12 not 0.02 as reported in the Stat Med paper
##

# Convert 2x2 Chlamydia testing table to a dataframe for analysis
# Include NAs for the samples where CTDT test was not conducted (HC2 was conducted on all)
HC2stdtest &lt;- c(rep(1,827),rep(0,4998))
stratum &lt;- HC2stdtest
CTDTsampledtest &lt;- c(           rep(1,800), # 1,1 cell
                                rep(0,27), # 1,0 cell HC2+ , CTDT-
                                rep(NA,827-800-27), # HC2+, and no CTDT test done
                                rep(1,6), # 0,1 cell: HC2-, CTDT+
                                rep(0,396),# 0,0 cell: HC2- and CTDT-
                                rep(NA,4998-6-396) # HC2-, no CTDT test done
)
chlamydia &lt;- data.frame(stratum,HC2stdtest,CTDTsampledtest)					

# Analysis
temp &lt;- CompareTests(chlamydia$HC2stdtest,
                     chlamydia$CTDTsampledtest,
                     chlamydia$stratum,
                     goldstd="sampledtest"
)


##
# Example analysis of fictitious data example
##
data(specimens)
temp &lt;- CompareTests(specimens$stdtest,
                     specimens$sampledtest,
                     specimens$stratum,
                     goldstd="sampledtest")
## The output is
# The weighted contingency table:
#                             as.factor.stdtest.
# as.factor.sampledtest.     1       2      3      4
#                      1 47.88   7.158  3.322  0.000
#                      2 20.12 104.006 21.861  2.682
#                      3  0.00  10.836 97.494  8.823
#                      4  0.00   0.000  3.322 74.495
# 
# 
# Agreement Statistics
# 
# pct agree and 95% CI: 0.8057 ( 0.7438 0.8555 )
# pct agree by categories and 95% CI 
#      est   left  right
# 1 0.6101 0.4501 0.7494
# 2 0.6241 0.5315 0.7083
# 3 0.6693 0.5562 0.7658
# 4 0.8340 0.6340 0.9358
# Kappa and 95% CI: 0.734 ( 0.6509 0.8032 )
# Weighted Kappa (quadratic weights) and 95% CI: 0.8767 ( 0.7107 0.9536 )
# symmetry chi-square: 9.119 p= 0.167 
# 
# 
# 
# Diagnostic Accuracy statistics
# 
#        est   left  right
# 1PV 0.7041 0.5422 0.8271
# 2PV 0.8525 0.7362 0.9229
# 3PV 0.7738 0.6547 0.8605
# 4PV 0.8662 0.6928 0.9490
#          est   left  right
# 1CSCP 0.8204 0.6011 0.9327
# 2CSCP 0.6996 0.6169 0.7710
# 3CSCP 0.8322 0.7219 0.9046
# 4CSCP 0.9573 0.5605 0.9975
</code></pre>

<hr>
<h2 id='fulltable'>
fulltable attaches margins and NA/NaN category to the output of table()
</h2><span id='topic+fulltable'></span>

<h3>Description</h3>

<p>fulltable attaches margins and NA/NaN category to the output of table()
</p>


<h3>Arguments</h3>

<p>same as table()
</p>


<h3>Value</h3>

<p>same as returned from table()
</p>


<h3>Author(s)</h3>

<p>Hormuzd A. Katki
</p>


<h3>See Also</h3>

<p>table
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## The function is currently defined as
function (...)
{
  ## Purpose: Add the margins automatically and don't exclude NA/NaN as its own row/column
  ##          and also add row/column titles.  Works for mixed numeric/factor variables.
  ##          For factors, the exclude option won't include the NAs as columns, that's why
  ##          I need to do more work.
  ## ----------------------------------------------------------------------
  ## Arguments: Same as for table()
  ## ----------------------------------------------------------------------
  ## Author: Hormuzd Katki, Date:  5 May 2006, 19:45

  # This works for purely numeric input, but not for any factors b/c exclude=NULL won't
  # include NAs for them.
  #   return(addmargins(table(...,exclude=NULL)))

  ##
  # Factors are harder.  I have to reconstruct each factor to include NA as a level
  ##
  
  # Put everything into a data frame
  x &lt;- data.frame(...)

  # For each factor (in columns), get the raw levels out, reconstruct to include NAs
  # That is, if there are any NAs -- if none, add it as a level anyway
  for (i in 1:dim(x)[2]) {
    if ( is.factor(x[,i]) )
      if ( any(is.na(x[,i])) )
        x[,i] &lt;- factor(unclass(x[,i]),labels=c(levels(x[,i]),"NA"),exclude=NULL)
      else
        levels(x[,i]) &lt;- c(levels(x[,i]),"NA")
  }

  # Make table with margins.  Since NA is a level in each factor, they'll be included
  return(addmargins(table(x,exclude=NULL)))

  }
</code></pre>

<hr>
<h2 id='specimens'>
Fictitious data on specimens tested by two methods
</h2><span id='topic+specimens'></span>

<h3>Description</h3>

<p>stdtest has been done on everyone, and sampledtest has been done on a stratifed subsample of 275 out of 402 specimens (is NA on the other 127 specimens)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(specimens)</code></pre>


<h3>Format</h3>

<p>A data frame with 402 observations on the following 3 variables.
</p>

<dl>
<dt><code>stratum</code></dt><dd><p>6 strata used for sampling</p>
</dd>
<dt><code>stdtest</code></dt><dd><p>standard test result available on all specimens</p>
</dd>
<dt><code>sampledtest</code></dt><dd><p>new test result available only on stratified subsample</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>data(specimens)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
