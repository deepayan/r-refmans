<!DOCTYPE html><html><head><title>Help for package obAnalytics</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {obAnalytics}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#obAnalytics-package'><p>obAnalytics.</p></a></li>
<li><a href='#alignS'><p>Align 2 sequences.</p></a></li>
<li><a href='#depth'><p>Depth.</p></a></li>
<li><a href='#depth.summary'><p>Depth summary.</p></a></li>
<li><a href='#depthMetrics'><p>Calculate order book summary statistics/metrics.</p></a></li>
<li><a href='#eventMatch'><p>Match Market Orders (takers) to Limit Orders (makers).</p></a></li>
<li><a href='#events'><p>Limit order events.</p></a></li>
<li><a href='#filterDepth'><p>Filter price level volume.</p></a></li>
<li><a href='#getSpread'><p>Get the spread.</p></a></li>
<li><a href='#loadData'><p>Load pre-processed data.</p></a></li>
<li><a href='#loadEventData'><p>Read raw limit order event data from a CSV file.</p></a></li>
<li><a href='#lob.data'><p>Example limit order book data.</p></a></li>
<li><a href='#matchTrades'><p>Construct trades data.table.</p></a></li>
<li><a href='#orderAggressiveness'><p>Calculate order aggressiveness with respect to best bid or ask in BPS.</p></a></li>
<li><a href='#orderBook'><p>Instantaneous limit order book reconstruction.</p></a></li>
<li><a href='#plotCurrentDepth'><p>Visualise order book depth at any given point in time.</p></a></li>
<li><a href='#plotEventMap'><p>Plot limit order event map.</p></a></li>
<li><a href='#plotEventsHistogram'><p>Plot a histogram given event data.</p></a></li>
<li><a href='#plotPriceLevels'><p>Plot order book price level heat map.</p></a></li>
<li><a href='#plotPriceLevelsFaster'><p>Poor man's heatmap.</p></a></li>
<li><a href='#plotTimeSeries'><p>General purpose time series plot.</p></a></li>
<li><a href='#plotTrades'><p>plotTrades.</p></a></li>
<li><a href='#plotVolumeMap'><p>Visualise flashed-limit order volume.</p></a></li>
<li><a href='#plotVolumePercentiles'><p>Visualise available limit order book liquidity through time.</p></a></li>
<li><a href='#priceLevelVolume'><p>Calculate priceLevelVolume (depth).</p></a></li>
<li><a href='#processData'><p>Import CSV file.</p></a></li>
<li><a href='#saveData'><p>Save processed data.</p></a></li>
<li><a href='#setOrderTypes'><p>Determine limit order types.</p></a></li>
<li><a href='#sMatrix'><p>Similarity matrix.</p></a></li>
<li><a href='#themeBlack'><p>Black theme.</p></a></li>
<li><a href='#tradeImpacts'><p>Trade impacts.</p></a></li>
<li><a href='#trades'><p>Trades.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Limit Order Book Analytics</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.1</td>
</tr>
<tr>
<td>Description:</td>
<td>Data processing, visualisation and analysis of Limit Order Book
    event data.</td>
</tr>
<tr>
<td>Author:</td>
<td>Philip Stubbings</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Philip Stubbings &lt;phil@parasec.net&gt;</td>
</tr>
<tr>
<td>Date:</td>
<td>2016-11-10</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/phil8192/ob-analytics">https://github.com/phil8192/ob-analytics</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/phil8192/ob-analytics/issues">https://github.com/phil8192/ob-analytics/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.1.1)</td>
</tr>
<tr>
<td>Imports:</td>
<td>zoo, ggplot2, reshape2, utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>grid, rmarkdown, knitr, testthat</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>5.0.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2016-11-11 11:06:41 UTC; phil</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2016-11-11 17:26:37</td>
</tr>
</table>
<hr>
<h2 id='obAnalytics-package'>obAnalytics.</h2><span id='topic+obAnalytics'></span><span id='topic+obAnalytics-package'></span>

<h3>Description</h3>

<p>Limit order book analytics.
</p>


<h3>Main functionality</h3>


<ul>
<li><p> Limit order book event processing.
</p>
</li>
<li><p> Visualise order book state and market impacts.
</p>
</li>
<li><p> Order book reconstruction and analysis.
</p>
</li></ul>



<h3>Data processing</h3>

<p>The main focus of this package is reconstruction of a limit order book. 
The <code><a href="#topic+processData">processData</a></code> function will perform data processing based on
a supplied CSV file, the schema of which is defined in the
<code><a href="#topic+processData">processData</a></code> function documentation. Example preprocessed limit
order data are also provided (see <code><a href="#topic+lob.data">lob.data</a></code>) which has been
derived from the example raw data provided the inst/extdata directory.
</p>
<p>The data processing consists of a number of stages:
</p>

<ul>
<li><p> Cleaning of duplicate and erroneous data.
</p>
</li>
<li><p> Identification of sequential event relationships.
</p>
</li>
<li><p> Inference of trade events via order-matching.
</p>
</li>
<li><p> Inference of order types (limit vs market).
</p>
</li>
<li><p> Construction of volume by price level series.
</p>
</li>
<li><p> Construction of order book summary statistics.
</p>
</li></ul>

<p>Limit order events are related to one another by <em>volume deltas</em> (the
change in volume for a limit order). To simulate a matching-engine, and thus
determine directional trade data, volume deltas from both sides of the limit
order book are ordered by time, yielding a sequence alignment problem, to
which the the
<a href="https://en.wikipedia.org/wiki/Needleman-Wunsch_algorithm">Needleman-Wunsch</a>
algorithm has been applied.
</p>


<h3>Visualisation</h3>

<p>The package provides a number of functions for the visualisation of limit
order events and order book liquidity. The visualisations all make use of
the <a href="http://ggplot2.org">ggplot2</a> plotting system:
</p>

<dl>
<dt><a href="#topic+plotTimeSeries">plotTimeSeries</a></dt><dd><p>General time series plotting.</p>
</dd>
<dt><a href="#topic+plotTrades">plotTrades</a></dt><dd><p>Plot <code><a href="#topic+trades">trades</a></code> data.</p>
</dd>
<dt><a href="#topic+plotCurrentDepth">plotCurrentDepth</a></dt><dd><p>Visualise the <em>shape</em> of an
<code><a href="#topic+orderBook">orderBook</a></code>.</p>
</dd>
<dt><a href="#topic+plotPriceLevels">plotPriceLevels</a></dt><dd><p>Visualise volume by price level through
time.</p>
</dd>
<dt><a href="#topic+plotVolumePercentiles">plotVolumePercentiles</a></dt><dd><p>Visualise order book liquidity through
time.</p>
</dd>
<dt><a href="#topic+plotEventMap">plotEventMap</a></dt><dd><p>Visualise sequential limit order events by price
level.</p>
</dd>
<dt><a href="#topic+plotVolumeMap">plotVolumeMap</a></dt><dd><p>Visualise sequential limit order events by
volume.</p>
</dd>
<dt><a href="#topic+plotEventsHistogram">plotEventsHistogram</a></dt><dd><p>Convenience function.</p>
</dd>
</dl>

<p>The <code><a href="#topic+plotPriceLevels">plotPriceLevels</a></code> visualisation is designed to show the
<em>ebb and flow</em> of limit order volume at all price levels including the
interplay between the bid/ask spread. It is possible to identify interesting
market participant behaviour and to visualise market shocks and resilience
with this function.
</p>
<p>The <code><a href="#topic+plotEventMap">plotEventMap</a></code> function is useful for studying systematic
market participant behaviour. Interesting sequential patterns can be observed
in this visualisation as algorithms react to various market events by
repositioning orders.
</p>
<p>The <code><a href="#topic+plotVolumeMap">plotVolumeMap</a></code> function shows a visualisation of cancelled
volume through time. It is possible to identify and filter out individual
trading algorithms from this graph.
</p>
<p>The <code><a href="#topic+plotVolumePercentiles">plotVolumePercentiles</a></code> visualisation is inspired by the size
map chart included in many articles from
<a href="http://www.nanex.net/NxResearch">Nanex research</a> and is intended to
show available market liquidity.
</p>
<p>In all visualisations it is possible to filter the data by time, price and
volume.
</p>


<h3>Analysis</h3>

<p>In addition to the generated <code><a href="#topic+lob.data">lob.data</a></code> which are intended to be
used as a basis for further research, the package currently provides a
limited set of trade and order book analysis functions:
</p>

<dl>
<dt><a href="#topic+filterDepth">filterDepth</a></dt><dd><p>Filter <code><a href="#topic+depth">depth</a></code> data by time period.</p>
</dd>
<dt><a href="#topic+getSpread">getSpread</a></dt><dd><p>Extract the bid/ask quotes from the
<code><a href="#topic+depth.summary">depth.summary</a></code> data.</p>
</dd>
<dt><a href="#topic+orderBook">orderBook</a></dt><dd><p>Reconstruct a Limit order book from
<code><a href="#topic+events">events</a></code> data.</p>
</dd>
<dt><a href="#topic+tradeImpacts">tradeImpacts</a></dt><dd><p>Group <code><a href="#topic+trades">trades</a></code> into individual impact events.</p>
</dd>
</dl>

<p>Additional functionality will be added to the package in the future.
</p>


<h3>Author(s)</h3>

<p>Philip Stubbings <a href="mailto:phil@parasec.net">phil@parasec.net</a>
</p>


<h3>References</h3>

<p><a href="http://parasec.net/transmission/order-book-visualisation">http://parasec.net/transmission/order-book-visualisation</a>
</p>

<hr>
<h2 id='alignS'>Align 2 sequences.</h2><span id='topic+alignS'></span>

<h3>Description</h3>

<p>Verbatim implementation of Needleman-Wunsch matching algorithm.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>alignS(s.matrix, gap = -1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="alignS_+3A_s.matrix">s.matrix</code></td>
<td>
<p>Similarity matrix. See sMatrix(...).</p>
</td></tr>
<tr><td><code id="alignS_+3A_gap">gap</code></td>
<td>
<p>Penality assigned to a gap (missing or extra value).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>2 column matrix. First column = similarity matrix rows
(first sequence), Second column = similarity matrix columns
(second sequence). Each row maps aligned indexs from each sequence:
</p>
<pre>
  &gt; a &lt;- c(2,4,5)
  &gt; b &lt;- 1:5
  &gt; alignS(sMatrix(a,b))
       a b
  [1,] 1 2
  [2,] 2 4
  [3,] 3 5
</pre>


<h3>Author(s)</h3>

<p>phil
</p>


<h3>References</h3>

<p><a href="https://en.wikipedia.org/wiki/Needleman-Wunsch_algorithm">https://en.wikipedia.org/wiki/Needleman-Wunsch_algorithm</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

a &lt;- c(2,4,5)
b &lt;- 1:5
alignS(sMatrix(a, b))


## End(Not run)
</code></pre>

<hr>
<h2 id='depth'>Depth.</h2><span id='topic+depth'></span>

<h3>Description</h3>

<p>Price level depth (liquidity) through time.
</p>


<h3>Format</h3>

<p>A data.frame consisting of the following fields:
</p>

<dl>
<dt>timestamp</dt><dd><p>Time at which volume was added or removed.</p>
</dd>
<dt>price</dt><dd><p>Order book price level.</p>
</dd>
<dt>volume</dt><dd><p>Amount of remaining volume at this price level.</p>
</dd>
<dt>side</dt><dd><p>The side of the price level: <em>bid</em> or <em>ask</em>.</p>
</dd>
</dl>


<h3>Details</h3>

<p>The depth data.frame describes the amount of available volume for all price
levels in the limit order book through time. Each row corresponds to a limit
order event, in which volume has been added or removed.
</p>


<h3>Author(s)</h3>

<p>phil
</p>


<h3>See Also</h3>

<p>Other Limit.order.book.data: <code><a href="#topic+depth.summary">depth.summary</a></code>,
<code><a href="#topic+events">events</a></code>, <code><a href="#topic+trades">trades</a></code>
</p>

<hr>
<h2 id='depth.summary'>Depth summary.</h2><span id='topic+depth.summary'></span>

<h3>Description</h3>

<p>Limit order book summary statistics.
</p>


<h3>Format</h3>

<p>A data.frame consisting of the following fields:
</p>

<dl>
<dt>timestamp</dt><dd><p>Local timestamp corresponding to <code><a href="#topic+events">events</a></code>.</p>
</dd>
<dt>best.bid.price</dt><dd><p>Best bid price.</p>
</dd>
<dt>best.bid.vol</dt><dd><p>Amount of volume available at the best bid.</p>
</dd>
<dt>bid.vol25:500bps</dt><dd><p>The amount of volume available for 20 25bps
percentiles below the best bid.</p>
</dd>
<dt>best.ask.price</dt><dd><p>The best ask price.</p>
</dd>
<dt>best.ask.vol</dt><dd><p>Amount of volume available at the best ask.</p>
</dd>
<dt>ask.vol25:500bps</dt><dd><p>The amount od volume available for 20 25bps
percentiles above the best ask.</p>
</dd>
</dl>


<h3>Details</h3>

<p>Various summary statistics describing the state of the order book after
every limit order event. The metrics are intended to quantify the
<em>shape</em> of the order book through time.
</p>


<h3>Author(s)</h3>

<p>phil
</p>


<h3>See Also</h3>

<p>Other Limit.order.book.data: <code><a href="#topic+depth">depth</a></code>,
<code><a href="#topic+events">events</a></code>, <code><a href="#topic+trades">trades</a></code>
</p>

<hr>
<h2 id='depthMetrics'>Calculate order book summary statistics/metrics.</h2><span id='topic+depthMetrics'></span>

<h3>Description</h3>

<p>This function calculates various summary statistics describing the state of
the limit order book after every event. The metrics are intended to quantify
the &quot;shape&quot; of the order book through time. Currenly the following metrics
are calculated:
</p>


<h3>Usage</h3>

<pre><code class='language-R'>depthMetrics(depth, bps = 25, bins = 20)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="depthMetrics_+3A_depth">depth</code></td>
<td>
<p>Price level cumulative depth calculated by priceLevelVolume()</p>
</td></tr>
<tr><td><code id="depthMetrics_+3A_bps">bps</code></td>
<td>
<p>Width (in BPS) for each interval/bin</p>
</td></tr>
<tr><td><code id="depthMetrics_+3A_bins">bins</code></td>
<td>
<p>Number of intervals +- the best bid/ask to aggregate.</p>
</td></tr>
</table>


<h3>Details</h3>

<pre>
  [timestamp,
   best.bid.price, best.bid.vol, bid.vol25:500bps,
   best.ask.price, best.ask.vol, ask.vol25:500bps,]

where timestamp = time of order book state change
 best.bid.price = current best bid price
 best.bid.vol = current amount of volume at the best bid
 bid.vol25:500bps = amount of volume available &gt; -25bps and &lt;= best bid
                    until &gt; 500bps &lt;= 475bps.
   ... the same pattern is then repeated for the ask side.
</pre>


<h3>Value</h3>

<p>data.frame containing order book summary statistics.
</p>


<h3>Author(s)</h3>

<p>phil
</p>

<hr>
<h2 id='eventMatch'>Match Market Orders (takers) to Limit Orders (makers).</h2><span id='topic+eventMatch'></span>

<h3>Description</h3>

<p>Matches corresponding Bid(s) and Ask(s) for each trade event.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>eventMatch(events, cut.off.ms = 5000)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="eventMatch_+3A_events">events</code></td>
<td>
<p>data frame of order book events.</p>
</td></tr>
<tr><td><code id="eventMatch_+3A_cut.off.ms">cut.off.ms</code></td>
<td>
<p>events occuring outside of this time (in milliseconds) 
will be considered as candidate matches.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A trade event (a market impact) will generate a list of volume change events.
This function will line up 2 time ordered event lists for each side of the
book and attempt to align them by matching volume. If the result contains 
duplicate matches, then the matching is treated as a sequence alignment 
problem, and the Needleman-Wunsch algorithm is applied. As such, the
function acts as a type of &quot;one shot&quot; matching engine, simulating an order
book matching engine without the need to reconstruct the whole book.
</p>


<h3>Author(s)</h3>

<p>phil
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
asTime &lt;- function(s) as.POSIXct(s, tz="UTC")
events &lt;- data.frame(timestamp=c(asTime("2015-10-10 21:32:00.000"),
                                 asTime("2015-10-10 21:32:00.010"),
                                 asTime("2015-10-10 21:32:10.000"),
                                 asTime("2015-10-10 21:32:10.010")),
                      direction=c("bid", "ask", "bid", "ask"),
                      event.id=c(1, 2, 3, 4),
                      fill=rep(1234, 4))
matched &lt;- obAnalytics:::eventMatch(events, cut.off.ms=1000)

</code></pre>

<hr>
<h2 id='events'>Limit order events.</h2><span id='topic+events'></span>

<h3>Description</h3>

<p>A data.frame containing the lifecycle of limit orders.
</p>


<h3>Format</h3>

<p>A data.frame consisting of the following fields:
</p>

<dl>
<dt>event.id</dt><dd><p>Event ID.</p>
</dd>
<dt>id</dt><dd><p>Limit Order ID.</p>
</dd>
<dt>timestamp</dt><dd><p>Local timestamp for order update (create/modify/delete).</p>
</dd>
<dt>exchange.timestamp</dt><dd><p>Exchange order creation time.</p>
</dd>
<dt>price</dt><dd><p>Limit order price level.</p>
</dd>
<dt>volume</dt><dd><p>Remaining limit order volume.</p>
</dd>
<dt>action</dt><dd><p>Event action: created, changed, deleted.</p>
</dd>
<dt>direction</dt><dd><p>Order book side: bid, ask.</p>
</dd>
<dt>fill</dt><dd><p>For changed or deleted events, indicates the change in volume.</p>
</dd>
<dt>matching.event</dt><dd><p>Matching <code>event.id</code> if this event is part of a
trade. <code>NA</code> otherwise.</p>
</dd>
<dt>type</dt><dd><p>Limit order type (see <em>Event types</em> below.)</p>
</dd>
<dt>aggressiveness.bps</dt><dd><p>The distance of the order from the edge of the
book in Basis Points (BPS).</p>
</dd>
</dl>

<p>Each limit order <em>type</em> has been categorised as follows:
</p>

<dl>
<dt>unknown</dt><dd><p>It was not possible to infer the order type given the
available data.</p>
</dd>
<dt>flashed-limit</dt><dd><p>Order was created then subsequently deleted. 96% of
example data.</p>
</dd>
<dt>resting-limit</dt><dd><p>Order was created and left in order book indefinitely
until filled.</p>
</dd>
<dt>market-limit</dt><dd><p>Order was partially filled before landing in the order
book at it's limit price.</p>
</dd>
<dt>market</dt><dd><p>Order was completely filled and did not come to rest in the
order book.</p>
</dd>
<dt>pacman</dt><dd><p>A limit-price modified <em>in situ</em> (exchange algorithmic
order).</p>
</dd>
</dl>


<h3>Details</h3>

<p>The purpose of this table is to keep account of the lifecycle of all orders
in both sides of the limit order book. The lifecycle of an individual limit
order follows a sequence of events:
</p>

<dl>
<dt>created</dt><dd><p>The order is created with a specified amount of volume and
a limit price.</p>
</dd>
<dt>changed</dt><dd><p>The order has been partially filled. On each modification, 
the remaining volume will decrease.</p>
</dd>
<dt>deleted</dt><dd><p>The order may be deleted at the request of the trader or, in
the event that the order has been completely filled, deleted by the exchange.
An order deleted by the exchange as a result of being filled will have 0
remaining volume at time of deletion.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>phil
</p>


<h3>See Also</h3>

<p>Other Limit.order.book.data: <code><a href="#topic+depth.summary">depth.summary</a></code>,
<code><a href="#topic+depth">depth</a></code>, <code><a href="#topic+trades">trades</a></code>
</p>

<hr>
<h2 id='filterDepth'>Filter price level volume.</h2><span id='topic+filterDepth'></span>

<h3>Description</h3>

<p>Given depth data calculated by <code><a href="#topic+priceLevelVolume">priceLevelVolume</a></code>, filter
between a specified time range. The resulting data will contain price level
volume which is active only within the specified time range.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>filterDepth(d, from, to)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="filterDepth_+3A_d">d</code></td>
<td>
<p><code><a href="#topic+depth">depth</a></code> data.</p>
</td></tr>
<tr><td><code id="filterDepth_+3A_from">from</code></td>
<td>
<p>Beginning of range.</p>
</td></tr>
<tr><td><code id="filterDepth_+3A_to">to</code></td>
<td>
<p>End of range.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For price levels with volume &gt; 0 before the time range starts, timestamps
will be set to the supplied <code>from</code> parameter.
</p>
<p>For volume &gt; 0 after the time range ends, timestamps will be set to the
supplied <code>to</code> parameter and volume set to 0.
</p>
<p>For example, the following data taken from <code><a href="#topic+priceLevelVolume">priceLevelVolume</a></code>
for price level 243.29 shows the available volume through time at that
price level between <code>00:52:37.686</code> and <code>03:28:49.621</code>.
</p>

<table>
<tr>
 <td style="text-align: right;">
  timestamp               </td><td style="text-align: right;"> price  </td><td style="text-align: right;"> volume    </td><td style="text-align: right;"> side </td>
</tr>
<tr>
 <td style="text-align: right;">
  2015-05-01 00:52:37.686 </td><td style="text-align: right;"> 243.29 </td><td style="text-align: right;"> 911500000 </td><td style="text-align: right;"> ask  </td>
</tr>
<tr>
 <td style="text-align: right;">
  2015-05-01 01:00:36.243 </td><td style="text-align: right;"> 243.29 </td><td style="text-align: right;"> 862200000 </td><td style="text-align: right;"> ask  </td>
</tr>
<tr>
 <td style="text-align: right;">
  2015-05-01 02:45:43.052 </td><td style="text-align: right;"> 243.29 </td><td style="text-align: right;"> 0         </td><td style="text-align: right;"> ask  </td>
</tr>
<tr>
 <td style="text-align: right;">
  2015-05-01 02:52:24.063 </td><td style="text-align: right;"> 243.29 </td><td style="text-align: right;"> 614700000 </td><td style="text-align: right;"> ask  </td>
</tr>
<tr>
 <td style="text-align: right;">
  2015-05-01 02:52:51.413 </td><td style="text-align: right;"> 243.29 </td><td style="text-align: right;"> 0         </td><td style="text-align: right;"> ask  </td>
</tr>
<tr>
 <td style="text-align: right;">
  2015-05-01 02:53:13.904 </td><td style="text-align: right;"> 243.29 </td><td style="text-align: right;"> 952300000 </td><td style="text-align: right;"> ask  </td>
</tr>
<tr>
 <td style="text-align: right;">
  2015-05-01 03:28:49.621 </td><td style="text-align: right;"> 243.29 </td><td style="text-align: right;"> 0         </td><td style="text-align: right;"> ask</td>
</tr>

</table>

<p>applying <code>filterDepth</code> to this data for a time range beteen
<code>02:45</code> and <code>03:00</code> will result in the following:
</p>

<table>
<tr>
 <td style="text-align: right;">
  timestamp               </td><td style="text-align: right;"> price  </td><td style="text-align: right;"> volume    </td><td style="text-align: right;"> side </td>
</tr>
<tr>
 <td style="text-align: right;">
  2015-05-01 02:45:00.000 </td><td style="text-align: right;"> 243.29 </td><td style="text-align: right;"> 862200000 </td><td style="text-align: right;"> ask  </td>
</tr>
<tr>
 <td style="text-align: right;">
  2015-05-01 02:45:43.052 </td><td style="text-align: right;"> 243.29 </td><td style="text-align: right;"> 0         </td><td style="text-align: right;"> ask  </td>
</tr>
<tr>
 <td style="text-align: right;">
  2015-05-01 02:52:24.063 </td><td style="text-align: right;"> 243.29 </td><td style="text-align: right;"> 614700000 </td><td style="text-align: right;"> ask  </td>
</tr>
<tr>
 <td style="text-align: right;">
  2015-05-01 02:52:51.413 </td><td style="text-align: right;"> 243.29 </td><td style="text-align: right;"> 0         </td><td style="text-align: right;"> ask  </td>
</tr>
<tr>
 <td style="text-align: right;">
  2015-05-01 02:53:13.904 </td><td style="text-align: right;"> 243.29 </td><td style="text-align: right;"> 952300000 </td><td style="text-align: right;"> ask  </td>
</tr>
<tr>
 <td style="text-align: right;">
  2015-05-01 03:00:00.000 </td><td style="text-align: right;"> 243.29 </td><td style="text-align: right;"> 0         </td><td style="text-align: right;"> ask</td>
</tr>

</table>

<p>Note that the timestamps at the begining and end of the table have been
<em>clamped</em> to the specified range and the volume set to 0 at the end.
</p>


<h3>Value</h3>

<p>Filtered depth data.
</p>


<h3>Author(s)</h3>

<p>phil
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# obtain price level volume for a 15 minute window.
filtered &lt;- with(lob.data, filterDepth(depth,
    from=as.POSIXct("2015-05-01 02:45:00.000", tz="UTC"),
    to=as.POSIXct("2015-05-01 03:00:00.000", tz="UTC")))

# top 5 most active price levels during this 15 minute window.
head(sort(tapply(filtered$volume, filtered$price, length),
    decreasing=TRUE), 5)

# extract available volume for price level 233.78, then plot it.
level.233.78 &lt;- filtered[filtered$price == 233.78, c("timestamp", "volume")]
plotTimeSeries(level.233.78$timestamp, level.233.78$volume*10^-8)

</code></pre>

<hr>
<h2 id='getSpread'>Get the spread.</h2><span id='topic+getSpread'></span>

<h3>Description</h3>

<p>Extracts the spread from the depth summary, removing any points in which a
change to bid/ask price/volume did not occur.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getSpread(depth.summary)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getSpread_+3A_depth.summary">depth.summary</code></td>
<td>
<p><code><a href="#topic+depth.summary">depth.summary</a></code> data.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The spread (best bid and ask price) will change following a market order or
upon the addition/cancellation of a limit order at, or within, the range of
the current best bid/ask. A change to the spread that is <em>not</em> the
result of a market order (an impact/market shock) is known as a
<em>quote</em>.
</p>
<p>The following table shows a market spread betwen <code>05:03:22.546</code> and
<code>05:04:42.957</code>. During this time, the best ask price and volume changes
whilst the best bid price and volume remains static.
</p>

<table>
<tr>
 <td style="text-align: right;">
  timestamp    </td><td style="text-align: right;"> bid.price </td><td style="text-align: right;"> bid.vol  </td><td style="text-align: right;"> ask.price </td><td style="text-align: right;"> ask.vol </td>
</tr>
<tr>
 <td style="text-align: right;">
  05:03:22.546 </td><td style="text-align: right;"> 235.45    </td><td style="text-align: right;"> 16235931 </td><td style="text-align: right;"> 235.72    </td><td style="text-align: right;"> 39375160 </td>
</tr>
<tr>
 <td style="text-align: right;">
  05:03:24.990 </td><td style="text-align: right;"> 235.45    </td><td style="text-align: right;"> 16235931 </td><td style="text-align: right;"> 235.72    </td><td style="text-align: right;"> 21211607 </td>
</tr>
<tr>
 <td style="text-align: right;">
  05:03:25.450 </td><td style="text-align: right;"> 235.45    </td><td style="text-align: right;"> 16235931 </td><td style="text-align: right;"> 235.71    </td><td style="text-align: right;"> 39375160 </td>
</tr>
<tr>
 <td style="text-align: right;">
  05:04:15.477 </td><td style="text-align: right;"> 235.45    </td><td style="text-align: right;"> 16235931 </td><td style="text-align: right;"> 235.72    </td><td style="text-align: right;"> 39058160 </td>
</tr>
<tr>
 <td style="text-align: right;">
  05:04:16.670 </td><td style="text-align: right;"> 235.45    </td><td style="text-align: right;"> 16235931 </td><td style="text-align: right;"> 235.71    </td><td style="text-align: right;"> 39058160 </td>
</tr>
<tr>
 <td style="text-align: right;">
  05:04:42.957 </td><td style="text-align: right;"> 235.45    </td><td style="text-align: right;"> 16235931 </td><td style="text-align: right;"> 235.71    </td><td style="text-align: right;"> 77019160</td>
</tr>

</table>



<h3>Value</h3>

<p>Bid/Ask spread quote data.
</p>


<h3>Author(s)</h3>

<p>phil
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# get the last 25 quotes (changes to the spread).
with(lob.data, tail(getSpread(depth.summary), 25))

</code></pre>

<hr>
<h2 id='loadData'>Load pre-processed data.</h2><span id='topic+loadData'></span>

<h3>Description</h3>

<p>Loads previously saved pre-processed data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>loadData(bin.file, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="loadData_+3A_bin.file">bin.file</code></td>
<td>
<p>File location.</p>
</td></tr>
<tr><td><code id="loadData_+3A_...">...</code></td>
<td>
<p><code><a href="base.html#topic+readRDS">readRDS</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Convenience function.
</p>


<h3>Value</h3>

<p>Limit order, trade and depth data structure <code><a href="#topic+lob.data">lob.data</a></code>.
</p>


<h3>Author(s)</h3>

<p>phil
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

lob.data &lt;- loadData(bin.file="/tmp/lob.data.rds")

## End(Not run)
</code></pre>

<hr>
<h2 id='loadEventData'>Read raw limit order event data from a CSV file.</h2><span id='topic+loadEventData'></span>

<h3>Description</h3>

<p>The function performs some data sanitisation: removing duplicate events
and ensuring that order events are in the appropriate order. The data are
ordered according to the life-cycle of a limit order:
order id, volume (desc), action (created,changed,deleted)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>loadEventData(file)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="loadEventData_+3A_file">file</code></td>
<td>
<p>Location of CSV file containing limit order events.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In addition to returning the sanitised raw data, the function also
appends a column &quot;fill.deltas&quot; representing the change in volume for each
limit order event.
</p>


<h3>Value</h3>

<p>A data.frame containing the raw limit order events data.
</p>


<h3>Author(s)</h3>

<p>phil
</p>

<hr>
<h2 id='lob.data'>Example limit order book data.</h2><span id='topic+lob.data'></span>

<h3>Description</h3>

<p>50,393 limit order events. 482 trades.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(lob.data)
</code></pre>


<h3>Format</h3>

<p>A list containing 4 data frames as returned by
<code><a href="#topic+processData">processData</a></code></p>


<h3>Details</h3>

<p>5 hours of limit order book event data obtained from the Bitstamp (bitcoin)
exchange on 2015-05-01 (midnight until 5am). The data has been preprocessed
with the <code><a href="#topic+processData">processData</a></code> function.
</p>


<h3>Author(s)</h3>

<p>phil
</p>


<h3>Source</h3>

<p><a href="https://www.bitstamp.net/websocket">https://www.bitstamp.net/websocket</a>
</p>


<h3>References</h3>

<p><a href="https://github.com/phil8192/ticker">https://github.com/phil8192/ticker</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+events">events</a></code>,
<code><a href="#topic+trades">trades</a></code>,
<code><a href="#topic+depth">depth</a></code>,
<code><a href="#topic+depth.summary">depth.summary</a></code>
</p>

<hr>
<h2 id='matchTrades'>Construct trades data.table.</h2><span id='topic+matchTrades'></span>

<h3>Description</h3>

<p>Given event data which has been pre-matched with maker/taker event ids,
this function will return a data.table containing all matched executions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>matchTrades(events)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="matchTrades_+3A_events">events</code></td>
<td>
<p>Limit order event data with assigned maker/taker event ids.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame describing marketable order executions of the following
form:
</p>

<dl>
<dt>timestamp</dt><dd><p>min(maker timestamp, taker timestamp) (first time we
learned of this trade)</p>
</dd>
<dt>price</dt><dd><p>Maker price (taker limit price can cross the book.)</p>
</dd>
<dt>volume</dt><dd><p>Lifted/traded volume</p>
</dd>
<dt>direction</dt><dd><p>Trade direction (side of the aggressor/taker)</p>
</dd>
<dt>maker.event.id</dt><dd><p>event.id corresponding to row in events data</p>
</dd>
<dt>taker.event.id</dt><dd><p>event.id corresponding to tow in events data</p>
</dd>
<dt>maker</dt><dd><p>Maker limit order id</p>
</dd>
<dt>taker</dt><dd><p>Taker limit order id</p>
</dd>
</dl>

<p>A market limit order (marketable) is first a taker and then becomes a maker
after landing in the order book before it's limit is reached.
</p>
<p>A market order is always a taker: it's volume will be filled before it's
limit is reached.
</p>
<p>Grouping executions by maker/taker can be used to analyse market impact
events.
</p>


<h3>Author(s)</h3>

<p>phil
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

csv.file &lt;- system.file("extdata", "orders.csv.xz", package="obAnalytics")
events &lt;- loadEventData(csv.file)
events &lt;- eventMatch(events)
trades &lt;- matchTrades(events)

## End(Not run)
</code></pre>

<hr>
<h2 id='orderAggressiveness'>Calculate order aggressiveness with respect to best bid or ask in BPS.</h2><span id='topic+orderAggressiveness'></span>

<h3>Description</h3>

<p>Added or deleted limit orders can be assigned a level of &quot;aggressiveness&quot;
with respect to the current best bid (ask) immediately before the order is
added or removed from the order book. Orders placed at the best bid (ask)
are assigned an aggressiveness of 0 BPS, a negative BPS below the best bid
(ask) and a positive BPS if placed inside the spread.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>orderAggressiveness(events, depth.summary)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="orderAggressiveness_+3A_events">events</code></td>
<td>
<p>The events data.frame.</p>
</td></tr>
<tr><td><code id="orderAggressiveness_+3A_depth.summary">depth.summary</code></td>
<td>
<p>Order book summary statistics.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The events data.frame containing a new aggressiveness.bps column.
</p>


<h3>Author(s)</h3>

<p>phil
</p>

<hr>
<h2 id='orderBook'>Instantaneous limit order book reconstruction.</h2><span id='topic+orderBook'></span>

<h3>Description</h3>

<p>Given a set of <code><a href="#topic+events">events</a></code>, reconstructs a limit order book for a
specific point in time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>orderBook(events, tp = as.POSIXlt(Sys.time(), tz = "UTC"),
  max.levels = NULL, bps.range = 0, min.bid = 0, max.ask = Inf)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="orderBook_+3A_events">events</code></td>
<td>
<p>Limit order <code><a href="#topic+events">events</a></code> data.frame.</p>
</td></tr>
<tr><td><code id="orderBook_+3A_tp">tp</code></td>
<td>
<p>Time point to re-construct order book at.</p>
</td></tr>
<tr><td><code id="orderBook_+3A_max.levels">max.levels</code></td>
<td>
<p>Max number of price levels to return.</p>
</td></tr>
<tr><td><code id="orderBook_+3A_bps.range">bps.range</code></td>
<td>
<p>Max depth to return +- BPS from best bid/ask.</p>
</td></tr>
<tr><td><code id="orderBook_+3A_min.bid">min.bid</code></td>
<td>
<p>Min bid to return.</p>
</td></tr>
<tr><td><code id="orderBook_+3A_max.ask">max.ask</code></td>
<td>
<p>Max ask to return.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>An order book consists of 2 sides: <em>bids</em> and <em>asks</em>, an example of
which is shown below:
</p>

<table>
<tr>
 <td style="text-align: right;">
      id </td><td style="text-align: right;">  price </td><td style="text-align: right;">     volume </td><td style="text-align: right;">  liquidity </td><td style="text-align: right;">  bps </td>
</tr>
<tr>
 <td style="text-align: right;">
65613703 </td><td style="text-align: right;"> 236.58 </td><td style="text-align: right;">  910229141 </td><td style="text-align: right;"> 6341547077 </td><td style="text-align: right;"> 2.11 </td>
</tr>
<tr>
 <td style="text-align: right;">
65613655 </td><td style="text-align: right;"> 236.56 </td><td style="text-align: right;"> 1320000000 </td><td style="text-align: right;"> 5431317936 </td><td style="text-align: right;"> 1.26 </td>
</tr>
<tr>
 <td style="text-align: right;">
65613700 </td><td style="text-align: right;"> 236.55 </td><td style="text-align: right;"> 1320000000 </td><td style="text-align: right;"> 4111317936 </td><td style="text-align: right;"> 0.84 </td>
</tr>
<tr>
 <td style="text-align: right;">
65613698 </td><td style="text-align: right;"> 236.54 </td><td style="text-align: right;"> 1600000000 </td><td style="text-align: right;"> 2791317936 </td><td style="text-align: right;"> 0.42 </td>
</tr>
<tr>
 <td style="text-align: right;">
65613712 </td><td style="text-align: right;"> 236.53 </td><td style="text-align: right;"> 1191317936 </td><td style="text-align: right;"> 1191317936 </td><td style="text-align: right;"> 0.00 </td>
</tr>
<tr>
 <td style="text-align: right;">
       - </td><td style="text-align: right;">      - </td><td style="text-align: right;">          - </td><td style="text-align: right;">          - </td><td style="text-align: right;">    - </td>
</tr>
<tr>
 <td style="text-align: right;">
65613225 </td><td style="text-align: right;"> 236.36 </td><td style="text-align: right;">   16154172 </td><td style="text-align: right;">   16154172 </td><td style="text-align: right;"> 0.00 </td>
</tr>
<tr>
 <td style="text-align: right;">
65613681 </td><td style="text-align: right;"> 236.31 </td><td style="text-align: right;">  200000000 </td><td style="text-align: right;">  216154172 </td><td style="text-align: right;"> 2.11 </td>
</tr>
<tr>
 <td style="text-align: right;">
65613220 </td><td style="text-align: right;"> 236.30 </td><td style="text-align: right;">  100000000 </td><td style="text-align: right;">  316154172 </td><td style="text-align: right;"> 2.53 </td>
</tr>
<tr>
 <td style="text-align: right;">
65612978 </td><td style="text-align: right;"> 236.28 </td><td style="text-align: right;">  100000000 </td><td style="text-align: right;">  416154172 </td><td style="text-align: right;"> 3.38 </td>
</tr>
<tr>
 <td style="text-align: right;">
65612388 </td><td style="text-align: right;"> 236.17 </td><td style="text-align: right;">  100000000 </td><td style="text-align: right;">  516154172 </td><td style="text-align: right;"> 8.03</td>
</tr>

</table>



<h3>Value</h3>

<p>Limit Order Book structure. A list containing 3 fields:
</p>

<dl>
<dt>timestamp</dt><dd><p>Timestamp the order book was reconstructed for.</p>
</dd>
<dt>asks</dt><dd><p>A data.frame containing the Ask side of the order book.</p>
</dd>
<dt>bids</dt><dd><p>A data.frame containing the Bid side of the order book.</p>
</dd>
</dl>

<p>The <em>bids</em> and <em>asks</em> data consists of the following:
</p>

<dl>
<dt>id</dt><dd><p>Limit order Id.</p>
</dd>
<dt>timestamp</dt><dd><p>Last modification time to limit order.</p>
</dd>
<dt>exchange.timestamp</dt><dd><p>Time at which order was placed in order book.</p>
</dd>
<dt>price</dt><dd><p>Limit order price.</p>
</dd>
<dt>volume</dt><dd><p>Limit orer volume.</p>
</dd>
<dt>liquidity</dt><dd><p>Cumulative sum of volume from best bid/ask up until price.</p>
</dd>
<dt>bps</dt><dd><p>Distance (in BPS) of order from best bid/ask.</p>
</dd>
</dl>

<p>Both the <em>bids</em> and <em>asks</em> data are ordered by descending price.
</p>


<h3>Author(s)</h3>

<p>phil
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
tp &lt;- as.POSIXct("2015-05-01 04:25:15.342", tz="UTC")
orderBook(lob.data$events, max.levels=5)

</code></pre>

<hr>
<h2 id='plotCurrentDepth'>Visualise order book depth at any given point in time.</h2><span id='topic+plotCurrentDepth'></span>

<h3>Description</h3>

<p>Plots the cumalative volume on each side of the limit order book.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotCurrentDepth(order.book, volume.scale = 1, show.quantiles = T,
  show.volume = T)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotCurrentDepth_+3A_order.book">order.book</code></td>
<td>
<p>A limit <code><a href="#topic+orderBook">orderBook</a></code> structure.</p>
</td></tr>
<tr><td><code id="plotCurrentDepth_+3A_volume.scale">volume.scale</code></td>
<td>
<p>Volume scale factor.</p>
</td></tr>
<tr><td><code id="plotCurrentDepth_+3A_show.quantiles">show.quantiles</code></td>
<td>
<p>If true, highlight top 1% highest volume.</p>
</td></tr>
<tr><td><code id="plotCurrentDepth_+3A_show.volume">show.volume</code></td>
<td>
<p>If true, also show non-cumulative volume.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>phil
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# get a limit order book for a specific point in time, limited to +- 150bps
# above/below best bid/ask price.
lob &lt;- orderBook(lob.data$events,
    tp=as.POSIXct("2015-05-01 04:38:17.429", tz="UTC"), bps.range=150)

# visualise the order book liquidity.
plotCurrentDepth(lob, volume.scale=10^-8)

</code></pre>

<hr>
<h2 id='plotEventMap'>Plot limit order event map.</h2><span id='topic+plotEventMap'></span>

<h3>Description</h3>

<p>Generates a visualisation of limit order events (excluding market and market
limit orders).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotEventMap(events, start.time = min(events$timestamp),
  end.time = max(events$timestamp), price.from = NULL, price.to = NULL,
  volume.from = NULL, volume.to = NULL, volume.scale = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotEventMap_+3A_events">events</code></td>
<td>
<p>Limit order <code><a href="#topic+events">events</a></code> data.frame.</p>
</td></tr>
<tr><td><code id="plotEventMap_+3A_start.time">start.time</code></td>
<td>
<p>Plot events from this time onward.</p>
</td></tr>
<tr><td><code id="plotEventMap_+3A_end.time">end.time</code></td>
<td>
<p>Plot events up until this time.</p>
</td></tr>
<tr><td><code id="plotEventMap_+3A_price.from">price.from</code></td>
<td>
<p>Plot events with price levels &gt;= this value.</p>
</td></tr>
<tr><td><code id="plotEventMap_+3A_price.to">price.to</code></td>
<td>
<p>Plot events with price levels &lt;= this value.</p>
</td></tr>
<tr><td><code id="plotEventMap_+3A_volume.from">volume.from</code></td>
<td>
<p>Plot events with volume &gt;= this value relevant to
volume.scale</p>
</td></tr>
<tr><td><code id="plotEventMap_+3A_volume.to">volume.to</code></td>
<td>
<p>Plot events with volume &lt;= this value relevant to
volume scale.</p>
</td></tr>
<tr><td><code id="plotEventMap_+3A_volume.scale">volume.scale</code></td>
<td>
<p>Volume scale factor.</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li><p> Ask side orders = red.
</p>
</li>
<li><p> Bid side orders = blue.
</p>
</li>
<li><p> Volume of order determines size of circle.
</p>
</li>
<li><p> Opaque = volume was added.
</p>
</li>
<li><p> Transparent = volume was removed.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>phil
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 

# plot all orders 
with(lob.data, plotEventMap(events))

## End(Not run)

# 1 hour of activity and re-scale the volume
with(lob.data, plotEventMap(events,
    start.time=as.POSIXct("2015-05-01 03:30:00.000", tz="UTC"),
    end.time=as.POSIXct("2015-05-01 04:00:00.000", tz="UTC"),
    volume.scale=10^-8))

# 15 minutes of activity &gt;= 5 (re-scaled) volume within price range
# $ [220, 245]
with(lob.data, plotEventMap(events,
    start.time=as.POSIXct("2015-05-01 03:30:00.000", tz="UTC"),
    end.time=as.POSIXct("2015-05-01 03:45:00.000", tz="UTC"),
    price.from=220,
    price.to=245,
    volume.from=5,
    volume.scale=10^-8))

</code></pre>

<hr>
<h2 id='plotEventsHistogram'>Plot a histogram given event data.</h2><span id='topic+plotEventsHistogram'></span>

<h3>Description</h3>

<p>Convenience function for plotting event price and volume histograms.
Will plot ask/bid bars side by side.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotEventsHistogram(events, start.time = min(events$timestamp),
  end.time = max(events$timestamp), val = "volume", bw = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotEventsHistogram_+3A_events">events</code></td>
<td>
<p>Limit order <code><a href="#topic+events">events</a></code> data.</p>
</td></tr>
<tr><td><code id="plotEventsHistogram_+3A_start.time">start.time</code></td>
<td>
<p>Include event data &gt;= this time.</p>
</td></tr>
<tr><td><code id="plotEventsHistogram_+3A_end.time">end.time</code></td>
<td>
<p>Include event data &lt;= this time.</p>
</td></tr>
<tr><td><code id="plotEventsHistogram_+3A_val">val</code></td>
<td>
<p>&quot;volume&quot; or &quot;price&quot;.</p>
</td></tr>
<tr><td><code id="plotEventsHistogram_+3A_bw">bw</code></td>
<td>
<p>Bar width (for price, 0.5 = 50 cent buckets.)</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>phil
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# necessary columns from event data.
events &lt;- lob.data$events[, c("timestamp", "direction", "price", "volume")]

# re-scale volume (if needed)
events$volume &lt;- events$volume * 10^-8

# histogram of all volume aggregated into 5 unit buckets.
plotEventsHistogram(events[events$volume &lt; 50, ], val="volume", bw=5)

# histogram of 99% of limit prices during a 1 hour time frame.
# bar width set to 0.25: counts are aggregated into 25 cent buckets. 
plotEventsHistogram(events[events$price &lt;= quantile(events$price, 0.99)
                    &amp; events$price &gt;= quantile(events$price, 0.01), ],
    start.time=as.POSIXct("2015-05-01 02:15:00.000", tz="UTC"),
    end.time=as.POSIXct("2015-05-01 03:15:00.000", tz="UTC"),
    val="price", bw=0.25)

</code></pre>

<hr>
<h2 id='plotPriceLevels'>Plot order book price level heat map.</h2><span id='topic+plotPriceLevels'></span>

<h3>Description</h3>

<p>Produces a visualisation of the limit order book depth through time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotPriceLevels(depth, spread = NULL, trades = NULL, show.mp = T,
  show.all.depth = F, col.bias = 0.1, start.time = head(depth$timestamp,
  1), end.time = tail(depth$timestamp, 1), price.from = NULL,
  price.to = NULL, volume.from = NULL, volume.to = NULL,
  volume.scale = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotPriceLevels_+3A_depth">depth</code></td>
<td>
<p>The order book <code><a href="#topic+depth">depth</a></code>.</p>
</td></tr>
<tr><td><code id="plotPriceLevels_+3A_spread">spread</code></td>
<td>
<p>Spread to overlay obtained from <code><a href="#topic+getSpread">getSpread</a></code>.</p>
</td></tr>
<tr><td><code id="plotPriceLevels_+3A_trades">trades</code></td>
<td>
<p><code><a href="#topic+trades">trades</a></code> data.</p>
</td></tr>
<tr><td><code id="plotPriceLevels_+3A_show.mp">show.mp</code></td>
<td>
<p>If True, spread will be summarised as midprice.</p>
</td></tr>
<tr><td><code id="plotPriceLevels_+3A_show.all.depth">show.all.depth</code></td>
<td>
<p>If True, show resting (and never hit) limit orders.</p>
</td></tr>
<tr><td><code id="plotPriceLevels_+3A_col.bias">col.bias</code></td>
<td>
<p>1 = uniform colour spectrum. 0.25 = bias toward 0.25
(more red less blue). &lt;= 0 enables logarithmic scaling.</p>
</td></tr>
<tr><td><code id="plotPriceLevels_+3A_start.time">start.time</code></td>
<td>
<p>Plot depth from this time onward.</p>
</td></tr>
<tr><td><code id="plotPriceLevels_+3A_end.time">end.time</code></td>
<td>
<p>Plot depth up until this time.</p>
</td></tr>
<tr><td><code id="plotPriceLevels_+3A_price.from">price.from</code></td>
<td>
<p>Plot depth with price levels &gt;= this value.</p>
</td></tr>
<tr><td><code id="plotPriceLevels_+3A_price.to">price.to</code></td>
<td>
<p>Plot depth with price levels &lt;= this value.</p>
</td></tr>
<tr><td><code id="plotPriceLevels_+3A_volume.from">volume.from</code></td>
<td>
<p>Plot depth with volume &gt;= this value relevant to
volume.scale</p>
</td></tr>
<tr><td><code id="plotPriceLevels_+3A_volume.to">volume.to</code></td>
<td>
<p>Plot depth with volume &lt;= this value relevant to
volume scale.</p>
</td></tr>
<tr><td><code id="plotPriceLevels_+3A_volume.scale">volume.scale</code></td>
<td>
<p>Volume scale factor.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The available volume at each price level is colour coded according to the
range of volume at all price levels. The colour coding follows the visible
spectrum, such that larger amounts of volume appear &quot;hotter&quot; than smaller
amounts, where cold = blue, hot = red.
</p>
<p>Since the distribution of limit order size exponentially decays, it can be
difficult to visually differentiate: most values will appear to be blue. The
function provides price, volume and a colour bias range to overcome this.
</p>


<h3>Author(s)</h3>

<p>phil
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# bid/ask spread.
spread &lt;- with(lob.data, getSpread(depth.summary))

## Not run: 

# plot all depth levels, rescaling the volume by 10^-8.
# produce 2 plots side-by-side: second plot contains depth levels with &gt; 50
# units of volume.
p1 &lt;- with(lob.data, plotPriceLevels(depth, spread,
                                       col.bias=0.1,
                                       volume.scale=10^-8))
p2 &lt;- with(lob.data, plotPriceLevels(depth, spread,
                                       col.bias=0.1,
                                       volume.scale=10^-8,
                                       volume.from=50))
library(grid)
pushViewport(viewport(layout=grid.layout(1, 2)))
print(p1, vp=viewport(layout.pos.row=1, layout.pos.col=1))
print(p2, vp=viewport(layout.pos.row=1, layout.pos.col=2))

## End(Not run)

# zoom into 1 hour of activity, show the spread and directional trades. 
with(lob.data, plotPriceLevels(depth, spread, trades,
   start.time=as.POSIXct("2015-05-01 03:25:00.000", tz="UTC"),
   end.time=as.POSIXct("2015-05-01 04:25:00.000", tz="UTC"),
   volume.scale=10^-8))

# zoom in to 15 minutes of activity, show the bid/ask midprice.
with(lob.data, plotPriceLevels(depth, spread,
   show.mp=FALSE,
   start.time=as.POSIXct("2015-05-01 03:30:00.000", tz="UTC"),
   end.time=as.POSIXct("2015-05-01 03:45:00.000", tz="UTC")))

</code></pre>

<hr>
<h2 id='plotPriceLevelsFaster'>Poor man's heatmap.</h2><span id='topic+plotPriceLevelsFaster'></span>

<h3>Description</h3>

<p>Used by plotPriceLevels filtering function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotPriceLevelsFaster(depth, spread, trades, show.mp = T, col.bias = 0.1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotPriceLevelsFaster_+3A_depth">depth</code></td>
<td>
<p>The order book depth (lob.data$depth).</p>
</td></tr>
<tr><td><code id="plotPriceLevelsFaster_+3A_spread">spread</code></td>
<td>
<p>Spread to overlay (getSpread(lob.data$depth.summary))</p>
</td></tr>
<tr><td><code id="plotPriceLevelsFaster_+3A_trades">trades</code></td>
<td>
<p>Trades (lob.data$trades).</p>
</td></tr>
<tr><td><code id="plotPriceLevelsFaster_+3A_show.mp">show.mp</code></td>
<td>
<p>If True, spread will be summarised as midprice.</p>
</td></tr>
<tr><td><code id="plotPriceLevelsFaster_+3A_col.bias">col.bias</code></td>
<td>
<p>1 = uniform colour spectrum. 0.25 = bias toward 0.25
(more red less blue). &lt;= 0 enables logarithmic scaling.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>An individual order book will consist of hundreds of thousands to millions
of updates per day. Plotting a heatmap of order book depth with even a few
thousand filtered events with ggplot is excruciatingly slow. This function
makes it possible to plot a heat map of all order book updates in a
reasonable amount of time. To achieve this, the function plots horizontal
colour coded lines for each price level update.
</p>


<h3>Author(s)</h3>

<p>phil
</p>

<hr>
<h2 id='plotTimeSeries'>General purpose time series plot.</h2><span id='topic+plotTimeSeries'></span>

<h3>Description</h3>

<p>Convenience function for plotting time series.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotTimeSeries(timestamp, series, start.time = min(timestamp),
  end.time = max(timestamp), title = "time series", y.label = "series")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotTimeSeries_+3A_timestamp">timestamp</code></td>
<td>
<p>POSIXct timestamps.</p>
</td></tr>
<tr><td><code id="plotTimeSeries_+3A_series">series</code></td>
<td>
<p>The time series.</p>
</td></tr>
<tr><td><code id="plotTimeSeries_+3A_start.time">start.time</code></td>
<td>
<p>Plot from this time onward.</p>
</td></tr>
<tr><td><code id="plotTimeSeries_+3A_end.time">end.time</code></td>
<td>
<p>Plot up until this time.</p>
</td></tr>
<tr><td><code id="plotTimeSeries_+3A_title">title</code></td>
<td>
<p>Plot title.</p>
</td></tr>
<tr><td><code id="plotTimeSeries_+3A_y.label">y.label</code></td>
<td>
<p>Y axis label of the plot.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>phil
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# plot trades.
with(lob.data$trades, plotTimeSeries(timestamp, price))

# plot a general time series.
timestamp &lt;- seq(as.POSIXct("2015-05-01 00:00:00.000", tz="UTC"), 
                 as.POSIXct("2015-05-01 00:59:00.000", tz="UTC"), by=60)
series &lt;- rep(1:10, 6)
plotTimeSeries(timestamp, series)

</code></pre>

<hr>
<h2 id='plotTrades'>plotTrades.</h2><span id='topic+plotTrades'></span>

<h3>Description</h3>

<p>A convenience function for plotting the trades data.frame in a nice way.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotTrades(trades, start.time = min(trades$timestamp),
  end.time = max(trades$timestamp))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotTrades_+3A_trades">trades</code></td>
<td>
<p><code><a href="#topic+trades">trades</a></code> data.</p>
</td></tr>
<tr><td><code id="plotTrades_+3A_start.time">start.time</code></td>
<td>
<p>Plot from.</p>
</td></tr>
<tr><td><code id="plotTrades_+3A_end.time">end.time</code></td>
<td>
<p>Plot to.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>phil
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
with(lob.data, plotTrades(trades))

</code></pre>

<hr>
<h2 id='plotVolumeMap'>Visualise flashed-limit order volume.</h2><span id='topic+plotVolumeMap'></span>

<h3>Description</h3>

<p>Plots the points at which volume was added or removed from the limit order
book.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotVolumeMap(events, action = "deleted", type = c("flashed-limit"),
  start.time = min(events$timestamp), end.time = max(events$timestamp),
  price.from = NULL, price.to = NULL, volume.from = NULL,
  volume.to = NULL, volume.scale = 1, log.scale = F)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotVolumeMap_+3A_events">events</code></td>
<td>
<p>Limit order <code><a href="#topic+events">events</a></code> data.frame.</p>
</td></tr>
<tr><td><code id="plotVolumeMap_+3A_action">action</code></td>
<td>
<p>&quot;deleted&quot; for cancelled volume, &quot;added&quot; for added volume.</p>
</td></tr>
<tr><td><code id="plotVolumeMap_+3A_type">type</code></td>
<td>
<p>default = c(&quot;flashed-limit&quot;). Set of types.</p>
</td></tr>
<tr><td><code id="plotVolumeMap_+3A_start.time">start.time</code></td>
<td>
<p>Plot events from this time onward.</p>
</td></tr>
<tr><td><code id="plotVolumeMap_+3A_end.time">end.time</code></td>
<td>
<p>Plot events up until this time.</p>
</td></tr>
<tr><td><code id="plotVolumeMap_+3A_price.from">price.from</code></td>
<td>
<p>Plot events with price levels &gt;= this value.</p>
</td></tr>
<tr><td><code id="plotVolumeMap_+3A_price.to">price.to</code></td>
<td>
<p>Plot events with price levels &lt;= this value.</p>
</td></tr>
<tr><td><code id="plotVolumeMap_+3A_volume.from">volume.from</code></td>
<td>
<p>Plot events with volume &gt;= this value relevant to
volume.scale</p>
</td></tr>
<tr><td><code id="plotVolumeMap_+3A_volume.to">volume.to</code></td>
<td>
<p>Plot events with volume &lt;= this value relevant to
volume scale.</p>
</td></tr>
<tr><td><code id="plotVolumeMap_+3A_volume.scale">volume.scale</code></td>
<td>
<p>Volume scale factor.</p>
</td></tr>
<tr><td><code id="plotVolumeMap_+3A_log.scale">log.scale</code></td>
<td>
<p>If true, plot volume on logarithmic scale.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A flashed limit-order is a &quot;fleeting&quot; limit order: an order was added,
then removed (usually within a very short period of time). This plot is
especially useful for identifying individual trading algorithms by price and
volume.
</p>


<h3>Author(s)</h3>

<p>phil
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# plot all fleeting limit order volume using logarithmic scale.
with(lob.data, plotVolumeMap(events, volume.scale=10^-8, log.scale=TRUE))

# "fleeting" order volume within 1 hour range up until 10 units of volume.
with(lob.data, plotVolumeMap(events, volume.scale=10^-8,
    start.time=as.POSIXct("2015-05-01 02:30:00.000", tz="UTC"),
    end.time=as.POSIXct("2015-05-01 03:30:00.000", tz="UTC"),
    volume.to=10))

</code></pre>

<hr>
<h2 id='plotVolumePercentiles'>Visualise available limit order book liquidity through time.</h2><span id='topic+plotVolumePercentiles'></span>

<h3>Description</h3>

<p>Plots the available volume in 25bps increments on each side of the order
book in the form of a stacked area graph.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotVolumePercentiles(depth.summary,
  start.time = head(depth.summary$timestamp, 1),
  end.time = tail(depth.summary$timestamp, 1), volume.scale = 1,
  perc.line = T, side.line = T)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotVolumePercentiles_+3A_depth.summary">depth.summary</code></td>
<td>
<p><code><a href="#topic+depth.summary">depth.summary</a></code> data.</p>
</td></tr>
<tr><td><code id="plotVolumePercentiles_+3A_start.time">start.time</code></td>
<td>
<p>Plot events from this time onward.</p>
</td></tr>
<tr><td><code id="plotVolumePercentiles_+3A_end.time">end.time</code></td>
<td>
<p>Plot events up until this time.</p>
</td></tr>
<tr><td><code id="plotVolumePercentiles_+3A_volume.scale">volume.scale</code></td>
<td>
<p>Volume scale factor.</p>
</td></tr>
<tr><td><code id="plotVolumePercentiles_+3A_perc.line">perc.line</code></td>
<td>
<p>If true, separate percentiles with subtle line.</p>
</td></tr>
<tr><td><code id="plotVolumePercentiles_+3A_side.line">side.line</code></td>
<td>
<p>If true, separate bid/ask side with subtle line.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The top of the graph depicts the ask side of the book, whilst the bottom
depicts the bid side. Percentiles and order book sides can be separated by an
optional subtle line for improved legibility.
</p>


<h3>Author(s)</h3>

<p>phil
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# visualise 2 hours of order book liquidity.
# data will be aggregated to minute-by-minute resolution.
plotVolumePercentiles(lob.data$depth.summary,
    start.time=as.POSIXct("2015-05-01 02:30:00.000", tz="UTC"),
    end.time=as.POSIXct("2015-05-01 04:30:00.000", tz="UTC"),
    volume.scale=10^-8)

## Not run: 

# visualise 15 minutes of order book liquidity.
# data will be aggregated to second-by-second resolution.
plotVolumePercentiles(lob.data$depth.summary,
    start.time=as.POSIXct("2015-05-01 04:30:00.000", tz="UTC"),
    end.time=as.POSIXct("2015-05-01 04:35:00.000", tz="UTC"),
    volume.scale=10^-8)

## End(Not run)
</code></pre>

<hr>
<h2 id='priceLevelVolume'>Calculate priceLevelVolume (depth).</h2><span id='topic+priceLevelVolume'></span>

<h3>Description</h3>

<p>Given a data.frame of limit order events, this function will calculate
the cumulative volume for each price level over time. Changes in volume
at a price level can occur when an a new order is added to the queue,
updated (partial fill) or deleted (execution or removal). The resulting
time series is of the form:
</p>


<h3>Usage</h3>

<pre><code class='language-R'>priceLevelVolume(events)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="priceLevelVolume_+3A_events">events</code></td>
<td>
<p>Limit order events.</p>
</td></tr>
</table>


<h3>Details</h3>


<dl>
<dt>timestamp</dt><dd><p>local time at which volume changed</p>
</dd>
<dt>price</dt><dd><p>price level at which volume changed</p>
</dd>
<dt>volume</dt><dd><p>amount of volume now remaining at this price level</p>
</dd>
<dt>side</dt><dd><p>the current side of the price level in the order book</p>
</dd>
</dl>



<h3>Value</h3>

<p>Time series of liquidity for each price level in the order book.
</p>


<h3>Author(s)</h3>

<p>phil
</p>

<hr>
<h2 id='processData'>Import CSV file.</h2><span id='topic+processData'></span>

<h3>Description</h3>

<p>Imports and performs preprocessing of limit order data contained in a CSV.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>processData(csv.file)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="processData_+3A_csv.file">csv.file</code></td>
<td>
<p>Location of CSV file to import</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The CSV file is expected to contain 7 columns:
</p>

<dl>
<dt>id</dt><dd><p>Numeric limit order unique identifier</p>
</dd>
<dt>timestamp</dt><dd><p>Time in milliseconds when event received locally</p>
</dd>
<dt>exchange.timestamp</dt><dd><p>Time in milliseconds when order first created on
the exchange</p>
</dd>
<dt>price</dt><dd><p>Price level of order event</p>
</dd>
<dt>volume</dt><dd><p>Remaining order volume</p>
</dd>
<dt>action</dt><dd><p>Event type (see below)</p>
</dd>
<dt>direction</dt><dd><p>Side of order book (bid or ask)</p>
</dd>
</dl>

<p><em>action</em> describes the limit order life-cycle:
</p>

<dl>
<dt>created</dt><dd><p>The limit order has been created</p>
</dd>
<dt>modified</dt><dd><p>The limit order has been modified (partial fill)</p>
</dd>
<dt>deleted</dt><dd><p>The limit order was deleted. If the remaining volume is 0,
the order has been filled.</p>
</dd>
</dl>

<p>An example dataset returned from this function can be seen in
<code><a href="#topic+lob.data">lob.data</a></code> which is the result of processing the example data
included in the <code>inst/extdata</code> directory of this package.
</p>


<h3>Value</h3>

<p>A list containing 4 data frames:
</p>

<dl>
<dt><a href="#topic+events">events</a></dt><dd><p>Limit order events.</p>
</dd>
<dt><a href="#topic+trades">trades</a></dt><dd><p>Inferred trades (executions).</p>
</dd>
<dt><a href="#topic+depth">depth</a></dt><dd><p>Order book price level depth through time.</p>
</dd>
<dt><a href="#topic+depth.summary">depth.summary</a></dt><dd><p>Limit order book summary statistics.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>phil
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

csv.file &lt;- system.file("extdata", "orders.csv.xz", package="obAnalytics")
lob.data &lt;- processData(csv.file)

## End(Not run)
</code></pre>

<hr>
<h2 id='saveData'>Save processed data.</h2><span id='topic+saveData'></span>

<h3>Description</h3>

<p>Saves processed data to file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>saveData(lob.data, bin.file, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="saveData_+3A_lob.data">lob.data</code></td>
<td>
<p><code><a href="#topic+lob.data">lob.data</a></code> data structure.</p>
</td></tr>
<tr><td><code id="saveData_+3A_bin.file">bin.file</code></td>
<td>
<p>File to save to.</p>
</td></tr>
<tr><td><code id="saveData_+3A_...">...</code></td>
<td>
<p><code><a href="base.html#topic+saveRDS">saveRDS</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Convenience function.
</p>


<h3>Author(s)</h3>

<p>phil
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

saveData(lob.data, bin.file="/tmp/lob.data.rds", compress="xz")

## End(Not run)
</code></pre>

<hr>
<h2 id='setOrderTypes'>Determine limit order types.</h2><span id='topic+setOrderTypes'></span>

<h3>Description</h3>

<p>This function infers order type given trade and order event data.
The following categories are assigned to the event data type field:
</p>

<dl>
<dt>unknown</dt><dd><p>It was not possible to determine the order type</p>
</dd>
<dt>flashed-limit</dt><dd><p>An order which was created and at some future
time deleted without ever being hit</p>
</dd>
<dt>resting-limit</dt><dd><p>The order was added and left to rest in the
order book. it may or may not be hit later</p>
</dd>
<dt>market-limit</dt><dd><p>This is a limit order that crosses the book,
it's volume is filled until it's limit price is reached, at which
point the order comes to land in the book</p>
</dd>
<dt>pacman</dt><dd><p>This is a special type of (algorithmic) order executed
by the exchange (the order &quot;eats&quot; the best bid or ask at intervals
until filled.</p>
</dd>
<dt>market</dt><dd><p>This is an order that crosses the book, it's volume
is filled before it's limit price is reached (order never comes to
land in the book.) A market order is the most aggressive order type.</p>
</dd>
</dl>



<h3>Usage</h3>

<pre><code class='language-R'>setOrderTypes(events, trades)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="setOrderTypes_+3A_events">events</code></td>
<td>
<p>Limit order event data.</p>
</td></tr>
<tr><td><code id="setOrderTypes_+3A_trades">trades</code></td>
<td>
<p>Execution data.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The limit order event data with updated type field.
</p>


<h3>Author(s)</h3>

<p>phil
</p>

<hr>
<h2 id='sMatrix'>Similarity matrix.</h2><span id='topic+sMatrix'></span>

<h3>Description</h3>

<p>Construct a similarity matrix between 2 vectors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sMatrix(a, b, filter = function(f1, f2) ifelse(f1 == f2, 1, -1))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sMatrix_+3A_a">a</code></td>
<td>
<p>Vector a.</p>
</td></tr>
<tr><td><code id="sMatrix_+3A_b">b</code></td>
<td>
<p>Vector b.</p>
</td></tr>
<tr><td><code id="sMatrix_+3A_filter">filter</code></td>
<td>
<p>A similarity function. Default: 1 if equal, -1 otherwise.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A similarity matrix.
</p>


<h3>Author(s)</h3>

<p>phil
</p>

<hr>
<h2 id='themeBlack'>Black theme.</h2><span id='topic+themeBlack'></span>

<h3>Description</h3>

<p>Default graph look and feel.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>themeBlack()
</code></pre>


<h3>Value</h3>

<p>Theme.
</p>


<h3>Author(s)</h3>

<p>phil
</p>

<hr>
<h2 id='tradeImpacts'>Trade impacts.</h2><span id='topic+tradeImpacts'></span>

<h3>Description</h3>

<p>Generates a data.frame containing order book impacts.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tradeImpacts(trades)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tradeImpacts_+3A_trades">trades</code></td>
<td>
<p><code><a href="#topic+trades">trades</a></code> data.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>An impact consists of 1 or more limit orders being hit in order to fulfil a
market order.
</p>


<h3>Value</h3>

<p>A data.frame containing a summary of market order impacts:
</p>

<dl>
<dt>id</dt><dd><p>market order id</p>
</dd>
<dt>min.price</dt><dd><p>minimum executed price</p>
</dd>
<dt>max.price</dt><dd><p>maximum executed price</p>
</dd>
<dt>vwap</dt><dd><p>VWAP obtained by market order</p>
</dd>
<dt>hits</dt><dd><p>number of limit orders hit by market order</p>
</dd>
<dt>vol</dt><dd><p>total volume removed by this impact</p>
</dd>
<dt>start.time</dt><dd><p>(local) start time of this impact</p>
</dd>
<dt>end.time</dt><dd><p>(local) end time of this impact</p>
</dd>
<dt>dir</dt><dd><p>direction of this impact (buy or sell)</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>phil
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# get impacts data.frame from trades data.
impacts &lt;- tradeImpacts(lob.data$trades)

# impacts (in bps) 
sell.bps &lt;- with(impacts[impacts$dir == "sell", ], {
  (max.price-min.price)/max.price
})
10000*summary(sell.bps[sell.bps &gt; 0])

</code></pre>

<hr>
<h2 id='trades'>Trades.</h2><span id='topic+trades'></span>

<h3>Description</h3>

<p>Inferred trades (executions).
</p>


<h3>Format</h3>

<p>A data.frame consisting of the following fields:
</p>

<dl>
<dt>timestamp</dt><dd><p>Local event timestamp.</p>
</dd>
<dt>price</dt><dd><p>Price at which the trade occured.</p>
</dd>
<dt>volume</dt><dd><p>Amount of traded volume.</p>
</dd>
<dt>direction</dt><dd><p>The trade direction: <em>buy</em> or <em>sell</em>.</p>
</dd>
<dt>maker.event.id</dt><dd><p>Corresponding market <em>making</em> event id in
<code><a href="#topic+events">events</a></code>.</p>
</dd>
<dt>taker.event.id</dt><dd><p>Corresponding market <em>taking</em> event id in
<code><a href="#topic+events">events</a></code>.</p>
</dd>
<dt>maker</dt><dd><p>Id of the market <em>making</em> limit order in
<code><a href="#topic+events">events</a></code>.</p>
</dd>
<dt>taker</dt><dd><p>Id of the market <em>taking</em> limit order in
<code><a href="#topic+events">events</a></code>.</p>
</dd>
</dl>


<h3>Details</h3>

<p>The trades data.frame contains a log of all executions ordered by local
timestamp. In addition to the usual timestamp, price and volume information,
each row also contains the trade direction (buyer or seller initiated) and
maker/taker limit order ids. The maker/taker event and limit order ids can
be used to group trades into market impacts. See:
<code><a href="#topic+tradeImpacts">tradeImpacts</a></code>.
</p>


<h3>Author(s)</h3>

<p>phil
</p>


<h3>See Also</h3>

<p>Other Limit.order.book.data: <code><a href="#topic+depth.summary">depth.summary</a></code>,
<code><a href="#topic+depth">depth</a></code>, <code><a href="#topic+events">events</a></code>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
