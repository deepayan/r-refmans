<!DOCTYPE html><html><head><title>Help for package soilhypfit</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {soilhypfit}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#control_fit_wrc_hcc'><p>Controlling fit_wrc_hcc</p></a></li>
<li><a href='#evaporative-length'><p>Evaporative Characteristic Length</p></a></li>
<li><a href='#fit_wrc_hcc'>
<p>Parametric Modelling of Soil Hydraulic Properties</p></a></li>
<li><a href='#hc_model'>
<p>Models for Soil Hydraulic Conductivity Functions</p></a></li>
<li><a href='#internal_functions'><p>Internal Functions of Package <span class="pkg">soilhypfit</span></p></a></li>
<li><a href='#profile_loglikelihood'>
<p>Profile Loglikelihoods and Confidence Intervals for</p>
Parametric Modelling of Soil Hydraulic Properties</a></li>
<li><a href='#sim_wrc_hcc'>
<p>Simulated Soil Water Retention and Hydraulic Conductivity Data</p></a></li>
<li><a href='#soilhypfit-package'><p>The soilhypfit Package</p></a></li>
<li><a href='#soilhypfitS3methods'><p>Common S3 Methods for Class <code>fit_wrc_hcc</code></p></a></li>
<li><a href='#swissforestsoils'>
<p>Physical properties of Swiss forest soils</p></a></li>
<li><a href='#utility-functions'><p>Utility functions for package soilhypfit</p></a></li>
<li><a href='#vcov'><p><code>vcov</code> Method for Class <code>fit_wrc_hcc</code></p></a></li>
<li><a href='#wc_model'>
<p>Models for Soil Water Retention Curves</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Modelling of Soil Water Retention and Hydraulic Conductivity
Data</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1-7</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-08-29</td>
</tr>
<tr>
<td>Author:</td>
<td>Andreas Papritz [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Andreas Papritz &lt;papritz@retired.ethz.ch&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>graphics, nloptr(&ge; 1.2.1), snowfall, stats, utils</td>
</tr>
<tr>
<td>Imports:</td>
<td>mgcv, quadprog(&ge; 1.5-7), parallel, Rmpfr(&ge; 0.7-2),
SoilHyP(&ge; 0.1.3)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>lattice</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>gmp (&gt;= 4.2.3), mpfr (&gt;= 3.0.0)</td>
</tr>
<tr>
<td>SystemRequirementsNote:</td>
<td>'MPFR' (MP Floating-Point Reliable Library,
http://mpfr.org/) and 'GMP' (GNU Multiple Precision library,
http://gmplib.org/) are required for Rmpfr</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides functions for efficiently estimating properties of the Van Genuchten-Mualem model for soil hydraulic parameters from possibly sparse soil water retention and hydraulic conductivity data by multi-response parameter estimation methods (Stewart, W.E., Caracotsios, M. Soerensen, J.P. (1992) "Parameter estimation from multi-response data" &lt;<a href="https://doi.org/10.1002%2Faic.690380502">doi:10.1002/aic.690380502</a>&gt;). Parameter estimation is simplified by exploiting the fact that residual and saturated water contents and saturated conductivity are conditionally linear parameters (Bates, D. M.  and Watts, D. G. (1988) "Nonlinear Regression Analysis and Its Applications" &lt;<a href="https://doi.org/10.1002%2F9780470316757">doi:10.1002/9780470316757</a>&gt;). Estimated parameters are optionally constrained by the evaporation characteristic length (Lehmann, P., Bickel, S., Wei, Z. and Or, D. (2020) "Physical Constraints for Improved Soil Hydraulic Parameter Estimation by Pedotransfer Functions" &lt;<a href="https://doi.org/10.1029%2F2019WR025963">doi:10.1029/2019WR025963</a>&gt;) to ensure that the estimated parameters are physically valid. Common S3 methods and further utility functions allow to process, explore and visualise estimation results.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> | <a href="https://www.r-project.org/Licenses/LGPL-3">LGPL-3</a> [expanded from: GPL (&ge; 2) | LGPL-3]</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-08-31 10:57:59 UTC; papritz</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-08-31 12:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='control_fit_wrc_hcc'>Controlling fit_wrc_hcc</h2><span id='topic+control_soilhypfit'></span><span id='topic+bwd_transf'></span><span id='topic+control_fit_wrc_hcc'></span><span id='topic+control_nloptr'></span><span id='topic+control_pcmp'></span><span id='topic+control_sce'></span><span id='topic+dfwd_transf'></span><span id='topic+fwd_transf'></span><span id='topic+param_boundf'></span><span id='topic+param_transf'></span>

<h3>Description</h3>

<p>This page documents options to control <code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code>.  It
describes the arguments of the functions <code>control_fit_wrc_hcc</code>,
<code>param_boundf</code>, <code>param_transf</code>, <code>fwd_transf</code>,
<code>dfwd_transf</code>, <code>bwd_transf</code>, <code>control_nloptr</code>,
<code>control_sce</code> and <code>control_pcmp</code>, which all serve to steer
<code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code>.</p>


<h3>Usage</h3>

<pre><code class='language-R'>control_fit_wrc_hcc(
    settings = c("uglobal", "ulocal", "clocal", "cglobal", "sce"),
    method = c("ml", "mpd", "wls"), hessian,
    nloptr = control_nloptr(), sce = control_sce(),
    wrc_model = "vg", hcc_model = "vgm",
    initial_param = c(alpha = 2., n = 1.5, tau = 0.5),
    approximation_alpha_k0 =
        c(c0 = 1, c1 = 5.55, c2 = 1.204, c3 = 2.11, c4 = 1.71),
    variable_weight = c(wrc = 1, hcc = 1),
    gam_k = 6, gam_n_newdata = 101, precBits = 256,
    min_nobs_wc = 5, min_nobs_hc = 5,
    keep_empty_fits = FALSE,
    param_bound = param_boundf(), param_tf = param_transf(),
    fwd_tf = fwd_transf(), deriv_fwd_tfd = dfwd_transf(), bwd_tf = bwd_transf(),
    pcmp = control_pcmp())

param_boundf(alpha = c(0 + 10 * sqrt(.Machine$double.eps), 500),
    n = c(1 + 10 * sqrt(.Machine$double.eps), 20), tau = c(-2, 20),
    thetar = c(0, 1), thetas = c(0, 1), k0 = c(0, Inf))

param_transf(alpha = c("log", "identity"), n = c("log1", "identity"),
    tau = c("logitlu", "identity"), k0 = c("log", "identity"))

fwd_transf(...)

dfwd_transf(...)

bwd_transf(...)

control_nloptr(...)

control_sce(reltol = 1.e-8, maxtime = 20, ...)

control_pcmp(ncores = detectCores() - 1L,
    fork = !identical(.Platform[["OS.type"]], "windows"))

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="control_fit_wrc_hcc_+3A_settings">settings</code></td>
<td>
<p>a keyword with possible values <code>"uglobal"</code>
(default), <code>"ulocal"</code>, <code>"clocal"</code>, <code>"cglobal"</code> or
<code>"sce"</code> to choose the approach for the nonlinear optimisation, see
<em>Details</em> and <code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code>.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_method">method</code></td>
<td>
<p>a keyword with possible values <code>"ml"</code> (maximum
likelihood, default), <code>"mpd"</code> (maximum posterior density) or
<code>"wls"</code> (weighted least squares) to choose the method for estimating
the nonlinear parameters <code class="reqn">\boldsymbol{\nu}^\mathrm{} </code>, see
<code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code>.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_hessian">hessian</code></td>
<td>
<p>a logical scalar controlling whether the Hessian matrix of
the objective function should be computed with respect to the possibly
transformed nonlinear parameters <code class="reqn">\boldsymbol{\nu}^\mathrm{} </code> at the solution
(default: <code>TRUE</code> if <code>settings %in% c("uglobal", "ulocal",
  "sce") &amp;&amp; method %in% c("mpd", "ml")</code> and <code>FALSE</code> otherwise).</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_nloptr">nloptr</code></td>
<td>
<p>a list of arguments passed to the optimiser
<code><a href="nloptr.html#topic+nloptr">nloptr</a></code> by its argument <code>opts</code>, or a function
such as <code>control_nloptr</code> that generates such a list.<br /> Note that
<code>control_fit_wrc_hcc</code> chooses sensible default values for the
various components of the list in dependence of the value chosen for
<code>settings</code>, but these defaults can be overridden by the arguments of
<code>control_nloptr</code>, see <em>Details</em>.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_sce">sce</code></td>
<td>
<p>a list of arguments passed to the optimiser
<code><a href="SoilHyP.html#topic+SCEoptim">SCEoptim</a></code> by its argument <code>control</code>, or a
function such as <code>control_sce</code> that generates such a list.<br /> Note
that <code>control_fit_wrc_hcc</code> chooses sensible default values for the
various components of the list, but these defaults can be overridden by
the arguments of <code>control_sce</code>, see <em>Details</em>.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_wrc_model">wrc_model</code></td>
<td>
<p>a keyword choosing the parametrical model for the
water retention curve.  Currently, only the <em>Van Genuchten</em> model
(<code>"vg"</code>) is implemented, see <code><a href="#topic+wc_model">wc_model</a></code>
and <code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code>.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_hcc_model">hcc_model</code></td>
<td>
<p>a keyword choosing the parametrical model for the
hydraulic conductivity function.  Currently, only the <em>Van
Genuchten-Mualem</em> model (<code>"vgm"</code>) is implemented, see
<code><a href="#topic+hc_model">hc_model</a></code> and <code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code>.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_initial_param">initial_param</code></td>
<td>
<p>a named numeric vector with default initial values
for the <em>nonlinear</em> parameters <code class="reqn">\boldsymbol{\nu}^\mathrm{} </code>
of the models for the water retention curve and/or hydraulic conductivity
function.  Currently, initial values must be defined for the parameters
<code class="reqn">\alpha</code> (default 1.5 [<code class="reqn">\mathrm{m}^{-1}</code>]), <code class="reqn">n</code>
(default 2 [-]) and <code class="reqn">\tau</code> (default 0.5 [-]), hence the elements of
<code>initial_param</code> must be named <code>"alpha"</code>, <code>"n"</code> and
<code>"tau"</code>.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_approximation_alpha_k0">approximation_alpha_k0</code></td>
<td>
<p>a named numeric vector with constants to
approximate the parameter <code class="reqn">\alpha</code> and the saturated hydraulic
conductivity <code class="reqn">K_0</code> when constraining the estimated <em>nonlinear</em>
parameters <code class="reqn">\boldsymbol{\nu}^\mathrm{} </code> of the Van
Genuchten-Mualem model by the <em>characteristic evaporative length</em>
(<cite>Lehmann et al., 2020</cite>), see <code><a href="#topic+evaporative-length">evaporative-length</a></code> and
<code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code>.  For consistency with other quantities,
the following units should be used for the constants:
</p>

<ul>
<li> <p><code>c1</code>: <code class="reqn">\mathrm{m}^{-1}</code>,
</p>
</li>
<li> <p><code>c3</code>: <code class="reqn">\mathrm{m}\,\mathrm{d}^{-1}</code>.
</p>
</li></ul>
<p> The remaining constants are
dimensionless.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_variable_weight">variable_weight</code></td>
<td>
<p>a named numeric vector of length 2 that defines
the weights of water content and hydraulic conductivity measurements in
the objective function for <code>method = "wls"</code>.  If equal to 1
(default) the weights of the variables are equal to the inverse variances
of the water content and (possibly log-transformed) hydraulic
conductivity measurements.  If different from 1, then the inverse
variances are multiplied by <code>variable_weight</code> to get the variable
weights <code class="reqn">w_\theta</code> and <code class="reqn">w_K</code>, see <code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code> and
<code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code>.  Note that for estimation methods mpd and
ml the variable weights are equal to 1 but the case weights
<code class="reqn">w^\prime_{\theta,i}</code> and <code class="reqn">w^\prime_{K,j}</code> may differ from 1.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_gam_k">gam_k</code></td>
<td>
<p>the dimension of the basis of the additive model for
the water retention data when computing initial values of the
parameters <code class="reqn">\alpha</code> and <code class="reqn">n</code>, see <code><a href="mgcv.html#topic+s">s</a></code> and<br />
<code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code>.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_gam_n_newdata">gam_n_newdata</code></td>
<td>
<p>the number of evaluation points of the additive
model for the water retention data when computing initial values of the
parameters <code class="reqn">\alpha</code> and <code class="reqn">n</code>, see <code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code>.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_precbits">precBits</code></td>
<td>
<p>an integer scalar defining the default precision (in
bits) to be used in high-precision computations by
<code><a href="Rmpfr.html#topic+mpfr">mpfr</a></code>, see <em>Details</em>.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_min_nobs_wc">min_nobs_wc</code></td>
<td>
<p>an integer scalar defining the minimum number of
water content measurements per sample required for fitting a model to the
water content data.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_min_nobs_hc">min_nobs_hc</code></td>
<td>
<p>an integer scalar defining the minimum number of
hydraulic conductivity measurements per sample required for fitting a
model to hydraulic conductivity data.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_keep_empty_fits">keep_empty_fits</code></td>
<td>
<p>a logical scalar controlling whether missing
fitting results should be dropped for samples without any data or failed
fits (<code>FALSE</code>, default) or kept (<code>TRUE</code>).</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_param_bound">param_bound</code></td>
<td>
<p>a named list of numeric vectors of length 2 that
define the allowed lower and upper bounds (box constraints) for the
parameters of the models or a function such as <code>param_boundf</code> which
generates this list, see <em>Details</em>.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_param_tf">param_tf</code></td>
<td>
<p>a named vector of keywords that define the
transformations to be applied to the model parameters before estimation
or a function such as <code>param_transf</code>, which generates this vector,
see <em>Details</em>.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_fwd_tf">fwd_tf</code></td>
<td>
<p>a named list of invertible functions to be used to
transform model parameters or a function such as <code>fwd_transf</code>, which
generates this list, see <em>Details</em>.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_deriv_fwd_tfd">deriv_fwd_tfd</code></td>
<td>
<p>a named list of functions corresponding to the first
derivatives of the functions defined in <code>fwd_tf</code> or a function such
as <code>dfwd_transf</code>, which generates this list, see <em>Details</em>.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_bwd_tf">bwd_tf</code></td>
<td>
<p>a named list of inverse functions corresponding the
functions defined in <code>fwd_tf</code> or a function such as <code>bwd_transf</code>,
which generates this list, see <em>Details</em>.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_pcmp">pcmp</code></td>
<td>
<p>a list to control parallel computations or a function such as
<code>control_pcmp</code> that generates this list, see <code>control_pcmp</code> for
allowed arguments.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_alpha">alpha</code></td>
<td>
<p>either a numeric vector of length 2 defining the allowed
lower and upper bounds for the nonlinear parameter <code class="reqn">\alpha</code>
(<code>param_boundf</code>), or a keyword defining the transformation
to be applied to the parameter <code class="reqn">\alpha</code> before estimation
(<code>param_transf</code>), see <em>Details</em>.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_n">n</code></td>
<td>
<p>either a numeric vector of length 2 defining the allowed lower
and upper bounds for the nonlinear parameter <code class="reqn">n</code>
(<code>param_boundf</code>), or a keyword defining the transformation
to be applied to the parameter <code class="reqn">n</code> before estimation
(<code>param_transf</code>), see <em>Details</em>.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_tau">tau</code></td>
<td>
<p>either a numeric vector of length 2 defining the allowed
lower and upper bounds for the nonlinear parameter <code class="reqn">\tau</code>
(<code>param_boundf</code>), or a keyword defining the transformation
to be applied to the parameter <code class="reqn">\tau</code> before estimation
(<code>param_transf</code>), see <em>Details</em>.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_thetar">thetar</code></td>
<td>
<p>a numeric vector of length 2 defining the allowed
lower and upper bounds for the linear parameter <code class="reqn">\theta_r</code>
(<code>param_boundf</code>), see <em>Details</em>.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_thetas">thetas</code></td>
<td>
<p>a numeric vector of length 2 defining the allowed
lower and upper bounds for the linear parameter <code class="reqn">\theta_s</code>
(<code>param_boundf</code>), see <em>Details</em>.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_k0">k0</code></td>
<td>
<p>either a numeric vector of length 2 defining the allowed
lower and upper bounds for the linear parameter <code class="reqn">K_0</code>
(<code>param_boundf</code>), or a keyword defining the transformation
to be applied to the parameter <code class="reqn">K_0</code> before estimation
(<code>param_transf</code>), see <em>Details</em>.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_reltol">reltol</code></td>
<td>
<p>a numeric scalar defining (one possible) convergence
criterion for the optimiser <code>SCEoptim</code>, see argument <code>control</code>
of <code><a href="SoilHyP.html#topic+SCEoptim">SCEoptim</a></code> for details.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_maxtime">maxtime</code></td>
<td>
<p>a numeric scalar defining the maximum duration of
optimisation in seconds by the optimiser <code>SCEoptim</code>, see see
argument <code>control</code> of <code><a href="SoilHyP.html#topic+SCEoptim">SCEoptim</a></code> for details.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_ncores">ncores</code></td>
<td>
<p>an integer defining the number of cores for
parallel computations.  Defaults to the number of available cores
minus one. <code>ncores = 1</code> suppresses parallel computations.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_fork">fork</code></td>
<td>
<p>a logical scalar controlling whether forking should be used
for parallel computations (default: <code>TRUE</code> on Unix and MacOS and
<code>FALSE</code> on Windows operating systems).  Note that stetting
<code>fork = TRUE</code> on Windows suppresses parallel computations.</p>
</td></tr>
<tr><td><code id="control_fit_wrc_hcc_+3A_...">...</code></td>
<td>
<p>further arguments, such as details on parameter
transformations (<code>fwd_transf</code>, <code>dfwd_transf</code>,
<code>bwd_transf</code>) or control options passed to the
optimisers <code><a href="nloptr.html#topic+nloptr">nloptr</a></code> and
<code><a href="SoilHyP.html#topic+SCEoptim">SCEoptim</a></code>, see <em>Details</em>.</p>
</td></tr>





</table>


<h3>Details</h3>



<h4>Enforcing bounds on the estimated parameters</h4>

<p>Parameters of models for the water retention curve and the hydraulic
conductivity function may vary only within certain bounds (see
<code><a href="#topic+param_boundf">param_boundf</a></code> for allowed ranges).  <code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code>
uses two mechanisms to constrain parameter estimates to permissible
ranges:
</p>

<ol>
<li> <p><em>Parameter transformations</em>
</p>
<p>If a local algorithm is used for nonlinear optimisation
(<code>settings = "ulocal"</code> or <code>settings = "clocal"</code>) and a
transformation not equal to <code>"identity"</code> is specified in
<code>param_tf</code> for any of the <em>nonlinear</em> parameters
<code class="reqn">\boldsymbol{\nu}^\mathrm{} </code>, then the elements of <code class="reqn">\boldsymbol{\nu}^\mathrm{} </code> are
transformed by the functions given in <code>param_tf</code>.  The values
of the transformed parameters vary then over the whole real line,
and an unconstrained algorithm can be used for nonlinear
optimisation.
</p>
<p>Note that the <em>linear</em> parameters <code class="reqn">\theta_r</code> (residual)
and <code class="reqn">\theta_s</code> (saturated water content) are never transformed
and for the saturated hydraulic conductivity, <code class="reqn">K_0</code>, only
<code>"log"</code> (default) or <code>"identity"</code> can be chosen.
Quadratic programming (see <code><a href="quadprog.html#topic+solve.QP">solve.QP</a></code>) is
employed to enforce the box constraints specified in the argument
<code>param_bound</code> for <code class="reqn">\theta_r</code> and <code class="reqn">\theta_s</code>.
Quadratic programming is also used to enforce the positivity
constraint on <code class="reqn">K_0</code> if <code class="reqn">K_0</code> is not log-transformed
(<code>"identity"</code>).  Otherwise, the logarithm of <code class="reqn">K_0</code> is
estimated unconstrainedly, see <code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code> for
further details.
</p>
</li>
<li> <p><em>Box constraints</em>
</p>
<p>If a global algorithm is used for the optimisation (<code>settings</code>
equal to <code>"uglobal"</code> <code>"cglobal"</code> or <code>"sce"</code>) or if
<code>"identity"</code> transformations are specified for all elements of
<code class="reqn">\boldsymbol{\nu}^\mathrm{} </code>, then an optimisation algorithm is deployed that
respects the box constraints given in <code>param_bound</code>.  If
parameters are estimated for several soil samples in a single call
of <code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code> and if sample-specific box constraints
should be used then the lower and upper bounds of the
box-constraints must be specified by the arguments
<code>lower_param</code> and <code>upper_param</code> of the function
<code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code>, see explanations there.
</p>
<p>Further note that the transformations specified by <code>param_tf</code>
for the nonlinear parameters <code class="reqn">\boldsymbol{\nu}^\mathrm{} </code> are ignored when a
global optimisation algorithm is used.
</p>
</li></ol>




<h4>Parameter transformations</h4>

<p>The arguments <code>param_tf</code>, <code>fwd_tf</code>, <code>deriv_fwd_tfd</code>,
<code>bwd_tf</code> define how the model parameters are transformed for
estimation by local optimisation algortihms (see above and
<code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code>).  The following transformations are
currently available:
</p>

<dl>
<dt><code>"log"</code>:</dt><dd><p><code class="reqn">\log(x)</code>,</p>
</dd>
<dt><code>"log1"</code>:</dt><dd><p><code class="reqn">\log(x-1)</code>,</p>
</dd>
<dt><code>"logitlu"</code>:</dt><dd><p><code class="reqn">\log((x - l) / (u - x))</code> with <code class="reqn">l</code>
and <code class="reqn">u</code> the allowed lower and upper bounds for a parameter, see
<code>param_boundf</code>,</p>
</dd>
<dt><code>"identity"</code>:</dt><dd><p>no transformation.</p>
</dd>
</dl>

<p>These are the possible values that the various arguments of the
function <code>param_transf</code> accept (as quoted character strings), and
these are the names of the list components returned by
<code>fwd_transf</code>, <code>dfwd_transf</code> and <code>bwd_transf</code>.
</p>
<p>Additional transformations can be implemented by:
</p>

<ol>
<li><p> Extending the function definitions by arguments like
</p>
<p><code>fwd_tf = fwd_transf(my_fun = function(x) your transformation)</code>,<br />
<code>deriv_fwd_tfd = dfwd_transf(my_fun = function(x) your derivative)</code>,<br />
<code>bwd_tf = bwd_transf(my_fun = function(x) your back-transformation)</code>,
</p>
</li>
<li><p> Assigning to a given argument of <code>param_transf</code> the name
of the new function, e.g.<br /> <code>alpha = "my_fun"</code>.  </p>
</li></ol>

<p>Note that the values given to the arguments of <code>param_transf</code> must
match the names of the functions returned by <code>fwd_transf</code>,
<code>dfwd_transf</code> and <code>bwd_transf</code>.
</p>



<h4>High-precision numerical computations</h4>

<p>Estimation of <code class="reqn">\log(K_0)</code> is somewhat delicate for large
values of the shape parameter <code class="reqn">n</code> and/or small values of
<code class="reqn">\alpha</code>.  The water saturation and the relative conductivity are
then close to zero for capillary pressure head exceeding
<code class="reqn">1/\alpha</code>.  To avoid numerical problems caused by limited accuracy
of double precision numbers, <code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code> uses the
function <code><a href="Rmpfr.html#topic+mpfr">mpfr</a></code> of the package <span class="pkg">Rmpfr</span> for
high-accuracy computations.  The argument <code>precBits</code> of
<code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code> controls the accuracy.  Increase its
value if computation fails with a respective diagnostic message.
</p>



<h4>Options to choose the approach for nonlinear optimisation</h4>

<p>The argument <code>settings</code> defines sets of default options to control
the optimisers.  The following <code>settings</code> are currently defined:
</p>

<dl>
<dt><code>"uglobal"</code>:</dt><dd><p>unconstrained optimisation by any of the
global algorithms (named <code>"NLOPT_G..."</code>) of the NLopt library.</p>
</dd>
<dt><code>"cglobal"</code>:</dt><dd><p>constrained optimisation by the global
algorithm <code>"NLOPT_GN_ISRES"</code> of NLopt that allows for inequality
constraints.</p>
</dd>
<dt><code>"ulocal"</code>:</dt><dd><p>unconstrained optimisation by any of the
local algorithms<br /> (named <code>"NLOPT_L..."</code>) of
NLopt.</p>
</dd>
<dt><code>"clocal"</code>:</dt><dd><p>constrained optimisation by any of the local
algorithms<br /> (<code>"NLOPT_LN_COBYLA"</code>, <code>"NLOPT_LN_AUGLAG"</code>,
<code>"NLOPT_LD_AUGLAG"</code>, <code>"NLOPT_LD_SLSQP"</code>,<br />
<code>"NLOPT_LD_MMA"</code>), <code>"NLOPT_LD_CCSAQ"</code>) of NLopt that allow
for inequality constraints.</p>
</dd>
<dt><code>"sce"</code>:</dt><dd><p>unconstrained optimisation by the global
algorithm implemented in <code><a href="SoilHyP.html#topic+SCEoptim">SCEoptim</a></code>.</p>
</dd>
</dl>

<p>The functions <code>control_nloptr</code> and <code>control_sce</code> allow finer
control of the optimisers.

<code>control_nloptr</code> and <code>control_sce</code> take any
argument available to pass controlling options to the optimisers
<code><a href="nloptr.html#topic+nloptr">nloptr</a></code> (by its argument <code>opts</code>) and
<code><a href="SoilHyP.html#topic+SCEoptim">SCEoptim</a></code> (by its argument <code>control</code>),
respectively.
</p>


<h5>Controlling nloptr</h5>

<p>The function <code><a href="nloptr.html#topic+nloptr.print.options">nloptr.print.options</a></code> prints all
options available to control <code><a href="nloptr.html#topic+nloptr">nloptr</a></code> by its
argument <code>opts</code>.  Detailed information on the options can be
found in the
<a href="https://nlopt.readthedocs.io/en/latest/NLopt_manual/">NLopt
documentation</a>.<br />
</p>
<p>The function <code>control_fit_wrc_hcc</code> sets meaningful defaults for
<code>opts</code> in dependence of the chosen optimisation approach as
specified by the argument <code>settings</code>, and it checks the
consistency of the arguments of <code>control_nloptr</code> if they are
explicitly passed to <code>fit_wrc_hcc</code>.<br />
</p>
<p>The following defaults are set by <code>control_fit_wrc_hcc</code> for the
argument <code>opts</code> of <code><a href="nloptr.html#topic+nloptr">nloptr</a></code> (:
</p>


<ol>
<li><p> Unconstrained, global optimisation (<code>settings =
        "uglobal"</code>):
</p>
<pre>
nloptr = control_nloptr(
  algorithm = "NLOPT_GN_MLSL_LDS",
  local_opts = list(
    algorithm = "NLOPT_LN_BOBYQA",
    xtol_rel = -1.,
    ftol_rel = 1.e-6
  ),
  xtol_rel = -1,
  ftol_rel = -1,
  maxeval = 125,
  maxtime = -1)
        </pre>
<p>In addition, any parameter transformations specified by
<code>param_tf</code> are overridden and the untransformed parameters
(<code>"identity"</code>) are estimated when <code>settings = "uglobal"</code> is
chosen.
</p>

</li>
<li><p> Constrained, global optimisation (<code>settings =
        "cglobal"</code>):
</p>
<pre>
nloptr = control_nloptr(
  algorithm = "NLOPT_GN_ISRES",
  xtol_rel = -1,
  ftol_rel = -1,
  maxeval = 1000,
  maxtime = -1)
        </pre>
<p>In addition, any parameter transformations specified by
<code>param_tf</code> are overridden and the untransformed parameters
(<code>"identity"</code>) are estimated when <code>settings = "cglobal"</code>
is chosen.
</p>

</li>
<li><p> Unconstrained, local optimisation (<code>settings =
        "ulocal"</code>):
</p>
<pre>
nloptr = control_nloptr(
  algorithm = "NLOPT_LN_BOBYQA",
  xtol_rel = -1,
  ftol_rel = 1.e-8,
  maxeval = 250,
  maxtime = -1)
        </pre>

</li>
<li><p> Constrained, local optimisation (<code>settings = "clocal"</code>):
</p>
<pre>
nloptr = control_nloptr(
  algorithm = "NLOPT_LD_CCSAQ",
  xtol_rel = -1,
  ftol_rel = 1.e-8,
  maxeval = 1000,
  maxtime = -1)
        </pre>
<p>If the algorithm <code>"NLOPT_LD_AUGLAG"</code> is used for constrained,
local optimisation then
</p>
<pre>
nloptr = control_nloptr(
  algorithm = "NLOPT_LD_AUGLAG",
  local_opts = list(
    algorithm = "NLOPT_LD_LBFGS",
    xtol_rel = -1.,
    ftol_rel = 1.e-6
  ),
  xtol_rel = -1,
  ftol_rel = 1.e-8,
  maxeval = 1000,
  maxtime = -1)
        </pre>
</li></ol>

<p>For other, unspecified elements of <code>opts</code> default values as
listed by <code><a href="nloptr.html#topic+nloptr.print.options">nloptr.print.options</a></code> are used.
</p>



<h5>Controlling SCEoptim</h5>

<p>The function <code>control_sce</code> sets meaningful defaults for the
argument <code>control</code> of <code><a href="SoilHyP.html#topic+SCEoptim">SCEoptim</a></code>.
Currently, the following defaults are defined:
</p>
<pre>
sce = control_sce(
  reltol = 1e-08,
  maxtime = 20)
      </pre>
<p>In addition, any parameter transformations specified by
<code>param_tf</code> are overridden and the untransformed parameters
(<code>"identity"</code>) are estimated when <code>settings = "sce"</code> is
chosen.
</p>




<h3>Value</h3>

<p><code>control_fit_wrc_hcc</code> creates a list with components
<code>settings</code>, <code>hessian</code>, <code>method</code>, <code>nloptr</code>,
<code>sce</code>, <code>wrc_model</code>, <code>hcc_model</code>, <code>initial_param</code>,
<code>approximation_alpha_k0</code>, <code>variable_weight</code>, <code>gam_k</code>,
<code>gam_n_newdata</code>, <code>precBits</code>, <code>min_nobs_wc</code>,
<code>min_nobs_hc</code>, <code>keep_empty_fits</code>, <code>param_bound</code>,
<code>param_tf</code>, <code>fwd_tf</code>, <code>deriv_fwd_tfd</code>, <code>bwd_tf</code>,
<code>pcmp</code> corresponding to its arguments and some further components
(<code>delta_sat_0</code>, <code>grad_eps</code>, <code>use_derivative</code>) that cannot
be changed by the user.
</p>
<p><code>control_nloptr</code> and <code>control_sce</code>
create lists with control parameters passed to
<code><a href="nloptr.html#topic+nloptr">nloptr</a></code> and <code><a href="SoilHyP.html#topic+SCEoptim">SCEoptim</a></code>,
respectively, see <em>Details</em>.
</p>
<p><code>param_boundf</code> generates a list with allowed lower and upper bounds of
the model parameters.
</p>
<p><code>param_transf</code> generates a list with keywords that
define what transformations are used for estimating the model
parameters, and <code>fwd_transf</code>, <code>bwd_transf</code> and
<code>dfwd_transf</code> return lists of functions with forward and backward
transformations and the first derivatives of the forward
transformations, see <em>Details</em>.
</p>
<p><code>control_pcmp</code> generates a list with control parameters for parallel
computations.
</p>


<h3>Author(s)</h3>

<p>Andreas Papritz <a href="mailto:papritz@retired.ethz.ch">papritz@retired.ethz.ch</a>.
</p>


<h3>References</h3>

<p>Johnson, S.G. The NLopt nonlinear-optimisation package.
<a href="https://github.com/stevengj/nlopt">https://github.com/stevengj/nlopt</a>.
</p>
<p>Lehmann, P., Assouline, S., Or, D. (2008) Characteristic lengths
affecting evaporative drying of porous media.  <em>Physical Review E</em>,
<b>77</b>, 056309, <a href="https://doi.org/10.1103/PhysRevE.77.056309">doi:10.1103/PhysRevE.77.056309</a>.
</p>
<p>Lehmann, P., Bickel, S., Wei, Z., Or, D. (2020) Physical Constraints for
Improved Soil Hydraulic Parameter Estimation by Pedotransfer Functions.
<em>Water Resources Research</em> <b>56</b>, e2019WR025963,
<a href="https://doi.org/10.1029/2019WR025963">doi:10.1029/2019WR025963</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code> for a description of the models and a brief
summary of the parameter estimation approach;
</p>
<p><code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code> for (constrained) estimation of parameters of
models for soil water retention and hydraulic conductivity data;
</p>



<p><code><a href="#topic+soilhypfitmethods">soilhypfitmethods</a></code> for common S3 methods for class
<code>fit_wrc_hcc</code>;
</p>
<p><code><a href="#topic+vcov">vcov</a></code> for computing (co-)variances of the estimated
nonlinear parameters;
</p>
<p><code><a href="#topic+prfloglik_sample">prfloglik_sample</a></code> for profile loglikelihood
computations;
</p>
<p><code><a href="#topic+wc_model">wc_model</a></code> and <code><a href="#topic+hc_model">hc_model</a></code> for currently
implemented models for soil water retention curves and hydraulic
conductivity functions;
</p>
<p><code><a href="#topic+evaporative-length">evaporative-length</a></code> for physically constraining parameter
estimates of soil hydraulic material functions.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# use of \donttest{} because execution time exceeds 5 seconds
data(sim_wrc_hcc)

# estimate parameters for a single soil sample by maximizing loglikelihood ...

# ... with unconstrained, global optimisation algorithm NLOPT_GN_MLSL
coef(
  fit1 &lt;- fit_wrc_hcc(
    wrc_formula = wc ~ head, hcc_formula = hc ~ head,
    data = sim_wrc_hcc, subset = id == 2
  ), gof = TRUE)

# ... as fit1 but fitting parameter tau as well
coef(
  fit2 &lt;- update(fit1,
    fit_param = default_fit_param(tau = TRUE)
  ), gof = TRUE)

plot(fit1, y = fit2)

# ... with unconstrained, local optimisation algorithm NLOPT_LN_BOBYQA,
#     initial values for alpha and n are computed from data and
#     transformed nonlinear parameters are estimated without box-constraints
coef(
  fit3 &lt;- update(
    fit2,
    control = control_fit_wrc_hcc(settings = "ulocal"),
    verbose = 2), gof = TRUE)

# estimate parameters by unconstrained, weighted least squares minimisation with
#     algorithm NLOPT_LD_LBFGS, giving larger weight to conductivity data,
#     using specified initial values for alpha and n and
#     fitting untransformed nonlinear parameters with default box constraints
#     defined by param_boundf()
#     diagnostic output directly from nloptr
coef(
  fit4 &lt;- update(
    fit2,
    param = c(alpha = 1.7, n = 2),
    control = control_fit_wrc_hcc(
      settings = "ulocal", method = "wls",
      variable_weight = c(wrc = 1, hcc = 2),
      nloptr = control_nloptr(algorithm = "NLOPT_LD_LBFGS", print_level = 3),
      param_tf = param_transf(alpha = "identity", n = "identity", tau = "identity")
    ), verbose = 0), gof = TRUE)

# ... as fit4 but giving even larger weight to conductivity data
coef(
  fit5 &lt;- update(
    fit4,
    control = control_fit_wrc_hcc(
      settings = "ulocal", method = "wls",
      variable_weight = c(wrc = 1, hcc = 5),
      nloptr = control_nloptr(algorithm = "NLOPT_LD_LBFGS", print_level = 3),
      param_tf = param_transf(alpha = "identity", n = "identity", tau = "identity")
    ), verbose = 0), gof = TRUE)

plot(fit4, y = fit5)

</code></pre>

<hr>
<h2 id='evaporative-length'>Evaporative Characteristic Length</h2><span id='topic+evaporative-length'></span><span id='topic+lc'></span><span id='topic+lt'></span>

<h3>Description</h3>

<p>The functions <code>lc</code> and <code>lt</code> compute the <em>characteristic
length</em> <code class="reqn">L_\mathrm{c}</code> of <em>stage-I</em> evaporation from a soil
and its &ldquo;target&rdquo; (expected) value <code class="reqn">L_\mathrm{t}</code>, used to
constrain estimates of nonlinear parameters of the Van Genuchten-Mualem
(VGM) model for water retention curves and hydraulic conductivity
functions.</p>


<h3>Usage</h3>

<pre><code class='language-R'>lc(alpha, n, tau, k0, e0, c0 = NULL, c3 = NULL, c4 = NULL)

lt(n, tau, e0, c0, c1, c2, c3, c4)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="evaporative-length_+3A_alpha">alpha</code></td>
<td>
<p>parameter <code class="reqn">\alpha</code> (inverse air entry pressure) of the
VGM model, see <code><a href="#topic+wc_model">wc_model</a></code> and <code><a href="#topic+hc_model">hc_model</a></code>.  For
consistency with other quantities, the unit of <code class="reqn">\alpha</code> should be
<b>1/meter</b> [<code class="reqn">\mathrm{m}^{-1}</code>].  </p>
</td></tr>
<tr><td><code id="evaporative-length_+3A_n">n</code></td>
<td>
<p>parameter <code class="reqn">n</code> (shape parameter) of the VGM model, see
<code><a href="#topic+wc_model">wc_model</a></code> and <code><a href="#topic+hc_model">hc_model</a></code>.</p>
</td></tr>
<tr><td><code id="evaporative-length_+3A_tau">tau</code></td>
<td>
<p>parameter <code class="reqn">\tau</code> (tortuosity parameter) of the VGM model,
see <code><a href="#topic+hc_model">hc_model</a></code>.</p>
</td></tr>
<tr><td><code id="evaporative-length_+3A_k0">k0</code></td>
<td>
<p>saturated hydraulic conductivity <code class="reqn">K_0</code>, see
<code><a href="#topic+hc_model">hc_model</a></code>.  If <code>k0</code> is missing or equal to <code>NA</code>
in calls of <code>lc</code> then <code>k0</code> is approximated by the same relation
as used for <code>lt</code>, see <em>Details</em>.  For consistency with other
quantities, the unit of <code class="reqn">K_0</code> should be <b>meter/day</b>
[<code class="reqn">\mathrm{m}\,\mathrm{d}^{-1}</code>].</p>
</td></tr>
<tr><td><code id="evaporative-length_+3A_e0">e0</code></td>
<td>
<p>a numeric scalar with the <em>stage-I</em> rate of evaporation
<code class="reqn">E_0</code> from a soil, see <em>Details</em> and
<code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code>.  For consistency with other quantities,
the unit of <code class="reqn">E_0</code> should be <b>meter/day</b>
[<code class="reqn">\mathrm{m}\,\mathrm{d}^{-1}</code>].</p>
</td></tr>
<tr><td><code id="evaporative-length_+3A_c0">c0</code>, <code id="evaporative-length_+3A_c1">c1</code>, <code id="evaporative-length_+3A_c2">c2</code>, <code id="evaporative-length_+3A_c3">c3</code>, <code id="evaporative-length_+3A_c4">c4</code></td>
<td>
<p>numeric constants to approximate the parameter
<code class="reqn">\alpha</code> and the saturated hydraulic conductivity <code class="reqn">K_0</code> when
computing <code class="reqn">L_\mathrm{t}</code>, see <em>Details</em> and
<code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code>.  For consistency with other quantities,
the following units should be used for the constants: </p>
 <ul>
<li>
<p><code>c1</code>: <code class="reqn">\mathrm{m}^{-1}</code>, </p>
</li>
<li> <p><code>c3</code>:
<code class="reqn">\mathrm{m}\,\mathrm{d}^{-1}</code>.  </p>
</li></ul>
<p> The remaining constants are
dimensionless.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <em>characteristic length</em> of <em>stage-I evaporation</em>
<code class="reqn">L_\mathrm{c}</code> (<cite>Lehmann et al., 2008, 2020</cite>) is defined by

</p>
<p style="text-align: center;"><code class="reqn">
  L_\mathrm{c}(\boldsymbol{\nu}, K_0, E_0) = \frac{
    \frac{1}{\alpha \,§ n} \left(\frac{2n-1}{n-1}\right)^\frac{2n-1}{n}
  }{1 + \frac{E_0}{K_\mathrm{eff}}}
</code>
</p>


<p>where <code class="reqn">\boldsymbol{\nu}^\mathrm{T} = (\alpha, n, \tau)</code> are the nonlinear parameters of
the VGM model, <code class="reqn">K_0</code> is the saturated hydraulic conductivity,
<code class="reqn">E_0</code> the stage-I evaporation rate and
<code class="reqn">K_\mathrm{eff} = 4\, K_\mathrm{VGM}(h_\mathrm{crit}; K_0,
\boldsymbol{\nu})</code> is the
effective hydraulic conductivity at the critical pressure 
</p>
<p style="text-align: center;"><code class="reqn">
  h_\mathrm{crit} = \frac{1}{\alpha} \,
  \left(\frac{n-1}{n}\right)^\frac{1-2n}{n},
  </code>
</p>


<p>see <code>hc_model</code> for the definition of
<code class="reqn">K_\mathrm{VGM}(h; K_0,
\boldsymbol{\nu})</code>.
</p>
<p>The quantity <code class="reqn">L_\mathrm{t}</code> is the expected value (&ldquo;target&rdquo;) of
<code class="reqn">L_\mathrm{c}</code> for given shape (<code class="reqn">n</code>) and tortuosity
(<code class="reqn">\tau</code>) parameters.  To evaluate <code class="reqn">L_\mathrm{t}</code>, the
parameters <code class="reqn">\alpha</code> and <code class="reqn">K_0</code> are approximated by the following
relations

</p>
<p style="text-align: center;"><code class="reqn">
 \widehat{\alpha} = g_\alpha(n; c_0, c_1, c_2) =
    c_1 \, \frac{n - c_0}{1 + c_2 \, (n - c_0)},
</code>
</p>


<p style="text-align: center;"><code class="reqn">
 \widehat{K}_0 = g_{K_0}(n; c_0, c_3, c_4) =
    c_3 \, (n - c_0)^{c_4}.
</code>
</p>


<p>The default values for <code class="reqn">c_0</code> to <code class="reqn">c_4</code> (see argument
<code>approximation_alpha_k0</code> of
<code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code>) were estimated with data on African
desert regions of the database <em>ROSETTA3</em> (<cite>Zhang and Schaap,
2017</cite>), see <cite>Lehmann et al. (2020)</cite> for details.
</p>


<h3>Value</h3>

<p>A numeric scalar with the characteristic evaporative length (<code>lc</code>) or
its expected value (<code>lt</code>).</p>


<h3>Author(s)</h3>

<p>Andreas Papritz <a href="mailto:papritz@retired.ethz.ch">papritz@retired.ethz.ch</a>.
</p>


<h3>References</h3>

<p>Lehmann, P., Assouline, S., Or, D. (2008) Characteristic lengths
affecting evaporative drying of porous media.  <em>Physical Review E</em>,
<b>77</b>, 056309, <a href="https://doi.org/10.1103/PhysRevE.77.056309">doi:10.1103/PhysRevE.77.056309</a>.
</p>
<p>Lehmann, P., Bickel, S., Wei, Z., Or, D. (2020) Physical Constraints for
Improved Soil Hydraulic Parameter Estimation by Pedotransfer Functions.
<em>Water Resources Research</em> <b>56</b>, e2019WR025963,
<a href="https://doi.org/10.1029/2019WR025963">doi:10.1029/2019WR025963</a>.
</p>
<p>Zhang, Y. , Schaap, M. G. 2017. Weighted recalibration of the Rosetta
pedotransfer model with improved estimates of hydraulic parameter
distributions and summary statistics (Rosetta3). <em>Journal of Hydrology</em>,
<b>547</b>, 39-53, <a href="https://doi.org/10.1016/j.jhydrol.2017.01.004">doi:10.1016/j.jhydrol.2017.01.004</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code> for a description of the models and a brief
summary of the parameter estimation approach;
</p>
<p><code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code> for (constrained) estimation of parameters of
models for soil water retention and hydraulic conductivity data;
</p>
<p><code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code> for options to control
<code>fit_wrc_hcc</code>;
</p>
<p><code><a href="#topic+soilhypfitmethods">soilhypfitmethods</a></code> for common S3 methods for class
<code>fit_wrc_hcc</code>;
</p>
<p><code><a href="#topic+vcov">vcov</a></code> for computing (co-)variances of the estimated
nonlinear parameters;
</p>
<p><code><a href="#topic+prfloglik_sample">prfloglik_sample</a></code> for profile loglikelihood
computations;
</p>
<p><code><a href="#topic+wc_model">wc_model</a></code> and <code><a href="#topic+hc_model">hc_model</a></code> for currently
implemented models for soil water retention curves and hydraulic
conductivity functions;



</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# use of \donttest{} because execution time exceeds 5 seconds

# estimate parameters of 4 samples of the Swiss forest soil dataset
# that have water retention (theta, all samples), saturated hydraulic conductivity
# (ksat) and optionally unsaturated hydraulic conductivity data
# (ku, samples "CH2_4" and "CH3_1")

data(swissforestsoils)

# select subset of data
sfs_subset &lt;- droplevels(
  subset(
    swissforestsoils,
    layer_id %in% c("CH2_3", "CH2_4", "CH2_6", "CH3_1")
  ))

# extract ksat measurements
ksat &lt;- sfs_subset[!duplicated(sfs_subset$layer_id), "ksat", drop = FALSE]
rownames(ksat) &lt;- levels(sfs_subset$layer_id)
colnames(ksat) &lt;- "k0"

# define number of cores for parallel computations
if(interactive()) ncpu &lt;- parallel::detectCores() - 1L else ncpu &lt;- 1L


# unconstrained estimation (global optimisation algorithm NLOPT_GN_MLSL)
# k0 fixed at measured ksat values
rsfs_uglob &lt;- fit_wrc_hcc(
  wrc_formula = theta ~ head | layer_id,
  hcc_formula = ku ~ head | layer_id,
  data = sfs_subset,
  param = ksat,
  fit_param = default_fit_param(k0 = FALSE),
  control = control_fit_wrc_hcc(
    settings = "uglobal", pcmp = control_pcmp(ncores = ncpu)))
summary(rsfs_uglob)
coef(rsfs_uglob, lc = TRUE, gof = TRUE)


# constrained estimation by restricting ratio Lc/Lt to [0.5, 2]
# (global constrained optimisation algorithm NLOPT_GN_MLSL)
# k0 fixed at measured ksat values
rsfs_cglob &lt;- update(
  rsfs_uglob,
  control = control_fit_wrc_hcc(
    settings = "cglobal", nloptr = control_nloptr(ranseed = 1),
    pcmp = control_pcmp(ncores = ncpu)))
summary(rsfs_cglob)
coef(rsfs_cglob, lc = TRUE, gof = TRUE)

# get initial parameter values from rsfs_cglob
ini_param &lt;- cbind(
  coef(rsfs_cglob)[, c("alpha", "n")],
  ksat
)
# constrained estimation by restricting ratio Lc/Lt to [0.5, 2]
# (local constrained optimisation algorithm NLOPT_LD_CCSAQ)
# k0 fixed at measured ksat values
rsfs_cloc &lt;- update(
  rsfs_uglob,
  param = ini_param,
  control = control_fit_wrc_hcc(
    settings = "clocal", nloptr = control_nloptr(ranseed = 1),
    pcmp = control_pcmp(ncores = ncpu)))
summary(rsfs_cloc)
coef(rsfs_cloc, lc = TRUE, gof = TRUE)

op &lt;- par(mfrow = c(4, 2))
plot(rsfs_uglob, y = rsfs_cglob)
on.exit(par(op))

op &lt;- par(mfrow = c(4, 2))
plot(rsfs_uglob, y = rsfs_cloc)
on.exit(par(op))

</code></pre>

<hr>
<h2 id='fit_wrc_hcc'>
Parametric Modelling of Soil Hydraulic Properties
</h2><span id='topic+fit_wrc_hcc'></span><span id='topic+default_fit_param'></span>

<h3>Description</h3>

<p>The function <code>fit_wrc_hcc</code> estimates parameters of models for the
soil water retention curve and/or soil hydraulic conductivity function
from respective measurements by nonlinear regression methods, optionally
subject to physical constraints on the estimated parameters.
<code>fit_wrc_hcc</code> uses optimisation algorithms of the NLopt library
(Johnson, see <code><a href="nloptr.html#topic+nloptr-package">nloptr-package</a></code>) and the Shuffled
Complex Evolution (SCE) algorithm (Duan et al., 1994) implemented in the
function <code><a href="SoilHyP.html#topic+SCEoptim">SCEoptim</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
fit_wrc_hcc(
    wrc_formula, hcc_formula, data,
    subset = NULL, wrc_subset = subset, hcc_subset = subset,
    weights = NULL, wrc_weights = weights, hcc_weights = weights,
    na.action, param = NULL, lower_param = NULL, upper_param = NULL,
    fit_param = default_fit_param(),
    e0 = 2.5e-3, ratio_lc_lt_bound = c(lower = 0.5, upper = 2),
    control = control_fit_wrc_hcc(), verbose = 0)

default_fit_param(
    alpha = TRUE, n = TRUE, tau = FALSE,
    thetar = TRUE, thetas = TRUE, k0 = TRUE)

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fit_wrc_hcc_+3A_wrc_formula">wrc_formula</code></td>
<td>
<p>an optional two-sided formula such as <code>wc ~ head</code>
or <code>wc ~ head | id</code>, specifying the variables for the water content
(<code>wc</code>), the capillary pressure <code>head</code> and, optionally, for
sample <code>id</code>s when model parameters are estimated for several soil
samples at the same time, see <code><a href="stats.html#topic+formula">formula</a></code> and
<em>Details</em>.</p>
</td></tr>
<tr><td><code id="fit_wrc_hcc_+3A_hcc_formula">hcc_formula</code></td>
<td>
<p>an optional two-sided formula such as <code>hc ~ head</code>
or <code>hc ~ head | id</code>, specifying the variables for the hydraulic
conductivity (<code>hc</code>), the capillary pressure <code>head</code> and,
optionally, for sample <code>id</code>s when model parameters are estimated for
several soil samples at the same time.  See <code><a href="stats.html#topic+formula">formula</a></code>
and <em>Details</em>.</p>
</td></tr>
<tr><td><code id="fit_wrc_hcc_+3A_data">data</code></td>
<td>
<p>a mandatory data frame containing the variables specified in
the formula, the subset and weights arguments.</p>
</td></tr>
<tr><td><code id="fit_wrc_hcc_+3A_subset">subset</code></td>
<td>
<p>an optional expression generating a vector to choose a
subset of water content and hydraulic conductivity data.  The expression
is evaluated in the environment generated by
<code>model.frame(wrc_formula, data)</code> and<br /> <code>model.frame(hcc_formula,
  data)</code>, respectively.</p>
</td></tr>
<tr><td><code id="fit_wrc_hcc_+3A_wrc_subset">wrc_subset</code></td>
<td>
<p>an optional expression generating a vector to choose a
subset of water content data.  The expression is evaluated in the
environment generated by<br />  <code>model.frame(wrc_formula, data)</code>.  Defaults
to <code>subset</code>.</p>
</td></tr>
<tr><td><code id="fit_wrc_hcc_+3A_hcc_subset">hcc_subset</code></td>
<td>
<p>an optional expression generating a vector to choose a
subset of hydraulic conductivity data.
The expression is evaluated in the environment generated by
<code>model.frame(hcc_formula, data)</code>.  Defaults to <code>subset</code>.</p>
</td></tr>
<tr><td><code id="fit_wrc_hcc_+3A_weights">weights</code></td>
<td>
<p>an optional expression generating a numeric vector of case
weights <code class="reqn">w^\prime_{\theta,i}</code> and <code class="reqn">w^\prime_{K,i}</code> (default: 1,
see <code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code>) for water content and hydraulic
conductivity data.  The expression is evaluated in the environment
generated by <code>model.frame(wrc_formula, data)</code> and
<code>model.frame(hcc_formula, data)</code>, respectively.</p>
</td></tr>
<tr><td><code id="fit_wrc_hcc_+3A_wrc_weights">wrc_weights</code></td>
<td>
<p>an optional expression generating a numeric vector of
case weights <code class="reqn">w^\prime_{\theta,i}</code> (see
<code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code>) for water content data.  The expression is
evaluated in the environment generated by <code>model.frame(wrc_formula,
  data)</code>.  Defaults to <code>weights</code>.</p>
</td></tr>
<tr><td><code id="fit_wrc_hcc_+3A_hcc_weights">hcc_weights</code></td>
<td>
<p>an optional expression generating a numeric vector of
case weights <code class="reqn">w^\prime_{K,i}</code> (see <code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code>) for
hydraulic conductivity data.  The expression is evaluated in the
environment generated by <code>model.frame(hcc_formula, data)</code>.  Defaults
to <code>weights</code>.</p>
</td></tr>
<tr><td><code id="fit_wrc_hcc_+3A_na.action">na.action</code></td>
<td>
<p>a function which indicates what should happen when the
data contain <code>NA</code>s.  The default is set by the <code>na.action</code>
argument of <code><a href="base.html#topic+options">options</a></code>, and is <code><a href="stats.html#topic+na.fail">na.fail</a></code> if that
is unset.  The &ldquo;factory-fresh&rdquo; default is <code><a href="stats.html#topic+na.omit">na.omit</a></code>.
Another possible value is <code>NULL</code>, no action.  Value
<code><a href="stats.html#topic+na.exclude">na.exclude</a></code> can be useful.</p>
</td></tr>
<tr><td><code id="fit_wrc_hcc_+3A_param">param</code></td>
<td>
<p>an optional named numeric vector (or a numeric matrix or a
dataframe with specified row and column names, see <em>Details</em>) with
initial values for the model parameters.  Currently, <code>param</code> may
have elements (or columns) named <code>"alpha"</code>, <code>"n"</code>,
<code>"tau"</code>, <code>"thetar"</code>, <code>"thetas"</code>, <code>"k0"</code>, see
<code><a href="#topic+wc_model">wc_model</a></code> and <code><a href="#topic+hc_model">hc_model</a></code> and <em>Details</em>.
For consistency with other quantities, the unit of <code class="reqn">\alpha</code> should be
<b>1/meter</b> [<code class="reqn">\mathrm{m}^{-1}</code>] and the unit of <code class="reqn">K_0</code>
<b>meter/day</b> [<code class="reqn">\mathrm{m}\,\mathrm{d}^{-1}</code>].</p>
</td></tr>
<tr><td><code id="fit_wrc_hcc_+3A_lower_param">lower_param</code></td>
<td>
<p>an optional named numeric vector (or a numeric matrix
or a dataframe with specified row and column names, see <em>Details</em>)
with lower bounds for the parameters of the models.  Currently,
<code>lower_param</code> may have elements (or columns) named <code>"alpha"</code>,
<code>"n"</code>, <code>"tau"</code>, <code>"thetar"</code>, <code>"thetas"</code>, <code>"k0"</code>,
see <code><a href="#topic+wc_model">wc_model</a></code>, <code><a href="#topic+hc_model">hc_model</a></code> and
<code><a href="#topic+param_boundf">param_boundf</a></code>.  For consistency with other quantities, the
unit of <code class="reqn">\alpha</code> should be <b>1/meter</b>
[<code class="reqn">\mathrm{m}^{-1}</code>] and the unit of <code class="reqn">K_0</code> <b>meter/day</b>
[<code class="reqn">\mathrm{m}\,\mathrm{d}^{-1}</code>].  If lower bounds are
specified for <code class="reqn">\theta_r</code> but not for <code class="reqn">\theta_s</code> then the lower
bounds specified for <code class="reqn">\theta_r</code> will also be used for
<code class="reqn">\theta_s</code>.</p>
</td></tr>
<tr><td><code id="fit_wrc_hcc_+3A_upper_param">upper_param</code></td>
<td>
<p>an optional named numeric vector (or a numeric matrix
or a dataframe with specified row and column names, see <em>Details</em>)
with upper bounds for the parameters of the models.  Currently,
<code>upper_param</code> may have elements (or columns) named <code>"alpha"</code>,
<code>"n"</code>, <code>"tau"</code>, <code>"thetar"</code>, <code>"thetas"</code>, <code>"k0"</code>,
see <code><a href="#topic+wc_model">wc_model</a></code>, <code><a href="#topic+hc_model">hc_model</a></code> and
<code><a href="#topic+param_boundf">param_boundf</a></code>.  For consistency with other quantities, the
unit of <code class="reqn">\alpha</code> should be <b>1/meter</b>
[<code class="reqn">\mathrm{m}^{-1}</code>] and the unit of <code class="reqn">K_0</code> <b>meter/day</b>
[<code class="reqn">\mathrm{m}\,\mathrm{d}^{-1}</code>].  If upper bounds are
specified for <code class="reqn">\theta_s</code> but not for <code class="reqn">\theta_r</code> then the upper
bounds specified for <code class="reqn">\theta_s</code> will also be used for
<code class="reqn">\theta_r</code>.</p>
</td></tr>
<tr><td><code id="fit_wrc_hcc_+3A_fit_param">fit_param</code></td>
<td>
<p>a named logical vector (or a logical matrix or a
dataframe with specified row and column names, see <em>Details</em>)
containing flags that control whether model parameters are estimated
(<code>TRUE</code>) or kept fixed at the initial values (<code>FALSE</code>) as
specified in <code>param</code>.  This vector can be generated easily by the
function <code>default_fit_param</code>.  Currently, <code>fit_param</code> may have
elements (or columns) named <code>"alpha"</code>, <code>"n"</code>, <code>"tau"</code>,<br />
<code>"thetar"</code>, <code>"thetas"</code>, <code>"k0"</code>, see <em>Details</em>,
<code><a href="#topic+wc_model">wc_model</a></code> and <code><a href="#topic+hc_model">hc_model</a></code>.</p>
</td></tr>
<tr><td><code id="fit_wrc_hcc_+3A_e0">e0</code></td>
<td>
<p>a numeric scalar (or named vector, see <em>Details</em>) with the
stage-I rate of evaporation <code class="reqn">E_0</code> from a soil (default <code class="reqn">2.5\cdot
  10^{-3} \ \mathrm{m}\,\mathrm{d}^{-1}</code>) required to
evaluate the <em>characteristic evaporative length</em>, see
<code><a href="#topic+evaporative-length">evaporative-length</a></code> and <code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code>.  For
consistency with other quantities, the unit of <code class="reqn">E_0</code> should
<b>meter/day</b> [<code class="reqn">\mathrm{m}\,\mathrm{d}^{-1}</code>].  Note that
<code>e0</code> is ignored when an unconstrained nonlinear optimisation
algorithm is chosen (argument <code>settings</code> of
<code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code> equal to <code>"uglobal"</code>, <code>"sce"</code>
or <code>"ulocal"</code>).</p>
</td></tr>
<tr><td><code id="fit_wrc_hcc_+3A_ratio_lc_lt_bound">ratio_lc_lt_bound</code></td>
<td>
<p>a named numeric vector of length 2 (or a matrix
with specified rownames and two columns, see <em>Details</em>) defining the
default <code>lower</code> and <code>upper</code> bounds of the ratio
<code class="reqn">L_\mathrm{c}/L_\mathrm{t}</code> (<cite>Lehmann et al., 2008,
2020</cite>) for constrained estimation of the <em>nonlinear</em> parameters
<code class="reqn">\boldsymbol{\nu}^\mathrm{T} =(\alpha, n, \tau)</code> (default values 0.5 (<code>lower</code>)
and 2 (<code>upper</code>)), see <code><a href="#topic+evaporative-length">evaporative-length</a></code> and
<code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code>.  Note that <code>ratio_lc_lt_bound</code> is
ignored when an unconstrained nonlinear optimisation algorithm is chosen
(argument <code>settings</code> of <code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code> equal to
<code>"uglobal"</code>, <code>"sce"</code> or <code>"ulocal"</code>).</p>
</td></tr>
<tr><td><code id="fit_wrc_hcc_+3A_control">control</code></td>
<td>
<p>a list with options to control <code>fit_wrc_hcc</code> or a
function such as<br /> <code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code> that generates such
a list.  The main argument <code>settings</code> of <code>control_fit_wrc_hcc</code>
selects a nonlinear optimisation approach, see<br />
<code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code> and <code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code>
for full details.</p>
</td></tr>
<tr><td><code id="fit_wrc_hcc_+3A_verbose">verbose</code></td>
<td>
<p>positive integer controlling logging of diagnostic
messages to the console and plotting of data and model curves
during fitting.
</p>

<dl>
<dt><code>verbose &lt; 0</code></dt><dd><p>suppresses all output,</p>
</dd>
<dt><code>verbose &gt;= 0</code></dt><dd><p>suppresses all output except
warning messages,</p>
</dd>
<dt><code>verbose &gt;= 1</code></dt><dd><p>displays at the end the measurements along
with the fitted model curves,</p>
</dd>
<dt><code>verbose &gt;= 2</code></dt><dd><p>prints for each iteration the parameters
values, the value of the objective function and the ratio of
<code class="reqn">L_\mathrm{c}/L_\mathrm{t}</code> (see
<code><a href="#topic+evaporative-length">evaporative-length</a></code>),</p>
</dd>
<dt><code>verbose &gt;= 3</code></dt><dd><p>plots for each iteration the measurements
along with the fitted model curves.</p>
</dd>
</dl>

<p>Logging of further diagnostics during fitting is controlled in addition
by the arguments <code>print_level</code>, <code>check_derivatives</code>,
<code>check_derivatives_print</code> when <code><a href="nloptr.html#topic+nloptr">nloptr</a></code> is used
(see <code><a href="nloptr.html#topic+nloptr.print.options">nloptr.print.options</a></code> and
<code><a href="#topic+control_nloptr">control_nloptr</a></code>) and by the argument <code>trace</code> of
<code><a href="SoilHyP.html#topic+SCEoptim">SCEoptim</a></code> (see <code><a href="#topic+control_sce">control_sce</a></code>).</p>
</td></tr>
<tr><td><code id="fit_wrc_hcc_+3A_alpha">alpha</code></td>
<td>
<p>a logical scalar controlling whether the inverse air entry
pressure <code class="reqn">\alpha</code> should be estimated (<code>TRUE</code>, default) or kept
fixed at the initial value (<code>FALSE</code>) specified by <code>param</code>, see
<code><a href="#topic+wc_model">wc_model</a></code> and <code><a href="#topic+hc_model">hc_model</a></code>.</p>
</td></tr>
<tr><td><code id="fit_wrc_hcc_+3A_n">n</code></td>
<td>
<p>a logical scalar controlling whether the shape parameter <code class="reqn">n</code>
should be estimated (<code>TRUE</code>, default) or kept fixed at the initial
value (<code>FALSE</code>) specified by <code>param</code>, see
<code><a href="#topic+wc_model">wc_model</a></code> and <code><a href="#topic+hc_model">hc_model</a></code>.</p>
</td></tr>
<tr><td><code id="fit_wrc_hcc_+3A_tau">tau</code></td>
<td>
<p>a logical scalar controlling whether the tortuosity parameter
<code class="reqn">\tau</code> should be estimated (<code>TRUE</code>) or kept fixed at the initial
value (<code>FALSE</code>, default) specified by <code>param</code>, see
<code><a href="#topic+hc_model">hc_model</a></code>.</p>
</td></tr>
<tr><td><code id="fit_wrc_hcc_+3A_thetar">thetar</code></td>
<td>
<p>a logical scalar controlling whether the residual water
content <code class="reqn">\theta_r</code> should be estimated (<code>TRUE</code>, default) or kept
fixed at the initial value (<code>FALSE</code>) specified by <code>param</code>, see
<code><a href="#topic+wc_model">wc_model</a></code>.</p>
</td></tr>
<tr><td><code id="fit_wrc_hcc_+3A_thetas">thetas</code></td>
<td>
<p>a logical scalar controlling whether the saturated water
content <code class="reqn">\theta_s</code> should be estimated (<code>TRUE</code>, default) or kept
fixed at the initial value (<code>FALSE</code>) specified by <code>param</code>, see
<code><a href="#topic+wc_model">wc_model</a></code>.</p>
</td></tr>
<tr><td><code id="fit_wrc_hcc_+3A_k0">k0</code></td>
<td>
<p>a logical scalar controlling whether the saturated hydraulic
conductivity <code class="reqn">K_0</code> should be estimated (<code>TRUE</code>, default) or kept
fixed at the initial value (<code>FALSE</code>) specified by <code>param</code>, see
<code><a href="#topic+hc_model">hc_model</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>



<h4>Estimating model parameters of water retention curves and/or
hydraulic conductivity functions</h4>

<p>The function <code>fit_wrc_hcc</code> estimates model parameters of water
retention curves and/or hydraulic conductivity functions by
<em>maximum likelihood</em> (ml, default) <em>maximum posterior density</em>
(mpd) or <em>nonlinear least squares</em> (wls), see argument
<code>method</code> of <code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code>.  Measurements must
be available for at least one of the two material functions.  If one
type of data is missing then the respective <code>formula</code>,
<code>subset</code> and <code>weights</code> arguments should be omitted.
</p>
<p>If both types of data are available then measurements are weighed when
computing the residual sum of squares for wls, but unit weights are
used by default for mpd and ml estimation, see
<code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code>.  The wls weights are the product of the
<em>case weights</em> <code class="reqn">w^\prime_{\theta,i}</code> and <code class="reqn">w^\prime_{K,i}</code>
given by <code>weights</code>, <code>wrc_weights</code> and <code>hcc_weights</code>,
respectively, and the <em>variable weights</em> as specified by the
argument <code>variable_weight</code> of <code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code>.
Note that the <code>variable_weights</code> are not used &ldquo;as is&rdquo;, but they
are multiplied by the inverse variances of the water content or the
(log-transformed) conductivity data per sample to obtain the variable
weights <code class="reqn">w_\theta</code>, <code class="reqn">w_K</code> mentioned in
<code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code>.</p>



<h4>Estimating model parameters for a single or multiple soil
samples</h4>

<p>When parameters are estimated for a single soil sample only, then model
formulae are of the form <code>wc ~ head</code> and/or <code>hc ~head</code>, and
there is no need to specify a sample <code>id</code>.  In this case
<code>param</code>, <code>lower_param</code>, <code>upper_param</code>, <code>fit_param</code>
and <code>ratio_lc_lt_bound</code> are vectors and <code>e0</code> is a scalar.
</p>
<p><code>fit_wrc_hcc</code> allows to fit models to datasets containing data for
multiple soil samples.  The model formula must then be of the form
<code>wc ~ head|id</code> and/or <code>hc ~ head|id</code> where the factor
<code>id</code> identifies the soil samples.  If <code>param</code>,
<code>lower_param</code>, <code>upper_param</code>, <code>fit_param</code> and
<code>ratio_lc_lt_bound</code> are vectors and <code>e0</code> is a scalar then
this information is used for processing all the soil samples.  If
specific information per sample should be used then <code>param</code>,
<code>lower_param</code>, <code>upper_param</code>, <code>fit_param</code> and
<code>ratio_lc_lt_bound</code> must be matrices (or data frames) with as many
rows as there are soil samples.  The matrices (or data.frames) must
have rownames matching the levels of the factor <code>id</code> defining the
soil samples.  <code>e0</code> must be a named vector with as many elements
as there are soil samples and the names must again match the levels of
<code>id</code>.
</p>
<p>By default, <code>fit_wrc_hcc</code> processes data of multiple soil samples
in parallel, see <code><a href="#topic+control_pcmp">control_pcmp</a></code> for options to control
parallel computing.  Note that diagnostic output (except warning
messages) is suppressed in parallel computations.  If computations fail
for a particular soil sample, the id of the sample with the failed fit
can be extracted by the utility function
<code><a href="#topic+select_failed_fits">select_failed_fits</a></code> and the respective error messages by
<code><a href="#topic+extract_error_messages">extract_error_messages</a></code>.
</p>



<h4>Controlling <code>fit_wrc_hcc</code></h4>

<p>The argument <code>control</code> is used to pass a list of options to
<code>fit_wrc_hcc</code> that steer the function, see
<code><a href="#topic+soilhypfit-package">soilhypfit-package</a></code> and <code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code>
for full details.
</p>



<h3>Value</h3>

<p><code>fit_wrc_hcc</code> returns an object of <code><a href="base.html#topic+class">class</a></code>
<code>fit_wrc_hcc</code>, which is a list with the following components:
</p>
<table>
<tr><td><code>fit</code></td>
<td>
<p>a list with as many components as there are soils samples.
Each component is in turn a list that contains the estimated parameters
and accompanying information:
</p>

<ul>
<li><p><code>converged</code>: an integer code issued by
<code><a href="SoilHyP.html#topic+SCEoptim">SCEoptim</a></code> or <code><a href="nloptr.html#topic+nloptr">nloptr</a></code> on (non-)
convergence, see <code><a href="#topic+convergence_message">convergence_message</a></code> and
<a href="https://nlopt.readthedocs.io/en/latest/NLopt_Reference/#return-values">NLopt
return values</a>.
</p>
</li>
<li><p><code>message</code>: a character string issued by
<code><a href="SoilHyP.html#topic+SCEoptim">SCEoptim</a></code> or <code><a href="nloptr.html#topic+nloptr">nloptr</a></code> on
(non-)convergence.
</p>
</li>
<li><p><code>evaluation</code>: the number of evaluations of the objective
function and of the gradient.
</p>
</li>
<li><p><code>objective</code>: the value of the objective function
evaluated at the solution.  The contributions of the water retention
curve and the hydraulic conductivity function to <code>objective</code> are
reported as attributes <code>obj_wc</code> and <code>obj_hc</code>.  The
attributes <code>ssq_wc</code> and <code>ssq_hc</code> are the respective
residual sums of squares <code class="reqn">Q_\theta</code> and <code class="reqn">Q_K</code>, see
<code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code>.
</p>
</li>
<li><p><code>gradient</code>: the gradient of the objective function at the
solution with respect to the (possibly transformed) nonlinear parameters.
</p>
</li>
<li><p><code>lp</code>: the estimated values for the linear parameters
<code class="reqn">\boldsymbol{\mu}^\mathrm{T} =(\theta_r, \theta_s, K_0)</code>, see
<code><a href="#topic+wc_model">wc_model</a></code> and <code><a href="#topic+hc_model">hc_model</a></code>.
</p>
</li>
<li><p><code>nlp</code>: the estimated values for the nonlinear parameters
<code class="reqn">\boldsymbol{\nu}^\mathrm{T} =(\alpha, n, \tau)</code>, see <code><a href="#topic+wc_model">wc_model</a></code> and
<code><a href="#topic+hc_model">hc_model</a></code>.
</p>
</li>
<li><p><code>inequality_constraint</code>: a list with the values of the
inequality constraints evaluated at the solutions.  Currently, values
are reported for the expressions.
</p>
<p style="text-align: center;"><code class="reqn">-(\frac{L_\mathrm{c}}{L_\mathrm{t}} - l)</code>
</p>

<p style="text-align: center;"><code class="reqn">\frac{L_\mathrm{c}}{L_\mathrm{t}} - u</code>
</p>

<p>in the only component <code>lc</code>, where <code class="reqn">l</code> and <code class="reqn">u</code> are the
lower and upper bounds of the ratio, see argument
<code>ratio_lc_lt_bound</code> and <code><a href="#topic+evaporative-length">evaporative-length</a></code>.  The
values of <code class="reqn">L_\mathrm{c}</code>, <code class="reqn">L_\mathrm{t}</code>, the
imposed bounds on their ratio and <code>e0</code> are
returned as attributes of <code>lc</code>.
</p>
</li>
<li><p><code>hessian</code>: optionally the Hessian matrix of the objective
function with respect to the possibly transformed nonlinear
parameters at the solution.
</p>
</li>
<li><p><code>variable_weight</code>: a named vector with the variable
weights <code class="reqn">w_{\theta}</code> and <code class="reqn">w_{K}</code>, see <em>Details</em>.
</p>
</li>
<li><p><code>weight</code>: a list with one or two components named
<code>weights_wc</code> and or <code>weights_hc</code> with the case weights
<code class="reqn">w_{\theta,i}</code> and <code class="reqn">w_{K,i}</code> used in the objective function,
see <em>Details</em>.
</p>
</li>
<li><p><code>fitted</code>: a list with one or two components named
<code>wrc</code> and/or <code>hcc</code> with the fitted values for the water
retention and the (possibly log-transformed) hydraulic conductivity
data.
</p>
</li>
<li><p><code>residuals</code>: a list with one or two components named
<code>wrc</code> and/or <code>hcc</code> with residuals for the water retention
and the (possibly log-transformed) hydraulic conductivity data.
</p>
</li>
<li><p><code>model</code>: a list with one or two components named <code>wrc</code>
and/or <code>hcc</code> with the <code><a href="stats.html#topic+model.frame">model.frame</a></code>s for the
water retention and hydraulic conductivity data.
</p>
</li>
<li><p><code>initial_objects</code>: a list with the values for
<code>param</code>, <code>fit_param</code>, <code>variable_weight</code>,
<code>param_bound</code>, <code>e0</code> and <code>ratio_lc_lt_bound</code> as taken
from the (processed) arguments of the call of <code>fit_wrc_hcc</code>.
</p>
</li></ul>

</td></tr>
<tr><td><code>sample_id_variable</code></td>
<td>
<p>the name of the variable defining the samples.</p>
</td></tr>
<tr><td><code>wrc</code></td>
<td>
<p>logical scalar signalling whether water retention data were
used to estimate the parameters.</p>
</td></tr>
<tr><td><code>wrc_formula</code></td>
<td>
<p>formula defining the variables for water content and
hydraulic head of the water retention data (<code>NULL</code> if not <code>wrc</code>
equal to <code>FALSE</code>).</p>
</td></tr>
<tr><td><code>wrc_mf</code></td>
<td>
<p>unevaluated call of <code><a href="stats.html#topic+model.frame">model.frame</a></code> to
build the modelframe for the water retention data (<code>NULL</code> if
<code>wrc</code> equal to <code>FALSE</code>).</p>
</td></tr>
<tr><td><code>wrc</code></td>
<td>
<p>logical scalar signalling whether water retention data were
used to estimate the parameters.</p>
</td></tr>
<tr><td><code>hcc_formula</code></td>
<td>
<p>formula defining the variables for hydraulic
conductivity and hydraulic head of the hydraulic conductivity data
(<code>NULL</code> if not <code>hcc</code> equal to <code>FALSE</code>).</p>
</td></tr>
<tr><td><code>hcc_mf</code></td>
<td>
<p>unevaluated call of <code><a href="stats.html#topic+model.frame">model.frame</a></code> to
build the modelframe for the water retention data (<code>NULL</code> if
<code>hcc</code> equal to <code>FALSE</code>).</p>
</td></tr>
<tr><td><code>control</code></td>
<td>
<p>a list with the options used to control
<code>fit_wrc_hcc</code>, see <code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code>.</p>
</td></tr>
<tr><td><code>call</code></td>
<td>
<p>the matched call.</p>
</td></tr>
<tr><td><code>na.action</code></td>
<td>
<p>information returned by <code><a href="stats.html#topic+model.frame">model.frame</a></code>
on the special handling of <code>NA</code>s.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Andreas Papritz <a href="mailto:papritz@retired.ethz.ch">papritz@retired.ethz.ch</a>.
</p>


<h3>References</h3>

<p>Duan, Q., Sorooshian, S., and Gupta, V. K. (1994) Optimal use of the
SCE-UA global optimisation method for calibrating watershed models,
<em>Journal of Hydrology</em> <b>158</b>, 265&ndash;284,
<a href="https://doi.org/10.1016/0022-1694%2894%2990057-4">doi:10.1016/0022-1694(94)90057-4</a>.
</p>
<p>Johnson, S.G. The NLopt nonlinear-optimisation package.
<a href="https://github.com/stevengj/nlopt">https://github.com/stevengj/nlopt</a>.
</p>
<p>Lehmann, P., Assouline, S., Or, D. (2008) Characteristic lengths
affecting evaporative drying of porous media.  <em>Physical Review E</em>,
<b>77</b>, 056309, <a href="https://doi.org/10.1103/PhysRevE.77.056309">doi:10.1103/PhysRevE.77.056309</a>.
</p>
<p>Lehmann, P., Bickel, S., Wei, Z., Or, D. (2020) Physical Constraints for
Improved Soil Hydraulic Parameter Estimation by Pedotransfer Functions.
<em>Water Resources Research</em> <b>56</b>, e2019WR025963,
<a href="https://doi.org/10.1029/2019WR025963">doi:10.1029/2019WR025963</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code> for a description of the models and a brief
summary of the parameter estimation approach;
</p>



<p><code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code> for options to control
<code>fit_wrc_hcc</code>;
</p>
<p><code><a href="#topic+soilhypfitmethods">soilhypfitmethods</a></code> for common S3 methods for class
<code>fit_wrc_hcc</code>;
</p>
<p><code><a href="#topic+vcov">vcov</a></code> for computing (co-)variances of the estimated
nonlinear parameters;
</p>
<p><code><a href="#topic+prfloglik_sample">prfloglik_sample</a></code> for profile loglikelihood
computations;
</p>
<p><code><a href="#topic+wc_model">wc_model</a></code> and <code><a href="#topic+hc_model">hc_model</a></code> for currently
implemented models for soil water retention curves and hydraulic
conductivity functions;
</p>
<p><code><a href="#topic+evaporative-length">evaporative-length</a></code> for physically constraining parameter
estimates of soil hydraulic material functions.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# use of \donttest{} because execution time exceeds 5 seconds

data(sim_wrc_hcc)

# define number of cores for parallel computations
if(interactive()) ncpu &lt;- parallel::detectCores() - 1L else ncpu &lt;- 1L


# estimate parameters for single sample ...

#  ... from wrc and hcc data
plot(rfit_wrc_hcc &lt;- fit_wrc_hcc(
  wrc_formula = wc ~ head, hcc_formula = hc ~ head,
  data = sim_wrc_hcc, subset = id == 1))
coef(rfit_wrc_hcc, gof = TRUE)

#  ... from wrc data
plot(rfit_wrc &lt;- fit_wrc_hcc(
  wrc_formula = wc ~ head,
  data = sim_wrc_hcc, subset = id == 1))
coef(rfit_wrc, gof = TRUE)

#  ... from  hcc data
plot(rfit_hcc &lt;- fit_wrc_hcc(
  hcc_formula = hc ~ head,
  data = sim_wrc_hcc, subset = id == 1))
coef(rfit_hcc, gof = TRUE)

# ... from wrc and hcc data
#     keeping some parameters fixed
plot(rfit_wrc_hcc_fixed &lt;- fit_wrc_hcc(
  wrc_formula = wc ~ head, hcc_formula = hc ~ head,
  data = sim_wrc_hcc, subset = id == 1,
  param = c(alpha = 2.1, thetar = 0.1),
  fit_param = default_fit_param(alpha = FALSE, thetar = FALSE)),
  y = rfit_wrc_hcc)
coef(rfit_wrc_hcc, gof = TRUE)
coef(rfit_wrc_hcc_fixed, gof = TRUE)


# estimate parameters for 3 samples simultaneously by ...

# ... unconstrained, global optimisation algorithm NLOPT_GN_MLSL (default)
rfit_uglob &lt;- fit_wrc_hcc(
  wrc_formula = wc ~ head | id, hcc_formula = hc ~ head | id,
  data = sim_wrc_hcc,
  control = control_fit_wrc_hcc(pcmp = control_pcmp(ncores = ncpu)))
summary(rfit_uglob)
op &lt;- par(mfrow = c(3, 2))
plot(rfit_uglob)
on.exit(par(op))

# ... unconstrained, global optimisation algorithm SCEoptim
rfit_sce &lt;- update(
  rfit_uglob,
  control = control_fit_wrc_hcc(
    settings = "sce", pcmp = control_pcmp(ncores = ncpu)))
coef(rfit_sce, gof = TRUE, lc = TRUE)
convergence_message(2, sce = TRUE)
op &lt;- par(mfrow = c(3, 2))
plot(rfit_sce, y = rfit_uglob)
on.exit(par(op))

# ... unconstrained, local optimisation algorithm NLOPT_LN_BOBYQA,
#     logging iteration results to console
rfit_uloc &lt;- update(
  rfit_uglob,
  param = as.matrix(coef(rfit_uglob, what = "nonlinear")),
  control = control_fit_wrc_hcc(
    settings = "ulocal", pcmp = control_pcmp(ncores = 1L)),
  verbose = 2)
coef(rfit_uloc, gof = TRUE, lc = TRUE)

# ... constrained, global optimisation algorithm NLOPT_GN_ISRES
rfit_cglob &lt;- update(
  rfit_uglob,
  ratio_lc_lt_bound = c(lower = 0.8, upper = 1.2),
  control = control_fit_wrc_hcc(
    settings = "cglobal", nloptr = control_nloptr(ranseed = 1),
    pcmp = control_pcmp(ncores = ncpu)))
coef(rfit_cglob, gof = TRUE, lc = TRUE)

# ... constrained, local optimisation algorithm NLOPT_LD_CCSAQ
#     starting from unconstrained, locally fitted initial values
rfit_cloc_1 &lt;- update(
  rfit_uglob,
  param = coef(rfit_uloc, what = "nonlinear"),
  ratio_lc_lt_bound = c(lower = 0.8, upper = 1.2),
  control = control_fit_wrc_hcc(
    settings = "clocal", pcmp = control_pcmp(ncores = ncpu)))
coef(rfit_cloc_1, gof = TRUE, lc = TRUE)
op &lt;- par(mfrow = c(3, 2))
plot(x = rfit_uloc, y = rfit_cloc_1)
on.exit(par(op))

# ... constrained, local optimisation algorithm NLOPT_LD_CCSAQ
#     starting from constrained, globally fitted initial values,
#     using sample-specific evaporation rates and limits for ratio lc/lt
rfit_cloc_2 &lt;- update(
  rfit_uglob,
  param = as.matrix(coef(rfit_cglob, what = "nonlinear")),
  e0 = c("1" = 0.002, "2" = 0.0025, "3" = 0.003),
  ratio_lc_lt_bound = rbind(
    "1" = c(lower = 0.7, upper = 2),
    "2" = c(lower = 0.8, upper = 1.4),
    "3" = c(lower = 0.8, upper = 2)
  ),
  control = control_fit_wrc_hcc(
    settings = "clocal", pcmp = control_pcmp(ncores = ncpu)))
coef(rfit_cloc_2, gof = TRUE, lc = TRUE, e0 = TRUE)

# ... global optimisation algorithm NLOPT_GN_MLSL
#     with sample-specific box-constraints

rfit_uglob_bc &lt;- update(
  rfit_uglob,
  lower_param = rbind(
    "1" = c(alpha = 2.4, n = 1.11, thetar = 0.2, thetas = 0.6),
    "2" = c(alpha = 1.2, n = 1.12, thetar = 0.2, thetas = 0.6),
    "3" = c(alpha = 1.2, n = 1.13, thetar = 0.2, thetas = 0.6)
  ),
  upper_param = rbind(
    "1" = c(alpha = 20.1, n = 2.51, thetar = 0.6, thetas = 0.6),
    "2" = c(alpha = 20.2, n = 1.5,  thetar = 0.6, thetas = 0.6),
    "3" = c(alpha = 1.3, n = 2.53,  thetar = 0.6, thetas = 0.6)
  )
)
coef(rfit_uglob, gof = TRUE)
coef(rfit_uglob_bc, gof = TRUE)

</code></pre>

<hr>
<h2 id='hc_model'>
Models for Soil Hydraulic Conductivity Functions
</h2><span id='topic+hc_model'></span><span id='topic+hcrel_model'></span><span id='topic+hc_model'></span>

<h3>Description</h3>

<p>The functions <code>hc_model</code> and <code>hcrel_model</code> compute, for given
capillary pressure head <code class="reqn">h</code>, the <em>hydraulic conductivity</em>
<code class="reqn">K(h)</code> and the <em>relative hydraulic conductivity</em> <code class="reqn">k(h)</code>
respectively, of a soil by parametrical models.  </p>


<h3>Usage</h3>

<pre><code class='language-R'>hcrel_model(h, nlp, precBits = NULL, hcc_model = "vgm")

hc_model(h, nlp, lp, precBits = NULL, hcc_model = "vgm")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hc_model_+3A_h">h</code></td>
<td>
<p>a mandatory numeric vector with values of capillary pressure
head for which to compute the hydraulic conductivity.  For consistency
with other quantities, the unit of  head should be <b>meter</b>
[m].</p>
</td></tr>
<tr><td><code id="hc_model_+3A_nlp">nlp</code></td>
<td>
<p>a mandatory named numeric vector, currently with elements
named <code>"alpha"</code>, <code>"n"</code> and <code>"tau"</code>, which are the
<em>nonlinear</em> parameters <code class="reqn">\boldsymbol{\nu}^\mathrm{T} = (\alpha, n, \tau)</code>, where
<code class="reqn">\alpha</code>, <code class="reqn">n</code> and <code class="reqn">\tau</code> are the inverse air entry pressure,
the shape and the tortuosity parameters, see <em>Details</em>.  For
consistency with other quantities, the unit of <code class="reqn">\alpha</code> should be
<b>1/meter</b> [<code class="reqn">\mathrm{m}^{-1}</code>].</p>
</td></tr>
<tr><td><code id="hc_model_+3A_lp">lp</code></td>
<td>
<p>a mandatory named numeric vector, currently with a single
element named <code>"k0"</code>, which is the saturated hydraulic conductivity
<code class="reqn">K_0</code>, the only <em>linear</em> parameter of the model, see
<em>Details</em>.  For consistency with other quantities, the unit of
<code class="reqn">K_0</code> should be <b>meter/day</b> [<code class="reqn">\mathrm{m}\,\mathrm{d}^{-1}</code>].</p>
</td></tr>
<tr><td><code id="hc_model_+3A_precbits">precBits</code></td>
<td>
<p>an optional integer scalar defining the maximal precision
(in bits) to be used in high-precision computations by
<code><a href="Rmpfr.html#topic+mpfr">mpfr</a></code>.  If equal to <code>NULL</code> (default) then
<code><a href="Rmpfr.html#topic+mpfr">mpfr</a></code> is not used and the result of the function call
is of storage mode <code>double</code>, see <code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code>.</p>
</td></tr>
<tr><td><code id="hc_model_+3A_hcc_model">hcc_model</code></td>
<td>
<p>a keyword denoting the parametrical model for the
hydraulic conductivity function.  Currently, only the <em>Van
Genuchten-Mualem</em> model (<code>wrc_model = "vgm"</code>) is implemented, see
<em>Details</em>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The functions <code>hcrel_model</code> and <code>hc_model</code> currently model soil
hydraulic conductivity functions only by the simplified form of the Van
Genuchten-Mualem model (<cite>Van Genuchten, 1980</cite>) with the restriction
<code class="reqn">m = 1 - \frac{1}{n}</code>, i.e. by

</p>
<p style="text-align: center;"><code class="reqn">
  k_\mathrm{VGM}(h; \boldsymbol{\nu}) =
    S_\mathrm{VG}(h; \boldsymbol{\nu})^\tau \,
    \left[
      1 - \left(
        1 - S_\mathrm{VG}(h; \boldsymbol{\nu})^\frac{n}{n-1}
      \right)^\frac{n-1}{n}
    \right]^2,
</code>
</p>


<p style="text-align: center;"><code class="reqn">
  K_\mathrm{VGM}(h; \mbox{$\mu$}, \boldsymbol{\nu}) =
  K_0 \, k_\mathrm{VGM}(h; \boldsymbol{\nu}),
</code>
</p>


<p>where <code class="reqn">\mu = K_0</code> is the saturated hydraulic conductivity (<code class="reqn">K_0 &gt;
0</code>),
<code class="reqn">\boldsymbol{\nu}^\mathrm{T} = (\alpha, n, \tau)</code> are the inverse air entry pressure
(<code class="reqn">\alpha &gt; 0</code>), the shape (<code class="reqn">n &gt; 1</code>) and tortuosity parameter
(<code class="reqn">\tau &gt; -2</code>), and <code class="reqn">S_\mathrm{VG}(h;
\boldsymbol{\nu})</code> is the the volumetric
water saturation, see <code>sat_model</code> for an expression.
</p>
<p>Note that <code class="reqn">\mu</code> and <code class="reqn">\boldsymbol{\nu}^\mathrm{} </code> are passed to the functions by
the arguments <code>lp</code> and <code>nlp</code>, respectively.</p>


<h3>Value</h3>

<p>A numeric vector with values of (relative) hydraulic conductivity.
</p>


<h3>Author(s)</h3>

<p>Andreas Papritz <a href="mailto:papritz@retired.ethz.ch">papritz@retired.ethz.ch</a>.
</p>


<h3>References</h3>

<p>Van Genuchten, M. Th.  (1980) A closed-form equation for predicting the
hydraulic conductivity of unsaturated soils. <em>Soil Science Society of
America Journal</em>, <b>44</b>, 892&ndash;898,
<a href="https://doi.org/10.2136/sssaj1980.03615995004400050002x">doi:10.2136/sssaj1980.03615995004400050002x</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code> for a description of the models and a brief
summary of the parameter estimation approach;
</p>
<p><code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code> for (constrained) estimation of parameters of
models for soil water retention and hydraulic conductivity data;
</p>
<p><code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code> for options to control
<code>fit_wrc_hcc</code>;
</p>
<p><code><a href="#topic+soilhypfitmethods">soilhypfitmethods</a></code> for common S3 methods for class
<code>fit_wrc_hcc</code>;
</p>
<p><code><a href="#topic+vcov">vcov</a></code> for computing (co-)variances of the estimated
nonlinear parameters;
</p>




<p><code><a href="#topic+evaporative-length">evaporative-length</a></code> for physically constraining parameter
estimates of soil hydraulic material functions.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## define capillary pressure head (unit meters)
h &lt;- c(0.01, 0.1, 0.2, 0.3, 0.5, 1., 2., 5.,10.)

## compute (relative) hydraulic conductivity
hcrel &lt;- hcrel_model(h, nlp = c(alpha = 1.5, n = 2, tau = 0.5))
hc &lt;- hc_model(h, nlp = c(alpha = 1.5, n = 2, tau = 0.5), lp = c(k0 = 5))

## display hydraulic conductivity function
op &lt;- par(mfrow = c(1, 2))
plot(hcrel ~ h, log = "xy", type = "l")
plot(hc ~ h, log = "xy", type = "l")
on.exit(par(op))
</code></pre>

<hr>
<h2 id='internal_functions'>Internal Functions of Package <span class="pkg">soilhypfit</span></h2><span id='topic+d1ineq_constraint_nlp'></span><span id='topic+d1l0'></span><span id='topic+d1lc'></span><span id='topic+estimate_lp'></span><span id='topic+estimate_nlp'></span><span id='topic+fit_wrc_hcc_fit'></span><span id='topic+gradient_nlp'></span><span id='topic+ineq_constraint_nlp'></span><span id='topic+model_names_nlp_lp'></span><span id='topic+model_fit_param_consistent'></span><span id='topic+model_param_tf_nlp_identity'></span><span id='topic+objective_nlp'></span><span id='topic+stop_cluster'></span>

<h3>Description</h3>

<p>The unexported internal functions
</p>

<ul>
<li><p><code>d1ineq_constraint_nlp</code>
</p>
</li>
<li><p><code>d1l0</code>
</p>
</li>
<li><p><code>d1lc</code>
</p>
</li>
<li><p><code>estimate_lp</code>
</p>
</li>
<li><p><code>estimate_nlp</code>
</p>
</li>
<li><p><code>fit_wrc_hcc_fit</code>
</p>
</li>
<li><p><code>gradient_nlp</code>
</p>
</li>
<li><p><code>ineq_constraint_nlp</code>
</p>
</li>
<li><p><code>model_names_nlp_lp</code>
</p>
</li>
<li><p><code>model_fit_param_consistent</code>
</p>
</li>
<li><p><code>model_param_tf_nlp_identity</code>
</p>
</li>
<li><p><code>objective_nlp</code>
</p>
</li>
<li><p><code>stop_cluster</code>
</p>
</li></ul>

<p>are not intended for direct use.  However, as any unexported function, they
can be accessed by typing <code>soilhypfit:::<var>function-name</var></code>.
</p>


<h3>Author(s)</h3>

<p>Andreas Papritz <a href="mailto:papritz@retired.ethz.ch">papritz@retired.ethz.ch</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code> for a description of the models and a brief
summary of the parameter estimation approach;
</p>
<p><code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code> for (constrained) estimation of parameters of
models for soil water retention and hydraulic conductivity data;
</p>
<p><code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code> for options to control
<code>fit_wrc_hcc</code>;
</p>
<p><code><a href="#topic+soilhypfitmethods">soilhypfitmethods</a></code> for common S3 methods for class
<code>fit_wrc_hcc</code>;
</p>
<p><code><a href="#topic+vcov">vcov</a></code> for computing (co-)variances of the estimated
nonlinear parameters;
</p>
<p><code><a href="#topic+prfloglik_sample">prfloglik_sample</a></code> for profile loglikelihood
computations;
</p>
<p><code><a href="#topic+wc_model">wc_model</a></code> and <code><a href="#topic+hc_model">hc_model</a></code> for currently
implemented models for soil water retention curves and hydraulic
conductivity functions;
</p>
<p><code><a href="#topic+evaporative-length">evaporative-length</a></code> for physically constraining parameter
estimates of soil hydraulic material functions.
</p>

<hr>
<h2 id='profile_loglikelihood'>
Profile Loglikelihoods and Confidence Intervals for
Parametric Modelling of Soil Hydraulic Properties</h2><span id='topic+prfloglik_sample'></span><span id='topic+confint_prfloglik_sample'></span><span id='topic+confint.fit_wrc_hcc'></span>

<h3>Description</h3>

<p>The function <code>prfloglik_sample</code> computes for a single soil sample a
loglikelihood profile as a function of the specified values for subsets
of model parameters of soil water retention and/or soil hydraulic
conductivity functions.  The function <code>confint_prfloglik_sample</code>
computes a confidence interval of one model parameter based on the
likelihood ratio test for a single soil sample, and the S3 method
<code>confint</code> computes confidence intervals of <em>nonlinear</em>
model parameters for multiple soil samples.</p>


<h3>Usage</h3>

<pre><code class='language-R'>prfloglik_sample(object, values, soil_sample,
    ncores = min(detectCores() - 1L, NROW(values)), verbose = 0)

confint_prfloglik_sample(object, parm = names(default_fit_param()),
    soil_sample, level = 0.95, test = c("F", "Chisq"),
    denominator_df = c("nonlinear", "all"), param_bound = NULL,
    root_tol = .Machine$double.eps^0.25, froot_tol = sqrt(root_tol),
    verbose = 0)

## S3 method for class 'fit_wrc_hcc'
confint(object,
    parm = names(object[["control"]][["initial_param"]]), level = 0.95,
    subset = NULL, type = c("loglik", "normal"), test = c("F", "Chisq"),
    denominator_df = c("nonlinear", "all"),
    root_tol = .Machine$double.eps^0.25, froot_tol = sqrt(root_tol),
    ncores = detectCores() - 1L, verbose = 0, ...)

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="profile_loglikelihood_+3A_object">object</code></td>
<td>
<p>an object of class <code>fit_wrc_hcc</code>, see
<code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code>.</p>
</td></tr>
<tr><td><code id="profile_loglikelihood_+3A_values">values</code></td>
<td>
<p>a <code>data.frame</code> or a <code>matrix</code> with the values of
the conditionally linear (<code class="reqn">\boldsymbol{\mu}^\mathrm{} </code>) and nonlinear parameters
(<code class="reqn">\boldsymbol{\nu}^\mathrm{} </code>) that should be kept fixed to compute the likelihood
profile (mandatory argument, see <code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code>,
<code><a href="#topic+wc_model">wc_model</a></code> and <code><a href="#topic+hc_model">hc_model</a></code> for information about
the parametrization of models for soil water retention curves and/or soil
hydraulic conductivity functions.).  The names of the columns of
<code>values</code> must match the names of model parameters.</p>
</td></tr>
<tr><td><code id="profile_loglikelihood_+3A_soil_sample">soil_sample</code></td>
<td>
<p>a character scalar with the label of the soil sample
for which the loglikelihood profile or the confidence interval should be
computed.  If <code>object</code> contains parameter estimates for a single
soil sample then <code>soil_sample</code> is ignored, otherwise
<code>soil_sample</code> is a mandatory argument.</p>
</td></tr>
<tr><td><code id="profile_loglikelihood_+3A_ncores">ncores</code></td>
<td>
<p>an integer defining the number of cores for parallel
computations.  <code>ncores = 1</code> suppresses parallel computations.</p>
</td></tr>
<tr><td><code id="profile_loglikelihood_+3A_verbose">verbose</code></td>
<td>
<p>positive integer controlling logging of diagnostic
messages to the console and plotting of data and model curves
during fitting, see <code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code>.</p>
</td></tr>
<tr><td><code id="profile_loglikelihood_+3A_parm">parm</code></td>
<td>
<p>character scalar (<code>confint_prfloglik_sample</code>) or vector
(<code>confint</code>) with name(s) of parameter(s) for which to compute the
confidence interval(s).  Note that <code>confint_prfloglik_sample</code> allows
to compute a confidence interval for <em>all</em> parameters (including the
linear ones), whereas the <code>confint</code> method computes confidence
intervals for the <em>nonlinear</em> parameters (<code class="reqn">\boldsymbol{\nu}^\mathrm{} </code>) only,
see <code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code> for information about the
parametrization of models for soil water retention curves and/or soil
hydraulic conductivity functions.</p>
</td></tr>
<tr><td><code id="profile_loglikelihood_+3A_level">level</code></td>
<td>
<p>numeric scalar with the confidence level
required to compute the confidence interval.</p>
</td></tr>
<tr><td><code id="profile_loglikelihood_+3A_test">test</code></td>
<td>
<p>character keyword specifying whether to use the asymptotic
<code class="reqn">\chi^2</code>-distribution or the finite sample approximate F-distribution
for the likelihood ratio test statistic when computing the confidence
interval, see <em>Details</em>.</p>
</td></tr>
<tr><td><code id="profile_loglikelihood_+3A_denominator_df">denominator_df</code></td>
<td>
<p>character keyword specifying whether the
denominator degrees of freedom for the F-distribution of the test
statistic is equal to the number of estimated <em>nonlinear</em> parameters
(<code>"nonlinear"</code>, default) or equal to the total number of estimated
parameters (<code>"all"</code>).</p>
</td></tr>
<tr><td><code id="profile_loglikelihood_+3A_param_bound">param_bound</code></td>
<td>
<p>a numeric vector of length 2 with the allowed range of
the parameter for which the confidence interval is computed.  The limits
of the confidence interval are searched within this range, see
<em>Details</em>.  When equal to <code>NULL</code> (default) <code>param_bound</code>
is taken from to component <code>initial_objects</code> of the selected
component <code>fit</code> of <code>object</code>, see <em>Details</em>.</p>
</td></tr>
<tr><td><code id="profile_loglikelihood_+3A_root_tol">root_tol</code></td>
<td>
<p>a numeric scalar defining the desired accuracy (convergence
tolerance) for root finding by <code><a href="stats.html#topic+uniroot">uniroot</a></code> when
computing the confidence interval.</p>
</td></tr>
<tr><td><code id="profile_loglikelihood_+3A_froot_tol">froot_tol</code></td>
<td>
<p>a numeric scalar defining the desired accuracy (function
value tolerance) for deciding whether a root has been found.</p>
</td></tr>
<tr><td><code id="profile_loglikelihood_+3A_subset">subset</code></td>
<td>
<p>an integer, character or logical vector to the choose the
soil samples for which confidence intervals should be computed.  Defaults
to <code>NULL</code> which computes the intervals for all samples contained in
<code>object</code>.</p>
</td></tr>
<tr><td><code id="profile_loglikelihood_+3A_type">type</code></td>
<td>
<p>character keyword specifying whether to compute confidence
intervals based on the likelihood ratio test (<code>"logik"</code>, default) by
<code>confint_prfloglik_sample</code> or based on the asymptotic normal
distribution of maximum likelihood estimates (<code>"normal"</code>), see
<em>Details</em>.</p>
</td></tr>
<tr><td><code id="profile_loglikelihood_+3A_...">...</code></td>
<td>
<p>additional arguments passed to methods, currently not used.</p>
</td></tr>
</table>


<h3>Details</h3>



<h4>Computing likelihood profiles</h4>

<p>The function <code>prfloglik_sample</code> computes the loglikelihood profile
for a subset of the nonlinear (<code class="reqn">\boldsymbol{\nu}^\mathrm{} </code>) (and linear
<code class="reqn">\boldsymbol{\mu}^\mathrm{} </code>) model parameters.  We denote the profiling
parameters of interest by <code class="reqn">\boldsymbol{\phi}</code>
and the nuisance parameters that are estimated when computing the
profile by <code class="reqn">\boldsymbol{\psi}</code>, so that
<code class="reqn">
      (
        \boldsymbol{\phi}^\mathrm{T},
        \boldsymbol{\psi}^\mathrm{T}
      )^\mathrm{T}
    </code>
is a rearranged version of the parameter vector
<code class="reqn">
      (
        \boldsymbol{\mu}^\mathrm{T},
        \boldsymbol{\nu}^\mathrm{T}
      )^\mathrm{T}
    </code>, see <code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code>.
<code>prfloglik_sample</code> computes the estimates
<code class="reqn">
      \widehat{\boldsymbol{\psi}}(\boldsymbol{\phi})
    </code>
of <code class="reqn">\boldsymbol{\psi}</code>
and the profile loglikelihood
<code class="reqn">
      Q(\boldsymbol{\phi},
        \widehat{\boldsymbol{\psi}}(\boldsymbol{\phi});
        \boldsymbol{\theta}, \boldsymbol{K},
        \boldsymbol{h}
      )
    </code>
as a function of <code class="reqn">\boldsymbol{\phi}</code>.
</p>
<p>To compute the estimates,
<code class="reqn">\boldsymbol{\psi}</code>
is partitioned into the nonlinear and conditionally linear parameters, see
<code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code> for details.
<code>prfloglik_sample</code> uses the packages <span class="pkg">parallel</span> and
<span class="pkg">snowfall</span> for parallelized computation of loglikelihood
profiles.
</p>



<h4>Computing likelihood based confidence intervals</h4>

<p>The function <code>confint_prfloglik_sample</code> computes the
confidence interval of a single model parameter
<code class="reqn">
      \phi \in (
        \boldsymbol{\mu}^\mathrm{T},
        \boldsymbol{\nu}^\mathrm{T}
      )^\mathrm{T}
    </code>
based on the likelihood ratio test.
The interval is computed by assuming either
</p>

<ul>
<li><p>  that the test statistic
<code class="reqn">
        T(\phi) = \Delta Q(\phi) = 2(
        Q(\widehat{\phi},
        \widehat{\boldsymbol{\psi}};
        \boldsymbol{\theta}, \boldsymbol{K},
        \boldsymbol{h}
        ) -
        Q(\phi,
        \widehat{\boldsymbol{\psi}}(\phi);
        \boldsymbol{\theta}, \boldsymbol{K},
        \boldsymbol{h}
      ))
      </code>
follows a <code class="reqn">\chi^2_1</code>-distribution with 1 degrees of freedom
(possible choice when both water retention and/or
hydraulic conductivity data were used to estimate the parameters), or
</p>
</li>
<li><p> that the transformed test statistic
<code class="reqn">
        T(\phi) = \left(\exp(\Delta Q(\phi) / n) - 1 \right) (n - p)
      </code>
follows an <code class="reqn">F(1,n-p)</code>-distribution where <code class="reqn">n</code> is the number of
water content or hydraulic conductivity measurements, and <code class="reqn">p</code> is
the number of estimated parameters (see Uusipaikka,
2008, p. 115, for details).  <code>denominator_df</code> allows to control
how <code class="reqn">p</code> is chosen. Note that this test distribution can
only be chosen (and is then the default) when only water retention or
only hydraulic conductivty data were used to estimate the parameters.
</p>
</li></ul>

<p><code>confint_prfloglik_sample</code> computes profile loglikelihoods
<code class="reqn">
      Q(\phi,
        \widehat{\boldsymbol{\psi}}(\phi);
        \boldsymbol{\theta}, \boldsymbol{K},
        \boldsymbol{h}
      )
    </code>
by<br /> <code>prfloglik_sample</code>
and then uses <code><a href="stats.html#topic+uniroot">uniroot</a></code> to search the roots
of the equation
</p>
<p style="text-align: center;"><code class="reqn">
      f(\phi) = q_T(\gamma)- T(\phi)
    </code>
</p>

<p>in the interval defined by <code>param_bound</code>. <code class="reqn">q_T(\gamma)</code> is
the <code class="reqn">\gamma</code>-quantile of the chosen test distribution for <code class="reqn">T</code>.
</p>



<h4>Computing confidence intervals for several soil samples</h4>

<p>The <code>confint</code> method computes 2 types of confidence intervals (in
dependence of <code>type</code>) of only the nonlinear parameters
<code class="reqn">\boldsymbol{\nu}^\mathrm{} </code>, possibly for
multiple soil samples at the same time:
</p>

<ul>
<li><p> intervals based on the asymptotic normal distribution
of maximum likelihood estimates with standard errors computed by the
<code>vcov</code> method for class <code>fit_wrc_hcc</code> (see
<code><a href="#topic+vcov.fit_wrc_hcc">vcov.fit_wrc_hcc</a></code>,
</p>
</li>
<li><p> intervals based on the likelihood ratio test by
<code>confint_prfloglik_sample</code>.  The intervals for several soil
samples are computed in parallel.
</p>
</li></ul>




<h4>Requirements for computing loglikelihood profiles</h4>

<p>The parameters contained in <code>object</code> must be estimated by maximum
likelihood (<code>method = "ml"</code>, see <code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code> and
<code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code>.  Use of other estimation methods
results an error.
</p>
<p>Preferably an unconstrained local algorithm (<code>settings =
    "ulocal"</code>, see <code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code> and
<code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code>)) is used for minimizing the negative
loglikelihood when generating <code>object</code>.  Use of other algorithms
generates a warning message.
</p>



<h3>Value</h3>

<p>The function <code>prfloglik_sample</code> returns a <code>data.frame</code>
with the columns of <code>values</code> (parameters of interest
<code class="reqn">\boldsymbol{\phi}</code>),
a column <code>loglik</code> with the
maximized profile loglikelihood
<code class="reqn">Q(\phi,
        \widehat{\boldsymbol{\psi}}(\phi);
        \boldsymbol{\theta}, \boldsymbol{K},
        \boldsymbol{h}
      )
  </code>, columns with the estimated parameters
<code class="reqn">
      \widehat{\boldsymbol{\psi}}(\boldsymbol{\phi})
    </code>,
columns with the gradient of the loglikelihood with respect to the
estimated nonlinear parameters (missing if all nonlinear parameters were
fixed) and a column <code>converged</code>, indicating whether convergence has
occurred (see <code><a href="#topic+convergence_message">convergence_message</a></code>) when estimating the
nonlinear parameters (equal to <code>NA</code> when all nonlinear parameters
are fixed).
</p>
<p>The function <code>confint_prfloglik_sample</code> returns a numeric
vector of length 2 with the lower and upper limits of the confidence
interval.  If no roots were found then <code>NA</code> is returned.  The
returned result further contains as attribute list <code>prfloglik</code>
the parameter estimate <code class="reqn">\widehat{\phi}</code>
(<code>param_estimate</code>), the maximized loglikelihood
<code class="reqn">
    Q(\widehat{\phi},
        \widehat{\boldsymbol{\psi}};
        \boldsymbol{\theta}, \boldsymbol{K},
        \boldsymbol{h}
    )
  </code> (<code>loglik</code>), the quantile of the test distribution
<code class="reqn">q_{\mathrm{test}}(\gamma)</code> (<code>qtest</code>),
the type of test distribution used (<code>test</code>),
the significance <code>level</code>, the number
of water content (<code>nobs_wrc</code>) and conductivity measurements
(<code>nobs_hcc</code>) and the function values of <code class="reqn">f(\phi)</code>
evaluated at the roots returned by <code><a href="stats.html#topic+uniroot">uniroot</a></code>.
</p>
<p>The method <code>confint</code> returns a dataframe with the lower and upper
limits of the confidence intervals for the estimated nonlinear
parameters.
</p>


<h3>Author(s)</h3>

<p>Andreas Papritz <a href="mailto:papritz@retired.ethz.ch">papritz@retired.ethz.ch</a>.
</p>


<h3>References</h3>

<p>Uusipaikka, E. (2008) Confidence Intervals in Generalized Regression Models.
Chapman &amp; Hall/CRC Press, Boca Raton <a href="https://doi.org/10.1201/9781420060386">doi:10.1201/9781420060386</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code> for a description of the models and a brief
summary of the parameter estimation approach;
</p>
<p><code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code> for (constrained) estimation of parameters of
models for soil water retention and hydraulic conductivity data;
</p>
<p><code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code> for options to control
<code>fit_wrc_hcc</code>;
</p>
<p><code><a href="#topic+soilhypfitmethods">soilhypfitmethods</a></code> for common S3 methods for class
<code>fit_wrc_hcc</code>;
</p>
<p><code><a href="#topic+vcov">vcov</a></code> for computing (co-)variances of the estimated
nonlinear parameters;
</p>



<p><code><a href="#topic+wc_model">wc_model</a></code> and <code><a href="#topic+hc_model">hc_model</a></code> for currently
implemented models for soil water retention curves and hydraulic
conductivity functions;
</p>
<p><code><a href="#topic+evaporative-length">evaporative-length</a></code> for physically constraining parameter
estimates of soil hydraulic material functions.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# use of \donttest{} because execution time exceeds 5 seconds

library(lattice)

data(sim_wrc_hcc)

# define number of cores for parallel computations
if(interactive()) ncpu &lt;- parallel::detectCores() - 1L else ncpu &lt;- 1L

# estimate parameters for 3 samples simultaneously by ...

# ... unconstrained, global optimisation algorithm NLOPT_GN_MLSL (default)
rfit_uglob &lt;- fit_wrc_hcc(
  wrc_formula = wc ~ head | id, hcc_formula = hc ~ head | id,
  data = sim_wrc_hcc,
  control = control_fit_wrc_hcc(param_bound = param_boundf(
      alpha = c(0.00001, 50), n = c(1.0001, 7), tau = c(-1, 5)
    ), pcmp = control_pcmp(ncores = ncpu)))

# ... unconstrained, local optimisation algorithm NLOPT_LN_BOBYQA,
rfit_uloc &lt;- update(
  rfit_uglob,
  param = as.matrix(coef(rfit_uglob, what = "nonlinear")),
  control = control_fit_wrc_hcc(
    settings = "ulocal", param_tf = param_transf(
      alpha = "identity", n = "identity", tau = "identity"
    ), param_bound = param_boundf(
      alpha = c(0.00001, 50), n = c(1.0001, 7), tau = c(-1, 5)
    ), pcmp = control_pcmp(ncores = ncpu)))

# extract estimated parameters for sample id == "1"
coef_id_1 &lt;- unlist(coef(rfit_uloc, gof = TRUE, se = TRUE, subset = "1"))

# compute loglikelihood profile of parameter alpha for sample id == "1"
rprfloglik_alpha &lt;- prfloglik_sample(
  rfit_uloc, values = data.frame(alpha = seq(1.5, 3.0, length = 40L)),
  soil_sample = "1", ncores = ncpu)
# plot loglikelihood profile along with 95% confidence intervals
plot(loglik ~ alpha, rprfloglik_alpha, type = "l")
abline(v = coef_id_1["alpha"])
# 95% confidence intervall based on likelihood ratio test
abline(h = -coef_id_1["obj"] - 0.5 * qchisq(0.95, 1), lty = "dashed")
# 95% confidence intervall based on asymptotic normal distribution
segments(
  x0 = coef_id_1["alpha"] + qnorm(0.025) * coef_id_1["se.alpha"],
  x1 = coef_id_1["alpha"] + qnorm(0.975) * coef_id_1["se.alpha"],
  y0 = min(rprfloglik_alpha$loglik)
)

# compute loglikelihood profile of parameter n for sample id == "1"
rprfloglik_n &lt;- prfloglik_sample(
  rfit_uloc, values = data.frame(n = seq(1.7, 2.25, length = 40L)),
  soil_sample = "1", ncores = ncpu
)
# plot loglikelihood profile along with 95% confidence intervals
plot(loglik ~ n, rprfloglik_n, type = "l")
abline(v = coef_id_1["n"])
# 95% confidence intervall based on likelihood ratio test
abline(h = -coef_id_1["obj"] - 0.5 * qchisq(0.95, 1), lty = "dashed")
# 95% confidence intervall based on asymptotic normal distribution
segments(
  x0 = coef_id_1["n"] + qnorm(0.025) * coef_id_1["se.n"],
  x1 = coef_id_1["n"] + qnorm(0.975) * coef_id_1["se.n"],
  y0 = min(rprfloglik_n$loglik)
)

# compute loglikelihood profile of parameters alpha and n for sample id == "1"
rprfloglik_alpha_n &lt;- prfloglik_sample(
  rfit_uloc, values = expand.grid(
    alpha = seq(1.5, 3.0, length = 40L), n = seq(1.7, 2.25, length = 40L)),
  soil_sample = "1", ncores = ncpu
)

# joint confidence region of alpha and n based on likelihood ratio test
levelplot(loglik ~ alpha + n, rprfloglik_alpha_n,
  panel = function(x, y, z, subscripts, ...){
    panel.levelplot(x, y, z, subscripts, ...)
    panel.levelplot(x, y, z, subscripts, region = FALSE, contour = TRUE,
      at = -coef_id_1["obj"] - 0.5 * qchisq(0.95, 2),
      lty = "solid"
    )
    panel.levelplot(x, y, z, subscripts, region = FALSE, contour = TRUE,
      at = -coef_id_1["obj"] - 0.5 * qchisq(0.9, 2),
      lty = "dashed"
    )
    panel.levelplot(x, y, z, subscripts, region = FALSE, contour = TRUE,
      at = -coef_id_1["obj"] - 0.5 * qchisq(0.8, 2),
      lty = "dotted"
    )
    panel.points(coef_id_1["alpha"], coef_id_1["n"], pch = 16)
    panel.lines(
      x = rprfloglik_alpha[, c("alpha", "n")], col = "blue"
    )
    panel.lines(
      x = rprfloglik_n[, c("alpha", "n")], col = "magenta"
    )
  }, key = list(
    corner = c(1, 0.97),
    lines = list(
      lty = c(rep("solid", 3), "dashed", "dotted"),
      col = c("blue", "magenta", rep("black", 3))
    ),
    text = list(c(
        "estimate of n as a function of fixed alpha",
        "estimate of alpha as a function of fixed n",
        "95% joint confidence region",
        "90% joint confidence region",
        "80% joint confidence region"
      ))
  ))

# compute 95%-confidence interval
(ci.alpha &lt;- confint_prfloglik_sample(
  rfit_uloc, parm = "alpha", soil_sample = "1"
))
# use limits to draw loglikelihood profile for alpha
rprfloglik_alpha &lt;- prfloglik_sample(
  rfit_uloc, values = data.frame(
    alpha = seq(0.9 * ci.alpha[1], 1.1 * ci.alpha[2], length = 40L)),
  soil_sample = "1", ncores = ncpu)
plot(loglik ~ alpha, rprfloglik_alpha, type = "l")
lines(
  ci.alpha,
  rep(diff(unlist(attr(ci.alpha, "prfloglik")[c("qtest", "loglik")])) , 2)
)
abline(v = attr(ci.alpha, "prfloglik")["estimate"], lty = "dashed")

# 95%-confidence intervals of all nonlinear parameters based for all
# soil samples asymptotic normal distribution of maximum likelihood estimates
confint(rfit_uloc, type = "normal")

# 95%-confidence intervals of all nonlinear parameters based for all
# soil samples based on likelihood ratio test
confint(rfit_uloc, ncores = ncpu)

</code></pre>

<hr>
<h2 id='sim_wrc_hcc'>
Simulated Soil Water Retention and Hydraulic Conductivity Data
</h2><span id='topic+sim_wrc_hcc'></span>

<h3>Description</h3>

<p>The data give simulated values of water content and hydraulic
conductivity at given capillary pressure head for 3 soil samples.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(sim_wrc_hcc)</code></pre>


<h3>Format</h3>

<p>A data frame with 28 observations on the following 4 variables.
</p>
 <dl>
<dt><code>id</code></dt><dd><p>a factor with levels <code>1</code>, <code>2</code>,
<code>3</code> coding the soil samples.</p>
</dd>
<dt><code>head</code></dt><dd><p>a numeric vector with values of capillary pressure
head (unit <code class="reqn">\mathrm{m}</code>).</p>
</dd>
<dt><code>wc</code></dt><dd><p>a numeric vector with values of simulated volumetric
water content (unit -)</p>
</dd>
<dt><code>hc</code></dt><dd><p>a numeric vector with values of simulated hydraulic
conductivity (unit <code class="reqn">\mathrm{m} \, \mathrm{d}^{-1}</code>).</p>
</dd> </dl>



<h3>Details</h3>

<p>The values of <code>wc</code> and <code>hc</code> were simulated by the model of
<em>Van Genuchten Mualem</em> (Van Genuchten, 1980, see
<code><a href="#topic+wc_model">wc_model</a></code> and <code><a href="#topic+hc_model">hc_model</a></code>) with the following
parameters:

</p>

<table>
<tr>
 <td style="text-align: right;">
    sample id </td><td style="text-align: right;"> <code class="reqn">\theta_r</code> </td><td style="text-align: right;"> <code class="reqn">\theta_s</code> </td><td style="text-align: right;"> <code class="reqn">K_0</code> [<code class="reqn">\mathrm{m} \, \mathrm{d}^{-1}</code>)]
              </td><td style="text-align: right;"> <code class="reqn">\alpha</code> [<code class="reqn">\mathrm{m}^{-1}</code>] </td><td style="text-align: right;"> <code class="reqn">n</code> </td><td style="text-align: right;"> <code class="reqn">\tau</code> </td>
</tr>
<tr>
 <td style="text-align: right;">
    1 </td><td style="text-align: right;"> 0.05 </td><td style="text-align: right;"> 0.45 </td><td style="text-align: right;"> 0.1 </td><td style="text-align: right;"> 2   </td><td style="text-align: right;"> 2   </td><td style="text-align: right;"> 0.5 </td>
</tr>
<tr>
 <td style="text-align: right;">
    2 </td><td style="text-align: right;"> 0.1  </td><td style="text-align: right;"> 0.5  </td><td style="text-align: right;"> 5   </td><td style="text-align: right;"> 1.5 </td><td style="text-align: right;"> 1.5 </td><td style="text-align: right;"> 0.5 </td>
</tr>
<tr>
 <td style="text-align: right;">
    3 </td><td style="text-align: right;"> 0.05 </td><td style="text-align: right;"> 0.45 </td><td style="text-align: right;"> 2   </td><td style="text-align: right;"> 1.4 </td><td style="text-align: right;"> 1.3 </td><td style="text-align: right;"> 0.5 </td>
</tr>
<tr>
 <td style="text-align: right;">
  </td>
</tr>

</table>


<p>Normally distributed errors were added to the model values (<code>wc</code>:
sd: 0.05; <code>log(hc)</code>: sd 0.5).
</p>


<h3>References</h3>

<p>Van Genuchten, M. Th. (1980) A closed-form equation for predicting the
hydraulic conductivity of unsaturated soils. <em>Soil Science Society of
America Journal</em>, <b>44</b>, 892&ndash;898,
<a href="https://doi.org/10.2136/sssaj1980.03615995004400050002x">doi:10.2136/sssaj1980.03615995004400050002x</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(sim_wrc_hcc)

library(lattice)

xyplot(wc ~ head|id, type = "l", sim_wrc_hcc, scales = list( x = list(log=TRUE)))
xyplot(hc ~ head|id, type = "l", sim_wrc_hcc, scales = list( log = TRUE))

</code></pre>

<hr>
<h2 id='soilhypfit-package'>The soilhypfit Package</h2><span id='topic+soilhypfit-package'></span><span id='topic+soilhypfit'></span><span id='topic+soilhypfitIntro'></span>

<h3>Description</h3>

<p>This is a summary of the features and functionality of
<span class="pkg">soilhypfit</span>, a package in <span class="rlang"><b>R</b></span> for parameteric modelling of soil water
retention and hydraulic conductivity data.</p>


<h3>Details</h3>




<h4>Estimation approach</h4>

<p>The main function, <code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code>, estimates parameters of
models for soil water retention and hydraulic conductivity by
<em>maximum likelihood</em> (ml, default), <em>maximum posterior
density</em> (mpd) <em>estimation</em> (<cite>Stewart et al., 1992</cite>) or
nonlinear <em>weighted least squares</em> (wls) from data on volumetric
<em>soil water content</em>, <code class="reqn">\boldsymbol{\theta}^\mathrm{T} =(\theta_1, \theta_2,
    ..., \theta_{n_\theta})</code>, and/or <em>soil hydraulic conductivity</em>,
<code class="reqn">\boldsymbol{K}^\mathrm{T} =(K_1, K_2, ..., K_{n_K})</code>, both measured at given
capillary pressure head, <code class="reqn">\boldsymbol{h}^\mathrm{T} =(h_1, h_2, ...)</code>.
</p>
<p>For mpd and ml estimation, the models for the measurements are
</p>
<p style="text-align: center;"><code class="reqn">
      \theta_i = \theta(h_i;\boldsymbol{\mu}, \boldsymbol{\nu})
      + \varepsilon_{\theta,i}, \ \ i=1, 2, ..., n_\theta,
    </code>
</p>

<p style="text-align: center;"><code class="reqn">
      \log(K_j) = \log(K(h_j;\boldsymbol{\mu}, \boldsymbol{\nu}))
      + \varepsilon_{K,j}, \ \ j=1, 2, ..., n_K,
    </code>
</p>

<p>where
<code class="reqn">
      \theta(h_i; \boldsymbol{\mu}, \boldsymbol{\nu})
    </code> and
<code class="reqn">
      K(h_j; \boldsymbol{\mu}, \boldsymbol{\nu})
    </code>
denote modelled water content and conductivity,
<code class="reqn">\boldsymbol{\mu}^\mathrm{} </code> and <code class="reqn">\boldsymbol{\nu}^\mathrm{} </code> are the
<em>conditionally linear</em> and <em>nonlinear</em>
model parameters (see below and <cite>Bates and Watts, 1988, sec. 3.3.5</cite>),
and
<code class="reqn">\varepsilon_{\theta,i}</code> and
<code class="reqn">\varepsilon_{K,j}</code> are independent,
normally distributed errors
with zero means and variances <code class="reqn">\sigma^2_\theta</code>
and <code class="reqn">\sigma^2_K</code>, respectively.
</p>

<p>Let
</p>
<p style="text-align: center;"><code class="reqn">
      Q_{\theta}(\boldsymbol{\mu}, \boldsymbol{\nu};
      \boldsymbol{\theta},
      \boldsymbol{h}) =\left(
        \boldsymbol{\theta} -
        \boldsymbol{\theta}(
          \boldsymbol{h};
          \boldsymbol{\mu}, \boldsymbol{\nu}
        )
      \right)^\mathrm{T}
      \boldsymbol{W}_\theta
      \left(
        \boldsymbol{\theta} -
        \boldsymbol{\theta}(
          \boldsymbol{h};
          \boldsymbol{\mu}, \boldsymbol{\nu}
        )
      \right),
    </code>
</p>

<p>and
</p>
<p style="text-align: center;"><code class="reqn">
      Q_{K}(\boldsymbol{\mu}, \boldsymbol{\nu};
       \boldsymbol{K}, \boldsymbol{h}) = \left(
        \log(\boldsymbol{K}) -
        \log(\boldsymbol{K}(
          \boldsymbol{h};
          \boldsymbol{\mu}, \boldsymbol{\nu}
        ))
      \right)^\mathrm{T}
      \boldsymbol{W}_K
      \left(
        \log(\boldsymbol{K}) -
        \log(\boldsymbol{K}(
          \boldsymbol{h};
          \boldsymbol{\mu}, \boldsymbol{\nu}
        ))
      \right),
    </code>
</p>

<p>denote the (possibly weighted) residual sums of squares between
measurements and modelled values.
<code class="reqn">\boldsymbol{\theta}(
        \boldsymbol{h};
        \boldsymbol{\mu}, \boldsymbol{\nu}
      ) )
    </code> and
<code class="reqn">\boldsymbol{K}(
        \boldsymbol{h};
        \boldsymbol{\mu}, \boldsymbol{\nu}
      )
    </code>
are vectors with modelled values of water content and hydraulic
conductivity, and
<code class="reqn">\boldsymbol{W}_\theta</code> and
<code class="reqn">\boldsymbol{W}_K</code> are optional diagonal matrices
with weights <code class="reqn">w_{\theta,i}</code> and <code class="reqn">w_{K,j}</code>, respectively.
The weights are products of <em>case weights</em> <code class="reqn">w^\prime_{\theta,i}</code>
and <code class="reqn">w^\prime_{K,j}</code> and <em>variable weights</em> <code class="reqn">w_\theta</code>, <code class="reqn">w_K</code>, hence
<code class="reqn">
      w_{\theta,i} = w_\theta\, w^\prime_{\theta,i}
    </code> and
<code class="reqn">
      w_{K,j} = w_K\, w^\prime_{K,j}
    </code>.
</p>
<p>The objective function for ml and mpd estimation
is equal to (<cite>Stewart et al., 1992</cite>,
eqs 14 and 15, respectively)
</p>
<p style="text-align: center;"><code class="reqn">
      Q(\boldsymbol{\mu}, \boldsymbol{\nu};
        \boldsymbol{\theta}, \boldsymbol{K},
        \boldsymbol{h}
        ) = \frac{\kappa_\theta}{2}
        \log( Q_{\theta}(\boldsymbol{\mu}, \boldsymbol{\nu};
        \boldsymbol{\theta}, \boldsymbol{h})) +
        \frac{\kappa_K}{2}
        \log( Q_{K}(\boldsymbol{\mu}, \boldsymbol{\nu};
        \boldsymbol{K}, \boldsymbol{h})),
    </code>
</p>

<p>where <code class="reqn">\kappa_v = n_v + 2</code> for mpd and <code class="reqn">\kappa_v = n_v</code> for ml
estimation, <code class="reqn">v \in (\theta, K)</code>,
and weights <code class="reqn">w_{\theta,i} = w_{K,j} = 1</code>.
Note that
<code class="reqn">
      Q(\boldsymbol{\mu},
      \boldsymbol{\nu}; \boldsymbol{\theta},
      \boldsymbol{K}, \boldsymbol{h})
    </code> is equal to the negative logarithm of the
concentrated loglikelihood or the concentrated posterior density,
obtained by replacing
<code class="reqn">\sigma^2_\theta</code> and <code class="reqn">\sigma^2_K</code> by their conditional maximum
likelihood or maximum density estimates
<code class="reqn">
      \widehat{\sigma}^2_\theta(\boldsymbol{\mu}),
      \boldsymbol{\nu})
    </code> and
<code class="reqn">
      \widehat{\sigma}^2_K(\boldsymbol{\mu})
    </code>
respectively (<cite>Stewart et al., 1992</cite>, p. 642).
</p>
<p>For wls the objective function is equal to
</p>
<p style="text-align: center;"><code class="reqn">
      Q(\boldsymbol{\mu}, \boldsymbol{\nu};
        \boldsymbol{\theta}, \boldsymbol{K},
        \boldsymbol{h}
        ) = Q_{\theta}(\boldsymbol{\mu}, \boldsymbol{\nu};
        \boldsymbol{\theta}, \boldsymbol{h}) +
        Q_{K}(\boldsymbol{\mu}, \boldsymbol{\nu};
        \boldsymbol{K}, \boldsymbol{h}).
    </code>
</p>

<p>If either water content or conductivity data are not available, then the respective
terms are omitted from
<code class="reqn">Q(\boldsymbol{\mu}, \boldsymbol{\nu};
        \boldsymbol{\theta}, \boldsymbol{K},
        \boldsymbol{h}
        )
    </code>.
</p>

<p>The function <code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code> does not attempt to estimate the parameters
by minimising <br />
<code class="reqn">
      Q(\boldsymbol{\mu}, \boldsymbol{\nu};
      \boldsymbol{\theta}, \boldsymbol{K},
      \boldsymbol{h})
    </code> directly with respect to
<code class="reqn">\boldsymbol{\mu}^\mathrm{} </code> and <code class="reqn">\boldsymbol{\nu}^\mathrm{} </code>.
Rather, it exploits the fact that for <em>given nonlinear parameters</em>
<code class="reqn">\boldsymbol{\nu}^\mathrm{} </code>, the <em>conditionally linear parameters</em>
<code class="reqn">
      \boldsymbol{\mu}^T = (\theta_r, \theta_s, \log(K_0))
    </code>
can be estimated straightforwardly
by minimising the <em>conditional residual sums of squares</em>
</p>
<p style="text-align: center;"><code class="reqn">
      Q_\theta^*(\theta_r, \theta_s;
      \boldsymbol{\theta},
      \boldsymbol{h}, \boldsymbol{\nu})
      =\left(
        \boldsymbol{\theta} - [
          \boldsymbol{1},
          \boldsymbol{S}(
            \boldsymbol{h};
            \boldsymbol{\nu}
          )] \, \left[
            \begin{array}{c} \theta_r \\ \theta_s - \theta_r \end{array}
          \right]
      \right)^\mathrm{T}
      \boldsymbol{W}_\theta
      \left(
        \boldsymbol{\theta} - [
          \boldsymbol{1},
          \boldsymbol{S}(
            \boldsymbol{h};
            \boldsymbol{\nu}
          )] \, \left[
            \begin{array}{c} \theta_r \\ \theta_s - \theta_r \end{array}
          \right]
      \right)
    </code>
</p>

<p>with respect to <code class="reqn">\theta_r</code> and  <code class="reqn">\theta_s-\theta_r</code> and/or
</p>
<p style="text-align: center;"><code class="reqn">
      Q_K^*(K_0; \boldsymbol{K},
        \boldsymbol{h}, \boldsymbol{\nu})=
      \left(
        \log(\boldsymbol{K}) - \log(K_0  \,
          \boldsymbol{k}(
            \boldsymbol{h};
            \boldsymbol{\nu}
          ))
      \right)^\mathrm{T}
      \boldsymbol{W}_K
      \left(
        \log(\boldsymbol{K}) - \log(K_0  \,
          \boldsymbol{k}(
            \boldsymbol{h};
            \boldsymbol{\nu}
          ))
      \right),
    </code>
</p>

<p>with respect to <code class="reqn">\log(K_0)</code>, where
<code class="reqn">\boldsymbol{1}^\mathrm{} </code> is a vector of ones,
<code class="reqn">\boldsymbol{S}(
            \boldsymbol{h};
            \boldsymbol{\nu}
          )^\mathrm{T} = (
            S(h_1; \boldsymbol{\nu}),
            ...,
            S(h_{n_\theta}; \boldsymbol{\nu})
          )
    </code> and
<code class="reqn">\boldsymbol{k}(
            \boldsymbol{h};
            \boldsymbol{\nu}
          )^\mathrm{T} = (
            k(h_1; \boldsymbol{\nu}),
            ...,
            k(h_{n_K}; \boldsymbol{\nu})
          )
    </code>
are vectors of modelled <em>water saturation</em>
and modelled <em>relative conductivity</em> values,
<code class="reqn">\theta_r</code> and <code class="reqn">\theta_s</code> are the <em>residual</em>
and <em>saturated water content</em>, and
<code class="reqn">K_0</code> is the <em>saturated hydraulic conductivity</em>.
</p>
<p>Unconstrained conditional estimates, say <code class="reqn">
    \widehat{\theta}_r(\boldsymbol{\nu})
    </code>, <code class="reqn">
    \widehat{\theta}_s(\boldsymbol{\nu}) -
    \widehat{\theta}_r(\boldsymbol{\nu}) </code> and <code class="reqn">
    \widehat{\log(K_0)}(\boldsymbol{\nu}) </code> can be
easily obtained from the normal equations of the respective (weighted)
least squares problems, and quadratic programming yields conditional (weighted)
least squares estimates that honour the inequality constraints <code class="reqn">0
    \le \theta_r \le \theta_s \le 1</code>.
</p>

<p>Let <code class="reqn">
     \widehat{\boldsymbol{\mu}}(\boldsymbol{\nu})^\mathrm{T} =
     (
     \widehat{\theta}_r(\boldsymbol{\nu}),
     \widehat{\theta}_s(\boldsymbol{\nu}),
     \widehat{\log(K_0)}(\boldsymbol{\nu})
     )
    </code>
be the conditional estimates of the linear parameters
obtained by minimising
<code class="reqn">
      Q_\theta^*(\theta_r, \theta_s;
      \boldsymbol{\theta},
      \boldsymbol{h}, \boldsymbol{\nu})
    </code>,
and
<code class="reqn">
      Q_K^*(K_0;
      \boldsymbol{K},
      \boldsymbol{h}, \boldsymbol{\nu})
    </code>, respectively.
<code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code> then estimates the
nonlinear parameters by minimising
<code class="reqn">
      Q(
      \widehat{\boldsymbol{\mu}}(\boldsymbol{\nu}),
      \boldsymbol{\nu};
      \boldsymbol{\theta}, \boldsymbol{K},
      \boldsymbol{h})
    </code> with respect to <code class="reqn">\boldsymbol{\nu}^\mathrm{} </code>
by a nonlinear optimisation algorithm.
</p>

<p>For mpd and ml estimation the variances of the model errors are estimated by
(<cite>Stewart et al., 1992</cite>, eq. 16)
</p>
<p style="text-align: center;"><code class="reqn">
      \widehat{\sigma}_\theta^2 = \frac{Q_{\theta}(
        \widehat{\boldsymbol{\mu}}(\widehat{\boldsymbol{\nu}}),
        \widehat{\boldsymbol{\nu}};
      \boldsymbol{\theta},
      \boldsymbol{h})}{\kappa_\theta},
    </code>
</p>

<p>and
</p>
<p style="text-align: center;"><code class="reqn">
      \widehat{\sigma}_K^2 = \frac{Q_{K}(
        \widehat{\boldsymbol{\mu}}(\widehat{\boldsymbol{\nu}}),
        \widehat{\boldsymbol{\nu}};
      \boldsymbol{K},
      \boldsymbol{h})}{\kappa_K}.
    </code>
</p>


<p>Furthermore, for mpd and ml estimation, the covariance matrix of the estimated
nonlinear parameters may be approximated by the inverse Hessian matrix
of <code class="reqn">
      Q(\widehat{\boldsymbol{\mu}}(\boldsymbol{\nu}),
      \boldsymbol{\nu};
      \boldsymbol{\theta}, \boldsymbol{K},
      \boldsymbol{h})
    </code> at the solution
<code class="reqn">
      \widehat{\boldsymbol{\nu}}
    </code>
(<cite>Stewart and Sørensen, 1981</cite>), i.e.
</p>
<p style="text-align: center;"><code class="reqn">
      \mathrm{Cov}[
        \widehat{\boldsymbol{\nu}},
        \widehat{\boldsymbol{\nu}}^T] \approx
        \boldsymbol{A}^{-1},
    </code>
</p>

<p>where
</p>
<p style="text-align: center;"><code class="reqn">
      [\boldsymbol{A}]_{kl} =
      \frac{\partial^2}{\partial\nu_k\, \partial\nu_l} \left.
      Q(\widehat{\boldsymbol{\mu}}(\boldsymbol{\nu}),
      \boldsymbol{\nu};
      \boldsymbol{\theta}, \boldsymbol{K},
      \boldsymbol{h})\right|_{\nu=\hat{\nu}}.
    </code>
</p>





<h4>Details on parameter estimation</h4>




<h5>Models for water retention curves and hydraulic conductivity functions</h5>

<p>Currently, <code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code> allows to estimate the parameters of the
simplified form of the <em>Van Genuchten-Mualem</em> (VGM) model (Van
Genuchten, 1980) with the restriction <code class="reqn">m = 1 - \frac{1}{n}</code>, see <code><a href="#topic+wc_model">wc_model</a></code> and <code><a href="#topic+hc_model">hc_model</a></code>.
This model has the following parameters:
</p>

<ul>
<li> <p><code class="reqn">\boldsymbol{\mu}^\mathrm{T} = (\theta_r, \theta_s, K_0)</code> (see above) and
</p>
</li>
<li> <p><code class="reqn">\boldsymbol{\nu}^\mathrm{T} = (\alpha, n, \tau)</code> where <code class="reqn">\alpha</code> is
the inverse air entry pressure, <code class="reqn">n</code> the shape and <code class="reqn">\tau</code>
the tortuosity parameter.
</p>
</li></ul>

<p>Any of these parameters can be either estimated from data or kept
fixed at the specified initial values (see arguments <code>param</code> and
<code>fit_param</code> of <code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code>).
</p>




<h5>Imposing physical constraints on the estimated parameters</h5>

<p>Parameters of models for the water retention curve and the hydraulic
conductivity function may vary only within certain bounds (see
<code><a href="#topic+wc_model">wc_model</a></code>, <code><a href="#topic+hc_model">hc_model</a></code> and
<code><a href="#topic+param_boundf">param_boundf</a></code> for allowed ranges).
<code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code> either estimates <em>transformed
parameters</em> that vary over the whole real line and can therefore be
estimated without constraints (see <code><a href="#topic+param_transf">param_transf</a></code>), or it
uses algorithms (quadratic programming for estimating
<code class="reqn">\boldsymbol{\mu}^\mathrm{} </code>, nonlinear optimisation algorithms with box
constraints for estimating <code class="reqn">\boldsymbol{\nu}^\mathrm{} </code>) that restrict estimates
to permissible ranges, see <em>Details</em> section of
<code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code>.
</p>
<p>In addition, for natural soils, the parameters of the VGM model
cannot vary independently from each other over the allowed ranges.
Sets of fitted parameters should always result in soil hydraulic
quantities that are physically meaningful.  One of these quantities
is the <em>characteristic length</em> <code class="reqn">L_\mathrm{c}</code> of
<em>stage-I</em> evaporation from a soil (Lehmann et al., 2008).
<code class="reqn">L_\mathrm{c}</code> can be related to the parameters of the VGM
model, see Lehmann et al.  (2008, 2020) and
<code><a href="#topic+evaporative-length">evaporative-length</a></code>.
</p>
<p>Using several soil hydrological databases, Lehmann et al.  (2020)
analysed the mutual dependence of VGM parameters and proposed
regression equations to relate the inverse air entry pressure
<code class="reqn">\alpha</code> and the saturated hydraulic <code class="reqn">K_0</code> to the shape
parameter <code class="reqn">n</code>, which characterises the width of the pore size
distribution of a soil.  Using these relations, Lehmann et al.
(2020) then computed the expected value (&ldquo;target&rdquo;)
<code class="reqn">L_\mathrm{t}</code> of <code class="reqn">L_\mathrm{c}</code> for given <code class="reqn">n</code>
and tortuosity parameter <code class="reqn">\tau</code>, see
<code><a href="#topic+evaporative-length">evaporative-length</a></code>.  <code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code> allows
to constrain estimates of the nonlinear parameters <code class="reqn">\boldsymbol{\nu}^\mathrm{} </code>
by defining permissible lower and upper bounds for the ratio
<code class="reqn">L_\mathrm{c}/L_\mathrm{t}</code>, see arguments
<code>ratio_lc_lt_bound</code> of <code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code> and
<code>settings</code> of <code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code>.
</p>




<h5>Choice of optimisation algorithm for estimating the nonlinear parameters</h5>

<p>To estimate <code class="reqn">\boldsymbol{\nu}^\mathrm{} </code>, <code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code> minimises
<code class="reqn"> Q(
      \widehat{\boldsymbol{\mu}}(\boldsymbol{\nu}),
      \boldsymbol{\nu};
      \boldsymbol{\theta}, \boldsymbol{K},
      \boldsymbol{h}) </code>
either by a nonlinear optimisation algorithm available in the library
<em>NLopt</em> (Johnson, see <code><a href="nloptr.html#topic+nloptr">nloptr</a></code>) or by the Shuffled
Complex Evolution (SCE) optimisation algorithm (Duan et al., 1994,
see <code><a href="SoilHyP.html#topic+SCEoptim">SCEoptim</a></code>).  The choice of the algorithm
is controlled by the argument <code>settings</code> of the function
<code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code>:
</p>

<ol>
<li><p> global optimisation without constraints for the
ratio <code class="reqn">L_\mathrm{c}/L_\mathrm{t}</code> <br />(<code>settings =
        "uglobal"</code> or <code>settings = "sce"</code>),
</p>
</li>
<li><p> global optimisation with inequality constraints
for the ratio <code class="reqn">L_\mathrm{c}/L_\mathrm{t}</code><br />
(<code>settings = "cglobal"</code>),
</p>
</li>
<li><p> local optimisation without constraints for the
ratio <code class="reqn">L_\mathrm{c}/L_\mathrm{t}</code><br /> (<code>settings =
        "ulocal"</code>),
</p>
</li>
<li><p> local optimisation with inequality constraints
for the ratio <code class="reqn">L_\mathrm{c}/L_\mathrm{t}</code><br />
(<code>settings = "clocal"</code>).
</p>
</li></ol>

<p>The <code>settings</code> argument also sets reasonable default values
for the termination (= convergence) criteria for the various
algorithms, see
<a href="https://nlopt.readthedocs.io/en/latest/NLopt_Introduction/#termination-conditions">NLopt
documentation, section Termination conditions</a>.  The NLopt
documentation contains a very useful discussion of
<a href="https://nlopt.readthedocs.io/en/latest/NLopt_Introduction/#optimisation-problems">(constrained)
optimisation problems</a> in general,
<a href="https://nlopt.readthedocs.io/en/latest/NLopt_Introduction/#global-versus-local-optimisation">global
vs.  local optimisation</a> and
<a href="https://nlopt.readthedocs.io/en/latest/NLopt_Introduction/#gradient-based-versus-derivative-free-algorithms">gradient-based
vs.  derivative-free algorithms</a>.
</p>
<p>Note that besides the <code>settings</code> argument of
<code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code>, the arguments <code>nloptr</code> and
<code>sce</code> along with the functions <code><a href="#topic+control_nloptr">control_nloptr</a></code> and
<code><a href="#topic+control_sce">control_sce</a></code> allow to fully control the nonlinear
optimisation algorithms, see <code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code> for
details.
</p>




<h5>Computing initial values of parameters</h5>

<p>For local optimisation algorithms &ldquo;good&rdquo; initial values of
<code class="reqn">\boldsymbol{\nu}^\mathrm{} </code> are indispensable for successful estimation.
<code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code> allows to compute initial values of
<code class="reqn">\alpha</code> and <code class="reqn">n</code> for the Van Genuchten model from water
retention data by the following procedure:
</p>

<ol>
<li><p> Smooth the water retention data,
<code class="reqn">
           (\theta_i, y_i= \log(h_i)), i=1,2, ... n_\theta,
          </code> by an additive model.
</p>
</li>
<li><p> Determine the saturation, <code class="reqn">S^*</code>, and the logarithm of
capillary pressure head, <code class="reqn">y^* = \log(h^*)</code>, at
the inflection point of the additive model fit.
</p>
</li>
<li><p> Find the root, say <code class="reqn">\widehat{m}</code>, of
<code class="reqn">S^* = (1 + 1/m)^{-m}</code>.
One obtains the right-hand side of this equation by solving
<code class="reqn">\frac{\partial^2}{\partial y^2}
           \left[
             S_\mathrm{VG}(\exp(y); \boldsymbol{\nu})
           \right] = 0
         </code>
for <code class="reqn">y</code> and plugging the result into the expression for
<code class="reqn">
           S_\mathrm{VG}(\exp(y); \boldsymbol{\nu}),
         </code>
see <code><a href="#topic+wc_model">wc_model</a></code>.
</p>
</li>
<li><p> Compute
<code class="reqn">
           \widehat{n} = 1 / (1 - \widehat{m})
         </code>
and
<code class="reqn">
           \widehat{\alpha} = 1 / \exp(y^*) \,(1/\widehat{m})^{1-\widehat{m}}.
         </code>
The second expression is again a result of solving
<code class="reqn">\frac{\partial^2}{\partial y^2}
           \left[
             S_\mathrm{VG}(\exp(y); \boldsymbol{\nu})
           \right] = 0.
         </code>
</p>
</li></ol>

<p>Initial values for local optimisation algorithms can of course also
be obtained by first estimating the parameters by a global
algorithm.  These estimates can be &ldquo;refined&rdquo; in a second
step by a local unconstrained algorithm, possibly
followed by a third call of <code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code> to constrain
the estimated parameters by the ratio
<code class="reqn">L_\mathrm{c}/L_\mathrm{t}</code>.  The method
<code><a href="#topic+coef.fit_wrc_hcc">coef.fit_wrc_hcc</a></code> can be used to extract the estimated
parameters from an object of class <code>fit_wrc_hcc</code> and to pass
them as initial values to <code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code>, see
<code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code> for examples.
</p>




<h3>Author(s)</h3>

<p>Andreas Papritz <a href="mailto:papritz@retired.ethz.ch">papritz@retired.ethz.ch</a>.
</p>


<h3>References</h3>

<p>Bates, D. M., and Watts, D. G. (1988) Nonlinear Regression Analysis and its
Applications. John Wiley &amp; Sons, New York <a href="https://doi.org/10.1002/9780470316757">doi:10.1002/9780470316757</a>.
</p>
<p>Duan, Q., Sorooshian, S., and Gupta, V. K. (1994) Optimal use of the
SCE-UA global optimisation method for calibrating watershed models,
<em>Journal of Hydrology</em> <b>158</b>, 265&ndash;284,
<a href="https://doi.org/10.1016/0022-1694%2894%2990057-4">doi:10.1016/0022-1694(94)90057-4</a>.
</p>
<p>Johnson, S.G. The NLopt nonlinear-optimisation package.
<a href="https://github.com/stevengj/nlopt">https://github.com/stevengj/nlopt</a>.
</p>
<p>Lehmann, P., Assouline, S., Or, D. (2008) Characteristic lengths
affecting evaporative drying of porous media.  <em>Physical Review E</em>,
<b>77</b>, 056309, <a href="https://doi.org/10.1103/PhysRevE.77.056309">doi:10.1103/PhysRevE.77.056309</a>.
</p>
<p>Lehmann, P., Bickel, S., Wei, Z., Or, D. (2020) Physical Constraints for
Improved Soil Hydraulic Parameter Estimation by Pedotransfer Functions.
<em>Water Resources Research</em> <b>56</b>, e2019WR025963,
<a href="https://doi.org/10.1029/2019WR025963">doi:10.1029/2019WR025963</a>.
</p>
<p>Stewart, W.E., Caracotsios, M. Sørensen, J.P. 1992.  Parameter
estimation from multiresponse data.  <em>AIChE Journal</em>, <b>38</b>,
641&ndash;650, <a href="https://doi.org/10.1002/aic.690380502">doi:10.1002/aic.690380502</a>.
</p>
<p>Stewart, W.E. and Sørensen, J.P. (1981)
Bayesian estimation of common
parameters from multiresponse data with missing observations.
<em>Technometrics</em>, <b>23</b>, 131&ndash;141, <br />
<a href="https://doi.org/10.1080/00401706.1981.10486255">doi:10.1080/00401706.1981.10486255</a>.
</p>
<p>Van Genuchten, M. Th. (1980) A closed-form equation for predicting the
hydraulic conductivity of unsaturated soils. <em>Soil Science Society of
America Journal</em>, <b>44</b>, 892&ndash;898,
<a href="https://doi.org/10.2136/sssaj1980.03615995004400050002x">doi:10.2136/sssaj1980.03615995004400050002x</a>.
</p>


<h3>See Also</h3>




<p><code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code> for (constrained) estimation of parameters of
models for soil water retention and hydraulic conductivity data;
</p>
<p><code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code> for options to control
<code>fit_wrc_hcc</code>;
</p>
<p><code><a href="#topic+soilhypfitmethods">soilhypfitmethods</a></code> for common S3 methods for class
<code>fit_wrc_hcc</code>;
</p>
<p><code><a href="#topic+vcov">vcov</a></code> for computing (co-)variances of the estimated
nonlinear parameters;
</p>
<p><code><a href="#topic+prfloglik_sample">prfloglik_sample</a></code> for profile loglikelihood
computations;
</p>
<p><code><a href="#topic+wc_model">wc_model</a></code> and <code><a href="#topic+hc_model">hc_model</a></code> for currently
implemented models for soil water retention curves and hydraulic
conductivity functions;
</p>
<p><code><a href="#topic+evaporative-length">evaporative-length</a></code> for physically constraining parameter
estimates of soil hydraulic material functions.
</p>

<hr>
<h2 id='soilhypfitS3methods'>Common S3 Methods for Class <code>fit_wrc_hcc</code></h2><span id='topic+soilhypfitS3methods'></span><span id='topic+soilhypfitmethods'></span><span id='topic+coef.fit_wrc_hcc'></span><span id='topic+lines.fit_wrc_hcc'></span><span id='topic+plot.fit_wrc_hcc'></span><span id='topic+print.fit_wrc_hcc'></span><span id='topic+print.summary_fit_wrc_hcc'></span><span id='topic+summary.fit_wrc_hcc'></span>

<h3>Description</h3>

<p>This page documents the methods <code>coef</code>,
<code>summary</code>, <code>print</code>, <code>plot</code> and <code>lines</code> for the class
<code>fit_wrc_hcc</code>.</p>


<h3>Usage</h3>

<pre><code class='language-R'>
## S3 method for class 'fit_wrc_hcc'
coef(object, what = c("all", "nonlinear", "linear"),
    subset = NULL, residual_se = FALSE, se = FALSE, gof = FALSE, lc = FALSE,
    e0 = FALSE, bound = lc, ...)

## S3 method for class 'fit_wrc_hcc'
summary(object, what = c("all", "nonlinear", "linear"),
    subset = NULL, gof = TRUE, lc = TRUE, ...)

## S3 method for class 'fit_wrc_hcc'
print(x, ...)

## S3 method for class 'fit_wrc_hcc'
plot(x, what = c("wrc", "hcc"), y = NULL,
    subset = NULL, ylim_wc = NULL, ylim_hc = NULL,
    head_saturation = 0.01,
    beside = identical(sum(par("mfrow")), 2L), pch = 1, col_points = "black",
    col_line_x = "blue", lty_x = "solid",
    col_line_y = "orange", lty_y = "dashed",
    xlab_wc = "head [m]", ylab_wc = "water content [-]",
    xlab_hc = "head [m]", ylab_hc = "hyd. conductivity [m/d]",
    draw_legend = TRUE, draw_parameter = FALSE, cex_legend = 0.7, ...)

## S3 method for class 'fit_wrc_hcc'
lines(x, what = c("wrc", "hcc"), id = 1,
    head_saturation = 0.01, ...)

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="soilhypfitS3methods_+3A_object">object</code>, <code id="soilhypfitS3methods_+3A_x">x</code>, <code id="soilhypfitS3methods_+3A_y">y</code></td>
<td>
<p>an object of class <code>fit_wrc_hcc</code>, see
<code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code>.</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_what">what</code></td>
<td>
<p>character keyword indicating the type of parameters to return
(<code>coef</code>) or the type of data to <code>plot</code>.</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_subset">subset</code></td>
<td>
<p>an integer, character or logical vector to the choose the
soil samples for which data and model curves are displayed or extracted.
Defaults to <code>NULL</code> which displays results for all soil samples.</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_residual_se">residual_se</code></td>
<td>
<p>a logical scalar to control whether residual standard
errors (= standard deviations of residuals) should be returned, see
<em>Details</em>.</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_se">se</code></td>
<td>
<p>a logical scalar to control whether standard errors of the
nonlinear parameters <code class="reqn">\boldsymbol{\nu}^\mathrm{} </code> should be returned, see
<em>Details</em> and <code><a href="#topic+vcov.fit_wrc_hcc">vcov.fit_wrc_hcc</a></code>.</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_gof">gof</code></td>
<td>
<p>a logical scalar to control whether goodness-of-fit statistic
should be returned.</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_lc">lc</code></td>
<td>
<p>a logical scalar to control whether the characteristic evaporative
length should be returned, see <code><a href="#topic+evaporative-length">evaporative-length</a></code>.</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_e0">e0</code></td>
<td>
<p>a logical scalar to control whether the evaporation rate should
be returned.  This is only effective for constrained estimation, see
<code><a href="#topic+evaporative-length">evaporative-length</a></code>.</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_bound">bound</code></td>
<td>
<p>a logical scalar to control whether the lower and upper
bounds of the ratio <code class="reqn">L_\mathrm{c}/L_\mathrm{t}</code> should be
returned. This is only effective for constrained estimation, see
<code><a href="#topic+evaporative-length">evaporative-length</a></code>.</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_ylim_wc">ylim_wc</code></td>
<td>
<p>optional numeric vector of length 2 to set the range of
water content values displayed on the y-axis (default <code>NULL</code> for
automatic axis scales).</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_ylim_hc">ylim_hc</code></td>
<td>
<p>optional numeric vector of length 2 to set the range of
hydraulic conductivity values displayed on the y-axis (default
<code>NULL</code> for automatic axis scales).</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_head_saturation">head_saturation</code></td>
<td>
<p>head value (unit m) assigned to zero head values in
plots with logarithmic head scale.</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_beside">beside</code></td>
<td>
<p>a logical scalar controlling whether water retention curves
and hydraulic conductivity functions of a sample should be plotted side
by side.</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_pch">pch</code></td>
<td>
<p>plotting &lsquo;character&rsquo;, i.e., symbol to use for the
measurements, see <code><a href="graphics.html#topic+points">points</a></code>.</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_col_points">col_points</code></td>
<td>
<p>color code or name for symbol colors for the
measurements, see <code><a href="graphics.html#topic+par">par</a></code>.</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_col_line_x">col_line_x</code></td>
<td>
<p>color code or name for the line representing the
fitted model <code>x</code>, see <code><a href="graphics.html#topic+par">par</a></code>.</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_lty_x">lty_x</code></td>
<td>
<p>type of line representing the fitted model <code>x</code>, see
<code><a href="graphics.html#topic+par">par</a></code>.</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_col_line_y">col_line_y</code></td>
<td>
<p>color code or name for the line representing the
fitted model <code>y</code>, see <code><a href="graphics.html#topic+par">par</a></code>.</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_lty_y">lty_y</code></td>
<td>
<p>type of line representing the fitted model <code>y</code>, see
<code><a href="graphics.html#topic+par">par</a></code>.</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_xlab_wc">xlab_wc</code></td>
<td>
<p>a character string with the annotation for the
<var>x</var>-axis of a water retention curve.</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_ylab_wc">ylab_wc</code></td>
<td>
<p>a character string with the annotation for the
<var>y</var>-axis of a water retention curve.</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_xlab_hc">xlab_hc</code></td>
<td>
<p>a character string with the annotation for the
<var>x</var>-axis of a hydraulic conductivity function.</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_ylab_hc">ylab_hc</code></td>
<td>
<p>a character string with the annotation for the
<var>y</var>-axis of a hydraulic conductivity function.</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_draw_legend">draw_legend</code></td>
<td>
<p>a logical scalar controlling whether a legend with the
values of the arguments <code>x</code> and <code>y</code> and the residual sums of
squares is drawn if <code>y</code> is non-<code>NULL</code>.</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_draw_parameter">draw_parameter</code></td>
<td>
<p>a logical scalar controlling whether the
parameters are drawn (default <code>FALSE</code>).</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_cex_legend">cex_legend</code></td>
<td>
<p>a character expansion factor for annotations by
<code><a href="graphics.html#topic+legend">legend</a></code>.</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_id">id</code></td>
<td>
<p>a character string or integer scalar to select the sample for
which to plot the modelled water retention curve or hydraulic
conductivity function.</p>
</td></tr>
<tr><td><code id="soilhypfitS3methods_+3A_...">...</code></td>
<td>
<p>additional arguments passed to methods.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Residual standard errors, standard errors of the nonlinear parameters and
confidence intervals based on the asymptotic normal distribution are
computed only for mpd and ml estimates, see <br />
<code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code>, <code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code> and
<code><a href="#topic+vcov">vcov</a></code>.
</p>
<p>The <code>plot</code> method for class <code>fit_wrc_hcc</code> displays for each
sample the measurements of the water retention curve and/or the hydraulic
conductivity function, along with the fitted model curve(s).  Optionally,
the curves of a second model fit (specified by the
argument <code>y</code>) can be plotted for each sample.
</p>
<p>The <code>lines</code> method adds the curve of a fitted model to an existing
plot.
</p>


<h3>Value</h3>

<p>The method <code>coef</code> returns a dataframe with the estimated parameters
(and optionally standard errors), optionally the value of the
objective function along with convergence code and/or information on the
characteristic evaporative length.
</p>
<p>The method <code>summary</code> generates a list (of class
<code>summary.fit_wrc_hcc</code>) with the following components:

</p>

<dl>
<dt><code>data</code></dt><dd><p>a named integer vector with the total number of
samples (<code>nsamp</code>) and the number of samples with only water
retention (<code>nwrc</code>), only hydraulic conductivity (<code>nhcc</code>) and
both type of measurements (<code>nwrchcc</code>).</p>
</dd>
<dt><code>control</code></dt><dd><p>a list with a subset (<code>settings</code>,
<code>nloptr</code>, <code>sce</code>, <code>approximation_alpha_k0</code>,
<code>param_bound</code>, <code>param_tf</code>) of the components of
<code>object[["control"]]</code>, see <code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code> and
<code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code>.</p>
</dd>
<dt><code>result</code></dt><dd><p>a dataframe with the estimated parameters and
optionally the residual sum of squares along with convergence code
and/or information on the characteristic evaporative length.</p>
</dd>
<dt><code>call</code></dt><dd><p>the <code>call</code> component of <code>object</code>.</p>
</dd>
</dl>

<p>Note that only a <code>print</code> method is available for class
<code>summary.fit_wrc_hcc</code>.
</p>


<h3>Author(s)</h3>

<p>Andreas Papritz <a href="mailto:papritz@retired.ethz.ch">papritz@retired.ethz.ch</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code> for a description of the models and a brief
summary of the parameter estimation approach;
</p>
<p><code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code> for (constrained) estimation of parameters of
models for soil water retention and hydraulic conductivity data;
</p>
<p><code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code> for options to control
<code>fit_wrc_hcc</code>;
</p>



<p><code><a href="#topic+vcov">vcov</a></code> for computing (co-)variances of the estimated
nonlinear parameters;
</p>
<p><code><a href="#topic+prfloglik_sample">prfloglik_sample</a></code> for profile loglikelihood
computations;
</p>
<p><code><a href="#topic+wc_model">wc_model</a></code> and <code><a href="#topic+hc_model">hc_model</a></code> for currently
implemented models for soil water retention curves and hydraulic
conductivity functions;
</p>
<p><code><a href="#topic+evaporative-length">evaporative-length</a></code> for physically constraining parameter
estimates of soil hydraulic material functions.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# use of \donttest{} because execution time exceeds 5 seconds

data(sim_wrc_hcc)

# define number of cores for parallel computations
if(interactive()) ncpu &lt;- parallel::detectCores() - 1L else ncpu &lt;- 1L

# estimate parameters for 3 samples by unconstrained, global optimisation
# algorithm NLOPT_GN_MLSL
# sample 1: use only conductivity data
# sample 2: use only water content data
# sample 3: use both types of data
rfit_uglob &lt;- fit_wrc_hcc(
  wrc_formula = wc ~ head | id, hcc_formula = hc ~ head | id,
  wrc_subset = id != 1, hcc_subset = id != 2,
  data = sim_wrc_hcc, fit_param = default_fit_param(tau = TRUE),
  control = control_fit_wrc_hcc(param_bound = param_boundf(
      alpha = c(0.00001, 50), n = c(1.0001, 7), tau = c(-1, 5)
    ), pcmp = control_pcmp(ncores = ncpu)))
print(rfit_uglob)
summary(rfit_uglob)
coef(rfit_uglob, what = "nonlinear")
coef(rfit_uglob, what = "linear", gof = TRUE)
coef(vcov(rfit_uglob), status = TRUE, se = FALSE)
op &lt;- par(mfrow = c(3, 2))
plot(rfit_uglob)
on.exit(par(op))


</code></pre>

<hr>
<h2 id='swissforestsoils'>
Physical properties of Swiss forest soils</h2><span id='topic+swissforestsoils'></span>

<h3>Description</h3>

<p>The data give basic physical properties, water content and hydraulic
conductivity measurements (at given capillary pressure head) for 128 soil
layers (horizons) measured at 23 forest sites in Switzerland.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(swissforestsoils)</code></pre>


<h3>Format</h3>

<p>A data frame with 1373 observations on the following 21 variables.
</p>

<dl>
<dt><code>profile_id</code></dt><dd><p>a factor with short labels for the 23 sites.</p>
</dd>
<dt><code>profile</code></dt><dd><p>a factor with with long labels for the 23 sites.</p>
</dd>
<dt><code>longitude</code></dt><dd><p>a numeric vector with the latitude of the site
in degree.</p>
</dd>
<dt><code>latitude</code></dt><dd><p>a numeric vector with the latitude of the site
in degree.</p>
</dd>
<dt><code>layer_id</code></dt><dd><p>a factor with labels for the 128 soil layer.</p>
</dd>
<dt><code>layer_ub</code>, <code>layer_lb</code></dt><dd><p>numeric vectors with the upper
and lower depth (unit cm) of the soil layer for the measurements of the
basic physical properties (<code>particle_density</code>, ..., <code>ksat</code>).</p>
</dd>
<dt><code>particle_density</code></dt><dd><p>a numeric vector with the density of the
solid soil material (unit <code class="reqn">\mathrm{g} \,\mathrm{cm^{-3}}</code>).</p>
</dd>
<dt><code>bulk_density</code></dt><dd><p>a numeric vector with soil (bulk) density
(unit <code class="reqn">\mathrm{g} \,\mathrm{cm^{-3}}</code>).</p>
</dd>
<dt><code>porosity</code></dt><dd><p>a numeric vector with the soil porosity (unit
volume percentage).</p>
</dd>
<dt><code>clay</code></dt><dd><p>a numeric vector with the clay content (unit mass
percentage).</p>
</dd>
<dt><code>silt</code></dt><dd><p>a numeric vector with the silt content (unit mass
percentage).</p>
</dd>
<dt><code>sand</code></dt><dd><p>a numeric vector with the sand content (unit mass
percentage).</p>
</dd>
<dt><code>ksat</code></dt><dd><p>a numeric vector with the saturated hydraulic
conductivity (unit <code class="reqn">\mathrm{m} \,\mathrm{d^{-1}}</code>).</p>
</dd>
<dt><code>head</code></dt><dd><p>a numeric vector with capillary pressure head at
which <code>theta</code> (water retention curve) and/or <code>ku</code> (hydraulic
conductivity function) were measured (unit m).</p>
</dd>
<dt><code>layer_ub_theta</code>, <code>layer_lb_theta</code></dt><dd><p>numeric vectors
with the upper and lower depth (unit cm) of the soil layer for which
the water retention curve was measured.</p>
</dd>
<dt><code>theta</code></dt><dd><p>a numeric vector with volumetric water content
measurements (dimensionless) of the water retention curve.</p>
</dd>
<dt><code>layer_ub_ku</code>, <code>layer_lb_ku</code></dt><dd><p>a numeric vector with the
upper and lower depth (unit cm) of the soil layer for which the water
retention curve was measured.</p>
</dd>
<dt><code>ku</code></dt><dd><p>a numeric vector with hydraulic conductivity
measurements (unit <code class="reqn">\mathrm{m} \,\mathrm{d^{-1}}</code>) of
the hydraulic conductivity function.</p>
</dd>
</dl>



<h3>Details</h3>

<p><code>clay</code>, <code>silt</code> and <code>sand</code> refer to soil particles with
diameter less than 2, between 2 and 50 and larger than 50 <code class="reqn">\mu</code>m.
</p>


<h3>Source</h3>

<p>Richard, F. &amp; Lüscher, P. 1978 &ndash; 1987.  Physikalische Eigenschaften von
Böden der Schweiz.  Lokalformen Bände 1 &ndash; 4.  Eidgenössische Anstalt für
das forstliche Versuchswesen, Birmensdorf.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# use of \donttest{} because execution time exceeds 5 seconds

# estimate parameters using all samples (samples with water retention,
# hydraulic conductivity, or with both type of measurements)

data(swissforestsoils)

# define number of cores for parallel computations
if(interactive()) ncpu &lt;- parallel::detectCores() - 1L else ncpu &lt;- 1L

# unconstrained estimation (global optimisation algorithm NLOPT_GN_MLSL)
r_uglob &lt;- fit_wrc_hcc(
  wrc_formula = theta ~ head | layer_id,
  hcc_formula = ku ~ head | layer_id,
  data = swissforestsoils,
  control = control_fit_wrc_hcc(
    settings = "uglobal", pcmp = control_pcmp(ncores = ncpu)))
summary(r_uglob)
coef(r_uglob)

</code></pre>

<hr>
<h2 id='utility-functions'>Utility functions for package soilhypfit</h2><span id='topic+check_param_boundf'></span><span id='topic+convergence_message'></span><span id='topic+extract_error_messages'></span><span id='topic+select_failed_fits'></span>

<h3>Description</h3>

<p>This page documents the functions <code>convergence_message</code>,
<code>extract_error_messages</code>, <code>select_failed_fits</code> and
<code>check_param_boundf</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>convergence_message(x, sce = FALSE)

extract_error_messages(object, start = 1, stop = 80, prt = TRUE)

select_failed_fits(object)

check_param_boundf(y, compare_thetar_thetas = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="utility-functions_+3A_x">x</code></td>
<td>
<p>an integer scalar issued by the optimisers of
<code><a href="nloptr.html#topic+nloptr">nloptr</a></code> or <code><a href="SoilHyP.html#topic+SCEoptim">SCEoptim</a></code> on<br />
(non-)convergence</p>
</td></tr>
<tr><td><code id="utility-functions_+3A_sce">sce</code></td>
<td>
<p>a logical scalar to select the optimiser
<code><a href="nloptr.html#topic+nloptr">nloptr</a></code> (<code>FALSE</code>, default) or
<code><a href="SoilHyP.html#topic+SCEoptim">SCEoptim</a></code> (<code>TRUE</code>).</p>
</td></tr>
<tr><td><code id="utility-functions_+3A_object">object</code></td>
<td>
<p>an object of class <code>fit_wrc_hcc</code>, see
<code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code>.</p>
</td></tr>
<tr><td><code id="utility-functions_+3A_prt">prt</code></td>
<td>
<p>a logical scalar controlling whether the error messages should
be printed.</p>
</td></tr>
<tr><td><code id="utility-functions_+3A_start">start</code>, <code id="utility-functions_+3A_stop">stop</code></td>
<td>
<p>integer scalar with the first and last character to
print.</p>
</td></tr>
<tr><td><code id="utility-functions_+3A_y">y</code></td>
<td>
<p>a named list of numeric vectors of length 2 that define the
allowed lower and upper bounds (box constraints) for the parameters of
the models, see argument <code>param_bound</code> of
<code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code>.</p>
</td></tr>
<tr><td><code id="utility-functions_+3A_compare_thetar_thetas">compare_thetar_thetas</code></td>
<td>
<p>logical scalar to control cross-comparison
of valid ranges of parameters <code>thetar</code> and <code>thetas</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function <code>convergence_message</code> prints a message that explains
the convergence codes, for <code><a href="nloptr.html#topic+nloptr">nloptr</a></code>, see
<a href="https://nlopt.readthedocs.io/en/latest/NLopt_Reference/#return-values">NLopt
return values</a>.  The function <code>extract_error_messages</code> extract the
error messages of estimations that failed and optionally prints sub-strings
of them.<br />  The function <code>select_failed_fits</code> returns the
<code>id</code>s of the soil samples for which parameter estimation failed.
The function <code>check_param_boundf</code> checks the validity and consistecy
of bounds of box constraints of model parameters.
</p>


<h3>Value</h3>

<p>The function <code>convergence_message</code> and <code>extract_error_messages</code>
return invisibly the convergence code or the error messages.
</p>


<h3>Author(s)</h3>

<p>Andreas Papritz <a href="mailto:papritz@retired.ethz.ch">papritz@retired.ethz.ch</a>.
</p>


<h3>References</h3>

<p>Duan, Q., Sorooshian, S., and Gupta, V. K. (1994) Optimal use of the
SCE-UA global optimisation method for calibrating watershed models,
<em>Journal of Hydrology</em> <b>158</b>, 265&ndash;284,
<a href="https://doi.org/10.1016/0022-1694%2894%2990057-4">doi:10.1016/0022-1694(94)90057-4</a>.
</p>
<p>Johnson, S.G. The NLopt nonlinear-optimisation package.
<a href="https://github.com/stevengj/nlopt">https://github.com/stevengj/nlopt</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code> for a description of the models and a brief
summary of the parameter estimation approach;
</p>
<p><code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code> for (constrained) estimation of parameters of
models for soil water retention and hydraulic conductivity data;
</p>
<p><code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code> for options to control
<code>fit_wrc_hcc</code>;
</p>
<p><code><a href="#topic+soilhypfitmethods">soilhypfitmethods</a></code> for common S3 methods for class
<code>fit_wrc_hcc</code>;
</p>
<p><code><a href="#topic+vcov">vcov</a></code> for computing (co-)variances of the estimated
nonlinear parameters;
</p>
<p><code><a href="#topic+prfloglik_sample">prfloglik_sample</a></code> for profile loglikelihood
computations;
</p>
<p><code><a href="#topic+wc_model">wc_model</a></code> and <code><a href="#topic+hc_model">hc_model</a></code> for currently
implemented models for soil water retention curves and hydraulic
conductivity functions;
</p>
<p><code><a href="#topic+evaporative-length">evaporative-length</a></code> for physically constraining parameter
estimates of soil hydraulic material functions.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>convergence_message(3)
convergence_message(2, sce = TRUE)
</code></pre>

<hr>
<h2 id='vcov'><code>vcov</code> Method for Class <code>fit_wrc_hcc</code></h2><span id='topic+vcov'></span><span id='topic+coef.vcov_fit_wrc_hcc'></span><span id='topic+vcov.fit_wrc_hcc'></span>

<h3>Description</h3>

<p>This page documents the method <code>vcov</code> for the class
<code>fit_wrc_hcc</code> and its <code>coef</code> method.  <code>vcov</code> extracts the
covariance matrices of the nonlinear parameters
<code class="reqn">\widehat{\boldsymbol{\nu}}</code> estimated by
maximum likelihood or maximum posterior density.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
## S3 method for class 'fit_wrc_hcc'
vcov(object, subset = NULL, grad_eps,
    bound_eps = sqrt(.Machine$double.eps), ...)

## S3 method for class 'vcov_fit_wrc_hcc'
coef(object, se = TRUE, correlation = se,
    status = FALSE, ...)

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vcov_+3A_object">object</code></td>
<td>
<p>either an object of class <code>fit_wrc_hcc</code> for
<code>vcov</code> or an object of class <code>vcov_fit_wrc_hcc</code> for
<code>coef</code>.</p>
</td></tr>
<tr><td><code id="vcov_+3A_subset">subset</code></td>
<td>
<p>an integer, character or logical vector to the choose the
soil samples for which covariance matrices should be extracted.
Defaults to <code>NULL</code>, which extracts the covariances for all soil samples.</p>
</td></tr>
<tr><td><code id="vcov_+3A_grad_eps">grad_eps</code></td>
<td>
<p>a numeric scalar defining a critical magnitude of the
moduli of scaled gradient components so that they are considered to be
approximately equal to zero, see <em>Details</em>.</p>
</td></tr>
<tr><td><code id="vcov_+3A_bound_eps">bound_eps</code></td>
<td>
<p>a numeric scalar defining the critical difference
between parameter estimates and the boundaries of the parameter space so
that the estimates are considered to be identical to the boundary values,
see <em>Details</em>.</p>
</td></tr>
<tr><td><code id="vcov_+3A_se">se</code></td>
<td>
<p>a logical scalar to control whether standard errors of the
estimated nonlinear parameters
<code class="reqn">\widehat{\boldsymbol{\nu}}</code> should be
returned (<code>TRUE</code>, default) or variances (<code>FALSE</code>).</p>
</td></tr>
<tr><td><code id="vcov_+3A_correlation">correlation</code></td>
<td>
<p>a logical scalar to control whether correlations
(<code>TRUE</code>, default) or covariances (<code>FALSE</code>) of the esitmated
nonlinear parameters
<code class="reqn">\widehat{\boldsymbol{\nu}}</code> should be
returned.</p>
</td></tr>
<tr><td><code id="vcov_+3A_status">status</code></td>
<td>
<p>a logical scalar to control whether diagnostics should be
returned along with the results.</p>
</td></tr>
<tr><td><code id="vcov_+3A_...">...</code></td>
<td>
<p>additional arguments passed to methods, currently not used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function <code>vcov</code> extracts (co-)variances of the nonlinear
parameters from the inverse Hessian matrix of the objective function at
the solution <code class="reqn">\widehat{\boldsymbol{\nu}}</code> for
mpd and ml estimates, see <code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code> and <cite>Stewart
and Sørensen (1981)</cite>.
</p>
<p><code>vcov</code> checks whether the gradient at the solution is approximately
equal to zero and issues a warning if this is not the case.  This is
controlled by the argument <code>grad_eps</code> which is the tolerable largest
modulus of the scaled gradient (= gradient divided by the absolute value
of objective function) at the solution.  The function
<code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code> selects a default value for
<code>grad_eps</code> in the dependence of the chosen optimisation approach
(argument <code>settings</code> of <code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code>).
</p>
<p><code>vcov</code> sets covariances equal to <code>NA</code> if the parameter
estimates differ less than <code>bound_eps</code> from the boundaries of the
parameter space as defined by <code><a href="#topic+param_boundf">param_boundf</a></code>.
</p>


<h3>Value</h3>

<p>The method <code>vcov</code> returns an object of of class
<code>vcov_fit_wrc_hcc</code>, which is a list of covariance matrices of the
estimated nonlinear parameters for the soil samples.  The attribute
<code>status</code> of the matrices qualifies the covariances.
</p>
<p>The <code>coef</code> method for class <code>vcov_fit_wrc_hcc</code> extracts the
entries of the covariances matrices, optionally computes standard errors
and correlation coefficients and returns the results in a dataframe.
</p>


<h3>Author(s)</h3>

<p>Andreas Papritz <a href="mailto:papritz@retired.ethz.ch">papritz@retired.ethz.ch</a>.
</p>


<h3>References</h3>

<p>Stewart, W.E. and Sørensen, J.P. (1981)
Bayesian estimation of common
parameters from multiresponse data with missing observations.
<em>Technometrics</em>, <b>23</b>, 131&ndash;141, <br />
<a href="https://doi.org/10.1080/00401706.1981.10486255">doi:10.1080/00401706.1981.10486255</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code> for a description of the models and a brief
summary of the parameter estimation approach;
</p>
<p><code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code> for (constrained) estimation of parameters of
models for soil water retention and hydraulic conductivity data;
</p>
<p><code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code> for options to control
<code>fit_wrc_hcc</code>;
</p>
<p><code><a href="#topic+soilhypfitmethods">soilhypfitmethods</a></code> for common S3 methods for class
<code>fit_wrc_hcc</code>;
</p>


<p><code><a href="#topic+prfloglik_sample">prfloglik_sample</a></code> for profile loglikelihood
computations;
</p>
<p><code><a href="#topic+wc_model">wc_model</a></code> and <code><a href="#topic+hc_model">hc_model</a></code> for currently
implemented models for soil water retention curves and hydraulic
conductivity functions;
</p>
<p><code><a href="#topic+evaporative-length">evaporative-length</a></code> for physically constraining parameter
estimates of soil hydraulic material functions.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# use of \donttest{} because execution time exceeds 5 seconds

data(sim_wrc_hcc)

# define number of cores for parallel computations
if(interactive()) ncpu &lt;- parallel::detectCores() - 1L else ncpu &lt;- 1L

# estimate parameters for 3 samples by unconstrained, global optimisation
# algorithm NLOPT_GN_MLSL
# sample 1: use only conductivity data
# sample 2: use only water content data
# sample 3: use both types of data
rfit_uglob &lt;- fit_wrc_hcc(
  wrc_formula = wc ~ head | id,
  hcc_formula = hc ~ head | id,
  wrc_subset = id != 1,
  hcc_subset = id != 2,
  data = sim_wrc_hcc,
  control = control_fit_wrc_hcc(pcmp = control_pcmp(ncores = ncpu)))
print(rfit_uglob)
summary(rfit_uglob)
coef(rfit_uglob, what = "nonlinear")
coef(rfit_uglob, what = "linear", gof = TRUE)
coef(vcov(rfit_uglob), status = TRUE, se = FALSE)
op &lt;- par(mfrow = c(3, 2))
plot(rfit_uglob)
on.exit(par(op))

</code></pre>

<hr>
<h2 id='wc_model'>
Models for Soil Water Retention Curves
</h2><span id='topic+wc_model'></span><span id='topic+sat_model'></span><span id='topic+wc_model'></span>

<h3>Description</h3>

<p>The functions <code>sat_model</code> and <code>wc_model</code> compute, for given
capillary pressure head <code class="reqn">h</code>, the volumetric water saturation
<code class="reqn">S(h)</code> and the volumetric water content <code class="reqn">\theta(h)</code>,
respectively, of a soil by parametrical models.  </p>


<h3>Usage</h3>

<pre><code class='language-R'>sat_model(h, nlp, precBits = NULL, wrc_model = "vg")

wc_model(h, nlp, lp, precBits = NULL, wrc_model = "vg")

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="wc_model_+3A_h">h</code></td>
<td>
<p>a mandatory numeric vector with values of capillary pressure
head for which to compute the volumetric water saturation or content.
For consistency with other quantities, the unit of pressure head
should be <b>meter</b> [m].</p>
</td></tr>
<tr><td><code id="wc_model_+3A_nlp">nlp</code></td>
<td>
<p>a mandatory named numeric vector, currently with elements
named <code>"alpha"</code> and <code>"n"</code>, which are the <em>nonlinear</em>
parameters <code class="reqn">\boldsymbol{\nu}^\mathrm{T} = (\alpha, n)</code>, where <code class="reqn">\alpha</code> and <code class="reqn">n</code>
are the inverse air entry pressure and the shape parameter, see
<em>Details</em>.  For consistency with other quantities, the unit of
<code class="reqn">\alpha</code> should be <b>1/meter</b> [<code class="reqn">\mathrm{m}^{-1}</code>].</p>
</td></tr>
<tr><td><code id="wc_model_+3A_lp">lp</code></td>
<td>
<p>a mandatory named numeric vector, currently with elements named
<code>"thetar"</code> and <code>"thetas"</code>, which are the <em>linear</em>
parameters <code class="reqn">\boldsymbol{\mu}^\mathrm{T} = (\theta_r, \theta_s)</code> where
<code class="reqn">\theta_r</code> and <code class="reqn">\theta_s</code> are the residual and saturated water
content, respectively, see <em>Details</em>.</p>
</td></tr>
<tr><td><code id="wc_model_+3A_precbits">precBits</code></td>
<td>
<p>an optional integer scalar defining the maximal precision
(in bits) to be used in high-precision computations by
<code><a href="Rmpfr.html#topic+mpfr">mpfr</a></code>.  If equal to <code>NULL</code> (default) then
<code><a href="Rmpfr.html#topic+mpfr">mpfr</a></code> is not used and the result of the function call
is of storage mode <code>double</code>, see <code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code>.</p>
</td></tr>
<tr><td><code id="wc_model_+3A_wrc_model">wrc_model</code></td>
<td>
<p>a keyword denoting the parametrical model for the
water retention curve.  Currently, only the <em>Van Genuchten model</em>
(<code>wrc_model = "vg"</code>) is implemented, see <em>Details</em>.</p>
</td></tr> </table>


<h3>Details</h3>

<p>The functions <code>sat_model</code> and <code>wc_model</code> currently model soil
water retention curves only by the simplified form of the model by
<cite>Van Genuchten (1980)</cite> with the restriction <code class="reqn">m = 1 - \frac{1}{n}</code>, i.e.

</p>
<p style="text-align: center;"><code class="reqn">
  S_\mathrm{VG}(h; \boldsymbol{\nu}) = (
  1 + (\alpha \ h)^n)^\frac{1-n}{n}
</code>
</p>


<p style="text-align: center;"><code class="reqn">
  \theta_\mathrm{VG}(h; \boldsymbol{\mu}, \boldsymbol{\nu}) =
	\theta_r + (\theta_s - \theta_r) \, S_\mathrm{VG}(h; \boldsymbol{\nu})
</code>
</p>


<p>where <code class="reqn">\boldsymbol{\mu}^\mathrm{T} = (\theta_r, \theta_s)</code> are the residual and
saturated water content (<code class="reqn">0 \le \theta_r \le \theta_s \le 1</code>),
respectively, and <code class="reqn">\boldsymbol{\nu}^\mathrm{T} = (\alpha, n)</code> are the inverse air
entry pressure (<code class="reqn">\alpha &gt; 0</code>) and the shape parameter (<code class="reqn">n &gt; 1</code>).
</p>
<p>Note that <code class="reqn">\boldsymbol{\mu}^\mathrm{} </code> and
<code class="reqn">\boldsymbol{\nu}^\mathrm{} </code> are passed to the functions by
the arguments <code>lp</code> and <code>nlp</code>, respectively.</p>


<h3>Value</h3>

<p>A numeric vector with values of volumetric water saturation
(<code>sat_model</code>) or water content (<code>wc_model</code>).
</p>


<h3>Author(s)</h3>

<p>Andreas Papritz <a href="mailto:papritz@retired.ethz.ch">papritz@retired.ethz.ch</a>.
</p>


<h3>References</h3>

<p>Van Genuchten, M. Th.  (1980) A closed-form equation for predicting the
hydraulic conductivity of unsaturated soils. <em>Soil Science Society of
America Journal</em>, <b>44</b>, 892&ndash;898,
<a href="https://doi.org/10.2136/sssaj1980.03615995004400050002x">doi:10.2136/sssaj1980.03615995004400050002x</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+soilhypfitIntro">soilhypfitIntro</a></code> for a description of the models and a brief
summary of the parameter estimation approach;
</p>
<p><code><a href="#topic+fit_wrc_hcc">fit_wrc_hcc</a></code> for (constrained) estimation of parameters of
models for soil water retention and hydraulic conductivity data;
</p>
<p><code><a href="#topic+control_fit_wrc_hcc">control_fit_wrc_hcc</a></code> for options to control
<code>fit_wrc_hcc</code>;
</p>
<p><code><a href="#topic+soilhypfitmethods">soilhypfitmethods</a></code> for common S3 methods for class
<code>fit_wrc_hcc</code>;
</p>
<p><code><a href="#topic+vcov">vcov</a></code> for computing (co-)variances of the estimated
nonlinear parameters;
</p>
<p><code><a href="#topic+prfloglik_sample">prfloglik_sample</a></code> for profile loglikelihood
computations;
</p>




<p><code><a href="#topic+evaporative-length">evaporative-length</a></code> for physically constraining parameter
estimates of soil hydraulic material functions.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## define capillary pressure head (unit meters)
h &lt;- c(0.01, 0.1, 0.2, 0.3, 0.5, 1., 2., 5.,10.)

## compute water saturation and water content
sat &lt;- sat_model(h, nlp = c(alpha = 1.5, n = 2))
theta &lt;- wc_model(
  h ,nlp = c(alpha = 1.5, n = 2), lp = c(thetar = 0.1, thetas = 0.5))

## display water retention curve
op &lt;- par(mfrow = c(1, 2))
plot(sat ~ h, log = "x", type = "l")
plot(theta ~ h, log = "x", type = "l")
on.exit(par(op))
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
