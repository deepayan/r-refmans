<!DOCTYPE html><html lang="en"><head><title>Help for package mederrRank</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {mederrRank}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#mederrRank-package'>
<p>Bayesian Methods for Identifying the Most Harmful Medication Errors</p></a></li>
<li><a href='#bayes.rank'><p>Optimal Bayesian Ranking</p></a></li>
<li><a href='#bhm.constr.resamp'>
<p>Markov Chain Monte Carlo Estimation (Step 2) of the Bayesian Hierarchical Model for Identifying the Most Harmful Medication Errors</p></a></li>
<li><a href='#bhm.mcmc'>
<p>Markov Chain Monte Carlo Estimation (Step 1) of the Bayesian Hierarchical Model for Identifying the Most Harmful Medication Errors</p></a></li>
<li><a href='#bhm.resample'>
<p>Resampling Transformation for the Markov Chain Monte Carlo Estimation Simulation of the Bayesian Hierarchical Model for Identifying the Most Harmful Medication Errors</p></a></li>
<li><a href='#dmixnegbinom'>
<p>The Negative Binomial Mixture Distribution</p></a></li>
<li><a href='#dnegbinom'>
<p>The Negative Binomial Distribution</p></a></li>
<li><a href='#dst'>
<p>The Skewed Student t Distribution</p></a></li>
<li><a href='#EBGM'>
<p>Geometric Mean of the Relative Risk Empirical Bayes Posterior Distribution</p></a></li>
<li><a href='#llDiffD'>
<p>Log-Likelihood Difference for the <code class="reqn">\delta_j</code> Parameters</p></a></li>
<li><a href='#llDiffT'>
<p>Log-Likelihood Difference for the <code class="reqn">\theta_i</code> Parameters</p></a></li>
<li><a href='#logp'>
<p>Negative Log-Posterior Function of the Bayesian Hierarchical Model for Identifying the Most Harmful Medication Errors</p></a></li>
<li><a href='#logunpost'>
<p>Unnormalized Marginal Posterior Distributions for <code class="reqn">k</code> and <code class="reqn">\eta</code></p></a></li>
<li><a href='#mederrData-class'><p>Class &quot;mederrData&quot;. Data Specification for Identifying the Most Harmful MEdication Errors using a Bayesian Hierarchical Model.</p></a></li>
<li><a href='#mederrFit-class'><p>Class &quot;mederrFit&quot;. Simulated Monte Carlo Chains (Step 1) for the Bayesian Hierarchical Model Used to Identify the Most Harmful Medication Errors.</p></a></li>
<li><a href='#mederrResample-class'><p>Class &quot;mederrResample&quot;. Simulated Monte Carlo Chains (Step 2) for the Bayesian Hierarchical Model Used to Identify the Most Harmful Medication Errors.</p></a></li>
<li><a href='#MEDMARX'>
<p>Subset of the MEDMARX Data</p></a></li>
<li><a href='#mixnegbinom.em'>
<p>Expectation-Maximization Algorithm for the Mixture of Negative Binomial Distributions</p></a></li>
<li><a href='#mixnegbinom.loglik'>
<p>Log-Likelihood Function for the Mixture of Negative Binomial Distributions</p></a></li>
<li><a href='#mixnegbinom.score'>
<p>Log-Likelihood Score Function for the Mixture of Negative Binomial Distributions</p></a></li>
<li><a href='#negbinom.em'>
<p>Expectation-Maximization Algorithm for the Negative Binomial Distribution</p></a></li>
<li><a href='#negbinom.loglik'>
<p>Log-Likelihood Function for the Mixture of Negative Binomial Distributions</p></a></li>
<li><a href='#negbinom.score'>
<p>Log-Likelihood Score Function for the Negative Binomial Distribution</p></a></li>
<li><a href='#p.value'>
<p>Posterior Predictive Test statistics</p></a></li>
<li><a href='#plot-methods'><p>Plot of Medication Error Data and Analysis</p></a></li>
<li><a href='#post.rep'>
<p>Posterior Predictive Data Replications</p></a></li>
<li><a href='#rmixnegbinom'>
<p>The Negative Binomial Mixture Distribution</p></a></li>
<li><a href='#simdata'>
<p>Simulated Data</p></a></li>
<li><a href='#summary-methods'><p>Summary of Medication Error Data and Analysis</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Bayesian Methods for Identifying the Most Harmful Medication
Errors</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-09-05</td>
</tr>
<tr>
<td>Description:</td>
<td>Two distinct but related statistical approaches to the problem of identifying the combinations of medication error characteristics that are more likely to result in harm are implemented in this package: 1) a Bayesian hierarchical model with optimal Bayesian ranking on the log odds of harm, and 2) an empirical Bayes model that estimates the ratio of the observed count of harm to the count that would be expected if error characteristics and harm were independent. In addition, for the Bayesian hierarchical model, the package provides functions to assess the sensitivity of results to different specifications of the random effects distributions.</td>
</tr>
<tr>
<td>Author:</td>
<td>Sergio Venturini, Jessica Myers</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Sergio Venturini &lt;sergio.venturini@unicatt.it&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>BB, methods, numDeriv, utils</td>
</tr>
<tr>
<td>Imports:</td>
<td>graphics, stats</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> | file LICENSE [expanded from: GPL (&ge; 2) | file LICENSE]</td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-09-05 15:02:00 UTC; Sergio</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-09-05 15:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='mederrRank-package'>
Bayesian Methods for Identifying the Most Harmful Medication Errors
</h2><span id='topic+mederrRank-package'></span><span id='topic+mederrRank'></span>

<h3>Description</h3>

<p>Two distinct but related statistical approaches to the problem of identifying the combinations of medication error characteristics that are more likely to result in harm are implemented in this package: 1) a Bayesian hierarchical model with optimal Bayesian ranking on the log odds of harm, and 2) an empirical Bayes model that estimates the ratio of the observed count of harm to the count that would be expected if error characteristics and harm were independent. In addition, for the Bayesian hierarchical model, the package provides functions to assess the sensitivity of results to different specifications of the random effects distributions.
</p>


<h3>Details</h3>

<p>The package is loaded with the usual <code>library(mederrRank)</code> command. The most important functions are <code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code>, <code><a href="#topic+bhm.resample">bhm.resample</a></code> and <code><a href="#topic+mixnegbinom.em">mixnegbinom.em</a></code>.
</p>


<h3>Author(s)</h3>

<p>Sergio Venturini, Jessica Myers
</p>
<p>Maintainer: Sergio Venturini &lt;sergio.venturini@unicatt.it&gt;
</p>


<h3>References</h3>

<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bayes.rank">bayes.rank</a></code>,
<code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code>, 
<code><a href="#topic+bhm.resample">bhm.resample</a></code>,
<code><a href="#topic+mixnegbinom.em">mixnegbinom.em</a></code>.
</p>

<hr>
<h2 id='bayes.rank'>Optimal Bayesian Ranking</h2><span id='topic+bayes.rank'></span>

<h3>Description</h3>

<p>This function estimates the ranks of the log odds of harm of the various medication error profiles as described in Myers et al. (2011).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  bayes.rank(model)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="bayes.rank_+3A_model">model</code></td>
<td>
<p>a <a href="#topic+mederrFit">mederrFit</a> object.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Using the posterior samples of the <code class="reqn">\theta_i</code>, the function estimates the ranks of the log odds of harm of the various error profiles. Optimal Bayesian ranking gives estimates of rank for profile <code class="reqn">i</code> as
</p>
<p style="text-align: center;"><code class="reqn">\hat{R}_i = \sum_{k=1}^{n}{\hat{P}(\theta_k \leq \theta_i | \boldsymbol{y}, \boldsymbol{N})},</code>
</p>

<p>where <code class="reqn">\hat{P}(\theta_k \leq \theta_i | \boldsymbol{y}, \boldsymbol{N})</code>  is the posterior probability that <code class="reqn">\theta_k \leq \theta_i</code>.
</p>


<h3>Value</h3>

<p><code>bayes.rank</code> returns the numerical vector of Optimal Bayesian ranks for the chosen <a href="#topic+mederrFit">mederrFit</a> model (see the references for the details).
</p>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bhm.constr.resamp">bhm.constr.resamp</a></code>,
<code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data("simdata", package = "mederrRank")
summary(simdata)

fit &lt;- bhm.mcmc(simdata, nsim = 1000, burnin = 500, scale.factor = 1.1)
ranks &lt;- bayes.rank(fit)

summary(ranks)

## End(Not run)
</code></pre>

<hr>
<h2 id='bhm.constr.resamp'>
Markov Chain Monte Carlo Estimation (Step 2) of the Bayesian Hierarchical Model for Identifying the Most Harmful Medication Errors 
</h2><span id='topic+bhm.constr.resamp'></span>

<h3>Description</h3>

<p>This function represents the &quot;constructor&quot; function for the resampling procedure used in this package. <code><a href="#topic+bhm.resample">bhm.resample</a></code> calculates the importance ratios, and performs the sampling, and then this function constructs the resampled model based on that information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bhm.constr.resamp(model, resample, k, eta)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="bhm.constr.resamp_+3A_model">model</code></td>
<td>
<p>an object of <a href="base.html#topic+class">class</a> &quot;<a href="#topic+mederrFit">mederrFit</a>&quot;.</p>
</td></tr>
<tr><td><code id="bhm.constr.resamp_+3A_resample">resample</code></td>
<td>
<p>an object of <a href="base.html#topic+class">class</a> &quot;<a href="#topic+mederrResample">mederrResample</a>&quot;.</p>
</td></tr>
<tr><td><code id="bhm.constr.resamp_+3A_k">k</code></td>
<td>
<p><code class="reqn">k</code> (number of degrees of freedom) value to use in the resampling procedure.</p>
</td></tr>
<tr><td><code id="bhm.constr.resamp_+3A_eta">eta</code></td>
<td>
<p><code class="reqn">\eta</code> (skewing paramter) value to use in the resampling procedure.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Deviations from the normal, i.e. <code class="reqn">(k = \infty, \eta = 1)</code>, random effects distribution using a different pair of <code class="reqn">k</code> and <code class="reqn">\eta</code> values are considered. The methodology implemented here is the importance link function resampling approach introduce by MacEachern and Peruggia (2000): based on the <code class="reqn">(k = \infty, \eta = 1)</code> chain, new posterior samples under a new set of <code class="reqn">(k, \eta)</code> values is obtained.
</p>


<h3>Value</h3>

<p><code>bhm.constr.resamp</code> returns an object of the class &quot;<a href="#topic+mederrFit">mederrFit</a>&quot;.
</p>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>MacEachern, S. and Peruggia, M. (2000), &quot;Importance Link Function Estimation for Markov Chain Monte Carlo Methods&quot;, Journal of Computational and Graphical Statistics, 9, 99-121.
</p>
<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code>,
<code><a href="#topic+bhm.resample">bhm.resample</a></code>,
<code><a href="#topic+mederrData">mederrData</a></code>,
<code><a href="#topic+mederrFit">mederrFit</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data("simdata", package = "mederrRank")
summary(simdata)

fit &lt;- bhm.mcmc(simdata, nsim = 1000, burnin = 500, scale.factor = 1.1)
resamp &lt;- bhm.resample(fit, simdata, p.resample = .1,
	k = c(3, 6, 10, 30, 60, Inf), eta = c(.5, .8, 1, 1.25, 2))
fit2 &lt;- bhm.constr.resamp(fit, resamp, k = 3, eta = .8)
plot(fit, fit2, simdata)

theta0 &lt;- c(10, 6, 100, 100, .1)
ans &lt;- mixnegbinom.em(simdata, theta0, 50000, 0.01, se = TRUE,
	stratified = TRUE)

summary(fit2, ans, simdata)

## End(Not run)
</code></pre>

<hr>
<h2 id='bhm.mcmc'>
Markov Chain Monte Carlo Estimation (Step 1) of the Bayesian Hierarchical Model for Identifying the Most Harmful Medication Errors 
</h2><span id='topic+bhm.mcmc'></span>

<h3>Description</h3>

<p>This function implements the Markov Chain Monte Carlo estimation methodology for the Bayesian hierarchical model described in Myers et al. (2011).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bhm.mcmc(dat, nsim = 2000, burnin = 500, scale.factor = 1,
	adaptive.int = 100, adaptive.max = 1000, prior = NULL,
	init = NULL, tuneD = NULL, tuneT = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="bhm.mcmc_+3A_dat">dat</code></td>
<td>
<p>an object of <a href="base.html#topic+class">class</a> &quot;<a href="#topic+mederrData">mederrData</a>&quot;.</p>
</td></tr>
<tr><td><code id="bhm.mcmc_+3A_nsim">nsim</code></td>
<td>
<p>number of iterations.</p>
</td></tr>
<tr><td><code id="bhm.mcmc_+3A_burnin">burnin</code></td>
<td>
<p>number of burn-in iterations.</p>
</td></tr>
<tr><td><code id="bhm.mcmc_+3A_scale.factor">scale.factor</code></td>
<td>
<p>scale factor of the random effects proposal distribution.</p>
</td></tr>
<tr><td><code id="bhm.mcmc_+3A_adaptive.int">adaptive.int</code></td>
<td>
<p>iteration interval at which the standard error of the random effects proposal distribution is updated.</p>
</td></tr>
<tr><td><code id="bhm.mcmc_+3A_adaptive.max">adaptive.max</code></td>
<td>
<p>last iteration at which the standard error of the random effects proposal distribution is updated.</p>
</td></tr>
<tr><td><code id="bhm.mcmc_+3A_prior">prior</code></td>
<td>
<p>an optional list of the hyperparameters values; see the Details section below.</p>
</td></tr>
<tr><td><code id="bhm.mcmc_+3A_init">init</code></td>
<td>
<p>an optional list of initial values for the model parameters; see the Details section below.</p>
</td></tr>
<tr><td><code id="bhm.mcmc_+3A_tuned">tuneD</code></td>
<td>
<p>an optional vector of the <code class="reqn">\delta_j</code> proposal distribution variances.</p>
</td></tr>
<tr><td><code id="bhm.mcmc_+3A_tunet">tuneT</code></td>
<td>
<p>an optional vector of the <code class="reqn">\theta_i</code> proposal distribution variances.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The Bayesian hierarchical model (with crossed random effects) implemented here for identifying the medication error profiles with the largest log odds of harm is
</p>
<p style="text-align: center;"><code class="reqn">y_{ij} | N_{ij}, p_{ij} \sim Bin(N_{ij},p_{ij})</code>
</p>

<p style="text-align: center;"><code class="reqn">logit(p_{ij}) = \gamma + \theta_i + \delta_j</code>
</p>

<p style="text-align: center;"><code class="reqn">\theta_i | \sigma, \eta, k \sim St(0,\sigma,k,\eta), \qquad i=1,\ldots,n</code>
</p>

<p style="text-align: center;"><code class="reqn">\delta_j | \tau^2 \sim N(0,\tau^2), \qquad j=1,\ldots,J</code>
</p>

<p style="text-align: center;"><code class="reqn">\gamma \sim N(g,G)</code>
</p>

<p style="text-align: center;"><code class="reqn">\sigma^2 \sim IG(a_1,b_1)</code>
</p>

<p style="text-align: center;"><code class="reqn">\tau^2 \sim IG(a_2,b_2)</code>
</p>

<p style="text-align: center;"><code class="reqn">k \sim Unif(0,\infty)</code>
</p>

<p style="text-align: center;"><code class="reqn">\eta \sim Unif(0,\infty),</code>
</p>

<p>where <code class="reqn">N_{ij}</code> denotes the number of times that the error profile <code class="reqn">i</code> is cited on a report from hospital j and <code class="reqn">y_{ij}</code> is the corresponding number of times that profile <code class="reqn">i</code> in hospital <code class="reqn">j</code> was reported with harm.
This function implements the first model estimation step in which the values <code class="reqn">k = \infty</code> and <code class="reqn">k = 1</code>, i.e. a symmetric normal distribution, is forced for the error profiles' random effects. A sample from the joint posterior distribution of all other parameters via Markov Chain Monte Carlo with adaptive Metropolis steps for each set of random effects is obtained. For more details see Myers et al. (2011).
</p>


<h3>Value</h3>

<p><code>bhm.mcmc</code> returns an object of the class &quot;<a href="#topic+mederrFit">mederrFit</a>&quot;.
</p>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bhm.resample">bhm.resample</a></code>,
<code><a href="#topic+mederrData">mederrData</a></code>,
<code><a href="#topic+mederrFit">mederrFit</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data("simdata", package = "mederrRank")
summary(simdata)

fit &lt;- bhm.mcmc(simdata, nsim = 1000, burnin = 500, scale.factor = 1.1)
resamp &lt;- bhm.resample(fit, simdata, p.resample = .1,
	k = c(3, 6, 10, 30, 60, Inf), eta = c(.5, .8, 1, 1.25, 2))
fit2 &lt;- bhm.constr.resamp(fit, resamp, k = 3, eta = .8)
plot(fit, fit2, simdata)

theta0 &lt;- c(10, 6, 100, 100, .1)
ans &lt;- mixnegbinom.em(simdata, theta0, 50000, 0.01, se = TRUE,
	stratified = TRUE)

summary(fit2, ans, simdata)
## End(Not run)
</code></pre>

<hr>
<h2 id='bhm.resample'>
Resampling Transformation for the Markov Chain Monte Carlo Estimation Simulation of the Bayesian Hierarchical Model for Identifying the Most Harmful Medication Errors
</h2><span id='topic+bhm.resample'></span>

<h3>Description</h3>

<p>This function implements the transformation needed to apply the importance link function resampling methodology based on the Markov Chain Monte Carlo simulations obtained with the <code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code> command (see the References).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bhm.resample(model, dat, p.resample = 0.1, k, eta)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="bhm.resample_+3A_model">model</code></td>
<td>
<p>an object of <a href="base.html#topic+class">class</a> &quot;<a href="#topic+mederrFit">mederrFit</a>&quot;.</p>
</td></tr>
<tr><td><code id="bhm.resample_+3A_dat">dat</code></td>
<td>
<p>an object of <a href="base.html#topic+class">class</a> &quot;<a href="#topic+mederrData">mederrData</a>&quot;.</p>
</td></tr>
<tr><td><code id="bhm.resample_+3A_p.resample">p.resample</code></td>
<td>
<p>proportion of simulations resampled from the <code>model</code> argument.</p>
</td></tr>
<tr><td><code id="bhm.resample_+3A_k">k</code></td>
<td>
<p>required vector of <code class="reqn">k</code> values to be used in the resampling process.</p>
</td></tr>
<tr><td><code id="bhm.resample_+3A_eta">eta</code></td>
<td>
<p>required vector of <code class="reqn">\eta</code> values to be used in the resampling process.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>bhm.resample</code> returns an object of the class &quot;<a href="#topic+mederrResample">mederrResample</a>&quot;.
</p>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>MacEachern, S. and Peruggia, M. (2000), &quot;Importance Link Function Estimation for Markov Chain Monte Carlo Methods&quot;, Journal of Computational and Graphical Statistics, 9, 99-121.
</p>
<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mederrData">mederrData</a></code>,
<code><a href="#topic+mederrFit">mederrFit</a></code>,
<code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data("simdata", package = "mederrRank")
summary(simdata)

fit &lt;- bhm.mcmc(simdata, nsim = 1000, burnin = 500, scale.factor = 1.1)
resamp &lt;- bhm.resample(fit, simdata, p.resample = .1,
	k = c(3, 6, 10, 30, 60, Inf), eta = c(.5, .8, 1, 1.25, 2))
fit2 &lt;- bhm.constr.resamp(fit, resamp, k = 3, eta = .8)
plot(fit, fit2, simdata)

theta0 &lt;- c(10, 6, 100, 100, .1)
ans &lt;- mixnegbinom.em(simdata, theta0, 50000, 0.01, se = TRUE,
	stratified = TRUE)

summary(fit2, ans, simdata)

## End(Not run)
</code></pre>

<hr>
<h2 id='dmixnegbinom'>
The Negative Binomial Mixture Distribution
</h2><span id='topic+dmixnegbinom'></span>

<h3>Description</h3>

<p>Density function for a mixture of two negative binomial distributions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dmixnegbinom(x, theta, E, log.p = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dmixnegbinom_+3A_x">x</code></td>
<td>
<p>vector of (non-negative integer) quantiles.</p>
</td></tr>
<tr><td><code id="dmixnegbinom_+3A_theta">theta</code></td>
<td>
<p>vector of parameters for the negative binomial distribution mixture.</p>
</td></tr>
<tr><td><code id="dmixnegbinom_+3A_e">E</code></td>
<td>
<p>vector of (non-negative integer) expected counts.</p>
</td></tr>
<tr><td><code id="dmixnegbinom_+3A_log.p">log.p</code></td>
<td>
<p>logical; if TRUE, probabilities p are given as log(p).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The mixture of two negative binomial distributions has density
</p>
<p style="text-align: center;"><code class="reqn">P(N = x) = theta[5] f(x;theta[1],theta[2],E) + (1 - theta[5]) f(x;theta[3],theta[4],E),</code>
</p>

<p>where
</p>
<p style="text-align: center;"><code class="reqn">f(x;\alpha,\beta,E) = \frac{\Gamma(\alpha + x)}{\Gamma(\alpha) x!}\frac{1}{(1 + \beta/E)^x}\frac{1}{(1 + E/\beta)^\alpha}</code>
</p>

<p>for <code class="reqn">x = 0,1,\ldots,\alpha</code>, <code class="reqn">\alpha, \beta, E &gt; 0</code> and <code class="reqn">0 &lt; theta[5] \leq 1</code>.
The mixture of two negative binomial distributions represents the marginal distribution of the counts <code class="reqn">N</code> coming from Poisson data with parameter <code class="reqn">\lambda</code> and a mixture of two gamma distributions as its prior. For details see the paper by Dumouchel (1999).
</p>


<h3>Value</h3>

<p><code>dmixnegbinom</code> gives the density corresponding to the <code>E</code> and <code>theta</code> values provided.
</p>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>DuMouchel W. (1999), &quot;Bayesian Data Mining in Large Frequency Tables, with an Application to the FDA Spontaneous Reporting System&quot;. The American Statistician, 53, 177-190.
</p>
<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+dnbinom">dnbinom</a></code>,
<code><a href="#topic+rmixnegbinom">rmixnegbinom</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data("simdata", package = "mederrRank")
ni &lt;- simdata@numi
theta0 &lt;- c(10, 6, 100, 100, .1)
ans &lt;- mixnegbinom.em(simdata, theta0, 50000, 0.01,
	se = FALSE, stratified = TRUE)
theta &lt;- ans$theta.hat
N.E &lt;- cbind(ans$N[1:ni], ans$E[1:ni])[sort(ans$N[1:ni], index.return = TRUE)$ix, ]
N.ix &lt;- match(unique(N.E[, 1]), N.E[, 1])
N &lt;- N.E[N.ix, 1]
E &lt;- N.E[N.ix, 2]
dens &lt;- dmixnegbinom(N, theta, E)
hist(N.E[, 1], breaks = 40, freq = FALSE)
points(N, dens)

## End(Not run)
</code></pre>

<hr>
<h2 id='dnegbinom'>
The Negative Binomial Distribution
</h2><span id='topic+dnegbinom'></span>

<h3>Description</h3>

<p>Density function for the negative binomial distribution with parameters <code>alpha</code> and <code>prob</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dnegbinom(x, alpha, prob, log.p = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dnegbinom_+3A_x">x</code></td>
<td>
<p>vector of (non-negative integer) quantiles.</p>
</td></tr>
<tr><td><code id="dnegbinom_+3A_alpha">alpha</code></td>
<td>
<p>target for number of successful trials. Must be strictly positive, need not be integer.</p>
</td></tr>
<tr><td><code id="dnegbinom_+3A_prob">prob</code></td>
<td>
<p>probability of success in each trial. <code>0 &lt; prob &lt;= 1</code>.</p>
</td></tr>
<tr><td><code id="dnegbinom_+3A_log.p">log.p</code></td>
<td>
<p>logical; if TRUE, probabilities p are given as log(p).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The negative binomial distribution with parameters <code>alpha</code> = <code class="reqn">\alpha</code> and <code>prob</code> = <code class="reqn">p</code> has density
</p>
<p style="text-align: center;"><code class="reqn">\frac{\Gamma(x + \alpha)}{\Gamma(\alpha) x!} p^\alpha (1-p)^x</code>
</p>

<p>for <code class="reqn">x = 0,1,\ldots,\alpha &gt; 0</code> and <code class="reqn">0 &lt; p \leq 1</code>.
This represents the number of failures which occur in a sequence of Bernoulli trials before a target number of successes is reached.
</p>


<h3>Value</h3>

<p><code>dnegbinom</code> gives the density corresponding to the <code>alpha</code> and <code>prob</code> values provided.
</p>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>DuMouchel W. (1999), &quot;Bayesian Data Mining in Large Frequency Tables, with an Application to the FDA Spontaneous Reporting System&quot;. The American Statistician, 53, 177-190.
</p>
<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dmixnegbinom">dmixnegbinom</a></code>,
<code><a href="stats.html#topic+dnbinom">dnbinom</a></code>.
</p>

<hr>
<h2 id='dst'>
The Skewed Student t Distribution
</h2><span id='topic+dst'></span>

<h3>Description</h3>

<p>Density function for the skewed t distribution with <code>k</code> degrees of freedom, scale parameter <code>sigma</code> and skewness <code>eta</code> .
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dst(x, sigma, k, eta)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dst_+3A_x">x</code></td>
<td>
<p>vector of quantiles.</p>
</td></tr>
<tr><td><code id="dst_+3A_sigma">sigma</code></td>
<td>
<p>scale parameter (<code class="reqn">&gt; 0</code>).</p>
</td></tr>
<tr><td><code id="dst_+3A_k">k</code></td>
<td>
<p>degrees of freedom (<code class="reqn">&gt; 0</code>, maybe non-integer). <code>df = Inf</code> is allowed.</p>
</td></tr>
<tr><td><code id="dst_+3A_eta">eta</code></td>
<td>
<p>skewness parameter (<code class="reqn">&gt; 0</code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This distribution is based on introducing skewing into the symmetric scaled t distribution, as described in Fernandez and Steel (1998).
The parameters characterizing the center (here set at 0) and the spread (<code>sigma</code>) refer to the mean and standard deviation of the underlying symmetric distribution.
In the skewed t distribution, the centrality parameter defines the mode of the distribution, but it is no longer either the mean or the median. Similarly, in the skewed t distribution, <code>sigma</code> still characterizes the spread, but it can no longer be interpreted directly as the standard deviation of the distribution.
</p>


<h3>Value</h3>

<p><code>dst</code> gives the density corresponding to the <code>simga</code>, <code>k</code> and <code>eta</code> values provided.
</p>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>Fernandez, C. and Steel, M. (1998), &quot;On Bayesian Modeling of Fat Tails and Skewness&quot;. Journal of the American Statistical Association, 93, 359-371.
</p>
<p>Lee, K. and Thompson, S. (2008), &quot;Flexible Parametric Models for Random-Effects Distributions&quot;. Statistics in Medicine, 27, 418-434.
</p>
<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+dt">dt</a></code>.
</p>

<hr>
<h2 id='EBGM'>
Geometric Mean of the Relative Risk Empirical Bayes Posterior Distribution
</h2><span id='topic+EBGM'></span>

<h3>Description</h3>

<p>This function computes the geometric mean of the empirical Bayes posterior distribution for the observed vs. expected count relative risk.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>EBGM(eb.result)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="EBGM_+3A_eb.result">eb.result</code></td>
<td>
<p>output of the <code><a href="#topic+mixnegbinom.em">mixnegbinom.em</a></code> or <code><a href="#topic+negbinom.em">negbinom.em</a></code> commands.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For further details see DuMouchel (1999).
</p>


<h3>Value</h3>

<p><code>EBGM</code> returns the vector of geometric means.
</p>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>DuMouchel W. (1999), &quot;Bayesian Data Mining in Large Frequency Tables, with an Application to the FDA Spontaneous Reporting System&quot;. The American Statistician, 53, 177-190.
</p>
<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mixnegbinom.em">mixnegbinom.em</a></code>,
<code><a href="#topic+negbinom.em">negbinom.em</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data("simdata", package = "mederrRank")
summary(simdata)

fit &lt;- bhm.mcmc(simdata, nsim = 1000, burnin = 500, scale.factor = 1.1)
resamp &lt;- bhm.resample(fit, simdata, p.resample = .1,
	k = c(3, 6, 10, 30, 60, Inf), eta = c(.5, .8, 1, 1.25, 2))
fit2 &lt;- bhm.constr.resamp(fit, resamp, k = 3, eta = .8)

theta0 &lt;- c(10, 6, 100, 100, .1)
ans &lt;- mixnegbinom.em(simdata, theta0, 50000, 0.01,
	se = FALSE, stratified = TRUE)

ni &lt;- simdata@numi
rank(EBGM(ans)[1:ni])
summary(fit2, ans, simdata)
## End(Not run)
</code></pre>

<hr>
<h2 id='llDiffD'>
Log-Likelihood Difference for the <code class="reqn">\delta_j</code> Parameters
</h2><span id='topic+llDiffD'></span>

<h3>Description</h3>

<p>This function computes the log-likelihood difference for the candidate <code class="reqn">\delta_j</code> random effects. It is a helper function and not meant to be used on its own.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>llDiffD(dat, deltaj, cand, thetai, gamma, tau2)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="llDiffD_+3A_dat">dat</code></td>
<td>
<p>data frame containing the observed sample counts.</p>
</td></tr>
<tr><td><code id="llDiffD_+3A_deltaj">deltaj</code></td>
<td>
<p>vector of previous accepted values for the <code class="reqn">\delta_j</code> random effects.</p>
</td></tr>
<tr><td><code id="llDiffD_+3A_cand">cand</code></td>
<td>
<p>vector of candidate values for the <code class="reqn">\delta_j</code> random effects.</p>
</td></tr>
<tr><td><code id="llDiffD_+3A_thetai">thetai</code></td>
<td>
<p>vector of previous accepted values for the <code class="reqn">\theta_i</code> random effects.</p>
</td></tr>
<tr><td><code id="llDiffD_+3A_gamma">gamma</code></td>
<td>
<p>last sampled value for the <code class="reqn">\gamma</code> parameter.</p>
</td></tr>
<tr><td><code id="llDiffD_+3A_tau2">tau2</code></td>
<td>
<p>last sampled value for the <code class="reqn">\tau^2</code> parameter.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For further details see Myers et al. (2011).
</p>


<h3>Value</h3>

<p><code>llDiffD</code> returns the vector of log-likelihood differences.
</p>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bhm.constr.resamp">bhm.constr.resamp</a></code>,
<code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code>,
<code><a href="#topic+bhm.resample">bhm.resample</a></code>.
</p>

<hr>
<h2 id='llDiffT'>
Log-Likelihood Difference for the <code class="reqn">\theta_i</code> Parameters
</h2><span id='topic+llDiffT'></span>

<h3>Description</h3>

<p>This function computes the log-likelihood difference for the candidate <code class="reqn">\theta_i</code> random effects. It is a helper function and not meant to be used on its own.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>llDiffT(dat, thetai, cand, deltaj, gamma, sigma2)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="llDiffT_+3A_dat">dat</code></td>
<td>
<p>data frame containing the observed sample counts.</p>
</td></tr>
<tr><td><code id="llDiffT_+3A_thetai">thetai</code></td>
<td>
<p>vector of previous accepted values for the <code class="reqn">\theta_i</code> random effects.</p>
</td></tr>
<tr><td><code id="llDiffT_+3A_cand">cand</code></td>
<td>
<p>vector of candidate values for the <code class="reqn">\delta_j</code> random effects.</p>
</td></tr>
<tr><td><code id="llDiffT_+3A_deltaj">deltaj</code></td>
<td>
<p>vector of previous accepted values for the <code class="reqn">\delta_j</code> random effects.</p>
</td></tr>
<tr><td><code id="llDiffT_+3A_gamma">gamma</code></td>
<td>
<p>last sampled value for the <code class="reqn">\gamma</code> parameter.</p>
</td></tr>
<tr><td><code id="llDiffT_+3A_sigma2">sigma2</code></td>
<td>
<p>last sampled value for the <code class="reqn">\sigma^2</code> parameter.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For further details see Myers et al. (2011).
</p>


<h3>Value</h3>

<p><code>llDiffT</code> returns the vector of log-likelihood differences.
</p>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bhm.constr.resamp">bhm.constr.resamp</a></code>,
<code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code>,
<code><a href="#topic+bhm.resample">bhm.resample</a></code>.
</p>

<hr>
<h2 id='logp'>
Negative Log-Posterior Function of the Bayesian Hierarchical Model for Identifying the Most Harmful Medication Errors
</h2><span id='topic+logp'></span>

<h3>Description</h3>

<p>This function computes the negative log-posterior distribution of the Bayesian hierarchical model described in Myers et al (2011). It is a helper function and not meant to be used on its own.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>logp(theta, deltaj, sigma2, i, k, eta, dat)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="logp_+3A_theta">theta</code></td>
<td>
<p>value of the error profile random effect at which the log.posterior distribution is calculated.</p>
</td></tr>
<tr><td><code id="logp_+3A_deltaj">deltaj</code></td>
<td>
<p>vector of hospital random effect values.</p>
</td></tr>
<tr><td><code id="logp_+3A_sigma2">sigma2</code></td>
<td>
<p>scale parameter (<code class="reqn">&gt; 0</code>).</p>
</td></tr>
<tr><td><code id="logp_+3A_i">i</code></td>
<td>
<p>error profile index for which the calculate of the log.posterior distribution is needed.</p>
</td></tr>
<tr><td><code id="logp_+3A_k">k</code></td>
<td>
<p>degrees of freedom (<code class="reqn">&gt; 0</code>, maybe non-integer). <code>df = Inf</code> is allowed.</p>
</td></tr>
<tr><td><code id="logp_+3A_eta">eta</code></td>
<td>
<p>skewness parameter (<code class="reqn">&gt; 0</code>).</p>
</td></tr>
<tr><td><code id="logp_+3A_dat">dat</code></td>
<td>
<p>an object of <a href="base.html#topic+class">class</a> &quot;<a href="#topic+mederrData">mederrData</a>&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For further details see Myers et al. (2011).
</p>


<h3>Value</h3>

<p><code>logp</code> returns a vector of log-posterior values.  
</p>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bhm.constr.resamp">bhm.constr.resamp</a></code>,
<code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code>,
<code><a href="#topic+bhm.resample">bhm.resample</a></code>.
</p>

<hr>
<h2 id='logunpost'>
Unnormalized Marginal Posterior Distributions for <code class="reqn">k</code> and <code class="reqn">\eta</code>
</h2><span id='topic+logunpost'></span>

<h3>Description</h3>

<p>This functions computes the unnormalized marginal posterior distributions for the <code class="reqn">k</code> and <code class="reqn">\eta</code> parameters as described in Myers et al (2011). 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>logunpost(resample)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="logunpost_+3A_resample">resample</code></td>
<td>
<p>an object of <a href="base.html#topic+class">class</a> &quot;<a href="#topic+mederrResample">mederrResample</a>&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>logunpost</code> is used in the plot <code>method</code> for a <a href="#topic+mederrResample">mederrResample</a> object.
</p>


<h3>Value</h3>

<p><code>logunpost</code> returns an array with the posterior distribution values.  
</p>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bhm.constr.resamp">bhm.constr.resamp</a></code>,
<code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code>,
<code><a href="#topic+bhm.resample">bhm.resample</a></code>,
<code><a href="#topic+mederrResample">mederrResample</a></code>.
</p>

<hr>
<h2 id='mederrData-class'>Class &quot;mederrData&quot;. Data Specification for Identifying the Most Harmful MEdication Errors using a Bayesian Hierarchical Model.</h2><span id='topic+mederrData-class'></span><span id='topic+mederrData'></span><span id='topic+initialize+2CmederrData-method'></span>

<h3>Description</h3>

<p>This class encapsulates the data specification for a Bayesian Hierarchical Model used to identify the most harmful medication errors as described in Myers et al. (2011).
</p>


<h3>Objects from the Class</h3>

<p>Objects can be created by calls of the form <code>new("mederrData", data)</code>, where the <code>data</code> argument has to be a matrix or a data frame object that contains the following (<em>numeric</em>) information for each error profile/hospital combination:
</p>

<ol>
<li><p> the number of times (<code class="reqn">y</code>) that profile <code class="reqn">i</code> in hospital <code class="reqn">j</code> was reported with harm;
</p>
</li>
<li><p> the total number of times (<code class="reqn">N</code>) that the error profile <code class="reqn">i</code> is cited on a report from hospital <code class="reqn">j</code>,
</p>
</li>
<li><p> the error profile <code class="reqn">i</code> identification code,
</p>
</li>
<li><p> the hospital <code class="reqn">j</code> identification code.
</p>
</li></ol>



<h3>Slots</h3>


<dl>
<dt><code>data</code>:</dt><dd><p>Object of class <code>"data.frame"</code>; data in the standard <code><a href="base.html#topic+data.frame">data.frame</a></code> form.</p>
</dd>
<dt><code>size</code>:</dt><dd><p>Object of class <code>"numeric"</code>; total number of observations in the data set.</p>
</dd>
<dt><code>numi</code>:</dt><dd><p>Object of class <code>"numeric"</code>; number of error profiles available in the data set.</p>
</dd>
<dt><code>numj</code>:</dt><dd><p>Object of class <code>"numeric"</code>; number of hospitals available in the data set.</p>
</dd>
</dl>



<h3>Methods</h3>



<dl>
<dt>plot</dt><dd><p><code>signature(x = "mederrData", y = "missing")</code>: Provides a pictorial representation for a sample of error profiles reported by some hospitals.</p>
</dd>
<dt>summary</dt><dd><p><code>signature(object = "mederrData")</code>: Summarizes information about an <code><a href="#topic+mederrData">mederrData</a></code> object.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bayes.rank">bayes.rank</a></code>,
<code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code>, 
<code><a href="#topic+bhm.resample">bhm.resample</a></code>,
<code><a href="#topic+mixnegbinom.em">mixnegbinom.em</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ng &lt;- 50
i &lt;- rep(1:ng, ng)
j &lt;- rep(1:ng, each = ng)
N &lt;- rpois(ng^2, 3 + .05*i - .01*j) + 1

theta_i &lt;- rgamma(ng, 5, 5) - 4/5
delta_j &lt;- rnorm(ng, 0, .2)
logit &lt;- -3 + theta_i[i] + delta_j[j]
y &lt;- rbinom(ng^2, N, exp(logit)/(1 + exp(logit)))

simdata &lt;- new("mederrData", data = cbind(y, N, i, j))
</code></pre>

<hr>
<h2 id='mederrFit-class'>Class &quot;mederrFit&quot;. Simulated Monte Carlo Chains (Step 1) for the Bayesian Hierarchical Model Used to Identify the Most Harmful Medication Errors.</h2><span id='topic+mederrFit-class'></span><span id='topic+mederrFit'></span><span id='topic+initialize+2CmederrFit-method'></span>

<h3>Description</h3>

<p>This class encapsulates the simulated Monte Carlo chains for the Bayesian Hierarchical Model as described in Myers et al. (2011) forcing a symmetric normal distribution on the <code class="reqn">\theta_i</code>, <code class="reqn">i=1,\ldots,n</code>.
</p>


<h3>Objects from the Class</h3>

<p>Objects can be created by calls of the form <code>new("mederrFit", thetai, deltaj, gamma, sigma2, tau2, p.acc.i, p.acc.j, tune.theta, tune.delta, k, eta)</code>, but most often as the result of a call to <code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code> or to <code><a href="#topic+bhm.constr.resamp">bhm.constr.resamp</a></code>.
</p>


<h3>Slots</h3>


<dl>
<dt><code>thetai</code>:</dt><dd><p>Object of class <code>"matrix"</code>; simulated chains for the <code class="reqn">\theta_i</code>, <code class="reqn">i = 1,\ldots,n</code>, error profiles random effects; see <code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code>.</p>
</dd>
<dt><code>deltaj</code>:</dt><dd><p>Object of class <code>"matrix"</code>; simulated chains for the <code class="reqn">\delta_j</code>, <code class="reqn">i = j,\ldots,J</code>, hospitals random effects; see <code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code>.</p>
</dd>
<dt><code>gamma</code>:</dt><dd><p>Object of class <code>"numeric"</code>; simulated chain for the <code class="reqn">\gamma</code> parameter; see <code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code>.</p>
</dd>
<dt><code>sigma2</code>:</dt><dd><p>Object of class <code>"numeric"</code>; simulated chain for the <code class="reqn">\sigma^2</code> parameter; see <code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code>.</p>
</dd>
<dt><code>tau2</code>:</dt><dd><p>Object of class <code>"numeric"</code>; simulated chain for the <code class="reqn">\tau^2</code> parameter; see <code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code>.</p>
</dd>
<dt><code>p.acc.i</code>:</dt><dd><p>Object of class <code>"numeric"</code>; acceptance rates for the error profiles random effects.</p>
</dd>
<dt><code>p.acc.j</code>:</dt><dd><p>Object of class <code>"numeric"</code>; acceptance rates for the hospitals random effects.</p>
</dd>
<dt><code>tune.theta</code>:</dt><dd><p>Object of class <code>"numeric"</code>; last updated values of the <code class="reqn">\theta_i</code> working variances for the Metropolis step.</p>
</dd>
<dt><code>tune.delta</code>:</dt><dd><p>Object of class <code>"numeric"</code>; last updated values of the <code class="reqn">\delta_j</code> working variances for the Metropolis step.</p>
</dd>
<dt><code>k</code>:</dt><dd><p>Object of class <code>"numeric"</code>; <code class="reqn">k</code> value used in the simulation.</p>
</dd>
<dt><code>eta</code>:</dt><dd><p>Object of class <code>"numeric"</code>; <code class="reqn">\eta</code> value used in the simulation.</p>
</dd>
</dl>



<h3>Methods</h3>



<dl>
<dt>plot</dt><dd><p><code>signature(x = "mederrFit", y = "mederrFit")</code>: Provides a graphical representation of the estimates.</p>
</dd>
<dt>summary</dt><dd><p><code>signature(object = "mederrFit")</code>: Summarizes the information regarding the estimates.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bayes.rank">bayes.rank</a></code>,
<code><a href="#topic+bhm.constr.resamp">bhm.constr.resamp</a></code>,
<code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code>.
</p>

<hr>
<h2 id='mederrResample-class'>Class &quot;mederrResample&quot;. Simulated Monte Carlo Chains (Step 2) for the Bayesian Hierarchical Model Used to Identify the Most Harmful Medication Errors.</h2><span id='topic+mederrResample-class'></span><span id='topic+mederrResample'></span><span id='topic+initialize+2CmederrResample-method'></span>

<h3>Description</h3>

<p>This class encapsulates the information needed to resample the Monte Carlo chains for the Bayesian Hierarchical Model as described in Myers et al. (2011) using user defined values for <code class="reqn">k</code> and <code class="reqn">eta</code>.
</p>


<h3>Objects from the Class</h3>

<p>Objects can be created by calls of the form <code>new("mederrResample", log.ir, samp, A, t.new, t.old, grd)</code>, but most often as the result of a call to <code><a href="#topic+bhm.resample">bhm.resample</a></code>.
</p>


<h3>Slots</h3>


<dl>
<dt><code>log.ir</code>:</dt><dd><p>Object of class <code>"array"</code>; logarithm of the importance ratio for each pair of <code class="reqn">(k,\eta)</code> values.</p>
</dd>
<dt><code>samp</code>:</dt><dd><p>Object of class <code>"array"</code>; resampled MCMC simulation indexes.</p>
</dd>
<dt><code>A</code>:</dt><dd><p>Object of class <code>"array"</code>; transformation ratio for each pair of <code class="reqn">(k,\eta)</code> values.</p>
</dd>
<dt><code>t.new</code>:</dt><dd><p>Object of class <code>"array"</code>; <code class="reqn">\theta_i</code> posterior modes using <code class="reqn">(k = \infty, \eta = 1)</code>.</p>
</dd>
<dt><code>t.old</code>:</dt><dd><p>Object of class <code>"numeric"</code>; <code class="reqn">\theta_i</code> posterior modes using user defined <code class="reqn">(k, \eta)</code> values.</p>
</dd>
<dt><code>grd</code>:</dt><dd><p>Object of class <code>"list"</code>; grid of required <code class="reqn">(k, \eta)</code> values.</p>
</dd>
</dl>



<h3>Methods</h3>



<dl>
<dt>plot</dt><dd><p><code>signature(x = "mederrResample", y = "missing")</code>: : Provides a graphical representation of a <code><a href="#topic+mederrResample">mederrResample</a></code> object.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bayes.rank">bayes.rank</a></code>.
<code><a href="#topic+bhm.constr.resamp">bhm.constr.resamp</a></code>,
<code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code>. 
</p>

<hr>
<h2 id='MEDMARX'>
Subset of the MEDMARX Data
</h2><span id='topic+MEDMARX'></span>

<h3>Description</h3>

<p>Subset of the MEDMARX data included for illustrative purposes only in the <code><a href="#topic+mederrRank">mederrRank</a></code> package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(MEDMARX)</code></pre>


<h3>Format</h3>

<p>An object of class <code><a href="#topic+mederrData">mederrData</a></code>.
</p>


<h3>Details</h3>

<p>The data contained in this object are reproduced by gentle permission of Quantros, Inc., 690 N. McCarthy Blvd., Suite 200, Milpitas, CA 95035.
</p>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code>,
<code><a href="#topic+mederrData">mederrData</a></code>,
<code><a href="#topic+mederrFit">mederrFit</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("MEDMARX", package = "mederrRank")
summary(MEDMARX)
plot(MEDMARX, nbins.err = 20, nbins.hosp = 10)
</code></pre>

<hr>
<h2 id='mixnegbinom.em'>
Expectation-Maximization Algorithm for the Mixture of Negative Binomial Distributions
</h2><span id='topic+mixnegbinom.em'></span>

<h3>Description</h3>

<p>This function provides the empirical Bayes estimates for the parameters <code>theta</code> of a mixture of two negative binomial distributions (see <code><a href="#topic+dmixnegbinom">dmixnegbinom</a></code>) using an Expectation-Maximization algorithm.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mixnegbinom.em(dat, theta0, maxiter = 50000, toler = 0.01,
	se = TRUE, stratified = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mixnegbinom.em_+3A_dat">dat</code></td>
<td>
<p>an object of <a href="base.html#topic+class">class</a> &quot;<a href="#topic+mederrData">mederrData</a>&quot;.</p>
</td></tr>
<tr><td><code id="mixnegbinom.em_+3A_theta0">theta0</code></td>
<td>
<p>initial values for the parameters to be optimized over.</p>
</td></tr>
<tr><td><code id="mixnegbinom.em_+3A_maxiter">maxiter</code></td>
<td>
<p>a positive integer specifying the maximum number of iterations to be performed before the program is terminated.</p>
</td></tr>
<tr><td><code id="mixnegbinom.em_+3A_toler">toler</code></td>
<td>
<p>a positive scalar giving the tolerance at which the change in the log-likelihood is considered close enough to zero to terminate the algorithm.</p>
</td></tr>
<tr><td><code id="mixnegbinom.em_+3A_se">se</code></td>
<td>
<p>logical; if TRUE the standard errors of the estimates are also returned.</p>
</td></tr>
<tr><td><code id="mixnegbinom.em_+3A_stratified">stratified</code></td>
<td>
<p>logical; if TRUE the analysis will be performed by stratifying on the hospitals.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For further details see Myers et al. (2011).
</p>


<h3>Value</h3>

<p><code>mixnegbinom.em</code> returns a list with components:
</p>
<table role = "presentation">
<tr><td><code>theta.hat</code></td>
<td>
<p>The best set of parameters found.</p>
</td></tr>
<tr><td><code>final.err</code></td>
<td>
<p>The last change in the log-likelihood; it has to be smaller than the <code>toler</code> argument.</p>
</td></tr>
<tr><td><code>final.ll</code></td>
<td>
<p>The likelihood value corresponding to <code>theta.hat</code>.</p>
</td></tr>
<tr><td><code>final.score</code></td>
<td>
<p>The log-likelihood score value corresponding to <code>theta.hat</code>.</p>
</td></tr>
<tr><td><code>num.iter</code></td>
<td>
<p>The number of iterations performed to find the proposed solution.</p>
</td></tr>
<tr><td><code>se</code></td>
<td>
<p>Only if argument <code>se</code> is true. A vector of estimates standard errors for the solution found.</p>
</td></tr>
<tr><td><code>N</code></td>
<td>
<p>The vector of observed error profiles counts.</p>
</td></tr>
<tr><td><code>E</code></td>
<td>
<p>The vector of expected error profiles counts.</p>
</td></tr>
<tr><td><code>prior</code></td>
<td>
<p>A character string giving the prior used; for this function is set to &quot;mixgamma&quot;, i.e. a mixture of two gamma distributions as in DuMouchel (1999).</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>DuMouchel W. (1999), &quot;Bayesian Data Mining in Large Frequency Tables, with an Application to the FDA Spontaneous Reporting System&quot;. The American Statistician, 53, 177-190.
</p>
<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dmixnegbinom">dmixnegbinom</a></code>,
<code><a href="#topic+EBGM">EBGM</a></code>,
<code><a href="#topic+negbinom.em">negbinom.em</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data("simdata", package = "mederrRank")
summary(simdata)

fit &lt;- bhm.mcmc(simdata, nsim = 1000, burnin = 500, scale.factor = 1.1)
resamp &lt;- bhm.resample(fit, simdata, p.resample = .1,
	k = c(3, 6, 10, 30, 60, Inf), eta = c(.5, .8, 1, 1.25, 2))
fit2 &lt;- bhm.constr.resamp(fit, resamp, k = 3, eta = .8)
plot(fit, fit2, simdata)

theta0 &lt;- c(10, 6, 100, 100, .1)
ans &lt;- mixnegbinom.em(simdata, theta0, 50000, 0.01,
	se = TRUE, stratified = TRUE)
ans$theta
ans$se

summary(fit2, ans, simdata)
## End(Not run)
</code></pre>

<hr>
<h2 id='mixnegbinom.loglik'>
Log-Likelihood Function for the Mixture of Negative Binomial Distributions
</h2><span id='topic+mixnegbinom.loglik'></span>

<h3>Description</h3>

<p>This function computes the log-likelihood function for the mixture of two negative binomial distributions as described in <code><a href="#topic+dmixnegbinom">dmixnegbinom</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mixnegbinom.loglik(theta, N, E)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mixnegbinom.loglik_+3A_theta">theta</code></td>
<td>
<p>vector of parameter values.</p>
</td></tr>
<tr><td><code id="mixnegbinom.loglik_+3A_n">N</code></td>
<td>
<p>vector of observed error profiles counts.</p>
</td></tr>
<tr><td><code id="mixnegbinom.loglik_+3A_e">E</code></td>
<td>
<p>vector of expected error profiles counts.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For further details see Myers et al. (2011).
</p>


<h3>Value</h3>

<p><code>mixnegbinom.loglik</code> returns the log-likelihood value for the negative binomial mixture.
</p>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>DuMouchel W. (1999), &quot;Bayesian Data Mining in Large Frequency Tables, with an Application to the FDA Spontaneous Reporting System&quot;. The American Statistician, 53, 177-190.
</p>
<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dmixnegbinom">dmixnegbinom</a></code>,
<code><a href="#topic+mixnegbinom.em">mixnegbinom.em</a></code>,
<code><a href="#topic+mixnegbinom.score">mixnegbinom.score</a></code>.
</p>

<hr>
<h2 id='mixnegbinom.score'>
Log-Likelihood Score Function for the Mixture of Negative Binomial Distributions
</h2><span id='topic+mixnegbinom.score'></span>

<h3>Description</h3>

<p>This function computes the log-likelihood score for the mixture of two negative binomial distributions as described in <code><a href="#topic+dmixnegbinom">dmixnegbinom</a></code>. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mixnegbinom.score(theta, N, E)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mixnegbinom.score_+3A_theta">theta</code></td>
<td>
<p>vector of parameter values.</p>
</td></tr>
<tr><td><code id="mixnegbinom.score_+3A_n">N</code></td>
<td>
<p>vector of observed error profiles counts.</p>
</td></tr>
<tr><td><code id="mixnegbinom.score_+3A_e">E</code></td>
<td>
<p>vector of expected error profiles counts.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For further details see Myers et al. (2011).
</p>


<h3>Value</h3>

<p><code>mixnegbinom.score</code> returns the vector of log-likelihood score values for the negative binomial mixture.
</p>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>DuMouchel W. (1999), &quot;Bayesian Data Mining in Large Frequency Tables, with an Application to the FDA Spontaneous Reporting System&quot;. The American Statistician, 53, 177-190.
</p>
<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dmixnegbinom">dmixnegbinom</a></code>,
<code><a href="#topic+mixnegbinom.em">mixnegbinom.em</a></code>,
<code><a href="#topic+mixnegbinom.loglik">mixnegbinom.loglik</a></code>.
</p>

<hr>
<h2 id='negbinom.em'>
Expectation-Maximization Algorithm for the Negative Binomial Distribution
</h2><span id='topic+negbinom.em'></span>

<h3>Description</h3>

<p>This function provides the empirical Bayes estimates for the parameters <code>theta</code> of a negative binomial distribution (see <code><a href="#topic+dnegbinom">dnegbinom</a></code>) using an Expectation-Maximization algorithm.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>negbinom.em(dat, theta0, maxiter = 50000, toler = 0.01,
	se = TRUE, stratified = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="negbinom.em_+3A_dat">dat</code></td>
<td>
<p>an object of <a href="base.html#topic+class">class</a> &quot;<a href="#topic+mederrData">mederrData</a>&quot;.</p>
</td></tr>
<tr><td><code id="negbinom.em_+3A_theta0">theta0</code></td>
<td>
<p>initial values for the parameters to be optimized over.</p>
</td></tr>
<tr><td><code id="negbinom.em_+3A_maxiter">maxiter</code></td>
<td>
<p>a positive integer specifying the maximum number of iterations to be performed before the program is terminated.</p>
</td></tr>
<tr><td><code id="negbinom.em_+3A_toler">toler</code></td>
<td>
<p>a positive scalar giving the tolerance at which the scaled gradient is considered close enough to zero to terminate the algorithm.</p>
</td></tr>
<tr><td><code id="negbinom.em_+3A_se">se</code></td>
<td>
<p>logical; if TRUE the standard errors of the estimates are also returned.</p>
</td></tr>
<tr><td><code id="negbinom.em_+3A_stratified">stratified</code></td>
<td>
<p>logical; if TRUE the analysis will be performed by stratifying on the hospitals.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For further details see Myers et al. (2011).
</p>


<h3>Value</h3>

<p><code>negbinom.em</code> returns a list with components:
</p>
<table role = "presentation">
<tr><td><code>theta.hat</code></td>
<td>
<p>The best set of parameters found.</p>
</td></tr>
<tr><td><code>final.err</code></td>
<td>
<p>The last change in the log-likelihood; it has to be smaller than the <code>toler</code> argument.</p>
</td></tr>
<tr><td><code>final.ll</code></td>
<td>
<p>The likelihood value corresponding to <code>theta.hat</code>.</p>
</td></tr>
<tr><td><code>final.score</code></td>
<td>
<p>The log-likelihood score value corresponding to <code>theta.hat</code>.</p>
</td></tr>
<tr><td><code>num.iter</code></td>
<td>
<p>The number of iterations performed to find the proposed solution.</p>
</td></tr>
<tr><td><code>se</code></td>
<td>
<p>Only if argument <code>se</code> is true. A vector of estimates standard errors for the solution found.</p>
</td></tr>
<tr><td><code>N</code></td>
<td>
<p>The vector of observed error profiles counts.</p>
</td></tr>
<tr><td><code>E</code></td>
<td>
<p>The vector of expected error profiles counts.</p>
</td></tr>
<tr><td><code>prior</code></td>
<td>
<p>A character string giving the prior used; for this function is set to &quot;gamma&quot;, i.e. a gamma distribution.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>DuMouchel W. (1999), &quot;Bayesian Data Mining in Large Frequency Tables, with an Application to the FDA Spontaneous Reporting System&quot;. The American Statistician, 53, 177-190.
</p>
<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dnegbinom">dnegbinom</a></code>,
<code><a href="#topic+EBGM">EBGM</a></code>,
<code><a href="#topic+mixnegbinom.em">mixnegbinom.em</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("simdata", package = "mederrRank")
summary(simdata)

## Not run: 
fit &lt;- bhm.mcmc(simdata, nsim = 1000, burnin = 500, scale.factor = 1.1)
resamp &lt;- bhm.resample(fit, simdata, p.resample = .1,
	k = c(3, 6, 10, 30, 60, Inf), eta = c(.5, .8, 1, 1.25, 2))
fit2 &lt;- bhm.constr.resamp(fit, resamp, k = 3, eta = .8)
plot(fit, fit2, simdata)

## End(Not run)

theta0 &lt;- runif(2, 0, 5)
ans &lt;- negbinom.em(simdata, theta0, 50000, 0.01,
	se = TRUE, stratified = TRUE)
ans$theta
ans$se

## Not run: 
summary(fit2, ans, simdata)

## End(Not run)
</code></pre>

<hr>
<h2 id='negbinom.loglik'>
Log-Likelihood Function for the Mixture of Negative Binomial Distributions
</h2><span id='topic+negbinom.loglik'></span>

<h3>Description</h3>

<p>This function computes the log-likelihood function for the mixture of two negative binomial distribution as described in <code><a href="#topic+dmixnegbinom">dmixnegbinom</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>negbinom.loglik(theta, N, E)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="negbinom.loglik_+3A_theta">theta</code></td>
<td>
<p>vector of parameter values.</p>
</td></tr>
<tr><td><code id="negbinom.loglik_+3A_n">N</code></td>
<td>
<p>vector of observed error profiles counts.</p>
</td></tr>
<tr><td><code id="negbinom.loglik_+3A_e">E</code></td>
<td>
<p>vector of expected error profiles counts.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For further details see Myers et al. (2011).
</p>


<h3>Value</h3>

<p><code>negbinom.loglik</code> returns the log-likelihood value for the negative binomial distribution.
</p>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>DuMouchel W. (1999), &quot;Bayesian Data Mining in Large Frequency Tables, with an Application to the FDA Spontaneous Reporting System&quot;. The American Statistician, 53, 177-190.
</p>
<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dnegbinom">dnegbinom</a></code>,
<code><a href="#topic+negbinom.em">negbinom.em</a></code>,
<code><a href="#topic+negbinom.score">negbinom.score</a></code>.
</p>

<hr>
<h2 id='negbinom.score'>
Log-Likelihood Score Function for the Negative Binomial Distribution
</h2><span id='topic+negbinom.score'></span>

<h3>Description</h3>

<p>This function computes the log-likelihood score for the negative binomial distribution as described in <code><a href="#topic+dmixnegbinom">dmixnegbinom</a></code>. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>negbinom.score(theta, N, E)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="negbinom.score_+3A_theta">theta</code></td>
<td>
<p>vector of parameter values.</p>
</td></tr>
<tr><td><code id="negbinom.score_+3A_n">N</code></td>
<td>
<p>vector of observed error profiles counts.</p>
</td></tr>
<tr><td><code id="negbinom.score_+3A_e">E</code></td>
<td>
<p>vector of expected error profiles counts.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For further details see Myers et al. (2011).
</p>


<h3>Value</h3>

<p><code>negbinom.score</code> returns the vector of log-likelihood score values for the negative binomial distribution.
</p>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>DuMouchel W. (1999), &quot;Bayesian Data Mining in Large Frequency Tables, with an Application to the FDA Spontaneous Reporting System&quot;. The American Statistician, 53, 177-190.
</p>
<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dnegbinom">dnegbinom</a></code>,
<code><a href="#topic+negbinom.em">negbinom.em</a></code>,
<code><a href="#topic+negbinom.loglik">negbinom.loglik</a></code>.
</p>

<hr>
<h2 id='p.value'>
Posterior Predictive Test statistics
</h2><span id='topic+p.value'></span>

<h3>Description</h3>

<p>This function computes posterior predictive test statistics as described in Myers et al. (2011).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>p.value(reps)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="p.value_+3A_reps">reps</code></td>
<td>
<p>list of replications created with the <code><a href="#topic+post.rep">post.rep</a></code> function.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For further details see Myers et al. (2011).
</p>


<h3>Value</h3>

<p><code>p-value</code> creates a list of p-values.
</p>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bhm.constr.resamp">bhm.constr.resamp</a></code>,
<code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code>,
<code><a href="#topic+bhm.resample">bhm.resample</a></code>,
<code><a href="#topic+post.rep">post.rep</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data("simdata", package = "mederrRank")
summary(simdata)

fit &lt;- bhm.mcmc(simdata, nsim = 1000, burnin = 500, scale.factor = 1.1)
resamp &lt;- bhm.resample(fit, simdata, p.resample = .1,
	k = c(3, 6, 10, 30, 60, Inf), eta = c(.5, .8, 1, 1.25, 2))
fit2 &lt;- bhm.constr.resamp(fit, resamp, k = 3, eta = .8)
reps &lt;- post.rep(fit2, simdata)
pvalues &lt;- p.value(reps)

## End(Not run)
</code></pre>

<hr>
<h2 id='plot-methods'>Plot of Medication Error Data and Analysis</h2><span id='topic+plot-methods'></span><span id='topic+plot+2CANY+2CANY-method'></span><span id='topic+plot+2CmederrData+2Cmissing-method'></span><span id='topic+plot+2CmederrFit+2CmederrFit-method'></span><span id='topic+plot+2CmederrResample+2Cmissing-method'></span>

<h3>Description</h3>

<p>Methods for function <code>plot</code> in Package &lsquo;graphics&rsquo; to be used with &quot;<a href="#topic+mederrData">mederrData</a>&quot;, <a href="#topic+mederrFit">mederrFit</a> and &quot;<a href="#topic+mederrResample">mederrResample</a>&quot; objects.
</p>


<h3>Methods</h3>


<dl>
<dt><code>signature(x = "mederrData", y = "missing")</code></dt><dd>
<p>Pictorial representation for a &quot;<a href="#topic+mederrData">mederrData</a>&quot; object.
</p>
</dd>
<dt><code>signature(x = "mederrFit", y = "mederrFit")</code></dt><dd>
<p>Graphical representation of Markov Chain Monte Carlo simulations for a &quot;<a href="#topic+mederrFit">mederrFit</a>&quot; object.
</p>
</dd>
<dt><code>signature(x = "mederrResample", y = "missing")</code></dt><dd>
<p>Graphical representation of the resampling transformation for a &quot;<a href="#topic+mederrResample">mederrResample</a>&quot; object.
</p>
</dd>
</dl>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code>, 
<code><a href="#topic+bhm.resample">bhm.resample</a></code>.
</p>

<hr>
<h2 id='post.rep'>
Posterior Predictive Data Replications
</h2><span id='topic+post.rep'></span>

<h3>Description</h3>

<p>This function creates a list of replicated data for posterior predictive checking as described in Myers et al. (2011).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>post.rep(model, dat)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="post.rep_+3A_model">model</code></td>
<td>
<p>an object of <a href="base.html#topic+class">class</a> &quot;<a href="#topic+mederrFit">mederrFit</a>&quot;.</p>
</td></tr>
<tr><td><code id="post.rep_+3A_dat">dat</code></td>
<td>
<p>an object of <a href="base.html#topic+class">class</a> &quot;<a href="#topic+mederrData">mederrData</a>&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For further details see Myers et al. (2011).
</p>


<h3>Value</h3>

<p><code>post.rep</code> returns a list of replicated data.  
</p>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bhm.constr.resamp">bhm.constr.resamp</a></code>,
<code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code>,
<code><a href="#topic+bhm.resample">bhm.resample</a></code>,
<code><a href="#topic+p.value">p.value</a></code>.
</p>

<hr>
<h2 id='rmixnegbinom'>
The Negative Binomial Mixture Distribution
</h2><span id='topic+rmixnegbinom'></span>

<h3>Description</h3>

<p>Random generation for a mixture of two negative binomial distributions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmixnegbinom(n, theta, E)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rmixnegbinom_+3A_n">n</code></td>
<td>
<p>number of observations.</p>
</td></tr>
<tr><td><code id="rmixnegbinom_+3A_theta">theta</code></td>
<td>
<p>vector of parameters for the negative binomial distribution mixture.</p>
</td></tr>
<tr><td><code id="rmixnegbinom_+3A_e">E</code></td>
<td>
<p>vector of (non-negative integer) expected counts.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>rmixnegbinom</code> generates random deviates corresponding to the <code>E</code> and <code>theta</code> values provided.
</p>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dmixnegbinom">dmixnegbinom</a></code>,
<code><a href="stats.html#topic+rnbinom">rnbinom</a></code>.
</p>

<hr>
<h2 id='simdata'>
Simulated Data
</h2><span id='topic+simdata'></span>

<h3>Description</h3>

<p>Simulated data to use for illustrative purposes in the <code><a href="#topic+mederrRank">mederrRank</a></code> package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(simdata)</code></pre>


<h3>Format</h3>

<p>An object of class <code><a href="#topic+mederrData">mederrData</a></code>.
</p>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code>,
<code><a href="#topic+mederrData">mederrData</a></code>,
<code><a href="#topic+mederrFit">mederrFit</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("simdata", package = "mederrRank")
summary(simdata)
plot(simdata)
</code></pre>

<hr>
<h2 id='summary-methods'>Summary of Medication Error Data and Analysis</h2><span id='topic+summary-methods'></span><span id='topic+summary+2CANY-method'></span><span id='topic+summary+2CmederrData-method'></span><span id='topic+summary+2CmederrFit-method'></span>

<h3>Description</h3>

<p>Methods for function <code>summary</code> in Package &lsquo;base&rsquo; to be used with &quot;<a href="#topic+mederrData">mederrData</a>&quot; and &quot;<a href="#topic+mederrFit">mederrFit</a>&quot; objects.
</p>


<h3>Methods</h3>


<dl>
<dt><code>signature(object = "mederrData")</code></dt><dd>
<p>Extracts summary information about the slots of a &quot;<a href="#topic+mederrData">mederrData</a>&quot; object.
</p>
</dd>
<dt><code>signature(object = "mederrFit")</code></dt><dd>
<p>Extracts summary information about the slots of a &quot;<a href="#topic+mederrFit">mederrFit</a>&quot; object.
</p>
</dd>
</dl>


<h3>Author(s)</h3>

<p>Sergio Venturini <a href="mailto:sergio.venturini@unicatt.it">sergio.venturini@unicatt.it</a>, 
</p>
<p>Jessica A. Myers <a href="mailto:jmyers6@partners.org">jmyers6@partners.org</a>
</p>


<h3>References</h3>

<p>Myers, J. A., Venturini, S., Dominici, F. and Morlock, L. (2011), &quot;Random Effects Models for Identifying the Most Harmful Medication Errors in a Large, Voluntary Reporting Database&quot;. Technical Report.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bayes.rank">bayes.rank</a></code>,
<code><a href="#topic+bhm.mcmc">bhm.mcmc</a></code>.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
