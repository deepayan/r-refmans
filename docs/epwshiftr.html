<!DOCTYPE html><html lang="en"><head><title>Help for package epwshiftr</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {epwshiftr}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#epwshiftr-package'><p>epwshiftr: Create future EnergyPlus Weather files using CMIP6 data</p></a></li>
<li><a href='#Cmip6Dict'><p>CMIP6 Controlled Vocabularies (CVs) and Data Request Dictionary</p></a></li>
<li><a href='#esgf_query'><p>Query CMIP6 data using ESGF search RESTful API</p></a></li>
<li><a href='#EsgfQuery'><p>Query CMIP6 data using ESGF search RESTful API</p></a></li>
<li><a href='#extract_data'><p>Extract data</p></a></li>
<li><a href='#future_epw'><p>Create future EPW files using morphed data</p></a></li>
<li><a href='#get_data_dir'><p>Get the path of directory where epwshiftr data is stored</p></a></li>
<li><a href='#get_data_node'><p>Get data nodes which store CMIP6 output</p></a></li>
<li><a href='#init_cmip6_index'><p>Build CMIP6 experiment output file index</p></a></li>
<li><a href='#load_cmip6_index'><p>Load previously stored CMIP6 experiment output file index</p></a></li>
<li><a href='#match_coord'><p>Match coordinates of input EPW in the CMIP6 output file database</p></a></li>
<li><a href='#morphing_epw'><p>Morphing EPW weather variables</p></a></li>
<li><a href='#set_cmip6_index'><p>Set CMIP6 index</p></a></li>
<li><a href='#summary_database'><p>Summary CMIP6 model output file status</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Create Future 'EnergyPlus' Weather Files using 'CMIP6' Data</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.4</td>
</tr>
<tr>
<td>Description:</td>
<td>
    Query, download climate change projection data from the 'CMIP6' (Coupled
    Model Intercomparison Project Phase 6) project
    <a href="https://pcmdi.llnl.gov/CMIP6/">https://pcmdi.llnl.gov/CMIP6/</a> in the 'ESGF' (Earth System Grid Federation)
    platform <a href="https://esgf.llnl.gov">https://esgf.llnl.gov</a>, and create future 'EnergyPlus'
    <a href="https://energyplus.net">https://energyplus.net</a> Weather ('EPW') files adjusted from climate changes
    using data from Global Climate Models ('GCM').</td>
</tr>
<tr>
<td>Imports:</td>
<td>checkmate (&ge; 2.0.0), cli (&ge; 3.4.0), data.table (&ge; 1.12.4),
eplusr (&ge; 0.15.2), fst, future.apply, jsonlite, PCICt,
progressr, psychrolib, R6, rappdirs, RNetCDF, units</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 3.0.0), curl, mockery, withr, pingr, knitr,
rmarkdown</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/ideas-lab-nus/epwshiftr">https://github.com/ideas-lab-nus/epwshiftr</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/ideas-lab-nus/epwshiftr/issues">https://github.com/ideas-lab-nus/epwshiftr/issues</a></td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>Collate:</td>
<td>'coord.R' 'dict.R' 'utils.R' 'epwshiftr-package.R' 'esgf.R'
'gh.R' 'morph.R' 'netcdf.R' 'query.R'</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/testthat/start-first:</td>
<td>utils, esgf, coord, netcdf, morph</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-03-11 00:31:39 UTC; hongyuanjia</td>
</tr>
<tr>
<td>Author:</td>
<td>Hongyuan Jia <a href="https://orcid.org/0000-0002-0075-8183"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Adrian Chong <a href="https://orcid.org/0000-0002-9486-4728"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Hongyuan Jia &lt;hongyuanjia@outlook.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-03-12 12:40:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='epwshiftr-package'>epwshiftr: Create future EnergyPlus Weather files using CMIP6 data</h2><span id='topic+epwshiftr'></span><span id='topic+epwshiftr-package'></span>

<h3>Description</h3>

<p>Query, download climate change projection data from the <a href="https://pcmdi.llnl.gov/CMIP6/">CMIP6 (Coupled Model Intercomparison Project Phase 6) project</a> in
the <a href="https://esgf.llnl.gov">ESGF (Earth System Grid Federation) platform</a>,
and create future <a href="https://energyplus.net">EnergyPlus</a> Weather (EPW) files
adjusted from climate changes using data from Global Climate Models (GCM).
</p>


<h3>Package options</h3>


<ul>
<li> <p><code>epwshiftr.verbose</code>: If <code>TRUE</code>, more detailed message will be printed.
Default: <code>FALSE</code>.
</p>
</li>
<li> <p><code>epwshiftr.threshold_alpha</code>: the threshold of the absolute value for alpha,
i.e. monthly-mean fractional change, when performing morphing operations.
The default value is set to <code>3</code>. If the morphing methods are set
<code>"stretch"</code> or <code>"combined"</code>, and the absolute alpha exceeds the threshold
value, warnings are issued and the morphing method fallbacks to
<code>"shift"</code> to avoid unrealistic morphed values.
</p>
</li>
<li> <p><code>epwshiftr.dir</code>: The directory to store package data, including CMIP6
model output file index and etc. If not set, the current user data
directory will be used.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Hongyuan Jia
</p>


<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/ideas-lab-nus/epwshiftr">https://github.com/ideas-lab-nus/epwshiftr</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/ideas-lab-nus/epwshiftr/issues">https://github.com/ideas-lab-nus/epwshiftr/issues</a>
</p>
</li></ul>


<hr>
<h2 id='Cmip6Dict'>CMIP6 Controlled Vocabularies (CVs) and Data Request Dictionary</h2><span id='topic+Cmip6Dict'></span><span id='topic+cmip6_dict'></span>

<h3>Description</h3>

<p>The <code>Cmip6Dict</code> object provides functionalities to fetch the latest CMIP6
Controlled Vocabularies (CVs) and Data Request (DReq) information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cmip6_dict()
</code></pre>


<h3>Details</h3>

<p>The CMIP6 CVs gives a well-defined set of global attributes that are recorded
in each CMIP6 model output, providing information necessary for interpreting
the data. The data of CMIP6 CVs is stored as JSON files in the WCRP-CMIP
<a href="https://github.com/WCRP-CMIP/CMIP6_CVs">GitHub Repo</a>.
</p>
<p>The CMIP6 DReq defines all the quantities from CMIP6 simulations that should
be archived. This includes both quantities of general interest needed from
most of the CMIP6-endorsed model intercomparison projects (MIPs) and
quantities that are more specialized and only of interest to a single
endorsed MIP. The raw data of DReq is stored a Microsoft Excel file
(<code>CMIP6_MIP_tables.xlsx</code>) in a Subversion repo.
The <code>Cmip6Dict</code> object uses the parsed DReq data that is stored in the
<a href="https://github.com/PCMDI/cmip6-cmor-tables">GitHub Repo</a>.
</p>
<p>For more information, please see:
</p>

<ul>
<li> <p><a href="https://docs.google.com/document/d/1h0r8RZr_f3-8egBMMh7aqLwy3snpD6_MrDz1q8n5XUk/edit">CMIP6 Global Attributes, DRS, Filenames, Directory Structure, and CV's</a>
</p>
</li>
<li> <p><a href="https://wcrp-cmip.github.io/WGCM_Infrastructure_Panel/CMIP6/data_request.html">CMIP6 Data Request</a>
</p>
</li></ul>



<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-Cmip6Dict-version"><code>Cmip6Dict$version()</code></a>
</p>
</li>
<li> <p><a href="#method-Cmip6Dict-is_empty"><code>Cmip6Dict$is_empty()</code></a>
</p>
</li>
<li> <p><a href="#method-Cmip6Dict-timestamp"><code>Cmip6Dict$timestamp()</code></a>
</p>
</li>
<li> <p><a href="#method-Cmip6Dict-built_time"><code>Cmip6Dict$built_time()</code></a>
</p>
</li>
<li> <p><a href="#method-Cmip6Dict-build"><code>Cmip6Dict$build()</code></a>
</p>
</li>
<li> <p><a href="#method-Cmip6Dict-get"><code>Cmip6Dict$get()</code></a>
</p>
</li>
<li> <p><a href="#method-Cmip6Dict-save"><code>Cmip6Dict$save()</code></a>
</p>
</li>
<li> <p><a href="#method-Cmip6Dict-load"><code>Cmip6Dict$load()</code></a>
</p>
</li>
<li> <p><a href="#method-Cmip6Dict-print"><code>Cmip6Dict$print()</code></a>
</p>
</li></ul>


<hr>
<a id="method-Cmip6Dict-version"></a>



<h4>Method <code>version()</code></h4>

<p>Get the version of CVs and Data Request
</p>


<h5>Usage</h5>

<div class="r"><pre>Cmip6Dict$version()</pre></div>



<h5>Returns</h5>

<p>A list of two element:
</p>

<ul>
<li> <p><code>cvs</code>: A <a href="base.html#topic+numeric_version">numeric_version</a> object giving the version of CVs
</p>
</li>
<li> <p><code>dreq</code>: A <a href="base.html#topic+numeric_version">numeric_version</a> object giving the version of Data
Request
</p>
</li></ul>



<hr>
<a id="method-Cmip6Dict-is_empty"></a>



<h4>Method <code>is_empty()</code></h4>

<p>Is it an empty Cmip6Dict?
</p>
<p><code style="white-space: pre;">&#8288;$is_empty()&#8288;</code> checks if this <code>Cmip6Dict</code> is empty, i.e. the <code style="white-space: pre;">&#8288;$build() &#8288;</code> or <code style="white-space: pre;">&#8288;$load()&#8288;</code> method hasn't been called yet and there is no data of
CVs and Data Request.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cmip6Dict$is_empty()</pre></div>



<h5>Returns</h5>

<p>A single logical value of <code>TRUE</code> or <code>FALSE</code>.
</p>


<hr>
<a id="method-Cmip6Dict-timestamp"></a>



<h4>Method <code>timestamp()</code></h4>

<p>Get the last modified time for CVs
</p>


<h5>Usage</h5>

<div class="r"><pre>Cmip6Dict$timestamp()</pre></div>



<h5>Returns</h5>

<p>A list of 14 <a href="base.html#topic+POSIXct">DateTime</a>s:
</p>

<ul>
<li> <p><code>"cvs"</code>: The last modified time for the whole CV collection
</p>
</li>
<li> <p><code>"drs"</code>: The last modified time for Data Reference Syntax (DRS)
</p>
</li>
<li> <p><code>"activity_id"</code>: The last modified time for Activity ID
</p>
</li>
<li> <p><code>"experiment_id"</code>: The last modified time for Experiment ID
</p>
</li>
<li> <p><code>"frequency"</code>: The last modified time for Frequency
</p>
</li>
<li> <p><code>"grid_label"</code>: The last modified time for Grid Label
</p>
</li>
<li> <p><code>"institution_id"</code>: The last modified time for Institution ID
</p>
</li>
<li> <p><code>"nominal_resolution"</code>: The last modified time for Nominal Resolution
</p>
</li>
<li> <p><code>"realm"</code>: The last modified time for Realm
</p>
</li>
<li> <p><code>"required_global_attributes"</code>: The last modified time for Required Global Attributes
</p>
</li>
<li> <p><code>"source_id"</code>: The last modified time for Source ID
</p>
</li>
<li> <p><code>"source_type"</code>: The last modified time for Source Type
</p>
</li>
<li> <p><code>"sub_experiment_id"</code>: The last modified time for Sub-Experiment ID
</p>
</li>
<li> <p><code>"table_id"</code>: The last modified time for Table ID
</p>
</li></ul>



<hr>
<a id="method-Cmip6Dict-built_time"></a>



<h4>Method <code>built_time()</code></h4>

<p>Get the time when the dictionary was built
</p>


<h5>Usage</h5>

<div class="r"><pre>Cmip6Dict$built_time()</pre></div>



<h5>Returns</h5>

<p>A <a href="base.html#topic+POSIXct">DateTime</a>
</p>


<hr>
<a id="method-Cmip6Dict-build"></a>



<h4>Method <code>build()</code></h4>

<p>Fetch and parse all data of CVs and Data Request
</p>


<h5>Usage</h5>

<div class="r"><pre>Cmip6Dict$build(token = NULL, force = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>token</code></dt><dd><p>A string of GitHub token that is used to access GitHub
REST APIs. If <code>NULL</code>, <code>GITHUB_PAT</code> or <code>GITHUB_TOKEN</code>
environment variable will be used if exists. Default: <code>NULL</code>.</p>
</dd>
<dt><code>force</code></dt><dd><p>Whether to force to rebuild the dict when it has been
already built before. Default: <code>FALSE</code>.</p>
</dd>
</dl>

</div>



<h5>Returns</h5>

<p>The updated <code>Cmip6Dict</code> itself.
</p>


<hr>
<a id="method-Cmip6Dict-get"></a>



<h4>Method <code>get()</code></h4>

<p>Get the data for a specific CV or Data Request
</p>


<h5>Usage</h5>

<div class="r"><pre>Cmip6Dict$get(type)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>type</code></dt><dd><p>A single string indicating the type of data to list.
Should be one of:
</p>

<ul>
<li> <p><code>"drs"</code>: Data Reference Syntax (DRS)
</p>
</li>
<li> <p><code>"activity_id"</code>: Activity ID
</p>
</li>
<li> <p><code>"experiment_id"</code>: Experiment ID
</p>
</li>
<li> <p><code>"frequency"</code>: Frequency
</p>
</li>
<li> <p><code>"grid_label"</code>: Grid Label
</p>
</li>
<li> <p><code>"institution_id"</code>: Institution ID
</p>
</li>
<li> <p><code>"nominal_resolution"</code>: Nominal Resolution
</p>
</li>
<li> <p><code>"realm"</code>: Realm
</p>
</li>
<li> <p><code>"required_global_attributes"</code>: Required Global Attributes
</p>
</li>
<li> <p><code>"source_id"</code>: Source ID
</p>
</li>
<li> <p><code>"source_type"</code>: Source Type
</p>
</li>
<li> <p><code>"sub_experiment_id"</code>: Sub-Experiment ID
</p>
</li>
<li> <p><code>"table_id"</code>: Table ID
</p>
</li>
<li> <p><code>"dreq"</code>: Data Request
</p>
</li></ul>
</dd>
</dl>

</div>



<h5>Returns</h5>

<p>For <code>"drs"</code>, &quot;activity_id&quot;<code style="white-space: pre;">&#8288;, &#8288;</code>&quot;frequency&quot;<code style="white-space: pre;">&#8288;, &#8288;</code>&quot;grid_label&quot;<code style="white-space: pre;">&#8288;, &#8288;</code>&quot;institution_id&quot;<code style="white-space: pre;">&#8288;, &#8288;</code>&quot;source_type&quot;<code>and</code>&quot;sub_experiment_id&quot;', a
<a href="base.html#topic+list">list</a>.
</p>
<p>For <code>"experiment_id"</code>, <code>"source_id"</code> and <code>"dreq"</code>, a <a href="data.table.html#topic+data.table">data.table</a>.
</p>
<p>For <code>"nominal_resolution"</code>, <code>"required_global_attributes"</code> and
<code>"table_id"</code>, a <a href="base.html#topic+character">character</a> vector.
</p>


<hr>
<a id="method-Cmip6Dict-save"></a>



<h4>Method <code>save()</code></h4>

<p>Save the Cmip6Dict object
</p>
<p><code style="white-space: pre;">&#8288;$save()&#8288;</code> stores all the core data of current <code>Cmip6Dict</code> object into
an <a href="base.html#topic+saveRDS">RDS</a> file named <code>CMIP6DICT</code> in the specified folder.
This file can be reloaded via <code style="white-space: pre;">&#8288;$load()&#8288;</code> method to restore the last
state of current <code>Cmip6Dict</code> object.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cmip6Dict$save(dir = getOption("epwshiftr.dir", "."))</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>dir</code></dt><dd><p>A single string giving the directory to save the RDS file.
Default is set to the global option <code>epwshiftr.dir</code>. The
directory will be created if not exists. If this global option
is not set, the current working directory is used.</p>
</dd>
</dl>

</div>



<h5>Returns</h5>

<p>A single string giving the full path of the RDS file.
</p>


<hr>
<a id="method-Cmip6Dict-load"></a>



<h4>Method <code>load()</code></h4>

<p>Load the saved Cmip6Dict object from file
</p>
<p><code style="white-space: pre;">&#8288;$load()&#8288;</code> loads the RDS file named <code>CMIP6DICT</code> that is created using
<code style="white-space: pre;">&#8288;$save()&#8288;</code> method.
</p>
<p>Please note that the file should be exactly the same as <code>CMIP6DICT</code>
without file extension.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cmip6Dict$load(dir = getOption("epwshiftr.dir", "."))</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>dir</code></dt><dd><p>A single string giving the directory to find the RDS file.
Default is set to the global option <code>epwshiftr.dir</code>. If this
global option is not set, the current working directory is
used.</p>
</dd>
</dl>

</div>



<h5>Returns</h5>

<p>A single string giving the full path of the RDS file.
</p>


<hr>
<a id="method-Cmip6Dict-print"></a>



<h4>Method <code>print()</code></h4>

<p>Print a summary of the current <code>Cmip6Dict</code> object
</p>
<p><code style="white-space: pre;">&#8288;$print()&#8288;</code> gives the summary of current <code>Cmip6Dict</code> object including
the version of CVs and Data Request, and the last built time.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cmip6Dict$print()</pre></div>



<h5>Returns</h5>

<p>The <code>Cmip6Dict</code> object itself, invisibly.
</p>




<h3>Author(s)</h3>

<p>Hongyuan Jia
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

# create a new Cmip6Dict object
dict &lt;- cmip6_dict()

# by default, there is no data when the Cmip6Dict was created
dict$is_empty()

# fetch and parse all CVs and Data Request data
dict$build()

# get the version of CVs nand Data Request
dict$version()

# get the last modified time for each CV and Data Request
dict$timestamp()

# get the time when the dict was built
dict$built_time()

# get the data of CVs and DReq
dict$get("activity_id")
dict$get("experiment_id")
dict$get("sub_experiment_id")
dict$get("institution_id")
dict$get("source_id")
dict$get("table_id")
dict$get("frequency")
dict$get("grid_label")
dict$get("realm")
dict$get("source_type")
dict$get("dreq")

# save the dict object for later usage
# default location is the value of global option "epwshiftr.dir"
dict$save()

# the saved dict object can be reloaded
new_dict &lt;- cmip6_dict()
new_dict$load()

# print will show the version summary and the last built time
dict$print()

## End(Not run)
</code></pre>

<hr>
<h2 id='esgf_query'>Query CMIP6 data using ESGF search RESTful API</h2><span id='topic+esgf_query'></span>

<h3>Description</h3>

<p>Query CMIP6 data using ESGF search RESTful API
</p>


<h3>Usage</h3>

<pre><code class='language-R'>esgf_query(
  activity = "ScenarioMIP",
  variable = c("tas", "tasmax", "tasmin", "hurs", "hursmax", "hursmin", "pr", "rsds",
    "rlds", "psl", "sfcWind", "clt"),
  frequency = "day",
  experiment = c("ssp126", "ssp245", "ssp370", "ssp585"),
  source = c("AWI-CM-1-1-MR", "BCC-CSM2-MR", "CESM2", "CESM2-WACCM", "EC-Earth3",
    "EC-Earth3-Veg", "GFDL-ESM4", "INM-CM4-8", "INM-CM5-0", "MPI-ESM1-2-HR",
    "MRI-ESM2-0"),
  variant = "r1i1p1f1",
  replica = FALSE,
  latest = TRUE,
  resolution = c("100 km", "50 km"),
  type = "Dataset",
  limit = 10000L,
  data_node = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="esgf_query_+3A_activity">activity</code></td>
<td>
<p>A character vector indicating activity identifiers. Default:
<code>"ScenarioMIP"</code>. Possible values:
</p>

<ul>
<li> <p><code>"AerChemMIP"</code>: Aerosols and Chemistry Model Intercomparison Project,
</p>
</li>
<li> <p><code>"C4MIP"</code>: Coupled Climate Carbon Cycle Model Intercomparison Project,
</p>
</li>
<li> <p><code>"CDRMIP"</code>: Carbon Dioxide Removal Model Intercomparison Project,
</p>
</li>
<li> <p><code>"CFMIP"</code>: Cloud Feedback Model Intercomparison Project,
</p>
</li>
<li> <p><code>"CMIP"</code>: CMIP DECK: 1pctCO2, abrupt4xCO2, amip, esm-piControl, esm-historical, historical, and piControl experiments,
</p>
</li>
<li> <p><code>"CORDEX"</code>: Coordinated Regional Climate Downscaling Experiment,
</p>
</li>
<li> <p><code>"DAMIP"</code>: Detection and Attribution Model Intercomparison Project,
</p>
</li>
<li> <p><code>"DCPP"</code>: Decadal Climate Prediction Project,
</p>
</li>
<li> <p><code>"DynVarMIP"</code>: Dynamics and Variability Model Intercomparison Project,
</p>
</li>
<li> <p><code>"FAFMIP"</code>: Flux-Anomaly-Forced Model Intercomparison Project,
</p>
</li>
<li> <p><code>"GMMIP"</code>: Global Monsoons Model Intercomparison Project,
</p>
</li>
<li> <p><code>"GeoMIP"</code>: Geoengineering Model Intercomparison Project,
</p>
</li>
<li> <p><code>"HighResMIP"</code>: High-Resolution Model Intercomparison Project,
</p>
</li>
<li> <p><code>"ISMIP6"</code>: Ice Sheet Model Intercomparison Project for CMIP6,
</p>
</li>
<li> <p><code>"LS3MIP"</code>: Land Surface, Snow and Soil Moisture,
</p>
</li>
<li> <p><code>"LUMIP"</code>: Land-Use Model Intercomparison Project,
</p>
</li>
<li> <p><code>"OMIP"</code>: Ocean Model Intercomparison Project,
</p>
</li>
<li> <p><code>"PAMIP"</code>: Polar Amplification Model Intercomparison Project,
</p>
</li>
<li> <p><code>"PMIP"</code>: Palaeoclimate Modelling Intercomparison Project,
</p>
</li>
<li> <p><code>"RFMIP"</code>: Radiative Forcing Model Intercomparison Project,
</p>
</li>
<li> <p><code>"SIMIP"</code>: Sea Ice Model Intercomparison Project,
</p>
</li>
<li> <p><code>"ScenarioMIP"</code>: Scenario Model Intercomparison Project,
</p>
</li>
<li> <p><code>"VIACSAB"</code>: Vulnerability, Impacts, Adaptation and Climate Services Advisory Board,
</p>
</li>
<li> <p><code>"VolMIP"</code>: Volcanic Forcings Model Intercomparison Project
</p>
</li></ul>
</td></tr>
<tr><td><code id="esgf_query_+3A_variable">variable</code></td>
<td>
<p>A character vector indicating variable identifiers. The 12
most related variables for EPW are set as defaults. If <code>NULL</code>, all
possible variables are returned. Default: <code>c("tas", "tasmax", "tasmin", "hurs", "hursmax", "hursmin", "psl", "rss", "rls", "sfcWind", "pr", "clt")</code>, where:
</p>

<ul>
<li> <p><code>tas</code>: Near-surface (usually, 2 meter) air temperature, units: <code>K</code>.
</p>
</li>
<li> <p><code>tasmax</code>: Maximum near-surface (usually, 2 meter) air temperature, units: <code>K</code>.
</p>
</li>
<li> <p><code>tasmin</code>: Minimum near-surface (usually, 2 meter) air temperature, units: <code>K</code>.
</p>
</li>
<li> <p><code>hurs</code>: Near-surface relative humidity, units: <code style="white-space: pre;">&#8288;%&#8288;</code>.
</p>
</li>
<li> <p><code>hursmax</code>: Maximum near-surface relative humidity, units: <code style="white-space: pre;">&#8288;%&#8288;</code>.
</p>
</li>
<li> <p><code>hursmin</code>: Minimum near-surface relative humidity, units: <code style="white-space: pre;">&#8288;%&#8288;</code>.
</p>
</li>
<li> <p><code>psl</code>: Sea level pressure, units: <code>Pa</code>.
</p>
</li>
<li> <p><code>rsds</code>: Surface downwelling shortwave radiation, units: <code style="white-space: pre;">&#8288;W m-2&#8288;</code>.
</p>
</li>
<li> <p><code>rlds</code>: Surface downwelling longwave radiation, units: <code style="white-space: pre;">&#8288;W m-2&#8288;</code>.
</p>
</li>
<li> <p><code>sfcWind</code>: Near-surface (usually, 10 meters) wind speed, units: <code style="white-space: pre;">&#8288;m s-1&#8288;</code>.
</p>
</li>
<li> <p><code>pr</code>: Precipitation, units: <code style="white-space: pre;">&#8288;kg m-2 s-1&#8288;</code>.
</p>
</li>
<li> <p><code>clt</code>: Total cloud area fraction for the whole atmospheric column, as
seen from the surface or the top of the atmosphere. Units: <code style="white-space: pre;">&#8288;%&#8288;</code>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="esgf_query_+3A_frequency">frequency</code></td>
<td>
<p>A character vector of sampling frequency. If <code>NULL</code>, all
possible frequencies are returned. Default: <code>"day"</code>.
Possible values:
</p>

<ul>
<li> <p><code>"1hr"</code>: sampled hourly,
</p>
</li>
<li> <p><code>"1hrCM"</code>: monthly-mean diurnal cycle resolving each day into 1-hour means,
</p>
</li>
<li> <p><code>"1hrPt"</code>: sampled hourly, at specified time point within an hour,
</p>
</li>
<li> <p><code>"3hr"</code>: sampled every 3 hours,
</p>
</li>
<li> <p><code>"3hrPt"</code>: sampled 3 hourly, at specified time point within the time period,
</p>
</li>
<li> <p><code>"6hr"</code>: sampled every 6 hours,
</p>
</li>
<li> <p><code>"6hrPt"</code>: sampled 6 hourly, at specified time point within the time period,
</p>
</li>
<li> <p><code>"day"</code>: daily mean samples,
</p>
</li>
<li> <p><code>"dec"</code>: decadal mean samples,
</p>
</li>
<li> <p><code>"fx"</code>: fixed (time invariant) field,
</p>
</li>
<li> <p><code>"mon"</code>: monthly mean samples,
</p>
</li>
<li> <p><code>"monC"</code>: monthly climatology computed from monthly mean samples,
</p>
</li>
<li> <p><code>"monPt"</code>: sampled monthly, at specified time point within the time period,
</p>
</li>
<li> <p><code>"subhrPt"</code>: sampled sub-hourly, at specified time point within an hour,
</p>
</li>
<li> <p><code>"yr"</code>: annual mean samples,
</p>
</li>
<li> <p><code>"yrPt"</code>: sampled yearly, at specified time point within the time period
</p>
</li></ul>
</td></tr>
<tr><td><code id="esgf_query_+3A_experiment">experiment</code></td>
<td>
<p>A character vector indicating root experiment identifiers.
The <strong>Tier-1</strong> experiment of activity ScenarioMIP are set as defaults.
If <code>NULL</code>, all possible experiment are returned.
Default: <code>c("ssp126", "ssp245", "ssp370", "ssp585")</code>.</p>
</td></tr>
<tr><td><code id="esgf_query_+3A_source">source</code></td>
<td>
<p>A character vector indicating model identifiers. Defaults are
set to 11 sources which give outputs of all 4 experiment of activity
ScenarioMIP with daily frequency, i.e. <code>"AWI-CM-1-1-MR"</code>,
<code>"BCC-CSM2-MR"</code>, <code>"CESM2"</code>, <code>"CESM2-WACCM"</code>, <code>"EC-Earth3"</code>,
<code>"EC-Earth3-Veg"</code>, <code>"GFDL-ESM4"</code>, <code>"INM-CM4-8"</code>, <code>"INM-CM5-0"</code>,
<code>"MPI-ESM1-2-HR"</code> and <code>"MRI-ESM2-0"</code>.
If <code>NULL</code>, all possible sources are returned.</p>
</td></tr>
<tr><td><code id="esgf_query_+3A_variant">variant</code></td>
<td>
<p>A character vector indicating label constructed from 4
indices stored as global attributes in format <code style="white-space: pre;">&#8288;r&lt;k&gt;i&lt;l&gt;p&lt;m&gt;f&lt;n&gt;&#8288;</code>
described below. Default: <code>"r1i1p1f1"</code>.
If <code>NULL</code>, all possible variants are returned.
</p>

<ul>
<li> <p><code>r</code>: realization_index (<code style="white-space: pre;">&#8288;&lt;k&gt;&#8288;</code>) = realization number (integer &gt;0)
</p>
</li>
<li> <p><code>i</code>: initialization_index (<code style="white-space: pre;">&#8288;&lt;l&gt;&#8288;</code>) = index for variant of initialization method (integer &gt;0)
</p>
</li>
<li> <p><code>p</code>: physics_index (<code style="white-space: pre;">&#8288;&lt;m&gt;&#8288;</code>) = index for model physics variant (integer &gt;0)
</p>
</li>
<li> <p><code>f</code>: forcing_index (<code style="white-space: pre;">&#8288;&lt;n&gt;&#8288;</code>) = index for variant of forcing (integer &gt;0)
</p>
</li></ul>
</td></tr>
<tr><td><code id="esgf_query_+3A_replica">replica</code></td>
<td>
<p>Whether the record is the &quot;master&quot; copy, or a replica. Use
<code>FALSE</code> to return only originals and <code>TRUE</code> to return only replicas.
Use <code>NULL</code> to return both the master and the replicas.
Default: <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="esgf_query_+3A_latest">latest</code></td>
<td>
<p>Whether the record is the latest available version, or a
previous version. Use <code>TRUE</code> to return only the latest version of all
records and <code>FALSE</code> to return previous versions. Default: <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="esgf_query_+3A_resolution">resolution</code></td>
<td>
<p>A character vector indicating approximate horizontal
resolution. Default: <code>c("50 km", "100 km")</code>.
If <code>NULL</code>, all possible resolutions are returned.</p>
</td></tr>
<tr><td><code id="esgf_query_+3A_type">type</code></td>
<td>
<p>A single string indicating the intrinsic type of the record.
Should be either <code>"Dataset"</code> or <code>"File"</code>. Default: <code>"Dataset"</code>.</p>
</td></tr>
<tr><td><code id="esgf_query_+3A_limit">limit</code></td>
<td>
<p>An integer indicating the maximum of matched records to return.
Should be &lt;= 10,000. Default: <code>10000</code>.</p>
</td></tr>
<tr><td><code id="esgf_query_+3A_data_node">data_node</code></td>
<td>
<p>A character vector indicating data nodes to be queried.
Default to <code>NULL</code>, which means all possible data nodes.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The Earth System Grid Federation (ESGF) is an international collaboration for
the software that powers most global climate change research, notably
assessments by the Intergovernmental Panel on Climate Change (IPCC).
</p>
<p>The ESGF search service exposes a RESTful URL that can be used by clients to
query the contents of the underlying search index, and return results
matching the given constraints. With the distributed capabilities of the ESGF
search, the URL at any Index Node can be used to query that Node only, or all
Nodes in the ESGF system. <code>esgf_query()</code> uses the
<a href="http://esgf-node.llnl.gov">LLNL (Lawrence Livermore National Laboratory) Index Node</a>.
</p>
<p>The core Controlled Vocabularies (CVs) for use in CMIP6, including all
activities, experiment, sources (GCMs), frequencies can be found at the
<a href="https://github.com/WCRP-CMIP/CMIP6_CVs">WCRP-CMIP/CMIP6_CVs</a> GitHub repo.
</p>


<h3>Value</h3>

<p>A <a href="data.table.html#topic+data.table">data.table::data.table</a> with an attribute named <code>response</code> which
is a list converted from json response. If no matched data is found, an empty
data.table is returned. Otherwise, the columns of returned data varies based
on the <code>type</code>:
</p>

<ul>
<li><p> If <code>"Dataset"</code>, returned columns are:</p>

<table>
<tr>
 <td style="text-align: right;">
   No. </td><td style="text-align: left;"> Column </td><td style="text-align: left;"> Type </td><td style="text-align: left;"> Description </td>
</tr>
<tr>
 <td style="text-align: right;">
   1 </td><td style="text-align: left;"> <code>dataset_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Dataset universal identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   2 </td><td style="text-align: left;"> <code>mip_era</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Activity's associated CMIP cycle. Will always be <code>"CMIP6"</code> </td>
</tr>
<tr>
 <td style="text-align: right;">
   3 </td><td style="text-align: left;"> <code>activity_drs</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Activity DRS (Data Reference Syntax) </td>
</tr>
<tr>
 <td style="text-align: right;">
   4 </td><td style="text-align: left;"> <code>institution_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Institution identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   5 </td><td style="text-align: left;"> <code>source_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Model identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   6 </td><td style="text-align: left;"> <code>experiment_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Root experiment identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   7 </td><td style="text-align: left;"> <code>member_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> A compound construction from <code>sub_experiment_id</code> and <code>variant_label</code> </td>
</tr>
<tr>
 <td style="text-align: right;">
   8 </td><td style="text-align: left;"> <code>table_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Table identifier, i.e. sampling frequency identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   9 </td><td style="text-align: left;"> <code>frequency</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Sampling frequency </td>
</tr>
<tr>
 <td style="text-align: right;">
   10 </td><td style="text-align: left;"> <code>grid_label</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Grid identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   11 </td><td style="text-align: left;"> <code>version</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Approximate date of model output file </td>
</tr>
<tr>
 <td style="text-align: right;">
   12 </td><td style="text-align: left;"> <code>nominal_resolution</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Approximate horizontal resolution </td>
</tr>
<tr>
 <td style="text-align: right;">
   13 </td><td style="text-align: left;"> <code>variable_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Variable identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   14 </td><td style="text-align: left;"> <code>variable_long_name</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Variable long name </td>
</tr>
<tr>
 <td style="text-align: right;">
   15 </td><td style="text-align: left;"> <code>variable_units</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Units of variable </td>
</tr>
<tr>
 <td style="text-align: right;">
   16 </td><td style="text-align: left;"> <code>data_node</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Data node to download the model output file </td>
</tr>
<tr>
 <td style="text-align: right;">
   17 </td><td style="text-align: left;"> <code>dataset_pid</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> A unique string that helps identify the dataset </td>
</tr>
<tr>
 <td style="text-align: right;">
</td>
</tr>

</table>

</li>
<li><p> If <code>"File"</code>, returned columns are:</p>

<table>
<tr>
 <td style="text-align: right;">
   No. </td><td style="text-align: left;"> Column </td><td style="text-align: left;"> Type </td><td style="text-align: left;"> Description </td>
</tr>
<tr>
 <td style="text-align: right;">
   1 </td><td style="text-align: left;"> <code>file_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Model output file universal identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   2 </td><td style="text-align: left;"> <code>dataset_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Dataset universal identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   3 </td><td style="text-align: left;"> <code>mip_era</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Activity's associated CMIP cycle. Will always be <code>"CMIP6"</code> </td>
</tr>
<tr>
 <td style="text-align: right;">
   4 </td><td style="text-align: left;"> <code>activity_drs</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Activity DRS (Data Reference Syntax) </td>
</tr>
<tr>
 <td style="text-align: right;">
   5 </td><td style="text-align: left;"> <code>institution_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Institution identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   6 </td><td style="text-align: left;"> <code>source_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Model identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   7 </td><td style="text-align: left;"> <code>experiment_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Root experiment identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   8 </td><td style="text-align: left;"> <code>member_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> A compound construction from <code>sub_experiment_id</code> and <code>variant_label</code> </td>
</tr>
<tr>
 <td style="text-align: right;">
   9 </td><td style="text-align: left;"> <code>table_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Table identifier, i.e. sampling frequency identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   10 </td><td style="text-align: left;"> <code>frequency</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Sampling frequency </td>
</tr>
<tr>
 <td style="text-align: right;">
   11 </td><td style="text-align: left;"> <code>grid_label</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Grid identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   12 </td><td style="text-align: left;"> <code>version</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Approximate date of model output file </td>
</tr>
<tr>
 <td style="text-align: right;">
   13 </td><td style="text-align: left;"> <code>nominal_resolution</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Approximate horizontal resolution </td>
</tr>
<tr>
 <td style="text-align: right;">
   14 </td><td style="text-align: left;"> <code>variable_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Variable identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   15 </td><td style="text-align: left;"> <code>variable_long_name</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Variable long name </td>
</tr>
<tr>
 <td style="text-align: right;">
   16 </td><td style="text-align: left;"> <code>variable_units</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Units of variable </td>
</tr>
<tr>
 <td style="text-align: right;">
   17 </td><td style="text-align: left;"> <code>datetime_start</code> </td><td style="text-align: left;"> POSIXct </td><td style="text-align: left;"> Start date and time of simulation </td>
</tr>
<tr>
 <td style="text-align: right;">
   18 </td><td style="text-align: left;"> <code>datetime_end</code> </td><td style="text-align: left;"> POSIXct </td><td style="text-align: left;"> End date and time of simulation </td>
</tr>
<tr>
 <td style="text-align: right;">
   19 </td><td style="text-align: left;"> <code>file_size</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Model output file size in Bytes </td>
</tr>
<tr>
 <td style="text-align: right;">
   20 </td><td style="text-align: left;"> <code>data_node</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Data node to download the model output file </td>
</tr>
<tr>
 <td style="text-align: right;">
   21 </td><td style="text-align: left;"> <code>file_url</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Model output file download url from HTTP server </td>
</tr>
<tr>
 <td style="text-align: right;">
   22 </td><td style="text-align: left;"> <code>tracking_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> A unique string that helps identify the output file </td>
</tr>
<tr>
 <td style="text-align: right;">
</td>
</tr>

</table>

</li></ul>



<h3>References</h3>

<p>https://github.com/ESGF/esgf.github.io/wiki/ESGF_Search_REST_API
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
esgf_query(variable = "rss", experiment = "ssp126", resolution = "100 km", limit = 1)

esgf_query(variable = "rss", experiment = "ssp126", type = "File", limit = 1)

## End(Not run)

</code></pre>

<hr>
<h2 id='EsgfQuery'>Query CMIP6 data using ESGF search RESTful API</h2><span id='topic+EsgfQuery'></span><span id='topic+query_esgf'></span>

<h3>Description</h3>

<p>The Earth System Grid Federation (ESGF) is an international collaboration for
the software that powers most global climate change research, notably
assessments by the Intergovernmental Panel on Climate Change (IPCC).
</p>
<p>The ESGF search service exposes RESTful APIs that can be used by clients to
query the contents of the underlying search index, and return results
matching the given constraints. The documentation of the APIs can be found
using this <a href="https://esgf.github.io/esg-search/ESGF_Search_RESTful_API.html">link</a>
</p>
<p><code>EsgfQuery</code> is the workhorse for dealing with ESGF search services.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>query_esgf(host = "https://esgf-node.llnl.gov/esg-search")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="EsgfQuery_+3A_host">host</code></td>
<td>
<p>The URL to the ESGF Search API service. This should be the URL of
the ESGF search service excluding the final endpoint name. Usually
this is <code style="white-space: pre;">&#8288;http://&lt;hostname&gt;/esg-search&#8288;</code>. Default is set to the
<a href="http://esgf-node.llnl.gov">LLNL (Lawrence Livermore National Laboratory) Index Node</a>,
which is <code>"https://esgf-node.llnl.gov/esg-search"</code>.</p>
</td></tr>
</table>


<h3><code>EsgfQuery</code> object</h3>

<p><code>query_esgf()</code> returns an <code>EsgfQuery</code> object, which is an <a href="R6.html#topic+R6Class">R6</a>
object with quite a few methods that can be classified into 3 categories:
</p>

<ul>
<li> <p><strong>Value listing</strong>: methods to list all possible values of facets, shards,
etc.
</p>
</li>
<li> <p><strong>Parameter getter &amp; setter</strong>: methods to get the query parameter values or
set them before sending the actual query to the ESGF search services.
</p>
</li>
<li> <p><strong>Query responses</strong>: methods to collect results for the query response.
</p>
</li></ul>



<h4>Value listing</h4>

<p>When creating an <code>EsgfQuery</code> object, a
<a href="https://esgf.github.io/esg-search/ESGF_Search_RESTful_API.html#facet-listings">facet listing query</a>
is sent to the index node to get all available facets and shards for the
default project (CMIP6).
<code>EsgfQuery</code> object provides three value-listing methods to extract data from
the response of the facet listing query:
</p>

<ul>
<li> <p><a href="#method-EsgfQuery-list_all_facets"><code>EsgfQuery$list_all_facets()</code></a>:
List all available facet names.
</p>
</li>
<li> <p><a href="#method-EsgfQuery-list_all_shards"><code>EsgfQuery$list_all_shards()</code></a>:
List all available shards.
</p>
</li>
<li> <p><a href="#method-EsgfQuery-list_all_values"><code>EsgfQuery$list_all_values()</code></a>:
List all available values of a specific facet.
</p>
</li></ul>




<h4>Parameter getter &amp; setter</h4>

<p>The ESGF search services support a lot of parameters. The <code>EsgfQuery</code>
contains dedicated methods to set values for most of them, including:
</p>

<ul>
<li><p> Most common keywords:
<a href="#method-EsgfQuery-facets"><code>facets</code></a>,
<a href="#method-EsgfQuery-offset"><code>offset</code></a>,
<a href="#method-EsgfQuery-limit"><code>limit</code></a>,
<a href="#method-EsgfQuery-fields"><code>fields</code></a>,
<a href="#method-EsgfQuery-type"><code>type</code></a>,
<a href="#method-EsgfQuery-replica"><code>replica</code></a>,
<a href="#method-EsgfQuery-latest"><code>latest</code></a>,
<a href="#method-EsgfQuery-distrib"><code>distrib</code></a>
and
<a href="#method-EsgfQuery-shards"><code>shards</code></a>.
</p>
</li>
<li><p> Most common facets:
<a href="#method-EsgfQuery-project"><code>project</code></a>,
<a href="#method-EsgfQuery-activity_id"><code>activity_id</code></a>,
<a href="#method-EsgfQuery-experiment_id"><code>experiment_id</code></a>,
<a href="#method-EsgfQuery-source_id"><code>source_id</code></a>,
<a href="#method-EsgfQuery-variable_id"><code>variable_id</code></a>,
<a href="#method-EsgfQuery-frequency"><code>frequency</code></a>,
<a href="#method-EsgfQuery-variant_label"><code>variant_label</code></a>,
<a href="#method-EsgfQuery-nominal_resolution"><code>nominal_resolution</code></a>
and
<a href="#method-EsgfQuery-data_node"><code>data_node</code></a>.
</p>
</li></ul>

<p>All methods act in a similar way:
</p>

<ul>
<li><p> If input is given, the corresponding parameter is set and the updated
<code>EsgfQuery</code> object is returned.
</p>

<ul>
<li><p> This makes it possible to chain different parameter setters, e.g.
<code>EsgfQuery$project("CMIP6")$frequency("day")$limit(1)</code> sets the parameter
<code>project</code>, <code>frequency</code> and <code>limit</code> sequentially.
</p>
</li>
<li><p> For parameters that want character inputs, you can put a preceding <code>!</code> to
negate the constraints, e.g. <code>EsgfQuery$project(!"CMIP6")</code> searches for
all projects except for <code>CMIP6</code>.
</p>
</li></ul>

</li>
<li><p> If no input is given, the current parameter value is returned. For example,
directly calling <code>EsgfQuery$project()</code> returns the current value of the
<code>project</code> parameter. The returned value can be two types:
</p>

<ul>
<li> <p><code>NULL</code>, i.e. there is no constraint on the corresponding parameter
</p>
</li>
<li><p> An <code>EsgfQueryParam</code> object which is essentially a list of three elements:
</p>

<ul>
<li> <p><code>value</code>: The input values
</p>
</li>
<li> <p><code>negate</code>: Whether there is a preceding <code>!</code> in the input
</p>
</li>
<li> <p><code>name</code>: The parameter name
</p>
</li></ul>

</li></ul>

</li></ul>

<p>Despite methods for specific keywords and facets, you can specify arbitrary
query parameters using
<a href="#method-EsgfQuery-params"><code>EsgfQuery$params()</code></a> method. For
details on the usage, please see the
<a href="#method-EsgfQuery-params">documentation</a>.
</p>



<h4>Query responses</h4>

<p>The query is not sent unless related methods are called:
</p>

<ul>
<li> <p><a href="#method-EsgfQuery-count"><code>EsgfQuery$count()</code></a>: Count the total
number of records that match the query.
</p>

<ul>
<li><p> You can return only the total number of matched record by calling
<code>EsgfQuery$count(facets = FALSE)</code>
</p>
</li>
<li><p> You can also count the matched records for specified facets, e.g.
<code>EsgfQuery$count(facets = c("source_id", "activity_id"))</code>
</p>
</li></ul>

</li>
<li> <p><a href="#method-EsgfQuery-collect"><code>EsgfQuery$collect()</code></a>: Collect the
query results and format it into a <a href="data.table.html#topic+data.table">data.table</a>
</p>
</li></ul>




<h4>Other helpers</h4>

<p><code>EsgfQuery</code> object also provide several other helper functions:
</p>

<ul>
<li> <p><a href="#method-EsgfQuery-build_cache"><code>EsgfQuery$build_cache()</code></a>:
By default, <code>EsgfQuery$build_cache()</code> is called when initialize a new
<code>EsgfQuery</code> object. So in general, there is no need to call this
separately. Basically, <code>EsgfQuery$build_cahce()</code> sends a
<a href="https://esgf.github.io/esg-search/ESGF_Search_RESTful_API.html#facet-listings">facet listing query</a>
to the index node and stores the response internally. The response contains
all available facets and shards and is used as a source for validating user
input for parameter setters.
</p>
</li>
<li> <p><a href="#method-EsgfQuery-url"><code>EsgfQuery$url()</code></a>: Returns the actual
query URL or the wget script URL which can be used to download all files
matching the given constraints..
</p>
</li>
<li> <p><a href="#method-EsgfQuery-response"><code>EsgfQuery$response()</code></a>: Returns the
actual response of
<a href="#method-EsgfQuery-count"><code>EsgfQuery$count()</code></a> and
<a href="#method-EsgfQuery-collect"><code>EsgfQuery$collect()</code></a>. It is a named
list generated from the JSON response using <code><a href="jsonlite.html#topic+fromJSON">jsonlite::fromJSON()</a></code>.
</p>
</li>
<li> <p><a href="#method-EsgfQuery-print"><code>EsgfQuery$print()</code></a>: Print a summary
of the current <code>EsgfQuery</code> object including the host URL, the built time of
facet cache and all query parameters.
</p>
</li></ul>




<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-EsgfQuery-new"><code>EsgfQuery$new()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-build_cache"><code>EsgfQuery$build_cache()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-list_all_facets"><code>EsgfQuery$list_all_facets()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-list_all_shards"><code>EsgfQuery$list_all_shards()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-list_all_values"><code>EsgfQuery$list_all_values()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-project"><code>EsgfQuery$project()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-activity_id"><code>EsgfQuery$activity_id()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-experiment_id"><code>EsgfQuery$experiment_id()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-source_id"><code>EsgfQuery$source_id()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-variable_id"><code>EsgfQuery$variable_id()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-frequency"><code>EsgfQuery$frequency()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-variant_label"><code>EsgfQuery$variant_label()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-nominal_resolution"><code>EsgfQuery$nominal_resolution()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-data_node"><code>EsgfQuery$data_node()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-facets"><code>EsgfQuery$facets()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-fields"><code>EsgfQuery$fields()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-shards"><code>EsgfQuery$shards()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-replica"><code>EsgfQuery$replica()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-latest"><code>EsgfQuery$latest()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-type"><code>EsgfQuery$type()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-limit"><code>EsgfQuery$limit()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-offset"><code>EsgfQuery$offset()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-distrib"><code>EsgfQuery$distrib()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-params"><code>EsgfQuery$params()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-url"><code>EsgfQuery$url()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-count"><code>EsgfQuery$count()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-collect"><code>EsgfQuery$collect()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-response"><code>EsgfQuery$response()</code></a>
</p>
</li>
<li> <p><a href="#method-EsgfQuery-print"><code>EsgfQuery$print()</code></a>
</p>
</li></ul>


<hr>
<a id="method-EsgfQuery-new"></a>



<h4>Method <code>new()</code></h4>

<p>Create a new EsgfQuery object
</p>
<p>When initialization, a
<a href="https://esgf.github.io/esg-search/ESGF_Search_RESTful_API.html#facet-listings">facet listing query</a>
is sent to the index node to get all available facets and shards.
This information will be used to validate inputs for <code>activity_id</code>,
<code>scource_id</code> facets and etc.
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$new(host = "https://esgf-node.llnl.gov/esg-search")</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>host</code></dt><dd><p>The URL to the ESGF Search API service. This should be
the URL of the ESGF search service excluding the final
endpoint name. Usually this is <code style="white-space: pre;">&#8288;http://&lt;hostname&gt;/esg-search&#8288;</code>.
Default is to ses the <a href="http://esgf-node.llnl.gov">LLNL (Lawrence Livermore National Laboratory)</a> Index Node, which is
<code>"https://esgf-node.llnl.gov/esg-search"</code>.</p>
</dd>
</dl>

</div>



<h5>Returns</h5>

<p>An <code>EsgfQuery</code> object.
</p>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
q &lt;- EsgfQuery$new(host = "https://esgf-node.llnl.gov/esg-search")
q
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-build_cache"></a>



<h4>Method <code>build_cache()</code></h4>

<p>Build facet cache used for input validation
</p>
<p>A facet cache is data that is fetched using a
<a href="https://esgf.github.io/esg-search/ESGF_Search_RESTful_API.html#facet-listings">facet listing query</a>
to the index node. It contains all available facets and shards that
can be used as parameter values within a specific project.
</p>
<p>By default, <code style="white-space: pre;">&#8288;$build_cache()&#8288;</code> is called when initialize a new
<code>EsgfQuery</code> object for the default project (CMIP6). So in general,
there is no need to call this method, unless that you want to
rebuild the cache again with different projects after calling
<a href="#method-EsgfQuery-project"><code>$project()</code></a>.
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$build_cache()</pre></div>



<h5>Returns</h5>

<p>The modified <code>EsgfQuery</code> object.
</p>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
q$build_cache()
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-list_all_facets"></a>



<h4>Method <code>list_all_facets()</code></h4>

<p>List all available facet names
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$list_all_facets()</pre></div>



<h5>Returns</h5>

<p>A character vector.
</p>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
q$list_all_facets()
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-list_all_shards"></a>



<h4>Method <code>list_all_shards()</code></h4>

<p>List all available shards
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$list_all_shards()</pre></div>



<h5>Returns</h5>

<p>A character vector.
</p>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
q$list_all_shards()
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-list_all_values"></a>



<h4>Method <code>list_all_values()</code></h4>

<p>List all available values of a specific facet
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$list_all_values(facet)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>facet</code></dt><dd><p>A single string giving the facet name.</p>
</dd>
</dl>

</div>



<h5>Returns</h5>

<p>A named character vector.
</p>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
q$list_all_values()
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-project"></a>



<h4>Method <code>project()</code></h4>

<p>Get or set the <code>project</code> facet parameter.
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$project(value = "CMIP6")</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>value</code></dt><dd><p>The  parameter value. Default: <code>"CMIP6"</code>.
There are two options:
</p>

<ul>
<li><p> If <code>value</code> is not given, current value is returned.
</p>
</li>
<li><p> A character vector or <code>NULL</code>.  Note that you can put a preceding <code>!</code> to negate the facet constraints. For example, <code>$project(!c("CMIP5", "CMIP6"))</code> searches for all <code>project</code>s except for <code>CMIP5</code> and <code>CMIP6</code>.
</p>
</li></ul>
</dd>
</dl>

</div>



<h5>Returns</h5>

 <ul>
<li><p> If <code>value</code> is given, the modified <code>EsgfQuery</code> object. </p>
</li>
<li><p> Otherwise, an <code>EsgfQueryParam</code> object which is essentially a list of three elements: </p>
 <ul>
<li> <p><code>value</code>: input values. </p>
</li>
<li> <p><code>negate</code>: Whether there is a preceding <code>!</code>. </p>
</li>
<li> <p><code>name</code>: Parameter name. </p>
</li></ul>
 </li></ul>




<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
# get current value
q$project()

# set the parameter
q$project("CMIP6")

# negate the project constraints
q$project(!"CMIP6")

# remove the parameter
q$project(NULL)
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-activity_id"></a>



<h4>Method <code>activity_id()</code></h4>

<p>Get or set the <code>activity_id</code> facet parameter.
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$activity_id(value)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>value</code></dt><dd><p>The  parameter value. Default: <code>NULL</code>.
There are two options:
</p>

<ul>
<li><p> If <code>value</code> is not given, current value is returned.
</p>
</li>
<li><p> A character vector or <code>NULL</code>.  Note that you can put a preceding <code>!</code> to negate the facet constraints. For example, <code>$activity_id(!c("C4MIP", "GeoMIP"))</code> searches for all <code>activity_id</code>s except for <code>C4MIP</code> and <code>GeoMIP</code>.
</p>
</li></ul>
</dd>
</dl>

</div>



<h5>Returns</h5>

 <ul>
<li><p> If <code>value</code> is given, the modified <code>EsgfQuery</code> object. </p>
</li>
<li><p> Otherwise, an <code>EsgfQueryParam</code> object which is essentially a list of three elements: </p>
 <ul>
<li> <p><code>value</code>: input values. </p>
</li>
<li> <p><code>negate</code>: Whether there is a preceding <code>!</code>. </p>
</li>
<li> <p><code>name</code>: Parameter name. </p>
</li></ul>
 </li></ul>




<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
# get current value
q$activity_id()

# set the parameter
q$activity_id("ScenarioMIP")

# negate the constraints
q$activity_id(!c("CFMIP", "ScenarioMIP"))

# remove the parameter
q$activity_id(NULL)
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-experiment_id"></a>



<h4>Method <code>experiment_id()</code></h4>

<p>Get or set the <code>experiment_id</code> facet parameter.
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$experiment_id(value)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>value</code></dt><dd><p>The  parameter value. Default: <code>NULL</code>.
There are two options:
</p>

<ul>
<li><p> If <code>value</code> is not given, current value is returned.
</p>
</li>
<li><p> A character vector or <code>NULL</code>.  Note that you can put a preceding <code>!</code> to negate the facet constraints. For example, <code>$experiment_id(!c("ssp126", "ssp245"))</code> searches for all <code>experiment_id</code>s except for <code>ssp126</code> and <code>ssp245</code>.
</p>
</li></ul>
</dd>
</dl>

</div>



<h5>Returns</h5>

 <ul>
<li><p> If <code>value</code> is given, the modified <code>EsgfQuery</code> object. </p>
</li>
<li><p> Otherwise, an <code>EsgfQueryParam</code> object which is essentially a list of three elements: </p>
 <ul>
<li> <p><code>value</code>: input values. </p>
</li>
<li> <p><code>negate</code>: Whether there is a preceding <code>!</code>. </p>
</li>
<li> <p><code>name</code>: Parameter name. </p>
</li></ul>
 </li></ul>




<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
# get current value
q$experiment_id()

# set the parameter
q$experiment_id(c("ssp126", "ssp585"))

# negate the constraints
q$experiment_id(!c("ssp126", "ssp585"))

# remove the parameter
q$experiment_id(NULL)
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-source_id"></a>



<h4>Method <code>source_id()</code></h4>

<p>Get or set the <code>source_id</code> facet parameter.
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$source_id(value)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>value</code></dt><dd><p>The  parameter value. Default: <code>NULL</code>.
There are two options:
</p>

<ul>
<li><p> If <code>value</code> is not given, current value is returned.
</p>
</li>
<li><p> A character vector or <code>NULL</code>.  Note that you can put a preceding <code>!</code> to negate the facet constraints. For example, <code>$source_id(!c("CESM2", "CESM2-FV2"))</code> searches for all <code>source_id</code>s except for <code>CESM2</code> and <code>CESM2-FV2</code>.
</p>
</li></ul>
</dd>
</dl>

</div>



<h5>Returns</h5>

 <ul>
<li><p> If <code>value</code> is given, the modified <code>EsgfQuery</code> object. </p>
</li>
<li><p> Otherwise, an <code>EsgfQueryParam</code> object which is essentially a list of three elements: </p>
 <ul>
<li> <p><code>value</code>: input values. </p>
</li>
<li> <p><code>negate</code>: Whether there is a preceding <code>!</code>. </p>
</li>
<li> <p><code>name</code>: Parameter name. </p>
</li></ul>
 </li></ul>




<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
# get current value
q$source_id()

# set the parameter
q$source_id(c("BCC-CSM2-MR", "CESM2"))

# negate the constraints
q$source_id(!c("BCC-CSM2-MR", "CESM2"))

# remove the parameter
q$source_id(NULL)
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-variable_id"></a>



<h4>Method <code>variable_id()</code></h4>

<p>Get or set the <code>variable_id</code> facet parameter.
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$variable_id(value)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>value</code></dt><dd><p>The  parameter value. Default: <code>NULL</code>.
There are two options:
</p>

<ul>
<li><p> If <code>value</code> is not given, current value is returned.
</p>
</li>
<li><p> A character vector or <code>NULL</code>.  Note that you can put a preceding <code>!</code> to negate the facet constraints. For example, <code>$variable_id(!c("tas", "pr"))</code> searches for all <code>variable_id</code>s except for <code>tas</code> and <code>pr</code>.
</p>
</li></ul>
</dd>
</dl>

</div>



<h5>Returns</h5>

 <ul>
<li><p> If <code>value</code> is given, the modified <code>EsgfQuery</code> object. </p>
</li>
<li><p> Otherwise, an <code>EsgfQueryParam</code> object which is essentially a list of three elements: </p>
 <ul>
<li> <p><code>value</code>: input values. </p>
</li>
<li> <p><code>negate</code>: Whether there is a preceding <code>!</code>. </p>
</li>
<li> <p><code>name</code>: Parameter name. </p>
</li></ul>
 </li></ul>




<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
# get current value
q$variable_id()

# set the parameter
q$variable_id(c("tas", "pr"))

# negate the constraints
q$variable_id(!c("tas", "pr"))

# remove the parameter
q$variable_id(NULL)
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-frequency"></a>



<h4>Method <code>frequency()</code></h4>

<p>Get or set the <code>frequency</code> facet parameter.
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$frequency(value)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>value</code></dt><dd><p>The  parameter value. Default: <code>NULL</code>.
There are two options:
</p>

<ul>
<li><p> If <code>value</code> is not given, current value is returned.
</p>
</li>
<li><p> A character vector or <code>NULL</code>.  Note that you can put a preceding <code>!</code> to negate the facet constraints. For example, <code>$frequency(!c("day", "mon"))</code> searches for all <code>frequency</code>s except for <code>day</code> and <code>mon</code>.
</p>
</li></ul>
</dd>
</dl>

</div>



<h5>Returns</h5>

 <ul>
<li><p> If <code>value</code> is given, the modified <code>EsgfQuery</code> object. </p>
</li>
<li><p> Otherwise, an <code>EsgfQueryParam</code> object which is essentially a list of three elements: </p>
 <ul>
<li> <p><code>value</code>: input values. </p>
</li>
<li> <p><code>negate</code>: Whether there is a preceding <code>!</code>. </p>
</li>
<li> <p><code>name</code>: Parameter name. </p>
</li></ul>
 </li></ul>




<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
# get current value
q$frequency()

# set the parameter
q$frequency(c("1hr", "day"))

# negate the constraints
q$frequency(!c("1hr", "day"))

# remove the parameter
q$frequency(NULL)
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-variant_label"></a>



<h4>Method <code>variant_label()</code></h4>

<p>Get or set the <code>variant_label</code> facet parameter.
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$variant_label(value)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>value</code></dt><dd><p>The  parameter value. Default: <code>NULL</code>.
There are two options:
</p>

<ul>
<li><p> If <code>value</code> is not given, current value is returned.
</p>
</li>
<li><p> A character vector or <code>NULL</code>.  Note that you can put a preceding <code>!</code> to negate the facet constraints. For example, <code>$variant_label(!c("r1i1p1f1", "r2i1p1f1"))</code> searches for all <code>variant_label</code>s except for <code>r1i1p1f1</code> and <code>r2i1p1f1</code>.
</p>
</li></ul>
</dd>
</dl>

</div>



<h5>Returns</h5>

 <ul>
<li><p> If <code>value</code> is given, the modified <code>EsgfQuery</code> object. </p>
</li>
<li><p> Otherwise, an <code>EsgfQueryParam</code> object which is essentially a list of three elements: </p>
 <ul>
<li> <p><code>value</code>: input values. </p>
</li>
<li> <p><code>negate</code>: Whether there is a preceding <code>!</code>. </p>
</li>
<li> <p><code>name</code>: Parameter name. </p>
</li></ul>
 </li></ul>




<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
# get current value
q$variant_label()

# set the parameter
q$variant_label(c("r1i1p1f1", "r1i2p1f1"))

# negate the constraints
q$variant_label(!c("r1i1p1f1", "r1i2p1f1"))

# remove the parameter
q$variant_label(NULL)
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-nominal_resolution"></a>



<h4>Method <code>nominal_resolution()</code></h4>

<p>Get or set the <code>nominal_resolution</code> facet parameter.
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$nominal_resolution(value)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>value</code></dt><dd><p>The  parameter value. Default: <code>NULL</code>.
There are two options:
</p>

<ul>
<li><p> If <code>value</code> is not given, current value is returned.
</p>
</li>
<li><p> A character vector or <code>NULL</code>.  Note that you can put a preceding <code>!</code> to negate the facet constraints. For example, <code>$nominal_resolution(!c("50 km", "1x1 degree"))</code> searches for all <code>nominal_resolution</code>s except for <code>50 km</code> and <code>1x1 degree</code>.
</p>
</li></ul>
</dd>
</dl>

</div>



<h5>Returns</h5>

 <ul>
<li><p> If <code>value</code> is given, the modified <code>EsgfQuery</code> object. </p>
</li>
<li><p> Otherwise, an <code>EsgfQueryParam</code> object which is essentially a list of three elements: </p>
 <ul>
<li> <p><code>value</code>: input values. </p>
</li>
<li> <p><code>negate</code>: Whether there is a preceding <code>!</code>. </p>
</li>
<li> <p><code>name</code>: Parameter name. </p>
</li></ul>
 </li></ul>




<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
# get current value
q$nominal_resolution()

# set the parameter
q$nominal_resolution(c("100 km", "1x1 degree"))

# negate the constraints
q$nominal_resolution(!c("100 km", "1x1 degree"))

# remove the parameter
q$nominal_resolution(NULL)
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-data_node"></a>



<h4>Method <code>data_node()</code></h4>

<p>Get or set the <code>data_node</code> parameter.
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$data_node(value)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>value</code></dt><dd><p>The  parameter value. Default: <code>NULL</code>.
There are two options:
</p>

<ul>
<li><p> If <code>value</code> is not given, current value is returned.
</p>
</li>
<li><p> A character vector or <code>NULL</code>.  Note that you can put a preceding <code>!</code> to negate the facet constraints. For example, <code>$data_node(!c("cmip.bcc.cma.cn", "esg.camscma.cn"))</code> searches for all <code>data_node</code>s except for <code>cmip.bcc.cma.cn</code> and <code>esg.camscma.cn</code>.
</p>
</li></ul>
</dd>
</dl>

</div>



<h5>Returns</h5>

 <ul>
<li><p> If <code>value</code> is given, the modified <code>EsgfQuery</code> object. </p>
</li>
<li><p> Otherwise, an <code>EsgfQueryParam</code> object which is essentially a list of three elements: </p>
 <ul>
<li> <p><code>value</code>: input values. </p>
</li>
<li> <p><code>negate</code>: Whether there is a preceding <code>!</code>. </p>
</li>
<li> <p><code>name</code>: Parameter name. </p>
</li></ul>
 </li></ul>




<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
# get current value
q$data_node()

# set the parameter
q$data_node("esg.lasg.ac.cn")

# negate the constraints
q$data_node(!"esg.lasg.ac.cn")

# remove the parameter
q$data_node(NULL)
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-facets"></a>



<h4>Method <code>facets()</code></h4>

<p>Get or set the <code>facets</code> parameter for facet counting query.
</p>
<p>Note that <code style="white-space: pre;">&#8288;$facets()&#8288;</code> only affects
<a href="#method-EsgfQuery-count"><code>$count()</code></a>
method when sending a query of facet counting.
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$facets(value)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>value</code></dt><dd><p>The facet parameter value. Default: <code>NULL</code>.
There are two options:
</p>

<ul>
<li><p> If <code>value</code> is not given, current value is returned.
</p>
</li>
<li><p> A character vector or <code>NULL</code>. The special notation <code>"*"</code> can be used to indicate that all available facets should be considered.
</p>
</li></ul>
</dd>
</dl>

</div>



<h5>Returns</h5>

 <ul>
<li><p> If <code>value</code> is given, the modified <code>EsgfQuery</code> object. </p>
</li>
<li><p> Otherwise, an <code>EsgfQueryParam</code> object which is essentially a list of three elements: </p>
 <ul>
<li> <p><code>value</code>: input values. </p>
</li>
<li> <p><code>negate</code>: Whether there is a preceding <code>!</code>. </p>
</li>
<li> <p><code>name</code>: Parameter name. </p>
</li></ul>
 </li></ul>




<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
# get current value
q$facets()

# set the facets
q$facets(c("activity_id", "source_id"))

# use all available facets
q$facets("*")
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-fields"></a>



<h4>Method <code>fields()</code></h4>

<p>Get or set the <code>fields</code> parameter.
</p>
<p>By default, all available metadata fields are returned for each
query. <code style="white-space: pre;">&#8288;$facets()&#8288;</code> can be used to limit the number of fields returned
in the query response.
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$fields(value = "*")</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>value</code></dt><dd><p>The facet parameter value. Default: <code>"*"</code>.
There are two options:
</p>

<ul>
<li><p> If <code>value</code> is not given, current value is returned.
</p>
</li>
<li><p> A character vector or <code>NULL</code>. The special notation <code>"*"</code> can be used to indicate that all available fields should be considered.
</p>
</li></ul>
</dd>
</dl>

</div>



<h5>Returns</h5>

 <ul>
<li><p> If <code>value</code> is given, the modified <code>EsgfQuery</code> object. </p>
</li>
<li><p> Otherwise, an <code>EsgfQueryParam</code> object which is essentially a list of three elements: </p>
 <ul>
<li> <p><code>value</code>: input values. </p>
</li>
<li> <p><code>negate</code>: Whether there is a preceding <code>!</code>. </p>
</li>
<li> <p><code>name</code>: Parameter name. </p>
</li></ul>
 </li></ul>




<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
# get current value
q$fields()

# set the fields
q$fields(c("activity_id", "source_id"))

# use all available fields
q$fields("*")

# remove the parameter
# act the same as above because the default `fields` in ESGF search
# services is `*` if `fields` is not specified
q$fields(NULL)
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-shards"></a>



<h4>Method <code>shards()</code></h4>

<p>Get or set the <code>shards</code> parameter.
</p>
<p>By default, a distributed query targets all ESGF Nodes. <code style="white-space: pre;">&#8288;$shards()&#8288;</code>
can be used to execute a distributed search that targets only one or
more specific nodes.
</p>
<p>All available shards can be retrieved using
<a href="#method-EsgfQuery-list_all_shards"><code>$list_all_shards()</code></a>
method.
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$shards(value)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>value</code></dt><dd><p>The facet parameter value.
There are two options:
</p>

<ul>
<li><p> If <code>value</code> is not given, current value is returned.
</p>
</li>
<li><p> A character vector or <code>NULL</code>.
</p>
</li></ul>
</dd>
</dl>

</div>



<h5>Returns</h5>

 <ul>
<li><p> If <code>value</code> is given, the modified <code>EsgfQuery</code> object. </p>
</li>
<li><p> Otherwise, an <code>EsgfQueryParam</code> object which is essentially a list of three elements: </p>
 <ul>
<li> <p><code>value</code>: input values. </p>
</li>
<li> <p><code>negate</code>: Whether there is a preceding <code>!</code>. </p>
</li>
<li> <p><code>name</code>: Parameter name. </p>
</li></ul>
 </li></ul>




<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
# get current value
q$shards()

# set the parameter
q$shards("localhost:8983/solr/datasets")

# negate the constraints
q$shards(!"localhost:8983/solr/datasets")

# only applicable for distributed queries
q$distrib(FALSE)$shards("localhost:8983/solr/datasets") # Error

# remove the parameter
q$shards(NULL)
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-replica"></a>



<h4>Method <code>replica()</code></h4>

<p>Get or set the <code>replica</code> parameter.
</p>
<p>By default, a query returns all records (masters and replicas)
matching the search criteria, i.e. <code style="white-space: pre;">&#8288;$replica(NULL)&#8288;</code>.
To return only master records, use <code style="white-space: pre;">&#8288;$replica(FALSE)&#8288;</code>; to return only
replicas, use <code style="white-space: pre;">&#8288;$replica(TRUE)&#8288;</code>.
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$replica(value)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>value</code></dt><dd><p>The facet parameter value. Default: <code>NULL</code>.
There are two options:
</p>

<ul>
<li><p> If <code>value</code> is not given, current value is returned.
</p>
</li>
<li><p> A flag or <code>NULL</code>.
</p>
</li></ul>
</dd>
</dl>

</div>



<h5>Returns</h5>

 <ul>
<li><p> If <code>value</code> is given, the modified <code>EsgfQuery</code> object. </p>
</li>
<li><p> Otherwise, an <code>EsgfQueryParam</code> object which is essentially a list of three elements: </p>
 <ul>
<li> <p><code>value</code>: input values. </p>
</li>
<li> <p><code>negate</code>: Whether there is a preceding <code>!</code>. </p>
</li>
<li> <p><code>name</code>: Parameter name. </p>
</li></ul>
 </li></ul>




<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
# get current value
q$replica()

# set the parameter
q$replica(TRUE)

# remove the parameter
q$replica(NULL)
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-latest"></a>



<h4>Method <code>latest()</code></h4>

<p>Get or set the <code>latest</code> parameter.
</p>
<p>By default, a query to the ESGF search services returns only the very
last, up-to-date version of the matching records, i.e.
<code style="white-space: pre;">&#8288;$latest(TRUE)&#8288;</code>. You can use <code style="white-space: pre;">&#8288;$latest(FALSE)&#8288;</code> to return all versions.
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$latest(value = TRUE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>value</code></dt><dd><p>The facet parameter value. Default: <code>TRUE</code>.
There are two options:
</p>

<ul>
<li><p> If <code>value</code> is not given, current value is returned.
</p>
</li>
<li><p> A flag.
</p>
</li></ul>
</dd>
</dl>

</div>



<h5>Returns</h5>

 <ul>
<li><p> If <code>value</code> is given, the modified <code>EsgfQuery</code> object. </p>
</li>
<li><p> Otherwise, an <code>EsgfQueryParam</code> object which is essentially a list of three elements: </p>
 <ul>
<li> <p><code>value</code>: input values. </p>
</li>
<li> <p><code>negate</code>: Whether there is a preceding <code>!</code>. </p>
</li>
<li> <p><code>name</code>: Parameter name. </p>
</li></ul>
 </li></ul>




<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
# get current value
q$latest()

# set the parameter
q$latest(TRUE)
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-type"></a>



<h4>Method <code>type()</code></h4>

<p>Get or set the <code>type</code> parameter.
</p>
<p>There are three types in total: <code>Dataset</code>, <code>File</code> or <code>Aggregation</code>.
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$type(value = "Dataset")</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>value</code></dt><dd><p>The facet parameter value. Default: <code>"Dataset"</code>.
There are two options:
</p>

<ul>
<li><p> If <code>value</code> is not given, current value is returned.
</p>
</li>
<li><p> A string.
</p>
</li></ul>
</dd>
</dl>

</div>



<h5>Returns</h5>

 <ul>
<li><p> If <code>value</code> is given, the modified <code>EsgfQuery</code> object. </p>
</li>
<li><p> Otherwise, an <code>EsgfQueryParam</code> object which is essentially a list of three elements: </p>
 <ul>
<li> <p><code>value</code>: input values. </p>
</li>
<li> <p><code>negate</code>: Whether there is a preceding <code>!</code>. </p>
</li>
<li> <p><code>name</code>: Parameter name. </p>
</li></ul>
 </li></ul>




<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
# get current value
q$type()

# set the parameter
q$type("Dataset")
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-limit"></a>



<h4>Method <code>limit()</code></h4>

<p>Get or set the <code>limit</code> parameter.
</p>
<p><code style="white-space: pre;">&#8288;$limit()&#8288;</code> can be used to limit the number of records to return.
Note that the maximum number of records to return per query for ESGF
search services is 10,000. A warning is issued if input value is
greater than that. In this case, <code>limit</code> will be reset to 10,000.
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$limit(value = 10L)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>value</code></dt><dd><p>The facet parameter value. Default: <code>10</code>.
There are two options:
</p>

<ul>
<li><p> If <code>value</code> is not given, current value is returned.
</p>
</li>
<li><p> An integer.
</p>
</li></ul>
</dd>
</dl>

</div>



<h5>Returns</h5>

 <ul>
<li><p> If <code>value</code> is given, the modified <code>EsgfQuery</code> object. </p>
</li>
<li><p> Otherwise, an <code>EsgfQueryParam</code> object which is essentially a list of three elements: </p>
 <ul>
<li> <p><code>value</code>: input values. </p>
</li>
<li> <p><code>negate</code>: Whether there is a preceding <code>!</code>. </p>
</li>
<li> <p><code>name</code>: Parameter name. </p>
</li></ul>
 </li></ul>




<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
# get current value
q$limit()

# set the parameter
q$limit(10L)

# `limit` is reset to 10,000 if input is greater than that
q$limit(10000L) # warning
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-offset"></a>



<h4>Method <code>offset()</code></h4>

<p>Get or set the <code>offset</code> parameter.
</p>
<p>If the query returns records that exceed the
<a href="#method-EsgfQuery-limit"><code>limit</code></a> number,
<code style="white-space: pre;">&#8288;$offset()&#8288;</code> can be used to paginate through the available results.
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$offset(value = 0L)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>value</code></dt><dd><p>The facet parameter value. Default: <code>0</code>.
There are two options:
</p>

<ul>
<li><p> If <code>value</code> is not given, current value is returned.
</p>
</li>
<li><p> An integer.
</p>
</li></ul>
</dd>
</dl>

</div>



<h5>Returns</h5>

 <ul>
<li><p> If <code>value</code> is given, the modified <code>EsgfQuery</code> object. </p>
</li>
<li><p> Otherwise, an <code>EsgfQueryParam</code> object which is essentially a list of three elements: </p>
 <ul>
<li> <p><code>value</code>: input values. </p>
</li>
<li> <p><code>negate</code>: Whether there is a preceding <code>!</code>. </p>
</li>
<li> <p><code>name</code>: Parameter name. </p>
</li></ul>
 </li></ul>




<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
# get current value
q$offset()

# set the parameter
q$offset(0L)
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-distrib"></a>



<h4>Method <code>distrib()</code></h4>

<p>Get or set the <code>distrib</code> facet
</p>
<p>By default, the query is sent to all ESGF Nodes, i.e.
<code style="white-space: pre;">&#8288;$distrib(TRUE)&#8288;</code>.
<code style="white-space: pre;">&#8288;$distrib(FALSE)&#8288;</code> can be used to execute the query only on the
target node.
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$distrib(value = TRUE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>value</code></dt><dd><p>The facet parameter value. Default: <code>TRUE</code>.
There are two options:
</p>

<ul>
<li><p> If <code>value</code> is not given, current value is returned.
</p>
</li>
<li><p> A flag.
</p>
</li></ul>
</dd>
</dl>

</div>



<h5>Returns</h5>

 <ul>
<li><p> If <code>value</code> is given, the modified <code>EsgfQuery</code> object. </p>
</li>
<li><p> Otherwise, an <code>EsgfQueryParam</code> object which is essentially a list of three elements: </p>
 <ul>
<li> <p><code>value</code>: input values. </p>
</li>
<li> <p><code>negate</code>: Whether there is a preceding <code>!</code>. </p>
</li>
<li> <p><code>name</code>: Parameter name. </p>
</li></ul>
 </li></ul>




<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
# get current value
q$distrib()

# set the parameter
q$distrib(TRUE)
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-params"></a>



<h4>Method <code>params()</code></h4>

<p>Get or set other parameters.
</p>
<p><code style="white-space: pre;">&#8288;$params()&#8288;</code> can be used to specify other parameters that do not have
a dedicated method, e.g. <code>version</code>, <code>master_id</code>, etc. It can also be
used to overwrite existing parameter values specified using methods
like <a href="#method-EsgfQuery-activity_id"><code>$activity_id()</code></a>.
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$params(...)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>...</code></dt><dd><p>Parameter values to set. There are three options:
</p>

<ul>
<li><p> If not given, existing parameters that do not have a dedicated
method are returned.
</p>
</li>
<li><p> If <code>NULL</code>, all existing parameters that do not have a dedicated
method are removed.
</p>
</li>
<li><p> A named vector, e.g. <code style="white-space: pre;">&#8288;$params(score = 1, table_id = "day")&#8288;</code> will
set <code>score</code> to <code>1</code> and <code>table_id</code> to <code>day</code>.
The <code>!</code> notation can still be used to negate the constraints, e.g.
<code style="white-space: pre;">&#8288;$params(table_id = !c("3hr", "day"))&#8288;</code> searches for all <code>table_id</code>
except for <code style="white-space: pre;">&#8288;3hr&#8288;</code> and <code>day</code>.
</p>
</li></ul>
</dd>
</dl>

</div>



<h5>Returns</h5>


<ul>
<li><p> If parameters are specified, the modified <code>EsgfQuery</code> object,
invisibly.
</p>
</li>
<li><p> Otherwise, an empty list for <code style="white-space: pre;">&#8288;$params(NULL)&#8288;</code> or a list of
<code>EsgfQueryParam</code> objects.
</p>
</li></ul>




<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
# get current values
# default is an empty list (`list()`)
q$params()

# set the parameter
q$params(table_id = c("3hr", "day"), member_id = "00")
q$params()

# reset existing parameters
q$frequency("day")
q$params(frequency = "mon")
q$frequency() # frequency value has been changed using $params()

# negating the constraints is also supported
q$params(table_id = !c("3hr", "day"))

# use NULL to remove all parameters
q$params(NULL)$params()
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-url"></a>



<h4>Method <code>url()</code></h4>

<p>Get the URL of actual query or wget script
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$url(wget = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>wget</code></dt><dd><p>Whether to return the URL of the wget script that can be
used to download all files matching the given constraints.
Default: <code>FALSE</code>.</p>
</dd>
</dl>

</div>



<h5>Returns</h5>

<p>A single string.
</p>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
q$url()

# get the wget script URL
q$url(wget = TRUE)

# You can download the wget script using the URL directly. For
# example, the code below downloads the script and save it as
# 'wget.sh' in R's temporary folder:
download.file(q$url(TRUE), file.path(tempdir(), "wget.sh"), mode = "wb")

}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-count"></a>



<h4>Method <code>count()</code></h4>

<p>Send a query of facet counting and fetch the results
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$count(facets = TRUE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>facets</code></dt><dd><p><code>NULL</code>, a flag or a character vector. There are three
options:
</p>

<ul>
<li><p> If <code>NULL</code> or <code>FALSE</code>, only the total number of matched records is
returned.
</p>
</li>
<li><p> If <code>TRUE</code>, the value of <a href="#method-EsgfQuery-facets"><code>$facets()</code></a>
is used to limit the facets. This is the default value.
</p>
</li>
<li><p> If a character vector, it is used to limit the facets.
</p>
</li></ul>
</dd>
</dl>

</div>



<h5>Returns</h5>


<ul>
<li><p> If <code>facets</code> equals <code>NULL</code> or <code>FALSE</code>, or <code style="white-space: pre;">&#8288;$facets()&#8288;</code> returns <code>NULL</code>,
an integer.
</p>
</li>
<li><p> Otherwise, a named list with the first element always being <code>total</code>
which is the total number of matched records. Other elements have
the same length as input facets and are all named integer vectors.
</p>
</li></ul>




<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
# get the total number of matched records
q$count(NULL) # or q$count(facets = FALSE)

# count records for specific facets
q$facets(c("activity_id", "source_id"))$count()

# same as above
q$count(facets = c("activity_id", "source_id"))
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-collect"></a>



<h4>Method <code>collect()</code></h4>

<p>Send the actual query and fetch the results
</p>
<p><code style="white-space: pre;">&#8288;$collect()&#8288;</code> sends the actual query to the ESGF search services and
returns the results in a <a href="data.table.html#topic+data.table">data.table::data.table</a>. The columns depend
on the value of query type and <code>fields</code> parameter.
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$collect()</pre></div>



<h5>Returns</h5>

<p>A <a href="data.table.html#topic+data.table">data.table</a>.
</p>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
q$fields("source_id")
q$collect()
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-response"></a>



<h4>Method <code>response()</code></h4>

<p>Get the response of last sent query
</p>
<p>The response of the last sent query is always stored internally and
can be retrieved using <code style="white-space: pre;">&#8288;$response()&#8288;</code>. It is a named list generated
from the JSON response using <code><a href="jsonlite.html#topic+fromJSON">jsonlite::fromJSON()</a></code>.
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$response()</pre></div>



<h5>Returns</h5>

<p>A named list.
</p>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
q$response()
}
</pre>
</div>


<hr>
<a id="method-EsgfQuery-print"></a>



<h4>Method <code>print()</code></h4>

<p>Print a summary of the current <code>EsgfQuery</code> object
</p>
<p><code style="white-space: pre;">&#8288;$print()&#8288;</code> gives the summary of current <code>EsgfQuery</code> object including
the host URL, the built time of facet cache and all query parameters.
</p>


<h5>Usage</h5>

<div class="r"><pre>EsgfQuery$print()</pre></div>



<h5>Returns</h5>

<p>The <code>EsgfQuery</code> object itself, invisibly.
</p>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
q$print()
}
</pre>
</div>




<h3>Author(s)</h3>

<p>Hongyuan Jia
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## ------------------------------------------------
## Method `EsgfQuery$new`
## ------------------------------------------------

## Not run: 
q &lt;- EsgfQuery$new(host = "https://esgf-node.llnl.gov/esg-search")
q

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$build_cache`
## ------------------------------------------------

## Not run: 
q$build_cache()

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$list_all_facets`
## ------------------------------------------------

## Not run: 
q$list_all_facets()

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$list_all_shards`
## ------------------------------------------------

## Not run: 
q$list_all_shards()

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$list_all_values`
## ------------------------------------------------

## Not run: 
q$list_all_values()

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$project`
## ------------------------------------------------

## Not run: 
# get current value
q$project()

# set the parameter
q$project("CMIP6")

# negate the project constraints
q$project(!"CMIP6")

# remove the parameter
q$project(NULL)

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$activity_id`
## ------------------------------------------------

## Not run: 
# get current value
q$activity_id()

# set the parameter
q$activity_id("ScenarioMIP")

# negate the constraints
q$activity_id(!c("CFMIP", "ScenarioMIP"))

# remove the parameter
q$activity_id(NULL)

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$experiment_id`
## ------------------------------------------------

## Not run: 
# get current value
q$experiment_id()

# set the parameter
q$experiment_id(c("ssp126", "ssp585"))

# negate the constraints
q$experiment_id(!c("ssp126", "ssp585"))

# remove the parameter
q$experiment_id(NULL)

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$source_id`
## ------------------------------------------------

## Not run: 
# get current value
q$source_id()

# set the parameter
q$source_id(c("BCC-CSM2-MR", "CESM2"))

# negate the constraints
q$source_id(!c("BCC-CSM2-MR", "CESM2"))

# remove the parameter
q$source_id(NULL)

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$variable_id`
## ------------------------------------------------

## Not run: 
# get current value
q$variable_id()

# set the parameter
q$variable_id(c("tas", "pr"))

# negate the constraints
q$variable_id(!c("tas", "pr"))

# remove the parameter
q$variable_id(NULL)

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$frequency`
## ------------------------------------------------

## Not run: 
# get current value
q$frequency()

# set the parameter
q$frequency(c("1hr", "day"))

# negate the constraints
q$frequency(!c("1hr", "day"))

# remove the parameter
q$frequency(NULL)

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$variant_label`
## ------------------------------------------------

## Not run: 
# get current value
q$variant_label()

# set the parameter
q$variant_label(c("r1i1p1f1", "r1i2p1f1"))

# negate the constraints
q$variant_label(!c("r1i1p1f1", "r1i2p1f1"))

# remove the parameter
q$variant_label(NULL)

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$nominal_resolution`
## ------------------------------------------------

## Not run: 
# get current value
q$nominal_resolution()

# set the parameter
q$nominal_resolution(c("100 km", "1x1 degree"))

# negate the constraints
q$nominal_resolution(!c("100 km", "1x1 degree"))

# remove the parameter
q$nominal_resolution(NULL)

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$data_node`
## ------------------------------------------------

## Not run: 
# get current value
q$data_node()

# set the parameter
q$data_node("esg.lasg.ac.cn")

# negate the constraints
q$data_node(!"esg.lasg.ac.cn")

# remove the parameter
q$data_node(NULL)

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$facets`
## ------------------------------------------------

## Not run: 
# get current value
q$facets()

# set the facets
q$facets(c("activity_id", "source_id"))

# use all available facets
q$facets("*")

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$fields`
## ------------------------------------------------

## Not run: 
# get current value
q$fields()

# set the fields
q$fields(c("activity_id", "source_id"))

# use all available fields
q$fields("*")

# remove the parameter
# act the same as above because the default `fields` in ESGF search
# services is `*` if `fields` is not specified
q$fields(NULL)

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$shards`
## ------------------------------------------------

## Not run: 
# get current value
q$shards()

# set the parameter
q$shards("localhost:8983/solr/datasets")

# negate the constraints
q$shards(!"localhost:8983/solr/datasets")

# only applicable for distributed queries
q$distrib(FALSE)$shards("localhost:8983/solr/datasets") # Error

# remove the parameter
q$shards(NULL)

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$replica`
## ------------------------------------------------

## Not run: 
# get current value
q$replica()

# set the parameter
q$replica(TRUE)

# remove the parameter
q$replica(NULL)

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$latest`
## ------------------------------------------------

## Not run: 
# get current value
q$latest()

# set the parameter
q$latest(TRUE)

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$type`
## ------------------------------------------------

## Not run: 
# get current value
q$type()

# set the parameter
q$type("Dataset")

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$limit`
## ------------------------------------------------

## Not run: 
# get current value
q$limit()

# set the parameter
q$limit(10L)

# `limit` is reset to 10,000 if input is greater than that
q$limit(10000L) # warning

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$offset`
## ------------------------------------------------

## Not run: 
# get current value
q$offset()

# set the parameter
q$offset(0L)

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$distrib`
## ------------------------------------------------

## Not run: 
# get current value
q$distrib()

# set the parameter
q$distrib(TRUE)

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$params`
## ------------------------------------------------

## Not run: 
# get current values
# default is an empty list (`list()`)
q$params()

# set the parameter
q$params(table_id = c("3hr", "day"), member_id = "00")
q$params()

# reset existing parameters
q$frequency("day")
q$params(frequency = "mon")
q$frequency() # frequency value has been changed using $params()

# negating the constraints is also supported
q$params(table_id = !c("3hr", "day"))

# use NULL to remove all parameters
q$params(NULL)$params()

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$url`
## ------------------------------------------------

## Not run: 
q$url()

# get the wget script URL
q$url(wget = TRUE)

# You can download the wget script using the URL directly. For
# example, the code below downloads the script and save it as
# 'wget.sh' in R's temporary folder:
download.file(q$url(TRUE), file.path(tempdir(), "wget.sh"), mode = "wb")


## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$count`
## ------------------------------------------------

## Not run: 
# get the total number of matched records
q$count(NULL) # or q$count(facets = FALSE)

# count records for specific facets
q$facets(c("activity_id", "source_id"))$count()

# same as above
q$count(facets = c("activity_id", "source_id"))

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$collect`
## ------------------------------------------------

## Not run: 
q$fields("source_id")
q$collect()

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$response`
## ------------------------------------------------

## Not run: 
q$response()

## End(Not run)

## ------------------------------------------------
## Method `EsgfQuery$print`
## ------------------------------------------------

## Not run: 
q$print()

## End(Not run)
</code></pre>

<hr>
<h2 id='extract_data'>Extract data</h2><span id='topic+extract_data'></span>

<h3>Description</h3>

<p><code>extract_data()</code> takes an <code>epw_cmip6_coord</code> object generated using
<code><a href="#topic+match_coord">match_coord()</a></code> and extracts CMIP6 data using the coordinates and years of
interest specified.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_data(
  coord,
  years = NULL,
  unit = FALSE,
  out_dir = NULL,
  by = NULL,
  keep = is.null(out_dir),
  compress = 100
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="extract_data_+3A_coord">coord</code></td>
<td>
<p>An <code>epw_cmip6_coord</code> object created using <code><a href="#topic+match_coord">match_coord()</a></code></p>
</td></tr>
<tr><td><code id="extract_data_+3A_years">years</code></td>
<td>
<p>An integer vector indicating the target years to be included in
the data file. All other years will be excluded. If <code>NULL</code>, no
subsetting on years will be performed. Default: <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="extract_data_+3A_unit">unit</code></td>
<td>
<p>If <code>TRUE</code>, units will be added to values using
<code><a href="units.html#topic+units">units::set_units()</a></code>.</p>
</td></tr>
<tr><td><code id="extract_data_+3A_out_dir">out_dir</code></td>
<td>
<p>The directory to save extracted data using <code><a href="fst.html#topic+write_fst">fst::write_fst()</a></code>.
If <code>NULL</code>, all data will be kept in memory by default. Default: <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="extract_data_+3A_by">by</code></td>
<td>
<p>A character vector of variable names used to split data
during extraction. Should be a subset of:
</p>

<ul>
<li> <p><code>"experiment"</code>: root experiment identifiers
</p>
</li>
<li> <p><code>"source"</code>: model identifiers
</p>
</li>
<li> <p><code>"variable"</code>: variable identifiers
</p>
</li>
<li> <p><code>"activity"</code>: activity identifiers
</p>
</li>
<li> <p><code>"frequency"</code>: sampling frequency
</p>
</li>
<li> <p><code>"variant"</code>: variant label
</p>
</li>
<li> <p><code>"resolution"</code>: approximate horizontal resolution
</p>
</li></ul>

<p>If <code>NULL</code> and <code>out_dir</code> is given, file name <code>data.fst</code> will be used. Default:
<code>NULL</code>.</p>
</td></tr>
<tr><td><code id="extract_data_+3A_keep">keep</code></td>
<td>
<p>Whether keep extracted data in memory. Default: <code>TRUE</code> if
<code>out_dir</code> is <code>NULL</code>, and <code>FALSE</code> otherwise.</p>
</td></tr>
<tr><td><code id="extract_data_+3A_compress">compress</code></td>
<td>
<p>A single integer in the range 0 to 100, indicating the amount
of compression to use. Lower values mean larger file sizes. Default:
<code>100</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>extract_data()</code> supports common calendars, including <code style="white-space: pre;">&#8288;365_day&#8288;</code> and
<code style="white-space: pre;">&#8288;360_day&#8288;</code>, thanks to the <a href="PCICt.html#topic+as.PCICt">PCICt</a> package.
</p>
<p><code>extract_data()</code> uses <a href="future.apply.html#topic+future_lapply">future.apply</a>
underneath. You can use your preferable future backend to
speed up data extraction in parallel. By default, <code>extract_data()</code> uses
<code>future::sequential</code> backend, which runs things in sequential.
</p>


<h3>Value</h3>

<p>An <code>epw_cmip6_data</code> object, which is basically a list of 3 elements:
</p>

<ul>
<li> <p><code>epw</code>: An <a href="eplusr.html#topic+Epw">eplusr::Epw</a> object whose longitude and latitude are used to
extract CMIP6 data. It is the same object as created in <code><a href="#topic+match_coord">match_coord()</a></code>
</p>
</li>
<li> <p><code>meta</code>: A list containing basic metadata of input EPW, including <code>city</code>,
<code>state_province</code>, <code>country</code>, <code>latitude</code> and <code>longitude</code>.
</p>
</li>
<li> <p><code>data</code>: An empty <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> if <code>keep</code> is <code>FALSE</code> or a
<code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> of 14 columns if <code>keep</code> is <code>TRUE</code>:</p>

<table>
<tr>
 <td style="text-align: right;">
   No. </td><td style="text-align: left;"> Column </td><td style="text-align: left;"> Type </td><td style="text-align: left;"> Description </td>
</tr>
<tr>
 <td style="text-align: right;">
   1 </td><td style="text-align: left;"> <code>activity_drs</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Activity DRS (Data Reference Syntax) </td>
</tr>
<tr>
 <td style="text-align: right;">
   2 </td><td style="text-align: left;"> <code>institution_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Institution identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   3 </td><td style="text-align: left;"> <code>source_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Model identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   4 </td><td style="text-align: left;"> <code>experiment_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Root experiment identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   5 </td><td style="text-align: left;"> <code>member_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> A compound construction from <code>sub_experiment_id</code> and <code>variant_label</code> </td>
</tr>
<tr>
 <td style="text-align: right;">
   6 </td><td style="text-align: left;"> <code>table_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Table identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   7 </td><td style="text-align: left;"> <code>lon</code> </td><td style="text-align: left;"> Double </td><td style="text-align: left;"> Longitude of extracted location </td>
</tr>
<tr>
 <td style="text-align: right;">
   8 </td><td style="text-align: left;"> <code>lat</code> </td><td style="text-align: left;"> Double </td><td style="text-align: left;"> Latitude of extracted location </td>
</tr>
<tr>
 <td style="text-align: right;">
   9 </td><td style="text-align: left;"> <code>dist</code> </td><td style="text-align: left;"> Double </td><td style="text-align: left;"> The spherical distance in km between EPW location and grid coordinates </td>
</tr>
<tr>
 <td style="text-align: right;">
   10 </td><td style="text-align: left;"> <code>datetime</code> </td><td style="text-align: left;"> POSIXct </td><td style="text-align: left;"> Datetime for the predicted value </td>
</tr>
<tr>
 <td style="text-align: right;">
   11 </td><td style="text-align: left;"> <code>variable</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Variable identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   12 </td><td style="text-align: left;"> <code>description</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Variable long name </td>
</tr>
<tr>
 <td style="text-align: right;">
   13 </td><td style="text-align: left;"> <code>units</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Units of variable </td>
</tr>
<tr>
 <td style="text-align: right;">
   14 </td><td style="text-align: left;"> <code>value</code> </td><td style="text-align: left;"> Double </td><td style="text-align: left;"> The actual predicted value </td>
</tr>
<tr>
 <td style="text-align: right;">
</td>
</tr>

</table>

</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
coord &lt;- match_coord("path_to_an_EPW")
extract_data(coord, years = 2030:2060)

## End(Not run)
</code></pre>

<hr>
<h2 id='future_epw'>Create future EPW files using morphed data</h2><span id='topic+future_epw'></span>

<h3>Description</h3>

<p>Create future EPW files using morphed data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>future_epw(
  morphed,
  by = c("experiment", "source", "interval"),
  dir = ".",
  separate = TRUE,
  overwrite = FALSE,
  full = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="future_epw_+3A_morphed">morphed</code></td>
<td>
<p>An <code>epw_cmip6_morphed</code> object created using <code><a href="#topic+morphing_epw">morphing_epw()</a></code>.</p>
</td></tr>
<tr><td><code id="future_epw_+3A_by">by</code></td>
<td>
<p>A character vector of columns to be used as grouping variables when
creating EPW files. Should be a subset of:
</p>

<ul>
<li> <p><code>"experiment"</code>: root experiment identifiers
</p>
</li>
<li> <p><code>"source"</code>: model identifiers
</p>
</li>
<li> <p><code>"variable"</code>: variable identifiers
</p>
</li>
<li> <p><code>"activity"</code>: activity identifiers
</p>
</li>
<li> <p><code>"frequency"</code>: sampling frequency
</p>
</li>
<li> <p><code>"variant"</code>: variant label
</p>
</li>
<li> <p><code>"resolution"</code>: approximate horizontal resolution
</p>
</li>
<li> <p><code>"longitude"</code>: averaged longitude of input data
</p>
</li>
<li> <p><code>"latitude"</code>: averaged latitude of input data
</p>
</li></ul>
</td></tr>
<tr><td><code id="future_epw_+3A_dir">dir</code></td>
<td>
<p>The parent directory to save the generated EPW files. If not
exist, it will be created first. Default: <code>"."</code>, i.e., current working
directory.</p>
</td></tr>
<tr><td><code id="future_epw_+3A_separate">separate</code></td>
<td>
<p>If <code>TRUE</code>, each EPW file will be saved into a separate folder
using grouping variables specified in <code>by</code>.</p>
</td></tr>
<tr><td><code id="future_epw_+3A_overwrite">overwrite</code></td>
<td>
<p>If <code>TRUE</code>, overwrite existing files if they exist. Default:
<code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="future_epw_+3A_full">full</code></td>
<td>
<p>If <code>TRUE</code>, a <a href="data.table.html#topic+data.table">data.table</a> containing
information about how the data are split and also the generated future
EPWs and their paths are returned. Default: <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If <code>full</code> is <code>FALSE</code>, which is the default, a list of generated <a href="eplusr.html#topic+Epw">eplusr::Epw</a> objects, invisibly.
Otherwise, a <a href="data.table.html#topic+data.table">data.table</a> with columns:
</p>

<ul>
<li><p> specified by the <code>by</code> value
</p>
</li>
<li> <p><code>epw</code>: a list of <a href="eplusr.html#topic+Epw">eplusr::Epw</a>
</p>
</li>
<li> <p><code>path</code>: full paths of the generated EPW files
</p>
</li></ul>


<hr>
<h2 id='get_data_dir'>Get the path of directory where epwshiftr data is stored</h2><span id='topic+get_data_dir'></span>

<h3>Description</h3>

<p>If option <code>epwshiftr.dir</code> is set, use it. Otherwise, get package data storage
directory using <code><a href="rappdirs.html#topic+user_data_dir">rappdirs::user_data_dir()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_data_dir()
</code></pre>


<h3>Value</h3>

<p>A single string.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>options(epwshiftr.dir = tempdir())
get_data_dir()

</code></pre>

<hr>
<h2 id='get_data_node'>Get data nodes which store CMIP6 output</h2><span id='topic+get_data_node'></span>

<h3>Description</h3>

<p>Get data nodes which store CMIP6 output
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_data_node(speed_test = FALSE, timeout = 3)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_data_node_+3A_speed_test">speed_test</code></td>
<td>
<p>If <code>TRUE</code>, use <code><a href="pingr.html#topic+ping">pingr::ping()</a></code> to perform connection speed
test on each data node. A <code>ping</code> column is appended in returned
data.table which stores each data node response in milliseconds. This
feature needs pingr package already installed. Default: <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="get_data_node_+3A_timeout">timeout</code></td>
<td>
<p>Timeout for a ping response in seconds. Default: <code>3</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> of 2 or 3 (when <code>speed_test</code> is <code>TRUE</code>)
columns:</p>

<table>
<tr>
 <td style="text-align: left;">
   Column </td><td style="text-align: left;"> Type </td><td style="text-align: left;"> Description </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code>data_node</code> </td><td style="text-align: left;"> character </td><td style="text-align: left;"> Web address of data node </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code>status</code> </td><td style="text-align: left;"> character </td><td style="text-align: left;"> Status of data node. <code>"UP"</code> means OK and <code>"DOWN"</code> means currently not available </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code>ping</code> </td><td style="text-align: left;"> double </td><td style="text-align: left;"> Data node response in milliseconds during speed test </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
get_data_node()

## End(Not run)

</code></pre>

<hr>
<h2 id='init_cmip6_index'>Build CMIP6 experiment output file index</h2><span id='topic+init_cmip6_index'></span>

<h3>Description</h3>

<p><code>init_cmip6_index()</code> will search the CMIP6 model output file using <code><a href="#topic+esgf_query">esgf_query()</a></code>
, return a <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> containing the actual NetCDF file url
to download, and store it into user data directory for future use.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>init_cmip6_index(
  activity = "ScenarioMIP",
  variable = c("tas", "tasmax", "tasmin", "hurs", "hursmax", "hursmin", "pr", "rsds",
    "rlds", "psl", "sfcWind", "clt"),
  frequency = "day",
  experiment = c("ssp126", "ssp245", "ssp370", "ssp585"),
  source = c("AWI-CM-1-1-MR", "BCC-CSM2-MR", "CESM2", "CESM2-WACCM", "EC-Earth3",
    "EC-Earth3-Veg", "GFDL-ESM4", "INM-CM4-8", "INM-CM5-0", "MPI-ESM1-2-HR",
    "MRI-ESM2-0"),
  variant = "r1i1p1f1",
  replica = FALSE,
  latest = TRUE,
  resolution = c("100 km", "50 km"),
  limit = 10000L,
  data_node = NULL,
  years = NULL,
  save = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="init_cmip6_index_+3A_activity">activity</code></td>
<td>
<p>A character vector indicating activity identifiers. Default:
<code>"ScenarioMIP"</code>. Possible values:
</p>

<ul>
<li> <p><code>"AerChemMIP"</code>: Aerosols and Chemistry Model Intercomparison Project,
</p>
</li>
<li> <p><code>"C4MIP"</code>: Coupled Climate Carbon Cycle Model Intercomparison Project,
</p>
</li>
<li> <p><code>"CDRMIP"</code>: Carbon Dioxide Removal Model Intercomparison Project,
</p>
</li>
<li> <p><code>"CFMIP"</code>: Cloud Feedback Model Intercomparison Project,
</p>
</li>
<li> <p><code>"CMIP"</code>: CMIP DECK: 1pctCO2, abrupt4xCO2, amip, esm-piControl, esm-historical, historical, and piControl experiments,
</p>
</li>
<li> <p><code>"CORDEX"</code>: Coordinated Regional Climate Downscaling Experiment,
</p>
</li>
<li> <p><code>"DAMIP"</code>: Detection and Attribution Model Intercomparison Project,
</p>
</li>
<li> <p><code>"DCPP"</code>: Decadal Climate Prediction Project,
</p>
</li>
<li> <p><code>"DynVarMIP"</code>: Dynamics and Variability Model Intercomparison Project,
</p>
</li>
<li> <p><code>"FAFMIP"</code>: Flux-Anomaly-Forced Model Intercomparison Project,
</p>
</li>
<li> <p><code>"GMMIP"</code>: Global Monsoons Model Intercomparison Project,
</p>
</li>
<li> <p><code>"GeoMIP"</code>: Geoengineering Model Intercomparison Project,
</p>
</li>
<li> <p><code>"HighResMIP"</code>: High-Resolution Model Intercomparison Project,
</p>
</li>
<li> <p><code>"ISMIP6"</code>: Ice Sheet Model Intercomparison Project for CMIP6,
</p>
</li>
<li> <p><code>"LS3MIP"</code>: Land Surface, Snow and Soil Moisture,
</p>
</li>
<li> <p><code>"LUMIP"</code>: Land-Use Model Intercomparison Project,
</p>
</li>
<li> <p><code>"OMIP"</code>: Ocean Model Intercomparison Project,
</p>
</li>
<li> <p><code>"PAMIP"</code>: Polar Amplification Model Intercomparison Project,
</p>
</li>
<li> <p><code>"PMIP"</code>: Palaeoclimate Modelling Intercomparison Project,
</p>
</li>
<li> <p><code>"RFMIP"</code>: Radiative Forcing Model Intercomparison Project,
</p>
</li>
<li> <p><code>"SIMIP"</code>: Sea Ice Model Intercomparison Project,
</p>
</li>
<li> <p><code>"ScenarioMIP"</code>: Scenario Model Intercomparison Project,
</p>
</li>
<li> <p><code>"VIACSAB"</code>: Vulnerability, Impacts, Adaptation and Climate Services Advisory Board,
</p>
</li>
<li> <p><code>"VolMIP"</code>: Volcanic Forcings Model Intercomparison Project
</p>
</li></ul>
</td></tr>
<tr><td><code id="init_cmip6_index_+3A_variable">variable</code></td>
<td>
<p>A character vector indicating variable identifiers. The 12
most related variables for EPW are set as defaults. If <code>NULL</code>, all
possible variables are returned. Default: <code>c("tas", "tasmax", "tasmin", "hurs", "hursmax", "hursmin", "psl", "rss", "rls", "sfcWind", "pr", "clt")</code>, where:
</p>

<ul>
<li> <p><code>tas</code>: Near-surface (usually, 2 meter) air temperature, units: <code>K</code>.
</p>
</li>
<li> <p><code>tasmax</code>: Maximum near-surface (usually, 2 meter) air temperature, units: <code>K</code>.
</p>
</li>
<li> <p><code>tasmin</code>: Minimum near-surface (usually, 2 meter) air temperature, units: <code>K</code>.
</p>
</li>
<li> <p><code>hurs</code>: Near-surface relative humidity, units: <code style="white-space: pre;">&#8288;%&#8288;</code>.
</p>
</li>
<li> <p><code>hursmax</code>: Maximum near-surface relative humidity, units: <code style="white-space: pre;">&#8288;%&#8288;</code>.
</p>
</li>
<li> <p><code>hursmin</code>: Minimum near-surface relative humidity, units: <code style="white-space: pre;">&#8288;%&#8288;</code>.
</p>
</li>
<li> <p><code>psl</code>: Sea level pressure, units: <code>Pa</code>.
</p>
</li>
<li> <p><code>rsds</code>: Surface downwelling shortwave radiation, units: <code style="white-space: pre;">&#8288;W m-2&#8288;</code>.
</p>
</li>
<li> <p><code>rlds</code>: Surface downwelling longwave radiation, units: <code style="white-space: pre;">&#8288;W m-2&#8288;</code>.
</p>
</li>
<li> <p><code>sfcWind</code>: Near-surface (usually, 10 meters) wind speed, units: <code style="white-space: pre;">&#8288;m s-1&#8288;</code>.
</p>
</li>
<li> <p><code>pr</code>: Precipitation, units: <code style="white-space: pre;">&#8288;kg m-2 s-1&#8288;</code>.
</p>
</li>
<li> <p><code>clt</code>: Total cloud area fraction for the whole atmospheric column, as
seen from the surface or the top of the atmosphere. Units: <code style="white-space: pre;">&#8288;%&#8288;</code>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="init_cmip6_index_+3A_frequency">frequency</code></td>
<td>
<p>A character vector of sampling frequency. If <code>NULL</code>, all
possible frequencies are returned. Default: <code>"day"</code>.
Possible values:
</p>

<ul>
<li> <p><code>"1hr"</code>: sampled hourly,
</p>
</li>
<li> <p><code>"1hrCM"</code>: monthly-mean diurnal cycle resolving each day into 1-hour means,
</p>
</li>
<li> <p><code>"1hrPt"</code>: sampled hourly, at specified time point within an hour,
</p>
</li>
<li> <p><code>"3hr"</code>: sampled every 3 hours,
</p>
</li>
<li> <p><code>"3hrPt"</code>: sampled 3 hourly, at specified time point within the time period,
</p>
</li>
<li> <p><code>"6hr"</code>: sampled every 6 hours,
</p>
</li>
<li> <p><code>"6hrPt"</code>: sampled 6 hourly, at specified time point within the time period,
</p>
</li>
<li> <p><code>"day"</code>: daily mean samples,
</p>
</li>
<li> <p><code>"dec"</code>: decadal mean samples,
</p>
</li>
<li> <p><code>"fx"</code>: fixed (time invariant) field,
</p>
</li>
<li> <p><code>"mon"</code>: monthly mean samples,
</p>
</li>
<li> <p><code>"monC"</code>: monthly climatology computed from monthly mean samples,
</p>
</li>
<li> <p><code>"monPt"</code>: sampled monthly, at specified time point within the time period,
</p>
</li>
<li> <p><code>"subhrPt"</code>: sampled sub-hourly, at specified time point within an hour,
</p>
</li>
<li> <p><code>"yr"</code>: annual mean samples,
</p>
</li>
<li> <p><code>"yrPt"</code>: sampled yearly, at specified time point within the time period
</p>
</li></ul>
</td></tr>
<tr><td><code id="init_cmip6_index_+3A_experiment">experiment</code></td>
<td>
<p>A character vector indicating root experiment identifiers.
The <strong>Tier-1</strong> experiment of activity ScenarioMIP are set as defaults.
If <code>NULL</code>, all possible experiment are returned.
Default: <code>c("ssp126", "ssp245", "ssp370", "ssp585")</code>.</p>
</td></tr>
<tr><td><code id="init_cmip6_index_+3A_source">source</code></td>
<td>
<p>A character vector indicating model identifiers. Defaults are
set to 11 sources which give outputs of all 4 experiment of activity
ScenarioMIP with daily frequency, i.e. <code>"AWI-CM-1-1-MR"</code>,
<code>"BCC-CSM2-MR"</code>, <code>"CESM2"</code>, <code>"CESM2-WACCM"</code>, <code>"EC-Earth3"</code>,
<code>"EC-Earth3-Veg"</code>, <code>"GFDL-ESM4"</code>, <code>"INM-CM4-8"</code>, <code>"INM-CM5-0"</code>,
<code>"MPI-ESM1-2-HR"</code> and <code>"MRI-ESM2-0"</code>.
If <code>NULL</code>, all possible sources are returned.</p>
</td></tr>
<tr><td><code id="init_cmip6_index_+3A_variant">variant</code></td>
<td>
<p>A character vector indicating label constructed from 4
indices stored as global attributes in format <code style="white-space: pre;">&#8288;r&lt;k&gt;i&lt;l&gt;p&lt;m&gt;f&lt;n&gt;&#8288;</code>
described below. Default: <code>"r1i1p1f1"</code>.
If <code>NULL</code>, all possible variants are returned.
</p>

<ul>
<li> <p><code>r</code>: realization_index (<code style="white-space: pre;">&#8288;&lt;k&gt;&#8288;</code>) = realization number (integer &gt;0)
</p>
</li>
<li> <p><code>i</code>: initialization_index (<code style="white-space: pre;">&#8288;&lt;l&gt;&#8288;</code>) = index for variant of initialization method (integer &gt;0)
</p>
</li>
<li> <p><code>p</code>: physics_index (<code style="white-space: pre;">&#8288;&lt;m&gt;&#8288;</code>) = index for model physics variant (integer &gt;0)
</p>
</li>
<li> <p><code>f</code>: forcing_index (<code style="white-space: pre;">&#8288;&lt;n&gt;&#8288;</code>) = index for variant of forcing (integer &gt;0)
</p>
</li></ul>
</td></tr>
<tr><td><code id="init_cmip6_index_+3A_replica">replica</code></td>
<td>
<p>Whether the record is the &quot;master&quot; copy, or a replica. Use
<code>FALSE</code> to return only originals and <code>TRUE</code> to return only replicas.
Use <code>NULL</code> to return both the master and the replicas.
Default: <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="init_cmip6_index_+3A_latest">latest</code></td>
<td>
<p>Whether the record is the latest available version, or a
previous version. Use <code>TRUE</code> to return only the latest version of all
records and <code>FALSE</code> to return previous versions. Default: <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="init_cmip6_index_+3A_resolution">resolution</code></td>
<td>
<p>A character vector indicating approximate horizontal
resolution. Default: <code>c("50 km", "100 km")</code>.
If <code>NULL</code>, all possible resolutions are returned.</p>
</td></tr>
<tr><td><code id="init_cmip6_index_+3A_limit">limit</code></td>
<td>
<p>An integer indicating the maximum of matched records to return.
Should be &lt;= 10,000. Default: <code>10000</code>.</p>
</td></tr>
<tr><td><code id="init_cmip6_index_+3A_data_node">data_node</code></td>
<td>
<p>A character vector indicating data nodes to be queried.
Default to <code>NULL</code>, which means all possible data nodes.</p>
</td></tr>
<tr><td><code id="init_cmip6_index_+3A_years">years</code></td>
<td>
<p>An integer vector indicating the target years to be include in
the data file. All other years will be excluded. If <code>NULL</code>, no
subsetting on years will be performed. Default: <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="init_cmip6_index_+3A_save">save</code></td>
<td>
<p>If <code>TRUE</code>, the results will be saved into user data directory.
Default: <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For details on where the file index is stored, see <code><a href="rappdirs.html#topic+user_data_dir">rappdirs::user_data_dir()</a></code>.
</p>


<h3>Value</h3>

<p>A <a href="data.table.html#topic+data.table">data.table::data.table</a> with 22 columns:</p>

<table>
<tr>
 <td style="text-align: right;">
   No. </td><td style="text-align: left;"> Column </td><td style="text-align: left;"> Type </td><td style="text-align: left;"> Description </td>
</tr>
<tr>
 <td style="text-align: right;">
   1 </td><td style="text-align: left;"> <code>file_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Model output file universal identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   2 </td><td style="text-align: left;"> <code>dataset_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Dataset universal identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   3 </td><td style="text-align: left;"> <code>mip_era</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Activity's associated CMIP cycle. Will always be <code>"CMIP6"</code> </td>
</tr>
<tr>
 <td style="text-align: right;">
   4 </td><td style="text-align: left;"> <code>activity_drs</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Activity DRS (Data Reference Syntax) </td>
</tr>
<tr>
 <td style="text-align: right;">
   5 </td><td style="text-align: left;"> <code>institution_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Institution identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   6 </td><td style="text-align: left;"> <code>source_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Model identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   7 </td><td style="text-align: left;"> <code>experiment_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Root experiment identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   8 </td><td style="text-align: left;"> <code>member_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> A compound construction from <code>sub_experiment_id</code> and <code>variant_label</code> </td>
</tr>
<tr>
 <td style="text-align: right;">
   9 </td><td style="text-align: left;"> <code>table_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Table identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   10 </td><td style="text-align: left;"> <code>frequency</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Sampling frequency </td>
</tr>
<tr>
 <td style="text-align: right;">
   11 </td><td style="text-align: left;"> <code>grid_label</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Grid identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   12 </td><td style="text-align: left;"> <code>version</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Approximate date of model output file </td>
</tr>
<tr>
 <td style="text-align: right;">
   13 </td><td style="text-align: left;"> <code>nominal_resolution</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Approximate horizontal resolution </td>
</tr>
<tr>
 <td style="text-align: right;">
   14 </td><td style="text-align: left;"> <code>variable_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Variable identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   15 </td><td style="text-align: left;"> <code>variable_long_name</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Variable long name </td>
</tr>
<tr>
 <td style="text-align: right;">
   16 </td><td style="text-align: left;"> <code>variable_units</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Units of variable </td>
</tr>
<tr>
 <td style="text-align: right;">
   17 </td><td style="text-align: left;"> <code>datetime_start</code> </td><td style="text-align: left;"> POSIXct </td><td style="text-align: left;"> Start date and time of simulation </td>
</tr>
<tr>
 <td style="text-align: right;">
   18 </td><td style="text-align: left;"> <code>datetime_end</code> </td><td style="text-align: left;"> POSIXct </td><td style="text-align: left;"> End date and time of simulation </td>
</tr>
<tr>
 <td style="text-align: right;">
   19 </td><td style="text-align: left;"> <code>file_size</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Model output file size in Bytes </td>
</tr>
<tr>
 <td style="text-align: right;">
   20 </td><td style="text-align: left;"> <code>data_node</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Data node to download the model output file </td>
</tr>
<tr>
 <td style="text-align: right;">
   21 </td><td style="text-align: left;"> <code>dataset_pid</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> A unique string that helps identify the dataset </td>
</tr>
<tr>
 <td style="text-align: right;">
   22 </td><td style="text-align: left;"> <code>tracking_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> A unique string that helps identify the output file </td>
</tr>
<tr>
 <td style="text-align: right;">
</td>
</tr>

</table>



<h3>Note</h3>

<p>Argument <code>limit</code> will only apply to <code>Dataset</code> query. <code>init_cmip6_index()</code> will
try to get all model output files which match the dataset id.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
init_cmip6_index()

## End(Not run)

</code></pre>

<hr>
<h2 id='load_cmip6_index'>Load previously stored CMIP6 experiment output file index</h2><span id='topic+load_cmip6_index'></span>

<h3>Description</h3>

<p>Load previously stored CMIP6 experiment output file index
</p>


<h3>Usage</h3>

<pre><code class='language-R'>load_cmip6_index(force = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="load_cmip6_index_+3A_force">force</code></td>
<td>
<p>If <code>TRUE</code>, read the index file. Otherwise, return the
cached index if exists. Default: <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <a href="data.table.html#topic+data.table">data.table::data.table</a> with 20 columns. For detail description on
column, see <code><a href="#topic+init_cmip6_index">init_cmip6_index()</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
load_cmip6_index()

## End(Not run)
</code></pre>

<hr>
<h2 id='match_coord'>Match coordinates of input EPW in the CMIP6 output file database</h2><span id='topic+match_coord'></span>

<h3>Description</h3>

<p><code>match_coord()</code> takes an EPW and uses its longitude and latitude to calculate
the distance between the EPW location and the global grid points in NetCDF
files.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>match_coord(epw, threshold = list(lon = 1, lat = 1), max_num = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="match_coord_+3A_epw">epw</code></td>
<td>
<p>Possible values:
</p>

<ul>
<li><p> A file path of EPW file
</p>
</li>
<li><p> An <a href="eplusr.html#topic+Epw">eplusr::Epw</a> object
</p>
</li>
<li><p> A regular expression used to search locations in EnergyPlus Weather
Database, e.g. &quot;los angeles.*tmy3&quot;. You will be asked to select a matched
EPW to download and read. It will be saved into <code><a href="base.html#topic+tempdir">tempdir()</a></code>. Note that the
search is case-insensitive
</p>
</li></ul>
</td></tr>
<tr><td><code id="match_coord_+3A_threshold">threshold</code></td>
<td>
<p>A list of 2 elements <code>lon</code> and <code>lat</code> specifying the
absolute distance threshold used for subsetting longitude and
latitude value for calculating distances. If <code>NULL</code>, no subsetting is
performed and the distances between the target location and all grid
points are calculated. This is useful set the <code>threshold</code> value to
exclude some points that are absolute too far away from the target
location. Default: <code>list(lon = 1.0, lat = 1.0)</code></p>
</td></tr>
<tr><td><code id="match_coord_+3A_max_num">max_num</code></td>
<td>
<p>The maximum number of grid points to be matched. Default is
<code>NULL</code>, which means no number limit and the total matched grid points
are determined by the <code>threshold</code> input.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>match_coord()</code> uses <a href="future.apply.html#topic+future_lapply">future.apply</a>
underneath. You can use your preferable future backend to
speed up data extraction in parallel. By default, <code>match_coord()</code> uses
<code>future::sequential</code> backend, which runs things in sequential.
</p>


<h3>Value</h3>

<p>An <code>epw_cmip6_coord</code> object, which is basically a list of 3 elements:
</p>

<ul>
<li> <p><code>epw</code>: An <a href="eplusr.html#topic+Epw">eplusr::Epw</a> object parsed from input <code>epw</code> argument
</p>
</li>
<li> <p><code>meta</code>: A list containing basic meta data of input EPW, including <code>city</code>,
<code>state_province</code>, <code>country</code>, <code>latitute</code> and <code>longitude</code>.
</p>
</li>
<li> <p><code>coord</code>: A <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> which is basically CMIP6 index
database with an appending new list column <code>coord</code> that contains
matched latitudes and longitudes in each NetCDF file. Each element
in <code>coord</code> is a <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> of 6 columns describing
the matched coordinates.
</p>

<ul>
<li> <p><code>index</code>: the indices of matched coordinates
</p>
</li>
<li> <p><code>ind_lon</code>, <code>ind_lat</code>: The value indices of longitude or latitude in the
NetCDF coordinate grids. These values are used to extract the
corresponding variable values
</p>
</li>
<li> <p><code>lon</code>, <code>lat</code>: the actual longitude or latitude in the NetCDF coordinate
grids
</p>
</li>
<li> <p><code>dist</code>: the distance in km between the coordinate values in NetCDF and
input EPW
</p>
</li></ul>

</li></ul>



<h3>Geographical distance calculation</h3>

<p><code>match_coord()</code> calculates the geographical distances based formulas of
spherical trigonometry:
</p>
<p style="text-align: center;"><code class="reqn">
\Delta{X}=\cos(\phi_2)\cos(\lambda_2) - \cos(\phi_1)\cos(\lambda_1)
</code>
</p>

<p style="text-align: center;"><code class="reqn">
\Delta{Y}=\cos(\phi_2)\sin(\lambda_2) - \cos(\phi_1)\sin(\lambda_1)
</code>
</p>

<p style="text-align: center;"><code class="reqn">
\Delta{Z}=\sin(\phi_2) - \sin(\phi_1)
</code>
</p>

<p style="text-align: center;"><code class="reqn">
C_h=\sqrt{(\Delta{X})^2 + (\Delta{Y})^2 + (\Delta{Z})^2}
</code>
</p>

<p>where <code class="reqn">phi</code> is the latitude and <code class="reqn">lambda</code> is the longitude.  This
formula treats the Earth as a sphere. The geographical distance between
points on the surface of a spherical Earth is <code class="reqn">D = RC_h</code>.
</p>
<p>For more details, please see this <a href="https://en.wikipedia.org/wiki/Geographical_distance#Tunnel_distance">Wikipedia</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# download an EPW from EnergyPlus website
epw &lt;- eplusr::download_weather("los angeles.*TMY3", dir = tempdir(),
    type = "EPW", ask = FALSE)

match_coord(epw, threshold = list(lon = 1.0, lat = 1.0))

## End(Not run)

</code></pre>

<hr>
<h2 id='morphing_epw'>Morphing EPW weather variables</h2><span id='topic+morphing_epw'></span>

<h3>Description</h3>

<p><code>morphing_epw()</code> takes an <code>epw_cmip6_data</code> object generated using
<code><a href="#topic+extract_data">extract_data()</a></code> and calculates future core EPW weather variables using
Morphing Method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>morphing_epw(
  data,
  years = NULL,
  labels = NULL,
  methods = NULL,
  warning = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="morphing_epw_+3A_data">data</code></td>
<td>
<p>An <code>epw_cmip6_data</code>object generated using <code><a href="#topic+extract_data">extract_data()</a></code></p>
</td></tr>
<tr><td><code id="morphing_epw_+3A_years">years</code></td>
<td>
<p>An integer vector indicating the target years to be considered.
If <code>NULL</code>, all years in input data will be considered. Default: <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="morphing_epw_+3A_labels">labels</code></td>
<td>
<p>A character or factor vector used for grouping input <code>years</code>.
Usually are the outputs of <code><a href="base.html#topic+cut">base::cut()</a></code>. <code>labels</code> should have the
same length as <code>years</code>. If given, climate data of <code>years</code> grouped by
<code>labels</code> will be averaged. Default: <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="morphing_epw_+3A_methods">methods</code></td>
<td>
<p>A named character giving the methods of morphing procedures of
each variables. Possible variable names are <code>tdb</code>, <code>rh</code>, <code>p</code>,
<code>hor_ir</code>, <code>glob_rad</code>, <code>wind</code>. Possible values are: <code>"stretch"</code>,
<code>"shift"</code> and <code>"combined"</code>. For example: <code>c(tdb = "stretch", rh = "shift")</code>. <code>"combined"</code> is only applicable to <code>tdb</code>. The default
morphing method for each variable is listed in the <em>Return</em> section.
If <code>NULL</code>, the default methods will be used. Default: <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="morphing_epw_+3A_warning">warning</code></td>
<td>
<p>If <code>TRUE</code>, warnings will be issued for cases with input data
less than a decade (10 years). This is because using data that only
covers a short period of time may not be able to capture the average
of future climate. Default: <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The EPW weather variables that get morphed are listed in details.
</p>


<h3>Value</h3>

<p>An <code>epw_cmip6_morphed</code> object, which is basically a list of 12 elements:</p>

<table>
<tr>
 <td style="text-align: right;">
   No. </td><td style="text-align: left;"> Element </td><td style="text-align: left;"> Type </td><td style="text-align: left;"> Morphing Method </td><td style="text-align: left;"> Description </td>
</tr>
<tr>
 <td style="text-align: right;">
   1 </td><td style="text-align: left;"> <code>epw</code> </td><td style="text-align: left;"> <a href="eplusr.html#topic+Epw">eplusr::Epw</a> </td><td style="text-align: left;"> N/A </td><td style="text-align: left;"> The original EPW file used for morphing </td>
</tr>
<tr>
 <td style="text-align: right;">
   2 </td><td style="text-align: left;"> <code>tdb</code> </td><td style="text-align: left;"> <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> </td><td style="text-align: left;"> Stretch </td><td style="text-align: left;"> Data of dry-bulb temperature after morphing </td>
</tr>
<tr>
 <td style="text-align: right;">
   3 </td><td style="text-align: left;"> <code>tdew</code> </td><td style="text-align: left;"> <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> </td><td style="text-align: left;"> Derived </td><td style="text-align: left;"> Data of dew-point temperature after morphing </td>
</tr>
<tr>
 <td style="text-align: right;">
   4 </td><td style="text-align: left;"> <code>rh</code> </td><td style="text-align: left;"> <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> </td><td style="text-align: left;"> Stretch </td><td style="text-align: left;"> Data of relative humidity after morphing </td>
</tr>
<tr>
 <td style="text-align: right;">
   5 </td><td style="text-align: left;"> <code>p</code> </td><td style="text-align: left;"> <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> </td><td style="text-align: left;"> Stretch </td><td style="text-align: left;"> Data of atmospheric pressure after morphing </td>
</tr>
<tr>
 <td style="text-align: right;">
   6 </td><td style="text-align: left;"> <code>hor_ir</code> </td><td style="text-align: left;"> <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> </td><td style="text-align: left;"> Stretch </td><td style="text-align: left;"> Data of horizontal infrared radiation from the sky after morphing </td>
</tr>
<tr>
 <td style="text-align: right;">
   7 </td><td style="text-align: left;"> <code>glob_rad</code> </td><td style="text-align: left;"> <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> </td><td style="text-align: left;"> Stretch </td><td style="text-align: left;"> Data of global horizontal radiation after morphing </td>
</tr>
<tr>
 <td style="text-align: right;">
   8 </td><td style="text-align: left;"> <code>norm_rad</code> </td><td style="text-align: left;"> <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> </td><td style="text-align: left;"> Derived </td><td style="text-align: left;"> Data of direct normal radiation after morphing </td>
</tr>
<tr>
 <td style="text-align: right;">
   9 </td><td style="text-align: left;"> <code>diff_rad</code> </td><td style="text-align: left;"> <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> </td><td style="text-align: left;"> Stretch </td><td style="text-align: left;"> Data of diffuse horizontal radiation after morphing </td>
</tr>
<tr>
 <td style="text-align: right;">
   10 </td><td style="text-align: left;"> <code>wind</code> </td><td style="text-align: left;"> <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> </td><td style="text-align: left;"> Stretch </td><td style="text-align: left;"> Data of wind speed after morphing </td>
</tr>
<tr>
 <td style="text-align: right;">
   11 </td><td style="text-align: left;"> <code>total_cover</code> </td><td style="text-align: left;"> <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> </td><td style="text-align: left;"> Derived </td><td style="text-align: left;"> Data of total sky cover after morphing </td>
</tr>
<tr>
 <td style="text-align: right;">
   12 </td><td style="text-align: left;"> <code>opaque_cover</code> </td><td style="text-align: left;"> <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> </td><td style="text-align: left;"> Derived </td><td style="text-align: left;"> Data of opaque sky cover after morphing </td>
</tr>
<tr>
 <td style="text-align: right;">
</td>
</tr>

</table>

<p>Each <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> listed above contains 19 columns below or an
empty <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> if the corresponding variables cannot be
found in the input <code>epw_cmip6_data</code> object.</p>

<table>
<tr>
 <td style="text-align: right;">
   No. </td><td style="text-align: left;"> Column </td><td style="text-align: left;"> Type </td><td style="text-align: left;"> Description </td>
</tr>
<tr>
 <td style="text-align: right;">
   1 </td><td style="text-align: left;"> <code>activity_drs</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Activity DRS (Data Reference Syntax) </td>
</tr>
<tr>
 <td style="text-align: right;">
   2 </td><td style="text-align: left;"> <code>institution_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Institution identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   3 </td><td style="text-align: left;"> <code>source_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Model identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   4 </td><td style="text-align: left;"> <code>experiment_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Root experiment identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   5 </td><td style="text-align: left;"> <code>member_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> A compound construction from <code>sub_experiment_id</code> and <code>variant_label</code> </td>
</tr>
<tr>
 <td style="text-align: right;">
   6 </td><td style="text-align: left;"> <code>table_id</code> </td><td style="text-align: left;"> Character </td><td style="text-align: left;"> Table identifier </td>
</tr>
<tr>
 <td style="text-align: right;">
   7 </td><td style="text-align: left;"> <code>lon</code> </td><td style="text-align: left;"> Double </td><td style="text-align: left;"> The <strong>averaged</strong> values of input longitude </td>
</tr>
<tr>
 <td style="text-align: right;">
   8 </td><td style="text-align: left;"> <code>lat</code> </td><td style="text-align: left;"> Double </td><td style="text-align: left;"> The <strong>averaged</strong> values of input latitude </td>
</tr>
<tr>
 <td style="text-align: right;">
   9 </td><td style="text-align: left;"> <code>dist</code> </td><td style="text-align: left;"> Double </td><td style="text-align: left;"> The <strong>averaged</strong> spherical distances in km between EPW location and grid coordinates </td>
</tr>
<tr>
 <td style="text-align: right;">
   10 </td><td style="text-align: left;"> <code>interval</code> </td><td style="text-align: left;"> Factor </td><td style="text-align: left;"> The label value used to average raw input data </td>
</tr>
<tr>
 <td style="text-align: right;">
   11 </td><td style="text-align: left;"> <code>datetime</code> </td><td style="text-align: left;"> POSIXct </td><td style="text-align: left;"> The datetime value with <strong>fake year</strong> generated by calling the <code>Epw$data()</code> method with the input EPW </td>
</tr>
<tr>
 <td style="text-align: right;">
   12 </td><td style="text-align: left;"> <code>year</code> </td><td style="text-align: left;"> Integer </td><td style="text-align: left;"> The <strong>original</strong> year of the raw EPW data </td>
</tr>
<tr>
 <td style="text-align: right;">
   13 </td><td style="text-align: left;"> <code>month</code> </td><td style="text-align: left;"> Integer </td><td style="text-align: left;"> The month value of the morphed data </td>
</tr>
<tr>
 <td style="text-align: right;">
   14 </td><td style="text-align: left;"> <code>day</code> </td><td style="text-align: left;"> Integer </td><td style="text-align: left;"> The day of the morphed data </td>
</tr>
<tr>
 <td style="text-align: right;">
   15 </td><td style="text-align: left;"> <code>hour</code> </td><td style="text-align: left;"> Integer </td><td style="text-align: left;"> The hour of the morphed data </td>
</tr>
<tr>
 <td style="text-align: right;">
   16 </td><td style="text-align: left;"> <code>minute</code> </td><td style="text-align: left;"> Integer </td><td style="text-align: left;"> The minute of the morphed data </td>
</tr>
<tr>
 <td style="text-align: right;">
   17 </td><td style="text-align: left;"> <strong>Variable Name</strong> </td><td style="text-align: left;"> Double </td><td style="text-align: left;"> The morphed data, where <code style="white-space: pre;">&#8288;Variable Name&#8288;</code> is the corresponding EPW weather variable name </td>
</tr>
<tr>
 <td style="text-align: right;">
   18 </td><td style="text-align: left;"> <code>delta</code> </td><td style="text-align: left;"> Double </td><td style="text-align: left;"> The shift factor. Will be <code>NA</code> for derived values </td>
</tr>
<tr>
 <td style="text-align: right;">
   19 </td><td style="text-align: left;"> <code>alpha</code> </td><td style="text-align: left;"> Double </td><td style="text-align: left;"> The stretch factor. Will be <code>NA</code> for derived values </td>
</tr>
<tr>
 <td style="text-align: right;">
</td>
</tr>

</table>



<h3>The Morphing procedure</h3>

<p>Here <em>Morphing</em> is an algorithm proposed by Belcher etc. 2005
used to morph the present-day observed weather files (here the EPWs)  to
produce future climate weather files. The EPW data is used as the
<em>'baseline climate'</em>.
</p>
<p>The first step before morphing is to calculate the monthly means of
climatological variables in the EPW file, denoted by <code class="reqn">&lt;x_0&gt;_m</code>.
The subscript '0' is to denote the present day weather record, and 'm' is to
denote the month.
</p>
<p>The morphing involves three generic operations, i.e. 1) a shift; 2) a linear
stretch (scaling factor); and 3) a shift and a stretch:
</p>
<p style="text-align: center;"><code class="reqn">
\textrm{Shift: } x = x_0 + \Delta x_m
</code>
</p>

<p style="text-align: center;"><code class="reqn">
\textrm{Stretch: }x = \alpha_m x_m
</code>
</p>

<p style="text-align: center;"><code class="reqn">
\textrm{Shift + Stretch: } x = x_0 + \Delta x_m + \alpha_m (x_0 - &lt;x_0&gt;_m)
</code>
</p>



<h4>Shift</h4>

<p>If using a shift, for each month, a shift <code class="reqn">\Delta x_m</code> is applied to
<code class="reqn">x_0</code>. <code class="reqn">\Delta x_m</code> is the absolute change in the monthly mean value
of the variable for the month <code class="reqn">m</code>,
i.e. <code class="reqn">\Delta x_m = &lt;x_0&gt;_m - &lt;x&gt;_m</code>. Here the monthly variance of the
variable is unchanged.
</p>



<h4>Stretch</h4>

<p>If using a stretch, for each month, a stretch <code class="reqn">\alpha _m</code> is applied to
<code class="reqn">x_0</code>, where <code class="reqn">\alpha _m</code> is the fractional change in the monthly-mean
value of a variable, i.e. <code class="reqn">\alpha _m = &lt;x&gt;_m / &lt;x_0&gt;_m</code>. In this case,
the variance will be multiplied by to <code class="reqn">\alpha^2_m</code>
</p>



<h4>Combined Shift and Stretch</h4>

<p>When using a combined shift and stretch factor, both the mean and the
variance will be switched off altogether.
</p>
<p>For more details about morphing, please see (Belcher etc. 2005)
</p>



<h3>References</h3>

<p>Belcher, S., Hacker, J., Powell, D., 2005. Constructing design weather data
for future climates. Building Services Engineering Research and Technology
26, 4961. https://doi.org/10.1191/0143624405bt112oa
</p>

<hr>
<h2 id='set_cmip6_index'>Set CMIP6 index</h2><span id='topic+set_cmip6_index'></span>

<h3>Description</h3>

<p><code>set_cmip6_index()</code> takes a <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> as input and set it as
current index.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_cmip6_index(index, save = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_cmip6_index_+3A_index">index</code></td>
<td>
<p>A <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> containing the same column names
and types as the output of <code><a href="#topic+init_cmip6_index">init_cmip6_index()</a></code>.</p>
</td></tr>
<tr><td><code id="set_cmip6_index_+3A_save">save</code></td>
<td>
<p>If <code>TRUE</code>, besides loaded index, the index file saved to data
directory will be also updated. Default: <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>set_cmip6_index()</code> is useful when <code><a href="#topic+init_cmip6_index">init_cmip6_index()</a></code> may give you too much
cases of which only some are of interest.
</p>


<h3>Value</h3>

<p>A <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code>.
</p>

<hr>
<h2 id='summary_database'>Summary CMIP6 model output file status</h2><span id='topic+summary_database'></span>

<h3>Description</h3>

<p><code>summary_database()</code> scans the directory specified and returns a
<code><a href="data.table.html#topic+data.table">data.table()</a></code> containing summary information about all the CMIP6
files available against the output file index loaded using
<code><a href="#topic+load_cmip6_index">load_cmip6_index()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>summary_database(
  dir,
  by = c("activity", "experiment", "variant", "frequency", "variable", "source",
    "resolution"),
  mult = c("skip", "latest"),
  append = FALSE,
  miss = c("keep", "overwrite"),
  recursive = FALSE,
  update = FALSE,
  warning = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary_database_+3A_dir">dir</code></td>
<td>
<p>A single string indicating the directory where CMIP6 model output
NetCDF files are stored.</p>
</td></tr>
<tr><td><code id="summary_database_+3A_by">by</code></td>
<td>
<p>The grouping column to summary the database status. Should be a
subset of:
</p>

<ul>
<li> <p><code>"experiment"</code>: root experiment identifiers
</p>
</li>
<li> <p><code>"source"</code>: model identifiers
</p>
</li>
<li> <p><code>"variable"</code>: variable identifiers
</p>
</li>
<li> <p><code>"activity"</code>: activity identifiers
</p>
</li>
<li> <p><code>"frequency"</code>: sampling frequency
</p>
</li>
<li> <p><code>"variant"</code>: variant label
</p>
</li>
<li> <p><code>"resolution"</code>: approximate horizontal resolution
</p>
</li></ul>
</td></tr>
<tr><td><code id="summary_database_+3A_mult">mult</code></td>
<td>
<p>Actions when multiple files match a same case in the CMIP6
index. If <code>"latest"</code>, the file with latest modification time
will be used. If <code>"skip"</code>, all matched files will be skip and this
case will be kept as unmatched. Default: <code>"skip"</code>.</p>
</td></tr>
<tr><td><code id="summary_database_+3A_append">append</code></td>
<td>
<p>If <code>TRUE</code>, status of CMIP6 files will only be updated if they
are not found in previous summary. This is useful if CMIP6 files are
stored in different directories. Default: <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="summary_database_+3A_miss">miss</code></td>
<td>
<p>Actions when matched files in the previous summary do not exist
when running current summary. Only applicable when <code>append</code> is set to
<code>TRUE</code>. If <code>"keep"</code>, the metadata for the missing output files will
be kept. If <code>"overwrite"</code>, existing metadata of those output will be
first removed from the output file index and overwritten based on the
newly matched files if possible. Default: <code>"keep"</code>.</p>
</td></tr>
<tr><td><code id="summary_database_+3A_recursive">recursive</code></td>
<td>
<p>If <code>TRUE</code>, scan recursively into directories. Default:
<code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="summary_database_+3A_update">update</code></td>
<td>
<p>If <code>TRUE</code>, the output file index will be updated based
on the matched NetCDF files in specified directory. If <code>FALSE</code>, only
current loaded index will be updated, but the actual index
database file saved in <code><a href="#topic+get_data_dir">get_data_dir()</a></code> will remain unchanged.
Default: <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="summary_database_+3A_warning">warning</code></td>
<td>
<p>If <code>TRUE</code>, warning messages will show when target files are
missing or multiple files match a same case. Default: <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The database here can be any directory that stores the NetCDF files for CMIP6
GCMs. It can be also be the same as <code>get_data_dir()</code> where epwshiftr stores
the output file index, if you want to save the output file index and output
files in the same place.
</p>
<p><code>summary_database()</code> uses the <code>tracking_id</code>, <code>datetime_start</code> and
<code>datetime_end</code> global attributes of each NetCDF file to match against the
output file index. So the names of NetCDF files do not necessarily follow the
CMIP6 file name encoding.
</p>
<p><code>summary_database()</code> will append 5 columns in the CMIP6 output file index:
</p>

<ul>
<li> <p><code>file_path</code>: the full path of matched NetCDF file for every case.
</p>
</li></ul>

<p><code>summary_database()</code> uses <a href="future.apply.html#topic+future_lapply">future.apply</a>
underneath to speed up the data processing if applicable. You can use your
preferable future backend to speed up data extraction in parallel. By default,
<code>summary_database()</code> uses <code>future::sequential</code> backend, which runs things in
sequential.
</p>


<h3>Value</h3>

<p>A <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> containing corresponding grouping
columns plus:</p>

<table>
<tr>
 <td style="text-align: left;">
   Column </td><td style="text-align: left;"> Type </td><td style="text-align: left;"> Description </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code>datetime_start</code> </td><td style="text-align: left;"> POSIXct </td><td style="text-align: left;"> Start date and time of simulation </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code>datetime_end</code> </td><td style="text-align: left;"> POSIXct </td><td style="text-align: left;"> End date and time of simulation </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code>file_num</code> </td><td style="text-align: left;"> Integer </td><td style="text-align: left;"> Total number of file per group </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code>file_size</code> </td><td style="text-align: left;"> Units (Mbytes) </td><td style="text-align: left;"> Approximate total size of file </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code>dl_num</code> </td><td style="text-align: left;"> Integer </td><td style="text-align: left;"> Total number of file downloaded </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code>dl_percent</code> </td><td style="text-align: left;"> Units (%) </td><td style="text-align: left;"> Total percentage of file downloaded </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code>dl_size</code> </td><td style="text-align: left;"> Units (Mbytes) </td><td style="text-align: left;"> Total size of file downloaded </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>Also 2 extra <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> are attached as <strong>attributes</strong>:
</p>

<ul>
<li> <p><code>not_found</code>: A <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> that contains metadata for those
CMIP6 outputs that are listed in current CMIP6 output file index but the
existing file paths are not valid now and cannot be found in current
database.
</p>
</li>
<li> <p><code>not_matched</code>: A <code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> that contains metadata for
those CMIP6 output files that are found in current database but not listed
in current CMIP6 output file index.
</p>
</li></ul>

<p>For the meaning of grouping columns, see <code><a href="#topic+init_cmip6_index">init_cmip6_index()</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
summary_database()

summary_database(by = "experiment")

## End(Not run)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
