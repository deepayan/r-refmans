<!DOCTYPE html><html lang="en"><head><title>Help for package hSDM</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {hSDM}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#hSDM-package'><p>hierarchical Bayesian species distribution models</p></a></li>
<li><a href='#altitude'><p>Virtual altitudinal data</p></a></li>
<li><a href='#cfr.env'><p>Environmental data for South Africa's Cap Floristic Region</p></a></li>
<li><a href='#data.Kery2010'><p>Count data for the Willow tit (from Kéry and Royle 2010)</p></a></li>
<li><a href='#datacells.Latimer2006'><p>Data of presence-absence (from Latimer et al. 2006)</p></a></li>
<li><a href='#frogs'>
<p>Counts of the number of frogs in a water body</p></a></li>
<li><a href='#hSDM.binomial'><p>Binomial logistic regression model</p></a></li>
<li><a href='#hSDM.binomial.iCAR'><p>Binomial logistic regression model with CAR process</p></a></li>
<li><a href='#hSDM.Nmixture'><p>N-mixture model</p></a></li>
<li><a href='#hSDM.Nmixture.iCAR'><p>N-mixture model with CAR process</p></a></li>
<li><a href='#hSDM.Nmixture.K'><p>N-mixture model with K, the maximal theoretical abundance</p></a></li>
<li><a href='#hSDM.poisson'><p>Poisson log regression model</p></a></li>
<li><a href='#hSDM.poisson.iCAR'><p>Poisson log regression model with CAR process</p></a></li>
<li><a href='#hSDM.siteocc'><p>Site occupancy model</p></a></li>
<li><a href='#hSDM.siteocc.iCAR'><p>Site-occupancy model with CAR process</p></a></li>
<li><a href='#hSDM.ZIB'><p>ZIB (Zero-Inflated Binomial) model</p></a></li>
<li><a href='#hSDM.ZIB.iCAR'><p>ZIB (Zero-Inflated Binomial) model with CAR process</p></a></li>
<li><a href='#hSDM.ZIB.iCAR.alteration'><p>ZIB (Zero-Inflated Binomial) model with CAR process taking into</p>
account site alteration</a></li>
<li><a href='#hSDM.ZIP'><p>ZIP (Zero-Inflated Poisson) model</p></a></li>
<li><a href='#hSDM.ZIP.iCAR'><p>ZIP (Zero-Inflated Poisson) model with CAR process</p></a></li>
<li><a href='#hSDM.ZIP.iCAR.alteration'><p>ZIP (Zero-Inflated Poisson) model with CAR process taking into</p>
account site alteration</a></li>
<li><a href='#logit'><p>Generalized logit and inverse logit function</p></a></li>
<li><a href='#neighbors.Latimer2006'><p>Neighborhood data (from Latimer et al. 2006)</p></a></li>
<li><a href='#predict.hSDM'><p>Predict method for models fitted with hSDM</p></a></li>
<li><a href='#punc10'><p>Occurrence data for <em>Protea punctata</em> Meisn. in the Cap</p>
Floristic Region</a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Hierarchical Bayesian Species Distribution Models</td>
</tr>
<tr>
<td>Version:</td>
<td>1.4.4</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-09-06</td>
</tr>
<tr>
<td>Imports:</td>
<td>coda</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>GNU GSL</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, raster, sp, rmarkdown, bookdown</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Ghislain Vieilledent &lt;ghislain.vieilledent@cirad.fr&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>User-friendly and fast set of functions for estimating parameters of hierarchical Bayesian species distribution models (Latimer and others 2006 &lt;<a href="https://doi.org/10.1890%2F04-0609">doi:10.1890/04-0609</a>&gt;). Such models allow interpreting the observations (occurrence and abundance of a species) as a result of several hierarchical processes including ecological processes (habitat suitability, spatial dependence and anthropogenic disturbance) and observation processes (species detectability). Hierarchical species distribution models are essential for accurately characterizing the environmental response of species, predicting their probability of occurrence, and assessing uncertainty in the model results.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://ecology.ghislainv.fr/hSDM/">https://ecology.ghislainv.fr/hSDM/</a>,
<a href="https://github.com/ghislainv/hSDM/">https://github.com/ghislainv/hSDM/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/ghislainv/hSDM/issues/">https://github.com/ghislainv/hSDM/issues/</a></td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-09-06 14:13:35 UTC; ghislain</td>
</tr>
<tr>
<td>Author:</td>
<td>Ghislain Vieilledent
    <a href="https://orcid.org/0000-0002-1685-4997"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut, cre],
  Matthieu Autier [ctb],
  Alan E. Gelfand [ctb],
  Jérôme Guélat [ctb],
  Marc Kéry [ctb],
  Andrew M. Latimer [ctb],
  Cory Merow [ctb],
  Frédéric Mortier [ctb],
  John A. Silander Jr. [ctb],
  Adam M. Wilson [ctb],
  Shanshan Wu [ctb],
  CIRAD [cph, fnd]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-09-06 15:20:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='hSDM-package'>hierarchical Bayesian species distribution models</h2><span id='topic+hSDM-package'></span><span id='topic+hSDM'></span>

<h3>Description</h3>

<p><code>hSDM</code> is an R package for estimating parameters of
hierarchical Bayesian species distribution models. Such models allow
interpreting the observations (occurrence and abundance of a species)
as a result of several hierarchical processes including ecological
processes (habitat suitability, spatial dependence and anthropogenic
disturbance) and observation processes (species
detectability). Hierarchical species distribution models are essential
for accurately characterizing the environmental response of species,
predicting their probability of occurrence, and assessing uncertainty
in the model results.</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
    Package: </td><td style="text-align: left;"> hSDM</td>
</tr>
<tr>
 <td style="text-align: left;">
    Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
    Version: </td><td style="text-align: left;"> 1.4.2</td>
</tr>
<tr>
 <td style="text-align: left;">
    Date: </td><td style="text-align: left;"> 2019-05-13</td>
</tr>
<tr>
 <td style="text-align: left;">
    License: </td><td style="text-align: left;"> GPL-3 </td>
</tr>
<tr>
 <td style="text-align: left;">
    LazyLoad: </td><td style="text-align: left;"> yes</td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>Author(s)</h3>


<table>
<tr>
 <td style="text-align: left;">
    Ghislain Vieilledent &lt;ghislain.vieilledent@cirad.fr&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
    Matthieu Autier &lt;matthieu.authier@univ-lr.fr&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
    Alan E. Gelfand &lt;alan@stat.duke.edu&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
    Jérôme Guélat &lt;jerome.guelat@vogelwarte.ch&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
    Marc Kéry &lt;marc.kery@vogelwarte.ch&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
    Andrew M. Latimer &lt;amlatimer@ucdavis.edu&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
    Cory Merow &lt;cory.merow@gmail.com&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
    Frédéric Mortier &lt;frederic.mortier@cirad.fr&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
    John A. Silander Jr. &lt;john.silander@uconn.edu&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
    Adam M. Wilson &lt;adamw@buffalo.edu&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
    Shanshan Wu &lt;wu_shanshan@hotmail.com&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>


<hr>
<h2 id='altitude'>Virtual altitudinal data</h2><span id='topic+altitude'></span>

<h3>Description</h3>

<p>Data frame with virtual altitudinal data. The data frame is
used in the examples of the hSDM package vignette to derive an
altitude raster determining species habitat suitability.</p>


<h3>Format</h3>

<p><code>altitude</code> is a data frame with 2500 observations (50 x 50 cells) and 3 variables:
</p>

<dl>
<dt><code>x</code></dt><dd><p>coordinates of the center of the cell on the x axis</p>
</dd>
<dt><code>y</code></dt><dd><p>coordinates of the center of the cell on the y axis</p>
</dd>
<dt><code>altitude</code></dt><dd><p>altitude (m)</p>
</dd>
</dl>


<hr>
<h2 id='cfr.env'>Environmental data for South Africa's Cap Floristic Region</h2><span id='topic+cfr.env'></span>

<h3>Description</h3>

<p>Data include environmental variables for 36909 one minute
by one minute grid cells on the whole South Africa's Cap Floristic
Region.</p>


<h3>Format</h3>

<p><code>cfr.env</code> is a data frame with 36909 observations (cells) on the
following six environmental variables.
</p>

<dl>
<dt><code>lon</code></dt><dd><p>longitude</p>
</dd>
<dt><code>lat</code></dt><dd><p>latitude</p>
</dd>
<dt><code>min07</code></dt><dd><p>minimum temperature of the coldest month (July)</p>
</dd>
<dt><code>smdwin</code></dt><dd><p>winter soil moisture days</p>
</dd>
<dt><code>fert3</code></dt><dd><p>moderately high fertility (percent of grid cell)</p>
</dd>
<dt><code>ph1</code></dt><dd><p>acidic soil (percent of grid cell)</p>
</dd>
<dt><code>text1</code></dt><dd><p>fine soil texture (percent of grid cell)</p>
</dd>
<dt><code>text2</code></dt><dd><p>moderately fine soil texture (percent of grid cell)</p>
</dd>
</dl>



<h3>Source</h3>

<p>Cory Merow's personal data</p>


<h3>References</h3>

<p>Latimer, A. M.; Wu, S. S.; Gelfand, A. E. and Silander, J. A. (2006)
Building statistical models to analyze species
distributions. <em>Ecological Applications</em>, 16, 33-50.
</p>

<hr>
<h2 id='data.Kery2010'>Count data for the Willow tit (from Kéry and Royle 2010)</h2><span id='topic+data.Kery2010'></span>

<h3>Description</h3>

<p>Repeated count data for the Willow tit (<em>Poecile
montanus</em>, a pesserine bird) in Switzerland on the period
1999-2003. Data come from the Swiss national breeding bird survey MHB
(Monitoring Haüfige Brutvögel).</p>


<h3>Format</h3>

<p><code>data.Kery2010</code> is a data frame with 264 observations (1 km^2 quadrats) and the
following 10 variables.
</p>

<dl>
<dt><code>coordx</code></dt><dd><p>quadrat x coordinate</p>
</dd>
<dt><code>coordy</code></dt><dd><p>quadrat y coordinate</p>
</dd>
<dt><code>elevation</code></dt><dd><p>mean quadrat elevation (m)</p>
</dd>
<dt><code>forest</code></dt><dd><p>quadrat forest cover (in %)</p>
</dd>
<dt><code>count1</code></dt><dd><p>count for survey 1</p>
</dd>
<dt><code>count2</code></dt><dd><p>count for survey 2</p>
</dd>
<dt><code>count3</code></dt><dd><p>count for survey 3</p>
</dd>
<dt><code>juldate1</code></dt><dd><p>Julian date of survey 1</p>
</dd>
<dt><code>juldate2</code></dt><dd><p>Julian date of survey 2</p>
</dd>
<dt><code>juldate3</code></dt><dd><p>Julian date of survey 3</p>
</dd>
</dl>



<h3>Source</h3>

<p>Kéry and Royle, 2010, <em>Journal of Animal Ecology</em>, 79, 453-461.</p>


<h3>References</h3>

<p>Kéry, M. and Andrew Royle, J. 2010. Hierarchical modelling and estimation of
abundance and population trends in metapopulation designs. <em>Journal of
Animal Ecology</em>, 79, 453-461.
</p>

<hr>
<h2 id='datacells.Latimer2006'>Data of presence-absence (from Latimer et al. 2006)</h2><span id='topic+datacells.Latimer2006'></span>

<h3>Description</h3>

<p>Data come from a small region including 476 one minute by
one minute grid cells. This region is a small corner of South
Africa's Cape Floristic Region, and includes very high plant species
diversity and a World Biosphere Reserve. The data frame can be used as an example
for several functions in the <code>hSDM</code> package.</p>


<h3>Format</h3>

<p><code>datacells.Latimer2006</code> is a data frame with 476 observations (cells) on the following 9 variables.
</p>

<dl>
<dt><code>y</code></dt><dd><p>the number of times the species was observed to be present in each cell</p>
</dd>
<dt><code>n</code></dt><dd><p>the number of visits or sample locations in each cell (which can be zero)</p>
</dd>
<dt><code>rough</code></dt><dd><p>elevational range or &quot;roughness&quot;</p>
</dd>
<dt><code>julmint</code></dt><dd><p>July minimum temperature</p>
</dd>
<dt><code>pptcv</code></dt><dd><p>interannual variation in precipitation</p>
</dd>
<dt><code>smdsum</code></dt><dd><p>summer soil moisture days</p>
</dd>
<dt><code>evi</code></dt><dd><p>enhanced vegetation or &quot;greenness&quot; index</p>
</dd>
<dt><code>ph1</code></dt><dd><p>percent acidic soil</p>
</dd>
<dt><code>num</code></dt><dd><p>number of neighbors of each cell, this is a sparse representation of the adjacency
matrix for the subregion.</p>
</dd>
</dl>



<h3>Source</h3>

<p>Latimer et al. (2006) <em>Ecological Applications</em>, Appendix B</p>


<h3>References</h3>

<p>Latimer, A. M.; Wu, S. S.; Gelfand, A. E. and Silander, J. A. (2006)
Building statistical models to analyze species
distributions. <em>Ecological Applications</em>, 16, 33-50.
</p>

<hr>
<h2 id='frogs'>
Counts of the number of frogs in a water body
</h2><span id='topic+frogs'></span>

<h3>Description</h3>

<p>Counts of the number of frogs in ponds of the Canton Aargau, Switzerland.
</p>


<h3>Format</h3>

<p>A data frame with 481 observations on the following 10 variables.
</p>

<dl>
<dt><code>count1</code></dt><dd><p>number of counted frogs during the first visit</p>
</dd>
<dt><code>count2</code></dt><dd><p>number of counted frogs uring the second visit</p>
</dd>
<dt><code>elevation</code></dt><dd><p>elevation, meters above sea level</p>
</dd>
<dt><code>year</code></dt><dd><p>year</p>
</dd>
<dt><code>fish</code></dt><dd><p>presence of fish (1 = present, 0 = absent)</p>
</dd>
<dt><code>waterarea</code></dt><dd><p>area of the water body in square meters</p>
</dd>
<dt><code>vegetation</code></dt><dd><p>indicator of vegetation (1 = vegetation present, 0 = no vegetation present)</p>
</dd>
<dt><code>pondid</code></dt><dd><p>name of the pond, corresponds to observation id</p>
</dd>
<dt><code>x</code></dt><dd><p>x coordinate</p>
</dd>
<dt><code>y</code></dt><dd><p>y coordinate</p>
</dd>
</dl>



<h3>Details</h3>

<p>The amphibian monitoring program started in 1999 and is mainly aimed
at surveying population trends of endangered amphibian species. Every
year, about 30 water bodies in two or three randomly selected priority
areas (out of ten priority areas of high amphibian diversity) are
surveyed. Additionally, a random selection of water bodies that
potentially are suitable for one of the endangered amphibian species
but that do not belong to the priority areas were surveyed. Each water
body is surveyed by single trained volunteer during two nocturnal
visits per year. Volunteers recorded anurans by walking along the
water's edge with precise rules for the duration of a survey taking
account of the size of the surveyed water body and noting visual
encounters and calls. As fare as possible, encountered individuals of
the Pelophylax-complex were identified as Marsh Frog (Pelophylax
ridibundus), Pool Frog (P. lessonaea) or hybrids (P. esculentus) based
on morphological characteristics or based on their calls. In the given
data set, however, these three taxa are lumped together.
</p>


<h3>Source</h3>

<p>The data is provided by Isabelle Floess, Landschaft und Gewaesser, Kanton Aargau.</p>


<h3>References</h3>

<p>Schmidt, B. R., 2005: Monitoring the distribution of pond-breeding
amphibians, when species are detected imperfectly. - Aquatic
conservation: marine and freshwater ecosystems 15: 681-692.
</p>
<p>Tanadini, L. G.; Schmidt, B. R., 2011: Population size influences
amphibian detection probability: implications for biodiversity
monitoring programs. - Plos One 6: e28244.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  data(frogs)
</code></pre>

<hr>
<h2 id='hSDM.binomial'>Binomial logistic regression model</h2><span id='topic+hSDM.binomial'></span>

<h3>Description</h3>

<p>The <code>hSDM.binomial</code> function performs a Binomial
logistic regression in a Bayesian framework. The function calls
a Gibbs sampler written in C code which uses an adaptive Metropolis
algorithm to estimate the conditional posterior distribution of
model's parameters.</p>


<h3>Usage</h3>

<pre><code class='language-R'>hSDM.binomial(presences, trials, suitability, data,
suitability.pred = NULL, burnin = 5000, mcmc = 10000, thin = 10,
beta.start, mubeta = 0, Vbeta = 1e+06, seed = 1234, verbose = 1, save.p
= 0)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hSDM.binomial_+3A_presences">presences</code></td>
<td>
<p>A vector indicating the number of successes (or
presences) for each observation.</p>
</td></tr>
<tr><td><code id="hSDM.binomial_+3A_trials">trials</code></td>
<td>
<p>A vector indicating the number of trials for each
observation. <code class="reqn">t_n</code> should be superior or equal to <code class="reqn">y_n</code>, the
number of successes for observation <code class="reqn">n</code>. If <code class="reqn">t_n=0</code>, then
<code class="reqn">y_n=0</code>.</p>
</td></tr>
<tr><td><code id="hSDM.binomial_+3A_suitability">suitability</code></td>
<td>
<p>A one-sided formula of the form '~x1+...+xp' with p
terms specifying the explicative variables for the suitability process
of the model.</p>
</td></tr>
<tr><td><code id="hSDM.binomial_+3A_data">data</code></td>
<td>
<p>A data frame containing the model's explicative
variables.</p>
</td></tr>
<tr><td><code id="hSDM.binomial_+3A_suitability.pred">suitability.pred</code></td>
<td>
<p>An optional data frame in which to look for
variables with which to predict. If NULL, the observations are
used.</p>
</td></tr>
<tr><td><code id="hSDM.binomial_+3A_burnin">burnin</code></td>
<td>
<p>The number of burnin iterations for the sampler.</p>
</td></tr>
<tr><td><code id="hSDM.binomial_+3A_mcmc">mcmc</code></td>
<td>
<p>The number of Gibbs iterations for the sampler. Total
number of Gibbs iterations is equal to
<code>burnin+mcmc</code>. <code>burnin+mcmc</code> must be divisible by 10 and
superior or equal to 100 so that the progress bar can be displayed.</p>
</td></tr>
<tr><td><code id="hSDM.binomial_+3A_thin">thin</code></td>
<td>
<p>The thinning interval used in the simulation. The number
of mcmc iterations must be divisible by this value.</p>
</td></tr> 
<tr><td><code id="hSDM.binomial_+3A_beta.start">beta.start</code></td>
<td>
<p>Starting values for beta parameters of the
suitability process. If <code>beta.start</code> takes a scalar value, then
that value will serve for all of the betas.</p>
</td></tr>
<tr><td><code id="hSDM.binomial_+3A_mubeta">mubeta</code></td>
<td>
<p>Means of the priors for the <code class="reqn">\beta</code> parameters
of the suitability process. <code>mubeta</code> must be either a scalar or a
p-length vector. If <code>mubeta</code> takes a scalar value, then that value will
serve as the prior mean for all of the betas. The default value is set
to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.binomial_+3A_vbeta">Vbeta</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\beta</code>
parameters of the suitability process. <code>Vbeta</code> must be either a
scalar or a p-length vector. If <code>Vbeta</code> takes a scalar value,
then that value will serve as the prior variance for all of the
betas. The default variance is large and set to 1.0E6 for an
uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.binomial_+3A_seed">seed</code></td>
<td>
<p>The seed for the random number generator. Default to 1234.</p>
</td></tr>
<tr><td><code id="hSDM.binomial_+3A_verbose">verbose</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
progress of the sampler is printed to the screen. Default is 1: a
progress bar is printed, indicating the step (in %) reached by the
Gibbs sampler.</p>
</td></tr>
<tr><td><code id="hSDM.binomial_+3A_save.p">save.p</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for predictions are saved. Default is 0: the
posterior mean is computed and returned in the <code>theta.pred</code>
vector. Be careful, setting <code>save.p</code> to 1 might require a large
amount of memory.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We model an ecological process where the presence or absence
of the species is explained by habitat suitability.
</p>
<p><b>Ecological process:</b>
</p>
<p style="text-align: center;"><code class="reqn">y_i \sim \mathcal{B}inomial(\theta_i,t_i)</code>
</p>

<p style="text-align: center;"><code class="reqn">logit(\theta_i) = X_i \beta</code>
</p>



<h3>Value</h3>

<table role = "presentation">
<tr><td><code>mcmc</code></td>
<td>
<p>An mcmc object that contains the posterior sample. This
object can be summarized by functions provided by the coda
package. The posterior sample of the deviance <code class="reqn">D</code>, with
<code class="reqn">D=-2\log(\prod_i P(y_i|\beta,t_i))</code>, is also provided.</p>
</td></tr>
<tr><td><code>theta.pred</code></td>
<td>
<p>If <code>save.p</code> is set to 0 (default),
<code>theta.pred</code> is the predictive posterior mean of the
probability associated to the suitability process for each
prediction. If <code>save.p</code> is set to 1, <code>theta.pred</code> is an
<code>mcmc</code> object with sampled values of the probability associated
to the suitability process for each prediction.</p>
</td></tr>
<tr><td><code>theta.latent</code></td>
<td>
<p>Predictive posterior mean of the probability
associated to the suitability process for each observation.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent <a href="mailto:ghislain.vieilledent@cirad.fr">ghislain.vieilledent@cirad.fr</a>
</p>


<h3>References</h3>

<p>Gelfand, A. E.; Schmidt, A. M.; Wu, S.; Silander, J. A.; Latimer, A. and
Rebelo, A. G. (2005) Modelling species diversity through species level
hierarchical modelling. <em>Applied Statistics</em>, 54, 1-20.
</p>
<p>Latimer, A. M.; Wu, S. S.; Gelfand, A. E. and Silander, J. A. (2006) Building
statistical models to analyze species distributions. <em>Ecological
Applications</em>, 16, 33-50.
</p>


<h3>See Also</h3>

<p><code><a href="coda.html#topic+plot.mcmc">plot.mcmc</a></code>, <code><a href="coda.html#topic+summary.mcmc">summary.mcmc</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 

#==============================================
# hSDM.binomial()
# Example with simulated data
#==============================================

#=================
#== Load libraries
library(hSDM)

#==================
#== Data simulation

#= Number of sites
nsite &lt;- 200

#= Set seed for repeatability
seed &lt;- 1234

#= Number of visits associated to each site
set.seed(seed)
visits&lt;- rpois(nsite,3)
visits[visits==0] &lt;- 1

#= Ecological process (suitability)
set.seed(seed)
x1 &lt;- rnorm(nsite,0,1)
set.seed(2*seed)
x2 &lt;- rnorm(nsite,0,1)
X &lt;- cbind(rep(1,nsite),x1,x2)
beta.target &lt;- c(-1,1,-1)
logit.theta &lt;- X %*% beta.target
theta &lt;- inv.logit(logit.theta)
set.seed(seed)
Y &lt;- rbinom(nsite,visits,theta)

#= Data-sets
data.obs &lt;- data.frame(Y,visits,x1,x2)

#==================================
#== Site-occupancy model

mod.hSDM.binomial &lt;- hSDM.binomial(presences=data.obs$Y,
                                   trials=data.obs$visits,
                                   suitability=~x1+x2,
                                   data=data.obs,
                                   suitability.pred=NULL,
                                   burnin=1000, mcmc=1000, thin=1,
                                   beta.start=0,
                                   mubeta=0, Vbeta=1.0E6,
                                   seed=1234, verbose=1,
                                   save.p=0)

#==========
#== Outputs

#= Parameter estimates
summary(mod.hSDM.binomial$mcmc)
pdf(file="Posteriors_hSDM.binomial.pdf")
plot(mod.hSDM.binomial$mcmc)
dev.off()

#== glm resolution to compare
mod.glm &lt;- glm(cbind(Y,visits-Y)~x1+x2,family="binomial",data=data.obs)
summary(mod.glm)

#= Predictions
summary(mod.hSDM.binomial$theta.latent)
summary(mod.hSDM.binomial$theta.pred)
pdf(file="Pred-Init.pdf")
plot(theta,mod.hSDM.binomial$theta.pred)
abline(a=0,b=1,col="red")
dev.off()


## End(Not run)

</code></pre>

<hr>
<h2 id='hSDM.binomial.iCAR'>Binomial logistic regression model with CAR process</h2><span id='topic+hSDM.binomial.iCAR'></span>

<h3>Description</h3>

<p>The <code>hSDM.binomial.iCAR</code> function performs a Binomial
logistic regression model in a hierarchical Bayesian framework. The
suitability process includes a spatial correlation process. The
spatial correlation is modelled using an intrinsic CAR model. The
<code>hSDM.binomial.iCAR</code> function calls a Gibbs sampler written in C
code which uses an adaptive Metropolis algorithm to estimate the
conditional posterior distribution of hierarchical model's
parameters.</p>


<h3>Usage</h3>

<pre><code class='language-R'>hSDM.binomial.iCAR(presences, trials, suitability,
spatial.entity, data, n.neighbors, neighbors, suitability.pred=NULL,
spatial.entity.pred=NULL, burnin = 5000, mcmc = 10000, thin = 10,
beta.start, Vrho.start, mubeta = 0, Vbeta = 1e+06, priorVrho =
"1/Gamma", shape = 0.5, rate = 0.0005, Vrho.max=1000, seed = 1234,
verbose = 1, save.rho = 0, save.p = 0)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hSDM.binomial.iCAR_+3A_presences">presences</code></td>
<td>
<p>A vector indicating the number of successes (or
presences) for each observation.</p>
</td></tr>
<tr><td><code id="hSDM.binomial.iCAR_+3A_trials">trials</code></td>
<td>
<p>A vector indicating the number of trials for each
observation. <code class="reqn">t_i</code> should be superior to zero and superior or
equal to <code class="reqn">y_i</code>, the number of successes for observation <code class="reqn">i</code>.</p>
</td></tr>
<tr><td><code id="hSDM.binomial.iCAR_+3A_suitability">suitability</code></td>
<td>
<p>A one-sided formula of the form
<code class="reqn">\sim x_1+...+x_p</code> with <code class="reqn">p</code> terms specifying the
explicative variables for the suitability process.</p>
</td></tr>
<tr><td><code id="hSDM.binomial.iCAR_+3A_spatial.entity">spatial.entity</code></td>
<td>
<p>A vector indicating the spatial entity
identifier (from one to the total number of entities) for each
observation. Several observations can occur in one spatial entity. A
spatial entity can be a raster cell for example.</p>
</td></tr>
<tr><td><code id="hSDM.binomial.iCAR_+3A_data">data</code></td>
<td>
<p>A data frame containing the model's variables.</p>
</td></tr>
<tr><td><code id="hSDM.binomial.iCAR_+3A_n.neighbors">n.neighbors</code></td>
<td>
<p>A vector of integers that indicates the number of
neighbors (adjacent entities) of each spatial
entity. <code>length(n.neighbors)</code> indicates the total number of
spatial entities.</p>
</td></tr>
<tr><td><code id="hSDM.binomial.iCAR_+3A_neighbors">neighbors</code></td>
<td>
<p>A vector of integers indicating the neighbors
(adjacent entities) of each spatial entity. Must be of the form
c(neighbors of entity 1, neighbors of entity 2, ... , neighbors of
the last entity). Length of the <code>neighbors</code> vector should be
equal to <code>sum(n.neighbors)</code>.</p>
</td></tr>
<tr><td><code id="hSDM.binomial.iCAR_+3A_suitability.pred">suitability.pred</code></td>
<td>
<p>An optional data frame in which to look for
variables with which to predict. If NULL, the observations are
used.</p>
</td></tr>
<tr><td><code id="hSDM.binomial.iCAR_+3A_spatial.entity.pred">spatial.entity.pred</code></td>
<td>
<p>An optional vector indicating the spatial
entity identifier (from one to the total number of entities) for
predictions. If NULL, the vector <code>spatial.entity</code> for
observations is used.</p>
</td></tr>
<tr><td><code id="hSDM.binomial.iCAR_+3A_burnin">burnin</code></td>
<td>
<p>The number of burnin iterations for the sampler.</p>
</td></tr>
<tr><td><code id="hSDM.binomial.iCAR_+3A_mcmc">mcmc</code></td>
<td>
<p>The number of Gibbs iterations for the sampler. Total
number of Gibbs iterations is equal to
<code>burnin+mcmc</code>. <code>burnin+mcmc</code> must be divisible by 10 and
superior or equal to 100 so that the progress bar can be displayed.</p>
</td></tr>
<tr><td><code id="hSDM.binomial.iCAR_+3A_thin">thin</code></td>
<td>
<p>The thinning interval used in the simulation. The number
of mcmc iterations must be divisible by this value.</p>
</td></tr>
<tr><td><code id="hSDM.binomial.iCAR_+3A_beta.start">beta.start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters of
the suitability process. This can either be a scalar or a
<code class="reqn">p</code>-length vector.</p>
</td></tr>
<tr><td><code id="hSDM.binomial.iCAR_+3A_vrho.start">Vrho.start</code></td>
<td>
<p>Positive scalar indicating the starting value for the
variance of the spatial random effects.</p>
</td></tr>
<tr><td><code id="hSDM.binomial.iCAR_+3A_mubeta">mubeta</code></td>
<td>
<p>Means of the priors for the <code class="reqn">\beta</code> parameters
of the suitability process. <code>mubeta</code> must be either a scalar or a
p-length vector. If <code>mubeta</code> takes a scalar value, then that value will
serve as the prior mean for all of the betas. The default value is set
to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.binomial.iCAR_+3A_vbeta">Vbeta</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\beta</code>
parameters of the suitability process. <code>Vbeta</code> must be either a
scalar or a p-length vector. If <code>Vbeta</code> takes a scalar value,
then that value will serve as the prior variance for all of the
betas. The default variance is large and set to 1.0E6 for an
uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.binomial.iCAR_+3A_priorvrho">priorVrho</code></td>
<td>
<p>Type of prior for the variance of the spatial random
effects. Can be set to a fixed positive scalar, or to an inverse-gamma
distribution (&quot;1/Gamma&quot;) with parameters <code>shape</code> and <code>rate</code>,
or to a uniform distribution (&quot;Uniform&quot;) on the interval
[0,<code>Vrho.max</code>]. Default set to &quot;1/Gamma&quot;.</p>
</td></tr>
<tr><td><code id="hSDM.binomial.iCAR_+3A_shape">shape</code></td>
<td>
<p>The shape parameter for the Gamma prior on the precision
of the spatial random effects. Default value is <code>shape=0.5</code> for
uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.binomial.iCAR_+3A_rate">rate</code></td>
<td>
<p>The rate (1/scale) parameter for the Gamma prior on the
precision of the spatial random effects. Default value is
<code>rate=0.0005</code> for uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.binomial.iCAR_+3A_vrho.max">Vrho.max</code></td>
<td>
<p>Upper bound for the uniform prior of the spatial
random effect variance. Default set to 1000.</p>
</td></tr>
<tr><td><code id="hSDM.binomial.iCAR_+3A_seed">seed</code></td>
<td>
<p>The seed for the random number generator. Default set to
1234.</p>
</td></tr>
<tr><td><code id="hSDM.binomial.iCAR_+3A_verbose">verbose</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
progress of the sampler is printed to the screen. Default is 1: a
progress bar is printed, indicating the step (in %) reached by the
Gibbs sampler.</p>
</td></tr>
<tr><td><code id="hSDM.binomial.iCAR_+3A_save.rho">save.rho</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for rhos are saved. Default is 0: the posterior mean
is computed and returned in the <code>rho.pred</code> vector. Be careful,
setting <code>save.rho</code> to 1 might require a large amount of
memory.</p>
</td></tr>
<tr><td><code id="hSDM.binomial.iCAR_+3A_save.p">save.p</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for predictions are saved. Default is 0: the
posterior mean is computed and returned in the <code>theta.pred</code>
vector. Be careful, setting <code>save.p</code> to 1 might require a large
amount of memory.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We model an ecological process where the presence or absence of the
species is explained by habitat suitability. The ecological process
includes an intrinsic conditional autoregressive (iCAR) model for
spatial autocorrelation between observations, assuming that the
probability of presence of the species at one site depends on the
probability of presence of the species on neighboring sites.
</p>
<p><b>Ecological process:</b>
</p>
<p style="text-align: center;"><code class="reqn">y_i \sim \mathcal{B}inomial(\theta_i,t_i)</code>
</p>

<p style="text-align: center;"><code class="reqn">logit(\theta_i) = X_i \beta + \rho_{j(i)}</code>
</p>

<p><code class="reqn">\rho_j</code>: spatial random effect
</p>
<p><code class="reqn">j(i)</code>: index of the spatial entity for observation <code class="reqn">i</code>.
</p>
<p><b>Spatial autocorrelation:</b>
</p>
<p>An intrinsic conditional autoregressive model (iCAR) is assumed:
</p>
<p style="text-align: center;"><code class="reqn">\rho_j \sim \mathcal{N}ormal(\mu_j,V_{\rho} / n_j)</code>
</p>

<p><code class="reqn">\mu_j</code>: mean of <code class="reqn">\rho_{j'}</code> in the
neighborhood of <code class="reqn">j</code>.
</p>
<p><code class="reqn">V_{\rho}</code>: variance of the spatial random effects.
</p>
<p><code class="reqn">n_j</code>: number of neighbors for spatial entity <code class="reqn">j</code>.
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>mcmc</code></td>
<td>
<p>An mcmc object that contains the posterior sample. This
object can be summarized by functions provided by the coda
package. The posterior sample of the deviance <code class="reqn">D</code>, with
<code class="reqn">D=-2\log(\prod_i P(y_i|...))</code>, is
also provided.</p>
</td></tr>
<tr><td><code>rho.pred</code></td>
<td>
<p>If <code>save.rho</code> is set to 0 (default),
<code>rho.pred</code> is the predictive posterior mean of the spatial
random effect associated to each spatial entity. If <code>save.rho</code> is
set to 1, <code>rho.pred</code> is an <code>mcmc</code> object with sampled
values for each spatial random effect associated to each spatial
entity.</p>
</td></tr>
<tr><td><code>theta.pred</code></td>
<td>
<p>If <code>save.p</code> is set to 0 (default),
<code>theta.pred</code> is the predictive posterior mean of the
probability associated to the suitability process for each
prediction. If <code>save.p</code> is set to 1, <code>theta.pred</code> is an
<code>mcmc</code> object with sampled values of the probability associated
to the suitability process for each prediction.</p>
</td></tr>
<tr><td><code>theta.latent</code></td>
<td>
<p>Predictive posterior mean of the probability
associated to the suitability process for each observation.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent <a href="mailto:ghislain.vieilledent@cirad.fr">ghislain.vieilledent@cirad.fr</a>
</p>


<h3>References</h3>

<p>Gelfand, A. E.; Schmidt, A. M.; Wu, S.; Silander, J. A.; Latimer, A. and
Rebelo, A. G. (2005) Modelling species diversity through species level
hierarchical modelling. <em>Applied Statistics</em>, 54, 1-20.
</p>
<p>Latimer, A. M.; Wu, S. S.; Gelfand, A. E. and Silander, J. A. (2006) Building
statistical models to analyze species distributions. <em>Ecological
Applications</em>, 16, 33-50.
</p>
<p>Lichstein, J. W.; Simons, T. R.; Shriner, S. A. &amp; Franzreb,
K. E. (2002) Spatial autocorrelation and autoregressive models in ecology
<em>Ecological Monographs</em>, 72, 445-463.
</p>
<p>Diez, J. M. &amp; Pulliam, H. R. (2007) Hierarchical analysis of species
distributions and abundance across environmental gradients
<em>Ecology</em>, 88, 3144-3152.
</p>


<h3>See Also</h3>

<p><code><a href="coda.html#topic+plot.mcmc">plot.mcmc</a></code>, <code><a href="coda.html#topic+summary.mcmc">summary.mcmc</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run:  

#==============================================
# hSDM.binomial.iCAR()
# Example with simulated data
#==============================================

#=================
#== Load libraries                          
library(hSDM)
library(raster)
library(sp)

#===================================
#== Multivariate normal distribution
rmvn &lt;- function(n, mu = 0, V = matrix(1), seed=1234) {
    p &lt;- length(mu)
    if (any(is.na(match(dim(V), p)))) {
        stop("Dimension problem!")
    }
    D &lt;- chol(V)
    set.seed(seed)
    t(matrix(rnorm(n*p),ncol=p)%*%D+rep(mu,rep(n,p)))
}

#==================
#== Data simulation

#= Set seed for repeatability
seed &lt;- 1234

#= Landscape
xLand &lt;- 30
yLand &lt;- 30 
Landscape &lt;- raster(ncol=xLand,nrow=yLand,crs='+proj=utm +zone=1')
Landscape[] &lt;- 0
extent(Landscape) &lt;- c(0,xLand,0,yLand)
coords &lt;- coordinates(Landscape)
ncells &lt;- ncell(Landscape)

#= Neighbors
neighbors.mat &lt;- adjacent(Landscape, cells=c(1:ncells), directions=8, pairs=TRUE, sorted=TRUE)
n.neighbors &lt;- as.data.frame(table(as.factor(neighbors.mat[,1])))[,2]
adj &lt;- neighbors.mat[,2]

#= Generate symmetric adjacency matrix, A
A &lt;- matrix(0,ncells,ncells)
index.start &lt;- 1
for (i in 1:ncells) {
    index.end &lt;- index.start+n.neighbors[i]-1
    A[i,adj[c(index.start:index.end)]] &lt;- 1
    index.start &lt;- index.end+1
}

#= Spatial effects
Vrho.target &lt;- 5
d &lt;- 1	# Spatial dependence parameter = 1 for intrinsic CAR
Q &lt;- diag(n.neighbors)-d*A + diag(.0001,ncells) # Add small constant to make Q non-singular
covrho &lt;- Vrho.target*solve(Q) # Covariance of rhos
set.seed(seed)
rho &lt;- c(rmvn(1,mu=rep(0,ncells),V=covrho,seed=seed)) # Spatial Random Effects
rho &lt;- rho-mean(rho) # Centering rhos on zero

#= Raster and plot spatial effects
r.rho &lt;- rasterFromXYZ(cbind(coords,rho))
plot(r.rho)

#= Sample the observation sites in the landscape
nsite &lt;- 250
set.seed(seed)
x.coord &lt;- runif(nsite,0,xLand)
set.seed(2*seed)
y.coord &lt;- runif(nsite,0,yLand)
sites.sp &lt;- SpatialPoints(coords=cbind(x.coord,y.coord))
cells &lt;- extract(Landscape,sites.sp,cell=TRUE)[,1]

#= Number of visits associated to each observation point
set.seed(seed)
visits &lt;- rpois(nsite,3)
visits[visits==0] &lt;- 1

#= Ecological process (suitability)
set.seed(seed)
x1 &lt;- rnorm(nsite,0,1)
set.seed(2*seed)
x2 &lt;- rnorm(nsite,0,1)
X &lt;- cbind(rep(1,nsite),x1,x2)
beta.target &lt;- c(-1,1,-1)
logit.theta &lt;- X %*% beta.target + rho[cells]
theta &lt;- inv.logit(logit.theta)
set.seed(seed)
Y &lt;- rbinom(nsite,visits,theta)

#= Relative importance of spatial random effects
RImp &lt;- mean(abs(rho[cells])/abs(X %*% beta.target))
RImp

#= Data-sets
data.obs &lt;- data.frame(Y,visits,x1,x2,cell=cells)

#==================================
#== Site-occupancy model

Start &lt;- Sys.time() # Start the clock
mod.hSDM.binomial.iCAR &lt;- hSDM.binomial.iCAR(presences=data.obs$Y,
                                               trials=data.obs$visits,
                                               suitability=~x1+x2,
                                               spatial.entity=data.obs$cell,
                                               data=data.obs,
                                               n.neighbors=n.neighbors,
                                               neighbors=adj,
                                               suitability.pred=NULL,
                                               spatial.entity.pred=NULL,
                                               burnin=5000, mcmc=5000, thin=5,
                                               beta.start=0,
                                               Vrho.start=1,
                                               mubeta=0, Vbeta=1.0E6,
                                               priorVrho="1/Gamma",
                                               shape=0.5, rate=0.0005,
                                               seed=1234, verbose=1,
                                               save.rho=1, save.p=0)
Time.hSDM &lt;- difftime(Sys.time(),Start,units="sec") # Time difference

#= Computation time
Time.hSDM

#==========
#== Outputs

#= Parameter estimates 
summary(mod.hSDM.binomial.iCAR$mcmc)
pdf("Posteriors_hSDM.binomial.iCAR.pdf")
plot(mod.hSDM.binomial.iCAR$mcmc)
dev.off()

#= Predictions
summary(mod.hSDM.binomial.iCAR$theta.latent)
summary(mod.hSDM.binomial.iCAR$theta.pred)
pdf(file="Pred-Init.pdf")
plot(theta,mod.hSDM.binomial.iCAR$theta.pred)
abline(a=0,b=1,col="red")
dev.off()

#= Summary plots for spatial random effects

# rho.pred
rho.pred &lt;- apply(mod.hSDM.binomial.iCAR$rho.pred,2,mean)
r.rho.pred &lt;- rasterFromXYZ(cbind(coords,rho.pred))

# plot
pdf(file="Summary_hSDM.binomial.iCAR.pdf")
par(mfrow=c(2,2))
# rho target
plot(r.rho, main="rho target")
plot(sites.sp,add=TRUE)
# rho estimated
plot(r.rho.pred, main="rho estimated")
# correlation and "shrinkage"
Levels.cells &lt;- sort(unique(cells))
plot(rho[-Levels.cells],rho.pred[-Levels.cells],
     xlim=range(rho),
     ylim=range(rho),
     xlab="rho target",
     ylab="rho estimated")
points(rho[Levels.cells],rho.pred[Levels.cells],pch=16,col="blue")
legend(x=-3,y=4,legend="Visited cells",col="blue",pch=16,bty="n")
abline(a=0,b=1,col="red")
dev.off()


## End(Not run)

</code></pre>

<hr>
<h2 id='hSDM.Nmixture'>N-mixture model</h2><span id='topic+hSDM.Nmixture'></span>

<h3>Description</h3>

<p>The <code>hSDM.Nmixture</code> function can be used to model
species distribution including different processes in a hierarchical
Bayesian framework: a <code class="reqn">\mathcal{P}oisson</code> suitability
process (refering to environmental suitability explaining abundance)
and a <code class="reqn">\mathcal{B}inomial</code> observability process
(refering to various ecological and methodological issues explaining
species detection). The <code>hSDM.Nmixture</code> function calls a Gibbs
sampler written in C code which uses an adaptive Metropolis algorithm
to estimate the conditional posterior distribution of hierarchical
model's parameters.</p>


<h3>Usage</h3>

<pre><code class='language-R'>hSDM.Nmixture(# Observations
                     counts, observability, site, data.observability,
                     # Habitat
                     suitability, data.suitability,
                     # Predictions
                     suitability.pred = NULL,
                     # Chains
                     burnin = 5000, mcmc = 10000, thin = 10,
                     # Starting values
                     beta.start,
                     gamma.start,
                     # Priors
                     mubeta = 0, Vbeta = 1.0E6,
                     mugamma = 0, Vgamma = 1.0E6,
                     # Various
                     seed = 1234, verbose = 1,
                     save.p = 0, save.N = 0)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hSDM.Nmixture_+3A_counts">counts</code></td>
<td>
<p>A vector indicating the count (or abundance) for each
observation.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture_+3A_observability">observability</code></td>
<td>
<p>A one-sided formula of the form
<code class="reqn">\sim w_1+...+w_q</code> with <code class="reqn">q</code> terms specifying the
explicative variables for the observability process.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture_+3A_site">site</code></td>
<td>
<p>A vector indicating the site identifier (from one to the
total number of sites) for each observation. Several observations
can occur at one site. A site can be a raster cell for example.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture_+3A_data.observability">data.observability</code></td>
<td>
<p>A data frame containing the model's
variables for the observability process.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture_+3A_suitability">suitability</code></td>
<td>
<p>A one-sided formula of the form
<code class="reqn">\sim x_1+...+x_p</code> with <code class="reqn">p</code> terms specifying the
explicative variables for the suitability process.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture_+3A_data.suitability">data.suitability</code></td>
<td>
<p>A data frame containing the model's
variables for the suitability process.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture_+3A_suitability.pred">suitability.pred</code></td>
<td>
<p>An optional data frame in which to look for
variables with which to predict. If NULL, the observations are
used.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture_+3A_burnin">burnin</code></td>
<td>
<p>The number of burnin iterations for the sampler.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture_+3A_mcmc">mcmc</code></td>
<td>
<p>The number of Gibbs iterations for the sampler. Total
number of Gibbs iterations is equal to
<code>burnin+mcmc</code>. <code>burnin+mcmc</code> must be divisible by 10 and
superior or equal to 100 so that the progress bar can be displayed.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture_+3A_thin">thin</code></td>
<td>
<p>The thinning interval used in the simulation. The number
of mcmc iterations must be divisible by this value.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture_+3A_beta.start">beta.start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters of
the suitability process. This can either be a scalar or a
<code class="reqn">p</code>-length vector.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture_+3A_gamma.start">gamma.start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters
of the observability process. This can either be a scalar or a
<code class="reqn">q</code>-length vector.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture_+3A_mubeta">mubeta</code></td>
<td>
<p>Means of the priors for the <code class="reqn">\beta</code> parameters
of the suitability process. <code>mubeta</code> must be either a scalar or a
p-length vector. If <code>mubeta</code> takes a scalar value, then that value will
serve as the prior mean for all of the betas. The default value is set
to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture_+3A_vbeta">Vbeta</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\beta</code>
parameters of the suitability process. <code>Vbeta</code> must be either a
scalar or a p-length vector. If <code>Vbeta</code> takes a scalar value,
then that value will serve as the prior variance for all of the
betas. The default variance is large and set to 1.0E6 for an
uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture_+3A_mugamma">mugamma</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\gamma</code>
parameters of the observability process. <code>mugamma</code> must be either
a scalar or a p-length vector. If <code>mugamma</code> takes a scalar value,
then that value will serve as the prior mean for all of the
gammas. The default value is set to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture_+3A_vgamma">Vgamma</code></td>
<td>
<p>Variances of the Normal priors for the
<code class="reqn">\gamma</code> parameters of the observability
process. <code>Vgamma</code> must be either a scalar or a p-length
vector. If <code>Vgamma</code> takes a scalar value, then that value will
serve as the prior variance for all of the gammas. The default
variance is large and set to 1.0E6 for an uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture_+3A_seed">seed</code></td>
<td>
<p>The seed for the random number generator. Default set to
1234.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture_+3A_verbose">verbose</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
progress of the sampler is printed to the screen. Default is 1: a
progress bar is printed, indicating the step (in %) reached by the
Gibbs sampler.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture_+3A_save.p">save.p</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for predictions are saved. Default is 0: the
posterior mean is computed and returned in the <code>lambda.pred</code>
vector. Be careful, setting <code>save.p</code> to 1 might require a large
amount of memory.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture_+3A_save.n">save.N</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for the latent count variable N for each observed
cells are saved. Default is 0: the mean (rounded to the closest
integer) is computed and returned in the <code>N.pred</code> vector. Be
careful, setting <code>save.N</code> to 1 might require a large amount of
memory.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The model integrates two processes, an ecological process associated
to the abundance of the species due to habitat suitability and an
observation process that takes into account the fact that the
probability of detection of the species is inferior to one.
</p>
<p><b>Ecological process:</b>
</p>
<p style="text-align: center;"><code class="reqn">N_i \sim \mathcal{P}oisson(\lambda_i)</code>
</p>

<p style="text-align: center;"><code class="reqn">log(\lambda_i) = X_i \beta</code>
</p>

<p><b>Observation process:</b>
</p>
<p style="text-align: center;"><code class="reqn">y_{it} \sim \mathcal{B}inomial(N_i, \delta_{it})</code>
</p>

<p style="text-align: center;"><code class="reqn">logit(\delta_{it}) = W_{it} \gamma</code>
</p>
 


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>mcmc</code></td>
<td>
<p>An mcmc object that contains the posterior sample. This
object can be summarized by functions provided by the coda
package. The posterior sample of the deviance <code class="reqn">D</code>, with
<code class="reqn">D=-2\log(\prod_{it} P(y_{it},N_i|...))</code>, is also
provided.</p>
</td></tr>
<tr><td><code>lambda.pred</code></td>
<td>
<p>If <code>save.p</code> is set to 0 (default),
<code>lambda.pred</code> is the predictive posterior mean of the abundance
associated to the suitability process for each prediction. If
<code>save.p</code> is set to 1, <code>lambda.pred</code> is an <code>mcmc</code>
object with sampled values of the abundance associated to the
suitability process for each prediction.</p>
</td></tr>
<tr><td><code>N.pred</code></td>
<td>
<p>If <code>save.N</code> is set to 0 (default), <code>N.pred</code> is
the posterior mean (rounded to the closest integer) of the latent
count variable N for each observed cell. If <code>save.N</code> is set to
1, <code>N.pred</code> is an <code>mcmc</code> object with sampled values of the
latent count variable N for each observed cell.</p>
</td></tr>
<tr><td><code>lambda.latent</code></td>
<td>
<p>Predictive posterior mean of the abundance
associated to the suitability process for each observation.</p>
</td></tr>
<tr><td><code>delta.latent</code></td>
<td>
<p>Predictive posterior mean of the probability
associated to the observability process for each observation.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent <a href="mailto:ghislain.vieilledent@cirad.fr">ghislain.vieilledent@cirad.fr</a>
</p>


<h3>References</h3>

<p>Gelfand, A. E.; Schmidt, A. M.; Wu, S.; Silander, J. A.; Latimer, A. and
Rebelo, A. G. (2005) Modelling species diversity through species level
hierarchical modelling. <em>Applied Statistics</em>, 54, 1-20.
</p>
<p>Latimer, A. M.; Wu, S. S.; Gelfand, A. E. and Silander, J. A. (2006) Building
statistical models to analyze species distributions. <em>Ecological
Applications</em>, 16, 33-50.
</p>
<p>Royle, J. A. (2004) N-mixture models for estimating population size from
spatially replicated counts. <em>Biometrics</em>, 60, 108-115.
</p>


<h3>See Also</h3>

<p><code><a href="coda.html#topic+plot.mcmc">plot.mcmc</a></code>, <code><a href="coda.html#topic+summary.mcmc">summary.mcmc</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 

#==============================================
# hSDM.Nmixture()
# Example with simulated data
#==============================================

#=================
#== Load libraries
library(hSDM)

#==================
#== Data simulation

# Number of observation sites
nsite &lt;- 200

#= Set seed for repeatability
seed &lt;- 4321

#= Ecological process (suitability)
set.seed(seed)
x1 &lt;- rnorm(nsite,0,1)
set.seed(2*seed)
x2 &lt;- rnorm(nsite,0,1)
X &lt;- cbind(rep(1,nsite),x1,x2)
beta.target &lt;- c(-1,1,-1) # Target parameters
log.lambda &lt;- X %*% beta.target
lambda &lt;- exp(log.lambda)
set.seed(seed)
N &lt;- rpois(nsite,lambda)

#= Number of visits associated to each observation point
set.seed(seed)
visits &lt;- rpois(nsite,3)
visits[visits==0] &lt;- 1
# Vector of observation points
sites &lt;- vector()
for (i in 1:nsite) {
    sites &lt;- c(sites,rep(i,visits[i]))
}

#= Observation process (detectability)
nobs &lt;- sum(visits)
set.seed(seed)
w1 &lt;- rnorm(nobs,0,1)
set.seed(2*seed)
w2 &lt;- rnorm(nobs,0,1)
W &lt;- cbind(rep(1,nobs),w1,w2)
gamma.target &lt;- c(-1,1,-1) # Target parameters
logit.delta &lt;- W %*% gamma.target
delta &lt;- inv.logit(logit.delta)
set.seed(seed)
Y &lt;- rbinom(nobs,N[sites],delta)

#= Data-sets
data.obs &lt;- data.frame(Y,w1,w2,site=sites)
data.suit &lt;- data.frame(x1,x2)

#================================
#== Parameter inference with hSDM

Start &lt;- Sys.time() # Start the clock
mod.hSDM.Nmixture &lt;- hSDM.Nmixture(# Observations
                           counts=data.obs$Y,
                           observability=~w1+w2,
                           site=data.obs$site,
                           data.observability=data.obs,
                           # Habitat
                           suitability=~x1+x2,
                           data.suitability=data.suit,
                           # Predictions
                           suitability.pred=NULL,
                           # Chains
                           burnin=5000, mcmc=5000, thin=5,
                           # Starting values
                           beta.start=0,
                           gamma.start=0,
                           # Priors
                           mubeta=0, Vbeta=1.0E6,
                           mugamma=0, Vgamma=1.0E6,
                           # Various
                           seed=1234, verbose=1,
                           save.p=0, save.N=1)
Time.hSDM &lt;- difftime(Sys.time(),Start,units="sec") # Time difference

#= Computation time
Time.hSDM

#==========
#== Outputs

#= Parameter estimates
summary(mod.hSDM.Nmixture$mcmc)
pdf(file="Posteriors_hSDM.Nmixture.pdf")
plot(mod.hSDM.Nmixture$mcmc)
dev.off()

#= Predictions
summary(mod.hSDM.Nmixture$lambda.latent)
summary(mod.hSDM.Nmixture$delta.latent)
summary(mod.hSDM.Nmixture$lambda.pred)
pdf(file="Pred-Init.pdf")
plot(lambda,mod.hSDM.Nmixture$lambda.pred)
abline(a=0,b=1,col="red")
dev.off()

#= MCMC for latent variable N
pdf(file="MCMC_N.pdf")
plot(mod.hSDM.Nmixture$N.pred)
dev.off()

#= Check that Ns are correctly estimated
M &lt;- as.matrix(mod.hSDM.Nmixture$N.pred)
N.est &lt;- apply(M,2,mean)
Y.by.site &lt;- tapply(data.obs$Y,data.obs$site,mean) # Mean by site
pdf(file="Check_N.pdf",width=10,height=5)
par(mfrow=c(1,2))
plot(Y.by.site, N.est) ## More individuals are expected (N &gt; Y) due to detection process
abline(a=0,b=1,col="red")
plot(N, N.est) ## N are well estimated
abline(a=0,b=1,col="red")
cor(N, N.est) ## Very close to 1
dev.off()


## End(Not run)

</code></pre>

<hr>
<h2 id='hSDM.Nmixture.iCAR'>N-mixture model with CAR process</h2><span id='topic+hSDM.Nmixture.iCAR'></span>

<h3>Description</h3>

<p>The <code>hSDM.Nmixture.iCAR</code> function can be used to model
species distribution including different processes in a hierarchical
Bayesian framework: a <code class="reqn">\mathcal{P}oisson</code> suitability
process (refering to environmental suitability explaining abundance)
which takes into account the spatial dependence of the observations,
and a <code class="reqn">\mathcal{B}inomial</code> observability process
(refering to various ecological and methodological issues explaining
the species detection). The <code>hSDM.Nmixture.iCAR</code> function calls a
Gibbs sampler written in C code which uses an adaptive Metropolis
algorithm to estimate the conditional posterior distribution of
hierarchical model's parameters.</p>


<h3>Usage</h3>

<pre><code class='language-R'>hSDM.Nmixture.iCAR(# Observations
                     counts, observability, site, data.observability,
                     # Habitat
                     suitability, data.suitability,
                     # Spatial structure
                     spatial.entity,
                     n.neighbors, neighbors,
                     # Predictions
                     suitability.pred = NULL, spatial.entity.pred = NULL,
                     # Chains
                     burnin = 5000, mcmc = 10000, thin = 10,
                     # Starting values
                     beta.start,
                     gamma.start,
                     Vrho.start,
                     # Priors
                     mubeta = 0, Vbeta = 1.0E6,
                     mugamma = 0, Vgamma = 1.0E6,
                     priorVrho = "1/Gamma",
                     shape = 0.5, rate = 0.0005,
                     Vrho.max = 1000,
                     # Various
                     seed = 1234, verbose = 1,
                     save.rho = 0, save.p = 0, save.N = 0)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_counts">counts</code></td>
<td>
<p>A vector indicating the count (or abundance) for each
observation.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_observability">observability</code></td>
<td>
<p>A one-sided formula of the form
<code class="reqn">\sim w_1+...+w_q</code> with <code class="reqn">q</code> terms specifying the
explicative variables for the observability process.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_site">site</code></td>
<td>
<p>A vector indicating the site identifier (from one to the
total number of sites) for each observation. Several observations
can occur at one site. A site can be a raster cell for example.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_data.observability">data.observability</code></td>
<td>
<p>A data frame containing the model's
variables for the observability process.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_suitability">suitability</code></td>
<td>
<p>A one-sided formula of the form
<code class="reqn">\sim x_1+...+x_p</code> with <code class="reqn">p</code> terms specifying the
explicative variables for the suitability process.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_data.suitability">data.suitability</code></td>
<td>
<p>A data frame containing the model's variables
for the suitability process. The number of rows of the data frame
should be equal to the total number of spatial entities.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_spatial.entity">spatial.entity</code></td>
<td>
<p>A vector (of length 'nsite') indicating the
spatial entity identifier for each site. Values must be between 1
and the total number of spatial entities. Several sites can be found
in one spatial entity. A spatial entity can be a raster cell for
example.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_n.neighbors">n.neighbors</code></td>
<td>
<p>A vector of integers that indicates the number of
neighbors (adjacent entities) of each spatial
entity. <code>length(n.neighbors)</code> indicates the total number of
spatial entities.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_neighbors">neighbors</code></td>
<td>
<p>A vector of integers indicating the neighbors
(adjacent entities) of each spatial entity. Must be of the form
c(neighbors of entity 1, neighbors of entity 2, ... , neighbors of
the last entity). Length of the <code>neighbors</code> vector should be
equal to <code>sum(n.neighbors)</code>.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_suitability.pred">suitability.pred</code></td>
<td>
<p>An optional data frame in which to look for
variables with which to predict. If NULL, the data frame
<code>data.suitability</code> for observations is used.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_spatial.entity.pred">spatial.entity.pred</code></td>
<td>
<p>An optional vector indicating the spatial
entity identifier (from one to the total number of entities) for
predictions. If NULL, the vector <code>spatial.entity</code> for
observations is used.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_burnin">burnin</code></td>
<td>
<p>The number of burnin iterations for the sampler.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_mcmc">mcmc</code></td>
<td>
<p>The number of Gibbs iterations for the sampler. Total
number of Gibbs iterations is equal to
<code>burnin+mcmc</code>. <code>burnin+mcmc</code> must be divisible by 10 and
superior or equal to 100 so that the progress bar can be displayed.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_thin">thin</code></td>
<td>
<p>The thinning interval used in the simulation. The number
of mcmc iterations must be divisible by this value.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_beta.start">beta.start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters of
the suitability process. This can either be a scalar or a
<code class="reqn">p</code>-length vector.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_gamma.start">gamma.start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters
of the observability process. This can either be a scalar or a
<code class="reqn">q</code>-length vector.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_vrho.start">Vrho.start</code></td>
<td>
<p>Positive scalar indicating the starting value for the
variance of the spatial random effects.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_mubeta">mubeta</code></td>
<td>
<p>Means of the priors for the <code class="reqn">\beta</code> parameters
of the suitability process. <code>mubeta</code> must be either a scalar or a
p-length vector. If <code>mubeta</code> takes a scalar value, then that value will
serve as the prior mean for all of the betas. The default value is set
to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_vbeta">Vbeta</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\beta</code>
parameters of the suitability process. <code>Vbeta</code> must be either a
scalar or a p-length vector. If <code>Vbeta</code> takes a scalar value,
then that value will serve as the prior variance for all of the
betas. The default variance is large and set to 1.0E6 for an
uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_mugamma">mugamma</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\gamma</code>
parameters of the observability process. <code>mugamma</code> must be either
a scalar or a p-length vector. If <code>mugamma</code> takes a scalar value,
then that value will serve as the prior mean for all of the
gammas. The default value is set to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_vgamma">Vgamma</code></td>
<td>
<p>Variances of the Normal priors for the
<code class="reqn">\gamma</code> parameters of the observability
process. <code>Vgamma</code> must be either a scalar or a p-length
vector. If <code>Vgamma</code> takes a scalar value, then that value will
serve as the prior variance for all of the gammas. The default
variance is large and set to 1.0E6 for an uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_priorvrho">priorVrho</code></td>
<td>
<p>Type of prior for the variance of the spatial random
effects. Can be set to a fixed positive scalar, or to an inverse-gamma
distribution (&quot;1/Gamma&quot;) with parameters <code>shape</code> and <code>rate</code>,
or to a uniform distribution (&quot;Uniform&quot;) on the interval
[0,<code>Vrho.max</code>]. Default set to &quot;1/Gamma&quot;.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_shape">shape</code></td>
<td>
<p>The shape parameter for the Gamma prior on the precision
of the spatial random effects. Default value is <code>shape=0.05</code> for
uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_rate">rate</code></td>
<td>
<p>The rate (1/scale) parameter for the Gamma prior on the
precision of the spatial random effects. Default value is
<code>rate=0.0005</code> for uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_vrho.max">Vrho.max</code></td>
<td>
<p>Upper bound for the uniform prior of the spatial
random effect variance. Default set to 1000.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_seed">seed</code></td>
<td>
<p>The seed for the random number generator. Default set to
1234.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_verbose">verbose</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
progress of the sampler is printed to the screen. Default is 1: a
progress bar is printed, indicating the step (in %) reached by the
Gibbs sampler.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_save.rho">save.rho</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for rhos are saved. Default is 0: the posterior mean
is computed and returned in the <code>rho.pred</code> vector. Be careful,
setting <code>save.rho</code> to 1 might require a large amount of
memory.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_save.p">save.p</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for predictions are saved. Default is 0: the
posterior mean is computed and returned in the <code>lambda.pred</code>
vector. Be careful, setting <code>save.p</code> to 1 might require a large
amount of memory.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.iCAR_+3A_save.n">save.N</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for the latent count variable N for each observed
cells are saved. Default is 0: the mean (rounded to the closest
integer) is computed and returned in the <code>N.pred</code> vector. Be
careful, setting <code>save.N</code> to 1 might require a large amount of
memory.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The model integrates two processes, an ecological process associated
to the abundance of the species due to habitat suitability and an
observation process that takes into account the fact that the
probability of detection of the species is inferior to one. The
ecological process includes an intrinsic conditional autoregressive
model (iCAR) model for spatial autocorrelation between observations,
assuming that the abundance of the species at one site depends on the
abundance of the species on neighboring sites.
</p>
<p><b>Ecological process:</b>
</p>
<p style="text-align: center;"><code class="reqn">N_i \sim \mathcal{P}oisson(\lambda_i)</code>
</p>

<p style="text-align: center;"><code class="reqn">log(\lambda_i) = X_i \beta + \rho_i</code>
</p>

<p><code class="reqn">\rho_i</code>: spatial random effect
</p>
<p><b>Spatial autocorrelation:</b>
</p>
<p>An intrinsic conditional autoregressive model (iCAR) is assumed:
</p>
<p style="text-align: center;"><code class="reqn">\rho_i \sim \mathcal{N}ormal(\mu_i,V_{\rho} / n_i)</code>
</p>

<p><code class="reqn">\mu_i</code>: mean of <code class="reqn">\rho_{i'}</code> in the
neighborhood of <code class="reqn">i</code>.
</p>
<p><code class="reqn">V_{\rho}</code>: variance of the spatial random effects.
</p>
<p><code class="reqn">n_i</code>: number of neighbors for spatial entity <code class="reqn">i</code>.
</p>
<p><b>Observation process:</b>
</p>
<p style="text-align: center;"><code class="reqn">y_{it} \sim \mathcal{B}inomial(N_i, \delta_{it})</code>
</p>

<p style="text-align: center;"><code class="reqn">logit(\delta_{it}) = W_{it} \gamma</code>
</p>
 


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>mcmc</code></td>
<td>
<p>An mcmc object that contains the posterior sample. This
object can be summarized by functions provided by the coda
package. The posterior sample of the deviance <code class="reqn">D</code>, with
<code class="reqn">D=-2\log(\prod_{it} P(y_{it},N_i|...))</code>, is also
provided.</p>
</td></tr>
<tr><td><code>rho.pred</code></td>
<td>
<p>If <code>save.rho</code> is set to 0 (default),
<code>rho.pred</code> is the predictive posterior mean of the spatial
random effect associated to each spatial entity. If <code>save.rho</code> is
set to 1, <code>rho.pred</code> is an <code>mcmc</code> object with sampled
values for each spatial random effect associated to each spatial
entity.</p>
</td></tr>
<tr><td><code>lambda.pred</code></td>
<td>
<p>If <code>save.p</code> is set to 0 (default),
<code>lambda.pred</code> is the predictive posterior mean of the abundance
associated to the suitability process for each prediction. If
<code>save.p</code> is set to 1, <code>lambda.pred</code> is an <code>mcmc</code>
object with sampled values of the abundance associated to the
suitability process for each prediction.</p>
</td></tr>
<tr><td><code>N.pred</code></td>
<td>
<p>If <code>save.N</code> is set to 0 (default), <code>N.pred</code> is
the posterior mean (rounded to the closest integer) of the latent
count variable N for each observed cell. If <code>save.N</code> is set to 1,
<code>N.pred</code> is an <code>mcmc</code> object with sampled values of the
latent count variable N for each observed cell.</p>
</td></tr>
<tr><td><code>lambda.latent</code></td>
<td>
<p>Predictive posterior mean of the abundance
associated to the suitability process for each observation.</p>
</td></tr>
<tr><td><code>delta.latent</code></td>
<td>
<p>Predictive posterior mean of the probability
associated to the observability process for each observation.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent <a href="mailto:ghislain.vieilledent@cirad.fr">ghislain.vieilledent@cirad.fr</a>
</p>


<h3>References</h3>

<p>Gelfand, A. E.; Schmidt, A. M.; Wu, S.; Silander, J. A.; Latimer, A. and
Rebelo, A. G. (2005) Modelling species diversity through species level
hierarchical modelling. <em>Applied Statistics</em>, 54, 1-20.
</p>
<p>Latimer, A. M.; Wu, S. S.; Gelfand, A. E. and Silander, J. A. (2006) Building
statistical models to analyze species distributions. <em>Ecological
Applications</em>, 16, 33-50.
</p>
<p>Royle, J. A. (2004) N-mixture models for estimating population size from
spatially replicated counts. <em>Biometrics</em>, 60, 108-115.
</p>


<h3>See Also</h3>

<p><code><a href="coda.html#topic+plot.mcmc">plot.mcmc</a></code>, <code><a href="coda.html#topic+summary.mcmc">summary.mcmc</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 

#==============================================
# hSDM.Nmixture.iCAR()
# Example with simulated data
#==============================================

#=================
#== Load libraries
library(hSDM)
library(raster)
library(sp)

#===================================
#== Multivariate normal distribution
rmvn &lt;- function(n, mu = 0, V = matrix(1), seed=1234) {
    p &lt;- length(mu)
    if (any(is.na(match(dim(V), p)))) {
        stop("Dimension problem!")
    }
    D &lt;- chol(V)
    set.seed(seed)
    t(matrix(rnorm(n*p),ncol=p)%*%D+rep(mu,rep(n,p)))
}


#==================
#== Data simulation

#= Set seed for repeatability
seed &lt;- 4321

#= Landscape
xLand &lt;- 20
yLand &lt;- 20 
Landscape &lt;- raster(ncol=xLand,nrow=yLand,crs='+proj=utm +zone=1')
Landscape[] &lt;- 0
extent(Landscape) &lt;- c(0,xLand,0,yLand)
coords &lt;- coordinates(Landscape)
ncells &lt;- ncell(Landscape)

#= Neighbors
neighbors.mat &lt;- adjacent(Landscape, cells=c(1:ncells), directions=8, pairs=TRUE, sorted=TRUE)
n.neighbors &lt;- as.data.frame(table(as.factor(neighbors.mat[,1])))[,2]
adj &lt;- neighbors.mat[,2]

#= Generate symmetric adjacency matrix, A
A &lt;- matrix(0,ncells,ncells)
index.start &lt;- 1
for (i in 1:ncells) {
    index.end &lt;- index.start+n.neighbors[i]-1
    A[i,adj[c(index.start:index.end)]] &lt;- 1
    index.start &lt;- index.end+1
}

#= Spatial effects
Vrho.target &lt;- 5
d &lt;- 1	# Spatial dependence parameter = 1 for intrinsic CAR
Q &lt;- diag(n.neighbors)-d*A + diag(.0001,ncells) # Add small constant to make Q non-singular
covrho &lt;- Vrho.target*solve(Q) # Covariance of rhos
set.seed(seed)
rho &lt;- c(rmvn(1,mu=rep(0,ncells),V=covrho,seed=seed)) # Spatial Random Effects
rho &lt;- rho-mean(rho) # Centering rhos on zero

#= Raster and plot spatial effects
r.rho &lt;- rasterFromXYZ(cbind(coords,rho))
plot(r.rho)

#= Sample the observation sites in the landscape
nsite &lt;- 150
set.seed(seed)
x.coord &lt;- runif(nsite,0,xLand)
set.seed(2*seed)
y.coord &lt;- runif(nsite,0,yLand)
sites.sp &lt;- SpatialPoints(coords=cbind(x.coord,y.coord))
cells &lt;- extract(Landscape,sites.sp,cell=TRUE)[,1]

#= Ecological process (suitability)
set.seed(seed)
x1 &lt;- rnorm(nsite,0,1)
set.seed(2*seed)
x2 &lt;- rnorm(nsite,0,1)
X &lt;- cbind(rep(1,nsite),x1,x2)
beta.target &lt;- c(-1,1,-1)
log.lambda &lt;- X %*% beta.target + rho[cells]
lambda &lt;- exp(log.lambda)
set.seed(seed)
N &lt;- rpois(nsite,lambda)

#= Relative importance of spatial random effects
RImp &lt;- mean(abs(rho[cells])/abs(X %*% beta.target))
RImp

#= Number of visits associated to each observation point
set.seed(seed)
visits &lt;- rpois(nsite,3)
visits[visits==0] &lt;- 1
# Vector of observation points
sites &lt;- vector()
for (i in 1:nsite) {
    sites &lt;- c(sites,rep(i,visits[i]))
}

#= Observation process (detectability)
nobs &lt;- sum(visits)
set.seed(seed)
w1 &lt;- rnorm(nobs,0,1)
set.seed(2*seed)
w2 &lt;- rnorm(nobs,0,1)
W &lt;- cbind(rep(1,nobs),w1,w2)
gamma.target &lt;- c(-1,1,-1)
logit.delta &lt;- W %*% gamma.target
delta &lt;- inv.logit(logit.delta)
set.seed(seed)
Y &lt;- rbinom(nobs,N[sites],delta)

#= Data-sets
data.obs &lt;- data.frame(Y,w1,w2,site=sites)
data.suit &lt;- data.frame(x1,x2,cell=cells)

#================================
#== Parameter inference with hSDM

Start &lt;- Sys.time() # Start the clock
mod.hSDM.Nmixture.iCAR &lt;- hSDM.Nmixture.iCAR(# Observations
                           counts=data.obs$Y,
                           observability=~w1+w2,
                           site=data.obs$site,
                           data.observability=data.obs,
                           # Habitat
                           suitability=~x1+x2, data.suitability=data.suit,
                           # Spatial structure
                           spatial.entity=data.suit$cell,
                           n.neighbors=n.neighbors, neighbors=adj,
                           # Predictions
                           suitability.pred=NULL,
                           spatial.entity.pred=NULL,
                           # Chains
                           burnin=5000, mcmc=5000, thin=5,
                           # Starting values
                           beta.start=0,
                           gamma.start=0,
                           Vrho.start=1,
                           # Priors
                           mubeta=0, Vbeta=1.0E6,
                           mugamma=0, Vgamma=1.0E6,
                           priorVrho="1/Gamma",
                           shape=0.5, rate=0.005,
                           Vrho.max=10,
                           # Various
                           seed=1234, verbose=1,
                           save.rho=1, save.p=0, save.N=1)
Time.hSDM &lt;- difftime(Sys.time(),Start,units="sec") # Time difference

#= Computation time
Time.hSDM

#==========
#== Outputs

#= Parameter estimates 
summary(mod.hSDM.Nmixture.iCAR$mcmc)
pdf(file="Posteriors_hSDM.Nmixture.iCAR.pdf")
plot(mod.hSDM.Nmixture.iCAR$mcmc)
dev.off()

#= Predictions
summary(mod.hSDM.Nmixture.iCAR$lambda.latent)
summary(mod.hSDM.Nmixture.iCAR$delta.latent)
summary(mod.hSDM.Nmixture.iCAR$lambda.pred)
pdf(file="Pred-Init.pdf")
plot(lambda,mod.hSDM.Nmixture.iCAR$lambda.pred)
abline(a=0,b=1,col="red")
dev.off()

#= MCMC for latent variable N
pdf(file="MCMC_N.pdf")
plot(mod.hSDM.Nmixture.iCAR$N.pred)
dev.off()

#= Check that Ns are corretly estimated
M &lt;- as.matrix(mod.hSDM.Nmixture.iCAR$N.pred)
N.est &lt;- apply(M,2,mean)
Y.by.site &lt;- tapply(data.obs$Y,data.obs$site,mean) # Mean by site
pdf(file="Check_N.pdf",width=10,height=5)
par(mfrow=c(1,2))
plot(Y.by.site, N.est) ## More individuals are expected (N &gt; Y) due to detection process
abline(a=0,b=1,col="red")
plot(N, N.est) ## N are well estimated
abline(a=0,b=1,col="red")
cor(N, N.est) ## Very close to 1
dev.off()

#= Summary plots for spatial random effects

# rho.pred
rho.pred &lt;- apply(mod.hSDM.Nmixture.iCAR$rho.pred,2,mean)
r.rho.pred &lt;- rasterFromXYZ(cbind(coords,rho.pred))

# plot
pdf(file="Summary_hSDM.Nmixture.iCAR.pdf")
par(mfrow=c(2,2))
# rho target
plot(r.rho, main="rho target")
plot(sites.sp,add=TRUE)
# rho estimated
plot(r.rho.pred, main="rho estimated")
# correlation and "shrinkage"
Levels.cells &lt;- sort(unique(cells))
plot(rho[-Levels.cells],rho.pred[-Levels.cells],
     xlim=range(rho),
     ylim=range(rho),
     xlab="rho target",
     ylab="rho estimated")
points(rho[Levels.cells],rho.pred[Levels.cells],pch=16,col="blue")
legend(x=-3,y=4,legend="Visited cells",col="blue",pch=16,bty="n")
abline(a=0,b=1,col="red")
dev.off()


## End(Not run)

</code></pre>

<hr>
<h2 id='hSDM.Nmixture.K'>N-mixture model with K, the maximal theoretical abundance</h2><span id='topic+hSDM.Nmixture.K'></span>

<h3>Description</h3>

<p>The <code>hSDM.Nmixture.K</code> function can be used to model
species distribution including different processes in a hierarchical
Bayesian framework: a <code class="reqn">\mathcal{P}oisson</code> suitability
process (refering to environmental suitability explaining abundance)
and a <code class="reqn">\mathcal{B}inomial</code> observability process
(refering to various ecological and methodological issues explaining
species detection). The <code>hSDM.Nmixture.K</code> function calls a Gibbs
sampler written in C code which uses an adaptive Metropolis algorithm
to estimate the conditional posterior distribution of hierarchical
model's parameters. K is the maximal theoretical abundance sensus
Royle 2004.</p>


<h3>Usage</h3>

<pre><code class='language-R'>hSDM.Nmixture.K(# Observations
                       counts, observability, site, data.observability,
                       # Habitat
                       suitability, data.suitability,
                       # Predictions
                       suitability.pred = NULL,
                       # Chains
                       burnin = 5000, mcmc = 10000, thin = 10,
                       # Starting values
                       beta.start,
                       gamma.start,
                       # Priors
                       mubeta = 0, Vbeta = 1.0E6,
                       mugamma = 0, Vgamma = 1.0E6,
                       # Various
                       K,
                       seed = 1234, verbose = 1,
                       save.p = 0)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hSDM.Nmixture.K_+3A_counts">counts</code></td>
<td>
<p>A vector indicating the count (or abundance) for each
observation.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.K_+3A_observability">observability</code></td>
<td>
<p>A one-sided formula of the form
<code class="reqn">\sim w_1+...+w_q</code> with <code class="reqn">q</code> terms specifying the
explicative variables for the observability process.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.K_+3A_site">site</code></td>
<td>
<p>A vector indicating the site identifier (from one to the
total number of sites) for each observation. Several observations
can occur at one site. A site can be a raster cell for example.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.K_+3A_data.observability">data.observability</code></td>
<td>
<p>A data frame containing the model's
variables for the observability process.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.K_+3A_suitability">suitability</code></td>
<td>
<p>A one-sided formula of the form
<code class="reqn">\sim x_1+...+x_p</code> with <code class="reqn">p</code> terms specifying the
explicative variables for the suitability process.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.K_+3A_data.suitability">data.suitability</code></td>
<td>
<p>A data frame containing the model's
variables for the suitability process.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.K_+3A_suitability.pred">suitability.pred</code></td>
<td>
<p>An optional data frame in which to look for
variables with which to predict. If NULL, the observations are
used.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.K_+3A_burnin">burnin</code></td>
<td>
<p>The number of burnin iterations for the sampler.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.K_+3A_mcmc">mcmc</code></td>
<td>
<p>The number of Gibbs iterations for the sampler. Total
number of Gibbs iterations is equal to
<code>burnin+mcmc</code>. <code>burnin+mcmc</code> must be divisible by 10 and
superior or equal to 100 so that the progress bar can be displayed.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.K_+3A_thin">thin</code></td>
<td>
<p>The thinning interval used in the simulation. The number
of mcmc iterations must be divisible by this value.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.K_+3A_beta.start">beta.start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters of
the suitability process. This can either be a scalar or a
<code class="reqn">p</code>-length vector.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.K_+3A_gamma.start">gamma.start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters
of the observability process. This can either be a scalar or a
<code class="reqn">q</code>-length vector.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.K_+3A_mubeta">mubeta</code></td>
<td>
<p>Means of the priors for the <code class="reqn">\beta</code> parameters
of the suitability process. <code>mubeta</code> must be either a scalar or a
p-length vector. If <code>mubeta</code> takes a scalar value, then that value will
serve as the prior mean for all of the betas. The default value is set
to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.K_+3A_vbeta">Vbeta</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\beta</code>
parameters of the suitability process. <code>Vbeta</code> must be either a
scalar or a p-length vector. If <code>Vbeta</code> takes a scalar value,
then that value will serve as the prior variance for all of the
betas. The default variance is large and set to 1.0E6 for an
uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.K_+3A_mugamma">mugamma</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\gamma</code>
parameters of the observability process. <code>mugamma</code> must be either
a scalar or a p-length vector. If <code>mugamma</code> takes a scalar value,
then that value will serve as the prior mean for all of the
gammas. The default value is set to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.K_+3A_vgamma">Vgamma</code></td>
<td>
<p>Variances of the Normal priors for the
<code class="reqn">\gamma</code> parameters of the observability
process. <code>Vgamma</code> must be either a scalar or a p-length
vector. If <code>Vgamma</code> takes a scalar value, then that value will
serve as the prior variance for all of the gammas. The default
variance is large and set to 1.0E6 for an uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.K_+3A_k">K</code></td>
<td>
<p>Maximal theoretical abundance sensus Royle 2004. It
corresponds to the integer upper index of integration for
N-mixture. This should be set high enough so that it does not affect
the parameter estimates. Note that computation time will increase
with K.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.K_+3A_seed">seed</code></td>
<td>
<p>The seed for the random number generator. Default set to
1234.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.K_+3A_verbose">verbose</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
progress of the sampler is printed to the screen. Default is 1: a
progress bar is printed, indicating the step (in %) reached by the
Gibbs sampler.</p>
</td></tr>
<tr><td><code id="hSDM.Nmixture.K_+3A_save.p">save.p</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for predictions are saved. Default is 0: the
posterior mean is computed and returned in the <code>lambda.pred</code>
vector. Be careful, setting <code>save.p</code> to 1 might require a large
amount of memory.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The model integrates two processes, an ecological process associated
to the abundance of the species due to habitat suitability and an
observation process that takes into account the fact that the
probability of detection of the species is inferior to one.
</p>
<p><b>Ecological process:</b>
</p>
<p style="text-align: center;"><code class="reqn">N_i \sim \mathcal{P}oisson(\lambda_i)</code>
</p>

<p style="text-align: center;"><code class="reqn">log(\lambda_i) = X_i \beta</code>
</p>

<p><b>Observation process:</b>
</p>
<p style="text-align: center;"><code class="reqn">y_{it} \sim \mathcal{B}inomial(N_i, \delta_{it})</code>
</p>

<p style="text-align: center;"><code class="reqn">logit(\delta_{it}) = W_{it} \gamma</code>
</p>
 


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>mcmc</code></td>
<td>
<p>An mcmc object that contains the posterior sample. This
object can be summarized by functions provided by the coda
package. The posterior sample of the deviance <code class="reqn">D</code>, with
<code class="reqn">D=-2\log(\prod_{it} P(y_{it},N_i|...))</code>, is also
provided.</p>
</td></tr>
<tr><td><code>lambda.pred</code></td>
<td>
<p>If <code>save.p</code> is set to 0 (default),
<code>lambda.pred</code> is the predictive posterior mean of the abundance
associated to the suitability process for each prediction. If
<code>save.p</code> is set to 1, <code>lambda.pred</code> is an <code>mcmc</code>
object with sampled values of the abundance associated to the
suitability process for each prediction.</p>
</td></tr>
<tr><td><code>lambda.latent</code></td>
<td>
<p>Predictive posterior mean of the abundance
associated to the suitability process for each observation.</p>
</td></tr>
<tr><td><code>delta.latent</code></td>
<td>
<p>Predictive posterior mean of the probability
associated to the observability process for each observation.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent <a href="mailto:ghislain.vieilledent@cirad.fr">ghislain.vieilledent@cirad.fr</a>
</p>


<h3>References</h3>

<p>Gelfand, A. E.; Schmidt, A. M.; Wu, S.; Silander, J. A.; Latimer, A. and
Rebelo, A. G. (2005) Modelling species diversity through species level
hierarchical modelling. <em>Applied Statistics</em>, 54, 1-20.
</p>
<p>Latimer, A. M.; Wu, S. S.; Gelfand, A. E. and Silander, J. A. (2006) Building
statistical models to analyze species distributions. <em>Ecological
Applications</em>, 16, 33-50.
</p>
<p>Royle, J. A. (2004) N-mixture models for estimating population size from
spatially replicated counts. <em>Biometrics</em>, 60, 108-115.
</p>


<h3>See Also</h3>

<p><code><a href="coda.html#topic+plot.mcmc">plot.mcmc</a></code>, <code><a href="coda.html#topic+summary.mcmc">summary.mcmc</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 

#==============================================
# hSDM.Nmixture.K()
# Example with simulated data
#==============================================

#=================
#== Load libraries
library(hSDM)

#==================
#== Data simulation

# Number of observation sites
nsite &lt;- 200

#= Set seed for repeatability
seed &lt;- 4321

#= Ecological process (suitability)
set.seed(seed)
x1 &lt;- rnorm(nsite,0,1)
set.seed(2*seed)
x2 &lt;- rnorm(nsite,0,1)
X &lt;- cbind(rep(1,nsite),x1,x2)
beta.target &lt;- c(-1,1,-1) # Target parameters
log.lambda &lt;- X %*% beta.target
lambda &lt;- exp(log.lambda)
set.seed(seed)
N &lt;- rpois(nsite,lambda)

#= Number of visits associated to each observation point
set.seed(seed)
visits &lt;- rpois(nsite,3)
visits[visits==0] &lt;- 1
# Vector of observation points
sites &lt;- vector()
for (i in 1:nsite) {
    sites &lt;- c(sites,rep(i,visits[i]))
}

#= Observation process (detectability)
nobs &lt;- sum(visits)
set.seed(seed)
w1 &lt;- rnorm(nobs,0,1)
set.seed(2*seed)
w2 &lt;- rnorm(nobs,0,1)
W &lt;- cbind(rep(1,nobs),w1,w2)
gamma.target &lt;- c(-1,1,-1) # Target parameters
logit.delta &lt;- W %*% gamma.target
delta &lt;- inv.logit(logit.delta)
set.seed(seed)
Y &lt;- rbinom(nobs,N[sites],delta)

#= Data-sets
data.obs &lt;- data.frame(Y,w1,w2,site=sites)
data.suit &lt;- data.frame(x1,x2)

#================================
#== Parameter inference with hSDM

Start &lt;- Sys.time() # Start the clock
mod.hSDM.Nmixture.K &lt;- hSDM.Nmixture.K(# Observations
                           counts=data.obs$Y,
                           observability=~w1+w2,
                           site=data.obs$site,
                           data.observability=data.obs,
                           # Habitat
                           suitability=~x1+x2,
                           data.suitability=data.suit,
                           # Predictions
                           suitability.pred=NULL,
                           # Chains
                           burnin=5000, mcmc=5000, thin=5,
                           # Starting values
                           beta.start=0,
                           gamma.start=0,
                           # Priors
                           mubeta=0, Vbeta=1.0E6,
                           mugamma=0, Vgamma=1.0E6,
                           # Various
                           K=max(data.obs$Y)*2,
                           seed=1234, verbose=1,
                           save.p=0)
Time.hSDM &lt;- difftime(Sys.time(),Start,units="sec") # Time difference

#= Computation time
Time.hSDM

#==========
#== Outputs

#= Parameter estimates
summary(mod.hSDM.Nmixture.K$mcmc)
pdf(file="Posteriors_hSDM.Nmixture.K.pdf")
plot(mod.hSDM.Nmixture.K$mcmc)
dev.off()

#= Predictions
summary(mod.hSDM.Nmixture.K$lambda.latent)
summary(mod.hSDM.Nmixture.K$delta.latent)
summary(mod.hSDM.Nmixture.K$lambda.pred)
pdf(file="Pred-Init.K.pdf")
plot(lambda,mod.hSDM.Nmixture.K$lambda.pred)
abline(a=0,b=1,col="red")
dev.off()


## End(Not run)

</code></pre>

<hr>
<h2 id='hSDM.poisson'>Poisson log regression model</h2><span id='topic+hSDM.poisson'></span>

<h3>Description</h3>

<p>The <code>hSDM.poisson</code> function performs a Poisson log
regression in a Bayesian framework. The function calls a Gibbs sampler
written in C code which uses an adaptive Metropolis algorithm to
estimate the conditional posterior distribution of model's
parameters.</p>


<h3>Usage</h3>

<pre><code class='language-R'>hSDM.poisson(counts, suitability, data, suitability.pred = NULL,
burnin = 5000, mcmc = 10000, thin = 10, beta.start, mubeta = 0, Vbeta =
1e+06, seed = 1234, verbose = 1, save.p = 0)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hSDM.poisson_+3A_counts">counts</code></td>
<td>
<p>A vector indicating the count (or abundance) for each
observation.</p>
</td></tr>
<tr><td><code id="hSDM.poisson_+3A_suitability">suitability</code></td>
<td>
<p>A one-sided formula of the form '~x1+...+xp' with p
terms specifying the explicative covariates for the suitability
process of the model.</p>
</td></tr>
<tr><td><code id="hSDM.poisson_+3A_data">data</code></td>
<td>
<p>A data frame containing the model's explicative
variables.</p>
</td></tr>
<tr><td><code id="hSDM.poisson_+3A_suitability.pred">suitability.pred</code></td>
<td>
<p>An optional data frame in which to look for
variables with which to predict. If NULL, the observations are
used.</p>
</td></tr>
<tr><td><code id="hSDM.poisson_+3A_burnin">burnin</code></td>
<td>
<p>The number of burnin iterations for the sampler.</p>
</td></tr>
<tr><td><code id="hSDM.poisson_+3A_mcmc">mcmc</code></td>
<td>
<p>The number of Gibbs iterations for the sampler. Total
number of Gibbs iterations is equal to
<code>burnin+mcmc</code>. <code>burnin+mcmc</code> must be divisible by 10 and
superior or equal to 100 so that the progress bar can be displayed.</p>
</td></tr>
<tr><td><code id="hSDM.poisson_+3A_thin">thin</code></td>
<td>
<p>The thinning interval used in the simulation. The number
of mcmc iterations must be divisible by this value.</p>
</td></tr> 
<tr><td><code id="hSDM.poisson_+3A_beta.start">beta.start</code></td>
<td>
<p>Starting values for beta parameters of the
suitability process. If <code>beta.start</code> takes a scalar value, then
that value will serve for all of the betas.</p>
</td></tr>
<tr><td><code id="hSDM.poisson_+3A_mubeta">mubeta</code></td>
<td>
<p>Means of the priors for the <code class="reqn">\beta</code> parameters
of the suitability process. <code>mubeta</code> must be either a scalar or a
p-length vector. If <code>mubeta</code> takes a scalar value, then that value will
serve as the prior mean for all of the betas. The default value is set
to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.poisson_+3A_vbeta">Vbeta</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\beta</code>
parameters of the suitability process. <code>Vbeta</code> must be either a
scalar or a p-length vector. If <code>Vbeta</code> takes a scalar value,
then that value will serve as the prior variance for all of the
betas. The default variance is large and set to 1.0E6 for an
uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.poisson_+3A_seed">seed</code></td>
<td>
<p>The seed for the random number generator. Default to 1234.</p>
</td></tr>
<tr><td><code id="hSDM.poisson_+3A_verbose">verbose</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
progress of the sampler is printed to the screen. Default is 1: a
progress bar is printed, indicating the step (in %) reached by the
Gibbs sampler.</p>
</td></tr>
<tr><td><code id="hSDM.poisson_+3A_save.p">save.p</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for predictions are saved. Default is 0: the
posterior mean is computed and returned in the <code>lambda.pred</code>
vector. Be careful, setting <code>save.p</code> to 1 might require a large
amount of memory.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We model the abundance of the species as a function of environmental
variables.
</p>
<p><b>Ecological process:</b>
</p>
<p style="text-align: center;"><code class="reqn">y_i \sim \mathcal{P}oisson(\lambda_i)</code>
</p>

<p style="text-align: center;"><code class="reqn">log(\lambda_i) = X_i \beta</code>
</p>



<h3>Value</h3>

<table role = "presentation">
<tr><td><code>mcmc</code></td>
<td>
<p>An mcmc object that contains the posterior sample. This
object can be summarized by functions provided by the coda
package. The posterior sample of the deviance <code class="reqn">D</code>, with
<code class="reqn">D=-2\log(\prod_i P(y_i,n_i|\beta))</code>, is also
provided.</p>
</td></tr>
<tr><td><code>lambda.pred</code></td>
<td>
<p>If <code>save.p</code> is set to 0 (default),
<code>lambda.pred</code> is the predictive posterior mean of the abundance
associated to the suitability process for each prediction. If
<code>save.p</code> is set to 1, <code>lambda.pred</code> is an <code>mcmc</code>
object with sampled values of the abundance associated to the
suitability process for each prediction.</p>
</td></tr>
<tr><td><code>lambda.latent</code></td>
<td>
<p>Predictive posterior mean of the abundance
associated to the suitability process for each observation.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent &lt;ghislain.vieilledent@cirad.fr&gt;
</p>


<h3>References</h3>

<p>Latimer, A. M.; Wu, S. S.; Gelfand, A. E. and Silander, J. A. (2006) Building
statistical models to analyze species distributions. <em>Ecological
Applications</em>, 16, 33-50.
</p>
<p>Gelfand, A. E.; Schmidt, A. M.; Wu, S.; Silander, J. A.; Latimer, A. and
Rebelo, A. G. (2005) Modelling species diversity through species level
hierarchical modelling. <em>Applied Statistics</em>, 54, 1-20.
</p>


<h3>See Also</h3>

<p><code><a href="coda.html#topic+plot.mcmc">plot.mcmc</a></code>, <code><a href="coda.html#topic+summary.mcmc">summary.mcmc</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 

#==============================================
# hSDM.poisson()
# Example with simulated data
#==============================================

#=================
#== Load libraries
library(hSDM)

#==================
#== Data simulation

#= Number of sites
nsite &lt;- 200

#= Set seed for repeatability
seed &lt;- 1234

#= Ecological process (suitability)
set.seed(seed)
x1 &lt;- rnorm(nsite,0,1)
set.seed(2*seed)
x2 &lt;- rnorm(nsite,0,1)
X &lt;- cbind(rep(1,nsite),x1,x2)
beta.target &lt;- c(-1,1,-1)
log.lambda &lt;- X %*% beta.target
lambda &lt;- exp(log.lambda)
set.seed(seed)
Y &lt;- rpois(nsite,lambda)

#= Data-sets
data.obs &lt;- data.frame(Y,x1,x2)

#==================================
#== Site-occupancy model

mod.hSDM.poisson &lt;- hSDM.poisson(counts=data.obs$Y,
                                 suitability=~x1+x2,
                                 data=data.obs,
                                 suitability.pred=NULL,
                                 burnin=1000, mcmc=1000, thin=1,
                                 beta.start=0,
                                 mubeta=0, Vbeta=1.0E6,
                                 seed=1234, verbose=1,
                                 save.p=0)

#==========
#== Outputs

#= Parameter estimates
summary(mod.hSDM.poisson$mcmc)
pdf(file="Posteriors_hSDM.poisson.pdf")
plot(mod.hSDM.poisson$mcmc)
dev.off()

#== glm resolution to compare
mod.glm &lt;- glm(Y~x1+x2,family="poisson",data=data.obs)
summary(mod.glm)

#= Predictions
summary(mod.hSDM.poisson$lambda.latent)
summary(mod.hSDM.poisson$lambda.pred)
pdf(file="Pred-Init.pdf")
plot(lambda,mod.hSDM.poisson$lambda.pred)
abline(a=0,b=1,col="red")
dev.off()


## End(Not run)

</code></pre>

<hr>
<h2 id='hSDM.poisson.iCAR'>Poisson log regression model with CAR process</h2><span id='topic+hSDM.poisson.iCAR'></span>

<h3>Description</h3>

<p>The <code>hSDM.poisson.iCAR</code> function performs a Poisson
log regression in a hierarchical Bayesian framework. The
suitability process includes a spatial correlation process. The
spatial correlation is modelled using an intrinsic CAR model. The
<code>hSDM.poisson.iCAR</code> function calls a Gibbs sampler written in C
code which uses an adaptive Metropolis algorithm to estimate the
conditional posterior distribution of hierarchical model's
parameters.</p>


<h3>Usage</h3>

<pre><code class='language-R'>hSDM.poisson.iCAR(counts, suitability, spatial.entity, data,
n.neighbors, neighbors, suitability.pred=NULL, spatial.entity.pred=NULL,
burnin = 5000, mcmc = 10000, thin = 10, beta.start, Vrho.start, mubeta =
0, Vbeta = 1e+06, priorVrho = "1/Gamma", shape = 0.5, rate = 0.0005,
Vrho.max=1000, seed = 1234, verbose = 1, save.rho = 0, save.p = 0)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hSDM.poisson.iCAR_+3A_counts">counts</code></td>
<td>
<p>A vector indicating the count (or abundance) for each
observation.</p>
</td></tr>
<tr><td><code id="hSDM.poisson.iCAR_+3A_suitability">suitability</code></td>
<td>
<p>A one-sided formula of the form
<code class="reqn">\sim x_1+...+x_p</code> with <code class="reqn">p</code> terms specifying the
explicative variables for the suitability process.</p>
</td></tr>
<tr><td><code id="hSDM.poisson.iCAR_+3A_spatial.entity">spatial.entity</code></td>
<td>
<p>A vector indicating the spatial entity
identifier (from one to the total number of entities) for each
observation. Several observations can occur in one spatial entity. A
spatial entity can be a raster cell for example.</p>
</td></tr>
<tr><td><code id="hSDM.poisson.iCAR_+3A_data">data</code></td>
<td>
<p>A data frame containing the model's variables.</p>
</td></tr>
<tr><td><code id="hSDM.poisson.iCAR_+3A_n.neighbors">n.neighbors</code></td>
<td>
<p>A vector of integers that indicates the number of
neighbors (adjacent entities) of each spatial
entity. <code>length(n.neighbors)</code> indicates the total number of
spatial entities.</p>
</td></tr>
<tr><td><code id="hSDM.poisson.iCAR_+3A_neighbors">neighbors</code></td>
<td>
<p>A vector of integers indicating the neighbors
(adjacent entities) of each spatial entity. Must be of the form
c(neighbors of entity 1, neighbors of entity 2, ... , neighbors of
the last entity). Length of the <code>neighbors</code> vector should be
equal to <code>sum(n.neighbors)</code>.</p>
</td></tr>
<tr><td><code id="hSDM.poisson.iCAR_+3A_suitability.pred">suitability.pred</code></td>
<td>
<p>An optional data frame in which to look for
variables with which to predict. If NULL, the observations are
used.</p>
</td></tr>
<tr><td><code id="hSDM.poisson.iCAR_+3A_spatial.entity.pred">spatial.entity.pred</code></td>
<td>
<p>An optional vector indicating the spatial
entity identifier (from one to the total number of entities) for
predictions. If NULL, the vector <code>spatial.entity</code> for
observations is used.</p>
</td></tr>
<tr><td><code id="hSDM.poisson.iCAR_+3A_burnin">burnin</code></td>
<td>
<p>The number of burnin iterations for the sampler.</p>
</td></tr>
<tr><td><code id="hSDM.poisson.iCAR_+3A_mcmc">mcmc</code></td>
<td>
<p>The number of Gibbs iterations for the sampler. Total
number of Gibbs iterations is equal to
<code>burnin+mcmc</code>. <code>burnin+mcmc</code> must be divisible by 10 and
superior or equal to 100 so that the progress bar can be displayed.</p>
</td></tr>
<tr><td><code id="hSDM.poisson.iCAR_+3A_thin">thin</code></td>
<td>
<p>The thinning interval used in the simulation. The number
of mcmc iterations must be divisible by this value.</p>
</td></tr>
<tr><td><code id="hSDM.poisson.iCAR_+3A_beta.start">beta.start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters of
the suitability process. This can either be a scalar or a
<code class="reqn">p</code>-length vector.</p>
</td></tr>
<tr><td><code id="hSDM.poisson.iCAR_+3A_vrho.start">Vrho.start</code></td>
<td>
<p>Positive scalar indicating the starting value for the
variance of the spatial random effects.</p>
</td></tr>
<tr><td><code id="hSDM.poisson.iCAR_+3A_mubeta">mubeta</code></td>
<td>
<p>Means of the priors for the <code class="reqn">\beta</code> parameters
of the suitability process. <code>mubeta</code> must be either a scalar or a
p-length vector. If <code>mubeta</code> takes a scalar value, then that value will
serve as the prior mean for all of the betas. The default value is set
to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.poisson.iCAR_+3A_vbeta">Vbeta</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\beta</code>
parameters of the suitability process. <code>Vbeta</code> must be either a
scalar or a p-length vector. If <code>Vbeta</code> takes a scalar value,
then that value will serve as the prior variance for all of the
betas. The default variance is large and set to 1.0E6 for an
uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.poisson.iCAR_+3A_priorvrho">priorVrho</code></td>
<td>
<p>Type of prior for the variance of the spatial random
effects. Can be set to a fixed positive scalar, or to an inverse-gamma
distribution (&quot;1/Gamma&quot;) with parameters <code>shape</code> and <code>rate</code>,
or to a uniform distribution (&quot;Uniform&quot;) on the interval
[0,<code>Vrho.max</code>]. Default set to &quot;1/Gamma&quot;.</p>
</td></tr>
<tr><td><code id="hSDM.poisson.iCAR_+3A_shape">shape</code></td>
<td>
<p>The shape parameter for the Gamma prior on the precision
of the spatial random effects. Default value is <code>shape=0.05</code> for
uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.poisson.iCAR_+3A_rate">rate</code></td>
<td>
<p>The rate (1/scale) parameter for the Gamma prior on the
precision of the spatial random effects. Default value is
<code>rate=0.0005</code> for uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.poisson.iCAR_+3A_vrho.max">Vrho.max</code></td>
<td>
<p>Upper bound for the uniform prior of the spatial
random effect variance. Default set to 1000.</p>
</td></tr>
<tr><td><code id="hSDM.poisson.iCAR_+3A_seed">seed</code></td>
<td>
<p>The seed for the random number generator. Default set to
1234.</p>
</td></tr>
<tr><td><code id="hSDM.poisson.iCAR_+3A_verbose">verbose</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
progress of the sampler is printed to the screen. Default is 1: a
progress bar is printed, indicating the step (in %) reached by the
Gibbs sampler.</p>
</td></tr>
<tr><td><code id="hSDM.poisson.iCAR_+3A_save.rho">save.rho</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for rhos are saved. Default is 0: the posterior mean
is computed and returned in the <code>rho.pred</code> vector. Be careful,
setting <code>save.rho</code> to 1 might require a large amount of
memory.</p>
</td></tr>
<tr><td><code id="hSDM.poisson.iCAR_+3A_save.p">save.p</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for predictions are saved. Default is 0: the
posterior mean is computed and returned in the <code>lambda.pred</code>
vector. Be careful, setting <code>save.p</code> to 1 might require a large
amount of memory.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We model an ecological process where the abundance of the species is
explained by habitat suitability. The ecological process includes an
intrinsic conditional autoregressive (iCAR) model for spatial
autocorrelation between observations, assuming that the probability of
presence of the species at one site depends on the probability of
presence of the species on neighboring sites.
</p>
<p><b>Ecological process:</b>
</p>
<p style="text-align: center;"><code class="reqn">y_i \sim \mathcal{P}oisson(\lambda_i,t_i)</code>
</p>

<p style="text-align: center;"><code class="reqn">log(\lambda_i) = X_i \beta + \rho_{j(i)}</code>
</p>

<p><code class="reqn">\rho_j</code>: spatial random effect
</p>
<p><code class="reqn">j(i)</code>: index of the spatial entity for observation <code class="reqn">i</code>.
</p>
<p><b>Spatial autocorrelation:</b>
</p>
<p>An intrinsic conditional autoregressive model (iCAR) is assumed:
</p>
<p style="text-align: center;"><code class="reqn">\rho_j \sim \mathcal{N}ormal(\mu_j,V_{\rho} / n_j)</code>
</p>

<p><code class="reqn">\mu_j</code>: mean of <code class="reqn">\rho_{j'}</code> in the
neighborhood of <code class="reqn">j</code>.
</p>
<p><code class="reqn">V_{\rho}</code>: variance of the spatial random effects.
</p>
<p><code class="reqn">n_j</code>: number of neighbors for spatial entity <code class="reqn">j</code>.
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>mcmc</code></td>
<td>
<p>An mcmc object that contains the posterior sample. This
object can be summarized by functions provided by the coda
package. The posterior sample of the deviance <code class="reqn">D</code>, with
<code class="reqn">D=-2\log(\prod_i P(y_i|...))</code>, is
also provided.</p>
</td></tr>
<tr><td><code>rho.pred</code></td>
<td>
<p>If <code>save.rho</code> is set to 0 (default),
<code>rho.pred</code> is the predictive posterior mean of the spatial
random effect associated to each spatial entity. If <code>save.rho</code> is
set to 1, <code>rho.pred</code> is an <code>mcmc</code> object with sampled
values for each spatial random effect associated to each spatial
entity.</p>
</td></tr>
<tr><td><code>lambda.pred</code></td>
<td>
<p>If <code>save.p</code> is set to 0 (default),
<code>lambda.pred</code> is the predictive posterior mean of the abundance
associated to the suitability process for each prediction. If
<code>save.p</code> is set to 1, <code>lambda.pred</code> is an <code>mcmc</code>
object with sampled values of the abundance associated to the
suitability process for each prediction.</p>
</td></tr>
<tr><td><code>lambda.latent</code></td>
<td>
<p>Predictive posterior mean of the abundance
associated to the suitability process for each observation.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent <a href="mailto:ghislain.vieilledent@cirad.fr">ghislain.vieilledent@cirad.fr</a>
</p>


<h3>References</h3>

<p>Gelfand, A. E.; Schmidt, A. M.; Wu, S.; Silander, J. A.; Latimer, A. and
Rebelo, A. G. (2005) Modelling species diversity through species level
hierarchical modelling. <em>Applied Statistics</em>, 54, 1-20.
</p>
<p>Latimer, A. M.; Wu, S. S.; Gelfand, A. E. and Silander, J. A. (2006) Building
statistical models to analyze species distributions. <em>Ecological
Applications</em>, 16, 33-50.
</p>
<p>Lichstein, J. W.; Simons, T. R.; Shriner, S. A. &amp; Franzreb,
K. E. (2002) Spatial autocorrelation and autoregressive models in ecology
<em>Ecological Monographs</em>, 72, 445-463.
</p>
<p>Diez, J. M. &amp; Pulliam, H. R. (2007) Hierarchical analysis of species
distributions and abundance across environmental gradients
<em>Ecology</em>, 88, 3144-3152.
</p>


<h3>See Also</h3>

<p><code><a href="coda.html#topic+plot.mcmc">plot.mcmc</a></code>, <code><a href="coda.html#topic+summary.mcmc">summary.mcmc</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 

#==============================================
# hSDM.poisson.iCAR()
# Example with simulated data
#==============================================

#=================
#== Load libraries                          
library(hSDM)
library(raster)
library(sp)

#===================================
#== Multivariate normal distribution
rmvn &lt;- function(n, mu = 0, V = matrix(1), seed=1234) {
    p &lt;- length(mu)
    if (any(is.na(match(dim(V), p)))) {
        stop("Dimension problem!")
    }
    D &lt;- chol(V)
    set.seed(seed)
    t(matrix(rnorm(n*p),ncol=p)%*%D+rep(mu,rep(n,p)))
}

#==================
#== Data simulation

#= Set seed for repeatability
seed &lt;- 1234

#= Landscape
xLand &lt;- 30
yLand &lt;- 30 
Landscape &lt;- raster(ncol=xLand,nrow=yLand,crs='+proj=utm +zone=1')
Landscape[] &lt;- 0
extent(Landscape) &lt;- c(0,xLand,0,yLand)
coords &lt;- coordinates(Landscape)
ncells &lt;- ncell(Landscape)

#= Neighbors
neighbors.mat &lt;- adjacent(Landscape, cells=c(1:ncells), directions=8, pairs=TRUE, sorted=TRUE)
n.neighbors &lt;- as.data.frame(table(as.factor(neighbors.mat[,1])))[,2]
adj &lt;- neighbors.mat[,2]

#= Generate symmetric adjacency matrix, A
A &lt;- matrix(0,ncells,ncells)
index.start &lt;- 1
for (i in 1:ncells) {
    index.end &lt;- index.start+n.neighbors[i]-1
    A[i,adj[c(index.start:index.end)]] &lt;- 1
    index.start &lt;- index.end+1
}

#= Spatial effects
Vrho.target &lt;- 5
d &lt;- 1	# Spatial dependence parameter = 1 for intrinsic CAR
Q &lt;- diag(n.neighbors)-d*A + diag(.0001,ncells) # Add small constant to make Q non-singular
covrho &lt;- Vrho.target*solve(Q) # Covariance of rhos
set.seed(seed)
rho &lt;- c(rmvn(1,mu=rep(0,ncells),V=covrho,seed=seed)) # Spatial Random Effects
rho &lt;- rho-mean(rho) # Centering rhos on zero

#= Raster and plot spatial effects
r.rho &lt;- rasterFromXYZ(cbind(coords,rho))
plot(r.rho)

#= Sample the observation sites in the landscape
nsite &lt;- 250
set.seed(seed)
x.coord &lt;- runif(nsite,0,xLand)
set.seed(2*seed)
y.coord &lt;- runif(nsite,0,yLand)
sites.sp &lt;- SpatialPoints(coords=cbind(x.coord,y.coord))
cells &lt;- extract(Landscape,sites.sp,cell=TRUE)[,1]

#= Ecological process (suitability)
set.seed(seed)
x1 &lt;- rnorm(nsite,0,1)
set.seed(2*seed)
x2 &lt;- rnorm(nsite,0,1)
X &lt;- cbind(rep(1,nsite),x1,x2)
beta.target &lt;- c(-1,1,-1)
log.lambda &lt;- X %*% beta.target + rho[cells]
lambda &lt;- exp(log.lambda)
set.seed(seed)
Y &lt;- rpois(nsite,lambda)

#= Relative importance of spatial random effects
RImp &lt;- mean(abs(rho[cells])/abs(X %*% beta.target))
RImp

#= Data-sets
data.obs &lt;- data.frame(Y,x1,x2,cell=cells)

#==================================
#== Site-occupancy model

Start &lt;- Sys.time() # Start the clock
mod.hSDM.poisson.iCAR &lt;- hSDM.poisson.iCAR(counts=data.obs$Y,
                                           suitability=~x1+x2,
                                           spatial.entity=data.obs$cell,
                                           data=data.obs,
                                           n.neighbors=n.neighbors,
                                           neighbors=adj,
                                           suitability.pred=NULL,
                                           spatial.entity.pred=NULL,
                                           burnin=5000, mcmc=5000, thin=5,
                                           beta.start=0,
                                           Vrho.start=1,
                                           mubeta=0, Vbeta=1.0E6,
                                           priorVrho="1/Gamma",
                                           shape=0.5, rate=0.0005,
                                           seed=1234, verbose=1,
                                           save.rho=1, save.p=0)
Time.hSDM &lt;- difftime(Sys.time(),Start,units="sec") # Time difference

#= Computation time
Time.hSDM

#==========
#== Outputs

#= Parameter estimates 
summary(mod.hSDM.poisson.iCAR$mcmc)
pdf("Posteriors_hSDM.poisson.iCAR.pdf")
plot(mod.hSDM.poisson.iCAR$mcmc)
dev.off()

#= Predictions
summary(mod.hSDM.poisson.iCAR$lambda.latent)
summary(mod.hSDM.poisson.iCAR$lambda.pred)
pdf(file="Pred-Init.pdf")
plot(lambda,mod.hSDM.poisson.iCAR$lambda.pred)
abline(a=0,b=1,col="red")
dev.off()

#= Summary plots for spatial random effects

# rho.pred
rho.pred &lt;- apply(mod.hSDM.poisson.iCAR$rho.pred,2,mean)
r.rho.pred &lt;- rasterFromXYZ(cbind(coords,rho.pred))

# plot
pdf(file="Summary_hSDM.poisson.iCAR.pdf")
par(mfrow=c(2,2))
# rho target
plot(r.rho, main="rho target")
plot(sites.sp,add=TRUE)
# rho estimated
plot(r.rho.pred, main="rho estimated")
# correlation and "shrinkage"
Levels.cells &lt;- sort(unique(cells))
plot(rho[-Levels.cells],rho.pred[-Levels.cells],
     xlim=range(rho),
     ylim=range(rho),
     xlab="rho target",
     ylab="rho estimated")
points(rho[Levels.cells],rho.pred[Levels.cells],pch=16,col="blue")
legend(x=-3,y=4,legend="Visited cells",col="blue",pch=16,bty="n")
abline(a=0,b=1,col="red")
dev.off()


## End(Not run)

</code></pre>

<hr>
<h2 id='hSDM.siteocc'>Site occupancy model</h2><span id='topic+hSDM.siteocc'></span>

<h3>Description</h3>

<p>The <code>hSDM.siteocc</code> function can be used to model
species distribution including different processes in a hierarchical
Bayesian framework: a <code class="reqn">\mathcal{B}ernoulli</code> suitability
process (refering to environmental suitability) and a
<code class="reqn">\mathcal{B}ernoulli</code> observability process (refering
to various ecological and methodological issues explaining the species
detection). The <code>hSDM.siteocc</code> function calls a Gibbs sampler
written in C code which uses a Metropolis algorithm to estimate the
conditional posterior distribution of hierarchical model's
parameters.</p>


<h3>Usage</h3>

<pre><code class='language-R'>hSDM.siteocc(# Observations
                     presence, observability, site, data.observability,
                     # Habitat
                     suitability, data.suitability,
                     # Predictions
                     suitability.pred = NULL,
                     # Chains
                     burnin = 1000, mcmc = 1000, thin = 1,
                     # Starting values
                     beta.start,
                     gamma.start,
                     # Priors
                     mubeta = 0, Vbeta = 1.0E6,
                     mugamma = 0, Vgamma = 1.0E6,
                     # Various
                     seed = 1234, verbose = 1,
                     save.p = 0)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hSDM.siteocc_+3A_presence">presence</code></td>
<td>
<p>A vector indicating the presence/absence for each
observation.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc_+3A_observability">observability</code></td>
<td>
<p>A one-sided formula of the form
<code class="reqn">\sim w_1+...+w_q</code> with <code class="reqn">q</code> terms specifying the
explicative variables for the observability process.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc_+3A_site">site</code></td>
<td>
<p>A vector indicating the site identifier (from one to the
total number of sites) for each observation. Several observations
can occur at one site. A site can be a raster cell for example.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc_+3A_data.observability">data.observability</code></td>
<td>
<p>A data frame containing the model's
variables for the observability process.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc_+3A_suitability">suitability</code></td>
<td>
<p>A one-sided formula of the form
<code class="reqn">\sim x_1+...+x_p</code> with <code class="reqn">p</code> terms specifying the
explicative variables for the suitability process.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc_+3A_data.suitability">data.suitability</code></td>
<td>
<p>A data frame containing the model's
variables for the suitability process.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc_+3A_suitability.pred">suitability.pred</code></td>
<td>
<p>An optional data frame in which to look for
variables with which to predict. If NULL, the observations are
used.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc_+3A_burnin">burnin</code></td>
<td>
<p>The number of burnin iterations for the sampler.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc_+3A_mcmc">mcmc</code></td>
<td>
<p>The number of Gibbs iterations for the sampler. Total
number of Gibbs iterations is equal to
<code>burnin+mcmc</code>. <code>burnin+mcmc</code> must be divisible by 10 and
superior or equal to 100 so that the progress bar can be displayed.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc_+3A_thin">thin</code></td>
<td>
<p>The thinning interval used in the simulation. The number
of mcmc iterations must be divisible by this value.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc_+3A_beta.start">beta.start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters of
the suitability process. This can either be a scalar or a
<code class="reqn">p</code>-length vector.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc_+3A_gamma.start">gamma.start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters
of the observability process. This can either be a scalar or a
<code class="reqn">q</code>-length vector.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc_+3A_mubeta">mubeta</code></td>
<td>
<p>Means of the priors for the <code class="reqn">\beta</code> parameters
of the suitability process. <code>mubeta</code> must be either a scalar or a
p-length vector. If <code>mubeta</code> takes a scalar value, then that value will
serve as the prior mean for all of the betas. The default value is set
to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc_+3A_vbeta">Vbeta</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\beta</code>
parameters of the suitability process. <code>Vbeta</code> must be either a
scalar or a p-length vector. If <code>Vbeta</code> takes a scalar value,
then that value will serve as the prior variance for all of the
betas. The default variance is large and set to 1.0E6 for an
uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc_+3A_mugamma">mugamma</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\gamma</code>
parameters of the observability process. <code>mugamma</code> must be either
a scalar or a p-length vector. If <code>mugamma</code> takes a scalar value,
then that value will serve as the prior mean for all of the
gammas. The default value is set to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc_+3A_vgamma">Vgamma</code></td>
<td>
<p>Variances of the Normal priors for the
<code class="reqn">\gamma</code> parameters of the observability
process. <code>Vgamma</code> must be either a scalar or a p-length
vector. If <code>Vgamma</code> takes a scalar value, then that value will
serve as the prior variance for all of the gammas. The default
variance is large and set to 1.0E6 for an uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc_+3A_seed">seed</code></td>
<td>
<p>The seed for the random number generator. Default set to
1234.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc_+3A_verbose">verbose</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
progress of the sampler is printed to the screen. Default is 1: a
progress bar is printed, indicating the step (in %) reached by the
Gibbs sampler.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc_+3A_save.p">save.p</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for predictions are saved. Default is 0: the
posterior mean is computed and returned in the <code>lambda.pred</code>
vector. Be careful, setting <code>save.p</code> to 1 might require a large
amount of memory.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The model integrates two processes, an ecological process associated
to the presence or absence of the species due to habitat suitability
and an observation process that takes into account the fact that the
probability of detection of the species is inferior to one.
</p>
<p><b>Ecological process:</b>
</p>
<p style="text-align: center;"><code class="reqn">z_i \sim \mathcal{B}ernoulli(\theta_i)</code>
</p>

<p style="text-align: center;"><code class="reqn">logit(\theta_i) = X_i \beta</code>
</p>

<p><b>Observation process:</b>
</p>
<p style="text-align: center;"><code class="reqn">y_{it} \sim \mathcal{B}ernoulli(z_i * \delta_{it})</code>
</p>

<p style="text-align: center;"><code class="reqn">logit(\delta_{it}) = W_{it} \gamma</code>
</p>
 


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>mcmc</code></td>
<td>
<p>An mcmc object that contains the posterior sample. This
object can be summarized by functions provided by the coda
package. The posterior sample of the deviance <code class="reqn">D</code>, with
<code class="reqn">D=-2\log(\prod_{it} P(y_{it},N_i|...))</code>, is also
provided.</p>
</td></tr>
<tr><td><code>theta.pred</code></td>
<td>
<p>If <code>save.p</code> is set to 0 (default),
<code>theta.pred</code> is the predictive posterior mean of the
probability associated to the suitability process for each
prediction. If <code>save.p</code> is set to 1, <code>theta.pred</code> is an
<code>mcmc</code> object with sampled values of the probability associated
to the suitability process for each prediction.</p>
</td></tr>
<tr><td><code>theta.latent</code></td>
<td>
<p>Predictive posterior mean of the probability
associated to the suitability process for each site.</p>
</td></tr>
<tr><td><code>delta.latent</code></td>
<td>
<p>Predictive posterior mean of the probability
associated to the observability process for each observation.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent <a href="mailto:ghislain.vieilledent@cirad.fr">ghislain.vieilledent@cirad.fr</a>
</p>


<h3>References</h3>

<p>MacKenzie, D. I.; Nichols, J. D.; Lachman, G. B.; Droege, S.; Andrew
Royle, J. and Langtimm, C. A. (2002) Estimating site occupancy rates when
detection probabilities are less than one. <em>Ecology</em>, 83,
2248-2255.
</p>


<h3>See Also</h3>

<p><code><a href="coda.html#topic+plot.mcmc">plot.mcmc</a></code>, <code><a href="coda.html#topic+summary.mcmc">summary.mcmc</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 

#==============================================
# hSDM.siteocc()
# Example with simulated data
#==============================================

#=================
#== Load libraries
library(hSDM)

#==================
#== Data simulation

#= Number of observation sites
nsite &lt;- 200

#= Set seed for repeatability
seed &lt;- 4321

#= Ecological process (suitability)
set.seed(seed)
x1 &lt;- rnorm(nsite,0,1)
set.seed(2*seed)
x2 &lt;- rnorm(nsite,0,1)
X &lt;- cbind(rep(1,nsite),x1,x2)
beta.target &lt;- c(-1,1,-1) # Target parameters
logit.theta &lt;- X %*% beta.target
theta &lt;- inv.logit(logit.theta)
set.seed(seed)
Z &lt;- rbinom(nsite,1,theta)

#= Number of visits associated to each observation point
set.seed(seed)
visits &lt;- rpois(nsite,3)
visits[visits==0] &lt;- 1
# Vector of observation points
sites &lt;- vector()
for (i in 1:nsite) {
    sites &lt;- c(sites,rep(i,visits[i]))
}

#= Observation process (detectability)
nobs &lt;- sum(visits)
set.seed(seed)
w1 &lt;- rnorm(nobs,0,1)
set.seed(2*seed)
w2 &lt;- rnorm(nobs,0,1)
W &lt;- cbind(rep(1,nobs),w1,w2)
gamma.target &lt;- c(-1,1,-1) # Target parameters
logit.delta &lt;- W %*% gamma.target
delta &lt;- inv.logit(logit.delta)
set.seed(seed)
Y &lt;- rbinom(nobs,1,delta*Z[sites])

#= Data-sets
data.obs &lt;- data.frame(Y,w1,w2,site=sites)
data.suit &lt;- data.frame(x1,x2)

#================================
#== Parameter inference with hSDM
#==================================

Start &lt;- Sys.time() # Start the clock
mod.hSDM.siteocc &lt;- hSDM.siteocc(# Observations
                                 presence=data.obs$Y,
                                 observability=~w1+w2,
                                 site=data.obs$site,
                                 data.observability=data.obs,
                                 # Habitat
                                 suitability=~x1+x2,
                                 data.suitability=data.suit,
                                 # Predictions
                                 suitability.pred=NULL,
                                 # Chains
                                 burnin=2000, mcmc=2000, thin=2,
                                 # Starting values
                                 beta.start=0,
                                 gamma.start=0,
                                 # Priors
                                 mubeta=0, Vbeta=1.0E6,
                                 mugamma=0, Vgamma=1.0E6,
                                 # Various
                                 seed=1234, verbose=1, save.p=0)
Time.hSDM &lt;- difftime(Sys.time(),Start,units="sec") # Time difference

#= Computation time
Time.hSDM

#==========
#== Outputs

#= Parameter estimates
summary(mod.hSDM.siteocc$mcmc)
pdf(file="Posteriors_hSDM.siteocc.pdf")
plot(mod.hSDM.siteocc$mcmc)
dev.off()

#= Predictions
summary(mod.hSDM.siteocc$theta.latent)
summary(mod.hSDM.siteocc$delta.latent)
summary(mod.hSDM.siteocc$theta.pred)
pdf(file="Pred-Init.pdf")
plot(theta,mod.hSDM.siteocc$theta.pred)
abline(a=0,b=1,col="red")
dev.off()


## End(Not run)

</code></pre>

<hr>
<h2 id='hSDM.siteocc.iCAR'>Site-occupancy model with CAR process</h2><span id='topic+hSDM.siteocc.iCAR'></span>

<h3>Description</h3>

<p>The <code>hSDM.siteocc.iCAR</code> function can be used to model
species distribution including different processes in a hierarchical
Bayesian framework: a <code class="reqn">\mathcal{B}ernoulli</code> suitability
process (refering to environmental suitability) which takes into
account the spatial dependence of the observations, and a
<code class="reqn">\mathcal{B}ernoulli</code> observability process (refering
to various ecological and methodological issues explaining the species
detection). The <code>hSDM.siteocc.iCAR</code> function calls a Gibbs
sampler written in C code which uses an adaptive Metropolis algorithm
to estimate the conditional posterior distribution of hierarchical
model's parameters.</p>


<h3>Usage</h3>

<pre><code class='language-R'>hSDM.siteocc.iCAR(# Observations
                         presence, observability, site, data.observability,
                         # Habitat
                         suitability, data.suitability,
                         # Spatial structure
                         spatial.entity,
                         n.neighbors, neighbors,
                         # Predictions
                         suitability.pred = NULL, spatial.entity.pred = NULL,
                         # Chains
                         burnin = 1000, mcmc = 1000, thin = 1,
                         # Starting values
                         beta.start,
                         gamma.start,
                         Vrho.start,
                         # Priors
                         mubeta = 0, Vbeta = 1.0E6,
                         mugamma = 0, Vgamma = 1.0E6,
                         priorVrho = "1/Gamma",
                         shape = 0.5, rate = 0.0005,
                         Vrho.max = 1000,
                         # Various
                         seed = 1234, verbose = 1,
                         save.rho = 0, save.p = 0)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hSDM.siteocc.iCAR_+3A_presence">presence</code></td>
<td>
<p>A vector indicating the presence/absence for each observation.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_observability">observability</code></td>
<td>
<p>A one-sided formula of the form
<code class="reqn">\sim w_1+...+w_q</code> with <code class="reqn">q</code> terms specifying the
explicative variables for the observability process.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_site">site</code></td>
<td>
<p>A vector indicating the site identifier (from one to the
total number of sites) for each observation. Several observations
can occur at one site. A site can be a raster cell for example.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_data.observability">data.observability</code></td>
<td>
<p>A data frame containing the model's
variables for the observability process.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_suitability">suitability</code></td>
<td>
<p>A one-sided formula of the form
<code class="reqn">\sim x_1+...+x_p</code> with <code class="reqn">p</code> terms specifying the
explicative variables for the suitability process.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_data.suitability">data.suitability</code></td>
<td>
<p>A data frame containing the model's
variables for the suitability process.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_spatial.entity">spatial.entity</code></td>
<td>
<p>A vector (of length 'nsite') indicating the
spatial entity identifier for each site. Values must be between 1
and the total number of spatial entities. Several sites can be found
in one spatial entity. A spatial entity can be a raster cell for
example.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_n.neighbors">n.neighbors</code></td>
<td>
<p>A vector of integers that indicates the number of
neighbors (adjacent entities) of each spatial
entity. <code>length(n.neighbors)</code> indicates the total number of
spatial entities.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_neighbors">neighbors</code></td>
<td>
<p>A vector of integers indicating the neighbors
(adjacent entities) of each spatial entity. Must be of the form
c(neighbors of entity 1, neighbors of entity 2, ... , neighbors of
the last entity). Length of the <code>neighbors</code> vector should be
equal to <code>sum(n.neighbors)</code>.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_suitability.pred">suitability.pred</code></td>
<td>
<p>An optional data frame in which to look for
variables with which to predict. If NULL, the observations are
used.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_spatial.entity.pred">spatial.entity.pred</code></td>
<td>
<p>An optional vector indicating the spatial
entity identifier (from one to the total number of entities) for
predictions. If NULL, the vector <code>spatial.entity</code> for
observations is used.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_burnin">burnin</code></td>
<td>
<p>The number of burnin iterations for the sampler.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_mcmc">mcmc</code></td>
<td>
<p>The number of Gibbs iterations for the sampler. Total
number of Gibbs iterations is equal to
<code>burnin+mcmc</code>. <code>burnin+mcmc</code> must be divisible by 10 and
superior or equal to 100 so that the progress bar can be displayed.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_thin">thin</code></td>
<td>
<p>The thinning interval used in the simulation. The number
of mcmc iterations must be divisible by this value.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_beta.start">beta.start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters of
the suitability process. This can either be a scalar or a
<code class="reqn">p</code>-length vector.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_gamma.start">gamma.start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters
of the observability process. This can either be a scalar or a
<code class="reqn">q</code>-length vector.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_vrho.start">Vrho.start</code></td>
<td>
<p>Positive scalar indicating the starting value for the
variance of the spatial random effects.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_mubeta">mubeta</code></td>
<td>
<p>Means of the priors for the <code class="reqn">\beta</code> parameters
of the suitability process. <code>mubeta</code> must be either a scalar or a
p-length vector. If <code>mubeta</code> takes a scalar value, then that value will
serve as the prior mean for all of the betas. The default value is set
to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_vbeta">Vbeta</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\beta</code>
parameters of the suitability process. <code>Vbeta</code> must be either a
scalar or a p-length vector. If <code>Vbeta</code> takes a scalar value,
then that value will serve as the prior variance for all of the
betas. The default variance is large and set to 1.0E6 for an
uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_mugamma">mugamma</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\gamma</code>
parameters of the observability process. <code>mugamma</code> must be either
a scalar or a p-length vector. If <code>mugamma</code> takes a scalar value,
then that value will serve as the prior mean for all of the
gammas. The default value is set to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_vgamma">Vgamma</code></td>
<td>
<p>Variances of the Normal priors for the
<code class="reqn">\gamma</code> parameters of the observability
process. <code>Vgamma</code> must be either a scalar or a p-length
vector. If <code>Vgamma</code> takes a scalar value, then that value will
serve as the prior variance for all of the gammas. The default
variance is large and set to 1.0E6 for an uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_priorvrho">priorVrho</code></td>
<td>
<p>Type of prior for the variance of the spatial random
effects. Can be set to a fixed positive scalar, or to an inverse-gamma
distribution (&quot;1/Gamma&quot;) with parameters <code>shape</code> and <code>rate</code>,
or to a uniform distribution (&quot;Uniform&quot;) on the interval
[0,<code>Vrho.max</code>]. Default set to &quot;1/Gamma&quot;.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_shape">shape</code></td>
<td>
<p>The shape parameter for the Gamma prior on the precision
of the spatial random effects. Default value is <code>shape=0.05</code> for
uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_rate">rate</code></td>
<td>
<p>The rate (1/scale) parameter for the Gamma prior on the
precision of the spatial random effects. Default value is
<code>rate=0.0005</code> for uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_vrho.max">Vrho.max</code></td>
<td>
<p>Upper bound for the uniform prior of the spatial
random effect variance. Default set to 1000.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_seed">seed</code></td>
<td>
<p>The seed for the random number generator. Default set to
1234.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_verbose">verbose</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
progress of the sampler is printed to the screen. Default is 1: a
progress bar is printed, indicating the step (in %) reached by the
Gibbs sampler.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_save.rho">save.rho</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for rhos are saved. Default is 0: the posterior mean
is computed and returned in the <code>rho.pred</code> vector. Be careful,
setting <code>save.rho</code> to 1 might require a large amount of
memory.</p>
</td></tr>
<tr><td><code id="hSDM.siteocc.iCAR_+3A_save.p">save.p</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for predictions are saved. Default is 0: the
posterior mean is computed and returned in the <code>theta.pred</code>
vector. Be careful, setting <code>save.p</code> to 1 might require a large
amount of memory.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The model integrates two processes, an ecological process associated
to the presence or absence of the species due to habitat suitability
and an observation process that takes into account the fact that the
probability of detection of the species is inferior to one. The
ecological process includes an intrinsic conditional autoregressive
model (iCAR) model for spatial autocorrelation between observations,
assuming that the probability of presence of the species at one site
depends on the probability of presence of the species on neighboring
sites.
</p>
<p><b>Ecological process:</b>
</p>
<p style="text-align: center;"><code class="reqn">z_i \sim \mathcal{B}ernoulli(\theta_i)</code>
</p>

<p style="text-align: center;"><code class="reqn">logit(\theta_i) = X_i \beta + \rho_{j(i)}</code>
</p>

<p><code class="reqn">\rho_j</code>: spatial random effect
</p>
<p><code class="reqn">j(i)</code>: index of the spatial entity for observation <code class="reqn">i</code>.
</p>
<p><b>Spatial autocorrelation:</b>
</p>
<p>An intrinsic conditional autoregressive model (iCAR) is assumed:
</p>
<p style="text-align: center;"><code class="reqn">\rho_j \sim \mathcal{N}ormal(\mu_j,V_{\rho} / n_j)</code>
</p>

<p><code class="reqn">\mu_j</code>: mean of <code class="reqn">\rho_{j'}</code> in the
neighborhood of <code class="reqn">j</code>.
</p>
<p><code class="reqn">V_{\rho}</code>: variance of the spatial random effects.
</p>
<p><code class="reqn">n_j</code>: number of neighbors for spatial entity <code class="reqn">j</code>.
</p>
<p><b>Observation process:</b>
</p>
<p style="text-align: center;"><code class="reqn">y_{it} \sim \mathcal{B}ernoulli(z_i * \delta_{it})</code>
</p>

<p style="text-align: center;"><code class="reqn">logit(\delta_{it}) = W_{it} \gamma</code>
</p>
 


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>mcmc</code></td>
<td>
<p>An mcmc object that contains the posterior sample. This
object can be summarized by functions provided by the coda
package. The posterior sample of the deviance <code class="reqn">D</code>, with
<code class="reqn">D=-2\log(\prod_i P(y_i,z_i|...))</code>, is also
provided.</p>
</td></tr>
<tr><td><code>rho.pred</code></td>
<td>
<p>If <code>save.rho</code> is set to 0 (default),
<code>rho.pred</code> is the predictive posterior mean of the spatial
random effect associated to each spatial entity. If <code>save.rho</code> is
set to 1, <code>rho.pred</code> is an <code>mcmc</code> object with sampled
values for each spatial random effect associated to each spatial
entity.</p>
</td></tr>
<tr><td><code>theta.pred</code></td>
<td>
<p>If <code>save.p</code> is set to 0 (default),
<code>theta.pred</code> is the predictive posterior mean of the
probability associated to the suitability process for each
prediction. If <code>save.p</code> is set to 1, <code>theta.pred</code> is an
<code>mcmc</code> object with sampled values of the probability associated
to the suitability process for each prediction.</p>
</td></tr>
<tr><td><code>theta.latent</code></td>
<td>
<p>Predictive posterior mean of the probability
associated to the suitability process for each site.</p>
</td></tr>
<tr><td><code>delta.latent</code></td>
<td>
<p>Predictive posterior mean of the probability
associated to the observability process for each observation.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent <a href="mailto:ghislain.vieilledent@cirad.fr">ghislain.vieilledent@cirad.fr</a>
</p>


<h3>References</h3>

<p>Diez, J. M. &amp; Pulliam, H. R. (2007) Hierarchical analysis of species
distributions and abundance across environmental gradients
<em>Ecology</em>, 88, 3144-3152.
</p>
<p>Gelfand, A. E.; Schmidt, A. M.; Wu, S.; Silander, J. A.; Latimer,
A. and Rebelo, A. G. (2005) Modelling species diversity through
species level hierarchical modelling. <em>Applied Statistics</em>, 54,
1-20.
</p>
<p>Latimer, A. M.; Wu, S. S.; Gelfand, A. E. and Silander, J. A. (2006)
Building statistical models to analyze species
distributions. <em>Ecological Applications</em>, 16, 33-50.
</p>
<p>Lichstein, J. W.; Simons, T. R.; Shriner, S. A. &amp; Franzreb,
K. E. (2002) Spatial autocorrelation and autoregressive models in
ecology <em>Ecological Monographs</em>, 72, 445-463.
</p>
<p>MacKenzie, D. I.; Nichols, J. D.; Lachman, G. B.; Droege, S.; Andrew
Royle, J. and Langtimm, C. A. (2002) Estimating site occupancy rates
when detection probabilities are less than one. <em>Ecology</em>, 83,
2248-2255.
</p>


<h3>See Also</h3>

<p><code><a href="coda.html#topic+plot.mcmc">plot.mcmc</a></code>, <code><a href="coda.html#topic+summary.mcmc">summary.mcmc</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run:  

#==============================================
# hSDM.siteocc.iCAR()
# Example with simulated data
#==============================================

#=================
#== Load libraries
library(hSDM)
library(raster)
library(sp)

#===================================
#== Multivariate normal distribution
rmvn &lt;- function(n, mu = 0, V = matrix(1), seed=1234) {
    p &lt;- length(mu)
    if (any(is.na(match(dim(V), p)))) {
        stop("Dimension problem!")
    }
    D &lt;- chol(V)
    set.seed(seed)
    t(matrix(rnorm(n*p),ncol=p)%*%D+rep(mu,rep(n,p)))
}

#==================
#== Data simulation

#= Set seed for repeatability
seed &lt;- 1234

#= Landscape
xLand &lt;- 30
yLand &lt;- 30 
Landscape &lt;- raster(ncol=xLand,nrow=yLand,crs='+proj=utm +zone=1')
Landscape[] &lt;- 0
extent(Landscape) &lt;- c(0,xLand,0,yLand)
coords &lt;- coordinates(Landscape)
ncells &lt;- ncell(Landscape)

#= Neighbors
neighbors.mat &lt;- adjacent(Landscape, cells=c(1:ncells), directions=8, pairs=TRUE, sorted=TRUE)
n.neighbors &lt;- as.data.frame(table(as.factor(neighbors.mat[,1])))[,2]
adj &lt;- neighbors.mat[,2]

#= Generate symmetric adjacency matrix, A
A &lt;- matrix(0,ncells,ncells)
index.start &lt;- 1
for (i in 1:ncells) {
    index.end &lt;- index.start+n.neighbors[i]-1
    A[i,adj[c(index.start:index.end)]] &lt;- 1
    index.start &lt;- index.end+1
}

#= Spatial effects
Vrho.target &lt;- 5
d &lt;- 1	# Spatial dependence parameter = 1 for intrinsic CAR
Q &lt;- diag(n.neighbors)-d*A + diag(.0001,ncells) # Add small constant to make Q non-singular
covrho &lt;- Vrho.target*solve(Q) # Covariance of rhos
set.seed(seed)
rho &lt;- c(rmvn(1,mu=rep(0,ncells),V=covrho,seed=seed)) # Spatial Random Effects
rho &lt;- rho-mean(rho) # Centering rhos on zero

#= Raster and plot spatial effects
r.rho &lt;- rasterFromXYZ(cbind(coords,rho))
plot(r.rho)

#= Sample the observation sites in the landscape
nsite &lt;- 250
set.seed(seed)
x.coord &lt;- runif(nsite,0,xLand)
set.seed(2*seed)
y.coord &lt;- runif(nsite,0,yLand)
sites.sp &lt;- SpatialPoints(coords=cbind(x.coord,y.coord))
cells &lt;- extract(Landscape,sites.sp,cell=TRUE)[,1]

#= Ecological process (suitability)
set.seed(seed)
x1 &lt;- rnorm(nsite,0,1)
set.seed(2*seed)
x2 &lt;- rnorm(nsite,0,1)
X &lt;- cbind(rep(1,nsite),x1,x2)
beta.target &lt;- c(-1,1,-1)
logit.theta &lt;- X %*% beta.target + rho[cells]
theta &lt;- inv.logit(logit.theta)
set.seed(seed)
Z &lt;- rbinom(nsite,1,theta)

#= Relative importance of spatial random effects
RImp &lt;- mean(abs(rho[cells])/abs(X %*% beta.target))
RImp

#= Number of visits associated to each observation point
set.seed(seed)
visits &lt;- rpois(nsite,3)
visits[visits==0] &lt;- 1
# Vector of observation points
sites &lt;- vector()
for (i in 1:nsite) {
    sites &lt;- c(sites,rep(i,visits[i]))
}

#= Observation process (detectability)
nobs &lt;- sum(visits)
set.seed(seed)
w1 &lt;- rnorm(nobs,0,1)
set.seed(2*seed)
w2 &lt;- rnorm(nobs,0,1)
W &lt;- cbind(rep(1,nobs),w1,w2)
gamma.target &lt;- c(-1,1,-1)
logit.delta &lt;- W %*% gamma.target
delta &lt;- inv.logit(logit.delta)
set.seed(seed)
Y &lt;- rbinom(nobs,1,delta*Z[sites])

#= Data-sets
data.obs &lt;- data.frame(Y,w1,w2,site=sites)
data.suit &lt;- data.frame(x1,x2,cell=cells)

#================================
#== Parameter inference with hSDM

Start &lt;- Sys.time() # Start the clock
mod.hSDM.siteocc.iCAR &lt;- hSDM.siteocc.iCAR(# Observations
                                           presence=data.obs$Y,
                                           observability=~w1+w2,
                                           site=data.obs$site,
                                           data.observability=data.obs,
                                           # Habitat
                                           suitability=~x1+x2, data.suitability=data.suit,
                                           # Spatial structure
                                           spatial.entity=data.suit$cell,
                                           n.neighbors=n.neighbors, neighbors=adj,
                                           # Predictions
                                           suitability.pred=NULL,
                                           spatial.entity.pred=NULL,
                                           # Chains
                                           burnin=10000, mcmc=5000, thin=5,
                                           # Starting values
                                           beta.start=0,
                                           gamma.start=0,
                                           Vrho.start=1,
                                           # Priors
                                           mubeta=0, Vbeta=1.0E6,
                                           mugamma=0, Vgamma=1.0E6,
                                           priorVrho="Uniform",
                                           Vrho.max=10,
                                           # Various
                                           seed=1234, verbose=1,
                                           save.rho=1, save.p=0)
Time.hSDM &lt;- difftime(Sys.time(),Start,units="sec") # Time difference

#= Computation time
Time.hSDM

#==========
#== Outputs

#= Parameter estimates 
summary(mod.hSDM.siteocc.iCAR$mcmc)
pdf("Posteriors_hSDM.siteocc.iCAR.pdf")
plot(mod.hSDM.siteocc.iCAR$mcmc)
dev.off()

#= Predictions
summary(mod.hSDM.siteocc.iCAR$theta.latent)
summary(mod.hSDM.siteocc.iCAR$delta.latent)
summary(mod.hSDM.siteocc.iCAR$theta.pred)
pdf(file="Pred-Init.pdf")
plot(theta,mod.hSDM.siteocc.iCAR$theta.pred)
abline(a=0,b=1,col="red")
dev.off()

#= Summary plots for spatial random effects

# rho.pred
rho.pred &lt;- apply(mod.hSDM.siteocc.iCAR$rho.pred,2,mean)
r.rho.pred &lt;- rasterFromXYZ(cbind(coords,rho.pred))

# plot
pdf(file="Summary_hSDM.siteocc.iCAR.pdf")
par(mfrow=c(2,2))
# rho target
plot(r.rho, main="rho target")
plot(sites.sp,add=TRUE)
# rho estimated
plot(r.rho.pred, main="rho estimated")
# correlation and "shrinkage"
Levels.cells &lt;- sort(unique(cells))
plot(rho[-Levels.cells],rho.pred[-Levels.cells],
     xlim=range(rho),
     ylim=range(rho),
     xlab="rho target",
     ylab="rho estimated")
points(rho[Levels.cells],rho.pred[Levels.cells],pch=16,col="blue")
legend(x=-3,y=4,legend="Visited cells",col="blue",pch=16,bty="n")
abline(a=0,b=1,col="red")
dev.off()


## End(Not run)

</code></pre>

<hr>
<h2 id='hSDM.ZIB'>ZIB (Zero-Inflated Binomial) model</h2><span id='topic+hSDM.ZIB'></span>

<h3>Description</h3>

<p>The <code>hSDM.ZIB</code> function can be used to
model species distribution including different processes in a
hierarchical Bayesian framework: a
<code class="reqn">\mathcal{B}ernoulli</code> suitability process (refering to
environmental suitability) and a <code class="reqn">\mathcal{B}inomial</code>
observability process (refering to various ecological and
methodological issues explaining the species detection). The
<code>hSDM.ZIB</code> function calls a Gibbs sampler written in C
code which uses a Metropolis algorithm to estimate the conditional
posterior distribution of hierarchical model's parameters.</p>


<h3>Usage</h3>

<pre><code class='language-R'>hSDM.ZIB(presences, trials, suitability,
observability, data, suitability.pred=NULL, burnin = 5000, mcmc = 10000,
thin = 10, beta.start, gamma.start, mubeta = 0, Vbeta = 1e+06, mugamma =
0, Vgamma = 1e+06, seed = 1234, verbose = 1, save.p = 0)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hSDM.ZIB_+3A_presences">presences</code></td>
<td>
<p>A vector indicating the number of successes (or
presences) for each observation.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB_+3A_trials">trials</code></td>
<td>
<p>A vector indicating the number of trials for each
observation. <code class="reqn">t_i</code> should be superior to zero and superior or
equal to <code class="reqn">y_i</code>, the number of successes for observation <code class="reqn">i</code>.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB_+3A_suitability">suitability</code></td>
<td>
<p>A one-sided formula of the form
<code class="reqn">\sim x_1+...+x_p</code> with <code class="reqn">p</code> terms specifying the
explicative variables for the suitability process.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB_+3A_observability">observability</code></td>
<td>
<p>A one-sided formula of the form
<code class="reqn">\sim w_1+...+w_q</code> with <code class="reqn">q</code> terms specifying the
explicative variables for the observability process.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB_+3A_data">data</code></td>
<td>
<p>A data frame containing the model's variables.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB_+3A_suitability.pred">suitability.pred</code></td>
<td>
<p>An optional data frame in which to look for
variables with which to predict. If NULL, the observations are
used.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB_+3A_burnin">burnin</code></td>
<td>
<p>The number of burnin iterations for the sampler.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB_+3A_mcmc">mcmc</code></td>
<td>
<p>The number of Gibbs iterations for the sampler. Total
number of Gibbs iterations is equal to
<code>burnin+mcmc</code>. <code>burnin+mcmc</code> must be divisible by 10 and
superior or equal to 100 so that the progress bar can be displayed.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB_+3A_thin">thin</code></td>
<td>
<p>The thinning interval used in the simulation. The number
of mcmc iterations must be divisible by this value.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB_+3A_beta.start">beta.start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters of
the suitability process. This can either be a scalar or a
<code class="reqn">p</code>-length vector.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB_+3A_gamma.start">gamma.start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters
of the observability process. This can either be a scalar or a
<code class="reqn">q</code>-length vector.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB_+3A_mubeta">mubeta</code></td>
<td>
<p>Means of the priors for the <code class="reqn">\beta</code> parameters
of the suitability process. <code>mubeta</code> must be either a scalar or a
p-length vector. If <code>mubeta</code> takes a scalar value, then that value will
serve as the prior mean for all of the betas. The default value is set
to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB_+3A_vbeta">Vbeta</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\beta</code>
parameters of the suitability process. <code>Vbeta</code> must be either a
scalar or a p-length vector. If <code>Vbeta</code> takes a scalar value,
then that value will serve as the prior variance for all of the
betas. The default variance is large and set to 1.0E6 for an
uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB_+3A_mugamma">mugamma</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\gamma</code>
parameters of the observability process. <code>mugamma</code> must be either
a scalar or a p-length vector. If <code>mugamma</code> takes a scalar value,
then that value will serve as the prior mean for all of the
gammas. The default value is set to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB_+3A_vgamma">Vgamma</code></td>
<td>
<p>Variances of the Normal priors for the
<code class="reqn">\gamma</code> parameters of the observability
process. <code>Vgamma</code> must be either a scalar or a p-length
vector. If <code>Vgamma</code> takes a scalar value, then that value will
serve as the prior variance for all of the gammas. The default
variance is large and set to 1.0E6 for an uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB_+3A_seed">seed</code></td>
<td>
<p>The seed for the random number generator. Default set to
1234.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB_+3A_verbose">verbose</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
progress of the sampler is printed to the screen. Default is 1: a
progress bar is printed, indicating the step (in %) reached by the
Gibbs sampler.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB_+3A_save.p">save.p</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for predictions are saved. Default is 0: the
posterior mean is computed and returned in the <code>prob.p.pred</code>
vector. Be careful, setting <code>save.p</code> to 1 might require a large
amount of memory.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The model integrates two processes, an ecological process associated
to the presence or absence of the species due to habitat suitability
and an observation process that takes into account the fact that the
probability of detection of the species is inferior to one.
</p>
<p><b>Ecological process:</b>
</p>
<p style="text-align: center;"><code class="reqn">z_i \sim \mathcal{B}ernoulli(\theta_i)</code>
</p>

<p style="text-align: center;"><code class="reqn">logit(\theta_i) = X_i \beta</code>
</p>

<p><b>Observation process:</b>
</p>
<p style="text-align: center;"><code class="reqn">y_i \sim \mathcal{B}inomial(z_i * \delta_i, t_i)</code>
</p>

<p style="text-align: center;"><code class="reqn">logit(\delta_i) = W_i \gamma</code>
</p>
 


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>mcmc</code></td>
<td>
<p>An mcmc object that contains the posterior sample. This
object can be summarized by functions provided by the coda
package. The posterior sample of the deviance <code class="reqn">D</code>, with
<code class="reqn">D=-2\log(\prod_i P(y_i,z_i|...))</code>, is also
provided.</p>
</td></tr>
<tr><td><code>prob.p.pred</code></td>
<td>
<p>If <code>save.p</code> is set to 0 (default),
<code>prob.p.pred</code> is the predictive posterior mean of the
probability associated to the suitability process for each
prediction. If <code>save.p</code> is set to 1, <code>prob.p.pred</code> is an
<code>mcmc</code> object with sampled values of the probability associated
to the suitability process for each prediction.</p>
</td></tr>
<tr><td><code>prob.p.latent</code></td>
<td>
<p>Predictive posterior mean of the probability
associated to the suitability process for each observation.</p>
</td></tr>
<tr><td><code>prob.q.latent</code></td>
<td>
<p>Predictive posterior mean of the probability
associated to the observability process for each observation.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent <a href="mailto:ghislain.vieilledent@cirad.fr">ghislain.vieilledent@cirad.fr</a>
</p>


<h3>References</h3>

<p>Gelfand, A. E.; Schmidt, A. M.; Wu, S.; Silander, J. A.; Latimer, A. and
Rebelo, A. G. (2005) Modelling species diversity through species level
hierarchical modelling. <em>Applied Statistics</em>, 54, 1-20.
</p>
<p>Latimer, A. M.; Wu, S. S.; Gelfand, A. E. and Silander, J. A. (2006) Building
statistical models to analyze species distributions. <em>Ecological
Applications</em>, 16, 33-50.
</p>
<p>MacKenzie, D. I.; Nichols, J. D.; Lachman, G. B.; Droege, S.; Andrew
Royle, J. and Langtimm, C. A. (2002) Estimating site occupancy rates when
detection probabilities are less than one. <em>Ecology</em>, 83, 2248-2255.
</p>


<h3>See Also</h3>

<p><code><a href="coda.html#topic+plot.mcmc">plot.mcmc</a></code>, <code><a href="coda.html#topic+summary.mcmc">summary.mcmc</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run:  

#==============================================
# hSDM.ZIB()
# Example with simulated data
#==============================================

#============
#== Preambule
library(hSDM)

#==================
#== Data simulation

# Set seed for repeatability
seed &lt;- 1234

# Number of observations
nobs &lt;- 1000

# Target parameters
beta.target &lt;- matrix(c(0.2,0.5,0.5),ncol=1)
gamma.target &lt;- matrix(c(1),ncol=1)
## Uncomment if you want covariates on the observability process
## gamma.target &lt;- matrix(c(0.2,0.5,0.5),ncol=1)

# Covariates for "suitability" process
set.seed(seed)
X1 &lt;- rnorm(n=nobs,0,1)
set.seed(2*seed)
X2 &lt;- rnorm(n=nobs,0,1)
X &lt;- cbind(rep(1,nobs),X1,X2)

# Covariates for "observability" process
W &lt;- cbind(rep(1,nobs))
## Uncomment if you want covariates on the observability process 
## set.seed(3*seed)
## W1 &lt;- rnorm(n=nobs,0,1)
## set.seed(4*seed)
## W2 &lt;- rnorm(n=nobs,0,1)
## W &lt;- cbind(rep(1,nobs),W1,W2)

#== Simulating latent variables

# Suitability
logit.theta.1 &lt;- X %*% beta.target
theta.1 &lt;- inv.logit(logit.theta.1)
set.seed(seed)
y.1 &lt;- rbinom(nobs,1,theta.1)

# Observability
set.seed(seed)
trials &lt;- rpois(nobs,5)	# Number of trial associated to each observation
trials[trials==0] &lt;- 1
logit.theta.2 &lt;- W %*% gamma.target
theta.2 &lt;- inv.logit(logit.theta.2)
set.seed(seed)
y.2 &lt;- rbinom(nobs,trials,theta.2)

#== Simulating response variable
Y &lt;- y.2*y.1

#== Data-set
Data &lt;- data.frame(Y,trials,X1,X2)
## Uncomment if you want covariates on the observability process 
## Data &lt;- data.frame(Y,trials,X1,X2,W1,W2)

#==================================
#== ZIB model

mod.hSDM.ZIB &lt;- hSDM.ZIB(presences=Data$Y,
                         trials=Data$trials,
                         suitability=~X1+X2,
                         observability=~1, #=~1+W1+W2 if covariates
                         data=Data,
                         suitability.pred=NULL,
                         burnin=1000, mcmc=1000, thin=5,
                         beta.start=0,
                         gamma.start=0,
                         mubeta=0, Vbeta=1.0E6,
                         mugamma=0, Vgamma=1.0E6,
                         seed=1234, verbose=1,
                         save.p=0)

#==========
#== Outputs
pdf(file="Posteriors_hSDM.ZIB.pdf")
plot(mod.hSDM.ZIB$mcmc)
dev.off()
summary(mod.hSDM.ZIB$prob.p.latent)
summary(mod.hSDM.ZIB$prob.q.latent)
summary(mod.hSDM.ZIB$prob.p.pred)


## End(Not run)

</code></pre>

<hr>
<h2 id='hSDM.ZIB.iCAR'>ZIB (Zero-Inflated Binomial) model with CAR process</h2><span id='topic+hSDM.ZIB.iCAR'></span>

<h3>Description</h3>

<p>The <code>hSDM.ZIB.iCAR</code> function can be used to
model species distribution including different processes in a
hierarchical Bayesian framework: a
<code class="reqn">\mathcal{B}ernoulli</code> suitability process (refering to
environmental suitability) which takes into account the spatial
dependence of the observations, and a
<code class="reqn">\mathcal{B}inomial</code> observability process (refering to
various ecological and methodological issues explaining the species
detection). The <code>hSDM.ZIB.iCAR</code> function calls a Gibbs
sampler written in C code which uses an adaptive Metropolis algorithm
to estimate the conditional posterior distribution of hierarchical
model's parameters.</p>


<h3>Usage</h3>

<pre><code class='language-R'>hSDM.ZIB.iCAR(presences, trials, suitability,
observability, spatial.entity, data, n.neighbors, neighbors,
suitability.pred=NULL, spatial.entity.pred=NULL, burnin = 5000, mcmc =
10000, thin = 10, beta.start, gamma.start, Vrho.start, mubeta = 0, Vbeta
= 1e+06, mugamma = 0, Vgamma = 1e+06, priorVrho = "1/Gamma", shape =
0.5, rate = 0.0005, Vrho.max=1000, seed = 1234, verbose = 1, save.rho =
0, save.p = 0)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hSDM.ZIB.iCAR_+3A_presences">presences</code></td>
<td>
<p>A vector indicating the number of successes (or
presences) for each observation.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_trials">trials</code></td>
<td>
<p>A vector indicating the number of trials for each
observation. <code class="reqn">t_i</code> should be superior to zero and superior or
equal to <code class="reqn">y_i</code>, the number of successes for observation <code class="reqn">i</code>.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_suitability">suitability</code></td>
<td>
<p>A one-sided formula of the form
<code class="reqn">\sim x_1+...+x_p</code> with <code class="reqn">p</code> terms specifying the
explicative variables for the suitability process.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_observability">observability</code></td>
<td>
<p>A one-sided formula of the form
<code class="reqn">\sim w_1+...+w_q</code> with <code class="reqn">q</code> terms specifying the
explicative variables for the observability process.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_spatial.entity">spatial.entity</code></td>
<td>
<p>A vector indicating the spatial entity
identifier (from one to the total number of entities) for each
observation. Several observations can occur in one spatial entity. A
spatial entity can be a raster cell for example.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_data">data</code></td>
<td>
<p>A data frame containing the model's variables.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_n.neighbors">n.neighbors</code></td>
<td>
<p>A vector of integers that indicates the number of
neighbors (adjacent entities) of each spatial
entity. <code>length(n.neighbors)</code> indicates the total number of
spatial entities.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_neighbors">neighbors</code></td>
<td>
<p>A vector of integers indicating the neighbors
(adjacent entities) of each spatial entity. Must be of the form
c(neighbors of entity 1, neighbors of entity 2, ... , neighbors of
the last entity). Length of the <code>neighbors</code> vector should be
equal to <code>sum(n.neighbors)</code>.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_suitability.pred">suitability.pred</code></td>
<td>
<p>An optional data frame in which to look for
variables with which to predict. If NULL, the observations are
used.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_spatial.entity.pred">spatial.entity.pred</code></td>
<td>
<p>An optional vector indicating the spatial
entity identifier (from one to the total number of entities) for
predictions. If NULL, the vector <code>spatial.entity</code> for
observations is used.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_burnin">burnin</code></td>
<td>
<p>The number of burnin iterations for the sampler.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_mcmc">mcmc</code></td>
<td>
<p>The number of Gibbs iterations for the sampler. Total
number of Gibbs iterations is equal to
<code>burnin+mcmc</code>. <code>burnin+mcmc</code> must be divisible by 10 and
superior or equal to 100 so that the progress bar can be displayed.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_thin">thin</code></td>
<td>
<p>The thinning interval used in the simulation. The number
of mcmc iterations must be divisible by this value.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_beta.start">beta.start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters of
the suitability process. This can either be a scalar or a
<code class="reqn">p</code>-length vector.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_gamma.start">gamma.start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters
of the observability process. This can either be a scalar or a
<code class="reqn">q</code>-length vector.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_vrho.start">Vrho.start</code></td>
<td>
<p>Positive scalar indicating the starting value for the
variance of the spatial random effects.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_mubeta">mubeta</code></td>
<td>
<p>Means of the priors for the <code class="reqn">\beta</code> parameters
of the suitability process. <code>mubeta</code> must be either a scalar or a
p-length vector. If <code>mubeta</code> takes a scalar value, then that value will
serve as the prior mean for all of the betas. The default value is set
to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_vbeta">Vbeta</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\beta</code>
parameters of the suitability process. <code>Vbeta</code> must be either a
scalar or a p-length vector. If <code>Vbeta</code> takes a scalar value,
then that value will serve as the prior variance for all of the
betas. The default variance is large and set to 1.0E6 for an
uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_mugamma">mugamma</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\gamma</code>
parameters of the observability process. <code>mugamma</code> must be either
a scalar or a p-length vector. If <code>mugamma</code> takes a scalar value,
then that value will serve as the prior mean for all of the
gammas. The default value is set to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_vgamma">Vgamma</code></td>
<td>
<p>Variances of the Normal priors for the
<code class="reqn">\gamma</code> parameters of the observability
process. <code>Vgamma</code> must be either a scalar or a p-length
vector. If <code>Vgamma</code> takes a scalar value, then that value will
serve as the prior variance for all of the gammas. The default
variance is large and set to 1.0E6 for an uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_priorvrho">priorVrho</code></td>
<td>
<p>Type of prior for the variance of the spatial random
effects. Can be set to a fixed positive scalar, or to an inverse-gamma
distribution (&quot;1/Gamma&quot;) with parameters <code>shape</code> and <code>rate</code>,
or to a uniform distribution (&quot;Uniform&quot;) on the interval
[0,<code>Vrho.max</code>]. Default set to &quot;1/Gamma&quot;.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_shape">shape</code></td>
<td>
<p>The shape parameter for the Gamma prior on the precision
of the spatial random effects. Default value is <code>shape=0.05</code> for
uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_rate">rate</code></td>
<td>
<p>The rate (1/scale) parameter for the Gamma prior on the
precision of the spatial random effects. Default value is
<code>rate=0.0005</code> for uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_vrho.max">Vrho.max</code></td>
<td>
<p>Upper bound for the uniform prior of the spatial
random effect variance. Default set to 1000.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_seed">seed</code></td>
<td>
<p>The seed for the random number generator. Default set to
1234.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_verbose">verbose</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
progress of the sampler is printed to the screen. Default is 1: a
progress bar is printed, indicating the step (in %) reached by the
Gibbs sampler.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_save.rho">save.rho</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for rhos are saved. Default is 0: the posterior mean
is computed and returned in the <code>rho.pred</code> vector. Be careful,
setting <code>save.rho</code> to 1 might require a large amount of
memory.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR_+3A_save.p">save.p</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for predictions are saved. Default is 0: the
posterior mean is computed and returned in the <code>prob.p.pred</code>
vector. Be careful, setting <code>save.p</code> to 1 might require a large
amount of memory.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The model integrates two processes, an ecological process associated
to the presence or absence of the species due to habitat suitability
and an observation process that takes into account the fact that the
probability of detection of the species is inferior to one. The
ecological process includes an intrinsic conditional autoregressive
model (iCAR) model for spatial autocorrelation between observations,
assuming that the probability of presence of the species at one site
depends on the probability of presence of the species on neighboring
sites.
</p>
<p><b>Ecological process:</b>
</p>
<p style="text-align: center;"><code class="reqn">z_i \sim \mathcal{B}ernoulli(\theta_i)</code>
</p>

<p style="text-align: center;"><code class="reqn">logit(\theta_i) = X_i \beta + \rho_{j(i)}</code>
</p>

<p><code class="reqn">\rho_j</code>: spatial random effect
</p>
<p><code class="reqn">j(i)</code>: index of the spatial entity for observation <code class="reqn">i</code>.
</p>
<p><b>Spatial autocorrelation:</b>
</p>
<p>An intrinsic conditional autoregressive model (iCAR) is assumed:
</p>
<p style="text-align: center;"><code class="reqn">\rho_j \sim \mathcal{N}ormal(\mu_j,V_{\rho} / n_j)</code>
</p>

<p><code class="reqn">\mu_j</code>: mean of <code class="reqn">\rho_{j'}</code> in the
neighborhood of <code class="reqn">j</code>.
</p>
<p><code class="reqn">V_{\rho}</code>: variance of the spatial random effects.
</p>
<p><code class="reqn">n_j</code>: number of neighbors for spatial entity <code class="reqn">j</code>.
</p>
<p><b>Observation process:</b>
</p>
<p style="text-align: center;"><code class="reqn">y_i \sim \mathcal{B}inomial(z_i * \delta_i, t_i)</code>
</p>

<p style="text-align: center;"><code class="reqn">logit(\delta_i) = W_i \gamma</code>
</p>
 


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>mcmc</code></td>
<td>
<p>An mcmc object that contains the posterior sample. This
object can be summarized by functions provided by the coda
package. The posterior sample of the deviance <code class="reqn">D</code>, with
<code class="reqn">D=-2\log(\prod_i P(y_i,z_i|...))</code>, is also
provided.</p>
</td></tr>
<tr><td><code>rho.pred</code></td>
<td>
<p>If <code>save.rho</code> is set to 0 (default),
<code>rho.pred</code> is the predictive posterior mean of the spatial
random effect associated to each spatial entity. If <code>save.rho</code> is
set to 1, <code>rho.pred</code> is an <code>mcmc</code> object with sampled
values for each spatial random effect associated to each spatial
entity.</p>
</td></tr>
<tr><td><code>prob.p.pred</code></td>
<td>
<p>If <code>save.p</code> is set to 0 (default),
<code>prob.p.pred</code> is the predictive posterior mean of the
probability associated to the suitability process for each
prediction. If <code>save.p</code> is set to 1, <code>prob.p.pred</code> is an
<code>mcmc</code> object with sampled values of the probability associated
to the suitability process for each prediction.</p>
</td></tr>
<tr><td><code>prob.p.latent</code></td>
<td>
<p>Predictive posterior mean of the probability
associated to the suitability process for each observation.</p>
</td></tr>
<tr><td><code>prob.q.latent</code></td>
<td>
<p>Predictive posterior mean of the probability
associated to the observability process for each observation.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent <a href="mailto:ghislain.vieilledent@cirad.fr">ghislain.vieilledent@cirad.fr</a>
</p>


<h3>References</h3>

<p>Gelfand, A. E.; Schmidt, A. M.; Wu, S.; Silander, J. A.; Latimer, A. and
Rebelo, A. G. (2005) Modelling species diversity through species level
hierarchical modelling. <em>Applied Statistics</em>, 54, 1-20.
</p>
<p>Latimer, A. M.; Wu, S. S.; Gelfand, A. E. and Silander, J. A. (2006) Building
statistical models to analyze species distributions. <em>Ecological
Applications</em>, 16, 33-50.
</p>
<p>MacKenzie, D. I.; Nichols, J. D.; Lachman, G. B.; Droege, S.; Andrew
Royle, J. and Langtimm, C. A. (2002) Estimating site occupancy rates when
detection probabilities are less than one. <em>Ecology</em>, 83, 2248-2255.
</p>


<h3>See Also</h3>

<p><code><a href="coda.html#topic+plot.mcmc">plot.mcmc</a></code>, <code><a href="coda.html#topic+summary.mcmc">summary.mcmc</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run:  

#==============================================
# hSDM.ZIB.iCAR()
# Example with simulated data
#==============================================

#============
#== Preambule
library(hSDM)
library(raster)
library(sp)
library(mvtnorm)

#==================
#== Data simulation

# Set seed for repeatability
seed &lt;- 1234

# Target parameters
beta.target &lt;- matrix(c(0.2,0.5,0.5),ncol=1)
gamma.target &lt;- matrix(c(1),ncol=1)
## Uncomment if you want covariates on the observability process
## gamma.target &lt;- matrix(c(0.2,0.5,0.5),ncol=1)
Vrho.target &lt;- 1 # Spatial Variance

# Landscape
Landscape &lt;- raster(ncol=20,nrow=20,crs='+proj=utm +zone=1')
ncell &lt;- ncell(Landscape)

# Neighbors
neighbors.mat &lt;- adjacent(Landscape, cells=c(1:ncell), directions=8, pairs=TRUE, sorted=TRUE)
n.neighbors &lt;- as.data.frame(table(as.factor(neighbors.mat[,1])))[,2]
adj &lt;- neighbors.mat[,2]

# Generate symmetric adjacency matrix, A
A &lt;- matrix(0,ncell,ncell)
index.start &lt;- 1
for (i in 1:ncell) {
    index.end &lt;- index.start+n.neighbors[i]-1
    A[i,adj[c(index.start:index.end)]] &lt;- 1
    index.start &lt;- index.end+1
}

# Spatial effects
d &lt;- 1	# Spatial dependence parameter = 1 for intrinsic CAR
Q &lt;- diag(n.neighbors)-d*A + diag(.0001,ncell) # Add small constant to make Q non-singular
covrho &lt;- Vrho.target*solve(Q) # Covariance of rhos
set.seed(seed)
rho &lt;- c(rmvnorm(1,sigma=covrho)) # Spatial Random Effects
rho &lt;- rho-mean(rho) # Centering rhos on zero

# Visited cells
n.visited &lt;- 150 # Compare with 400, 350 and 100 for example
set.seed(seed)
visited.cells &lt;- sort(sample(1:ncell,n.visited,replace=FALSE)) # Draw visited cells at random
notvisited.cells &lt;- c(1:ncell)[-visited.cells]

# Number of observations
nobs &lt;- 300

# Cell vector
set.seed(seed)
cells &lt;- c(visited.cells,sample(visited.cells,nobs-n.visited,replace=TRUE))
coords &lt;- xyFromCell(Landscape,cells) # Get coordinates

# Covariates for "suitability" process
set.seed(seed)
X1.cell &lt;- rnorm(n=ncell,0,1)
set.seed(2*seed)
X2.cell &lt;- rnorm(n=ncell,0,1)
X1 &lt;- X1.cell[cells]
X2 &lt;- X2.cell[cells]
X &lt;- cbind(rep(1,nobs),X1,X2)

# Covariates for "observability" process
W &lt;- cbind(rep(1,nobs))
## Uncomment if you want covariates on the observability process 
## set.seed(3*seed)
## W1 &lt;- rnorm(n=nobs,0,1)
## set.seed(4*seed)
## W2 &lt;- rnorm(n=nobs,0,1)
## W &lt;- cbind(rep(1,nobs),W1,W2)

#== Simulating latent variables

# Suitability
logit.theta.1 &lt;- vector()
for (n in 1:nobs) {
  logit.theta.1[n] &lt;- X[n,]%*%beta.target+rho[cells[n]]
}
theta.1 &lt;- inv.logit(logit.theta.1)
set.seed(seed)
y.1 &lt;- rbinom(nobs,1,theta.1)

# Observability
set.seed(seed)
trials &lt;- rpois(nobs,5)	# Number of trial associated to each observation
trials[trials==0] &lt;- 1
logit.theta.2 &lt;- W%*%gamma.target
theta.2 &lt;- inv.logit(logit.theta.2)
set.seed(seed)
y.2 &lt;- rbinom(nobs,trials,theta.2)

#== Simulating response variable
Y &lt;- y.2*y.1

#== Data-set
Data &lt;- data.frame(Y,trials,cells,X1,X2)
## Uncomment if you want covariates on the observability process 
## Data &lt;- data.frame(Y,trials,cells,X1,X2,W1,W2)
Data &lt;- SpatialPointsDataFrame(coords=coords,data=Data)
plot(Data)

#== Data-set for predictions (suitability on each spatial cell)
Data.pred &lt;- data.frame(X1=X1.cell,X2=X2.cell,cells=c(1:ncell))

#==================================
#== Site-occupancy model

mod.hSDM.ZIB.iCAR &lt;- hSDM.ZIB.iCAR(presences=Data$Y,
                                   trials=Data$trials,
                                   suitability=~X1+X2,
                                   observability=~1,
                                   spatial.entity=Data$cells,
                                   data=Data,
                                   n.neighbors=n.neighbors,
                                   neighbors=adj,
                                   ## suitability.pred=NULL,
                                   ## spatial.entity.pred=NULL,
                                   suitability.pred=Data.pred,
                                   spatial.entity.pred=Data.pred$cells,
                                   burnin=5000, mcmc=5000, thin=5,
                                   beta.start=0,
                                   gamma.start=0,
                                   Vrho.start=10,
                                   priorVrho="1/Gamma",
                                   #priorVrho="Uniform",
                                   #priorVrho=10,
                                   mubeta=0, Vbeta=1.0E6,
                                   mugamma=0, Vgamma=1.0E6,
                                   shape=0.5, rate=0.0005,
                                   #Vrho.max=1000,
                                   seed=1234, verbose=1,
                                   save.rho=1, save.p=0)

#==========
#== Outputs

#= Parameter estimates
summary(mod.hSDM.ZIB.iCAR$mcmc)

#= MCMC and posteriors
pdf(file="Posteriors_hSDM.ZIB.iCAR.pdf")
plot(mod.hSDM.ZIB.iCAR$mcmc)
dev.off()

pdf(file="Posteriors.rho_hSDM.ZIB.iCAR.pdf")
plot(mod.hSDM.ZIB.iCAR$rho.pred)
dev.off()

#= Summary plots

# rho
r.rho &lt;- r.rho.pred &lt;- r.visited &lt;- Landscape
r.rho[] &lt;- rho
rho.pred &lt;- apply(mod.hSDM.ZIB.iCAR$rho.pred,2,mean)
r.rho.pred[] &lt;- rho.pred
r.visited[] &lt;- 0
r.visited[visited.cells] &lt;- 1
# prob.p
r.prob.p &lt;- Landscape
r.prob.p[] &lt;- mod.hSDM.ZIB.iCAR$prob.p.pred

pdf(file="Summary_hSDM.ZIB.iCAR.pdf")
par(mfrow=c(3,2))
plot(r.rho, main="rho target")
plot(r.visited,main="Visited cells and presences")
plot(Data[Y&gt;0,],add=TRUE,pch=16,cex=0.5)
plot(r.rho.pred, main="rho estimated")
plot(rho[visited.cells],rho.pred[visited.cells],
     xlab="rho target",
     ylab="rho estimated")
points(rho[notvisited.cells],rho.pred[notvisited.cells],pch=16,col="blue")
legend(x=-4,y=3.5,legend="Unvisited cells",col="blue",pch=16,bty="n")
abline(a=0,b=1,col="red")
plot(r.prob.p,main="Proba of presence")
plot(Data[Y&gt;0,],add=TRUE,pch=16,cex=0.5)
dev.off()


## End(Not run)

</code></pre>

<hr>
<h2 id='hSDM.ZIB.iCAR.alteration'>ZIB (Zero-Inflated Binomial) model with CAR process taking into
account site alteration</h2><span id='topic+hSDM.ZIB.iCAR.alteration'></span>

<h3>Description</h3>

<p>The <code>hSDM.ZIB.iCAR.alteration</code> function can be
used to model species distribution including different processes in a
hierarchical Bayesian framework: (i) a
<code class="reqn">\mathcal{B}ernoulli</code> suitability process (refering to
environmental suitability) which takes into account the spatial
dependence of the observations, (ii) an alteration process (refering
to anthropogenic disturbances), and (iii) a
<code class="reqn">\mathcal{B}inomial</code> observability process (refering to
various ecological and methodological issues explaining the species
detection). The <code>hSDM.ZIB.iCAR.alteration</code> function calls a
Gibbs sampler written in C code which uses an adaptive Metropolis
algorithm to estimate the conditional posterior distribution of
hierarchical model's parameters.</p>


<h3>Usage</h3>

<pre><code class='language-R'>hSDM.ZIB.iCAR.alteration(presences, trials, suitability,
observability, spatial.entity, alteration, data, n.neighbors, neighbors,
suitability.pred=NULL, spatial.entity.pred=NULL, burnin = 5000, mcmc =
10000, thin = 10, beta.start, gamma.start, Vrho.start, mubeta = 0, Vbeta
= 1e+06, mugamma = 0, Vgamma = 1e+06, priorVrho = "1/Gamma", shape =
0.5, rate = 0.0005, Vrho.max=1000, seed = 1234, verbose = 1, save.rho =
0, save.p = 0)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_presences">presences</code></td>
<td>
<p>A vector indicating the number of successes (or
presences) for each observation.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_trials">trials</code></td>
<td>
<p>A vector indicating the number of trials for each
observation. <code class="reqn">t_i</code> should be superior to zero and superior or
equal to <code class="reqn">y_i</code>, the number of successes for observation <code class="reqn">i</code>.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_suitability">suitability</code></td>
<td>
<p>A one-sided formula of the form
<code class="reqn">\sim x_1+...+x_p</code> with <code class="reqn">p</code> terms specifying the
explicative variables for the suitability process.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_observability">observability</code></td>
<td>
<p>A one-sided formula of the form
<code class="reqn">\sim w_1+...+w_q</code> with <code class="reqn">q</code> terms specifying the
explicative variables for the observability process.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_spatial.entity">spatial.entity</code></td>
<td>
<p>A vector indicating the spatial entity
identifier (from one to the total number of entities) for each
observation. Several observations can occur in one spatial entity. A
spatial entity can be a raster cell for example.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_alteration">alteration</code></td>
<td>
<p>A vector indicating the proportion of area in the
spatial cell which is transformed (by anthropogenic activities for
example) for each observation. Must be between 0 and 1.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_data">data</code></td>
<td>
<p>A data frame containing the model's variables.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_n.neighbors">n.neighbors</code></td>
<td>
<p>A vector of integers that indicates the number of
neighbors (adjacent entities) of each spatial
entity. <code>length(n.neighbors)</code> indicates the total number of
spatial entities.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_neighbors">neighbors</code></td>
<td>
<p>A vector of integers indicating the neighbors
(adjacent entities) of each spatial entity. Must be of the form
c(neighbors of entity 1, neighbors of entity 2, ... , neighbors of
the last entity). Length of the <code>neighbors</code> vector should be
equal to <code>sum(n.neighbors)</code>.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_suitability.pred">suitability.pred</code></td>
<td>
<p>An optional data frame in which to look for
variables with which to predict. If NULL, the observations are
used.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_spatial.entity.pred">spatial.entity.pred</code></td>
<td>
<p>An optional vector indicating the spatial
entity identifier (from one to the total number of entities) for
predictions. If NULL, the vector <code>spatial.entity</code> for
observations is used.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_burnin">burnin</code></td>
<td>
<p>The number of burnin iterations for the sampler.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_mcmc">mcmc</code></td>
<td>
<p>The number of Gibbs iterations for the sampler. Total
number of Gibbs iterations is equal to
<code>burnin+mcmc</code>. <code>burnin+mcmc</code> must be divisible by 10 and
superior or equal to 100 so that the progress bar can be displayed.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_thin">thin</code></td>
<td>
<p>The thinning interval used in the simulation. The number
of mcmc iterations must be divisible by this value.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_beta.start">beta.start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters of
the suitability process. This can either be a scalar or a
<code class="reqn">p</code>-length vector.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_gamma.start">gamma.start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters
of the observability process. This can either be a scalar or a
<code class="reqn">q</code>-length vector.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_vrho.start">Vrho.start</code></td>
<td>
<p>Positive scalar indicating the starting value for the
variance of the spatial random effects.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_mubeta">mubeta</code></td>
<td>
<p>Means of the priors for the <code class="reqn">\beta</code> parameters
of the suitability process. <code>mubeta</code> must be either a scalar or a
p-length vector. If <code>mubeta</code> takes a scalar value, then that value will
serve as the prior mean for all of the betas. The default value is set
to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_vbeta">Vbeta</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\beta</code>
parameters of the suitability process. <code>Vbeta</code> must be either a
scalar or a p-length vector. If <code>Vbeta</code> takes a scalar value,
then that value will serve as the prior variance for all of the
betas. The default variance is large and set to 1.0E6 for an
uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_mugamma">mugamma</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\gamma</code>
parameters of the observability process. <code>mugamma</code> must be either
a scalar or a p-length vector. If <code>mugamma</code> takes a scalar value,
then that value will serve as the prior mean for all of the
gammas. The default value is set to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_vgamma">Vgamma</code></td>
<td>
<p>Variances of the Normal priors for the
<code class="reqn">\gamma</code> parameters of the observability
process. <code>Vgamma</code> must be either a scalar or a p-length
vector. If <code>Vgamma</code> takes a scalar value, then that value will
serve as the prior variance for all of the gammas. The default
variance is large and set to 1.0E6 for an uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_priorvrho">priorVrho</code></td>
<td>
<p>Type of prior for the variance of the spatial random
effects. Can be set to a fixed positive scalar, or to an inverse-gamma
distribution (&quot;1/Gamma&quot;) with parameters <code>shape</code> and <code>rate</code>,
or to a uniform distribution (&quot;Uniform&quot;) on the interval
[0,<code>Vrho.max</code>]. Default set to &quot;1/Gamma&quot;.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_shape">shape</code></td>
<td>
<p>The shape parameter for the Gamma prior on the precision
of the spatial random effects. Default value is <code>shape=0.05</code> for
uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_rate">rate</code></td>
<td>
<p>The rate (1/scale) parameter for the Gamma prior on the
precision of the spatial random effects. Default value is
<code>rate=0.0005</code> for uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_vrho.max">Vrho.max</code></td>
<td>
<p>Upper bound for the uniform prior of the spatial
random effect variance. Default set to 1000.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_seed">seed</code></td>
<td>
<p>The seed for the random number generator. Default set to
1234.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_verbose">verbose</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
progress of the sampler is printed to the screen. Default is 1: a
progress bar is printed, indicating the step (in %) reached by the
Gibbs sampler.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_save.rho">save.rho</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for rhos are saved. Default is 0: the posterior mean
is computed and returned in the <code>rho.pred</code> vector. Be careful,
setting <code>save.rho</code> to 1 might require a large amount of
memory.</p>
</td></tr>
<tr><td><code id="hSDM.ZIB.iCAR.alteration_+3A_save.p">save.p</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for predictions are saved. Default is 0: the
posterior mean is computed and returned in the <code>prob.p.pred</code>
vector. Be careful, setting <code>save.p</code> to 1 might require a large
amount of memory.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The model integrates two processes, an ecological process associated
to the presence or absence of the species due to habitat suitability
and an observation process that takes into account the fact that the
probability of detection of the species is inferior to one. The
ecological process includes an intrinsic conditional autoregressive
model (iCAR) model for spatial autocorrelation between observations,
assuming that the probability of presence of the species at one site
depends on the probability of presence of the species on neighboring
sites.
</p>
<p><b>Ecological process:</b>
</p>
<p style="text-align: center;"><code class="reqn">z_i \sim \mathcal{B}ernoulli(\theta_i)</code>
</p>

<p style="text-align: center;"><code class="reqn">logit(\theta_i) = X_i \beta + \rho_{j(i)}</code>
</p>

<p><code class="reqn">\rho_j</code>: spatial random effect
</p>
<p><code class="reqn">j(i)</code>: index of the spatial entity for observation <code class="reqn">i</code>.
</p>
<p><b>Spatial autocorrelation:</b>
</p>
<p>An intrinsic conditional autoregressive model (iCAR) is assumed:
</p>
<p style="text-align: center;"><code class="reqn">\rho_j \sim \mathcal{N}ormal(\mu_j,V_{\rho} / n_j)</code>
</p>

<p><code class="reqn">\mu_j</code>: mean of <code class="reqn">\rho_{j'}</code> in the
neighborhood of <code class="reqn">j</code>.
</p>
<p><code class="reqn">V_{\rho}</code>: variance of the spatial random effects.
</p>
<p><code class="reqn">n_j</code>: number of neighbors for spatial entity <code class="reqn">j</code>.
</p>
<p><b>Observation process:</b>
</p>
<p style="text-align: center;"><code class="reqn">y_i \sim \mathcal{B}inomial(z_i * \delta_i, t_i)</code>
</p>

<p style="text-align: center;"><code class="reqn">logit(\delta_i) = W_i \gamma</code>
</p>
 


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>mcmc</code></td>
<td>
<p>An mcmc object that contains the posterior sample. This
object can be summarized by functions provided by the coda
package. The posterior sample of the deviance <code class="reqn">D</code>, with
<code class="reqn">D=-2\log(\prod_i P(y_i,z_i|...))</code>, is also
provided.</p>
</td></tr>
<tr><td><code>rho.pred</code></td>
<td>
<p>If <code>save.rho</code> is set to 0 (default),
<code>rho.pred</code> is the predictive posterior mean of the spatial
random effect associated to each spatial entity. If <code>save.rho</code> is
set to 1, <code>rho.pred</code> is an <code>mcmc</code> object with sampled
values for each spatial random effect associated to each spatial
entity.</p>
</td></tr>
<tr><td><code>prob.p.pred</code></td>
<td>
<p>If <code>save.p</code> is set to 0 (default),
<code>prob.p.pred</code> is the predictive posterior mean of the
probability associated to the suitability process for each
prediction. If <code>save.p</code> is set to 1, <code>prob.p.pred</code> is an
<code>mcmc</code> object with sampled values of the probability associated
to the suitability process for each prediction.</p>
</td></tr>
<tr><td><code>prob.p.latent</code></td>
<td>
<p>Predictive posterior mean of the probability
associated to the suitability process for each observation.</p>
</td></tr>
<tr><td><code>prob.q.latent</code></td>
<td>
<p>Predictive posterior mean of the probability
associated to the observability process for each observation.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent <a href="mailto:ghislain.vieilledent@cirad.fr">ghislain.vieilledent@cirad.fr</a>
</p>


<h3>References</h3>

<p>Gelfand, A. E.; Schmidt, A. M.; Wu, S.; Silander, J. A.; Latimer, A. and
Rebelo, A. G. (2005) Modelling species diversity through species level
hierarchical modelling. <em>Applied Statistics</em>, 54, 1-20.
</p>
<p>Latimer, A. M.; Wu, S. S.; Gelfand, A. E. and Silander, J. A. (2006) Building
statistical models to analyze species distributions. <em>Ecological
Applications</em>, 16, 33-50.
</p>
<p>MacKenzie, D. I.; Nichols, J. D.; Lachman, G. B.; Droege, S.; Andrew
Royle, J. and Langtimm, C. A. (2002) Estimating site occupancy rates when
detection probabilities are less than one. <em>Ecology</em>, 83, 2248-2255.
</p>


<h3>See Also</h3>

<p><code><a href="coda.html#topic+plot.mcmc">plot.mcmc</a></code>, <code><a href="coda.html#topic+summary.mcmc">summary.mcmc</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run:  

#==============================================
# hSDM.ZIB.iCAR.alteration()
# Example with simulated data
#==============================================

#============
#== Preambule
library(hSDM)
library(raster)
library(sp)
library(mvtnorm)

#==================
#== Data simulation

# Set seed for repeatability
seed &lt;- 1234

# Target parameters
beta.target &lt;- matrix(c(0.2,0.5,0.5),ncol=1)
gamma.target &lt;- matrix(c(1),ncol=1)
## Uncomment if you want covariates on the observability process
## gamma.target &lt;- matrix(c(0.2,0.5,0.5),ncol=1)
Vrho.target &lt;- 1 # Spatial Variance

# Landscape
Landscape &lt;- raster(ncol=20,nrow=20,crs='+proj=utm +zone=1')
ncell &lt;- ncell(Landscape)

# Neighbors
neighbors.mat &lt;- adjacent(Landscape, cells=c(1:ncell), directions=8, pairs=TRUE, sorted=TRUE)
n.neighbors &lt;- as.data.frame(table(as.factor(neighbors.mat[,1])))[,2]
adj &lt;- neighbors.mat[,2]

# Generate symmetric adjacency matrix, A
A &lt;- matrix(0,ncell,ncell)
index.start &lt;- 1
for (i in 1:ncell) {
    index.end &lt;- index.start+n.neighbors[i]-1
    A[i,adj[c(index.start:index.end)]] &lt;- 1
    index.start &lt;- index.end+1
}

# Spatial effects
d &lt;- 1	# Spatial dependence parameter = 1 for intrinsic CAR
Q &lt;- diag(n.neighbors)-d*A + diag(.0001,ncell) # Add small constant to make Q non-singular
covrho &lt;- Vrho.target*solve(Q) # Covariance of rhos
set.seed(seed)
rho &lt;- c(rmvnorm(1,sigma=covrho)) # Spatial Random Effects
rho &lt;- rho-mean(rho) # Centering rhos on zero

# Visited cells
n.visited &lt;- 150 # Compare with 400, 350 and 100 for example
set.seed(seed)
visited.cells &lt;- sort(sample(1:ncell,n.visited,replace=FALSE)) # Draw visited cells at random
notvisited.cells &lt;- c(1:ncell)[-visited.cells]

# Number of observations
nobs &lt;- 300

# Cell vector
set.seed(seed)
cells &lt;- c(visited.cells,sample(visited.cells,nobs-n.visited,replace=TRUE))
coords &lt;- xyFromCell(Landscape,cells) # Get coordinates

# Covariates for "suitability" process
set.seed(seed)
X1.cell &lt;- rnorm(n=ncell,0,1)
set.seed(2*seed)
X2.cell &lt;- rnorm(n=ncell,0,1)
X1 &lt;- X1.cell[cells]
X2 &lt;- X2.cell[cells]
X &lt;- cbind(rep(1,nobs),X1,X2)

# Alteration
U &lt;- runif(n=nobs,min=0,max=1)

# Covariates for "observability" process
W &lt;- cbind(rep(1,nobs))
## Uncomment if you want covariates on the observability process 
## set.seed(3*seed)
## W1 &lt;- rnorm(n=nobs,0,1)
## set.seed(4*seed)
## W2 &lt;- rnorm(n=nobs,0,1)
## W &lt;- cbind(rep(1,nobs),W1,W2)

#== Simulating latent variables

# Suitability
logit.theta.1 &lt;- vector()
for (n in 1:nobs) {
  logit.theta.1[n] &lt;- X[n,]%*%beta.target+rho[cells[n]]
}
theta.1 &lt;- inv.logit(logit.theta.1)
set.seed(seed)
y.1 &lt;- rbinom(nobs,1,theta.1)

# Alteration
u &lt;- rbinom(nobs,1,U)

# Observability
set.seed(seed)
trials &lt;- rpois(nobs,5)	# Number of trial associated to each observation
trials[trials==0] &lt;- 1
logit.theta.2 &lt;- W%*%gamma.target
theta.2 &lt;- inv.logit(logit.theta.2)
set.seed(seed)
y.2 &lt;- rbinom(nobs,trials,theta.2)

#== Simulating response variable
Y &lt;- y.2*(1-u)*y.1

#== Data-set
Data &lt;- data.frame(Y,trials,cells,X1,X2,U)
## Uncomment if you want covariates on the observability process 
## Data &lt;- data.frame(Y,trials,cells,X1,X2,W1,W2,U)
Data &lt;- SpatialPointsDataFrame(coords=coords,data=Data)
plot(Data)

#== Data-set for predictions (suitability on each spatial cell)
Data.pred &lt;- data.frame(X1=X1.cell,X2=X2.cell,cells=c(1:ncell))

#==================================
#== Site-occupancy model

mod.hSDM.ZIB.iCAR.alteration &lt;- hSDM.ZIB.iCAR.alteration(presences=Data$Y,
                                               trials=Data$trials,
                                               suitability=~X1+X2,
                                               observability=~1,
                                               spatial.entity=Data$cells,
                                               alteration=Data$U,
                                               data=Data,
                                               n.neighbors=n.neighbors,
                                               neighbors=adj,
                                               ## suitability.pred=NULL,
                                               ## spatial.entity.pred=NULL,
                                               suitability.pred=Data.pred,
                                               spatial.entity.pred=Data.pred$cells,
                                               burnin=5000, mcmc=5000, thin=5,
                                               beta.start=0,
                                               gamma.start=0,
                                               Vrho.start=10,
                                               priorVrho="1/Gamma",
                                               #priorVrho="Uniform",
                                               #priorVrho=10,
                                               mubeta=0, Vbeta=1.0E6,
                                               mugamma=0, Vgamma=1.0E6,
                                               shape=0.5, rate=0.0005,
                                               #Vrho.max=1000,
                                               seed=1234, verbose=1,
                                               save.rho=1, save.p=0)

#==========
#== Outputs

#= Parameter estimates
summary(mod.hSDM.ZIB.iCAR.alteration$mcmc)

#= MCMC and posteriors
pdf(file="Posteriors_hSDM.ZIB.iCAR.alteration.pdf")
plot(mod.hSDM.ZIB.iCAR.alteration$mcmc)
dev.off()

pdf(file="Posteriors.rho_hSDM.ZIB.iCAR.alteration.pdf")
plot(mod.hSDM.ZIB.iCAR.alteration$rho.pred)
dev.off()

#= Summary plots

# rho
r.rho &lt;- r.rho.pred &lt;- r.visited &lt;- Landscape
r.rho[] &lt;- rho
rho.pred &lt;- apply(mod.hSDM.ZIB.iCAR.alteration$rho.pred,2,mean)
r.rho.pred[] &lt;- rho.pred
r.visited[] &lt;- 0
r.visited[visited.cells] &lt;- 1
# prob.p
r.prob.p &lt;- Landscape
r.prob.p[] &lt;- mod.hSDM.ZIB.iCAR.alteration$prob.p.pred

pdf(file="Summary_hSDM.ZIB.iCAR.alteration.pdf")
par(mfrow=c(3,2))
plot(r.rho, main="rho target")
plot(r.visited,main="Visited cells and presences")
plot(Data[Y&gt;0,],add=TRUE,pch=16,cex=0.5)
plot(r.rho.pred, main="rho estimated")
plot(rho[visited.cells],rho.pred[visited.cells],
     xlab="rho target",
     ylab="rho estimated")
points(rho[notvisited.cells],rho.pred[notvisited.cells],pch=16,col="blue")
legend(x=-4,y=3.5,legend="Unvisited cells",col="blue",pch=16,bty="n")
abline(a=0,b=1,col="red")
plot(r.prob.p,main="Proba of presence")
plot(Data[Y&gt;0,],add=TRUE,pch=16,cex=0.5)
dev.off()


## End(Not run)

</code></pre>

<hr>
<h2 id='hSDM.ZIP'>ZIP (Zero-Inflated Poisson) model</h2><span id='topic+hSDM.ZIP'></span>

<h3>Description</h3>

<p>The <code>hSDM.ZIP</code> function can be used to model species
distribution including different processes in a hierarchical Bayesian
framework: a <code class="reqn">\mathcal{B}ernoulli</code> suitability process
(refering to various ecological variables explaining environmental
suitability or not) and a <code class="reqn">\mathcal{P}oisson</code> abundance
process (refering to various ecological variables explaining the
species abundance when the habitat is suitable). The <code>hSDM.ZIP</code>
function calls a Gibbs sampler written in C code which uses a
Metropolis algorithm to estimate the conditional posterior
distribution of hierarchical model's parameters.</p>


<h3>Usage</h3>

<pre><code class='language-R'>hSDM.ZIP(counts, suitability, abundance, data,
suitability.pred=NULL, burnin = 5000, mcmc = 10000, thin = 10,
beta.start, gamma.start, mubeta = 0, Vbeta = 1e+06, mugamma = 0, Vgamma
= 1e+06, seed = 1234, verbose = 1, save.p = 0)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hSDM.ZIP_+3A_counts">counts</code></td>
<td>
<p>A vector indicating the count for each observation.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP_+3A_suitability">suitability</code></td>
<td>
<p>A one-sided formula of the form
<code class="reqn">\sim x_1+...+x_p</code> with <code class="reqn">p</code> terms specifying the
explicative variables for the suitability process.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP_+3A_abundance">abundance</code></td>
<td>
<p>A one-sided formula of the form
<code class="reqn">\sim w_1+...+w_q</code> with <code class="reqn">q</code> terms specifying the
explicative variables for the abundance process.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP_+3A_data">data</code></td>
<td>
<p>A data frame containing the model's variables.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP_+3A_suitability.pred">suitability.pred</code></td>
<td>
<p>An optional data frame in which to look for
variables with which to predict. If NULL, the observations are
used.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP_+3A_burnin">burnin</code></td>
<td>
<p>The number of burnin iterations for the sampler.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP_+3A_mcmc">mcmc</code></td>
<td>
<p>The number of Gibbs iterations for the sampler. Total
number of Gibbs iterations is equal to
<code>burnin+mcmc</code>. <code>burnin+mcmc</code> must be divisible by 10 and
superior or equal to 100 so that the progress bar can be displayed.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP_+3A_thin">thin</code></td>
<td>
<p>The thinning interval used in the simulation. The number
of mcmc iterations must be divisible by this value.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP_+3A_beta.start">beta.start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters of
the suitability process. This can either be a scalar or a
<code class="reqn">p</code>-length vector.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP_+3A_gamma.start">gamma.start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters
of the abundance process. This can either be a scalar or a
<code class="reqn">q</code>-length vector.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP_+3A_mubeta">mubeta</code></td>
<td>
<p>Means of the priors for the <code class="reqn">\beta</code> parameters
of the suitability process. <code>mubeta</code> must be either a scalar or a
p-length vector. If <code>mubeta</code> takes a scalar value, then that value will
serve as the prior mean for all of the betas. The default value is set
to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP_+3A_vbeta">Vbeta</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\beta</code>
parameters of the suitability process. <code>Vbeta</code> must be either a
scalar or a p-length vector. If <code>Vbeta</code> takes a scalar value,
then that value will serve as the prior variance for all of the
betas. The default variance is large and set to 1.0E6 for an
uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP_+3A_mugamma">mugamma</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\gamma</code>
parameters of the abundance process. <code>mugamma</code> must be either
a scalar or a p-length vector. If <code>mugamma</code> takes a scalar value,
then that value will serve as the prior mean for all of the
gammas. The default value is set to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP_+3A_vgamma">Vgamma</code></td>
<td>
<p>Variances of the Normal priors for the
<code class="reqn">\gamma</code> parameters of the abundance
process. <code>Vgamma</code> must be either a scalar or a p-length
vector. If <code>Vgamma</code> takes a scalar value, then that value will
serve as the prior variance for all of the gammas. The default
variance is large and set to 1.0E6 for an uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP_+3A_seed">seed</code></td>
<td>
<p>The seed for the random number generator. Default set to
1234.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP_+3A_verbose">verbose</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
progress of the sampler is printed to the screen. Default is 1: a
progress bar is printed, indicating the step (in %) reached by the
Gibbs sampler.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP_+3A_save.p">save.p</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for predictions are saved. Default is 0: the
posterior mean is computed and returned in the <code>prob.p.pred</code>
vector. Be careful, setting <code>save.p</code> to 1 might require a large
amount of memory.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The model integrates two processes, an ecological process associated
to habitat suitability (habitat is suitable or not for the species)
and an abundance process that takes into account ecological variables
explaining the species abundance when the habitat is suitable.
</p>
<p><b>Suitability process:</b>
</p>
<p style="text-align: center;"><code class="reqn">z_i \sim \mathcal{B}ernoulli(\theta_i)</code>
</p>

<p style="text-align: center;"><code class="reqn">logit(\theta_i) = X_i \beta</code>
</p>

<p><b>Abundance process:</b>
</p>
<p style="text-align: center;"><code class="reqn">y_i \sim \mathcal{P}oisson(z_i * \lambda_i)</code>
</p>

<p style="text-align: center;"><code class="reqn">log(\lambda_i) = W_i \gamma</code>
</p>
 


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>mcmc</code></td>
<td>
<p>An mcmc object that contains the posterior sample. This
object can be summarized by functions provided by the coda
package. The posterior sample of the deviance <code class="reqn">D</code>, with
<code class="reqn">D=-2\log(\prod_i P(y_i,z_i|...))</code>, is also
provided.</p>
</td></tr>
<tr><td><code>prob.p.pred</code></td>
<td>
<p>If <code>save.p</code> is set to 0 (default),
<code>prob.p.pred</code> is the predictive posterior mean of the
probability associated to the suitability process for each
prediction. If <code>save.p</code> is set to 1, <code>prob.p.pred</code> is an
<code>mcmc</code> object with sampled values of the probability associated
to the suitability process for each prediction.</p>
</td></tr>
<tr><td><code>prob.p.latent</code></td>
<td>
<p>Predictive posterior mean of the probability
associated to the suitability process for each observation.</p>
</td></tr>
<tr><td><code>prob.q.latent</code></td>
<td>
<p>Predictive posterior mean of the probability
associated to the abundance process for each observation.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent <a href="mailto:ghislain.vieilledent@cirad.fr">ghislain.vieilledent@cirad.fr</a>
</p>


<h3>References</h3>

<p>Flores, O.; Rossi, V. and Mortier, F. (2009) Autocorrelation offsets
zero-inflation in models of tropical saplings density. <em>Ecological
Modelling</em>, 220, 1797-1809.
</p>
<p>Gelfand, A. E.; Schmidt, A. M.; Wu, S.; Silander, J. A.; Latimer, A. and
Rebelo, A. G. (2005) Modelling species diversity through species level
hierarchical modelling. <em>Applied Statistics</em>, 54, 1-20.
</p>
<p>Latimer, A. M.; Wu, S. S.; Gelfand, A. E. and Silander, J. A. (2006) Building
statistical models to analyze species distributions. <em>Ecological
Applications</em>, 16, 33-50.
</p>


<h3>See Also</h3>

<p><code><a href="coda.html#topic+plot.mcmc">plot.mcmc</a></code>, <code><a href="coda.html#topic+summary.mcmc">summary.mcmc</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run:  

#==============================================
# hSDM.ZIP()
# Example with simulated data
#==============================================

#============
#== Preambule
library(hSDM)

#==================
#== Data simulation

# Set seed for repeatability
seed &lt;- 1234

# Number of observations
nobs &lt;- 1000

# Target parameters
beta.target &lt;- matrix(c(0.2,0.5,0.5),ncol=1)
gamma.target &lt;- matrix(c(1),ncol=1)
## Uncomment if you want covariates on the abundance process
## gamma.target &lt;- matrix(c(0.2,0.5,0.5),ncol=1)

# Covariates for "suitability" process
set.seed(seed)
X1 &lt;- rnorm(n=nobs,0,1)
set.seed(2*seed)
X2 &lt;- rnorm(n=nobs,0,1)
X &lt;- cbind(rep(1,nobs),X1,X2)

# Covariates for "abundance" process
W &lt;- cbind(rep(1,nobs))
## Uncomment if you want covariates on the abundance process 
## set.seed(3*seed)
## W1 &lt;- rnorm(n=nobs,0,1)
## set.seed(4*seed)
## W2 &lt;- rnorm(n=nobs,0,1)
## W &lt;- cbind(rep(1,nobs),W1,W2)

#== Simulating latent variables

# Suitability
logit.theta &lt;- X %*% beta.target
theta &lt;- inv.logit(logit.theta)
set.seed(seed)
y.1 &lt;- rbinom(nobs,1,theta)

# Abundance
set.seed(seed)
log.lambda &lt;- W %*% gamma.target
lambda &lt;- exp(log.lambda)
set.seed(seed)
y.2 &lt;- rpois(nobs,lambda)

#== Simulating response variable
Y &lt;- y.2*y.1

#== Data-set
Data &lt;- data.frame(Y,X1,X2)
## Uncomment if you want covariates on the abundance process 
## Data &lt;- data.frame(Y,X1,X2,W1,W2)

#==================================
#== ZIP model

mod.hSDM.ZIP &lt;- hSDM.ZIP(counts=Data$Y,
                         suitability=~X1+X2,
                         abundance=~1, #=~1+W1+W2 if covariates
                         data=Data,
                         suitability.pred=NULL,
                         burnin=1000, mcmc=1000, thin=5,
                         beta.start=0,
                         gamma.start=0,
                         mubeta=0, Vbeta=1.0E6,
                         mugamma=0, Vgamma=1.0E6,
                         seed=1234, verbose=1,
                         save.p=0)

#==========
#== Outputs
pdf(file="Posteriors_hSDM.ZIP.pdf")
plot(mod.hSDM.ZIP$mcmc)
dev.off()
summary(mod.hSDM.ZIP$prob.p.latent)
summary(mod.hSDM.ZIP$prob.q.latent)
summary(mod.hSDM.ZIP$prob.p.pred)


## End(Not run)

</code></pre>

<hr>
<h2 id='hSDM.ZIP.iCAR'>ZIP (Zero-Inflated Poisson) model with CAR process</h2><span id='topic+hSDM.ZIP.iCAR'></span>

<h3>Description</h3>

<p>The <code>hSDM.ZIP.iCAR</code> function can be used to model
species distribution including different processes in a hierarchical
Bayesian framework: a <code class="reqn">\mathcal{B}ernoulli</code> suitability
process (refering to various ecological variables explaining
environmental suitability or not) which takes into account the spatial
dependence of the observations, and a <code class="reqn">\mathcal{P}oisson</code>
abundance process (refering to various ecological variables explaining
the species abundance when the habitat is suitable). The
<code>hSDM.ZIP.iCAR</code> function calls a Gibbs sampler written in C code
which uses an adaptive Metropolis algorithm to estimate the
conditional posterior distribution of hierarchical model's
parameters.</p>


<h3>Usage</h3>

<pre><code class='language-R'>hSDM.ZIP.iCAR(counts, suitability, abundance, spatial.entity,
data, n.neighbors, neighbors, suitability.pred=NULL,
spatial.entity.pred=NULL, burnin = 5000, mcmc = 10000, thin = 10,
beta.start, gamma.start, Vrho.start, mubeta = 0, Vbeta = 1e+06, mugamma
= 0, Vgamma = 1e+06, priorVrho = "1/Gamma", shape = 0.5, rate = 0.0005,
Vrho.max=1000, seed = 1234, verbose = 1, save.rho = 0, save.p = 0)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hSDM.ZIP.iCAR_+3A_counts">counts</code></td>
<td>
<p>A vector indicating the count for each observation.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_suitability">suitability</code></td>
<td>
<p>A one-sided formula of the form
<code class="reqn">\sim x_1+...+x_p</code> with <code class="reqn">p</code> terms specifying the
explicative variables for the suitability process.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_abundance">abundance</code></td>
<td>
<p>A one-sided formula of the form
<code class="reqn">\sim w_1+...+w_q</code> with <code class="reqn">q</code> terms specifying the
explicative variables for the abundance process.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_spatial.entity">spatial.entity</code></td>
<td>
<p>A vector indicating the spatial entity
identifier (from one to the total number of entities) for each
observation. Several observations can occur in one spatial entity. A
spatial entity can be a raster cell for example.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_data">data</code></td>
<td>
<p>A data frame containing the model's variables.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_n.neighbors">n.neighbors</code></td>
<td>
<p>A vector of integers that indicates the number of
neighbors (adjacent entities) of each spatial
entity. <code>length(n.neighbors)</code> indicates the total number of
spatial entities.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_neighbors">neighbors</code></td>
<td>
<p>A vector of integers indicating the neighbors
(adjacent entities) of each spatial entity. Must be of the form
c(neighbors of entity 1, neighbors of entity 2, ... , neighbors of
the last entity). Length of the <code>neighbors</code> vector should be
equal to <code>sum(n.neighbors)</code>.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_suitability.pred">suitability.pred</code></td>
<td>
<p>An optional data frame in which to look for
variables with which to predict. If NULL, the observations are
used.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_spatial.entity.pred">spatial.entity.pred</code></td>
<td>
<p>An optional vector indicating the spatial
entity identifier (from one to the total number of entities) for
predictions. If NULL, the vector <code>spatial.entity</code> for
observations is used.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_burnin">burnin</code></td>
<td>
<p>The number of burnin iterations for the sampler.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_mcmc">mcmc</code></td>
<td>
<p>The number of Gibbs iterations for the sampler. Total
number of Gibbs iterations is equal to
<code>burnin+mcmc</code>. <code>burnin+mcmc</code> must be divisible by 10 and
superior or equal to 100 so that the progress bar can be displayed.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_thin">thin</code></td>
<td>
<p>The thinning interval used in the simulation. The number
of mcmc iterations must be divisible by this value.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_beta.start">beta.start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters of
the suitability process. This can either be a scalar or a
<code class="reqn">p</code>-length vector.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_gamma.start">gamma.start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters
of the observability process. This can either be a scalar or a
<code class="reqn">q</code>-length vector.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_vrho.start">Vrho.start</code></td>
<td>
<p>Positive scalar indicating the starting value for the
variance of the spatial random effects.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_mubeta">mubeta</code></td>
<td>
<p>Means of the priors for the <code class="reqn">\beta</code> parameters
of the suitability process. <code>mubeta</code> must be either a scalar or a
p-length vector. If <code>mubeta</code> takes a scalar value, then that value will
serve as the prior mean for all of the betas. The default value is set
to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_vbeta">Vbeta</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\beta</code>
parameters of the suitability process. <code>Vbeta</code> must be either a
scalar or a p-length vector. If <code>Vbeta</code> takes a scalar value,
then that value will serve as the prior variance for all of the
betas. The default variance is large and set to 1.0E6 for an
uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_mugamma">mugamma</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\gamma</code>
parameters of the observability process. <code>mugamma</code> must be either
a scalar or a p-length vector. If <code>mugamma</code> takes a scalar value,
then that value will serve as the prior mean for all of the
gammas. The default value is set to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_vgamma">Vgamma</code></td>
<td>
<p>Variances of the Normal priors for the
<code class="reqn">\gamma</code> parameters of the observability
process. <code>Vgamma</code> must be either a scalar or a p-length
vector. If <code>Vgamma</code> takes a scalar value, then that value will
serve as the prior variance for all of the gammas. The default
variance is large and set to 1.0E6 for an uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_priorvrho">priorVrho</code></td>
<td>
<p>Type of prior for the variance of the spatial random
effects. Can be set to a fixed positive scalar, or to an inverse-gamma
distribution (&quot;1/Gamma&quot;) with parameters <code>shape</code> and <code>rate</code>,
or to a uniform distribution (&quot;Uniform&quot;) on the interval
[0,<code>Vrho.max</code>]. Default set to &quot;1/Gamma&quot;.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_shape">shape</code></td>
<td>
<p>The shape parameter for the Gamma prior on the precision
of the spatial random effects. Default value is <code>shape=0.05</code> for
uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_rate">rate</code></td>
<td>
<p>The rate (1/scale) parameter for the Gamma prior on the
precision of the spatial random effects. Default value is
<code>rate=0.0005</code> for uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_vrho.max">Vrho.max</code></td>
<td>
<p>Upper bound for the uniform prior of the spatial
random effect variance. Default set to 1000.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_seed">seed</code></td>
<td>
<p>The seed for the random number generator. Default set to
1234.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_verbose">verbose</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
progress of the sampler is printed to the screen. Default is 1: a
progress bar is printed, indicating the step (in %) reached by the
Gibbs sampler.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_save.rho">save.rho</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for rhos are saved. Default is 0: the posterior mean
is computed and returned in the <code>rho.pred</code> vector. Be careful,
setting <code>save.rho</code> to 1 might require a large amount of
memory.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR_+3A_save.p">save.p</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for predictions are saved. Default is 0: the
posterior mean is computed and returned in the <code>prob.p.pred</code>
vector. Be careful, setting <code>save.p</code> to 1 might require a large
amount of memory.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The model integrates two processes, an ecological process associated
to habitat suitability (habitat is suitable or not for the species)
and an abundance process that takes into account ecological variables
explaining the species abundance when the habitat is suitable. The
suitability process includes an intrinsic conditional autoregressive
model (iCAR) model for spatial autocorrelation between observations,
assuming that the suitability at one site depends on the suitability
on neighboring sites.
</p>
<p><b>Suitability process:</b>
</p>
<p style="text-align: center;"><code class="reqn">z_i \sim \mathcal{B}ernoulli(\theta_i)</code>
</p>

<p style="text-align: center;"><code class="reqn">logit(\theta_i) = X_i \beta + \rho_{j(i)}</code>
</p>

<p><code class="reqn">\rho_j</code>: spatial random effect
</p>
<p><code class="reqn">j(i)</code>: index of the spatial entity for observation <code class="reqn">i</code>.
</p>
<p><b>Spatial autocorrelation:</b>
</p>
<p>An intrinsic conditional autoregressive model (iCAR) is assumed:
</p>
<p style="text-align: center;"><code class="reqn">\rho_j \sim \mathcal{N}ormal(\mu_j,V_{\rho} / n_j)</code>
</p>

<p><code class="reqn">\mu_j</code>: mean of <code class="reqn">\rho_{j'}</code> in the
neighborhood of <code class="reqn">j</code>.
</p>
<p><code class="reqn">V_{\rho}</code>: variance of the spatial random effects.
</p>
<p><code class="reqn">n_j</code>: number of neighbors for spatial entity <code class="reqn">j</code>.
</p>
<p><b>Abundance process:</b>
</p>
<p style="text-align: center;"><code class="reqn">y_i \sim \mathcal{P}oisson(z_i * \lambda_i)</code>
</p>

<p style="text-align: center;"><code class="reqn">log(\lambda_i) = W_i \gamma</code>
</p>



<h3>Value</h3>

<table role = "presentation">
<tr><td><code>mcmc</code></td>
<td>
<p>An mcmc object that contains the posterior sample. This
object can be summarized by functions provided by the coda
package. The posterior sample of the deviance <code class="reqn">D</code>, with
<code class="reqn">D=-2\log(\prod_i P(y_i,z_i|...))</code>, is also
provided.</p>
</td></tr>
<tr><td><code>rho.pred</code></td>
<td>
<p>If <code>save.rho</code> is set to 0 (default),
<code>rho.pred</code> is the predictive posterior mean of the spatial
random effect associated to each spatial entity. If <code>save.rho</code> is
set to 1, <code>rho.pred</code> is an <code>mcmc</code> object with sampled
values for each spatial random effect associated to each spatial
entity.</p>
</td></tr>
<tr><td><code>prob.p.pred</code></td>
<td>
<p>If <code>save.p</code> is set to 0 (default),
<code>prob.p.pred</code> is the predictive posterior mean of the
probability associated to the suitability process for each
prediction. If <code>save.p</code> is set to 1, <code>prob.p.pred</code> is an
<code>mcmc</code> object with sampled values of the probability associated
to the suitability process for each prediction.</p>
</td></tr>
<tr><td><code>prob.p.latent</code></td>
<td>
<p>Predictive posterior mean of the probability
associated to the suitability process for each observation.</p>
</td></tr>
<tr><td><code>prob.q.latent</code></td>
<td>
<p>Predictive posterior mean of the probability
associated to the observability process for each observation.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent <a href="mailto:ghislain.vieilledent@cirad.fr">ghislain.vieilledent@cirad.fr</a>
</p>


<h3>References</h3>

<p>Flores, O.; Rossi, V. and Mortier, F. (2009) Autocorrelation offsets
zero-inflation in models of tropical saplings density. <em>Ecological
Modelling</em>, 220, 1797-1809.
</p>
<p>Gelfand, A. E.; Schmidt, A. M.; Wu, S.; Silander, J. A.; Latimer, A. and
Rebelo, A. G. (2005) Modelling species diversity through species level
hierarchical modelling. <em>Applied Statistics</em>, 54, 1-20.
</p>
<p>Latimer, A. M.; Wu, S. S.; Gelfand, A. E. and Silander, J. A. (2006) Building
statistical models to analyze species distributions. <em>Ecological
Applications</em>, 16, 33-50.
</p>


<h3>See Also</h3>

<p><code><a href="coda.html#topic+plot.mcmc">plot.mcmc</a></code>, <code><a href="coda.html#topic+summary.mcmc">summary.mcmc</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run:  

#==============================================
# hSDM.ZIP.iCAR()
# Example with simulated data
#==============================================

#============
#== Preambule
library(hSDM)
library(raster)
library(sp)
library(mvtnorm)

#==================
#== Data simulation

# Set seed for repeatability
seed &lt;- 1234

# Target parameters
beta.target &lt;- matrix(c(0.2,0.5,0.5),ncol=1)
gamma.target &lt;- matrix(c(1),ncol=1)
## Uncomment if you want covariates on the observability process
## gamma.target &lt;- matrix(c(0.2,0.5,0.5),ncol=1)
Vrho.target &lt;- 1 # Spatial Variance

# Landscape
Landscape &lt;- raster(ncol=20,nrow=20,crs='+proj=utm +zone=1')
ncell &lt;- ncell(Landscape)

# Neighbors
neighbors.mat &lt;- adjacent(Landscape, cells=c(1:ncell), directions=8, pairs=TRUE, sorted=TRUE)
n.neighbors &lt;- as.data.frame(table(as.factor(neighbors.mat[,1])))[,2]
adj &lt;- neighbors.mat[,2]

# Generate symmetric adjacency matrix, A
A &lt;- matrix(0,ncell,ncell)
index.start &lt;- 1
for (i in 1:ncell) {
    index.end &lt;- index.start+n.neighbors[i]-1
    A[i,adj[c(index.start:index.end)]] &lt;- 1
    index.start &lt;- index.end+1
}

# Spatial effects
d &lt;- 1	# Spatial dependence parameter = 1 for intrinsic CAR
Q &lt;- diag(n.neighbors)-d*A + diag(.0001,ncell) # Add small constant to make Q non-singular
covrho &lt;- Vrho.target*solve(Q) # Covariance of rhos
set.seed(seed)
rho &lt;- c(rmvnorm(1,sigma=covrho)) # Spatial Random Effects
rho &lt;- rho-mean(rho) # Centering rhos on zero

# Visited cells
n.visited &lt;- 150 # Compare with 400, 350 and 100 for example
set.seed(seed)
visited.cells &lt;- sort(sample(1:ncell,n.visited,replace=FALSE)) # Draw visited cells at random
notvisited.cells &lt;- c(1:ncell)[-visited.cells]

# Number of observations
nobs &lt;- 300

# Cell vector
set.seed(seed)
cells &lt;- c(visited.cells,sample(visited.cells,nobs-n.visited,replace=TRUE))
coords &lt;- xyFromCell(Landscape,cells) # Get coordinates

# Covariates for "suitability" process
set.seed(seed)
X1.cell &lt;- rnorm(n=ncell,0,1)
set.seed(2*seed)
X2.cell &lt;- rnorm(n=ncell,0,1)
X1 &lt;- X1.cell[cells]
X2 &lt;- X2.cell[cells]
X &lt;- cbind(rep(1,nobs),X1,X2)

# Covariates for "abundance" process
W &lt;- cbind(rep(1,nobs))
## Uncomment if you want covariates on the observability process 
## set.seed(3*seed)
## W1 &lt;- rnorm(n=nobs,0,1)
## set.seed(4*seed)
## W2 &lt;- rnorm(n=nobs,0,1)
## W &lt;- cbind(rep(1,nobs),W1,W2)

#== Simulating latent variables

# Suitability
logit.theta &lt;- vector()
for (n in 1:nobs) {
  logit.theta[n] &lt;- X[n,]%*%beta.target+rho[cells[n]]
}
theta &lt;- inv.logit(logit.theta)
set.seed(seed)
y.1 &lt;- rbinom(nobs,1,theta)

# Abundance
set.seed(seed)
log.lambda &lt;- W %*% gamma.target
lambda &lt;- exp(log.lambda)
set.seed(seed)
y.2 &lt;- rpois(nobs,lambda)

#== Simulating response variable
Y &lt;- y.2*y.1

#== Data-set
Data &lt;- data.frame(Y,cells,X1,X2)
## Uncomment if you want covariates on the observability process 
## Data &lt;- data.frame(Y,cells,X1,X2,W1,W2)
Data &lt;- SpatialPointsDataFrame(coords=coords,data=Data)
plot(Data)

#== Data-set for predictions (suitability on each spatial cell)
Data.pred &lt;- data.frame(X1=X1.cell,X2=X2.cell,cells=c(1:ncell))

#==================================
#== ZIP model with CAR

mod.hSDM.ZIP.iCAR &lt;- hSDM.ZIP.iCAR(counts=Data$Y,
                                   suitability=~X1+X2,
                                   abundance=~1,
                                   spatial.entity=Data$cells,
                                   data=Data,
                                   n.neighbors=n.neighbors,
                                   neighbors=adj,
                                   suitability.pred=Data.pred,
                                   spatial.entity.pred=Data.pred$cells,
                                   burnin=5000, mcmc=5000, thin=5,
                                   beta.start=0,
                                   gamma.start=0,
                                   Vrho.start=10,
                                   priorVrho="1/Gamma",
                                   #priorVrho="Uniform",
                                   #priorVrho=10,
                                   mubeta=0, Vbeta=1.0E6,
                                   mugamma=0, Vgamma=1.0E6,
                                   shape=0.5, rate=0.0005,
                                   #Vrho.max=1000,
                                   seed=1234, verbose=1,
                                   save.rho=1, save.p=0)

#==========
#== Outputs

#= Parameter estimates
summary(mod.hSDM.ZIP.iCAR$mcmc)

#= MCMC and posteriors
pdf(file="Posteriors_hSDM.ZIP.iCAR.pdf")
plot(mod.hSDM.ZIP.iCAR$mcmc)
dev.off()

pdf(file="Posteriors.rho_hSDM.ZIP.iCAR.pdf")
plot(mod.hSDM.ZIP.iCAR$rho.pred)
dev.off()

#= Summary plots

# rho
r.rho &lt;- r.rho.pred &lt;- r.visited &lt;- Landscape
r.rho[] &lt;- rho
rho.pred &lt;- apply(mod.hSDM.ZIP.iCAR$rho.pred,2,mean)
r.rho.pred[] &lt;- rho.pred
r.visited[] &lt;- 0
r.visited[visited.cells] &lt;- tapply(Data$Y,Data$cells,mean)
# prob.p
r.prob.p &lt;- Landscape
r.prob.p[] &lt;- mod.hSDM.ZIP.iCAR$prob.p.pred

pdf(file="Summary_hSDM.ZIP.iCAR.pdf")
par(mfrow=c(3,2))
plot(r.rho, main="rho target")
plot(r.visited,main="Visited cells and counts")
plot(Data,add=TRUE,pch=16,cex=0.5)
plot(r.rho.pred, main="rho estimated")
plot(rho[visited.cells],rho.pred[visited.cells],
     xlab="rho target",
     ylab="rho estimated")
points(rho[notvisited.cells],rho.pred[notvisited.cells],pch=16,col="blue")
legend(x=-4,y=3.5,legend="Unvisited cells",col="blue",pch=16,bty="n")
abline(a=0,b=1,col="red")
plot(r.prob.p,main="Predicted counts")
plot(Data,add=TRUE,pch=16,cex=0.5)
dev.off()


## End(Not run)

</code></pre>

<hr>
<h2 id='hSDM.ZIP.iCAR.alteration'>ZIP (Zero-Inflated Poisson) model with CAR process taking into
account site alteration</h2><span id='topic+hSDM.ZIP.iCAR.alteration'></span>

<h3>Description</h3>

<p>The <code>hSDM.ZIP.iCAR.alteration</code> function can be used to
model species distribution including different processes in a
hierarchical Bayesian framework: (i) a
<code class="reqn">\mathcal{B}ernoulli</code> suitability process (refering to
various ecological variables explaining environmental suitability or
not) which takes into account the spatial dependence of the
observations, (ii) an alteration process (refering to anthropogenic
disturbances), and (iii) a <code class="reqn">\mathcal{P}oisson</code> abundance
process (refering to various ecological variables explaining the
species abundance when the habitat is suitable). The
<code>hSDM.ZIP.iCAR.alteration</code> function calls a Gibbs sampler written
in C code which uses an adaptive Metropolis algorithm to estimate the
conditional posterior distribution of hierarchical model's
parameters.</p>


<h3>Usage</h3>

<pre><code class='language-R'>hSDM.ZIP.iCAR.alteration(counts, suitability, abundance,
spatial.entity, alteration, data, n.neighbors, neighbors,
suitability.pred=NULL, spatial.entity.pred=NULL, burnin = 5000, mcmc =
10000, thin = 10, beta.start, gamma.start, Vrho.start, mubeta = 0, Vbeta
= 1e+06, mugamma = 0, Vgamma = 1e+06, priorVrho = "1/Gamma", shape =
0.5, rate = 0.0005, Vrho.max=1000, seed = 1234, verbose = 1, save.rho =
0, save.p = 0)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_counts">counts</code></td>
<td>
<p>A vector indicating the count for each observation.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_suitability">suitability</code></td>
<td>
<p>A one-sided formula of the form
<code class="reqn">\sim x_1+...+x_p</code> with <code class="reqn">p</code> terms specifying the
explicative variables for the suitability process.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_abundance">abundance</code></td>
<td>
<p>A one-sided formula of the form
<code class="reqn">\sim w_1+...+w_q</code> with <code class="reqn">q</code> terms specifying the
explicative variables for the abundance process.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_spatial.entity">spatial.entity</code></td>
<td>
<p>A vector indicating the spatial entity
identifier (from one to the total number of entities) for each
observation. Several observations can occur in one spatial entity. A
spatial entity can be a raster cell for example.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_alteration">alteration</code></td>
<td>
<p>A vector indicating the proportion of area in the
spatial cell which is transformed (by anthropogenic activities for
example) for each observation. Must be between 0 and 1.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_data">data</code></td>
<td>
<p>A data frame containing the model's variables.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_n.neighbors">n.neighbors</code></td>
<td>
<p>A vector of integers that indicates the number of
neighbors (adjacent entities) of each spatial
entity. <code>length(n.neighbors)</code> indicates the total number of
spatial entities.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_neighbors">neighbors</code></td>
<td>
<p>A vector of integers indicating the neighbors
(adjacent entities) of each spatial entity. Must be of the form
c(neighbors of entity 1, neighbors of entity 2, ... , neighbors of
the last entity). Length of the <code>neighbors</code> vector should be
equal to <code>sum(n.neighbors)</code>.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_suitability.pred">suitability.pred</code></td>
<td>
<p>An optional data frame in which to look for
variables with which to predict. If NULL, the observations are
used.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_spatial.entity.pred">spatial.entity.pred</code></td>
<td>
<p>An optional vector indicating the spatial
entity identifier (from one to the total number of entities) for
predictions. If NULL, the vector <code>spatial.entity</code> for
observations is used.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_burnin">burnin</code></td>
<td>
<p>The number of burnin iterations for the sampler.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_mcmc">mcmc</code></td>
<td>
<p>The number of Gibbs iterations for the sampler. Total
number of Gibbs iterations is equal to
<code>burnin+mcmc</code>. <code>burnin+mcmc</code> must be divisible by 10 and
superior or equal to 100 so that the progress bar can be displayed.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_thin">thin</code></td>
<td>
<p>The thinning interval used in the simulation. The number
of mcmc iterations must be divisible by this value.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_beta.start">beta.start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters of
the suitability process. This can either be a scalar or a
<code class="reqn">p</code>-length vector.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_gamma.start">gamma.start</code></td>
<td>
<p>Starting values for <code class="reqn">\beta</code> parameters
of the observability process. This can either be a scalar or a
<code class="reqn">q</code>-length vector.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_vrho.start">Vrho.start</code></td>
<td>
<p>Positive scalar indicating the starting value for the
variance of the spatial random effects.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_mubeta">mubeta</code></td>
<td>
<p>Means of the priors for the <code class="reqn">\beta</code> parameters
of the suitability process. <code>mubeta</code> must be either a scalar or a
p-length vector. If <code>mubeta</code> takes a scalar value, then that value will
serve as the prior mean for all of the betas. The default value is set
to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_vbeta">Vbeta</code></td>
<td>
<p>Variances of the Normal priors for the <code class="reqn">\beta</code>
parameters of the suitability process. <code>Vbeta</code> must be either a
scalar or a p-length vector. If <code>Vbeta</code> takes a scalar value,
then that value will serve as the prior variance for all of the
betas. The default variance is large and set to 1.0E6 for an
uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_mugamma">mugamma</code></td>
<td>
<p>Means of the Normal priors for the <code class="reqn">\gamma</code>
parameters of the observability process. <code>mugamma</code> must be either
a scalar or a p-length vector. If <code>mugamma</code> takes a scalar value,
then that value will serve as the prior mean for all of the
gammas. The default value is set to 0 for an uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_vgamma">Vgamma</code></td>
<td>
<p>Variances of the Normal priors for the
<code class="reqn">\gamma</code> parameters of the observability
process. <code>Vgamma</code> must be either a scalar or a p-length
vector. If <code>Vgamma</code> takes a scalar value, then that value will
serve as the prior variance for all of the gammas. The default
variance is large and set to 1.0E6 for an uninformative flat prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_priorvrho">priorVrho</code></td>
<td>
<p>Type of prior for the variance of the spatial random
effects. Can be set to a fixed positive scalar, or to an inverse-gamma
distribution (&quot;1/Gamma&quot;) with parameters <code>shape</code> and <code>rate</code>,
or to a uniform distribution (&quot;Uniform&quot;) on the interval
[0,<code>Vrho.max</code>]. Default set to &quot;1/Gamma&quot;.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_shape">shape</code></td>
<td>
<p>The shape parameter for the Gamma prior on the precision
of the spatial random effects. Default value is <code>shape=0.05</code> for
uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_rate">rate</code></td>
<td>
<p>The rate (1/scale) parameter for the Gamma prior on the
precision of the spatial random effects. Default value is
<code>rate=0.0005</code> for uninformative prior.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_vrho.max">Vrho.max</code></td>
<td>
<p>Upper bound for the uniform prior of the spatial
random effect variance. Default set to 1000.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_seed">seed</code></td>
<td>
<p>The seed for the random number generator. Default set to
1234.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_verbose">verbose</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
progress of the sampler is printed to the screen. Default is 1: a
progress bar is printed, indicating the step (in %) reached by the
Gibbs sampler.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_save.rho">save.rho</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for rhos are saved. Default is 0: the posterior mean
is computed and returned in the <code>rho.pred</code> vector. Be careful,
setting <code>save.rho</code> to 1 might require a large amount of
memory.</p>
</td></tr>
<tr><td><code id="hSDM.ZIP.iCAR.alteration_+3A_save.p">save.p</code></td>
<td>
<p>A switch (0,1) which determines whether or not the
sampled values for predictions are saved. Default is 0: the
posterior mean is computed and returned in the <code>prob.p.pred</code>
vector. Be careful, setting <code>save.p</code> to 1 might require a large
amount of memory.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The model integrates two processes, an ecological process associated
to the presence or absence of the species due to habitat suitability
and an observation process that takes into account the fact that the
probability of detection of the species is inferior to one. The
ecological process includes an intrinsic conditional autoregressive
model (iCAR) model for spatial autocorrelation between observations,
assuming that the probability of presence of the species at one site
depends on the probability of presence of the species on neighboring
sites.
</p>
<p><b>Ecological process:</b>
</p>
<p style="text-align: center;"><code class="reqn">z_i \sim \mathcal{B}ernoulli(\theta_i)</code>
</p>

<p style="text-align: center;"><code class="reqn">logit(\theta_i) = X_i \beta + \rho_{j(i)}</code>
</p>

<p><code class="reqn">\rho_j</code>: spatial random effect
</p>
<p><code class="reqn">j(i)</code>: index of the spatial entity for observation <code class="reqn">i</code>.
</p>
<p><b>Spatial autocorrelation:</b>
</p>
<p>An intrinsic conditional autoregressive model (iCAR) is assumed:
</p>
<p style="text-align: center;"><code class="reqn">\rho_j \sim \mathcal{N}ormal(\mu_j,V_{\rho} / n_j)</code>
</p>

<p><code class="reqn">\mu_j</code>: mean of <code class="reqn">\rho_{j'}</code> in the
neighborhood of <code class="reqn">j</code>.
</p>
<p><code class="reqn">V_{\rho}</code>: variance of the spatial random effects.
</p>
<p><code class="reqn">n_j</code>: number of neighbors for spatial entity <code class="reqn">j</code>.
</p>
<p><b>Observation process:</b>
</p>
<p style="text-align: center;"><code class="reqn">y_i \sim \mathcal{B}inomial(z_i * \delta_i, t_i)</code>
</p>

<p style="text-align: center;"><code class="reqn">logit(\delta_i) = W_i \gamma</code>
</p>
 


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>mcmc</code></td>
<td>
<p>An mcmc object that contains the posterior sample. This
object can be summarized by functions provided by the coda
package. The posterior sample of the deviance <code class="reqn">D</code>, with
<code class="reqn">D=-2\log(\prod_i P(y_i,z_i|...))</code>, is also
provided.</p>
</td></tr>
<tr><td><code>rho.pred</code></td>
<td>
<p>If <code>save.rho</code> is set to 0 (default),
<code>rho.pred</code> is the predictive posterior mean of the spatial
random effect associated to each spatial entity. If <code>save.rho</code> is
set to 1, <code>rho.pred</code> is an <code>mcmc</code> object with sampled
values for each spatial random effect associated to each spatial
entity.</p>
</td></tr>
<tr><td><code>prob.p.pred</code></td>
<td>
<p>If <code>save.p</code> is set to 0 (default),
<code>prob.p.pred</code> is the predictive posterior mean of the
probability associated to the suitability process for each
prediction. If <code>save.p</code> is set to 1, <code>prob.p.pred</code> is an
<code>mcmc</code> object with sampled values of the probability associated
to the suitability process for each prediction.</p>
</td></tr>
<tr><td><code>prob.p.latent</code></td>
<td>
<p>Predictive posterior mean of the probability
associated to the suitability process for each observation.</p>
</td></tr>
<tr><td><code>prob.q.latent</code></td>
<td>
<p>Predictive posterior mean of the probability
associated to the observability process for each observation.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent <a href="mailto:ghislain.vieilledent@cirad.fr">ghislain.vieilledent@cirad.fr</a>
</p>


<h3>References</h3>

<p>Flores, O.; Rossi, V. and Mortier, F. (2009) Autocorrelation offsets
zero-inflation in models of tropical saplings density. <em>Ecological
Modelling</em>, 220, 1797-1809.
</p>
<p>Gelfand, A. E.; Schmidt, A. M.; Wu, S.; Silander, J. A.; Latimer, A. and
Rebelo, A. G. (2005) Modelling species diversity through species level
hierarchical modelling. <em>Applied Statistics</em>, 54, 1-20.
</p>
<p>Latimer, A. M.; Wu, S. S.; Gelfand, A. E. and Silander, J. A. (2006) Building
statistical models to analyze species distributions. <em>Ecological
Applications</em>, 16, 33-50.
</p>


<h3>See Also</h3>

<p><code><a href="coda.html#topic+plot.mcmc">plot.mcmc</a></code>, <code><a href="coda.html#topic+summary.mcmc">summary.mcmc</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run:  

#==============================================
# hSDM.ZIP.iCAR.alteration()
# Example with simulated data
#==============================================

#============
#== Preambule
library(hSDM)
library(raster)
library(sp)
library(mvtnorm)

#==================
#== Data simulation

# Set seed for repeatability
seed &lt;- 1234

# Target parameters
beta.target &lt;- matrix(c(0.2,0.5,0.5),ncol=1)
gamma.target &lt;- matrix(c(1),ncol=1)
## Uncomment if you want covariates on the observability process
## gamma.target &lt;- matrix(c(0.2,0.5,0.5),ncol=1)
Vrho.target &lt;- 1 # Spatial Variance

# Landscape
Landscape &lt;- raster(ncol=20,nrow=20,crs='+proj=utm +zone=1')
ncell &lt;- ncell(Landscape)

# Neighbors
neighbors.mat &lt;- adjacent(Landscape, cells=c(1:ncell), directions=8, pairs=TRUE, sorted=TRUE)
n.neighbors &lt;- as.data.frame(table(as.factor(neighbors.mat[,1])))[,2]
adj &lt;- neighbors.mat[,2]

# Generate symmetric adjacency matrix, A
A &lt;- matrix(0,ncell,ncell)
index.start &lt;- 1
for (i in 1:ncell) {
    index.end &lt;- index.start+n.neighbors[i]-1
    A[i,adj[c(index.start:index.end)]] &lt;- 1
    index.start &lt;- index.end+1
}

# Spatial effects
d &lt;- 1	# Spatial dependence parameter = 1 for intrinsic CAR
Q &lt;- diag(n.neighbors)-d*A + diag(.0001,ncell) # Add small constant to make Q non-singular
covrho &lt;- Vrho.target*solve(Q) # Covariance of rhos
set.seed(seed)
rho &lt;- c(rmvnorm(1,sigma=covrho)) # Spatial Random Effects
rho &lt;- rho-mean(rho) # Centering rhos on zero

# Visited cells
n.visited &lt;- 150 # Compare with 400, 350 and 100 for example
set.seed(seed)
visited.cells &lt;- sort(sample(1:ncell,n.visited,replace=FALSE)) # Draw visited cells at random
notvisited.cells &lt;- c(1:ncell)[-visited.cells]

# Number of observations
nobs &lt;- 300

# Cell vector
set.seed(seed)
cells &lt;- c(visited.cells,sample(visited.cells,nobs-n.visited,replace=TRUE))
coords &lt;- xyFromCell(Landscape,cells) # Get coordinates

# Covariates for "suitability" process
set.seed(seed)
X1.cell &lt;- rnorm(n=ncell,0,1)
set.seed(2*seed)
X2.cell &lt;- rnorm(n=ncell,0,1)
X1 &lt;- X1.cell[cells]
X2 &lt;- X2.cell[cells]
X &lt;- cbind(rep(1,nobs),X1,X2)

# Alteration
U &lt;- runif(n=nobs,min=0,max=1)

# Covariates for "abundance" process
W &lt;- cbind(rep(1,nobs))
## Uncomment if you want covariates on the observability process 
## set.seed(3*seed)
## W1 &lt;- rnorm(n=nobs,0,1)
## set.seed(4*seed)
## W2 &lt;- rnorm(n=nobs,0,1)
## W &lt;- cbind(rep(1,nobs),W1,W2)

#== Simulating latent variables

# Suitability
logit.theta &lt;- vector()
for (n in 1:nobs) {
  logit.theta[n] &lt;- X[n,]%*%beta.target+rho[cells[n]]
}
theta &lt;- inv.logit(logit.theta)
set.seed(seed)
y.1 &lt;- rbinom(nobs,1,theta)

# Alteration
u &lt;- rbinom(nobs,1,U)

# Abundance
set.seed(seed)
log.lambda &lt;- W %*% gamma.target
lambda &lt;- exp(log.lambda)
set.seed(seed)
y.2 &lt;- rpois(nobs,lambda)

#== Simulating response variable
Y &lt;- y.2*(1-u)*y.1

#== Data-set
Data &lt;- data.frame(Y,cells,X1,X2,U)
## Uncomment if you want covariates on the observability process 
## Data &lt;- data.frame(Y,cells,X1,X2,W1,W2,U)
Data &lt;- SpatialPointsDataFrame(coords=coords,data=Data)
plot(Data)

#== Data-set for predictions (suitability on each spatial cell)
Data.pred &lt;- data.frame(X1=X1.cell,X2=X2.cell,cells=c(1:ncell))

#==================================
#== Site-occupancy model

mod.hSDM.ZIP.iCAR.alteration &lt;- hSDM.ZIP.iCAR.alteration(counts=Data$Y,
                                               suitability=~X1+X2,
                                               abundance=~1,
                                               spatial.entity=Data$cells,
                                               alteration=Data$U,
                                               data=Data,
                                               n.neighbors=n.neighbors,
                                               neighbors=adj,
                                               ## suitability.pred=NULL,
                                               ## spatial.entity.pred=NULL,
                                               suitability.pred=Data.pred,
                                               spatial.entity.pred=Data.pred$cells,
                                               burnin=5000, mcmc=5000, thin=5,
                                               beta.start=0,
                                               gamma.start=0,
                                               Vrho.start=10,
                                               priorVrho="1/Gamma",
                                               #priorVrho="Uniform",
                                               #priorVrho=10,
                                               mubeta=0, Vbeta=1.0E6,
                                               mugamma=0, Vgamma=1.0E6,
                                               shape=0.5, rate=0.0005,
                                               #Vrho.max=1000,
                                               seed=1234, verbose=1,
                                               save.rho=1, save.p=0)

#==========
#== Outputs

#= Parameter estimates
summary(mod.hSDM.ZIP.iCAR.alteration$mcmc)

#= MCMC and posteriors
pdf(file="Posteriors_hSDM.ZIP.iCAR.alteration.pdf")
plot(mod.hSDM.ZIP.iCAR.alteration$mcmc)
dev.off()

pdf(file="Posteriors.rho_hSDM.ZIP.iCAR.alteration.pdf")
plot(mod.hSDM.ZIP.iCAR.alteration$rho.pred)
dev.off()

#= Summary plots

# rho
r.rho &lt;- r.rho.pred &lt;- r.visited &lt;- Landscape
r.rho[] &lt;- rho
rho.pred &lt;- apply(mod.hSDM.ZIP.iCAR.alteration$rho.pred,2,mean)
r.rho.pred[] &lt;- rho.pred
r.visited[] &lt;- 0
r.visited[visited.cells] &lt;- tapply(Data$Y,Data$cells,mean)
# prob.p
r.prob.p &lt;- Landscape
r.prob.p[] &lt;- mod.hSDM.ZIP.iCAR.alteration$prob.p.pred

pdf(file="Summary_hSDM.ZIP.iCAR.alteration.pdf")
par(mfrow=c(3,2))
plot(r.rho, main="rho target")
plot(r.visited,main="Visited cells and counts")
plot(Data,add=TRUE,pch=16,cex=0.5)
plot(r.rho.pred, main="rho estimated")
plot(rho[visited.cells],rho.pred[visited.cells],
     xlab="rho target",
     ylab="rho estimated")
points(rho[notvisited.cells],rho.pred[notvisited.cells],pch=16,col="blue")
legend(x=-4,y=3.5,legend="Unvisited cells",col="blue",pch=16,bty="n")
abline(a=0,b=1,col="red")
plot(r.prob.p,main="Predicted counts")
plot(Data,add=TRUE,pch=16,cex=0.5)
dev.off()


## End(Not run)

</code></pre>

<hr>
<h2 id='logit'>Generalized logit and inverse logit function</h2><span id='topic+logit'></span><span id='topic+inv.logit'></span>

<h3>Description</h3>

<p>Compute generalized logit and generalized inverse logit functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>logit(x, min = 0, max = 1)
inv.logit(x, min = 0, max = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="logit_+3A_x">x</code></td>
<td>
<p>value(s) to be transformed</p>
</td></tr>
<tr><td><code id="logit_+3A_min">min</code></td>
<td>
<p>Lower end of logit interval</p>
</td></tr>
<tr><td><code id="logit_+3A_max">max</code></td>
<td>
<p>Upper end of logit interval</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The generalized logit function takes values on [min, max] and
transforms them to span [-Inf,Inf] it is defined as:
</p>
<p style="text-align: center;"><code class="reqn">y = log(\frac{p}{(1-p)})</code>
</p>

<p>where
</p>
<p style="text-align: center;"><code class="reqn">p=\frac{(x-min)}{(max-min)}</code>
</p>

<p>The generized inverse logit function provides the inverse
transformation:
</p>
<p style="text-align: center;"><code class="reqn">x = p' (max-min) + min</code>
</p>

<p>where
</p>
<p style="text-align: center;"><code class="reqn">p'=\frac{exp(y)}{(1+exp(y))}</code>
</p>



<h3>Value</h3>

<p>Transformed value(s).
</p>


<h3>Author(s)</h3>

<p>Gregory R. Warnes &lt;greg@warnes.net&gt;</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  x &lt;- seq(0,10, by=0.25)
  xt &lt;- logit(x, min=0, max=10)
  cbind(x,xt)

  y &lt;- inv.logit(xt, min=0, max=10)
  cbind(x,xt,y)  

## End(Not run)
</code></pre>

<hr>
<h2 id='neighbors.Latimer2006'>Neighborhood data (from Latimer et al. 2006)</h2><span id='topic+neighbors.Latimer2006'></span>

<h3>Description</h3>

<p>Data come from a small region including 476 one minute by
one minute grid cells. This region is is a small corner of South
Africa's Cape Floristic Region, and includes very high plant species
diversity and a World Biosphere Reserve. The data frame can be used as
an example for several functions in the <code>hSDM</code> package.</p>


<h3>Format</h3>

<p><code>neighbors.Latimer2006</code> is a vector of 3542 integers indicating
the neighbors (adjacent cells) of each spatial cell. The vector is of
the form c(neighbors of cell 1, neighbors of cell 2, ... , neighbors
of the last cell).
</p>


<h3>Source</h3>

<p>Latimer et al. (2006) <em>Ecological Applications</em>, Appendix B</p>


<h3>References</h3>

<p>Latimer, A. M.; Wu, S. S.; Gelfand, A. E. and Silander, J. A. (2006)
Building statistical models to analyze species
distributions. <em>Ecological Applications</em>, 16, 33-50.
</p>

<hr>
<h2 id='predict.hSDM'>Predict method for models fitted with hSDM</h2><span id='topic+predict.hSDM'></span>

<h3>Description</h3>

<p>Predicted values for models fitted with hSDM</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'hSDM'
predict(object,newdata=NULL,type="mean",probs=c(0.025,0.975),...)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict.hSDM_+3A_object">object</code></td>
<td>
<p>An object of class <code>"hSDM"</code>.</p>
</td></tr>
<tr><td><code id="predict.hSDM_+3A_newdata">newdata</code></td>
<td>
<p>An optional data frame in which to look for variables with which to predict. If omitted, the fitted values are used.</p>
</td></tr>
<tr><td><code id="predict.hSDM_+3A_type">type</code></td>
<td>
<p>Type of prediction. Can be <code>"mean"</code> for predictive posterior mean, <code>"quantile"</code> for producing sample quantiles from the predictive posterior corresponding to the given probabilities (see <code>probs</code> argument) or <code>"posterior"</code> for the full predictive posterior for each prediction. Using <code>"quantile"</code> or <code>"posterior"</code> might lead to memory problem depending on the number of predictions and the number of samples for the hSDM model's parameters.</p>
</td></tr>
<tr><td><code id="predict.hSDM_+3A_probs">probs</code></td>
<td>
<p>Numeric vector of probabilities with values in [0,1] and used when <code>type="quantile"</code>.</p>
</td></tr>
<tr><td><code id="predict.hSDM_+3A_...">...</code></td>
<td>
<p>Further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Return a vector for the predictive posterior mean when <code>type="mean"</code>, a data-frame with the mean and quantiles when <code>type="quantile"</code> or an <code>mcmc</code> object (see <code>coda</code> package) with posterior distribution for each prediction when <code>type="posterior"</code>.</p>


<h3>Author(s)</h3>

<p>Ghislain Vieilledent <a href="mailto:ghislain.vieilledent@cirad.fr">ghislain.vieilledent@cirad.fr</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+hSDM">hSDM</a></code>
</p>

<hr>
<h2 id='punc10'>Occurrence data for <em>Protea punctata</em> Meisn. in the Cap
Floristic Region</h2><span id='topic+punc10'></span>

<h3>Description</h3>

<p>The species data were collected by the Protea Atlas Project
of South Africa’s National Botanical Institute.</p>


<h3>Format</h3>

<p><code>cfr.env</code> is a data frame with 2934 presence-absence observation points.
</p>

<dl>
<dt><code>Occurrence</code></dt><dd><p>presence (1) or absence (0) of the species</p>
</dd>
<dt><code>lon</code></dt><dd><p>longitude</p>
</dd>
<dt><code>lat</code></dt><dd><p>latitude</p>
</dd>
</dl>



<h3>Source</h3>

<p>Cory Merow's personal data</p>


<h3>References</h3>

<p>Latimer, A. M.; Wu, S. S.; Gelfand, A. E. and Silander, J. A. (2006)
Building statistical models to analyze species
distributions. <em>Ecological Applications</em>, 16, 33-50.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
