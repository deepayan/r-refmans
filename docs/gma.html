<!DOCTYPE html><html><head><title>Help for package gma</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {gma}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#env.single'><p> Simulated single-level dataset</p></a></li>
<li><a href='#env.two'><p> Simulated two-level dataset</p></a></li>
<li><a href='#gma'><p> Granger Mediation Analysis of Time Series</p></a></li>
<li><a href='#gma-package'>
<p>Granger Mediation Analysis</p></a></li>
<li><a href='#sim.data.ts.single'><p> Generate single-level simulation data</p></a></li>
<li><a href='#sim.data.ts.two'><p> Generate two-level simulation data</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Granger Mediation Analysis</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2018-08-23</td>
</tr>
<tr>
<td>Author:</td>
<td>Yi Zhao &lt;zhaoyi1026@gmail.com&gt;, Xi Luo &lt;xi.rossi.luo@gmail.com&gt;</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Yi Zhao &lt;zhaoyi1026@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Performs Granger mediation analysis (GMA) for time series. This package includes a single level GMA model and a two-level GMA model, for time series with hierarchically nested structure. The single level GMA model for the time series of a single participant performs the causal mediation analysis which integrates the structural equation modeling and the Granger causality frameworks. A vector autoregressive model of order p is employed to account for the spatiotemporal dependencies in the data. Meanwhile, the model introduces the unmeasured confounding effect through a nonzero correlation parameter. Under the two-level model, by leveraging the variabilities across participants, the parameters are identifiable and consistently estimated based on a full conditional likelihood or a two-stage method. See Zhao, Y., &amp; Luo, X. (2017), Granger Mediation Analysis of Multiple Time Series with an Application to fMRI, &lt;<a href="https://arxiv.org/abs/1709.05328">arXiv:1709.05328</a>&gt; for details.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Depends:</td>
<td>MASS, nlme, car</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2017-09-18 14:14:15 UTC; yizhao</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2017-09-19 10:07:35 UTC</td>
</tr>
</table>
<hr>
<h2 id='env.single'> Simulated single-level dataset
</h2><span id='topic+env.single'></span>

<h3>Description</h3>

<p> &quot;env.single&quot; is an R environment containing a data frame of data generated from 500 time points, and the true model parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("env.single")</code></pre>


<h3>Format</h3>

<p> An R environment
</p>

<dl>
<dt><code>data1</code></dt><dd><p>a data frame with <code>Z</code> the treatment assignment, <code>M</code> the mediator and <code>R</code> the interested outcome.</p>
</dd>
<dt><code>error1</code></dt><dd><p>a data frame with <code>E1</code> and <code>E2</code> the error time series of <code>M</code> and <code>R</code>, respectively.</p>
</dd>
<dt><code>theta</code></dt><dd><p>a 3 by 1 vector, which is the coefficients <code>(A,B,C)</code> of the model.</p>
</dd>
<dt><code>Sigma</code></dt><dd><p>a 2 by 2 matrix, which is the covariance matrix of two Gaussian white noise processes.</p>
</dd>
<dt><code>p</code></dt><dd><p>the order of the vector autoregressive (VAR) model.</p>
</dd>
<dt><code>W</code></dt><dd><p>a 2<code>p</code> by 2 matrix, which is the transition matrix of the VAR(<code>p</code>) model.</p>
</dd>
<dt><code>Delta</code></dt><dd><p>a 2 by 2 matrix, which is the covariance matrix of the initial condition of the Gaussian white noise processes.</p>
</dd>
</dl>



<h3>Details</h3>

<p> The true parameters are set as follows. The number of time points is 500. The coefficients are set to be <code class="reqn">A = 0.5</code>, <code class="reqn">C = 0.5</code> and <code class="reqn">B = -1</code>. The variances of the model errors are <code class="reqn">\sigma_1^2 = 1</code>, <code class="reqn">\sigma_2^2 = 4</code> and the correlation is <code class="reqn">\delta = 0.5</code>. For the VAR model, we consider the case <code class="reqn">p = 1</code>, and the parameter settings satisfy the stationarity condition.
</p>


<h3>References</h3>

<p>Zhao, Y., &amp; Luo, X. (2017). <em>Granger Mediation Analysis of Multiple Time Series with an Application to fMRI.</em> arXiv preprint arXiv:1709.05328.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(env.single)
dt&lt;-get("data1",env.single)
</code></pre>

<hr>
<h2 id='env.two'> Simulated two-level dataset
</h2><span id='topic+env.two'></span>

<h3>Description</h3>

<p> &quot;env.two&quot; is an R environment containing a data list generated from 50 subjects, and the parameter settings used to generate the data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("env.two")</code></pre>


<h3>Format</h3>

<p> An R environment.
</p>

<dl>
<dt><code>data2</code></dt><dd><p>a list of length 50, each contains a data frame with 3 variables.</p>
</dd>
<dt><code>error2</code></dt><dd><p>a list of length 50, each contains a data frame with 2 columns.</p>
</dd>
<dt><code>theta</code></dt><dd><p>a 3 by 1 vector, which is the population level coefficients <code>(A,B,C)</code> of the model.</p>
</dd>
<dt><code>Sigma</code></dt><dd><p>a 2 by 2 matrix, which is the covariance matrix of the two Gaussian white noise processes.</p>
</dd>
<dt><code>p</code></dt><dd><p>the order of the vector autoregressive (VAR) model.</p>
</dd>
<dt><code>W</code></dt><dd><p>a 2<code>p</code> by 2 matrix, which is the transition matrix of the VAR(<code>p</code>) model.</p>
</dd>
<dt><code>Delta</code></dt><dd><p>a 2 by 2 matrix, which is the covariance matrix of the initial condition of the Gaussian white noise processes.</p>
</dd>
<dt><code>n</code></dt><dd><p>a 50 by 1 matrix, is the number of time points for each subject.</p>
</dd>
<dt><code>Lambda</code></dt><dd><p>the covariance matrix of the model errors in the coefficient regression model.</p>
</dd>
<dt><code>A</code></dt><dd><p>a vector of length 50, is the <code>A</code> value in the single-level for each subject.</p>
</dd>
<dt><code>B</code></dt><dd><p>a vector of length 50, is the <code>B</code> value in the single-level for each subject.</p>
</dd>
<dt><code>C</code></dt><dd><p>a vector of length 50, is the <code>C</code> value in the single-level for each subject.</p>
</dd>
</dl>



<h3>Details</h3>

<p> The true parameters are set as follows. The number of subjects i <code class="reqn">N = 50</code>. For each subject, the number of time points is a random draw from a Poisson distribution with mean 100. The population level coefficients are set to be <code class="reqn">A = 0.5</code>, <code class="reqn">C = 0.5</code> and <code class="reqn">B = -1</code>, and the variances of the Gaussian white noise process are assumed to be the same across participants with <code class="reqn">\sigma_{1_{i}}^2 = 1</code>, <code class="reqn">\sigma_{2_{i}}^2 = 4</code> and the correlation is <code class="reqn">\delta = 0.5</code>. For the VAR model, we consider the case <code class="reqn">p = 1</code>, and the parameter settings satisfy the stationarity condition.
</p>


<h3>References</h3>

<p>Zhao, Y., &amp; Luo, X. (2017). <em>Granger Mediation Analysis of Multiple Time Series with an Application to fMRI.</em> arXiv preprint arXiv:1709.05328.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(env.two)
dt&lt;-get("data2",env.two)
</code></pre>

<hr>
<h2 id='gma'> Granger Mediation Analysis of Time Series
</h2><span id='topic+gma'></span>

<h3>Description</h3>

<p> This function performs Granger Mediation Analysis (GMA) for time series data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gma(dat, model.type = c("single", "twolevel"), method = c("HL", "TS", "HL-TS"), 
  delta = NULL, p = 1, single.var.asmp = TRUE, sens.plot = FALSE, 
  sens.delta = seq(-1, 1, by = 0.01), legend.pos = "topright", 
  xlab = expression(delta), ylab = expression(hat(AB)), cex.lab = 1, 
  cex.axis = 1, lgd.cex = 1, lgd.pt.cex = 1, plot.delta0 = TRUE, 
  interval = c(-0.9, 0.9), tol = 1e-04, max.itr = 500, conf.level = 0.95, 
  error.indep = TRUE, error.var.equal = FALSE, 
  Sigma.update = TRUE, var.constraint = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gma_+3A_dat">dat</code></td>
<td>
<p> a data frame or a list of data. When it is a data frame, it contains <code>Z</code> as the treatment/exposure assignment, <code>M</code> as the mediator and <code>R</code> as the interested outcome and <code>model.type</code> should be &quot;single&quot;. <code>Z</code>, <code>M</code> and <code>R</code> are all in one column. When it is a list, the list length is the number of subjects. For a two-level dataset, each list contains one data frame with <code>Z</code>, <code>M</code> and <code>R</code>, and <code>model.type</code> should be &quot;twolevel&quot;.
</p>
</td></tr>
<tr><td><code id="gma_+3A_model.type">model.type</code></td>
<td>
<p> a character of model type, &quot;single&quot; for single level model, &quot;twolevel&quot; for two-level model.
</p>
</td></tr>
<tr><td><code id="gma_+3A_method">method</code></td>
<td>
<p> a character of method that is used for the two-level GMA model. When <code>delta</code> is given, the method can be either &quot;HL&quot; (full likelihood) or &quot;TS&quot; (two-stage); when <code>delta</code> is not given, the method can be &quot;HL&quot;, &quot;TS&quot; or &quot;HL-TS&quot;. The &quot;HL-TS&quot; method estimates <code>delta</code> by the &quot;HL&quot; method first and uses the &quot;TS&quot; method to estimate the rest parameters.
</p>
</td></tr>
<tr><td><code id="gma_+3A_delta">delta</code></td>
<td>
<p> a number gives the correlation between the Gaussian white noise processes. Default value is <code>NULL</code>. When <code>model.type = "single"</code>, the default will be <code>0</code>. For two-level model, if <code>delta = NULL</code>, the value of <code>delta</code> will be estimated.
</p>
</td></tr>
<tr><td><code id="gma_+3A_p">p</code></td>
<td>
<p> a number gives the order of the vector autoregressive model. Default value is <code>1</code>. 
</p>
</td></tr>
<tr><td><code id="gma_+3A_single.var.asmp">single.var.asmp</code></td>
<td>
<p> a logic value indicates if in the single level model, the asymptotic variance will be used. Default value is <code>TRUE</code>.
</p>
</td></tr>
<tr><td><code id="gma_+3A_sens.plot">sens.plot</code></td>
<td>
<p> a logic value. Default is <code>FALSE</code>. This is used only for single level model. When <code>sens.plot = TRUE</code>, the sensitivity analysis will be performed and plotted.
</p>
</td></tr>
<tr><td><code id="gma_+3A_sens.delta">sens.delta</code></td>
<td>
<p> a sequence of <code>delta</code> values under which the sensitivity analysis is performed. Default is a sequence from -1 to 1 with increment 0.01. The elements with absolute value 1 will be excluded from the analysis.
</p>
</td></tr>
<tr><td><code id="gma_+3A_legend.pos">legend.pos</code></td>
<td>
<p> a character indicates the location of the legend when <code>sens.plot = TRUE</code>. This is used for single level model.
</p>
</td></tr>
<tr><td><code id="gma_+3A_xlab">xlab</code></td>
<td>
<p> a title for <code>x</code> axis in the sensitivity plot.
</p>
</td></tr>
<tr><td><code id="gma_+3A_ylab">ylab</code></td>
<td>
<p> a title for <code>y</code> axis in the sensitivity plot.
</p>
</td></tr>
<tr><td><code id="gma_+3A_cex.lab">cex.lab</code></td>
<td>
<p> the magnification to be used for <code>x</code> and <code>y</code> labels relative to the current setting of <code>cex</code>.
</p>
</td></tr>
<tr><td><code id="gma_+3A_cex.axis">cex.axis</code></td>
<td>
<p> the magnification to be used for axis annotation relative to the current setting of <code>cex</code>.
</p>
</td></tr>
<tr><td><code id="gma_+3A_lgd.cex">lgd.cex</code></td>
<td>
<p> the magnification to be used for legend relative to the current setting of <code>cex</code>.
</p>
</td></tr>
<tr><td><code id="gma_+3A_lgd.pt.cex">lgd.pt.cex</code></td>
<td>
<p> the magnification to be used for the points in legend relative to the current setting of <code>cex</code>.
</p>
</td></tr>
<tr><td><code id="gma_+3A_plot.delta0">plot.delta0</code></td>
<td>
<p> a logic value. Default is <code>TRUE</code>. When <code>plot.delta0 = TRUE</code>, the estimates when <code class="reqn">\delta = 0</code> is plotted.
</p>
</td></tr>
<tr><td><code id="gma_+3A_interval">interval</code></td>
<td>
<p> a vector of length two indicates the searching interval when estimating <code>delta</code>. Default is (-0.9,0.9).
</p>
</td></tr>
<tr><td><code id="gma_+3A_tol">tol</code></td>
<td>
<p> a number indicates the tolerance of convergence for the &quot;HL&quot; method. Default is <code>1e-4</code>.
</p>
</td></tr>
<tr><td><code id="gma_+3A_max.itr">max.itr</code></td>
<td>
<p> an integer indicates the maximum number of iteration for the &quot;HL&quot; method. Default is 500.
</p>
</td></tr>
<tr><td><code id="gma_+3A_conf.level">conf.level</code></td>
<td>
<p> a number indicates the significance level of the confidence intervals. Default is 0.95.
</p>
</td></tr>
<tr><td><code id="gma_+3A_error.indep">error.indep</code></td>
<td>
<p> a logic value. Default is <code>TRUE</code>. This is used for <code>model.type = "twolevel"</code>. When <code>error.indep = TRUE</code>, the error terms in the linear models for <code class="reqn">A</code>, <code class="reqn">B</code> and <code class="reqn">C</code> are independent.
</p>
</td></tr>
<tr><td><code id="gma_+3A_error.var.equal">error.var.equal</code></td>
<td>
<p> a logic value. Default is <code>FALSE</code>. This is used for <code>model.type = "twolevel"</code>. When <code>error.var.equal = TRUE</code>, the variances of the error terms in the linear models for <code class="reqn">A</code>, <code class="reqn">B</code> and <code class="reqn">C</code> are assumed to be identical.
</p>
</td></tr>
<tr><td><code id="gma_+3A_sigma.update">Sigma.update</code></td>
<td>
<p> a logic value. Default is <code>TRUE</code>, and the estimated variances of the Gaussian white noise processes in the single level model will be updated in each iteration when running a two-level GMA model.
</p>
</td></tr>
<tr><td><code id="gma_+3A_var.constraint">var.constraint</code></td>
<td>
<p> a logic value. Default is <code>TRUE</code>, and an interval constraint is added on the variance components in the higher level regression model of the two-level GMA model.
</p>
</td></tr>
<tr><td><code id="gma_+3A_...">...</code></td>
<td>
<p> additional arguments to be passed.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p> The single level GMA model is
</p>
<p style="text-align: center;"><code class="reqn">M_{t}=Z_{t}A+E_{1t},</code>
</p>

<p style="text-align: center;"><code class="reqn">R_{t}=Z_{t}C+M_{t}B+E_{2t},</code>
</p>

<p>and for stochastic processes <code class="reqn">(E_{1t},E_{2t})</code>,
</p>
<p style="text-align: center;"><code class="reqn">E_{1t}=\sum_{j=1}^{p}\omega_{11_{j}}E_{1,t-j}+\sum_{j=1}^{p}\omega_{21_{j}}E_{2,t-j}+\epsilon_{1t},</code>
</p>

<p style="text-align: center;"><code class="reqn">E_{2t}=\sum_{j=1}^{p}\omega_{12_{j}}E_{1,t-j}+\sum_{j=1}^{p}\omega_{22_{j}}E_{2,t-j}+\epsilon_{2t}.</code>
</p>

<p>A correlation between the Gaussian white noise <code class="reqn">(\epsilon_{1t},\epsilon_{2t})</code> is assumed to be <code class="reqn">\delta</code>. The coefficients, as well as the transition matrix, are estimated by maximizing the conditional log-likelihood function. The confidence intervals of the coefficients are calculated based on the asymptotic joint distribution. The variance of <code class="reqn">AB</code> estimator based on either the product method or the difference method is obtained from the Delta method. Under this single level model, <code class="reqn">\delta</code> is not identifiable. Sensitivity analysis for the indirect effect (<code class="reqn">AB</code>) can be used to assess the deviation of the findings from assuming <code class="reqn">\delta = 0</code>, when the independence assumption is violated.
</p>
<p>The two-level GMA model is introduced to estimate <code class="reqn">\delta</code> from data without sensitivity analysis. It addresses the individual variation issue for datasets with hierarchically nested structure. For simplicity, we refer to the two levels of data by time series and subjects. Under the two-level GMA model, the data consists of <code class="reqn">N</code> independent subjects and a time series of length <code class="reqn">n_{i}</code>. The single level GMA model is first applied on the time series from a single subject. The coefficients then follow a linear model. Here we enforce the assumption that <code class="reqn">\delta</code> is a constant across subjects. The parameters are estimated through a full likelihood or a two-stage method.
</p>


<h3>Value</h3>

<p> When <code>model.type = "single"</code>,
</p>
<table>
<tr><td><code>Coefficients</code></td>
<td>
<p>point estimate of the coefficients, as well as the corresponding standard error and confidence interval. The indirect effect is estimated by both the produce (<code>ABp</code>) and the difference (<code>ABd</code>) methods.</p>
</td></tr>
<tr><td><code>D</code></td>
<td>
<p>point estimate of the causal coefficients in matrix form.</p>
</td></tr>
<tr><td><code>Sigma</code></td>
<td>
<p>estimate covariance matrix of the Gaussian white noise.</p>
</td></tr>
<tr><td><code>delta</code></td>
<td>
<p>the <code class="reqn">\delta</code> value used to estimate the rest parameters.</p>
</td></tr>
<tr><td><code>W</code></td>
<td>
<p>estimate of the transition matrix in the VAR(p) model.</p>
</td></tr>
<tr><td><code>LL</code></td>
<td>
<p>the conditional log-likelihood value.</p>
</td></tr>
<tr><td><code>time</code></td>
<td>
<p>the CPU time used, see <code><a href="base.html#topic+system.time">system.time</a></code>.</p>
</td></tr>
</table>
<p>When <code>model.type = "twolevel"</code>
</p>
<table>
<tr><td><code>delta</code></td>
<td>
<p>the specified or estimated value of correlation parameter <code class="reqn">\delta</code>.</p>
</td></tr>
<tr><td><code>Coefficients</code></td>
<td>
<p>the estimated population level effect in the regression models.</p>
</td></tr>
<tr><td><code>Lambda</code></td>
<td>
<p>the estimated covariance matrix of the model errors in the higher level coefficient regression models.</p>
</td></tr>
<tr><td><code>Sigma</code></td>
<td>
<p>the estimated variances of <code class="reqn">\epsilon_{1t}</code> and <code class="reqn">\epsilon_{2t}</code> for each subject.</p>
</td></tr>
<tr><td><code>W</code></td>
<td>
<p>the estimated population level transition matrix.</p>
</td></tr>
<tr><td><code>HL</code></td>
<td>
<p>the value of full likelihood.</p>
</td></tr>
<tr><td><code>convergence</code></td>
<td>
<p>the logic value indicating if the method converges.</p>
</td></tr>
<tr><td><code>var.constraint</code></td>
<td>
<p>the interval constraints used for the variances in the higher level coefficient regression models.</p>
</td></tr>
<tr><td><code>time</code></td>
<td>
<p>the CPU time used, see <code><a href="base.html#topic+system.time">system.time</a></code>.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p> Yi Zhao, Brown University, <a href="mailto:zhaoyi1026@gmail.com">zhaoyi1026@gmail.com</a>;
Xi Luo, Brown University, <a href="mailto:xi.rossi.luo@gmail.com">xi.rossi.luo@gmail.com</a>.
</p>


<h3>References</h3>

<p>Zhao, Y., &amp; Luo, X. (2017). <em>Granger Mediation Analysis of Multiple Time Series with an Application to fMRI.</em> arXiv preprint arXiv:1709.05328.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Example with simulated data

##############################################################################
# Single level GMA model
# Data was generated with 500 time points.
# The correlation between Gaussian white noise is 0.5.
data(env.single)
data.SL&lt;-get("data1",env.single)

## Example 1: Given delta is 0.5.
gma(data.SL,model.type="single",delta=0.5)
# $Coefficients
#          Estimate         SE         LB         UB
# A     0.519090451 0.06048910  0.4005340  0.6376469
# C     0.487396067 0.12650909  0.2394428  0.7353493
# B    -0.951262962 0.07693595 -1.1020547 -0.8004713
# C2   -0.006395453 0.12125003 -0.2440411  0.2312502
# AB.p -0.493791520 0.07004222 -0.6310717 -0.3565113
# AB.d -0.493791520 0.17523161 -0.8372392 -0.1503439

## Example 2: Assume the white noise are independent.
gma(data.SL,model.type="single",delta=0)
# $Coefficients
#          Estimate         SE          LB         UB
# A     0.519090451 0.06048910  0.40053400 0.63764690
# C    -0.027668910 0.11136493 -0.24594015 0.19060234
# B     0.040982178 0.07693595 -0.10980952 0.19177387
# C2   -0.006395453 0.12125003 -0.24404115 0.23125024
# AB.p  0.021273457 0.04001358 -0.05715172 0.09969864
# AB.d  0.021273457 0.16463207 -0.30139946 0.34394638

## Example 3: Sensitivity analysis (given delta is 0.5)
# We comment out the example due to the computation time.
# gma(data.SL,model.type="single",delta=0.5,sens.plot=TRUE)
##############################################################################

##############################################################################
# Two-level GMA model
# Data was generated with 50 subjects.
# The correlation between white noise in the single level model is 0.5.
# The time series is generate from a VAR(1) model.
# We comment out our examples due to the computation time.
data(env.two)
data.TL&lt;-get("data2",env.two)

## Example 1: Correlation is unknown and to be estimated.
# Assume errors in the coefficients model are independent.
# Add an interval constraint on the variance components.

# "HL" method
# gma(data.TL,model.type="twolevel",method="HL",p=1)
# $delta
# [1] 0.5176206
# 
# $Coefficients
#           Estimate
# A        0.5587349
# C        0.7129338
# B       -1.0453097
# C2       0.1213349
# AB.prod -0.5840510
# AB.diff -0.5915989
# 
# $time
#   user  system elapsed 
# 12.285   0.381  12.684 

# "TS" method
# gma(data.TL,model.type="twolevel",method="TS",p=1)
# $delta
# [1] 0.4993492
# 
# $Coefficients
#           Estimate
# A        0.5569101
# C        0.6799228
# B       -0.9940383
# C2       0.1213349
# AB.prod -0.5535900
# AB.diff -0.5585879
# 
# $time
#  user  system elapsed 
# 7.745   0.175   7.934 

## Example 2: Given the correlation is 0.5.
# Assume errors in the coefficients model are independent.
# Add an interval constraint on the variance components.

# "HL" method
# gma(data.TL,model.type="twolevel",method="HL",delta=0.5,p=1)
# $delta
# [1] 0.5
# 
# $Coefficients
#           Estimate
# A        0.5586761
# C        0.6881703
# B       -0.9997898
# C2       0.1213349
# AB.prod -0.5585587
# AB.diff -0.5668355
# 
# $time
#  user  system elapsed 
# 0.889   0.023   0.913
##############################################################################
</code></pre>

<hr>
<h2 id='gma-package'>
Granger Mediation Analysis
</h2><span id='topic+gma-package'></span>

<h3>Description</h3>

<p>gma performs Granger Mediation Analysis (GMA) of time series. This package includes a single level GMA model and a two-level GMA model, for time series with hierarchically nested structure. The single level GMA model for the time series of a single participant performs the causal mediation analysis which integrates the structural equation modeling and the Granger causality frameworks. A multivariate autoregressive model of order p is employed to account for the spatiotemporal dependencies in the data. Meanwhile, the model introduces the unmeasured confounding effect through a nonzero correlation parameter. Under the two-level model, by leveraging the variabilities across participants, the parameters are identifiable and consistently estimated using a two-stage method or a block coordinate descent method.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> gma </td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package </td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.0 </td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2017-08-23 </td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL (&gt;=2) </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Yi Zhao &lt;zhaoyi1026@gmail.com&gt; and Xi Luo &lt;xi.rossi.luo@gmail.com&gt; <br />
</p>
<p>Maintainer: Yi Zhao &lt;zhaoyi1026@gmail.com&gt;
</p>


<h3>References</h3>

<p>Zhao, Y., &amp; Luo, X. (2017). <em>Granger Mediation Analysis of Multiple Time Series with an Application to fMRI.</em> arXiv preprint arXiv:1709.05328.
</p>

<hr>
<h2 id='sim.data.ts.single'> Generate single-level simulation data
</h2><span id='topic+sim.data.ts.single'></span>

<h3>Description</h3>

<p> This function generates a single-level dataset with given parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim.data.ts.single(n, Z, A, B, C, Sigma, W, Delta = NULL, p = NULL, nburn = 100)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sim.data.ts.single_+3A_n">n</code></td>
<td>
<p> an integer indicating the length of the time series.
</p>
</td></tr>
<tr><td><code id="sim.data.ts.single_+3A_z">Z</code></td>
<td>
<p> a vector of treatment/exposure assignment at each time point.
</p>
</td></tr>
<tr><td><code id="sim.data.ts.single_+3A_a">A</code></td>
<td>
<p> a numeric value of model coefficient.
</p>
</td></tr>
<tr><td><code id="sim.data.ts.single_+3A_b">B</code></td>
<td>
<p> a numeric value of model coefficient.
</p>
</td></tr>
<tr><td><code id="sim.data.ts.single_+3A_c">C</code></td>
<td>
<p> a numeric value of model coefficient.
</p>
</td></tr>
<tr><td><code id="sim.data.ts.single_+3A_sigma">Sigma</code></td>
<td>
<p> a 2 by 2 matrix, is the covariance matrix of the two Gaussian white noise processes.
</p>
</td></tr>
<tr><td><code id="sim.data.ts.single_+3A_w">W</code></td>
<td>
<p> a <code class="reqn">2p</code> by 2 matrix, is the transition matrix.
</p>
</td></tr>
<tr><td><code id="sim.data.ts.single_+3A_delta">Delta</code></td>
<td>
<p> a 2 by 2 matrix, is the covariance matrix of the initial condition. Default is <code>NULL</code>, will be the same as <code>Sigma</code>.
</p>
</td></tr>
<tr><td><code id="sim.data.ts.single_+3A_p">p</code></td>
<td>
<p> a numeric value indicating the order of the vector autoregressive (VAR) model. Default is <code>NULL</code>, will be calculated based on <code>W</code>.
</p>
</td></tr>
<tr><td><code id="sim.data.ts.single_+3A_nburn">nburn</code></td>
<td>
<p> a integer indicating the number of burning sample. Default is 100.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p> The single level GMA model is
</p>
<p style="text-align: center;"><code class="reqn">M_{t}=Z_{t}A+E_{1t},</code>
</p>

<p style="text-align: center;"><code class="reqn">R_{t}=Z_{t}C+M_{t}B+E_{2t},</code>
</p>

<p>and for stochastic processes <code class="reqn">(E_{1t},E_{2t})</code>,
</p>
<p style="text-align: center;"><code class="reqn">E_{1t}=\sum_{j=1}^{p}\omega_{11_{j}}E_{1,t-j}+\sum_{j=1}^{p}\omega_{21_{j}}E_{2,t-j}+\epsilon_{1t},</code>
</p>

<p style="text-align: center;"><code class="reqn">E_{2t}=\sum_{j=1}^{p}\omega_{12_{j}}E_{1,t-j}+\sum_{j=1}^{p}\omega_{22_{j}}E_{2,t-j}+\epsilon_{2t}.</code>
</p>

<p><code>Sigma</code> is the covariance matrix of the Gaussian white noise <code class="reqn">(\epsilon_{1t},\epsilon_{2t})</code>, and <code>Delta</code> is the covariance matrix of <code class="reqn">(\epsilon_{10},\epsilon_{20})</code>. <code>W</code> is the transition matrix with element <code class="reqn">\omega</code>'s.
</p>


<h3>Value</h3>

<p> The function returns a list with two data frames. One is the data with variables <code>Z</code>, <code>M</code> and <code>R</code>; one is the data frame of <code class="reqn">(E_{1t},E_{2t})</code>.
</p>


<h3>Author(s)</h3>

<p> Yi Zhao, Brown University, <a href="mailto:zhaoyi1026@gmail.com">zhaoyi1026@gmail.com</a>;
Xi Luo, Brown University, <a href="mailto:xi.rossi.luo@gmail.com">xi.rossi.luo@gmail.com</a>
</p>


<h3>References</h3>

<p>Zhao, Y., &amp; Luo, X. (2017). <em>Granger Mediation Analysis of Multiple Time Series with an Application to fMRI.</em> arXiv preprint arXiv:1709.05328.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>###################################################
# Generate a single-level dataset

# covariance matrix of errors
delta&lt;-0.5
Sigma&lt;-matrix(c(1,2*delta,2*delta,4),2,2)

# model coefficients
A0&lt;-0.5
B0&lt;--1
C0&lt;-0.5

# number of time points
n&lt;-500

# generate a treatment assignment vector
set.seed(1000)
Z&lt;-matrix(rbinom(n,size=1,prob=0.5),n,1)

# VAR(1) model
p&lt;-1

# Delta and W matrices
Delta&lt;-matrix(c(2,delta*sqrt(2*8),delta*sqrt(2*8),8),2,2)
W&lt;-matrix(c(-0.809,0.154,-0.618,-0.5),2,2)

# number of burning samples
nburn&lt;-1000

set.seed(1000)
data.single&lt;-sim.data.ts.single(n,Z,A0,B0,C0,Sigma,W,Delta,p=p,nburn=nburn)
###################################################
</code></pre>

<hr>
<h2 id='sim.data.ts.two'> Generate two-level simulation data
</h2><span id='topic+sim.data.ts.two'></span>

<h3>Description</h3>

<p> This function generates a two-level dataset with given parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim.data.ts.two(Z.list, N, theta, Sigma, W, Delta = NULL, p = NULL, 
  Lambda = diag(rep(1, 3)), nburn = 100)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sim.data.ts.two_+3A_z.list">Z.list</code></td>
<td>
<p> a list of data. Each list is a vector containing the treatment/exposure assignment at each time point for the subject.
</p>
</td></tr>
<tr><td><code id="sim.data.ts.two_+3A_n">N</code></td>
<td>
<p> an integer, indicates the number of subjects.
</p>
</td></tr>
<tr><td><code id="sim.data.ts.two_+3A_theta">theta</code></td>
<td>
<p> a vector of length 3, contains the population level causal effect coefficients.
</p>
</td></tr>
<tr><td><code id="sim.data.ts.two_+3A_sigma">Sigma</code></td>
<td>
<p> a 2 by 2 matrix, is the covariance matrix of the two Gaussian white noise processes in the single level model.
</p>
</td></tr>
<tr><td><code id="sim.data.ts.two_+3A_w">W</code></td>
<td>
<p> a <code class="reqn">2p</code> by 2 matrix, is the transition matrix in the single level model.
</p>
</td></tr>
<tr><td><code id="sim.data.ts.two_+3A_delta">Delta</code></td>
<td>
<p> a 2 by 2 matrix, is the covariance matrix of the initial condition in the single level model. Default is <code>NULL</code>, will be the same as <code>Sigma</code>.
</p>
</td></tr>
<tr><td><code id="sim.data.ts.two_+3A_p">p</code></td>
<td>
<p> an integer, indicates the order of the vector autoregressive (VAR) model in the single level model. Default is <code>NULL</code>, will be calculated based on <code>W</code>.
</p>
</td></tr>
<tr><td><code id="sim.data.ts.two_+3A_lambda">Lambda</code></td>
<td>
<p> the covariance matrix of the model errors in the linear model of the model coefficients. Default is a 3 by 3 identity matrix.
</p>
</td></tr>
<tr><td><code id="sim.data.ts.two_+3A_nburn">nburn</code></td>
<td>
<p> a integer indicating the number of burning sample in the single level model. Default is 100.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p> For the time series of length <code class="reqn">n_{i}</code> of subject <code class="reqn">i</code>, the single level GMA model is
</p>
<p style="text-align: center;"><code class="reqn">M_{i_{t}}=Z_{i_{t}}A_{i}+E_{i_{1t}},</code>
</p>

<p style="text-align: center;"><code class="reqn">R_{i_{t}}=Z_{i_{t}}C_{i}+M_{i_{t}}B_{i}+E_{i_{2t}},</code>
</p>

<p>and
</p>
<p style="text-align: center;"><code class="reqn">E_{i_{1t}}=\sum_{j=1}^{p}\omega_{i_{11_{j}}}E_{i_{1,t-j}}+\sum_{j=1}^{p}\omega_{i_{21_{j}}}E_{i_{2,t-j}}+\epsilon_{i_{1t}},</code>
</p>

<p style="text-align: center;"><code class="reqn">E_{i_{2t}}=\sum_{j=1}^{p}\omega_{i_{12_{j}}}E_{i_{1,t-j}}+\sum_{j=1}^{p}\omega_{i_{22_{j}}}E_{i_{2,t-j}}+\epsilon_{i_{2t}},</code>
</p>

<p>where <code>Sigma</code> is the covariance matrix of <code class="reqn">(\epsilon_{i_{1t}},\epsilon_{i_{2t}})</code> (for simplicity, <code>Sigma</code> is the same across subjects). For coefficients <code class="reqn">A_{i}</code>, <code class="reqn">B_{i}</code> and <code class="reqn">C_{i}</code>, we assume a multivariate regression model. The model errors are from a trivariate normal distribution with mean zero and covariance <code>Lambda</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>data</code></td>
<td>
<p>a list of data. Each list is a data frame of <code class="reqn">(Z_{t},M_{t},R_{t})</code>.</p>
</td></tr>
<tr><td><code>error</code></td>
<td>
<p>a list of data. Each list is a data frame of <code class="reqn">(E_{1t},E_{2t})</code>.</p>
</td></tr>
<tr><td><code>A</code></td>
<td>
<p>a vector of length <code>N</code>, the value of <code class="reqn">A</code>s.</p>
</td></tr>
<tr><td><code>B</code></td>
<td>
<p>a vector of length <code>N</code>, the value of <code class="reqn">B</code>s.</p>
</td></tr>
<tr><td><code>C</code></td>
<td>
<p>a vector of length <code>N</code>, the value of <code class="reqn">C</code>s.</p>
</td></tr>
<tr><td><code>type</code></td>
<td>
<p>a character indicates the type of the dataset.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p> Yi Zhao, Brown University, <a href="mailto:zhaoyi1026@gmail.com">zhaoyi1026@gmail.com</a>;
Xi Luo, Brown University, <a href="mailto:xi.rossi.luo@gmail.com">xi.rossi.luo@gmail.com</a>
</p>


<h3>References</h3>

<p>Zhao, Y., &amp; Luo, X. (2017). <em>Granger Mediation Analysis of Multiple Time Series with an Application to fMRI.</em> arXiv preprint arXiv:1709.05328.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>###################################################
# Generate a two-level dataset

# covariance matrix of errors
delta&lt;-0.5
Sigma&lt;-matrix(c(1,2*delta,2*delta,4),2,2)

# model coefficients
A0&lt;-0.5
B0&lt;--1
C0&lt;-0.5

theta&lt;-c(A0,B0,C0)

# number of time points
N&lt;-50
set.seed(2000)
n&lt;-matrix(rpois(N,100),N,1)

# treatment assignment list
set.seed(1000)
Z.list&lt;-list()
for(i in 1:N)
{
  Z.list[[i]]&lt;-matrix(rbinom(n[i,1],size=1,prob=0.5),n[i,1],1)
}

# Lambda
Lambda&lt;-diag(0.5,3)

# VAR(1) model
p&lt;-1

# Delta and W matrices
Delta&lt;-matrix(c(2,delta*sqrt(2*8),delta*sqrt(2*8),8),2,2)
W&lt;-matrix(c(-0.809,0.154,-0.618,-0.5),2,2)

# number of burning samples
nburn&lt;-1000

# set.seed(2000)
# data2&lt;-sim.data.ts.two(Z.list,N,theta=theta,Sigma,W,Delta,p,Lambda,nburn)
###################################################
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
