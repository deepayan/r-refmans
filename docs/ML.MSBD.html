<!DOCTYPE html><html><head><title>Help for package ML.MSBD</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ML.MSBD}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#ML.MSBD-package'>
<p>Maximum Likelihood Inference on Multi-State Trees</p></a></li>
<li><a href='#likelihood_MSBD'><p>Likelihood calculation for randomly sampled trees</p></a></li>
<li><a href='#likelihood_MSBD_unresolved'><p>Likelihood calculation for unresolved trees</p></a></li>
<li><a href='#ML_MSBD'><p>Full Maximum Likelihood inference of birth and death rates together with their changes along a phylogeny under a multi-type birth-death model.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Maximum Likelihood Inference on Multi-State Trees</td>
</tr>
<tr>
<td>Version:</td>
<td>1.2.1</td>
</tr>
<tr>
<td>Description:</td>
<td>Inference of a multi-states birth-death model from a phylogeny, comprising a number of states N, birth and death rates for each state and on which edges each state appears. Inference is done using a hybrid approach: states are progressively added in a greedy approach. For a fixed number of states N the best model is selected via maximum likelihood. Reference: J. Barido-Sottani, T. G. Vaughan and T. Stadler (2018) &lt;<a href="https://doi.org/10.1098%2Frsif.2018.0512">doi:10.1098/rsif.2018.0512</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>ape (&ge; 5.1), foreach</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, doParallel</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>6.1.1</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-04-16 17:35:07 UTC; joellebs</td>
</tr>
<tr>
<td>Author:</td>
<td>Joelle Barido-Sottani [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Joelle Barido-Sottani &lt;joelle.barido-sottani@m4x.org&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-04-16 18:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='ML.MSBD-package'>
Maximum Likelihood Inference on Multi-State Trees
</h2><span id='topic+ML.MSBD-package'></span><span id='topic+ML.MSBD'></span>

<h3>Description</h3>

<p>Inference of a multi-states birth-death model from a phylogeny, comprising a number of states N, birth and death rates for each state and on which edges each state appears. Inference is done using a hybrid approach: states are progressively added in a greedy approach. For a fixed number of states N the best model is selected via maximum likelihood. Reference: J. Barido-Sottani, T. G. Vaughan and T. Stadler (2018) &lt;doi:10.1098/rsif.2018.0512&gt;.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> ML.MSBD</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Title: </td><td style="text-align: left;"> Maximum Likelihood Inference on Multi-State Trees</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.2.1</td>
</tr>
<tr>
 <td style="text-align: left;">
Authors@R: </td><td style="text-align: left;"> person("Joelle", "Barido-Sottani", email = "joelle.barido-sottani@m4x.org", role = c("aut", "cre"))</td>
</tr>
<tr>
 <td style="text-align: left;">
Description: </td><td style="text-align: left;"> Inference of a multi-states birth-death model from a phylogeny, comprising a number of states N, birth and death rates for each state and on which edges each state appears. Inference is done using a hybrid approach: states are progressively added in a greedy approach. For a fixed number of states N the best model is selected via maximum likelihood. Reference: J. Barido-Sottani, T. G. Vaughan and T. Stadler (2018) &lt;doi:10.1098/rsif.2018.0512&gt;.</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL-3</td>
</tr>
<tr>
 <td style="text-align: left;">
Imports: </td><td style="text-align: left;"> ape (&gt;= 5.1),
foreach</td>
</tr>
<tr>
 <td style="text-align: left;">
Suggests: </td><td style="text-align: left;"> knitr,
rmarkdown,
doParallel</td>
</tr>
<tr>
 <td style="text-align: left;">
RoxygenNote: </td><td style="text-align: left;"> 6.1.1</td>
</tr>
<tr>
 <td style="text-align: left;">
VignetteBuilder: </td><td style="text-align: left;"> knitr</td>
</tr>
<tr>
 <td style="text-align: left;">
Author: </td><td style="text-align: left;"> Joelle Barido-Sottani [aut, cre]</td>
</tr>
<tr>
 <td style="text-align: left;">
Maintainer: </td><td style="text-align: left;"> Joelle Barido-Sottani &lt;joelle.barido-sottani@m4x.org&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>


<p>Index of help topics:
</p>
<pre>
ML.MSBD-package         Maximum Likelihood Inference on Multi-State
                        Trees
ML_MSBD                 Full Maximum Likelihood inference of birth and
                        death rates together with their changes along a
                        phylogeny under a multi-type birth-death model.
likelihood_MSBD         Likelihood calculation for randomly sampled
                        trees
likelihood_MSBD_unresolved
                        Likelihood calculation for unresolved trees
</pre>


<h3>Author(s)</h3>

<p>NA
</p>
<p>Maintainer: NA
</p>


<h3>References</h3>

<p>J. Barido-Sottani and T. Stadler. Accurate detection of HIV transmission clusters from phylogenetic trees using a multi-state birth-death model, BioRXiv 2017. (https://www.biorxiv.org/content/early/2017/11/10/215491)
</p>


<h3>See Also</h3>

<p><code><a href="ape.html#topic+ape-package">ape</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulate a random phylogeny
set.seed(25)
tree &lt;- ape::rtree(10)

# Calculate the log likelihood under a multi-states model with 2 states 
# and full extant &amp; extinct sampling
likelihood_MSBD(tree, shifts = matrix(c(2,1.8,2), nrow = 1), 
  gamma = 0.05, lambdas = c(10, 6), mus = c(1, 0.5), sigma = 1)

# Infer the most likely multi-states birth-death model with full extant &amp; extinct sampling
## Not run: ML_MSBD(tree, initial_values = c(0.1, 10, 1), sigma = 1, time_mode = "mid") 
# Infer the most likely multi-states birth-death model with exponential decay 
# and full extant &amp; extinct sampling
## Not run: ML_MSBD(tree, initial_values = c(0.1, 10, 0.5, 1), sigma = 1, 
  stepsize = 0.1, time_mode = "mid")
## End(Not run)
</code></pre>

<hr>
<h2 id='likelihood_MSBD'>Likelihood calculation for randomly sampled trees</h2><span id='topic+likelihood_MSBD'></span>

<h3>Description</h3>

<p>Calculates the negative log likelihood of a multi-states model given a tree. 
This function is designed to work with constant extant and/or extinct sampling.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>likelihood_MSBD(tree, shifts, gamma, lambdas, mus, lambda_rates = NULL,
  stepsize = NULL, uniform_weights = TRUE, p_lambda = 0, p_mu = 0,
  rho = 1, sigma = 0, rho_sampling = TRUE, add_time = 0,
  unresolved = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="likelihood_MSBD_+3A_tree">tree</code></td>
<td>
<p>Phylogenetic tree (in ape format) to calculate the likelihood on.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_+3A_shifts">shifts</code></td>
<td>
<p>Matrix describing the positions (edges and times) of shifts. See 'Details'.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_+3A_gamma">gamma</code></td>
<td>
<p>Rate of state change.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_+3A_lambdas">lambdas</code></td>
<td>
<p>Birth rates of all states.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_+3A_mus">mus</code></td>
<td>
<p>Death rates of all states.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_+3A_lambda_rates">lambda_rates</code></td>
<td>
<p>Rates of decay of birth rate for all states. To use exponential decay, <code>stepsize</code> should also be provided.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_+3A_stepsize">stepsize</code></td>
<td>
<p>Size of the step to use for time discretization with exponential decay, default NULL. To use exponential decay, <code>lambda_rates</code> should also be provided.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_+3A_uniform_weights">uniform_weights</code></td>
<td>
<p>Whether all states are weighted uniformly in shifts, default TRUE. If FALSE, the weights of states are calculated from the distributions <code>p_lambda</code> and <code>p_mu</code>. See 'Details'.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_+3A_p_lambda">p_lambda</code></td>
<td>
<p>Prior probability distribution on lambdas, used if <code>uniform_weights = FALSE</code>.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_+3A_p_mu">p_mu</code></td>
<td>
<p>Prior probability distribution on mus, used if <code>uniform_weights = FALSE</code>.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_+3A_rho">rho</code></td>
<td>
<p>Sampling proportion on extant tips, default 1.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_+3A_sigma">sigma</code></td>
<td>
<p>Sampling probability on extinct tips (tips are sampled upon extinction), default 0.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_+3A_rho_sampling">rho_sampling</code></td>
<td>
<p>Whether the most recent tips should be considered extant tips, sampled with sampling proportion <code>rho</code>. If FALSE, all tips will be considered extinct tips, sampled with sampling probability <code>sigma</code>. Should be TRUE for most macroevolution datasets and FALSE for most epidemiology datasets.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_+3A_add_time">add_time</code></td>
<td>
<p>The time between the most recent tip and the end of the process (&gt;=0). This is an internal variable used in calculations for unresolved trees.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_+3A_unresolved">unresolved</code></td>
<td>
<p>Whether this tree is the backbone of an unresolved tree. This is an internal variable used in calculations for unresolved trees.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It is to be noted that all times are counted backwards, with the most recent tip positioned at 0. <br /><br />
The 'shifts' matrix is composed of 3 columns and a number of rows. Each row describes a shift: the first column is the index of the edge on which the shift happens, 
the second column is the time of the shift, and the third column is the index of the new state. For example the row vector (3,0.5,2) specifies a shift on edge number 3, at time 0.5, 
towards the state that has parameters <code>lambdas[2]</code>, <code>lambda_rates[2]</code> and <code>mus[2]</code>. <br /><br />
The weights w are used for calculating the transition rates q from each state i to j: <code class="reqn">q_{i,j}=\gamma*w_{i,j}</code>. 
If <code>uniform_weights = TRUE</code>, <code class="reqn">w_{i,j} = \frac{1}{N-1}</code> for all i,j, where N is the total number of states. 
If <code>uniform_weights = FALSE</code>, <code class="reqn">w_{i,j} = \frac{p_\lambda(\lambda_j)p_\mu(\mu_j)}{sum_{k \ne i}p_\lambda(\lambda_k)p_\mu(\mu_k)}</code>
where the distributions <code class="reqn">p_\lambda</code> and <code class="reqn">p_\mu</code> are provided by the inputs <code>p_lambda</code> and <code>p_mu</code>.
</p>


<h3>Value</h3>

<p>The value of the negative log likelihood of the model given the tree.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Input a phylogeny
tree &lt;- ape::read.tree(text = "(((t4:0.7293960718,(t1:0.450904974,t3:0.09259337652)
        :0.04068535892):0.4769176776,t8:0.1541864066):0.7282000314,((t7:0.07264320855,
        (((t5:0.8231869878,t6:0.3492440532):0.2380232813,t10:0.2367582193):0.5329497182,
        t9:0.1016243151):0.5929288475):0.3003101915,t2:0.8320755605):0.2918686506);")

# Calculate the log likelihood under a constant birth-death model (i.e, no shifts) 
# with full extant &amp; extinct sampling
likelihood_MSBD(tree, shifts = c(), gamma = 0, lambdas = 10, mus = 1, sigma = 1)
# Calculate the log likelihood under a multi-states model with 2 states 
# and full extant &amp; extinct sampling
likelihood_MSBD(tree, shifts = matrix(c(2,1.8,2), nrow = 1), 
                gamma = 0.05, lambdas = c(10, 6), mus = c(1, 0.5), sigma = 1)
# Calculate the log likelihood under a multi-states model with 2 states and exponential decay 
# with full extant &amp; extinct sampling
likelihood_MSBD(tree, shifts = matrix(c(2,1.8,2), nrow = 1), 
                gamma = 0.05, lambdas = c(10, 6), mus = c(1, 0.5), 
                sigma = 1, stepsize = 0.01, lambda_rates = c(0.1, 0.1))

</code></pre>

<hr>
<h2 id='likelihood_MSBD_unresolved'>Likelihood calculation for unresolved trees</h2><span id='topic+likelihood_MSBD_unresolved'></span>

<h3>Description</h3>

<p>Calculates the negative log likelihood of a multi-states model given a tree. 
This function is designed to work with unresolved trees, where tips represent collapsed clades. This sampling scheme is not recommended for epidemiology datasets.
The MRCA times of collapsed clades and the number of collapsed lineages need to be provided for all tips. If neither is provided the function will default to random sampling. 
Extinct tips can be present outside of the unresolved parts, but not below the time(s) set for <code>tcut</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>likelihood_MSBD_unresolved(tree, shifts, gamma, lambdas, mus,
  lambda_rates = NULL, stepsize = NULL, uniform_weights = TRUE,
  p_lambda = 0, p_mu = 0, rho = 1, sigma = 0,
  rho_sampling = TRUE, lineage_counts = c(), tcut = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="likelihood_MSBD_unresolved_+3A_tree">tree</code></td>
<td>
<p>Phylogenetic tree (in ape format) to calculate the likelihood on.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_unresolved_+3A_shifts">shifts</code></td>
<td>
<p>Matrix describing the positions (edges and times) of shifts. See 'Details'.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_unresolved_+3A_gamma">gamma</code></td>
<td>
<p>Rate of state change.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_unresolved_+3A_lambdas">lambdas</code></td>
<td>
<p>Birth rates of all states.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_unresolved_+3A_mus">mus</code></td>
<td>
<p>Death rates of all states.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_unresolved_+3A_lambda_rates">lambda_rates</code></td>
<td>
<p>Rates of decay of birth rate for all states. To use exponential decay, <code>stepsize</code> should also be provided.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_unresolved_+3A_stepsize">stepsize</code></td>
<td>
<p>Size of the step to use for time discretization with exponential decay, default NULL. To use exponential decay, <code>lambda_rates</code> should also be provided.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_unresolved_+3A_uniform_weights">uniform_weights</code></td>
<td>
<p>Whether all states are weighted uniformly in shifts, default TRUE. If FALSE, the weights of states are calculated from the distributions <code>p_lambda</code> and <code>p_mu</code>. See 'Details'.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_unresolved_+3A_p_lambda">p_lambda</code></td>
<td>
<p>Prior probability distribution on lambdas, used if <code>uniform_weights = FALSE</code>.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_unresolved_+3A_p_mu">p_mu</code></td>
<td>
<p>Prior probability distribution on mus, used if <code>uniform_weights = FALSE</code>.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_unresolved_+3A_rho">rho</code></td>
<td>
<p>Sampling proportion on extant tips, default 1.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_unresolved_+3A_sigma">sigma</code></td>
<td>
<p>Sampling probability on extinct tips (tips are sampled upon extinction), default 0.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_unresolved_+3A_rho_sampling">rho_sampling</code></td>
<td>
<p>Whether the most recent tips should be considered extant tips, sampled with sampling proportion <code>rho</code>. If FALSE, all tips will be considered extinct tips, sampled with sampling probability <code>sigma</code>. Should be TRUE for most macroevolution datasets and FALSE for most epidemiology datasets.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_unresolved_+3A_lineage_counts">lineage_counts</code></td>
<td>
<p>Number of lineages collapsed on each tip. Should be set to 1 for extinct tips.</p>
</td></tr>
<tr><td><code id="likelihood_MSBD_unresolved_+3A_tcut">tcut</code></td>
<td>
<p>Times of clade collapsing for each tip (i.e time of the MRCA of all collapsed lineages). Can be a single number or a vector of length the number of tips.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It is to be noted that all times are counted backwards, with the most recent tip positioned at 0. <br /><br />
The 'shifts' matrix is composed of 3 columns and a number of rows. Each row describes a shift: the first column is the index of the edge on which the shift happens, 
the second column is the time of the shift, and the third column is the index of the new state. For example the row vector (3,0.5,2) specifies a shift on edge number 3, at time 0.5, 
towards the state that has parameters <code>lambdas[2]</code>, <code>lambda_rates[2]</code> and <code>mus[2]</code>. <br /><br />
The weights w are used for calculating the transition rates q from each state i to j: <code class="reqn">q_{i,j}=\gamma*w_{i,j}</code>. 
If <code>uniform_weights = TRUE</code>, <code class="reqn">w_{i,j} = \frac{1}{N-1}</code> for all i,j, where N is the total number of states. 
If <code>uniform_weights = FALSE</code>, <code class="reqn">w_{i,j} = \frac{p_\lambda(\lambda_j)p_\mu(\mu_j)}{sum_{k \ne i}p_\lambda(\lambda_k)p_\mu(\mu_k)}</code>
where the distributions <code class="reqn">p_\lambda</code> and <code class="reqn">p_\mu</code> are provided by the inputs <code>p_lambda</code> and <code>p_mu</code>.
</p>


<h3>Value</h3>

<p>The value of the negative log likelihood of the model given the tree.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Input a phylogeny
tree &lt;- ape::read.tree(text = "(t3:0.9703302342,((t4:0.1999577823,(t2:0.1287530271,
        (t7:0.08853561159,(t8:0.07930237712,t9:0.07930237712):0.009233234474):0.04021741549):
        0.07120475526):0.4269919425,(((t10:0.0191876225,t5:0.0191876225):0.04849906822,
        t6:0.06768669072):0.1672340445,t1:0.2349207353):0.3920289896):0.3433805094);")

# Calculate the log likelihood under a constant birth-death model (i.e, no shifts) 
# with unresolved tips
likelihood_MSBD_unresolved(tree, shifts = c(), gamma = 0, lambdas = 10, mus = 1, 
                           lineage_counts = c(2,5,1,3,1,1,1,1,2,6), tcut = 0.05)
# Calculate the log likelihood under a multi-states model with 2 states and unresolved tips
likelihood_MSBD_unresolved(tree, shifts = matrix(c(2,0.7,2), nrow = 1), 
                           gamma = 0.05, lambdas = c(10, 5), mus = c(1, 1), 
                           lineage_counts = c(2,5,1,3,1,1,1,1,2,6), tcut = 0.05)

</code></pre>

<hr>
<h2 id='ML_MSBD'>Full Maximum Likelihood inference of birth and death rates together with their changes along a phylogeny under a multi-type birth-death model.</h2><span id='topic+ML_MSBD'></span>

<h3>Description</h3>

<p>Infers a complete MSBD model from a phylogeny, including the most likely number of states, positions and times of state changes, and parameters associated with each state. 
Uses a greedy approach to add states and Maximum Likelihood inference for the other parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ML_MSBD(tree, initial_values, uniform_weights = TRUE, p_lambda = 0,
  p_mu = 0, rho = 1, sigma = 0, rho_sampling = TRUE,
  lineage_counts = c(), tcut = 0, stepsize = NULL,
  no_extinction = FALSE, fixed_gamma = NULL, unique_lambda = FALSE,
  unique_mu = FALSE, optim_control = list(), attempt_remove = TRUE,
  max_nshifts = Inf, saved_state = NULL, save_path = NULL,
  time_mode = c("3pos", "tip", "mid", "root"), fast_optim = FALSE,
  parallel = FALSE, ncores = getOption("mc.cores", 2L))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ML_MSBD_+3A_tree">tree</code></td>
<td>
<p>Phylogenetic tree (in ape format) to calculate the likelihood on.</p>
</td></tr>
<tr><td><code id="ML_MSBD_+3A_initial_values">initial_values</code></td>
<td>
<p>Initial values for the optimizer, to be provided as a vector in this order: gamma (optional), lambda, lambda decay rate (optional), mu (optional). See 'Details'.</p>
</td></tr>
<tr><td><code id="ML_MSBD_+3A_uniform_weights">uniform_weights</code></td>
<td>
<p>Whether all states are weighted uniformly in shifts, default TRUE. If FALSE, the weights of states are calculated from the distributions <code>p_lambda</code> and <code>p_mu</code>. See 'Details'.</p>
</td></tr>
<tr><td><code id="ML_MSBD_+3A_p_lambda">p_lambda</code></td>
<td>
<p>Prior probability distribution on lambdas, used if <code>uniform_weights = FALSE</code>.</p>
</td></tr>
<tr><td><code id="ML_MSBD_+3A_p_mu">p_mu</code></td>
<td>
<p>Prior probability distribution on mus, used if <code>uniform_weights = FALSE</code>.</p>
</td></tr>
<tr><td><code id="ML_MSBD_+3A_rho">rho</code></td>
<td>
<p>Sampling proportion on extant tips, default 1.</p>
</td></tr>
<tr><td><code id="ML_MSBD_+3A_sigma">sigma</code></td>
<td>
<p>Sampling probability on extinct tips (tips are sampled upon extinction), default 0.</p>
</td></tr>
<tr><td><code id="ML_MSBD_+3A_rho_sampling">rho_sampling</code></td>
<td>
<p>Whether the most recent tips should be considered extant tips, sampled with sampling proportion <code>rho</code>. If FALSE, all tips will be considered extinct tips, sampled with sampling probability <code>sigma</code>. Should be TRUE for most macroevolution datasets and FALSE for most epidemiology datasets.</p>
</td></tr>
<tr><td><code id="ML_MSBD_+3A_lineage_counts">lineage_counts</code></td>
<td>
<p>For trees with clade collapsing. Number of lineages collapsed on each tip. Should be set to 1 for extinct tips.</p>
</td></tr>
<tr><td><code id="ML_MSBD_+3A_tcut">tcut</code></td>
<td>
<p>For trees with clade collapsing. Times of clade collapsing for each tip (i.e time of the MRCA of all collapsed lineages). Can be a single number or a vector of length the number of tips.</p>
</td></tr>
<tr><td><code id="ML_MSBD_+3A_stepsize">stepsize</code></td>
<td>
<p>Size of the step to use for time discretization with exponential decay, default NULL. To use exponential decay, an initial value for <code>lambda_rates</code> should also be provided.</p>
</td></tr>
<tr><td><code id="ML_MSBD_+3A_no_extinction">no_extinction</code></td>
<td>
<p>Whether to use the Yule process (<code>mu=0</code>) for all states, default FALSE. If TRUE no initial value for <code>mu</code> is needed.</p>
</td></tr>
<tr><td><code id="ML_MSBD_+3A_fixed_gamma">fixed_gamma</code></td>
<td>
<p>Value to which <code>gamma</code> should be fixed, default NULL. If provided no initial value for <code>gamma</code> is needed.</p>
</td></tr>
<tr><td><code id="ML_MSBD_+3A_unique_lambda">unique_lambda</code></td>
<td>
<p>Whether to use the same value of <code>lambda</code> for all states, default FALSE. If TRUE and exponential decay is active all states will also share the same value for <code>lambda_rate</code>.</p>
</td></tr>
<tr><td><code id="ML_MSBD_+3A_unique_mu">unique_mu</code></td>
<td>
<p>Whether to use the same value of <code>mu</code> for all states, default FALSE.</p>
</td></tr>
<tr><td><code id="ML_MSBD_+3A_optim_control">optim_control</code></td>
<td>
<p>Control list for the optimizer, corresponds to control input in optim function, see <code>?optim</code> for details.</p>
</td></tr>
<tr><td><code id="ML_MSBD_+3A_attempt_remove">attempt_remove</code></td>
<td>
<p>Whether to attempt to remove shifts at the end of the inference, default TRUE. If FALSE, use a pure greedy algorithm.</p>
</td></tr>
<tr><td><code id="ML_MSBD_+3A_max_nshifts">max_nshifts</code></td>
<td>
<p>Maximum number of shifts to test for, default <code>Inf</code>.</p>
</td></tr>
<tr><td><code id="ML_MSBD_+3A_saved_state">saved_state</code></td>
<td>
<p>If provided, the inference will be restarted from this state.</p>
</td></tr>
<tr><td><code id="ML_MSBD_+3A_save_path">save_path</code></td>
<td>
<p>If provided, the progress of the inference will be saved to this path after each optimization step.</p>
</td></tr>
<tr><td><code id="ML_MSBD_+3A_time_mode">time_mode</code></td>
<td>
<p>String controlling the time positions of inferred shifts. See 'Details'.</p>
</td></tr>
<tr><td><code id="ML_MSBD_+3A_fast_optim">fast_optim</code></td>
<td>
<p>Whether to use the faster mode of optimization, default FALSE. If TRUE only rates associated with the state currently being added to the tree and its ancestor will be optimized at each step, otherwise all rates are optimized.</p>
</td></tr>
<tr><td><code id="ML_MSBD_+3A_parallel">parallel</code></td>
<td>
<p>Whether the computation should be run in parallel, default FALSE. Will use a user-defined cluster if one is found, otherwise will define its own.</p>
</td></tr>
<tr><td><code id="ML_MSBD_+3A_ncores">ncores</code></td>
<td>
<p>Number of cores to use for a parallel computation.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It is to be noted that all times are counted backwards, with the most recent tip positioned at 0. <br /><br />
</p>
<p>Five time modes are possible for the input <code>time_mode</code>. 
In <code>tip</code> mode, the shifts will be placed at 10% of the length of the edge. 
In <code>mid</code> mode, the shifts will be placed at 50% of the length of the edge. 
In <code>root</code> mode, the shifts will be placed at 90% of the length of the edge. 
In <code>3pos</code> mode, the three &quot;tip&quot;, &quot;mid&quot; and &quot;root&quot; positions will be tested.<br /><br />
</p>
<p>The weights w are used for calculating the transition rates q from each state i to j: <code class="reqn">q_{i,j}=\gamma*w_{i,j}</code>. 
If <code>uniform_weights = TRUE</code>, <code class="reqn">w_{i,j} = \frac{1}{N-1}</code> for all i,j, where N is the total number of states. 
If <code>uniform_weights = FALSE</code>, <code class="reqn">w_{i,j} = \frac{p_\lambda(\lambda_j)p_\mu(\mu_j)}{sum_{k \ne i}p_\lambda(\lambda_k)p_\mu(\mu_k)}</code>
where the distributions <code class="reqn">p_\lambda</code> and <code class="reqn">p_\mu</code> are provided by the inputs <code>p_lambda</code> and <code>p_mu</code>.<br /><br />
</p>
<p>Initial values for the optimization need to be provided as a vector and contain the following elements (in order): 
an initial value for gamma, which is required unless <code>fixed_gamma</code> is provided, 
an initial value for lambda which is always required, 
an initial value for lambda decay rate, which is required if <code>stepsize</code> is provided, 
and an initial value for mu, which is required unless <code>no_extinction = TRUE</code>. 
An error will be raised if the number of initial values provided does not match the one expected from the rest of the settings, 
and the function will fail if the likelihood cannot be calculated at the initial values.
</p>


<h3>Value</h3>

<p>Returns a list describing the most likely model found, with the following components:
</p>
<table>
<tr><td><code>likelihood</code></td>
<td>
<p>the negative log likelihood of the model</p>
</td></tr>
<tr><td><code>shifts.edge</code></td>
<td>
<p>the indexes of the edges where shifts happen, 0 indicates the root state</p>
</td></tr>
<tr><td><code>shifts.time</code></td>
<td>
<p>the time positions of shifts</p>
</td></tr>
<tr><td><code>gamma</code></td>
<td>
<p>the rate of state change</p>
</td></tr>
<tr><td><code>lambdas</code></td>
<td>
<p>the birth rates of all states</p>
</td></tr>
<tr><td><code>lambda_rates</code></td>
<td>
<p>if exponential decay was activated, the rates of decay of birth rate for all states</p>
</td></tr>
<tr><td><code>mus</code></td>
<td>
<p>the death rates of all states</p>
</td></tr>
<tr><td><code>best_models</code></td>
<td>
<p>a vector containing the negative log likelihood of the best model found for each number of states tested (<code>best_models[i]</code> corresponds to i states, i.e i-1 shifts)</p>
</td></tr>
</table>
<p>All vectors are indexed in the same way, so that the state with parameters <code>lambdas[i]</code>, <code>lambda_rates[i]</code> and <code>mus[i]</code> starts on edge <code>shifts.edge[i]</code> at time <code>shifts.time[i]</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Input a phylogeny
tree &lt;- ape::read.tree(text = "(((t4:0.7293960718,(t1:0.450904974,t3:0.09259337652)
        :0.04068535892):0.4769176776,t8:0.1541864066):0.7282000314,((t7:0.07264320855,
        (((t5:0.8231869878,t6:0.3492440532):0.2380232813,t10:0.2367582193):0.5329497182,
        t9:0.1016243151):0.5929288475):0.3003101915,t2:0.8320755605):0.2918686506);")

# Infer the most likely multi-states birth-death model 
# with full extant &amp; extinct sampling
## Not run: ML_MSBD(tree, initial_values = c(0.1, 10, 1), sigma = 1, time_mode = "mid") 
# Infer the most likely multi-states birth-death model with exponential decay
# and full extant &amp; extinct sampling
## Not run: ML_MSBD(tree, initial_values = c(0.1, 10, 0.5, 1), sigma = 1, 
                 stepsize = 0.1, time_mode = "mid")
## End(Not run)

# Input a phylogeny with extant samples
tree2 &lt;- ape::read.tree(text = "(t3:0.9703302342,((t4:0.1999577823,(t2:0.1287530271,
        (t7:0.08853561159,(t8:0.07930237712,t9:0.07930237712):0.009233234474):0.04021741549):
        0.07120475526):0.4269919425,(((t10:0.0191876225,t5:0.0191876225):0.04849906822,
        t6:0.06768669072):0.1672340445,t1:0.2349207353):0.3920289896):0.3433805094);")

# Infer the most likely multi-states Yule model with partial extant sampling
## Not run: ML_MSBD(tree2, initial_values = c(0.1, 10), no_extinction = TRUE, 
                  rho = 0.5, time_mode = "mid")
## End(Not run)
# Infer the most likely multi-states birth-death model with full extant sampling 
# and unresolved extant tips
## Not run: ML_MSBD(tree2, initial_values = c(0.1, 10, 1), 
                  lineage_counts = c(2,5,1,3,1,1,1,1,2,6), tcut = 0.05, time_mode = "mid")
## End(Not run)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
