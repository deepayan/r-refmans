<!DOCTYPE html><html lang="en"><head><title>Help for package CoDaLoMic</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {CoDaLoMic}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#CoDaLoMic-package'><p>CoDaLoMic</p></a></li>
<li><a href='#B1MODImatrizP'><p>Ridge regression matrix</p></a></li>
<li><a href='#B1MODImodel'><p>Obtaining the regression value of the FBM</p></a></li>
<li><a href='#Balance'><p>Calculating the balance of the FBM model</p></a></li>
<li><a href='#BPBM_Matrix'><p>Obtains the matrix of covariates of the BPBM</p></a></li>
<li><a href='#cockroach'><p>cockroach dataset</p></a></li>
<li><a href='#Estimate_Param_EstParmFunc'><p>Estimating Parameters of EstParmFunc</p></a></li>
<li><a href='#Estimate_Param_FBM'><p>Estimating Parameters of EstParmFunc_FBM</p></a></li>
<li><a href='#Estimating_BPBM'><p>Estimating BPBM</p></a></li>
<li><a href='#EstParmFunc'><p>Writting the loglikelihood of the dirichlet</p></a></li>
<li><a href='#EstParmFunc_FBM'><p>Writting the loglikelihood of the dirichlet</p></a></li>
<li><a href='#ExpectedValue_EstParmFunc'><p>Obtaining the value of the Dirichlet parameters, the expected value and the variance.</p></a></li>
<li><a href='#ExpectedValues_EstParmFunc_FBM'><p>Obtainig the value of the dirichlet parameters, the expected value and the variance.</p></a></li>
<li><a href='#ExpectedValuess_BPBM'><p>Obtainig the value of the dirichlet parameters, the expected value and the variance.</p></a></li>
<li><a href='#FromVectorToMatrix_BPBM'><p>Writting the parameters in the matrix form required in BPBM model</p></a></li>
<li><a href='#FVectorPBmodeloPredi'><p>Obtaining a vector with the covariates of the prediction</p></a></li>
<li><a href='#Graphics'><p>Plots the time series</p></a></li>
<li><a href='#GraphicsPrediction'><p>Plots the time series</p></a></li>
<li><a href='#GraphicsPredictionBPBM'><p>Plots the time series</p></a></li>
<li><a href='#GraphicsSPBal'><p>Obtaining the graphic of the SPBal at all time points</p></a></li>
<li><a href='#LogVeroFuncBUENA'><p>Writting the loglikelihood of the dirichlet</p></a></li>
<li><a href='#MaxBacteria'><p>Putting the reference bacteria at the last row</p></a></li>
<li><a href='#MaxBacteriaPred'><p>Putting the reference bacteria at the last row</p></a></li>
<li><a href='#ObtainigValuePB'><p>Obtaining the principal balances values</p></a></li>
<li><a href='#ObtainigValueSPBal'><p>Obtaining the selected principal balances values</p></a></li>
<li><a href='#ObtainingDIC'><p>Writting the loglikelihood of the dirichlet</p></a></li>
<li><a href='#PBalance'><p>Calculating balances</p></a></li>
<li><a href='#PBalancePredi'><p>Calculating balances for a composition</p></a></li>
<li><a href='#PBmodel'><p>Obtaining the regression value of the BPBM</p></a></li>
<li><a href='#PCAbiplot'><p>PCA of the estimated parameters</p></a></li>
<li><a href='#Percen_Variance'><p>Percentage of variance</p></a></li>
<li><a href='#PlotDendogram'><p>Plotting a dendogram</p></a></li>
<li><a href='#PredictionBPBM'><p>Predicting using BPBM</p></a></li>
<li><a href='#PredictionEstParmFunc'><p>Predicting using dirichl-gLV</p></a></li>
<li><a href='#PredictionFBM'><p>Predicting using FBM</p></a></li>
<li><a href='#PreparingTheData'><p>Preparing dataset</p></a></li>
<li><a href='#QualityControl'><p>Analysing the quality of the estimation</p></a></li>
<li><a href='#ridgeregression'><p>Ridge regression</p></a></li>
<li><a href='#rxnrate'><p>Solving the right side of the gLV equations</p></a></li>
<li><a href='#Simulated'><p>Gut microbiome simulated dataset</p></a></li>
<li><a href='#StudyingParam'><p>Controlling quality of the convergence in BPBM</p></a></li>
<li><a href='#Table_alr_Dirich_glv'><p>Obtainig a table with the interpretable parameters</p></a></li>
<li><a href='#TableBPBM'><p>Obtaining a table with the SPBal information of the BPBM</p></a></li>
<li><a href='#TableFBM'><p>Obtainig a table with the interpretable parameters</p></a></li>
<li><a href='#TauAndParameters_EstParmFunc_FBM'><p>Obtaining the value of tau and the estimate value of the rest of the parameters</p></a></li>
<li><a href='#vecttor'><p>Alr of a bacteria</p></a></li>
<li><a href='#ZeroData'><p>Zero replacement</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Compositional Models to Longitudinal Microbiome Data</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Author:</td>
<td>Irene Creus Martí <a href="https://orcid.org/0000-0002-7962-4478"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Irene Creus Martí &lt;ircrmar@mat.upv.es&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Implementation of models to analyse compositional microbiome time series taking into account the interaction between groups of bacteria. The models implemented are described in Creus-Martí et al (2018, ISBN:978-84-09-07541-6), Creus-Martí et al (2021) &lt;<a href="https://doi.org/10.1155%2F2021%2F9951817">doi:10.1155/2021/9951817</a>&gt; and Creus-Martí et al (2022) &lt;<a href="https://doi.org/10.1155%2F2022%2F4907527">doi:10.1155/2022/4907527</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>xtable, ggplot2, reshape2, compositions, MASS, broom, R2jags,
ggbiplot, zCompositions</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 3.0.0), gtools, knitr, parallel, base</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-01-17 18:53:04 UTC; IRENE</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-01-20 16:44:16 UTC</td>
</tr>
</table>
<hr>
<h2 id='CoDaLoMic-package'>CoDaLoMic</h2><span id='topic+CoDaLoMic'></span><span id='topic+CoDaLoMic-package'></span>

<h3>Description</h3>

<p>This package contain functions to model compositional and longitudinal microbiome datasets. This package contains the functions needed to execute the models published in the articles:
</p>

<ul>
<li><p> Creus-Martí, I., Moya, A., Santonja, F. J. (2018), A Statistical Model with a Lotka-Volterra Structure for Microbiota Data, Lucas Jodar, Juan Carlos Cortes and Luis Acedo,  Modelling for engineering and human behavior 2018, Instituto Universitario de Matematica Multidisciplinar, ISBN: 978-84-09-07541-6.
</p>
</li>
<li><p> Creus-Martí, I., Moya, A., Santonja, F. J. (2021). A Dirichlet autoregressive model for the analysis of microbiota time-series data. Complexity, 2021, 1-16.
</p>
</li>
<li><p> Creus-Martí, I., Moya, A., Santonja, F. J. (2022). Bayesian hierarchical compositional models for analysing longitudinal abundance data from microbiome studies. Complexity, 2022.
</p>
</li></ul>

<p>In addition, the package contains one real dataset extracted from:
</p>

<ul>
<li><p> Marín-Miret, J., Pérez-Cobas, A. E., Domínguez-Santos, R., Pérez-Rocher, B., Latorre, A., &amp; Moya, A. (2024). Adaptability of the gut microbiota of the German cockroach Blattella germanica to a periodic antibiotic treatment. Microbiological Research, 287, 127863.
</p>
</li></ul>



<h3>Details</h3>

<p>We refer to the model described in Creus-Martí (2018) as Dirich-gLV, we refer to the model described in Creus-Martí (2021) as FBM and we refer to the model described in Creus-Martí (2022) as BPBM.
</p>


<h3>Access to Additional Files</h3>

<p>This package includes files in the directory 'inst/extdata'.  Users can access these files using 'system.file()'. The following files are available:
</p>

<ul>
<li> <p><code>README.pdf</code>, <code>README.Rmd</code>, <code>README.R</code>: Basic instructions for using the package.
</p>
</li>
<li> <p><code>1-s2.0-S0944501324002647-mmc6.xlsx</code>: Original cockroach dataset extracted from Marín-Miret et al (2024).
</p>
</li>
<li>  <p><code>Simulated.R</code>: Code use to obtain the Simulated dataset.
</p>
</li>
<li> <p><code>cockroach.R</code>: Code use to obtain the cockroach dataset.
</p>
</li></ul>

<p>To access these files, use:
<code>base::system.file("extdata", "filename", package = "CoDaLoMic")</code>
</p>
<p>For instance:
<code>base::system.file("extdata", "README.pdf", package = "CoDaLoMic")</code>
</p>
<p>On Windows, the PDF can be opened as follows:
<code>base::shell.exec(system.file("extdata", "README.pdf", package = "CoDaLoMic"))</code>
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Irene Creus Martí <a href="mailto:ircrmar@mat.upv.es">ircrmar@mat.upv.es</a> (<a href="https://orcid.org/0000-0002-7962-4478">ORCID</a>)
</p>

<hr>
<h2 id='B1MODImatrizP'>Ridge regression matrix</h2><span id='topic+B1MODImatrizP'></span>

<h3>Description</h3>

<p>Defining the part of the ridge regression matrix  that  carries the information of the bacteria <code>especieII</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>B1MODImatrizP(Tt, especieII, especie, E, EspecieMaxima)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="B1MODImatrizP_+3A_tt">Tt</code></td>
<td>
<p>Number of time points available</p>
</td></tr>
<tr><td><code id="B1MODImatrizP_+3A_especieii">especieII</code></td>
<td>
<p>Number. The number of the row in which the bacteria that we want to use is placed in the matrix <code>especie</code>.</p>
</td></tr>
<tr><td><code id="B1MODImatrizP_+3A_especie">especie</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at all time points.</p>
</td></tr>
<tr><td><code id="B1MODImatrizP_+3A_e">E</code></td>
<td>
<p>Number of bacteria available</p>
</td></tr>
<tr><td><code id="B1MODImatrizP_+3A_especiemaxima">EspecieMaxima</code></td>
<td>
<p>Row in which the bacteria chosen as reference is in <code>especie</code>. This is the bacteria that is going to be at the denominator of the balance and at the denominator of the alr transformation.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a matrix. The first column contain the number 1 repeated <code>Tt</code> times. The second column contains
the alr transformation of the <code>especieII</code> in all time points. The third column
contains the balance (whose numerator has all the bacteria except <code>especieII</code> and <code>EspecieMaxima</code> and the denominator
contains the <code>EspecieMaxima</code>) in all time points.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

Tt=2
especie1=cbind(c(0.5,0.3,0.2), c(0.1,0.3,0.6))
especieII=1
E=3
EspecieMaxima=3

B1MODImatrizP(Tt, especieII,especie1, E, EspecieMaxima)

</code></pre>

<hr>
<h2 id='B1MODImodel'>Obtaining the regression value of the FBM</h2><span id='topic+B1MODImodel'></span>

<h3>Description</h3>

<p>This function calculates the value of the FBM regression, defined by:  </p>
<p style="text-align: center;"><code class="reqn">\mu_{it}=a_{i1}+a_{i2}\cdot\text{alr}(x_{i,(t-1)})+a_{i3}\cdot\text{Balance}(x_{i,(t-1)})\text{ for }i=1,\dots, D-1\text{ where } D \text{ is the number of bacteria}</code>
</p>



<h3>Usage</h3>

<pre><code class='language-R'>B1MODImodel(A, especie, E, EspecieMaxima, Tt)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="B1MODImodel_+3A_a">A</code></td>
<td>
<p>Matrix of dimensions (<code>E</code>-1)x3 that contains all the parameters of the model except tau</p>
</td></tr>
<tr><td><code id="B1MODImodel_+3A_especie">especie</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at all time points.</p>
</td></tr>
<tr><td><code id="B1MODImodel_+3A_e">E</code></td>
<td>
<p>Number of bacteria available</p>
</td></tr>
<tr><td><code id="B1MODImodel_+3A_especiemaxima">EspecieMaxima</code></td>
<td>
<p>Row in which the bacteria chosen as reference is in <code>especie</code>.This bacteria is used as reference in the alr tranformation that the model does and it is placed at the denominator of the balance)</p>
</td></tr>
<tr><td><code id="B1MODImodel_+3A_tt">Tt</code></td>
<td>
<p>Number of time points available.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a matrix. The row i contains the regression values of the bacteria i at all time points.
</p>


<h3>References</h3>

<p>Creus-Martí, I., Moya, A., Santonja, F. J. (2021). A Dirichlet autoregressive model for the analysis of microbiota time-series data. Complexity, 2021, 1-16.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

df&lt;-data.frame(cbind(c(0.1,0.1,0.8),c(0.2,0.1,0.7)))
E=3
EspecieMaxima=3
set.seed(724)
A=matrix(c(-2:3),2,3)
Tt=2

B1MODImodel(A,df, E, EspecieMaxima,Tt)

</code></pre>

<hr>
<h2 id='Balance'>Calculating the balance of the FBM model</h2><span id='topic+Balance'></span>

<h3>Description</h3>

<p>Defining a balance where we compare all the bacteria (except the one chosen as reference and the <code>especieI</code>) with the one chosen as reference.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Balance(A, especieI, especie, E, EspecieMaxima)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Balance_+3A_a">A</code></td>
<td>
<p>Number of time points for which we calculate the balance</p>
</td></tr>
<tr><td><code id="Balance_+3A_especiei">especieI</code></td>
<td>
<p>Number. The bacteria that we do not include in the balance. We must write the number of the row in which the bacteria is placed in the matrix <code>especie</code>.</p>
</td></tr>
<tr><td><code id="Balance_+3A_especie">especie</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at all time points.</p>
</td></tr>
<tr><td><code id="Balance_+3A_e">E</code></td>
<td>
<p>Number of bacteria available</p>
</td></tr>
<tr><td><code id="Balance_+3A_especiemaxima">EspecieMaxima</code></td>
<td>
<p>Row in which the bacteria chosen as reference is in <code>especie</code>.This bacteria is used as reference in the alr tranformation that the model does and it is placed at the denominator of the balance)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a vector with the value of the balance for all the time points indicated.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
Balance(2,2,cbind(c(0.1,0.1,0.8),c(0.2,0.1,0.7)),3,3)

</code></pre>

<hr>
<h2 id='BPBM_Matrix'>Obtains the matrix of covariates of the BPBM</h2><span id='topic+BPBM_Matrix'></span>

<h3>Description</h3>

<p>This function writes the matrix of covariates of the BPBM.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>BPBM_Matrix(rows.position, PB, Tt)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="BPBM_Matrix_+3A_rows.position">rows.position</code></td>
<td>
<p>Vector. Vector with the number of the rows where the SPBal are in the matrix PB. We write first the row in which the balance with higher variance is placed, then the row in which the balance with second higher variance is placed...</p>
</td></tr>
<tr><td><code id="BPBM_Matrix_+3A_pb">PB</code></td>
<td>
<p>Matrix. Each line os the matrix PB contains the values of one principal balance at all time points.</p>
</td></tr>
<tr><td><code id="BPBM_Matrix_+3A_tt">Tt</code></td>
<td>
<p>Number of time points available.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In an example with two SPBal and three time points, the covariates are written in the following  order:
</p>

<table>
<tr>
 <td style="text-align: right;">
 1 </td><td style="text-align: right;">  1  </td><td style="text-align: right;">  1</td>
</tr>
<tr>
 <td style="text-align: right;">
 <code class="reqn">SPBal_{1,t-1}</code> </td><td style="text-align: right;">  <code class="reqn">SPBal_{1,t-2}</code> </td><td style="text-align: right;">   <code class="reqn">SPBal_{1,t-3}</code> </td>
</tr>
<tr>
 <td style="text-align: right;">
 <code class="reqn">SPBal_{2,t-1}</code> </td><td style="text-align: right;">  <code class="reqn">SPBal_{2,t-2}</code> </td><td style="text-align: right;">   <code class="reqn">SPBal_{2,t-3}</code> </td>
</tr>

</table>



<h3>Value</h3>

<p>Returns a matrix with the covariates of the model.
</p>


<h3>References</h3>

<p>Creus-Martí, I., Moya, A., Santonja, F. J. (2022). Bayesian hierarchical compositional models for analysing longitudinal abundance data from microbiome studies. Complexity, 2022.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
matt=matrix(c(1:12),3,4)
rows.position=c(2,3)
BPBM_Matrix(rows.position,matt,4)


</code></pre>

<hr>
<h2 id='cockroach'>cockroach dataset</h2><span id='topic+cockroach'></span>

<h3>Description</h3>

<p>Gut microbiome dataset of a Blatella germanica cockroach treated by kanamycin during three periods of time (days: 1–10,  36–45, 71–80). The data is extracted from Marín-Miret et al (2024), more specifically, the data is the information of the K3 cockroach in the article. The dataset contains 105 time points and 210 genera.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(cockroach)
</code></pre>


<h3>Format</h3>

<p>A data frame with 105 rows and 211 columns.
</p>


<h3>References</h3>

<p>Marín-Miret, J., Pérez-Cobas, A. E., Domínguez-Santos, R., Pérez-Rocher, B., Latorre, A., &amp; Moya, A. (2024). Adaptability of the gut microbiota of the German cockroach Blattella germanica to a periodic antibiotic treatment. Microbiological Research, 287, 127863.
</p>

<hr>
<h2 id='Estimate_Param_EstParmFunc'>Estimating Parameters of EstParmFunc</h2><span id='topic+Estimate_Param_EstParmFunc'></span>

<h3>Description</h3>

<p>This function calculates the estimated parameters of the Dirich-gLV model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Estimate_Param_EstParmFunc(Iter.EstParmFunc, paramini, especie, seed = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Estimate_Param_EstParmFunc_+3A_iter.estparmfunc">Iter.EstParmFunc</code></td>
<td>
<p>Number. Number of iterations.</p>
</td></tr>
<tr><td><code id="Estimate_Param_EstParmFunc_+3A_paramini">paramini</code></td>
<td>
<p>Initial values of the parameters. Vector equal to <code>c(tau.ini, as.vector(pam.ini))</code> where:</p>
</td></tr>
<tr><td><code id="Estimate_Param_EstParmFunc_+3A_especie">especie</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at all time points. The bacteria placed in the last row of the matrix will be used as reference in the alr transformation.</p>
</td></tr>
<tr><td><code id="Estimate_Param_EstParmFunc_+3A_seed">seed</code></td>
<td>
<p>Number. Set a seed. Default <code>seed=NULL</code>.
</p>

<ul>
<li><p> pam.ini  Matrix. Each row has the parameters of each bacteria, following the same structure than pam in EstParmFunc
</p>
</li>
<li><p> tau.ini  Number. Initial value of the tau parameter in the model
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>Maximum likelihood estimation is used. This function makes an iterative process, it obtains the value of the parameter that maximize the Dirichlet loglikelihood (defined in EstParmFunc) using the Nelder-Mead method and some initial parameters. Then it uses this value as initial parameters and repeats the process <code>Iter.EstParmFunc</code> times.
</p>


<h3>Value</h3>

<p>Returns a list with:
</p>

<ul>
<li><p> All.iter:  Matrix. Each row has the parameters obtained in each iteration. The parameters are in the columns written in the same order that they are written in <code>paramini</code>. In this matrix we must observe that in the last iterations the values has really similar or equal values, it not, we need to increase the value of <code>Iter.EstParmFunc</code>.
</p>
</li>
<li><p> Param.Estimates: The estimated parameters. The parameters are in the columns written in the same order that they are written in <code>paramini</code>.
</p>
</li></ul>



<h3>References</h3>

<p>Creus-Martí, I. and Moya, A. and Santonja, F. J. (2018). A Statistical Model with a Lotka-Volterra Structure for Microbiota Data. Lucas Jodar, Juan Carlos Cortes and Luis Acedo,  Modelling for engineering and human behavior 2018, Instituto Universitario de Matematica Multidisciplinar. ISBN: 978-84-09-07541-6
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
especie=cbind(c(0.5,0.3,0.2),c(0.1,0.3,0.6))
paramini=c(100,2,3,4,5,6,7)
Estimate_Param_EstParmFunc(5, paramini , especie,714)


</code></pre>

<hr>
<h2 id='Estimate_Param_FBM'>Estimating Parameters of EstParmFunc_FBM</h2><span id='topic+Estimate_Param_FBM'></span>

<h3>Description</h3>

<p>This function estimates the parameters of the FBM model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Estimate_Param_FBM(
  tau,
  ridge.final,
  Iter.EstParmFunc = 80,
  especie,
  EspecieMaxima,
  Tt,
  E,
  seed = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Estimate_Param_FBM_+3A_tau">tau</code></td>
<td>
<p>Number. Value of the tau parameter.</p>
</td></tr>
<tr><td><code id="Estimate_Param_FBM_+3A_ridge.final">ridge.final</code></td>
<td>
<p>Object of class &quot;ridgelm&quot;. Values obtained with the ridge regression.</p>
</td></tr>
<tr><td><code id="Estimate_Param_FBM_+3A_iter.estparmfunc">Iter.EstParmFunc</code></td>
<td>
<p>Number. Number of iterations. Default: 80 iterations.</p>
</td></tr>
<tr><td><code id="Estimate_Param_FBM_+3A_especie">especie</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at all time points. The bacteria placed in the last row of the matrix will be used as reference in the alr transformation and will be at the denominator of the balance.</p>
</td></tr>
<tr><td><code id="Estimate_Param_FBM_+3A_especiemaxima">EspecieMaxima</code></td>
<td>
<p>Row in which the bacteria chosen as reference is in <code>especie</code>. This is the bacteria that is going to be at the denominator of the balance and in the deniminator of the alr tranformation. As a result, in this function, <code>EspecieMaxima</code> must be equal to <code>E</code>.</p>
</td></tr>
<tr><td><code id="Estimate_Param_FBM_+3A_tt">Tt</code></td>
<td>
<p>Number of time points available</p>
</td></tr>
<tr><td><code id="Estimate_Param_FBM_+3A_e">E</code></td>
<td>
<p>Number. Number of bacteria available.</p>
</td></tr>
<tr><td><code id="Estimate_Param_FBM_+3A_seed">seed</code></td>
<td>
<p>Number. Set a seed. Default <code>seed=NULL</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Maximum likelihood estimation is used. This function makes an iterative process, for a given
value of tau, it obtains the value of the rest of the parameters that maximize the dirichlet loglikelihood
(defined in EstParmFunc_FBM) using the Nelder-Mead method and the values obtained in the ridge regression as initial parameters.
Then it uses the values obtained as initial parameters and repeats the process <code>Iter.EstParmFunc</code> times.
</p>
<p>The regression of this model is defined by
</p>
<p style="text-align: center;"><code class="reqn">\mu_{it}=a_{i1}+a_{i2}\cdot\text{alr}(x_{i,(t-1)})+a_{i3}\cdot\text{Balance}(x_{i,(t-1)})\text{ for }i=1,\dots, D-1\text{ where } D \text{ is the number of bacteria}</code>
</p>



<h3>Value</h3>

<p>Returns a list with:
</p>

<ul>
<li><p> All.iter:  Matrix. Each row has the parameters obtained in each iteration. The parameters are in the columns written in following order: a11,a12,a13, a21, a22,a23, ...a(D-1)1,a(D-1)2,a(D-1)3,tau. Where D is the number of bacterial species present in the matrix <code>especie</code>. In this matrix we must observe that in the last iterations the values has really similar or equal values, it not, we need to increase the value of <code>Iter.EstParmFunc</code>.
</p>
</li>
<li><p> Param.Estimates:  Vector with the estimated parameters, in the following order: a11,a12,a13, a21, a22,a23, ...a(D-1)1,a(D-1)2,a(D-1)3,tau. Where D is the number of bacterial species present in the matrix <code>especie</code>.
</p>
</li>
<li><p> AIC Number: Value of the AIC.
</p>
</li></ul>



<h3>References</h3>

<p>Creus-Martí, I., Moya, A., Santonja, F. J. (2021). A Dirichlet autoregressive model for the analysis of microbiota time-series data. Complexity, 2021, 1-16.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
set.seed(123)
especie=t(gtools::rdirichlet(5,c(1,3,1)))
Tt=5
E=3
EspecieMaxima=3
ridge.final=ridgeregression(Tt,especie, E, EspecieMaxima)
tau=20
Iter.EstParmFunc=40

Estimate_Param_FBM(tau,ridge.final,Iter.EstParmFunc, especie,EspecieMaxima,Tt,E, 714)

</code></pre>

<hr>
<h2 id='Estimating_BPBM'>Estimating BPBM</h2><span id='topic+Estimating_BPBM'></span>

<h3>Description</h3>

<p>The estimation of the BPBM model is carried out using MCMC. To execute this function it is necessary to have the program Just Another Gibbs Sampler (JAGS) (Plummer, 2003) program installed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Estimating_BPBM(
  especie,
  Tt,
  E,
  MatrizPBmodelo,
  nn.chain = 3,
  nn.burnin = 5000,
  nn.sample = 20000,
  nn.thin = 10,
  seed = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Estimating_BPBM_+3A_especie">especie</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at all time points.</p>
</td></tr>
<tr><td><code id="Estimating_BPBM_+3A_tt">Tt</code></td>
<td>
<p>Number of time points available.</p>
</td></tr>
<tr><td><code id="Estimating_BPBM_+3A_e">E</code></td>
<td>
<p>Number of bacteria in the dataset.</p>
</td></tr>
<tr><td><code id="Estimating_BPBM_+3A_matrizpbmodelo">MatrizPBmodelo</code></td>
<td>
<p>Matrix with the covariates of the model. In an example with two SPBal and three time points, the covariates are written in the following  order:
</p>

<table>
<tr>
 <td style="text-align: right;">
1 </td><td style="text-align: right;">  1  </td><td style="text-align: right;">  1</td>
</tr>
<tr>
 <td style="text-align: right;">
<code class="reqn">SPBal_{1,t-1}</code> </td><td style="text-align: right;">  <code class="reqn">SPBal_{1,t-2}</code> </td><td style="text-align: right;">   <code class="reqn">SPBal_{1,t-3}</code> </td>
</tr>
<tr>
 <td style="text-align: right;">
<code class="reqn">SPBal_{2,t-1}</code> </td><td style="text-align: right;">  <code class="reqn">SPBal_{2,t-2}</code> </td><td style="text-align: right;">   <code class="reqn">SPBal_{2,t-3} </code></td>
</tr>

</table>
</td></tr>
<tr><td><code id="Estimating_BPBM_+3A_nn.chain">nn.chain</code></td>
<td>
<p>the number of chains to use with the simulation. Default is 3, minimum2.</p>
</td></tr>
<tr><td><code id="Estimating_BPBM_+3A_nn.burnin">nn.burnin</code></td>
<td>
<p>the number of burnin iterations. Default is 5000.</p>
</td></tr>
<tr><td><code id="Estimating_BPBM_+3A_nn.sample">nn.sample</code></td>
<td>
<p>the  number of iterations to take. Default: 20000. The markov chain will have (&quot;sample&quot;-&quot;burnin&quot;)/&quot;thin&quot; iterations.</p>
</td></tr>
<tr><td><code id="Estimating_BPBM_+3A_nn.thin">nn.thin</code></td>
<td>
<p>the thinning interval to be used. Default: 10.</p>
</td></tr>
<tr><td><code id="Estimating_BPBM_+3A_seed">seed</code></td>
<td>
<p>Number. Set a seed. Default <code>seed=NULL</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a list with:
</p>

<ul>
<li><p> List with:
</p>

<ul>
<li><p> R2jagsOutput:  R2jags object with the information of the estimation.
</p>
</li>
<li><p> SamplesAllChains:  Matrix. Matrix that has the iterations of all the Markov chains joined.
</p>
</li></ul>

</li></ul>



<h3>References</h3>


<ul>
<li><p> Creus-Martí, I., Moya, A., Santonja, F. J. (2022). Bayesian hierarchical compositional models for analysing longitudinal abundance data from microbiome studies. Complexity, 2022.
</p>
</li>
<li><p> Plummer, M. (2003, March). JAGS: A program for analysis of Bayesian graphical models using Gibbs sampling. In Proceedings of the 3rd international workshop on distributed statistical computing (Vol. 124, No. 125.10, pp. 1-10).
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
set.seed(314)
especie=t(gtools::rdirichlet(n=6, c(6,6,1,6,6)))
E=5
Tt=6
MatrizPBmodelo=rbind(c(1,1,1,1,1,1),c(-0.3,0.4,0.3,-0.7,-0.4,-0.6),c(0.3,0.5,-0.3,0.1,0.4,0.1))



Estimating_BPBM(especie,
               Tt,
               E,
               MatrizPBmodelo,
               nn.chain=3,
               nn.burnin=1000,
               nn.sample=2000,
               nn.thin=10,
               714)

</code></pre>

<hr>
<h2 id='EstParmFunc'>Writting the loglikelihood of the dirichlet</h2><span id='topic+EstParmFunc'></span>

<h3>Description</h3>

<p>This function calculates the loglikelihood of the dirichlet for the Dirich-gLV model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>EstParmFunc(parms.vector, especie)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="EstParmFunc_+3A_parms.vector">parms.vector</code></td>
<td>
<p>Vector equal to <code>c(tau,as.vector( pam))</code> where:
</p>

<ul>
<li><p> pam:  Matrix. Each row has the parameters of each bacteria. Following our example, pam has the parameters placed as follows:
</p>

<table>
<tr>
 <td style="text-align: right;">
 r1 </td><td style="text-align: right;">  a11  </td><td style="text-align: right;">  a12</td>
</tr>
<tr>
 <td style="text-align: right;">
 r2 </td><td style="text-align: right;">  a21 </td><td style="text-align: right;">   a22 </td>
</tr>

</table>

</li>
<li><p> tau:  Number. Value of the tau parameter in the model
</p>
</li></ul>
</td></tr>
<tr><td><code id="EstParmFunc_+3A_especie">especie</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at all time points . The bacteria placed in the last row of this matrix is the one used as reference in the alr transfromation that the model apply</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In an example with three bacteria, the regression of this model is defined by
</p>
<p style="text-align: center;"><code class="reqn">r_{1}\cdot log(x_{1}(t)/x_{3}(t))+log(x_{1}(t)/x_{3}(t))\cdot [a_{11}\cdot log(x_{1}(t)/x_{3}(t))(t)+a_{12}\cdot log(x_{2}(t)/x_{3}(t))] </code>
</p>

<p style="text-align: center;"><code class="reqn">r_{2}\cdot log(x_{2}(t)/x_{3}(t))+log(x_{2}(t)/x_{3}(t))\cdot [a_{21}\cdot log(x_{1}(t)/x_{3}(t))(t)+a_{22}\cdot log(x_{2}(t)/x_{3}(t))] </code>
</p>



<h3>Value</h3>

<p>Returns a number with the value of the dirichlet loglikelihood.
</p>


<h3>References</h3>

<p>Creus-Martí, I. and Moya, A. and Santonja, F. J. (2018). A Statistical Model with a Lotka-Volterra Structure for Microbiota Data. Lucas Jodar, Juan Carlos Cortes and Luis Acedo,  Modelling or engineering and human behavior 2018, Instituto Universitario de Matematica Multidisciplinar. ISBN: 978-84-09-07541-6
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

especie1=cbind(c(0.5,0.3,0.2), c(0.1,0.3,0.6))
tau1=0.4
parms1= cbind(c(0.1,0.2),c(-0.2,0.1),c(0.3,0.2))
parms11=c(tau1,as.vector( parms1))

EstParmFunc(parms11,especie1)

</code></pre>

<hr>
<h2 id='EstParmFunc_FBM'>Writting the loglikelihood of the dirichlet</h2><span id='topic+EstParmFunc_FBM'></span>

<h3>Description</h3>

<p>This function calculates the loglikelihood of the dirichlet for the FBM model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>EstParmFunc_FBM(param, especie, E, EspecieMaxima, Tt, especiemodi)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="EstParmFunc_FBM_+3A_param">param</code></td>
<td>
<p>Vector with the parameters in the following order: a11,a12,a13, a21, a22,a23, ...a(D-1)1,a(D-1)2,a(D-1)3,tau. Where D is the number of bacterial species present in the matrix <code>especie</code>.</p>
</td></tr>
<tr><td><code id="EstParmFunc_FBM_+3A_especie">especie</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at all time points.</p>
</td></tr>
<tr><td><code id="EstParmFunc_FBM_+3A_e">E</code></td>
<td>
<p>Number of bacteria available</p>
</td></tr>
<tr><td><code id="EstParmFunc_FBM_+3A_especiemaxima">EspecieMaxima</code></td>
<td>
<p>Row in which the bacterial with maximum mean abundance is in <code>especie</code>.This bacteria is used as reference in the alr transformation that the model does and it is placed at the denominator of the balance)</p>
</td></tr>
<tr><td><code id="EstParmFunc_FBM_+3A_tt">Tt</code></td>
<td>
<p>Number of bacteria available</p>
</td></tr>
<tr><td><code id="EstParmFunc_FBM_+3A_especiemodi">especiemodi</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at time points t=2,...,<code>Tt</code>. The bacteria are placed in the same order than in <code>especie</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The regression of this model is defined by
</p>
<p style="text-align: center;"><code class="reqn">\mu_{it}=a_{i1}+a_{i2}\cdot\text{alr}(x_{i,(t-1)})+a_{i3}\cdot\text{Balance}(x_{i,(t-1)})\text{ for }i=1,\dots, D-1\text{ where } D \text{ is the number of bacteria}</code>
</p>



<h3>Value</h3>

<p>Returns a number with the value of the dirichlet loglikelihood.
</p>


<h3>References</h3>

<p>Creus-Martí, I., Moya, A., Santonja, F. J. (2021). A Dirichlet autoregressive model for the analysis of microbiota time-series data. Complexity, 2021, 1-16.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

especie1=cbind(c(0.5,0.3,0.2), c(0.1,0.3,0.6))
especiemodi=especie1[,-1]
tau1=0.4
parms1= cbind(c(0.1,0.2),c(-0.2,0.1),c(0.3,0.2))
parms11=c(as.vector( t(parms1)),tau1)

EstParmFunc_FBM(parms11,especie1,3 ,3  , 2,especiemodi)

</code></pre>

<hr>
<h2 id='ExpectedValue_EstParmFunc'>Obtaining the value of the Dirichlet parameters, the expected value and the variance.</h2><span id='topic+ExpectedValue_EstParmFunc'></span>

<h3>Description</h3>

<p>This function calculates the value of the Dirichlet parameters, the expected value and the variance for the Dirich-gLV model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ExpectedValue_EstParmFunc(Param.Estimates, especie)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ExpectedValue_EstParmFunc_+3A_param.estimates">Param.Estimates</code></td>
<td>
<p>Vector with the estimated parameters. This value is the output of the Estimate_Param_EstParmFunc function.</p>
</td></tr>
<tr><td><code id="ExpectedValue_EstParmFunc_+3A_especie">especie</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at all time points. The bacteria placed in the last row of this matrix is the one used as reference in the alr transformation that the model applies.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a list with:
</p>

<ul>
<li><p> Dirichlet.Param:  Matrix. Matrix that contains at row i the Dirichlet parameter of the bacteria i at all time points.
</p>
</li>
<li><p> Expected.Value:  Matrix. Matrix that contains at row i the expected value of the bacteria i at all time points. The bacterias are placed at the same orden than in <code>especies</code>.
</p>
</li>
<li><p> Variance.Value:  Matrix. Matrix that contains at row i the variance of the bacteria i at all time points. The bacterias are placed at the same orden than in <code>especies</code>.
</p>
</li></ul>



<h3>References</h3>

<p>Creus-Martí, I. and Moya, A. and Santonja, F. J. (2018). A Statistical Model with a Lotka-Volterra Structure for Microbiota Data. Lucas Jodar, Juan Carlos Cortes and Luis Acedo,  Modelling or engineering and human behavior 2018, Instituto Universitario de Matematica Multidisciplinar. ISBN: 978-84-09-07541-6
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

especie1=cbind(c(0.5,0.3,0.2), c(0.1,0.3,0.6))
tau1=0.4
parms1= cbind(c(0.1,0.2),c(-0.2,0.1),c(0.3,0.2))
parms11=c(tau1,as.vector( parms1))

ExpectedValue_EstParmFunc(parms11,especie1)
</code></pre>

<hr>
<h2 id='ExpectedValues_EstParmFunc_FBM'>Obtainig the value of the dirichlet parameters, the expected value and the variance.</h2><span id='topic+ExpectedValues_EstParmFunc_FBM'></span>

<h3>Description</h3>

<p>This function calculates the value of the dirichlet parameters, the expected value and the variance for the FBM model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ExpectedValues_EstParmFunc_FBM(
  paramEstimadosFinal,
  especie,
  E,
  EspecieMaxima,
  Tt
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ExpectedValues_EstParmFunc_FBM_+3A_paramestimadosfinal">paramEstimadosFinal</code></td>
<td>
<p>The estimate parameters, in the following order: a11,a12,a13, a21, a22,a23, ...a(D-1)1,a(D-1)2,a(D-1)3,tau. Where D is the number of bacterial species present in the matrix <code>especie</code>.</p>
</td></tr>
<tr><td><code id="ExpectedValues_EstParmFunc_FBM_+3A_especie">especie</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at all time points.</p>
</td></tr>
<tr><td><code id="ExpectedValues_EstParmFunc_FBM_+3A_e">E</code></td>
<td>
<p>Number of bacteria available.</p>
</td></tr>
<tr><td><code id="ExpectedValues_EstParmFunc_FBM_+3A_especiemaxima">EspecieMaxima</code></td>
<td>
<p>Row in which the bacteria chosen as reference is in <code>especie</code>.This bacteria is used as reference in the alr tranformation that the model does and it is placed at the denominator of the balance).</p>
</td></tr>
<tr><td><code id="ExpectedValues_EstParmFunc_FBM_+3A_tt">Tt</code></td>
<td>
<p>Number of time points available.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The regression of this model is defined by
</p>
<p style="text-align: center;"><code class="reqn">\mu_{it}=a_{i1}+a_{i2}\cdot\text{alr}(x_{i,(t-1)})+a_{i3}\cdot\text{Balance}(x_{i,(t-1)})\text{ for }i=1,\dots, D-1\text{ where } D \text{ is the number of bacteria}</code>
</p>



<h3>Value</h3>

<p>Returns a list with:
</p>

<ul>
<li><p> Dirichlet.Param:  Matrix. Matrix that contains at row i the dirichlet parameter of the bacteria i at all time points.
</p>
</li>
<li><p> Expected.Value:  Matrix. Matrix that contains at row i the expected value of the bacteria i at all time points. The bacterias are placed at the same orden than in <code>especies</code>.
</p>
</li>
<li><p> Variance.Value:  Matrix. Matrix that contains at row i the variance of the bacteria i at all time points. The bacterias are placed at the same orden than in <code>especies</code>.
</p>
</li></ul>



<h3>References</h3>

<p>Creus-Martí, I., Moya, A., Santonja, F. J. (2021). A Dirichlet autoregressive model for the analysis of microbiota time-series data. Complexity, 2021, 1-16.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
set.seed(123)
especie=t(gtools::rdirichlet(2,c(1,1,3)))
Tt=2
E=3
tau=5
EspecieMaxima=3
Iter.EstParmFunc=5
parms11=c(0.1,0.2,0.3,0.4,0.5,0.6,tau)

ExpectedValues_EstParmFunc_FBM(parms11 , especie,E,EspecieMaxima,Tt)

</code></pre>

<hr>
<h2 id='ExpectedValuess_BPBM'>Obtainig the value of the dirichlet parameters, the expected value and the variance.</h2><span id='topic+ExpectedValuess_BPBM'></span>

<h3>Description</h3>

<p>This function calculates the value of the dirichlet parameters, the expected value and the variance for the BPBM model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ExpectedValuess_BPBM(Estimated.Param, MatrizPBmodelo, E, Tt)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ExpectedValuess_BPBM_+3A_estimated.param">Estimated.Param</code></td>
<td>
<p>Vector with the estimate parameters. Column &quot;mean&quot; of the output of &quot;StudyingParam&quot; function.</p>
</td></tr>
<tr><td><code id="ExpectedValuess_BPBM_+3A_matrizpbmodelo">MatrizPBmodelo</code></td>
<td>
<p>Matrix. Output of &quot;ObtainingValueSPBal&quot; called &quot;MatrixSPBal&quot;.</p>
</td></tr>
<tr><td><code id="ExpectedValuess_BPBM_+3A_e">E</code></td>
<td>
<p>Number of bacteria available.</p>
</td></tr>
<tr><td><code id="ExpectedValuess_BPBM_+3A_tt">Tt</code></td>
<td>
<p>Number of time points available.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The regression of this model is defined by:
</p>
<p style="text-align: center;"><code class="reqn">\mu_{it}=a_{i0}+a_{i1}\cdot\text{SPBal}_{1,t-1}+\cdots+a_{iM}\cdot\text{SPBal}_{M,t-1}</code>
</p>



<h3>Value</h3>

<p>Returns a list with:
</p>

<ul>
<li><p> Dirichlet.Param:  Matrix. Matrix that contains at row i the dirichlet parameter of the bacteria i at all time points.
</p>
</li>
<li><p> Expected.Value:  Matrix. Matrix that contains at row i the expected value of the bacteria i at all time points. The bacterias are placed at the same orden than in <code>especies</code>.
</p>
</li>
<li><p> Variance.Value:  Matrix. Matrix that contains at row i the variance of the bacteria i at all time points. The bacterias are placed at the same orden than in <code>especies</code>.
</p>
</li></ul>



<h3>References</h3>

<p>Creus-Martí, I., Moya, A., Santonja, F. J. (2022). Bayesian hierarchical compositional models for analysing longitudinal abundance data from microbiome studies. Complexity, 2022.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
Tt=3
E=3
Estimated.Param=c(0.1 ,0.4, 0.7, 0.2 ,0.5, 0.8 ,0.3, 0.6, 0.9,
                 0.1, 0.4 ,0.7, 0.2, 0.5, 0.8, 0.3 ,0.6, 0.9)
MatrizPBmodelo=rbind(c(1,1,1),c(0.3,0.6,-0.1),c(0.2,-0.4,0.3))
ExpectedValuess_BPBM(Estimated.Param,MatrizPBmodelo,E,Tt)

</code></pre>

<hr>
<h2 id='FromVectorToMatrix_BPBM'>Writting the parameters in the matrix form required in BPBM model</h2><span id='topic+FromVectorToMatrix_BPBM'></span>

<h3>Description</h3>

<p><code>StudyingParam</code> returns a matrix where the value of the parameters is in the column &quot;mean&quot;. This function inputs this columns and outputs the parameters in the matrix form required by the BPBM model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>FromVectorToMatrix_BPBM(param, MatrizPBmodelo, E)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="FromVectorToMatrix_BPBM_+3A_param">param</code></td>
<td>
<p>Vector. Column &quot;mean&quot; of the output of &quot;StudyingParam&quot; function.</p>
</td></tr>
<tr><td><code id="FromVectorToMatrix_BPBM_+3A_matrizpbmodelo">MatrizPBmodelo</code></td>
<td>
<p>Matrix with the covariates of the model. In an example with two SPBal and three time points, the covariates are written in the following  order:
</p>

<table>
<tr>
 <td style="text-align: right;">
1 </td><td style="text-align: right;">  1  </td><td style="text-align: right;">  1</td>
</tr>
<tr>
 <td style="text-align: right;">
<code class="reqn">SPBal_{1,t-1}</code> </td><td style="text-align: right;">  <code class="reqn">SPBal_{1,t-2}</code> </td><td style="text-align: right;">   <code class="reqn">SPBal_{1,t-3}</code> </td>
</tr>
<tr>
 <td style="text-align: right;">
<code class="reqn">SPBal_{2,t-1}</code> </td><td style="text-align: right;">  <code class="reqn">SPBal_{2,t-2}</code> </td><td style="text-align: right;">   <code class="reqn">SPBal_{2,t-3}</code>
 </td>
</tr>

</table>
</td></tr>
<tr><td><code id="FromVectorToMatrix_BPBM_+3A_e">E</code></td>
<td>
<p>Number of bacteria in the dataset.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a matrix with the parameters in the order required by the BPBM model.
</p>


<h3>References</h3>

<p>Creus-Martí, I., Moya, A., Santonja, F. J. (2022). Bayesian hierarchical compositional models for analysing longitudinal abundance data from microbiome studies. Complexity, 2022.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
set.seed(314)
especie=t(gtools::rdirichlet(n=6, c(6,6,1,6,6)))
E=5
Tt=6
MatrizPBmodelo=rbind(c(1,1,1,1,1,1),
                   c(-0.3,0.4,0.3,-0.7,-0.4,-0.6),
                   c(0.3,0.5,-0.3,0.1,0.4,0.1))

est=Estimating_BPBM(especie,
                   Tt,
                   E,
                   MatrizPBmodelo,
                   nn.chain=3,
                   nn.burnin=1000,
                   nn.sample=5000,
                   nn.thin=10)

mm=StudyingParam(est$R2jagsOutput$BUGSoutput$summary,est$SamplesAllChains)
FromVectorToMatrix_BPBM(mm$Param.Summary[,"mean"],MatrizPBmodelo,5)

</code></pre>

<hr>
<h2 id='FVectorPBmodeloPredi'>Obtaining a vector with the covariates of the prediction</h2><span id='topic+FVectorPBmodeloPredi'></span>

<h3>Description</h3>

<p>Calculates a vector with the covariates of the BPBM model in one time point.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>FVectorPBmodeloPredi(NumSPBal, DemSPBal, v, MatrizPBmodelo)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="FVectorPBmodeloPredi_+3A_numspbal">NumSPBal</code></td>
<td>
<p>List. The component i of the list has the number of the row of the matrix <code>especie</code> where the bacteria in the numerator of the principal balance i are placed.</p>
</td></tr>
<tr><td><code id="FVectorPBmodeloPredi_+3A_demspbal">DemSPBal</code></td>
<td>
<p>List. The component i of the list has the number of the row of the matrix <code>especie</code> where the bacteria in the denominator of the principal balance i are placed.</p>
</td></tr>
<tr><td><code id="FVectorPBmodeloPredi_+3A_v">v</code></td>
<td>
<p>Vector. Vector with a coda composition. The bacteria ar in the same orden than the matrix <code>especie</code></p>
</td></tr>
<tr><td><code id="FVectorPBmodeloPredi_+3A_matrizpbmodelo">MatrizPBmodelo</code></td>
<td>
<p>the matrix that contains the covariates of the model. The first line es equal to 1 for all columns. The other rows contain the value of one SPBal at all time points. The selected principal balance of the row i+1 has at its numerator the bacteria placed in the rows <code>NumSPBal[[i]]</code> of the &quot;especie&quot;. The selected principal balance of the row i+1 has at its denominator the bacteria placed in the rows <code>DemSPBal[[i]]</code> of the &quot;especie&quot;.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a vector where the first component is a 1 and the following components have the values of the SPBal.  The SPBal in the component i+1  has at its numerator the bacteria placed in the rows <code>Num[[i]]</code> of the <code>especie</code>. The SPBal of the component i+1  has at its denominator the bacteria placed in the rows <code>Dem[[i]]</code> of the <code>especie</code>.
</p>


<h3>References</h3>

<p>Creus-Martí, I., Moya, A., Santonja, F. J. (2022). Bayesian hierarchical compositional models for analysing longitudinal abundance data from microbiome studies. Complexity, 2022.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
v=c(0.1,0.1,0.2,0.3,0.3)
Num2&lt;-list(3,c(3,5),1,c(3,5,4))
Dem2&lt;-list(5,4,2,c(1,2))
MatrizPBmodelo=rbind(c(1,1,1,1),
                    c(-0.3,0.2,0.5,0.6),
                    c(-0.4,0.3,0.5,0.6),
                    c(0.5,0.3,0.2,0.7),
                    c(-0.2,0.9,0.2,0.1)   )

FVectorPBmodeloPredi(Num2,Dem2,v,MatrizPBmodelo)

</code></pre>

<hr>
<h2 id='Graphics'>Plots the time series</h2><span id='topic+Graphics'></span>

<h3>Description</h3>

<p>Plots the time series
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Graphics(especie, names.especie, esperanza, Variance, Plot.Tipe, Detail)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Graphics_+3A_especie">especie</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at all time points.</p>
</td></tr>
<tr><td><code id="Graphics_+3A_names.especie">names.especie</code></td>
<td>
<p>Vector with the names of the bacteria in the same order that are placed in the <code>especie</code> matrix.</p>
</td></tr>
<tr><td><code id="Graphics_+3A_esperanza">esperanza</code></td>
<td>
<p>Matrix that contains at row i the expected value of the bacterial taxa i at all time points. The bacteria must be placed in the same order than in <code>especie</code></p>
</td></tr>
<tr><td><code id="Graphics_+3A_variance">Variance</code></td>
<td>
<p>Matrix that contains at row i the variance of the bacterial taxa i at all time points. The bacteria must be placed in the same order than in <code>especie</code></p>
</td></tr>
<tr><td><code id="Graphics_+3A_plot.tipe">Plot.Tipe</code></td>
<td>
<p>Character. If <code>Plot.Tipe==Data</code> the function displays a graphic of the dataset, if <code>Plot.Tipe==DataExpected</code> the function displays a graphic of the data and the expected values, if <code>Plot.Tipe==All</code> the function displais a graphic woth the data, the expected values and the variance.If  <code>Plot.Tipe==Var</code> the function returns the boxplot of the variance at each time point and the variance of each bacteria. If  <code>Plot.Tipe==OnlyVar</code> the function returns the boxplots of the variance at each time points.</p>
</td></tr>
<tr><td><code id="Graphics_+3A_detail">Detail</code></td>
<td>
<p>Character. If <code>Detail==no</code> the graphic obtained when <code>Plot.Tipe==DataExpected</code> and <code>Plot.Tipe==All</code> will have the same y axis for all the taxa. If <code>Detail==yes</code> these functions will have different y axis.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns the indicated plots.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

names.especie=c("Bact1", "Bact2", "Bact3")
especie=cbind(c(0.5,0.3,0.2), c(0.6,0.3,0.1),c(0.4,0.1,0.5),c(0.4,0.1,0.5))
esperanza=especie[,c(1:3)]+0.1
Variance=matrix(c(runif(9,0.001,0.004)), 3,3)

Graphics(especie, names.especie, esperanza, Variance,"Data","no")
Graphics(especie, names.especie, esperanza, Variance,"DataExpected","no")
Graphics(especie, names.especie, esperanza, Variance,"All","no")
</code></pre>

<hr>
<h2 id='GraphicsPrediction'>Plots the time series</h2><span id='topic+GraphicsPrediction'></span>

<h3>Description</h3>

<p>This function takes into account the data used to estimate  and the data used to predict.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GraphicsPrediction(
  especie.All,
  names.especie,
  ExpectedValue.All,
  VarianceValue.All,
  Pred,
  Plot.Tipe,
  Detail
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="GraphicsPrediction_+3A_especie.all">especie.All</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at all time points.</p>
</td></tr>
<tr><td><code id="GraphicsPrediction_+3A_names.especie">names.especie</code></td>
<td>
<p>Vector with the names of the bacteria in the same order that are placed in the <code>especie</code> matrix.</p>
</td></tr>
<tr><td><code id="GraphicsPrediction_+3A_expectedvalue.all">ExpectedValue.All</code></td>
<td>
<p>Matrix that contains at row i the expected value of the bacterial taxa i at all time points. The bacteria must be placed in the same order than in <code>especie</code>. This matrix must  comply: dim(ExpectedValue.All)[2]=dim(especie.All)[2]-1</p>
</td></tr>
<tr><td><code id="GraphicsPrediction_+3A_variancevalue.all">VarianceValue.All</code></td>
<td>
<p>Matrix that contains at row i the variance of the bacterial taxa i at all time points. The bacteria must be placed in the same order than in <code>especie</code>.This matrix must  comply: dim(VarianceValue.All)[2]=dim(especie.All)[2]-1</p>
</td></tr>
<tr><td><code id="GraphicsPrediction_+3A_pred">Pred</code></td>
<td>
<p>Number. Indicates the time point in which we start predicting.</p>
</td></tr>
<tr><td><code id="GraphicsPrediction_+3A_plot.tipe">Plot.Tipe</code></td>
<td>
<p>Character. If <code>Plot.Tipe==Data</code> the function displays a graphic of the dataset, if <code>Plot.Tipe==DataExpected</code> the function displays a graphic of the data and the expected values, if <code>Plot.Tipe==All</code> the function displays a graphic with the data, the expected values and the variance.If  <code>Plot.Tipe==Var</code> the function returns the boxplot of the variance at each time point and the variance of each bacteria. If  <code>Plot.Tipe==OnlyVar</code> the function returns the boxplots of the variance at each time points.</p>
</td></tr>
<tr><td><code id="GraphicsPrediction_+3A_detail">Detail</code></td>
<td>
<p>Character. If <code>Detail==no</code> the graphic obtained when <code>Plot.Tipe==DataExpected</code> and <code>Plot.Tipe==All</code> will have the same y axis for all the taxa. If <code>Detail==yes</code> these functions will have different y axis.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns the indicated plots with a vertical line when the time point is equal to Pred-1, in Pred the prediction has started.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

names.especie=c("Bact1", "Bact2", "Bact3")
especie.All=cbind(c(0.5,0.3,0.2),
                c(0.6,0.3,0.1),
                c(0.4,0.1,0.5),
                c(0.4,0.1,0.5),
                c(0.4,0.1,0.5),
                c(0.4,0.1,0.5))
ExpectedValue.All=especie.All[,-1]+0.1
VarianceValue.All=matrix(c(runif(15,0.001,0.004)), 3,5)
Pred=4

GraphicsPrediction(especie.All,
                  names.especie,
                  ExpectedValue.All,
                  VarianceValue.All ,
                  Pred,
                  "Data",
                  "no")

GraphicsPrediction(especie.All,
                 names.especie,
                 ExpectedValue.All,
                 VarianceValue.All ,
                 Pred,
                 "DataExpected",
                 "no")

GraphicsPrediction(especie.All,
                 names.especie,
                 ExpectedValue.All,
                 VarianceValue.All ,
                 Pred,
                 "All",
                 "no")

GraphicsPrediction(especie.All,
                 names.especie,
                 ExpectedValue.All,
                 VarianceValue.All ,
                 Pred,
                 "Var",
                 "no")

GraphicsPrediction(especie.All,
                 names.especie,
                 ExpectedValue.All,
                 VarianceValue.All ,
                 Pred,
                 "OnlyVar",
                 "no")


</code></pre>

<hr>
<h2 id='GraphicsPredictionBPBM'>Plots the time series</h2><span id='topic+GraphicsPredictionBPBM'></span>

<h3>Description</h3>

<p>This function takes into account the data used to estimate and the data used to predict. We use this function when we want to observe the results obtained with the BPBM model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GraphicsPredictionBPBM(
  especie.All,
  names.especie,
  ExpectedValue.All,
  VarianceValue.All,
  Pred,
  Plot.Tipe,
  Varmas,
  Varmenos,
  Detail
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="GraphicsPredictionBPBM_+3A_especie.all">especie.All</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at all time points.</p>
</td></tr>
<tr><td><code id="GraphicsPredictionBPBM_+3A_names.especie">names.especie</code></td>
<td>
<p>Vector with the names of the bacteria in the same order that are placed in the <code>especie</code> matrix.</p>
</td></tr>
<tr><td><code id="GraphicsPredictionBPBM_+3A_expectedvalue.all">ExpectedValue.All</code></td>
<td>
<p>Matrix that contains at row i the expected value of the bacterial taxa i at all time points. The bacteria must be placed in the same order than in <code>especie</code>. This matrix must  comply: dim(ExpectedValue.All)[2]=dim(especie.All)[2]-1</p>
</td></tr>
<tr><td><code id="GraphicsPredictionBPBM_+3A_variancevalue.all">VarianceValue.All</code></td>
<td>
<p>Matrix that contains at row i the variance of the bacterial taxa i at all time points. The bacteria must be placed in the same order than in <code>especie</code>.This matrix must  comply: dim(VarianceValue.All)[2]=dim(especie.All)[2]-1</p>
</td></tr>
<tr><td><code id="GraphicsPredictionBPBM_+3A_pred">Pred</code></td>
<td>
<p>Number. Indicates the time point in which we start predicting.</p>
</td></tr>
<tr><td><code id="GraphicsPredictionBPBM_+3A_plot.tipe">Plot.Tipe</code></td>
<td>
<p>Character. If <code>Plot.Tipe==Data</code> the function displays a graphic of the dataset, if <code>Plot.Tipe==DataExpected</code> the function displays a graphic of the data and the expected values, if <code>Plot.Tipe==All</code> the function displays a graphic with the data, the expected values and the variance (the varmas and varmenos parameters are introduce and are taken into account to plot the variance of the predicted part).If  <code>Plot.Tipe==Var</code> the function returns the boxplot of the variance at each time point and the variance of each bacteria. If  <code>Plot.Tipe==OnlyVar</code> the function returns the boxplots of the variance at each time points.</p>
</td></tr>
<tr><td><code id="GraphicsPredictionBPBM_+3A_varmas">Varmas</code></td>
<td>
<p>Matrix. Output of &quot;PredictionBPBM&quot; adding &quot;$ExpVarmas&quot;. Matrix that contains at row i the expected value plus two times the sqrt(variance) of the bacteria i at all time points t=<code>Tt</code>,...,K, the rest of the time points has 0 values. The bacteria are placed at the same order than in <code>especies</code>.</p>
</td></tr>
<tr><td><code id="GraphicsPredictionBPBM_+3A_varmenos">Varmenos</code></td>
<td>
<p>Matrix. Output of &quot;PredictionBPBM&quot; adding &quot;$ExpVarmenos&quot;. Matrix that contains at row i the expected value minus two times the sqrt(variance) of the bacteria i at all time points t=<code>Tt</code>,...,K, the rest of the time points has 0 values. The bacteria are placed at the same order than in <code>especies</code>.</p>
</td></tr>
<tr><td><code id="GraphicsPredictionBPBM_+3A_detail">Detail</code></td>
<td>
<p>Character. If <code>Detail==no</code> the graphic obtained when <code>Plot.Tipe==DataExpected</code> and <code>Plot.Tipe==All</code> will have the same y axis for all the taxa. If <code>Detail==yes</code> these functions will have different y axis.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns the indicated plots with a vertical line when the time point is equal to <code>Tt</code>=Pred-1, in Pred=<code>Tt</code>+1 the predicction has started.
</p>


<h3>References</h3>

<p>Creus-Martí, I., Moya, A., Santonja, F. J. (2022). Bayesian hierarchical compositional models for analysing longitudinal abundance data from microbiome studies. Complexity, 2022.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

names.especie=c("Bact1", "Bact2", "Bact3")
especie.All=cbind(c(0.5,0.3,0.2),
                 c(0.6,0.3,0.1),
                 c(0.4,0.1,0.5),
                 c(0.4,0.1,0.5),
                 c(0.4,0.1,0.5),
                 c(0.4,0.1,0.5))
ExpectedValue.All=especie.All[,-1]+0.1
VarianceValue.All=matrix(c(runif(15,0.001,0.004)), 3,5)
Pred=4
Varmas=cbind(matrix(0,3,2),matrix(c(runif(9,0.001,0.004)) ,3 ,3 ))
Varmenos=cbind(matrix(0,3,2),matrix(c(runif(9,0.001,0.004)) ,3 ,3 ))

GraphicsPredictionBPBM(especie.All,
                      names.especie,
                      ExpectedValue.All,
                      VarianceValue.All ,
                      Pred ,
                      "Data",
                      Varmas,
                      Varmenos,
                      "no")

GraphicsPredictionBPBM(especie.All,
                      names.especie,
                      ExpectedValue.All,
                      VarianceValue.All ,
                      Pred ,
                      "DataExpected",
                      Varmas,
                      Varmenos,
                      "no")

GraphicsPredictionBPBM(especie.All,
                      names.especie,
                      ExpectedValue.All,
                      VarianceValue.All,
                      Pred ,
                      "All",
                      Varmas,
                      Varmenos,
                      "no")

GraphicsPredictionBPBM(especie.All,
                      names.especie,
                      ExpectedValue.All,
                      VarianceValue.All ,
                      Pred ,
                      "Var",
                      Varmas,
                      Varmenos,
                      "no")

GraphicsPredictionBPBM(especie.All,
                      names.especie,
                      ExpectedValue.All,
                      VarianceValue.All ,
                      Pred ,
                      "OnlyVar",
                      Varmas,
                      Varmenos,
                      "no")

</code></pre>

<hr>
<h2 id='GraphicsSPBal'>Obtaining the graphic of the SPBal at all time points</h2><span id='topic+GraphicsSPBal'></span>

<h3>Description</h3>

<p>The SPBal (of BPBM model) are ordered from highest to lowest variance percentage. The zero is highlight because the closer the value of the balance is to zero, the more similar (in terms of relative abundance) the numerator and denominator groups will be. The farther away from zero, the more different.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GraphicsSPBal(MatrizPBmodelo)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="GraphicsSPBal_+3A_matrizpbmodelo">MatrizPBmodelo</code></td>
<td>
<p>Matrix. Output of &quot;ObtainigValueSPBal&quot; function.  MatrixSPBal is the matrix that contains the covariates of the model. The first line es equal to 1 for all columns. The other rows contain the value of one SPBal at all time points. The selected principal balance of the row i+1 has at its numerator the bacteria placed in the rows <code>NumSPBal[[i]]</code> of the &quot;especie&quot;. The selected principal balance of the row i+1 has at its denominator the bacteria placed in the rows <code>DemSPBal[[i]]</code> of the &quot;especie&quot;.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a graphic.
</p>


<h3>References</h3>

<p>Creus-Martí, I., Moya, A., Santonja, F. J. (2022). Bayesian hierarchical compositional models for analysing longitudinal abundance data from microbiome studies. Complexity, 2022.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
MatrizPBmodelo=rbind(c(1,1,1,1,1,1),c(-0.3,0.4,0.3,-0.7,-0.4,-0.6),c(0.3,0.5,-0.3,0.1,0.4,0.1))
GraphicsSPBal(MatrizPBmodelo)

</code></pre>

<hr>
<h2 id='LogVeroFuncBUENA'>Writting the loglikelihood of the dirichlet</h2><span id='topic+LogVeroFuncBUENA'></span>

<h3>Description</h3>

<p>This function calculates the loglikelihood of the dirichlet for the BPBM model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>LogVeroFuncBUENA(param, MatrizPBmodelo, E, Tt, especiemodi)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="LogVeroFuncBUENA_+3A_param">param</code></td>
<td>
<p>Vector. Column &quot;mean&quot; of the output of &quot;StudyingParam&quot; function.</p>
</td></tr>
<tr><td><code id="LogVeroFuncBUENA_+3A_matrizpbmodelo">MatrizPBmodelo</code></td>
<td>
<p>Matrix with the covariates of the model. In an example with two SPBal and three time points, the covariates are written in the following  order:
</p>

<table>
<tr>
 <td style="text-align: right;">
1 </td><td style="text-align: right;">  1  </td><td style="text-align: right;">  1</td>
</tr>
<tr>
 <td style="text-align: right;">
<code class="reqn">SPBal_{1,t-1}</code> </td><td style="text-align: right;">  <code class="reqn">SPBal_{1,t-2}</code> </td><td style="text-align: right;">   <code class="reqn">SPBal_{1,t-3}</code> </td>
</tr>
<tr>
 <td style="text-align: right;">
<code class="reqn">SPBal_{2,t-1}</code> </td><td style="text-align: right;">  <code class="reqn">SPBal_{2,t-2}</code> </td><td style="text-align: right;">  <code class="reqn"> SPBal_{2,t-3}</code> </td>
</tr>

</table>
</td></tr>
<tr><td><code id="LogVeroFuncBUENA_+3A_e">E</code></td>
<td>
<p>Number f bacteria in the dataset.</p>
</td></tr>
<tr><td><code id="LogVeroFuncBUENA_+3A_tt">Tt</code></td>
<td>
<p>Number of time points available</p>
</td></tr>
<tr><td><code id="LogVeroFuncBUENA_+3A_especiemodi">especiemodi</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at time points t=2,...,<code>Tt</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a number with the value of the dirichlet loglikelihood.
</p>


<h3>References</h3>

<p>Creus-Martí, I., Moya, A., Santonja, F. J. (2022). Bayesian hierarchical compositional models for analysing longitudinal abundance data from microbiome studies. Complexity, 2022.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

set.seed(314)
especie=t(gtools::rdirichlet(n=2, c(1,2,3)))
E=3
Tt=2
MatrizPBmodelo=rbind(c(1,1),c(-0.3,0.4),c(0.3,0.5))
set.seed(314)
est=Estimating_BPBM(especie,
                   Tt,
                   E,
                   MatrizPBmodelo,
                   nn.chain=3,
                   nn.burnin=1000,
                   nn.sample=5000,
                   nn.thin=10)

param=est$SamplesAllChains

especiemodi=especie[,-1]


LogVeroFuncBUENA(param,MatrizPBmodelo,E,Tt,especiemodi)
</code></pre>

<hr>
<h2 id='MaxBacteria'>Putting the reference bacteria at the last row</h2><span id='topic+MaxBacteria'></span>

<h3>Description</h3>

<p>This function calculates the mean abundance of each bacteria. Then, it creates a matrix where each row contains the abundance of one bacteria at all time points but  the bacteria with maximum (or minimum or a bacteria indicated by the user) mean abundance is placed at the last row
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MaxBacteria(nombresOriginal, especieOriginal, E, Tt, which.esp)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="MaxBacteria_+3A_nombresoriginal">nombresOriginal</code></td>
<td>
<p>Vector with the bacterial names at the same order than in DaTa. it must be fulfilled that lenght(nombresOriginal)==dim(DaTa)[2]-1</p>
</td></tr>
<tr><td><code id="MaxBacteria_+3A_especieoriginal">especieOriginal</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at all time points</p>
</td></tr>
<tr><td><code id="MaxBacteria_+3A_e">E</code></td>
<td>
<p>Number of bacteria available</p>
</td></tr>
<tr><td><code id="MaxBacteria_+3A_tt">Tt</code></td>
<td>
<p>Number of bacteria available</p>
</td></tr>
<tr><td><code id="MaxBacteria_+3A_which.esp">which.esp</code></td>
<td>
<p>If <code>which=="Max"</code> this function puts in the last position of the matrix the bacteria with maximum mean abundance.  If <code>which=="Min"</code> this function puts in the last position of the matrix the bacteria with minimum mean abundance.  If which is equal to a number this function puts in the last position of the matrix the bacteria that is in the &quot;which&quot; row of the <code>especieOriginal</code> matrix.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a list with
</p>

<ul>
<li> <p><code>especie</code> - Matrix that contains at row i the bacterial taxa of bacteria i at all time points but  the bacteria with maximum (or minimum) mean abundance (or the bacteria indicated by the user) is placed at the last row.
</p>
</li>
<li> <p><code>especiemodi</code> - Matrix that contains at row i the bacterial taxa of bacteria i at time points t=2,...,<code>Tt</code> but  the bacteria with maximum (or minimum) mean abundance (or the bacteria indicated by the user) is placed at the last row.
</p>
</li>
<li> <p><code>nombres</code> - Vector with the bacteria's names placed in the order in which appear in the rows of the matrices <code>especie</code> and <code>especiemodi</code>
</p>
</li>
<li> <p><code>EE</code>  - Row in which the bacterial with maximum (or minimum) mean abundance was (or the value of &quot;which&quot; if which is numerical).
</p>
</li>
<li>  <p><code>EspecieMaxima</code> - Row in which the bacterial with maximum (or minimum) mean abundance (or the bacteria indicated by the user) is in <code>especie</code>.)
#' </p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
names1=c("Bact1","Bact2","Bact3")
set.seed(314)
esp1=t(gtools::rdirichlet(n=4, c(1,3,1)))
e1=3
t1=4

MaxBacteria(names1,esp1,e1,t1,"Max")


names3=c("Bact1","Bact2","Bact3","Bact4","Bact5")
set.seed(314)
esp3=t(gtools::rdirichlet(n=6, c(6,6,1,6,6)))
e3=5
t3=6
MaxBacteria(names3,esp3,e3,t3,"Min")


</code></pre>

<hr>
<h2 id='MaxBacteriaPred'>Putting the reference bacteria at the last row</h2><span id='topic+MaxBacteriaPred'></span>

<h3>Description</h3>

<p>This function calculates the mean abundance of each bacteria taking into account the time points used to estimate the model (t=1,2,...,<code>Tt</code>). Then, it creates a matrix where each row contains the abundance of one bacteria at all time points but  the bacteria with maximum (or minimum) mean abundance (or the bacterial indicated by the user) is placed at the last row
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MaxBacteriaPred(
  nombresOriginal,
  especieOriginal,
  E,
  Tt,
  Pred,
  K,
  especieOriginal.All,
  which.esp
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="MaxBacteriaPred_+3A_nombresoriginal">nombresOriginal</code></td>
<td>
<p>Vector with the bacterial names at the same order than in DaTa. it must be fulfilled that lenght(nombresOriginal)==dim(DaTa)[2]-1</p>
</td></tr>
<tr><td><code id="MaxBacteriaPred_+3A_especieoriginal">especieOriginal</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at t=1,2,...,<code>Tt</code>, with <code>Tt</code>=Pred-1.</p>
</td></tr>
<tr><td><code id="MaxBacteriaPred_+3A_e">E</code></td>
<td>
<p>Number of bacteria available</p>
</td></tr>
<tr><td><code id="MaxBacteriaPred_+3A_tt">Tt</code></td>
<td>
<p>Number of time points used to estimate the model (<code>Tt</code>=Pred-1)</p>
</td></tr>
<tr><td><code id="MaxBacteriaPred_+3A_pred">Pred</code></td>
<td>
<p>Number. The data at t=1,...,Pred-1 will be used to estimate the model. The rest of the time points will be used to study the capacity of the model to predict. If <code>Pred==0</code> all the datatset will be used to estimate the model.</p>
</td></tr>
<tr><td><code id="MaxBacteriaPred_+3A_k">K</code></td>
<td>
<p>Number of time points at the data</p>
</td></tr>
<tr><td><code id="MaxBacteriaPred_+3A_especieoriginal.all">especieOriginal.All</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at all time points.</p>
</td></tr>
<tr><td><code id="MaxBacteriaPred_+3A_which.esp">which.esp</code></td>
<td>
<p>If <code>which=="Max"</code> this function puts in the last position of the matrix the bacteria with maximum mean abundance.  If <code>which=="Min"</code> this function puts in the last position of the matrix the bacteria with minimum mean abundance.  If which is equal to a number this function puts in the last position of the matrix the bacteria that is in the &quot;which&quot; row of the <code>especieOriginal</code> matrix.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a list with
</p>

<ul>
<li> <p><code>especie</code> - Matrix that contains at row i the bacterial taxa of bacteria i at time points t=1,2,...,<code>Tt</code> but  the bacteria with with maximum (or minimum) mean abundance (or the bacteria indicated by the user) is placed at the last row.
</p>
</li>
<li> <p><code>especiemodi</code> - Matrix that contains at row i the bacterial taxa of bacteria i at time points t=2,...,<code>Tt</code> but  the bacteria with with maximum (or minimum) mean abundance (or the bacteria indicated by the user) is placed at the last row.
</p>
</li>
<li> <p><code>nombres</code> - Vector with the bacteria's names placed in the order in which appear in the rows of the matrices <code>especie</code> and <code>especiemodi</code>
</p>
</li>
<li> <p><code>EE</code>  -  Row in which the bacterial with maximum (or minimum) mean abundance was (or the value of &quot;which&quot; if which is numerical).
</p>
</li>
<li>  <p><code>EspecieMaxima</code> - Row in which the bacterial with with maximum (or minimum) mean abundance (or the bacteria indicated by the user) is in <code>especie</code>.)
#' #'   </p>
</li>
<li> <p><code>especie.all</code>  - Matrix that contains at row i the bacterial taxa of bacteria i at all time points (t=1,2,...,K) but  the bacteria with with maximum (or minimum) mean abundance (or the bacteria indicated by the user) is placed at the last row.
</p>
</li>
<li>  <p><code>especiemodi.all</code> - Matrix that contains at row i the bacterial taxa of bacteria i at all time points (t=2,...,K) but  the bacteria with with maximum (or minimum) mean abundance (or the bacteria indicated by the user) is placed at the last row.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
names2=c("Bact1","Bact2","Bact3","Bact4","Bact5")
set.seed(314)
esp2=t(gtools::rdirichlet(n=6, c(1,1,5,1,1)))
e2=5

MaxBacteriaPred(names2,esp2[,-c(4,5,6)],e2,3,Pred=4, 6,esp2, "Max")

</code></pre>

<hr>
<h2 id='ObtainigValuePB'>Obtaining the principal balances values</h2><span id='topic+ObtainigValuePB'></span>

<h3>Description</h3>

<p>Calculates the value of the principal balances (Martín-Fernández et al, 2018) at all time points.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ObtainigValuePB(Num, Dem, especie, Tt)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ObtainigValuePB_+3A_num">Num</code></td>
<td>
<p>List. The component i of the list has the number of the row of the matrix <code>especie</code> where the bacteria in the numerator of the principal balance i are placed.</p>
</td></tr>
<tr><td><code id="ObtainigValuePB_+3A_dem">Dem</code></td>
<td>
<p>List. The component i of the list has the number of the row of the matrix <code>especie</code> where the bacteria in the denominator of the principal balance i are placed.</p>
</td></tr>
<tr><td><code id="ObtainigValuePB_+3A_especie">especie</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at all time points.</p>
</td></tr>
<tr><td><code id="ObtainigValuePB_+3A_tt">Tt</code></td>
<td>
<p>Number of time points available</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a matrix where the row i has the value of the principal balance at all time points. The principal balance of the row i has at its numerator the bacteria placed in the rows <code>Num[[i]]</code> of the <code>especie</code>. The principal balance of the row i has at its denominator the bacteria placed in the rows <code>Dem[[i]]</code> of the <code>especie</code>.
</p>


<h3>References</h3>


<ul>
<li><p> Creus-Martí, I., Moya, A., Santonja, F. J. (2022). Bayesian hierarchical compositional models for analysing longitudinal abundance data from microbiome studies. Complexity, 2022.
</p>
</li>
<li><p> Martín-Fernández, J. A., Pawlowsky-Glahn, V., Egozcue, J. J., &amp; Tolosona-Delgado, R. (2018). Advances in principal balances for compositional data. Mathematical Geosciences, 50, 273-298.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
set.seed(314)
esp2=t(gtools::rdirichlet(n=6, c(1,1,5,1,1)))

Num2&lt;-list(3,c(3,5),1,c(3,5,4))
Dem2&lt;-list(5,4,2,c(1,2))

ObtainigValuePB(Num2,Dem2,esp2,6)

</code></pre>

<hr>
<h2 id='ObtainigValueSPBal'>Obtaining the selected principal balances values</h2><span id='topic+ObtainigValueSPBal'></span>

<h3>Description</h3>

<p>Calculates the value of the selected principal balances (SPBal) of the BPBM model at all time points.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ObtainigValueSPBal(Num, Dem, especie, Tt)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ObtainigValueSPBal_+3A_num">Num</code></td>
<td>
<p>List. The component i of the list has the number of the row of the matrix <code>especie</code> where the bacteria in the numerator of the principal balance i are placed.</p>
</td></tr>
<tr><td><code id="ObtainigValueSPBal_+3A_dem">Dem</code></td>
<td>
<p>List. The component i of the list has the number of the row of the matrix <code>especie</code> where the bacteria in the denominator of the principal balance i are placed.</p>
</td></tr>
<tr><td><code id="ObtainigValueSPBal_+3A_especie">especie</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at all time points.</p>
</td></tr>
<tr><td><code id="ObtainigValueSPBal_+3A_tt">Tt</code></td>
<td>
<p>Number of time points available</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a list with:
</p>

<ul>
<li><p> NumSPBal:  List. The component i of the list has the number of the row of the matrix <code>especie</code> where the bacteria in the numerator of the selected  principal balance i are placed.
</p>
</li>
<li><p> DemSPBal:  List. The component i of the list has the number of the row of the matrix <code>especie</code> where the bacteria in the denominator of the selected  principal balance i are placed.
</p>
</li>
<li><p> MatrixSPBal:  MatrixSPBal is the matrix that contains the covariates of the model. The first line es equal to 1 for all columns. The other rows contain the value of one SPBal at all time points. The selected principal balance of the row i+1 has at its numerator the bacteria placed in the rows <code>NumSPBal[[i]]</code> of the &quot;especie&quot;. The selected principal balance of the row i+1 has at its denominator the bacteria placed in the rows <code>DemSPBal[[i]]</code> of the &quot;especie&quot;.
</p>
</li>
<li><p> PercenVarianceSPBal: Vector. The component of the vector i contains the percentage of variance of the SPBal with numerator <code>NumSPBal[[i]]</code> and denominator <code>DemSPBal[[i]]</code>.
</p>
</li></ul>



<h3>References</h3>

<p>Creus-Martí, I., Moya, A., Santonja, F. J. (2022). Bayesian hierarchical compositional models for analysing longitudinal abundance data from microbiome studies. Complexity, 2022.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
set.seed(314)
esp2=t(gtools::rdirichlet(n=6, c(1,1,5,1,1)))

Num2&lt;-list(3,c(3,5),1,c(3,5,4))
Dem2&lt;-list(5,4,2,c(1,2))

ObtainigValueSPBal(Num2,Dem2,esp2,6)

</code></pre>

<hr>
<h2 id='ObtainingDIC'>Writting the loglikelihood of the dirichlet</h2><span id='topic+ObtainingDIC'></span>

<h3>Description</h3>

<p>This function calculates the loglikelihood of the dirichlet for the BPBM model. Then, it calculates the loglikelihood with the parameters of each iteration of the MCMC chains and introduces the values in a vector called vectorD. DIC=(1/2)*var(vectorD)+mean(VectorD)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ObtainingDIC(cadenas, MatrizPBmodelo, E, Tt, especiemodi)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ObtainingDIC_+3A_cadenas">cadenas</code></td>
<td>
<p>Matrix with the iterations (in rows) of all the Markov Chains obtained in th estimation. It is the output of &quot;StudyingParam&quot; adding &quot;$AllChainsJoined&quot;.</p>
</td></tr>
<tr><td><code id="ObtainingDIC_+3A_matrizpbmodelo">MatrizPBmodelo</code></td>
<td>
<p>Matrix with the covariates of the model. In an example with two SPBal and three time points, the covariates are written in the following  order:
</p>

<table>
<tr>
 <td style="text-align: right;">
 1 </td><td style="text-align: right;">  1  </td><td style="text-align: right;">  1</td>
</tr>
<tr>
 <td style="text-align: right;">
<code class="reqn"> SPBal_{1,t-1}</code> </td><td style="text-align: right;">  <code class="reqn">SPBal_{1,t-2}</code> </td><td style="text-align: right;">   <code class="reqn">SPBal_{1,t-3}</code> </td>
</tr>
<tr>
 <td style="text-align: right;">
 <code class="reqn">SPBal_{2,t-1}</code> </td><td style="text-align: right;">  <code class="reqn">SPBal_{2,t-2}</code> </td><td style="text-align: right;">   <code class="reqn">SPBal_{2,t-3}</code> </td>
</tr>

</table>
</td></tr>
<tr><td><code id="ObtainingDIC_+3A_e">E</code></td>
<td>
<p>Number f bacteria in the dataset.</p>
</td></tr>
<tr><td><code id="ObtainingDIC_+3A_tt">Tt</code></td>
<td>
<p>Number of time points available</p>
</td></tr>
<tr><td><code id="ObtainingDIC_+3A_especiemodi">especiemodi</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at time points t=2,...,<code>Tt</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a data.frame with the DIC value (using the rule, pD = var/2).
</p>


<h3>References</h3>

<p>Creus-Martí, I., Moya, A., Santonja, F. J. (2022). Bayesian hierarchical compositional models for analysing longitudinal abundance data from microbiome studies. Complexity, 2022.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

set.seed(314)
especie=t(gtools::rdirichlet(n=2, c(1,2,3)))
E=3
Tt=2
MatrizPBmodelo=rbind(c(1,1),c(-0.3,0.4),c(0.3,0.5))
set.seed(314)
est=Estimating_BPBM(especie,
                   Tt,
                   E,
                   MatrizPBmodelo,
                   nn.chain=3,
                   nn.burnin=1000,
                   nn.sample=5000,
                   nn.thin=10)
SumFinal=StudyingParam(est$R2jagsOutput$BUGSoutput$summary   ,est$SamplesAllChains)
cadenas=SumFinal$AllChainsJoined
especiemodi=especie[,-1]

ObtainingDIC(cadenas,MatrizPBmodelo,E,Tt,especiemodi)
</code></pre>

<hr>
<h2 id='PBalance'>Calculating balances</h2><span id='topic+PBalance'></span>

<h3>Description</h3>

<p>This function calculates the balance that has at the numerator the bacteria placed at <code>Num</code> and has at the denominator the bacteria placed at <code>Dem</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PBalance(A, Num, Dem, especie)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PBalance_+3A_a">A</code></td>
<td>
<p>Number. The balance will be calculated for t=1,2,...,<code>A</code> time points.</p>
</td></tr>
<tr><td><code id="PBalance_+3A_num">Num</code></td>
<td>
<p>vector that contains the position in the matrix <code>especies</code> of the families that  we position at the numerator of the balance.</p>
</td></tr>
<tr><td><code id="PBalance_+3A_dem">Dem</code></td>
<td>
<p>vector that contains the position in the matrix <code>especies</code> of the families that  we position at the denumerator of the balance</p>
</td></tr>
<tr><td><code id="PBalance_+3A_especie">especie</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at all time points.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a vector with the value of the balance in each time point.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
especie1=cbind(c(0.5,0.3,0.1,0.1), c(0.1,0.3,0.6,0.1))
Num=c(1,2)
Dem=c(3,4)
A=2
PBalance(A,Num,Dem,especie1)

</code></pre>

<hr>
<h2 id='PBalancePredi'>Calculating balances for a composition</h2><span id='topic+PBalancePredi'></span>

<h3>Description</h3>

<p>This function calculates the balance that has at the numerator de bacteria placed at <code>Num</code> and has at the denominator the bacteria placed at <code>Dem</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PBalancePredi(Num, Dem, DatosEsperanzas)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PBalancePredi_+3A_num">Num</code></td>
<td>
<p>vector that contains the position in the matrix <code>especies</code> of the families that  we position at the numerator of the balance.</p>
</td></tr>
<tr><td><code id="PBalancePredi_+3A_dem">Dem</code></td>
<td>
<p>vector that contains the position in the matrix <code>especies</code> of the families that  we position at the denumerator of the balance</p>
</td></tr>
<tr><td><code id="PBalancePredi_+3A_datosesperanzas">DatosEsperanzas</code></td>
<td>
<p>Vector with a coda composition. The bacteria are in the same orden than the matrix <code>especie</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns the value of the balance
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
Num=c(1,2)
Dem=c(3,4)
DatosEsperanzas=c(0.1,0.3,0.4,0.2)

PBalancePredi(Num,Dem,DatosEsperanzas)

</code></pre>

<hr>
<h2 id='PBmodel'>Obtaining the regression value of the BPBM</h2><span id='topic+PBmodel'></span>

<h3>Description</h3>

<p>This function calculates the value of the BPBM regression, defined by:  </p>
<p style="text-align: center;"><code class="reqn">\mu_{it}=a_{i0}+a_{i1}\cdot\text{SPBal}_{1,t-1}+\cdots+a_{iM}\cdot\text{SPBal}_{M,t-1}</code>
</p>



<h3>Usage</h3>

<pre><code class='language-R'>PBmodel(A, MatrizPBmodelo, E, Tt)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PBmodel_+3A_a">A</code></td>
<td>
<p>Matrix that contains all the parameters of the model. The parameters are written in the matrix in the following order (in an example with three bacteria):
</p>

<table>
<tr>
 <td style="text-align: right;">
 a10 </td><td style="text-align: right;">  a11  </td><td style="text-align: right;">  a12</td><td style="text-align: right;"> ...</td><td style="text-align: right;">  a1M </td>
</tr>
<tr>
 <td style="text-align: right;">
 a20 </td><td style="text-align: right;">  a21  </td><td style="text-align: right;">  a22</td><td style="text-align: right;"> ...</td><td style="text-align: right;">  a2M </td>
</tr>
<tr>
 <td style="text-align: right;">
 a30 </td><td style="text-align: right;">  a31  </td><td style="text-align: right;">  a32</td><td style="text-align: right;"> ...</td><td style="text-align: right;">  a3M</td>
</tr>

</table>
</td></tr>
<tr><td><code id="PBmodel_+3A_matrizpbmodelo">MatrizPBmodelo</code></td>
<td>
<p>Matrix. Output of &quot;ObtainingValueSPBal&quot; called &quot;MatrixSPBal&quot;.</p>
</td></tr>
<tr><td><code id="PBmodel_+3A_e">E</code></td>
<td>
<p>Number of bacteria in the dataset.</p>
</td></tr>
<tr><td><code id="PBmodel_+3A_tt">Tt</code></td>
<td>
<p>Number of time points.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a matrix. The row i contains the regression values of the bacteria i at all time points.
</p>


<h3>References</h3>

<p>Creus-Martí, I., Moya, A., Santonja, F. J. (2022). Bayesian hierarchical compositional models for analysing longitudinal abundance data from microbiome studies. Complexity, 2022.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
A=rbind(c(1,2,3),c(4,5,6),c(7,8,9))
MatrizPBmodelo=cbind(c(1,2,3),c(4,5,6),c(7,8,9))
E=3
Tt=3


PBmodel(A,MatrizPBmodelo, E,Tt)
</code></pre>

<hr>
<h2 id='PCAbiplot'>PCA of the estimated parameters</h2><span id='topic+PCAbiplot'></span>

<h3>Description</h3>

<p>This function applys a PCA to the estimate parameters (using function &quot;prcomp&quot; with <code>center = TRUE</code> and <code>scale. = TRUE</code>). Then uses the ggbiplot function to plot the biplot.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PCAbiplot(paramEstimadosFinal, names, E)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PCAbiplot_+3A_paramestimadosfinal">paramEstimadosFinal</code></td>
<td>
<p>The estimate parameters, in the following order: a11,a12,a13, a21, a22,a23, ...a(D-1)1,a(D-1)2,a(D-1)3,tau. Where D is the number of bacterial especies present in the matrix <code>especie</code>.</p>
</td></tr>
<tr><td><code id="PCAbiplot_+3A_names">names</code></td>
<td>
<p>Vector with the name of the bacteria. The component i has the name of the bacteria i, with i=1,...,D. The bacteria in the las position of the vector is the bacteria used as reference in the alr transformation.</p>
</td></tr>
<tr><td><code id="PCAbiplot_+3A_e">E</code></td>
<td>
<p>Number of bacteria available.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a list with the PCA biplot, the variance explained of each Principal Component and an object of class &quot;prcomp&quot; with the PCA. In the biplot, &quot;a&quot; denotes the intercept, &quot;b&quot; denotes the parameter that give information about the importance of the bacteria in defining herself in  the next time point and &quot;c&quot; denotes denotes the parameter that give information about the importance of the rest of the community in defining the bacteria in  the next time point.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
set.seed(123)
especie=t(gtools::rdirichlet(10,c(1,3,1,2,4)))
names=c("Bact1","Bact2","Bact3","Bact4","Bact5")
tau1=0.4
parms1= cbind(c(0.1,0.2,0.4,0.6),c(-0.2,0.1,0.1,0.3),c(0.3,0.2,0.3,0.5))
paramEstimadosFinal=c(as.vector( t(parms1)),tau1)

PCAbiplot(paramEstimadosFinal,names,5)

</code></pre>

<hr>
<h2 id='Percen_Variance'>Percentage of variance</h2><span id='topic+Percen_Variance'></span>

<h3>Description</h3>

<p>This function calculates the variance of each row of the matrix <code>PB</code>. Returns the percentage of variance of each row of the matrix <code>PB</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Percen_Variance(PB)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Percen_Variance_+3A_pb">PB</code></td>
<td>
<p>Matrix.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a vector with  percentage of variance of each row of the matrix <code>PB</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
matt=matrix(c(1:4),2,2)


Percen_Variance(matt)

</code></pre>

<hr>
<h2 id='PlotDendogram'>Plotting a dendogram</h2><span id='topic+PlotDendogram'></span>

<h3>Description</h3>

<p>Plots the dendogram obtained using the  Ward’s method for obtaining the principal balances. The process follow in this function is explained  in Section 3.1 of (Creus-Martí et al, 2022)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PlotDendogram(especie, names)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PlotDendogram_+3A_especie">especie</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at all time points.</p>
</td></tr>
<tr><td><code id="PlotDendogram_+3A_names">names</code></td>
<td>
<p>Vector with the names of the bacteria in the same order that are written in <code>especie</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a list with: the dendogram.
</p>

<ul>
<li><p> Num: List. The component i of the list has the number of the row of the matrix <code>especie</code> where the bacteria in the numerator of the principal balance i are placed.
</p>
</li>
<li><p> Dem:  List. The component i of the list has the number of the row of the matrix <code>especie</code> where the bacteria in the denominator of the principal balance i are placed.
</p>
</li>
<li><p> dendogram:  Plots the dendogram.
</p>
</li></ul>



<h3>References</h3>

<p>Creus-Martí, I., Moya, A., Santonja, F. J. (2022). Bayesian hierarchical compositional models for analysing longitudinal abundance data from microbiome studies. Complexity, 2022.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
names2=c("Bact1","Bact2","Bact3","Bact4","Bact5")
set.seed(314)
esp2=t(gtools::rdirichlet(n=6, c(1,1,5,1,1)))


PlotDendogram(esp2,names2)

</code></pre>

<hr>
<h2 id='PredictionBPBM'>Predicting using BPBM</h2><span id='topic+PredictionBPBM'></span>

<h3>Description</h3>

<p>This function calculates the expected value and variance of the bacteria at time point <code>Tt</code>. Then, this function calculates the expected value and variance of the bacteria at time point t=(<code>Tt</code>+1),...,K. It calculates the expected value at each time point for each markov chain iteration. The expected value for each time point is the mean of the expected values of all iterations.mAnalogous with the variance, the dirichlet parameters and the expected valur plus(and minus) two times the sqrt of the variance.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PredictionBPBM(
  NumSPBal,
  DemSPBal,
  MCMC.CHAINS,
  alpha,
  K,
  esperanza,
  Var,
  E,
  Tt,
  MatrizPBmodelo
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PredictionBPBM_+3A_numspbal">NumSPBal</code></td>
<td>
<p>List. The component i of the list has the number of the row of the matrix <code>especie</code> where the bacteria in the numerator of the principal balance i are placed.</p>
</td></tr>
<tr><td><code id="PredictionBPBM_+3A_demspbal">DemSPBal</code></td>
<td>
<p>List. The component i of the list has the number of the row of the matrix <code>especie</code> where the bacteria in the denominator of the principal balance i are placed.</p>
</td></tr>
<tr><td><code id="PredictionBPBM_+3A_mcmc.chains">MCMC.CHAINS</code></td>
<td>
<p>Matrix with the iterations of all the chains for all the parameters. Each column has all the iteration of one parameter. If the cero is in the center of the credible interval of one parameter all its iteration in the Marchov Chain have the value 0. It is output of the &quot;StudyingParam&quot; function adding &quot;$AllChainsJoined&quot;.</p>
</td></tr>
<tr><td><code id="PredictionBPBM_+3A_alpha">alpha</code></td>
<td>
<p>Matrix that contains at the row i the Dirichlet parameter of the bacteria i at t=1,2,3,...,<code>Tt</code>.</p>
</td></tr>
<tr><td><code id="PredictionBPBM_+3A_k">K</code></td>
<td>
<p>Number. The function will calculate the value of the expected value and the variance at <code>Tt</code> and predict for the time points t=<code>Tt</code>+1,..,K. To predict all the time points available at the data we K=dim(especie.All)-1</p>
</td></tr>
<tr><td><code id="PredictionBPBM_+3A_esperanza">esperanza</code></td>
<td>
<p>Matrix that contains at row i the expected value of the bacterial taxa of bacteria i at t=1,2,3,...,<code>Tt</code>-1.</p>
</td></tr>
<tr><td><code id="PredictionBPBM_+3A_var">Var</code></td>
<td>
<p>Matrix that contains at row i the variance of the bacterial taxa of bacteria i at t=1,2,3,...,<code>Tt</code>-1.</p>
</td></tr>
<tr><td><code id="PredictionBPBM_+3A_e">E</code></td>
<td>
<p>Number of bacteria available</p>
</td></tr>
<tr><td><code id="PredictionBPBM_+3A_tt">Tt</code></td>
<td>
<p>Number of bacteria available</p>
</td></tr>
<tr><td><code id="PredictionBPBM_+3A_matrizpbmodelo">MatrizPBmodelo</code></td>
<td>
<p>is the matrix that contains the covariates of the model. The first line es equal to 1 for all columns. The other rows contain the value of one SPBal at all time points. The selected principal balance of the row i+1 has at its numerator the bacteria placed in the rows <code>NumSPBal[[i]]</code> of the &quot;especie&quot;. The selected principal balance of the row i+1 has at its denominator the bacteria placed in the rows <code>DemSPBal[[i]]</code> of the &quot;especie&quot;.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a list with:
</p>

<ul>
<li><p> ExpectedValue.All:  Matrix. Matrix that contains at row i the expected value of the bacteria i at all time points t=1,2,...,K. The bacterias are placed at the same order than in <code>especies</code>.
</p>
</li>
<li><p> VarianceValue.All:  Matrix. Matrix that contains at row i the variance of the bacteria i at all time points t=1,2,...,K. The bacterias are placed at the same order than in <code>especies</code>.
</p>
</li>
<li><p> DirichlerParam.All: Matrix.   Matrix that contains at row i the dirichlet parameter of the bacteria i at all time points t=1,2,...,K. The bacterias are placed at the same order than in <code>especies</code>.
</p>
</li>
<li><p> ExpVarmas:  Matrix. Matrix that contains at row i the expected value plus two times the sqrt(variance) of the bacteria i at all time points t=<code>Tt</code>,...,K, the rest of the time points has 0 values. The bacterias are placed at the same order than in <code>especies</code>.
</p>
</li>
<li><p> ExpVarmenos:  Matrix. Matrix that contains at row i the expected value plus two times the sqrt(variance) of the bacteria i at all time points t=<code>Tt</code>,...,K,the rest of the time points has 0 values. The bacterias are placed at the same order than in <code>especies</code>.
</p>
</li></ul>



<h3>References</h3>

<p>Creus-Martí, I., Moya, A., Santonja, F. J. (2022). Bayesian hierarchical compositional models for analysing longitudinal abundance data from microbiome studies. Complexity, 2022.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
NumSPBal=list(1,c(1,2))
DemSPBal=list(2,3)
MCMC.CHAINS=cbind(c(0.1,0.11),
                 c(0.2,0.21),
                 c(0.3,0.31),
                 c(-0.1,-0.11),
                 c(0.15,0.105),
                 c(0.44,0.41),
                 c(0.3,0.31),
                 c(0.201,0.221),
                 c(0.13,0.113) )
alpha=cbind(c(0.1,0.2,0.1),c(0.1,0.5,0.3))
K=3
esperanza=cbind(c(0.2,0.2,0.6))
Var=cbind(c(0.1,0.01,0.11))
E=3
Tt=2
MatrizPBmodelo=cbind(c(1,0.3,0.2))

PredictionBPBM(NumSPBal,DemSPBal,MCMC.CHAINS, alpha,K,esperanza,Var,E,Tt,MatrizPBmodelo )

</code></pre>

<hr>
<h2 id='PredictionEstParmFunc'>Predicting using dirichl-gLV</h2><span id='topic+PredictionEstParmFunc'></span>

<h3>Description</h3>

<p>This function calculates the expected value and variance of the bacteria at time point <code>Tt</code>. Then, this function calculates the expected value and variance of the bacteria at time point t=(<code>Tt</code>+1),...,K
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PredictionEstParmFunc(
  paramEstimadosFinal,
  EspecieMaxima,
  alpha,
  K,
  esperanza,
  Var,
  E,
  Tt
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PredictionEstParmFunc_+3A_paramestimadosfinal">paramEstimadosFinal</code></td>
<td>
<p>The estimate parameters. Vector equal to <code>c(tau,as.vector( pam))</code> where:
</p>

<ul>
<li><p> pam  Matrix. Each row has the parameters of each bacteria. Following our example, pam has the parameters placed as follows:
</p>

<table>
<tr>
 <td style="text-align: right;">
 r1 </td><td style="text-align: right;">  a11  </td><td style="text-align: right;">  a12</td>
</tr>
<tr>
 <td style="text-align: right;">
 r2 </td><td style="text-align: right;">  a21 </td><td style="text-align: right;">   a22 </td>
</tr>

</table>

</li>
<li><p> tau  Number. Value of the tau parameter in the model
</p>
</li></ul>
</td></tr>
<tr><td><code id="PredictionEstParmFunc_+3A_especiemaxima">EspecieMaxima</code></td>
<td>
<p>Row in which the bacteria chosen as reference is in <code>especie</code>.This bacteria is used as reference in the alr transformation that the model does.</p>
</td></tr>
<tr><td><code id="PredictionEstParmFunc_+3A_alpha">alpha</code></td>
<td>
<p>Matrix that contains at the row i the dirichlet parameter of the bacteria i at t=1,2,3,...,<code>Tt</code>.</p>
</td></tr>
<tr><td><code id="PredictionEstParmFunc_+3A_k">K</code></td>
<td>
<p>Number. The function will calculate the value of the expected value and the variance at <code>Tt</code> and predict for the time points t=<code>Tt</code>+1,..,K. To predict all the time points available at the data we K=dim(especie.All)-1</p>
</td></tr>
<tr><td><code id="PredictionEstParmFunc_+3A_esperanza">esperanza</code></td>
<td>
<p>Matrix that contains at row i the expected value of the bacterial taxa of bacteria i at t=1,2,3,...,<code>Tt</code>-1.</p>
</td></tr>
<tr><td><code id="PredictionEstParmFunc_+3A_var">Var</code></td>
<td>
<p>Matrix that contains at row i the variance of the bacterial taxa of bacteria i at t=1,2,3,...,<code>Tt</code>-1.</p>
</td></tr>
<tr><td><code id="PredictionEstParmFunc_+3A_e">E</code></td>
<td>
<p>Number of bacteria available</p>
</td></tr>
<tr><td><code id="PredictionEstParmFunc_+3A_tt">Tt</code></td>
<td>
<p>Number of time points available</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The regression of this model, in an example with three bacteria, is defined by
</p>
<p style="text-align: center;"><code class="reqn">r_{1}\cdot log(x_{1}(t)/x_{3}(t))+log(x_{1}(t)/x_{3}(t))\cdot [a_{11}\cdot log(x_{1}(t)/x_{3}(t))(t)+a_{12}\cdot log(x_{2}(t)/x_{3}(t))] </code>
</p>

<p style="text-align: center;"><code class="reqn">r_{2}\cdot log(x_{2}(t)/x_{3}(t))+log(x_{2}(t)/x_{3}(t))\cdot [a_{21}\cdot log(x_{1}(t)/x_{3}(t))(t)+a_{22}\cdot log(x_{2}(t)/x_{3}(t))] </code>
</p>



<h3>Value</h3>

<p>Returns a list with:
</p>

<ul>
<li><p> ExpectedValue.All:  Matrix. Matrix that contains at row i the expected value of the bacteria i at all time points t=2,...,K. The bacteria are placed at the same order than in <code>especies</code>.
</p>
</li>
<li><p> VarianceValue.All:  Matrix. Matrix that contains at row i the variance of the bacteria i at all time points t=2,...,K. The bacteria are placed at the same order than in <code>especies</code>.
</p>
</li>
<li><p> DirichlerParam.All:  Matrix. Matrix that contains at row i the dirichlet parameter of the bacteria i at all time points t=2,...,K. The bacteria are placed at the same order than in <code>especies</code>.
</p>
</li></ul>



<h3>References</h3>

<p>Creus-Martí, I. and Moya, A. and Santonja, F. J. (2018). A Statistical Model with a Lotka-Volterra Structure for Microbiota Data. Lucas Jodar, Juan Carlos Cortes and Luis Acedo,  Modelling or engineering and human behavior 2018, Instituto Universitario de Matematica Multidisciplinar. ISBN: 978-84-09-07541-6
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
pam.ini=rbind(c(0.1,0.2,0.3),c(0.4,0.5,0.6))
paramEstimadosFinal=c(5, as.vector(pam.ini))
EspecieMaxima=3
alpha=cbind(c(2,2,3),c(1,1,3))
K=3
esperanza=cbind(c(0.2,0.3,0.5))
Var=cbind(c(0.2,0.3,0.5))
E=3
Tt=2

PredictionEstParmFunc(paramEstimadosFinal,EspecieMaxima, alpha,K,esperanza,Var,E,Tt )

</code></pre>

<hr>
<h2 id='PredictionFBM'>Predicting using FBM</h2><span id='topic+PredictionFBM'></span>

<h3>Description</h3>

<p>This function calculates the expected value and variance of the bacteria at time point <code>Tt</code>. Then, this function calculates the expected value and variance of the bacteria at time point t=(<code>Tt</code>+1),...,K
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PredictionFBM(
  paramEstimadosFinal,
  EspecieMaxima,
  alpha,
  K,
  esperanza,
  Var,
  E,
  Tt
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PredictionFBM_+3A_paramestimadosfinal">paramEstimadosFinal</code></td>
<td>
<p>The estimate parameters, in the following order: a11,a12,a13, a21, a22,a23, ...a(D-1)1,a(D-1)2,a(D-1)3,tau. Where D is the number of bacterial species present in the matrix <code>especie</code>.</p>
</td></tr>
<tr><td><code id="PredictionFBM_+3A_especiemaxima">EspecieMaxima</code></td>
<td>
<p>Row in which the bacteria chosen as reference is in <code>especie</code>.This bacteria is used as reference in the alr transformation that the model does and it is placed at the denominator of the balance)</p>
</td></tr>
<tr><td><code id="PredictionFBM_+3A_alpha">alpha</code></td>
<td>
<p>Matrix that contains at the row i the Dirichlet parameter of the bacteria i at t=1,2,3,...,<code>Tt</code>.</p>
</td></tr>
<tr><td><code id="PredictionFBM_+3A_k">K</code></td>
<td>
<p>Number. The function will calculate the value of the expected value and the variance at <code>Tt</code> and predict for the time points t=<code>Tt</code>+1,..,K. To predict all the time points available at the data we K=dim(especie.All)-1</p>
</td></tr>
<tr><td><code id="PredictionFBM_+3A_esperanza">esperanza</code></td>
<td>
<p>Matrix that contains at row i the expected value of the bacterial taxa of bacteria i at t=1,2,3,...,<code>Tt</code>-1.</p>
</td></tr>
<tr><td><code id="PredictionFBM_+3A_var">Var</code></td>
<td>
<p>Matrix that contains at row i the variance of the bacterial taxa of bacteria i at t=1,2,3,...,<code>Tt</code>-1.</p>
</td></tr>
<tr><td><code id="PredictionFBM_+3A_e">E</code></td>
<td>
<p>Number of bacteria available</p>
</td></tr>
<tr><td><code id="PredictionFBM_+3A_tt">Tt</code></td>
<td>
<p>Number of bacteria available</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The regression of this model is defined by
</p>
<p style="text-align: center;"><code class="reqn">\mu_{it}=a_{i1}+a_{i2}\cdot\text{alr}(x_{i,(t-1)})+a_{i3}\cdot\text{Balance}(x_{i,(t-1)})\text{ for }i=1,\dots, D-1\text{ where } D \text{ is the number of bacteria}</code>
</p>



<h3>Value</h3>

<p>Returns a list with:
</p>

<ul>
<li><p> ExpectedValue.All:  Matrix. Matrix that contains at row i the expected value of the bacteria i at all time points t=1,2,...,K. The bacteria are placed at the same order than in <code>especies</code>.
</p>
</li>
<li><p> VarianceValue.All:  Matrix. Matrix that contains at row i the variance of the bacteria i at all time points t=1,2,...,K. The bacteria are placed at the same order than in <code>especies</code>.
</p>
</li>
<li><p> DirichlerParam.All: Matrix.   Matrix that contains at row i the dirichlet parameter of the bacteria i at all time points t=1,2,...,K. The bacteria are placed at the same order than in <code>especies</code>.
</p>
</li></ul>



<h3>References</h3>

<p>Creus-Martí, I., Moya, A., Santonja, F. J. (2021). A Dirichlet autoregressive model for the analysis of microbiota time-series data. Complexity, 2021, 1-16.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
Tt=2
E=3
tau=5
EspecieMaxima=3
K=3
parms11=c(0.1,0.2,0.3,0.4,0.5,0.6,tau)
alpha=cbind(c(1.726793,1.892901,1.380306),
           c(1,1,3))
Expected=cbind(c(alpha[1,1]/tau, alpha[2,1]/tau, alpha[3,1]/tau  ),
              c(alpha[1,2]/tau,alpha[2,2]/tau,alpha[3,2]/tau))
Variance=cbind(c(0.03768101, 0.03920954, 0.03330857 ),
              c( 0.03683242,0.02784883, 0.0413761 ))
Expected.final=Expected[,-2]
Variance.final=Variance[,-2]

PredictionFBM(parms11,EspecieMaxima, alpha,K,Expected.final,Variance.final,E,Tt )

</code></pre>

<hr>
<h2 id='PreparingTheData'>Preparing dataset</h2><span id='topic+PreparingTheData'></span>

<h3>Description</h3>

<p>Preparing the dataset to be introduce in the models' functions. In order to introduce the usage of the package there is a README file. You can find the link to the file using <code>base::system.file("extdata", "README.pdf", package = "CoDaLoMic")</code>. On windows you can open the file with <code>base::shell.exec(system.file("extdata", "README.pdf", package = "CoDaLoMic"))</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PreparingTheData(DaTa, Pred)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PreparingTheData_+3A_data">DaTa</code></td>
<td>
<p>data.frame. The first column contains the time point information (natural numbers 1,2,3...). The rest of the columns contain the relative abundance of each bacteria at the different time points. The values of each column must sum 1.</p>
</td></tr>
<tr><td><code id="PreparingTheData_+3A_pred">Pred</code></td>
<td>
<p>Number. The data at t=1,...,Pred-1 will be used to estimate the model. The rest of the time points will be used to study the capacity of the model to predict. If <code>Pred==0</code> all the datatset will be used to estimate the model.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If <code>Pred==0</code> returns a list with
</p>

<ul>
<li> <p><code>Tt</code> - The number of time points available.
</p>
</li>
<li> <p><code>E</code> - Number of bacteria available
</p>
</li>
<li> <p><code>especieOriginal</code> - Matrix that contains at row i the bacterial taxa of bacteria i at all time points.
</p>
</li>
<li> <p><code>especiemodiOriginal</code> - Matrix that contains at row i the bacterial taxa of bacteria i at time points t=2,...,<code>Tt</code>.
</p>
</li></ul>

<p>If <code>Pred!=0</code> returns a list with
</p>

<ul>
<li> <p><code>Tt</code> - The number of time points available used to estimate the model (<code>Tt</code>=Pred-1).
</p>
</li>
<li> <p><code>E</code> - Number of bacteria available
</p>
</li>
<li> <p><code>especieOriginal</code> - Matrix that contains at row i the bacterial taxa of bacteria i at the time points t=1,2,...,Pred-1.
</p>
</li>
<li> <p><code>especiemodiOriginal</code> - Matrix that contains at row i the bacterial taxa of bacteria i at time points t=2,...,Pred-1.
</p>
</li>
<li> <p><code>especieOriginal.All</code> - Matrix that contains at row i the bacterial taxa of bacteria i at the time points.
</p>
</li>
<li> <p><code>especiemodiOriginal.All</code> - Matrix that contains at row i the bacterial taxa of bacteria i at time points.
</p>
</li>
<li> <p><code>K</code> - Number of time points available at the dataset.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>

df&lt;-data.frame(cbind(c(1,2,3),
                     c(0.5,0.2,0.3),
                     c(0.2,0.1,0.6),
                     c(0.1,0.1,0.8),
                     c(0.3,0.3,0.4)))
PreparingTheData(df,Pred=0)

df2&lt;-data.frame(cbind(c(1,2,3,4,5),
                      c(0.1,0.1,0.1,0.2,0.5),
                      c(0.2,0.2,0.2,0.2,0.2),
                      c(0.2,0.3,0.1,0.2,0.2)))
PreparingTheData(df2,Pred=4)
</code></pre>

<hr>
<h2 id='QualityControl'>Analysing the quality of the estimation</h2><span id='topic+QualityControl'></span>

<h3>Description</h3>

<p>This function calculates the  root-mean-square deviation (RMSD), the Nash Sutchiffe Coefficient, the residual sum of squares (RSS) and the mean absolute percentage error (MAPE) for the matrices introduces. This function also calculates the mean of the RMSD, the mean of the Nash Sutchiffe Coefficient  and the mean of the RSS.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>QualityControl(matrixData, matrixExpected, names.especie)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="QualityControl_+3A_matrixdata">matrixData</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at the time points that we want take into account to calculate the quality control values.</p>
</td></tr>
<tr><td><code id="QualityControl_+3A_matrixexpected">matrixExpected</code></td>
<td>
<p>Matrix that contains at row i the expected value of the bacterial taxa i at the time points that we want take into account to calculate the quality control values. The bacteria must be placed in the same order than in <code>matrixData</code></p>
</td></tr>
<tr><td><code id="QualityControl_+3A_names.especie">names.especie</code></td>
<td>
<p>Vector with the names of the bacteria in the same order that are placed in the <code>matrixData</code> matrix.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a data.frame.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

names.especie=c("Bact1", "Bact2", "Bact3")
matrixExpected=matrix(c(1:9),3,3)
matrixData=matrixExpected+0.1

QualityControl(matrixData, matrixExpected,names.especie)


</code></pre>

<hr>
<h2 id='ridgeregression'>Ridge regression</h2><span id='topic+ridgeregression'></span>

<h3>Description</h3>

<p>Ridge regression
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ridgeregression(Tt, especie, E, EspecieMaxima, seed = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ridgeregression_+3A_tt">Tt</code></td>
<td>
<p>Number of time points available</p>
</td></tr>
<tr><td><code id="ridgeregression_+3A_especie">especie</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at all time points. The bacteria placed in the last row of the matrix will be used as reference in the alr transformation and will be at the denominator of the balance.</p>
</td></tr>
<tr><td><code id="ridgeregression_+3A_e">E</code></td>
<td>
<p>Number of bacteria available.</p>
</td></tr>
<tr><td><code id="ridgeregression_+3A_especiemaxima">EspecieMaxima</code></td>
<td>
<p>Row in which the bacteria used as reference is in <code>especie</code>. This is the bacteria that is going to be at the denominator of the balance and the denominator of the alr transformation. As a result, in this function, <code>EspecieMaxima</code> must be equal to <code>E</code></p>
</td></tr>
<tr><td><code id="ridgeregression_+3A_seed">seed</code></td>
<td>
<p>Number. Set a seed. Default <code>seed=NULL</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns the result of the ridge regression, object of class &quot;ridgelm&quot;.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

set.seed(123)
especie=t(gtools::rdirichlet(10,c(1,3,1,2,4)))
Tt=10
E=5
EspecieMaxima=5

ridgeregression(Tt,especie, E, EspecieMaxima, 558562316)


</code></pre>

<hr>
<h2 id='rxnrate'>Solving the right side of the gLV equations</h2><span id='topic+rxnrate'></span>

<h3>Description</h3>

<p>This function calculates the right side of the gLV equation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rxnrate(State, parms)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rxnrate_+3A_state">State</code></td>
<td>
<p>Vector with a CoDa composition</p>
</td></tr>
<tr><td><code id="rxnrate_+3A_parms">parms</code></td>
<td>
<p>Matrix. Each row has the parameters of each differential equation. following our example, parms has the parameters placed as follows:
</p>

<table>
<tr>
 <td style="text-align: right;">
 r1 </td><td style="text-align: right;">  a11  </td><td style="text-align: right;">  a12 </td><td style="text-align: right;">   a13 </td>
</tr>
<tr>
 <td style="text-align: right;">
 r2 </td><td style="text-align: right;">  a21 </td><td style="text-align: right;">   a22 </td><td style="text-align: right;">  a23 </td>
</tr>
<tr>
 <td style="text-align: right;">
 r3 </td><td style="text-align: right;">  a31  </td><td style="text-align: right;">  a32 </td><td style="text-align: right;">  a33</td>
</tr>

</table>
</td></tr>
</table>


<h3>Details</h3>

<p>For instance, if we want to solve the following gLV equations:
</p>
<p style="text-align: center;"><code class="reqn">\frac{dx_{1}(t)}{dt}=r_{1}\cdot x_{1}(t)+x_{1}(t)\cdot[a_{11}\cdot x_{1}(t)+a_{12}\cdot x_{2}(t)+a_{13}\cdot x_{3}(t)]</code>
</p>

<p style="text-align: center;"><code class="reqn">\frac{dx_{2}(t)}{dt}=r_{2}\cdot x_{2}(t)+x_{2}(t)\cdot[a_{21}\cdot x_{1}(t)+a_{22}\cdot x_{2}(t)+a_{23}\cdot x_{3}(t)]</code>
</p>

<p style="text-align: center;"><code class="reqn">\frac{dx_{3}(t)}{dt}=r_{3}\cdot x_{3}(t)+x_{3}(t)\cdot[a_{31}\cdot x_{1}(t)+a_{32}\cdot x_{2}(t)+a_{33}\cdot x_{3}(t)]</code>
</p>

<p>This function returns a vector with the value of:
</p>
<p style="text-align: center;"><code class="reqn">r_{1}\cdot x_{1}(t)+x_{1}(t)\cdot[a_{11}\cdot x_{1}(t)+a_{12}\cdot x_{2}(t)+a_{13}\cdot x_{3}(t)]</code>
</p>

<p style="text-align: center;"><code class="reqn">r_{2}\cdot x_{2}(t)+x_{2}(t)\cdot[a_{21}\cdot x_{1}(t)+a_{22}\cdot x_{2}(t)+a_{23}\cdot x_{3}(t)]</code>
</p>

<p style="text-align: center;"><code class="reqn">r_{3}\cdot x_{3}(t)+x_{3}(t)\cdot[a_{31}\cdot x_{1}(t)+a_{32}\cdot x_{2}(t)+a_{33}\cdot x_{3}(t)]</code>
</p>



<h3>Value</h3>

<p>Returns a vector with the value of the right side of the gLV equations.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

cinit1&lt;-c(x1&lt;-0.7,x2&lt;-0.2,x3&lt;-0.1)
parms1= cbind(c(0.1,0.2,-0.1),c(-0.2,0.1,-0.1),c(0.3,0.2,0.3),c(0.1,0.22,0.2))
rxnrate(cinit1,parms1)

</code></pre>

<hr>
<h2 id='Simulated'>Gut microbiome simulated dataset</h2><span id='topic+Simulated'></span>

<h3>Description</h3>

<p>Simulated dataset with 5 microbial taxa and 10 time points. Following the scheme given by Faust et al (2018), we generated the interaction matrix using the algorithm proposed by Klemm and Eguíluz (2002), and we generated the initial abundances using the Poisson distribution. With these two tools, we simulated the data using the generalized Lotka-Volterra structure. We carried out the simulation using the R package seqtime (Faust et al, 2018). Focusing on technical details, to generate the interaction matrix we set the clique size at 4, the diagonal values at -1, the interaction connectance at 0.04, the positive edge percentage at 64
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(Simulated)
</code></pre>


<h3>Format</h3>

<p>A data frame with 10 rows and 6 columns.
</p>


<h3>References</h3>


<ul>
<li><p> K. Faust, F. Bauchinger, B. Laroche et al., “Signatures ofecological processes in microbial community time series”. Microbiome, vol. 6, no. 1, p. 120, 2018
</p>
</li>
<li><p> K. Klemm and V. M. Eguíluz, “Growing scale-free networkswith small-world behavior”. Physical Review, vol. 65, no. 5,Article ID 057102, 2002.
</p>
</li></ul>


<hr>
<h2 id='StudyingParam'>Controlling quality of the convergence in BPBM</h2><span id='topic+StudyingParam'></span>

<h3>Description</h3>

<p>This function controls that the value of the Rhat is between 0.9 and 1.1. In addition, it controls that the effective sample size is bigger than 100 and that the zero is not at the center of the credible interval (the interval between 2.5 and 97.5). We consider that the zero is in the center of the credible interval when the zero is between the 25 and the 75 quantile of the distribution formed by the limits if the credible interval.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>StudyingParam(Sum, MCMC.CHAINS)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="StudyingParam_+3A_sum">Sum</code></td>
<td>
<p>Matrix with the summary of the &quot;Estimating_BPBM&quot;.It is the output of the &quot;Estimating_BPBM&quot; adding &quot;$R2jagsOutput$BUGSoutput$summary&quot;.</p>
</td></tr>
<tr><td><code id="StudyingParam_+3A_mcmc.chains">MCMC.CHAINS</code></td>
<td>
<p>Matrix with the values of all the Markov chains for all parameters. It is the output of the &quot;Estimating_BPBM&quot; adding &quot;$SamplesAllChains&quot;.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a list with:
</p>

<ul>
<li><p> Param.Summary:  Matrix. The matrix Sum with a zero in the column <code>Sum[,"mean"]</code> when a parameter has the zero in the center of its credible interval.
</p>
</li>
<li><p> AllChainsJoined:  Matrix. The matrix MCMC.CHAINS with a zero in all the iterations of the chain when a parameter has the zero in the center of its credible interval.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
set.seed(314)
especie=t(gtools::rdirichlet(n=6, c(6,6,1,6,6)))
E=5
Tt=6
MatrizPBmodelo=rbind(c(1,1,1,1,1,1),c(-0.3,0.4,0.3,-0.7,-0.4,-0.6),c(0.3,0.5,-0.3,0.1,0.4,0.1))

est=Estimating_BPBM(especie,
                   Tt,
                   E,
                   MatrizPBmodelo,
                   nn.chain=3,
                   nn.burnin=1000,
                   nn.sample=5000,
                   nn.thin=10)

StudyingParam(est$R2jagsOutput$BUGSoutput$summary,est$SamplesAllChains)


</code></pre>

<hr>
<h2 id='Table_alr_Dirich_glv'>Obtainig a table with the interpretable parameters</h2><span id='topic+Table_alr_Dirich_glv'></span>

<h3>Description</h3>

<p>This function returns a table with the interpretable parameters of the Dirich-gLV model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Table_alr_Dirich_glv(Param.Estimates, especie, names, E)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Table_alr_Dirich_glv_+3A_param.estimates">Param.Estimates</code></td>
<td>
<p>Vector with the estimates parameters. It is equal to <code>c(tau,as.vector( pam))</code> where:
</p>

<ul>
<li><p> pam  Matrix. Each row has the parameters of each bacteria. Following our example, pam has the parameters placed as follows:
</p>

<table>
<tr>
 <td style="text-align: right;">
 r1 </td><td style="text-align: right;">  a11  </td><td style="text-align: right;">  a12</td>
</tr>
<tr>
 <td style="text-align: right;">
 r2 </td><td style="text-align: right;">  a21 </td><td style="text-align: right;">   a22 </td>
</tr>

</table>

</li>
<li><p> tau  Number. Value of the tau parameter in the model
</p>
</li></ul>
</td></tr>
<tr><td><code id="Table_alr_Dirich_glv_+3A_especie">especie</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at all time points. The bacteria placed in the last row of this matrix is the one used as reference in the alr transformation that the model applies.</p>
</td></tr>
<tr><td><code id="Table_alr_Dirich_glv_+3A_names">names</code></td>
<td>
<p>Vector with the name of the bacteria in the same order than are present in the <code>especie</code> matrix.</p>
</td></tr>
<tr><td><code id="Table_alr_Dirich_glv_+3A_e">E</code></td>
<td>
<p>Number of bacteria available.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In an example with three bacteria, the regression of this model is defined by
</p>
<p style="text-align: center;"><code class="reqn">r_{1}\cdot log(x_{1}(t)/x_{3}(t))+log(x_{1}(t)/x_{3}(t))\cdot [a_{11}\cdot log(x_{1}(t)/x_{3}(t))(t)+a_{12}\cdot log(x_{2}(t)/x_{3}(t))] </code>
</p>

<p style="text-align: center;"><code class="reqn">r_{2}\cdot log(x_{2}(t)/x_{3}(t))+log(x_{2}(t)/x_{3}(t))\cdot [a_{21}\cdot log(x_{1}(t)/x_{3}(t))(t)+a_{22}\cdot log(x_{2}(t)/x_{3}(t))] </code>
</p>



<h3>Value</h3>

<p>Returns a table written in latex format with the matrix pam.
</p>


<h3>References</h3>

<p>Creus-Martí, I. and Moya, A. and Santonja, F. J. (2018). A Statistical Model with a Lotka-Volterra Structure for Microbiota Data. Lucas Jodar, Juan Carlos Cortes and Luis Acedo,  Modelling or engineering and human behavior 2018, Instituto Universitario de Matematica Multidisciplinar. ISBN: 978-84-09-07541-6
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

pam.ini=rbind(c(0.1,0.2,0.3),c(0.4,0.5,0.6))
paramEstimadosFinal=c(5, as.vector(pam.ini))
E=3
especie=cbind(c(0.2,0.4,0.4),c(0.1,0.1,0.8),c(0.5,0.1,0.4))
names=c("a","b","c")

Table_alr_Dirich_glv(paramEstimadosFinal,especie,names,E)

</code></pre>

<hr>
<h2 id='TableBPBM'>Obtaining a table with the SPBal information of the BPBM</h2><span id='topic+TableBPBM'></span>

<h3>Description</h3>

<p>Returns a table with the percentage of variance that each SPBal has, the bacteria that goes in the numerator and denominator of the balance, the relationship between the group in the numerator and the denominator and the bacteria most influenced by this SPBal.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>TableBPBM(
  NumSPBal,
  DemSPBal,
  PerVar,
  MatrizPBmodelo,
  Estimated.Param,
  BB = 0.55,
  names,
  E
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="TableBPBM_+3A_numspbal">NumSPBal</code></td>
<td>
<p>List. Output of &quot;ObtainigValueSPBal&quot; function.List. The component i of the list has the number of the row of the matrix <code>especie</code> where the bacteria in the numerator of the selected  principal balance i are placed.</p>
</td></tr>
<tr><td><code id="TableBPBM_+3A_demspbal">DemSPBal</code></td>
<td>
<p>List. Output of &quot;ObtainigValueSPBal&quot; function.List. The component i of the list has the number of the row of the matrix <code>especie</code> where the bacteria in the denominator of the selected  principal balance i are placed.</p>
</td></tr>
<tr><td><code id="TableBPBM_+3A_pervar">PerVar</code></td>
<td>
<p>Vector. Output of &quot;ObtainigValueSPBal&quot; function. The component of the vector i contains the percentage of variance of the SPBal with numerator <code>NumSPBal[[i]]</code> and denominator <code>DemSPBal[[i]]</code>.</p>
</td></tr>
<tr><td><code id="TableBPBM_+3A_matrizpbmodelo">MatrizPBmodelo</code></td>
<td>
<p>Matrix. Output of &quot;ObtainigValueSPBal&quot; function.  MatrixSPBal is the matrix that contains the covariates of the model. The first line es equal to 1 for all columns. The other rows contain the value of one SPBal at all time points. The selected principal balance of the row i+1 has at its numerator the bacteria placed in the rows <code>NumSPBal[[i]]</code> of the &quot;especie&quot;. The selected principal balance of the row i+1 has at its denominator the bacteria placed in the rows <code>DemSPBal[[i]]</code> of the &quot;especie&quot;.</p>
</td></tr>
<tr><td><code id="TableBPBM_+3A_estimated.param">Estimated.Param</code></td>
<td>
<p>Vector. Column &quot;mean&quot; of the output of StudyingParam function.</p>
</td></tr>
<tr><td><code id="TableBPBM_+3A_bb">BB</code></td>
<td>
<p>The bacteria in the numerator and the denominator of the balance are considered similar if the mean of the SPBal is between (-BB,BB).Default: 0.55.</p>
</td></tr>
<tr><td><code id="TableBPBM_+3A_names">names</code></td>
<td>
<p>Vector with the bacteria's names placed in the order in which appear in the rows of the matrices <code>especie</code> and <code>especiemodi</code>.</p>
</td></tr>
<tr><td><code id="TableBPBM_+3A_e">E</code></td>
<td>
<p>number of bacteria in the dataset.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns the table written in latex
</p>


<h3>Examples</h3>

<pre><code class='language-R'>NumSPBal=list(c(3,4),3,2)
DemSPBal=list(1,5,4)
PerVar=c(41.37487, 21.08270, 19.16870)
MatrizPBmodelo=rbind(c(1.00000000,  1.0000000,  1.0000000,  1.0000000 , 1.0000000),
                    c(1.84449081, -1.3569851, -0.1388348, -0.5269079, -1.3288684),
                    c(0.27531685,  0.4741394, -1.9045554, -0.3581268, -0.4768543),
                    c( 0.07782991,  0.3492473, -0.7138882,  1.4332828, -0.7203295))
namesOr=c("Bact1", "Bact2","Bact3","Bact4","Bact5")
Estimated.Param=c(0.5, 0.3, -0.2,0.1)
E=5

TableBPBM(NumSPBal,
         DemSPBal,
         PerVar,
         MatrizPBmodelo,
         Estimated.Param,
         BB=0.55,
         namesOr,
         E)

</code></pre>

<hr>
<h2 id='TableFBM'>Obtainig a table with the interpretable parameters</h2><span id='topic+TableFBM'></span>

<h3>Description</h3>

<p>This function returns a table with the interpretable parameters of the FBM model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>TableFBM(paramEstimadosFinal, names, E)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="TableFBM_+3A_paramestimadosfinal">paramEstimadosFinal</code></td>
<td>
<p>The estimate parameters, in the following order: a11,a12,a13, a21, a22,a23, ...a(D-1)1,a(D-1)2,a(D-1)3,tau. Where D is the number of bacterial species present in the matrix <code>especie</code>.</p>
</td></tr>
<tr><td><code id="TableFBM_+3A_names">names</code></td>
<td>
<p>Vector of length D. The component i has the name of the bacteria i.</p>
</td></tr>
<tr><td><code id="TableFBM_+3A_e">E</code></td>
<td>
<p>Number of bacteria available.</p>
</td></tr>
</table>


<h3>Details</h3>

<p style="text-align: center;"><code class="reqn">\mu_{it}=a_{i1}+a_{i2}\cdot\text{alr}(x_{i,(t-1)})+a_{i3}\cdot\text{Balance}(x_{i,(t-1)})\text{ for }i=1,\dots, D-1\text{ where } D \text{ is the number of bacteria}</code>
</p>



<h3>Value</h3>

<p>Returns a table written in latex format.
</p>


<h3>References</h3>

<p>Creus-Martí, I., Moya, A., Santonja, F. J. (2021). A Dirichlet autoregressive model for the analysis of microbiota time-series data. Complexity, 2021, 1-16.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>paramEstimadosFinal=c(1,2,3,1,2,3,1,2,3)
names=c("Bact1", "Bact2","Bact3")
E=3

TableFBM(paramEstimadosFinal,names,E)

</code></pre>

<hr>
<h2 id='TauAndParameters_EstParmFunc_FBM'>Obtaining the value of tau and the estimate value of the rest of the parameters</h2><span id='topic+TauAndParameters_EstParmFunc_FBM'></span>

<h3>Description</h3>

<p>This function estimates the parameters of the FBM model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>TauAndParameters_EstParmFunc_FBM(
  ttau = 30,
  ridge.final,
  Iter.EstParmFunc = 80,
  especie,
  EspecieMaxima,
  Tt,
  E,
  seed = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="TauAndParameters_EstParmFunc_FBM_+3A_ttau">ttau</code></td>
<td>
<p>Number. We estimate de FBM model for the values of tau: 1, 2,..., ttau</p>
</td></tr>
<tr><td><code id="TauAndParameters_EstParmFunc_FBM_+3A_ridge.final">ridge.final</code></td>
<td>
<p>Object of class &quot;ridgelm&quot;. Values obtained with the ridge regression.</p>
</td></tr>
<tr><td><code id="TauAndParameters_EstParmFunc_FBM_+3A_iter.estparmfunc">Iter.EstParmFunc</code></td>
<td>
<p>Number. Number of iterations. Default: 80 iterations.</p>
</td></tr>
<tr><td><code id="TauAndParameters_EstParmFunc_FBM_+3A_especie">especie</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at all time points. The bacteria placed in the last row of the matrix will be used as reference in the alr transformation and will be at the denominator of the balance.</p>
</td></tr>
<tr><td><code id="TauAndParameters_EstParmFunc_FBM_+3A_especiemaxima">EspecieMaxima</code></td>
<td>
<p>Row in which the bacteria used as reference is in <code>especie</code>. This is the bacteria that is going to be at the denominator of the balance and at the denominator of the alr transformartion. As a result, in this function, <code>EspecieMaxima</code> must be equal to <code>E</code></p>
</td></tr>
<tr><td><code id="TauAndParameters_EstParmFunc_FBM_+3A_tt">Tt</code></td>
<td>
<p>Number of time points available</p>
</td></tr>
<tr><td><code id="TauAndParameters_EstParmFunc_FBM_+3A_e">E</code></td>
<td>
<p>Number. Number of bacteria available.</p>
</td></tr>
<tr><td><code id="TauAndParameters_EstParmFunc_FBM_+3A_seed">seed</code></td>
<td>
<p>Number. Set a seed. Default <code>seed=NULL</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We give to the parameter tau the value 1,2,...,<code>ttau</code>. We estimate the FBM model for all this values (using the function &quot;Estimate_param_FBM&quot;)
and we select the value of tau that minimizes the AIC. The regression of this model is defined by
</p>
<p style="text-align: center;"><code class="reqn">\mu_{it}=a_{i1}+a_{i2}\cdot\text{alr}(x_{i,(t-1)})+a_{i3}\cdot\text{Balance}(x_{i,(t-1)})\text{ for }i=1,\dots, D-1\text{ where } D \text{ is the number of bacteria}</code>
</p>



<h3>Value</h3>

<p>Returns a list with:
</p>

<ul>
<li><p> EstimateParameters:  Vector with the estimated parameters, in the following order: a11,a12,a13, a21, a22,a23, ...a(D-1)1,a(D-1)2,a(D-1)3,tau. Where D is the number of bacterial species present in the matrix <code>especie</code>.
</p>
</li>
<li><p> AIC Number: Value of the AIC.
</p>
</li>
<li><p> All.iter:  Matrix. Each row has the parameters obtained in each iteration. The parameters are in the columns written in the same order that they are written in <code>Param.Estimates </code>. In this matrix we must observe that in the last iterations the values has really similar or equal values, if not, we need to increase the value of <code>Iter.EstParmFunc</code>.
</p>
</li></ul>



<h3>References</h3>

<p>Creus-Martí, I., Moya, A., Santonja, F. J. (2021). A Dirichlet autoregressive model for the analysis of microbiota time-series data. Complexity, 2021, 1-16.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
set.seed(123)
especie=t(gtools::rdirichlet(5,c(1,3,1)))
Tt=5
E=3
EspecieMaxima=3
ridge.final=ridgeregression(Tt,especie, E, EspecieMaxima)
ttau=10
Iter.EstParmFunc=10

TauAndParameters_EstParmFunc_FBM(ttau,ridge.final,Iter.EstParmFunc, especie,EspecieMaxima,Tt,E,714)
</code></pre>

<hr>
<h2 id='vecttor'>Alr of a bacteria</h2><span id='topic+vecttor'></span>

<h3>Description</h3>

<p>Writtes a vector with the alr transformation of the bacteria <code>i</code> at time points t=2,...,<code>Tt</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vecttor(i, especie, Tt, EspecieMaxima)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vecttor_+3A_i">i</code></td>
<td>
<p>Number. Position of the bacteria that we make the alr in the matrix <code>especie</code>. <code>i</code> must be different that <code>EspecieMaxima</code>.</p>
</td></tr>
<tr><td><code id="vecttor_+3A_especie">especie</code></td>
<td>
<p>Matrix that contains at row i the bacterial taxa of bacteria i at all time points. The bacteria placed in the last row of the matrix will be used as reference in the alr transformation and will be at the denominator of the balance.</p>
</td></tr>
<tr><td><code id="vecttor_+3A_tt">Tt</code></td>
<td>
<p>Number of time points available</p>
</td></tr>
<tr><td><code id="vecttor_+3A_especiemaxima">EspecieMaxima</code></td>
<td>
<p>Row in which the bacteria used as reference is in <code>especie</code>. This is the bacteria that is going to be at the denominator of the balance and the denominator of the alr transformation. As a result, in this function, <code>EspecieMaxima</code> must be equal to <code>E</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a vector with the alr transformation of the bacteria <code>i</code> at time points t=2,...,<code>Tt</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

set.seed(123)
especie=t(gtools::rdirichlet(10,c(1,3,1,2,4)))
Tt=10
EspecieMaxima=5
i=2

vecttor(i,especie,Tt,EspecieMaxima)


</code></pre>

<hr>
<h2 id='ZeroData'>Zero replacement</h2><span id='topic+ZeroData'></span>

<h3>Description</h3>

<p>In this function the zeros are removed or replaced using functions of &quot;zCompositions&quot; package that can be used with longitudinal data (because they do not use the information of other rows to make the replacement).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ZeroData(DaTa, method = "multKM", seed = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ZeroData_+3A_data">DaTa</code></td>
<td>
<p>data.frame. The first column contains the time point information (natural numbers 1,2,3...). The rest of the columns contain the relative abundance of each bacteria at the different time points. The values of each column must sum 1.</p>
</td></tr>
<tr><td><code id="ZeroData_+3A_method">method</code></td>
<td>
<p>Character.
</p>

<ul>
<li><p> If <code>method="multKM"</code> - The replacement is carried out with the &quot;multiplicative Kaplan-Meier smoothing spline replacement&quot; (Palarea-Albaladejo and Martín-Fernandez, 2015). Default method. The zeros must be written with a 0.
</p>
</li>
<li><p> If <code>method="multRepl"</code> -  The replacement is carried out with the &quot;multiplicative simple replacement&quot; (Palarea-Albaladejo and Martín-Fernandez, 2015).  The zeros must be written with a 0.
</p>
</li>
<li><p> If <code>method="nozeros"</code> - The bacteria that contains zeros are removed. One column is added to the dataset called &quot;Other&quot;.
</p>
</li></ul>
</td></tr>
<tr><td><code id="ZeroData_+3A_seed">seed</code></td>
<td>
<p>Number. Set a seed. Default <code>seed=NULL</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The dataset without zeros.
</p>


<h3>References</h3>

<p>Palarea-Albaladejo J. and Martín-Fernandez JA. zCompositions – R package for multivariate imputation of left-censored data under a compositional approach. Chemometrics and Intelligent Laboratory Systems 2015; 143: 85-96.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
set.seed(2)
dat=gtools::rdirichlet(6,c(1,2,3,1,2,3))
dat2=dat
dat2[2,1]=0
dat2[2,2]=dat[2,1]+dat[2,2]
dat2[4,3]=0
dat2[4,4]=dat[4,3]+dat[4,4]

X &lt;- cbind( c(1:6) ,dat2)

Final=ZeroData(X,"multKM",1)
Final2=ZeroData(X,"multRepl",1)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
