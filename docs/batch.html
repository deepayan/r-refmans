<!DOCTYPE html><html lang="en"><head><title>Help for package batch</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {batch}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#mergeCsv'><p>Merge CSV Files</p></a></li>
<li><a href='#msplit'><p>Split Vectors for Parallelization</p></a></li>
<li><a href='#parseCommandArgs'><p>Parse Command-Line Arguments</p></a></li>
<li><a href='#rbatch'><p>R Batch Submission</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Version:</td>
<td>1.1-5</td>
</tr>
<tr>
<td>Date:</td>
<td>2018-04-16</td>
</tr>
<tr>
<td>Title:</td>
<td>Batching Routines in Parallel and Passing Command-Line Arguments
to R</td>
</tr>
<tr>
<td>Author:</td>
<td>Thomas Hoffmann &lt;tjhoffm@gmail.com&gt;</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Thomas Hoffmann &lt;tjhoffm@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Functions to allow you to easily pass command-line arguments into R, and functions to aid in submitting your R code in parallel on a cluster and joining the results afterward (e.g. multiple parameter values for simulations running in parallel, splitting up a permutation test in parallel, etc.). See &lsquo;parseCommandArgs(...)&rsquo; for the main example of how to use this package.</td>
</tr>
<tr>
<td>Suggests:</td>
<td>parallel</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.14)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL]</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="http://sites.google.com/site/thomashoffmannproject/">http://sites.google.com/site/thomashoffmannproject/</a></td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>true</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2018-04-16 21:07:26 UTC; tom</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2018-04-16 21:44:03 UTC</td>
</tr>
</table>
<hr>
<h2 id='mergeCsv'>Merge CSV Files</h2><span id='topic+mergeCsv'></span>

<h3>Description</h3>

<p>Merges multiple csv's in the current directory together, with the option of averaging over several. For instance, if you have broken a set of simulations each into five jobs, this will merge all groups of five simulations together.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mergeCsv(every=1, outfile="allResults.csv", quote=FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mergeCsv_+3A_every">every</code></td>
<td>
<p>How many lines should be merged (averaged) over. This is especially useful when using the 'multiplier' open in the various batching routines (e.g. Rbatch, Rmosrun, etc.).</p>
</td></tr>
<tr><td><code id="mergeCsv_+3A_outfile">outfile</code></td>
<td>
<p>Name of the csv file to write the merged data to.</p>
</td></tr>
<tr><td><code id="mergeCsv_+3A_quote">quote</code></td>
<td>
<p>Whether to quote each item.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Thomas J. Hoffmann (2011). Passing in Command Line Arguments and
Parallel Cluster/Multicore Batching in R with batch. Journal of
Statistical Software, Code Snippets, 39(1), 1-11. URL
<a href="http://www.jstatsoft.org/v39/c01/">http://www.jstatsoft.org/v39/c01/</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+parseCommandArgs">parseCommandArgs</a></code>, <code><a href="#topic+rbatch">rbatch</a></code>, <code><a href="#topic+msplit">msplit</a></code>
</p>

<hr>
<h2 id='msplit'>Split Vectors for Parallelization</h2><span id='topic+msplit'></span>

<h3>Description</h3>

<p>Aids in splitting of a vector for parallelization, e.g. splitting up a group of SNPs into subgroups, so each one can analyzed in a parallel process. Other uses might be to choose splitting points for k-fold cross validation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>msplit(vec, m)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="msplit_+3A_vec">vec</code></td>
<td>
<p>A vector, e.g. c(1,2,3), 1:10.</p>
</td></tr>
<tr><td><code id="msplit_+3A_m">m</code></td>
<td>
<p>Numer of splits.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Returns a list, with each member being a subgroup to be parallelized.
</p>


<h3>References</h3>

<p>Thomas J. Hoffmann (2011). Passing in Command Line Arguments and
Parallel Cluster/Multicore Batching in R with batch. Journal of
Statistical Software, Code Snippets, 39(1), 1-11. URL
<a href="http://www.jstatsoft.org/v39/c01/">http://www.jstatsoft.org/v39/c01/</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+parseCommandArgs">parseCommandArgs</a></code>, <code><a href="#topic+rbatch">rbatch</a></code>, <code><a href="#topic+mergeCsv">mergeCsv</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  snps &lt;- paste("snp", 1:98, sep="")
  print(snps)
  print(msplit(snps, 10)) ## Splits it into 10 groups
</code></pre>

<hr>
<h2 id='parseCommandArgs'>Parse Command-Line Arguments</h2><span id='topic+parseCommandArgs'></span>

<h3>Description</h3>

<p><code>parseCommandArgs</code> allows for command line arguments to be passed into R. Arguments may be of the form of simple R objects. This makes running the same R code on multiple different options easy, and possible to run in parallel on a single machine or on a cluster.
</p>
<p><code>parseCommandArgsDF</code> returns a dataframe with all of the values that were set when the code was executed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>parseCommandArgs(evaluate=TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="parseCommandArgs_+3A_evaluate">evaluate</code></td>
<td>
<p>If TRUE, then the command-line arguments are assigned to the current namespace, over-riding any default values that may have already been set in software.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Returns a list of the command-line arguments that were set.
</p>
<p>See the example below for a good example of how to use this function, and how to run things in parallel with it.
</p>


<h3>References</h3>

<p>Thomas J. Hoffmann (2011). Passing in Command Line Arguments and
Parallel Cluster/Multicore Batching in R with batch. Journal of
Statistical Software, Code Snippets, 39(1), 1-11. URL
<a href="http://www.jstatsoft.org/v39/c01/">http://www.jstatsoft.org/v39/c01/</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rbatch">rbatch</a></code>, <code><a href="#topic+mergeCsv">mergeCsv</a></code>, <code><a href="#topic+msplit">msplit</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  ## mainSim.R
  ## Put the following code in the file 'mainSim.R'.
  ##
  ## Try this out by running:
  ##   R --vanilla &lt; mainSim.R &gt; mainSim.Rout1013
  ##   R --vanilla --args seed 1014 bbeta 0 &lt; mainSim.R &gt; mainSim.Rout1014
  ##   R --vanilla --args seed 1015 bbeta "c(10,20)" &lt; mainSim.R &gt; mainSim.Rout1015
  library(batch)

  ## Set values of some parameters
  seed &lt;- 1013 ## default value
  bbeta &lt;- 5   ## default value, note 'beta' is an R function, so we can't use that

  ## Overwrite the values of 'seed' and 'bbeta', e.g., if they have been
  ##  passed in from the command prompt.
  parseCommandArgs()

  ## Will disply the default values on the first run,
  ##  but bbeta=1014 and bbeta=0 on the second run.
  print(seed)
  print(bbeta)

  ## ... your simualtion code

  ## Write out your results to a csv file
  write.csv(data.frame(seed=seed, bbeta=paste(bbeta,collapse="~")),
    paste("res",seed,".csv",sep=""), row.names=FALSE)

  ## R.miSniam

## End(Not run)

## Not run: 
  ## run_mainSim_parallel.R
  ## Put the following code in 'run_mainSim_parallel.R'
  ##
  ## Selects a variety of parameter combinations to run
  ##    mainSim.R in parallel on a cluster.
  ##
  ## First see the commands that would be run (to make sure they are correct) with
  ##   R --vanilla --args RUN 0 &lt; run_mainSim_parallel.R
  ##  Then run the commands with
  ##   R --vanilla &lt; run_mainSim_parallel.R
  ##  or
  ##   R --vanilla --args RUN 1 &lt; run_mainSim_parallel.R
  ##  These will all default to run locally.
  ## To run on a mosix cluster, run with
  ##   R --vanilla --args RUN 1 RBATCH mosix &lt; run_mainSim_parallel.R
  ## And on a LSF cluster, run with
  ##   R --vanilla --args RUN 1 RBATCH lsf &lt; run_mainSim_parallel.R
  library(batch)

  parseCommandArgs() ## for overwriting default values; here, 'run'

  ## Choose a high enough seed for later for pasting the results together
  ##  (1,...,9,10) sorts not the way you want, for example.
  seed &lt;- 1000
  for(i in 1:10)
    seed &lt;- rbatch("mainSim.R", seed=seed, bbeta=i)

  ## Only for local (but it does not hurt to run in other situations,
  ##  so suggested in all cases).
  ## This actually runs all the commands when run on the local system.
  rbatch.local.run()
  ## R.lellarap_miSniam_nur

## End(Not run)
## Not run: 
  ## paste_mainSim_results.R
  ## Put the following code in paste_mainSim_results.R (or just
  ##  type them in), and run
  ##   R --vanilla &lt; paste_mainSim_results.R
  ##
  ## Pastes all of the csv files created in 'run_mainSim_parallel'
  ##  together.
  library(batch)
  mergeCsv()

## End(Not run)
</code></pre>

<hr>
<h2 id='rbatch'>R Batch Submission</h2><span id='topic+rbatch'></span><span id='topic+rbatch.default'></span><span id='topic+rbatch.local'></span><span id='topic+rbatch.local.run'></span><span id='topic+rbatch.lsf'></span><span id='topic+rbatch.mosix'></span>

<h3>Description</h3>

<p>Aids in the submission of multiple jobs to a cluster. Also can be used locally on a linux machine to utilize all cores (or processors), if the cluster is busy.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rbatch(rfile, seed, ..., rbatch.control=rbatch.default())
rbatch.default()
rbatch.local(BATCH="ALLCORES", BATCHPOST="", QUOTE="",
             ARGQUOTE='"', RUN=1, MULTIPLIER=1)
rbatch.local.run(ncores=NA)
rbatch.lsf(BATCH="bsub -q normal", BATCHPOST="", QUOTE='"',
           ARGQUOTE='""', RUN=1, MULTIPLIER=1)
rbatch.mosix(BATCH="nohup mosrun -e -b -q", BATCHPOST=" &amp;", QUOTE="",
             ARGQUOTE='"', RUN=1, MULTIPLIER=1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rbatch_+3A_rfile">rfile</code></td>
<td>
<p>Name of the R file that you wish to batch.</p>
</td></tr>
<tr><td><code id="rbatch_+3A_seed">seed</code></td>
<td>
<p>What seed you wish to run. You will need to set this in your code, but it will be used to set the name of the output file.</p>
</td></tr>
<tr><td><code id="rbatch_+3A_...">...</code></td>
<td>
<p>Any other arguments you want to pass to your R file (to be parsed via parseCommandArgs() call, see that function for a detailed example.</p>
</td></tr>
<tr><td><code id="rbatch_+3A_rbatch.control">rbatch.control</code></td>
<td>
<p>Object from rbatch.default(), rbatch.lsf() or rbatch.mosix(), controlling the cluster run. Suggested is to always use rbatch.default(), as is the default, and set the command line argument RBATCH to 'lsf' or 'mosix', or alter any of the parameters in the functions (e.g. BATCH, MULTIPLIER) through the command line arguments.</p>
</td></tr>
<tr><td><code id="rbatch_+3A_batch">BATCH</code></td>
<td>
<p>Command string to use to batch the file on a cluster. The default is the normal queue for LSF, &quot;bsub -q normal&quot;. Rmosrun sets this to &quot;nohup mosrun -e -b -q&quot; is used..</p>
</td></tr>
<tr><td><code id="rbatch_+3A_batchpost">BATCHPOST</code></td>
<td>
<p>String that will be pasted to the end of the batch string (e.g. '&amp;').</p>
</td></tr>
<tr><td><code id="rbatch_+3A_quote">QUOTE</code></td>
<td>
<p>How to quote the command string. Default is for LSF.</p>
</td></tr>
<tr><td><code id="rbatch_+3A_argquote">ARGQUOTE</code></td>
<td>
<p>How to quote arguments when they are vectores, default is double quote to work with LSF, you might also find single quote to be useful.</p>
</td></tr>
<tr><td><code id="rbatch_+3A_run">RUN</code></td>
<td>
<p>Default is 0, in which case the commands will not be batched. Use this to first ensure you are really batching what you want to batch. Then set this to be 1.</p>
</td></tr>
<tr><td><code id="rbatch_+3A_multiplier">MULTIPLIER</code></td>
<td>
<p>How many times to run the current set of arguments. For example, if you have a simulation that you want to run 1000 iterations on, you could set multiplier to 10, and run 100 iterations 10 times by setting multiplier to 10. Then you could use mergeCsv(10), e.g., if you wrote your results to a csv file as exemplified in the parseCommandArgs() routine. Automatically increments the seed.</p>
</td></tr>
<tr><td><code id="rbatch_+3A_ncores">ncores</code></td>
<td>
<p>Number of cores. If NA (default) this is automatically detected, but sometimes it is detected incorrectly.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Returns the next seed you can use (particularly useful when you set the multiplier argument).
</p>
<p>See the examples in <code><a href="#topic+parseCommandArgs">parseCommandArgs</a></code> for examples on how to run this.
</p>


<h3>References</h3>

<p>Thomas J. Hoffmann (2011). Passing in Command Line Arguments and
Parallel Cluster/Multicore Batching in R with batch. Journal of
Statistical Software, Code Snippets, 39(1), 1-11. URL
<a href="http://www.jstatsoft.org/v39/c01/">http://www.jstatsoft.org/v39/c01/</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+parseCommandArgs">parseCommandArgs</a></code>, <code><a href="#topic+mergeCsv">mergeCsv</a></code>, <code><a href="#topic+msplit">msplit</a></code>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
