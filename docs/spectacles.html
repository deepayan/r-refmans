<!DOCTYPE html><html lang="en"><head><title>Help for package spectacles</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {spectacles}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#spectacles-package'><p>Storing, Manipulating and Analysis Spectroscopy and Associated Data in R</p></a></li>
<li><a href='#aggregate_spectra'><p>Aggregates spectral and data information</p></a></li>
<li><a href='#apply_spectra'><p>Apply a function on the spectra of a Spectra* object</p></a></li>
<li><a href='#australia'><p>Australia spectra library data set</p></a></li>
<li><a href='#base_line'><p>Baseline correction using the baseline package#'</p></a></li>
<li><a href='#big.head'><p>Return the First or Last Part of an Object</p></a></li>
<li><a href='#continuum_removal'><p>Continuum removal</p></a></li>
<li><a href='#cut'><p>Manipulating the wavelength range of a <code>Spectra</code> object</p></a></li>
<li><a href='#dimensions'><p>Retrieve dimensions of Spectra* objects</p></a></li>
<li><a href='#extraction-methods'><p>Extracting and replacing parts of Spectra* objects</p></a></li>
<li><a href='#features'><p>Retrieves or sets the data slot of a SpectraDataFrame object.</p></a></li>
<li><a href='#fill_spectra'><p>Fill missing wavelengths of a Spectra* object with a given value</p></a></li>
<li><a href='#ids'><p>Retrieves or sets the ids of a <code>Spectra*</code> object.</p></a></li>
<li><a href='#kenstone'><p>Kennard-Stone algorithm for optimal calibration set selection.</p></a></li>
<li><a href='#load_oz'><p>Load the australia dataset</p></a></li>
<li><a href='#melt_spectra'><p>Melts the spectra data of a Spectra object and returns it as wide format.</p></a></li>
<li><a href='#mutate'><p>Mutate a Spectra* object by transforming the spectra values, and/or adding</p>
new or replacing existing attributes.</a></li>
<li><a href='#plot_offset'><p>Offset plot of a collection of spectra</p></a></li>
<li><a href='#plot_stack'><p>Stacked plot of a collection of spectra</p></a></li>
<li><a href='#plot_summary'><p>Summary plot of a collection of spectra</p></a></li>
<li><a href='#plot-Spectra'><p>Plots an object inheriting from the Spectra class</p></a></li>
<li><a href='#postResampleSpectro'><p>Calculates performance indictors across resamples</p></a></li>
<li><a href='#rbind'><p>Stacking <code>Spectra</code> objects together</p></a></li>
<li><a href='#res+2Cnumeric-method'><p>Spectral resolution</p></a></li>
<li><a href='#separate'><p>Separates a <code>Spectra*</code> object into a calibration and a validation set.</p></a></li>
<li><a href='#snv'><p>Standard and Robust Normal Variate transformations</p></a></li>
<li><a href='#Spectra'><p>Constructor for the Spectra class.</p></a></li>
<li><a href='#Spectra-class'><p>Spectra* classes</p></a></li>
<li><a href='#spectra-methods'><p>Retrieves or sets the spectra of a <code>Spectra*</code> objects.</p></a></li>
<li><a href='#SpectraDataFrame'><p>Constructor for the SpectraDataFrame class.</p></a></li>
<li><a href='#splice'><p>Splice correction of a spectra collected using ASD hardware</p></a></li>
<li><a href='#split'><p>Split a Spectra* object using factors</p></a></li>
<li><a href='#subset'><p>Subset SpectraDataFrame object</p></a></li>
<li><a href='#summary'><p>Summary</p></a></li>
<li><a href='#wl'><p>Retrieves or sets the wavelengths of a <code>Spectra*</code> object.</p></a></li>
<li><a href='#wl_units'><p>Wavelengths of Spectra* objects</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Storing, Manipulating and Analysis Spectroscopy and Associated
Data</td>
</tr>
<tr>
<td>Version:</td>
<td>0.5-4</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-07-07</td>
</tr>
<tr>
<td>Description:</td>
<td>Stores and eases the manipulation of spectra and associated data,
    with dedicated classes for spatial and soil-related data.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/pierreroudier/spectacles/">https://github.com/pierreroudier/spectacles/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/pierreroudier/spectacles/issues">https://github.com/pierreroudier/spectacles/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.14)</td>
</tr>
<tr>
<td>Imports:</td>
<td>ggplot2, methods, plyr, reshape2, stringr, baseline, signal,
epiR</td>
</tr>
<tr>
<td>Suggests:</td>
<td>caret, pls, RColorBrewer, knitr, rmarkdown, dplyr</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Collate:</td>
<td>'spectacles-package.R' 'AAA-Classes.R' 'Spectra-methods.R'
'SpectraDataFrame-methods.R' 'ZZZ.R' 'aggregate_spectra.R'
'australia.R' 'big_head.R' 'kenstone.R' 'performance.R'
'plot-methods.R' 'preprocessing.R' 'setters.R' 'splice.R'</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-07-07 06:05:37 UTC; RoudierP</td>
</tr>
<tr>
<td>Author:</td>
<td>Pierre Roudier [aut, cre],
  Max Kuhn [ctb],
  Kristian Hovde Liland [ctb],
  Bjorn-Helge Mevik [ctb],
  Hadley Wickham [ctb],
  Raphael Viscarra Rossel [dtc]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Pierre Roudier &lt;roudierp@landcareresearch.co.nz&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-07-07 06:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='spectacles-package'>Storing, Manipulating and Analysis Spectroscopy and Associated Data in R</h2><span id='topic+spectacles-package'></span>

<h3>Description</h3>

<p>Stores and eases the manipulation of spectra and associated data.
</p>


<h3>Author(s)</h3>

<p>Pierre Roudier
</p>

<hr>
<h2 id='aggregate_spectra'>Aggregates spectral and data information</h2><span id='topic+aggregate_spectra'></span><span id='topic+aggregate_spectra+2CSpectra-method'></span><span id='topic+aggregate_spectra+2CSpectraDataFrame-method'></span>

<h3>Description</h3>

<p>Aggregates spectral and data information of a <code>Spectra</code> object using a
user-defined function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'Spectra'
aggregate_spectra(obj, fun = mean, ...)

## S4 method for signature 'SpectraDataFrame'
aggregate_spectra(obj, fun = mean, id = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="aggregate_spectra_+3A_obj">obj</code></td>
<td>
<p>see below</p>
</td></tr>
<tr><td><code id="aggregate_spectra_+3A_fun">fun</code></td>
<td>
<p>see below</p>
</td></tr>
<tr><td><code id="aggregate_spectra_+3A_...">...</code></td>
<td>
<p>see below</p>
</td></tr>
<tr><td><code id="aggregate_spectra_+3A_id">id</code></td>
<td>
<p>see below</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For <code>SpectraDataFrame</code> objects, associated data is also aggregated using the function provided by the <code>fun</code> option. Additionally, the method for <code>SpectraDataFrame</code> has an <code>id</code> option that allows to specify an attribute which will be used to split the object, apply sequentially the <code>fun</code> function, and recombine the results in an unique object.
</p>


<h3>Value</h3>

<p>An object of the same class as <code>obj</code>
</p>


<h3>Methods</h3>


<p><b>x=Spectra</b>
</p>
<p><code>aggregate_spectra(obj, fun=mean, ...)</code>
</p>

<table>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>obj</code> </td><td style="text-align: left;"> A <code>Spectra</code> object </td>
</tr>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;">
<code>fun</code> </td><td style="text-align: left;"> An aggregation function </td>
</tr>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>...</code> </td><td style="text-align: left;"> Expressions
evaluated in the context of <code>fun</code> </td>
</tr>
<tr>
 <td style="text-align: right;"> </td>
</tr>

</table>

<p><b>x=SpectraDataFrame</b>
</p>
<p><code>aggregate_spectra(obj, fun=mean, id=NULL, ...)</code>
</p>

<table>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>obj</code> </td><td style="text-align: left;"> A <code>SpectraDataFrame</code> object </td>
</tr>
<tr>
 <td style="text-align: right;">
</td><td style="text-align: left;"> <code>fun</code> </td><td style="text-align: left;"> An aggregation function </td>
</tr>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>id</code> </td><td style="text-align: left;">
Attribute(s) to split the object (character vector) </td>
</tr>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>...</code> </td><td style="text-align: left;">
Expressions evaluated in the context of <code>fun</code> </td>
</tr>
<tr>
 <td style="text-align: right;"> </td>
</tr>

</table>




<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+apply_spectra">apply_spectra</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading example data
data(australia)
spectra(australia) &lt;- sr_no ~ ... ~ 350:2500

# Aggregation on the whole collection
m &lt;- aggregate_spectra(australia, fun = mean)
plot(m)

# Aggregation factor-wise

# Generate some kind of factor
australia$fact &lt;- sample(
  LETTERS[1:3], 
  size = nrow(australia), 
  replace = TRUE
)
m &lt;- aggregate_spectra(australia, fun = mean, id = 'fact')
plot(m)
</code></pre>

<hr>
<h2 id='apply_spectra'>Apply a function on the spectra of a Spectra* object</h2><span id='topic+apply_spectra'></span>

<h3>Description</h3>

<p>Aggregates spectral and data information of a <code>Spectra</code> object using a
user-defined function.
</p>
<p>Apply a function and update the spectra of a <code>Spectra</code> object. This
function is particularly interesting for pre-processing, e.g to derive the
spectra, or apply pre-processing functions such as <code>snv</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apply_spectra(obj, fun, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="apply_spectra_+3A_obj">obj</code></td>
<td>
<p>an object inheriting from class <code>Spectra</code></p>
</td></tr>
<tr><td><code id="apply_spectra_+3A_fun">fun</code></td>
<td>
<p>an aggregation function</p>
</td></tr>
<tr><td><code id="apply_spectra_+3A_...">...</code></td>
<td>
<p>expressions evaluated in the context of <code>fun</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The philosophy of this function is to let the user free to use any function
to pre-process a spectra collection, using either functions from the stats
package, functions from other packages such as <code>signal</code>, or personal
functions.
</p>


<h3>Value</h3>

<p>An object of the same class as <code>obj</code>
</p>


<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+aggregate_spectra">aggregate_spectra</a></code>, <code><a href="#topic+snv">snv</a></code>,
<code><a href="#topic+rnv">rnv</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading example data
data(australia)
spectra(australia) &lt;- sr_no ~ ... ~ 350:2500

# Second derivative
r &lt;- apply_spectra(australia, diff, 2)
plot(r)

# Smoothing kernel
k &lt;- kernel("daniell", 20) # define a kernel
r &lt;- apply_spectra(australia, kernapply, k)
plot(r)

## Not run: 
# Savitzky-Golay filter (from the signal package)
library(signal)
r &lt;- apply_spectra(australia, sgolayfilt, n = 33, p = 4)
plot(r)

## End(Not run)

</code></pre>

<hr>
<h2 id='australia'>Australia spectra library data set</h2><span id='topic+australia'></span><span id='topic+oz'></span>

<h3>Description</h3>

<p>The <code>australia</code> data set gathers 100 soil spectra, along side with their organic
carbon, pH and clay content values. This data set has been collected by
CSIRO.The <code>oz</code> dataset is the first 5 samples of <code>australia</code>, and is here to keep examples fast to run.
</p>
<p>The <code>data.frame</code> contains the following columns: 
</p>

<ul>
<li><p>sr_noa unique identifier for each spectrum
</p>
</li>
<li><p>carbonsoil organic carbon values
</p>
</li>
<li><p>phsoil pH values
</p>
</li>
<li><p>claysoil clay values
</p>
</li>
<li><p>X350, X351, ...,X2499, X2500reflectance in wavelengths 350 to 2500nm
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Data kindly contributed by Raphael Viscarra Rossel. To reduce the
size of the package, the original dataset has been reduced to 100 spectra
using the Kennard-Stone algorithm.
</p>


<h3>References</h3>

<p>Viscarra Rossel, R. and Behrens, T. 2010.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(australia)
big.head(australia)
spectra(australia) &lt;- sr_no ~ ... ~ 350:2500

data(oz)
big.head(oz)
spectra(oz) &lt;- sr_no ~ ... ~ 350:2500

</code></pre>

<hr>
<h2 id='base_line'>Baseline correction using the baseline package#'</h2><span id='topic+base_line'></span><span id='topic+base_line+2CSpectra-method'></span>

<h3>Description</h3>

<p>Estimates baselines for the spectra in the <code>obj</code> object, using the
algorithm named in 'method'.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'Spectra'
base_line(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="base_line_+3A_object">object</code></td>
<td>
<p>an object inheriting from class <code>Spectra</code></p>
</td></tr>
<tr><td><code id="base_line_+3A_...">...</code></td>
<td>
<p>additional arguments to be passed to the <code>baseline</code> function
in the baseline package. The main option would be <code>'method'</code>, to switch
between the several baseline methods presented in teh details section.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The baseline package implements various algorithms for the baseline
correction. The following methods are available:
</p>
 <ul>
<li><p> 'als': Baseline correction by 2nd derivative constrained
weighted regression </p>
</li>
<li><p> 'fillPeaks': An iterative algorithm using
suppression of baseline by means in local windows </p>
</li>
<li><p> 'irls' (default): An
algorithm with primary smoothing and repeated baseline suppressions and
regressions with 2nd derivative constraint </p>
</li>
<li><p> 'lowpass': An algorithm for
removing baselines based on Fast Fourier Transform filtering </p>
</li>
<li>
<p>'medianWindow': An implementation and extention of Mark S. Friedrichs'
model-free algorithm </p>
</li>
<li><p> 'modpolyfit': An implementation of Chad A. Lieber
and Anita Mahadevan-Jansen's algorithm for polynomial fiting </p>
</li>
<li>
<p>'peakDetection': A translation from Kevin R. Coombes et al.'s MATLAB code
for detecting peaks and removing baselines </p>
</li>
<li><p> 'rfbaseline': Wrapper for
Andreas F. Ruckstuhl, Matthew P. Jacobson, Robert W. Field, James A. Dodd's
algorithm based on LOWESS and weighted regression </p>
</li>
<li><p> 'rollingBall': Ideas
from Rolling Ball algorithm for X-ray spectra by M.A.Kneen and H.J.
Annegarn. Variable window width has been left out </p>
</li></ul>

<p>See baseline package documentation for more information and references.
</p>
<p>Additionally, the baseline package provides a nice GUI that helps choosing
the good baseline method and the good parametrisation. This GUI can be used
with the <code>inspectr</code> package. This is demonstrate in the Examples
section.
</p>


<h3>Value</h3>

<p>An object of the same class as <code>obj</code> with the continuum removed
from its spectra.
</p>


<h3>Author(s)</h3>

<p>Interface to the baseline package by Pierre Roudier
<a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>, baseline package authored by Kristian Hovde
Liland and Bjorn-Helge Mevik
</p>


<h3>References</h3>

<p>Kristian Hovde Liland and Bjorn-Helge Mevik (2011). baseline:
Baseline Correction of Spectra. R package version 1.0-1.
http://CRAN.R-project.org/package=baseline
</p>


<h3>See Also</h3>

<p><code><a href="#topic+continuum_removal">continuum_removal</a></code>, <code><a href="#topic+snv">snv</a></code>,
<code><a href="#topic+rnv">rnv</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading example data
data(australia)
spectra(australia) &lt;- sr_no ~ ... ~ 350:2500

# Subsample for demo purposes
australia &lt;- australia[1:10,]

# Correction using the default method (irls)
bl &lt;- base_line(australia)
plot(bl)

# Specifying another method for baseline calculation
bl2 &lt;- base_line(australia, method = "modpolyfit")
plot(bl2)

# Using the baseline package independently
# (useful to plot the corrections)
## Not run: 
library(baseline)
bl3 &lt;- baseline(spectra(australia), method = 'irls')
class(bl3) # this is a baseline object
plot(bl3)
# Affecting the baseline-corrected spectra back
# to the SpectraDataFrame object
spectra(australia) &lt;- getCorrected(bl3)
plot(australia)

# Using the baselineGUI with inspectr
baselineGUI(spectra(australia))
## When happy with a configuration, clik "Apply to all" and 
## save the results under a name, e.g. "corrected.spectra"
spectra(australia) &lt;- getCorrected(corrected.spectra)
plot(australia)

## End(Not run)

</code></pre>

<hr>
<h2 id='big.head'>Return the First or Last Part of an Object</h2><span id='topic+big.head'></span><span id='topic+big.tail'></span>

<h3>Description</h3>

<p>Return the First or Last Part of an Object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>big.head(x, n = 5, l = 5, r = 5)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="big.head_+3A_x">x</code></td>
<td>
<p>a <code>"data.frame"</code> or a <code>"matrix"</code> object</p>
</td></tr>
<tr><td><code id="big.head_+3A_n">n</code></td>
<td>
<p>a single, positive integer, number of rows for the object to return</p>
</td></tr>
<tr><td><code id="big.head_+3A_l">l</code></td>
<td>
<p>a single, positive integer, the number of columns to include on the left</p>
</td></tr>
<tr><td><code id="big.head_+3A_r">r</code></td>
<td>
<p>a single, positive integer, the number of columns to include on the right</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Returns the first or last rows of a data frame like head() and tail(), but
also only returns the first and last columns. This has been implemented to
check big data frames.
</p>


<h3>Value</h3>

<p>An object (usually) like 'x' but generally smaller.
</p>


<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="utils.html#topic+head">head</a></code>, <code><a href="utils.html#topic+tail">tail</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
big.head(mtcars)
big.tail(mtcars)
big.tail(mtcars, 10)
big.head(mtcars, 10, 2, 4)
big.head(mtcars, , , 1)

data(australia)
big.head(australia)

</code></pre>

<hr>
<h2 id='continuum_removal'>Continuum removal</h2><span id='topic+continuum_removal'></span>

<h3>Description</h3>

<p>Operates a continuum removal on a vector.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>continuum_removal(x, wl = as.numeric(names(x)), upper = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="continuum_removal_+3A_x">x</code></td>
<td>
<p>a numeric vector</p>
</td></tr>
<tr><td><code id="continuum_removal_+3A_wl">wl</code></td>
<td>
<p>the wavelengths of the spectra</p>
</td></tr>
<tr><td><code id="continuum_removal_+3A_upper">upper</code></td>
<td>
<p>if TRUE, removes the upper convex hull from the spectra, if
FALSE, takes the lower convex hull</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This operation is commonly done to normalize reflectance spectra and allow
comparison of individual absorption features from a common baseline. The
removal is based on the upper convex hull of the spectra.
</p>
<p>This function is working on vectors. It may applied on matrix or data.frames
using the <code>apply</code> function, or on <code>Spectra*</code> objects using the
<code>apply_spectra</code> function.
</p>


<h3>Value</h3>

<p>A numeric vector with its continuum removed.
</p>


<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>, based on code from
Raphael Viscarra-Rossel.
</p>


<h3>References</h3>

<p>Clark, R.N., and Roush, T.L. 1984. Reflectance spectroscopy:
Quantitative analysis techniques for remote sensing applications. Journal of
Geophysical Research 89, 6329&ndash;6340.
</p>


<h3>See Also</h3>

<p><code><a href="baseline.html#topic+baseline">baseline</a></code>, <code><a href="#topic+snv">snv</a></code>, <code><a href="#topic+rnv">rnv</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading example data
data(australia)
spectra(australia) &lt;- sr_no ~ ... ~ 350:2500

s &lt;- apply_spectra(australia, continuum_removal)
plot(s)

s &lt;- apply_spectra(australia, continuum_removal, upper = FALSE)
plot(s)

</code></pre>

<hr>
<h2 id='cut'>Manipulating the wavelength range of a <code>Spectra</code> object</h2><span id='topic+cut'></span><span id='topic+cut+2CSpectra-method'></span>

<h3>Description</h3>

<p>This methods allows to either select or remove a specific range of
wavelengths from a <code>Spectra</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'Spectra'
cut(x, ..., wl)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cut_+3A_x">x</code></td>
<td>
<p>an object inheriting from class <code>Spectra</code></p>
</td></tr>
<tr><td><code id="cut_+3A_...">...</code></td>
<td>
<p>ignored</p>
</td></tr>
<tr><td><code id="cut_+3A_wl">wl</code></td>
<td>
<p>a vector of the wavelengths to either select or remove from
<code>x</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The wavelengths are extracted if <code>wl &gt; 0</code>, or removed if <code>wl &lt; 0</code>.
You can't mix negative and positive index in <code>wl</code>.
</p>


<h3>Value</h3>

<p>An object of the same class as <code>x</code>.
</p>


<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading example data
data(australia)
spectra(australia) &lt;- sr_no ~ ... ~ 350:2500

# Extracting a specific wavelengths range
s &lt;- cut(australia, wl = 450:550)
plot(s)

s &lt;- cut(australia, wl = c(450:550, 1850:2050))
plot(s)

# Removing a specific wavelengths range
s &lt;- cut(australia, wl = -1*450:550)
plot(s)

s &lt;- cut(australia, wl = -1*c(450:550, 1850:2050))
plot(s)

</code></pre>

<hr>
<h2 id='dimensions'>Retrieve dimensions of Spectra* objects</h2><span id='topic+dimensions'></span><span id='topic+length.Spectra'></span><span id='topic+nrow+2CSpectra-method'></span><span id='topic+ncol+2CSpectra-method'></span><span id='topic+dim'></span><span id='topic+length'></span><span id='topic+dim.Spectra'></span>

<h3>Description</h3>

<p>Retrieves the wavelengths units and the spectral resolution from
<code>Spectra*</code> objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'Spectra'
length(x)

## S4 method for signature 'Spectra'
nrow(x)

## S4 method for signature 'Spectra'
ncol(x)

## S3 method for class 'Spectra'
dim(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dimensions_+3A_x">x</code></td>
<td>
<p>For <code>nrow</code>, <code>length</code>, <code>dim</code>, a <code>Spectra</code>
object. For <code>ncol</code>, a <code>SpectraDataFrame</code> object.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>* Methods for <code>Spectra</code> objects
</p>
<p><code>nrow</code> returns the number of individuals in the collection
<code>length</code> returns the number of wavelengths in the collection
<code>ncol</code> returns NULL <code>dim</code> returns a vector containing (1) the
number of individuals and (2) in the number of wavelengths in the collection
</p>
<p>* Methods for <code>Spectra</code> objects
</p>
<p><code>nrow</code> returns the number of individuals in the collection
<code>length</code> returns the number of wavelengths in the collection
<code>ncol</code> returns the number of attributes in the collection <code>dim</code>
returns a vector containing (1) the number of individuals, (2) in the number
of wavelengths, and (3) the number of attributes in the collection
</p>


<h3>Value</h3>

<p><code>nrow</code>, <code>ncol</code>, <code>nwl</code>, and <code>length</code>, return an
<code>integer</code>, <code>dim</code> returns a vector of length 2 or 3 (see Details section).
</p>


<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading example data
data(australia)
spectra(australia) &lt;- sr_no ~ ... ~ 350:2500

nrow(australia)
ncol(australia)
length(australia)
dim(australia)

</code></pre>

<hr>
<h2 id='extraction-methods'>Extracting and replacing parts of Spectra* objects</h2><span id='topic+extraction-methods'></span><span id='topic++5B'></span><span id='topic++5B+3C-'></span><span id='topic++5B+5B'></span><span id='topic++5B+5B+3C-'></span><span id='topic++24'></span><span id='topic++24+3C-'></span><span id='topic++5B+2CSpectra-method'></span><span id='topic++5B+5B+2CSpectra-method'></span><span id='topic++5B+5B+3C-+2CSpectra-method'></span><span id='topic++5B+2CSpectra+2CANY+2CANY+2Cmissing-method'></span><span id='topic++5B+2CSpectraDataFrame+2CANY+2CANY+2Cmissing-method'></span><span id='topic++5B+5B+2CSpectraDataFrame+2CANY+2Cmissing-method'></span><span id='topic++5B+5B+3C-+2CSpectra+2CANY+2Cmissing-method'></span><span id='topic++5B+3C-+2CSpectraDataFrame-method'></span><span id='topic++24+3C-+2CSpectra-method'></span><span id='topic++24+2CSpectraDataFrame-method'></span><span id='topic++5B+5B+3C-+2CSpectra+2CANY+2Cmissing+2CANY-method'></span>

<h3>Description</h3>

<p>These methods emulates classic base methods '[', '[[' and '$' to extract or replace parts of Spectra* objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>\S4method{[}{Spectra}(x,i,j,...,drop=FALSE)
\S4method{[[}{Spectra}(x,i,j,...)
\S4method{$}{SpectraDataFrame}(x,name)
\S4method{$}{Spectra}(x,name) &lt;- value
\S4method{[[}{Spectra}(x,i,j,...) &lt;- value
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="extraction-methods_+3A_x">x</code></td>
<td>
<p>an object of class <code>Spectra</code> or <code>SpectraDataFrame</code></p>
</td></tr>
<tr><td><code id="extraction-methods_+3A_i">i</code>, <code id="extraction-methods_+3A_j">j</code>, <code id="extraction-methods_+3A_...">...</code></td>
<td>
<p>indices specifying elements to extract or replace</p>
</td></tr>
<tr><td><code id="extraction-methods_+3A_drop">drop</code></td>
<td>
<p>currently ignored</p>
</td></tr>
<tr><td><code id="extraction-methods_+3A_name">name</code></td>
<td>
<p>A literal character string or a name (possibly backtick quoted)</p>
</td></tr>
<tr><td><code id="extraction-methods_+3A_value">value</code></td>
<td>
<p>typically an array-like R object of a similar class as x</p>
</td></tr>
</table>


<h3>Value</h3>

<p>These methods either return an object of the same class as <code>x</code>,
or can promote a <code>Spectra</code> object to a <code>SpectraDataFrame</code> object
by adding data (&quot;[[&lt;-&quot; and &quot;$&lt;-&quot; methods).
</p>


<h3>Methods</h3>


<p><b>x=Spectra</b>
</p>
<p><code>x[i, j, ..., drop = FALSE]</code>
</p>
<p><code>x$name &lt;- value</code>
</p>
<p><code>x[[name]] &lt;- value</code>
</p>

<table>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>x</code> </td><td style="text-align: left;"> A <code>Spectra</code> object </td>
</tr>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>i</code>
</td><td style="text-align: left;"> Row index of the selected individuals </td>
</tr>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>j</code> </td><td style="text-align: left;"> Selected
wavelengths </td>
</tr>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>name</code> </td><td style="text-align: left;"> A literal character string or a name
</td>
</tr>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>...</code> </td><td style="text-align: left;"> Ignored </td>
</tr>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>drop</code> </td><td style="text-align: left;"> Ignored </td>
</tr>
<tr>
 <td style="text-align: right;"> </td>
</tr>

</table>

<p><b>x=SpectraDataFrame</b>
</p>
<p><code>x[i, j, k, ..., drop = FALSE]</code>
</p>
<p><code>x[[name]]</code>
</p>
<p><code>x[[name]] &lt;- value</code>
</p>
<p><code>x$name</code>
</p>
<p><code>x$name &lt;- value</code>
</p>

<table>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>x</code> </td><td style="text-align: left;"> A <code>SpectraDataFrame</code> object </td>
</tr>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;">
<code>i</code> </td><td style="text-align: left;"> Row index of the selected individuals </td>
</tr>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>j</code> </td><td style="text-align: left;">
Selected wavelengths </td>
</tr>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>k</code> </td><td style="text-align: left;"> Selected columns in the @data
slot</td>
</tr>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>name</code> </td><td style="text-align: left;"> A literal character string or a name </td>
</tr>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;">
<code>...</code> </td><td style="text-align: left;"> Ignored </td>
</tr>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>drop</code> </td><td style="text-align: left;"> Ignored </td>
</tr>
<tr>
 <td style="text-align: right;"> </td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading example data
data(australia)
spectra(australia) &lt;- sr_no ~ ... ~ 350:2500

# Getting features information from SpectraDataFrame
australia$carbon
australia[['carbon']]

# Creating new features
australia$foo &lt;- runif(nrow(australia))
australia[['bar']] &lt;- runif(nrow(australia))

# Replacing values
australia$foo &lt;- sample(
  LETTERS[1:5], 
  size = nrow(australia), 
  replace = TRUE
)
australia[['bar']] &lt;- sample(
  c(TRUE, FALSE), 
  size = nrow(australia), 
  replace = TRUE
)

# Promote Spectra to SpectraDataFrame
s &lt;- as(australia, 'Spectra')
class(s)
s$foo &lt;- runif(nrow(s))

</code></pre>

<hr>
<h2 id='features'>Retrieves or sets the data slot of a SpectraDataFrame object.</h2><span id='topic+features'></span><span id='topic+features+3C-'></span><span id='topic+features-methods'></span><span id='topic+features+2CSpectraDataFrame-method'></span><span id='topic+features+3C-+2CSpectra-method'></span><span id='topic+features+3C-+2CSpectraDataFrame-method'></span>

<h3>Description</h3>

<p>Either retrieves the attributes values from the data slot of a
SpectraDataFrame object, or upgrades a Spectra object to a SpectraDataFrame
object by initialising its data slot by a suitable <code>"data.frame"</code>
object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'SpectraDataFrame'
features(object,exclude_id)
## S4 replacement method for signature 'Spectra'
features(object,safe,exclude_id,key,append) &lt;- value
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="features_+3A_object">object</code></td>
<td>
<p>a <code>Spectra</code> object</p>
</td></tr>
<tr><td><code id="features_+3A_exclude_id">exclude_id</code></td>
<td>
<p>see below</p>
</td></tr>
<tr><td><code id="features_+3A_value">value</code></td>
<td>
<p>see below</p>
</td></tr>
<tr><td><code id="features_+3A_safe">safe</code></td>
<td>
<p>see below</p>
</td></tr>
<tr><td><code id="features_+3A_key">key</code></td>
<td>
<p>see below</p>
</td></tr>
<tr><td><code id="features_+3A_append">append</code></td>
<td>
<p>see below</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The <code>features</code> methods return a <code>data.frame</code> object, while
the <code>"features&lt;-"</code> methods return a <code>SpectraDataFrame</code> object.
</p>


<h3>Methods</h3>


<p><b>x=Spectra</b>
</p>
<p><code>features(object, safe=TRUE, key=NULL, exclude_id=TRUE) &lt;- value</code>
</p>

<table>
<tr>
 <td style="text-align: right;"> 

</td><td style="text-align: left;"> <code>object</code> </td><td style="text-align: left;"> A <code>Spectra</code> object </td>
</tr>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;">
<code>safe</code> </td><td style="text-align: left;"> Logical. If TRUE, data is being added to the object using a
SQL join (using a key field  given by the <code>key</code> option), otherwise it is
assumed the order of the rows is consitent with the order of the rows in
<code>object</code> </td>
</tr>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>key</code> </td><td style="text-align: left;"> Character, name of the column of the
data.frame storing the ids for the SQL join. Ignored if <code>safe</code> is
<code>FALSE</code>. </td>
</tr>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>exclude_id</code> </td><td style="text-align: left;"> Logical, if <code>TRUE</code>, ids
used for the SQL join are removed from the data slot after the join.</td>
</tr>
<tr>
 <td style="text-align: right;"> 
</td>
</tr>

</table>

<p><b>x=SpectraDataFrame</b>
</p>
<p><code>features(obj, exclude_id=TRUE)</code>
</p>
<p><code>features(obj, safe=TRUE, key=NULL, exclude_id=TRUE, append=TRUE) &lt;-
value</code>
</p>

<table>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>object</code> </td><td style="text-align: left;"> A <code>SpectraDataFrame</code> object </td>
</tr>
<tr>
 <td style="text-align: right;">
</td><td style="text-align: left;"> <code>safe</code> </td><td style="text-align: left;"> Logical. If TRUE, data is being added to the object
using a SQL join (using a key field given by the <code>key</code> option),
otherwise it is assumed the order of the rows is consitent with the order of
the rows in <code>object</code> </td>
</tr>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>key</code> </td><td style="text-align: left;"> Character, name of the
column of the data.frame storing the ids for the SQL join. Ignored if
<code>safe</code> is <code>FALSE</code>. </td>
</tr>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>exclude_id</code> </td><td style="text-align: left;"> Logical. For
the <code>features</code> method, if <code>TRUE</code>, the spectra ids are added to the
<code>data.frame</code> that is returned. For the <code>"features&lt;-"</code> method, If
<code>TRUE</code>, ids used for the SQL join are removed from the data slot after
the join. </td>
</tr>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>append</code> </td><td style="text-align: left;"> Logical, if <code>TRUE</code>, the data is
appended to any existing data. if FALSE, the data provided is erasing any
existing data. </td>
</tr>
<tr>
 <td style="text-align: right;"> </td>
</tr>

</table>




<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spectra">spectra</a></code>, <code><a href="#topic+wl">wl</a></code>,
<code><a href="#topic+SpectraDataFrame-class">SpectraDataFrame-class</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading example data
data(oz)
spectra(oz) &lt;- sr_no ~ ... ~ 350:2500

# Printing available data
features(oz)

# Promoting a Spectra to a SpectraDataFrame object
s &lt;- as(oz, "Spectra")

# Generating dummy data
d &lt;- data.frame(
  id = ids(oz), 
  foo = runif(nrow(oz)), 
  bar = sample(LETTERS[1:5], size = nrow(oz), replace = TRUE)
)
head(d)

# Affecting data to Spectra object
features(s) &lt;- d
features(s)

# Adding data to an existing SpectraDataFrame object

features(oz) &lt;- d
features(oz)

</code></pre>

<hr>
<h2 id='fill_spectra'>Fill missing wavelengths of a Spectra* object with a given value</h2><span id='topic+fill_spectra'></span><span id='topic+fill_spectra+2CSpectra-method'></span>

<h3>Description</h3>

<p>Fill missing wavelengths of a Spectra* object with a given value. This is
mostly usefull to include NA values in the spectra in order to show missing
bits in plots.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'Spectra'
fill_spectra(obj, ref = NULL, fill = NA, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fill_spectra_+3A_obj">obj</code></td>
<td>
<p>an object inheriting from class <code>Spectra</code></p>
</td></tr>
<tr><td><code id="fill_spectra_+3A_ref">ref</code></td>
<td>
<p>a numeric vector, giving the reference wavelengths (ie the entire
range of wavelengths expected to be in the spectra before some waveleng5ths
have been cut out). If NULL, the function is trying to guess it.</p>
</td></tr>
<tr><td><code id="fill_spectra_+3A_fill">fill</code></td>
<td>
<p>values to fill gaps in the data with</p>
</td></tr>
<tr><td><code id="fill_spectra_+3A_...">...</code></td>
<td>
<p>ignored</p>
</td></tr>
</table>


<h3>Details</h3>

<p>At this stage removing gaps does not work well with irreguarly spaced
wavelengths. Results might be odd for binned spectra.
</p>


<h3>Value</h3>

<p>An object of the same class as <code>obj</code>
</p>


<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading example data
data(australia)
spectra(australia) &lt;- sr_no ~ ... ~ 350:2500

# Cut wavelengths out of the collection
oz &lt;- cut(australia, wl=-1*c(355:400, 2480:2499))
big.head(spectra(oz), , 7)

# Giving the wavelengths at which I want data
oz_filled &lt;- fill_spectra(oz, ref = 350:2500, fill = NA)
big.head(spectra(oz_filled), , 7)
plot(oz_filled)

# Trying to guess ref values
oz_filled &lt;- fill_spectra(oz, fill = -999)
big.head(spectra(oz_filled), , 7)
plot(oz_filled)

</code></pre>

<hr>
<h2 id='ids'>Retrieves or sets the ids of a <code>Spectra*</code> object.</h2><span id='topic+ids'></span><span id='topic+ids+3C-'></span><span id='topic+ids+2CSpectra-method'></span><span id='topic+ids+3C-+2CSpectra-method'></span><span id='topic+ids+3C-+2CSpectraDataFrame-method'></span>

<h3>Description</h3>

<p>Either retrieves the wavelengths from a <code>Spectra*</code> object, or creates a
<code>Spectra*</code> object from a <code>"data.frame"</code> object by setting some of
its columns as the wavelengths. The <code>"ids&lt;-"</code> method for 
<code>SpectraDataFrame</code> objects allows to use a formula interface to use a 
column in its <code>data</code> slot as the object IDs (see the last example provided 
in the Examples section).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ids(object, ...)
ids(object) &lt;- value

## S4 replacement method for signature 'Spectra'
ids(object) &lt;- value

## S4 replacement method for signature 'SpectraDataFrame'
ids(object) &lt;- value
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ids_+3A_object">object</code></td>
<td>
<p>an object of class <code>"Spectra"</code> or inheriting from this class</p>
</td></tr>
<tr><td><code id="ids_+3A_...">...</code></td>
<td>

<dl>
<dt><code>as.vector</code></dt><dd><p>Controls whether the IDs are returned as a vector or as a data.frame (defaults to TRUE)</p>
</dd>
</dl>
</td></tr>
<tr><td><code id="ids_+3A_value">value</code></td>
<td>
<p>character vector for new IDs</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The <code>ids</code> methods return a vector if <code>as.vector</code> is TRUE,
a <code>data.frame</code> otherwise. The <code>"ids&lt;-"</code> method return a
<code>SpectraDataFrame</code> object (or a <code>Spectra</code> object if the column in
the data slot that has been used to initiate the IDs was the only
attribute).
</p>


<h3>Methods</h3>


<ul>
<li> <p><code>ids(object, ..., as.vector = TRUE)</code> 
</p>
</li>
<li> <p><code>ids(object) &lt;- value</code> 
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading example data
data(oz)
spectra(oz) &lt;- sr_no ~ ... ~ 350:2500

# Retrieving ids
ids(oz)

# Setting ids using a vector of values
ids(oz) &lt;- seq_len(nrow(oz))
ids(oz)

# Setting ids using an attribute
oz$new_id &lt;- seq_len(nrow(oz)) + 1000
ids(oz) &lt;- ~ new_id
ids(oz)

</code></pre>

<hr>
<h2 id='kenstone'>Kennard-Stone algorithm for optimal calibration set selection.</h2><span id='topic+kenstone'></span><span id='topic+kenstone+2CSpectra-method'></span>

<h3>Description</h3>

<p>An implemnentation of the Kennard-Stone algorithm for calibration set selection.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>kenstone(x, size, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="kenstone_+3A_x">x</code></td>
<td>
<p>a <code>Spectra</code> object</p>
</td></tr>
<tr><td><code id="kenstone_+3A_size">size</code></td>
<td>
<p>a positive number, the number of items to choose from</p>
</td></tr>
<tr><td><code id="kenstone_+3A_...">...</code></td>
<td>
<p>ignored</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector of length size giving the indices of the selected
individuals in x.
</p>


<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>


<h3>References</h3>

<p>Kennard, L.A. Stone, Technometrics 11 (1969) 137.
</p>

<hr>
<h2 id='load_oz'>Load the australia dataset</h2><span id='topic+load_oz'></span>

<h3>Description</h3>

<p>Loads the australia dataset as a SpectraDataFrame
</p>


<h3>Usage</h3>

<pre><code class='language-R'>load_oz(n = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="load_oz_+3A_n">n</code></td>
<td>
<p>the number of spectra to return. By default, it returns all 100 spectra in the dataset.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a SpectraDataFrame
</p>


<h3>Author(s)</h3>

<p>Pierre Roudier
</p>


<h3>Examples</h3>

<pre><code class='language-R'>oz &lt;- load_oz()

</code></pre>

<hr>
<h2 id='melt_spectra'>Melts the spectra data of a Spectra object and returns it as wide format.</h2><span id='topic+melt_spectra'></span><span id='topic+melt_spectra-methods'></span><span id='topic+melt_spectra+2CSpectra-method'></span><span id='topic+melt_spectra+2CSpectraDataFrame-method'></span>

<h3>Description</h3>

<p>This function is very useful when wanting to plot spectra using the lattice or ggplot2 packages
</p>


<h3>Usage</h3>

<pre><code class='language-R'>melt_spectra(obj, attr=NULL, ...)

## S4 method for signature 'SpectraDataFrame'
melt_spectra(obj, attr = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="melt_spectra_+3A_obj">obj</code></td>
<td>
<p>an object of class <code>"Spectra"</code> or inheriting from this class</p>
</td></tr>
<tr><td><code id="melt_spectra_+3A_attr">attr</code></td>
<td>
<p>vector of id variables against which the spectra will be melted (see <code>melt</code>)</p>
</td></tr>
<tr><td><code id="melt_spectra_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods</p>
</td></tr>
</table>


<h3>Methods</h3>


<p><b>x=Spectra</b>
</p>
<p><code>melt_spectra(obj, ...)</code>
</p>

<table>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>obj</code> </td><td style="text-align: left;"> A <code>Spectra</code> object </td>
</tr>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;">
<code>...</code> </td><td style="text-align: left;"> Ignored </td>
</tr>
<tr>
 <td style="text-align: right;"> </td>
</tr>

</table>

<p><b>x=SpectraDataFrame</b>
</p>
<p><code>melt_spectra(obj, attr=NULL, ...)</code>
</p>

<table>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>obj</code> </td><td style="text-align: left;"> A <code>SpectraDataFrame</code> object </td>
</tr>
<tr>
 <td style="text-align: right;">
</td><td style="text-align: left;"> <code>attr</code> </td><td style="text-align: left;"> Character, the name of an attribute in the object data
to split the spectra against. </td>
</tr>
<tr>
 <td style="text-align: right;"> </td><td style="text-align: left;"> <code>...</code> </td><td style="text-align: left;"> Ignored </td>
</tr>
<tr>
 <td style="text-align: right;"> </td>
</tr>

</table>




<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>


<h3>References</h3>

<p>Hadley Wickham (2011). The Split-Apply-Combine Strategy for Data
Analysis. Journal of Statistical Software, 40(1), 1-29. URL
http://www.jstatsoft.org/v40/i01/.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading example data
data(australia)
spectra(australia) &lt;- sr_no ~ ... ~ 350:2500

# Simple melt
r &lt;- melt_spectra(australia)
head(r)

## Not run: 
# Melt against some factor (or continuous data), and plot
# using ggplot2

# Create some factor
australia$fact &lt;- sample(
  LETTERS[1:3], 
  size = nrow(australia), 
  replace = TRUE
)
r &lt;- melt_spectra(australia, attr = 'fact')

# Create plot
library(ggplot2)
p &lt;- ggplot(r) + 
  geom_line(aes(x=wl, y=nir, group=id, colour=fact)) + 
  theme_bw()
print(p)

## End(Not run)

</code></pre>

<hr>
<h2 id='mutate'>Mutate a Spectra* object by transforming the spectra values, and/or adding
new or replacing existing attributes.</h2><span id='topic+mutate'></span><span id='topic+mutate.Spectra'></span><span id='topic+mutate+2CSpectra-method'></span>

<h3>Description</h3>

<p>This function is very similar to <code>transform</code> but it executes the
transformations iteratively so that later transformations can use the
columns created by earlier transformations. Like transform, unnamed
components are silently dropped.
</p>
<p>Either the spectra, and/or the attributes (if the <code>.data</code> inherits from
the <code>SpectraDataFrame</code> class) can be affected: </p>
 <ul>
<li><p> To
affect the spectra, one should use the <code>nir</code> placeholder, eg <code>nir
= log(1/nir)</code> </p>
</li>
<li><p> To affect the attributes of the object, the definitions
of new columns are simply given using attributes names, <code>newAttribute =
1/sqrt(attribute)</code> </p>
</li>
<li><p> Both spectra and attrbutes can be transformed in
one command.</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'Spectra'
mutate(.data, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mutate_+3A_.data">.data</code></td>
<td>
<p>an object inheriting from the <code>Spectra</code> class</p>
</td></tr>
<tr><td><code id="mutate_+3A_...">...</code></td>
<td>
<p>named parameters giving definitions of new columns</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>, from code from
Hadley Wickham
</p>


<h3>References</h3>

<p>Hadley Wickham (2011). The Split-Apply-Combine Strategy for Data
Analysis. Journal of Statistical Software, 40(1), 1-29. URL
http://www.jstatsoft.org/v40/i01/.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading example data
data(australia)
spectra(australia) &lt;- sr_no ~ ... ~ 350:2500

# Modifying spectra
m &lt;- mutate(australia, nir = log1p(1/nir))
plot(m)

# Modifying and creating attributes
m &lt;- mutate(
  australia, 
  sqrt_carbon = sqrt(carbon), 
  foo = clay + ph, 
  nir = log1p(1/nir)
)
plot(m)
</code></pre>

<hr>
<h2 id='plot_offset'>Offset plot of a collection of spectra</h2><span id='topic+plot_offset'></span><span id='topic+plot_offset+2CSpectra-method'></span>

<h3>Description</h3>

<p>Creates an offset plot of a collection of Spectra
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_offset(x, offset = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_offset_+3A_x">x</code></td>
<td>
<p>an object of class <code>"Spectra"</code> or inheriting from this class</p>
</td></tr>
<tr><td><code id="plot_offset_+3A_offset">offset</code></td>
<td>
<p>Offset between spectra</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Pierre Roudier
</p>


<h3>Examples</h3>

<pre><code class='language-R'> oz &lt;- load_oz(3)
 plot_offset(oz)
 plot_offset(oz, 0.3)
 plot_offset(oz, 2)
</code></pre>

<hr>
<h2 id='plot_stack'>Stacked plot of a collection of spectra</h2><span id='topic+plot_stack'></span><span id='topic+plot_stack+2CSpectra-method'></span>

<h3>Description</h3>

<p>Creates a stacked plot of a collection of Spectra
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_stack(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_stack_+3A_x">x</code></td>
<td>
<p>an object of class <code>"Spectra"</code> or inheriting from this class</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Pierre Roudier
</p>


<h3>Examples</h3>

<pre><code class='language-R'> oz &lt;- load_oz(3)
 plot_stack(oz)
</code></pre>

<hr>
<h2 id='plot_summary'>Summary plot of a collection of spectra</h2><span id='topic+plot_summary'></span><span id='topic+plot_summary+2CSpectra-method'></span>

<h3>Description</h3>

<p>Creates a summary plot of a collection of Spectra
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_summary(x, fun = mean, se = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_summary_+3A_x">x</code></td>
<td>
<p>an object of class <code>"Spectra"</code> or inheriting from this class</p>
</td></tr>
<tr><td><code id="plot_summary_+3A_fun">fun</code></td>
<td>
<p>an aggregation function</p>
</td></tr>
<tr><td><code id="plot_summary_+3A_se">se</code></td>
<td>
<p>if TRUE, plots the standard deviation around the summary spectra
(computed by function as given by <code>fun</code>). If FALSE, does not plot
dispersion information. If a function, uses this function instead of
<code>sd</code>.</p>
</td></tr>
<tr><td><code id="plot_summary_+3A_...">...</code></td>
<td>
<p>additional parameters, currently ignored</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Pierre Roudier
</p>


<h3>Examples</h3>

<pre><code class='language-R'> oz &lt;- load_oz()
 plot_summary(oz)
</code></pre>

<hr>
<h2 id='plot-Spectra'>Plots an object inheriting from the Spectra class</h2><span id='topic+plot-Spectra'></span><span id='topic+plot'></span><span id='topic+plot.Spectra'></span><span id='topic+plot+2CSpectra+2CANY-method'></span>

<h3>Description</h3>

<p>The philosophy of this plotting routine is to provide a &quot;quick'n'dirty&quot; way
to plot your spectra collection. For advanced visualisations, the use of
<code><a href="#topic+melt_spectra">melt_spectra</a></code> alongside with ggplot2 or lattice is encouraged.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'Spectra'
plot(x,gg,gaps,attr,...)

## S3 method for class 'Spectra'
plot(x, gg = FALSE, gaps = TRUE, attr = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot-Spectra_+3A_x">x</code></td>
<td>
<p>an object of class <code>"Spectra"</code> or inheriting from this class</p>
</td></tr>
<tr><td><code id="plot-Spectra_+3A_gg">gg</code></td>
<td>
<p>if TRUE, uses the <code>ggplot2</code> package to plot the data, if
FALSE uses <code>matplot</code> from base graphics (much faster)</p>
</td></tr>
<tr><td><code id="plot-Spectra_+3A_gaps">gaps</code></td>
<td>
<p>if TRUE, gaps in the spectra are not plotted</p>
</td></tr>
<tr><td><code id="plot-Spectra_+3A_attr">attr</code></td>
<td>
<p>attribute against which lines are coloured (only for <code>gg =
TRUE</code></p>
</td></tr>
<tr><td><code id="plot-Spectra_+3A_...">...</code></td>
<td>
<p>additional parameters passed to <code>matplot</code></p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading example data
data(australia)
spectra(australia) &lt;- sr_no ~ ... ~ 350:2500

# Default plotting method
plot(australia[1:5,])

# Default plot using ggplot2
plot(australia[1:5,], gg = TRUE)

## Not run: 

# Managing gaps in the spectra
s &lt;- cut(australia, wl =c(-1*450:500, -1*1800:2050))
plot(s, gaps = TRUE)
plot(s, gaps = FALSE)

# passing various options to matplot
plot(
  australia, 
  lty = 1:5, 
  col = 'blue', 
  xlab = 'foo', ylab = 'bar', 
  ylim = c(0.4,0.6), 
  main = 'my plot'
)

# Using colour ramps
plot(
  australia, 
  lty = 1, 
  col = rainbow(10), 
  main = "It is possible to create really ugly visualisations"
)

# Example using colours given by ColorBrewer (http://colorbrewer2.org/)
library(RColorBrewer)
plot(australia, lty = 1, col = brewer.pal(n = 8, name = "Set2"))

# Using an attribute to group spectra

# Generate some kind of factor
australia$fact &lt;- sample(
  LETTERS[1:3], 
  size = nrow(australia), 
  replace = TRUE
) 

s &lt;- aggregate_spectra(australia, fun = mean, id = 'fact')
plot(s, gg = TRUE, attr = 'fact')

## End(Not run)
</code></pre>

<hr>
<h2 id='postResampleSpectro'>Calculates performance indictors across resamples</h2><span id='topic+postResampleSpectro'></span><span id='topic+spectroSummary'></span>

<h3>Description</h3>

<p>Given two numeric vectors of data, the root mean squared error, the R-squared, the bias, the RPD, the RPIQ, the CCC and the standard error are calculated. For two factors, the overall agreement rate and Kappa are determined.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>postResampleSpectro(pred, obs)
spectroSummary(data, lev = NULL, model = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="postResampleSpectro_+3A_data">data</code></td>
<td>
<p>a data frame or matrix with columns obs and pred for the observed and predicted outcomes</p>
</td></tr>
<tr><td><code id="postResampleSpectro_+3A_lev">lev</code></td>
<td>
<p>a character vector of factors levels for the response. In regression cases, this would be NULL.</p>
</td></tr>
<tr><td><code id="postResampleSpectro_+3A_model">model</code></td>
<td>
<p>a character string for the model name</p>
</td></tr>
<tr><td><code id="postResampleSpectro_+3A_pred">pred</code></td>
<td>
<p>A vector of numeric data</p>
</td></tr>
<tr><td><code id="postResampleSpectro_+3A_obs">obs</code></td>
<td>
<p>A vector of numeric data</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function extends <code>postResample</code> in the <code>caret</code> package.
</p>


<h3>Author(s)</h3>

<p>Pierre Roudier, adapted from code from Max Kuhn
</p>


<h3>Examples</h3>

<pre><code class='language-R'>predicted &lt;-  matrix(rnorm(50), ncol = 5)
observed &lt;- rnorm(10)
apply(predicted, 2, postResampleSpectro, obs = observed)
</code></pre>

<hr>
<h2 id='rbind'>Stacking <code>Spectra</code> objects together</h2><span id='topic+rbind'></span><span id='topic+rbind.Spectra'></span><span id='topic+rbind.SpectraDataFrame'></span>

<h3>Description</h3>

<p>This method stacks two or more <code>Spectra*</code> objects together.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'Spectra'
rbind(..., create_new_ids = FALSE, new_ids = NULL)

## S3 method for class 'SpectraDataFrame'
rbind(..., create_new_ids = FALSE, new_ids = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rbind_+3A_...">...</code></td>
<td>
<p>The <code>Spectra</code> objects to be combined.</p>
</td></tr>
<tr><td><code id="rbind_+3A_create_new_ids">create_new_ids</code></td>
<td>
<p>allows creation of new ids if the ids of the
<code>Spectra*</code> objects you are trying to stack are redundant</p>
</td></tr>
<tr><td><code id="rbind_+3A_new_ids">new_ids</code></td>
<td>
<p>vector of new ids to be given to the new object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>Spectra*</code> object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading example data
data(australia)
spectra(australia) &lt;- sr_no ~ ... ~ 350:2500

s &lt;- rbind(australia, australia, create_new_ids = TRUE)

l &lt;- separate(australia, calibration = 0.6)
s &lt;- rbind(l$validation, l$calibration)
</code></pre>

<hr>
<h2 id='res+2Cnumeric-method'>Spectral resolution</h2><span id='topic+res+2Cnumeric-method'></span><span id='topic+res+2Cinteger-method'></span><span id='topic+res'></span><span id='topic+res+2CSpectra-method'></span><span id='topic+res+2CSpectraDataFrame-method'></span>

<h3>Description</h3>

<p>Returns the spectral resolution of an object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'numeric'
res(x)

## S4 method for signature 'integer'
res(x)

## S4 method for signature 'Spectra'
res(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="res+2B2Cnumeric-method_+3A_x">x</code></td>
<td>
<p>object an object inheriting from <code>Spectra</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>a vector
</p>


<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>

<hr>
<h2 id='separate'>Separates a <code>Spectra*</code> object into a calibration and a validation set.</h2><span id='topic+separate'></span><span id='topic+separate.Spectra'></span><span id='topic+separate+2CSpectra-method'></span>

<h3>Description</h3>

<p>Separates a <code>Spectra*</code> object into a calibration and a validation set.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'Spectra'
separate(obj, calibration)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="separate_+3A_obj">obj</code></td>
<td>
<p>an object inheriting from class <code>SpectraDataFrame</code></p>
</td></tr>
<tr><td><code id="separate_+3A_calibration">calibration</code></td>
<td>
<p>The fraction of the dataset to be put in the calibration
set</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An list with two <code>SpectraDataFrame</code> objects, one for the
calibration, and the other for the validation.
</p>


<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading example data
data(australia)
spectra(australia) &lt;- sr_no ~ ... ~ 350:2500

l &lt;- separate(australia, calibration=0.7)
# The result is a list of two Spectra* objects
str(l)
lapply(l, nrow)
</code></pre>

<hr>
<h2 id='snv'>Standard and Robust Normal Variate transformations</h2><span id='topic+snv'></span><span id='topic+rnv'></span>

<h3>Description</h3>

<p>Standard and Robust Normal Variate transformations are often used in
chemometrics to normalise a spectra collection and remove the baseline
effect.
</p>
<p>The Standard Normal Variate transformation (SNV, Barnes et al., 1989) is a
common method to reduce within-class variance.
</p>
<p>The Robust Normal Variate transformation (RNV, Guo et al., 1999) is a
modification of the SNV to make it more robust to closure problems.
</p>
<p>These function are to be used in conjonction with
<code>apply_spectra</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>snv(x)

rnv(x, r)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="snv_+3A_x">x</code></td>
<td>
<p>a vector of numeric values</p>
</td></tr>
<tr><td><code id="snv_+3A_r">r</code></td>
<td>
<p>the percentile to use in the RNV computation</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector of numeric values
</p>


<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>


<h3>References</h3>

 
<ul>
<li><p> Barnes, R.J., Dhanoa, M.S., Lister, S.J. 1989.
Standard normal variate transformation and detrending of near-infra-red
diffuse reflectance spectra. Applied Spectroscopy 43, 772&ndash;777.
</p>
</li>
<li><p> Guo, Q., Wu, W., Massar, D.L. 1999. The robust normal variate
transform for pattern recognition with near-infrared data. Analytica Chimica
Acta 382:1&ndash;2, 87&ndash;103.  
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
# Loading example data
data(australia)
spectra(australia) &lt;- sr_no ~ ... ~ 350:2500

# Standard Normal Variate transform
s &lt;- apply_spectra(australia[1:10,], snv)
plot(s)

# The scale function in the base package is actually doing
# the same thing!
s &lt;- apply_spectra(australia[1:10,], scale, center = TRUE, scale = TRUE)
plot(s)

# Robust Normal Variate transform
s &lt;- apply_spectra(australia[1:10,], rnv, r = 0.25)
plot(s)

</code></pre>

<hr>
<h2 id='Spectra'>Constructor for the Spectra class.</h2><span id='topic+Spectra'></span>

<h3>Description</h3>

<p>Constructor for the Spectra class. Creates a Spectra object from scratch.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Spectra(wl = numeric(), nir = matrix(), id = as.character(NA), units = "nm")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Spectra_+3A_wl">wl</code></td>
<td>
<p>a numeric vector giving the wavelengths at with the spectra have
been measured</p>
</td></tr>
<tr><td><code id="Spectra_+3A_nir">nir</code></td>
<td>
<p>a <code>"matrix"</code> or a <code>"data.frame"</code> object giving the
spectra values for each sample</p>
</td></tr>
<tr><td><code id="Spectra_+3A_id">id</code></td>
<td>
<p>a vector giving the unique id of each sample in the collection</p>
</td></tr>
<tr><td><code id="Spectra_+3A_units">units</code></td>
<td>
<p>a character giving the unit in which the wavelengths values are
expressed</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a new <code>"Spectra"</code> object
</p>


<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code>spectra</code>, <code>wl</code>,
<code>Spectra-class</code>, <code>SpectraDataFrame</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  wls &lt;- 350:2500
  id &lt;- c("A", "B")
  nir &lt;- matrix(runif(2*length(wls)), nrow = 2)
  s &lt;- Spectra(wl = wls, nir = nir, id = id, units = "nm")

</code></pre>

<hr>
<h2 id='Spectra-class'>Spectra* classes</h2><span id='topic+Spectra-class'></span><span id='topic+spectacles'></span><span id='topic+SpectraDataFrame-class'></span><span id='topic+as.data.frame.Spectra'></span><span id='topic+as.data.frame.SpectraDataFrame'></span><span id='topic+as.data.frame.SpatialSpectra'></span><span id='topic+names.SpectraDataFrame'></span><span id='topic+names+3C-.SpectraDataFrame'></span><span id='topic+print+2CSpectra-method'></span><span id='topic+show+2CSpectra-method'></span>

<h3>Description</h3>

<p>The spectacles package provides the user with S4 classes that have been
developped to store and manipulate spectroscopy data.
</p>
<p>The <code>Spectra</code> class is storing the spectra matrix, along with the
wavelengths at which those have been measured, the units in whioch those
wavelengths are expressed, and a unique id for each sample in the
collection.
</p>
<p>The <code>SpectraDataFrame</code> class is extending the <code>Spectra</code> class by
giving the opportunity to store attribute data along with the spectra - this
is mostly the case when we want to predict physical or chemical properties
from the spectra set.
</p>
<p>The <code>SpatialSpectra</code> and <code>SpatialSpectraDataFrame</code> classes are
extending the <code>Spectra</code> and <code>SpectraDataFrame</code> classes using the
<code>SpatialPoints</code> class from package sp. This allows to store spatial
information on the dataset: coordinates, coordinate reference system,
bounding box, etc.
</p>
<p>Common generic methods implemented for these classes include:
</p>
<p><code>summary</code>, <code>show</code>, <code>nrow</code>, <code>length</code>, <code>plot</code>,
<code>[</code>, <code>[[</code>, <code>$</code>.
</p>
<p><code>SpatialPoints</code> methods from the sp package can be applied to
<code>SpatialSpectra</code> and <code>SpatialSpectraDataFrame</code> objects are they
inherit from this class.
</p>


<h3>Slots</h3>


<dl>
<dt><code>wl</code></dt><dd><p>object of class &quot;<code>numeric</code>&quot;; the wavelengths at which the spectra has been measured</p>
</dd>
<dt><code>nir</code></dt><dd><p>object of class &quot;<code>matrix</code>&quot;; the spectra, with as many columns as wavelengths, and as many rows as samples</p>
</dd>
<dt><code>id</code></dt><dd><p>object of class &quot;<code>data.frame</code>&quot; with one attribute; the identification strings for each sample in the collection</p>
</dd>
<dt><code>units</code></dt><dd><p>object of class &quot;<code>character</code>&quot;; units in which the wavelengths are expressed</p>
</dd>
<dt><code>data</code></dt><dd><p>object of class data.frame containing the attribute data</p>
</dd>
</dl>


<h3>Objects from the Class</h3>

<p>Objects can be created by calls of the form
<code>new("Spectra", ...)</code>, with the constructor functions like
<code>Spectra(...)</code>, or with the helper functions such as <code>wl</code> and
<code>spectra</code>.
</p>


<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
showClass("Spectra")
showClass("SpectraDataFrame")

</code></pre>

<hr>
<h2 id='spectra-methods'>Retrieves or sets the spectra of a <code>Spectra*</code> objects.</h2><span id='topic+spectra-methods'></span><span id='topic+spectra'></span><span id='topic+spectra+3C-'></span><span id='topic+spectra+2Cdata.frame-method'></span><span id='topic+spectra+2CSpectra-method'></span><span id='topic+spectra+2CSpectraDataFrame-method'></span><span id='topic+spectra+3C-+2Cdata.frame-method'></span><span id='topic+spectra+3C-+2CSpectra-method'></span>

<h3>Description</h3>

<p>Either retrieves the spectra matrix from a <code>Spectra*</code> object, or
creates a <code>Spectra*</code> object from a <code>"data.frame"</code> object different
interfaces detailed below.When applied to a <code>Spectra*</code> object, this functions simply returns the spectra it is storing.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'Spectra'
spectra(object)

## S4 replacement method for signature 'data.frame'
spectra(object, ...) &lt;- value

## S4 replacement method for signature 'Spectra'
spectra(object) &lt;- value
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="spectra-methods_+3A_object">object</code></td>
<td>
<p>an object of class <code>"Spectra"</code> or inheriting from this class</p>
</td></tr>
<tr><td><code id="spectra-methods_+3A_...">...</code></td>
<td>
<p>see details below</p>
</td></tr>
<tr><td><code id="spectra-methods_+3A_value">value</code></td>
<td>
<p>see details below</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If applied on a <code>"data.frame"</code> object, it is an helper function to
create a <code>Spectra*</code> object. Two kind of interfaces are then available.
<code>value</code> can be: 
</p>

<dl>
<dt>a vector:</dt><dd><p>Similarly to <code>wl</code>, the wavelengths of the spectra can be passed by a <code>"numeric"</code> vector. Alternatively, the names of the columns that contain the spectra information can be passed as a <code>"character"</code> vector.</p>
</dd>
<dt>a formula:</dt><dd><p>This interface is specific to inspectr. It follows a
scheme where differents parts can be observed, the id column, the attributes
columns, and the spectra columns, described by the wavelengths at which it
has been measured:</p>
</dd>
</dl>

<ul>
<li> <p><b>Placeholders:</b> 
</p>

<ul>
<li> <p><code>...</code> placeholder for all the columns of your data.frame object except those that have been already used in other parts of the formula. This can lead to errors. E.g. if <code>object</code> has data one every wavelength between 350 and 2500 nm, <code>spectra(object) &lt;- id_field ~ ... ~ 500:2500</code> will stores the columns corresponding to the wavelengths 350-499 nm in its data slot!
</p>
</li>
<li> <p><code>id</code> For the creation of a <code>SpectraDataFrame</code>, it is important to always specify an id field in the formula. If no id column is present, the <code>id</code> placeholder will create one for you.
</p>
</li></ul>

</li>
<li> <p><code>spectra(object) &lt;- ~ 350:2500</code> will build a <code>Spectra</code> object from the wavelengths between 350 and 2500, based on the column names.
</p>
</li>
<li> <p><code>spectra(object) &lt;- ~ 350:2:2500</code> will build a <code>Spectra</code> object from the wavelengths in <code>seq(350, 2500, by = 2)</code>
</p>
</li>
<li> <p><code>spectra(object) &lt;- ~ 500:2350</code> will build a <code>Spectra</code> object from the wavelengths between 500 and 2350, even though other wavelengths are present (they will be dropped)
</p>
<p>In the three later cases, the id field has been dropped (it will be automatically created). If you want to use a column of <code>"data.frame"</code> as an id filed, you can still use the first part of the formula:
</p>
</li>
<li> <p><code>spectra(object) &lt;- id_field ~ 350:2500</code> 
</p>
</li>
<li> <p><code>spectra(object) &lt;- id_field ~ 350:5:2500</code>
</p>
<p>Some data can also be added to the object, which will then be of <code>SpectraDataFrame</code> class:
</p>
</li>
<li> <p><code>spectra(object) &lt;- id_field ~ property1 ~ 500:2300</code> will create a <code>SpectraDataFrame</code> with ids from the id_field column, data from the property1 column, and spectral information between 500 and 2300 nm. That means that data property2, and all spectral information from bands &lt; 500 nm or &gt; 2300 nm will be dropped
</p>
<p>You can also combine the placeholders:
</p>
</li>
<li> <p><code>spectra(object) &lt;- id_field ~ ... ~ 350:2500</code> will create a <code>SpectraDataFrame</code> object with ids from the id_field column, all spectral bands between 350 and 2500 nm. The data slot is given all the remaining columns.  
</p>
</li></ul>




<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading example data
data(oz)
class(oz) # this is a simple data.frame
# structure of the data.frame: it is rowwise-formatted
big.head(oz) 

## CREATING Spectra OBJECTS
##

# Using spectra() to initiate a Spectra from 
# the data.frame
spectra(oz) &lt;- sr_no ~ 350:2500

# It is possible to select wavelengths using the formula interface
data(oz)
spectra(oz) &lt;- sr_no ~ 350:5:2500

data(oz)
spectra(oz) &lt;- sr_no ~ 500:1800

## CREATING SpectraDataFrame OBJECTS
##

# Using spectra() to initiate a SpectraDataFrame from 
# the data.frame
data(oz)
spectra(oz) &lt;- sr_no ~ carbon + ph + clay ~ 350:2500

# Selecting data to be included in the SpectradataFrame object
data(oz)
spectra(oz) &lt;- sr_no ~ carbon ~ 350:2500

# Forcing the creation of new ids using the id keyword in the 
# formula interface
data(oz)
spectra(oz) &lt;- id ~ carbon ~ 350:2500
ids(oz, as.vector = TRUE)

# Using the "..." short-hand to select all the remaining columns
data(oz)
spectra(oz) &lt;- sr_no ~ ... ~ 350:2500

## CREATING Spectra OBJECTS FROM
## BY-COLS-FORMATTED DATA
##

# For data formatted in the colwise format, 
# use the "colwise" mode

# Transforming data into colwise format
# for demonstration's sake
#
m &lt;- melt_spectra(oz)
oz_by_col &lt;- reshape2::acast(m, ... ~ sr_no)
oz_by_col &lt;- data.frame(
  wl = rownames(oz_by_col), 
  oz_by_col, 
  check.names = FALSE)

# Here's colwise-formatted data 
big.head(oz_by_col)

# Convert it into Spectra object
spectra(oz_by_col, mode = "colwise") &lt;- wl ~ ...

# Then data can be added to promote it as a SpectraDataFrame
my.data &lt;- features(oz)
features(oz_by_col) &lt;- my.data

</code></pre>

<hr>
<h2 id='SpectraDataFrame'>Constructor for the SpectraDataFrame class.</h2><span id='topic+SpectraDataFrame'></span>

<h3>Description</h3>

<p>Constructor for the SpectraDataFrame class. Creates a SpectraDataFrame
object, either from scratch, or from an existing Spectra object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SpectraDataFrame(
  ...,
  wl = numeric(),
  nir = matrix(),
  id = as.character(NA),
  units = "nm",
  data = data.frame()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="SpectraDataFrame_+3A_...">...</code></td>
<td>
<p>an object inheriting from <code>"Spectra"</code></p>
</td></tr>
<tr><td><code id="SpectraDataFrame_+3A_wl">wl</code></td>
<td>
<p>a numeric vector giving the wavelengths at with the spectra have
been measured</p>
</td></tr>
<tr><td><code id="SpectraDataFrame_+3A_nir">nir</code></td>
<td>
<p>a <code>"matrix"</code> or a <code>"data.frame"</code> object giving the
spectra values for each sample</p>
</td></tr>
<tr><td><code id="SpectraDataFrame_+3A_id">id</code></td>
<td>
<p>a vector giving the unique id of each sample in the collection</p>
</td></tr>
<tr><td><code id="SpectraDataFrame_+3A_units">units</code></td>
<td>
<p>a character giving the unit in which the wavelengths values are
expressed</p>
</td></tr>
<tr><td><code id="SpectraDataFrame_+3A_data">data</code></td>
<td>
<p>object of class <code>"data.frame"</code> containing the attribute
data</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a new <code>"SpectraDataFrame"</code> object
</p>


<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spectra">spectra</a></code>, <code><a href="#topic+wl">wl</a></code>,
<code><a href="#topic+Spectra-class">Spectra-class</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  # Creating a SpectraDataFrame object from scratch
  my.wl &lt;- 350:2500
  my.id &lt;- c("A", "B")
  my.nir &lt;- matrix(runif(2*length(my.wl)), nrow=2)
  my.data &lt;- data.frame(foo = runif(2), bar = LETTERS[1:2])
  my.sdf &lt;- SpectraDataFrame(wl = my.wl, nir = my.nir, id = my.id, data = my.data)

  # Creating a SpectraDataFrame object from an existing Spectra object
  my.s &lt;- Spectra(wl = my.wl, nir = my.nir, id = my.id)
  my.sdf &lt;- SpectraDataFrame(my.s, data = my.data)

</code></pre>

<hr>
<h2 id='splice'>Splice correction of a spectra collected using ASD hardware</h2><span id='topic+splice'></span><span id='topic+splice+2CSpectra-method'></span>

<h3>Description</h3>

<p>This is the correction method available in the ViewSpec Pro
software from ASD, which aims at correcting steps in the data (see details).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'Spectra'
splice(x, locations = list(c(750, 1000), c(1830, 1950)))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="splice_+3A_x">x</code></td>
<td>
<p>a <code>Spectra</code> object</p>
</td></tr>
<tr><td><code id="splice_+3A_locations">locations</code></td>
<td>
<p>the wavelengths to cut out and interpolate</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The SWIR1 part of the spectrum (1000-1800 nm) is taken as a reference 
for corrections as it is stable to the instrument sensitivity drift (Beal and Eamon, 2010)
</p>
<p>This is based on a description of the splice correction algorithm described in:
</p>
<p>Beal, D. and Eamon, M., 1996. Dynamic, Parabolic Linear Transformations of 
'Stepped' Radiometric Data. Analytical Spectral Devices Inc., Boulder, CO.
</p>


<h3>Value</h3>

<p>an object of same class as x
</p>


<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(australia)
spectra(australia) &lt;- sr_no ~ ... ~ 350:2500
oz_spliced &lt;- splice(australia)
plot(oz_spliced)

</code></pre>

<hr>
<h2 id='split'>Split a Spectra* object using factors</h2><span id='topic+split'></span><span id='topic+split.Spectra'></span><span id='topic+split+2CSpectra-method'></span>

<h3>Description</h3>

<p>Splits a Spectra* object into groups using a factor, either a provided as a vector or as an attribute in the features of the object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'Spectra'
split(x, f, drop = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="split_+3A_x">x</code></td>
<td>
<p>Spectra object</p>
</td></tr>
<tr><td><code id="split_+3A_f">f</code></td>
<td>
<p>either a vector of factors (for objects inheriting from
<code>Spectra</code>), or the name or indice of an attribute in the data slot of
an object inheriting from <code>SpectraDataFrame</code></p>
</td></tr>
<tr><td><code id="split_+3A_drop">drop</code></td>
<td>
<p>ignored</p>
</td></tr>
<tr><td><code id="split_+3A_...">...</code></td>
<td>
<p>further potential arguments passed to methods.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is an adaptation of the <code>split</code> function in the base package.
</p>


<h3>Value</h3>

<p>A list of objects of same class as <code>x</code>.
</p>


<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading example data
data(australia)
spectra(australia) &lt;- sr_no ~ ... ~ 350:2500

# On a Spectra object, we need to provide a vector of factors
# to split the object
s &lt;- as(australia, 'Spectra')
# We make up some kind of factor to split the data. 
idx &lt;- sample(letters[1:5], replace = TRUE, size = nrow(s)) # This is a vector
r &lt;- split(s, idx)
str(r)

# On a SpectradataFrame object, we can also provide the name or index 
# of an attribute

# Generate some kind of factor
australia$fact &lt;- sample(LETTERS[1:3], size = nrow(australia), replace = TRUE) 
r &lt;- split(australia, 'fact')
str(r)

# A list is returned, and is thus ready for use with lapply, or any
# of the l*ply functions from the plyr package
lapply(r, nrow)
</code></pre>

<hr>
<h2 id='subset'>Subset SpectraDataFrame object</h2><span id='topic+subset'></span><span id='topic+subset.SpectraDataFrame'></span><span id='topic+subset+2CSpectraDataFrame-method'></span>

<h3>Description</h3>

<p>Returns subsets of a SpectraDataFrame object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>subset(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="subset_+3A_x">x</code></td>
<td>
<p>SpectraDataFrame object</p>
</td></tr>
<tr><td><code id="subset_+3A_...">...</code></td>
<td>
<p>see details below</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Additional parameters:
</p>

<dl>
<dt>subset</dt><dd><p>logical expression indicating elements or rows to keep: missing values are taken as false</p>
</dd>
<dt>select</dt><dd><p>expression, indicating columns to select from the data slot</p>
</dd>
<dt>drop</dt><dd><p>passed on to &quot;[&quot; indexing operator</p>
</dd>
<dt>...</dt><dd><p>Additional arguments</p>
</dd>
</dl>



<h3>Value</h3>

<p>SpectraDataFrame object
</p>


<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mutate">mutate</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading example data
data(australia)
spectra(australia) &lt;- sr_no ~ ... ~ 350:2500

# Subset on attributes
s &lt;- subset(australia, carbon &lt; 5)

# Subset and selection of attributes
s &lt;- subset(australia, carbon &lt; 5, select = 1)
</code></pre>

<hr>
<h2 id='summary'>Summary</h2><span id='topic+summary'></span><span id='topic+summary.Spectra'></span><span id='topic+print.summary.Spectra'></span>

<h3>Description</h3>

<p>Summarize a Spectra* object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>\method{summary}{Spectra}(object, ...)

## S3 method for class 'summary.Spectra'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary_+3A_object">object</code></td>
<td>
<p>an object of class <code>Spectra</code> or <code>SpectraDataFrame</code></p>
</td></tr>
<tr><td><code id="summary_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code>summary</code></p>
</td></tr>
<tr><td><code id="summary_+3A_x">x</code></td>
<td>
<p>a result of <code>summary</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>"summary.Spectra"</code> object
</p>
<p><code>NULL</code>
</p>


<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(oz)
spectra(oz) &lt;- sr_no ~ ... ~ 350:2500
summary(oz)

</code></pre>

<hr>
<h2 id='wl'>Retrieves or sets the wavelengths of a <code>Spectra*</code> object.</h2><span id='topic+wl'></span><span id='topic+wl+3C-'></span><span id='topic+wl+2CSpectra-method'></span><span id='topic+wl+3C-+2CSpectra-method'></span><span id='topic+wl+3C-+2Cdata.frame-method'></span>

<h3>Description</h3>

<p>Either retrieves the wavelengths from a <code>Spectra*</code> object, or creates a
<code>Spectra*</code> object from a <code>"data.frame"</code> object by setting some of
its columns as the wavelengths.
</p>
<p>When applied to a <code>Spectra*</code> object, this functions simply returns the
wavelengths of the spectra it is storing.
</p>
<p>If applied on a <code>"data.frame"</code> object, it is an helper function to
create a <code>Spectra*</code> object. It then needs to be indicated the
wavelengths at which the spectra values are measured. The assumption is that
each row of the <code>"data.frame"</code> is a spectra, and the column names of
the <code>"data.frame"</code> contain the wavelengths values.
</p>
<p>If all the columns are used to create the <code>Spectra*</code> object, a
<code>Spectra</code> object is created. If some attributes are left, they will be
used to generate a <code>SpectraDataFrame</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'Spectra'
wl(object)

## S4 replacement method for signature 'data.frame'
wl(object) &lt;- value

## S4 replacement method for signature 'Spectra'
wl(object) &lt;- value
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="wl_+3A_object">object</code></td>
<td>
<p>a <code>"data.frame"</code> or an object inheriting from class
<code>Spectra</code></p>
</td></tr>
<tr><td><code id="wl_+3A_value">value</code></td>
<td>
<p>the wavelengths of the <code>Spectra*</code> object to create</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If applied on a <code>"data.frame"</code>, either a <code>Spectra</code> or a
<code>SpectraDataFrame</code> object. If applied on a <code>Spectra*</code> object, a
vector.
</p>


<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code>spectra</code>, <code>Spectra-class</code>,
<code>SpectraDataFrame-class</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading example data
data(oz)
spectra(oz) &lt;- sr_no ~ ... ~ 350:2500

# Retrieving wavelengths from Spectra* object
wl(oz)

# Replacing wavelength values - USE WITH CAUTION!
wl(oz) &lt;- 1:length(oz)
wl(oz)

# Use to initiate a Spectra* object from a data.frame
data(oz)
wl(oz) &lt;- 350:2500
ids(oz) &lt;- ~ sr_no

</code></pre>

<hr>
<h2 id='wl_units'>Wavelengths of Spectra* objects</h2><span id='topic+wl_units'></span><span id='topic+wl_units+3C-'></span><span id='topic+wl_units+2CSpectra-method'></span><span id='topic+wl_units+3C-+2CSpectra-method'></span>

<h3>Description</h3>

<p>Retrieves the wavelengths units from <code>Spectra*</code> object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wl_units(object)

## S4 replacement method for signature 'Spectra'
wl_units(object) &lt;- value
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="wl_units_+3A_object">object</code></td>
<td>
<p>an object inheriting from class <code>Spectra</code></p>
</td></tr>
<tr><td><code id="wl_units_+3A_value">value</code></td>
<td>
<p>a character string</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector
</p>


<h3>Author(s)</h3>

<p>Pierre Roudier <a href="mailto:pierre.roudier@gmail.com">pierre.roudier@gmail.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Loading example data
data(oz)
spectra(oz) &lt;- sr_no ~ ... ~ 350:2500

# Print wavelength information
wl(oz)
range(wl(oz))

# Manipulate wavelength information
wl(oz) &lt;- wl(oz) + 1000
wl(oz)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
