<!DOCTYPE html><html><head><title>Help for package envi</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {envi}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#div_plot'><p>Prepare an 'im' or 'SpatRaster' object for plotting with diverging color palette</p></a></li>
<li><a href='#envi-package'><p>The envi Package: Environmental Interpolation using Spatial Kernel Density Estimation</p></a></li>
<li><a href='#lrren'><p>Ecological niche model using a log relative risk surface</p></a></li>
<li><a href='#perlrren'><p>Spatially perturb an ecological niche model that uses a log relative risk surface</p></a></li>
<li><a href='#plot_cv'><p>Visualizations for the prediction diagnostics of an estimated ecological niche</p></a></li>
<li><a href='#plot_obs'><p>Visualizations for an estimated ecological niche in covariate space</p></a></li>
<li><a href='#plot_perturb'><p>Visualizations for a simulated ecological niche after iteratively perturbing the observation coordinates</p></a></li>
<li><a href='#plot_predict'><p>Visualizations for a predicted ecological niche in geographic space</p></a></li>
<li><a href='#pval_correct'><p>Calculate p-value corrections</p></a></li>
<li><a href='#seq_plot'><p>Prepare an 'im' or 'SpatRaster' object for plotting with sequential color palette</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Environmental Interpolation using Spatial Kernel Density
Estimation</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.19</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-01-23</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Ian D. Buller &lt;ian.buller@alumni.emory.edu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Estimates an ecological niche using occurrence data, covariates, and kernel
        density-based estimation methods. For a single species with presence and absence data,
        the 'envi' package uses the spatial relative risk function that is estimated using the
        'sparr' package. Details about the 'sparr' package methods can be found in the tutorial:
        Davies et al. (2018) &lt;<a href="https://doi.org/10.1002%2Fsim.7577">doi:10.1002/sim.7577</a>&gt;. Details about kernel density estimation can
        be found in J. F. Bithell (1990) &lt;<a href="https://doi.org/10.1002%2Fsim.4780090616">doi:10.1002/sim.4780090616</a>&gt;. More information about
        relative risk functions using kernel density estimation can be found in J. F. Bithell
        (1991) &lt;<a href="https://doi.org/10.1002%2Fsim.4780101112">doi:10.1002/sim.4780101112</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License (&ge; 2.0)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>concaveman, cvAUC, doFuture, doRNG, fields, foreach, future,
graphics, grDevices, iterators, pls, ROCR, sf, sparr,
spatstat.geom, stats, terra</td>
</tr>
<tr>
<td>Suggests:</td>
<td>R.rsp, RStoolbox, spatstat.data, spatstat.random, spelling,
testthat, utils</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>R.rsp</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/lance-waller-lab/envi">https://github.com/lance-waller-lab/envi</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/lance-waller-lab/envi/issues">https://github.com/lance-waller-lab/envi/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-01-23 14:14:14 UTC; ian.buller</td>
</tr>
<tr>
<td>Author:</td>
<td>Ian D. Buller <a href="https://orcid.org/0000-0001-9477-8582"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre, cph],
  Lance A. Waller <a href="https://orcid.org/0000-0001-5002-8886"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb, ths],
  Emory University [cph]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-01-23 14:40:03 UTC</td>
</tr>
</table>
<hr>
<h2 id='div_plot'>Prepare an 'im' or 'SpatRaster' object for plotting with diverging color palette</h2><span id='topic+div_plot'></span>

<h3>Description</h3>

<p>Internal function to convert 'im' object or 'SpatRaster' object to values readable by <code><a href="fields.html#topic+image.plot">image.plot</a></code> function within the <code><a href="#topic+plot_obs">plot_obs</a></code>, <code><a href="#topic+plot_predict">plot_predict</a></code>, and <code><a href="#topic+plot_perturb">plot_perturb</a></code> functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>div_plot(
  input,
  cols,
  midpoint = 0,
  thresh_up = NULL,
  thresh_low = NULL,
  digits = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="div_plot_+3A_input">input</code></td>
<td>
<p>An object of class 'im' or 'SpatRaster' from the <code><a href="#topic+lrren">lrren</a></code> function.</p>
</td></tr>
<tr><td><code id="div_plot_+3A_cols">cols</code></td>
<td>
<p>Character string of length three (3) specifying the colors for plotting: 1) presence, 2) neither, and 3) absence from the <code><a href="#topic+plot_obs">plot_obs</a></code> function.</p>
</td></tr>
<tr><td><code id="div_plot_+3A_midpoint">midpoint</code></td>
<td>
<p>Numeric. The value to center the diverging color palette.</p>
</td></tr>
<tr><td><code id="div_plot_+3A_thresh_up">thresh_up</code></td>
<td>
<p>Numeric. The upper value to concatenate the color key. The default (NULL) uses the maximum value from <code>input</code>.</p>
</td></tr>
<tr><td><code id="div_plot_+3A_thresh_low">thresh_low</code></td>
<td>
<p>Numeric. The lower value to concatenate the color key. The default (NULL) uses the minimum value from <code>input</code>.</p>
</td></tr>
<tr><td><code id="div_plot_+3A_digits">digits</code></td>
<td>
<p>Integer. The number of significant digits for the labels using the <code><a href="base.html#topic+round">round</a></code> function (default is 1).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class 'list'. This is a named list with the following components:
</p>

<dl>
<dt><code>v</code></dt><dd><p>An object of class 'vector' for the estimated ecological niche values.</p>
</dd>
<dt><code>cols</code></dt><dd><p>An object of class 'vector', returns diverging color palette values.</p>
</dd>
<dt><code>breaks</code></dt><dd><p>An object of class 'vector', returns diverging color palette breaks.</p>
</dd>
<dt><code>at</code></dt><dd><p>An object of class 'vector', returns legend breaks.</p>
</dd>
<dt><code>labels</code></dt><dd><p>An object of class 'vector', returns legend labels.</p>
</dd>
</dl>


<hr>
<h2 id='envi-package'>The envi Package: Environmental Interpolation using Spatial Kernel Density Estimation</h2><span id='topic+envi-package'></span><span id='topic+envi'></span>

<h3>Description</h3>

<p>Estimates an ecological niche model using occurrence data, covariates, and kernel density-based estimation methods.
</p>


<h3>Details</h3>

<p>For a single species with presence and absence data, the 'envi' package uses the spatial relative risk function estimated using the <code>sparr</code> package. Details about the <code>sparr</code> package methods can be found in the tutorial: Davies et al. (2018) <a href="https://doi.org/10.1002/sim.7577">doi:10.1002/sim.7577</a>. Details about kernel density estimation can be found in J. F. Bithell (1990) <a href="https://doi.org/10.1002/sim.4780090616">doi:10.1002/sim.4780090616</a>. More information about relative risk functions using kernel density estimation (KDE) can be found in J. F. Bithell (1991) <a href="https://doi.org/10.1002/sim.4780101112">doi:10.1002/sim.4780101112</a>.
</p>
<p>This package provides a function to estimate the ecological niche for a single species with presence and absence data. The 'envi' package also provides some sensitivity and visualization tools for the estimated ecological niche, its predicted spatial distribution, and prediction diagnostics. Various options for the correction of multiple testing are available.
</p>
<p>Key content of the 'envi' package include:<br />
</p>
<p><b>Ecological Niche Model</b>
</p>
<p><code><a href="#topic+lrren">lrren</a></code> Estimates the ecological niche for a single species with presence/absence data, two covariates, and the spatial relative risk function. Provide functionality to predict the spatial distribution of the estimated ecological niche in geographic space and prepare internal k-fold cross-validation data.
</p>
<p><b>Sensitivity Analysis</b>
</p>
<p><code><a href="#topic+perlrren">perlrren</a></code> Iteratively estimates the ecological niche for a single species with spatially perturbed (&quot;jittered&quot;) presence/absence data, two covariates, and the spatial relative risk function. Various radii for the spatial perturbation can be specified.
</p>
<p><b>Data Visualization</b>
</p>
<p><code><a href="#topic+plot_obs">plot_obs</a></code> Visualizes the <code><a href="#topic+lrren">lrren</a></code> output, specifically the estimated ecological niche in a space with dimensions as the two specified covariates in the model.
</p>
<p><code><a href="#topic+plot_predict">plot_predict</a></code> Visualizes the <code><a href="#topic+lrren">lrren</a></code> output, specifically the predicted spatial distribution of the ecological niche.
</p>
<p><code><a href="#topic+plot_cv">plot_cv</a></code> Visualizes the <code><a href="#topic+lrren">lrren</a></code> output, specifically two prediction diagnostics (area under the receiver operating characteristic curve and precision-recall curve).
</p>
<p><code><a href="#topic+plot_perturb">plot_perturb</a></code> Visualizes the <code><a href="#topic+perlrren">perlrren</a></code> output, specifically four summary statistics of the iterations, including mean log relative risk, standard deviation of the log relative risk, mean p-value, and proportion of iterations the p-value was significant based on an alpha-level threshold. It also can predict the spatial distribution of the summary statistics.
</p>


<h3>Dependencies</h3>

<p>The 'envi' package relies heavily upon <code>sparr</code>, <code>spatstat.geom</code>, <code><a href="sf.html#topic+sf">sf</a></code>, and <code>terra</code>. For a single species (presence/absence data), the spatial relative risk function uses the <code><a href="sparr.html#topic+risk">risk</a></code> function. Cross-validation is can be performed in parallel using the <code><a href="future.html#topic+future">future</a></code>, <code>doFuture</code>, <code>doRNG</code>, and <code><a href="foreach.html#topic+foreach">foreach</a></code> packages. Spatial perturbation is performed using the <code><a href="spatstat.geom.html#topic+rjitter">rjitter</a></code> function. Basic visualizations rely on the <code><a href="spatstat.geom.html#topic+plot.ppp">plot.ppp</a></code> and <code><a href="fields.html#topic+image.plot">image.plot</a></code> functions.
</p>


<h3>Author(s)</h3>

<p>Ian D. Buller<br /> <em>Social &amp; Scientific Systems, Inc., a division of DLH Corporation, Silver Spring, Maryland, USA (current); Occupational and Environmental Epidemiology Branch, Division of Cancer Epidemiology and Genetics, National Cancer Institute, National Institutes of Health, Rockville, Maryland, USA (former); Environmental Health Sciences, James T. Laney School of Graduate Studies, Emory University, Atlanta, Georgia, USA (original)</em><br />
</p>
<p>Maintainer: I.D.B. <a href="mailto:ian.buller@alumni.emory.edu">ian.buller@alumni.emory.edu</a>
</p>

<hr>
<h2 id='lrren'>Ecological niche model using a log relative risk surface</h2><span id='topic+lrren'></span>

<h3>Description</h3>

<p>Estimate the ecological niche of a single species with presence/absence data and two covariates. Predict the ecological niche in geographic space.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lrren(
  obs_locs,
  predict = FALSE,
  predict_locs = NULL,
  conserve = TRUE,
  alpha = 0.05,
  p_correct = "none",
  cv = FALSE,
  kfold = 10,
  balance = FALSE,
  parallel = FALSE,
  n_core = 2,
  poly_buffer = NULL,
  obs_window = NULL,
  verbose = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="lrren_+3A_obs_locs">obs_locs</code></td>
<td>
<p>Input data frame of presence and absence observations with six (6) features (columns): 1) ID, 2) longitude, 3) latitude, 4) presence/absence binary variable, 5) covariate 1 as x-coordinate, 6) covariate 2 as y-coordinate.</p>
</td></tr>
<tr><td><code id="lrren_+3A_predict">predict</code></td>
<td>
<p>Logical. If TRUE, will predict the ecological niche in geographic space. If FALSE (the default), will not predict.</p>
</td></tr>
<tr><td><code id="lrren_+3A_predict_locs">predict_locs</code></td>
<td>
<p>Input data frame of prediction locations with 4 features (columns): 1) longitude, 2) latitude, 3) covariate 1 as x-coordinate, 4) covariate 2 as y-coordinate. The covariates must be the same as those included in <code>obs_locs</code>.</p>
</td></tr>
<tr><td><code id="lrren_+3A_conserve">conserve</code></td>
<td>
<p>Logical. If TRUE (the default), the ecological niche will be estimated within a concave hull around the locations in <code>obs_locs</code>. If FALSE, the ecological niche will be estimated within a concave hull around the locations in <code>predict_locs</code>.</p>
</td></tr>
<tr><td><code id="lrren_+3A_alpha">alpha</code></td>
<td>
<p>Numeric. The two-tailed alpha level for the significance threshold (the default is 0.05).</p>
</td></tr>
<tr><td><code id="lrren_+3A_p_correct">p_correct</code></td>
<td>
<p>Optional. Character string specifying whether to apply a correction for multiple comparisons including a False Discovery Rate <code>p_correct = "FDR"</code>, a Sidak correction <code>p_correct = "Sidak"</code>, and a Bonferroni correction <code>p_correct = "Bonferroni"</code>. If <code>p_correct = "none"</code> (the default), then no correction is applied.</p>
</td></tr>
<tr><td><code id="lrren_+3A_cv">cv</code></td>
<td>
<p>Logical. If TRUE, will calculate prediction diagnostics using internal k-fold cross-validation. If FALSE (the default), will not.</p>
</td></tr>
<tr><td><code id="lrren_+3A_kfold">kfold</code></td>
<td>
<p>Integer. Specify the number of folds used in the internal cross-validation. The default is 10.</p>
</td></tr>
<tr><td><code id="lrren_+3A_balance">balance</code></td>
<td>
<p>Logical. If TRUE, the prevalence within each k-fold will be 0.50 by undersampling absence locations (assumes absence data are more frequent). If FALSE (the default), the prevalence within each k-fold will match the prevalence in <code>obs_locs</code>.</p>
</td></tr>
<tr><td><code id="lrren_+3A_parallel">parallel</code></td>
<td>
<p>Logical. If TRUE, will execute the function in parallel. If FALSE (the default), will not execute the function in parallel.</p>
</td></tr>
<tr><td><code id="lrren_+3A_n_core">n_core</code></td>
<td>
<p>Optional. Integer specifying the number of CPU cores on the current host for parallelization (the default is 2 cores).</p>
</td></tr>
<tr><td><code id="lrren_+3A_poly_buffer">poly_buffer</code></td>
<td>
<p>Optional. Specify a custom distance (in the same units as covariates) to add to the window within which the ecological niche is estimated. The default is 1/100th of the smallest range among the two covariates.</p>
</td></tr>
<tr><td><code id="lrren_+3A_obs_window">obs_window</code></td>
<td>
<p>Optional. Specify a custom window of class 'owin' within which to estimate the ecological niche. The default computes a concave hull around the data specified in <code>conserve</code>.</p>
</td></tr>
<tr><td><code id="lrren_+3A_verbose">verbose</code></td>
<td>
<p>Logical. If TRUE (the default), will print function progress during execution. If FALSE, will not print.</p>
</td></tr>
<tr><td><code id="lrren_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code><a href="sparr.html#topic+risk">risk</a></code> to select bandwidth, edge correction, and resolution.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function estimates the ecological niche of a single species (presence/absence data), or the presence of one species relative to another, using two covariates, will predict the ecological niche into a geographic area and prepare k-fold cross-validation data sets for prediction diagnostics.
</p>
<p>The function uses the <code><a href="sparr.html#topic+risk">risk</a></code> function to estimate the spatial relative risk function and forces <code>risk(tolerate == TRUE)</code> in order to calculate asymptotic p-values. The estimated ecological niche can be visualized using the <code><a href="#topic+plot_obs">plot_obs</a></code> function.
</p>
<p>If <code>predict = TRUE</code>, this function will predict ecological niche at every location specified with <code>predict_locs</code> with best performance if <code>predict_locs</code> are gridded locations in the same study area as the observations in <code>obs_locs</code> - a version of environmental interpolation. The predicted spatial distribution of the estimated ecological niche can be visualized using the <code><a href="#topic+plot_predict">plot_predict</a></code> function.
</p>
<p>If <code>cv = TRUE</code>, this function will prepare k-fold cross-validation data sets for prediction diagnostics. The sample size of each fold depends on the number of folds set with <code>kfold</code>. If <code>balance = TRUE</code>, the sample size of each fold will be the frequency of presence locations divided by the number of folds times two. If <code>balance = FALSE</code>, the sample size of each fold will be the frequency of all observed locations divided by the number of folds. The cross-validation can be performed in parallel if <code>parallel = TRUE</code> using the <code><a href="future.html#topic+future">future</a></code>, <code>doFuture</code>, <code>doRNG</code>, and <code><a href="foreach.html#topic+foreach">foreach</a></code> packages. Two diagnostics (area under the receiver operating characteristic curve and precision-recall curve) can be visualized using the <code>plot_cv</code> function.
</p>
<p>The <code>obs_window</code> argument may be useful to specify a 'known' window for the ecological niche (e.g., a convex hull around observed locations).
</p>
<p>This function has functionality for a correction for multiple testing. If <code>p_correct = "FDR"</code>, calculates a False Discovery Rate by Benjamini and Hochberg. If <code>p_correct = "Sidak"</code>, calculates a Sidak correction. If <code>p_correct = "Bonferroni"</code>, calculates a Bonferroni correction. If <code>p_correct = "none"</code> (the default), then the function does not account for multiple testing and uses the uncorrected <code>alpha</code> level. See the internal <code>pval_correct</code> function documentation for more details.
</p>


<h3>Value</h3>

<p>An object of class 'list'. This is a named list with the following components:
</p>

<dl>
<dt><code>out</code></dt><dd><p>An object of class 'list' for the estimated ecological niche.</p>
</dd>
<dt><code>dat</code></dt><dd><p>An object of class 'data.frame', returns <code>obs_locs</code> that are used in the accompanying plotting functions.</p>
</dd>
<dt><code>p_critical</code></dt><dd><p>A numeric value for the critical p-value used for significance tests.</p>
</dd>
</dl>

<p>The returned <code>out</code> is a named list with the following components:
</p>

<dl>
<dt><code>obs</code></dt><dd><p>An object of class 'rrs' for the spatial relative risk.</p>
</dd>
<dt><code>presence</code></dt><dd><p>An object of class 'ppp' for the presence locations.</p>
</dd>
<dt><code>absence</code></dt><dd><p>An object of class 'ppp' for the absence locations.</p>
</dd>
<dt><code>outer_poly</code></dt><dd><p>An object of class 'matrix' for the coordinates of the concave hull around the observation locations.</p>
</dd>
<dt><code>inner_poly</code></dt><dd><p>An object of class 'matrix' for the coordinates of the concave hull around the observation locations. Same as <code>outer_poly</code>.</p>
</dd>
</dl>

<p>If <code>predict = TRUE</code>, the returned <code>out</code> has additional components:
</p>

<dl>
<dt><code>outer_poly</code></dt><dd><p>An object of class 'matrix' for the coordinates of the concave hull around the prediction locations.</p>
</dd>
<dt><code>prediction</code></dt><dd><p>An object of class 'matrix' for the coordinates of the concave hull around the prediction locations.</p>
</dd>
</dl>

<p>If <code>cv = TRUE</code>, the returned object of class 'list' has an additional named list <code>cv</code> with the following components:
</p>

<dl>
<dt><code>cv_predictions_rr</code></dt><dd><p>A list of length <code>kfold</code> with values of the log relative risk surface at each point randomly selected in a cross-validation fold.</p>
</dd>
<dt><code>cv_labels</code></dt><dd><p>A list of length <code>kfold</code> with a binary value of presence (1) or absence (0) for each point randomly selected in a cross-validation fold.</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>if (interactive()) {
  set.seed(1234) # for reproducibility

# Using the 'bei' and 'bei.extra' data within {spatstat.data}

# Covariate data (centered and scaled)
  elev &lt;- spatstat.data::bei.extra[[1]]
  grad &lt;- spatstat.data::bei.extra[[2]]
  elev$v &lt;- scale(elev)
  grad$v &lt;- scale(grad)
  elev_raster &lt;- terra::rast(elev)
  grad_raster &lt;- terra::rast(grad)

# Presence data
  presence &lt;- spatstat.data::bei
  spatstat.geom::marks(presence) &lt;- data.frame("presence" = rep(1, presence$n),
                                               "lon" = presence$x,
                                               "lat" = presence$y)
  spatstat.geom::marks(presence)$elev &lt;- elev[presence]
  spatstat.geom::marks(presence)$grad &lt;- grad[presence]

# (Pseudo-)Absence data
  absence &lt;- spatstat.random::rpoispp(0.008, win = elev)
  spatstat.geom::marks(absence) &lt;- data.frame("presence" = rep(0, absence$n),
                                              "lon" = absence$x,
                                              "lat" = absence$y)
  spatstat.geom::marks(absence)$elev &lt;- elev[absence]
  spatstat.geom::marks(absence)$grad &lt;- grad[absence]

# Combine into readable format
  obs_locs &lt;- spatstat.geom::superimpose(presence, absence, check = FALSE)
  obs_locs &lt;- spatstat.geom::marks(obs_locs)
  obs_locs$id &lt;- seq(1, nrow(obs_locs), 1)
  obs_locs &lt;- obs_locs[ , c(6, 2, 3, 1, 4, 5)]
  
# Prediction Data
  predict_xy &lt;- terra::crds(elev_raster)
  predict_locs &lt;- as.data.frame(predict_xy)
  predict_locs$elev &lt;- terra::extract(elev_raster, predict_xy)[ , 1]
  predict_locs$grad &lt;- terra::extract(grad_raster, predict_xy)[ , 1]

# Run lrren
  test_lrren &lt;- lrren(obs_locs = obs_locs,
                      predict_locs = predict_locs,
                      predict = TRUE,
                      cv = TRUE)
}

</code></pre>

<hr>
<h2 id='perlrren'>Spatially perturb an ecological niche model that uses a log relative risk surface</h2><span id='topic+perlrren'></span>

<h3>Description</h3>

<p>Estimates the ecological niche of a single species with presence/absence data and two covariates, iteratively, by randomly perturbing ('jittering') the coordinates of observations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>perlrren(
  obs_ppp,
  covariates,
  predict = TRUE,
  predict_locs = NULL,
  radii = NULL,
  n_sim = 2,
  alpha = 0.05,
  p_correct = "none",
  parallel = FALSE,
  n_core = 2,
  verbose = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="perlrren_+3A_obs_ppp">obs_ppp</code></td>
<td>
<p>Input object of class 'ppp' a marked point pattern of presence and absence observations with 5 (five) features (columns): 1) ID, 2) longitude, 3) latitude, 4) presence/absence binary variable, 5) ordinal ID for spatial perturbation.</p>
</td></tr>
<tr><td><code id="perlrren_+3A_covariates">covariates</code></td>
<td>
<p>Input object of class 'imlist' of 2 (two) covariates within the same spatial window and in the same coordinate reference system as <code>obs_ppp</code>.</p>
</td></tr>
<tr><td><code id="perlrren_+3A_predict">predict</code></td>
<td>
<p>Logical. If TRUE (the default), will predict the ecological niche in geographic space. If FALSE, will not predict.</p>
</td></tr>
<tr><td><code id="perlrren_+3A_predict_locs">predict_locs</code></td>
<td>
<p>Input data frame of prediction locations with 4 features (columns): 1) longitude, 2) latitude, 3) covariate 1 as x-coordinate, 4) covariate 2 as y-coordinate. If unspecified (the default), automatically computed from an 'im' object within <code>covariates</code>.</p>
</td></tr>
<tr><td><code id="perlrren_+3A_radii">radii</code></td>
<td>
<p>Vector of length equal to the number of levels of ordinal ID in <code>obs_ppp</code>. Specifies the radii of the spatial perturbation at each level in units equivalent to the coordinate reference system of <code>obs_ppp</code>.</p>
</td></tr>
<tr><td><code id="perlrren_+3A_n_sim">n_sim</code></td>
<td>
<p>Integer, specifying the number of simulation iterations to perform.</p>
</td></tr>
<tr><td><code id="perlrren_+3A_alpha">alpha</code></td>
<td>
<p>Numeric. The two-tailed alpha level for the significance threshold (default is 0.05).</p>
</td></tr>
<tr><td><code id="perlrren_+3A_p_correct">p_correct</code></td>
<td>
<p>Optional. Character string specifying whether to apply a correction for multiple comparisons including a False Discovery Rate <code>p_correct = "FDR"</code>, a Sidak correction <code>p_correct = "Sidak"</code>, and a Bonferroni correction <code>p_correct = "Bonferroni"</code>. If <code>p_correct = "none"</code> (the default), then no correction is applied.</p>
</td></tr>
<tr><td><code id="perlrren_+3A_parallel">parallel</code></td>
<td>
<p>Logical. If TRUE, will execute the function in parallel. If FALSE (the default), will not execute the function in parallel.</p>
</td></tr>
<tr><td><code id="perlrren_+3A_n_core">n_core</code></td>
<td>
<p>Optional. Integer specifying the number of CPU cores on the current host for parallelization (the default is 2 cores).</p>
</td></tr>
<tr><td><code id="perlrren_+3A_verbose">verbose</code></td>
<td>
<p>Logical. If TRUE (the default), will print function progress during execution. If FALSE, will not print.</p>
</td></tr>
<tr><td><code id="perlrren_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code><a href="#topic+lrren">lrren</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function performs a sensitivity analysis of an ecological niche model of a single species (presence/absence data), or the presence of one species relative to another, that uses two covariates. The observation locations (presence and absence data) are randomly spatially perturbed (i.e., &quot;jittered&quot;) uniformly within a circular disc of a specified radius centered at their recorded location using the <code><a href="spatstat.geom.html#topic+rjitter">rjitter</a></code> function. This method simulates the spatial uncertainty of observations, how that may affect the covariate values at each observation (i.e., misclassification error), and the estimated ecological niche based on the two specified covariates. Observations can be grouped into categories of the uncertainty of class 'factor' and can vary by degrees of uncertainty specified using the <code>radii</code> argument.
</p>
<p>The function iteratively estimates the ecological niche using the <code><a href="#topic+lrren">lrren</a></code> function and computes four summary statistics at every grid cell (i.e., knot) of the estimated surface: 1) mean of the log relative risk, 2) standard deviation of the log relative risk, 3) mean of the asymptotically normal p-value, and 4) proportion of iterations were statistically significant based on a two-tailed alpha-level threshold (argument <code>alpha</code>). The process can be performed in parallel if <code>parallel = TRUE</code> using the <code><a href="future.html#topic+future">future</a></code>, <code>doFuture</code>, <code>doRNG</code>, and <code><a href="foreach.html#topic+foreach">foreach</a></code> packages. The computed surfaces can be visualized using the <code><a href="#topic+plot_perturb">plot_perturb</a></code> function. If <code>predict = TRUE</code>, this function will predict the four summary statistics at every location specified with <code>predict_locs</code> and can also be visualized using the <code><a href="#topic+plot_perturb">plot_perturb</a></code> function.
</p>
<p>For more information about the spatial perturbation, please refer to the <code><a href="spatstat.geom.html#topic+rjitter">rjitter</a></code> function documentation.
</p>
<p>The function has functionality for a correction for multiple testing. If <code>p_correct = "FDR"</code>, calculates a False Discovery Rate by Benjamini and Hochberg. If <code>p_correct = "Sidak"</code>, calculates a Sidak correction. If <code>p_correct = "Bonferroni"</code>, calculates a Bonferroni correction. If <code>p_correct = "none"</code> (the default), then the function does not account for multiple testing and uses the uncorrected <code>alpha</code> level. See the internal <code>pval_correct</code> function documentation for more details.
</p>


<h3>Value</h3>

<p>An object of class &quot;list&quot;. This is a named list with the following components:
</p>

<dl>
<dt><code>sim</code></dt><dd><p>An object of class 'list' for the summary statistics of the iterative ecological niche.</p>
</dd>
<dt><code>predict</code></dt><dd><p>An object of class 'ppp', a marked point pattern with summary statistics for the iterative ecological niche in geographic space.</p>
</dd>
</dl>

<p>The returned <code>sim</code> is a named list with the following components:
</p>

<dl>
<dt><code>lrr_mean</code></dt><dd><p>An object of class 'im' for the mean log relative risk surface.</p>
</dd>
<dt><code>lrr_sd</code></dt><dd><p>An object of class 'im' for the standard deviation of log relative risk surface.</p>
</dd>
<dt><code>pval_mean</code></dt><dd><p>An object of class 'im' for the mean p-value surface.</p>
</dd>
<dt><code>pval_prop</code></dt><dd><p>An object of class 'im' for the proportion of iterations were statistically significant surface.</p>
</dd>
<dt><code>alpha_median</code></dt><dd><p>A numeric value of the median critical p-value across all iterations.</p>
</dd>
</dl>

<p>If <code>predict = FALSE</code>, the returned <code>predict</code> is empty. If <code>predict = TRUE</code>, the returned <code>predict</code> is an object of class 'ppp' a marked point pattern with the following features:
</p>

<dl>
<dt><code>x</code></dt><dd><p>Values for x-coordinate in geographic space (e.g., longitude).</p>
</dd>
<dt><code>y</code></dt><dd><p>Values for y-coordinate in geographic space (e.g., latitude).</p>
</dd>
<dt><code>v</code></dt><dd><p>Values for x-coordinate in covariate space.</p>
</dd>
<dt><code>z</code></dt><dd><p>Values for x-coordinate in covariate space.</p>
</dd>
<dt><code>lrr_mean</code></dt><dd><p>Values for the mean log relative risk surface.</p>
</dd>
<dt><code>lrr_sd</code></dt><dd><p>Values for the standard deviation of log relative risk surface.</p>
</dd>
<dt><code>pval_mean</code></dt><dd><p>Values for the mean p-value surface.</p>
</dd>
<dt><code>pval_prop</code></dt><dd><p>Values for the proportion of iterations were statistically significant surface.</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>if (interactive()) {
  set.seed(1234) # for reproducibility

# Using the 'bei' and 'bei.extra' data within {spatstat.data}

# Covariate data (centered and scaled)
  ims &lt;- spatstat.data::bei.extra
  ims[[1]]$v &lt;- scale(ims[[1]]$v)
  ims[[2]]$v &lt;- scale(ims[[2]]$v)
  
# Presence data
  presence &lt;- spatstat.data::bei
  spatstat.geom::marks(presence) &lt;- data.frame("presence" = rep(1, presence$n),
                                               "lon" = presence$x,
                                               "lat" = presence$y)
                                          
# (Pseudo-)Absence data
  absence &lt;- spatstat.random::rpoispp(0.008, win = ims[[1]])
  spatstat.geom::marks(absence) &lt;- data.frame("presence" = rep(0, absence$n),
                                              "lon" = absence$x,
                                              "lat" = absence$y)
# Combine into readable format
  obs_locs &lt;- spatstat.geom::superimpose(presence, absence, check = FALSE)
  spatstat.geom::marks(obs_locs)$id &lt;- seq(1, obs_locs$n, 1)
  spatstat.geom::marks(obs_locs) &lt;- spatstat.geom::marks(obs_locs)[ , c(4, 2, 3, 1)]
 
# Specify categories for varying degrees of spatial uncertainty
## Creates three groups
  spatstat.geom::marks(obs_locs)$levels &lt;- as.factor(stats::rpois(obs_locs$n,
                                                                  lambda = 0.05))
                                                                  
# Run perlrren
  test_perlrren &lt;- perlrren(obs_ppp = obs_locs,
                            covariates = ims,
                            radii = c(10, 100, 500),
                            n_sim = 10)
}

</code></pre>

<hr>
<h2 id='plot_cv'>Visualizations for the prediction diagnostics of an estimated ecological niche</h2><span id='topic+plot_cv'></span>

<h3>Description</h3>

<p>Create multiple plots of output from the <code><a href="#topic+lrren">lrren</a></code> function, specifically for the internal k-fold cross-validation diagnostics.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_cv(input, alpha = 0.05)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_cv_+3A_input">input</code></td>
<td>
<p>An object of class 'list' from the <code><a href="#topic+lrren">lrren</a></code> function.</p>
</td></tr>
<tr><td><code id="plot_cv_+3A_alpha">alpha</code></td>
<td>
<p>Numeric. The two-tailed alpha level for the significance threshold (default is 0.05).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>This function produces two plots: 1) area under the receiver operating characteristic curve and 2) precision-recall curve. Each plot shows predictions for the log relative risk surface. The red-colored lines are the average curves.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if (interactive()) {
  set.seed(1234) # for reproducibility

# Using the 'bei' and 'bei.extra' data within {spatstat.data}

# Covariate data (centered and scaled)
  elev &lt;- spatstat.data::bei.extra[[1]]
  grad &lt;- spatstat.data::bei.extra[[2]]
  elev$v &lt;- scale(elev)
  grad$v &lt;- scale(grad)
  elev_raster &lt;- terra::rast(elev)
  grad_raster &lt;- terra::rast(grad)

# Presence data
  presence &lt;- spatstat.data::bei
  spatstat.geom::marks(presence) &lt;- data.frame("presence" = rep(1, presence$n),
                                               "lon" = presence$x,
                                               "lat" = presence$y)
  spatstat.geom::marks(presence)$elev &lt;- elev[presence]
  spatstat.geom::marks(presence)$grad &lt;- grad[presence]

# (Pseudo-)Absence data
  absence &lt;- spatstat.random::rpoispp(0.008, win = elev)
  spatstat.geom::marks(absence) &lt;- data.frame("presence" = rep(0, absence$n),
                                              "lon" = absence$x,
                                              "lat" = absence$y)
  spatstat.geom::marks(absence)$elev &lt;- elev[absence]
  spatstat.geom::marks(absence)$grad &lt;- grad[absence]

# Combine into readable format
  obs_locs &lt;- spatstat.geom::superimpose(presence, absence, check = FALSE)
  obs_locs &lt;- spatstat.geom::marks(obs_locs)
  obs_locs$id &lt;- seq(1, nrow(obs_locs), 1)
  obs_locs &lt;- obs_locs[ , c(6, 2, 3, 1, 4, 5)]
  
# Run lrren
  test_lrren &lt;- lrren(obs_locs = obs_locs,
                      cv = TRUE)
                      
# Run plot_cv                 
  plot_cv(input = test_lrren)
}

</code></pre>

<hr>
<h2 id='plot_obs'>Visualizations for an estimated ecological niche in covariate space</h2><span id='topic+plot_obs'></span>

<h3>Description</h3>

<p>Create multiple plots of output from the <code><a href="#topic+lrren">lrren</a></code> function, specifically for the observation data and estimated ecological niche.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_obs(
  input,
  plot_cols = c("#8B3A3A", "#CCCCCC", "#0000CD"),
  alpha = input$p_critical,
  lower_lrr = NULL,
  upper_lrr = NULL,
  digits = 1,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_obs_+3A_input">input</code></td>
<td>
<p>An object of class 'list' from the <code><a href="#topic+lrren">lrren</a></code> function.</p>
</td></tr>
<tr><td><code id="plot_obs_+3A_plot_cols">plot_cols</code></td>
<td>
<p>Character string of length three (3) specifying the colors for plotting: 1) presence, 2) neither, and 3) absence. The default colors in hex are <code>c("#8B3A3A", "#CCCCCC", "#0000CD")</code> or <code>c("indianred4", "grey80", "blue3")</code>.</p>
</td></tr>
<tr><td><code id="plot_obs_+3A_alpha">alpha</code></td>
<td>
<p>Optional, numeric. The two-tailed alpha level for significance threshold (default is the <code>p_critical</code> value imported from <code>input</code>).</p>
</td></tr>
<tr><td><code id="plot_obs_+3A_lower_lrr">lower_lrr</code></td>
<td>
<p>Optional, numeric. Lower cut-off value for the log relative risk value in the color key (typically a negative value). The default is no limit, and the color key will include the minimum value of the log relative risk surface.</p>
</td></tr>
<tr><td><code id="plot_obs_+3A_upper_lrr">upper_lrr</code></td>
<td>
<p>Optional, numeric. Upper cut-off value for the log relative risk value in the color key (typically a positive value). The default is no limit, and the color key will include the maximum value of the log relative risk surface.</p>
</td></tr>
<tr><td><code id="plot_obs_+3A_digits">digits</code></td>
<td>
<p>Optional, integer. The number of significant digits for the color key labels using the <code><a href="base.html#topic+round">round</a></code> function (default is 1).</p>
</td></tr>
<tr><td><code id="plot_obs_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code><a href="spatstat.geom.html#topic+plot.ppp">plot.ppp</a></code> and <code><a href="fields.html#topic+image.plot">image.plot</a></code> for additional graphical features.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>This function produces three plots in a two-dimensional space where the axes are the two specified covariates: 1) observation locations by group, 2) log relative risk surface, and 3) significant p-value surface.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if (interactive()) {
  set.seed(1234) # for reproducibility

# Using the 'bei' and 'bei.extra' data within {spatstat.data}

# Covariate data (centered and scaled)
  elev &lt;- spatstat.data::bei.extra[[1]]
  grad &lt;- spatstat.data::bei.extra[[2]]
  elev$v &lt;- scale(elev)
  grad$v &lt;- scale(grad)
  elev_raster &lt;- terra::rast(elev)
  grad_raster &lt;- terra::rast(grad)

# Presence data
  presence &lt;- spatstat.data::bei
  spatstat.geom::marks(presence) &lt;- data.frame("presence" = rep(1, presence$n),
                                               "lon" = presence$x,
                                               "lat" = presence$y)
  spatstat.geom::marks(presence)$elev &lt;- elev[presence]
  spatstat.geom::marks(presence)$grad &lt;- grad[presence]

# (Pseudo-)Absence data
  absence &lt;- spatstat.random::rpoispp(0.008, win = elev)
  spatstat.geom::marks(absence) &lt;- data.frame("presence" = rep(0, absence$n),
                                              "lon" = absence$x,
                                              "lat" = absence$y)
  spatstat.geom::marks(absence)$elev &lt;- elev[absence]
  spatstat.geom::marks(absence)$grad &lt;- grad[absence]

# Combine into readable format
  obs_locs &lt;- spatstat.geom::superimpose(presence, absence, check = FALSE)
  obs_locs &lt;- spatstat.geom::marks(obs_locs)
  obs_locs$id &lt;- seq(1, nrow(obs_locs), 1)
  obs_locs &lt;- obs_locs[ , c(6, 2, 3, 1, 4, 5)]
  
# Run lrren
  test_lrren &lt;- lrren(obs_locs = obs_locs,
                      cv = FALSE)
                      
# Run plot_obs   
  plot_obs(input = test_lrren)
}

</code></pre>

<hr>
<h2 id='plot_perturb'>Visualizations for a simulated ecological niche after iteratively perturbing the observation coordinates</h2><span id='topic+plot_perturb'></span>

<h3>Description</h3>

<p>Create multiple plots of output from the <code><a href="#topic+perlrren">perlrren</a></code> function, specifically for the four summary statistics in covariate space and geographic space.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_perturb(
  input,
  predict = TRUE,
  mean_cols = c("#8B3A3A", "#CCCCCC", "#0000CD"),
  var_cols = c("#E5E5E5", "#1A1A1A"),
  cov_labs = c("V1", "V2"),
  cref0 = "EPSG:4326",
  cref1 = NULL,
  lower_lrr = NULL,
  upper_lrr = NULL,
  upper_sd = NULL,
  digits = 1,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_perturb_+3A_input">input</code></td>
<td>
<p>An object of class 'list' from the <code><a href="#topic+perlrren">perlrren</a></code> function.</p>
</td></tr>
<tr><td><code id="plot_perturb_+3A_predict">predict</code></td>
<td>
<p>Logical. If TRUE (the default), will visualize the four summary statistics in geographic space. If FALSE, will not.</p>
</td></tr>
<tr><td><code id="plot_perturb_+3A_mean_cols">mean_cols</code></td>
<td>
<p>Character string of length three (3) specifying the colors for plots with a divergent color palette: 1) presence, 2) neither, and 3) absence. The default colors in hex are <code>c("#8B3A3A", "#CCCCCC", "#0000CD")</code> or <code>c("indianred4", "grey80", "blue3")</code>.</p>
</td></tr>
<tr><td><code id="plot_perturb_+3A_var_cols">var_cols</code></td>
<td>
<p>Character string of length two (2) specifying the colors for plots with a sequential color palette from low to high values. The default colors in hex are <code>c("#E5E5E5", "#1A1A1A")</code> or <code>c("grey90", "grey10")</code>.</p>
</td></tr>
<tr><td><code id="plot_perturb_+3A_cov_labs">cov_labs</code></td>
<td>
<p>Character string of length two (2) specifying the x- and y-axis labels in plots of the ecological niche in covariate space. The default values are generic <code>c("V1", "V2")</code>.</p>
</td></tr>
<tr><td><code id="plot_perturb_+3A_cref0">cref0</code></td>
<td>
<p>Character. The Coordinate Reference System (CRS) for the x- and y-coordinates in geographic space. The default is WGS84 <code>"EPSG:4326"</code>.</p>
</td></tr>
<tr><td><code id="plot_perturb_+3A_cref1">cref1</code></td>
<td>
<p>Optional, character. The Coordinate Reference System (CRS) to spatially project the x- and y-coordinates in geographic space.</p>
</td></tr>
<tr><td><code id="plot_perturb_+3A_lower_lrr">lower_lrr</code></td>
<td>
<p>Optional, numeric. Lower cut-off value for the log relative risk value in the color key (typically a negative value). The default is no limit, and the color key will include the minimum value of the log relative risk surface.</p>
</td></tr>
<tr><td><code id="plot_perturb_+3A_upper_lrr">upper_lrr</code></td>
<td>
<p>Optional, numeric. Upper cut-off value for the log relative risk value in the color key (typically a positive value). The default is no limit, and the color key will include the maximum value of the log relative risk surface.</p>
</td></tr>
<tr><td><code id="plot_perturb_+3A_upper_sd">upper_sd</code></td>
<td>
<p>Optional, numeric. Upper cut-off value for the standard deviation of log relative risk value in the color key. The default is no limit, and the color key will include the maximum value of the standard deviation surface.</p>
</td></tr>
<tr><td><code id="plot_perturb_+3A_digits">digits</code></td>
<td>
<p>Optional, integer. The number of significant digits for the color key labels using the <code><a href="base.html#topic+round">round</a></code> function (default is 1).</p>
</td></tr>
<tr><td><code id="plot_perturb_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code><a href="fields.html#topic+image.plot">image.plot</a></code> for additional graphical features.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>This function produces four plots in a two-dimensional space where the axes are the two specified covariates: 1) mean of the log relative risk, 2) standard deviation of the log relative risk, 3) mean of the asymptotically normal p-value, and 4) proportion of iterations were statistically significant based on a two-tailed alpha-level threshold. If <code>predict = TRUE</code>, this function produces an additional four plots of the summary statistics above in a two-dimensional geographic space where the axes are longitude and latitude.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if (interactive()) {
  set.seed(1234) # for reproducibility

# Using the 'bei' and 'bei.extra' data within {spatstat.data}

# Covariate data (centered and scaled)
  ims &lt;- spatstat.data::bei.extra
  ims[[1]]$v &lt;- scale(ims[[1]]$v)
  ims[[2]]$v &lt;- scale(ims[[2]]$v)
  
# Presence data
  presence &lt;- spatstat.data::bei
  spatstat.geom::marks(presence) &lt;- data.frame("presence" = rep(1, presence$n),
                                              "lon" = presence$x,
                                              "lat" = presence$y)
                                          
# (Pseudo-)Absence data
  absence &lt;- spatstat.random::rpoispp(0.008, win = ims[[1]])
  spatstat.geom::marks(absence) &lt;- data.frame("presence" = rep(0, absence$n),
                                              "lon" = absence$x,
                                              "lat" = absence$y)
# Combine into readable format
  obs_locs &lt;- spatstat.geom::superimpose(presence, absence, check = FALSE)
  spatstat.geom::marks(obs_locs)$id &lt;- seq(1, obs_locs$n, 1)
  spatstat.geom::marks(obs_locs) &lt;- spatstat.geom::marks(obs_locs)[ , c(4, 2, 3, 1)]
 
# Specify categories for varying degrees of spatial uncertainty
## Creates three groups
  spatstat.geom::marks(obs_locs)$levels &lt;- as.factor(stats::rpois(obs_locs$n,
                                                                  lambda = 0.05))
                                                                  
# Run perlrren
  test_perlrren &lt;- perlrren(obs_ppp = obs_locs,
                            covariates = ims,
                            radii = c(10, 100, 500),
                            n_sim = 10)
                            
# Run plot_perturb                             
  plot_perturb(input = test_perlrren)
}

</code></pre>

<hr>
<h2 id='plot_predict'>Visualizations for a predicted ecological niche in geographic space</h2><span id='topic+plot_predict'></span>

<h3>Description</h3>

<p>Create multiple plots of output from the <code><a href="#topic+lrren">lrren</a></code> function, specifically for the predicted values of the ecological niche at geographic coordinates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_predict(
  input,
  plot_cols = c("#8B3A3A", "#CCCCCC", "#0000CD", "#FFFF00"),
  alpha = input$p_critical,
  cref0 = "EPSG:4326",
  cref1 = NULL,
  lower_lrr = NULL,
  upper_lrr = NULL,
  digits = 1,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_predict_+3A_input">input</code></td>
<td>
<p>An object of class 'list' from the <code><a href="#topic+lrren">lrren</a></code> function.</p>
</td></tr>
<tr><td><code id="plot_predict_+3A_plot_cols">plot_cols</code></td>
<td>
<p>Character string of length four (4) specifying the colors for plotting: 1) presence, 2) neither, 3) absence, and 4) NA values. The default colors in hex are <code>c("#8B3A3A", "#CCCCCC", "#0000CD" "#FFFF00")</code> or <code>c("indianred4", "grey80", "blue3", "yellow")</code>.</p>
</td></tr>
<tr><td><code id="plot_predict_+3A_alpha">alpha</code></td>
<td>
<p>Optional, numeric. The two-tailed alpha level for significance threshold (default is the <code>p_critical</code> value imported from <code>input</code>).</p>
</td></tr>
<tr><td><code id="plot_predict_+3A_cref0">cref0</code></td>
<td>
<p>Character. The Coordinate Reference System (CRS) for the x- and y-coordinates in geographic space. The default is WGS84 <code>"EPSG:4326"</code>.</p>
</td></tr>
<tr><td><code id="plot_predict_+3A_cref1">cref1</code></td>
<td>
<p>Optional, character. The Coordinate Reference System (CRS) to spatially project the x- and y-coordinates in geographic space.</p>
</td></tr>
<tr><td><code id="plot_predict_+3A_lower_lrr">lower_lrr</code></td>
<td>
<p>Optional, numeric. Lower cut-off value for the log relative risk value in the color key (typically a negative value). The default is no limit, and the color key will include the minimum value of the log relative risk surface.</p>
</td></tr>
<tr><td><code id="plot_predict_+3A_upper_lrr">upper_lrr</code></td>
<td>
<p>Optional, numeric. Upper cut-off value for the log relative risk value in the color key (typically a positive value). The default is no limit, and the color key will include the maximum value of the log relative risk surface.</p>
</td></tr>
<tr><td><code id="plot_predict_+3A_digits">digits</code></td>
<td>
<p>Optional, integer. The number of significant digits for the color key labels using the <code><a href="base.html#topic+round">round</a></code> function (default is 1).</p>
</td></tr>
<tr><td><code id="plot_predict_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code><a href="fields.html#topic+image.plot">image.plot</a></code> for additional graphical features.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>This function produces two plots in a two-dimensional space where the axes are geographic coordinates (e.g., longitude and latitude): 1) predicted log relative risk, and 2) significant p-values.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if (interactive()) {
  set.seed(1234) # for reproducibility

# Using the 'bei' and 'bei.extra' data within {spatstat.data}

# Covariate data (centered and scaled)
  elev &lt;- spatstat.data::bei.extra[[1]]
  grad &lt;- spatstat.data::bei.extra[[2]]
  elev$v &lt;- scale(elev)
  grad$v &lt;- scale(grad)
  elev_raster &lt;- terra::rast(elev)
  grad_raster &lt;- terra::rast(grad)

# Presence data
  presence &lt;- spatstat.data::bei
  spatstat.geom::marks(presence) &lt;- data.frame("presence" = rep(1, presence$n),
                                          "lon" = presence$x,
                                          "lat" = presence$y)
  spatstat.geom::marks(presence)$elev &lt;- elev[presence]
  spatstat.geom::marks(presence)$grad &lt;- grad[presence]

# (Pseudo-)Absence data
  absence &lt;- spatstat.random::rpoispp(0.008, win = elev)
  spatstat.geom::marks(absence) &lt;- data.frame("presence" = rep(0, absence$n),
                                              "lon" = absence$x,
                                              "lat" = absence$y)
  spatstat.geom::marks(absence)$elev &lt;- elev[absence]
  spatstat.geom::marks(absence)$grad &lt;- grad[absence]

# Combine into readable format
  obs_locs &lt;- spatstat.geom::superimpose(presence, absence, check = FALSE)
  obs_locs &lt;- spatstat.geom::marks(obs_locs)
  obs_locs$id &lt;- seq(1, nrow(obs_locs), 1)
  obs_locs &lt;- obs_locs[ , c(6, 2, 3, 1, 4, 5)]
  
# Prediction Data
  predict_xy &lt;- terra::crds(elev_raster)
  predict_locs &lt;- as.data.frame(predict_xy)
  predict_locs$elev &lt;- terra::extract(elev_raster, predict_xy)[ , 1]
  predict_locs$grad &lt;- terra::extract(grad_raster, predict_xy)[ , 1]

# Run lrren
  test_lrren &lt;- lrren(obs_locs = obs_locs,
                      predict_locs = predict_locs,
                      predict = TRUE)
                      
# Run plot_predict
  plot_predict(input = test_lrren, cref0 = "EPSG:5472")
}

</code></pre>

<hr>
<h2 id='pval_correct'>Calculate p-value corrections</h2><span id='topic+pval_correct'></span>

<h3>Description</h3>

<p>Internal function to calculate various p-value corrections for use within the <code><a href="#topic+plot_obs">plot_obs</a></code>, <code><a href="#topic+plot_predict">plot_predict</a></code>, and <code><a href="#topic+perlrren">perlrren</a></code> functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pval_correct(
  input,
  type = c("FDR", "Sidak", "Bonferroni"),
  alpha = 0.05,
  nbc = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pval_correct_+3A_input">input</code></td>
<td>
<p>A vector of class 'numeric' of p-values from the <code><a href="#topic+plot_obs">plot_obs</a></code>, <code><a href="#topic+plot_predict">plot_predict</a></code>, or <code><a href="#topic+perlrren">perlrren</a></code> function.</p>
</td></tr>
<tr><td><code id="pval_correct_+3A_type">type</code></td>
<td>
<p>Character string specifying which correction for multiple comparisons. Options include a False Discovery Rate <code>p_correct = "FDR"</code>, a Sidak correction <code>p_correct = "Sidak"</code>, and a Bonferroni correction <code>p_correct = "Bonferroni"</code>.</p>
</td></tr>
<tr><td><code id="pval_correct_+3A_alpha">alpha</code></td>
<td>
<p>Numeric. The alpha level for significance threshold (default in <code><a href="#topic+plot_obs">plot_obs</a></code>, <code><a href="#topic+plot_predict">plot_predict</a></code>, and <code><a href="#topic+perlrren">perlrren</a></code> functions is 0.05).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function provides functionality for multiple testing correction in five ways:
</p>

<ol>
<li><p> Computes a False Discovery Rate by Benjamini and Hochberg <a href="https://doi.org/10.1111/j.2517-6161.1995.tb02031.x">doi:10.1111/j.2517-6161.1995.tb02031.x</a> (<code>p_correct = "FDR"</code>) by: 1) sorting the p-values (p_i) of each knot in ascending order (p_1 &lt;= p_2 &lt;= ... &lt;= p_m), 2) starting from p_m find the first p_i for which p_i &lt;= (i/m) * alpha.
</p>
</li>
<li><p> Computes a Sidak correction <a href="https://doi.org/10.2307/2283989">doi:10.2307/2283989</a> (<code>p_correct = "Sidak"</code>) by 1 - (1 - <code>alpha</code>) ^ (1 / total number of gridded knots across the estimated surface). The default in the <code><a href="sparr.html#topic+risk">risk</a></code> function is a resolution of 128 x 128 or n = 16,384 knots and a custom resolution can be specified using the <code>resolution</code> argument within the <code><a href="sparr.html#topic+risk">risk</a></code> function.
</p>
</li>
<li><p> Computes a Bonferroni correction (<code>p_correct = "Bonferroni"</code>) by <code>alpha</code> / total number of gridded knots across the estimated surface. The default in the <code><a href="sparr.html#topic+risk">risk</a></code> function is a resolution of 128 x 128 or n = 16,384 knots and a custom resolution can be specified using the <code>resolution</code> argument within the <code><a href="sparr.html#topic+risk">risk</a></code> function.
</p>
</li></ol>



<h3>Value</h3>

<p>An object of class 'numeric' with the corrected alpha level.
</p>

<hr>
<h2 id='seq_plot'>Prepare an 'im' or 'SpatRaster' object for plotting with sequential color palette</h2><span id='topic+seq_plot'></span>

<h3>Description</h3>

<p>Internal function to convert 'im' object or 'SpatRaster' object to values readable by <code><a href="fields.html#topic+image.plot">image.plot</a></code> function within the <code><a href="#topic+plot_perturb">plot_perturb</a></code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>seq_plot(input, cols, thresh_up = NULL, digits = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="seq_plot_+3A_input">input</code></td>
<td>
<p>An object of class 'im' or 'SpatRaster' from the <code><a href="#topic+perlrren">perlrren</a></code> function.</p>
</td></tr>
<tr><td><code id="seq_plot_+3A_cols">cols</code></td>
<td>
<p>Character string of length three (3) specifying the colors for plotting: 1) presence, 2) neither, and 3) absence from the <code><a href="#topic+plot_obs">plot_obs</a></code> function.</p>
</td></tr>
<tr><td><code id="seq_plot_+3A_thresh_up">thresh_up</code></td>
<td>
<p>Numeric. The upper value to concatenate the color key. The default (NULL) uses the maximum value from <code>input</code>.</p>
</td></tr>
<tr><td><code id="seq_plot_+3A_digits">digits</code></td>
<td>
<p>Integer. The number of significant digits for the labels using the <code><a href="base.html#topic+round">round</a></code> function (default is 1).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class 'list'. This is a named list with the following components:
</p>

<dl>
<dt><code>v</code></dt><dd><p>An object of class 'vector' for the estimated ecological niche values.</p>
</dd>
<dt><code>cols</code></dt><dd><p>An object of class 'vector', returns diverging color palette values.</p>
</dd>
<dt><code>breaks</code></dt><dd><p>An object of class 'vector', returns diverging color palette breaks.</p>
</dd>
<dt><code>at</code></dt><dd><p>An object of class 'vector', returns legend breaks.</p>
</dd>
<dt><code>labels</code></dt><dd><p>An object of class 'vector', returns legend labels.</p>
</dd>
</dl>


</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
