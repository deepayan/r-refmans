<!DOCTYPE html><html lang="en"><head><title>Help for package addreg</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {addreg}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#addreg-package'>
<p>Additive Regression for Discrete Data</p></a></li>
<li><a href='#addreg'>
<p>Additive Regression for Discrete Data</p></a></li>
<li><a href='#addreg.control'>
<p>Auxiliary for Controlling addreg Fitting</p></a></li>
<li><a href='#addreg.smooth'>
<p>Smooth Additive Regression for Discrete Data</p></a></li>
<li><a href='#anova.addreg'>
<p>Analysis of Deviance for addreg Fits</p></a></li>
<li><a href='#B.Iso'>
<p>Defining Smooths in addreg.smooth Formulae</p></a></li>
<li><a href='#confint.addreg'>
<p>Confidence Intervals for addreg Model Parameters</p></a></li>
<li><a href='#contr.isotonic'>
<p>Contrast Matrix for Isotonic Covariate</p></a></li>
<li><a href='#conv.test'>
<p>Convergence Test Based on L2 Norm</p></a></li>
<li><a href='#interpret.addreg.smooth'>
<p>Interpret an addreg.smooth Formula</p></a></li>
<li><a href='#negbin1'>
<p>Family Functions for Negative Binomial 1 Models</p></a></li>
<li><a href='#nnnegbin'>
<p>ECME Algorithm for Additive Negative Binomial 1 Model</p></a></li>
<li><a href='#nnpois'>
<p>EM Algorithm for Identity-link Poisson GLM</p></a></li>
<li><a href='#plot.addreg.smooth'>
<p>Default addreg.smooth Plotting</p></a></li>
<li><a href='#predict.addreg'>
<p>Predict Method for addreg Fits</p></a></li>
<li><a href='#predict.addreg.smooth'>
<p>Predict Method for addreg.smooth Fits</p></a></li>
<li><a href='#summary.addreg'>
<p>Summarizing addreg Model Fits</p></a></li>
<li><a href='#vcov.addreg'>
<p>Calculate Variance-Covariance Matrix for a Fitted addreg Model Object</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Additive Regression for Discrete Data</td>
</tr>
<tr>
<td>Description:</td>
<td>Methods for fitting identity-link GLMs and GAMs to discrete data,
    using EM-type algorithms with more stable convergence properties than standard methods.</td>
</tr>
<tr>
<td>Version:</td>
<td>3.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2017-12-20</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.0.1)</td>
</tr>
<tr>
<td>Imports:</td>
<td>splines, combinat, glm2, turboEM</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/mdonoghoe/addreg">https://github.com/mdonoghoe/addreg</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2017-12-19 22:01:13 UTC; 42674999</td>
</tr>
<tr>
<td>Author:</td>
<td>Mark W. Donoghoe [aut, cre],
  Ian C. Marschner [ths]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Mark W. Donoghoe &lt;markdonoghoe@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2017-12-23 23:22:06 UTC</td>
</tr>
</table>
<hr>
<h2 id='addreg-package'>
Additive Regression for Discrete Data
</h2><span id='topic+addreg-package'></span>

<h3>Description</h3>

<p>Methods for fitting identity-link GLMs and GAMs to discrete data, using EM-type
algorithms with more stable convergence properties than standard methods.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> addreg</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 3.0</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2017-12-20</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL (&gt;= 2)</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>This package provides methods to fit generalised linear models (GLMs) and generalised additive
models (GAMs) with identity link functions to discrete data using binomial, Poisson
and negative binomial models. It is planned that future versions will incorporate other types 
of discrete data models, such as multinomial regression.
</p>
<p>The package has two primary functions: <code><a href="#topic+addreg">addreg</a></code> and <code><a href="#topic+addreg.smooth">addreg.smooth</a></code>, 
together with various supporting functions. It is useful in two main situations. The first is 
when a standard GLM routine, such as <code><a href="stats.html#topic+glm">glm</a></code>, fails to converge with such a model. 
The second is when a flexible semi-parametric component is desired in these models. One of the 
main purposes of this package is to provide parametric and semi-parametric adjustment of risk 
differences and rate differences.
</p>
<p>Two approaches based on the EM algorithm can be used. These methods accommodate the required
parameter constraints and are more stable than iteratively reweighted least squares. In a 
combinatorial EM algorithm (Marschner, 2014), a collection of restricted parameter spaces is 
defined which covers the full parameter space, and the EM algorithm is applied within each
restricted parameter space in order to find a collection of restricted maxima of
the log-likelihood function, from which can be obtained the global maximum over the
full parameter space.
</p>
<p>In the expanded EM approach, additional parameters are added to the model,
and an EM algorithm finds the MLE of this overparameterised model by imposing
constraints on each individual parameter. This requires a single application of
the EM algorithm.
</p>
<p>In either case, the EM algorithm may be accelerated by using the capabilities of the
<span class="pkg"><a href="turboEM.html#topic+turboem">turboEM</a></span> package.
</p>


<h3>Author(s)</h3>

<p>Mark W. Donoghoe <a href="mailto:markdonoghoe@gmail.com">markdonoghoe@gmail.com</a>
</p>
<p>Maintainer: Mark W. Donoghoe <a href="mailto:markdonoghoe@gmail.com">markdonoghoe@gmail.com</a>
</p>


<h3>References</h3>

<p>Donoghoe, M. W. and I. C. Marschner (2014). Stable computational methods
for additive binomial models with application to adjusted risk differences. 
<em>Computational Statistics and Data Analysis</em> 80: 184&ndash;196.
</p>
<p>Donoghoe, M. W. and I. C. Marschner (2015). Flexible regression models for rate 
differences, risk differences and relative risks. <em>International Journal of 
Biostatistics</em> 11(1): 91&ndash;108.
</p>
<p>Donoghoe, M. W. and I. C. Marschner (2016). Estimation of adjusted rate
differences using additive negative binomial regression. <em>Statistics
in Medicine</em> 35(18): 3166&ndash;3178.
</p>
<p>Marschner, I. C. (2010). Stable computation of maximum likelihood estimates
in identity link Poisson regression. <em>Journal of Computational and 
Graphical Statistics</em> 19(3): 666&ndash;683.
</p>
<p>Marschner, I. C. (2014). Combinatorial EM algorithms.
<em>Statistics and Computing</em> 24(6): 921&ndash;940.
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+glm">glm</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## For examples, see example(addreg) and example(addreg.smooth)
</code></pre>

<hr>
<h2 id='addreg'>
Additive Regression for Discrete Data
</h2><span id='topic+addreg'></span>

<h3>Description</h3>

<p><code>addreg</code> fits additive (identity-link) Poisson, negative binomial
and binomial regression models using a stable combinatorial EM algorithm.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>addreg(formula, mono = NULL, family, data, standard, subset, na.action,
       start = NULL, offset, control = list(...), model = TRUE, 
       method = c("cem", "em"),
       accelerate = c("em", "squarem", "pem", "qn"), 
       control.method = list(), warn = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="addreg_+3A_formula">formula</code></td>
<td>

<p>an object of class <code>"<a href="stats.html#topic+formula">formula</a>"</code>
(or one that can be coerced into that class): a symbolic
description of the model to be fitted. The details of
model specification are given under &quot;Details&quot;.  Note that
the model must contain an intercept, and 2nd-order terms
(such as interactions) or above are currently not supported
&mdash; see &quot;Note&quot;.
</p>
</td></tr>
<tr><td><code id="addreg_+3A_mono">mono</code></td>
<td>

<p>a vector indicating which terms in
<code>formula</code> should be restricted to have a
monotonically non-decreasing relationship with the
outcome. May be specified as names or indices of the
terms.
</p>
</td></tr>
<tr><td><code id="addreg_+3A_family">family</code></td>
<td>

<p>a description of the error distribution to
be used in the model. This can be a character string
naming a family function, a family function or the result
of a call to a family function (see
<code><a href="stats.html#topic+family">family</a></code> for details of family
functions), but here it is restricted to be <code><a href="stats.html#topic+poisson">poisson</a></code>,
<code><a href="#topic+negbin1">negbin1</a></code> or <code><a href="stats.html#topic+binomial">binomial</a></code> family with <code>identity</code> link.
</p>
</td></tr>
<tr><td><code id="addreg_+3A_data">data</code></td>
<td>

<p>an optional data frame, list or environment
(or object coercible by <code><a href="base.html#topic+as.data.frame">as.data.frame</a></code> to a
data frame) containing the variables in the model. If not
found in <code>data</code>, the variables are taken from
<code><a href="base.html#topic+environment">environment</a>(formula)</code>, typically the environment
from which <code>addreg</code> is called.
</p>
</td></tr>
<tr><td><code id="addreg_+3A_standard">standard</code></td>
<td>

<p>a numeric vector of length equal to the
number of cases, where each element is a positive
constant that (multiplicatively) standardises the fitted
value of the corresponding element of the response
vector. Ignored for binomial family (two-column
specification of response should be used instead).
</p>
</td></tr>
<tr><td><code id="addreg_+3A_subset">subset</code></td>
<td>

<p>an optional vector specifying a subset of
observations to be used in the fitting process.
</p>
</td></tr>
<tr><td><code id="addreg_+3A_na.action">na.action</code></td>
<td>

<p>a function which indicates what should happen when the data
contain <code>NA</code>s. The default is set be the <code>na.action</code>
setting of <code><a href="base.html#topic+options">options</a></code>, and is <code><a href="stats.html#topic+na.fail">na.fail</a></code>
if that is unset. The &lsquo;factory-fresh&rsquo; default is <code><a href="stats.html#topic+na.omit">na.omit</a></code>.
Another possible value is <code>NULL</code>, no action. Value
<code><a href="stats.html#topic+na.exclude">na.exclude</a></code> can be useful.
</p>
</td></tr>
<tr><td><code id="addreg_+3A_start">start</code></td>
<td>

<p>starting values for the parameters in the
linear predictor, also with the starting value for
the <code>scale</code> as the last element when
<code>family = <a href="#topic+negbin1">negbin1</a></code>.
</p>
</td></tr>
<tr><td><code id="addreg_+3A_offset">offset</code></td>
<td>

<p>this can be used to specify an <em>a
priori</em> known component to be included in the linear
predictor during fitting. This should be <code>NULL</code> or a
<em>non-negative</em> numeric vector of length equal to the number of cases.
One or more <code><a href="stats.html#topic+offset">offset</a></code> terms can be included in
the formula instead or as well, and if more than one is
specified their sum is used. See
<code><a href="stats.html#topic+model.offset">model.offset</a></code>.
</p>
<p>Ignored for binomial family; not yet implemented for negative binomial models.
</p>
</td></tr>
<tr><td><code id="addreg_+3A_control">control</code></td>
<td>

<p>list of parameters for controlling the
fitting process, passed to
<code><a href="#topic+addreg.control">addreg.control</a></code>.
</p>
</td></tr>
<tr><td><code id="addreg_+3A_model">model</code></td>
<td>

<p>a logical value indicating whether the <em>model frame</em> 
(and, for binomial models, the equivalent Poisson model)
should be included as a component of the returned value.
</p>
</td></tr>
<tr><td><code id="addreg_+3A_method">method</code></td>
<td>

<p>a character string that determines which algorithm to use to
find the MLE: <code>"cem"</code> for the combinatorial EM algorithm,
which cycles through a sequence of constrained parameter spaces,
or <code>"em"</code> for a single EM algorithm based on an
overparameterised model.
</p>
</td></tr>
<tr><td><code id="addreg_+3A_accelerate">accelerate</code></td>
<td>

<p>a character string that determines the acceleration
algorithm to be used, (partially) matching one of <code>"em"</code> (no acceleration &mdash; the default), 
<code>"squarem"</code>, <code>"pem"</code> or <code>"qn"</code>. See <code><a href="turboEM.html#topic+turboem">turboem</a></code>
for further details. Note that <code>"decme"</code> is not permitted.
</p>
</td></tr>
<tr><td><code id="addreg_+3A_control.method">control.method</code></td>
<td>

<p>a list of control parameters for the acceleration algorithm, which are passed to 
the <code>control.method</code> argument of <code><a href="turboEM.html#topic+turboem">turboem</a></code>.
</p>
<p>If any items are not specified, the defaults are used.
</p>
</td></tr>
<tr><td><code id="addreg_+3A_warn">warn</code></td>
<td>

<p>a logical indicating whether or not warnings should be
provided for non-convergence or boundary values.
</p>
</td></tr>
<tr><td><code id="addreg_+3A_...">...</code></td>
<td>

<p>arguments to be used to form the default
<code>control</code> argument if it is not supplied directly.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>addreg</code> fits a generalised linear model (GLM) with a
Poisson or binomial error distribution and identity link
function, as well as additive NegBin I models (which are not 
GLMs). Predictors are assumed to be continuous, unless
they are of class <code><a href="base.html#topic+factor">factor</a></code>, or are character or
logical (in which case they are converted to
<code>factor</code>s). Specifying a predictor as monotonic using
the <code>mono</code> argument means that for continuous terms,
the associated coefficient will be restricted to be
non-negative, and for categorical terms, the coefficients
will be non-decreasing in the order of the factor
<code>levels</code>. This allows semi-parametric monotonic regression
functions, in the form of unsmoothed step-functions. For 
smooth regression functions see <code><a href="#topic+addreg.smooth">addreg.smooth</a></code>.
</p>
<p>As well as allowing monotonicity constraints, the function 
is useful when a standard GLM routine, such as
<code><a href="stats.html#topic+glm">glm</a></code>, fails to converge with an identity-link Poisson
or binomial model. If <code><a href="stats.html#topic+glm">glm</a></code> does achieve successful convergence,
and <code>addreg</code> converges to an interior point, then the two
results will be identical. However, <code><a href="stats.html#topic+glm">glm</a></code> may still experience convergence 
problems even when <code>addreg</code> converges to an interior point. 
Note that if <code>addreg</code> converges to a boundary point, then it 
may differ slightly from <code><a href="stats.html#topic+glm">glm</a></code> even if <code><a href="stats.html#topic+glm">glm</a></code> successfully 
converges, because of differences in the definition of the parameter 
space. <code>addreg</code> produces valid fitted values for covariate 
values within the Cartesian product of the observed range of covariate 
values, whereas <code><a href="stats.html#topic+glm">glm</a></code> produces valid fitted values just 
for the observed covariate combinations (assuming it successfully 
converges). This issue is only relevant when <code>addreg</code> 
converges to a boundary point.
</p>
<p>The computational method is a combinatorial EM algorithm
(Marschner, 2014), which accommodates the parameter
contraints in the model and is more stable than iteratively
reweighted least squares. A collection of restricted
parameter spaces is defined which covers the full parameter
space, and the EM algorithm is applied within each
restricted parameter space in order to find a collection of
restricted maxima of the log-likelihood function, from
which can be obtained the global maximum over the full
parameter space. See Marschner (2010), Donoghoe and 
Marschner (2014) and Donoghoe and Marschner (2016) for further details.
</p>
<p>Acceleration of the EM algorithm can be achieved through the
methods of the <span class="pkg"><a href="turboEM.html#topic+turboem">turboEM</a></span> package, specified
through the <code>accelerate</code> argument. However, note that these
methods do not have the guaranteed convergence of the standard
EM algorithm, particularly when the MLE is on the boundary of
its (possibly constrained) parameter space.
</p>


<h3>Value</h3>

<p><code>addreg</code> returns an object of class <code>"addreg"</code>,
which inherits from classes <code>"glm"</code> and <code>"lm"</code>.
The function <code><a href="#topic+summary.addreg">summary.addreg</a></code> can be used 
to obtain or print a summary of the results.
</p>
<p>The generic accessor functions <code><a href="stats.html#topic+coefficients">coefficients</a></code>,
<code><a href="stats.html#topic+fitted.values">fitted.values</a></code> and <code><a href="stats.html#topic+residuals">residuals</a></code> can be used to
extract various useful features of the value returned by
<code>addreg</code>. Note that <code><a href="stats.html#topic+effects">effects</a></code> will not work.
</p>
<p>An object of class <code>"addreg"</code> is a list containing the
same components as an object of class <code>"glm"</code> (see the
&quot;Value&quot; section of <code><a href="stats.html#topic+glm">glm</a></code>), but without
<code>contrasts</code>, <code>qr</code>, <code>R</code> or <code>effects</code>
components. It also includes: 
</p>
<table role = "presentation">
<tr><td><code>loglik</code></td>
<td>
<p>the maximised log-likelihood.</p>
</td></tr>
<tr><td><code>aic.c</code></td>
<td>
<p>a small-sample corrected
version of Akaike's <em>An Information Criterion</em>
(Hurvich, Simonoff and Tsai, 1998). This is used by
<code><a href="#topic+addreg.smooth">addreg.smooth</a></code> to choose the optimal number of
knots for smooth terms.</p>
</td></tr> 
<tr><td><code>xminmax</code></td>
<td>
<p>the minimum and maximum observed values
for each of the continuous covariates, to help define
the covariate space of the model.</p>
</td></tr>
</table>
<p>As well as, for Poisson and negative binomial models:
</p>
<table role = "presentation">
<tr><td><code>nn.coefficients</code></td>
<td>
<p>estimated coefficients associated
with the non-negative parameterisation corresponding to the
MLE.</p>
</td></tr> 
<tr><td><code>nn.x</code></td>
<td>
<p>non-negative model matrix associated with
<code>nn.coefficients</code>.</p>
</td></tr> 
<tr><td><code>standard</code></td>
<td>
<p>the <code>standard</code> argument.</p>
</td></tr> 
</table>
<p>Or, for binomial models:
</p>
<table role = "presentation">
<tr><td><code>model.addpois</code></td>
<td>
<p>if requested, the <code>addreg</code> object for the associated identity-link
Poisson model.</p>
</td></tr>
</table>
<p>The <code>scale</code> component of the result is fixed at <code class="reqn">1</code> for
Poisson and binomial models, and is the constant overdispersion parameter
for negative binomial models (that is, <code>scale</code> = <code class="reqn">1+\phi</code>) where 
<code class="reqn">Var(\mu) = (1+\phi)\mu</code>).
</p>


<h3>Note</h3>

<p>Due to the way the covariate space is defined in the CEM algorithm,
specifying interactions in the formula is not currently supported 
by <code>addreg</code>. 2-way interactions between factors can be
included by calculating a new factor term that has levels
corresponding to all possible combinations of the factor
levels. See the Example.
</p>


<h3>Author(s)</h3>

<p>Mark W. Donoghoe <a href="mailto:markdonoghoe@gmail.com">markdonoghoe@gmail.com</a>
</p>


<h3>References</h3>

<p>Donoghoe, M. W. and I. C. Marschner (2014). Stable computational methods
for additive binomial models with application to adjusted risk differences. 
<em>Computational Statistics and Data Analysis</em> 80: 184&ndash;196.
</p>
<p>Donoghoe, M. W. and I. C. Marschner (2016). Estimation of adjusted rate
differences using additive negative binomial regression. <em>Statistics
in Medicine</em> 35(18): 3166&ndash;3178.
</p>
<p>Hurvich, C. M., J. S. Simonoff and C.-L. Tsai (1998). Smoothing parameter 
selection in nonparametric regression using an improved Akaike 
information criterion.
<em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em> 60(2): 271&ndash;293.
</p>
<p>Marschner, I. C. (2010). Stable computation of maximum likelihood estimates
in identity link Poisson regression. <em>Journal of Computational and 
Graphical Statistics</em> 19(3): 666&ndash;683.
</p>
<p>Marschner, I. C. (2014). Combinatorial EM algorithms.
<em>Statistics and Computing</em> 24(6): 921&ndash;940.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>require(glm2)
data(crabs)

#============================================================================
#  identity-link Poisson model with periodic non-convergence when glm is used
#============================================================================

crabs.boot &lt;- crabs[crabs$Rep1,-c(5:6)]
crabs.boot$width.shifted &lt;- crabs.boot$Width - min(crabs$Width)

fit.glm &lt;- glm(Satellites ~ width.shifted + factor(Dark) + factor(GoodSpine),
  family = poisson(identity), data = crabs.boot, start = rep(1,4), 
  control = glm.control(trace = TRUE))
  
fit.addreg &lt;- addreg(formula(fit.glm), family = poisson, data = crabs.boot,
  trace = 1)

# Speed up convergence by using single EM algorithm
fit.addreg.em &lt;- update(fit.addreg, method = "em")

# Speed up convergence by using acceleration methods
fit.addreg.acc &lt;- update(fit.addreg, accelerate = "squarem")
fit.addreg.em.acc &lt;- update(fit.addreg.em, accelerate = "squarem")
  
# Usual S3 methods work on addreg objects
summary(fit.addreg)
vcov(fit.addreg)
confint(fit.addreg)
summary(predict(fit.addreg), type = "response")

fit.addreg2 &lt;- addreg(update(formula(fit.glm), ~ . - factor(GoodSpine)),
  family = poisson, data = crabs.boot, trace = 1)
anova(fit.addreg2, fit.addreg, test = "LRT")

# Account for overdispersion (use start to speed it up a little)
fit.addreg.od &lt;- addreg(Satellites ~ factor(Dark) + factor(GoodSpine),
  family = negbin1, data = crabs.boot, trace = 1,
  start = c(4.3423675,-2.4059273,-0.4531984,5.969648))
summary(fit.addreg.od)
</code></pre>

<hr>
<h2 id='addreg.control'>
Auxiliary for Controlling addreg Fitting
</h2><span id='topic+addreg.control'></span>

<h3>Description</h3>

<p>Auxiliary function for <code><a href="#topic+addreg">addreg</a></code> fitting.
Typically only used internally by <code><a href="#topic+nnpois">nnpois</a></code> and 
<code><a href="#topic+nnnegbin">nnnegbin</a></code>, but may 
be used to construct a <code>control</code> argument to these functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>addreg.control(bound.tol = 1e-06, epsilon = 1e-10, maxit = 10000, trace = 0)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="addreg.control_+3A_bound.tol">bound.tol</code></td>
<td>

<p>positive tolerance specifying the
interior of the parameter space. If the fitted model is
more than <code>bound.tol</code> away from the boundary of the
parameter space then it is assumed to be in the interior.
This can allow the computational method to terminate
early if an interior maximum is found.  No early
termination is attempted if <code>bound.tol = Inf</code>.
</p>
</td></tr>
<tr><td><code id="addreg.control_+3A_epsilon">epsilon</code></td>
<td>

<p>positive convergence tolerance
<code class="reqn">\epsilon</code>; the estimates are considered to have 
converged when <code class="reqn">\sqrt{
  \sum (\theta_{old} - \theta_{new})^2} / \sqrt {\sum
  \theta_{old}^2} &lt; \epsilon</code>, where <code class="reqn">\theta</code> is the
vector of parameter estimates. See <code><a href="#topic+conv.test">conv.test</a></code>.
</p>
</td></tr>
<tr><td><code id="addreg.control_+3A_maxit">maxit</code></td>
<td>

<p>integer giving the maximum number of EM
algorithm iterations for a given parameterisation.
</p>
</td></tr>
<tr><td><code id="addreg.control_+3A_trace">trace</code></td>
<td>

<p>number indicating level of output that
should be produced. &gt;= 1 gives output for each
parameterisation, &gt;= 2 gives output at each iteration.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is used similarly to <code><a href="stats.html#topic+glm.control">glm.control</a></code>. The
<code>control</code> argument of <code><a href="#topic+addreg">addreg</a></code> is by
default passed to the <code>control</code> argument of
<code><a href="#topic+nnpois">nnpois</a></code> or <code><a href="#topic+nnnegbin">nnnegbin</a></code>.
</p>
<p>When <code>trace</code> is greater than zero, calls to
<code><a href="base.html#topic+cat">cat</a></code> produce the output. Hence,
<code><a href="base.html#topic+options">options</a>(digits = *)</code> can be used to increase
the precision.
</p>


<h3>Value</h3>

<p>A list with components named as the arguments.
</p>


<h3>Author(s)</h3>

<p>Mark W. Donoghoe <a href="mailto:markdonoghoe@gmail.com">markdonoghoe@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+glm.control">glm.control</a></code>, the equivalent function for
<code><a href="stats.html#topic+glm">glm</a></code> fitting.
</p>
<p><code><a href="#topic+nnpois">nnpois</a></code> and <code><a href="#topic+nnnegbin">nnnegbin</a></code>, the
functions used to fit <code><a href="#topic+addreg">addreg</a></code> models.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Variation on example(glm.control) :

counts &lt;- c(18,17,15,20,10,20,25,13,12)
outcome &lt;- gl(3,1,9)
treatment &lt;- gl(3,3)
oo &lt;- options(digits = 12)
addreg.D93X &lt;- addreg(counts ~ outcome + treatment, family = poisson, 
  trace = 2, epsilon = 1e-2)
options(oo)
coef(addreg.D93X)
</code></pre>

<hr>
<h2 id='addreg.smooth'>
Smooth Additive Regression for Discrete Data
</h2><span id='topic+addreg.smooth'></span>

<h3>Description</h3>

<p><code>addreg.smooth</code> fits additive (identity-link) Poisson, negative binomial
and binomial regression models using a stable EM algorithm. It provides additional
flexibility over <code><a href="#topic+addreg">addreg</a></code> by allowing for semi-parametric
terms.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>addreg.smooth(formula, mono = NULL, family, data, standard, subset, 
              na.action, offset, control = list(...), model = TRUE, 
              model.addreg = FALSE, method = c("cem", "em"), 
              accelerate = c("em", "squarem", "pem", "qn"),
              control.method = list(), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="addreg.smooth_+3A_formula">formula</code></td>
<td>

<p>an object of class <code>"<a href="stats.html#topic+formula">formula</a>"</code>
(or one that can be coerced into that class): a symbolic
description of the model to be fitted. The details of
model specification are given under &quot;Details&quot;.  The model 
must contain an intercept and at least one semi-parametric
term, included by using the <code><a href="#topic+B">B</a></code> or <code><a href="#topic+Iso">Iso</a></code>
functions. Note that 2nd-order terms (such as interactions) or above 
are not currently supported (see <code><a href="#topic+addreg">addreg</a></code>).
</p>
</td></tr>
<tr><td><code id="addreg.smooth_+3A_mono">mono</code></td>
<td>

<p>a vector indicating which terms in
<code>formula</code> should be restricted to have a
monotonically non-decreasing relationship with the
outcome. May be specified as names or indices of the
terms.
</p>
<p><code><a href="#topic+Iso">Iso</a>()</code> terms are always monotonic.
</p>
</td></tr>
<tr><td><code id="addreg.smooth_+3A_family">family</code></td>
<td>

<p>a description of the error distribution to
be used in the model. This can be a character string
naming a family function, a family function or the result
of a call to a family function (see
<code><a href="stats.html#topic+family">family</a></code> for details of family
functions), but here it is restricted to be <code><a href="stats.html#topic+poisson">poisson</a></code>,
<code><a href="#topic+negbin1">negbin1</a></code> or <code><a href="stats.html#topic+binomial">binomial</a></code> family with <code>identity</code> link.
</p>
</td></tr>
<tr><td><code id="addreg.smooth_+3A_data">data</code></td>
<td>

<p>an optional data frame, list or environment
(or object coercible by <code><a href="base.html#topic+as.data.frame">as.data.frame</a></code> to a
data frame) containing the variables in the model. If not
found in <code>data</code>, the variables are taken from
<code><a href="base.html#topic+environment">environment</a>(formula)</code>, typically the environment
from which <code>addreg.smooth</code> is called.
</p>
</td></tr>
<tr><td><code id="addreg.smooth_+3A_standard">standard</code></td>
<td>

<p>a numeric vector of length equal to the
number of cases, where each element is a positive
constant that (multiplicatively) standardises the fitted
value of the corresponding element of the response
vector. Ignored for binomial family (the two-column
specification of response should be used instead).
</p>
</td></tr>
<tr><td><code id="addreg.smooth_+3A_subset">subset</code></td>
<td>

<p>an optional vector specifying a subset of
observations to be used in the fitting process.
</p>
</td></tr>
<tr><td><code id="addreg.smooth_+3A_na.action">na.action</code></td>
<td>

<p>a function which indicates what should happen when the data
contain <code>NA</code>s. The default is set be the <code>na.action</code>
setting of <code><a href="base.html#topic+options">options</a></code>, and is <code><a href="stats.html#topic+na.fail">na.fail</a></code>
if that is unset. The &lsquo;factory-fresh&rsquo; default is <code><a href="stats.html#topic+na.omit">na.omit</a></code>.
Another possible value is <code>NULL</code>, no action. Value
<code><a href="stats.html#topic+na.exclude">na.exclude</a></code> can be useful.
</p>
</td></tr>
<tr><td><code id="addreg.smooth_+3A_offset">offset</code></td>
<td>

<p>this can be used to specify an <em>a
priori</em> known component to be included in the linear
predictor during fitting. This should be <code>NULL</code> or a
<em>non-negative</em> numeric vector of length equal to the number of cases.
One or more <code><a href="stats.html#topic+offset">offset</a></code> terms can be included in
the formula instead or as well, and if more than one is
specified their sum is used. See
<code><a href="stats.html#topic+model.offset">model.offset</a></code>.
</p>
<p>Ignored for binomial family; not yet implemented for negative binomial models.
</p>
</td></tr>
<tr><td><code id="addreg.smooth_+3A_control">control</code></td>
<td>

<p>list of parameters for controlling the
fitting process, passed to
<code><a href="#topic+addreg.control">addreg.control</a></code>.
</p>
</td></tr>
<tr><td><code id="addreg.smooth_+3A_model">model</code></td>
<td>

<p>a logical value indicating whether the <em>model frame</em> 
(and, for binomial models, the equivalent Poisson model)
should be included as a component of the returned value.
</p>
</td></tr>
<tr><td><code id="addreg.smooth_+3A_model.addreg">model.addreg</code></td>
<td>

<p>a logical value indicating whether the fitted <code>addreg</code>
object should be included as a component of the returned value.
</p>
</td></tr>
<tr><td><code id="addreg.smooth_+3A_method">method</code></td>
<td>

<p>a character string that determines which EM-type algorithm to use
to find the MLE: <code>"cem"</code> for the combinatorial EM algorithm,
which cycles through a sequence of constrained parameter spaces, or
<code>"em"</code> for a single EM algorithm based on an overparameterised
model.
</p>
</td></tr>
<tr><td><code id="addreg.smooth_+3A_accelerate">accelerate</code></td>
<td>

<p>a character string that determines the acceleration
algorithm to be used, (partially) matching one of <code>"em"</code> (no acceleration &mdash; the default), 
<code>"squarem"</code>, <code>"pem"</code> or <code>"qn"</code>. See <code><a href="turboEM.html#topic+turboem">turboem</a></code>
for further details. Note that <code>"decme"</code> is not permitted.
</p>
</td></tr>
<tr><td><code id="addreg.smooth_+3A_control.method">control.method</code></td>
<td>

<p>a list of control parameters for the acceleration algorithm, which are passed to 
the <code>control.method</code> argument of <code><a href="turboEM.html#topic+turboem">turboem</a></code>.
</p>
<p>If any items are not specified, the defaults are used.
</p>
</td></tr>
<tr><td><code id="addreg.smooth_+3A_...">...</code></td>
<td>

<p>arguments to be used to form the default
<code>control</code> argument if it is not supplied directly.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>addreg.smooth</code> performs the same fitting process as <code><a href="#topic+addreg">addreg</a></code>,
providing a stable maximum likelihood estimation procedure for identity-link
Poisson, negative binomial or binomial models, with the added flexibility of allowing semi-parametric
<code><a href="#topic+B">B</a></code> and <code><a href="#topic+Iso">Iso</a></code> terms (note that <code>addreg.smooth</code> will stop with an 
error if no semi-parametric terms are specified in the right-hand side of the <code>formula</code>; 
<code><a href="#topic+addreg">addreg</a></code> should be used instead).
</p>
<p>The method partitions the parameter space associated with the semi-parametric part of the
model into a sequence of constrained parameter spaces, and defines a fully parametric 
<code>addreg</code> model for each. The model with the highest log-likelihood is the MLE for 
the semi-parametric model (see Donoghoe and Marschner, 2015).
</p>
<p>Acceleration of the EM algorithm can be achieved through the
methods of the <span class="pkg"><a href="turboEM.html#topic+turboem">turboEM</a></span> package, specified
through the <code>accelerate</code> argument. However, note that these
methods do not have the guaranteed convergence of the standard
EM algorithm, particularly when the MLE is on the boundary of
its (possibly constrained) parameter space.
</p>


<h3>Value</h3>

<p>An object of class <code>"addreg.smooth"</code>, which contains the same objects as class
<code>"addreg"</code> (the same as <code>"<a href="stats.html#topic+glm">glm</a>"</code> objects, without <code>contrasts</code>,
<code>qr</code>, <code>R</code> or <code>effects</code> components), as well as:
</p>
<table role = "presentation">
<tr><td><code>model.addreg</code></td>
<td>
<p>if <code>model.addreg</code> is <code>TRUE</code>; the <code>addreg</code> object
for the fully parametric model corresponding to the fitted model.</p>
</td></tr>
<tr><td><code>xminmax.smooth</code></td>
<td>
<p>the minimum and maximum observed values for
each of the smooth terms in the model, to help define the 
covariate space.</p>
</td></tr>
<tr><td><code>full.formula</code></td>
<td>
<p>the component from <code><a href="#topic+interpret.addreg.smooth">interpret.addreg.smooth</a>(formula)</code>
that contains the <code>formula</code> term with any additional arguments to the <code><a href="#topic+B">B</a></code>
function removed.</p>
</td></tr>
<tr><td><code>knots</code></td>
<td>
<p>a named list containing the knot vectors for each of the smooth
terms in the model.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Mark W. Donoghoe <a href="mailto:markdonoghoe@gmail.com">markdonoghoe@gmail.com</a>
</p>


<h3>References</h3>

<p>Donoghoe, M. W. and I. C. Marschner (2015). Flexible regression models for rate 
differences, risk differences and relative risks. <em>International Journal of 
Biostatistics</em> 11(1): 91&ndash;108.
</p>
<p>Marschner, I. C. (2014). Combinatorial EM algorithms.
<em>Statistics and Computing</em> 24(6): 921&ndash;940.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+addreg">addreg</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Simple example
dat &lt;- data.frame(x1 = c(3.2,3.3,3.4,7.9,3.8,0.7,2.0,5.4,8.4,3.0,1.8,5.6,5.5,9.0,8.2),
  x2 = c(1,0,0,1,0,1,0,0,0,0,1,0,1,1,0),
  n = c(6,7,5,9,10,7,9,6,6,7,7,8,6,8,10),
  y = c(2,1,2,6,3,1,2,2,4,4,1,2,5,7,7))
m1 &lt;- addreg.smooth(cbind(y, n-y) ~ B(x1, knot.range = 1:3) + factor(x2), mono = 1,
  data = dat, family = binomial, trace = 1)

plot(m1, at = data.frame(x2 = 0:1))
points(dat$x1, dat$y / dat$n, col = rainbow(2)[dat$x2 + 1], pch = 20)

</code></pre>

<hr>
<h2 id='anova.addreg'>
Analysis of Deviance for addreg Fits
</h2><span id='topic+anova.addreg'></span><span id='topic+anova.addreglist'></span>

<h3>Description</h3>

<p>Compute an analysis of deviance table for more than one
GLM fitted using <code><a href="#topic+addreg">addreg</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'addreg'
anova(object, ..., test = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="anova.addreg_+3A_object">object</code>, <code id="anova.addreg_+3A_...">...</code></td>
<td>

<p>objects of class <code>"addreg"</code>,
typically the result of a call to <code><a href="#topic+addreg">addreg</a></code>,
or a <code><a href="base.html#topic+list">list</a></code> of <code>objects</code> for the &quot;<code>addreglist</code>&quot;
method.
</p>
</td></tr>
<tr><td><code id="anova.addreg_+3A_test">test</code></td>
<td>

<p>a character string, (partially) matching one
of <code>"Chisq"</code>, <code>"LRT"</code>, <code>"Rao"</code>, <code>"F"</code>
or <code>"Cp"</code>. See <code><a href="stats.html#topic+stat.anova">stat.anova</a></code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Unlike <code><a href="stats.html#topic+anova.glm">anova.glm</a></code>, specifying a single object
is not allowed.
</p>
<p>The table has a row for the residual degrees of freedom and
deviance for each model. For all but the first model, the
change in degrees of freedom and deviance is also given.
(This only makes statistical sense if the models are
nested.) It is conventional to list the models from
smallest to largest, but this is up to the user.
</p>
<p>Models where the MLE lies on the boundary of the parameter
space will be automatically removed from the list (with a
warning), because asymptotic results to not apply to such
models.
</p>
<p>The table will optionally contain test statistics (and p-values) 
comparing the reduction in deviance for the row to
the residuals. Mallows' <em>Cp</em> statistic is the residual
deviance plus twice the estimate of <code class="reqn">\sigma^2</code> times
the residual degrees of freedom, which is closely related
to AIC. You can also choose <code>"LRT"</code> and <code>"Rao"</code>
for likelihood ratio tests and Rao's efficient score test.
The former is synonymous with <code>"Chisq"</code> (although both
have an asymptotic chi-square distribution).
</p>


<h3>Value</h3>

<p>An object of class <code>"anova"</code> inheriting from class
<code>"data.frame"</code>.
</p>


<h3>Warning</h3>

<p>The comparison between two or more models will only be
valid if they are fitted to the same dataset. This may be
a problem if there are missing values and R's
default of <code>na.action = na.omit</code> is used, and
<code>anova</code> will detect this with an error.
</p>


<h3>Author(s)</h3>

<p>Mark W. Donoghoe <a href="mailto:markdonoghoe@gmail.com">markdonoghoe@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+addreg">addreg</a></code>, <code><a href="stats.html#topic+anova.glm">anova.glm</a></code>,
<code><a href="stats.html#topic+anova">anova</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## For an example, see example(addreg)
</code></pre>

<hr>
<h2 id='B.Iso'>
Defining Smooths in addreg.smooth Formulae
</h2><span id='topic+B'></span><span id='topic+Iso'></span>

<h3>Description</h3>

<p>Function used in the definition of smooth terms within <code><a href="#topic+addreg.smooth">addreg.smooth</a></code>
model formulae. The function does not evaluate a smooth &mdash; it exists purely to help
set up a model using smooths.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>B(..., knots = NULL, knot.range = 0:5)

Iso(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="B.Iso_+3A_...">...</code></td>
<td>

<p>variable that this smooth is a function of. Note that unlike <code><a href="mgcv.html#topic+gam">gam</a></code>,
smooths that are functions of more than one variable are not supported.
</p>
</td></tr>
<tr><td><code id="B.Iso_+3A_knots">knots</code></td>
<td>

<p><em>unique</em> positions of <em>interior</em> knots of a B-spline basis. Boundary
knots are created automatically.
</p>
</td></tr>
<tr><td><code id="B.Iso_+3A_knot.range">knot.range</code></td>
<td>

<p>if <code>knots</code> is not specified, a vector containing a series of non-negative
integers denoting the number of <em>interior</em> knots for which the model will be fit.
These are placed at evenly-spaced quantiles of the observed covariate values.
</p>
<p>At least one of <code>knots</code> or <code>knot.range</code> must be non-missing.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function does not evaluate the variable arguments; the
output from this function is used when producing the model
matrix, at which point the actual basis functions are constructed.
</p>
<p><code>B</code> is used to specify an order-3 B-spline basis (which can be
restricted to be monotonically non-decreasing via the
<code>mono</code> argument in <code><a href="#topic+addreg.smooth">addreg.smooth</a></code>). If
<code>length(knot.range) &gt; 1</code>, models with each of the
specified number of interior knots will be fit, and the model
with the best (smallest) <code>aic.c</code> will be returned.
</p>
<p><code>Iso</code> is used to specify an isotonic basis, designed
such that the resulting function has non-negative
increments at each observed covariate value. When
<code>Iso</code> is used, the resulting function will always be
monotonically non-decreasing, regardless of the value of
<code>mono</code>.
</p>


<h3>Value</h3>

<p>An object of class <code>"B.smooth"</code> (for <code>B</code>) or
<code>"Iso.smooth"</code> (for <code>Iso</code>), which is a list with
the following elements: </p>
<table role = "presentation">
<tr><td><code>term</code></td>
<td>
<p>name of the term
provided in the <code>...</code> argument.</p>
</td></tr>
<tr><td><code>termlabel</code></td>
<td>
<p>label for the term in the model; e.g. for
term <code>"x"</code> it will be <code>"B(x)"</code> or
<code>"Iso(x)"</code>.</p>
</td></tr> <tr><td><code>knots</code></td>
<td>
<p>vector of interior knots (if
specified). <code>NA</code> for <code>Iso</code>.</p>
</td></tr>
<tr><td><code>knot.range</code></td>
<td>
<p>vector of number of interior knots.
<code>NA</code> for <code>Iso</code>.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Mark W. Donoghoe <a href="mailto:markdonoghoe@gmail.com">markdonoghoe@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+addreg.smooth">addreg.smooth</a></code>
</p>
<p><code><a href="mgcv.html#topic+s">s</a></code> performs a similar function in the <code><a href="mgcv.html#topic+mgcv">mgcv</a></code> package.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## See example(addreg.smooth) for an example of specifying smooths in model
##  formulae.
</code></pre>

<hr>
<h2 id='confint.addreg'>
Confidence Intervals for addreg Model Parameters
</h2><span id='topic+confint.addreg'></span>

<h3>Description</h3>

<p>Computes confidence intervals for one or more parameters in
a fitted <code><a href="#topic+addreg">addreg</a></code> model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'addreg'
confint(object, parm, level = 0.95, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="confint.addreg_+3A_object">object</code></td>
<td>

<p>a fitted model object, resulting from a
call to <code><a href="#topic+addreg">addreg</a></code>.
</p>
</td></tr>
<tr><td><code id="confint.addreg_+3A_parm">parm</code></td>
<td>

<p>a specification of which parameters are to be
given confidence intervals, either a vector of numbers or
a vector of names. If missing, all parameters are
considered.
</p>
</td></tr>
<tr><td><code id="confint.addreg_+3A_level">level</code></td>
<td>

<p>the confidence level required.
</p>
</td></tr>
<tr><td><code id="confint.addreg_+3A_...">...</code></td>
<td>

<p>additional argument(s) passed to <code><a href="stats.html#topic+confint.default">confint.default</a></code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Calculates confidence intervals for model parameters assuming asymptotic normality, using <code><a href="#topic+vcov.addreg">vcov.addreg</a>(object)</code>. As
such, if the MLE is on the boundary of the parameter space,
(i.e. <code>object$boundary == TRUE</code>) the normality assumption 
is invalid and <code>NA</code> is returned.
</p>


<h3>Value</h3>

<p>A matrix (or vector) with columns giving lower and upper
confidence limits for each parameter. These will be
labelled as (1-level)/2 and 1-(1-level)/2 in % (by default
2.5% and 97.5%).
</p>


<h3>Author(s)</h3>

<p>Mark W. Donoghoe <a href="mailto:markdonoghoe@gmail.com">markdonoghoe@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+confint.default">confint.default</a></code>, <code><a href="#topic+vcov.addreg">vcov.addreg</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## For an example, see example(addreg)
</code></pre>

<hr>
<h2 id='contr.isotonic'>
Contrast Matrix for Isotonic Covariate
</h2><span id='topic+contr.isotonic'></span><span id='topic+contr.opisotonic'></span>

<h3>Description</h3>

<p>Return something similar to a contrast matrix for a categorical
covariate that we wish to be monotonically non-decreasing
in a specified order.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>contr.isotonic(n, perm, contrasts = TRUE, sparse = FALSE)

contr.opisotonic(n, perm, contrasts = TRUE, sparse = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="contr.isotonic_+3A_n">n</code></td>
<td>

<p>a vector of levels for a factor, or the number
of levels.
</p>
</td></tr>
<tr><td><code id="contr.isotonic_+3A_perm">perm</code></td>
<td>

<p>a permutation of the levels of <code>n</code> (or
of the numbers <code>1:n</code>), which define the order in
which the coefficients must be monotonically
non-decreasing.
</p>
</td></tr>
<tr><td><code id="contr.isotonic_+3A_contrasts">contrasts</code></td>
<td>

<p>a logical indicating whether constrasts
should be computed.
</p>
</td></tr>
<tr><td><code id="contr.isotonic_+3A_sparse">sparse</code></td>
<td>

<p>included for compatibility reasons. Has no
effect.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>contr.isotonic</code> is used in creating the design matrix
for categorical covariates with a specified order under a
particular parameterisation. For Poisson and negative binomial models, this
occurs if a categorical covariate is defined as monotonic;
for binomial models, each parameterisation defines a
permutation of the levels that must be monotonically
increasing.
</p>
<p>For overparameterised binomial models, the design matrix for
categorical covariates must include isotonic-style dummy 
covariates for every possible permutation of the levels. This
is the function of <code>contr.opisotonic</code>.
</p>
<p>In the order specified by <code>perm</code>, the coefficient
associated with each level is the sum of increments between
the preceding levels. That is, the first level is defined
as <code class="reqn">0</code>, the second as <code class="reqn">0 + d_2</code>, the third as <code class="reqn">0 + d_2 + d_3</code>, and
so on.  In fitting the model, these increments are
constrained to be non-negative.
</p>
<p>Note that these are not &lsquo;contrasts&rsquo; as defined in the
theory for linear models; rather this is used to define the
<code>contrasts</code> attribute of each variable so that
<code><a href="stats.html#topic+model.matrix">model.matrix</a></code> produces the desired design
matrix.
</p>


<h3>Value</h3>

<p>A matrix with <code>n</code> rows and <code>k</code> columns, with
<code>k=n-1</code> if <code>contrasts</code> is <code>TRUE</code> and
<code>k=n</code> if <code>contrasts</code> is <code>FALSE</code>.
</p>


<h3>Author(s)</h3>

<p>Mark W. Donoghoe <a href="mailto:markdonoghoe@gmail.com">markdonoghoe@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+model.matrix">model.matrix</a></code>, which uses
<code>contr.isotonic</code> to create the design matrix.
</p>
<p><code><a href="stats.html#topic+contr.treatment">contr.treatment</a></code>, <code><a href="stats.html#topic+contrasts">contrasts</a></code> for
their usual use in regression models.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>contr.isotonic(4,1:4)
contr.isotonic(4,c(1,3,2,4))

# Show how contr.isotonic applies within model.matrix
x &lt;- factor(round(runif(20,0,2)))
mf &lt;- model.frame(~x)
contrasts(x) &lt;- contr.isotonic(levels(x), levels(x))
model.matrix(mf)
</code></pre>

<hr>
<h2 id='conv.test'>
Convergence Test Based on L2 Norm
</h2><span id='topic+conv.test'></span>

<h3>Description</h3>

<p>Performs a test of convergence based on the L2 norm of
the change in the parameter estimates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>conv.test(theta1, theta2, epsilon)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="conv.test_+3A_theta1">theta1</code></td>
<td>

<p>vector of parameter estimates at previous
step.
</p>
</td></tr>
<tr><td><code id="conv.test_+3A_theta2">theta2</code></td>
<td>

<p>vector of parameter estimates at current
step.
</p>
</td></tr>
<tr><td><code id="conv.test_+3A_epsilon">epsilon</code></td>
<td>

<p>positive convergence tolerance.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is used as the convergence test in the
<code><a href="#topic+addreg">addreg</a></code> fitting functions, because the EM
algorithm may converge slowly such that the test based on
the deviance used in <code><a href="stats.html#topic+glm.fit">glm.fit</a></code> (see
<code><a href="stats.html#topic+glm.control">glm.control</a></code>) may report convergence at a
point away from the actual optimum.
</p>


<h3>Value</h3>

<p>A logical; <code>TRUE</code> if
<code>sqrt(sum((theta1-theta2)**2))/sqrt(sum(theta1**2)) &lt;
epsilon</code>, <code>FALSE</code> otherwise.
</p>


<h3>Author(s)</h3>

<p>Mark W. Donoghoe <a href="mailto:markdonoghoe@gmail.com">markdonoghoe@gmail.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>theta.old &lt;- c(4,5,6)
theta.new &lt;- c(4.05,5,6)

conv.test(theta.old, theta.new, 0.01)
conv.test(theta.old, theta.new, 0.005)
</code></pre>

<hr>
<h2 id='interpret.addreg.smooth'>
Interpret an addreg.smooth Formula
</h2><span id='topic+interpret.addreg.smooth'></span>

<h3>Description</h3>

<p>This is an internal function of package <code><a href="#topic+addreg-package">addreg</a></code>.
It is a service routine for <code><a href="#topic+addreg.smooth">addreg.smooth</a></code> which interprets the
smooth parts of the model formula and returns modified formulas to be used
in the fitting functions.
</p>
<p>Not normally called directly.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>interpret.addreg.smooth(formula)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="interpret.addreg.smooth_+3A_formula">formula</code></td>
<td>

<p>A formula as supplied to <code><a href="#topic+addreg.smooth">addreg.smooth</a></code>, which includes
at least one <code><a href="#topic+B">B</a></code> or <code><a href="#topic+Iso">Iso</a></code> term.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with components:
</p>
<table role = "presentation">
<tr><td><code>full.formula</code></td>
<td>
<p>a <code><a href="stats.html#topic+formula">formula</a></code> object which is the same as
the <code>formula</code> supplied, but with additional arguments removed from
the smooth terms. E.g. <code>B(x, knot.range = 0:2)</code> would appear as
<code>B(x)</code> in this formula.</p>
</td></tr>
<tr><td><code>fake.formula</code></td>
<td>
<p>a <code><a href="stats.html#topic+formula">formula</a></code> object which is the same as
the <code>formula</code> supplied, but with smooth terms replaced by their
covariates alone. E.g. <code>B(x, knot.range = 0:2)</code> would appear as 
<code>x</code> in this formula. Used to construct the model matrix.</p>
</td></tr>
<tr><td><code>smooth.spec</code></td>
<td>
<p>a named list containing the results of <code><a href="base.html#topic+eval">eval</a></code>uating
the smooth terms. See <code><a href="#topic+B">B</a></code> and <code><a href="#topic+Iso">Iso</a></code> for details.</p>
</td></tr>
<tr><td><code>smooth.ind</code></td>
<td>
<p>a vector containing the indices of the smooth components in
the <code>formula</code>.</p>
</td></tr>
<tr><td><code>terms</code></td>
<td>
<p>the result of running <code><a href="stats.html#topic+terms.formula">terms.formula</a>(formula, specials = c("B", "Iso"))</code>.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Mark W. Donoghoe <a href="mailto:markdonoghoe@gmail.com">markdonoghoe@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+addreg.smooth">addreg.smooth</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Specify a smooth model with knot.range
res &lt;- interpret.addreg.smooth(y ~ B(x, knot.range = 0:2) + x2)
# The knot.range is removed from the full.formula...
print(res$full.formula)
# ...but is stored in the $smooth.spec component of the result:
print(res$smooth.spec$x$knot.range)
</code></pre>

<hr>
<h2 id='negbin1'>
Family Functions for Negative Binomial 1 Models
</h2><span id='topic+negbin1'></span>

<h3>Description</h3>

<p>Specifies the information required to fit a negative binomial 1 (NB1) model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>negbin1(link, phi = stop("'phi' must be given"))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="negbin1_+3A_link">link</code></td>
<td>

<p>included for compatibility with <code><a href="stats.html#topic+family">family</a></code>.
For <code><a href="#topic+addreg">addreg</a></code> models, this will always be
<code>"identity"</code>.
</p>
</td></tr>
<tr><td><code id="negbin1_+3A_phi">phi</code></td>
<td>

<p>the value of the scale parameter of the NB1 distribution (see
&quot;Details&quot;). This can be set to <code>NA</code> for initialisation,
but during estimation the family should be updated with the
current estimate, and must be strictly positive.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The NB1 distribution can be parameterised in
terms of a mean <code class="reqn">\mu</code> and scale parameter <code class="reqn">\phi</code> (the 
<code>phi</code> argument of this function), such that if
<code class="reqn">Y \sim NB1(\mu, \phi)</code>, then <code class="reqn">E(Y) = \mu</code> and
<code class="reqn">Var(Y) = (1+\phi)\mu</code>.
</p>
<p>These can be related to the <code>size</code> and <code>prob</code> arguments
of the <code><a href="stats.html#topic+NegBinomial">NegBinomial</a></code> functions by <code>size</code> = <code class="reqn">\mu / \phi</code>
and <code>prob</code> = <code class="reqn">1 / (1 + \phi)</code>.
</p>


<h3>Value</h3>

<p>An object of class <code>"family"</code>: see <code><a href="stats.html#topic+family">family</a></code> for
full details. Note that when the estimate of <code>phi</code> is updated in
a model, this <code>family</code> object must be reloaded using the new
estimate.
</p>


<h3>Author(s)</h3>

<p>Mark W. Donoghoe <a href="mailto:markdonoghoe@gmail.com">markdonoghoe@gmail.com</a>
</p>

<hr>
<h2 id='nnnegbin'>
ECME Algorithm for Additive Negative Binomial 1 Model
</h2><span id='topic+nnnegbin'></span>

<h3>Description</h3>

<p>Finds the maximum likelihood estimate of an additive negative binomial (NB1) model
using an ECME algorithm,
where each of the mean coefficients is restricted to be non-negative.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nnnegbin(y, x, standard, offset, start, control = addreg.control(),
         accelerate = c("em", "squarem", "pem", "qn"),
         control.method = list())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="nnnegbin_+3A_y">y</code></td>
<td>

<p>non-negative integer response vector.
</p>
</td></tr>
<tr><td><code id="nnnegbin_+3A_x">x</code></td>
<td>

<p>non-negative covariate matrix.
</p>
</td></tr>
<tr><td><code id="nnnegbin_+3A_standard">standard</code></td>
<td>

<p>standardising vector, where each element is a positive constant that
(multiplicatively) standardises the fitted value of the corresponding
element of the response vector. The default is a vector of ones.
</p>
</td></tr>
<tr><td><code id="nnnegbin_+3A_offset">offset</code></td>
<td>

<p>non-negative additive offset vector. The default is a vector of zeros.
</p>
</td></tr>
<tr><td><code id="nnnegbin_+3A_start">start</code></td>
<td>

<p>vector of starting values for the parameter estimates. The last element is
the starting value of the <code>scale</code>, and must be <code>&gt; 1</code>. The remaining
elements are for the additive mean parameters, and must be
greater than <code>control$bound.tol</code>.
</p>
</td></tr>
<tr><td><code id="nnnegbin_+3A_control">control</code></td>
<td>

<p>an <code><a href="#topic+addreg.control">addreg.control</a></code> object, which controls the fitting process.
</p>
</td></tr>
<tr><td><code id="nnnegbin_+3A_accelerate">accelerate</code></td>
<td>

<p>a character string that determines the acceleration
algorithm to be used, (partially) matching one of <code>"em"</code> (no acceleration &ndash; the default), 
<code>"squarem"</code>, <code>"pem"</code> or <code>"qn"</code>. See <code><a href="turboEM.html#topic+turboem">turboem</a></code>
for further details. Note that <code>"decme"</code> is not permitted.
</p>
</td></tr>
<tr><td><code id="nnnegbin_+3A_control.method">control.method</code></td>
<td>

<p>a list of control parameters for the acceleration algorithm. See <code><a href="turboEM.html#topic+turboem">turboem</a></code>
for details of the parameters that apply to each algorithm. If not specified, the defaults are used.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is a workhorse function for <code><a href="#topic+addreg">addreg</a></code>, and runs the ECME algorithm to find the 
constrained non-negative MLE associated with an additive NB1 model.
</p>


<h3>Value</h3>

<p>A list containing the following components
</p>
<table role = "presentation">
<tr><td><code>coefficients</code></td>
<td>
<p>the constrained non-negative maximum likelihood estimate of the mean parameters.</p>
</td></tr>
<tr><td><code>scale</code></td>
<td>
<p>the maximum likelihood estimate of the scale parameter.</p>
</td></tr>
<tr><td><code>residuals</code></td>
<td>
<p>the residuals at the MLE, that is <code>y - fitted.values</code></p>
</td></tr>
<tr><td><code>fitted.values</code></td>
<td>
<p>the fitted mean values.</p>
</td></tr>
<tr><td><code>rank</code></td>
<td>
<p>the number of parameters in the model (named &ldquo;<code>rank</code>&quot; for compatibility &mdash;
we assume that models have full rank)</p>
</td></tr>
<tr><td><code>family</code></td>
<td>
<p>included for compatibility &mdash; will always be <code><a href="#topic+negbin1">negbin1</a>(identity)</code>.</p>
</td></tr>
<tr><td><code>linear.predictors</code></td>
<td>
<p>included for compatibility &mdash; same as <code>fitted.values</code> (as this is
an identity-link model).</p>
</td></tr>
<tr><td><code>deviance</code></td>
<td>
<p>up to a constant, minus twice the maximised log-likelihood (with respect to
a saturated NB1 model with the same <code>scale</code>).</p>
</td></tr>
<tr><td><code>aic</code></td>
<td>
<p>a version of Akaike's <em>An Information Criterion</em>,
minus twice the maximised log-likelihood plus twice the 
number of parameters.</p>
</td></tr>
<tr><td><code>aic.c</code></td>
<td>
<p>a small-sample corrected
version of Akaike's <em>An Information Criterion</em>
(Hurvich, Simonoff and Tsai, 1998).</p>
</td></tr>
<tr><td><code>null.deviance</code></td>
<td>
<p>the deviance for the null model, comparable with <code>deviance</code>.
The null model will include the offset and an intercept.</p>
</td></tr>
<tr><td><code>iter</code></td>
<td>
<p>the number of iterations of the EM algorithm used.</p>
</td></tr>
<tr><td><code>weights</code></td>
<td>
<p>included for compatibility &mdash; a vector of ones.</p>
</td></tr>
<tr><td><code>prior.weights</code></td>
<td>
<p>included for compatibility &mdash; a vector of ones.</p>
</td></tr>
<tr><td><code>standard</code></td>
<td>
<p>the <code>standard</code> vector passed to this function.</p>
</td></tr>
<tr><td><code>df.residual</code></td>
<td>
<p>the residual degrees of freedom.</p>
</td></tr>
<tr><td><code>df.null</code></td>
<td>
<p>the residual degrees of freedom for the null model.</p>
</td></tr>
<tr><td><code>y</code></td>
<td>
<p>the <code>y</code> vector used.</p>
</td></tr>
<tr><td><code>converged</code></td>
<td>
<p>logical. Did the ECME algorithm converge 
(according to <code><a href="#topic+conv.test">conv.test</a></code>)?</p>
</td></tr>
<tr><td><code>boundary</code></td>
<td>
<p>logical. Is the MLE on the boundary of the parameter
space &mdash; i.e. are any of the <code>coefficients &lt; control$bound.tol</code>?</p>
</td></tr>
<tr><td><code>loglik</code></td>
<td>
<p>the maximised log-likelihood.</p>
</td></tr>
<tr><td><code>nn.design</code></td>
<td>
<p>the non-negative <code>x</code> matrix used.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Mark W. Donoghoe <a href="mailto:markdonoghoe@gmail.com">markdonoghoe@gmail.com</a>.
</p>


<h3>References</h3>

<p>Donoghoe, M. W. and I. C. Marschner (2016). Estimation of adjusted rate
differences using additive negative binomial regression. <em>Statistics
in Medicine</em> 35(18): 3166&ndash;3178.
</p>
<p>Hurvich, C. M., J. S. Simonoff and C.-L. Tsai (1998). Smoothing parameter 
selection in non-parametric regression using an improved Akaike 
information criterion.
<em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em> 60(2): 271&ndash;293.
</p>

<hr>
<h2 id='nnpois'>
EM Algorithm for Identity-link Poisson GLM
</h2><span id='topic+nnpois'></span>

<h3>Description</h3>

<p>Finds the maximum likelihood estimate of an identity-link Poisson GLM
using an EM algorithm,
where each of the coefficients is restricted to be non-negative.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nnpois(y, x, standard, offset, start, control = addreg.control(),
       accelerate = c("em", "squarem", "pem", "qn"),
       control.method = list())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="nnpois_+3A_y">y</code></td>
<td>

<p>non-negative integer response vector.
</p>
</td></tr>
<tr><td><code id="nnpois_+3A_x">x</code></td>
<td>

<p>non-negative covariate matrix.
</p>
</td></tr>
<tr><td><code id="nnpois_+3A_standard">standard</code></td>
<td>

<p>standardising vector, where each element is a positive constant that
(multiplicatively) standardises the fitted value of the corresponding
element of the response vector. The default is a vector of ones.
</p>
</td></tr>
<tr><td><code id="nnpois_+3A_offset">offset</code></td>
<td>

<p>non-negative additive offset vector. The default is a vector of zeros.
</p>
</td></tr>
<tr><td><code id="nnpois_+3A_start">start</code></td>
<td>

<p>starting values for the parameter estimates. Each element must be
greater than <code>control$bound.tol</code>.
</p>
</td></tr>
<tr><td><code id="nnpois_+3A_control">control</code></td>
<td>

<p>an <code><a href="#topic+addreg.control">addreg.control</a></code> object, which controls the fitting process.
</p>
</td></tr>
<tr><td><code id="nnpois_+3A_accelerate">accelerate</code></td>
<td>

<p>a character string that determines the acceleration
algorithm to be used, (partially) matching one of <code>"em"</code> (no acceleration &ndash; the default), 
<code>"squarem"</code>, <code>"pem"</code> or <code>"qn"</code>. See <code><a href="turboEM.html#topic+turboem">turboem</a></code>
for further details. Note that <code>"decme"</code> is not permitted.
</p>
</td></tr>
<tr><td><code id="nnpois_+3A_control.method">control.method</code></td>
<td>

<p>a list of control parameters for the acceleration algorithm. See <code><a href="turboEM.html#topic+turboem">turboem</a></code>
for details of the parameters that apply to each algorithm. If not specified, the defaults are used.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is a workhorse function for <code><a href="#topic+addreg">addreg</a></code>, and runs the EM algorithm to find the 
constrained non-negative MLE associated with an identity-link Poisson GLM. See Marschner (2010)
for full details.
</p>


<h3>Value</h3>

<p>A list containing the following components
</p>
<table role = "presentation">
<tr><td><code>coefficients</code></td>
<td>
<p>the constrained non-negative maximum likelihood estimate of the parameters.</p>
</td></tr>
<tr><td><code>residuals</code></td>
<td>
<p>the residuals at the MLE, that is <code>y - fitted.values</code></p>
</td></tr>
<tr><td><code>fitted.values</code></td>
<td>
<p>the fitted mean values.</p>
</td></tr>
<tr><td><code>rank</code></td>
<td>
<p>the number of parameters in the model (named &ldquo;<code>rank</code>&quot; for compatibility &mdash;
we assume that models have full rank)</p>
</td></tr>
<tr><td><code>family</code></td>
<td>
<p>included for compatibility &mdash; will always be <code><a href="stats.html#topic+poisson">poisson</a>(identity)</code>.</p>
</td></tr>
<tr><td><code>linear.predictors</code></td>
<td>
<p>included for compatibility &mdash; same as <code>fitted.values</code> (as this is
an identity-link model).</p>
</td></tr>
<tr><td><code>deviance</code></td>
<td>
<p>up to a constant, minus twice the maximised log-likelihood.</p>
</td></tr>
<tr><td><code>aic</code></td>
<td>
<p>a version of Akaike's <em>An Information Criterion</em>,
minus twice the maximised log-likelihood plus twice the 
number of parameters.</p>
</td></tr>
<tr><td><code>aic.c</code></td>
<td>
<p>a small-sample corrected
version of Akaike's <em>An Information Criterion</em>
(Hurvich, Simonoff and Tsai, 1998).</p>
</td></tr>
<tr><td><code>null.deviance</code></td>
<td>
<p>the deviance for the null model, comparable with <code>deviance</code>.
The null model will include the offset and an intercept.</p>
</td></tr>
<tr><td><code>iter</code></td>
<td>
<p>the number of iterations of the EM algorithm used.</p>
</td></tr>
<tr><td><code>weights</code></td>
<td>
<p>included for compatibility &mdash; a vector of ones.</p>
</td></tr>
<tr><td><code>prior.weights</code></td>
<td>
<p>included for compatibility &mdash; a vector of ones.</p>
</td></tr>
<tr><td><code>standard</code></td>
<td>
<p>the <code>standard</code> vector passed to this function.</p>
</td></tr>
<tr><td><code>df.residual</code></td>
<td>
<p>the residual degrees of freedom.</p>
</td></tr>
<tr><td><code>df.null</code></td>
<td>
<p>the residual degrees of freedom for the null model.</p>
</td></tr>
<tr><td><code>y</code></td>
<td>
<p>the <code>y</code> vector used.</p>
</td></tr>
<tr><td><code>converged</code></td>
<td>
<p>logical. Did the EM algorithm converge 
(according to <code><a href="#topic+conv.test">conv.test</a></code>)?</p>
</td></tr>
<tr><td><code>boundary</code></td>
<td>
<p>logical. Is the MLE on the boundary of the parameter
space &mdash; i.e. are any of the <code>coefficients &lt; control$bound.tol</code>?</p>
</td></tr>
<tr><td><code>loglik</code></td>
<td>
<p>the maximised log-likelihood.</p>
</td></tr>
<tr><td><code>nn.design</code></td>
<td>
<p>the non-negative <code>x</code> matrix used.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Mark W. Donoghoe <a href="mailto:markdonoghoe@gmail.com">markdonoghoe@gmail.com</a>.
</p>
<p>This function is based on code from Marschner, Gillett and O'Connell (2012) written by Alexandra Gillett.
</p>


<h3>References</h3>

<p>Hurvich, C. M., J. S. Simonoff and C.-L. Tsai (1998). Smoothing parameter 
selection in nonparametric regression using an improved Akaike 
information criterion.
<em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em> 60(2): 271&ndash;293.
</p>
<p>Marschner, I. C. (2010). Stable computation of maximum likelihood estimates
in identity link Poisson regression. <em>Journal of Computational and 
Graphical Statistics</em> 19(3): 666&ndash;683.
</p>
<p>Marschner, I. C., A. C. Gillett and R. L. O'Connell (2012).
Stratified additive Poisson models: Computational methods
and applications in clinical epidemiology. <em>Computational
Statistics and Data Analysis</em> 56(5): 1115&ndash;1130.
</p>

<hr>
<h2 id='plot.addreg.smooth'>
Default addreg.smooth Plotting
</h2><span id='topic+plot.addreg.smooth'></span>

<h3>Description</h3>

<p>Takes a fitted <code>addreg.smooth</code> object produced by <code><a href="#topic+addreg.smooth">addreg.smooth</a></code> and plots
the component smooth functions that make it up, on the scale of the linear predictor,
for specified values of the other covariates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'addreg.smooth'
plot(x, type = c("response", "link"), at = data.frame(), 
     knotlines = TRUE, nobs = 1000, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.addreg.smooth_+3A_x">x</code></td>
<td>

<p>a fitted <code>addreg.smooth</code> object as produced by <code><a href="#topic+addreg.smooth">addreg.smooth</a></code>.
</p>
</td></tr>
<tr><td><code id="plot.addreg.smooth_+3A_type">type</code></td>
<td>

<p>the type of prediction required. Note that, unlike <code><a href="#topic+predict.addreg.smooth">predict.addreg.smooth</a></code>,
<code>"terms"</code> is not a valid option. Also, because <code>addreg.smooth</code> only applies
identity-link models, <code>"response"</code> and <code>"link"</code> will have the same results &mdash;
they are included for consistency.
</p>
</td></tr>
<tr><td><code id="plot.addreg.smooth_+3A_at">at</code></td>
<td>

<p>a data frame containing the values at which the prediction should be evaluated. The columns
must contain the covariates in the model, and several rows may be provided (in which case, multiple
lines are drawn on the same plot). Cannot be missing or <code>NULL</code>.
</p>
</td></tr>
<tr><td><code id="plot.addreg.smooth_+3A_knotlines">knotlines</code></td>
<td>

<p>logical; if vertical lines should be drawn on the plot to indicate the locations
of the knots for B-spline terms.
</p>
</td></tr>
<tr><td><code id="plot.addreg.smooth_+3A_nobs">nobs</code></td>
<td>

<p>the number of points which should be used to create the curve. These are placed evenly along
the range of the observed covariate values from the original model.
</p>
</td></tr>
<tr><td><code id="plot.addreg.smooth_+3A_...">...</code></td>
<td>

<p>other graphics parameters to pass on to plotting commands (note: some will not work).
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For each smooth covariate in the model of <code>x</code>, <code><a href="#topic+predict.addreg.smooth">predict.addreg.smooth</a></code>
is used to obtain predicted values for the range of that covariate, with the other
covariates remaining fixed at their values given in <code>at</code>. Several rows may be provided
in <code>at</code>, in which case, one curve is drawn for each, and they are coloured using
<code><a href="grDevices.html#topic+rainbow">rainbow</a>(nrow(at))</code>. If the model contains a single smooth covariate and no other
covariates, <code>at</code> may be provided as an empty data frame, <code>data.frame()</code>.
</p>


<h3>Value</h3>

<p>The function simply generates plots.
</p>


<h3>Note</h3>

<p>If this function is too restrictive, it may be easier to use <code><a href="#topic+predict.addreg.smooth">predict.addreg.smooth</a></code>
to get predictions for the dataset of your choice, and do the plotting manually.
</p>


<h3>Author(s)</h3>

<p>Mark W. Donoghoe <a href="mailto:markdonoghoe@gmail.com">markdonoghoe@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+addreg.smooth">addreg.smooth</a></code>, <code><a href="#topic+predict.addreg.smooth">predict.addreg.smooth</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## For an example, see example(addreg.smooth)
</code></pre>

<hr>
<h2 id='predict.addreg'>
Predict Method for addreg Fits
</h2><span id='topic+predict.addreg'></span>

<h3>Description</h3>

<p>Obtains predictions from a fitted <code><a href="#topic+addreg">addreg</a></code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'addreg'
predict(object, newdata = NULL, type = c("link", "response", "terms"), terms = NULL, 
        na.action = na.pass, checkminmax = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict.addreg_+3A_object">object</code></td>
<td>

<p>a fitted object of class inheriting from <code>"addreg"</code>.
</p>
</td></tr>
<tr><td><code id="predict.addreg_+3A_newdata">newdata</code></td>
<td>

<p>optionally, a data frame in which to look for variables with which to predict.
If omitted, the fitted linear predictors are used.
</p>
</td></tr>
<tr><td><code id="predict.addreg_+3A_type">type</code></td>
<td>

<p>the type of prediction required. The default is on the scale of the linear predictors; 
the alternative <code>"response"</code> is on the scale of the response variable. 
The <code>"terms"</code> option returns a matrix giving the fitted values of each term in the 
model formula on the linear predictor scale.
</p>
<p>The value of this argument can be abbreviated.
</p>
</td></tr>
<tr><td><code id="predict.addreg_+3A_terms">terms</code></td>
<td>

<p>with <code>type = "terms"</code> by default all terms are returned. 
A character vector specifies which terms are to be returned.
</p>
</td></tr>
<tr><td><code id="predict.addreg_+3A_na.action">na.action</code></td>
<td>

<p>function determining what should be done with missing values in <code>newdata</code>. 
The default is to predict <code>NA</code>.
</p>
</td></tr>
<tr><td><code id="predict.addreg_+3A_checkminmax">checkminmax</code></td>
<td>

<p>logical indicating whether or not values of continuous covariates in <code>newdata</code> 
should be checked to ensure they lie within the covariate space associated with the 
fitted model. Otherwise predicted values could lie outside the 
parameter space.
</p>
</td></tr>
<tr><td><code id="predict.addreg_+3A_...">...</code></td>
<td>

<p>further arguments passed to or from other methods.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>newdata</code> is omitted the predictions are based on the data used for the fit. 
In that case how cases with missing values in the original fit are treated is determined by the 
<code>na.action</code> argument of that fit. If <code>na.action = na.omit</code>, omitted cases 
will not appear in the residuals; if <code>na.action = na.exclude</code> they will 
appear, with residual value <code>NA</code>. See also <code><a href="stats.html#topic+napredict">napredict</a></code>.
</p>


<h3>Value</h3>

<p>A vector or matrix of predictions. For <code>type = "terms"</code>, this is a matrix with
a column per term, and may have an attribute <code>"constant"</code>.
</p>


<h3>Note</h3>

<p>Variables are first looked for in <code>newdata</code> and then searched for in the usual 
way (which will include the environment of the formula used in the fit). A warning 
will be given if the variables found are not of the same length as those in 
<code>newdata</code> if it was supplied.
</p>


<h3>Author(s)</h3>

<p>Mark W. Donoghoe <a href="mailto:markdonoghoe@gmail.com">markdonoghoe@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+addreg">addreg</a></code>
</p>
<p><code><a href="stats.html#topic+predict.glm">predict.glm</a></code> for the equivalent method for models fit using <code><a href="stats.html#topic+glm">glm</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## For an example, see example(addreg)
</code></pre>

<hr>
<h2 id='predict.addreg.smooth'>
Predict Method for addreg.smooth Fits
</h2><span id='topic+predict.addreg.smooth'></span>

<h3>Description</h3>

<p>Obtains predictions from a fitted <code><a href="#topic+addreg.smooth">addreg.smooth</a></code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'addreg.smooth'
predict(object, newdata = NULL, type = c("link", "response", "terms"), 
        terms = NULL, na.action = na.pass, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict.addreg.smooth_+3A_object">object</code></td>
<td>

<p>a fitted object of class inheriting from <code>"addreg.smooth"</code>.
</p>
</td></tr>
<tr><td><code id="predict.addreg.smooth_+3A_newdata">newdata</code></td>
<td>

<p>optionally, a data frame in which to look for variables with which to
predict. If omitted, the fitted linear predictors are used.
</p>
</td></tr>
<tr><td><code id="predict.addreg.smooth_+3A_type">type</code></td>
<td>

<p>the type of prediction required. The default is on the scale of the linear predictors; 
the alternative <code>"response"</code> is on the scale of the response variable. 
The <code>"terms"</code> option returns a matrix giving the fitted values of each term in the 
model formula on the linear predictor scale.
</p>
<p>The value of this argument can be abbreviated.
</p>
</td></tr>
<tr><td><code id="predict.addreg.smooth_+3A_terms">terms</code></td>
<td>

<p>with <code>type = "terms"</code> by default all terms are returned. 
A character vector specifies which terms are to be returned.
</p>
</td></tr>
<tr><td><code id="predict.addreg.smooth_+3A_na.action">na.action</code></td>
<td>

<p>function determining what should be done with missing values in <code>newdata</code>. 
The default is to predict <code>NA</code>.
</p>
</td></tr>
<tr><td><code id="predict.addreg.smooth_+3A_...">...</code></td>
<td>

<p>further arguments passed to or from other methods.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>predict.addreg.smooth</code> constructs the underlying basis functions for smooth variables
in <code>newdata</code> and runs <code><a href="#topic+predict.addreg">predict.addreg</a></code> to obtain predictions. Note that
if values of smooth covariates in <code>newdata</code> are outside the covariate space of 
<code>object</code>, an error will be returned.
</p>
<p>If <code>newdata</code> is omitted, the predictions are based on the data used for the fit. 
In that case how cases with missing values in the original fit are treated is determined by the 
<code>na.action</code> argument of that fit. If <code>na.action = na.omit</code>, omitted cases 
will not appear in the residuals; if <code>na.action = na.exclude</code> they will 
appear, with residual value <code>NA</code>. See also <code><a href="stats.html#topic+napredict">napredict</a></code>.
</p>


<h3>Value</h3>

<p>A vector or matrix of predictions. For <code>type = "terms"</code>, this is a matrix with
a column per term, and may have an attribute <code>"constant"</code>.
</p>


<h3>Note</h3>

<p>Variables are first looked for in <code>newdata</code> and then searched for in the usual 
way (which will include the environment of the formula used in the fit). A warning 
will be given if the variables found are not of the same length as those in 
<code>newdata</code> if it was supplied.
</p>


<h3>Author(s)</h3>

<p>Mark W. Donoghoe <a href="mailto:markdonoghoe@gmail.com">markdonoghoe@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+addreg.smooth">addreg.smooth</a></code>, <code><a href="#topic+predict.addreg">predict.addreg</a></code>
</p>
<p><code><a href="stats.html#topic+predict.glm">predict.glm</a></code> for the equivalent method for models fit using <code><a href="stats.html#topic+glm">glm</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## For an example, see example(addreg.smooth)
</code></pre>

<hr>
<h2 id='summary.addreg'>
Summarizing addreg Model Fits
</h2><span id='topic+summary.addreg'></span><span id='topic+print.summary.addreg'></span>

<h3>Description</h3>

<p>These functions are all <code><a href="utils.html#topic+methods">methods</a></code> for class <code>addreg</code>
or <code>summary.addreg</code> objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'addreg'
summary(object, correlation = FALSE, ...)

## S3 method for class 'summary.addreg'
print(x, digits = max(3L, getOption("digits") - 3L), 
      signif.stars = getOption("show.signif.stars"), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.addreg_+3A_object">object</code></td>
<td>

<p>an object of class <code>"addreg"</code>, usually from a call to <code><a href="#topic+addreg">addreg</a></code>
or <code><a href="#topic+addreg.smooth">addreg.smooth</a></code>.
</p>
</td></tr>
<tr><td><code id="summary.addreg_+3A_x">x</code></td>
<td>

<p>an object of class <code>"summary.addreg"</code>, usually from a call to
<code>summary.addreg</code>.
</p>
</td></tr>
<tr><td><code id="summary.addreg_+3A_correlation">correlation</code></td>
<td>

<p>logical; if <code>TRUE</code>, the correlation matrix of the estimated parameters is
returned and printed.
</p>
</td></tr>
<tr><td><code id="summary.addreg_+3A_digits">digits</code></td>
<td>

<p>the number of significant digits to use when printing.
</p>
</td></tr>
<tr><td><code id="summary.addreg_+3A_signif.stars">signif.stars</code></td>
<td>

<p>logical; if <code>TRUE</code>, &lsquo;significance stars&rsquo; are printed for each coefficient.
</p>
</td></tr>
<tr><td><code id="summary.addreg_+3A_...">...</code></td>
<td>

<p>further arguments passed to or from other methods.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>These perform the same function as <code><a href="stats.html#topic+summary.glm">summary.glm</a></code> and <code><a href="stats.html#topic+print.summary.glm">print.summary.glm</a></code>,
producing similar results for <code>addreg</code> models. <code>print.summary.addreg</code> additionally prints 
the small-sample corrected AIC (<code>aic.c</code>), the number of EM iterations for the parameterisation 
corresponding to the MLE, and for negative binomial models, the estimate of <code class="reqn">\phi</code> (<code>scale</code>-1)
and its standard error.
</p>
<p>The dispersion used in calculating standard errors is fixed as <code class="reqn">1</code> for binomial and Poisson
models, and is estimated via maximum likelihood for negative binomial models.
</p>


<h3>Value</h3>

<p><code>summary.addreg</code> returns an object of class <code>"summary.addreg"</code>, a list with components
</p>
<table role = "presentation">
<tr><td><code>call</code></td>
<td>
<p>the component from <code>object</code>.</p>
</td></tr>
<tr><td><code>family</code></td>
<td>
<p>the component from <code>object</code>.</p>
</td></tr>
<tr><td><code>deviance</code></td>
<td>
<p>the component from <code>object</code>.</p>
</td></tr>
<tr><td><code>aic</code></td>
<td>
<p>the component from <code>object</code>.</p>
</td></tr>
<tr><td><code>aic.c</code></td>
<td>
<p>the component from <code>object</code>.</p>
</td></tr>
<tr><td><code>df.residual</code></td>
<td>
<p>the component from <code>object</code>.</p>
</td></tr>
<tr><td><code>null.deviance</code></td>
<td>
<p>the component from <code>object</code>.</p>
</td></tr>
<tr><td><code>df.null</code></td>
<td>
<p>the component from <code>object</code>.</p>
</td></tr>
<tr><td><code>iter</code></td>
<td>
<p>the component from <code>object</code>.</p>
</td></tr>
<tr><td><code>deviance.resid</code></td>
<td>
<p>the deviance residuals: see <code><a href="stats.html#topic+residuals.glm">residuals.glm</a></code>.</p>
</td></tr>
<tr><td><code>coefficients</code></td>
<td>
<p>the matrix of coefficients, standard errors, z-values and p-values.</p>
</td></tr>
<tr><td><code>aliased</code></td>
<td>
<p>included for compatibility &mdash; always <code>FALSE</code>.</p>
</td></tr>
<tr><td><code>dispersion</code></td>
<td>
<p>the inferred/estimated dispersion.</p>
</td></tr>
<tr><td><code>df</code></td>
<td>
<p>included for compatibility &mdash; a 3-vector of the number of coefficients,
the number of residual degrees of freedom, and the number of coefficients (again).</p>
</td></tr>
<tr><td><code>cov.unscaled</code></td>
<td>
<p>the unscaled (<code>dispersion = 1</code>) estimated covariance
matrix of the estimated coefficients. <code>NaN</code> if <code>object$boundary == TRUE</code>.</p>
</td></tr>
<tr><td><code>cov.scaled</code></td>
<td>
<p>ditto, scaled by <code>dispersion</code>.</p>
</td></tr>
<tr><td><code>correlation</code></td>
<td>
<p>if <code>correlation</code> is <code>TRUE</code>, the estimated correlations
of the estimated coefficients. <code>NaN</code> if <code>object$boundary == TRUE</code>.</p>
</td></tr>
</table>
<p>For negative binomial models, the object also contains
</p>
<table role = "presentation">
<tr><td><code>phi</code></td>
<td>
<p>the estimate of <code class="reqn">\phi</code> (<code>scale</code>-1).</p>
</td></tr>
<tr><td><code>var.phi</code></td>
<td>
<p>the estimated variance of <code>phi</code>.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>If <code>object$boundary == TRUE</code>, the standard errors of the coefficients
are not valid, and a matrix of <code>NaN</code>s is returned by <code><a href="#topic+vcov.addreg">vcov.addreg</a></code>.
</p>


<h3>Author(s)</h3>

<p>Mark W. Donoghoe <a href="mailto:markdonoghoe@gmail.com">markdonoghoe@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+addreg">addreg</a></code>, <code><a href="stats.html#topic+summary.glm">summary.glm</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## For an example, see example(addreg)
</code></pre>

<hr>
<h2 id='vcov.addreg'>
Calculate Variance-Covariance Matrix for a Fitted addreg Model Object
</h2><span id='topic+vcov.addreg'></span>

<h3>Description</h3>

<p>Returns the variance-covariance matrix of the main parameters of a fitted <code>addreg</code> model object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'addreg'
vcov(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vcov.addreg_+3A_object">object</code></td>
<td>

<p>an object of class <code>"addreg"</code>, usually from a call to <code><a href="#topic+addreg">addreg</a></code>
or <code><a href="#topic+addreg.smooth">addreg.smooth</a></code>.
</p>
</td></tr>
<tr><td><code id="vcov.addreg_+3A_...">...</code></td>
<td>

<p>additional arguments for method functions.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>An equivalent method to <code><a href="stats.html#topic+vcov">vcov</a></code>, to use with <code><a href="#topic+addreg">addreg</a></code> models.
</p>


<h3>Value</h3>

<p>A matrix of the estimated covariances between the parameter estimates in the linear or 
non-linear predictor of the model. This should have row and column names corresponding 
to the parameter names given by the <code><a href="stats.html#topic+coef">coef</a></code> method.
</p>


<h3>Note</h3>

<p>If <code>object$boundary == TRUE</code>, the standard errors of the coefficients
are not valid, and a matrix of <code>NaN</code>s is returned.
</p>


<h3>Author(s)</h3>

<p>Mark W. Donoghoe <a href="mailto:markdonoghoe@gmail.com">markdonoghoe@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+summary.addreg">summary.addreg</a></code>, <code><a href="stats.html#topic+vcov.glm">vcov.glm</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## For an example, see example(addreg)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
