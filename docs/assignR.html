<!DOCTYPE html><html><head><title>Help for package assignR</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {assignR}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#assignR'><p>Tools for inferring geographic origin from isotopic data</p></a></li>
<li><a href='#c.wDist'>
<p>Combine method for wDist objects</p></a></li>
<li><a href='#calRaster'>
<p>Rescale isoscape using linear regression</p></a></li>
<li><a href='#d2h_lrNA'>
<p>data: low resolution North American growing season H isoscape</p></a></li>
<li><a href='#getIsoscapes'>
<p>Download and unpack isoscapes from the web</p></a></li>
<li><a href='#isoStack'>
<p>Stack isoscapes</p></a></li>
<li><a href='#jointP'>
<p>Joint probability of origin</p></a></li>
<li><a href='#knownOrig'>
<p>data: database of H and O isotope data for tissues of known origin</p></a></li>
<li><a href='#naMap'>
<p>data: North America boundary map</p></a></li>
<li><a href='#oddsRatio'>
<p>Odds ratio of points or regions</p></a></li>
<li><a href='#pdRaster'>
<p>Probability of origin surfaces</p></a></li>
<li><a href='#plot.isoStack'>
<p>Plot method for stacked isoscapes</p></a></li>
<li><a href='#plot.QA'>
<p>Plot quality metrics for geographic assignments</p></a></li>
<li><a href='#plot.wDist'>
<p>Plot weighted distance and bearing distributions</p></a></li>
<li><a href='#QA'>
<p>Quality assessment of geographic assignments</p></a></li>
<li><a href='#qtlRaster'>
<p>Sample assignment using thresholds</p></a></li>
<li><a href='#refTrans'>
<p>Transform reference scale of data</p></a></li>
<li><a href='#sr_MI'>
<p>data: low resolution locally weathered Sr isoscape for Michigan</p></a></li>
<li><a href='#states'>
<p>data: outline of US states</p></a></li>
<li><a href='#stds'>
<p>data: documentation of keratin H and O isotope standard calibrations</p></a></li>
<li><a href='#subOrigData'>
<p>Extract known origin sample data</p></a></li>
<li><a href='#unionP'>
<p>Union probability of origin</p></a></li>
<li><a href='#wDist'>
<p>Probability weighted distances and bearings</p></a></li>
<li><a href='#wrld_simpl'>
<p>data: world boundary map</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Infer Geographic Origin from Isotopic Data</td>
</tr>
<tr>
<td>Version:</td>
<td>2.4.0</td>
</tr>
<tr>
<td>Author:</td>
<td>Chao Ma, Gabe Bowen</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Gabe Bowen &lt;gabe.bowen@utah.edu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Routines for re-scaling isotope maps using known-origin tissue isotope data, assigning origin of unknown samples, and summarizing and assessing assignment results. Methods are adapted from Wunder (2010, in ISBN:9789048133536) and Vander Zanden, H. B. et al. (2014) &lt;<a href="https://doi.org/10.1111%2F2041-210X.12229">doi:10.1111/2041-210X.12229</a>&gt; as described in Ma, C. et al. (2020) &lt;<a href="https://doi.org/10.1111%2F2041-210X.13426">doi:10.1111/2041-210X.13426</a>&gt;.</td>
</tr>
<tr>
<td>Imports:</td>
<td>mvnfast, rlang, geosphere, terra (&ge; 1.7-23)</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat, covr</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-09-01 16:10:00 UTC; u0133977</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-09-01 16:30:08 UTC</td>
</tr>
</table>
<hr>
<h2 id='assignR'>Tools for inferring geographic origin from isotopic data
</h2><span id='topic+assignR'></span>

<h3>Description</h3>

<p>Routines for rescaling isoscapes using known-origin tissue isotope data, assigning origin of unknown samples, and summarizing and assessing assignment results.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Gabe Bowen <a href="mailto:gabe.bowen@utah.edu">gabe.bowen@utah.edu</a>  
<strong>Authors</strong>: Chao Ma, Gabe Bowen
</p>


<h3>See Also</h3>

<p><a href="https://spatial-lab.github.io/assignR/">https://spatial-lab.github.io/assignR/</a>
</p>

<hr>
<h2 id='c.wDist'>
Combine method for wDist objects
</h2><span id='topic+c.wDist'></span>

<h3>Description</h3>

<p>Combine statistics from one or more <code><a href="#topic+wDist">wDist</a></code> objects in a single data frame.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'wDist'
c(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="c.wDist_+3A_...">...</code></td>
<td>

<p>One or more wDist objects
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame containing sample IDs, distance, and bearing statistics for each sample in <code>...</code>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+wDist">wDist</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># load hydrogen isotope data for human hair in North America
d = subOrigData(group = "Modern human", mask = naMap, niter = 100)

# rescale from environmental isoscape to tissue isoscape
r = calRaster(known = d, isoscape = d2h_lrNA, mask = naMap)

# four unknown-origin examples
id = c("A", "B", "C", "D")
d2H = c(-110, -90, -105, -102)
un = data.frame(id,d2H)

# posterior probabilities
pp = pdRaster(r, unknown = un, mask = naMap)

# random collection locations
sites = d$data[sample(seq(length(d$data)), 4),]

# generate a wDist object
wd = wDist(pp, sites)

# combine stats and print
c(wd)
</code></pre>

<hr>
<h2 id='calRaster'>
Rescale isoscape using linear regression
</h2><span id='topic+calRaster'></span>

<h3>Description</h3>

<p>This function uses known-origin tissue data to rescale a map of environmental isotope values to a map of tissue value (and associated uncertainty) using a linear regression model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calRaster(known, isoscape, mask = NULL, interpMethod = 2, NA.value = NA, 
  ignore.NA = TRUE, genplot = TRUE, outDir =  NULL, verboseLM = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calRaster_+3A_known">known</code></td>
<td>

<p>subOrigData or SpatVector. Known-origin tissue isotope data from the subOrigData function or provided by user. User-provided data must be formatted as a subOrigData object (see <code><a href="#topic+subOrigData">subOrigData</a></code>) or a SpatVector with point geometry in which the first data field contains the measured tissue isotope value and the second the 1 standard deviation uncertainty on that value.
</p>
</td></tr>
<tr><td><code id="calRaster_+3A_isoscape">isoscape</code></td>
<td>

<p>SpatRaster. Isoscape raster with two layers. The first one is the mean and the second is one standard deviation.
</p>
</td></tr>
<tr><td><code id="calRaster_+3A_mask">mask</code></td>
<td>

<p>SpatVector. Polygon layer that constrains the area of the output rasters. If this is not provided, the entire area of <code>isoscape</code> is returned.
</p>
</td></tr>
<tr><td><code id="calRaster_+3A_interpmethod">interpMethod</code></td>
<td>

<p>numeric. 1 or 2. Designate one of two methods for extracting values from <code>isoscape</code>. If 1, values for the cell in which a point falls are returned. If 2 the returned values are interpolated (bilinear interpolation) from the values of the four adjacent grid cells.
</p>
</td></tr>
<tr><td><code id="calRaster_+3A_na.value">NA.value</code></td>
<td>

<p>NA or numeric. Value representing the absence of data in <code>isoscape</code>. Commonly used values include NA, -9999, and 9999.
</p>
</td></tr>
<tr><td><code id="calRaster_+3A_ignore.na">ignore.NA</code></td>
<td>

<p>logical. If NA values are extracted from <code>isoscape</code> at the location of samples in known, ignore these values and proceed with <code>calRaster</code>.
</p>
</td></tr>
<tr><td><code id="calRaster_+3A_genplot">genplot</code></td>
<td>

<p>logical. Plot the results.
</p>
</td></tr>
<tr><td><code id="calRaster_+3A_outdir">outDir</code></td>
<td>

<p>character string. Directory path to which output will be saved. If NULL no files are written.
</p>
</td></tr>
<tr><td><code id="calRaster_+3A_verboselm">verboseLM</code></td>
<td>

<p>logical. Print out the linear regression results.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns an object of class &ldquo;rescale&rdquo;.
</p>
<table>
<tr><td><code>isoscape.rescale</code></td>
<td>
<p>SpatRaster. <code>isoscape</code> rescaled using a linear regression model between values of <code>known</code> and <code>isoscape</code>. The first layer is the mean prediction and the second the standard deviation.</p>
</td></tr>
<tr><td><code>lm.data</code></td>
<td>
<p>data.frame. Known origin data and extracted <code>isoscape</code> values used for linear regression modeling.</p>
</td></tr>
<tr><td><code>lm.model</code></td>
<td>
<p>list. Linear regression model.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+pdRaster">pdRaster</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># load hydrogen isotope data for human hair in North America
d = subOrigData(group = "Modern human", mask = naMap, niter = 100, genplot = FALSE)

# rescale from environmental isoscape to tissue isoscape
r = calRaster(d, d2h_lrNA, naMap)
</code></pre>

<hr>
<h2 id='d2h_lrNA'>
data: low resolution North American growing season H isoscape
</h2><span id='topic+d2h_lrNA'></span>

<h3>Description</h3>

<p>Interpolated growing season precipitation H isoscape from waterisotopes.org.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>d2h_lrNA
</code></pre>


<h3>Format</h3>

<p>SpatRaster with two layers. The first layer is the mean prediction and the second is 1 standard deviation
</p>


<h3>References</h3>

<p>Bowen, G. J. (2018) Gridded maps of the isotopic composition of meteoric waters. http://www.waterisotopes.org.
</p>
<p>Bowen, G. J., Wassenaar, L. I. and Hobson, K. A. (2005) Global application of stable hydrogen and oxygen isotopes to wildlife forensics. <em>Oecologia</em>, <b>143</b>, 337&ndash;348.
</p>
<p>IAEA/WMO (2018) Global Network of Isotopes in Precipitation. The GNIP Database. https://nucleus.iaea.org/wiser.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(terra)

plot(d2h_lrNA)
</code></pre>

<hr>
<h2 id='getIsoscapes'>
Download and unpack isoscapes from the web
</h2><span id='topic+getIsoscapes'></span>

<h3>Description</h3>

<p>This function retrieves gridded isotope maps from waterisotopes.org, unpacks the zip archives, and bundles the map layers as a RasterStack.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getIsoscapes(isoType = "GlobalPrecipGS", timeout = 1200)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getIsoscapes_+3A_isotype">isoType</code></td>
<td>

<p>character string indicating which isoscapes are requested: see 'Details'.
</p>
</td></tr>
<tr><td><code id="getIsoscapes_+3A_timeout">timeout</code></td>
<td>

<p>integer. Maximum allowed file download time, in seconds. Some isoscape archives exceed 2 GB in size and may require long download times on slow connections. This option may not work on all system configurations.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Accepted <code>isoType</code> values are:
</p>

<dl>
<dt>&quot;GlobalPrecipGS&quot;</dt><dd><p>Global growing-season precipitation H and O isotope values</p>
</dd>
<dt>&quot;GlobalPrecipMA&quot;</dt><dd><p>Global mean-annual precipitation H and O isotope values</p>
</dd>
<dt>&quot;GlobalPrecipMO&quot;</dt><dd><p>Global monthly precipitation H and O isotope values</p>
</dd>
<dt>&quot;GlobalPrecipALL&quot;</dt><dd><p>Global mean-annual and monthly precipitation H and O isotope values</p>
</dd>
<dt>&quot;USPrecipMA&quot;</dt><dd><p>High-resolution contiguous USA mean-annual precipitation H and O isotope values</p>
</dd>
<dt>&quot;USPrecipMO&quot;</dt><dd><p>High-resolution contiguous USA monthly precipitation H and O isotope values</p>
</dd>
<dt>&quot;USPrecipALL&quot;</dt><dd><p>High-resolution contiguous USA mean-annual and monthly precipitation H and O isotope values</p>
</dd>
<dt>&quot;USSurf&quot;</dt><dd><p>High-resolution contiguous USA surface water H and O isotope values</p>
</dd>
<dt>&quot;USTap&quot;</dt><dd><p>High-resolution contiguous USA surface water H and O isotope values</p>
</dd>
<dt>&quot;USGround&quot;</dt><dd><p>Contiguous USA groundwater H and O isotope values in 7 depth intervals</p>
</dd>
<dt>&quot;GlobalSr&quot;</dt><dd><p>High-resolution bioavailable Sr isotope ratios for the global land surface</p>
</dd>
<dt>&quot;USSr&quot;</dt><dd><p>High-resolution contiguous USA Sr isotope ratios</p>
</dd>
<dt>&quot;CaribSr&quot;</dt><dd><p>High-resolution Sr isotope ratios for the circum-Caribbean region</p>
</dd>
</dl>



<h3>Value</h3>

<p>RasterStack containing the requested isoscape layers.
</p>


<h3>References</h3>

<p><a href="https://wateriso.utah.edu/waterisotopes/pages/data_access/ArcGrids.html">https://wateriso.utah.edu/waterisotopes/pages/data_access/ArcGrids.html</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
iso = getIsoscapes("CaribSr")

## End(Not run)
</code></pre>

<hr>
<h2 id='isoStack'>
Stack isoscapes
</h2><span id='topic+isoStack'></span>

<h3>Description</h3>

<p>Combine multiple isoscapes into a single data object, including optional reconciliation of raster properties.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>isoStack(..., clean = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="isoStack_+3A_...">...</code></td>
<td>

<p>Two or more SpatRaster isoscapes, each with two layers, or <code>rescale</code> objects as produced by <code><a href="#topic+calRaster">calRaster</a></code>. For objects other than <code>rescale</code>, the first layer in each should contain the tissue-specific isoscape and the second the isoscape prediction uncertainty (1 standard deviation).
</p>
</td></tr>
<tr><td><code id="isoStack_+3A_clean">clean</code></td>
<td>

<p>logical. Reconcile differences in raster properties within <code>...</code>?
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>clean</code> = TRUE all raster layers are projected to the projection of the first object in <code>...</code> and then resampled to the highest spatial resolution and smallest common spatial extent within <code>...</code>. Finally, cells containing NA in any layer within <code>...</code> are masked across all layers.
</p>
<p>If <code>clean</code> = FALSE any differences in raster properties between isoscapes will produce an error. 
</p>


<h3>Value</h3>

<p>Returns an object of class &ldquo;isoStack&rdquo;, a list containing the isoscapes objects in <code>...</code> after any cleaning. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#stack H and Sr isoscapes
h_s = isoStack(d2h_lrNA, sr_MI)
</code></pre>

<hr>
<h2 id='jointP'>
Joint probability of origin
</h2><span id='topic+jointP'></span>

<h3>Description</h3>

<p>Joint probability for individuals of common origin (product of probabilities)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>jointP(pdR)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="jointP_+3A_pdr">pdR</code></td>
<td>

<p>SpatRaster of probability density maps, e.g., as produced by <code>pdRaster</code>. All layers must have common spatial extent and projection.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>SpatRaster.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># load hydrogen isotope data for human hair in North America
d = subOrigData(group = "Modern human", mask = naMap, genplot = FALSE)

# rescale from environmental isoscape to tissue isoscape
r = calRaster(d, d2h_lrNA, naMap, genplot = FALSE)

# four unknown-origin examples
id = c("A", "B", "C", "D")
d2H = c(-110, -90, -105, -102)
un = data.frame(id, d2H)

# posterior probabilities
pp = pdRaster(r, un, mask = naMap, genplot = FALSE)

# joint probability for individuals of common origin
jointP(pp)
</code></pre>

<hr>
<h2 id='knownOrig'>
data: database of H and O isotope data for tissues of known origin
</h2><span id='topic+knownOrig'></span>

<h3>Description</h3>

<p>This dataset consists of hydrogen and oxygen isotope values and metadata for human hair, insect wings, and bird feathers of known geographic origin.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>knownOrig
</code></pre>


<h3>Format</h3>

<p>list.
</p>

<dl>
<dt>sites</dt><dd><p>SpatVector with 5 fields. WGS84 unprojected geometry.
</p>

<dl>
<dt>[, 1]</dt><dd><p>Site_ID: Unique ID</p>
</dd>
<dt>[, 2]</dt><dd><p>Site_name: Site name or descriptor</p>
</dd>
<dt>[, 3]</dt><dd><p>State: State or province of collection site, where recorded</p>
</dd>
<dt>[, 4]</dt><dd><p>Country: Country of collection site, where recorded</p>
</dd>
<dt>[, 5]</dt><dd><p>Site_comments: Site comments</p>
</dd>
</dl>

</dd>
<dt>samples</dt><dd><p>data.frame with 15 fields.
</p>

<dl>
<dt>[, 1]</dt><dd><p>Sample_ID: Unique ID</p>
</dd>
<dt>[, 2]</dt><dd><p>Sample_ID_orig: ID used in original data report</p>
</dd>
<dt>[, 3]</dt><dd><p>Site_ID: ID for sample collection site</p>
</dd>
<dt>[, 4]</dt><dd><p>Dataset_ID: ID for dataset from which sample is derived</p>
</dd>
<dt>[, 5]</dt><dd><p>Taxon: Genus and species name</p>
</dd>
<dt>[, 6]</dt><dd><p>Group: Biological group (informal)</p>
</dd>
<dt>[, 7]</dt><dd><p>Source_quality: Code indicating level of certainty in geographic origin</p>
</dd>
<dt>[, 8]</dt><dd><p>Age_class: Code for age of individual</p>
</dd>
<dt>[, 9]</dt><dd><p>Material_type: Tissue sampled, e.g., &ldquo;Hair&rdquo;</p>
</dd>
<dt>[, 10]</dt><dd><p>Matrix: Compound measured, e.g., &ldquo;Keratin&rdquo;</p>
</dd>
<dt>[, 11]</dt><dd><p>d2H: Hydrogen isotope value (permil)</p>
</dd>
<dt>[, 12]</dt><dd><p>d2H.sd: Reported analytical uncertainty for hydrogen isotope value (permil)</p>
</dd>
<dt>[, 13]</dt><dd><p>d18O: Oxygen isotope value (permil)</p>
</dd>
<dt>[, 14]</dt><dd><p>d18O.sd: Reported analytical uncertainty for oxygen isotope value (permil)</p>
</dd>
<dt>[, 15]</dt><dd><p>Sample_comments: Sample comments</p>
</dd>
</dl>

</dd>    
<dt>sources</dt><dd><p>data.frame with 17 fields.
</p>

<dl>
<dt>[, 1]</dt><dd><p>Dataset_ID: Unique ID</p>
</dd>
<dt>[, 2]</dt><dd><p>Dataset_name: Short name or descriptor</p>
</dd>
<dt>[, 3]</dt><dd><p>Citation: Bibliographic citation for study</p>
</dd>
<dt>[, 4]</dt><dd><p>Sampling_method: How material was subsampled for analysis, if reported</p>
</dd>
<dt>[, 5]</dt><dd><p>Sample_powdered: Was sample powdered prior to analysis (Y/N/NA)?</p>
</dd>
<dt>[, 6]</dt><dd><p>Lipid_extraction: Were lipids chemically extracted prior to analysis (Y/N/NA)?</p>
</dd>
<dt>[, 7]</dt><dd><p>Lipid_extraction_method: Solvent used to extract lipids</p>
</dd>
<dt>[, 8]</dt><dd><p>Exchange: Was a correction for exchangeable H made (Y/N/NA)?</p>
</dd>
<dt>[, 9]</dt><dd><p>Exchange_method: Method used to correct for exchangeable H</p>
</dd>
<dt>[, 10]</dt><dd><p>Exchange_T: Was H exchange carried out at ambient or high temperature (Ambient/High/NA)?</p>
</dd>
<dt>[, 11]</dt><dd><p>H_cal: Reference scale used to calibrate H isotope data, see <code><a href="#topic+stds">stds</a></code> object hstds</p>
</dd>
<dt>[, 12]</dt><dd><p>O_cal: Reference scale used to calibrate O isotope data, see <code><a href="#topic+stds">stds</a></code> object ostds</p>
</dd>
<dt>[, 13]</dt><dd><p>Std_powdered: Were calibration standards powdered (Y/N/NA)?</p>
</dd>
<dt>[, 14]</dt><dd><p>Drying: Did the study document how samples were fully dried and transferred dry to instrument (Y/N/NA)?</p>
</dd>
<dt>[, 15]</dt><dd><p>Analysis_method: Instrument configuration used for analysis</p>
</dd>
<dt>[, 16]</dt><dd><p>Analysis_type: What elements were analyzed for stable isotope ratios (H/O/H_O)?</p>
</dd>
<dt>[, 17]</dt><dd><p>Source_comments: Data source comments</p>
</dd>
</dl>

</dd>
</dl>



<h3>See Also</h3>

<p><code><a href="#topic+subOrigData">subOrigData</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(terra)

class(knownOrig$sites)
class(knownOrig$samples); class(knownOrig$sources)

summary(knownOrig$samples)

print(knownOrig$sources[, 1:2])

plot(wrld_simpl, border = "grey")
points(knownOrig$sites)
</code></pre>

<hr>
<h2 id='naMap'>
data: North America boundary map
</h2><span id='topic+naMap'></span>

<h3>Description</h3>

<p>Simplified spatial polygon layer representing the boundary of North America.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>naMap
</code></pre>


<h3>Format</h3>

<p>SpatVector
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(terra)

plot(naMap)
</code></pre>

<hr>
<h2 id='oddsRatio'>
Odds ratio of points or regions
</h2><span id='topic+oddsRatio'></span>

<h3>Description</h3>

<p>Calculate ratio of odds for two locations (points or polygons)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>oddsRatio(pdR, inputP)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="oddsRatio_+3A_pdr">pdR</code></td>
<td>

<p>SpatRaster of probability density maps, e.g., as produced by <code>pdRaster</code>.
</p>
</td></tr>
<tr><td><code id="oddsRatio_+3A_inputp">inputP</code></td>
<td>

<p>SpatVector points object of length 1 or 2 or polygons object of length 2
</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>library(terra)

# load hydrogen isotope data for human hair in North America
d = subOrigData(group = "Modern human", mask = naMap, genplot = FALSE)

# rescale from environmental isoscape to tissue isoscape
r = calRaster(d, d2h_lrNA, naMap, genplot = FALSE)

# four unknown-origin examples
id = c("A", "B", "C", "D")
d2H = c(-110, -90, -105, -102)
un = data.frame(id, d2H)

# posterior probabilities
pp = pdRaster(r, un, mask = naMap, genplot = FALSE)

# SpatialPolygons for two regions of interest
s1 = states[states$STATE_ABBR == "UT",]
s2 = states[states$STATE_ABBR == "NM",]
plot(naMap)
plot(s1, border = "red", add = TRUE)
plot(s2, border = "blue", add = TRUE)

# Get odds ratio for two regions using SpatialPolygon method
s12 = rbind(s1, s2)
oddsRatio(pp, s12)                     

# Create SpatialPoints for two points of interest
p1 = c(-112, 40)
p2 = c(-105, 33)
p12 = vect(rbind(p1, p2), crs = "WGS84")
points(p12, pch = 21, bg = "light blue")

# Get odds ratio for two points using SpatialPoints method
oddsRatio(pp, p12)
</code></pre>

<hr>
<h2 id='pdRaster'>
Probability of origin surfaces
</h2><span id='topic+pdRaster'></span>

<h3>Description</h3>

<p>Calculate posterior probabilities of origin for a sample based on its isotope ratio.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pdRaster(r, unknown, prior = NULL, mask = NULL, genplot = TRUE, outDir = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pdRaster_+3A_r">r</code></td>
<td>

<p>SpatRaster with two layers, <code>rescale</code> object (see <code><a href="#topic+calRaster">calRaster</a></code>), or <code><a href="#topic+isoStack">isoStack</a></code> object. For user-generated raster objects, the first layer must be the substrate-specific isoscape (mean prediction) and the second the isoscape prediction uncertainty (1 standard deviation).
</p>
</td></tr>
<tr><td><code id="pdRaster_+3A_unknown">unknown</code></td>
<td>

<p>data.frame, <code><a href="#topic+refTrans">refTrans</a></code> object, or list of two or more <code><a href="#topic+refTrans">refTrans</a></code> objects. For user-created data.frame, first column should contain unique sample IDs, and subsequent columns should contain sample isotope values for one or more isotopes to be used in assignment.
</p>
</td></tr>
<tr><td><code id="pdRaster_+3A_prior">prior</code></td>
<td>

<p>SpatRaster. Optional raster layer with prior probabilities, which has the same projection, resolution and extent as <code>r</code>.
</p>
</td></tr>
<tr><td><code id="pdRaster_+3A_mask">mask</code></td>
<td>

<p>SpatVector. This polygon mask will constrain the assignment area. If this is not provided, a default of mask of the extent of <code>r</code> is used.
</p>
</td></tr>
<tr><td><code id="pdRaster_+3A_genplot">genplot</code></td>
<td>

<p>logical. Plot results in R.
</p>
</td></tr>
<tr><td><code id="pdRaster_+3A_outdir">outDir</code></td>
<td>

<p>character string. Directory path to which output will be saved. If NULL no files are written.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If more than one isotope marker is to be used for multivariate assignment, <code>r</code> must be an <code><a href="#topic+isoStack">isoStack</a></code> object and the number of isoscapes in that object must be equal to the number of isotope-value columns or <code><a href="#topic+refTrans">refTrans</a></code> objects included in <code>unknown</code>. Isoscapes and unknown sample values will be matched based on order, so it is critical that the values appear in the same order in these two input objects.
</p>


<h3>Value</h3>

<p>SpatRaster including a probability density surface for each individual in <code>unknown</code>. If <code>outDir</code> is not NULL, writes individual rasters in GeoTIFF format and a single PDF file with images for each probability density raster to the designated directory.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+calRaster">calRaster</a></code>
<code><a href="#topic+refTrans">refTrans</a></code>
<code><a href="#topic+isoStack">isoStack</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># load hydrogen isotope data for human hair in North America
d = subOrigData(group = "Modern human", mask = naMap, genplot = FALSE)

# rescale from environmental isoscape to tissue isoscape
r = calRaster(d, d2h_lrNA, naMap, genplot = FALSE)

# sample to assign
id = "smile"
d2H = -80
un = data.frame(id, d2H)

# posterior probability surface
pp = pdRaster(r, un, mask = naMap)
</code></pre>

<hr>
<h2 id='plot.isoStack'>
Plot method for stacked isoscapes
</h2><span id='topic+plot.isoStack'></span>

<h3>Description</h3>

<p>Plot the output from <code><a href="#topic+isoStack">isoStack</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'isoStack'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.isoStack_+3A_x">x</code></td>
<td>

<p>An isoStack object
</p>
</td></tr>
<tr><td><code id="plot.isoStack_+3A_...">...</code></td>
<td>

<p>Other arguments to be passed to plot
</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+isoStack">isoStack</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#stack H and Sr isoscapes
h_s = isoStack(d2h_lrNA, sr_MI)

#plot isoStack
plot(h_s)
</code></pre>

<hr>
<h2 id='plot.QA'>
Plot quality metrics for geographic assignments
</h2><span id='topic+plot.QA'></span>

<h3>Description</h3>

<p>Plot the output from <code><a href="#topic+QA">QA</a></code>, including spatial precision, bias, sensitivity and odds ratio of known locations for validation samples.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'QA'
plot(x, ..., outDir = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.QA_+3A_x">x</code></td>
<td>

<p>One or more QA objects
</p>
</td></tr>
<tr><td><code id="plot.QA_+3A_...">...</code></td>
<td>

<p>Other arguments to be passed to plot
</p>
</td></tr>
<tr><td><code id="plot.QA_+3A_outdir">outDir</code></td>
<td>

<p>character string. Directory path to which output will be saved. If NULL no files are written.
</p>
</td></tr>
</table>


<h3>References</h3>

<p>Ma, C. et al. (2020) assignR : An R package for isotope-based geographic assignment. <em>Methods in Ecology and Evolution</em> <strong>11</strong> 996&ndash;1001. <a href="https://doi.org/10.1111/2041-210X.13426">doi:10.1111/2041-210X.13426</a>.
</p>
<p>Vander Zanden, H. B. et al. (2014) Contrasting assignment of migratory organisms to geographic origins using long-term versus year-specific precipitation isotope maps. <em>Methods in Ecology and Evolution</em> <strong>5</strong> 891&ndash;900. <a href="https://doi.org/10.1111/2041-210X.12229">doi:10.1111/2041-210X.12229</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+QA">QA</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># extract some known-origin data
d1 = subOrigData(taxon = "Buteo lagopus")

# run quality assessment based on precipitation hydrogen isotopes and 
# known-origin samples; small values of valiStation and valiTime 
# are used in example to reduce run time

# first with one example
# gives warning because a small number of samples are available
qa1 = QA(isoscape = d2h_lrNA, known = d1, valiStation = 1, 
          valiTime = 2, by = 10, mask = naMap, name = "Buteo")
                    
# plot the qa result
plot(qa1)

# now compare with a second data set
d2 = subOrigData(taxon = "Charadrius montanus")
qa2 = QA(isoscape = d2h_lrNA, known = d2, valiStation = 1, 
          valiTime = 2, by = 10, mask = naMap, name = "Charadrius")
plot(qa1, qa2)
</code></pre>

<hr>
<h2 id='plot.wDist'>
Plot weighted distance and bearing distributions
</h2><span id='topic+plot.wDist'></span>

<h3>Description</h3>

<p>Plot the output from <code><a href="#topic+wDist">wDist</a></code>, including weighted kernel density distributions for distance and bearing of travel.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'wDist'
plot(x, ..., bin = 20, pty = "both", index = c(1:5))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.wDist_+3A_x">x</code></td>
<td>

<p>A wDist object
</p>
</td></tr>
<tr><td><code id="plot.wDist_+3A_...">...</code></td>
<td>

<p>Other arguments to be passed to plot
</p>
</td></tr>
<tr><td><code id="plot.wDist_+3A_bin">bin</code></td>
<td>

<p>numeric. Bin width used to generate rose plot of travel bearings, in degrees. Must be a factor of 360.
</p>
</td></tr>
<tr><td><code id="plot.wDist_+3A_pty">pty</code></td>
<td>

<p>character. Type of plot to produce. Must be one of &ldquo;dist&rdquo;, &ldquo;bear&rdquo;, or &ldquo;both&rdquo;.
</p>
</td></tr>
<tr><td><code id="plot.wDist_+3A_index">index</code></td>
<td>

<p>numeric. Which items in x to plot? Numeric vector of up to 5 integers. Values in excess of 5 or exceeding the length of x will be ignored.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For the default <code>pty</code>, two plot panels will be printed to the active graphical device showing the distance and bearing distributions for (up to) the first five samples in <code>wd</code>. If more than five items exist in <code>wd</code>, those beyond the fifth will be ignored and a message returned.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+wDist">wDist</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># load hydrogen isotope data for human hair in North America
d = subOrigData(group = "Modern human", mask = naMap, niter = 100)

# rescale from environmental isoscape to tissue isoscape
r = calRaster(known = d, isoscape = d2h_lrNA, mask = naMap)

# four unknown-origin examples
id = c("A", "B", "C", "D")
d2H = c(-110, -90, -105, -102)
un = data.frame(id,d2H)

# posterior probabilities
pp = pdRaster(r, unknown = un, mask = naMap)

# random collection locations
sites = d$data[sample(seq(length(d$data)), 4),]

# generate a wDist object
wd = wDist(pp, sites)

# plot distributions
plot(wd)

# plot bearing distriubtion for sample B with a finer bin size
plot(wd, bin = 5, pty = "bear", index = 2)
</code></pre>

<hr>
<h2 id='QA'>
Quality assessment of geographic assignments
</h2><span id='topic+QA'></span>

<h3>Description</h3>

<p>How well does a given isoscape and/or known origin data set constrain the geographic origin of samples? Uses iterative re-sampling of known origin data to evaluate sample assignments and reports a suite of quality metrics.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>QA(known, isoscape, bySite = TRUE, valiStation = 1, valiTime = 50, 
  recal = TRUE, by = 2, prior = NULL, mask = NULL, setSeed = TRUE, 
  name = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="QA_+3A_known">known</code></td>
<td>

<p>subOrigData, list of subOrigData, or SpatVector. Known-origin tissue isotope data from the <code>subOrigData</code> function or provided by user. User-provided data must be formatted as subOrigData objects (see <code><a href="#topic+subOrigData">subOrigData</a></code>) or a SpatVector (see Details).
</p>
</td></tr>
<tr><td><code id="QA_+3A_isoscape">isoscape</code></td>
<td>
<p>SpatRaster with two layers or <code><a href="#topic+isoStack">isoStack</a></code> object. For user-generated raster objects, the first layer must be the isoscape (mean prediction) and the second the isoscape prediction uncertainty (1 standard deviation).
</p>
</td></tr>
<tr><td><code id="QA_+3A_bysite">bySite</code></td>
<td>
<p>logical. Resample known by site (TRUE) or by sample (FALSE)?</p>
</td></tr>
<tr><td><code id="QA_+3A_valistation">valiStation</code></td>
<td>
<p>numeric. How many sites or samples from known are withheld for validation? Must be two or more smaller than the length of <code>known</code>.
</p>
</td></tr>
<tr><td><code id="QA_+3A_valitime">valiTime</code></td>
<td>
<p>numeric. How many times do you want to randomly draw validation samples and run the validation? Must be an integer greater than one.
</p>
</td></tr>
<tr><td><code id="QA_+3A_recal">recal</code></td>
<td>
<p>logical. Recalibrate the isoscape(s) using the known-origin data? If FALSE, <code>isoscape</code> should be a calibrated product appropriate to the samples, and a single iteration is run for each sample in <code>known</code>; parameters <code>bySite</code>, <code>valiStation</code>, and <code>valiTime</code> are ignored.</p>
</td></tr>
<tr><td><code id="QA_+3A_by">by</code></td>
<td>
<p>integer. Threshold increment to use in evaluating assignment performance. Must be between 1 and 25.</p>
</td></tr>
<tr><td><code id="QA_+3A_prior">prior</code></td>
<td>
<p>SpatRaster. Optional layer with prior probabilities, which has the same projection, resolution and extent as <code>isoscape</code>.
</p>
</td></tr>
<tr><td><code id="QA_+3A_mask">mask</code></td>
<td>
<p>SpatVector. Constrains the area of the analysis. If this is not provided, the entire area of <code>isoscape</code> is used.
</p>
</td></tr>
<tr><td><code id="QA_+3A_setseed">setSeed</code></td>
<td>
<p>logical. Do you want to <code>set.seed()</code> when you randomly draw validation stations? &ldquo;TRUE&rdquo; gives the same sequence of random draws each time the function is called.
</p>
</td></tr>
<tr><td><code id="QA_+3A_name">name</code></td>
<td>
<p>character. Useful for identifying the QA output in subsequent plotting.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>known</code> is a user-provided SpatVector, the first data field must include the measured value for the first (or only) isotope marker and the second the one standard deviation uncertainty on that value. Subsequent fields must include the same information for all other isotope markers included in the analysis, and these markers must appear in the same order as in <code>isoscape</code>. A user-provided SpatVector must include a field named &ldquo;Site_ID&rdquo; containing unique values for each sampling site to support the &ldquo;bySite&rdquo; option, otherwise use <code>bySite = FALSE</code>.
</p>


<h3>Value</h3>

<p>Returns an object of class &ldquo;QA&rdquo;.
</p>
<table>
<tr><td><code>val_stations</code></td>
<td>
<p>numeric. An X*Y data.frame of validation station IDs for all valiTime. X = <code>valiTime</code> and Y = <code>valiStation</code>.
</p>
</td></tr>
<tr><td><code>pd_val</code></td>
<td>
<p>numeric. An X*Y data.frame containing the posterior probability density for the validation stations. X = <code>valiTime</code> and Y = <code>valiStation</code>.
</p>
</td></tr>
<tr><td><code>prption_byArea</code></td>
<td>
<p>numeric. An X*Y data.frame showing the proportion of validation individuals for which the known origin is contained within the top 0.00 to 1.00 area quantile (with increment of <code>by / 100</code>; Y = <code>ceiling(100 / by) + 1</code>). X = <code>valiTime</code>.
</p>
</td></tr>
<tr><td><code>prption_byProb</code></td>
<td>
<p>numeric. An X*Y data.frame showing the proportion of validation individuals for which the known origin is contained within the top 0.00 to 1.00 probability quantile (with increment of <code>by / 100</code>; Y = <code>ceiling(100 / by) + 1</code>). X = <code>valiTime</code>.
</p>
</td></tr>
<tr><td><code>precision</code></td>
<td>
<p>list. The length of the list is <code>valiTime</code>. Each element is an X*Y matrix showing the proportional area of the total assignment surface covered by the assignment region at a given probability quantile from 0.00 to 1.00 (with increment of <code>by / 100</code>; X = <code>ceiling(100 / by) + 1</code>) for each validation sample (Y = <code>valiStation</code>).</p>
</td></tr>
<tr><td><code>random_prob_density</code></td>
<td>
<p>Random probability of assignment to any given grid cell on the assignment surface(i.e. 1 divided by the total number of grid cells).
</p>
</td></tr>
<tr><td><code>name</code></td>
<td>
<p>character. Name assigned to the QA object.</p>
</td></tr>
<tr><td><code>by</code></td>
<td>
<p>integer. Value of by used.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>See Ma et al. (2020) for methodological details.
</p>


<h3>References</h3>

<p>Ma, C. et al. (2020) assignR : An R package for isotope-based geographic assignment. <em>Methods in Ecology and Evolution</em> <strong>11</strong> 996&ndash;1001. <a href="https://doi.org/10.1111/2041-210X.13426">doi:10.1111/2041-210X.13426</a>.
</p>
<p>Vander Zanden, H. B. et al. (2014) Contrasting assignment of migratory organisms to geographic origins using long-term versus year-specific precipitation isotope maps. <em>Methods in Ecology and Evolution</em> <strong>5</strong> 891&ndash;900. <a href="https://doi.org/10.1111/2041-210X.12229">doi:10.1111/2041-210X.12229</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.QA">plot.QA</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># extract some known-origin data
d1 = subOrigData(taxon = "Buteo lagopus")

# run quality assessment based on precipitation hydrogen isotopes and 
# known-origin samples; small values of valiStation and valiTime 
# are used in example to reduce run time

# first with one example
# gives warning because a small number of samples are available
qa1 = QA(known = d1, isoscape = d2h_lrNA, valiTime = 2, by = 10, 
          mask = naMap, name = "Buteo")
                    
# plot the qa result
plot(qa1)

# now compare with a second data set
d2 = subOrigData(taxon = "Charadrius montanus")
qa2 = QA(known = d2, isoscape = d2h_lrNA, valiTime = 2, by = 10, 
          mask = naMap, name = "Charadrius")
plot(qa1, qa2)
</code></pre>

<hr>
<h2 id='qtlRaster'>
Sample assignment using thresholds
</h2><span id='topic+qtlRaster'></span>

<h3>Description</h3>

<p>Selects the grid cells of probability density rasters with the highest probability and returns rasters with these cell values set to 1. Cells are selected based on the user-specified quantile threshold so that the most-probable cells representing a given fraction of the assignment area or posterior probability are returned.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>qtlRaster(pdR, threshold, thresholdType = "area", genplot = TRUE, outDir = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="qtlRaster_+3A_pdr">pdR</code></td>
<td>

<p>SpatRaster. Probability density maps for individual samples, e.g., as output by <code>pdRaster</code>.
</p>
</td></tr>
<tr><td><code id="qtlRaster_+3A_threshold">threshold</code></td>
<td>

<p>numeric from 0 to 1. Quantile to be selected. 
</p>
</td></tr>
<tr><td><code id="qtlRaster_+3A_thresholdtype">thresholdType</code></td>
<td>

<p>character. Either &ldquo;area&rdquo; (default) or &ldquo;prob&rdquo;. If &ldquo;area&rdquo;, the most probable cells constituting <code>threshold</code> percent of the assignment area are selected. If &ldquo;prob&rdquo;, the most probable cells constituting <code>threshold</code> percent of the posterior probability are selected.
</p>
</td></tr>
<tr><td><code id="qtlRaster_+3A_genplot">genplot</code></td>
<td>

<p>logical.Plot results in R.
</p>
</td></tr>
<tr><td><code id="qtlRaster_+3A_outdir">outDir</code></td>
<td>

<p>character string. Directory path to which output will be saved. If NULL no files are written.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>SpatRaster including a binary assignment surface for each individual in <code>pdR</code>. If <code>outDir</code> is not NULL, writes individual rasters in GeoTIFF format and a single PDF file with images for each raster to the designated directory.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(terra)

# load hydrogen isotope data for human hair in North America
d = subOrigData(group = "Modern human", mask = naMap, genplot = FALSE)

# rescale from environmental isoscape to tissue isoscape
r = calRaster(d, d2h_lrNA, naMap, genplot = FALSE)

# four unknown-origin examples
id = c("A", "B", "C", "D")
d2H = c(-110, -90, -105, -102)
un = data.frame(id, d2H)

# posterior probabilities
pp = pdRaster(r, un, mask = naMap, genplot = FALSE)

# assign to most probable 10 percent of area
## Not run: qtlRaster(pp, threshold = 0.1)

# assign to most probable 10 percent of proabability distribution
qtlRaster(pp, threshold = 0.1, thresholdType = "prob")
</code></pre>

<hr>
<h2 id='refTrans'>
Transform reference scale of data
</h2><span id='topic+refTrans'></span>

<h3>Description</h3>

<p>This function conducts transformations to convert isotope measurements between reference scales.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>refTrans(samples, marker = "d2H", ref_scale = "VSMOW_H", niter = 5000)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="refTrans_+3A_samples">samples</code></td>
<td>

<p>data.frame. Must include a field with data to be transformed, analytical reproducibility of sample data (1 standard deviation), and original reference scale for calibration of data. These fields must be named <em>marker</em>, <em>marker.sd</em>, and <em>marker_cal</em>, respectively, where <em>marker</em> is &ldquo;d2H&rdquo; or &ldquo;d18O&rdquo;. Values for the cal field should correspond to <em>Calibration</em> codes found in <code><a href="#topic+stds">stds</a></code> tables <em>hstds</em> and <em>ostds</em>.
</p>
</td></tr>
<tr><td><code id="refTrans_+3A_marker">marker</code></td>
<td>

<p>character string. Column name for isotopic data to be extracted, either &ldquo;d2H&rdquo; or &ldquo;d18O&rdquo;.
</p>
</td></tr>
<tr><td><code id="refTrans_+3A_ref_scale">ref_scale</code></td>
<td>

<p>character string. Text identifier for reference scale to which all isotope values will be transformed. See <code><a href="#topic+stds">stds</a></code>.</p>
</td></tr>
<tr><td><code id="refTrans_+3A_niter">niter</code></td>
<td>

<p>integer. Number of random samples used to propagate uncertainty in calibration hierarchy transformations.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns an object of class &ldquo;refTrans&rdquo;.
</p>
<table>
<tr><td><code>data</code></td>
<td>

<p>data.frame. Formatted identically to input object <em>samples</em>, with values for the data and data uncertainty fields replaced with transformed values.</p>
</td></tr>
<tr><td><code>chains</code></td>
<td>

<p>list. Each item is a character string vector containing the hierarchy of calibrations used in the transformation for a set of selected samples. See <code><a href="#topic+stds">stds</a></code>.
</p>
</td></tr>
</table>


<h3>References</h3>

<p>Magozzi, S. et al. (in press) Calibration chain transformation to improve the comparability of organic hydrogen and oxygen isotope data. <em>Methods in Ecology and Evolution</em>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Some fake sample data
s = data.frame("d2H" = seq(-100, -10, by=10), "d2H.sd" = rep(2), "d2H_cal" = rep("OldUT_H_1"))

# Transform to VSMOW-SLAP scale using default arguments
d1 = refTrans(s)

# Transformed values
d1$data$d2H

# error - target scale not valid for marker
## Not run: d2 = refTrans(s, ref_scale = "VSMOW_O")

</code></pre>

<hr>
<h2 id='sr_MI'>
data: low resolution locally weathered Sr isoscape for Michigan
</h2><span id='topic+sr_MI'></span>

<h3>Description</h3>

<p>Modeled 87Sr/86Sr value of the local rock weathering flux, obtained from waterisotopes.org and aggregated to 10 km resolution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sr_MI
</code></pre>


<h3>Format</h3>

<p>SpatRaster with two layers. The first layer is the mean prediction and the second is 1 standard deviation (here estimated as 1 percent of the modeled mean)
</p>


<h3>References</h3>

<p>Bataille, C. P. and Bowen, G. J. (2012) Mapping 87Sr/86Sr variations in bedrock and water for large scale provenance studies. <em>Chemical Geology</em>, <b>304&ndash;305</b>, 39&ndash;52.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(terra)

plot(sr_MI)
</code></pre>

<hr>
<h2 id='states'>
data: outline of US states
</h2><span id='topic+states'></span>

<h3>Description</h3>

<p>Outline map of the of lower 48 U.S. states.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>states
</code></pre>


<h3>Format</h3>

<p>SpatVector
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(terra)

plot(states)
</code></pre>

<hr>
<h2 id='stds'>
data: documentation of keratin H and O isotope standard calibrations
</h2><span id='topic+stds'></span>

<h3>Description</h3>

<p>This data object contains information on keratin H and O isotope standard materials and calibrations used across multiple laboratories since the year 2000.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("stds")
</code></pre>


<h3>Format</h3>

<p>list.
</p>

<dl>
<dt>hstds</dt><dd>
<p>data.frame with 18 fields.
</p>

<dl>
<dt>[, 1]</dt><dd><p>Calibration: Calibration code</p>
</dd>
<dt>[, 2]</dt><dd><p>High_ID: Identifier for high-value standard</p>
</dd>
<dt>[, 3]</dt><dd><p>High_material: Description of high-value standard material</p>
</dd>
<dt>[, 4]</dt><dd><p>High: Mean hydrogen isotope value of high-value standard</p>
</dd>
<dt>[, 5]</dt><dd><p>High_sd: Standard deviation of calibration data for high-value standard</p>
</dd>
<dt>[, 6]</dt><dd><p>High_n: Number of calibration data for high-value standard</p>
</dd>
<dt>[, 7]</dt><dd><p>High_se: Standard error of the calibrated mean for high-value standard</p>
</dd>
<dt>[, 8]</dt><dd><p>Low_ID: Identifier for low-value standard</p>
</dd>
<dt>[, 9]</dt><dd><p>Low_material: Description of low-value standard material</p>
</dd>
<dt>[, 10]</dt><dd><p>Low: Mean hydrogen isotope value of low-value standard</p>
</dd>
<dt>[, 11]</dt><dd><p>Low_sd: Standard deviation of calibration data for low-value standard</p>
</dd>
<dt>[, 12]</dt><dd><p>Low_n: Number of calibration data for low-value standard</p>
</dd>
<dt>[, 13]</dt><dd><p>Low_se: Standard error of the calibrated mean for low-value standard</p>
</dd>
<dt>[, 14]</dt><dd><p>Ref_scale: Calibration scale against which the values for this calibration are anchored</p>
</dd>
<dt>[, 15]</dt><dd><p>Citation_val: Source for the calibrated values</p>
</dd>
<dt>[, 16]</dt><dd><p>Citation_cal: Source for the methodology used for this calibration</p>
</dd>
<dt>[, 17]</dt><dd><p>Treatment: Description of calibration procedure</p>
</dd>
<dt>[, 18]</dt><dd><p>H_calibration_comments: Comments</p>
</dd>
</dl>

</dd>
<dt>ostds</dt><dd>
<p>data.frame with 18 fields.
</p>

<dl>
<dt>[, 1]</dt><dd><p>Calibration: Calibration code</p>
</dd>
<dt>[, 2]</dt><dd><p>High_ID: Identifier for high-value standard</p>
</dd>
<dt>[, 3]</dt><dd><p>High_material: Description of high-value standard material</p>
</dd>
<dt>[, 4]</dt><dd><p>High: Mean oxygen isotope value of high-value standard</p>
</dd>
<dt>[, 5]</dt><dd><p>High_sd: Standard deviation of calibration data for high-value standard</p>
</dd>
<dt>[, 6]</dt><dd><p>High_n: Number of calibration data for high-value standard</p>
</dd>
<dt>[, 7]</dt><dd><p>High_se: Standard error of the calibrated mean for high-value standard</p>
</dd>
<dt>[, 8]</dt><dd><p>Low_ID: Identifier for low-value standard</p>
</dd>
<dt>[, 9]</dt><dd><p>Low_material: Description of low-value standard material</p>
</dd>
<dt>[, 10]</dt><dd><p>Low: Mean oxygen isotope value of low-value standard</p>
</dd>
<dt>[, 11]</dt><dd><p>Low_sd: Standard deviation of calibration data for low-value standard</p>
</dd>
<dt>[, 12]</dt><dd><p>Low_n: Number of calibration data for low-value standard</p>
</dd>
<dt>[, 13]</dt><dd><p>Low_se: Standard error of the calibrated mean for low-value standard</p>
</dd>
<dt>[, 14]</dt><dd><p>Ref_scale: Calibration scale against which the values for this calibration are anchored</p>
</dd>
<dt>[, 15]</dt><dd><p>Citation_val: Source for the calibrated values</p>
</dd>
<dt>[, 16]</dt><dd><p>Citation_cal: Source for the methodology used for this calibration</p>
</dd>
<dt>[, 17]</dt><dd><p>Treatment: Description of calibration procedure</p>
</dd>
<dt>[, 18]</dt><dd><p>O_calibration_comments: Comments</p>
</dd>
</dl>

</dd>
<dt>ham</dt><dd>
<p>matrix. n x n symmetric, where n is the number of calibrations represented here and in <code>stds$hstds</code>.
</p>
</dd>
<dt>oam</dt><dd>
<p>matrix. n x n symmetric, where n is the number of calibrations represented here and in <code>stds$ostds</code>.
</p>
</dd>
</dl>



<h3>References</h3>

<p>Magozzi, S. et al. (in press) Calibration chain transformation to improve the comparability of organic hydrogen and oxygen isotope data. <em>Methods in Ecology and Evolution</em>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(graphics)
data("stds")

print(stds$hstds[, 1:5])
print(stds$ostds[, 1:5])
image(stds$ham)
image(stds$oam)
</code></pre>

<hr>
<h2 id='subOrigData'>
Extract known origin sample data
</h2><span id='topic+subOrigData'></span>

<h3>Description</h3>

<p>This function subsets the known-origin isotope dataset included in this package and conducts optional transformations to convert isotope measurements to a common reference scale.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>subOrigData(marker = "d2H", taxon = NULL, group = NULL, dataset = NULL, 
  age_code = NULL, mask = NULL, ref_scale = "VSMOW_H", niter = 5000, genplot = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="subOrigData_+3A_marker">marker</code></td>
<td>

<p>character string. Column name for isotopic data to be extracted, either &ldquo;d2H&rdquo; or &ldquo;d18O&rdquo;.
</p>
</td></tr>
<tr><td><code id="subOrigData_+3A_taxon">taxon</code></td>
<td>

<p>character string or string vector. Species name(s) for data to be extracted.
</p>
</td></tr>
<tr><td><code id="subOrigData_+3A_group">group</code></td>
<td>

<p>character string or string vector. Taxonomic groups for data to be extracted.
</p>
</td></tr>
<tr><td><code id="subOrigData_+3A_dataset">dataset</code></td>
<td>

<p>integer or integer vector. Dataset_ID(s) for data to be extracted. See <code><a href="#topic+knownOrig">knownOrig</a></code> feature <em>sources</em>.
</p>
</td></tr>
<tr><td><code id="subOrigData_+3A_age_code">age_code</code></td>
<td>

<p>character string or string vector. Animal age code for data to be extracted. 
</p>
</td></tr>
<tr><td><code id="subOrigData_+3A_mask">mask</code></td>
<td>

<p>SpatVector. Polygon layer used to constrain the geographic area from which data are extracted. If not provided, global.
</p>
</td></tr>
<tr><td><code id="subOrigData_+3A_ref_scale">ref_scale</code></td>
<td>

<p>character string. Text identifier for reference scale to which all isotope values will be transformed. See <code><a href="#topic+stds">stds</a></code>. Use &ldquo;NULL&rdquo; to obtain untransformed values on the originally reported scale.</p>
</td></tr>
<tr><td><code id="subOrigData_+3A_niter">niter</code></td>
<td>

<p>integer. Number of random samples used to propagate uncertainty in calibration hierarchy transformations.
</p>
</td></tr>
<tr><td><code id="subOrigData_+3A_genplot">genplot</code></td>
<td>

<p>logical. Plot results in R.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns an object of class &ldquo;subOrigData&rdquo;, formatted for use in <code><a href="#topic+calRaster">calRaster</a></code> or <code><a href="#topic+QA">QA</a></code> functions.
</p>
<table>
<tr><td><code>data</code></td>
<td>

<p>SpatVector including one point feature for each selected sample. Data fields are described in <code><a href="#topic+knownOrig">knownOrig</a></code> feature <em>samples</em>.</p>
</td></tr>
<tr><td><code>sources</code></td>
<td>

<p>data.frame. Information for all data sources for the selected samples. Fields are described in <code><a href="#topic+knownOrig">knownOrig</a></code> feature <em>sources</em> 
</p>
</td></tr>
<tr><td><code>chains</code></td>
<td>

<p>list. Each item is a character string vector containing the hierarchy of calibrations used in the transformation for a set of selected samples. See <code><a href="#topic+stds">stds</a></code>.
</p>
</td></tr>
<tr><td><code>marker</code></td>
<td>

<p>character string. The isotopic marker specified in the call to <code>subOrigData</code>
</p>
</td></tr>
</table>


<h3>References</h3>

<p>Magozzi, S. et al. (in press) Calibration chain transformation to improve the comparability of organic hydrogen and oxygen isotope data. <em>Methods in Ecology and Evolution</em>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## WITHOUT mask
# extract d2H data for Jackdaw, Partridge and Willow Grouse, transformed
# to the VSMOW/SLAP H reference scale by default
d1 = subOrigData(taxon = c("Danaus plexippus", "Setophaga ruticilla", 
  "Turdus migratorius"), niter = 100)
summary(d1)

# extract d2H data for insects and passerine birds without transformation
d2 = subOrigData(group = c("Insect","Passerine"), ref_scale = NULL, genplot = FALSE)
summary(d2)

# extract d18O data for all humans, transformed to the VSMOW/SLAP O reference scale
d3 = subOrigData(marker = "d18O", 
  group = c("Modern human", "Indigenous human"), ref_scale = "VSMOW_O", 
  niter = 100, genplot = FALSE)
summary(d3)

# extract d2H data for humans using taxon, transformed to the VSMOW/SLAP H reference scale
d4 = subOrigData(marker = "d2H", taxon = "Homo sapiens", ref_scale = 
  "VSMOW_H", niter = 100, genplot = FALSE)
summary(d4)

## WITH mask
# error - no samples found
## Not run: d5 = subOrigData(taxon = "Turdus philomelos", mask = naMap)
# this works OK
d6 = subOrigData(taxon = c("Danaus plexippus", "Setophaga ruticilla", 
  "Turdus migratorius"), mask = naMap, genplot = FALSE)
</code></pre>

<hr>
<h2 id='unionP'>
Union probability of origin
</h2><span id='topic+unionP'></span>

<h3>Description</h3>

<p>Probabilities that at least one individual came from each location in the assignment area (union of probabilities)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>unionP(pdR)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="unionP_+3A_pdr">pdR</code></td>
<td>

<p>SpatRaster of probability density maps, e.g., as produced by <code>pdRaster</code>.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>SpatRaster.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># load hydrogen isotope data for human hair in North America
d = subOrigData(group = "Modern human", mask = naMap, genplot = FALSE)

# rescale from environmental isoscape to tissue isoscape
r = calRaster(d, d2h_lrNA, naMap, genplot = FALSE)

# four unknown-origin examples
id = c("A", "B", "C", "D")
d2H = c(-110, -90, -105, -102)
un = data.frame(id, d2H)

# posterior probabilities
pp = pdRaster(r, un, mask = naMap, genplot = FALSE)

# probability that one or more individuals are from a given location
unionP(pp)
</code></pre>

<hr>
<h2 id='wDist'>
Probability weighted distances and bearings
</h2><span id='topic+wDist'></span>

<h3>Description</h3>

<p>Calculate the distance and bearing of migration for one or more samples, weighted by probabilities from a <code>pdRaster</code> analysis. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wDist(pdR, sites, maxpts = 1e5)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="wDist_+3A_pdr">pdR</code></td>
<td>

<p>SpatRaster of n probability density maps, e.g., as produced by <code>pdRaster</code>.
</p>
</td></tr>
<tr><td><code id="wDist_+3A_sites">sites</code></td>
<td>

<p>SpatVector object containing the collection locations for the n samples represented in <code>pdR</code>.
</p>
</td></tr>
<tr><td><code id="wDist_+3A_maxpts">maxpts</code></td>
<td>

<p>numeric. Maximum number of grid cells at which to calculate bearing and distance.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>pdR</code> and <code>sites</code> must be of equal length and corresponding order. Names in the output object are taken from the names of the layers in <code>pdR</code>.
</p>
<p>Distances and bearings are calculated on the WGS84 geoid using functions from the <span class="pkg">terra</span> and <span class="pkg">geosphere</span> package. These calculations can take a long time for large rasters. If <code>maxpts</code> is less than the number of grid cells in each <code>pdR</code> layer, calculations are carried out for <code>maxpts</code> randomly selected cells.
</p>
<p>Bearing values correspond to the initial bearing from source to collection location, and are reported on a scale of -180 to +180 degrees. The statistical metrics are rectified so that values for distributions spanning due south are reported correctly. Both weighted bearing and distance distributions are often multimodal, and it is recommended to review the distribution densities to assess the representativeness of the statistics (e.g., using <code><a href="#topic+plot.wDist">plot.wDist</a></code>). 
</p>


<h3>Value</h3>

<p>Returns an object of class &ldquo;wDist&rdquo;, a list of length n. Each item contains three named objects:
</p>
<table>
<tr><td><code>stats</code></td>
<td>

<p>named number. Statistics for the distance (dist, meters) and bearing (bear, degrees) between source and collection locations, including the weighted mean (wMean) and quantile (wXX) values.</p>
</td></tr>
<tr><td><code>d.dens</code></td>
<td>

<p>density. Weighted kernel density for the distance between source and collection locations (meters). See <code><a href="stats.html#topic+density">density</a></code>. 
</p>
</td></tr>
<tr><td><code>b.dens</code></td>
<td>

<p>density. Weighted kernel density for the bearing between source and collection locations (degrees). See <code><a href="stats.html#topic+density">density</a></code>.
</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'># load hydrogen isotope data for human hair in North America
d = subOrigData(group = "Modern human", mask = naMap, genplot = FALSE)

# rescale from environmental isoscape to tissue isoscape
r = calRaster(d, d2h_lrNA, naMap, genplot = FALSE)

# four unknown-origin examples
id = c("A", "B", "C", "D")
d2H = c(-110, -90, -105, -102)
un = data.frame(id, d2H)

# posterior probabilities
pp = pdRaster(r, un, mask = naMap, genplot = FALSE)

# random collection locations
sites = d$data[sample(seq(length(d$data)), 4),]

# generate a wDist object
wd = wDist(pp, sites)

# structure of the wDist object
str(wd, 2)
</code></pre>

<hr>
<h2 id='wrld_simpl'>
data: world boundary map
</h2><span id='topic+wrld_simpl'></span>

<h3>Description</h3>

<p>Simplified spatial polygon layer representing the boundary of global continents.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wrld_simpl
</code></pre>


<h3>Format</h3>

<p>SpatVector
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(terra)

plot(wrld_simpl)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
