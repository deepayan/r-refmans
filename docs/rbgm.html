<!DOCTYPE html><html><head><title>Help for package rbgm</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {rbgm}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#rbgm-package'><p>Utilities for BGM files for Atlantis</p></a></li>
<li><a href='#bgmfile'><p>Read BGM</p></a></li>
<li><a href='#boxSpatial'><p>Convert to spatial format</p></a></li>
<li><a href='#build_dz'><p>Build Atlantis dz Values</p></a></li>
<li><a href='#nodeSpatial'><p>Vertices as Spatial points.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Tools for 'Box Geometry Model' (BGM) Files and Topology for the
Atlantis Ecosystem Model</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.2.2), raster, sp</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr, geosphere, rlang, reproj, sfheaders</td>
</tr>
<tr>
<td>Suggests:</td>
<td>bgmfiles, covr, knitr, rmarkdown, roxygen2, testthat</td>
</tr>
<tr>
<td>Description:</td>
<td>Facilities for working with Atlantis box-geometry model (BGM) 
 files. Atlantis is a deterministic, biogeochemical, whole-of-ecosystem model. 
 Functions are provided to read from BGM files directly, preserving their 
 internal topology, as well as helper functions to generate spatial data from these
 mesh forms. This functionality aims to simplify the creation and modification of box 
 and geometry as well as the ability to integrate with other data sources. </td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>ByteCompile:</td>
<td>yes</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.0</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://research.csiro.au/atlantis/">https://research.csiro.au/atlantis/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/AustralianAntarcticDivision/rbgm/issues/">https://github.com/AustralianAntarcticDivision/rbgm/issues/</a></td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-04-12 03:26:15 UTC; mdsumner</td>
</tr>
<tr>
<td>Author:</td>
<td>Michael D. Sumner [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Michael D. Sumner &lt;mdsumner@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-04-12 05:30:04 UTC</td>
</tr>
</table>
<hr>
<h2 id='rbgm-package'>Utilities for BGM files for Atlantis</h2><span id='topic+rbgm-package'></span>

<h3>Description</h3>

<p>Tools for handling network data for Atlantis from box-geometry
model (BGM) files
</p>


<h3>rbgm features</h3>


<ul>
<li><p> read .bgm files and faithfully store all information so it can be round-tripped
</p>
</li>
<li><p> conversion from .bgm forms to Spatial classes (lines and polygons)
</p>
</li>
<li><p> (not yet implemented: write to .bgm)
</p>
</li></ul>



<h3>I. Import</h3>


<table>
<tr>
 <td style="text-align: left;">
 <code><a href="#topic+bgmfile">bgmfile</a></code> </td><td style="text-align: left;"> read directly from a .bgm file  </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>II. Conversion</h3>


<table>
<tr>
 <td style="text-align: left;">
 <code><a href="#topic+boxSpatial">boxSpatial</a></code> </td><td style="text-align: left;"> convert boxes to a <code><a href="sp.html#topic+SpatialPolygonsDataFrame">SpatialPolygonsDataFrame</a></code></td>
</tr>
<tr>
 <td style="text-align: left;">
 <code><a href="#topic+faceSpatial">faceSpatial</a></code> </td><td style="text-align: left;"> convert faces to a <code><a href="sp.html#topic+SpatialLinesDataFrame">SpatialLinesDataFrame</a></code> </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code><a href="#topic+boundarySpatial">boundarySpatial</a></code> </td><td style="text-align: left;"> convert boundary to a single-row <code><a href="sp.html#topic+SpatialPolygonsDataFrame">SpatialPolygonsDataFrame</a></code></td>
</tr>
<tr>
 <td style="text-align: left;">
 <code><a href="#topic+nodeSpatial">nodeSpatial</a></code> </td><td style="text-align: left;"> obtain all vertices as points </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code><a href="#topic+pointSpatial">pointSpatial</a></code> </td><td style="text-align: left;"> obtain all instances of vertices as points </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>III. Miscellaneous</h3>


<table>
<tr>
 <td style="text-align: left;">
 <code><a href="#topic+build_dz">build_dz</a></code> </td><td style="text-align: left;"> Build Atlantis dz Values </td>
</tr>
<tr>
 <td style="text-align: left;">
 </td>
</tr>

</table>


<hr>
<h2 id='bgmfile'>Read BGM</h2><span id='topic+bgmfile'></span><span id='topic+read_bgm'></span>

<h3>Description</h3>

<p>Read geometry and full topology from BGM files.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bgmfile(x, ...)

read_bgm(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bgmfile_+3A_x">x</code></td>
<td>
<p>path to a bgm file</p>
</td></tr>
<tr><td><code id="bgmfile_+3A_...">...</code></td>
<td>
<p>ignored for now</p>
</td></tr>
</table>


<h3>Details</h3>

<p>BGM is a file format used for the 'Box Geometry Model' in the Atlantis Ecosystem Model. 
This function reads everything from the .bgm file and returns it as linked tables.
</p>


<h3>See Also</h3>

<p>See helper functions to convert the bgm tables to 'Spatial' objects, <code><a href="#topic+boxSpatial">boxSpatial</a></code>, 
<code><a href="#topic+faceSpatial">faceSpatial</a></code>, <code><a href="#topic+nodeSpatial">nodeSpatial</a></code>, <code><a href="#topic+boundarySpatial">boundarySpatial</a></code>, <code><a href="#topic+pointSpatial">pointSpatial</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(bgmfiles)
bfile &lt;- sample(bgmfiles(), 1L)
bgm &lt;- bgmfile(bfile)
str(bgm)
</code></pre>

<hr>
<h2 id='boxSpatial'>Convert to spatial format</h2><span id='topic+boxSpatial'></span><span id='topic+box_sp'></span><span id='topic+box_sf'></span><span id='topic+boundarySpatial'></span><span id='topic+boundary_sp'></span><span id='topic+boundary_sf'></span><span id='topic+node_sp'></span><span id='topic+point_sp'></span><span id='topic+faceSpatial'></span><span id='topic+face_sp'></span><span id='topic+face_sf'></span>

<h3>Description</h3>

<p>Take the output of <code><a href="#topic+bgmfile">bgmfile</a></code> and return a <code><a href="sp.html#topic+Spatial">Spatial</a></code> object 
or a sf object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>boxSpatial(bgm)

box_sp(bgm)

box_sf(bgm)

boundarySpatial(bgm)

boundary_sp(bgm)

boundary_sf(bgm)

node_sp(bgm)

point_sp(bgm)

faceSpatial(bgm)

face_sp(bgm)

face_sf(bgm)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="boxSpatial_+3A_bgm">bgm</code></td>
<td>
<p>output of a BGM file, as returned by <code><a href="#topic+bgmfile">bgmfile</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note that the '_sp' forms are aliased to original functions called '*Spatial', and 
now have '_sf' counterparts to return that format.
</p>


<h3>Value</h3>

<p>Spatial* object or sf object
</p>

<ul>
<li><p> box_sp <code><a href="sp.html#topic+SpatialPolygonsDataFrame">SpatialPolygonsDataFrame</a></code> 
</p>
</li>
<li><p> face_sp  <code><a href="sp.html#topic+SpatialLinesDataFrame">SpatialLinesDataFrame</a></code> 
</p>
</li>
<li><p> boundary_sp <code><a href="sp.html#topic+SpatialPolygonsDataFrame">SpatialPolygonsDataFrame</a></code> 
</p>
</li>
<li><p> node_sp <code><a href="sp.html#topic+SpatialPointsDataFrame">SpatialPointsDataFrame</a></code> 
</p>
</li>
<li><p> point_sp <code><a href="sp.html#topic+SpatialPointsDataFrame">SpatialPointsDataFrame</a></code> 
</p>
</li></ul>


<ul>
<li><p> box_sf <code>sf with sfc_POLYGON column</code> 
</p>
</li>
<li><p> face_sf  <code>sf with sfc_LINESTRING column</code> 
</p>
</li>
<li><p> boundary_sf <code>sf with sfc_POLYGON column</code> 
</p>
</li>
<li><p> node_sf <code>sf with sfc_POINT column</code> 
</p>
</li>
<li><p> point_sf <code>sf with sfc_POINT column</code>
</p>
</li></ul>



<h3>Warning</h3>

<p>The sf objects created by 'box_sf()', 'node_sf()', 'face_sf()', 'boundary_sf()' and
'point_sf()' were not created by the sf package. They were created with 
reference to the sf format prior to November 2019. If you have problems 
it may be necessary to recreate the 'crs' part of the of the object with code like
'x &lt;- box_sf(bgm); library(sf); st_crs(x) &lt;- st_crs(attr(x$geometry, &quot;crs&quot;)$proj)'. 
</p>
<p>Get in touch ([create an issue](https://github.com/AustralianAntarcticDivision/rbgm/issues)) if you have any troubles.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>fname &lt;- bgmfiles::bgmfiles(pattern = "antarctica_28")
bgm &lt;- bgmfile(fname)
spdf &lt;- box_sp(bgm)
sfdf &lt;- box_sf(bgm)
sldf &lt;- face_sp(bgm)

plot(spdf, col = grey(seq(0, 1, length = nrow(bgm$boxes))))
plot(sldf, col = rainbow(nrow(bgm$faces)), lwd = 2,  add = TRUE)
</code></pre>

<hr>
<h2 id='build_dz'>Build Atlantis dz Values</h2><span id='topic+build_dz'></span>

<h3>Description</h3>

<p>Build dz layer values for Atlantis from a bottom value, up through successive intervals. Each value is the positive offset required to rise
to the top of the current interval.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>build_dz(
  z,
  zlayers = c(-Inf, -2000, -1000, -750, -400, -300, -200, -100, -50, -20, 0)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="build_dz_+3A_z">z</code></td>
<td>
<p>lowermost value</p>
</td></tr>
<tr><td><code id="build_dz_+3A_zlayers">zlayers</code></td>
<td>
<p>intervals of layer values</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Offset values are returned to move from <code>z</code> against the intervals in <code>zlayers</code>. The intervals are assumed
to be sorted and increasing in value from <code>-Inf</code>inity. Once the maximum layer is reached the result is padded
by that top value.
</p>


<h3>Value</h3>

<p>numeric vector of offset values
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## sanity tests
build_dz(-5000)
build_dz(-1500)
##build_dz(300)  ## error
build_dz(0)    ## ok
## data
dd &lt;- c(-4396.49, -2100.84, -4448.81, -411.96, -2703.56, -5232.96, 
       -4176.25, -2862.37, -3795.6, -1024.64, -897.93, -1695.82, -4949.76, 
    -5264.24, -2886.81)
## all values in a matrix for checking
## [zlayers, dd]
dzvals &lt;- sapply(dd, build_dz)
## process into text
f1 &lt;- function(x) sprintf("somelabel,%i,%s", x, paste(build_dz(dd[x]), collapse = ","))
tex1 &lt;- sapply(seq(length(dd)),  f1)
## for example
f2 &lt;- function(x) {
sprintf("morelabel,%i,%s", x, paste(as.integer(build_dz(dd[x])), collapse = ","))
}
tex2 &lt;- sapply(seq(length(dd)),  f2)
</code></pre>

<hr>
<h2 id='nodeSpatial'>Vertices as Spatial points.</h2><span id='topic+nodeSpatial'></span><span id='topic+node_sf'></span><span id='topic+pointSpatial'></span><span id='topic+point_sf'></span>

<h3>Description</h3>

<p>Obtain all vertices as a <code><a href="sp.html#topic+SpatialPointsDataFrame">SpatialPointsDataFrame</a></code> or
a sf dataframe.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nodeSpatial(bgm)

node_sf(bgm)

pointSpatial(bgm)

point_sf(bgm)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nodeSpatial_+3A_bgm">bgm</code></td>
<td>
<p>BGM object from <code><a href="#topic+bgmfile">bgmfile</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Nodes are the unique coordinates (or vertices), points are the instances of
those coordinates that exist in the model. <code><a href="#topic+point_sp">point_sp</a></code> or <code><a href="#topic+point_sf">point_sf</a></code> 
return all instances of the vertices with information about which boxes they belong
to. <code><a href="#topic+node_sp">node_sp</a></code> and <code><a href="#topic+node_sf">node_sf</a></code> return all vertices.
</p>


<h3>Value</h3>

<p><code><a href="sp.html#topic+SpatialPointsDataFrame">SpatialPointsDataFrame</a></code> or sf data frame
</p>


<h3>Warning</h3>

<p>The sf objects created by 'box_sf()', 'node_sf()', 'face_sf()', 'boundary_sf()' and
'point_sf()' were not created by the sf package. They were created with 
reference to the sf format prior to November 2019. If you have problems 
it may be necessary to recreate the 'crs' part of the of the object with code like
'x &lt;- node_sf(bgm); library(sf); st_crs(x) &lt;- st_crs(attr(x$geometry, &quot;crs&quot;)$proj)'. 
</p>
<p>Get in touch ([create an issue](https://github.com/AustralianAntarcticDivision/rbgm/issues)) if you have any troubles.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>fname &lt;- bgmfiles::bgmfiles(pattern = "antarctica_28")
bgm &lt;- bgmfile(fname)
spnode &lt;- node_sp(bgm)
names(spnode)
nrow(spnode)  ## only unique vertices
nrow(bgm$vertices)

sppoints &lt;- point_sp(bgm)
names(sppoints)
nrow(sppoints)
names(point_sf(bgm))
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
