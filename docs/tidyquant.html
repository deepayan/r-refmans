<!DOCTYPE html><html><head><title>Help for package tidyquant</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {tidyquant}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#%&gt;%'><p>Pipe operator</p></a></li>
<li><a href='#av_api_key'><p>Set Alpha Vantage API Key</p></a></li>
<li><a href='#coord_x_date'><p>Zoom in on plot regions using date ranges or date-time ranges</p></a></li>
<li><a href='#deprecated'><p>Deprecated functions</p></a></li>
<li><a href='#excel_date_functions'><p>Excel Date and Time Functions</p></a></li>
<li><a href='#excel_financial_math_functions'><p>Excel Financial Math Functions</p></a></li>
<li><a href='#excel_if_functions'><p>Excel Summarising &quot;If&quot; Functions</p></a></li>
<li><a href='#excel_pivot_table'><p>Excel Pivot Table</p></a></li>
<li><a href='#excel_ref_functions'><p>Excel Reference Functions</p></a></li>
<li><a href='#excel_stat_mutation_functions'><p>Excel Statistical Mutation Functions</p></a></li>
<li><a href='#excel_stat_summary_functions'><p>Excel Statistical Summary Functions</p></a></li>
<li><a href='#FANG'><p>Stock prices for the &quot;FANG&quot; stocks.</p></a></li>
<li><a href='#geom_bbands'><p>Plot Bollinger Bands using Moving Averages</p></a></li>
<li><a href='#geom_chart'><p>Plot Financial Charts in ggplot2</p></a></li>
<li><a href='#geom_ma'><p>Plot moving averages</p></a></li>
<li><a href='#palette_tq'><p>tidyquant palettes for use with scales</p></a></li>
<li><a href='#quandl_api_key'><p>Query or set Quandl API Key</p></a></li>
<li><a href='#quandl_search'><p>Search the Quandl database</p></a></li>
<li><a href='#scale_manual'><p>tidyquant colors and fills for ggplot2.</p></a></li>
<li><a href='#theme_tq'><p>tidyquant themes for ggplot2.</p></a></li>
<li><a href='#tidyquant'><p>tidyquant: Integrating quantitative financial analysis tools with the tidyverse</p></a></li>
<li><a href='#tiingo_api_key'><p>Set Tiingo API Key</p></a></li>
<li><a href='#tq_get'><p>Get quantitative data in <code>tibble</code> format</p></a></li>
<li><a href='#tq_index'><p>Get all stocks in a stock index or stock exchange in <code>tibble</code> format</p></a></li>
<li><a href='#tq_mutate'><p>Mutates quantitative data</p></a></li>
<li><a href='#tq_performance'><p>Computes a wide variety of summary performance metrics from stock or portfolio returns</p></a></li>
<li><a href='#tq_portfolio'><p>Aggregates a group of returns by asset into portfolio returns</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Tidy Quantitative Financial Analysis</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.7</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Matt Dancho &lt;mdancho@business-science.io&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Bringing business and financial analysis to the 'tidyverse'. The 'tidyquant' 
    package provides a convenient wrapper to various 'xts', 'zoo', 'quantmod', 'TTR' 
    and 'PerformanceAnalytics' package 
    functions and returns the objects in the tidy 'tibble' format. The main 
    advantage is being able to use quantitative functions with the 'tidyverse'
    functions including 'purrr', 'dplyr', 'tidyr', 'ggplot2', 'lubridate', etc. See 
    the 'tidyquant' website for more information, documentation and examples.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/business-science/tidyquant">https://github.com/business-science/tidyquant</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/business-science/tidyquant/issues">https://github.com/business-science/tidyquant/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0), lubridate, PerformanceAnalytics, quantmod (&ge;
0.4-13)</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr (&ge; 1.0.0), ggplot2, jsonlite, httr, curl, lazyeval,
magrittr, purrr, Quandl, riingo, readr, readxl, alphavantager
(&ge; 0.1.2), stringr, tibble, tidyr (&ge; 1.0.0), timetk (&ge;
2.4.0), timeDate, TTR, xts, rlang, tidyverse, tidyselect</td>
</tr>
<tr>
<td>Suggests:</td>
<td>tibbletime, forcats, broom, knitr, rmarkdown, testthat (&ge;
2.1.0), scales, Rblpapi, covr, janitor</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-03-31 15:56:53 UTC; mdanc</td>
</tr>
<tr>
<td>Author:</td>
<td>Matt Dancho [aut, cre],
  Davis Vaughan [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-03-31 20:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='+25+26gt+3B+25'>Pipe operator</h2><span id='topic++25+3E+25'></span>

<h3>Description</h3>

<p>See <code>magrittr::<a href="magrittr.html#topic+pipe">%&gt;%</a></code> for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lhs %&gt;% rhs
</code></pre>

<hr>
<h2 id='av_api_key'>Set Alpha Vantage API Key</h2><span id='topic+av_api_key'></span>

<h3>Description</h3>

<p>Set Alpha Vantage API Key
</p>


<h3>Usage</h3>

<pre><code class='language-R'>av_api_key(api_key)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="av_api_key_+3A_api_key">api_key</code></td>
<td>
<p>Optionally passed parameter to set Alpha Vantage <code>api_key</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A wrapper for <code>alphavantager::av_api_key()</code>
</p>


<h3>Value</h3>

<p>Returns invisibly the currently set <code>api_key</code>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+tq_get">tq_get()</a></code> <code>get = "alphavantager"</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
av_api_key(api_key = "foobar")

## End(Not run)

</code></pre>

<hr>
<h2 id='coord_x_date'>Zoom in on plot regions using date ranges or date-time ranges</h2><span id='topic+coord_x_date'></span><span id='topic+coord_x_datetime'></span>

<h3>Description</h3>

<p>Zoom in on plot regions using date ranges or date-time ranges
</p>


<h3>Usage</h3>

<pre><code class='language-R'>coord_x_date(xlim = NULL, ylim = NULL, expand = TRUE)

coord_x_datetime(xlim = NULL, ylim = NULL, expand = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="coord_x_date_+3A_xlim">xlim</code></td>
<td>
<p>Limits for the x axis, entered as character dates in &quot;YYYY-MM-DD&quot;
format for date or &quot;YYYY-MM-DD HH:MM:SS&quot; for date-time.</p>
</td></tr>
<tr><td><code id="coord_x_date_+3A_ylim">ylim</code></td>
<td>
<p>Limits for the y axis, entered as values</p>
</td></tr>
<tr><td><code id="coord_x_date_+3A_expand">expand</code></td>
<td>
<p>If <code>TRUE</code>, the default, adds a small expansion factor to
the limits to ensure that data and axes don't overlap. If <code>FALSE</code>,
limits are taken exactly from the data or <code>xlim</code>/<code>ylim</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>coord_</code> functions prevent loss of data during zooming, which is
necessary when zooming in on plots that calculate <code>stats</code> using data
outside of the zoom range (e.g. when plotting moving averages
with <code><a href="#topic+geom_ma">geom_ma()</a></code>). Setting limits using <code>scale_x_date</code>
changes the underlying data which causes moving averages to fail.
</p>
<p><code>coord_x_date</code> is a wrapper for <code>coord_cartesian</code>
that enables quickly zooming in on plot regions using a date range.
</p>
<p><code>coord_x_datetime</code> is a wrapper for <code>coord_cartesian</code>
that enables quickly zooming in on plot regions using a date-time range.
</p>


<h3>See Also</h3>

<p><code><a href="ggplot2.html#topic+coord_cartesian">ggplot2::coord_cartesian()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Load libraries
library(tidyquant)
library(dplyr)
library(ggplot2)

# coord_x_date
AAPL &lt;- tq_get("AAPL", from = "2013-01-01", to = "2016-12-31")
AAPL %&gt;%
    ggplot(aes(x = date, y = adjusted)) +
    geom_line() +                         # Plot stock price
    geom_ma(n = 50) +                     # Plot 50-day Moving Average
    geom_ma(n = 200, color = "red") +     # Plot 200-day Moving Average
    # Zoom in
    coord_x_date(xlim = c("2016-01-01", "2016-12-31"))


# coord_x_datetime
time_index &lt;- seq(from = as.POSIXct("2012-05-15 07:00"),
                  to   = as.POSIXct("2012-05-17 18:00"),
                  by   = "hour")
set.seed(1)
value &lt;- rnorm(n = length(time_index))
hourly_data &lt;- tibble(time.index = time_index,
                      value      = value)
hourly_data %&gt;%
    ggplot(aes(x = time.index, y = value)) +
    geom_point() +
    coord_x_datetime(xlim = c("2012-05-15 07:00:00", "2012-05-15 16:00:00"))
</code></pre>

<hr>
<h2 id='deprecated'>Deprecated functions</h2><span id='topic+deprecated'></span><span id='topic+tq_transform'></span><span id='topic+tq_transform_xy'></span>

<h3>Description</h3>

<p>A record of functions that have been deprecated.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tq_transform(data, ohlc_fun = OHLCV, mutate_fun, col_rename = NULL, ...)

tq_transform_xy(data, x, y = NULL, mutate_fun, col_rename = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="deprecated_+3A_data">data</code></td>
<td>
<p>A <code>tibble</code> (tidy data frame) of data typically from <code><a href="#topic+tq_get">tq_get()</a></code>.</p>
</td></tr>
<tr><td><code id="deprecated_+3A_ohlc_fun">ohlc_fun</code></td>
<td>
<p>Deprecated. Use <code>select</code>.</p>
</td></tr>
<tr><td><code id="deprecated_+3A_mutate_fun">mutate_fun</code></td>
<td>
<p>The mutation function from either the <code>xts</code>,
<code>quantmod</code>, or <code>TTR</code> package. Execute <code>tq_mutate_fun_options()</code>
to see the full list of options by package.</p>
</td></tr>
<tr><td><code id="deprecated_+3A_col_rename">col_rename</code></td>
<td>
<p>A string or character vector containing names that can be used
to quickly rename columns.</p>
</td></tr>
<tr><td><code id="deprecated_+3A_...">...</code></td>
<td>
<p>Additional parameters passed to the appropriate mutatation
function.</p>
</td></tr>
<tr><td><code id="deprecated_+3A_x">x</code>, <code id="deprecated_+3A_y">y</code></td>
<td>
<p>Parameters used with <code style="white-space: pre;">&#8288;_xy&#8288;</code> that consist of column names of variables
to be passed to the mutatation function (instead of OHLC functions).</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li> <p><code>tq_transform()</code> - use <code><a href="#topic+tq_transmute">tq_transmute()</a></code>
</p>
</li>
<li> <p><code>tq_transform_xy()</code> - use <code><a href="#topic+tq_transmute_xy">tq_transmute_xy()</a></code>
</p>
</li>
<li> <p><code>as_xts()</code> - use <code><a href="timetk.html#topic+tk_xts">timetk::tk_xts()</a></code>
</p>
</li>
<li> <p><code>as_tibble()</code> - use <code><a href="timetk.html#topic+tk_tbl">timetk::tk_tbl()</a></code>
</p>
</li>
<li> <p><code>summarise_by_time()</code> - Moved to <code>timetk</code> package. Use <code><a href="timetk.html#topic+summarise_by_time">timetk::summarise_by_time()</a></code>
</p>
</li></ul>


<hr>
<h2 id='excel_date_functions'>Excel Date and Time Functions</h2><span id='topic+excel_date_functions'></span><span id='topic+AS_DATE'></span><span id='topic+AS_DATETIME'></span><span id='topic+DATE'></span><span id='topic+DATEVALUE'></span><span id='topic+YMD'></span><span id='topic+MDY'></span><span id='topic+DMY'></span><span id='topic+YMD_HMS'></span><span id='topic+MDY_HMS'></span><span id='topic+DMY_HMS'></span><span id='topic+YMD_HM'></span><span id='topic+MDY_HM'></span><span id='topic+DMY_HM'></span><span id='topic+YMD_H'></span><span id='topic+MDY_H'></span><span id='topic+DMY_H'></span><span id='topic+WEEKDAY'></span><span id='topic+WDAY'></span><span id='topic+DOW'></span><span id='topic+MONTHDAY'></span><span id='topic+MDAY'></span><span id='topic+DOM'></span><span id='topic+QUARTERDAY'></span><span id='topic+QDAY'></span><span id='topic+DAY'></span><span id='topic+WEEKNUM'></span><span id='topic+WEEK'></span><span id='topic+WEEKNUM_ISO'></span><span id='topic+MONTH'></span><span id='topic+QUARTER'></span><span id='topic+YEAR'></span><span id='topic+YEAR_ISO'></span><span id='topic+DATE_TO_NUMERIC'></span><span id='topic+DATE_TO_DECIMAL'></span><span id='topic+SECOND'></span><span id='topic+MINUTE'></span><span id='topic+HOUR'></span><span id='topic+NOW'></span><span id='topic+TODAY'></span><span id='topic+EOMONTH'></span><span id='topic+EDATE'></span><span id='topic+NET_WORKDAYS'></span><span id='topic+COUNT_DAYS'></span><span id='topic+YEARFRAC'></span><span id='topic+DATE_SEQUENCE'></span><span id='topic+WORKDAY_SEQUENCE'></span><span id='topic+HOLIDAY_SEQUENCE'></span><span id='topic+HOLIDAY_TABLE'></span><span id='topic+FLOOR_DATE'></span><span id='topic+FLOOR_DAY'></span><span id='topic+FLOOR_WEEK'></span><span id='topic+FLOOR_MONTH'></span><span id='topic+FLOOR_QUARTER'></span><span id='topic+FLOOR_YEAR'></span><span id='topic+CEILING_DATE'></span><span id='topic+CEILING_DAY'></span><span id='topic+CEILING_WEEK'></span><span id='topic+CEILING_MONTH'></span><span id='topic+CEILING_QUARTER'></span><span id='topic+CEILING_YEAR'></span><span id='topic+ROUND_DATE'></span><span id='topic+ROUND_DAY'></span><span id='topic+ROUND_WEEK'></span><span id='topic+ROUND_MONTH'></span><span id='topic+ROUND_QUARTER'></span><span id='topic+ROUND_YEAR'></span>

<h3>Description</h3>

<p>50+ date and time functions familiar to users coming from an <strong>Excel Background.</strong>
The main benefits are:
</p>

<ol>
<li><p> Integration of the amazing <code>lubridate</code> package for handling dates and times
</p>
</li>
<li><p> Integration of Holidays from <code>timeDate</code> and Business Calendars
</p>
</li>
<li><p> New Date Math and Date Sequence Functions that factor in Business Calendars (e.g. <code><a href="#topic+EOMONTH">EOMONTH()</a></code>, <code><a href="#topic+NET_WORKDAYS">NET_WORKDAYS()</a></code>)
</p>
</li></ol>

<p>These functions are designed to help users coming from an <strong>Excel background</strong>.
Most functions replicate the behavior of Excel:
</p>

<ul>
<li><p> Names in most cases match Excel function names
</p>
</li>
<li><p> Functionality replicates Excel
</p>
</li>
<li><p> By default, missing values are ignored (same as in Excel)
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>AS_DATE(x, ...)

AS_DATETIME(x, ...)

DATE(year, month, day)

DATEVALUE(x, ...)

YMD(x, ...)

MDY(x, ...)

DMY(x, ...)

YMD_HMS(x, ...)

MDY_HMS(x, ...)

DMY_HMS(x, ...)

YMD_HM(x, ...)

MDY_HM(x, ...)

DMY_HM(x, ...)

YMD_H(x, ...)

MDY_H(x, ...)

DMY_H(x, ...)

WEEKDAY(x, ..., label = FALSE, abbr = TRUE)

WDAY(x, ..., label = FALSE, abbr = TRUE)

DOW(x, ..., label = FALSE, abbr = TRUE)

MONTHDAY(x, ...)

MDAY(x, ...)

DOM(x, ...)

QUARTERDAY(x, ...)

QDAY(x, ...)

DAY(x, ...)

WEEKNUM(x, ...)

WEEK(x, ...)

WEEKNUM_ISO(x, ...)

MONTH(x, ..., label = FALSE, abbr = TRUE)

QUARTER(x, ..., include_year = FALSE, fiscal_start = 1)

YEAR(x, ...)

YEAR_ISO(x, ...)

DATE_TO_NUMERIC(x, ...)

DATE_TO_DECIMAL(x, ...)

SECOND(x, ...)

MINUTE(x, ...)

HOUR(x, ...)

NOW(...)

TODAY(...)

EOMONTH(start_date, months = 0)

EDATE(start_date, months = 0)

NET_WORKDAYS(start_date, end_date, remove_weekends = TRUE, holidays = NULL)

COUNT_DAYS(start_date, end_date)

YEARFRAC(start_date, end_date)

DATE_SEQUENCE(start_date, end_date, by = "day")

WORKDAY_SEQUENCE(start_date, end_date, remove_weekends = TRUE, holidays = NULL)

HOLIDAY_SEQUENCE(
  start_date,
  end_date,
  calendar = c("NYSE", "LONDON", "NERC", "TSX", "ZURICH")
)

HOLIDAY_TABLE(years, pattern = ".")

FLOOR_DATE(x, ..., by = "day")

FLOOR_DAY(x, ...)

FLOOR_WEEK(x, ...)

FLOOR_MONTH(x, ...)

FLOOR_QUARTER(x, ...)

FLOOR_YEAR(x, ...)

CEILING_DATE(x, ..., by = "day")

CEILING_DAY(x, ...)

CEILING_WEEK(x, ...)

CEILING_MONTH(x, ...)

CEILING_QUARTER(x, ...)

CEILING_YEAR(x, ...)

ROUND_DATE(x, ..., by = "day")

ROUND_DAY(x, ...)

ROUND_WEEK(x, ...)

ROUND_MONTH(x, ...)

ROUND_QUARTER(x, ...)

ROUND_YEAR(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="excel_date_functions_+3A_x">x</code></td>
<td>
<p>A vector of date or date-time objects</p>
</td></tr>
<tr><td><code id="excel_date_functions_+3A_...">...</code></td>
<td>
<p>Parameters passed to underlying <code>lubridate</code> functions.</p>
</td></tr>
<tr><td><code id="excel_date_functions_+3A_year">year</code></td>
<td>
<p>Used in <code><a href="#topic+DATE">DATE()</a></code></p>
</td></tr>
<tr><td><code id="excel_date_functions_+3A_month">month</code></td>
<td>
<p>Used in <code><a href="#topic+DATE">DATE()</a></code></p>
</td></tr>
<tr><td><code id="excel_date_functions_+3A_day">day</code></td>
<td>
<p>Used in <code><a href="#topic+DATE">DATE()</a></code></p>
</td></tr>
<tr><td><code id="excel_date_functions_+3A_label">label</code></td>
<td>
<p>A logical used for <code><a href="#topic+MONTH">MONTH()</a></code> and <code><a href="#topic+WEEKDAY">WEEKDAY()</a></code> Date Extractors to decide whether or not to return names
(as ordered factors) or numeric values.</p>
</td></tr>
<tr><td><code id="excel_date_functions_+3A_abbr">abbr</code></td>
<td>
<p>A logical used for <code><a href="#topic+MONTH">MONTH()</a></code> and <code><a href="#topic+WEEKDAY">WEEKDAY()</a></code>. If <code>label = TRUE</code>, used to determine if
full names (e.g. Wednesday) or abbreviated names (e.g. Wed) should be returned.</p>
</td></tr>
<tr><td><code id="excel_date_functions_+3A_include_year">include_year</code></td>
<td>
<p>A logicial value used in <code><a href="#topic+QUARTER">QUARTER()</a></code>. Determines whether or not to return 2020 Q3 as <code>3</code> or <code>2020.3</code>.</p>
</td></tr>
<tr><td><code id="excel_date_functions_+3A_fiscal_start">fiscal_start</code></td>
<td>
<p>A numeric value used in <code><a href="#topic+QUARTER">QUARTER()</a></code>. Determines the fiscal-year starting quarter.</p>
</td></tr>
<tr><td><code id="excel_date_functions_+3A_start_date">start_date</code></td>
<td>
<p>Used in Date Math and Date Sequence operations. The starting date in the calculation.</p>
</td></tr>
<tr><td><code id="excel_date_functions_+3A_months">months</code></td>
<td>
<p>Used to offset months in <code><a href="#topic+EOMONTH">EOMONTH()</a></code> AND <code><a href="#topic+EDATE">EDATE()</a></code> Date Math calculations</p>
</td></tr>
<tr><td><code id="excel_date_functions_+3A_end_date">end_date</code></td>
<td>
<p>Used in Date Math and Date Sequence operations. The ending date in the calculation.</p>
</td></tr>
<tr><td><code id="excel_date_functions_+3A_remove_weekends">remove_weekends</code></td>
<td>
<p>A logical value used in Date Sequence and Date Math calculations.
Indicates whether or not weekends should be removed from the calculation.</p>
</td></tr>
<tr><td><code id="excel_date_functions_+3A_holidays">holidays</code></td>
<td>
<p>A vector of dates corresponding to holidays that should be removed from the calculation.</p>
</td></tr>
<tr><td><code id="excel_date_functions_+3A_by">by</code></td>
<td>
<p>Used to determine the gap in Date Sequence calculations and value to round to in Date Collapsing operations.
Acceptable values are: A character string, containing one of <code>"day"</code>, <code>"week"</code>, <code>"month"</code>, <code>"quarter"</code> or <code>"year"</code>.</p>
</td></tr>
<tr><td><code id="excel_date_functions_+3A_calendar">calendar</code></td>
<td>
<p>The calendar to be used in Date Sequence calculations for Holidays from the <code>timeDate</code> package.
Acceptable values are: <code>"NYSE"</code>, <code>"LONDON"</code>, <code>"NERC"</code>, <code>"TSX"</code>, <code>"ZURICH"</code></p>
</td></tr>
<tr><td><code id="excel_date_functions_+3A_years">years</code></td>
<td>
<p>A numeric vector of years to return Holidays for in <code><a href="#topic+HOLIDAY_TABLE">HOLIDAY_TABLE()</a></code></p>
</td></tr>
<tr><td><code id="excel_date_functions_+3A_pattern">pattern</code></td>
<td>
<p>Used to filter Holidays (e.g. <code>pattern = "Easter"</code>). A &quot;regular expression&quot; filtering pattern.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Converters</strong> - Make date and date-time from text (character data)
</p>

<ul>
<li><p> General String-to-Date Conversion: <code><a href="#topic+AS_DATE">AS_DATE()</a></code>, <code><a href="#topic+AS_DATETIME">AS_DATETIME()</a></code>
</p>
</li>
<li><p> Format-Specific String-to-Date Conversion: <code><a href="#topic+YMD">YMD()</a></code> (YYYY-MM-DD), <code><a href="#topic+MDY">MDY()</a></code> (MM-DD-YYYY), <code><a href="#topic+DMY">DMY()</a></code> (DD-MM-YYYY)
</p>
</li>
<li><p> Hour-Minute-Second Conversion: <code><a href="#topic+YMD_HMS">YMD_HMS()</a></code>, <code><a href="#topic+YMD_HM">YMD_HM()</a></code>, and friends.
</p>
</li></ul>

<p><strong>Extractors</strong> - Returns information from a time-stamp.
</p>

<ul>
<li><p> Extractors: <code><a href="#topic+SECOND">SECOND()</a></code>, <code><a href="#topic+MINUTE">MINUTE()</a></code>, <code><a href="#topic+HOUR">HOUR()</a></code>, <code><a href="#topic+DAY">DAY()</a></code>, <code><a href="#topic+WEEK">WEEK()</a></code>, <code><a href="#topic+MONTH">MONTH()</a></code>, <code><a href="#topic+QUARTER">QUARTER()</a></code>, <code><a href="#topic+YEAR">YEAR()</a></code>
</p>
</li></ul>

<p><strong>Current Time</strong> - Returns the current date/date-time based on your locale.
</p>

<ul>
<li> <p><code><a href="#topic+NOW">NOW()</a></code>, <code><a href="#topic+TODAY">TODAY()</a></code>
</p>
</li></ul>

<p><strong>Date Math</strong> - Perform popular Excel date calculations
</p>

<ul>
<li> <p><code><a href="#topic+EOMONTH">EOMONTH()</a></code> - End of Month
</p>
</li>
<li> <p><code><a href="#topic+NET_WORKDAYS">NET_WORKDAYS()</a></code>, <code><a href="#topic+COUNT_DAYS">COUNT_DAYS()</a></code> - Return number of days between 2 dates factoring in working days and holidays
</p>
</li>
<li> <p><code><a href="#topic+YEARFRAC">YEARFRAC()</a></code> - Return the fractional period of the year that has been completed between 2 dates.
</p>
</li></ul>

<p><strong>Date Sequences</strong> - Return a vector of dates or a Holiday Table (<code>tibble</code>).
</p>

<ul>
<li> <p><code><a href="#topic+DATE_SEQUENCE">DATE_SEQUENCE()</a></code>, <code><a href="#topic+WORKDAY_SEQUENCE">WORKDAY_SEQUENCE()</a></code>, <a href="#topic+HOLIDAY_SEQUENCE">HOLIDAY_SEQUENCE</a> - Return a sequence of dates between 2 dates that
factor in workdays and <code>timeDate</code> holiday calendars for popular business calendars including NYSE and London stock exchange.
</p>
</li></ul>

<p><strong>Date Collapsers</strong> - Collapse a date sequence (useful in <code>dplyr::group_by()</code> and <code><a href="#topic+pivot_table">pivot_table()</a></code>)
</p>

<ul>
<li> <p><code><a href="#topic+FLOOR_DATE">FLOOR_DATE()</a></code>, <code><a href="#topic+FLOOR_DAY">FLOOR_DAY()</a></code>, <code><a href="#topic+FLOOR_WEEK">FLOOR_WEEK()</a></code>, <code><a href="#topic+FLOOR_MONTH">FLOOR_MONTH()</a></code>, <code><a href="#topic+FLOOR_QUARTER">FLOOR_QUARTER()</a></code>, <code><a href="#topic+FLOOR_YEAR">FLOOR_YEAR()</a></code>
</p>
</li>
<li><p> Similar functions exist for CEILING and ROUND. These are wrappers for <code>lubridate</code> functions.
</p>
</li></ul>



<h3>Value</h3>


<ul>
<li> <p><strong>Converters</strong> - Date or date-time object the length of x
</p>
</li>
<li> <p><strong>Extractors</strong> - Returns information from a time-stamp.
</p>
</li>
<li> <p><strong>Current Time</strong> - Returns the current date/date-time based on your locale.
</p>
</li>
<li> <p><strong>Date Math</strong> - Numeric values or Date Values depending on the calculation.
</p>
</li>
<li> <p><strong>Date Sequences</strong> - Return a vector of dates or a Holiday Table (<code>tibble</code>).
</p>
</li>
<li> <p><strong>Date Collapsers</strong> - Date or date-time object the length of x
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Libraries
library(tidyquant)
library(tidyverse)
library(lubridate)

# --- Basic Usage ----

# Converters ---
AS_DATE("2011 Jan-01") # General
YMD("2011 Jan-01")     # Year, Month-Day Format
MDY("01-02-20")        # Month-Day, Year Format (January 2nd, 2020)
DMY("01-02-20")        # Day-Month, Year Format (February 1st, 2020)

# Extractors ---
WEEKDAY("2020-01-01")                                  # Labelled Day
WEEKDAY("2020-01-01", label = FALSE)                   # Numeric Day
WEEKDAY("2020-01-01", label = FALSE, week_start = 1)   # Start at 1 (Monday) vs 7 (Sunday)
MONTH("2020-01-01")
QUARTER("2020-01-01")
YEAR("2020-01-01")

# Current Date-Time ---
NOW()
TODAY()

# Date Math ---
EOMONTH("2020-01-01")
EOMONTH("2020-01-01", months = 1)
NET_WORKDAYS("2020-01-01", "2020-07-01") # 131 Skipping Weekends
NET_WORKDAYS("2020-01-01", "2020-07-01",
             holidays = HOLIDAY_SEQUENCE("2020-01-01", "2020-07-01",
                                         calendar = "NYSE")) # 126 Skipping 5 NYSE Holidays

# Date Sequences ---
DATE_SEQUENCE("2020-01-01", "2020-07-01")
WORKDAY_SEQUENCE("2020-01-01", "2020-07-01")
HOLIDAY_SEQUENCE("2020-01-01", "2020-07-01", calendar = "NYSE")
WORKDAY_SEQUENCE("2020-01-01", "2020-07-01",
                 holidays = HOLIDAY_SEQUENCE("2020-01-01", "2020-07-01",
                                             calendar = "NYSE"))

# Date Collapsers ---
FLOOR_DATE(AS_DATE("2020-01-15"), by = "month")
CEILING_DATE(AS_DATE("2020-01-15"), by = "month")
CEILING_DATE(AS_DATE("2020-01-15"), by = "month") - ddays(1) # EOMONTH using lubridate

# --- Usage with tidyverse ---

# Calculate returns by symbol/year/quarter
FANG %&gt;%
    pivot_table(
        .rows       = c(symbol, ~ QUARTER(date)),
        .columns    = ~ YEAR(date),
        .values     = ~ PCT_CHANGE_FIRSTLAST(adjusted)
    )

</code></pre>

<hr>
<h2 id='excel_financial_math_functions'>Excel Financial Math Functions</h2><span id='topic+excel_financial_math_functions'></span><span id='topic+NPV'></span><span id='topic+IRR'></span><span id='topic+FV'></span><span id='topic+PV'></span><span id='topic+PMT'></span><span id='topic+RATE'></span>

<h3>Description</h3>

<p><strong>Excel financial math functions</strong> are designed to easily calculate Net Present Value (<code><a href="#topic+NPV">NPV()</a></code>),
Future Value of cashflow (<code><a href="#topic+FV">FV()</a></code>), Present Value of future cashflow (<code><a href="#topic+PV">PV()</a></code>), and more.
</p>
<p>These functions are designed to help users coming from an <strong>Excel background</strong>.
Most functions replicate the behavior of Excel:
</p>

<ul>
<li><p> Names are similar to Excel function names
</p>
</li>
<li><p> By default, missing values are ignored (same as in Excel)
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>NPV(cashflow, rate, nper = NULL)

IRR(cashflow)

FV(rate, nper, pv = 0, pmt = 0, type = 0)

PV(rate, nper, fv = 0, pmt = 0, type = 0)

PMT(rate, nper, pv, fv = 0, type = 0)

RATE(nper, pmt, pv, fv = 0, type = 0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="excel_financial_math_functions_+3A_cashflow">cashflow</code></td>
<td>
<p>Cash flow values. When one value is provided, it's assumed constant cash flow.</p>
</td></tr>
<tr><td><code id="excel_financial_math_functions_+3A_rate">rate</code></td>
<td>
<p>One or more rate. When one rate is provided it's assumed constant rate.</p>
</td></tr>
<tr><td><code id="excel_financial_math_functions_+3A_nper">nper</code></td>
<td>
<p>Number of periods. When 'nper&ldquo; is provided, the cashflow values and rate are assumed constant.</p>
</td></tr>
<tr><td><code id="excel_financial_math_functions_+3A_pv">pv</code></td>
<td>
<p>Present value. Initial investments (cash inflows) are typcially a negative value.</p>
</td></tr>
<tr><td><code id="excel_financial_math_functions_+3A_pmt">pmt</code></td>
<td>
<p>Number of payments per period.</p>
</td></tr>
<tr><td><code id="excel_financial_math_functions_+3A_type">type</code></td>
<td>
<p>Should payments (<code>pmt</code>) occur at the beginning (<code>type = 0</code>) or
the end (<code>type = 1</code>) of each period.</p>
</td></tr>
<tr><td><code id="excel_financial_math_functions_+3A_fv">fv</code></td>
<td>
<p>Future value. Cash outflows are typically a positive value.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Net Present Value (NPV)</strong>
Net present value (NPV) is the difference between the present value of cash inflows and
the present value of cash outflows over a period of time. NPV is used in capital budgeting
and investment planning to analyze the profitability of a projected investment or project.
For more information, see <a href="https://www.investopedia.com/terms/n/npv.asp">Investopedia NPV</a>.
</p>
<p><strong>Internal Rate of Return (IRR)</strong>
The internal rate of return (IRR) is a metric used in capital budgeting to estimate the
profitability of potential investments. The internal rate of return is a discount rate
that makes the net present value (NPV) of all cash flows from a particular project equal
to zero. IRR calculations rely on the same formula as NPV does.
For more information, see <a href="https://www.investopedia.com/terms/i/irr.asp">Investopedia IRR</a>.
</p>
<p><strong>Future Value (FV)</strong>
Future value (FV) is the value of a current asset at a future date based on an assumed
rate of growth. The future value (FV) is important to investors and financial planners
as they use it to estimate how much an investment made today will be worth in the future.
Knowing the future value enables investors to make sound investment decisions based on
their anticipated needs. However, external economic factors, such as inflation, can adversely
affect the future value of the asset by eroding its value.
For more information, see <a href="https://www.investopedia.com/terms/f/futurevalue.asp">Investopedia FV</a>.
</p>
<p><strong>Present Value (PV)</strong>
Present value (PV) is the current value of a future sum of money or stream of cash flows given a
specified rate of return. Future cash flows are discounted at the discount rate, and the higher
the discount rate, the lower the present value of the future cash flows. Determining the
appropriate discount rate is the key to properly valuing future cash flows, whether they be earnings
or obligations. For more information, see <a href="https://www.investopedia.com/terms/p/presentvalue.asp">Investopedia PV</a>.
</p>
<p><strong>Payment (PMT)</strong>
The Payment <code><a href="#topic+PMT">PMT()</a></code> function calculates the payment for a loan based on constant payments and a constant interest rate.
</p>
<p><strong>Rate (RATE)</strong>
Returns the interest rate per period of a loan or an investment.
For example, use 6%/4 for quarterly payments at 6% APR.
</p>


<h3>Value</h3>


<ul>
<li><p> Summary functions return a single value
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
NPV(c(-1000, 250, 350, 450, 450), rate = 0.05)

IRR(c(-1000, 250, 350, 450, 450))

FV(rate = 0.05, nper = 5, pv = -100, pmt = 0, type = 0)

PV(rate = 0.05, nper = 5, fv = -100, pmt = 0, type = 0)

PMT(nper = 20, rate = 0.05, pv = -100, fv = 0, type = 0)

RATE(nper = 20, pmt = 8, pv = -100, fv = 0, type = 0)

</code></pre>

<hr>
<h2 id='excel_if_functions'>Excel Summarising &quot;If&quot; Functions</h2><span id='topic+excel_if_functions'></span><span id='topic+SUM_IFS'></span><span id='topic+COUNT_IFS'></span><span id='topic+AVERAGE_IFS'></span><span id='topic+MEDIAN_IFS'></span><span id='topic+MIN_IFS'></span><span id='topic+MAX_IFS'></span><span id='topic+CREATE_IFS'></span>

<h3>Description</h3>

<p><strong>&quot;IFS&quot; functions</strong> are filtering versions of their summarization counterparts.
Simply add &quot;cases&quot; that filter if a condition is true.
Multiple cases are evaluated as &quot;AND&quot; filtering operations.
A single case with <code>|</code> (&quot;OR&quot;) bars can be created to accomplish an &quot;OR&quot;.
See details below.
</p>
<p>These functions are designed to help users coming from an <strong>Excel background</strong>.
Most functions replicate the behavior of Excel:
</p>

<ul>
<li><p> Names are similar to Excel function names
</p>
</li>
<li><p> By default, missing values are ignored (same as in Excel)
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>SUM_IFS(x, ...)

COUNT_IFS(x, ...)

AVERAGE_IFS(x, ...)

MEDIAN_IFS(x, ...)

MIN_IFS(x, ...)

MAX_IFS(x, ...)

CREATE_IFS(.f, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="excel_if_functions_+3A_x">x</code></td>
<td>
<p>A vector. Most functions are designed for numeric data.
Some functions like <code><a href="#topic+COUNT_IFS">COUNT_IFS()</a></code> handle multiple data types.</p>
</td></tr>
<tr><td><code id="excel_if_functions_+3A_...">...</code></td>
<td>
<p>Add cases to evaluate. See Details.</p>
</td></tr>
<tr><td><code id="excel_if_functions_+3A_.f">.f</code></td>
<td>
<p>A function to convert to an &quot;IFS&quot; function.
Use <code>...</code> in this case to provide parameters to the <code>.f</code> like <code>na.rm = TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>&quot;AND&quot; Filtering:</strong>
Multiple cases are evaluated as &quot;AND&quot; filtering operations.
</p>
<p><strong>&quot;OR&quot; Filtering:</strong>
Compound single cases with <code>|</code> (&quot;OR&quot;) bars can be created to accomplish an &quot;OR&quot;.
Simply use a statement like <code>x &gt; 10 | x &lt; -10</code> to perform an &quot;OR&quot; if-statement.
</p>
<p><strong>Creating New &quot;Summarizing IFS&quot; Functions:</strong>
Users can create new &quot;IFS&quot; functions using the <code><a href="#topic+CREATE_IFS">CREATE_IFS()</a></code> function factory.
The only requirement is that the output of your function (<code>.f</code>) must be a single
value (scalar). See examples below.
</p>


<h3>Value</h3>


<ul>
<li> <p><strong>Summary functions</strong> return a single value
</p>
</li></ul>



<h3>Useful Functions</h3>

<p><strong>Summary Functions</strong> - Return a single value from a vector
</p>

<ul>
<li><p> Sum: <code><a href="#topic+SUM_IFS">SUM_IFS()</a></code>
</p>
</li>
<li><p> Center: <code><a href="#topic+AVERAGE_IFS">AVERAGE_IFS()</a></code>, <code><a href="#topic+MEDIAN_IFS">MEDIAN_IFS()</a></code>
</p>
</li>
<li><p> Count: <code><a href="#topic+COUNT_IFS">COUNT_IFS()</a></code>
</p>
</li>
<li><p> Range: <code><a href="#topic+MIN_IFS">MIN_IFS()</a></code>, <code><a href="#topic+MAX_IFS">MAX_IFS()</a></code>
</p>
</li></ul>

<p><strong>Create your own summary &quot;IFS&quot; function</strong>
</p>

<ul>
<li> <p><code><a href="#topic+CREATE_IFS">CREATE_IFS()</a></code>: This is a function factory that generates summary &quot;_IFS&quot; functions.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>library(tidyverse)
library(tidyquant)
library(timetk)
library(stringr)
library(lubridate)

# --- Basic Usage ---

SUM_IFS(x = 1:10, x &gt; 5)

COUNT_IFS(x = letters, str_detect(x, "a|b|c"))

SUM_IFS(-10:10, x &gt; 8 | x &lt; -5)

# Create your own IFS function (Mind blowingly simple)!
Q75_IFS &lt;- CREATE_IFS(.f = quantile, probs = 0.75, na.rm = TRUE)
Q75_IFS(1:10, x &gt; 5)

# --- Usage with tidyverse ---

# Using multiple cases IFS cases to count the frequency of days with
# high trade volume in a given year
FANG %&gt;%
    group_by(symbol) %&gt;%
    summarise(
        high_volume_in_2015 = COUNT_IFS(volume,
                                        year(date) == 2015,
                                        volume &gt; quantile(volume, 0.75))
    )

# Count negative returns by month
FANG %&gt;%
    mutate(symbol = as_factor(symbol)) %&gt;%
    group_by(symbol) %&gt;%

    # Collapse from daily to FIRST value by month
    summarise_by_time(
        .date_var  = date,
        .by        = "month",
        adjusted   = FIRST(adjusted)
    ) %&gt;%

    # Calculate monthly returns
    group_by(symbol) %&gt;%
    mutate(
        returns = PCT_CHANGE(adjusted, fill_na = 0)
    ) %&gt;%

    # Find returns less than zero and count the frequency
    summarise(
        negative_monthly_returns = COUNT_IFS(returns, returns &lt; 0)
    )

</code></pre>

<hr>
<h2 id='excel_pivot_table'>Excel Pivot Table</h2><span id='topic+excel_pivot_table'></span><span id='topic+pivot_table'></span>

<h3>Description</h3>

<p><strong>The Pivot Table</strong> is one of Excel's most powerful features, and now it's available in <code>R</code>!
A pivot table is a table of statistics that summarizes the data of a more extensive table
(such as from a database, spreadsheet, or business intelligence program).
</p>
<p>These functions are designed to help users coming from an <strong>Excel background</strong>.
Most functions replicate the behavior of Excel:
</p>

<ul>
<li><p> Names are similar to Excel function names
</p>
</li>
<li><p> Functionality replicates Excel
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>pivot_table(
  .data,
  .rows,
  .columns,
  .values,
  .filters = NULL,
  .sort = NULL,
  fill_na = NA
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="excel_pivot_table_+3A_.data">.data</code></td>
<td>
<p>A <code>data.frame</code> or <code>tibble</code> that contains data to summarize with a pivot table</p>
</td></tr>
<tr><td><code id="excel_pivot_table_+3A_.rows">.rows</code></td>
<td>
<p>Enter one or more groups to assess as expressions (e.g. <code>~ MONTH(date_column)</code>)</p>
</td></tr>
<tr><td><code id="excel_pivot_table_+3A_.columns">.columns</code></td>
<td>
<p>Enter one or more groups to assess expressions (e.g. <code>~ YEAR(date_column)</code>)</p>
</td></tr>
<tr><td><code id="excel_pivot_table_+3A_.values">.values</code></td>
<td>
<p>Numeric only. Enter one or more summarization expression(s) (e.g. <code>~ SUM(value_column)</code>)</p>
</td></tr>
<tr><td><code id="excel_pivot_table_+3A_.filters">.filters</code></td>
<td>
<p>This argument is not yet in use</p>
</td></tr>
<tr><td><code id="excel_pivot_table_+3A_.sort">.sort</code></td>
<td>
<p>This argument is not yet in use</p>
</td></tr>
<tr><td><code id="excel_pivot_table_+3A_fill_na">fill_na</code></td>
<td>
<p>A value to replace missing values with. Default is <code>NA</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>This summary might include sums, averages, or other statistics, which the pivot table groups together in a meaningful way.
</p>
<p>The key parameters are:
</p>

<ul>
<li> <p><code>.rows</code> - These are groups that will appear as row-wise headings for the summarization, You can modify these groups by applying collapsing functions (e.g. (<code>YEAR()</code>).
</p>
</li>
<li> <p><code>.columns</code> - These are groups that will appear as column headings for the summarization. You can modify these groups by applying collapsing functions (e.g. (<code>YEAR()</code>).
</p>
</li>
<li> <p><code>.values</code> - These are numeric data that are summarized using a summary function
(e.g. <code>SUM()</code>, <code>AVERAGE()</code>, <code>COUNT()</code>, <code>FIRST()</code>, <code>LAST()</code>, <code>SUM_IFS()</code>, <code>AVERAGE_IFS()</code>, <code>COUNT_IFS()</code>)
</p>
</li></ul>

<p><strong>R implementation details.</strong>
</p>

<ul>
<li><p> The <code>pivot_table()</code> function is powered by the <code>tidyverse</code>, an ecosystem of packages designed to manipulate data.
</p>
</li>
<li><p> All of the key parameters can be expressed using a functional form:
</p>

<ul>
<li><p> Rows and Column Groupings can be collapsed. Example: <code>.columns = ~ YEAR(order_date)</code>
</p>
</li>
<li><p> Values can be summarized provided a single value is returned. Example: <code>.values = ~ SUM_IFS(order_volume &gt;= quantile(order_volume, probs = 0.75))</code>
</p>
</li>
<li><p> Summarizations and Row/Column Groupings can be stacked (combined) with <code>c()</code>. Example: <code>.rows = c(~ YEAR(order_date), company)</code>
</p>
</li>
<li><p> Bare columns (e.g. <code>company</code>) don not need to be prefixed with the <code>~</code>.
</p>
</li>
<li> <p><strong>All grouping and summarizing functions MUST BE prefixed with <code>~</code></strong>. Example: <code>.rows = ~ YEAR(order_date)</code>
</p>
</li></ul>

</li></ul>



<h3>Value</h3>

<p>Returns a tibble that has been pivoted to summarize information by column and row groupings
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(tidyquant)
library(tidyverse)

# PIVOT TABLE ----
# Calculate returns by year/quarter
FANG %&gt;%
    pivot_table(
        .rows       = c(symbol, ~ QUARTER(date)),
        .columns    = ~ YEAR(date),
        .values     = ~ PCT_CHANGE_FIRSTLAST(adjusted)
    )

</code></pre>

<hr>
<h2 id='excel_ref_functions'>Excel Reference Functions</h2><span id='topic+excel_ref_functions'></span><span id='topic+VLOOKUP'></span>

<h3>Description</h3>

<p>Excel reference functions are used to efficiently lookup values from a data source.
The most popular lookup function is &quot;VLOOKUP&quot;, which has been implemented in R.
</p>
<p>These functions are designed to help users coming from an <strong>Excel background</strong>.
Most functions replicate the behavior of Excel:
</p>

<ul>
<li><p> Names are similar to Excel function names
</p>
</li>
<li><p> Functionality replicates Excel
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>VLOOKUP(.lookup_values, .data, .lookup_column, .return_column)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="excel_ref_functions_+3A_.lookup_values">.lookup_values</code></td>
<td>
<p>One or more lookup values.</p>
</td></tr>
<tr><td><code id="excel_ref_functions_+3A_.data">.data</code></td>
<td>
<p>A <code>data.frame</code> or <code>tibble</code> that contains values to evaluate and return</p>
</td></tr>
<tr><td><code id="excel_ref_functions_+3A_.lookup_column">.lookup_column</code></td>
<td>
<p>The column in <code>.data</code> containing exact matching values of the <code>.lookup_values</code></p>
</td></tr>
<tr><td><code id="excel_ref_functions_+3A_.return_column">.return_column</code></td>
<td>
<p>The column in <code>.data</code> containing the values to return if a match is found</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong><code><a href="#topic+VLOOKUP">VLOOKUP()</a></code> Details</strong>
</p>

<ul>
<li><p> Performs exact matching only. Fuzzy matching is not implemented.
</p>
</li>
<li><p> Can only return values from one column only. Use <code>dplyr::left_join()</code> to perform table joining.
</p>
</li></ul>



<h3>Value</h3>

<p>Returns a vector the length of the input lookup values
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(tidyquant)
library(tidyverse)

lookup_table &lt;- tibble(
    stock   = c("FB", "AMZN", "NFLX", "GOOG"),
    company = c("Facebook", "Amazon", "Netflix", "Google")
)

# --- Basic Usage ---

VLOOKUP("NFLX",
        .data = lookup_table,
        .lookup_column = stock,
        .return_column = company)

# --- Usage with tidyverse ---

# Add company names to the stock data
FANG %&gt;%
    mutate(company = VLOOKUP(symbol, lookup_table, stock, company))

</code></pre>

<hr>
<h2 id='excel_stat_mutation_functions'>Excel Statistical Mutation Functions</h2><span id='topic+excel_stat_mutation_functions'></span><span id='topic+ABS'></span><span id='topic+SQRT'></span><span id='topic+LOG'></span><span id='topic+EXP'></span><span id='topic+RETURN'></span><span id='topic+PCT_CHANGE'></span><span id='topic+CHANGE'></span><span id='topic+LAG'></span><span id='topic+LEAD'></span><span id='topic+CUMULATIVE_SUM'></span><span id='topic+CUMULATIVE_PRODUCT'></span><span id='topic+CUMULATIVE_MAX'></span><span id='topic+CUMULATIVE_MIN'></span><span id='topic+CUMULATIVE_MEAN'></span><span id='topic+CUMULATIVE_MEDIAN'></span>

<h3>Description</h3>

<p>15+ common statistical functions familiar to users of Excel (e.g. <code><a href="#topic+ABS">ABS()</a></code>, <code><a href="#topic+SQRT">SQRT()</a></code>)
that <strong>modify / transform</strong> a series of values
(i.e. a vector of the same length of the input is returned).
</p>
<p>These functions are designed to help users coming from an <strong>Excel background</strong>.
Most functions replicate the behavior of Excel:
</p>

<ul>
<li><p> Names in most cases match Excel function names
</p>
</li>
<li><p> Functionality replicates Excel
</p>
</li>
<li><p> By default, missing values are ignored (same as in Excel)
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>ABS(x)

SQRT(x)

LOG(x)

EXP(x)

RETURN(x, n = 1, fill_na = NA)

PCT_CHANGE(x, n = 1, fill_na = NA)

CHANGE(x, n = 1, fill_na = NA)

LAG(x, n = 1, fill_na = NA)

LEAD(x, n = 1, fill_na = NA)

CUMULATIVE_SUM(x)

CUMULATIVE_PRODUCT(x)

CUMULATIVE_MAX(x)

CUMULATIVE_MIN(x)

CUMULATIVE_MEAN(x)

CUMULATIVE_MEDIAN(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="excel_stat_mutation_functions_+3A_x">x</code></td>
<td>
<p>A vector. Most functions are designed for numeric data.</p>
</td></tr>
<tr><td><code id="excel_stat_mutation_functions_+3A_n">n</code></td>
<td>
<p>Values to offset. Used in functions like <code><a href="#topic+LAG">LAG()</a></code>, <code><a href="#topic+LEAD">LEAD()</a></code>, and <code><a href="#topic+PCT_CHANGE">PCT_CHANGE()</a></code></p>
</td></tr>
<tr><td><code id="excel_stat_mutation_functions_+3A_fill_na">fill_na</code></td>
<td>
<p>Fill missing (<code>NA</code>) values with a different value. Used in offsetting functions.</p>
</td></tr>
</table>


<h3>Value</h3>


<ul>
<li> <p><strong>Mutation functions</strong> return a mutated / transformed version of the vector
</p>
</li></ul>



<h3>Useful functions</h3>

<p><strong>Mutation Functions</strong> - Transforms a vector
</p>

<ul>
<li><p> Transformation: <code><a href="#topic+ABS">ABS()</a></code>, <code><a href="#topic+SQRT">SQRT()</a></code>, <code><a href="#topic+LOG">LOG()</a></code>, <code><a href="#topic+EXP">EXP()</a></code>
</p>
</li>
<li><p> Lags &amp; Change (Offsetting Functions): <code><a href="#topic+CHANGE">CHANGE()</a></code>, <code><a href="#topic+PCT_CHANGE">PCT_CHANGE()</a></code>, <code><a href="#topic+LAG">LAG()</a></code>, <code><a href="#topic+LEAD">LEAD()</a></code>
</p>
</li>
<li><p> Cumulative Totals: <code><a href="#topic+CUMULATIVE_SUM">CUMULATIVE_SUM()</a></code>, <code><a href="#topic+CUMULATIVE_PRODUCT">CUMULATIVE_PRODUCT()</a></code>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Libraries
library(tidyquant)
library(timetk)
library(tidyverse)
library(forcats)

# --- Basic Usage ----

CUMULATIVE_SUM(1:10)

PCT_CHANGE(c(21, 24, 22, 25), fill_na = 0)

# --- Usage with tidyverse ---

# Go from daily to monthly periodicity,
# then calculate returns and growth of $1 USD
FANG %&gt;%
    mutate(symbol = as_factor(symbol)) %&gt;%
    group_by(symbol) %&gt;%

    # Summarization - Collapse from daily to FIRST value by month
    summarise_by_time(
        .date_var  = date,
        .by        = "month",
        adjusted   = FIRST(adjusted)
    ) %&gt;%

    # Mutation - Calculate monthly returns and cumulative growth of $1 USD
    group_by(symbol) %&gt;%
    mutate(
        returns = PCT_CHANGE(adjusted, fill_na = 0),
        growth  = CUMULATIVE_SUM(returns) + 1
    )

</code></pre>

<hr>
<h2 id='excel_stat_summary_functions'>Excel Statistical Summary Functions</h2><span id='topic+excel_stat_summary_functions'></span><span id='topic+SUM'></span><span id='topic+AVERAGE'></span><span id='topic+MEDIAN'></span><span id='topic+MIN'></span><span id='topic+MAX'></span><span id='topic+COUNT'></span><span id='topic+COUNT_UNIQUE'></span><span id='topic+STDEV'></span><span id='topic+VAR'></span><span id='topic+COR'></span><span id='topic+COV'></span><span id='topic+FIRST'></span><span id='topic+LAST'></span><span id='topic+NTH'></span><span id='topic+CHANGE_FIRSTLAST'></span><span id='topic+PCT_CHANGE_FIRSTLAST'></span>

<h3>Description</h3>

<p>15+ common statistical functions familiar to users of Excel (e.g. <code><a href="#topic+SUM">SUM()</a></code>, <code><a href="#topic+AVERAGE">AVERAGE()</a></code>).
These functions return a <strong>single value</strong> (i.e. a vector of length 1).
</p>
<p>These functions are designed to help users coming from an <strong>Excel background</strong>.
Most functions replicate the behavior of Excel:
</p>

<ul>
<li><p> Names in most cases match Excel function names
</p>
</li>
<li><p> Functionality replicates Excel
</p>
</li>
<li><p> By default, missing values are ignored (same as in Excel)
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>SUM(x)

AVERAGE(x)

MEDIAN(x)

MIN(x)

MAX(x)

COUNT(x)

COUNT_UNIQUE(x)

STDEV(x)

VAR(x)

COR(x, y)

COV(x, y)

FIRST(x)

LAST(x)

NTH(x, n = 1)

CHANGE_FIRSTLAST(x)

PCT_CHANGE_FIRSTLAST(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="excel_stat_summary_functions_+3A_x">x</code></td>
<td>
<p>A vector. Most functions are designed for numeric data.
Some functions like <code><a href="#topic+COUNT">COUNT()</a></code> handle multiple data types.</p>
</td></tr>
<tr><td><code id="excel_stat_summary_functions_+3A_y">y</code></td>
<td>
<p>A vector. Used in functions requiring 2 inputs.</p>
</td></tr>
<tr><td><code id="excel_stat_summary_functions_+3A_n">n</code></td>
<td>
<p>A single value used in <code><a href="#topic+NTH">NTH()</a></code> to select a specific element location to return.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Summary Functions</strong>
</p>

<ul>
<li><p> All functions remove missing values (<code>NA</code>). This is the same behavior as in Excel and most commonly what is desired.
</p>
</li></ul>



<h3>Value</h3>


<ul>
<li> <p><strong>Summary functions</strong> return a single value
</p>
</li></ul>



<h3>Useful functions</h3>

<p><strong>Summary Functions</strong> - Return a single value from a vector
</p>

<ul>
<li><p> Sum: <code><a href="#topic+SUM">SUM()</a></code>
</p>
</li>
<li><p> Center: <code><a href="#topic+AVERAGE">AVERAGE()</a></code>, <code><a href="#topic+MEDIAN">MEDIAN()</a></code>
</p>
</li>
<li><p> Spread: <code><a href="#topic+STDEV">STDEV()</a></code>, <code><a href="#topic+VAR">VAR()</a></code>
</p>
</li>
<li><p> Range: <code><a href="#topic+MIN">MIN()</a></code>, <code><a href="#topic+MAX">MAX()</a></code>
</p>
</li>
<li><p> Count: <code><a href="#topic+COUNT">COUNT()</a></code>, <code><a href="#topic+COUNT_UNIQUE">COUNT_UNIQUE()</a></code>
</p>
</li>
<li><p> Position: <code><a href="#topic+FIRST">FIRST()</a></code>, <code><a href="#topic+LAST">LAST()</a></code>, <code><a href="#topic+NTH">NTH()</a></code>
</p>
</li>
<li><p> Change (Summary): <code><a href="#topic+CHANGE_FIRSTLAST">CHANGE_FIRSTLAST()</a></code>, <code><a href="#topic+PCT_CHANGE_FIRSTLAST">PCT_CHANGE_FIRSTLAST()</a></code>
</p>
</li>
<li><p> Correlation: <code><a href="#topic+COR">COR()</a></code>, <code><a href="#topic+COV">COV()</a></code>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Libraries
library(tidyquant)
library(timetk)
library(tidyverse)
library(forcats)

# --- Basic Usage ----

SUM(1:10)

PCT_CHANGE_FIRSTLAST(c(21, 24, 22, 25))

# --- Usage with tidyverse ---

# Go from daily to monthly periodicity,
# then calculate returns and growth of $1 USD
FANG %&gt;%
    mutate(symbol = as_factor(symbol)) %&gt;%
    group_by(symbol) %&gt;%

    # Summarization - Collapse from daily to FIRST value by month
    summarise_by_time(
        .date_var  = date,
        .by        = "month",
        adjusted   = FIRST(adjusted)
    )

</code></pre>

<hr>
<h2 id='FANG'>Stock prices for the &quot;FANG&quot; stocks.</h2><span id='topic+FANG'></span>

<h3>Description</h3>

<p>A dataset containing the daily historical stock prices for the &quot;FANG&quot; tech stocks,
&quot;FB&quot;, &quot;AMZN&quot;, &quot;NFLX&quot;, and &quot;GOOG&quot;, spanning from the beginning of
2013 through the end of 2016.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>FANG
</code></pre>


<h3>Format</h3>

<p>A &quot;tibble&quot; (&quot;tidy&quot; data frame) with 4,032 rows and 8 variables:
</p>

<dl>
<dt>symbol</dt><dd><p>stock ticker symbol</p>
</dd>
<dt>date</dt><dd><p>trade date</p>
</dd>
<dt>open</dt><dd><p>stock price at the open of trading, in USD</p>
</dd>
<dt>high</dt><dd><p>stock price at the highest point during trading, in USD</p>
</dd>
<dt>low</dt><dd><p>stock price at the lowest point during trading, in USD</p>
</dd>
<dt>close</dt><dd><p>stock price at the close of trading, in USD</p>
</dd>
<dt>volume</dt><dd><p>number of shares traded</p>
</dd>
<dt>adjusted</dt><dd><p>stock price at the close of trading adjusted for stock splits, in USD</p>
</dd>
</dl>



<h3>Source</h3>

<p><a href="https://www.investopedia.com/terms/f/fang-stocks-fb-amzn.asp">https://www.investopedia.com/terms/f/fang-stocks-fb-amzn.asp</a>
</p>

<hr>
<h2 id='geom_bbands'>Plot Bollinger Bands using Moving Averages</h2><span id='topic+geom_bbands'></span><span id='topic+geom_bbands_'></span>

<h3>Description</h3>

<p>Bollinger Bands plot a range around a moving average typically two standard deviations up and down.
The <code>geom_bbands()</code> function enables plotting Bollinger Bands quickly using various moving average functions.
The moving average functions used are specified in <code>TTR::SMA()</code>
from the TTR package. Use <code><a href="#topic+coord_x_date">coord_x_date()</a></code> to zoom into specific plot regions.
The following moving averages are available:
</p>

<ul>
<li> <p><strong><a href="https://www.investopedia.com/terms/s/sma.asp">Simple moving averages (SMA)</a></strong>:
Rolling mean over a period defined by <code>n</code>.
</p>
</li>
<li> <p><strong><a href="https://www.investopedia.com/terms/e/ema.asp">Exponential moving averages (EMA)</a></strong>: Includes
exponentially-weighted mean that gives more weight to recent observations.
Uses <code>wilder</code> and <code>ratio</code> args.
</p>
</li>
<li> <p><strong><a href="https://www.investopedia.com/ask/answers/071414/whats-difference-between-moving-average-and-weighted-moving-average.asp">Weighted moving averages (WMA)</a></strong>:
Uses a set of weights, <code>wts</code>, to weight observations in the moving average.
</p>
</li>
<li> <p><strong><a href="https://www.investopedia.com/articles/trading/10/double-exponential-moving-average.asp">Double exponential moving averages (DEMA)</a></strong>:
Uses <code>v</code> volume factor, <code>wilder</code> and <code>ratio</code> args.
</p>
</li>
<li> <p><strong><a href="https://en.wikipedia.org/wiki/Zero_lag_exponential_moving_average">Zero-lag exponential moving averages (ZLEMA)</a></strong>:
Uses <code>wilder</code> and <code>ratio</code> args.
</p>
</li>
<li> <p><strong><a href="https://www.investopedia.com/articles/trading/11/trading-with-vwap-mvwap.asp">Volume-weighted moving averages (VWMA)</a></strong>:
Requires <code>volume</code> aesthetic.
</p>
</li>
<li> <p><strong><a href="https://www.motivewave.com/studies/elastic_volume_weighted_moving_average.htm">Elastic, volume-weighted moving averages (EVWMA)</a></strong>:
Requires <code>volume</code> aesthetic.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>geom_bbands(
  mapping = NULL,
  data = NULL,
  position = "identity",
  na.rm = TRUE,
  show.legend = NA,
  inherit.aes = TRUE,
  ma_fun = SMA,
  n = 20,
  sd = 2,
  wilder = FALSE,
  ratio = NULL,
  v = 1,
  wts = 1:n,
  color_ma = "darkblue",
  color_bands = "red",
  alpha = 0.15,
  fill = "grey20",
  ...
)

geom_bbands_(
  mapping = NULL,
  data = NULL,
  position = "identity",
  na.rm = TRUE,
  show.legend = NA,
  inherit.aes = TRUE,
  ma_fun = "SMA",
  n = 10,
  sd = 2,
  wilder = FALSE,
  ratio = NULL,
  v = 1,
  wts = 1:n,
  color_ma = "darkblue",
  color_bands = "red",
  alpha = 0.15,
  fill = "grey20",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="geom_bbands_+3A_mapping">mapping</code></td>
<td>
<p>Set of aesthetic mappings created by <code><a href="ggplot2.html#topic+aes">ggplot2::aes()</a></code> or
<code><a href="ggplot2.html#topic+aes_">ggplot2::aes_()</a></code>. If specified and <code>inherit.aes = TRUE</code> (the
default), it is combined with the default mapping at the top level of the
plot. You must supply <code>mapping</code> if there is no plot mapping.</p>
</td></tr>
<tr><td><code id="geom_bbands_+3A_data">data</code></td>
<td>
<p>The data to be displayed in this layer. There are three options:
</p>
<p>If <code>NULL</code>, the default, the data is inherited from the plot
data as specified in the call to <code><a href="ggplot2.html#topic+ggplot">ggplot2::ggplot()</a></code>.
</p>
<p>A <code>data.frame</code>, or other object, will override the plot
data. All objects will be fortified to produce a data frame. See
<code><a href="ggplot2.html#topic+fortify">ggplot2::fortify()</a></code> for which variables will be created.
</p>
<p>A <code>function</code> will be called with a single argument,
the plot data. The return value must be a <code>data.frame.</code>, and
will be used as the layer data.</p>
</td></tr>
<tr><td><code id="geom_bbands_+3A_position">position</code></td>
<td>
<p>Position adjustment, either as a string naming the adjustment
(e.g. <code>"jitter"</code> to use <code>position_jitter</code>), or the result of a call to a
position adjustment function. Use the latter if you need to change the
settings of the adjustment.</p>
</td></tr>
<tr><td><code id="geom_bbands_+3A_na.rm">na.rm</code></td>
<td>
<p>If <code>TRUE</code>, silently removes <code>NA</code> values, which
typically desired for moving averages.</p>
</td></tr>
<tr><td><code id="geom_bbands_+3A_show.legend">show.legend</code></td>
<td>
<p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.
It can also be a named logical vector to finely select the aesthetics to
display.</p>
</td></tr>
<tr><td><code id="geom_bbands_+3A_inherit.aes">inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics,
rather than combining with them. This is most useful for helper functions
that define both data and aesthetics and shouldn't inherit behaviour from
the default plot specification, e.g. <code><a href="ggplot2.html#topic+borders">ggplot2::borders()</a></code>.</p>
</td></tr>
<tr><td><code id="geom_bbands_+3A_ma_fun">ma_fun</code></td>
<td>
<p>The function used to calculate the moving average. Seven options are
available including: SMA, EMA, WMA, DEMA, ZLEMA, VWMA, and EVWMA. The default is
<code>SMA</code>. See <code>TTR::SMA()</code> for underlying functions.</p>
</td></tr>
<tr><td><code id="geom_bbands_+3A_n">n</code></td>
<td>
<p>Number of periods to average over. Must be between 1 and
<code>nrow(x)</code>, inclusive.</p>
</td></tr>
<tr><td><code id="geom_bbands_+3A_sd">sd</code></td>
<td>
<p>The number of standard deviations to use.</p>
</td></tr>
<tr><td><code id="geom_bbands_+3A_wilder">wilder</code></td>
<td>
<p>logical; if <code>TRUE</code>, a Welles Wilder type EMA will be
calculated; see notes.</p>
</td></tr>
<tr><td><code id="geom_bbands_+3A_ratio">ratio</code></td>
<td>
<p>A smoothing/decay ratio.  <code>ratio</code> overrides <code>wilder</code>
in <code>EMA</code>, and provides additional smoothing in <code>VMA</code>.</p>
</td></tr>
<tr><td><code id="geom_bbands_+3A_v">v</code></td>
<td>
<p>The 'volume factor' (a number in [0,1]).  See Notes.</p>
</td></tr>
<tr><td><code id="geom_bbands_+3A_wts">wts</code></td>
<td>
<p>Vector of weights.  Length of <code>wts</code> vector must equal the
length of <code>x</code>, or <code>n</code> (the default).</p>
</td></tr>
<tr><td><code id="geom_bbands_+3A_color_ma">color_ma</code>, <code id="geom_bbands_+3A_color_bands">color_bands</code></td>
<td>
<p>Select the line color to be applied for the moving
average line and the Bollinger band line.</p>
</td></tr>
<tr><td><code id="geom_bbands_+3A_alpha">alpha</code></td>
<td>
<p>Used to adjust the alpha transparency for the BBand ribbon.</p>
</td></tr>
<tr><td><code id="geom_bbands_+3A_fill">fill</code></td>
<td>
<p>Used to adjust the fill color for the BBand ribbon.</p>
</td></tr>
<tr><td><code id="geom_bbands_+3A_...">...</code></td>
<td>
<p>Other arguments passed on to <code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code>. These are
often aesthetics, used to set an aesthetic to a fixed value, like
<code>color = "red"</code> or <code>size = 3</code>. They may also be parameters
to the paired geom/stat.</p>
</td></tr>
</table>


<h3>Aesthetics</h3>

<p>The following aesthetics are understood (required are in bold):
</p>

<ul>
<li> <p><strong><code>x</code></strong>, Typically a date
</p>
</li>
<li> <p><strong><code>high</code></strong>, Required to be the high price
</p>
</li>
<li> <p><strong><code>low</code></strong>, Required to be the low price
</p>
</li>
<li> <p><strong><code>close</code></strong>, Required to be the close price
</p>
</li>
<li> <p><code>volume</code>, Required for VWMA and EVWMA
</p>
</li>
<li> <p><code>colour</code>, Affects line colors
</p>
</li>
<li> <p><code>fill</code>, Affects ribbon fill color
</p>
</li>
<li> <p><code>alpha</code>, Affects ribbon alpha value
</p>
</li>
<li> <p><code>group</code>
</p>
</li>
<li> <p><code>linetype</code>
</p>
</li>
<li> <p><code>size</code>
</p>
</li></ul>



<h3>See Also</h3>

<p>See individual modeling functions for underlying parameters:
</p>

<ul>
<li> <p><code>TTR::SMA()</code> for simple moving averages
</p>
</li>
<li> <p><code>TTR::EMA()</code> for exponential moving averages
</p>
</li>
<li> <p><code>TTR::WMA()</code> for weighted moving averages
</p>
</li>
<li> <p><code>TTR::DEMA()</code> for double exponential moving averages
</p>
</li>
<li> <p><code>TTR::ZLEMA()</code> for zero-lag exponential moving averages
</p>
</li>
<li> <p><code>TTR::VWMA()</code> for volume-weighted moving averages
</p>
</li>
<li> <p><code>TTR::EVWMA()</code> for elastic, volume-weighted moving averages
</p>
</li>
<li> <p><code><a href="#topic+coord_x_date">coord_x_date()</a></code> for zooming into specific regions of a plot
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Load libraries
library(tidyquant)
library(dplyr)
library(ggplot2)


AAPL &lt;- tq_get("AAPL", from = "2013-01-01", to = "2016-12-31")

# SMA
AAPL %&gt;%
    ggplot(aes(x = date, y = close)) +
    geom_line() +           # Plot stock price
    geom_bbands(aes(high = high, low = low, close = close), ma_fun = SMA, n = 50) +
    coord_x_date(xlim = c(as_date("2016-12-31") - dyears(1), as_date("2016-12-31")),
                 ylim = c(75, 125))


# EMA
AAPL %&gt;%
   ggplot(aes(x = date, y = close)) +
   geom_line() +           # Plot stock price
   geom_bbands(aes(high = high, low = low, close = close),
                  ma_fun = EMA, wilder = TRUE, ratio = NULL, n = 50) +
   coord_x_date(xlim = c(as_date("2016-12-31") - dyears(1), as_date("2016-12-31")),
                ylim = c(75, 125))


# VWMA
AAPL %&gt;%
    ggplot(aes(x = date, y = close)) +
    geom_line() +           # Plot stock price
    geom_bbands(aes(high = high, low = low, close = close, volume = volume),
                   ma_fun = VWMA, n = 50) +
    coord_x_date(xlim = c(as_date("2016-12-31") - dyears(1), as_date("2016-12-31")),
                ylim = c(75, 125))
</code></pre>

<hr>
<h2 id='geom_chart'>Plot Financial Charts in ggplot2</h2><span id='topic+geom_chart'></span><span id='topic+geom_barchart'></span><span id='topic+geom_candlestick'></span>

<h3>Description</h3>

<p>Financial charts provide visual cues to open, high, low, and close prices.
Use <code><a href="#topic+coord_x_date">coord_x_date()</a></code> to zoom into specific plot regions.
The following financial chart geoms are available:
</p>

<ul>
<li> <p><strong><a href="https://www.investopedia.com/terms/b/barchart.asp">Bar Chart</a></strong>
</p>
</li>
<li> <p><strong><a href="https://www.investopedia.com/terms/c/candlestick.asp">Candlestick Chart</a></strong>
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>geom_barchart(
  mapping = NULL,
  data = NULL,
  stat = "identity",
  position = "identity",
  na.rm = TRUE,
  show.legend = NA,
  inherit.aes = TRUE,
  colour_up = "darkblue",
  colour_down = "red",
  fill_up = "darkblue",
  fill_down = "red",
  ...
)

geom_candlestick(
  mapping = NULL,
  data = NULL,
  stat = "identity",
  position = "identity",
  na.rm = TRUE,
  show.legend = NA,
  inherit.aes = TRUE,
  colour_up = "darkblue",
  colour_down = "red",
  fill_up = "darkblue",
  fill_down = "red",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="geom_chart_+3A_mapping">mapping</code></td>
<td>
<p>Set of aesthetic mappings created by <code><a href="ggplot2.html#topic+aes">ggplot2::aes()</a></code> or
<code><a href="ggplot2.html#topic+aes_">ggplot2::aes_()</a></code>. If specified and <code>inherit.aes = TRUE</code> (the
default), it is combined with the default mapping at the top level of the
plot. You must supply <code>mapping</code> if there is no plot mapping.</p>
</td></tr>
<tr><td><code id="geom_chart_+3A_data">data</code></td>
<td>
<p>The data to be displayed in this layer. There are three options:
</p>
<p>If <code>NULL</code>, the default, the data is inherited from the plot
data as specified in the call to <code><a href="ggplot2.html#topic+ggplot">ggplot2::ggplot()</a></code>.
</p>
<p>A <code>data.frame</code>, or other object, will override the plot
data. All objects will be fortified to produce a data frame. See
<code><a href="ggplot2.html#topic+fortify">ggplot2::fortify()</a></code> for which variables will be created.
</p>
<p>A <code>function</code> will be called with a single argument,
the plot data. The return value must be a <code>data.frame.</code>, and
will be used as the layer data.</p>
</td></tr>
<tr><td><code id="geom_chart_+3A_stat">stat</code></td>
<td>
<p>The statistical transformation to use on the data for this
layer, either as a <code>ggproto</code> <code>Geom</code> subclass or as a string naming the
stat stripped of the <code>stat_</code> prefix (e.g. <code>"count"</code> rather than
<code>"stat_count"</code>)</p>
</td></tr>
<tr><td><code id="geom_chart_+3A_position">position</code></td>
<td>
<p>Position adjustment, either as a string naming the adjustment
(e.g. <code>"jitter"</code> to use <code>position_jitter</code>), or the result of a call to a
position adjustment function. Use the latter if you need to change the
settings of the adjustment.</p>
</td></tr>
<tr><td><code id="geom_chart_+3A_na.rm">na.rm</code></td>
<td>
<p>If <code>TRUE</code>, silently removes <code>NA</code> values, which
typically desired for moving averages.</p>
</td></tr>
<tr><td><code id="geom_chart_+3A_show.legend">show.legend</code></td>
<td>
<p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.
It can also be a named logical vector to finely select the aesthetics to
display.</p>
</td></tr>
<tr><td><code id="geom_chart_+3A_inherit.aes">inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics,
rather than combining with them. This is most useful for helper functions
that define both data and aesthetics and shouldn't inherit behaviour from
the default plot specification, e.g. <code><a href="ggplot2.html#topic+borders">ggplot2::borders()</a></code>.</p>
</td></tr>
<tr><td><code id="geom_chart_+3A_colour_up">colour_up</code>, <code id="geom_chart_+3A_colour_down">colour_down</code></td>
<td>
<p>Select colors to be applied based on price movement
from open to close. If close &gt;= open, <code>colour_up</code> is used. Otherwise,
<code>colour_down</code> is used. The default is &quot;darkblue&quot; and &quot;red&quot;, respectively.</p>
</td></tr>
<tr><td><code id="geom_chart_+3A_fill_up">fill_up</code>, <code id="geom_chart_+3A_fill_down">fill_down</code></td>
<td>
<p>Select fills to be applied based on price movement
from open to close. If close &gt;= open, <code>fill_up</code> is used. Otherwise,
<code>fill_down</code> is used. The default is &quot;darkblue&quot; and &quot;red&quot;, respectively.
Only affects <code>geom_candlestick</code>.</p>
</td></tr>
<tr><td><code id="geom_chart_+3A_...">...</code></td>
<td>
<p>Other arguments passed on to <code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code>. These are
often aesthetics, used to set an aesthetic to a fixed value, like
<code>color = "red"</code> or <code>size = 3</code>. They may also be parameters
to the paired geom/stat.</p>
</td></tr>
</table>


<h3>Aesthetics</h3>

<p>The following aesthetics are understood (required are in bold):
</p>

<ul>
<li> <p><strong><code>x</code></strong>, Typically a date
</p>
</li>
<li> <p><strong><code>open</code></strong>, Required to be the open price
</p>
</li>
<li> <p><strong><code>high</code></strong>, Required to be the high price
</p>
</li>
<li> <p><strong><code>low</code></strong>, Required to be the low price
</p>
</li>
<li> <p><strong><code>close</code></strong>, Required to be the close price
</p>
</li>
<li> <p><code>alpha</code>
</p>
</li>
<li> <p><code>group</code>
</p>
</li>
<li> <p><code>linetype</code>
</p>
</li>
<li> <p><code>size</code>
</p>
</li></ul>



<h3>See Also</h3>

<p>See individual modeling functions for underlying parameters:
</p>

<ul>
<li> <p><code><a href="#topic+geom_ma">geom_ma()</a></code> for adding moving averages to ggplots
</p>
</li>
<li> <p><code><a href="#topic+geom_bbands">geom_bbands()</a></code> for adding Bollinger Bands to ggplots
</p>
</li>
<li> <p><code><a href="#topic+coord_x_date">coord_x_date()</a></code> for zooming into specific regions of a plot
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Load libraries
library(tidyquant)
library(dplyr)
library(ggplot2)

AAPL &lt;- tq_get("AAPL", from = "2013-01-01", to = "2016-12-31")

# Bar Chart
AAPL %&gt;%
    ggplot(aes(x = date, y = close)) +
    geom_barchart(aes(open = open, high = high, low = low, close = close)) +
    geom_ma(color = "darkgreen") +
    coord_x_date(xlim = c("2016-01-01", "2016-12-31"),
                 ylim = c(75, 125))

# Candlestick Chart
AAPL %&gt;%
    ggplot(aes(x = date, y = close)) +
    geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
    geom_ma(color = "darkgreen") +
    coord_x_date(xlim = c("2016-01-01", "2016-12-31"),
                 ylim = c(75, 125))
</code></pre>

<hr>
<h2 id='geom_ma'>Plot moving averages</h2><span id='topic+geom_ma'></span><span id='topic+geom_ma_'></span>

<h3>Description</h3>

<p>The underlying moving average functions used are specified in <code>TTR::SMA()</code>
from the TTR package. Use <code><a href="#topic+coord_x_date">coord_x_date()</a></code> to zoom into specific plot regions.
The following moving averages are available:
</p>

<ul>
<li> <p><strong><a href="https://www.investopedia.com/terms/s/sma.asp">Simple moving averages (SMA)</a></strong>:
Rolling mean over a period defined by <code>n</code>.
</p>
</li>
<li> <p><strong><a href="https://www.investopedia.com/terms/e/ema.asp">Exponential moving averages (EMA)</a></strong>: Includes
exponentially-weighted mean that gives more weight to recent observations.
Uses <code>wilder</code> and <code>ratio</code> args.
</p>
</li>
<li> <p><strong><a href="https://www.investopedia.com/ask/answers/071414/whats-difference-between-moving-average-and-weighted-moving-average.asp">Weighted moving averages (WMA)</a></strong>:
Uses a set of weights, <code>wts</code>, to weight observations in the moving average.
</p>
</li>
<li> <p><strong><a href="https://www.investopedia.com/articles/trading/10/double-exponential-moving-average.asp">Double exponential moving averages (DEMA)</a></strong>:
Uses <code>v</code> volume factor, <code>wilder</code> and <code>ratio</code> args.
</p>
</li>
<li> <p><strong><a href="https://en.wikipedia.org/wiki/Zero_lag_exponential_moving_average">Zero-lag exponential moving averages (ZLEMA)</a></strong>:
Uses <code>wilder</code> and <code>ratio</code> args.
</p>
</li>
<li> <p><strong><a href="https://www.investopedia.com/articles/trading/11/trading-with-vwap-mvwap.asp">Volume-weighted moving averages (VWMA)</a></strong>:
Requires <code>volume</code> aesthetic.
</p>
</li>
<li> <p><strong><a href="https://www.motivewave.com/studies/elastic_volume_weighted_moving_average.htm">Elastic, volume-weighted moving averages (EVWMA)</a></strong>:
Requires <code>volume</code> aesthetic.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>geom_ma(
  mapping = NULL,
  data = NULL,
  position = "identity",
  na.rm = TRUE,
  show.legend = NA,
  inherit.aes = TRUE,
  ma_fun = SMA,
  n = 20,
  wilder = FALSE,
  ratio = NULL,
  v = 1,
  wts = 1:n,
  ...
)

geom_ma_(
  mapping = NULL,
  data = NULL,
  position = "identity",
  na.rm = TRUE,
  show.legend = NA,
  inherit.aes = TRUE,
  ma_fun = "SMA",
  n = 20,
  wilder = FALSE,
  ratio = NULL,
  v = 1,
  wts = 1:n,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="geom_ma_+3A_mapping">mapping</code></td>
<td>
<p>Set of aesthetic mappings created by <code><a href="ggplot2.html#topic+aes">ggplot2::aes()</a></code> or
<code><a href="ggplot2.html#topic+aes_">ggplot2::aes_()</a></code>. If specified and <code>inherit.aes = TRUE</code> (the
default), it is combined with the default mapping at the top level of the
plot. You must supply <code>mapping</code> if there is no plot mapping.</p>
</td></tr>
<tr><td><code id="geom_ma_+3A_data">data</code></td>
<td>
<p>The data to be displayed in this layer. There are three options:
</p>
<p>If <code>NULL</code>, the default, the data is inherited from the plot
data as specified in the call to <code><a href="ggplot2.html#topic+ggplot">ggplot2::ggplot()</a></code>.
</p>
<p>A <code>data.frame</code>, or other object, will override the plot
data. All objects will be fortified to produce a data frame. See
<code><a href="ggplot2.html#topic+fortify">ggplot2::fortify()</a></code> for which variables will be created.
</p>
<p>A <code>function</code> will be called with a single argument,
the plot data. The return value must be a <code>data.frame.</code>, and
will be used as the layer data.</p>
</td></tr>
<tr><td><code id="geom_ma_+3A_position">position</code></td>
<td>
<p>Position adjustment, either as a string naming the adjustment
(e.g. <code>"jitter"</code> to use <code>position_jitter</code>), or the result of a call to a
position adjustment function. Use the latter if you need to change the
settings of the adjustment.</p>
</td></tr>
<tr><td><code id="geom_ma_+3A_na.rm">na.rm</code></td>
<td>
<p>If <code>TRUE</code>, silently removes <code>NA</code> values, which
typically desired for moving averages.</p>
</td></tr>
<tr><td><code id="geom_ma_+3A_show.legend">show.legend</code></td>
<td>
<p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.
It can also be a named logical vector to finely select the aesthetics to
display.</p>
</td></tr>
<tr><td><code id="geom_ma_+3A_inherit.aes">inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics,
rather than combining with them. This is most useful for helper functions
that define both data and aesthetics and shouldn't inherit behaviour from
the default plot specification, e.g. <code><a href="ggplot2.html#topic+borders">ggplot2::borders()</a></code>.</p>
</td></tr>
<tr><td><code id="geom_ma_+3A_ma_fun">ma_fun</code></td>
<td>
<p>The function used to calculate the moving average. Seven options are
available including: SMA, EMA, WMA, DEMA, ZLEMA, VWMA, and EVWMA. The default is
<code>SMA</code>. See <code>TTR::SMA()</code> for underlying functions.</p>
</td></tr>
<tr><td><code id="geom_ma_+3A_n">n</code></td>
<td>
<p>Number of periods to average over. Must be between 1 and
<code>nrow(x)</code>, inclusive.</p>
</td></tr>
<tr><td><code id="geom_ma_+3A_wilder">wilder</code></td>
<td>
<p>logical; if <code>TRUE</code>, a Welles Wilder type EMA will be
calculated; see notes.</p>
</td></tr>
<tr><td><code id="geom_ma_+3A_ratio">ratio</code></td>
<td>
<p>A smoothing/decay ratio.  <code>ratio</code> overrides <code>wilder</code>
in <code>EMA</code>, and provides additional smoothing in <code>VMA</code>.</p>
</td></tr>
<tr><td><code id="geom_ma_+3A_v">v</code></td>
<td>
<p>The 'volume factor' (a number in [0,1]).  See Notes.</p>
</td></tr>
<tr><td><code id="geom_ma_+3A_wts">wts</code></td>
<td>
<p>Vector of weights.  Length of <code>wts</code> vector must equal the
length of <code>x</code>, or <code>n</code> (the default).</p>
</td></tr>
<tr><td><code id="geom_ma_+3A_...">...</code></td>
<td>
<p>Other arguments passed on to <code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code>. These are
often aesthetics, used to set an aesthetic to a fixed value, like
<code>color = "red"</code> or <code>size = 3</code>. They may also be parameters
to the paired geom/stat.</p>
</td></tr>
</table>


<h3>Aesthetics</h3>

<p>The following aesthetics are understood (required are in bold):
</p>

<ul>
<li> <p><strong><code>x</code></strong>
</p>
</li>
<li> <p><strong><code>y</code></strong>
</p>
</li>
<li> <p><code>volume</code>, Required for VWMA and EVWMA
</p>
</li>
<li> <p><code>alpha</code>
</p>
</li>
<li> <p><code>colour</code>
</p>
</li>
<li> <p><code>group</code>
</p>
</li>
<li> <p><code>linetype</code>
</p>
</li>
<li> <p><code>size</code>
</p>
</li></ul>



<h3>See Also</h3>

<p>See individual modeling functions for underlying parameters:
</p>

<ul>
<li> <p><code>TTR::SMA()</code> for simple moving averages
</p>
</li>
<li> <p><code>TTR::EMA()</code> for exponential moving averages
</p>
</li>
<li> <p><code>TTR::WMA()</code> for weighted moving averages
</p>
</li>
<li> <p><code>TTR::DEMA()</code> for double exponential moving averages
</p>
</li>
<li> <p><code>TTR::ZLEMA()</code> for zero-lag exponential moving averages
</p>
</li>
<li> <p><code>TTR::VWMA()</code> for volume-weighted moving averages
</p>
</li>
<li> <p><code>TTR::EVWMA()</code> for elastic, volume-weighted moving averages
</p>
</li>
<li> <p><code><a href="#topic+coord_x_date">coord_x_date()</a></code> for zooming into specific regions of a plot
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Load libraries
library(tidyquant)
library(dplyr)
library(ggplot2)

AAPL &lt;- tq_get("AAPL", from = "2013-01-01", to = "2016-12-31")

# SMA
AAPL %&gt;%
    ggplot(aes(x = date, y = adjusted)) +
    geom_line() +                         # Plot stock price
    geom_ma(ma_fun = SMA, n = 50) +                 # Plot 50-day SMA
    geom_ma(ma_fun = SMA, n = 200, color = "red") + # Plot 200-day SMA
    coord_x_date(xlim = c("2016-01-01", "2016-12-31"),
                 ylim = c(75, 125))                     # Zoom in

# EVWMA
AAPL %&gt;%
    ggplot(aes(x = date, y = adjusted)) +
    geom_line() +                                                   # Plot stock price
    geom_ma(aes(volume = volume), ma_fun = EVWMA, n = 50) +   # Plot 50-day EVWMA
    coord_x_date(xlim = c("2016-01-01", "2016-12-31"),
                 ylim = c(75, 125))                                  # Zoom in
</code></pre>

<hr>
<h2 id='palette_tq'>tidyquant palettes for use with scales</h2><span id='topic+palette_tq'></span><span id='topic+palette_light'></span><span id='topic+palette_dark'></span><span id='topic+palette_green'></span>

<h3>Description</h3>

<p>These palettes are mainly called internally by tidyquant <code style="white-space: pre;">&#8288;scale_*_tq()&#8288;</code> functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>palette_light()

palette_dark()

palette_green()
</code></pre>


<h3>Examples</h3>

<pre><code class='language-R'>library(scales)
scales::show_col(palette_light())

</code></pre>

<hr>
<h2 id='quandl_api_key'>Query or set Quandl API Key</h2><span id='topic+quandl_api_key'></span>

<h3>Description</h3>

<p>Query or set Quandl API Key
</p>


<h3>Usage</h3>

<pre><code class='language-R'>quandl_api_key(api_key)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="quandl_api_key_+3A_api_key">api_key</code></td>
<td>
<p>Optionally passed parameter to set Quandl <code>api_key</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A wrapper for <code>Quandl::Quandl.api_key()</code>
</p>


<h3>Value</h3>

<p>Returns invisibly the currently set <code>api_key</code>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+tq_get">tq_get()</a></code> <code>get = "quandl"</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
quandl_api_key(api_key = "foobar")

## End(Not run)
</code></pre>

<hr>
<h2 id='quandl_search'>Search the Quandl database</h2><span id='topic+quandl_search'></span>

<h3>Description</h3>

<p>Search the Quandl database
</p>


<h3>Usage</h3>

<pre><code class='language-R'>quandl_search(query, silent = FALSE, per_page = 10, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="quandl_search_+3A_query">query</code></td>
<td>
<p>Search terms</p>
</td></tr>
<tr><td><code id="quandl_search_+3A_silent">silent</code></td>
<td>
<p>Prints the results when FALSE.</p>
</td></tr>
<tr><td><code id="quandl_search_+3A_per_page">per_page</code></td>
<td>
<p>Number of results returned per page.</p>
</td></tr>
<tr><td><code id="quandl_search_+3A_...">...</code></td>
<td>
<p>Additional named values that are interpretted as Quandl API parameters.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A wrapper for <code>Quandl::Quandl.search()</code>
</p>


<h3>Value</h3>

<p>Returns a tibble with search results.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+tq_get">tq_get()</a></code> <code>get = "quandl"</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
quandl_search(query = "oil")

## End(Not run)
</code></pre>

<hr>
<h2 id='scale_manual'>tidyquant colors and fills for ggplot2.</h2><span id='topic+scale_manual'></span><span id='topic+scale_color_tq'></span><span id='topic+scale_colour_tq'></span><span id='topic+scale_fill_tq'></span>

<h3>Description</h3>

<p>The tidyquant scales add colors that work nicely with <code>theme_tq()</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>scale_color_tq(..., theme = "light")

scale_colour_tq(..., theme = "light")

scale_fill_tq(..., theme = "light")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="scale_manual_+3A_...">...</code></td>
<td>
<p>common discrete scale parameters: <code>name</code>, <code>breaks</code>, <code>labels</code>, <code>na.value</code>, <code>limits</code> and <code>guide</code>. See <code><a href="ggplot2.html#topic+discrete_scale">discrete_scale()</a></code> for more details</p>
</td></tr>
<tr><td><code id="scale_manual_+3A_theme">theme</code></td>
<td>
<p>one of &quot;light&quot;, &quot;dark&quot;, or &quot;green&quot;. This should match the <code>theme_tq()</code> that is used with it.</p>
</td></tr>
</table>


<h3>Details</h3>


<dl>
<dt><code>scale_color_tq</code></dt><dd>
<p>For use when <code>color</code> is specified as an <code>aes()</code> in a ggplot.</p>
</dd>
<dt><code>scale_fill_tq</code></dt><dd>
<p>For use when <code>fill</code> is specified as an <code>aes()</code> in a ggplot.</p>
</dd>
</dl>



<h3>See Also</h3>

<p><code><a href="#topic+theme_tq">theme_tq()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Load libraries
library(tidyquant)
library(dplyr)
library(ggplot2)

# Get stock prices
stocks &lt;- c("AAPL", "FB", "NFLX") %&gt;%
    tq_get(from = "2013-01-01",
           to   = "2017-01-01")

# Plot for stocks
g &lt;- stocks %&gt;%
    ggplot(aes(date, adjusted, color = symbol)) +
    geom_line() +
    labs(title = "Multi stock example",
         xlab = "Date",
         ylab = "Adjusted Close")

# Plot with tidyquant theme and colors
g +
    theme_tq() +
    scale_color_tq()


</code></pre>

<hr>
<h2 id='theme_tq'>tidyquant themes for ggplot2.</h2><span id='topic+theme_tq'></span><span id='topic+theme_tq_dark'></span><span id='topic+theme_tq_green'></span>

<h3>Description</h3>

<p>The <code>theme_tq()</code> function creates a custom theme using tidyquant colors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>theme_tq(base_size = 11, base_family = "")

theme_tq_dark(base_size = 11, base_family = "")

theme_tq_green(base_size = 11, base_family = "")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="theme_tq_+3A_base_size">base_size</code></td>
<td>
<p>base font size, given in pts.</p>
</td></tr>
<tr><td><code id="theme_tq_+3A_base_family">base_family</code></td>
<td>
<p>base font family</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+scale_manual">scale_manual()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Load libraries
library(tidyquant)
library(dplyr)
library(ggplot2)

# Get stock prices
AAPL &lt;- tq_get("AAPL", from = "2013-01-01", to = "2016-12-31")

# Plot using ggplot with theme_tq
AAPL %&gt;% ggplot(aes(x = date, y = close)) +
       geom_line() +
       geom_bbands(aes(high = high, low = low, close = close),
                   ma_fun = EMA,
                   wilder = TRUE,
                   ratio = NULL,
                   n = 50) +
       coord_x_date(xlim = c("2016-01-01", "2016-12-31"),
                 ylim = c(75, 125)) +
       labs(title = "Apple BBands",
            x = "Date",
            y = "Price") +
       theme_tq()

</code></pre>

<hr>
<h2 id='tidyquant'>tidyquant: Integrating quantitative financial analysis tools with the tidyverse</h2><span id='topic+tidyquant'></span>

<h3>Description</h3>

<p>The main advantage of <code>tidyquant</code> is to
bridge the gap between the best quantitative resources for collecting and
manipulating quantitative data, <code>xts</code>, <code>quantmod</code> and <code>TTR</code>,
and the data modeling workflow and infrastructure of the <code>tidyverse</code>.
</p>


<h3>Details</h3>

<p>In this package, <code>tidyquant</code> functions and supporting data sets are
provided to seamlessly combine tidy tools with existing quantitative
analytics packages. The main advantage is being able to use tidy
functions with purrr for mapping and tidyr for nesting to extend modeling to
many stocks. See the tidyquant website for more information, documentation
and examples.
</p>
<p>Users will probably be interested in the following:
</p>

<ul>
<li> <p><strong>Getting Data from the Web:</strong> <code><a href="#topic+tq_get">tq_get()</a></code>
</p>
</li>
<li> <p><strong>Manipulating Data:</strong> <code><a href="#topic+tq_transmute">tq_transmute()</a></code> and <code><a href="#topic+tq_mutate">tq_mutate()</a></code>
</p>
</li>
<li> <p><strong>Performance Analysis and Portfolio Aggregation:</strong>
<code><a href="#topic+tq_performance">tq_performance()</a></code> and <code><a href="#topic+tq_portfolio">tq_portfolio()</a></code>
</p>
</li></ul>

<p>To learn more about tidyquant, start with the vignettes:
<code>browseVignettes(package = "tidyquant")</code>
</p>

<hr>
<h2 id='tiingo_api_key'>Set Tiingo API Key</h2><span id='topic+tiingo_api_key'></span>

<h3>Description</h3>

<p>Set Tiingo API Key
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tiingo_api_key(api_key)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tiingo_api_key_+3A_api_key">api_key</code></td>
<td>
<p>Optionally passed parameter to set Tiingo <code>api_key</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A wrapper for <code>riingo::ringo_set_token()</code>
</p>


<h3>Value</h3>

<p>Returns invisibly the currently set <code>api_key</code>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+tq_get">tq_get()</a></code> <code>get = "tiingo"</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
tiingo_api_key(api_key = "foobar")

## End(Not run)

</code></pre>

<hr>
<h2 id='tq_get'>Get quantitative data in <code>tibble</code> format</h2><span id='topic+tq_get'></span><span id='topic+tq_get_options'></span>

<h3>Description</h3>

<p>Get quantitative data in <code>tibble</code> format
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tq_get(x, get = "stock.prices", complete_cases = TRUE, ...)

tq_get_options()
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tq_get_+3A_x">x</code></td>
<td>
<p>A single character string, a character vector or tibble representing a single (or multiple)
stock symbol, metal symbol, currency combination, FRED code, etc.</p>
</td></tr>
<tr><td><code id="tq_get_+3A_get">get</code></td>
<td>
<p>A character string representing the type of data to get
for <code>x</code>. Options include:
</p>

<ul>
<li> <p><code>"stock.prices"</code>: Get the open, high, low, close, volume and adjusted
stock prices for a stock symbol from
Yahoo Finance (https://finance.yahoo.com/). Wrapper for <code>quantmod::getSymbols()</code>.
</p>
</li>
<li> <p><code>"dividends"</code>: Get the dividends for a stock symbol from
Yahoo Finance (https://finance.yahoo.com/). Wrapper for <code>quantmod::getDividends()</code>.
</p>
</li>
<li> <p><code>"splits"</code>: Get the split ratio for a stock symbol from
Yahoo Finance (https://finance.yahoo.com/). Wrapper for <code>quantmod::getSplits()</code>.
</p>
</li>
<li> <p><code>"stock.prices.japan"</code>: Get the open, high, low, close, volume and adjusted
stock prices for a stock symbol from
Yahoo Finance Japan (https://finance.yahoo.co.jp/). Wrapper for <code>quantmod::getSymbols.yahooj()</code>.
</p>
</li>
<li> <p><code>"economic.data"</code>: Get economic data from
<a href="https://fred.stlouisfed.org/">FRED</a>. rapper for <code>quantmod::getSymbols.FRED()</code>.
</p>
</li>
<li> <p><code>"quandl"</code>: Get data sets from
<a href="https://data.nasdaq.com/">Quandl</a>. Wrapper for <code>Quandl::Quandl()</code>.
See also <code><a href="#topic+quandl_api_key">quandl_api_key()</a></code>.
</p>
</li>
<li> <p><code>"quandl.datatable"</code>: Get data tables from
<a href="https://data.nasdaq.com/">Quandl</a>. Wrapper for <code>Quandl::Quandl.datatable()</code>.
See also <code><a href="#topic+quandl_api_key">quandl_api_key()</a></code>.
</p>
</li>
<li> <p><code>"tiingo"</code>: Get data sets from
<a href="https://api.tiingo.com/">Tiingo</a>. Wrapper for <code>riingo::riingo_prices()</code>.
See also <code><a href="#topic+tiingo_api_key">tiingo_api_key()</a></code>.
</p>
</li>
<li> <p><code>"tiingo.iex"</code>: Get data sets from
<a href="https://api.tiingo.com/">Tiingo</a>. Wrapper for <code>riingo::riingo_iex_prices()</code>.
See also <code><a href="#topic+tiingo_api_key">tiingo_api_key()</a></code>.
</p>
</li>
<li> <p><code>"tiingo.crypto"</code>: Get data sets from
<a href="https://api.tiingo.com/">Tiingo</a>. Wrapper for <code>riingo::riingo_crypto_prices()</code>.
See also <code><a href="#topic+tiingo_api_key">tiingo_api_key()</a></code>.
</p>
</li>
<li> <p><code>"alphavantager"</code>: Get data sets from
<a href="https://www.alphavantage.co/">Alpha Vantage</a>. Wrapper for <code>alphavantager::av_get()</code>.
See also <code><a href="#topic+av_api_key">av_api_key()</a></code>.
</p>
</li>
<li> <p><code>"rblpapi"</code>: Get data sets from
<a href="https://www.bloomberg.com/professional/solution/bloomberg-terminal/">Bloomberg</a>. Wrapper for <code>Rblpapi</code>.
See also <code><a href="Rblpapi.html#topic+blpConnect">Rblpapi::blpConnect()</a></code> to connect to Bloomberg terminal (required).
Use the argument <code>rblpapi_fun</code> to set the function such as &quot;bdh&quot; (default), &quot;bds&quot;, or &quot;bdp&quot;.
</p>
</li></ul>
</td></tr>
<tr><td><code id="tq_get_+3A_complete_cases">complete_cases</code></td>
<td>
<p>Removes symbols that return an NA value due to an error with the get
call such as sending an incorrect symbol &quot;XYZ&quot; to get = &quot;stock.prices&quot;. This is useful in
scaling so user does not need to
add an extra step to remove these rows. <code>TRUE</code> by default, and a warning
message is generated for any rows removed.</p>
</td></tr>
<tr><td><code id="tq_get_+3A_...">...</code></td>
<td>
<p>Additional parameters passed to the &quot;wrapped&quot;
function. Investigate underlying functions to see full list of arguments.
Common optional parameters include:
</p>

<ul>
<li> <p><code>from</code>: Standardized for time series functions in <code>quantmod</code>, <code>quandl</code>, <code>tiingo</code>, <code>alphavantager</code> packages.
A character string representing a start date in
YYYY-MM-DD format.
</p>
</li>
<li> <p><code>to</code>: Standardized for time series functions in <code>quantmod</code>, <code>quandl</code>, <code>tiingo</code>, <code>alphavantager</code> packages.
A character string representing a end date in
YYYY-MM-DD format.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p><code>tq_get()</code> is a consolidated function that gets data from various
web sources. The function is a wrapper for several <code>quantmod</code>
functions, <code>Quandl</code> functions, and also gets data from websources unavailable
in other packages.
The results are always returned as a <code>tibble</code>. The advantages
are (1) only one function is needed for all data sources and (2) the function
can be seemlessly used with the tidyverse: <code>purrr</code>, <code>tidyr</code>, and
<code>dplyr</code> verbs.
</p>
<p><code>tq_get_options()</code> returns a list of valid <code>get</code> options you can
choose from.
</p>
<p><code>tq_get_stock_index_options()</code> Is deprecated and will be removed in the
next version. Please use <code>tq_index_options()</code> instead.
</p>


<h3>Value</h3>

<p>Returns data in the form of a <code>tibble</code> object.
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+tq_index">tq_index()</a></code> to get a ful list of stocks in an index.
</p>
</li>
<li> <p><code><a href="#topic+tq_exchange">tq_exchange()</a></code> to get a ful list of stocks in an exchange.
</p>
</li>
<li> <p><code><a href="#topic+quandl_api_key">quandl_api_key()</a></code> to set the api key for collecting data via the <code>"quandl"</code>
get option.
</p>
</li>
<li> <p><code><a href="#topic+tiingo_api_key">tiingo_api_key()</a></code> to set the api key for collecting data via the <code>"tiingo"</code>
get option.
</p>
</li>
<li> <p><code><a href="#topic+av_api_key">av_api_key()</a></code> to set the api key for collecting data via the <code>"alphavantage"</code>
get option.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Load libraries
library(tidyquant)
library(tidyverse)

# Get the list of `get` options
tq_get_options()

# Get stock prices for a stock from Yahoo
aapl_stock_prices &lt;- tq_get("AAPL")

# Get stock prices for multiple stocks
mult_stocks &lt;- tq_get(c("FB", "AMZN"),
                      get  = "stock.prices",
                      from = "2016-01-01",
                      to   = "2017-01-01")


## Not run: 

# --- Quandl ---

quandl_api_key('&lt;your_api_key&gt;')

# Energy data from EIA
tq_get("EIA/PET_MTTIMUS1_M", get = "quandl", from = "2010-01-01")


# --- Tiingo ---

tiingo_api_key('&lt;your_api_key&gt;')

# Tiingo Prices (Free alternative to Yahoo Finance!)
tq_get(c("AAPL", "GOOG"), get = "tiingo", from = "2010-01-01")

# Sub-daily prices from IEX ----
tq_get(c("AAPL", "GOOG"),
       get = "tiingo.iex",
       from   = "2020-01-01",
       to     = "2020-01-15",
       resample_frequency = "5min")

# Tiingo Bitcoin Prices ----
tq_get(c("btcusd", "btceur"),
       get    = "tiingo.crypto",
       from   = "2020-01-01",
       to     = "2020-01-15",
       resample_frequency = "5min")


# --- Alpha Vantage ---

av_api_key('&lt;your_api_key&gt;')

# Daily Time Series
tq_get("AAPL",
       get        = "alphavantager",
       av_fun     = "TIME_SERIES_DAILY_ADJUSTED",
       outputsize = "full")

# Intraday 15 Min Interval
tq_get("AAPL",
       get        = "alphavantage",
       av_fun     = "TIME_SERIES_INTRADAY",
       interval   = "15min",
       outputsize = "full")

# FX DAILY
tq_get("USD/EUR", get = "alphavantage", av_fun = "FX_DAILY", outputsize = "full")

# FX REAL-TIME QUOTE
tq_get("USD/EUR", get = "alphavantage", av_fun = "CURRENCY_EXCHANGE_RATE")


## End(Not run)
</code></pre>

<hr>
<h2 id='tq_index'>Get all stocks in a stock index or stock exchange in <code>tibble</code> format</h2><span id='topic+tq_index'></span><span id='topic+tq_exchange'></span><span id='topic+tq_index_options'></span><span id='topic+tq_exchange_options'></span>

<h3>Description</h3>

<p>Get all stocks in a stock index or stock exchange in <code>tibble</code> format
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tq_index(x, use_fallback = FALSE)

tq_exchange(x)

tq_index_options()

tq_exchange_options()
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tq_index_+3A_x">x</code></td>
<td>
<p>A single character string, a character vector or tibble representing a
single stock index or multiple stock indexes.</p>
</td></tr>
<tr><td><code id="tq_index_+3A_use_fallback">use_fallback</code></td>
<td>
<p>A boolean that can be used to return a fallback data set
last downloaded when the package was updated. Useful if the website is down.
Set to <code>FALSE</code> by default.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>tq_index()</code> returns the stock symbol, company name, weight, and sector of every stock
in an index. The source is
<a href="https://www.ssga.com/us/en/individual/etfs/fund-finder">www.ssga.com</a>.
</p>
<p><code>tq_index_options()</code> returns a list of stock indexes you can
choose from.
</p>
<p><code>tq_exchange()</code> returns the stock symbol, company, last sale price,
market capitalization, sector and industry of every stock
in an exchange. Three stock exchanges are available (AMEX, NASDAQ, and NYSE).
</p>
<p><code>tq_exchange_options()</code> returns a list of stock exchanges you can
choose from. The options are AMEX, NASDAQ and NYSE.
</p>


<h3>Value</h3>

<p>Returns data in the form of a <code>tibble</code> object.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+tq_get">tq_get()</a></code> to get stock prices, financials, key stats, etc using the stock symbols.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Load libraries
library(tidyquant)

# Get the list of stock index options
tq_index_options()

# Get all stock symbols in a stock index
## Not run: 
tq_index("DOW")

## End(Not run)

# Get the list of stock exchange options
tq_exchange_options()

# Get all stocks in a stock exchange
## Not run: 
tq_exchange("NYSE")

## End(Not run)

</code></pre>

<hr>
<h2 id='tq_mutate'>Mutates quantitative data</h2><span id='topic+tq_mutate'></span><span id='topic+tq_mutate_'></span><span id='topic+tq_mutate_xy'></span><span id='topic+tq_mutate_xy_'></span><span id='topic+tq_mutate_fun_options'></span><span id='topic+tq_transmute'></span><span id='topic+tq_transmute_'></span><span id='topic+tq_transmute_xy'></span><span id='topic+tq_transmute_xy_'></span><span id='topic+tq_transmute_fun_options'></span>

<h3>Description</h3>

<p><code>tq_mutate()</code> adds new variables to an existing tibble;
<code>tq_transmute()</code> returns only newly created columns and is typically
used when periodicity changes
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tq_mutate(
  data,
  select = NULL,
  mutate_fun,
  col_rename = NULL,
  ohlc_fun = NULL,
  ...
)

tq_mutate_(data, select = NULL, mutate_fun, col_rename = NULL, ...)

tq_mutate_xy(data, x, y = NULL, mutate_fun, col_rename = NULL, ...)

tq_mutate_xy_(data, x, y = NULL, mutate_fun, col_rename = NULL, ...)

tq_mutate_fun_options()

tq_transmute(
  data,
  select = NULL,
  mutate_fun,
  col_rename = NULL,
  ohlc_fun = NULL,
  ...
)

tq_transmute_(data, select = NULL, mutate_fun, col_rename = NULL, ...)

tq_transmute_xy(data, x, y = NULL, mutate_fun, col_rename = NULL, ...)

tq_transmute_xy_(data, x, y = NULL, mutate_fun, col_rename = NULL, ...)

tq_transmute_fun_options()
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tq_mutate_+3A_data">data</code></td>
<td>
<p>A <code>tibble</code> (tidy data frame) of data typically from <code><a href="#topic+tq_get">tq_get()</a></code>.</p>
</td></tr>
<tr><td><code id="tq_mutate_+3A_select">select</code></td>
<td>
<p>The columns to send to the mutation function.</p>
</td></tr>
<tr><td><code id="tq_mutate_+3A_mutate_fun">mutate_fun</code></td>
<td>
<p>The mutation function from either the <code>xts</code>,
<code>quantmod</code>, or <code>TTR</code> package. Execute <code>tq_mutate_fun_options()</code>
to see the full list of options by package.</p>
</td></tr>
<tr><td><code id="tq_mutate_+3A_col_rename">col_rename</code></td>
<td>
<p>A string or character vector containing names that can be used
to quickly rename columns.</p>
</td></tr>
<tr><td><code id="tq_mutate_+3A_ohlc_fun">ohlc_fun</code></td>
<td>
<p>Deprecated. Use <code>select</code>.</p>
</td></tr>
<tr><td><code id="tq_mutate_+3A_...">...</code></td>
<td>
<p>Additional parameters passed to the appropriate mutatation
function.</p>
</td></tr>
<tr><td><code id="tq_mutate_+3A_x">x</code>, <code id="tq_mutate_+3A_y">y</code></td>
<td>
<p>Parameters used with <code style="white-space: pre;">&#8288;_xy&#8288;</code> that consist of column names of variables
to be passed to the mutatation function (instead of OHLC functions).</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>tq_mutate</code> and <code>tq_transmute</code> are very flexible wrappers for various <code>xts</code>,
<code>quantmod</code> and <code>TTR</code> functions. The main advantage is the
results are returned as a <code>tibble</code> and the
function can be used with the <code>tidyverse</code>. <code>tq_mutate</code> is used when additional
columns are added to the return data frame. <code>tq_transmute</code> works exactly like <code>tq_mutate</code>
except it only returns the newly created columns. This is helpful when
changing periodicity where the new columns would not have the same number of rows
as the original tibble.
</p>
<p><code>select</code> specifies the columns that get passed to the mutation function. Select works
as a more flexible version of the OHLC extractor functions from <code>quantmod</code> where
non-OHLC data works as well. When <code>select</code> is <code>NULL</code>, all columns are selected.
In Example 1 below, <code>close</code> returns the &quot;close&quot; price and sends this to the
mutate function, <code>periodReturn</code>.
</p>
<p><code>mutate_fun</code> is the function that performs the work. In Example 1, this
is <code>periodReturn</code>, which calculates the period returns. The <code>...</code>
are additional arguments passed to the <code>mutate_fun</code>. Think of
the whole operation in Example 1 as the close price, obtained by <code>select = close</code>,
being sent to the <code>periodReturn</code> function along
with additional arguments defining how to perform the period return, which
includes <code>period = "daily"</code> and <code>type = "log"</code>.
Example 4 shows how to apply a rolling regression.
</p>
<p><code>tq_mutate_xy</code> and <code>tq_transmute_xy</code> are designed to enable working with mutatation
functions that require two primary inputs (e.g. EVWMA, VWAP, etc).
Example 2 shows this benefit in action: using the EVWMA function that uses
volume to define the moving average period.
</p>
<p><code>tq_mutate_</code>, <code>tq_mutate_xy_</code>, <code>tq_transmute_</code>, and <code>tq_transmute_xy_</code>
are setup for Non-Standard
Evaluation (NSE). This enables programatically changing column names by modifying
the text representations. Example 5 shows the difference in implementation.
Note that character strings are being passed to the variables instead of
unquoted variable names. See <code>vignette("nse")</code> for more information.
</p>
<p><code>tq_mutate_fun_options</code> and <code>tq_transmute_fun_options</code> return a list of various
financial functions that are compatible with <code>tq_mutate</code> and <code>tq_transmute</code>,
respectively.
</p>


<h3>Value</h3>

<p>Returns mutated data in the form of a <code>tibble</code> object.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+tq_get">tq_get()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Load libraries
library(tidyquant)
library(dplyr)

##### Basic Functionality

fb_stock_prices  &lt;- FANG %&gt;%
    filter(symbol == "FB") %&gt;%
        filter(
            date &gt;= "2016-01-01",
            date &lt;= "2016-12-31"
        )

goog_stock_prices  &lt;- FANG %&gt;%
    filter(symbol == "GOOG") %&gt;%
        filter(
            date &gt;= "2016-01-01",
            date &lt;= "2016-12-31"
        )

# Example 1: Return logarithmic daily returns using periodReturn()
fb_stock_prices %&gt;%
    tq_mutate(select = close, mutate_fun = periodReturn,
              period = "daily", type = "log")

# Example 2: Use tq_mutate_xy to use functions with two columns required
fb_stock_prices %&gt;%
    tq_mutate_xy(x = close, y = volume, mutate_fun = EVWMA,
                 col_rename = "EVWMA")

# Example 3: Using tq_mutate to work with non-OHLC data
tq_get("DCOILWTICO", get = "economic.data") %&gt;%
    tq_mutate(select = price, mutate_fun = lag.xts, k = 1, na.pad = TRUE)

# Example 4: Using tq_mutate to apply a rolling regression
fb_returns &lt;- fb_stock_prices %&gt;%
    tq_transmute(adjusted, periodReturn, period = "monthly", col_rename = "fb.returns")
goog_returns &lt;- goog_stock_prices %&gt;%
    tq_transmute(adjusted, periodReturn, period = "monthly", col_rename = "goog.returns")
returns_combined &lt;- left_join(fb_returns, goog_returns, by = "date")
regr_fun &lt;- function(data) {
    coef(lm(fb.returns ~ goog.returns, data = as_tibble(data)))
}
returns_combined %&gt;%
    tq_mutate(mutate_fun = rollapply,
              width      = 6,
              FUN        = regr_fun,
              by.column  = FALSE,
              col_rename = c("coef.0", "coef.1"))

# Example 5: Non-standard evaluation:
# Programming with tq_mutate_() and tq_mutate_xy_()
col_name &lt;- "adjusted"
mutate &lt;- c("MACD", "SMA")
tq_mutate_xy_(fb_stock_prices, x = col_name, mutate_fun = mutate[[1]])
</code></pre>

<hr>
<h2 id='tq_performance'>Computes a wide variety of summary performance metrics from stock or portfolio returns</h2><span id='topic+tq_performance'></span><span id='topic+tq_performance_'></span><span id='topic+tq_performance_fun_options'></span>

<h3>Description</h3>

<p>Asset and portfolio performance analysis is a deep field with a wide range of theories and
methods for analyzing risk versus reward. The <code>PerformanceAnalytics</code> package
consolidates many of the most widely used performance metrics as functions that can
be applied to stock or portfolio returns. <code>tq_performance</code>
implements these performance analysis functions in a tidy way, enabling scaling
analysis using the split, apply, combine framework.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tq_performance(data, Ra, Rb = NULL, performance_fun, ...)

tq_performance_(data, Ra, Rb = NULL, performance_fun, ...)

tq_performance_fun_options()
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tq_performance_+3A_data">data</code></td>
<td>
<p>A <code>tibble</code> (tidy data frame) of returns in tidy format (i.e long format).</p>
</td></tr>
<tr><td><code id="tq_performance_+3A_ra">Ra</code></td>
<td>
<p>The column of asset returns</p>
</td></tr>
<tr><td><code id="tq_performance_+3A_rb">Rb</code></td>
<td>
<p>The column of baseline returns (for functions that require comparison to a baseline)</p>
</td></tr>
<tr><td><code id="tq_performance_+3A_performance_fun">performance_fun</code></td>
<td>
<p>The performance function from <code>PerformanceAnalytics</code>. See
<code>tq_performance_fun_options()</code> for a complete list of integrated functions.</p>
</td></tr>
<tr><td><code id="tq_performance_+3A_...">...</code></td>
<td>
<p>Additional parameters passed to the <code>PerformanceAnalytics</code> function.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Important concept</strong>: Performance is based on the statistical properties of returns,
and as a result this function uses stock or portfolio returns as opposed
to stock prices.
</p>
<p><code>tq_performance</code> is a wrapper for various <code>PerformanceAnalytics</code> functions
that return portfolio statistics.
The main advantage is the ability to scale with the <code>tidyverse</code>.
</p>
<p><code>Ra</code> and <code>Rb</code> are the columns containing asset and baseline returns, respectively.
These columns are mapped to the <code>PerformanceAnalytics</code> functions. Note that <code>Rb</code>
is not always required, and in these instances the argument defaults to <code>Rb = NULL</code>.
The user can tell if <code>Rb</code> is required by researching the underlying performance function.
</p>
<p><code>...</code> are additional arguments that are passed to the <code>PerformanceAnalytics</code>
function. Search the underlying function to see what arguments can be passed through.
</p>
<p><code>tq_performance_fun_options</code> returns a list of compatible <code>PerformanceAnalytics</code> functions
that can be supplied to the <code>performance_fun</code> argument.
</p>


<h3>Value</h3>

<p>Returns data in the form of a <code>tibble</code> object.
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+tq_transmute">tq_transmute()</a></code> which can be used to calculate period returns from a
set of stock prices. Use <code>mutate_fun = periodReturn</code> with the appropriate periodicity
such as <code>period = "monthly"</code>.
</p>
</li>
<li> <p><code><a href="#topic+tq_portfolio">tq_portfolio()</a></code> which can be used to aggregate period returns from
multiple stocks to period returns for a portfolio.
</p>
</li>
<li><p> The <code>PerformanceAnalytics</code> package, which contains the underlying functions
for the <code>performance_fun</code> argument. Additional parameters can be passed via <code>...</code>.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Load libraries
library(tidyquant)
library(dplyr)

# Use FANG data set
data(FANG)

# Get returns for individual stock components grouped by symbol
Ra &lt;- FANG %&gt;%
    group_by(symbol) %&gt;%
    tq_transmute(adjusted, periodReturn, period = "monthly", col_rename = "Ra")

# Get returns for SP500 as baseline
Rb &lt;- "^GSPC" %&gt;%
    tq_get(get  = "stock.prices",
           from = "2010-01-01",
           to   = "2015-12-31") %&gt;%
    tq_transmute(adjusted, periodReturn, period = "monthly", col_rename = "Rb")

# Merge stock returns with baseline
RaRb &lt;- left_join(Ra, Rb, by = c("date" = "date"))

##### Performance Metrics #####

# View options
tq_performance_fun_options()

# Get performance metrics
RaRb %&gt;%
    tq_performance(Ra = Ra, performance_fun = SharpeRatio, p = 0.95)

RaRb %&gt;%
    tq_performance(Ra = Ra, Rb = Rb, performance_fun = table.CAPM)

</code></pre>

<hr>
<h2 id='tq_portfolio'>Aggregates a group of returns by asset into portfolio returns</h2><span id='topic+tq_portfolio'></span><span id='topic+tq_portfolio_'></span><span id='topic+tq_repeat_df'></span>

<h3>Description</h3>

<p>Aggregates a group of returns by asset into portfolio returns
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tq_portfolio(
  data,
  assets_col,
  returns_col,
  weights = NULL,
  col_rename = NULL,
  ...
)

tq_portfolio_(
  data,
  assets_col,
  returns_col,
  weights = NULL,
  col_rename = NULL,
  ...
)

tq_repeat_df(data, n, index_col_name = "portfolio")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tq_portfolio_+3A_data">data</code></td>
<td>
<p>A <code>tibble</code> (tidy data frame) of returns in tidy format (i.e long format).</p>
</td></tr>
<tr><td><code id="tq_portfolio_+3A_assets_col">assets_col</code></td>
<td>
<p>The column with assets (securities)</p>
</td></tr>
<tr><td><code id="tq_portfolio_+3A_returns_col">returns_col</code></td>
<td>
<p>The column with returns</p>
</td></tr>
<tr><td><code id="tq_portfolio_+3A_weights">weights</code></td>
<td>
<p>Optional parameter for the asset weights, which can be passed as a numeric vector the length of
the number of assets or a two column tibble with asset names in first column
and weights in second column.</p>
</td></tr>
<tr><td><code id="tq_portfolio_+3A_col_rename">col_rename</code></td>
<td>
<p>A string or character vector containing names that can be used
to quickly rename columns.</p>
</td></tr>
<tr><td><code id="tq_portfolio_+3A_...">...</code></td>
<td>
<p>Additional parameters passed to <code>PerformanceAnalytics::Returns.portfolio</code></p>
</td></tr>
<tr><td><code id="tq_portfolio_+3A_n">n</code></td>
<td>
<p>Number of times to repeat a data frame row-wise.</p>
</td></tr>
<tr><td><code id="tq_portfolio_+3A_index_col_name">index_col_name</code></td>
<td>
<p>A renaming function for the &quot;index&quot; column, used when repeating data frames.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>tq_portfolio</code> is a wrapper for <code>PerformanceAnalytics::Returns.portfolio</code>.
The main advantage is the results are returned as a <code>tibble</code> and the
function can be used with the <code>tidyverse</code>.
</p>
<p><code>assets_col</code> and <code>returns_col</code> are columns within <code>data</code> that are used
to compute returns for a portfolio. The columns should be in &quot;long&quot; format (or &quot;tidy&quot; format)
meaning there is only one column containing all of the assets and one column containing
all of the return values (i.e. not in &quot;wide&quot; format with returns spread by asset).
</p>
<p><code>weights</code> are the weights to be applied to the asset returns.
Weights can be input in one of three options:
</p>

<ul>
<li><p> Single Portfolio: A numeric vector of weights that is the same length as unique number of assets.
The weights are applied in the order of the assets.
</p>
</li>
<li><p> Single Portfolio: A two column tibble with assets in the first column and weights in the second column.
The advantage to this method is the weights are mapped to the assets and any unlisted
assets default to a weight of zero.
</p>
</li>
<li><p> Multiple Portfolios: A three column tibble with portfolio index in the first
column, assets in the second column, and weights in the third column. The tibble
must be grouped by portfolio index.
</p>
</li></ul>

<p><code>tq_repeat_df</code> is a simple function that repeats
a data frame <code>n</code> times row-wise (long-wise), and adds a new column for a portfolio index.
The function is used to assist in Multiple Portfolio analyses, and
is a useful precursor to <code>tq_portfolio</code>.
</p>


<h3>Value</h3>

<p>Returns data in the form of a <code>tibble</code> object.
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#topic+tq_transmute">tq_transmute()</a></code> which can be used to get period returns.
</p>
</li>
<li> <p><code><a href="PerformanceAnalytics.html#topic+Return.portfolio">PerformanceAnalytics::Return.portfolio()</a></code> which is the underlying function
that specifies which parameters can be passed via <code>...</code>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Load libraries
library(tidyquant)
library(dplyr)

# Use FANG data set
data(FANG)

# Get returns for individual stock components
monthly_returns_stocks &lt;- FANG %&gt;%
    group_by(symbol) %&gt;%
    tq_transmute(adjusted, periodReturn, period = "monthly")

##### Portfolio Aggregation Methods #####

# Method 1: Use tq_portfolio with numeric vector of weights

weights &lt;- c(0.50, 0.25, 0.25, 0)
tq_portfolio(data = monthly_returns_stocks,
             assets_col = symbol,
             returns_col = monthly.returns,
             weights = weights,
             col_rename = NULL,
             wealth.index = FALSE)

# Method 2: Use tq_portfolio with two column tibble and map weights

# Note that GOOG's weighting is zero in Method 1. In Method 2,
# GOOG is not added and same result is achieved.
weights_df &lt;- tibble(symbol = c("FB", "AMZN", "NFLX"),
                     weights = c(0.50, 0.25, 0.25))
tq_portfolio(data = monthly_returns_stocks,
             assets_col = symbol,
             returns_col = monthly.returns,
             weights = weights_df,
             col_rename = NULL,
             wealth.index = FALSE)

# Method 3: Working with multiple portfolios

# 3A: Duplicate monthly_returns_stocks multiple times
mult_monthly_returns_stocks &lt;- tq_repeat_df(monthly_returns_stocks, n = 4)

# 3B: Create weights table grouped by portfolio id
weights &lt;- c(0.50, 0.25, 0.25, 0.00,
             0.00, 0.50, 0.25, 0.25,
             0.25, 0.00, 0.50, 0.25,
             0.25, 0.25, 0.00, 0.50)
stocks &lt;- c("FB", "AMZN", "NFLX", "GOOG")
weights_table &lt;- tibble(stocks) %&gt;%
    tq_repeat_df(n = 4) %&gt;%
    bind_cols(tibble(weights)) %&gt;%
    group_by(portfolio)

# 3C: Scale to multiple portfolios
tq_portfolio(data = mult_monthly_returns_stocks,
             assets_col = symbol,
             returns_col = monthly.returns,
             weights = weights_table,
             col_rename = NULL,
             wealth.index = FALSE)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
